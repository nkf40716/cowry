From blp at nicira.com  Sun Feb  1 13:46:23 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 1 Feb 2015 13:46:23 -0800
Subject: [ovs-discuss] packet loss in RSPAN trafic
In-Reply-To: <CAONKcZKTWAcDUXAbzneCJuYt8wmgiD6RAS4K8sOWMQrdsw4E8w@mail.gmail.com>
References: <CAONKcZKTWAcDUXAbzneCJuYt8wmgiD6RAS4K8sOWMQrdsw4E8w@mail.gmail.com>
Message-ID: <20150201214623.GA24647@nicira.com>

On Sat, Jan 31, 2015 at 03:41:13PM +0100, Philippe Gautier wrote:
> I detect packet loss when I analyse GRE traffic sended by RSPAN. Is there a
> default sampling parameter when configuring port mirroring ?

No, mirroring should copy all packets.

> Test platform and scenario:
> 
> Two KVM virtual hosts (port internet2, internet3) hosted on a physical host
> (port br0 and eth0). Trafic is sended through the gre interface to a remote
> host. The gre trafic is sended through eth0 physical interface.
> 
> When I generate a trafic between a vm and an internet host (In my case
> google server) I capture real and RSPAN trafic on eth0 interface.

It looks like the first packet is getting mirrored but a number of
packets after that are getting dropped, and that then after some time
the mirroring picks up again.  I wonder whether this is caused by ARP.
I believe that one valid way to do ARP is to queue the first packet to a
destination while waiting for an ARP response but drop later packets to
that destination until the ARP response arrives.  That would explain
this behavior.  So: does it help to add a static ARP entry for your
tunnel destination?

From blp at nicira.com  Sun Feb  1 13:50:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 1 Feb 2015 13:50:51 -0800
Subject: [ovs-discuss] How to support the ovs-group command?
In-Reply-To: <2C54893E2A0C484DA1249B509D857C394DFF112A@SZXEML506-MBS.china.huawei.com>
References: <2C54893E2A0C484DA1249B509D857C394DFF112A@SZXEML506-MBS.china.huawei.com>
Message-ID: <20150201215051.GB24647@nicira.com>

On Sat, Jan 31, 2015 at 07:13:44AM +0000, yuanfeng (A) wrote:
> Hi All,
>          Can anyone please tell me about the ovs-version and the OpenFlow13 group operation, I tried the group command to test the multipath function and found problem as below
> 
> [root at controller ~]# ovs-ofctl -O OpenFlow13 add-group $BRIDGE_NAME group_id=5566,type=select,bucket=output:1,bucket=output:2,bucket=output:3
> ovs-ofctl: unknown command 'add-group'; use --help for help
> 
>          My OVS version is 1.11.0

That's too old.  Only OVS 2.1 and later supports groups.

From blp at nicira.com  Sun Feb  1 13:54:39 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 1 Feb 2015 13:54:39 -0800
Subject: [ovs-discuss] debugging openvswitch command-line clients
In-Reply-To: <CANPUzQ0hmMBdRLt5rg7GOV7mQf_WM3jxTR5_k_SZ-V4TYcYFxg@mail.gmail.com>
References: <CANPUzQ0hmMBdRLt5rg7GOV7mQf_WM3jxTR5_k_SZ-V4TYcYFxg@mail.gmail.com>
Message-ID: <20150201215439.GC24647@nicira.com>

On Sat, Jan 31, 2015 at 05:28:23PM +0500, david jhon wrote:
> Now I want to debug openvswitch command-line clients such as vsctl, ofctl,
> appctl etc. I have started with debugging command "ovs-vsctl show" after I
> set a breakpoint in openvswitch-2.3.0/utilities/ovs-vsctl.c using gdb but
> it is not working for me. Please let me know how do I precede further in
> this regard. Any help is highly appreciated.

What does it mean that "it is not working"?

From blp at nicira.com  Sun Feb  1 13:55:21 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 1 Feb 2015 13:55:21 -0800
Subject: [ovs-discuss] patch
In-Reply-To: <CABFtFwm0eDWF84+B0j6iBMO=g_m9HJ04p05dwXK9tJk=fCVTeA@mail.gmail.com>
References: <CABFtFwkOMG0kFdR8-Uj2QeUAb4wSf7pnj=SagX2TjgyeVxnR-Q@mail.gmail.com>
 <B13165A8-668F-462B-8E16-513208C5257A@nicira.com>
 <CABFtFwk9MzweqvEGccv0mb_HV6+AF63DkgPYCC3aML6TvsiwoA@mail.gmail.com>
 <CABFtFwm0eDWF84+B0j6iBMO=g_m9HJ04p05dwXK9tJk=fCVTeA@mail.gmail.com>
Message-ID: <20150201215521.GD24647@nicira.com>

On Fri, Jan 30, 2015 at 05:13:42PM -0800, Ashok Chippa wrote:
> root at ashok-vb:/usr/local/bin# ovs-ofctl del-flows br-int
> root at ashok-vb:/usr/local/bin# ovs-ofctl dump-tables br-int
> OFPST_TABLE reply (xid=0x2): 254 tables
>   0: classifier: wild=0x3fffff, max=1000000, active=10
>                lookup=0, matched=0
>   1: table1  : wild=0x3fffff, max=1000000, active=0

If you apply the patch, then it will show active=0.

From a.n.chippa at gmail.com  Sun Feb  1 15:07:28 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Sun, 1 Feb 2015 15:07:28 -0800
Subject: [ovs-discuss] patch
In-Reply-To: <20150201215521.GD24647@nicira.com>
References: <CABFtFwkOMG0kFdR8-Uj2QeUAb4wSf7pnj=SagX2TjgyeVxnR-Q@mail.gmail.com>
 <B13165A8-668F-462B-8E16-513208C5257A@nicira.com>
 <CABFtFwk9MzweqvEGccv0mb_HV6+AF63DkgPYCC3aML6TvsiwoA@mail.gmail.com>
 <CABFtFwm0eDWF84+B0j6iBMO=g_m9HJ04p05dwXK9tJk=fCVTeA@mail.gmail.com>
 <20150201215521.GD24647@nicira.com>
Message-ID: <CABFtFw=1+p+zSfNE7n_N6G0hV7i4uca4tb3Ocmgi7tPXuncYQA@mail.gmail.com>

Thanks, I figure so... Will do and let you know if it worked...

On Sun, Feb 1, 2015 at 1:55 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Jan 30, 2015 at 05:13:42PM -0800, Ashok Chippa wrote:
> > root at ashok-vb:/usr/local/bin# ovs-ofctl del-flows br-int
> > root at ashok-vb:/usr/local/bin# ovs-ofctl dump-tables br-int
> > OFPST_TABLE reply (xid=0x2): 254 tables
> >   0: classifier: wild=0x3fffff, max=1000000, active=10
> >                lookup=0, matched=0
> >   1: table1  : wild=0x3fffff, max=1000000, active=0
>
> If you apply the patch, then it will show active=0.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150201/f6afb2ed/attachment.html>

From a.n.chippa at gmail.com  Sun Feb  1 23:05:06 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Sun, 1 Feb 2015 23:05:06 -0800
Subject: [ovs-discuss] patch
In-Reply-To: <CABFtFw=1+p+zSfNE7n_N6G0hV7i4uca4tb3Ocmgi7tPXuncYQA@mail.gmail.com>
References: <CABFtFwkOMG0kFdR8-Uj2QeUAb4wSf7pnj=SagX2TjgyeVxnR-Q@mail.gmail.com>
 <B13165A8-668F-462B-8E16-513208C5257A@nicira.com>
 <CABFtFwk9MzweqvEGccv0mb_HV6+AF63DkgPYCC3aML6TvsiwoA@mail.gmail.com>
 <CABFtFwm0eDWF84+B0j6iBMO=g_m9HJ04p05dwXK9tJk=fCVTeA@mail.gmail.com>
 <20150201215521.GD24647@nicira.com>
 <CABFtFw=1+p+zSfNE7n_N6G0hV7i4uca4tb3Ocmgi7tPXuncYQA@mail.gmail.com>
Message-ID: <CABFtFwkW1r1oXTbECBQhi17XRVSD9uv4WcLH7gAznMmzH1LeOQ@mail.gmail.com>

Can one of you please apply these diffs to 2.3.0 and provide me with a
patch. I am not able to readily figure out where (and how) in ofproto.c
this needs to be applied: It will take me more time to figure this out, as
I am not the original author of this code...

Appreciate your help. I will then patch it and test it. Thanks.

Here's ofproto.c.rej:



On Sun, Feb 1, 2015 at 3:07 PM, Ashok Chippa <a.n.chippa at gmail.com> wrote:

> Thanks, I figure so... Will do and let you know if it worked...
>
> On Sun, Feb 1, 2015 at 1:55 PM, Ben Pfaff <blp at nicira.com> wrote:
>
>> On Fri, Jan 30, 2015 at 05:13:42PM -0800, Ashok Chippa wrote:
>> > root at ashok-vb:/usr/local/bin# ovs-ofctl del-flows br-int
>> > root at ashok-vb:/usr/local/bin# ovs-ofctl dump-tables br-int
>> > OFPST_TABLE reply (xid=0x2): 254 tables
>> >   0: classifier: wild=0x3fffff, max=1000000, active=10
>> >                lookup=0, matched=0
>> >   1: table1  : wild=0x3fffff, max=1000000, active=0
>>
>> If you apply the patch, then it will show active=0.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150201/57f67180/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ofproto.c.rej
Type: text/x-reject
Size: 602 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150201/57f67180/attachment-0001.bin>

From zeech at sina.cn  Sun Feb  1 23:43:44 2015
From: zeech at sina.cn (zeech at sina.cn)
Date: Mon, 02 Feb 2015 15:43:44 +0800 
Subject: [ovs-discuss] Build openvswitch in openwrt failed!
Message-ID: <20150202074345.39D5EC60006@webmail.sinamail.sina.com.cn>

Help!I git the openwrt trunk, and when I compile openvswitch over octeon platform, some errors occurred.make  all-recursivemake[4]: Entering directory `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1'Making all in /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linuxmake[5]: Entering directory `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux'ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../actions.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../datapath.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../dp_notify.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../flow.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../flow_netlink.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../flow_table.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-gre.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-internal_dev.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-lisp.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-netdev.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-vxlan.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/dev-openvswitch.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/exthdrs_core.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/flex_array.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/flow_dissector.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/gre.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/gso.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/genetlink-openvswitch.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/hash.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/hash-x86.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/ip_tunnels_core.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/netdevice.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/net_namespace.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/reciprocal_div.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/skbuff-openvswitch.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/vxlan.c ln -s /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/utils.c make -C /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/linux-octeon/linux-3.14.28 M=/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux modulesmake[6]: Entering directory `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/linux-octeon/linux-3.14.28'  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/actions.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/datapath.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dp_notify.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_netlink.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_table.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-gre.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-internal_dev.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-lisp.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-netdev.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-vxlan.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dev-openvswitch.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/exthdrs_core.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flex_array.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_dissector.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gre.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gso.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/genetlink-openvswitch.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash-x86.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/ip_tunnels_core.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/netdevice.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/net_namespace.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/reciprocal_div.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/skbuff-openvswitch.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vxlan.o  CC [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/utils.o  LD [M]  /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/openvswitch.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/actions.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/actions.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/datapath.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/datapath.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dp_notify.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dp_notify.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_netlink.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_netlink.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_table.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_table.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-gre.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-gre.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-internal_dev.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-internal_dev.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-lisp.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-lisp.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-netdev.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-netdev.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-vxlan.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-vxlan.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dev-openvswitch.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dev-openvswitch.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/exthdrs_core.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/exthdrs_core.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flex_array.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flex_array.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_dissector.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_dissector.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gre.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gre.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gso.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gso.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/genetlink-openvswitch.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/genetlink-openvswitch.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash-x86.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash-x86.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/ip_tunnels_core.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/ip_tunnels_core.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/netdevice.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/netdevice.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/net_namespace.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/net_namespace.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/reciprocal_div.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/reciprocal_div.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/skbuff-openvswitch.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/skbuff-openvswitch.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vxlan.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vxlan.omips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/utils.o: ABI is incompatible with that of the selected emulationmips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/utils.omips64-openwrt-linux-uclibc-ld: Attempt to do relocatable link with elf64-tradbigmips input and elf32-ntradbigmips outputmips64-openwrt-linux-uclibc-ld: /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/actions.o: file class ELFCLASS64 incompatible with ELFCLASS32mips64-openwrt-linux-uclibc-ld: final link failed: File in wrong formatmake[7]: *** [/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/openvswitch.o] Error 1make[6]: *** [_module_/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux] Error 2make[6]: Leaving directory `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/linux-octeon/linux-3.14.28'make[5]: *** [default] Error 2make[5]: Leaving directory `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux'
I built the whole openwrt by:make dircleanmake menuconfigmake V=s
But it works over 32bit platforms.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/c60ec586/attachment-0001.html>

From danicamps81 at gmail.com  Mon Feb  2 02:29:02 2015
From: danicamps81 at gmail.com (Dani Camps)
Date: Mon, 2 Feb 2015 11:29:02 +0100
Subject: [ovs-discuss] Problem compiling ovs with dist-hooks-git in
	Makefile.am
Message-ID: <CAD3NH5WT=cUR7SnRffHwXVE5wiAWwiFEOREaSNRgoOVe9CSShw@mail.gmail.com>

Dear all,

I have cloned openvswitch into a private git repository and when
compiling with make I get an error that the distribution is missing
files in dist-hooks-git.

The error comes from this line in Makefile.am:

(cd $(srcdir) && git ls-files) | grep -v '\.gitignore$$' | \
sort -u > all-gitfiles;

Because in my case the grep statement, which I understand should
filter out all files ignored in .gitignore, is not filtering anything.

I am no expert on grep expressions, but I was wondering if this could
be missing the -f modifier if what we want is to take the search
expressions from a file.

Any help is appreciated. I copy my .gitignore at the end of the mail.

Best Regards

Daniel

#*#
*.a
*.d
*.ko
*.la
*.lo
*.loT
*.mod.c
*.o
*.o
*.pyc
*.so
*~
*,cover
.#*
.*.cmd
.*.swp
.coverage
.deps
.dirstamp
.libs
.tmp_versions
/Makefile
/Makefile.in
/aclocal.m4
/all-distfiles
/all-gitfiles
/autom4te.cache
/build-arch-stamp
/build-indep-stamp
/compile
/config.guess
/config.h
/config.h.in
/config.log
/config.status
/config.sub
/configure
/configure-stamp
/depcomp
/distfiles
/install-sh
/manpage-check
/missing
/missing-distfiles
/package.m4
/stamp-h1
Module.symvers
TAGS
cscope.*
tags

From andrey at xdel.ru  Mon Feb  2 02:53:20 2015
From: andrey at xdel.ru (Andrey Korolyov)
Date: Mon, 2 Feb 2015 14:53:20 +0400
Subject: [ovs-discuss] Packet drops during non-exhaustive flood with OVS
	and 1.8.0
In-Reply-To: <CABYiri9WwQMn1u7TbJNEGCs804f_hvP2cKxet2sGMbrx1rJUyw@mail.gmail.com>
References: <CABYiri-qn_HGYeRSxH+z0+LGi0se9NEOk0q9hzFg4R+wg05ABw@mail.gmail.com>
 <CABYiri9WwQMn1u7TbJNEGCs804f_hvP2cKxet2sGMbrx1rJUyw@mail.gmail.com>
Message-ID: <CABYiri_q4QqWrhTQL-UZ1wf3FLz-wj9SbtBJrDntz2Bw4cEPoQ@mail.gmail.com>

On Thu, Jan 22, 2015 at 8:11 PM, Andrey Korolyov <andrey at xdel.ru> wrote:
> On Wed, Jan 21, 2015 at 8:02 PM, Andrey Korolyov <andrey at xdel.ru> wrote:
>> Hello,
>>
>> I observed that the latest OVS with dpdk-1.8.0 and igb_uio starts to
>> drop packets earlier than a regular Linux ixgbe 10G interface, setup
>> follows:
>>
>> receiver/forwarder:
>> - 8 core/2 head system with E5-2603v2, cores 1-3 are given to OVS exclusively
>> - n-dpdk-rxqs=6, rx scattering is not enabled
>> - x520 da
>> - 3.10/3.18 host kernel
>> - during 'legacy mode' testing, queue interrupts are scattered through all cores
>>
>> sender:
>> - 16-core E52630, netmap framework for packet generation
>> - pkt-gen -f tx -i eth2 -s 10.6.9.0-10.6.9.255 -d
>> 10.6.10.0-10.6.10.255 -S 90:e2:ba:84:19:a0 -D 90:e2:ba:85:06:07 -R
>> 11000000, results in 11Mpps 60-byte packet flood, there are constant
>> values during test.
>>
>> OVS contains only single drop rule at the moment:
>> ovs-ofctl add-flow br0 in_port=1,actions=DROP
>>
>> Packet generator was launched for tens of seconds for both Linux stack
>> and OVS+DPDK cases, resulting in zero drop/error count on the
>> interface in first, along with same counter values on pktgen and host
>> interface stat (means that the none of generated packets are
>> unaccounted).
>>
>> I selected rate for about 11M because OVS starts to do packet drop
>> around this value, after same short test interface stat shows
>> following:
>>
>> statistics          : {collisions=0, rx_bytes=22003928768,
>> rx_crc_err=0, rx_dropped=0, rx_errors=10694693, rx_frame_err=0,
>> rx_over_err=0, rx_packets=343811387, tx_bytes=0, tx_dropped=0,
>> tx_errors=0, tx_packets=0}
>>
>> pktgen side:
>> Sent 354506080 packets, 60 bytes each, in 32.23 seconds.
>> Speed: 11.00 Mpps Bandwidth: 5.28 Gbps (raw 7.39 Gbps)
>>
>> If rate will be increased up to 13-14Mpps, the relative error/overall
>> ratio will rise up to a one third. So far OVS on dpdk shows perfect
>> results and I do not want to reject this solution due to exhaustive
>> behavior like described one, so I`m open for any suggestions to
>> improve the situation (except using 1.7 branch :) ).
>
> At a glance it looks like there is a problem with pmd threads, as they
> starting to consume about five thousandth of sys% on a dedicated cores
> during flood but in theory they should not. Any ideas for
> debugging/improving this situation are very welcomed!

Over the time from a last message I tried a couple of different
configurations, but packet loss starting to happen as early as at
7-8Mpps. Looks like that the bulk processing which has been in
OVS-DPDK distro is missing from series of patches
(http://openvswitch.org/pipermail/dev/2014-December/049722.html,
http://openvswitch.org/pipermail/dev/2014-December/049723.html).
Before implementing this, I would like to know if there can be any
obvious (not for me unfortunately) clues on this performance issue.

Thanks!

From gmussar at ciena.com  Mon Feb  2 09:30:37 2015
From: gmussar at ciena.com (Mussar, Gary)
Date: Mon, 2 Feb 2015 12:30:37 -0500
Subject: [ovs-discuss] [ dpdk-pktgen execution issue ] Error: Didn't
 find	any ports to use
In-Reply-To: <OFB3C9C421.470DBAFB-ON65257DDD.00247E08-65257DDD.00258980@tcs.com>
References: <OFB3C9C421.470DBAFB-ON65257DDD.00247E08-65257DDD.00258980@tcs.com>
Message-ID: <C281A17C31CFD745B242416D0E96EC637A3CC321@ONWVEXCHMB04.ciena.com>

I am guessing that this is a build issue. The dpdk-1.7.1 code depends on constructors in the object files to register the poll mode drivers. If the drivers are in an object file in a static library and nothing brings that object into the executable, then these constructors will not be invoked.

The work around used for some of the ovdk code is to use the -whole-archive option when linking with the static libraries in an effort to get the driver objects included in the executable. I found that this doesn't always work and if the executable uses libtool, it can result in reordering of the libraries.

I had to build the dpdk-1.7.1 code as a combined, shared library and then remove the -whole-archive kludges. I also changed the link to use the standard -L and -l options to include the intel_dpdk shared library to prevent libtool from reordering the libraries.

Gary

From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Arkajit Ghosh
Sent: Friday, January 30, 2015 01:50
To: discuss
Cc: Arkajit Ghosh
Subject: [ovs-discuss] [ dpdk-pktgen execution issue ] Error: Didn't find any ports to use

Hi,

Facing issue during the execution of dpdk-pktgen. Please find the below details:

Setup details:

> Executing in Guest machine (VM).
> Having 2 logical core.
>Configured 2048 km hugepages
>Number of processor: 2

Scenario to verify: Generate some packets by dpdk-pktgen and then one dpdk-ports will work as a RX end and other one will be as TX end to handle the incoming packets and do the required action.

dpdk-Ports creation: Here is the snapshot

root at tcs-VirtualBox:/usr/src/pktgen-DPDK/dpdk/examples/pktgen# /usr/src/ovs/utilities/ovs-vsctl show
c2245b31-3ca1-49c6-b4c5-1041be5b9dc4
    Bridge "ovsbr0"
        Port "dpdkr2"
            Interface "dpdkr2"
                type: dpdk
                options: {port="2"}
        Port "ovsbr0"
            Interface "ovsbr0"
                type: internal
        Port "dpdkr1"
            Interface "dpdkr1"
                type: dpdk
                options: {port="1"}
root at tcs-VirtualBox:/usr/src/pktgen-DPDK/dpdk/examples/pktgen#

Added the Flow Entrys:

   # Add flows between port 1 (dpdk0) to port 2 (dpdk1)

   ./ovs-ofctl add-flow ovsbr0 in_port=1,action=output:2
   ./ovs-ofctl add-flow ovsbr0 in_port=2,action=output:1


dpdk-pktgen execution error:

 Pktgen created by: Keith Wiles -- >>> Powered by Intel(r) DPDK <<<
-----------------------
EAL: Detected lcore 0 as core 0 on socket 0
EAL: Detected lcore 1 as core 1 on socket 0
EAL: Support maximum 64 logical core(s) by configuration.
EAL: Detected 2 lcore(s)
EAL: Auto-detected process type: PRIMARY
EAL:   cannot open VFIO container, error 2 (No such file or directory)
EAL: VFIO support could not be initialized
EAL: Setting up memory...
EAL: Ask a virtual area of 0x200000 bytes
EAL: Virtual area found at 0x7f282c400000 (size = 0x200000)
EAL: Ask a virtual area of 0x400000 bytes
EAL: Virtual area found at 0x7f282be00000 (size = 0x400000)
EAL: Ask a virtual area of 0x200000 bytes
EAL: Virtual area found at 0x7f282ba00000 (size = 0x200000)
EAL: Ask a virtual area of 0x200000 bytes
EAL: Virtual area found at 0x7f282b600000 (size = 0x200000)
EAL: Ask a virtual area of 0x400000 bytes
EAL: Virtual area found at 0x7f282b000000 (size = 0x400000)
EAL: Ask a virtual area of 0x200000 bytes
EAL: Virtual area found at 0x7f282ac00000 (size = 0x200000)
EAL: Ask a virtual area of 0x200000 bytes
EAL: Virtual area found at 0x7f282a800000 (size = 0x200000)
EAL: Ask a virtual area of 0x400000 bytes
EAL: Virtual area found at 0x7f282a200000 (size = 0x400000)
EAL: Ask a virtual area of 0x800000 bytes
EAL: Virtual area found at 0x7f2829800000 (size = 0x800000)
EAL: Ask a virtual area of 0x200000 bytes
EAL: Virtual area found at 0x7f2829400000 (size = 0x200000)
EAL: Ask a virtual area of 0x1e00000 bytes
EAL: Virtual area found at 0x7f2827400000 (size = 0x1e00000)
EAL: Ask a virtual area of 0xc00000 bytes
EAL: Virtual area found at 0x7f2826600000 (size = 0xc00000)
EAL: Ask a virtual area of 0x1000000 bytes
EAL: Virtual area found at 0x7f2825400000 (size = 0x1000000)
EAL: Ask a virtual area of 0x200000 bytes
EAL: Virtual area found at 0x7f2825000000 (size = 0x200000)
EAL: Ask a virtual area of 0xc00000 bytes
EAL: Virtual area found at 0x7f2824200000 (size = 0xc00000)
EAL: Ask a virtual area of 0xe00000 bytes
EAL: Virtual area found at 0x7f2823200000 (size = 0xe00000)
EAL: Ask a virtual area of 0x200000 bytes
EAL: Virtual area found at 0x7f2822e00000 (size = 0x200000)
EAL: Requesting 60 pages of size 2MB from socket 0
EAL: TSC frequency is ~2979222 KHz
EAL: WARNING: cpu flags constant_tsc=yes nonstop_tsc=no -> using unreliable clock cycles !
EAL: Master core 1 is ready (tid=2d914840)
0.1              = lcores(rx 0000000000000001, tx 0000000000000001) ports(rx 0000000000000002, tx 0000000000000002)
1.2              = lcores(rx 0000000000000002, tx 0000000000000002) ports(rx 0000000000000004, tx 0000000000000004)

Lua 5.2.3  Copyright (C) 1994-2013 Lua.org, PUC-Rio
>>> Packet Burst 32, RX Desc 512, TX Desc 512, mbufs/port 4096, mbuf cache 512
!PANIC!: *** Did not find any ports to use ***
PANIC in pktgen_config_ports():
*** Did not find any ports to use ***6: [./app/build/pktgen() [0x414c73]]
5: [/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf5) [0x7f282c7faec5]]
4: [./app/build/pktgen(main+0x470) [0x414750]]
3: [./app/build/pktgen(pktgen_config_ports+0x1007) [0x42b8c7]]
2: [./app/build/pktgen(__rte_panic+0xc1) [0x414251]]
1: [./app/build/pktgen(rte_dump_stack+0x18) [0x4a7cd8]]
./doit.sh: line 24:  3613 Aborted                 (core dumped) ./app/build/pktgen -c 0x2 -n 2 --proc-type auto -- -m "0.1,1.2"

###############################################

Please suggest how to proceed and also feel free to do mention if I missed anything.

Thanks & Regards
Arkajit Ghosh
Mailto: arkajit.ghosh at tcs.com<mailto:arkajit.ghosh at tcs.com>
Website: http://www.tcs.com
____________________________________________
Experience certainty. IT Services
Business Solutions
Consulting
____________________________________________

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain
confidential or privileged information. If you are
not the intended recipient, any dissemination, use,
review, distribution, printing or copying of the
information contained in this e-mail message
and/or attachments to it are strictly prohibited. If
you have received this communication in error,
please notify us by reply e-mail or telephone and
immediately and permanently delete the message
and any attachments. Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/f5bfc50a/attachment-0001.html>

From padmajs80 at gmail.com  Sun Feb  1 09:28:55 2015
From: padmajs80 at gmail.com (Padma Jayasankar)
Date: Sun, 1 Feb 2015 22:58:55 +0530
Subject: [ovs-discuss] BFD liveness update support
Message-ID: <CACveyyLq9C-fio=SmpzJcfif6_Kr9N7k=gKfghudzt0osnSCfA@mail.gmail.com>

Hi,
 I am using ovs 2.1.1. I am using Ubuntu 12.04. Now I have to use BFD to
detect failure and update the liveness of action buckets. I am able to
generate BFD traffic and the BFD ststus of interfaces are getting updated
to down and up according to link status(failure and recovery). But this
status is not updating the liveness of buckets. Does this version of OVS
doesn't support it? if not from which version is this support provided?
   If my linux kernel doesn't support that newer version of OVS, then is
there any work around to get BFD status update part?

Thanks and Regards,
Padma V
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150201/ac07cd15/attachment-0001.html>

From padmajs80 at gmail.com  Sun Feb  1 20:43:36 2015
From: padmajs80 at gmail.com (Padma Jayasankar)
Date: Mon, 2 Feb 2015 10:13:36 +0530
Subject: [ovs-discuss] In flow entries should 'action' be set to normal for
	BFD control packets
Message-ID: <CACveyy+9K4DH_2LUFRyGUpf4d_3_T3HQEYoSZYSm8ksEUC+y1Q@mail.gmail.com>

Hi,
  I have to use BFD for failure detection and when i went through some
examples the action field for the flow entries were set to 'Normal". Can't
we use 'output' action. In that case i have to add two entries (one for
each direction). Please claridy

Thanks and Regards,
Padma V
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/2492c18e/attachment-0001.html>

From tech.kals at gmail.com  Sun Feb  1 22:54:36 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Mon, 2 Feb 2015 12:24:36 +0530
Subject: [ovs-discuss] What is the difference between OVS 2.1.0 and 2.3.1
Message-ID: <CAHWErLeepeG4iUAnQLfqkbV0ivoLbwVT53vV8sDtFpyjwMmg3A@mail.gmail.com>

Hello Experts,

#1) Could someone please tell me what is the difference between OVS 2.1.0
and 2.3.1? I was using earlier 2.1.0 and should i move to 2.3.1?

#2) will OVS 2.1.0 supports TTP? or should I move to 2.3.1 version to
support TTP?



Thanks,
__Kals__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/33f4195a/attachment-0001.html>

From hengly at gmail.com  Mon Feb  2 01:37:49 2015
From: hengly at gmail.com (hengly)
Date: Mon, 2 Feb 2015 17:37:49 +0800
Subject: [ovs-discuss] suse linux support
Message-ID: <CAGsn+CKHPbpfokKD1Tdk-dQyzMGRcKDJSm8n8qDFbvPSS027QA@mail.gmail.com>

Dears,

I install the latest openvswitch on Suse Linux following the steps in
INSTALL.md. The ovsdb-server and ovs-vswitchd start successfully and work
well. And ovs-vsctl can also create bridges. However, when I try to add a
port to the new bridge using "ovs-vsctl add-port ovs0 tap0", the system is
broken and reboot. Neither system log nor open-vswitch.log output any
useful infomation.

Do I miss anything? Does openvswitch supports suse linux?

My software versions are ovs-vsctl 2.3.90, and Suse Linux (SLES 12). \

Thanks.

-- 
刘玉恒
hengly
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/9dcd1aaf/attachment-0001.html>

From ruverma at gmail.com  Mon Feb  2 03:06:33 2015
From: ruverma at gmail.com (Ruchika Verma)
Date: Mon, 2 Feb 2015 16:36:33 +0530
Subject: [ovs-discuss] OVS-controller crashes when tried in SSL mode
Message-ID: <CACHK9BGX=Eq4Jo45LTOyj5wsJEUdPG05tL__Un_32jpb+GTj7w@mail.gmail.com>

hi,

I am running ovs-controller with SSL enabled option using command -

    sudo ovs-controller -v pssl:6633  -p /mininet/mininet/ctl-privkey.pem -c
/mininet/mininet/ctl-cert.pem -C /var/lib/openvswitch/pki/switchca/
cacert.pem

I have enabled BOOTSTRAP option at switch through -

ovs-vsctl -- --bootstrap set-ssl /mininet/mininet/sc-privkey.pem
/mininet/mininet/sc-cert.pem /etc/openvswitch/cacert.pem

the keys and certificates are generated as -

sudo ovs-pki req+sign ctl controller
sudo ovs-pki req+sign sc switch

Now when i create the OpenVSwitch in virtual environment (on mininet),
using command -

sudo mn --topo=linear,1 --controller=remote

I get following error and OVS-Controller crashes after sometime. On
mininet window however the topology is created successfully.

>>>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/6ff59146/attachment.html>

From ruverma at gmail.com  Mon Feb  2 03:12:59 2015
From: ruverma at gmail.com (Ruchika Verma)
Date: Mon, 2 Feb 2015 16:42:59 +0530
Subject: [ovs-discuss] Fwd: OVS-controller crashes when tried in SSL mode
In-Reply-To: <CACHK9BGX=Eq4Jo45LTOyj5wsJEUdPG05tL__Un_32jpb+GTj7w@mail.gmail.com>
References: <CACHK9BGX=Eq4Jo45LTOyj5wsJEUdPG05tL__Un_32jpb+GTj7w@mail.gmail.com>
Message-ID: <CACHK9BHEAgE55mkWJOXum92B0GA0u6Ua4CH=jR_OR8Vo_onDOA@mail.gmail.com>

hi,

I am running ovs-controller with SSL enabled option using command -

    sudo ovs-controller -v pssl:6633  -p /mininet/mininet/ctl-privkey.pem
-c /mininet/mininet/ctl-cert.pem -C
/var/lib/openvswitch/pki/switchca/cacert.pem

I have enabled BOOTSTRAP option at switch through -

ovs-vsctl -- --bootstrap set-ssl /mininet/mininet/sc-privkey.pem
/mininet/mininet/sc-cert.pem /etc/openvswitch/cacert.pem

the keys and certificates are generated as -

sudo ovs-pki req+sign ctl controller
sudo ovs-pki req+sign sc switch

Now when i create the OpenVSwitch in virtual environment (on mininet),
using command -

sudo mn --topo=linear,1 --controller=remote

I get following error and OVS-Controller crashes after sometime. On mininet
window however the topology is created successfully.

>>>>>

...vconn|DBG|SSL:127.0.0.1:58708:entering ACTIVE

...vconn|DBG|SSL:127.0.0.1:58708:sent (SUCCESS):OFPT_HELLO(xid=0x1):

...poll_cmd|DBG|wakeup due to [POLLIN] in f8(127.0.0.1:6633 <-->
127.0.0.1:58708) at ../lib/stream-ssl.c:726

...stream-ssl|WARN|ssl-accept:unexpected SSL connection close

...vconn_stream|ERR|send:Protocol Error

..........................

above error prints are seen for many times before the controller crash.

Can you please help?

What am i doing wrong? is there any configuration parameter apart from -
1. changing the connection to SSL in /mininet/node.py
2. flags to support SSL in /openflow/configure​

​Thanks
Ruchika​
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/f2417b3b/attachment.html>

From pshelar at nicira.com  Mon Feb  2 10:55:25 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Mon, 2 Feb 2015 10:55:25 -0800
Subject: [ovs-discuss] Open vSwitch STT support
Message-ID: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>

STT patches were posted on netdev mailing list, But it was rejected.
As policy datapath patches must be accepted first in upstream kernel
before ported to OVS repo. But considering STT is well known protocol,
it is used in production and it can be useful for community, we can
make exception for STT and maintain it in OVS repo.
If anyone has objection to merging STT support let us know.

Thanks,
Pravin.

From djhon9813 at gmail.com  Mon Feb  2 11:12:09 2015
From: djhon9813 at gmail.com (david jhon)
Date: Tue, 3 Feb 2015 00:12:09 +0500
Subject: [ovs-discuss] debugging openvswitch command-line clients
In-Reply-To: <20150201215439.GC24647@nicira.com>
References: <CANPUzQ0hmMBdRLt5rg7GOV7mQf_WM3jxTR5_k_SZ-V4TYcYFxg@mail.gmail.com>
 <20150201215439.GC24647@nicira.com>
Message-ID: <CANPUzQ0qwW65PVUvwKQxvyZLtBwqd--dWh7fSx4XJK82uT+6jA@mail.gmail.com>

Hi Ben,

Thanks for your response.

It means that after setting up a break point at cmd_show() method and
attaching gdb to ovsdb-server pid (i.e., gdb ovs-vsctl.o
--pid=ovsdb-serverpid), I am not able to debug this specific file as single
stepping results in the following output:
     (gdb) n
     Single stepping until exit from function __kernel_vsyscall,
     which has no line number information.
     Warning:
     Cannot insert breakpoint 1.
     Cannot access memory at address 0x9353

please guide me what I am doing wrong. how gdb can be used to debug
openvswitch. Thank you!

Kind Regards,

On Mon, Feb 2, 2015 at 2:54 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Sat, Jan 31, 2015 at 05:28:23PM +0500, david jhon wrote:
> > Now I want to debug openvswitch command-line clients such as vsctl,
> ofctl,
> > appctl etc. I have started with debugging command "ovs-vsctl show" after
> I
> > set a breakpoint in openvswitch-2.3.0/utilities/ovs-vsctl.c using gdb but
> > it is not working for me. Please let me know how do I precede further in
> > this regard. Any help is highly appreciated.
>
> What does it mean that "it is not working"?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/7d6e2593/attachment.html>

From linville at tuxdriver.com  Mon Feb  2 11:20:17 2015
From: linville at tuxdriver.com (John W. Linville)
Date: Mon, 2 Feb 2015 14:20:17 -0500
Subject: [ovs-discuss] Open vSwitch STT support
In-Reply-To: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
Message-ID: <20150202192016.GA13141@tuxdriver.com>

On Mon, Feb 02, 2015 at 10:55:25AM -0800, Pravin Shelar wrote:
> STT patches were posted on netdev mailing list, But it was rejected.
> As policy datapath patches must be accepted first in upstream kernel
> before ported to OVS repo. But considering STT is well known protocol,
> it is used in production and it can be useful for community, we can
> make exception for STT and maintain it in OVS repo.
> If anyone has objection to merging STT support let us know.

What is preventing the upstream merge?

-- 
John W. Linville		Someday the world will need a hero, and you
linville at tuxdriver.com			might be all we have.  Be ready.

From a.n.chippa at gmail.com  Mon Feb  2 12:21:56 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Mon, 2 Feb 2015 12:21:56 -0800
Subject: [ovs-discuss] patch
In-Reply-To: <CABFtFwkW1r1oXTbECBQhi17XRVSD9uv4WcLH7gAznMmzH1LeOQ@mail.gmail.com>
References: <CABFtFwkOMG0kFdR8-Uj2QeUAb4wSf7pnj=SagX2TjgyeVxnR-Q@mail.gmail.com>
 <B13165A8-668F-462B-8E16-513208C5257A@nicira.com>
 <CABFtFwk9MzweqvEGccv0mb_HV6+AF63DkgPYCC3aML6TvsiwoA@mail.gmail.com>
 <CABFtFwm0eDWF84+B0j6iBMO=g_m9HJ04p05dwXK9tJk=fCVTeA@mail.gmail.com>
 <20150201215521.GD24647@nicira.com>
 <CABFtFw=1+p+zSfNE7n_N6G0hV7i4uca4tb3Ocmgi7tPXuncYQA@mail.gmail.com>
 <CABFtFwkW1r1oXTbECBQhi17XRVSD9uv4WcLH7gAznMmzH1LeOQ@mail.gmail.com>
Message-ID: <CABFtFw=ZmLkcO-2Sp8sy9b0pxd4vUvNWdW_6qPiV91K1m2CFpw@mail.gmail.com>

Still waiting :) I cannot find the context (around the change) I saw in
ofproto.c.rej in 2.3.0 ofproto.c. That's the reason for asking you for the
patch (based on 2.3.0). I do not need the entire patch, just the small hunk
that failed (in ofproto.c.rej I sent earlier). The faster I get it, the
faster I can test it :)

Thanks

On Sun, Feb 1, 2015 at 11:05 PM, Ashok Chippa <a.n.chippa at gmail.com> wrote:

> Can one of you please apply these diffs to 2.3.0 and provide me with a
> patch. I am not able to readily figure out where (and how) in ofproto.c
> this needs to be applied: It will take me more time to figure this out, as
> I am not the original author of this code...
>
> Appreciate your help. I will then patch it and test it. Thanks.
>
> Here's ofproto.c.rej:
>
>
>
> On Sun, Feb 1, 2015 at 3:07 PM, Ashok Chippa <a.n.chippa at gmail.com> wrote:
>
>> Thanks, I figure so... Will do and let you know if it worked...
>>
>> On Sun, Feb 1, 2015 at 1:55 PM, Ben Pfaff <blp at nicira.com> wrote:
>>
>>> On Fri, Jan 30, 2015 at 05:13:42PM -0800, Ashok Chippa wrote:
>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl del-flows br-int
>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl dump-tables br-int
>>> > OFPST_TABLE reply (xid=0x2): 254 tables
>>> >   0: classifier: wild=0x3fffff, max=1000000, active=10
>>> >                lookup=0, matched=0
>>> >   1: table1  : wild=0x3fffff, max=1000000, active=0
>>>
>>> If you apply the patch, then it will show active=0.
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/3d3710a0/attachment.html>

From pshelar at nicira.com  Mon Feb  2 13:34:07 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Mon, 2 Feb 2015 13:34:07 -0800
Subject: [ovs-discuss] Open vSwitch STT support
In-Reply-To: <20150202192016.GA13141@tuxdriver.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
Message-ID: <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>

On Mon, Feb 2, 2015 at 11:20 AM, John W. Linville
<linville at tuxdriver.com> wrote:
> On Mon, Feb 02, 2015 at 10:55:25AM -0800, Pravin Shelar wrote:
>> STT patches were posted on netdev mailing list, But it was rejected.
>> As policy datapath patches must be accepted first in upstream kernel
>> before ported to OVS repo. But considering STT is well known protocol,
>> it is used in production and it can be useful for community, we can
>> make exception for STT and maintain it in OVS repo.
>> If anyone has objection to merging STT support let us know.
>
> What is preventing the upstream merge?
>

Here is link to netdev patch, you can have a look at the discussion.

http://marc.info/?l=linux-netdev&m=142257416618642&w=2

> --
> John W. Linville                Someday the world will need a hero, and you
> linville at tuxdriver.com                  might be all we have.  Be ready.

From p.gautier.philippe at gmail.com  Mon Feb  2 15:08:30 2015
From: p.gautier.philippe at gmail.com (Philippe Gautier)
Date: Tue, 3 Feb 2015 00:08:30 +0100
Subject: [ovs-discuss] packet loss in RSPAN trafic
In-Reply-To: <20150201214623.GA24647@nicira.com>
References: <CAONKcZKTWAcDUXAbzneCJuYt8wmgiD6RAS4K8sOWMQrdsw4E8w@mail.gmail.com>
 <20150201214623.GA24647@nicira.com>
Message-ID: <CAONKcZKt5C1YkXE12NHZCVgJp7K=v1_7Z9=KQRvMAk27qha+NQ@mail.gmail.com>

 ip neigh show
192.168.42.151 dev br0 lladdr c0:3f:d5:60:3c:67 PERMANENT
192.168.42.2 dev br0 lladdr 7c:03:d8:81:2a:94 PERMANENT

Same observations with static arp entries. I tried to export traffic to
different ip address. I do not think it is related to arp table because my
gateway is 192.168.42.2. If gre traffic was dropped because of arp latency
real should have also be dropped ...



2015-02-01 22:46 GMT+01:00 Ben Pfaff <blp at nicira.com>:

> On Sat, Jan 31, 2015 at 03:41:13PM +0100, Philippe Gautier wrote:
> > I detect packet loss when I analyse GRE traffic sended by RSPAN. Is
> there a
> > default sampling parameter when configuring port mirroring ?
>
> No, mirroring should copy all packets.
>
> > Test platform and scenario:
> >
> > Two KVM virtual hosts (port internet2, internet3) hosted on a physical
> host
> > (port br0 and eth0). Trafic is sended through the gre interface to a
> remote
> > host. The gre trafic is sended through eth0 physical interface.
> >
> > When I generate a trafic between a vm and an internet host (In my case
> > google server) I capture real and RSPAN trafic on eth0 interface.
>
> It looks like the first packet is getting mirrored but a number of
> packets after that are getting dropped, and that then after some time
> the mirroring picks up again.  I wonder whether this is caused by ARP.
> I believe that one valid way to do ARP is to queue the first packet to a
> destination while waiting for an ARP response but drop later packets to
> that destination until the ARP response arrives.  That would explain
> this behavior.  So: does it help to add a static ARP entry for your
> tunnel destination?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/7a58e78a/attachment.html>

From p.gautier.philippe at gmail.com  Mon Feb  2 15:51:00 2015
From: p.gautier.philippe at gmail.com (Philippe Gautier)
Date: Tue, 3 Feb 2015 00:51:00 +0100
Subject: [ovs-discuss] packet loss in RSPAN trafic
In-Reply-To: <CAONKcZKt5C1YkXE12NHZCVgJp7K=v1_7Z9=KQRvMAk27qha+NQ@mail.gmail.com>
References: <CAONKcZKTWAcDUXAbzneCJuYt8wmgiD6RAS4K8sOWMQrdsw4E8w@mail.gmail.com>
 <20150201214623.GA24647@nicira.com>
 <CAONKcZKt5C1YkXE12NHZCVgJp7K=v1_7Z9=KQRvMAk27qha+NQ@mail.gmail.com>
Message-ID: <CAONKcZ+MRHXbMn7nMPSfNthqUd1o3pU-DfubSvcD9ybvdLAQQQ@mail.gmail.com>

It seems to be a MTU issue. Only tcp segments which lenght equal to 1484
are dropped (gre packet are 1484 + 38 = 1522)

I tried to increase MTU with no success.

ip link set eth0 mtu 1535

ip l show eth0
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1535 qdisc pfifo_fast master
ovs-system state UP mode DEFAULT group default qlen 1000
    link/ether 54:04:a6:76:0b:cf brd ff:ff:ff:ff:ff:ff

What is the correct procedure to set up MTU ?

2015-02-03 0:08 GMT+01:00 Philippe Gautier <p.gautier.philippe at gmail.com>:

>  ip neigh show
> 192.168.42.151 dev br0 lladdr c0:3f:d5:60:3c:67 PERMANENT
> 192.168.42.2 dev br0 lladdr 7c:03:d8:81:2a:94 PERMANENT
>
> Same observations with static arp entries. I tried to export traffic to
> different ip address. I do not think it is related to arp table because my
> gateway is 192.168.42.2. If gre traffic was dropped because of arp latency
> real should have also be dropped ...
>
>
>
> 2015-02-01 22:46 GMT+01:00 Ben Pfaff <blp at nicira.com>:
>
>> On Sat, Jan 31, 2015 at 03:41:13PM +0100, Philippe Gautier wrote:
>> > I detect packet loss when I analyse GRE traffic sended by RSPAN. Is
>> there a
>> > default sampling parameter when configuring port mirroring ?
>>
>> No, mirroring should copy all packets.
>>
>> > Test platform and scenario:
>> >
>> > Two KVM virtual hosts (port internet2, internet3) hosted on a physical
>> host
>> > (port br0 and eth0). Trafic is sended through the gre interface to a
>> remote
>> > host. The gre trafic is sended through eth0 physical interface.
>> >
>> > When I generate a trafic between a vm and an internet host (In my case
>> > google server) I capture real and RSPAN trafic on eth0 interface.
>>
>> It looks like the first packet is getting mirrored but a number of
>> packets after that are getting dropped, and that then after some time
>> the mirroring picks up again.  I wonder whether this is caused by ARP.
>> I believe that one valid way to do ARP is to queue the first packet to a
>> destination while waiting for an ARP response but drop later packets to
>> that destination until the ARP response arrives.  That would explain
>> this behavior.  So: does it help to add a static ARP entry for your
>> tunnel destination?
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/9195a442/attachment-0001.html>

From a.n.chippa at gmail.com  Mon Feb  2 19:41:25 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Mon, 2 Feb 2015 19:41:25 -0800
Subject: [ovs-discuss] patch
In-Reply-To: <CABFtFw=ZmLkcO-2Sp8sy9b0pxd4vUvNWdW_6qPiV91K1m2CFpw@mail.gmail.com>
References: <CABFtFwkOMG0kFdR8-Uj2QeUAb4wSf7pnj=SagX2TjgyeVxnR-Q@mail.gmail.com>
 <B13165A8-668F-462B-8E16-513208C5257A@nicira.com>
 <CABFtFwk9MzweqvEGccv0mb_HV6+AF63DkgPYCC3aML6TvsiwoA@mail.gmail.com>
 <CABFtFwm0eDWF84+B0j6iBMO=g_m9HJ04p05dwXK9tJk=fCVTeA@mail.gmail.com>
 <20150201215521.GD24647@nicira.com>
 <CABFtFw=1+p+zSfNE7n_N6G0hV7i4uca4tb3Ocmgi7tPXuncYQA@mail.gmail.com>
 <CABFtFwkW1r1oXTbECBQhi17XRVSD9uv4WcLH7gAznMmzH1LeOQ@mail.gmail.com>
 <CABFtFw=ZmLkcO-2Sp8sy9b0pxd4vUvNWdW_6qPiV91K1m2CFpw@mail.gmail.com>
Message-ID: <CABFtFw=sg-y0ry_E2KibzgUOD7uHKFtQZPq=8uhmA1hV_FrQZw@mail.gmail.com>

Hi Ben,

Hoping you will provide me with a patch that will work... Here's the
ofproto.c.rej:

--- ofproto/ofproto.c
+++ ofproto/ofproto.c
@@ -1,5 +1,5 @@
 /*
- * Copyright (c) 2009, 2010, 2011, 2012, 2013, 2014, 2015 Nicira, Inc.
+ * Copyright (c) 2009-2015 Nicira, Inc.
  * Copyright (c) 2010 Jean Tourrilhes - HP-Labs.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
@@ -2963,6 +2963,10 @@

             s->table_id = i;
             s->active_count = classifier_count(cls);
<<<<==== cannot find this in my branch (2.3.0)
+            if (i == 0) {
+                s->active_count -= connmgr_count_hidden_rules(
+                    ofproto->connmgr);
+            }
         }
     } else {
         stats = NULL;

s->active_count = classifier_count(cls); <<<<<===== cannot find this
anywhere in my 2.3.0 branch. Please either provide a patch with more
context (so I know where to patch this change) or provide a patch based on
2.3.0 that will work... I am blocked on this....

Thanks

On Mon, Feb 2, 2015 at 12:21 PM, Ashok Chippa <a.n.chippa at gmail.com> wrote:

> Still waiting :) I cannot find the context (around the change) I saw in
> ofproto.c.rej in 2.3.0 ofproto.c. That's the reason for asking you for the
> patch (based on 2.3.0). I do not need the entire patch, just the small hunk
> that failed (in ofproto.c.rej I sent earlier). The faster I get it, the
> faster I can test it :)
>
> Thanks
>
> On Sun, Feb 1, 2015 at 11:05 PM, Ashok Chippa <a.n.chippa at gmail.com>
> wrote:
>
>> Can one of you please apply these diffs to 2.3.0 and provide me with a
>> patch. I am not able to readily figure out where (and how) in ofproto.c
>> this needs to be applied: It will take me more time to figure this out, as
>> I am not the original author of this code...
>>
>> Appreciate your help. I will then patch it and test it. Thanks.
>>
>> Here's ofproto.c.rej:
>>
>>
>>
>> On Sun, Feb 1, 2015 at 3:07 PM, Ashok Chippa <a.n.chippa at gmail.com>
>> wrote:
>>
>>> Thanks, I figure so... Will do and let you know if it worked...
>>>
>>> On Sun, Feb 1, 2015 at 1:55 PM, Ben Pfaff <blp at nicira.com> wrote:
>>>
>>>> On Fri, Jan 30, 2015 at 05:13:42PM -0800, Ashok Chippa wrote:
>>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl del-flows br-int
>>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl dump-tables br-int
>>>> > OFPST_TABLE reply (xid=0x2): 254 tables
>>>> >   0: classifier: wild=0x3fffff, max=1000000, active=10
>>>> >                lookup=0, matched=0
>>>> >   1: table1  : wild=0x3fffff, max=1000000, active=0
>>>>
>>>> If you apply the patch, then it will show active=0.
>>>>
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/469371aa/attachment.html>

From pg201372016 at iitj.ac.in  Mon Feb  2 21:57:17 2015
From: pg201372016 at iitj.ac.in (Sumit Paliwal)
Date: Tue, 3 Feb 2015 11:27:17 +0530
Subject: [ovs-discuss] Queue Size and packets in queue
Message-ID: <CAEhKQHKt2GVZmfPfbQExgmARtNBy6X56m7L-T1Pe==U6cMXArQ@mail.gmail.com>

Hello Everyone,

I'm new to the openvswitch. I've created queues with the ports. and I'm
trying to get the number of packets currently available in queue.
ovs-ofctl queue-stats command gives the number of packets in queue.
Now my doubt is that, is it the total number of packets ever entered in the
queue!! because my queue size was 1000 but queue-stats is showing so many
number of packets.
And it will be really helpful if anyone could tell me, where exactly in the
Openvswitch source code the enqueue and flow table matching operation is
taking place.


Thanks & Regards,
-- 
Sumit Paliwal
M.Tech. ICT,
IIT Jodhpur


*"Have a great Day... "*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/d7b16ee8/attachment.html>

From a.n.chippa at gmail.com  Mon Feb  2 23:19:05 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Mon, 2 Feb 2015 23:19:05 -0800
Subject: [ovs-discuss] patch
In-Reply-To: <CABFtFw=sg-y0ry_E2KibzgUOD7uHKFtQZPq=8uhmA1hV_FrQZw@mail.gmail.com>
References: <CABFtFwkOMG0kFdR8-Uj2QeUAb4wSf7pnj=SagX2TjgyeVxnR-Q@mail.gmail.com>
 <B13165A8-668F-462B-8E16-513208C5257A@nicira.com>
 <CABFtFwk9MzweqvEGccv0mb_HV6+AF63DkgPYCC3aML6TvsiwoA@mail.gmail.com>
 <CABFtFwm0eDWF84+B0j6iBMO=g_m9HJ04p05dwXK9tJk=fCVTeA@mail.gmail.com>
 <20150201215521.GD24647@nicira.com>
 <CABFtFw=1+p+zSfNE7n_N6G0hV7i4uca4tb3Ocmgi7tPXuncYQA@mail.gmail.com>
 <CABFtFwkW1r1oXTbECBQhi17XRVSD9uv4WcLH7gAznMmzH1LeOQ@mail.gmail.com>
 <CABFtFw=ZmLkcO-2Sp8sy9b0pxd4vUvNWdW_6qPiV91K1m2CFpw@mail.gmail.com>
 <CABFtFw=sg-y0ry_E2KibzgUOD7uHKFtQZPq=8uhmA1hV_FrQZw@mail.gmail.com>
Message-ID: <CABFtFwkH0aTL8+OtbdxmPKoY5B9unFh8AChDup3VKoyyZPY_fQ@mail.gmail.com>

Can someone please help?... I AM BLOCKED ON THIS... One hunk has failed and
I shared that with you. The code base I have (2.3.0) seems to have changed
significantly where I cannot find a place to add these 4 lines:

+            if (i == 0) {
+                s->active_count -= connmgr_count_hidden_rules(
+                    ofproto->connmgr);
+            }

This is your code I assume, and it should not take you any time to provide
a patch that works... I am underwhelmed by your responses... This is not my
code base and I do not have the luxury to go deep into ofproto.c and track
all your changes and how the code morphed and then figure out where (and
how) to add the above 4 lines....

The only place in 2.3.0 that references s->active_count is in
handle_table_stats_request() function...:

handle_table_stats_request(...)
{
    ots[i].active_count = htonl(classifier_count(&p->tables[i].cls));
...
}

I am sure this is where it goes...

p.s.: It does not seem like you guys are interested in fixing your bugs...
I have volunteered to test it. Yet, I am not getting any help. If you think
it is that easy to fix somone else's code, would you like to try patching
newer version of my code with an older version of my patch? Let's see how
easy it is for you guys to find and resolve it...




On Mon, Feb 2, 2015 at 7:41 PM, Ashok Chippa <a.n.chippa at gmail.com> wrote:

> Hi Ben,
>
> Hoping you will provide me with a patch that will work... Here's the
> ofproto.c.rej:
>
> --- ofproto/ofproto.c
> +++ ofproto/ofproto.c
> @@ -1,5 +1,5 @@
>  /*
> - * Copyright (c) 2009, 2010, 2011, 2012, 2013, 2014, 2015 Nicira, Inc.
> + * Copyright (c) 2009-2015 Nicira, Inc.
>   * Copyright (c) 2010 Jean Tourrilhes - HP-Labs.
>   *
>   * Licensed under the Apache License, Version 2.0 (the "License");
> @@ -2963,6 +2963,10 @@
>
>              s->table_id = i;
>              s->active_count = classifier_count(cls);
> <<<<==== cannot find this in my branch (2.3.0)
> +            if (i == 0) {
> +                s->active_count -= connmgr_count_hidden_rules(
> +                    ofproto->connmgr);
> +            }
>          }
>      } else {
>          stats = NULL;
>
> s->active_count = classifier_count(cls); <<<<<===== cannot find this
> anywhere in my 2.3.0 branch. Please either provide a patch with more
> context (so I know where to patch this change) or provide a patch based on
> 2.3.0 that will work... I am blocked on this....
>
> Thanks
>
> On Mon, Feb 2, 2015 at 12:21 PM, Ashok Chippa <a.n.chippa at gmail.com>
> wrote:
>
>> Still waiting :) I cannot find the context (around the change) I saw in
>> ofproto.c.rej in 2.3.0 ofproto.c. That's the reason for asking you for the
>> patch (based on 2.3.0). I do not need the entire patch, just the small hunk
>> that failed (in ofproto.c.rej I sent earlier). The faster I get it, the
>> faster I can test it :)
>>
>> Thanks
>>
>> On Sun, Feb 1, 2015 at 11:05 PM, Ashok Chippa <a.n.chippa at gmail.com>
>> wrote:
>>
>>> Can one of you please apply these diffs to 2.3.0 and provide me with a
>>> patch. I am not able to readily figure out where (and how) in ofproto.c
>>> this needs to be applied: It will take me more time to figure this out, as
>>> I am not the original author of this code...
>>>
>>> Appreciate your help. I will then patch it and test it. Thanks.
>>>
>>> Here's ofproto.c.rej:
>>>
>>>
>>>
>>> On Sun, Feb 1, 2015 at 3:07 PM, Ashok Chippa <a.n.chippa at gmail.com>
>>> wrote:
>>>
>>>> Thanks, I figure so... Will do and let you know if it worked...
>>>>
>>>> On Sun, Feb 1, 2015 at 1:55 PM, Ben Pfaff <blp at nicira.com> wrote:
>>>>
>>>>> On Fri, Jan 30, 2015 at 05:13:42PM -0800, Ashok Chippa wrote:
>>>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl del-flows br-int
>>>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl dump-tables br-int
>>>>> > OFPST_TABLE reply (xid=0x2): 254 tables
>>>>> >   0: classifier: wild=0x3fffff, max=1000000, active=10
>>>>> >                lookup=0, matched=0
>>>>> >   1: table1  : wild=0x3fffff, max=1000000, active=0
>>>>>
>>>>> If you apply the patch, then it will show active=0.
>>>>>
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/b927bfad/attachment-0001.html>

From a.n.chippa at gmail.com  Mon Feb  2 23:19:58 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Mon, 2 Feb 2015 23:19:58 -0800
Subject: [ovs-discuss] patch does not work
Message-ID: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>

Can someone please help?... I AM BLOCKED ON THIS... One hunk has failed and
I shared that with you. The code base I have (2.3.0) seems to have changed
significantly where I cannot find a place to add these 4 lines:

+            if (i == 0) {
+                s->active_count -= connmgr_count_hidden_rules(
+                    ofproto->connmgr);
+            }

This is your code I assume, and it should not take you any time to provide
a patch that works... I am underwhelmed by your responses... This is not my
code base and I do not have the luxury to go deep into ofproto.c and track
all your changes and how the code morphed and then figure out where (and
how) to add the above 4 lines....

The only place in 2.3.0 that references s->active_count is in
handle_table_stats_request() function...:

handle_table_stats_request(...)
{
    ots[i].active_count = htonl(classifier_count(&p->tables[i].cls));
...
}

I am sure this is where it goes...

p.s.: It does not seem like you guys are interested in fixing your bugs...
I have volunteered to test it. Yet, I am not getting any help. If you think
it is that easy to fix somone else's code, would you like to try patching
newer version of my code with an older version of my patch? Let's see how
easy it is for you guys to find and resolve it...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/761b2198/attachment.html>

From a.n.chippa at gmail.com  Mon Feb  2 23:47:40 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Mon, 2 Feb 2015 23:47:40 -0800
Subject: [ovs-discuss] patch does not work
In-Reply-To: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
References: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
Message-ID: <CABFtFwmjWPKx62FQBEKsBOMwwt1GnSb_rf6eBdDa1ckrR60FZA@mail.gmail.com>

Here is the patch I was expecting from the authors of ofproto.c: I made the
changes and here's my patch:

--- ofproto.c.orig    2015-01-31 00:53:58.961069421 -0800
+++ ofproto.c    2015-02-02 23:36:32.176345873 -0800
@@ -1,5 +1,5 @@
 /*
- * Copyright (c) 2009, 2010, 2011, 2012, 2013, 2014 Nicira, Inc.
+ * Copyright (c) 2009-2015 Nicira, Inc.
  * Copyright (c) 2010 Jean Tourrilhes - HP-Labs.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
@@ -3087,6 +3087,9 @@
         ots[i].max_entries = htonl(1000000); /* An arbitrary big number. */
         fat_rwlock_rdlock(&p->tables[i].cls.rwlock);
         ots[i].active_count = htonl(classifier_count(&p->tables[i].cls));
+        if (i == 0) {
+            ots[i].active_count -= connmgr_count_hidden_rules(p->connmgr);
+        }
         fat_rwlock_unlock(&p->tables[i].cls.rwlock);
     }


I guess it would be too much to ask for a code review?



On Mon, Feb 2, 2015 at 11:19 PM, Ashok Chippa <a.n.chippa at gmail.com> wrote:

> Can someone please help?... I AM BLOCKED ON THIS... One hunk has failed
> and I shared that with you. The code base I have (2.3.0) seems to have
> changed significantly where I cannot find a place to add these 4 lines:
>
> +            if (i == 0) {
> +                s->active_count -= connmgr_count_hidden_rules(
> +                    ofproto->connmgr);
> +            }
>
> This is your code I assume, and it should not take you any time to provide
> a patch that works... I am underwhelmed by your responses... This is not my
> code base and I do not have the luxury to go deep into ofproto.c and track
> all your changes and how the code morphed and then figure out where (and
> how) to add the above 4 lines....
>
> The only place in 2.3.0 that references s->active_count is in
> handle_table_stats_request() function...:
>
> handle_table_stats_request(...)
> {
>     ots[i].active_count = htonl(classifier_count(&p->tables[i].cls));
> ...
> }
>
> I am sure this is where it goes...
>
> p.s.: It does not seem like you guys are interested in fixing your bugs...
> I have volunteered to test it. Yet, I am not getting any help. If you think
> it is that easy to fix somone else's code, would you like to try patching
> newer version of my code with an older version of my patch? Let's see how
> easy it is for you guys to find and resolve it...
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150202/f02b4c4d/attachment.html>

From a.n.chippa at gmail.com  Tue Feb  3 00:06:43 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 00:06:43 -0800
Subject: [ovs-discuss] PATCH does not work
Message-ID: <CABFtFwmdreK_PrfqvqK5MB=-aOwZTkcswR0=D0GftFOJF__y3w@mail.gmail.com>

Compiled the patch in and re-installed the .ko:

STILL SEE THIS:

root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl del-flows br-int
root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows br-int
NXST_FLOW reply (xid=0x4):
root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-tables br-int
OFPST_TABLE reply (xid=0x2): 254 tables
  0: classifier: wild=0x3fffff, max=1000000, active=10   <<<<============
STILL!!!
               lookup=0, matched=0
  1: table1  : wild=0x3fffff, max=1000000, active=0
               lookup=0, matched=0
...

I JUST CAN'T GET RID OF the ACTIVE_COUNT of 10!!! in dump-tables output:

ANY SUGGESTIONS?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/6c29e8f7/attachment.html>

From E.Istomin at edss.ee  Tue Feb  3 00:38:19 2015
From: E.Istomin at edss.ee (Eugene Istomin)
Date: Tue, 03 Feb 2015 10:38:19 +0200
Subject: [ovs-discuss] suse linux support
In-Reply-To: <CAGsn+CKHPbpfokKD1Tdk-dQyzMGRcKDJSm8n8qDFbvPSS027QA@mail.gmail.com>
References: <CAGsn+CKHPbpfokKD1Tdk-dQyzMGRcKDJSm8n8qDFbvPSS027QA@mail.gmail.com>
Message-ID: <2108969.ePcGqQxWHX@evis>

Hello,

Yes, SLE12 & openSUSE fully supports OVS.
You can try openSUSE 2.3.90 OVS package from our repo -
https://build.opensuse.org/package/show/home:conecenter:suse_rev4/ope
nvswitch[1] 


/---/
*/Best regards,/*
/Eugene Istomin/



Dears, 



I install the latest openvswitch on Suse Linux following the steps in 
INSTALL.md. The ovsdb-server and ovs-vswitchd start successfully and work 
well. And ovs-vsctl can also create bridges. However, when I try to add a 
port to the new bridge using "ovs-vsctl add-port ovs0 tap0", the system is 
broken and reboot. Neither system log nor open-vswitch.log output any 
useful infomation.



Do I miss anything? Does openvswitch supports suse linux?



My software versions are ovs-vsctl 2.3.90, and Suse Linux (SLES 12). \



Thanks.




刘玉恒hengly


--------
[1] 
https://build.opensuse.org/package/show/home:conecenter:suse_rev4/ope
nvswitch
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/31a5ea67/attachment-0001.html>

From E.Istomin at edss.ee  Tue Feb  3 00:38:19 2015
From: E.Istomin at edss.ee (Eugene Istomin)
Date: Tue, 03 Feb 2015 10:38:19 +0200
Subject: [ovs-discuss] suse linux support
In-Reply-To: <CAGsn+CKHPbpfokKD1Tdk-dQyzMGRcKDJSm8n8qDFbvPSS027QA@mail.gmail.com>
References: <CAGsn+CKHPbpfokKD1Tdk-dQyzMGRcKDJSm8n8qDFbvPSS027QA@mail.gmail.com>
Message-ID: <2108969.ePcGqQxWHX@evis>

Hello,

Yes, SLE12 & openSUSE fully supports OVS.
You can try openSUSE 2.3.90 OVS package from our repo -
https://build.opensuse.org/package/show/home:conecenter:suse_rev4/ope
nvswitch[1] 


/---/
*/Best regards,/*
/Eugene Istomin/



Dears, 



I install the latest openvswitch on Suse Linux following the steps in 
INSTALL.md. The ovsdb-server and ovs-vswitchd start successfully and work 
well. And ovs-vsctl can also create bridges. However, when I try to add a 
port to the new bridge using "ovs-vsctl add-port ovs0 tap0", the system is 
broken and reboot. Neither system log nor open-vswitch.log output any 
useful infomation.



Do I miss anything? Does openvswitch supports suse linux?



My software versions are ovs-vsctl 2.3.90, and Suse Linux (SLES 12). \



Thanks.




刘玉恒hengly


--------
[1] 
https://build.opensuse.org/package/show/home:conecenter:suse_rev4/ope
nvswitch
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/31a5ea67/attachment-0002.html>

From a.n.chippa at gmail.com  Tue Feb  3 01:02:12 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 01:02:12 -0800
Subject: [ovs-discuss] incorrect fix for active count (in dump-tables...)
Message-ID: <CABFtFwmqu80=2=8=DJYkiZ+v9Uszfj6yiReCn9VHNjKB_AkQ4A@mail.gmail.com>

NXST_FLOW reply (xid=0x4):
root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-tables br-int
OFPST_TABLE reply (xid=0x2): 254 tables
  0: classifier: wild=0x3fffff, max=1000000, active=4143972105   <<<<====
-ve
               lookup=30, matched=30
  1: table1  : wild=0x3fffff, max=1000000, active=0


I believe the fix to decrement the active_count is causing it to go -ve...
The fix does not seem right...

This happens after I re-install the .ko...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/f642cce9/attachment.html>

From lojakab at cisco.com  Tue Feb  3 01:11:41 2015
From: lojakab at cisco.com (Lori Jakab)
Date: Tue, 03 Feb 2015 11:11:41 +0200
Subject: [ovs-discuss] incorrect fix for active count (in dump-tables...)
In-Reply-To: <CABFtFwmqu80=2=8=DJYkiZ+v9Uszfj6yiReCn9VHNjKB_AkQ4A@mail.gmail.com>
References: <CABFtFwmqu80=2=8=DJYkiZ+v9Uszfj6yiReCn9VHNjKB_AkQ4A@mail.gmail.com>
Message-ID: <54D090CD.7010004@cisco.com>

Ashok,

Please try using the master branch from git, the patch was merged there.

-Lori

On 02/03/2015 11:02 AM, Ashok Chippa wrote:
> NXST_FLOW reply (xid=0x4):
> root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-tables br-int
> OFPST_TABLE reply (xid=0x2): 254 tables
>   0: classifier: wild=0x3fffff, max=1000000, active=4143972105  
> <<<<==== -ve
>                lookup=30, matched=30
>   1: table1  : wild=0x3fffff, max=1000000, active=0
> 
> 
> I believe the fix to decrement the active_count is causing it to go
> -ve... The fix does not seem right...
> 
> This happens after I re-install the .ko...
> 
> 
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> 

From a.n.chippa at gmail.com  Tue Feb  3 01:16:21 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 01:16:21 -0800
Subject: [ovs-discuss] incorrect fix for active count (in dump-tables...)
In-Reply-To: <54D090CD.7010004@cisco.com>
References: <CABFtFwmqu80=2=8=DJYkiZ+v9Uszfj6yiReCn9VHNjKB_AkQ4A@mail.gmail.com>
 <54D090CD.7010004@cisco.com>
Message-ID: <CABFtFw=nd7suWQv0mqBWt-m1JKN=3U=YMM=VrXToi=i61pKnwQ@mail.gmail.com>

Thank you Lori. Appreciate your suggestion.

On Tue, Feb 3, 2015 at 1:11 AM, Lori Jakab <lojakab at cisco.com> wrote:

> Ashok,
>
> Please try using the master branch from git, the patch was merged there.
>
> -Lori
>
> On 02/03/2015 11:02 AM, Ashok Chippa wrote:
> > NXST_FLOW reply (xid=0x4):
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-tables
> br-int
> > OFPST_TABLE reply (xid=0x2): 254 tables
> >   0: classifier: wild=0x3fffff, max=1000000, active=4143972105
> > <<<<==== -ve
> >                lookup=30, matched=30
> >   1: table1  : wild=0x3fffff, max=1000000, active=0
> >
> >
> > I believe the fix to decrement the active_count is causing it to go
> > -ve... The fix does not seem right...
> >
> > This happens after I re-install the .ko...
> >
> >
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/cfe94386/attachment.html>

From a.n.chippa at gmail.com  Tue Feb  3 01:20:48 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 01:20:48 -0800
Subject: [ovs-discuss] another bug?
Message-ID: <CABFtFwk723AKvcMuwQGmU4Tbofq-NfbiO9iEHxzzfqEgV6aU9Q@mail.gmail.com>

I added a flow to table0, but the flow is not shown correctly... Is this a
bug?

root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl del-flows br-int
root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows br-int
NXST_FLOW reply (xid=0x4):
root at ashok-vb:/home/achippa/openvswitch-2.3.0#
root at ashok-vb:/home/achippa/openvswitch-2.3.0#
root at ashok-vb:/home/achippa/openvswitch-2.3.0#
root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl add-flow br-int
table=0,priority=9999,nw_src=1.1.1.1,nw_dst=1.1.1.2,actions=DROP
2015-02-03T09:14:06Z|00001|ofp_util|INFO|normalization changed ofp_match,
details:
2015-02-03T09:14:06Z|00002|ofp_util|INFO| pre: nw_src=1.1.1.1,nw_dst=1.1.1.2
2015-02-03T09:14:06Z|00003|ofp_util|INFO|post:
root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows br-int
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=8.642s, table=0, n_packets=0, n_bytes=0, idle_age=8,
priority=9999 actions=drop

I ping 1.1.1.2 from 1.1.1.1 and the traffic passes through...!! What am I
missing?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/96cd2865/attachment-0001.html>

From blp at nicira.com  Tue Feb  3 08:37:15 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 08:37:15 -0800
Subject: [ovs-discuss] another bug?
In-Reply-To: <CABFtFwk723AKvcMuwQGmU4Tbofq-NfbiO9iEHxzzfqEgV6aU9Q@mail.gmail.com>
References: <CABFtFwk723AKvcMuwQGmU4Tbofq-NfbiO9iEHxzzfqEgV6aU9Q@mail.gmail.com>
Message-ID: <20150203163715.GA18144@nicira.com>

On Tue, Feb 03, 2015 at 01:20:48AM -0800, Ashok Chippa wrote:
> I added a flow to table0, but the flow is not shown correctly... Is this a
> bug?
> 
> root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl del-flows br-int
> root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows br-int
> NXST_FLOW reply (xid=0x4):
> root at ashok-vb:/home/achippa/openvswitch-2.3.0#
> root at ashok-vb:/home/achippa/openvswitch-2.3.0#
> root at ashok-vb:/home/achippa/openvswitch-2.3.0#
> root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl add-flow br-int
> table=0,priority=9999,nw_src=1.1.1.1,nw_dst=1.1.1.2,actions=DROP
> 2015-02-03T09:14:06Z|00001|ofp_util|INFO|normalization changed ofp_match,
> details:
> 2015-02-03T09:14:06Z|00002|ofp_util|INFO| pre: nw_src=1.1.1.1,nw_dst=1.1.1.2
> 2015-02-03T09:14:06Z|00003|ofp_util|INFO|post:
> root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows br-int
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=8.642s, table=0, n_packets=0, n_bytes=0, idle_age=8,
> priority=9999 actions=drop
> 
> I ping 1.1.1.2 from 1.1.1.1 and the traffic passes through...!! What am I
> missing?

Please read the FAQ.

### Q: I ran "ovs-ofctl add-flow br0 nw_dst=192.168.0.1,actions=drop"
   but I got a funny message like this:

       ofp_util|INFO|normalization changed ofp_match, details:
       ofp_util|INFO| pre: nw_dst=192.168.0.1
       ofp_util|INFO|post:

   and when I ran "ovs-ofctl dump-flows br0" I saw that my nw_dst
   match had disappeared, so that the flow ends up matching every
   packet.

A: The term "normalization" in the log message means that a flow
   cannot match on an L3 field without saying what L3 protocol is in
   use.  The "ovs-ofctl" command above didn't specify an L3 protocol,
   so the L3 field match was dropped.

   In this case, the L3 protocol could be IP or ARP.  A correct
   command for each possibility is, respectively:

       ovs-ofctl add-flow br0 ip,nw_dst=192.168.0.1,actions=drop

   and 

       ovs-ofctl add-flow br0 arp,nw_dst=192.168.0.1,actions=drop

   Similarly, a flow cannot match on an L4 field without saying what
   L4 protocol is in use.  For example, the flow match "tp_src=1234"
   is, by itself, meaningless and will be ignored.  Instead, to match
   TCP source port 1234, write "tcp,tp_src=1234", or to match UDP
   source port 1234, write "udp,tp_src=1234".

From blp at nicira.com  Tue Feb  3 08:38:01 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 08:38:01 -0800
Subject: [ovs-discuss] patch does not work
In-Reply-To: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
References: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
Message-ID: <20150203163801.GB18144@nicira.com>

On Mon, Feb 02, 2015 at 11:19:58PM -0800, Ashok Chippa wrote:
> Can someone please help?... I AM BLOCKED ON THIS... One hunk has failed and
> I shared that with you. The code base I have (2.3.0) seems to have changed
> significantly where I cannot find a place to add these 4 lines:

The patch I provided is not for 2.3.0, it is for master.

From blp at nicira.com  Tue Feb  3 08:38:27 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 08:38:27 -0800
Subject: [ovs-discuss] PATCH does not work
In-Reply-To: <CABFtFwmdreK_PrfqvqK5MB=-aOwZTkcswR0=D0GftFOJF__y3w@mail.gmail.com>
References: <CABFtFwmdreK_PrfqvqK5MB=-aOwZTkcswR0=D0GftFOJF__y3w@mail.gmail.com>
Message-ID: <20150203163827.GC18144@nicira.com>

On Tue, Feb 03, 2015 at 12:06:43AM -0800, Ashok Chippa wrote:
> Compiled the patch in and re-installed the .ko:
> 
> STILL SEE THIS:
> 
> root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl del-flows br-int
> root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows br-int
> NXST_FLOW reply (xid=0x4):
> root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-tables br-int
> OFPST_TABLE reply (xid=0x2): 254 tables
>   0: classifier: wild=0x3fffff, max=1000000, active=10   <<<<============
> STILL!!!
>                lookup=0, matched=0
>   1: table1  : wild=0x3fffff, max=1000000, active=0
>                lookup=0, matched=0
> ...
> 
> I JUST CAN'T GET RID OF the ACTIVE_COUNT of 10!!! in dump-tables output:

Why are you so fixated on this?

From blp at nicira.com  Tue Feb  3 08:39:30 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 08:39:30 -0800
Subject: [ovs-discuss] Queue Size and packets in queue
In-Reply-To: <CAEhKQHKt2GVZmfPfbQExgmARtNBy6X56m7L-T1Pe==U6cMXArQ@mail.gmail.com>
References: <CAEhKQHKt2GVZmfPfbQExgmARtNBy6X56m7L-T1Pe==U6cMXArQ@mail.gmail.com>
Message-ID: <20150203163930.GD18144@nicira.com>

On Tue, Feb 03, 2015 at 11:27:17AM +0530, Sumit Paliwal wrote:
> I'm new to the openvswitch. I've created queues with the ports. and I'm
> trying to get the number of packets currently available in queue.

OVS doesn't provide that information.

From blp at nicira.com  Tue Feb  3 08:45:37 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 08:45:37 -0800
Subject: [ovs-discuss] [ovs-dev]  Open vSwitch STT support
In-Reply-To: <CAJK4cL0uwieXdpC79CMZbPzHez0uH-cneyz+eODtoHNyTbkHWw@mail.gmail.com>
References: <CAJK4cL0uwieXdpC79CMZbPzHez0uH-cneyz+eODtoHNyTbkHWw@mail.gmail.com>
Message-ID: <20150203164537.GF18144@nicira.com>

On Tue, Feb 03, 2015 at 12:12:41PM +0800, John Xiao wrote:
> One question on STT IP, is it free to use STT in commercial products?
> I believe Nicira has patents on this.

Assuming that Nicira does, the patches are being offered by the patent
holder under GPLv2, see http://en.swpat.org/wiki/GPLv2_and_patents.

From blp at nicira.com  Tue Feb  3 08:51:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 08:51:44 -0800
Subject: [ovs-discuss] debugging openvswitch command-line clients
In-Reply-To: <CANPUzQ0qwW65PVUvwKQxvyZLtBwqd--dWh7fSx4XJK82uT+6jA@mail.gmail.com>
References: <CANPUzQ0hmMBdRLt5rg7GOV7mQf_WM3jxTR5_k_SZ-V4TYcYFxg@mail.gmail.com>
 <20150201215439.GC24647@nicira.com>
 <CANPUzQ0qwW65PVUvwKQxvyZLtBwqd--dWh7fSx4XJK82uT+6jA@mail.gmail.com>
Message-ID: <20150203165144.GH18144@nicira.com>

On Tue, Feb 03, 2015 at 12:12:09AM +0500, david jhon wrote:
> Hi Ben,
> 
> Thanks for your response.
> 
> It means that after setting up a break point at cmd_show() method and
> attaching gdb to ovsdb-server pid (i.e., gdb ovs-vsctl.o
> --pid=ovsdb-serverpid), I am not able to debug this specific file as single
> stepping results in the following output:
>      (gdb) n
>      Single stepping until exit from function __kernel_vsyscall,
>      which has no line number information.
>      Warning:
>      Cannot insert breakpoint 1.
>      Cannot access memory at address 0x9353
> 
> please guide me what I am doing wrong. how gdb can be used to debug
> openvswitch. Thank you!

That's not anything OVS-specific.  It means that you can't single-step
into a system call.  If you need more information, then please ask about
it on a GDB or Linux-kernel mailing list.

From gm2391 at att.com  Tue Feb  3 09:00:22 2015
From: gm2391 at att.com (MCGRATH, GIL)
Date: Tue, 3 Feb 2015 17:00:22 +0000
Subject: [ovs-discuss] Tunneling and vhost support for dpdk
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F730685622@IRSMSX104.ger.corp.intel.com>
References: <75F26445-256F-4335-B0FE-4E87F2A079D3@att.com>
 <20141122184218.GA12309@nicira.com>
 <6FF294DC-8EEB-4542-99D2-E1184463ED92@nicira.com>
 <1263C341-A91F-45F1-8AE2-CCAA0334DD36@att.com>
 <BC0FEEC7D7650749874CEC11314A88F730685622@IRSMSX104.ger.corp.intel.com>
Message-ID: <93A3A2A2-68B1-4DDC-88A0-5D9566451E2B@att.com>

A few questions:

Can I use the linux bonding driver and bind the dpdk port to bond0?
If not (which I suspect), can I do LACP bonding in OVS when using DPDK?

If I apply the dpdk vhost patches as described below should I build OVS 
with IVSHMEM?

— Gil



On 1/30/15, 6:57 PM, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:

>
>> -----Original Message-----
>> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of 
>>MCGRATH, GIL
>> Sent: Friday, January 30, 2015 3:53 PM
>> To: Justin Pettit; Ben Pfaff
>> Cc: discuss at openvswitch.org
>> Subject: Re: [ovs-discuss] Tunneling and vhost support for dpdk
>> 
>> Checking again on whether support for VhostNet is integrated in OVS DPDK
>> yet - if so I assume I can just use the version from trunk in github.
>
>It's not upstreamed into OVS yet. The model now will be slightly 
>different as a 
>vhost library now exists in DPDK 1.8. If you want to try it out have a 
>look at 
>this post
>http://www.openvswitch.org/pipermail/dev/2015-January/050278.html
>
>> 
>> 
>> 
>> On 11/22/14, 6:55 PM, "Justin Pettit" <jpettit at nicira.com> wrote:
>> 
>> >
>> >> On Nov 22, 2014, at 10:42 AM, Ben Pfaff <blp at nicira.com> wrote:
>> >>
>> >> On Sat, Nov 22, 2014 at 03:00:48PM +0000, MCGRATH, GIL wrote:
>> >>> Has tunneling support and vhost support for dpdk been integrated 
>>yet?
>> >>> I assume the tunneling includes vxlan?
>> >>
>> >> Yes, see README-native-tunneling.md.
>> >
>> >Just to be clear, though, I don't believe vhost support is integrated
>> >yet.  We spoke with Intel at the OVS Conference this week, and they're 
>>in
>> >the process of re-spinning the patches based on feedback they received.
>> >
>> >--Justin
>> >
>> >
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss

From kevin.traynor at intel.com  Tue Feb  3 09:02:22 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 3 Feb 2015 17:02:22 +0000
Subject: [ovs-discuss] Packet drops during non-exhaustive flood with OVS
	and 1.8.0
In-Reply-To: <CABYiri_q4QqWrhTQL-UZ1wf3FLz-wj9SbtBJrDntz2Bw4cEPoQ@mail.gmail.com>
References: <CABYiri-qn_HGYeRSxH+z0+LGi0se9NEOk0q9hzFg4R+wg05ABw@mail.gmail.com>
 <CABYiri9WwQMn1u7TbJNEGCs804f_hvP2cKxet2sGMbrx1rJUyw@mail.gmail.com>
 <CABYiri_q4QqWrhTQL-UZ1wf3FLz-wj9SbtBJrDntz2Bw4cEPoQ@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F730688B53@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: Andrey Korolyov [mailto:andrey at xdel.ru]
> Sent: Monday, February 2, 2015 10:53 AM
> To: dev at dpdk.org
> Cc: discuss at openvswitch.org; Traynor, Kevin
> Subject: Re: Packet drops during non-exhaustive flood with OVS and 1.8.0
> 
> On Thu, Jan 22, 2015 at 8:11 PM, Andrey Korolyov <andrey at xdel.ru> wrote:
> > On Wed, Jan 21, 2015 at 8:02 PM, Andrey Korolyov <andrey at xdel.ru> wrote:
> >> Hello,
> >>
> >> I observed that the latest OVS with dpdk-1.8.0 and igb_uio starts to
> >> drop packets earlier than a regular Linux ixgbe 10G interface, setup
> >> follows:
> >>
> >> receiver/forwarder:
> >> - 8 core/2 head system with E5-2603v2, cores 1-3 are given to OVS exclusively
> >> - n-dpdk-rxqs=6, rx scattering is not enabled
> >> - x520 da
> >> - 3.10/3.18 host kernel
> >> - during 'legacy mode' testing, queue interrupts are scattered through all cores
> >>
> >> sender:
> >> - 16-core E52630, netmap framework for packet generation
> >> - pkt-gen -f tx -i eth2 -s 10.6.9.0-10.6.9.255 -d
> >> 10.6.10.0-10.6.10.255 -S 90:e2:ba:84:19:a0 -D 90:e2:ba:85:06:07 -R
> >> 11000000, results in 11Mpps 60-byte packet flood, there are constant
> >> values during test.
> >>
> >> OVS contains only single drop rule at the moment:
> >> ovs-ofctl add-flow br0 in_port=1,actions=DROP
> >>
> >> Packet generator was launched for tens of seconds for both Linux stack
> >> and OVS+DPDK cases, resulting in zero drop/error count on the
> >> interface in first, along with same counter values on pktgen and host
> >> interface stat (means that the none of generated packets are
> >> unaccounted).
> >>
> >> I selected rate for about 11M because OVS starts to do packet drop
> >> around this value, after same short test interface stat shows
> >> following:
> >>
> >> statistics          : {collisions=0, rx_bytes=22003928768,
> >> rx_crc_err=0, rx_dropped=0, rx_errors=10694693, rx_frame_err=0,
> >> rx_over_err=0, rx_packets=343811387, tx_bytes=0, tx_dropped=0,
> >> tx_errors=0, tx_packets=0}
> >>
> >> pktgen side:
> >> Sent 354506080 packets, 60 bytes each, in 32.23 seconds.
> >> Speed: 11.00 Mpps Bandwidth: 5.28 Gbps (raw 7.39 Gbps)
> >>
> >> If rate will be increased up to 13-14Mpps, the relative error/overall
> >> ratio will rise up to a one third. So far OVS on dpdk shows perfect
> >> results and I do not want to reject this solution due to exhaustive
> >> behavior like described one, so I`m open for any suggestions to
> >> improve the situation (except using 1.7 branch :) ).
> >
> > At a glance it looks like there is a problem with pmd threads, as they
> > starting to consume about five thousandth of sys% on a dedicated cores
> > during flood but in theory they should not. Any ideas for
> > debugging/improving this situation are very welcomed!
> 
> Over the time from a last message I tried a couple of different
> configurations, but packet loss starting to happen as early as at
> 7-8Mpps. Looks like that the bulk processing which has been in
> OVS-DPDK distro is missing from series of patches
> (http://openvswitch.org/pipermail/dev/2014-December/049722.html,
> http://openvswitch.org/pipermail/dev/2014-December/049723.html).
> Before implementing this, I would like to know if there can be any
> obvious (not for me unfortunately) clues on this performance issue.

These patches are to enable DPDK 1.8 only. What 'bulk processing' are you referring to? 
By default there is a batch size of 192 in netdev-dpdk for rx from the NIC - the linked 
patch doesn't change this, just the DPDK version.

Main things to consider are to isocpu's, pin the pmd thread and keep everything 
on 1 NUMA socket. At 11 mpps without packet loss on that processor I suspect you are 
doing those things already.

> 
> Thanks!

From blp at nicira.com  Tue Feb  3 09:07:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 09:07:25 -0800
Subject: [ovs-discuss] Problem compiling ovs with dist-hooks-git in
 Makefile.am
In-Reply-To: <CAD3NH5WT=cUR7SnRffHwXVE5wiAWwiFEOREaSNRgoOVe9CSShw@mail.gmail.com>
References: <CAD3NH5WT=cUR7SnRffHwXVE5wiAWwiFEOREaSNRgoOVe9CSShw@mail.gmail.com>
Message-ID: <20150203170725.GJ18144@nicira.com>

On Mon, Feb 02, 2015 at 11:29:02AM +0100, Dani Camps wrote:
> I have cloned openvswitch into a private git repository and when
> compiling with make I get an error that the distribution is missing
> files in dist-hooks-git.
> 
> The error comes from this line in Makefile.am:
> 
> (cd $(srcdir) && git ls-files) | grep -v '\.gitignore$$' | \
> sort -u > all-gitfiles;
> 
> Because in my case the grep statement, which I understand should
> filter out all files ignored in .gitignore, is not filtering anything.

No, it's only supposed to filter out the .gitignore file itself.  ("git
ls-files" won't list any files that will be ignored anyhow.)

> I am no expert on grep expressions, but I was wondering if this could
> be missing the -f modifier if what we want is to take the search
> expressions from a file.

No, it's not supposed to come from a file.

> Any help is appreciated. I copy my .gitignore at the end of the mail.

From blp at nicira.com  Tue Feb  3 09:11:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 09:11:03 -0800
Subject: [ovs-discuss] patch
In-Reply-To: <CABFtFwkH0aTL8+OtbdxmPKoY5B9unFh8AChDup3VKoyyZPY_fQ@mail.gmail.com>
References: <CABFtFwkOMG0kFdR8-Uj2QeUAb4wSf7pnj=SagX2TjgyeVxnR-Q@mail.gmail.com>
 <B13165A8-668F-462B-8E16-513208C5257A@nicira.com>
 <CABFtFwk9MzweqvEGccv0mb_HV6+AF63DkgPYCC3aML6TvsiwoA@mail.gmail.com>
 <CABFtFwm0eDWF84+B0j6iBMO=g_m9HJ04p05dwXK9tJk=fCVTeA@mail.gmail.com>
 <20150201215521.GD24647@nicira.com>
 <CABFtFw=1+p+zSfNE7n_N6G0hV7i4uca4tb3Ocmgi7tPXuncYQA@mail.gmail.com>
 <CABFtFwkW1r1oXTbECBQhi17XRVSD9uv4WcLH7gAznMmzH1LeOQ@mail.gmail.com>
 <CABFtFw=ZmLkcO-2Sp8sy9b0pxd4vUvNWdW_6qPiV91K1m2CFpw@mail.gmail.com>
 <CABFtFw=sg-y0ry_E2KibzgUOD7uHKFtQZPq=8uhmA1hV_FrQZw@mail.gmail.com>
 <CABFtFwkH0aTL8+OtbdxmPKoY5B9unFh8AChDup3VKoyyZPY_fQ@mail.gmail.com>
Message-ID: <20150203171103.GK18144@nicira.com>

Ashok, you think that this is important.  Therefore, if I worked for
you, then I would scramble to get it fixed.  But I don't work for you
and I don't think it is important.  Therefore, it's your job to get it
fixed, or to find someone to get it fixed.  All this pestering just
makes people less likely to help you now and in the future.

On Mon, Feb 02, 2015 at 11:19:05PM -0800, Ashok Chippa wrote:
> Can someone please help?... I AM BLOCKED ON THIS... One hunk has failed and
> I shared that with you. The code base I have (2.3.0) seems to have changed
> significantly where I cannot find a place to add these 4 lines:
> 
> +            if (i == 0) {
> +                s->active_count -= connmgr_count_hidden_rules(
> +                    ofproto->connmgr);
> +            }
> 
> This is your code I assume, and it should not take you any time to provide
> a patch that works... I am underwhelmed by your responses... This is not my
> code base and I do not have the luxury to go deep into ofproto.c and track
> all your changes and how the code morphed and then figure out where (and
> how) to add the above 4 lines....
> 
> The only place in 2.3.0 that references s->active_count is in
> handle_table_stats_request() function...:
> 
> handle_table_stats_request(...)
> {
>     ots[i].active_count = htonl(classifier_count(&p->tables[i].cls));
> ...
> }
> 
> I am sure this is where it goes...
> 
> p.s.: It does not seem like you guys are interested in fixing your bugs...
> I have volunteered to test it. Yet, I am not getting any help. If you think
> it is that easy to fix somone else's code, would you like to try patching
> newer version of my code with an older version of my patch? Let's see how
> easy it is for you guys to find and resolve it...
> 
> 
> 
> 
> On Mon, Feb 2, 2015 at 7:41 PM, Ashok Chippa <a.n.chippa at gmail.com> wrote:
> 
> > Hi Ben,
> >
> > Hoping you will provide me with a patch that will work... Here's the
> > ofproto.c.rej:
> >
> > --- ofproto/ofproto.c
> > +++ ofproto/ofproto.c
> > @@ -1,5 +1,5 @@
> >  /*
> > - * Copyright (c) 2009, 2010, 2011, 2012, 2013, 2014, 2015 Nicira, Inc.
> > + * Copyright (c) 2009-2015 Nicira, Inc.
> >   * Copyright (c) 2010 Jean Tourrilhes - HP-Labs.
> >   *
> >   * Licensed under the Apache License, Version 2.0 (the "License");
> > @@ -2963,6 +2963,10 @@
> >
> >              s->table_id = i;
> >              s->active_count = classifier_count(cls);
> > <<<<==== cannot find this in my branch (2.3.0)
> > +            if (i == 0) {
> > +                s->active_count -= connmgr_count_hidden_rules(
> > +                    ofproto->connmgr);
> > +            }
> >          }
> >      } else {
> >          stats = NULL;
> >
> > s->active_count = classifier_count(cls); <<<<<===== cannot find this
> > anywhere in my 2.3.0 branch. Please either provide a patch with more
> > context (so I know where to patch this change) or provide a patch based on
> > 2.3.0 that will work... I am blocked on this....
> >
> > Thanks
> >
> > On Mon, Feb 2, 2015 at 12:21 PM, Ashok Chippa <a.n.chippa at gmail.com>
> > wrote:
> >
> >> Still waiting :) I cannot find the context (around the change) I saw in
> >> ofproto.c.rej in 2.3.0 ofproto.c. That's the reason for asking you for the
> >> patch (based on 2.3.0). I do not need the entire patch, just the small hunk
> >> that failed (in ofproto.c.rej I sent earlier). The faster I get it, the
> >> faster I can test it :)
> >>
> >> Thanks
> >>
> >> On Sun, Feb 1, 2015 at 11:05 PM, Ashok Chippa <a.n.chippa at gmail.com>
> >> wrote:
> >>
> >>> Can one of you please apply these diffs to 2.3.0 and provide me with a
> >>> patch. I am not able to readily figure out where (and how) in ofproto.c
> >>> this needs to be applied: It will take me more time to figure this out, as
> >>> I am not the original author of this code...
> >>>
> >>> Appreciate your help. I will then patch it and test it. Thanks.
> >>>
> >>> Here's ofproto.c.rej:
> >>>
> >>>
> >>>
> >>> On Sun, Feb 1, 2015 at 3:07 PM, Ashok Chippa <a.n.chippa at gmail.com>
> >>> wrote:
> >>>
> >>>> Thanks, I figure so... Will do and let you know if it worked...
> >>>>
> >>>> On Sun, Feb 1, 2015 at 1:55 PM, Ben Pfaff <blp at nicira.com> wrote:
> >>>>
> >>>>> On Fri, Jan 30, 2015 at 05:13:42PM -0800, Ashok Chippa wrote:
> >>>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl del-flows br-int
> >>>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl dump-tables br-int
> >>>>> > OFPST_TABLE reply (xid=0x2): 254 tables
> >>>>> >   0: classifier: wild=0x3fffff, max=1000000, active=10
> >>>>> >                lookup=0, matched=0
> >>>>> >   1: table1  : wild=0x3fffff, max=1000000, active=0
> >>>>>
> >>>>> If you apply the patch, then it will show active=0.
> >>>>>
> >>>>
> >>>>
> >>>
> >>
> >

From blp at nicira.com  Tue Feb  3 09:11:53 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 09:11:53 -0800
Subject: [ovs-discuss] What is the difference between OVS 2.1.0 and 2.3.1
In-Reply-To: <CAHWErLeepeG4iUAnQLfqkbV0ivoLbwVT53vV8sDtFpyjwMmg3A@mail.gmail.com>
References: <CAHWErLeepeG4iUAnQLfqkbV0ivoLbwVT53vV8sDtFpyjwMmg3A@mail.gmail.com>
Message-ID: <20150203171153.GL18144@nicira.com>

On Mon, Feb 02, 2015 at 12:24:36PM +0530, tech_kals Kals wrote:
> #1) Could someone please tell me what is the difference between OVS 2.1.0
> and 2.3.1? I was using earlier 2.1.0 and should i move to 2.3.1?

The NEWS file gives a list of changes.

> #2) will OVS 2.1.0 supports TTP? or should I move to 2.3.1 version to
> support TTP?

No version of OVS supports TTPs.  (Which TTP should it support?)

From andrey at xdel.ru  Tue Feb  3 09:21:03 2015
From: andrey at xdel.ru (Andrey Korolyov)
Date: Tue, 3 Feb 2015 21:21:03 +0400
Subject: [ovs-discuss] Packet drops during non-exhaustive flood with OVS
	and 1.8.0
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F730688B53@IRSMSX104.ger.corp.intel.com>
References: <CABYiri-qn_HGYeRSxH+z0+LGi0se9NEOk0q9hzFg4R+wg05ABw@mail.gmail.com>
 <CABYiri9WwQMn1u7TbJNEGCs804f_hvP2cKxet2sGMbrx1rJUyw@mail.gmail.com>
 <CABYiri_q4QqWrhTQL-UZ1wf3FLz-wj9SbtBJrDntz2Bw4cEPoQ@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F730688B53@IRSMSX104.ger.corp.intel.com>
Message-ID: <CABYiri8qr2v8r_XQO35swWt_OO=WQtW0jO=KAz70f5VojhM6kg@mail.gmail.com>

> These patches are to enable DPDK 1.8 only. What 'bulk processing' are you referring to?
> By default there is a batch size of 192 in netdev-dpdk for rx from the NIC - the linked
> patch doesn't change this, just the DPDK version.

Sorry, I referred the wrong part there: bulk transmission, which is
clearly not involved in my case. The idea was that the conditionally
enabling prefetch for rx queues (BULK_ALLOC) may help somehow, but
it`s probably will mask issue instead of solving it directly. By my
understanding, strict drop rule should have a zero impact on a main
ovs thread (and this is true) and work just fine with a line rate
(this is not).

>
> Main things to consider are to isocpu's, pin the pmd thread and keep everything
> on 1 NUMA socket. At 11 mpps without packet loss on that processor I suspect you are
> doing those things already.

Yes, with all tuning improvements I was able to do this, but bare
Linux stack on same machine is able to handle 12Mpps and there are
absolutely no hints of what exactly is being congested.

From xuyibing3225883 at gmail.com  Tue Feb  3 02:13:53 2015
From: xuyibing3225883 at gmail.com (=?utf-8?B?eHV5aWJpbmczMjI1ODgz?=)
Date: Tue, 3 Feb 2015 18:13:53 +0800
Subject: [ovs-discuss] got error msg at the last step of using ovs
Message-ID: <tencent_7863A54B7694CD574F94D0B9@qq.com>

An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/6fd23e0d/attachment.html>

From ruverma at gmail.com  Mon Feb  2 22:37:02 2015
From: ruverma at gmail.com (Ruchika Verma)
Date: Tue, 3 Feb 2015 12:07:02 +0530
Subject: [ovs-discuss] OVS-controller crashing on enabling SSL on Mininet
	Environment
Message-ID: <CACHK9BGp9Pan6mY=NS3n5zgOy_LR_CX-gBnenGqhumKEeJTWoQ@mail.gmail.com>

hi,

I am running ovs-controller with SSL enabled option using command -

    sudo ovs-controller -v pssl:6633  -p /mininet/mininet/ctl-privkey.pem
-c /mininet/mininet/ctl-cert.pem -C
/var/lib/openvswitch/pki/switchca/cacert.pem

I have enabled BOOTSTRAP option at switch through -

ovs-vsctl -- --bootstrap set-ssl /mininet/mininet/sc-privkey.pem
/mininet/mininet/sc-cert.pem /etc/openvswitch/cacert.pem

the keys and certificates are generated as -

sudo ovs-pki req+sign ctl controller
sudo ovs-pki req+sign sc switch

Now when i create the OpenVSwitch in virtual environment (on mininet),
using command -

sudo mn --topo=linear,1 --controller=remote

I get following error and OVS-Controller crashes after sometime. On mininet
window however the topology is created successfully.

>>>>>

...vconn|DBG|SSL:127.0.0.1:58708:entering ACTIVE

...vconn|DBG|SSL:127.0.0.1:58708:sent (SUCCESS):OFPT_HELLO(xid=0x1):

...poll_cmd|DBG|wakeup due to [POLLIN] in f8(127.0.0.1:6633 <-->
127.0.0.1:58708) at ../lib/stream-ssl.c:726

...stream-ssl|WARN|ssl-accept:unexpected SSL connection close

...vconn_stream|ERR|send:Protocol Error

..........................

above error prints are seen for many times before the controller crash.

Can you please help?

What am i doing wrong? is there any configuration parameter apart from -
1. changing the connection to SSL in /mininet/node.py
2. flags to support SSL in /openflow/configure​

​Thanks
Ruchika​
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/fa1cd558/attachment-0001.html>

From p.gao at se11.qmul.ac.uk  Mon Feb  2 23:11:59 2015
From: p.gao at se11.qmul.ac.uk (Peng Gao)
Date: Tue, 3 Feb 2015 07:11:59 +0000
Subject: [ovs-discuss] A simple question
Message-ID: <3B656164-BB24-4F2D-97DB-32B2F2358397@se11.qmul.ac.uk>

Dear
I am an undergraduate and my final project requires me to use OVS. As information mentioned on your website below, I should recompile and fix all of the new warnings if I implement a new OF message. So my question is how to recompile ovs code. Please help me.


Sincerely,

Peng Gao
Q: How do I implement a new OpenFlow message?

A: Add your new message to "enum ofpraw" and "enum ofptype" in lib/ofp-msgs.h, following the existing pattern. Then recompile and fix all of the new warnings, implementing new functionality for the new message as needed.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/2cdd40e8/attachment-0001.html>

From jpettit at nicira.com  Tue Feb  3 09:51:00 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 3 Feb 2015 09:51:00 -0800
Subject: [ovs-discuss] A simple question
In-Reply-To: <3B656164-BB24-4F2D-97DB-32B2F2358397@se11.qmul.ac.uk>
References: <3B656164-BB24-4F2D-97DB-32B2F2358397@se11.qmul.ac.uk>
Message-ID: <9082267E-FD0C-4437-B8CC-279ECBB7AFF2@nicira.com>

Run "make"...

The file INSTALL.md contains instructions for building OVS:

	https://github.com/openvswitch/ovs/blob/master/INSTALL.md

--Justin


> On Feb 2, 2015, at 11:11 PM, Peng Gao <p.gao at se11.qmul.ac.uk> wrote:
> 
> Dear
> I am an undergraduate and my final project requires me to use OVS. As information mentioned on your website below, I should recompile and fix all of the new warnings if I implement a new OF message. So my question is how to recompile ovs code. Please help me.
> 
> 
> Sincerely,
> 
> Peng Gao
> Q: How do I implement a new OpenFlow message?
> 
> A: Add your new message to "enum ofpraw" and "enum ofptype" in lib/ofp-msgs.h, following the existing pattern. Then recompile and fix all of the new warnings, implementing new functionality for the new message as needed.
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From jpettit at nicira.com  Tue Feb  3 09:51:52 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 3 Feb 2015 09:51:52 -0800
Subject: [ovs-discuss] got error msg at the last step of using ovs
In-Reply-To: <tencent_7863A54B7694CD574F94D0B9@qq.com>
References: <tencent_7863A54B7694CD574F94D0B9@qq.com>
Message-ID: <B8DEE996-7D09-4493-88E8-253F3A080AC1@nicira.com>

You haven't provided any details such as, for example, the error message.

--Justin


> On Feb 3, 2015, at 2:13 AM, xuyibing3225883 <xuyibing3225883 at gmail.com> wrote:
> 
> hi, 
> how to reslove the question？please tell me some steps of it，thanks.
> 
> 发自我的iPhone
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From alexw at nicira.com  Tue Feb  3 09:56:03 2015
From: alexw at nicira.com (Alex Wang)
Date: Tue, 3 Feb 2015 09:56:03 -0800
Subject: [ovs-discuss] In flow entries should 'action' be set to normal
 for BFD control packets
In-Reply-To: <CACveyy+9K4DH_2LUFRyGUpf4d_3_T3HQEYoSZYSm8ksEUC+y1Q@mail.gmail.com>
References: <CACveyy+9K4DH_2LUFRyGUpf4d_3_T3HQEYoSZYSm8ksEUC+y1Q@mail.gmail.com>
Message-ID: <CAArS4XWv_M3WJUK0EsyZtS67Q_hJN2h3OOqZmukw_SCU8CPFqg@mail.gmail.com>

On Sun, Feb 1, 2015 at 8:43 PM, Padma Jayasankar <padmajs80 at gmail.com>
wrote:

> Hi,
>   I have to use BFD for failure detection and when i went through some
> examples the action field for the flow entries were set to 'Normal". Can't
> we use 'output' action. In that case i have to add two entries (one for
> each direction). Please claridy
>


The BFD implementation in OVS is mainly used for tunnel link failure
detection.  You need to have a tunnel port first and then can you enable
bfd on the tunnel port.  The BFD state machine in OVS will compose/send
control packets through the tunnel... No OpenFlow rules are involved...

We currently do not support multi-hop bfd.

However, at this time, it is still unclear what kind of link
(tunnel/point-to-point physical link) you want you monitor... maybe you
should clarify first,

Thanks,
Alex Wang,


> Thanks and Regards,
> Padma V
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/45d2295a/attachment.html>

From linville at tuxdriver.com  Tue Feb  3 10:19:57 2015
From: linville at tuxdriver.com (John W. Linville)
Date: Tue, 3 Feb 2015 13:19:57 -0500
Subject: [ovs-discuss] Open vSwitch STT support
In-Reply-To: <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
 <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
Message-ID: <20150203181956.GA9500@tuxdriver.com>

On Mon, Feb 02, 2015 at 01:34:07PM -0800, Pravin Shelar wrote:
> On Mon, Feb 2, 2015 at 11:20 AM, John W. Linville
> <linville at tuxdriver.com> wrote:
> > On Mon, Feb 02, 2015 at 10:55:25AM -0800, Pravin Shelar wrote:
> >> STT patches were posted on netdev mailing list, But it was rejected.
> >> As policy datapath patches must be accepted first in upstream kernel
> >> before ported to OVS repo. But considering STT is well known protocol,
> >> it is used in production and it can be useful for community, we can
> >> make exception for STT and maintain it in OVS repo.
> >> If anyone has objection to merging STT support let us know.
> >
> > What is preventing the upstream merge?
> >
> 
> Here is link to netdev patch, you can have a look at the discussion.
> 
> http://marc.info/?l=linux-netdev&m=142257416618642&w=2

Thanks for doing that research for me! :-) You don't see any way to
work with Dave M. around his objections?

Violating an "upstream first" policy seems like you are making an "end
run" in hopes of eventually coming back to Dave M. with an argument
like "but people have been using this already".  I could be wrong,
but that probably won't make Dave any more happy about merging the
patchset in the future...

john
-- 
John W. Linville		Someday the world will need a hero, and you
linville at tuxdriver.com			might be all we have.  Be ready.

From blp at nicira.com  Tue Feb  3 10:59:07 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 10:59:07 -0800
Subject: [ovs-discuss] OVS-controller crashing on enabling SSL on
 Mininet Environment
In-Reply-To: <CACHK9BGp9Pan6mY=NS3n5zgOy_LR_CX-gBnenGqhumKEeJTWoQ@mail.gmail.com>
References: <CACHK9BGp9Pan6mY=NS3n5zgOy_LR_CX-gBnenGqhumKEeJTWoQ@mail.gmail.com>
Message-ID: <20150203185907.GN18144@nicira.com>

On Tue, Feb 03, 2015 at 12:07:02PM +0530, Ruchika Verma wrote:
> hi,
> 
> I am running ovs-controller with SSL enabled option using command -
> 
>     sudo ovs-controller -v pssl:6633  -p /mininet/mininet/ctl-privkey.pem
> -c /mininet/mininet/ctl-cert.pem -C
> /var/lib/openvswitch/pki/switchca/cacert.pem
> 
> I have enabled BOOTSTRAP option at switch through -
> 
> ovs-vsctl -- --bootstrap set-ssl /mininet/mininet/sc-privkey.pem
> /mininet/mininet/sc-cert.pem /etc/openvswitch/cacert.pem
> 
> the keys and certificates are generated as -
> 
> sudo ovs-pki req+sign ctl controller
> sudo ovs-pki req+sign sc switch
> 
> Now when i create the OpenVSwitch in virtual environment (on mininet),
> using command -
> 
> sudo mn --topo=linear,1 --controller=remote
> 
> I get following error and OVS-Controller crashes after sometime. On mininet
> window however the topology is created successfully.

What version of OVS is this?

Can you provide a backtrace for the crash?

From blp at nicira.com  Tue Feb  3 11:05:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 11:05:04 -0800
Subject: [ovs-discuss] Build openvswitch in openwrt failed!
In-Reply-To: <20150202074345.39D5EC60006@webmail.sinamail.sina.com.cn>
References: <20150202074345.39D5EC60006@webmail.sinamail.sina.com.cn>
Message-ID: <CACjuMbwkvHb1bkKsgx9Eude9tqRvB3QFUP=eAEwpfCe8O7DtvQ@mail.gmail.com>

Errors like "final link failed: File in wrong format" make it seem
unlikely to me that the problem is in OVS.  Maybe you should
ask on an openwrt list.

On Sun, Feb 1, 2015 at 11:43 PM,  <zeech at sina.cn> wrote:
> Help!
> I git the openwrt trunk, and when I compile openvswitch over octeon
> platform, some errors occurred.
>
> make  all-recursive
> make[4]: Entering directory
> `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1'
> Making all in
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux
> make[5]: Entering directory
> `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux'
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../actions.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../datapath.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../dp_notify.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../flow.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../flow_netlink.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../flow_table.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-gre.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-internal_dev.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-lisp.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-netdev.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../vport-vxlan.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/dev-openvswitch.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/exthdrs_core.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/flex_array.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/flow_dissector.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/gre.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/gso.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/genetlink-openvswitch.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/hash.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/hash-x86.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/ip_tunnels_core.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/netdevice.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/net_namespace.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/reciprocal_div.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/skbuff-openvswitch.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/vxlan.c
> ln -s
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/../linux/compat/utils.c
> make -C
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/linux-octeon/linux-3.14.28
> M=/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux
> modules
> make[6]: Entering directory
> `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/linux-octeon/linux-3.14.28'
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/actions.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/datapath.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dp_notify.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_netlink.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_table.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-gre.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-internal_dev.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-lisp.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-netdev.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-vxlan.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dev-openvswitch.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/exthdrs_core.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flex_array.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_dissector.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gre.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gso.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/genetlink-openvswitch.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash-x86.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/ip_tunnels_core.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/netdevice.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/net_namespace.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/reciprocal_div.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/skbuff-openvswitch.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vxlan.o
>   CC [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/utils.o
>   LD [M]
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/openvswitch.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/actions.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/actions.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/datapath.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/datapath.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dp_notify.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dp_notify.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_netlink.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_netlink.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_table.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_table.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-gre.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-gre.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-internal_dev.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-internal_dev.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-lisp.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-lisp.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-netdev.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-netdev.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-vxlan.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vport-vxlan.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dev-openvswitch.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/dev-openvswitch.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/exthdrs_core.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/exthdrs_core.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flex_array.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flex_array.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_dissector.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/flow_dissector.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gre.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gre.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gso.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/gso.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/genetlink-openvswitch.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/genetlink-openvswitch.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash-x86.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/hash-x86.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/ip_tunnels_core.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/ip_tunnels_core.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/netdevice.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/netdevice.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/net_namespace.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/net_namespace.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/reciprocal_div.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/reciprocal_div.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/skbuff-openvswitch.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/skbuff-openvswitch.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vxlan.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/vxlan.o
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/utils.o:
> ABI is incompatible with that of the selected emulation
> mips64-openwrt-linux-uclibc-ld: failed to merge target specific data of file
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/utils.o
> mips64-openwrt-linux-uclibc-ld: Attempt to do relocatable link with
> elf64-tradbigmips input and elf32-ntradbigmips output
> mips64-openwrt-linux-uclibc-ld:
> /samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/actions.o:
> file class ELFCLASS64 incompatible with ELFCLASS32
> mips64-openwrt-linux-uclibc-ld: final link failed: File in wrong format
> make[7]: ***
> [/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux/openvswitch.o]
> Error 1
> make[6]: ***
> [_module_/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux]
> Error 2
> make[6]: Leaving directory
> `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/linux-octeon/linux-3.14.28'
> make[5]: *** [default] Error 2
>
> make[5]: Leaving directory
> `/samba/work/openwrt/build_dir/target-mips64_octeon_64_uClibc-0.9.33.2/openvswitch-2.3.1/datapath/linux'
>
>
> I built the whole openwrt by:
>
> make dirclean
>
> make menuconfig
>
> make V=s
>
>
> But it works over 32bit platforms.
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>



-- 
"I don't normally do acked-by's.  I think it's my way of avoiding
getting blamed when it all blows up."               Andrew Morton

From nick.bastin at gmail.com  Tue Feb  3 11:14:15 2015
From: nick.bastin at gmail.com (Nicholas Bastin)
Date: Tue, 3 Feb 2015 13:14:15 -0600
Subject: [ovs-discuss] Open vSwitch STT support
In-Reply-To: <20150203181956.GA9500@tuxdriver.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
 <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
 <20150203181956.GA9500@tuxdriver.com>
Message-ID: <CADmMkWcmvmLiLZPhuznwUtN3iLVYNJgjCwA6tu=yhF-7Z03nmg@mail.gmail.com>

On Tue, Feb 3, 2015 at 12:19 PM, John W. Linville <linville at tuxdriver.com>
wrote:

> Thanks for doing that research for me! :-) You don't see any way to
> work with Dave M. around his objections?
>

It seems to be a philosophical objection, which is likely intractable.


> Violating an "upstream first" policy seems like you are making an "end
> run" in hopes of eventually coming back to Dave M. with an argument
> like "but people have been using this already".


People are already using it, so some sufficiency of deployment probably
isn't going to tip the scales.. :-)

Fundamentally this comes down to a disagreement over whether users should
be allowed to choose to use a protocol which performs poorly or not at all
in the face of certain topologies.  Personally I believe that users ought
to be given that choice to make for themselves (and this is really already
true at varying levels for all of the supported tunneling protocols, due to
device support, firewalls, middleboxes, etc.), but I don't think you're
going to find community consensus on this.

As an aside, the assertion that routers absolutely depend on tools like RED
is patently ridiculous.  It is possible that naive *networks* depend on
these tools, but the router couldn't care less.  TCP back-off and shaping
tools that depend on knowledge of the state machine are effectively
"cooperative" bandwidth management tools that hope - but cannot guarantee -
that they know how the sender will react and you should *never* rely on
them contributing significantly to traffic engineering on your network.

--
Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/92ff798c/attachment.html>

From pshelar at nicira.com  Tue Feb  3 11:27:28 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Tue, 3 Feb 2015 11:27:28 -0800
Subject: [ovs-discuss] Open vSwitch STT support
In-Reply-To: <20150203181956.GA9500@tuxdriver.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
 <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
 <20150203181956.GA9500@tuxdriver.com>
Message-ID: <CALnjE+pDG8G1=g-rJHpcn324X4nz8Pi9PthnMiz63mYbJx2yYA@mail.gmail.com>

On Tue, Feb 3, 2015 at 10:19 AM, John W. Linville
<linville at tuxdriver.com> wrote:
> On Mon, Feb 02, 2015 at 01:34:07PM -0800, Pravin Shelar wrote:
>> On Mon, Feb 2, 2015 at 11:20 AM, John W. Linville
>> <linville at tuxdriver.com> wrote:
>> > On Mon, Feb 02, 2015 at 10:55:25AM -0800, Pravin Shelar wrote:
>> >> STT patches were posted on netdev mailing list, But it was rejected.
>> >> As policy datapath patches must be accepted first in upstream kernel
>> >> before ported to OVS repo. But considering STT is well known protocol,
>> >> it is used in production and it can be useful for community, we can
>> >> make exception for STT and maintain it in OVS repo.
>> >> If anyone has objection to merging STT support let us know.
>> >
>> > What is preventing the upstream merge?
>> >
>>
>> Here is link to netdev patch, you can have a look at the discussion.
>>
>> http://marc.info/?l=linux-netdev&m=142257416618642&w=2
>
> Thanks for doing that research for me! :-) You don't see any way to
> work with Dave M. around his objections?
>
> Violating an "upstream first" policy seems like you are making an "end
> run" in hopes of eventually coming back to Dave M. with an argument
> like "but people have been using this already".  I could be wrong,
> but that probably won't make Dave any more happy about merging the
> patchset in the future...
>
I do not have any plans of pushing STT to upstream kernel. I do not
think increased STT usage will help us getting STT upstream in future.
STT is useful tunneling protocol regardless of whether it is upstream
or not and that is motivation of merging it to OVS repo.

From a.n.chippa at gmail.com  Tue Feb  3 12:14:07 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 12:14:07 -0800
Subject: [ovs-discuss] patch
In-Reply-To: <20150203171103.GK18144@nicira.com>
References: <CABFtFwkOMG0kFdR8-Uj2QeUAb4wSf7pnj=SagX2TjgyeVxnR-Q@mail.gmail.com>
 <B13165A8-668F-462B-8E16-513208C5257A@nicira.com>
 <CABFtFwk9MzweqvEGccv0mb_HV6+AF63DkgPYCC3aML6TvsiwoA@mail.gmail.com>
 <CABFtFwm0eDWF84+B0j6iBMO=g_m9HJ04p05dwXK9tJk=fCVTeA@mail.gmail.com>
 <20150201215521.GD24647@nicira.com>
 <CABFtFw=1+p+zSfNE7n_N6G0hV7i4uca4tb3Ocmgi7tPXuncYQA@mail.gmail.com>
 <CABFtFwkW1r1oXTbECBQhi17XRVSD9uv4WcLH7gAznMmzH1LeOQ@mail.gmail.com>
 <CABFtFw=ZmLkcO-2Sp8sy9b0pxd4vUvNWdW_6qPiV91K1m2CFpw@mail.gmail.com>
 <CABFtFw=sg-y0ry_E2KibzgUOD7uHKFtQZPq=8uhmA1hV_FrQZw@mail.gmail.com>
 <CABFtFwkH0aTL8+OtbdxmPKoY5B9unFh8AChDup3VKoyyZPY_fQ@mail.gmail.com>
 <20150203171103.GK18144@nicira.com>
Message-ID: <CABFtFwmRjZOPFmyKh9La__zdExevBTZoW6GDKsB-hoNeap5kWQ@mail.gmail.com>

Yes, you don't work for me... But do you support the code you write?  If
not, I will stop asking (or pestering as you call it)...

And yes, it is obviously not important for you... but it is for me...
Unfortunately we (in our company) were asked to base our product on
openvswitch, otherwise why would I even bother with it?

Alright, don't help... I have coded products that are infinitely more
complex than openvswitch... it is just a matter of time which I do not have
at this time... hence my urgency and dependency on others...

Lori was kind enough to suggest using the master branch...which is what
I'll do...


On Tue, Feb 3, 2015 at 9:11 AM, Ben Pfaff <blp at nicira.com> wrote:

> Ashok, you think that this is important.  Therefore, if I worked for
> you, then I would scramble to get it fixed.  But I don't work for you
> and I don't think it is important.  Therefore, it's your job to get it
> fixed, or to find someone to get it fixed.  All this pestering just
> makes people less likely to help you now and in the future.
>
> On Mon, Feb 02, 2015 at 11:19:05PM -0800, Ashok Chippa wrote:
> > Can someone please help?... I AM BLOCKED ON THIS... One hunk has failed
> and
> > I shared that with you. The code base I have (2.3.0) seems to have
> changed
> > significantly where I cannot find a place to add these 4 lines:
> >
> > +            if (i == 0) {
> > +                s->active_count -= connmgr_count_hidden_rules(
> > +                    ofproto->connmgr);
> > +            }
> >
> > This is your code I assume, and it should not take you any time to
> provide
> > a patch that works... I am underwhelmed by your responses... This is not
> my
> > code base and I do not have the luxury to go deep into ofproto.c and
> track
> > all your changes and how the code morphed and then figure out where (and
> > how) to add the above 4 lines....
> >
> > The only place in 2.3.0 that references s->active_count is in
> > handle_table_stats_request() function...:
> >
> > handle_table_stats_request(...)
> > {
> >     ots[i].active_count = htonl(classifier_count(&p->tables[i].cls));
> > ...
> > }
> >
> > I am sure this is where it goes...
> >
> > p.s.: It does not seem like you guys are interested in fixing your
> bugs...
> > I have volunteered to test it. Yet, I am not getting any help. If you
> think
> > it is that easy to fix somone else's code, would you like to try patching
> > newer version of my code with an older version of my patch? Let's see how
> > easy it is for you guys to find and resolve it...
> >
> >
> >
> >
> > On Mon, Feb 2, 2015 at 7:41 PM, Ashok Chippa <a.n.chippa at gmail.com>
> wrote:
> >
> > > Hi Ben,
> > >
> > > Hoping you will provide me with a patch that will work... Here's the
> > > ofproto.c.rej:
> > >
> > > --- ofproto/ofproto.c
> > > +++ ofproto/ofproto.c
> > > @@ -1,5 +1,5 @@
> > >  /*
> > > - * Copyright (c) 2009, 2010, 2011, 2012, 2013, 2014, 2015 Nicira, Inc.
> > > + * Copyright (c) 2009-2015 Nicira, Inc.
> > >   * Copyright (c) 2010 Jean Tourrilhes - HP-Labs.
> > >   *
> > >   * Licensed under the Apache License, Version 2.0 (the "License");
> > > @@ -2963,6 +2963,10 @@
> > >
> > >              s->table_id = i;
> > >              s->active_count = classifier_count(cls);
> > > <<<<==== cannot find this in my branch (2.3.0)
> > > +            if (i == 0) {
> > > +                s->active_count -= connmgr_count_hidden_rules(
> > > +                    ofproto->connmgr);
> > > +            }
> > >          }
> > >      } else {
> > >          stats = NULL;
> > >
> > > s->active_count = classifier_count(cls); <<<<<===== cannot find this
> > > anywhere in my 2.3.0 branch. Please either provide a patch with more
> > > context (so I know where to patch this change) or provide a patch
> based on
> > > 2.3.0 that will work... I am blocked on this....
> > >
> > > Thanks
> > >
> > > On Mon, Feb 2, 2015 at 12:21 PM, Ashok Chippa <a.n.chippa at gmail.com>
> > > wrote:
> > >
> > >> Still waiting :) I cannot find the context (around the change) I saw
> in
> > >> ofproto.c.rej in 2.3.0 ofproto.c. That's the reason for asking you
> for the
> > >> patch (based on 2.3.0). I do not need the entire patch, just the
> small hunk
> > >> that failed (in ofproto.c.rej I sent earlier). The faster I get it,
> the
> > >> faster I can test it :)
> > >>
> > >> Thanks
> > >>
> > >> On Sun, Feb 1, 2015 at 11:05 PM, Ashok Chippa <a.n.chippa at gmail.com>
> > >> wrote:
> > >>
> > >>> Can one of you please apply these diffs to 2.3.0 and provide me with
> a
> > >>> patch. I am not able to readily figure out where (and how) in
> ofproto.c
> > >>> this needs to be applied: It will take me more time to figure this
> out, as
> > >>> I am not the original author of this code...
> > >>>
> > >>> Appreciate your help. I will then patch it and test it. Thanks.
> > >>>
> > >>> Here's ofproto.c.rej:
> > >>>
> > >>>
> > >>>
> > >>> On Sun, Feb 1, 2015 at 3:07 PM, Ashok Chippa <a.n.chippa at gmail.com>
> > >>> wrote:
> > >>>
> > >>>> Thanks, I figure so... Will do and let you know if it worked...
> > >>>>
> > >>>> On Sun, Feb 1, 2015 at 1:55 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >>>>
> > >>>>> On Fri, Jan 30, 2015 at 05:13:42PM -0800, Ashok Chippa wrote:
> > >>>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl del-flows br-int
> > >>>>> > root at ashok-vb:/usr/local/bin# ovs-ofctl dump-tables br-int
> > >>>>> > OFPST_TABLE reply (xid=0x2): 254 tables
> > >>>>> >   0: classifier: wild=0x3fffff, max=1000000, active=10
> > >>>>> >                lookup=0, matched=0
> > >>>>> >   1: table1  : wild=0x3fffff, max=1000000, active=0
> > >>>>>
> > >>>>> If you apply the patch, then it will show active=0.
> > >>>>>
> > >>>>
> > >>>>
> > >>>
> > >>
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/ac6aef11/attachment.html>

From a.n.chippa at gmail.com  Tue Feb  3 17:19:08 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 17:19:08 -0800
Subject: [ovs-discuss] another bug?
In-Reply-To: <20150203163715.GA18144@nicira.com>
References: <CABFtFwk723AKvcMuwQGmU4Tbofq-NfbiO9iEHxzzfqEgV6aU9Q@mail.gmail.com>
 <20150203163715.GA18144@nicira.com>
Message-ID: <CABFtFw=DmRAe4a2s4_aBnPxWN8xFBe4JWGEoArOCtk==bLQMBA@mail.gmail.com>

Thank you...

root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl dump-flows br-int
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=176.280s, table=0, n_packets=0, n_bytes=0,
idle_age=176, priority=9999,ip,nw_src=1.1.1.1,nw_dst=1.1.1.2 actions=drop


On Tue, Feb 3, 2015 at 8:37 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Feb 03, 2015 at 01:20:48AM -0800, Ashok Chippa wrote:
> > I added a flow to table0, but the flow is not shown correctly... Is this
> a
> > bug?
> >
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl del-flows
> br-int
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows
> br-int
> > NXST_FLOW reply (xid=0x4):
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0#
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0#
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0#
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl add-flow br-int
> > table=0,priority=9999,nw_src=1.1.1.1,nw_dst=1.1.1.2,actions=DROP
> > 2015-02-03T09:14:06Z|00001|ofp_util|INFO|normalization changed ofp_match,
> > details:
> > 2015-02-03T09:14:06Z|00002|ofp_util|INFO| pre:
> nw_src=1.1.1.1,nw_dst=1.1.1.2
> > 2015-02-03T09:14:06Z|00003|ofp_util|INFO|post:
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows
> br-int
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=8.642s, table=0, n_packets=0, n_bytes=0,
> idle_age=8,
> > priority=9999 actions=drop
> >
> > I ping 1.1.1.2 from 1.1.1.1 and the traffic passes through...!! What am I
> > missing?
>
> Please read the FAQ.
>
> ### Q: I ran "ovs-ofctl add-flow br0 nw_dst=192.168.0.1,actions=drop"
>    but I got a funny message like this:
>
>        ofp_util|INFO|normalization changed ofp_match, details:
>        ofp_util|INFO| pre: nw_dst=192.168.0.1
>        ofp_util|INFO|post:
>
>    and when I ran "ovs-ofctl dump-flows br0" I saw that my nw_dst
>    match had disappeared, so that the flow ends up matching every
>    packet.
>
> A: The term "normalization" in the log message means that a flow
>    cannot match on an L3 field without saying what L3 protocol is in
>    use.  The "ovs-ofctl" command above didn't specify an L3 protocol,
>    so the L3 field match was dropped.
>
>    In this case, the L3 protocol could be IP or ARP.  A correct
>    command for each possibility is, respectively:
>
>        ovs-ofctl add-flow br0 ip,nw_dst=192.168.0.1,actions=drop
>
>    and
>
>        ovs-ofctl add-flow br0 arp,nw_dst=192.168.0.1,actions=drop
>
>    Similarly, a flow cannot match on an L4 field without saying what
>    L4 protocol is in use.  For example, the flow match "tp_src=1234"
>    is, by itself, meaningless and will be ignored.  Instead, to match
>    TCP source port 1234, write "tcp,tp_src=1234", or to match UDP
>    source port 1234, write "udp,tp_src=1234".
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/6acfaa6b/attachment-0001.html>

From a.n.chippa at gmail.com  Tue Feb  3 17:22:12 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 17:22:12 -0800
Subject: [ovs-discuss] patch does not work
In-Reply-To: <20150203163801.GB18144@nicira.com>
References: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
 <20150203163801.GB18144@nicira.com>
Message-ID: <CABFtFwmiK-B6Oqd+ZTZ2O=2xX098Rwykq36zn7sQDa_MnBSERw@mail.gmail.com>

That's all I wanted to know. I assumed it was for 2.3.0 (since I remember
mentioning I was working with 2.3.0). It obviously failed cause I tried to
patch it to 2.3.0. Hence the hunk failures and ... I modified the patch so
it could be patched to 2.3.0 and compiled and reinstalled... However, I
still see the bug... In any case, I'll move to master.... Any idea why
master tarball says v1.1.0? I'd think master is the latest (later than
2.3.1)...

On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Mon, Feb 02, 2015 at 11:19:58PM -0800, Ashok Chippa wrote:
> > Can someone please help?... I AM BLOCKED ON THIS... One hunk has failed
> and
> > I shared that with you. The code base I have (2.3.0) seems to have
> changed
> > significantly where I cannot find a place to add these 4 lines:
>
> The patch I provided is not for 2.3.0, it is for master.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/e835d1c7/attachment.html>

From a.n.chippa at gmail.com  Tue Feb  3 17:30:41 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 17:30:41 -0800
Subject: [ovs-discuss] PATCH does not work
In-Reply-To: <20150203163827.GC18144@nicira.com>
References: <CABFtFwmdreK_PrfqvqK5MB=-aOwZTkcswR0=D0GftFOJF__y3w@mail.gmail.com>
 <20150203163827.GC18144@nicira.com>
Message-ID: <CABFtFwmq_HS01srWbJh7zpJtPgeMkcbv52sKo68Gijax1cQ9Bg@mail.gmail.com>

It's not actually this I seem to be fixated on... I just want to start over
(with 0 flows) and add some flows and see them take effect... which this
bug seems to be preventing me...or so I think, I could be wrong... My
packets seem to be hitting a flow that I am not able to see... Keep in
mind, I'm still learning... Even after deleting the flows, this count is
persistent... so I think the bookkeeping is wrong somewhere... not a
critical bug for sure, as long as it does not prevent normal functions from
working...

On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Feb 03, 2015 at 12:06:43AM -0800, Ashok Chippa wrote:
> > Compiled the patch in and re-installed the .ko:
> >
> > STILL SEE THIS:
> >
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl del-flows
> br-int
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows
> br-int
> > NXST_FLOW reply (xid=0x4):
> > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-tables
> br-int
> > OFPST_TABLE reply (xid=0x2): 254 tables
> >   0: classifier: wild=0x3fffff, max=1000000, active=10   <<<<============
> > STILL!!!
> >                lookup=0, matched=0
> >   1: table1  : wild=0x3fffff, max=1000000, active=0
> >                lookup=0, matched=0
> > ...
> >
> > I JUST CAN'T GET RID OF the ACTIVE_COUNT of 10!!! in dump-tables output:
>
> Why are you so fixated on this?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/d20f7ae2/attachment.html>

From blp at nicira.com  Tue Feb  3 17:44:30 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 17:44:30 -0800
Subject: [ovs-discuss] PATCH does not work
In-Reply-To: <CABFtFwmq_HS01srWbJh7zpJtPgeMkcbv52sKo68Gijax1cQ9Bg@mail.gmail.com>
References: <CABFtFwmdreK_PrfqvqK5MB=-aOwZTkcswR0=D0GftFOJF__y3w@mail.gmail.com>
 <20150203163827.GC18144@nicira.com>
 <CABFtFwmq_HS01srWbJh7zpJtPgeMkcbv52sKo68Gijax1cQ9Bg@mail.gmail.com>
Message-ID: <20150204014430.GC12628@nicira.com>

So what does all the SHOUTING CAPITAL LETTERS and "THIS IS A BLOCKER FOR
ME" come from?  It sounds like it's not a blocker for you at all, you're
just fixated on it.

On Tue, Feb 03, 2015 at 05:30:41PM -0800, Ashok Chippa wrote:
> It's not actually this I seem to be fixated on... I just want to start over
> (with 0 flows) and add some flows and see them take effect... which this
> bug seems to be preventing me...or so I think, I could be wrong... My
> packets seem to be hitting a flow that I am not able to see... Keep in
> mind, I'm still learning... Even after deleting the flows, this count is
> persistent... so I think the bookkeeping is wrong somewhere... not a
> critical bug for sure, as long as it does not prevent normal functions from
> working...
> 
> On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Tue, Feb 03, 2015 at 12:06:43AM -0800, Ashok Chippa wrote:
> > > Compiled the patch in and re-installed the .ko:
> > >
> > > STILL SEE THIS:
> > >
> > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl del-flows
> > br-int
> > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows
> > br-int
> > > NXST_FLOW reply (xid=0x4):
> > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-tables
> > br-int
> > > OFPST_TABLE reply (xid=0x2): 254 tables
> > >   0: classifier: wild=0x3fffff, max=1000000, active=10   <<<<============
> > > STILL!!!
> > >                lookup=0, matched=0
> > >   1: table1  : wild=0x3fffff, max=1000000, active=0
> > >                lookup=0, matched=0
> > > ...
> > >
> > > I JUST CAN'T GET RID OF the ACTIVE_COUNT of 10!!! in dump-tables output:
> >
> > Why are you so fixated on this?
> >

From blp at nicira.com  Tue Feb  3 17:45:18 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 17:45:18 -0800
Subject: [ovs-discuss] patch does not work
In-Reply-To: <CABFtFwmiK-B6Oqd+ZTZ2O=2xX098Rwykq36zn7sQDa_MnBSERw@mail.gmail.com>
References: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
 <20150203163801.GB18144@nicira.com>
 <CABFtFwmiK-B6Oqd+ZTZ2O=2xX098Rwykq36zn7sQDa_MnBSERw@mail.gmail.com>
Message-ID: <20150204014518.GD12628@nicira.com>

Where did you get the master tarball, and where does it say v1.1.0?

On Tue, Feb 03, 2015 at 05:22:12PM -0800, Ashok Chippa wrote:
> That's all I wanted to know. I assumed it was for 2.3.0 (since I remember
> mentioning I was working with 2.3.0). It obviously failed cause I tried to
> patch it to 2.3.0. Hence the hunk failures and ... I modified the patch so
> it could be patched to 2.3.0 and compiled and reinstalled... However, I
> still see the bug... In any case, I'll move to master.... Any idea why
> master tarball says v1.1.0? I'd think master is the latest (later than
> 2.3.1)...
> 
> On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Mon, Feb 02, 2015 at 11:19:58PM -0800, Ashok Chippa wrote:
> > > Can someone please help?... I AM BLOCKED ON THIS... One hunk has failed
> > and
> > > I shared that with you. The code base I have (2.3.0) seems to have
> > changed
> > > significantly where I cannot find a place to add these 4 lines:
> >
> > The patch I provided is not for 2.3.0, it is for master.
> >

From a.n.chippa at gmail.com  Tue Feb  3 18:00:35 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 18:00:35 -0800
Subject: [ovs-discuss] PATCH does not work
In-Reply-To: <20150204014430.GC12628@nicira.com>
References: <CABFtFwmdreK_PrfqvqK5MB=-aOwZTkcswR0=D0GftFOJF__y3w@mail.gmail.com>
 <20150203163827.GC18144@nicira.com>
 <CABFtFwmq_HS01srWbJh7zpJtPgeMkcbv52sKo68Gijax1cQ9Bg@mail.gmail.com>
 <20150204014430.GC12628@nicira.com>
Message-ID: <CABFtFwkA6TmgdfPygk5f3wOi_WzYTofhFDkGYOFxRgP9yQa7mQ@mail.gmail.com>

Okay, here it is: I added a flow as shown below, and I expect the ping from
1.1.1.1 to 1.1.1.2 to not work... But the ping goes through... it is not
hitting the flow I added, and I cannot tell which flow it is hitting... as
dump-flows shows only one flow... BTW, dump-tables shows -ve count (there
is a bug there, even though it is not critical)... I'm sure you have bigger
fish to fry... :)    Please see steps 1 through 4 below:

1> ADD FLOW
--------------------

root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl add-flow br-int
table=0,priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2,actions=drop
root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl dump-flows br-int
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=8.242s, table=0, n_packets=0, n_bytes=0, idle_age=8,
priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2 actions=drop

2> PING from 1.1.1.1 to 1.1.1.2
------------------------------------------

root at c643cbf36aee:/# !ping
ping -c 7 1.1.1.2
PING 1.1.1.2 (1.1.1.2) 56(84) bytes of data.
64 bytes from 1.1.1.2: icmp_seq=1 ttl=64 time=0.380 ms
64 bytes from 1.1.1.2: icmp_seq=2 ttl=64 time=0.060 ms
64 bytes from 1.1.1.2: icmp_seq=3 ttl=64 time=0.110 ms
64 bytes from 1.1.1.2: icmp_seq=4 ttl=64 time=0.156 ms
64 bytes from 1.1.1.2: icmp_seq=5 ttl=64 time=0.094 ms
64 bytes from 1.1.1.2: icmp_seq=6 ttl=64 time=0.063 ms
64 bytes from 1.1.1.2: icmp_seq=7 ttl=64 time=0.078 ms

--- 1.1.1.2 ping statistics ---
7 packets transmitted, 7 received, 0% packet loss, time 5999ms
rtt min/avg/max/mdev = 0.060/0.134/0.380/0.105 ms

3> TCPDUMP on the interface(s) connected to 1.1.1.1 or 1.1.1.2
--------------------------------------------------------------------------------------

root at ashok-vb:/home/achippa/dispatcher# tcpdump -i dc2911ce73d24_l
tcpdump: WARNING: dc2911ce73d24_l: no IPv4 address assigned
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on dc2911ce73d24_l, link-type EN10MB (Ethernet), capture size
65535 bytes
17:52:32.682083 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 1,
length 64
17:52:32.682111 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 1, length
64
17:52:33.681082 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 2,
length 64
17:52:33.681105 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 2, length
64
17:52:34.679962 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 3,
length 64
17:52:34.679990 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 3, length
64
17:52:35.679419 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 4,
length 64
17:52:35.679449 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 4, length
64
17:52:36.678597 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 5,
length 64
17:52:36.678624 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 5, length
64
17:52:37.679530 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 6,
length 64
17:52:37.679561 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 6, length
64
17:52:37.682449 ARP, Request who-has 1.1.1.1 tell 1.1.1.2, length 28
17:52:37.682796 ARP, Reply 1.1.1.1 is-at ba:f9:6e:e6:67:82 (oui Unknown),
length 28
17:52:38.678662 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 7,
length 64
17:52:38.678703 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 7, length
64

4> n_packets is 0 on the flow I added
-------------------------------------------------

root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl dump-flows br-int
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=387.380s, table=0, n_packets=0, n_bytes=0,
idle_age=387, priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2 actions=drop

You can see, the rule was not hit... which rule is allowing it to go
through? I can't see with any cli command...


On Tue, Feb 3, 2015 at 5:44 PM, Ben Pfaff <blp at nicira.com> wrote:

> So what does all the SHOUTING CAPITAL LETTERS and "THIS IS A BLOCKER FOR
> ME" come from?  It sounds like it's not a blocker for you at all, you're
> just fixated on it.
>
> On Tue, Feb 03, 2015 at 05:30:41PM -0800, Ashok Chippa wrote:
> > It's not actually this I seem to be fixated on... I just want to start
> over
> > (with 0 flows) and add some flows and see them take effect... which this
> > bug seems to be preventing me...or so I think, I could be wrong... My
> > packets seem to be hitting a flow that I am not able to see... Keep in
> > mind, I'm still learning... Even after deleting the flows, this count is
> > persistent... so I think the bookkeeping is wrong somewhere... not a
> > critical bug for sure, as long as it does not prevent normal functions
> from
> > working...
> >
> > On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Tue, Feb 03, 2015 at 12:06:43AM -0800, Ashok Chippa wrote:
> > > > Compiled the patch in and re-installed the .ko:
> > > >
> > > > STILL SEE THIS:
> > > >
> > > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl del-flows
> > > br-int
> > > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows
> > > br-int
> > > > NXST_FLOW reply (xid=0x4):
> > > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-tables
> > > br-int
> > > > OFPST_TABLE reply (xid=0x2): 254 tables
> > > >   0: classifier: wild=0x3fffff, max=1000000, active=10
>  <<<<============
> > > > STILL!!!
> > > >                lookup=0, matched=0
> > > >   1: table1  : wild=0x3fffff, max=1000000, active=0
> > > >                lookup=0, matched=0
> > > > ...
> > > >
> > > > I JUST CAN'T GET RID OF the ACTIVE_COUNT of 10!!! in dump-tables
> output:
> > >
> > > Why are you so fixated on this?
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/c26cf20d/attachment-0001.html>

From a.n.chippa at gmail.com  Tue Feb  3 18:01:23 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 18:01:23 -0800
Subject: [ovs-discuss] patch does not work
In-Reply-To: <20150204014518.GD12628@nicira.com>
References: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
 <20150203163801.GB18144@nicira.com>
 <CABFtFwmiK-B6Oqd+ZTZ2O=2xX098Rwykq36zn7sQDa_MnBSERw@mail.gmail.com>
 <20150204014518.GD12628@nicira.com>
Message-ID: <CABFtFw=P1=ciuomKYsaj4pJG=MK5_TgCZtvr+HDogQJreTwrPQ@mail.gmail.com>

When I tried to download from openvswitch.org, clicking on the link there
says v1.1.0!!!

On Tue, Feb 3, 2015 at 5:45 PM, Ben Pfaff <blp at nicira.com> wrote:

> Where did you get the master tarball, and where does it say v1.1.0?
>
> On Tue, Feb 03, 2015 at 05:22:12PM -0800, Ashok Chippa wrote:
> > That's all I wanted to know. I assumed it was for 2.3.0 (since I remember
> > mentioning I was working with 2.3.0). It obviously failed cause I tried
> to
> > patch it to 2.3.0. Hence the hunk failures and ... I modified the patch
> so
> > it could be patched to 2.3.0 and compiled and reinstalled... However, I
> > still see the bug... In any case, I'll move to master.... Any idea why
> > master tarball says v1.1.0? I'd think master is the latest (later than
> > 2.3.1)...
> >
> > On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Mon, Feb 02, 2015 at 11:19:58PM -0800, Ashok Chippa wrote:
> > > > Can someone please help?... I AM BLOCKED ON THIS... One hunk has
> failed
> > > and
> > > > I shared that with you. The code base I have (2.3.0) seems to have
> > > changed
> > > > significantly where I cannot find a place to add these 4 lines:
> > >
> > > The patch I provided is not for 2.3.0, it is for master.
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/af3be6c2/attachment.html>

From blp at nicira.com  Tue Feb  3 18:04:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 18:04:55 -0800
Subject: [ovs-discuss] PATCH does not work
In-Reply-To: <CABFtFwkA6TmgdfPygk5f3wOi_WzYTofhFDkGYOFxRgP9yQa7mQ@mail.gmail.com>
References: <CABFtFwmdreK_PrfqvqK5MB=-aOwZTkcswR0=D0GftFOJF__y3w@mail.gmail.com>
 <20150203163827.GC18144@nicira.com>
 <CABFtFwmq_HS01srWbJh7zpJtPgeMkcbv52sKo68Gijax1cQ9Bg@mail.gmail.com>
 <20150204014430.GC12628@nicira.com>
 <CABFtFwkA6TmgdfPygk5f3wOi_WzYTofhFDkGYOFxRgP9yQa7mQ@mail.gmail.com>
Message-ID: <20150204020455.GE12628@nicira.com>

Are the packets going through your bridge at all?  What do "ovs-dpctl
show" and "ovs-vsctl show" print?  How about "ifconfig"?

On Tue, Feb 03, 2015 at 06:00:35PM -0800, Ashok Chippa wrote:
> Okay, here it is: I added a flow as shown below, and I expect the ping from
> 1.1.1.1 to 1.1.1.2 to not work... But the ping goes through... it is not
> hitting the flow I added, and I cannot tell which flow it is hitting... as
> dump-flows shows only one flow... BTW, dump-tables shows -ve count (there
> is a bug there, even though it is not critical)... I'm sure you have bigger
> fish to fry... :)    Please see steps 1 through 4 below:
> 
> 1> ADD FLOW
> --------------------
> 
> root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl add-flow br-int
> table=0,priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2,actions=drop
> root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl dump-flows br-int
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=8.242s, table=0, n_packets=0, n_bytes=0, idle_age=8,
> priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2 actions=drop
> 
> 2> PING from 1.1.1.1 to 1.1.1.2
> ------------------------------------------
> 
> root at c643cbf36aee:/# !ping
> ping -c 7 1.1.1.2
> PING 1.1.1.2 (1.1.1.2) 56(84) bytes of data.
> 64 bytes from 1.1.1.2: icmp_seq=1 ttl=64 time=0.380 ms
> 64 bytes from 1.1.1.2: icmp_seq=2 ttl=64 time=0.060 ms
> 64 bytes from 1.1.1.2: icmp_seq=3 ttl=64 time=0.110 ms
> 64 bytes from 1.1.1.2: icmp_seq=4 ttl=64 time=0.156 ms
> 64 bytes from 1.1.1.2: icmp_seq=5 ttl=64 time=0.094 ms
> 64 bytes from 1.1.1.2: icmp_seq=6 ttl=64 time=0.063 ms
> 64 bytes from 1.1.1.2: icmp_seq=7 ttl=64 time=0.078 ms
> 
> --- 1.1.1.2 ping statistics ---
> 7 packets transmitted, 7 received, 0% packet loss, time 5999ms
> rtt min/avg/max/mdev = 0.060/0.134/0.380/0.105 ms
> 
> 3> TCPDUMP on the interface(s) connected to 1.1.1.1 or 1.1.1.2
> --------------------------------------------------------------------------------------
> 
> root at ashok-vb:/home/achippa/dispatcher# tcpdump -i dc2911ce73d24_l
> tcpdump: WARNING: dc2911ce73d24_l: no IPv4 address assigned
> tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
> listening on dc2911ce73d24_l, link-type EN10MB (Ethernet), capture size
> 65535 bytes
> 17:52:32.682083 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 1,
> length 64
> 17:52:32.682111 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 1, length
> 64
> 17:52:33.681082 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 2,
> length 64
> 17:52:33.681105 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 2, length
> 64
> 17:52:34.679962 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 3,
> length 64
> 17:52:34.679990 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 3, length
> 64
> 17:52:35.679419 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 4,
> length 64
> 17:52:35.679449 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 4, length
> 64
> 17:52:36.678597 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 5,
> length 64
> 17:52:36.678624 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 5, length
> 64
> 17:52:37.679530 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 6,
> length 64
> 17:52:37.679561 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 6, length
> 64
> 17:52:37.682449 ARP, Request who-has 1.1.1.1 tell 1.1.1.2, length 28
> 17:52:37.682796 ARP, Reply 1.1.1.1 is-at ba:f9:6e:e6:67:82 (oui Unknown),
> length 28
> 17:52:38.678662 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 7,
> length 64
> 17:52:38.678703 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 7, length
> 64
> 
> 4> n_packets is 0 on the flow I added
> -------------------------------------------------
> 
> root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl dump-flows br-int
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=387.380s, table=0, n_packets=0, n_bytes=0,
> idle_age=387, priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2 actions=drop
> 
> You can see, the rule was not hit... which rule is allowing it to go
> through? I can't see with any cli command...
> 
> 
> On Tue, Feb 3, 2015 at 5:44 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > So what does all the SHOUTING CAPITAL LETTERS and "THIS IS A BLOCKER FOR
> > ME" come from?  It sounds like it's not a blocker for you at all, you're
> > just fixated on it.
> >
> > On Tue, Feb 03, 2015 at 05:30:41PM -0800, Ashok Chippa wrote:
> > > It's not actually this I seem to be fixated on... I just want to start
> > over
> > > (with 0 flows) and add some flows and see them take effect... which this
> > > bug seems to be preventing me...or so I think, I could be wrong... My
> > > packets seem to be hitting a flow that I am not able to see... Keep in
> > > mind, I'm still learning... Even after deleting the flows, this count is
> > > persistent... so I think the bookkeeping is wrong somewhere... not a
> > > critical bug for sure, as long as it does not prevent normal functions
> > from
> > > working...
> > >
> > > On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Tue, Feb 03, 2015 at 12:06:43AM -0800, Ashok Chippa wrote:
> > > > > Compiled the patch in and re-installed the .ko:
> > > > >
> > > > > STILL SEE THIS:
> > > > >
> > > > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl del-flows
> > > > br-int
> > > > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-flows
> > > > br-int
> > > > > NXST_FLOW reply (xid=0x4):
> > > > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl dump-tables
> > > > br-int
> > > > > OFPST_TABLE reply (xid=0x2): 254 tables
> > > > >   0: classifier: wild=0x3fffff, max=1000000, active=10
> >  <<<<============
> > > > > STILL!!!
> > > > >                lookup=0, matched=0
> > > > >   1: table1  : wild=0x3fffff, max=1000000, active=0
> > > > >                lookup=0, matched=0
> > > > > ...
> > > > >
> > > > > I JUST CAN'T GET RID OF the ACTIVE_COUNT of 10!!! in dump-tables
> > output:
> > > >
> > > > Why are you so fixated on this?
> > > >
> >

From blp at nicira.com  Tue Feb  3 18:06:57 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 18:06:57 -0800
Subject: [ovs-discuss] patch does not work
In-Reply-To: <CABFtFw=P1=ciuomKYsaj4pJG=MK5_TgCZtvr+HDogQJreTwrPQ@mail.gmail.com>
References: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
 <20150203163801.GB18144@nicira.com>
 <CABFtFwmiK-B6Oqd+ZTZ2O=2xX098Rwykq36zn7sQDa_MnBSERw@mail.gmail.com>
 <20150204014518.GD12628@nicira.com>
 <CABFtFw=P1=ciuomKYsaj4pJG=MK5_TgCZtvr+HDogQJreTwrPQ@mail.gmail.com>
Message-ID: <20150204020657.GA17187@nicira.com>

What URL are you viewing and, when you're there, where are you clicking?

On Tue, Feb 03, 2015 at 06:01:23PM -0800, Ashok Chippa wrote:
> When I tried to download from openvswitch.org, clicking on the link there
> says v1.1.0!!!
> 
> On Tue, Feb 3, 2015 at 5:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Where did you get the master tarball, and where does it say v1.1.0?
> >
> > On Tue, Feb 03, 2015 at 05:22:12PM -0800, Ashok Chippa wrote:
> > > That's all I wanted to know. I assumed it was for 2.3.0 (since I remember
> > > mentioning I was working with 2.3.0). It obviously failed cause I tried
> > to
> > > patch it to 2.3.0. Hence the hunk failures and ... I modified the patch
> > so
> > > it could be patched to 2.3.0 and compiled and reinstalled... However, I
> > > still see the bug... In any case, I'll move to master.... Any idea why
> > > master tarball says v1.1.0? I'd think master is the latest (later than
> > > 2.3.1)...
> > >
> > > On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Mon, Feb 02, 2015 at 11:19:58PM -0800, Ashok Chippa wrote:
> > > > > Can someone please help?... I AM BLOCKED ON THIS... One hunk has
> > failed
> > > > and
> > > > > I shared that with you. The code base I have (2.3.0) seems to have
> > > > changed
> > > > > significantly where I cannot find a place to add these 4 lines:
> > > >
> > > > The patch I provided is not for 2.3.0, it is for master.
> > > >
> >

From a.n.chippa at gmail.com  Tue Feb  3 18:26:59 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 18:26:59 -0800
Subject: [ovs-discuss] PATCH does not work
In-Reply-To: <20150204020455.GE12628@nicira.com>
References: <CABFtFwmdreK_PrfqvqK5MB=-aOwZTkcswR0=D0GftFOJF__y3w@mail.gmail.com>
 <20150203163827.GC18144@nicira.com>
 <CABFtFwmq_HS01srWbJh7zpJtPgeMkcbv52sKo68Gijax1cQ9Bg@mail.gmail.com>
 <20150204014430.GC12628@nicira.com>
 <CABFtFwkA6TmgdfPygk5f3wOi_WzYTofhFDkGYOFxRgP9yQa7mQ@mail.gmail.com>
 <20150204020455.GE12628@nicira.com>
Message-ID: <CABFtFwmgZQ+pneQJxoXCxGn55KLZkuuQwTuZeMTgaFFJG83Q3Q@mail.gmail.com>

Yes, I think so:

1> ovs-dpctl show:
-------------------------
root at ashok-vb:/home/achippa/dispatcher# ovs-dpctl show
system at ovs-system:
    lookups: hit:266 missed:102 lost:0
    flows: 0
    masks: hit:368 total:0 hit/pkt:1.00
    port 0: ovs-system (internal)
    port 1: br-int (internal)
    port 2: br-infra (internal)
    port 3: e919404747fd4_l
    port 4: dc2911ce73d24_l

2> ovs-vsctl show
------------------------
root at ashok-vb:/home/achippa/dispatcher# ovs-vsctl show
c9b867af-0ad5-4fd3-9fb1-23d7ba502d45
    Bridge br-int
        Controller "tcp:127.0.0.1:6789"
        Port "e919404747fd4_l"                      <<<<=========
            Interface "e919404747fd4_l"
        Port "a7c9a04d2ba94_l"
            Interface "a7c9a04d2ba94_l"
        Port br-int
            Interface br-int
                type: internal
        Port "dc2911ce73d24_l"                       <<<<=========
            Interface "dc2911ce73d24_l"
        Port "a009c241a81a4_l"
            Interface "a009c241a81a4_l"
        Port "3e9561b5aa544_l"
            Interface "3e9561b5aa544_l"
        Port "182ea9813d2c4_l"
            Interface "182ea9813d2c4_l"
        Port "ce56c08d18284_l"
            Interface "ce56c08d18284_l"
        Port "faabb5c229ba4_l"
            Interface "faabb5c229ba4_l"
        Port "c0042f784cce4_l"
            Interface "c0042f784cce4_l"
        Port "373aebf54bc54_l"
            Interface "373aebf54bc54_l"
        Port "b30f5aec2e6b4_l"
            Interface "b30f5aec2e6b4_l"
        Port "cb1dcd2663064_l"
            Interface "cb1dcd2663064_l"
        Port "c4d07647bc584_l"
            Interface "c4d07647bc584_l"
        Port "8c73d3f53c944_l"
            Interface "8c73d3f53c944_l"
        Port "892d9bbb06604_l"
            Interface "892d9bbb06604_l"
        Port "a8038586da2e4_l"
            Interface "a8038586da2e4_l"
    Bridge br-infra
        Port br-infra
            Interface br-infra
                type: internal

 3> ovs-ofctl dump-flows
---------------------------------

root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl dump-flows br-int
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=1539.357s, table=0, n_packets=0, n_bytes=0,
idle_age=1539, priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2 actions=drop

4> ifconfig

root at ashok-vb:/home/achippa/dispatcher# ifconfig
dc2911ce73d24_l Link encap:Ethernet  HWaddr 5a:b2:8d:45:4a:98
<<<<===== connected to container 1
          inet6 addr: fe80::58b2:8dff:fe45:4a98/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:186 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6553 errors:0 dropped:1 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:17248 (17.2 KB)  TX bytes:1194740 (1.1 MB)

docker0   Link encap:Ethernet  HWaddr 56:84:7a:fe:97:99
          inet addr:172.17.42.1  Bcast:0.0.0.0  Mask:255.255.0.0
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

e919404747fd4_l Link encap:Ethernet  HWaddr 02:5e:07:ed:8f:7b
<<<<===== connected to container 2
          inet6 addr: fe80::5e:7ff:feed:8f7b/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:187 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6523 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:17326 (17.3 KB)  TX bytes:1186709 (1.1 MB)

eth0      Link encap:Ethernet  HWaddr 08:00:27:4c:76:66
          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0
          inet6 addr: fe80::a00:27ff:fe4c:7666/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:7213 errors:0 dropped:0 overruns:0 frame:0
          TX packets:7842 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:3694882 (3.6 MB)  TX bytes:1077004 (1.0 MB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:11700 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11700 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:883683 (883.6 KB)  TX bytes:883683 (883.6 KB)

virbr0    Link encap:Ethernet  HWaddr ee:b4:2d:cc:7b:b9
          inet addr:192.168.122.1  Bcast:192.168.122.255  Mask:255.255.255.0
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)


5> docker container 1 ifconfig
----------------------------------------

root at c643cbf36aee:/# ifconfig
lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

veth0     Link encap:Ethernet  HWaddr ba:f9:6e:e6:67:82
          inet addr:1.1.1.1  Bcast:0.0.0.0  Mask:255.255.255.0
          inet6 addr: fe80::b8f9:6eff:fee6:6782/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:6616 errors:0 dropped:0 overruns:0 frame:0
          TX packets:187 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1204150 (1.2 MB)  TX bytes:17326 (17.3 KB)

6> docker container 2 ifconfig
----------------------------------------

root at f3035fbd1a05:/# ifconfig
lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:6 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:504 (504.0 B)  TX bytes:504 (504.0 B)

veth0     Link encap:Ethernet  HWaddr da:2d:83:97:03:e0
          inet addr:1.1.1.2  Bcast:0.0.0.0  Mask:255.255.255.0
          inet6 addr: fe80::d82d:83ff:fe97:3e0/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:6688 errors:0 dropped:2 overruns:0 frame:0
          TX packets:186 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1219650 (1.2 MB)  TX bytes:17248 (17.2 KB)

BTW, a few weeks ago, this was working... In all fairness to openvswitch, I
do need to confess that I did patch in a third-party DPI changes to OVS...
not sure if that broke it...

On Tue, Feb 3, 2015 at 6:04 PM, Ben Pfaff <blp at nicira.com> wrote:

> Are the packets going through your bridge at all?  What do "ovs-dpctl
> show" and "ovs-vsctl show" print?  How about "ifconfig"?
>
> On Tue, Feb 03, 2015 at 06:00:35PM -0800, Ashok Chippa wrote:
> > Okay, here it is: I added a flow as shown below, and I expect the ping
> from
> > 1.1.1.1 to 1.1.1.2 to not work... But the ping goes through... it is not
> > hitting the flow I added, and I cannot tell which flow it is hitting...
> as
> > dump-flows shows only one flow... BTW, dump-tables shows -ve count (there
> > is a bug there, even though it is not critical)... I'm sure you have
> bigger
> > fish to fry... :)    Please see steps 1 through 4 below:
> >
> > 1> ADD FLOW
> > --------------------
> >
> > root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl add-flow br-int
> > table=0,priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2,actions=drop
> > root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl dump-flows br-int
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=8.242s, table=0, n_packets=0, n_bytes=0,
> idle_age=8,
> > priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2 actions=drop
> >
> > 2> PING from 1.1.1.1 to 1.1.1.2
> > ------------------------------------------
> >
> > root at c643cbf36aee:/# !ping
> > ping -c 7 1.1.1.2
> > PING 1.1.1.2 (1.1.1.2) 56(84) bytes of data.
> > 64 bytes from 1.1.1.2: icmp_seq=1 ttl=64 time=0.380 ms
> > 64 bytes from 1.1.1.2: icmp_seq=2 ttl=64 time=0.060 ms
> > 64 bytes from 1.1.1.2: icmp_seq=3 ttl=64 time=0.110 ms
> > 64 bytes from 1.1.1.2: icmp_seq=4 ttl=64 time=0.156 ms
> > 64 bytes from 1.1.1.2: icmp_seq=5 ttl=64 time=0.094 ms
> > 64 bytes from 1.1.1.2: icmp_seq=6 ttl=64 time=0.063 ms
> > 64 bytes from 1.1.1.2: icmp_seq=7 ttl=64 time=0.078 ms
> >
> > --- 1.1.1.2 ping statistics ---
> > 7 packets transmitted, 7 received, 0% packet loss, time 5999ms
> > rtt min/avg/max/mdev = 0.060/0.134/0.380/0.105 ms
> >
> > 3> TCPDUMP on the interface(s) connected to 1.1.1.1 or 1.1.1.2
> >
> --------------------------------------------------------------------------------------
> >
> > root at ashok-vb:/home/achippa/dispatcher# tcpdump -i dc2911ce73d24_l
> > tcpdump: WARNING: dc2911ce73d24_l: no IPv4 address assigned
> > tcpdump: verbose output suppressed, use -v or -vv for full protocol
> decode
> > listening on dc2911ce73d24_l, link-type EN10MB (Ethernet), capture size
> > 65535 bytes
> > 17:52:32.682083 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 1,
> > length 64
> > 17:52:32.682111 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 1,
> length
> > 64
> > 17:52:33.681082 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 2,
> > length 64
> > 17:52:33.681105 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 2,
> length
> > 64
> > 17:52:34.679962 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 3,
> > length 64
> > 17:52:34.679990 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 3,
> length
> > 64
> > 17:52:35.679419 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 4,
> > length 64
> > 17:52:35.679449 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 4,
> length
> > 64
> > 17:52:36.678597 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 5,
> > length 64
> > 17:52:36.678624 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 5,
> length
> > 64
> > 17:52:37.679530 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 6,
> > length 64
> > 17:52:37.679561 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 6,
> length
> > 64
> > 17:52:37.682449 ARP, Request who-has 1.1.1.1 tell 1.1.1.2, length 28
> > 17:52:37.682796 ARP, Reply 1.1.1.1 is-at ba:f9:6e:e6:67:82 (oui Unknown),
> > length 28
> > 17:52:38.678662 IP 1.1.1.1 > 1.1.1.2: ICMP echo request, id 37, seq 7,
> > length 64
> > 17:52:38.678703 IP 1.1.1.2 > 1.1.1.1: ICMP echo reply, id 37, seq 7,
> length
> > 64
> >
> > 4> n_packets is 0 on the flow I added
> > -------------------------------------------------
> >
> > root at ashok-vb:/home/achippa/dispatcher# ovs-ofctl dump-flows br-int
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=387.380s, table=0, n_packets=0, n_bytes=0,
> > idle_age=387, priority=9999,icmp,nw_src=1.1.1.1,nw_dst=1.1.1.2
> actions=drop
> >
> > You can see, the rule was not hit... which rule is allowing it to go
> > through? I can't see with any cli command...
> >
> >
> > On Tue, Feb 3, 2015 at 5:44 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > So what does all the SHOUTING CAPITAL LETTERS and "THIS IS A BLOCKER
> FOR
> > > ME" come from?  It sounds like it's not a blocker for you at all,
> you're
> > > just fixated on it.
> > >
> > > On Tue, Feb 03, 2015 at 05:30:41PM -0800, Ashok Chippa wrote:
> > > > It's not actually this I seem to be fixated on... I just want to
> start
> > > over
> > > > (with 0 flows) and add some flows and see them take effect... which
> this
> > > > bug seems to be preventing me...or so I think, I could be wrong... My
> > > > packets seem to be hitting a flow that I am not able to see... Keep
> in
> > > > mind, I'm still learning... Even after deleting the flows, this
> count is
> > > > persistent... so I think the bookkeeping is wrong somewhere... not a
> > > > critical bug for sure, as long as it does not prevent normal
> functions
> > > from
> > > > working...
> > > >
> > > > On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > On Tue, Feb 03, 2015 at 12:06:43AM -0800, Ashok Chippa wrote:
> > > > > > Compiled the patch in and re-installed the .ko:
> > > > > >
> > > > > > STILL SEE THIS:
> > > > > >
> > > > > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl
> del-flows
> > > > > br-int
> > > > > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl
> dump-flows
> > > > > br-int
> > > > > > NXST_FLOW reply (xid=0x4):
> > > > > > root at ashok-vb:/home/achippa/openvswitch-2.3.0# ovs-ofctl
> dump-tables
> > > > > br-int
> > > > > > OFPST_TABLE reply (xid=0x2): 254 tables
> > > > > >   0: classifier: wild=0x3fffff, max=1000000, active=10
> > >  <<<<============
> > > > > > STILL!!!
> > > > > >                lookup=0, matched=0
> > > > > >   1: table1  : wild=0x3fffff, max=1000000, active=0
> > > > > >                lookup=0, matched=0
> > > > > > ...
> > > > > >
> > > > > > I JUST CAN'T GET RID OF the ACTIVE_COUNT of 10!!! in dump-tables
> > > output:
> > > > >
> > > > > Why are you so fixated on this?
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/8b042f2c/attachment-0001.html>

From a.n.chippa at gmail.com  Tue Feb  3 18:32:28 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Tue, 3 Feb 2015 18:32:28 -0800
Subject: [ovs-discuss] patch does not work
In-Reply-To: <20150204020657.GA17187@nicira.com>
References: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
 <20150203163801.GB18144@nicira.com>
 <CABFtFwmiK-B6Oqd+ZTZ2O=2xX098Rwykq36zn7sQDa_MnBSERw@mail.gmail.com>
 <20150204014518.GD12628@nicira.com>
 <CABFtFw=P1=ciuomKYsaj4pJG=MK5_TgCZtvr+HDogQJreTwrPQ@mail.gmail.com>
 <20150204020657.GA17187@nicira.com>
Message-ID: <CABFtFwn70auCM=ufiCgXO2XA1o-6BBkNkCoc+34+ZiyhSa92Lw@mail.gmail.com>

www.openvswitch.org/download/

Clicking on link https://github.com/openvswitch/ovs/tarball/master a window
pops up that says:

You have chosen to open:

openvswitch-ovs-v1.1.0pre2-7913-gec97c2d.tar.gz


On Tue, Feb 3, 2015 at 6:06 PM, Ben Pfaff <blp at nicira.com> wrote:

> What URL are you viewing and, when you're there, where are you clicking?
>
> On Tue, Feb 03, 2015 at 06:01:23PM -0800, Ashok Chippa wrote:
> > When I tried to download from openvswitch.org, clicking on the link
> there
> > says v1.1.0!!!
> >
> > On Tue, Feb 3, 2015 at 5:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > Where did you get the master tarball, and where does it say v1.1.0?
> > >
> > > On Tue, Feb 03, 2015 at 05:22:12PM -0800, Ashok Chippa wrote:
> > > > That's all I wanted to know. I assumed it was for 2.3.0 (since I
> remember
> > > > mentioning I was working with 2.3.0). It obviously failed cause I
> tried
> > > to
> > > > patch it to 2.3.0. Hence the hunk failures and ... I modified the
> patch
> > > so
> > > > it could be patched to 2.3.0 and compiled and reinstalled...
> However, I
> > > > still see the bug... In any case, I'll move to master.... Any idea
> why
> > > > master tarball says v1.1.0? I'd think master is the latest (later
> than
> > > > 2.3.1)...
> > > >
> > > > On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > On Mon, Feb 02, 2015 at 11:19:58PM -0800, Ashok Chippa wrote:
> > > > > > Can someone please help?... I AM BLOCKED ON THIS... One hunk has
> > > failed
> > > > > and
> > > > > > I shared that with you. The code base I have (2.3.0) seems to
> have
> > > > > changed
> > > > > > significantly where I cannot find a place to add these 4 lines:
> > > > >
> > > > > The patch I provided is not for 2.3.0, it is for master.
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150203/71642d39/attachment.html>

From jesse at nicira.com  Tue Feb  3 19:50:26 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 3 Feb 2015 19:50:26 -0800
Subject: [ovs-discuss] [ovs-dev]  Open vSwitch STT support
In-Reply-To: <CAJK4cL1EU7w3niUak1NqhtFPBkekOi1igKSXCbUmYhpCnRTMKQ@mail.gmail.com>
References: <CAJK4cL0uwieXdpC79CMZbPzHez0uH-cneyz+eODtoHNyTbkHWw@mail.gmail.com>
 <20150203164537.GF18144@nicira.com>
 <CAJK4cL1EU7w3niUak1NqhtFPBkekOi1igKSXCbUmYhpCnRTMKQ@mail.gmail.com>
Message-ID: <CAEP_g=_mBCK=x+pvy7hca9u+rb7WFDEmSRDWtRgLAAn9-x8cmw@mail.gmail.com>

Userspace code is generally licensed under Apache 2 but I don't think
anyone has proposed such patches to date.

On Tue, Feb 3, 2015 at 6:07 PM, John Xiao <johnxiao.cloud at gmail.com> wrote:
> Thanks Ben!
>
> For user space tunneling patches, I guess they will be under Apache
> License 2 which also means the patent licenses will be granted by the
> patches distributor/patent holder (i.e. Nicira).
>
> On Wed, Feb 4, 2015 at 12:45 AM, Ben Pfaff <blp at nicira.com> wrote:
>> On Tue, Feb 03, 2015 at 12:12:41PM +0800, John Xiao wrote:
>>> One question on STT IP, is it free to use STT in commercial products?
>>> I believe Nicira has patents on this.
>>
>> Assuming that Nicira does, the patches are being offered by the patent
>> holder under GPLv2, see http://en.swpat.org/wiki/GPLv2_and_patents.
> _______________________________________________
> dev mailing list
> dev at openvswitch.org
> http://openvswitch.org/mailman/listinfo/dev

From jesse at nicira.com  Tue Feb  3 20:18:40 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 3 Feb 2015 20:18:40 -0800
Subject: [ovs-discuss] [ovs-dev]  Open vSwitch STT support
In-Reply-To: <CAJK4cL1sbWwrbOu1H_u3sZJ2jZmRyqHZbOnzeC8XYwZOP-9gCA@mail.gmail.com>
References: <CAJK4cL0uwieXdpC79CMZbPzHez0uH-cneyz+eODtoHNyTbkHWw@mail.gmail.com>
 <20150203164537.GF18144@nicira.com>
 <CAJK4cL1EU7w3niUak1NqhtFPBkekOi1igKSXCbUmYhpCnRTMKQ@mail.gmail.com>
 <CAEP_g=_mBCK=x+pvy7hca9u+rb7WFDEmSRDWtRgLAAn9-x8cmw@mail.gmail.com>
 <CAJK4cL1sbWwrbOu1H_u3sZJ2jZmRyqHZbOnzeC8XYwZOP-9gCA@mail.gmail.com>
Message-ID: <CAEP_g=9r73naPKK1ii1+sh3wRhHQ+URjGpdOt5FFOaW4c7qogg@mail.gmail.com>

I think he just meant the pieces to configure the kernel implementation.

Realistically, nobody on this list is going to be able to give you a
legal opinion. You should talk to a lawyer to determine your rights as
far as patents go.

On Tue, Feb 3, 2015 at 8:11 PM, John Xiao <johnxiao.cloud at gmail.com> wrote:
> Thanks Jesse!
>
> That's true that there is no such patch yet.
> Pravin just mentioned "I will send out OVS userspace patch on ovs-dev
> mailing list." in
> http://marc.info/?l=linux-netdev&m=142257416618642&w=2
>
> On Wed, Feb 4, 2015 at 11:50 AM, Jesse Gross <jesse at nicira.com> wrote:
>> Userspace code is generally licensed under Apache 2 but I don't think
>> anyone has proposed such patches to date.
>>
>> On Tue, Feb 3, 2015 at 6:07 PM, John Xiao <johnxiao.cloud at gmail.com> wrote:
>>> Thanks Ben!
>>>
>>> For user space tunneling patches, I guess they will be under Apache
>>> License 2 which also means the patent licenses will be granted by the
>>> patches distributor/patent holder (i.e. Nicira).
>>>
>>> On Wed, Feb 4, 2015 at 12:45 AM, Ben Pfaff <blp at nicira.com> wrote:
>>>> On Tue, Feb 03, 2015 at 12:12:41PM +0800, John Xiao wrote:
>>>>> One question on STT IP, is it free to use STT in commercial products?
>>>>> I believe Nicira has patents on this.
>>>>
>>>> Assuming that Nicira does, the patches are being offered by the patent
>>>> holder under GPLv2, see http://en.swpat.org/wiki/GPLv2_and_patents.
>>> _______________________________________________
>>> dev mailing list
>>> dev at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/dev

From blp at nicira.com  Tue Feb  3 21:41:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 21:41:44 -0800
Subject: [ovs-discuss] patch does not work
In-Reply-To: <CABFtFwn70auCM=ufiCgXO2XA1o-6BBkNkCoc+34+ZiyhSa92Lw@mail.gmail.com>
References: <CABFtFwkO0aQV=hTq7bZYnbt4JQZhRZiCQHkJ=zLLq2hssrKJ6g@mail.gmail.com>
 <20150203163801.GB18144@nicira.com>
 <CABFtFwmiK-B6Oqd+ZTZ2O=2xX098Rwykq36zn7sQDa_MnBSERw@mail.gmail.com>
 <20150204014518.GD12628@nicira.com>
 <CABFtFw=P1=ciuomKYsaj4pJG=MK5_TgCZtvr+HDogQJreTwrPQ@mail.gmail.com>
 <20150204020657.GA17187@nicira.com>
 <CABFtFwn70auCM=ufiCgXO2XA1o-6BBkNkCoc+34+ZiyhSa92Lw@mail.gmail.com>
Message-ID: <20150204054144.GA19349@nicira.com>

OK, that naming is a side effect of how we've done releases, with tags
on branches instead of on master.  It doesn't indicate that you're
downloading version 1.1.  The final part of the name indicates the Git
commit number (ec97c2d), which you can use to verify what commit you're
getting.

On Tue, Feb 03, 2015 at 06:32:28PM -0800, Ashok Chippa wrote:
> www.openvswitch.org/download/
> 
> Clicking on link https://github.com/openvswitch/ovs/tarball/master a window
> pops up that says:
> 
> You have chosen to open:
> 
> openvswitch-ovs-v1.1.0pre2-7913-gec97c2d.tar.gz
> 
> 
> On Tue, Feb 3, 2015 at 6:06 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > What URL are you viewing and, when you're there, where are you clicking?
> >
> > On Tue, Feb 03, 2015 at 06:01:23PM -0800, Ashok Chippa wrote:
> > > When I tried to download from openvswitch.org, clicking on the link
> > there
> > > says v1.1.0!!!
> > >
> > > On Tue, Feb 3, 2015 at 5:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > Where did you get the master tarball, and where does it say v1.1.0?
> > > >
> > > > On Tue, Feb 03, 2015 at 05:22:12PM -0800, Ashok Chippa wrote:
> > > > > That's all I wanted to know. I assumed it was for 2.3.0 (since I
> > remember
> > > > > mentioning I was working with 2.3.0). It obviously failed cause I
> > tried
> > > > to
> > > > > patch it to 2.3.0. Hence the hunk failures and ... I modified the
> > patch
> > > > so
> > > > > it could be patched to 2.3.0 and compiled and reinstalled...
> > However, I
> > > > > still see the bug... In any case, I'll move to master.... Any idea
> > why
> > > > > master tarball says v1.1.0? I'd think master is the latest (later
> > than
> > > > > 2.3.1)...
> > > > >
> > > > > On Tue, Feb 3, 2015 at 8:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > > >
> > > > > > On Mon, Feb 02, 2015 at 11:19:58PM -0800, Ashok Chippa wrote:
> > > > > > > Can someone please help?... I AM BLOCKED ON THIS... One hunk has
> > > > failed
> > > > > > and
> > > > > > > I shared that with you. The code base I have (2.3.0) seems to
> > have
> > > > > > changed
> > > > > > > significantly where I cannot find a place to add these 4 lines:
> > > > > >
> > > > > > The patch I provided is not for 2.3.0, it is for master.
> > > > > >
> > > >
> >

From blp at nicira.com  Tue Feb  3 21:59:07 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Feb 2015 21:59:07 -0800
Subject: [ovs-discuss] OVS-controller crashing on enabling SSL on
 Mininet Environment
In-Reply-To: <CACHK9BG9tfx3m1guJpxhpw_EY-MzurNGGA0ziYxKFVLWfUaG7A@mail.gmail.com>
References: <CACHK9BGp9Pan6mY=NS3n5zgOy_LR_CX-gBnenGqhumKEeJTWoQ@mail.gmail.com>
 <20150203185907.GN18144@nicira.com>
 <CACHK9BG9tfx3m1guJpxhpw_EY-MzurNGGA0ziYxKFVLWfUaG7A@mail.gmail.com>
Message-ID: <20150204055907.GB19349@nicira.com>

What version of OVS is this?

On Tue, Feb 03, 2015 at 09:48:13PM -0800, Ruchika Verma wrote:
> hi Ben,
> 
> please find the backtrace attached.
> 
> Regards
> Ruchika​
>  error_ssl.txt
> <https://docs.google.com/file/d/0B7Bgk_t_PzaGQlF3eklQQjN3NGM/edit?usp=drive_web>
> ​
> 
> On Tue, Feb 3, 2015 at 10:59 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Tue, Feb 03, 2015 at 12:07:02PM +0530, Ruchika Verma wrote:
> > > hi,
> > >
> > > I am running ovs-controller with SSL enabled option using command -
> > >
> > >     sudo ovs-controller -v pssl:6633  -p /mininet/mininet/ctl-privkey.pem
> > > -c /mininet/mininet/ctl-cert.pem -C
> > > /var/lib/openvswitch/pki/switchca/cacert.pem
> > >
> > > I have enabled BOOTSTRAP option at switch through -
> > >
> > > ovs-vsctl -- --bootstrap set-ssl /mininet/mininet/sc-privkey.pem
> > > /mininet/mininet/sc-cert.pem /etc/openvswitch/cacert.pem
> > >
> > > the keys and certificates are generated as -
> > >
> > > sudo ovs-pki req+sign ctl controller
> > > sudo ovs-pki req+sign sc switch
> > >
> > > Now when i create the OpenVSwitch in virtual environment (on mininet),
> > > using command -
> > >
> > > sudo mn --topo=linear,1 --controller=remote
> > >
> > > I get following error and OVS-Controller crashes after sometime. On
> > mininet
> > > window however the topology is created successfully.
> >
> > What version of OVS is this?
> >
> > Can you provide a backtrace for the crash?
> >

From v.tolstov at selfip.ru  Tue Feb  3 23:04:01 2015
From: v.tolstov at selfip.ru (Vasiliy Tolstov)
Date: Wed, 4 Feb 2015 11:04:01 +0400
Subject: [ovs-discuss] Open vSwitch STT support
In-Reply-To: <CALnjE+pDG8G1=g-rJHpcn324X4nz8Pi9PthnMiz63mYbJx2yYA@mail.gmail.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
 <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
 <20150203181956.GA9500@tuxdriver.com>
 <CALnjE+pDG8G1=g-rJHpcn324X4nz8Pi9PthnMiz63mYbJx2yYA@mail.gmail.com>
Message-ID: <CACaajQveYidWC5KOrQr1LM3-pGoDV4LFi4BDLnDO=VFBV-WzCA@mail.gmail.com>

2015-02-03 22:27 GMT+03:00 Pravin Shelar <pshelar at nicira.com>:

> I do not have any plans of pushing STT to upstream kernel. I do not
> think increased STT usage will help us getting STT upstream in future.
> STT is useful tunneling protocol regardless of whether it is upstream
> or not and that is motivation of merging it to OVS repo.
>

Does it possible to add to readme test results posted in mailing list about
vxlan and stt and do this tests also (on the same hardware) for gre, listp,
geneve?


-- 
Vasiliy Tolstov,
e-mail: v.tolstov at selfip.ru
jabber: vase at selfip.ru
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150204/a2008d02/attachment.html>

From johnxiao.cloud at gmail.com  Tue Feb  3 18:07:54 2015
From: johnxiao.cloud at gmail.com (John Xiao)
Date: Wed, 4 Feb 2015 10:07:54 +0800
Subject: [ovs-discuss] [ovs-dev]  Open vSwitch STT support
In-Reply-To: <20150203164537.GF18144@nicira.com>
References: <CAJK4cL0uwieXdpC79CMZbPzHez0uH-cneyz+eODtoHNyTbkHWw@mail.gmail.com>
 <20150203164537.GF18144@nicira.com>
Message-ID: <CAJK4cL1EU7w3niUak1NqhtFPBkekOi1igKSXCbUmYhpCnRTMKQ@mail.gmail.com>

Thanks Ben!

For user space tunneling patches, I guess they will be under Apache
License 2 which also means the patent licenses will be granted by the
patches distributor/patent holder (i.e. Nicira).

On Wed, Feb 4, 2015 at 12:45 AM, Ben Pfaff <blp at nicira.com> wrote:
> On Tue, Feb 03, 2015 at 12:12:41PM +0800, John Xiao wrote:
>> One question on STT IP, is it free to use STT in commercial products?
>> I believe Nicira has patents on this.
>
> Assuming that Nicira does, the patches are being offered by the patent
> holder under GPLv2, see http://en.swpat.org/wiki/GPLv2_and_patents.

From johnxiao.cloud at gmail.com  Tue Feb  3 20:11:15 2015
From: johnxiao.cloud at gmail.com (John Xiao)
Date: Wed, 4 Feb 2015 12:11:15 +0800
Subject: [ovs-discuss] [ovs-dev]  Open vSwitch STT support
In-Reply-To: <CAEP_g=_mBCK=x+pvy7hca9u+rb7WFDEmSRDWtRgLAAn9-x8cmw@mail.gmail.com>
References: <CAJK4cL0uwieXdpC79CMZbPzHez0uH-cneyz+eODtoHNyTbkHWw@mail.gmail.com>
 <20150203164537.GF18144@nicira.com>
 <CAJK4cL1EU7w3niUak1NqhtFPBkekOi1igKSXCbUmYhpCnRTMKQ@mail.gmail.com>
 <CAEP_g=_mBCK=x+pvy7hca9u+rb7WFDEmSRDWtRgLAAn9-x8cmw@mail.gmail.com>
Message-ID: <CAJK4cL1sbWwrbOu1H_u3sZJ2jZmRyqHZbOnzeC8XYwZOP-9gCA@mail.gmail.com>

Thanks Jesse!

That's true that there is no such patch yet.
Pravin just mentioned "I will send out OVS userspace patch on ovs-dev
mailing list." in
http://marc.info/?l=linux-netdev&m=142257416618642&w=2

On Wed, Feb 4, 2015 at 11:50 AM, Jesse Gross <jesse at nicira.com> wrote:
> Userspace code is generally licensed under Apache 2 but I don't think
> anyone has proposed such patches to date.
>
> On Tue, Feb 3, 2015 at 6:07 PM, John Xiao <johnxiao.cloud at gmail.com> wrote:
>> Thanks Ben!
>>
>> For user space tunneling patches, I guess they will be under Apache
>> License 2 which also means the patent licenses will be granted by the
>> patches distributor/patent holder (i.e. Nicira).
>>
>> On Wed, Feb 4, 2015 at 12:45 AM, Ben Pfaff <blp at nicira.com> wrote:
>>> On Tue, Feb 03, 2015 at 12:12:41PM +0800, John Xiao wrote:
>>>> One question on STT IP, is it free to use STT in commercial products?
>>>> I believe Nicira has patents on this.
>>>
>>> Assuming that Nicira does, the patches are being offered by the patent
>>> holder under GPLv2, see http://en.swpat.org/wiki/GPLv2_and_patents.
>> _______________________________________________
>> dev mailing list
>> dev at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/dev

From johnxiao.cloud at gmail.com  Tue Feb  3 20:22:37 2015
From: johnxiao.cloud at gmail.com (John Xiao)
Date: Wed, 4 Feb 2015 12:22:37 +0800
Subject: [ovs-discuss] [ovs-dev]  Open vSwitch STT support
In-Reply-To: <CAEP_g=9r73naPKK1ii1+sh3wRhHQ+URjGpdOt5FFOaW4c7qogg@mail.gmail.com>
References: <CAJK4cL0uwieXdpC79CMZbPzHez0uH-cneyz+eODtoHNyTbkHWw@mail.gmail.com>
 <20150203164537.GF18144@nicira.com>
 <CAJK4cL1EU7w3niUak1NqhtFPBkekOi1igKSXCbUmYhpCnRTMKQ@mail.gmail.com>
 <CAEP_g=_mBCK=x+pvy7hca9u+rb7WFDEmSRDWtRgLAAn9-x8cmw@mail.gmail.com>
 <CAJK4cL1sbWwrbOu1H_u3sZJ2jZmRyqHZbOnzeC8XYwZOP-9gCA@mail.gmail.com>
 <CAEP_g=9r73naPKK1ii1+sh3wRhHQ+URjGpdOt5FFOaW4c7qogg@mail.gmail.com>
Message-ID: <CAJK4cL2rbC4DJQt1nSmtTcxvO+e2g+eiKw5dAVzTGJPE3-SgNg@mail.gmail.com>

Thanks Jesse. Sorry I misunderstood that.

On Wed, Feb 4, 2015 at 12:18 PM, Jesse Gross <jesse at nicira.com> wrote:
> I think he just meant the pieces to configure the kernel implementation.
>
> Realistically, nobody on this list is going to be able to give you a
> legal opinion. You should talk to a lawyer to determine your rights as
> far as patents go.
>
> On Tue, Feb 3, 2015 at 8:11 PM, John Xiao <johnxiao.cloud at gmail.com> wrote:
>> Thanks Jesse!
>>
>> That's true that there is no such patch yet.
>> Pravin just mentioned "I will send out OVS userspace patch on ovs-dev
>> mailing list." in
>> http://marc.info/?l=linux-netdev&m=142257416618642&w=2
>>
>> On Wed, Feb 4, 2015 at 11:50 AM, Jesse Gross <jesse at nicira.com> wrote:
>>> Userspace code is generally licensed under Apache 2 but I don't think
>>> anyone has proposed such patches to date.
>>>
>>> On Tue, Feb 3, 2015 at 6:07 PM, John Xiao <johnxiao.cloud at gmail.com> wrote:
>>>> Thanks Ben!
>>>>
>>>> For user space tunneling patches, I guess they will be under Apache
>>>> License 2 which also means the patent licenses will be granted by the
>>>> patches distributor/patent holder (i.e. Nicira).
>>>>
>>>> On Wed, Feb 4, 2015 at 12:45 AM, Ben Pfaff <blp at nicira.com> wrote:
>>>>> On Tue, Feb 03, 2015 at 12:12:41PM +0800, John Xiao wrote:
>>>>>> One question on STT IP, is it free to use STT in commercial products?
>>>>>> I believe Nicira has patents on this.
>>>>>
>>>>> Assuming that Nicira does, the patches are being offered by the patent
>>>>> holder under GPLv2, see http://en.swpat.org/wiki/GPLv2_and_patents.
>>>> _______________________________________________
>>>> dev mailing list
>>>> dev at openvswitch.org
>>>> http://openvswitch.org/mailman/listinfo/dev

From 15116983550 at qq.com  Wed Feb  4 08:39:03 2015
From: 15116983550 at qq.com (=?gb18030?B?wO6zyg==?=)
Date: Thu, 5 Feb 2015 00:39:03 +0800
Subject: [ovs-discuss] ovs does not work when running mininet.
Message-ID: <tencent_1C1317E90866EE3331D0143E@qq.com>

Hi all,
     I use mininet to run some easy topo with loop, and my OVS version is 2.3.1.
     I set OVS's OF version as 1.3, but several seconds ago, It just does not work at all. I use pingall to test it, but controller can't get anything, while no flow table in switch and ping failure.
     I try to reset OVS's OF version as OF13. Sometimes I works, but sometimes does not.
     Why?  BTW, if switch and controller's version is not matched, it seems like that OVS do not send the version error message to controller. It confuse me. It really works at OVS2.1.1.
     
     Thank you for your time.


------------------
Li Cheng 李呈_____________________________________________________
School of Information and Communication Engineering
Beijing University of Posts and Telecommunications
Beijing 100876, PR China

北京邮电大学·信息与通信工程学院·通信工程
_____________________________________________________
Mobile Phone: 
(+86) 151-1698-3550 Beijing 
E-mail:
350959853 at qq.com
licheng185408 at gmail.com
Homepage:
http://www.muzixing.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150205/5e7241f9/attachment-0001.html>

From blp at nicira.com  Wed Feb  4 09:55:47 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Feb 2015 09:55:47 -0800
Subject: [ovs-discuss] OVS-controller crashing on enabling SSL on
 Mininet Environment
In-Reply-To: <CACHK9BGpbATheFSZw8c4Nr_Jwc53XT6FvjK4_L4B=OYeW4dksA@mail.gmail.com>
References: <CACHK9BGp9Pan6mY=NS3n5zgOy_LR_CX-gBnenGqhumKEeJTWoQ@mail.gmail.com>
 <20150203185907.GN18144@nicira.com>
 <CACHK9BG9tfx3m1guJpxhpw_EY-MzurNGGA0ziYxKFVLWfUaG7A@mail.gmail.com>
 <20150204055907.GB19349@nicira.com>
 <CACHK9BGpbATheFSZw8c4Nr_Jwc53XT6FvjK4_L4B=OYeW4dksA@mail.gmail.com>
Message-ID: <20150204175547.GB5737@nicira.com>

Please don't drop the list.

That's a really old version.  Does it happen with 1.9.3?

On Wed, Feb 04, 2015 at 02:51:04PM +0530, Ruchika Verma wrote:
> sorry missed that information ovs version is 1.9.0
> 
> On Wed, Feb 4, 2015 at 11:29 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > What version of OVS is this?
> >
> > On Tue, Feb 03, 2015 at 09:48:13PM -0800, Ruchika Verma wrote:
> > > hi Ben,
> > >
> > > please find the backtrace attached.
> > >
> > > Regards
> > > Ruchika???
> > >  error_ssl.txt
> > > <
> > https://docs.google.com/file/d/0B7Bgk_t_PzaGQlF3eklQQjN3NGM/edit?usp=drive_web
> > >
> > > ???
> > >
> > > On Tue, Feb 3, 2015 at 10:59 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Tue, Feb 03, 2015 at 12:07:02PM +0530, Ruchika Verma wrote:
> > > > > hi,
> > > > >
> > > > > I am running ovs-controller with SSL enabled option using command -
> > > > >
> > > > >     sudo ovs-controller -v pssl:6633  -p
> > /mininet/mininet/ctl-privkey.pem
> > > > > -c /mininet/mininet/ctl-cert.pem -C
> > > > > /var/lib/openvswitch/pki/switchca/cacert.pem
> > > > >
> > > > > I have enabled BOOTSTRAP option at switch through -
> > > > >
> > > > > ovs-vsctl -- --bootstrap set-ssl /mininet/mininet/sc-privkey.pem
> > > > > /mininet/mininet/sc-cert.pem /etc/openvswitch/cacert.pem
> > > > >
> > > > > the keys and certificates are generated as -
> > > > >
> > > > > sudo ovs-pki req+sign ctl controller
> > > > > sudo ovs-pki req+sign sc switch
> > > > >
> > > > > Now when i create the OpenVSwitch in virtual environment (on
> > mininet),
> > > > > using command -
> > > > >
> > > > > sudo mn --topo=linear,1 --controller=remote
> > > > >
> > > > > I get following error and OVS-Controller crashes after sometime. On
> > > > mininet
> > > > > window however the topology is created successfully.
> > > >
> > > > What version of OVS is this?
> > > >
> > > > Can you provide a backtrace for the crash?
> > > >
> >

From blp at nicira.com  Wed Feb  4 10:54:37 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Feb 2015 10:54:37 -0800
Subject: [ovs-discuss] ovs does not work when running mininet.
In-Reply-To: <tencent_1C1317E90866EE3331D0143E@qq.com>
References: <tencent_1C1317E90866EE3331D0143E@qq.com>
Message-ID: <20150204185437.GD5737@nicira.com>

On Thu, Feb 05, 2015 at 12:39:03AM +0800, ???? wrote:
> Hi all,
>      I use mininet to run some easy topo with loop, and my OVS version is 2.3.1.
>      I set OVS's OF version as 1.3, but several seconds ago, It just does not work at all. I use pingall to test it, but controller can't get anything, while no flow table in switch and ping failure.
>      I try to reset OVS's OF version as OF13. Sometimes I works, but sometimes does not.
>      Why?  BTW, if switch and controller's version is not matched, it seems like that OVS do not send the version error message to controller. It confuse me. It really works at OVS2.1.1.

I'm having trouble understanding this issue.  If the switch and
controller don't support a common OpenFlow version, then they won't
work together whether there's a version error message or not.  Do you
still see a problem even when the switch and controller do support the
same OpenFlow version?

Your description of the failure is vague.  "It just does not work at
all" does not help much.

I suggest that you set the maximum logging level on OVS for OpenFlow
connections, by invoking OVS with -vvconn, or by running "ovs-appctl
vlog/set vconn" while OVS is running, and then post what ovs-vswitchd
logs when you see the problem.

From badveli_vishnuus at yahoo.com  Wed Feb  4 12:09:41 2015
From: badveli_vishnuus at yahoo.com (vis reddy)
Date: Wed, 4 Feb 2015 20:09:41 +0000 (UTC)
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <1048215707.1394349.1423077682840.JavaMail.yahoo@mail.yahoo.com>
References: <1048215707.1394349.1423077682840.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <702585298.1416484.1423080581532.JavaMail.yahoo@mail.yahoo.com>


Hello All,Going through rfc 7047
The operation updates rows in a table.  It searches "table" for rows
   that match all the conditions specified in "where".  For each
   matching row, it changes the value of each column specified in "row"
   to the value for that column specified in "row". 
I am not able to find out if there is an operation which tries to find a row that match conditions and if does not exist, it can insert, how do we achieve some thing like this?
this is useful as I do not have a idea if the row is existing i would want to update itor insert it if it does not exist. Should i always use select followed by insert or update operations.
ThanksVishnu


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150204/975738f2/attachment.html>

From blp at nicira.com  Wed Feb  4 14:17:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Feb 2015 14:17:10 -0800
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <702585298.1416484.1423080581532.JavaMail.yahoo@mail.yahoo.com>
References: <1048215707.1394349.1423077682840.JavaMail.yahoo@mail.yahoo.com>
 <702585298.1416484.1423080581532.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150204221710.GK5737@nicira.com>

On Wed, Feb 04, 2015 at 08:09:41PM +0000, vis reddy wrote:
> 
> Hello All,Going through rfc 7047
> The operation updates rows in a table.  It searches "table" for rows
>    that match all the conditions specified in "where".  For each
>    matching row, it changes the value of each column specified in "row"
>    to the value for that column specified in "row". 
> I am not able to find out if there is an operation??which tries to find a row that match conditions and if does not exist, it can insert,??how do we achieve some thing like this?
> this is useful as I do not have a idea if the row is existing??i would want to update itor insert it if it does not exist. Should i always use select followed by insert or update operations.

I think you'll have to select then insert or update in that case.

From pshelar at nicira.com  Wed Feb  4 14:34:33 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Wed, 4 Feb 2015 14:34:33 -0800
Subject: [ovs-discuss] Open vSwitch STT support
In-Reply-To: <CACaajQsOOmYPZ9p5BjycQdE1cjX_8-Uux3_OxJDiOCvvyq9QjA@mail.gmail.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
 <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
 <20150203181956.GA9500@tuxdriver.com>
 <CALnjE+pDG8G1=g-rJHpcn324X4nz8Pi9PthnMiz63mYbJx2yYA@mail.gmail.com>
 <CACaajQveYidWC5KOrQr1LM3-pGoDV4LFi4BDLnDO=VFBV-WzCA@mail.gmail.com>
 <CACaajQsOOmYPZ9p5BjycQdE1cjX_8-Uux3_OxJDiOCvvyq9QjA@mail.gmail.com>
Message-ID: <CALnjE+qGRWPeciw=MUkYOqGMqLQyO4RvCz96hx_VA7c+r=XshA@mail.gmail.com>

On Tue, Feb 3, 2015 at 11:04 PM, Vasiliy Tolstov <v.tolstov at selfip.ru> wrote:
>
> 2015-02-04 10:04 GMT+03:00 Vasiliy Tolstov <v.tolstov at selfip.ru>:
>>
>> Does it possible to add to readme test results posted in mailing list
>> about vxlan and stt and do this tests also (on the same hardware) for gre,
>> listp, geneve?
>
>
> Or openvswitch FAQ

I will summarize STT performance in the OVS documentation.

>
>
> --
> Vasiliy Tolstov,
> e-mail: v.tolstov at selfip.ru
> jabber: vase at selfip.ru

From tgraf at noironetworks.com  Thu Feb  5 03:16:43 2015
From: tgraf at noironetworks.com (Thomas Graf)
Date: Thu, 5 Feb 2015 12:16:43 +0100
Subject: [ovs-discuss] [ovs-dev]  Open vSwitch STT support
In-Reply-To: <CALnjE+pDG8G1=g-rJHpcn324X4nz8Pi9PthnMiz63mYbJx2yYA@mail.gmail.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
 <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
 <20150203181956.GA9500@tuxdriver.com>
 <CALnjE+pDG8G1=g-rJHpcn324X4nz8Pi9PthnMiz63mYbJx2yYA@mail.gmail.com>
Message-ID: <20150205111643.GB733@pox.localdomain>

On 02/03/15 at 11:27am, Pravin Shelar wrote:
> On Tue, Feb 3, 2015 at 10:19 AM, John W. Linville
> <linville at tuxdriver.com> wrote:
> > Thanks for doing that research for me! :-) You don't see any way to
> > work with Dave M. around his objections?
> >
> > Violating an "upstream first" policy seems like you are making an "end
> > run" in hopes of eventually coming back to Dave M. with an argument
> > like "but people have been using this already".  I could be wrong,
> > but that probably won't make Dave any more happy about merging the
> > patchset in the future...
> >
> I do not have any plans of pushing STT to upstream kernel. I do not
> think increased STT usage will help us getting STT upstream in future.
> STT is useful tunneling protocol regardless of whether it is upstream
> or not and that is motivation of merging it to OVS repo.

It's very unfortunate that STT can't make it upstream. Having it in
the OVS tree is the 2nd best option.

STT obviously does some abuse but so do other encaps like VXLAN which
abuse the outer UDP sport to benefit from RSS. It is however very hard
to argue with the feedback given.

From v.tolstov at selfip.ru  Thu Feb  5 05:56:15 2015
From: v.tolstov at selfip.ru (Vasiliy Tolstov)
Date: Thu, 5 Feb 2015 17:56:15 +0400
Subject: [ovs-discuss] [ovs-dev] Open vSwitch STT support
In-Reply-To: <20150205111643.GB733@pox.localdomain>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
 <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
 <20150203181956.GA9500@tuxdriver.com>
 <CALnjE+pDG8G1=g-rJHpcn324X4nz8Pi9PthnMiz63mYbJx2yYA@mail.gmail.com>
 <20150205111643.GB733@pox.localdomain>
Message-ID: <CACaajQsKhrS4F=qJaGK85WOnb-zzkG0_J520815-kK4MOiwL_Q@mail.gmail.com>

2015-02-05 14:16 GMT+03:00 Thomas Graf <tgraf at noironetworks.com>:

> STT obviously does some abuse but so do other encaps like VXLAN which
> abuse the outer UDP sport to benefit from RSS. It is however very hard
> to argue with the feedback given.
>

As STT have performance benefits to me (i'm use tunnels to transfer traffic
from vps also i have mutipath tcp enabled hosts to decrease cost in
switches that not have stacking support), i'm very happy if STT integrated
with openvswitch data path module. I look forward =)


-- 
Vasiliy Tolstov,
e-mail: v.tolstov at selfip.ru
jabber: vase at selfip.ru
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150205/7531bdca/attachment-0001.html>

From pg201372016 at iitj.ac.in  Thu Feb  5 06:08:11 2015
From: pg201372016 at iitj.ac.in (Sumit Paliwal)
Date: Thu, 5 Feb 2015 19:38:11 +0530
Subject: [ovs-discuss] Data Flow in openvswitch
Message-ID: <CAEhKQHKuTkUoniNkWt5TWCnFi1M0rQK1jWR06PnFr8B8pPtqmA@mail.gmail.com>

hello everyone,

Can anyone help me in understanding the data flow of openvswitch?
I'm using these switches in mininet environment. I'm not able to understand
that, which functions are called when a packet is received at ovs switch.
If I could get the starting point, i can figure out the rest.


Thanks & Regards,
-- 
Sumit Paliwal




*"Have a great Day... "*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150205/59c462a4/attachment.html>

From sbiswas7 at linux.vnet.ibm.com  Thu Feb  5 06:21:11 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Thu, 05 Feb 2015 19:51:11 +0530
Subject: [ovs-discuss]  VxLAN Flow setup not working.
Message-ID: <54D37C57.5030103@linux.vnet.ibm.com>

Hi,

I have a basic query.
I have 2 machines with OVS 2.3.1 on it.
I have done the following to create a VxLAN tunnel:

ovs-vsctl add-port br0 vxlan -- set interface vxlan type=vxlan 
options:remote_ip=<IP_of_remote_node>

After this, I have created a virtual machine using virsh on the OVS 
bridge br0.
Following this, I also added a few OF rules - like this on br0:

table=0,in_port=4,actions=set_field:100->tun_id,resubmit(,1)
table=1,tun_id=100, actions=output:1
table=1,tun_id=100,arp,nw_dst=10.10.1.10,actions=output:1

My VMs, vnet device is on Port 4. The VxLAN port is on Port 1.

Does these flow rules make sense? I am basically asking OVS to add the 
VxLAN headers by sending the packets out on Port 1 (which is my VxLAN port).

I don't have any ethernet devices attached to br0(the ovs bridge).
I have one eth0 device on this machine configured with a public IP for 
internet connectivity.

I am assuming that the vxlan traffic will flow out of the Linux TCP/IP 
stack and I wouldn't need to move the eth0 device as a port to br0...Is 
that correct?

I tried a similar configuration on the remote host and then tried to 
ping the VMs.

I can see that the flows have got hit on the source machine by seeing 
the packets count against them. However, the ARP rules' packet counts 
stayed at 0. I assumed that for the first time, the ARP flow should have 
got hit?

I did a tcpdump on eth0 but didn't see any relevant packets flowing out 
either. Naturally - the VMs aren't able to ping each other.

Am I missing something here?

Appreciate your help.

Thanks,
Sudipto


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150205/2675ecf6/attachment.html>

From badveli_vishnuus at yahoo.com  Wed Feb  4 11:21:22 2015
From: badveli_vishnuus at yahoo.com (vis reddy)
Date: Wed, 4 Feb 2015 19:21:22 +0000 (UTC)
Subject: [ovs-discuss] ovsdb update operation
Message-ID: <1048215707.1394349.1423077682840.JavaMail.yahoo@mail.yahoo.com>

Hello All,Going through rfc 7047
The operation updates rows in a table.  It searches "table" for rows
   that match all the conditions specified in "where".  For each
   matching row, it changes the value of each column specified in "row"
   to the value for that column specified in "row". 
I am not able to find out if there is an operation which tries to find a row that match conditions and if does not exist, it can insert, how do we achieve some thing like this?
this is useful as I do not have a idea if the row is existing i would want to update itor insert it if it does not exist. Should i always use select followed by insert or update operations.
ThanksVishnu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150204/b2060c2e/attachment.html>

From andrey at xdel.ru  Fri Feb  6 06:43:35 2015
From: andrey at xdel.ru (Andrey Korolyov)
Date: Fri, 6 Feb 2015 18:43:35 +0400
Subject: [ovs-discuss] Packet drops during non-exhaustive flood with OVS
	and 1.8.0
In-Reply-To: <CABYiri8qr2v8r_XQO35swWt_OO=WQtW0jO=KAz70f5VojhM6kg@mail.gmail.com>
References: <CABYiri-qn_HGYeRSxH+z0+LGi0se9NEOk0q9hzFg4R+wg05ABw@mail.gmail.com>
 <CABYiri9WwQMn1u7TbJNEGCs804f_hvP2cKxet2sGMbrx1rJUyw@mail.gmail.com>
 <CABYiri_q4QqWrhTQL-UZ1wf3FLz-wj9SbtBJrDntz2Bw4cEPoQ@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F730688B53@IRSMSX104.ger.corp.intel.com>
 <CABYiri8qr2v8r_XQO35swWt_OO=WQtW0jO=KAz70f5VojhM6kg@mail.gmail.com>
Message-ID: <CABYiri9CjS0ME-WnVXEKE-7Z6rkxLfTe3UO=z13qzbJ1ap78NQ@mail.gmail.com>

On Tue, Feb 3, 2015 at 8:21 PM, Andrey Korolyov <andrey at xdel.ru> wrote:
>> These patches are to enable DPDK 1.8 only. What 'bulk processing' are you referring to?
>> By default there is a batch size of 192 in netdev-dpdk for rx from the NIC - the linked
>> patch doesn't change this, just the DPDK version.
>
> Sorry, I referred the wrong part there: bulk transmission, which is
> clearly not involved in my case. The idea was that the conditionally
> enabling prefetch for rx queues (BULK_ALLOC) may help somehow, but
> it`s probably will mask issue instead of solving it directly. By my
> understanding, strict drop rule should have a zero impact on a main
> ovs thread (and this is true) and work just fine with a line rate
> (this is not).
>
>>
>> Main things to consider are to isocpu's, pin the pmd thread and keep everything
>> on 1 NUMA socket. At 11 mpps without packet loss on that processor I suspect you are
>> doing those things already.
>
> Yes, with all tuning improvements I was able to do this, but bare
> Linux stack on same machine is able to handle 12Mpps and there are
> absolutely no hints of what exactly is being congested.

Also both action=NORMAL & action=output:<non-dpdk port> do manage flow
control in such a way that the generator side reaches line (14.8Mpps)
rate on 60b data packets, though very high drop ratio persists. With
action=DROP or action=output:X, where X is another dpdk port, flow
control establishes somewhere at the 13Mpps. Of course, using regular
host interface or NORMAL action generates a lot of context switches,
mainly by miniflow_extract() and emc_..(), the difference in a syscall
distribution between congested (line rate is reached) and
non-congested link is unobservable.

From eyalr5 at hotmail.com  Thu Feb  5 08:50:37 2015
From: eyalr5 at hotmail.com (eyal)
Date: Thu, 5 Feb 2015 18:50:37 +0200
Subject: [ovs-discuss] can't load openvswitch.ko for Unknown symbol problem
Message-ID: <DUB127-W10719C291AA8806F184CF7993B0@phx.gbl>

OS: Centos7kernel: latest - 3.10.0-123.20.1.el7.x86_64OVS : 2.3.90 . the latest master - openvswitch-ovs-4d9226a The H file datapath/linux/compat/include/net/vxlan.h  has :IFNDEF HAVE_VXLAN_METADATA Which define prototype rpl_vxlan_xmit_skb. However the c file datapath/linux/compat/vxlan.cDoesn't implement this function because USE_KERNEL_TUNNEL_API  isn't define in the kernel header/ .config of 3.10.0-123.20.1.el7.x86_64. For that reason I have on dmesg file :dmesg | grep openvswitch[ 7177.899305] openvswitch: Unknown symbol rpl_vxlan_xmit_skb (err 0)[ 7177.899338] openvswitch: Unknown symbol rpl_vxlan_sock_release (err 0)[ 7177.899371] openvswitch: Unknown symbol rpl_vxlan_sock_add (err 0) Which kernel version contain this feature ? Thanks !  		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150205/4f34720f/attachment-0001.html>

From marco at nuvula.ch  Thu Feb  5 15:23:51 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Fri, 6 Feb 2015 00:23:51 +0100
Subject: [ovs-discuss] STP / VXLAN mesh: ETH0,
	Connection lost to OVS 2.3.1 server
Message-ID: <39C260E0-5634-40E4-BD09-9F0FA1643922@nuvula.ch>

Folks,

I have a small testbed with 4 ubuntu servers, fully meshed with VXLAN. To avoid loops I use Spanning-Tree.

The 4 servers run Ubuntu 14.10 fully updated.

I upgraded manually to openvswitch 2.3.1 with the vivid packages from ubuntu.

3 Servers run kvm and consume via rbd/ceph images. CEPH runs over openvswitch to sync data.

The 3 KVM servers share via VXLAN flat networks trunked with VLAN's.

These physical servers are single homed and therefore I need to bridge eth0 also to the outside world.

Randomly these servers loose connectivity to the outside world (eth0). Troubleshooting shows, that it is often related to STP events (VM's restarting/shutdown/hosts booting, etc).

After very long searches I think I found the culprit: A lock file ".conf.db.~lock~" is present in /etc/openvswitch directory. If I delete that file and reboot the host connectivity reappears.

When the host looses connectivity, no ipv4 traffic is forwarded anymore. No real culprits are visible in ovs-vswitch logs, except that a STP topology change happened.

local ovsbr0p1 bridged to eth0 interface can be ipv4 pinged. Gateway cannot be pinged anymore (sometimes ipv6 connectivity still works)

Any tips how to troubleshoot this and get rid of this sudden loss of connectivity ? Same problem happened on OVS 2.0 release.

Second question: How can I get rid of SPT events when VM's boot or similar ? On HW switches there is a concept of Access-Ports for end devices, where no STP event will be flood to the fabric.

thanks
marco



Below some outputs that could help in troubleshooting:




root at nuv-vir-kvm-server-3 ~ # ovs-vsctl show
5733eb7c-f4ac-446c-bfd1-c0121c0337b7
    Bridge "ovsbr0"
        Port "eth0"
            Interface "eth0"
        Port "ovsbr0p1"
            Interface "ovsbr0p1"
                type: internal
        Port "ovsbr0"
            Interface "ovsbr0"
                type: internal
    Bridge "ovsbr1"
        Port "ovsbr1.8p1"
            tag: 8
            Interface "ovsbr1.8p1"
                type: internal
        Port "ovsbr1.12p1"
            tag: 12
            Interface "ovsbr1.12p1"
                type: internal
        Port "ovsbr1.3p1"
            tag: 3
            Interface "ovsbr1.3p1"
                type: internal
        Port "ovsbr1.4"
            tag: 4
            Interface "ovsbr1.4"
                type: internal
        Port "ovsbr1.101p1"
            tag: 101
            Interface "ovsbr1.101p1"
                type: internal
        Port "ovsvx5"
            trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
            Interface "ovsvx5"
                type: vxlan
                options: {key=flow, remote_ip="46.4.100.54"}
        Port "ovsbr1.1"
            tag: 1
            Interface "ovsbr1.1"
                type: internal
        Port "ovsbr1.9"
            tag: 9
            Interface "ovsbr1.9"
                type: internal
        Port "ovsbr1.2"
            tag: 2
            Interface "ovsbr1.2"
                type: internal
        Port "ovsbr1.20"
            tag: 20
            Interface "ovsbr1.20"
                type: internal
        Port "ovsbr1.30p1"
            tag: 30
            Interface "ovsbr1.30p1"
                type: internal
        Port "ovsbr1.101"
            tag: 101
            Interface "ovsbr1.101"
                type: internal
        Port "ovsbr1.5"
            tag: 5
            Interface "ovsbr1.5"
                type: internal
        Port "ovsbr1.7"
            tag: 7
            Interface "ovsbr1.7"
                type: internal
        Port "ovsbr1.1p1"
            tag: 1
            Interface "ovsbr1.1p1"
                type: internal
        Port "ovsbr1.6"
            tag: 6
            Interface "ovsbr1.6"
                type: internal
        Port "ovsbr1.11p1"
            tag: 11
            Interface "ovsbr1.11p1"
                type: internal
        Port "ovsbr1.4p1"
            tag: 4
            Interface "ovsbr1.4p1"
                type: internal
        Port "ovsbr1"
            Interface "ovsbr1"
                type: internal
        Port "ovsbr1.8"
            tag: 8
            Interface "ovsbr1.8"
                type: internal
        Port "ovsbr1.12"
            tag: 12
            Interface "ovsbr1.12"
                type: internal
        Port "ovsbr1.11"
            tag: 11
            Interface "ovsbr1.11"
                type: internal
        Port "ovsbr1.10p1"
            tag: 10
            Interface "ovsbr1.10p1"
                type: internal
        Port "ovsbr1.7p1"
            tag: 7
            Interface "ovsbr1.7p1"
                type: internal
        Port "ovsbr1.2p1"
            tag: 2
            Interface "ovsbr1.2p1"
                type: internal
        Port "ovsbr1.9p1"
            tag: 9
            Interface "ovsbr1.9p1"
                type: internal
        Port "ovsbr1.30"
            tag: 30
            Interface "ovsbr1.30"
                type: internal
        Port "ovsvxnuv-vir-aci-ubuntu-1"
            trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
            Interface "ovsvxnuv-vir-aci-ubuntu-1"
                type: vxlan
                options: {key=flow, remote_ip="46.4.17.109"}
        Port "ovsbr1.10"
            tag: 10
            Interface "ovsbr1.10"
                type: internal
        Port "ovsvx7"
            trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
            Interface "ovsvx7"
                type: vxlan
                options: {key=flow, remote_ip="46.4.17.67"}
        Port "ovsbr1.5p1"
            tag: 5
            Interface "ovsbr1.5p1"
                type: internal
        Port "ovsvx6"
            trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
            Interface "ovsvx6"
                type: vxlan
                options: {key=flow, remote_ip="46.4.109.146"}
        Port "ovsbr1.6p1"
            tag: 6
            Interface "ovsbr1.6p1"
                type: internal
        Port "ovsbr1.3"
            tag: 3
            Interface "ovsbr1.3"
                type: internal
        Port "ovsbr1.20p1"
            tag: 20
            Interface "ovsbr1.20p1"
                type: internal
    ovs_version: "2.3.1"

_uuid               : c960a8da-aa1a-4c8a-a3f3-1b7863424313
bond_active_slave   : []
bond_downdelay      : 0
bond_fake_iface     : false
bond_mode           : []
bond_updelay        : 0
external_ids        : {}
fake_bridge         : false
interfaces          : [e8ec16b3-1a83-44a0-b3f8-f3dccfdde91d]
lacp                : []
mac                 : []
name                : "eth0"
other_config        : {}
qos                 : []
statistics          : {}
status              : {}
tag                 : []
trunks              : []
vlan_mode           : []

root at nuv-vir-kvm-server-5 ~ # ovs-vsctl list port
_uuid               : 6b14b501-a85b-4fc0-8cd3-1302830ff35c
bond_active_slave   : []
bond_downdelay      : 0
bond_fake_iface     : false
bond_mode           : []
bond_updelay        : 0
external_ids        : {}
fake_bridge         : false
interfaces          : [7dfc6aa1-23bf-4784-98c3-583ea20884c6]
lacp                : []
mac                 : []
name                : "ovsbr1.1p1"
other_config        : {}
qos                 : []
statistics          : {}
status              : {}
tag                 : 1
trunks              : []
vlan_mode           : []


_uuid               : eec4c406-3cf5-4507-9ca3-251741631e77
bond_active_slave   : []
bond_downdelay      : 0
bond_fake_iface     : false
bond_mode           : []
bond_updelay        : 0
external_ids        : {}
fake_bridge         : false
interfaces          : [8e88f0c9-31e0-4c44-81b8-53511ab8d8bd]
lacp                : []
mac                 : []
name                : "ovsbr1"
other_config        : {}
qos                 : []
statistics          : {}
status              : {}
tag                 : []
trunks              : []
vlan_mode           : []

_uuid               : a191cc12-89d3-4a79-bdaf-55502c5b213d
bond_active_slave   : []
bond_downdelay      : 0
bond_fake_iface     : false
bond_mode           : []
bond_updelay        : 0
external_ids        : {}
fake_bridge         : false
interfaces          : [4281866e-11b4-4c04-8a6c-066aea7af246]
lacp                : []
mac                 : []
name                : "ovsbr0p1"
other_config        : {}
qos                 : []
statistics          : {}
status              : {}
tag                 : []
trunks              : []
vlan_mode           : []



_uuid               : 22ee48dc-7fec-4742-b577-a5293f7e3bd9
admin_state         : up
bfd                 : {}
bfd_status          : {}
cfm_fault           : []
cfm_fault_status    : []
cfm_flap_count      : []
cfm_health          : []
cfm_mpid            : []
cfm_remote_mpids    : []
cfm_remote_opstate  : []
duplex              : []
external_ids        : {}
ifindex             : 5
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : 1
link_speed          : []
link_state          : up
mac                 : []
mac_in_use          : "c8:60:00:5f:f0:3f"
mtu                 : 1500
name                : "ovsbr0"
ofport              : 65534
ofport_request      : []
options             : {}
other_config        : {}
statistics          : {collisions=0, rx_bytes=360, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=4, tx_bytes=44058, tx_dropped=0, tx_errors=0, tx_packets=328}
status              : {driver_name=openvswitch}
type                : internal


_uuid               : e8ec16b3-1a83-44a0-b3f8-f3dccfdde91d
admin_state         : up
bfd                 : {}
bfd_status          : {}
cfm_fault           : []
cfm_fault_status    : []
cfm_flap_count      : []
cfm_health          : []
cfm_mpid            : []
cfm_remote_mpids    : []
cfm_remote_opstate  : []
duplex              : full
external_ids        : {}
ifindex             : 2
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : 1
link_speed          : 1000000000
link_state          : up
mac                 : []
mac_in_use          : "c8:60:00:5f:f0:3f"
mtu                 : 1500
name                : "eth0"
ofport              : 2
ofport_request      : []
options             : {}
other_config        : {}
statistics          : {collisions=0, rx_bytes=1381410080, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=6910253, tx_bytes=1055169046, tx_dropped=0, tx_errors=0, tx_packets=2504716}
status              : {driver_name="r8169", driver_version="2.3LK-NAPI", firmware_version="rtl_nic/rtl8168e-2.fw"}
type                : ""


_uuid               : 4281866e-11b4-4c04-8a6c-066aea7af246
admin_state         : up
bfd                 : {}
bfd_status          : {}
cfm_fault           : []
cfm_fault_status    : []
cfm_flap_count      : []
cfm_health          : []
cfm_mpid            : []
cfm_remote_mpids    : []
cfm_remote_opstate  : []
duplex              : []
external_ids        : {}
ifindex             : 4
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : 1
link_speed          : []
link_state          : up
mac                 : []
mac_in_use          : "62:ee:a5:83:b5:7e"
mtu                 : 1500
name                : "ovsbr0p1"
ofport              : 1
ofport_request      : []
options             : {}
other_config        : {}
statistics          : {collisions=0, rx_bytes=1053520420, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=2474191, tx_bytes=9971342322, tx_dropped=0, tx_errors=0, tx_packets=6910215}
status              : {driver_name=openvswitch}
type                : internal

_uuid               : 7dfc6aa1-23bf-4784-98c3-583ea20884c6
admin_state         : up
bfd                 : {}
bfd_status          : {}
cfm_fault           : []
cfm_fault_status    : []
cfm_flap_count      : []
cfm_health          : []
cfm_mpid            : []
cfm_remote_mpids    : []
cfm_remote_opstate  : []
duplex              : []
external_ids        : {}
ifindex             : 36
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : 1
link_speed          : []
link_state          : up
mac                 : []
mac_in_use          : "6e:e8:ec:44:f9:1a"
mtu                 : 1400
name                : "ovsbr1.1p1"
ofport              : 2
ofport_request      : []
options             : {}
other_config        : {}
statistics          : {collisions=0, rx_bytes=800790181, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=2044691, tx_bytes=9595662921, tx_dropped=0, tx_errors=0, tx_packets=6887123}
status              : {driver_name=openvswitch}
type                : internal

_uuid               : 8c602077-b2b1-4f2c-9201-93304008a814
bond_active_slave   : []
bond_downdelay      : 0
bond_fake_iface     : false
bond_mode           : []
bond_updelay        : 0
external_ids        : {}
fake_bridge         : false
interfaces          : [18cb6a6c-1f66-4eb5-bc78-304e8b404ac0]
lacp                : []
mac                 : []
name                : "ovsvx3"
other_config        : {}
qos                 : []
statistics          : {stp_error_count=0, stp_rx_count=311, stp_tx_count=4}
status              : {stp_port_id="8002", stp_role=root, stp_sec_in_state="592", stp_state=forwarding}
tag                 : []
trunks              : [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
vlan_mode           : trunk


2015-02-05T10:54:04.316Z|00082|bridge|INFO|bridge ovsbr1: added interface ovsvxnuv-vir-aci-ubuntu-1 on port 35
2015-02-05T10:54:34.562Z|00083|stp|INFO|ovsbr1: detected topology change.
2015-02-05T18:13:52.953Z|00014|stp(handler10)|INFO|ovsbr1: detected topology change.
2015-02-05T20:58:13.680Z|00084|stp|INFO|ovsbr1: detected topology change.
2015-02-05T20:58:14.181Z|00085|stp|INFO|ovsbr1: detected topology change.
2015-02-05T20:59:49.410Z|00086|stp|INFO|ovsbr1: detected topology change.
2015-02-05T21:13:56.899Z|00015|stp(handler10)|INFO|ovsbr1: detected topology change.
2015-02-05T21:16:05.136Z|00087|stp|INFO|ovsbr1: detected topology change.
2015-02-05T21:16:05.637Z|00088|stp|INFO|ovsbr1: detected topology change.
2015-02-05T21:16:34.178Z|00089|stp|INFO|ovsbr1: detected topology change.
2015-02-05T21:39:46.234Z|00016|stp(handler10)|INFO|ovsbr1: detected topology change.
2015-02-05T22:44:19.686Z|00090|stp|INFO|ovsbr1: detected topology change.
2015-02-05T22:44:49.218Z|00091|stp|INFO|ovsbr1: detected topology change.
2015-02-05T23:01:55.688Z|00001|fatal_signal(urcu5)|WARN|terminating with signal 15 (Terminated)
2015-02-05T23:07:39.407Z|00001|vlog|INFO|opened log file /var/log/openvswitch/ovs-vswitchd.log
2015-02-05T23:07:39.446Z|00002|reconnect|INFO|unix:/var/run/openvswitch/db.sock: connecting...
2015-02-05T23:07:39.446Z|00003|reconnect|INFO|unix:/var/run/openvswitch/db.sock: connected
2015-02-05T23:07:39.450Z|00004|dpif|WARN|system at ovs-system: failed to put[create] (Invalid argument) skb_priority(0),skb_mark(0),recirc_id(0x1),dp_hash(0x1),in_port(0),eth(src=00:00:00:00:00:00,dst=00:00:00:00:00:00)
2015-02-05T23:07:39.450Z|00005|ofproto_dpif|INFO|system at ovs-system: Datapath does not support recirculation
2015-02-05T23:07:39.450Z|00006|dpif|WARN|system at ovs-system: execute userspace(pid=0,userdata(00000000)) failed (Invalid argument) on packet metadata=0,in_port=0,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x1234
2015-02-05T23:07:39.450Z|00007|ofproto_dpif|WARN|system at ovs-system: variable-length userdata feature probe failed (Invalid argument)
2015-02-05T23:07:39.450Z|00008|dpif|WARN|system at ovs-system: failed to put[create] (Invalid argument) skb_priority(0),skb_mark(0),in_port(0),eth(src=00:00:00:00:00:00,dst=00:00:00:00:00:00),eth_type(0x8847),mpls(label=0,tc=0,ttl=0,bos=1)
2015-02-05T23:07:39.450Z|00009|ofproto_dpif|INFO|system at ovs-system: MPLS label stack length probed as 0
2015-02-05T23:07:39.454Z|00010|dpif|WARN|system at ovs-system: failed to query port ovsvxnuv-vir-aci-ubuntu-1: Invalid argument
2015-02-05T23:07:39.455Z|00011|bridge|INFO|bridge ovsbr0: added interface ovsbr0p1 on port 1
2015-02-05T23:07:39.456Z|00012|bridge|INFO|bridge ovsbr0: added interface eth0 on port 2
2015-02-05T23:07:39.457Z|00013|bridge|INFO|bridge ovsbr0: added interface ovsbr0 on port 65534
2015-02-05T23:07:39.459Z|00014|bridge|INFO|bridge ovsbr1: added interface ovsbr1.2p1 on port 4
2015-02-05T23:07:39.460Z|00015|bridge|INFO|bridge ovsbr1: added interface ovsbr1.6 on port 11
2015-02-05T23:07:39.461Z|00016|bridge|INFO|bridge ovsbr1: added interface ovsvx6 on port 31
2015-02-05T23:07:39.463Z|00017|bridge|INFO|bridge ovsbr1: added interface ovsbr1.7 on port 13
2015-02-05T23:07:39.467Z|00018|bridge|INFO|bridge ovsbr1: added interface ovsbr1.9 on port 17
2015-02-05T23:07:39.469Z|00019|bridge|INFO|bridge ovsbr1: added interface ovsbr1.9p1 on port 18
2015-02-05T23:07:39.472Z|00020|bridge|INFO|bridge ovsbr1: added interface ovsbr1.1 on port 1
2015-02-05T23:07:39.473Z|00021|bridge|INFO|bridge ovsbr1: added interface ovsbr1.6p1 on port 12
2015-02-05T23:07:39.476Z|00022|bridge|INFO|bridge ovsbr1: added interface ovsbr1.10p1 on port 20
2015-02-05T23:07:39.476Z|00023|bridge|INFO|bridge ovsbr1: added interface ovsvx3 on port 33
2015-02-05T23:07:39.481Z|00024|bridge|INFO|bridge ovsbr1: added interface ovsbr1.4p1 on port 8
2015-02-05T23:07:39.485Z|00025|bridge|INFO|bridge ovsbr1: added interface ovsbr1 on port 65534
2015-02-05T23:07:39.489Z|00001|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 1
2015-02-05T23:07:39.490Z|00026|bridge|INFO|bridge ovsbr1: added interface ovsbr1.3p1 on port 6
2015-02-05T23:07:39.495Z|00027|bridge|INFO|bridge ovsbr1: added interface ovsbr1.10 on port 19
2015-02-05T23:07:39.497Z|00002|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 3
2015-02-05T23:07:39.508Z|00028|bridge|INFO|bridge ovsbr1: added interface ovsbr1.30 on port 27
2015-02-05T23:07:39.510Z|00029|bridge|INFO|bridge ovsbr1: added interface ovsbr1.7p1 on port 14
2015-02-05T23:07:39.514Z|00030|bridge|INFO|bridge ovsbr1: added interface ovsbr1.11p1 on port 22
2015-02-05T23:07:39.514Z|00031|bridge|INFO|bridge ovsbr1: added interface ovsvx7 on port 34
2015-02-05T23:07:39.516Z|00032|bridge|INFO|bridge ovsbr1: added interface ovsbr1.20p1 on port 26
2015-02-05T23:07:39.516Z|00033|bridge|INFO|bridge ovsbr1: added interface ovsvxnuv-vir-aci-ubuntu-1 on port 35
2015-02-05T23:07:39.518Z|00034|bridge|INFO|bridge ovsbr1: added interface ovsbr1.20 on port 25
2015-02-05T23:07:39.521Z|00035|bridge|INFO|bridge ovsbr1: added interface ovsbr1.3 on port 5
2015-02-05T23:07:39.525Z|00036|bridge|INFO|bridge ovsbr1: added interface ovsbr1.4 on port 7
2015-02-05T23:07:39.529Z|00037|bridge|INFO|bridge ovsbr1: added interface ovsbr1.5p1 on port 10
2015-02-05T23:07:39.532Z|00038|bridge|INFO|bridge ovsbr1: added interface ovsbr1.8p1 on port 16
2015-02-05T23:07:39.539Z|00003|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 10
2015-02-05T23:07:39.541Z|00039|bridge|INFO|bridge ovsbr1: added interface ovsbr1.11 on port 21
2015-02-05T23:07:39.546Z|00040|bridge|INFO|bridge ovsbr1: added interface ovsbr1.5 on port 9
2015-02-05T23:07:39.549Z|00041|bridge|INFO|bridge ovsbr1: added interface ovsbr1.101 on port 29
2015-02-05T23:07:39.553Z|00042|bridge|INFO|bridge ovsbr1: added interface ovsbr1.2 on port 3
2015-02-05T23:07:39.563Z|00043|bridge|INFO|bridge ovsbr1: added interface ovsbr1.12p1 on port 24
2015-02-05T23:07:39.569Z|00044|bridge|INFO|bridge ovsbr1: added interface ovsbr1.8 on port 15
2015-02-05T23:07:39.570Z|00004|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 14
2015-02-05T23:07:39.573Z|00045|bridge|INFO|bridge ovsbr1: added interface ovsbr1.12 on port 23
2015-02-05T23:07:39.575Z|00046|bridge|INFO|bridge ovsbr1: added interface ovsbr1.101p1 on port 30
2015-02-05T23:07:39.581Z|00047|bridge|INFO|bridge ovsbr1: added interface ovsbr1.30p1 on port 28
2015-02-05T23:07:39.584Z|00048|bridge|INFO|bridge ovsbr1: added interface ovsbr1.1p1 on port 2
2015-02-05T23:07:39.584Z|00049|bridge|INFO|bridge ovsbr0: using datapath ID 0000c860005ff03f
2015-02-05T23:07:39.584Z|00050|connmgr|INFO|ovsbr0: added service controller "punix:/var/run/openvswitch/ovsbr0.mgmt"
2015-02-05T23:07:39.584Z|00051|bridge|INFO|bridge ovsbr1: using datapath ID 0000de63bff5aa47
2015-02-05T23:07:39.585Z|00052|connmgr|INFO|ovsbr1: added service controller "punix:/var/run/openvswitch/ovsbr1.mgmt"
2015-02-05T23:07:39.586Z|00053|dpif|WARN|system at ovs-system: failed to query port ovsvxnuv-vir-aci-ubuntu-1: Invalid argument
2015-02-05T23:07:39.595Z|00054|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.3.1
2015-02-05T23:07:49.598Z|00055|memory|INFO|49472 kB peak resident set size after 10.2 seconds
2015-02-05T23:07:49.598Z|00056|memory|INFO|handlers:2 ports:38 revalidators:2 rules:12 udpif keys:11
2015-02-05T23:08:09.607Z|00057|stp|INFO|ovsbr1: detected topology change.
2015-02-05T23:08:09.607Z|00058|stp|INFO|ovsbr1: detected topology change.
2015-02-05T23:08:09.607Z|00059|stp|INFO|ovsbr1: detected topology change.
2015-02-05T23:08:45.990Z|00060|bridge|INFO|bridge ovsbr1: added interface vnet0 on port 32
2015-02-05T23:09:16.213Z|00061|stp|INFO|ovsbr1: detected topology change.



From mittal.flora at gmail.com  Fri Feb  6 07:04:01 2015
From: mittal.flora at gmail.com (Flora Mittal)
Date: Fri, 6 Feb 2015 20:34:01 +0530
Subject: [ovs-discuss] configuration of vxlans
Message-ID: <CAP5z0CA--3tQY4jj2OW8=DPks2fVY-Yi1YAY-sYUA_VSTmm4kQ@mail.gmail.com>

Hi All,

      We are new to Networking and we need to experiment how vxlans work.
So we need to have multiple interfaces to the outgoing port, so that each
interface can act
as a pipe for the packets for that virtual Lan.
Can you please give a good link from where we can get this info.
The man pages are very long, and we need the info ASAP.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150206/249f4b8f/attachment.html>

From dchebota at gmu.edu  Fri Feb  6 09:18:33 2015
From: dchebota at gmu.edu (Dmitri Chebotarov)
Date: Fri, 6 Feb 2015 17:18:33 +0000
Subject: [ovs-discuss] can't load openvswitch.ko for Unknown symbol
 problem
In-Reply-To: <DUB127-W10719C291AA8806F184CF7993B0@phx.gbl>
References: <DUB127-W10719C291AA8806F184CF7993B0@phx.gbl>
Message-ID: <85BB6BDB-1AF1-43B1-BBA3-1A5114AC54BF@gmu.edu>

Hi 

I think OVS kernel module is already included /w a CentOS7's kernel.

You only need to build & install controls for openvswith ( don't need kmod)

Here is one of my systems as an example:

# uname -r
3.10.0-123.8.1.el7.x86_64

# lsmod |grep openv
openvswitch            70743  0
vxlan                  37584  1 openvswitch
gre                    13808  1 openvswitch
libcrc32c              12644  2 bnx2x,openvswitch

# ovs-vsctl -V
ovs-vsctl (Open vSwitch) 2.3.0
Compiled Sep  9 2014 11:32:17
DB Schema 7.6.0

# rpm -qa|grep openv
openvswitch-2.3.0-1.x86_64

--
Thank you,

Dmitri Chebotarov
VCL Sys Eng, Engineering & Architectural Support, TSD - Ent Servers & Messaging
223 Aquia Building, Ffx, MSN: 1B5
Phone: (703) 993-6175 | Fax: (703) 993-3404


> On Feb 5, 2015, at 11:50 , eyal <eyalr5 at hotmail.com> wrote:
> 
> OS: Centos7
> 
> kernel: latest - 3.10.0-123.20.1.el7.x86_64
> 
> OVS : 2.3.90 . the latest master - openvswitch-ovs-4d9226a
> 
>  
> 
> The H file datapath/linux/compat/include/net/vxlan.h  has :
> 
> IFNDEF HAVE_VXLAN_METADATA
> 
>  
> 
> Which define prototype rpl_vxlan_xmit_skb.
> 
>  
> 
> However the c file datapath/linux/compat/vxlan.c
> 
> Doesn't implement this function because USE_KERNEL_TUNNEL_API  isn't define in the kernel header/ .config of 3.10.0-123.20.1.el7.x86_64.
> 
>  
> 
> For that reason I have on dmesg file :
> 
> dmesg | grep openvswitch
> 
> [ 7177.899305] openvswitch: Unknown symbol rpl_vxlan_xmit_skb (err 0)
> 
> [ 7177.899338] openvswitch: Unknown symbol rpl_vxlan_sock_release (err 0)
> 
> [ 7177.899371] openvswitch: Unknown symbol rpl_vxlan_sock_add (err 0)
> 
>  
> 
> Which kernel version contain this feature ?
> 
>  
> 
> Thanks !
> 
>  
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From alexw at nicira.com  Fri Feb  6 09:33:20 2015
From: alexw at nicira.com (Alex Wang)
Date: Fri, 6 Feb 2015 09:33:20 -0800
Subject: [ovs-discuss] can't load openvswitch.ko for Unknown symbol
	problem
In-Reply-To: <DUB127-W10719C291AA8806F184CF7993B0@phx.gbl>
References: <DUB127-W10719C291AA8806F184CF7993B0@phx.gbl>
Message-ID: <CAArS4XU8p2T_WV1ne1vrN1AAJxeJ0QEkx284oJmXrS5nb9azEQ@mail.gmail.com>

Hey,

Have you tried with this commit?  Should be fine now,

commit 4ceb6c87968da7bcf025e4d4aef1a8da81eb24b4
Author: Thomas Graf <tgraf at noironetworks.com>
Date:   Wed Feb 4 07:45:06 2015 -0800

    datapath: Fix missing symbols when required to use own VXLAN stack

    Fixes an insufficient ifdef in compat/vxlan.c which caused required
    symbols not to be included in the build. The declarations were properly
    enabled so the build would succeed but the module would spit missing
    symbols when being inserted.

    The fix uses a new define USE_UPSTREAM_VXLAN which is set in the compat
    header <net/vxlan.h> as required. This centralizes the decision when to
    include VXLAN compat code to a single place which eases further changes.

    Reported-by: Pravin Shelar <pshelar at nicira.com>
    Signed-off-by: Thomas Graf <tgraf at noironetworks.com>
    Acked-by: Pravin B Shelar <pshelar at nicira.com>

Thanks,
Alex Wang,

On Thu, Feb 5, 2015 at 8:50 AM, eyal <eyalr5 at hotmail.com> wrote:

> OS: Centos7
>
> kernel:* latest - 3.10.0-123.20.1.el7.x86_64*
>
> OVS : 2.3.90 . the latest master - openvswitch-ovs-4d9226a
>
>
>
> The H file datapath/linux/compat/include/net/vxlan.h  has :
>
> IFNDEF HAVE_VXLAN_METADATA
>
>
>
> Which define prototype *rpl_vxlan_xmit_skb.*
>
>
>
> *However the c file datapath/linux/compat/vxlan.c*
>
> *Doesn't implement this function because USE_KERNEL_TUNNEL_API  isn't
> define in the kernel header/ .config of 3.10.0-123.20.1.el7.x86_64.*
>
>
>
> For that reason I have on dmesg file :
>
> *dmesg | grep openvswitch*
>
> [ 7177.899305] openvswitch: Unknown symbol rpl_vxlan_xmit_skb (err 0)
>
> [ 7177.899338] openvswitch: Unknown symbol rpl_vxlan_sock_release (err 0)
>
> [ 7177.899371] openvswitch: Unknown symbol rpl_vxlan_sock_add (err 0)
>
>
>
> Which kernel version contain this feature ?
>
>
>
> Thanks !
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150206/cd1bec7e/attachment.html>

From singh.pratapkrishna at gmail.com  Fri Feb  6 13:37:42 2015
From: singh.pratapkrishna at gmail.com (Krishna Pratap)
Date: Fri, 6 Feb 2015 16:37:42 -0500
Subject: [ovs-discuss] Flow format not supported for OF1.3 (ovs2.1)
Message-ID: <CAOTV=Vz6p=VGxRiUWgfwoZVi0U9JvZWh_Qrs8dE5ebchw8bPkA@mail.gmail.com>

Hi,

Im trying to add a flow which modifies the traffic source IP adress before
sending the packet-in to the controller and the flow wouldn't apply.
My switch is set to start with OF1.3 and im using ovs2.1 version. here are
the commands and the output .

------------------------
ovs-vsctl add-br br0
ovs-vsctl set bridge br0 protocol=OpenFlow13

Flow added:

ovs-ofctl -O OpenFlow13 add-flow br0
in_port=9,actions=output:1,mod_nw_src:'192.1.1.1',controller:663


here is the message I get when i try to do it

ovs-ofctl: none of the usable flow formats (OpenFlow10,NXM) is among the
allowed flow formats (OXM-OpenFlow13)

-----------------------------------------------

If I enable OpenFlow10 along with OpenFlow13 then Im able to add the above
flow successfully . Is there a way to add the flow without enabling OF1.0 ?
am I missing anything in the flow? any help would be great.

KP
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150206/77d48123/attachment.html>

From blp at nicira.com  Fri Feb  6 14:05:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Feb 2015 14:05:26 -0800
Subject: [ovs-discuss] Flow format not supported for OF1.3 (ovs2.1)
In-Reply-To: <CAOTV=Vz6p=VGxRiUWgfwoZVi0U9JvZWh_Qrs8dE5ebchw8bPkA@mail.gmail.com>
References: <CAOTV=Vz6p=VGxRiUWgfwoZVi0U9JvZWh_Qrs8dE5ebchw8bPkA@mail.gmail.com>
Message-ID: <20150206220526.GE1879@nicira.com>

On Fri, Feb 06, 2015 at 04:37:42PM -0500, Krishna Pratap wrote:
> ovs-ofctl -O OpenFlow13 add-flow br0
> in_port=9,actions=output:1,mod_nw_src:'192.1.1.1',controller:663
> 
> 
> here is the message I get when i try to do it
> 
> ovs-ofctl: none of the usable flow formats (OpenFlow10,NXM) is among the
> allowed flow formats (OXM-OpenFlow13)

In OpenFlow 1.0, mod_nw_src is allowed even on non-IP packets.  In
OpenFlow 1.1 and later, mod_nw_src is only allowed on IP packets, so
to make this work with OF1.3, add "ip" to the match:

ovs-ofctl -O OpenFlow13 add-flow br0 in_port=9,ip,actions=output:1,mod_nw_src:'192.1.1.1',controller:663

(However, "controller:663" doesn't make much sense.  Please make sure
that you understand what it means.)

From singh.pratapkrishna at gmail.com  Fri Feb  6 14:40:53 2015
From: singh.pratapkrishna at gmail.com (Krishna Pratap)
Date: Fri, 6 Feb 2015 17:40:53 -0500
Subject: [ovs-discuss] Flow format not supported for OF1.3 (ovs2.1)
In-Reply-To: <20150206220526.GE1879@nicira.com>
References: <CAOTV=Vz6p=VGxRiUWgfwoZVi0U9JvZWh_Qrs8dE5ebchw8bPkA@mail.gmail.com>
 <20150206220526.GE1879@nicira.com>
Message-ID: <CAOTV=Vx-1ONuOEFN6hv0sdzdU6Jhum37dO4rq2UT9iZpEiFdXw@mail.gmail.com>

Thanks for the help. that "ip" in the match fixed all the problems .
this is the flow that i applied
ovs-ofctl -O OpenFlow13  add-flow br0
in_port=254,ip,actions=output:1,mod_nw_src:'192.1.1.1',controller:6633

on a side note, you mentioned about  "controller:6633". were you pointing
out the incorrect port number? or anything else you would like to
highlight. ?

cheers
KP

On Fri, Feb 6, 2015 at 5:05 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Feb 06, 2015 at 04:37:42PM -0500, Krishna Pratap wrote:
> > ovs-ofctl -O OpenFlow13 add-flow br0
> > in_port=9,actions=output:1,mod_nw_src:'192.1.1.1',controller:663
> >
> >
> > here is the message I get when i try to do it
> >
> > ovs-ofctl: none of the usable flow formats (OpenFlow10,NXM) is among the
> > allowed flow formats (OXM-OpenFlow13)
>
> In OpenFlow 1.0, mod_nw_src is allowed even on non-IP packets.  In
> OpenFlow 1.1 and later, mod_nw_src is only allowed on IP packets, so
> to make this work with OF1.3, add "ip" to the match:
>
> ovs-ofctl -O OpenFlow13 add-flow br0
> in_port=9,ip,actions=output:1,mod_nw_src:'192.1.1.1',controller:663
>
> (However, "controller:663" doesn't make much sense.  Please make sure
> that you understand what it means.)
>



-- 
Best Regards,
Krishna Pratap Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150206/b8d8f568/attachment.html>

From blp at nicira.com  Fri Feb  6 14:41:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Feb 2015 14:41:29 -0800
Subject: [ovs-discuss] Flow format not supported for OF1.3 (ovs2.1)
In-Reply-To: <CAOTV=Vx-1ONuOEFN6hv0sdzdU6Jhum37dO4rq2UT9iZpEiFdXw@mail.gmail.com>
References: <CAOTV=Vz6p=VGxRiUWgfwoZVi0U9JvZWh_Qrs8dE5ebchw8bPkA@mail.gmail.com>
 <20150206220526.GE1879@nicira.com>
 <CAOTV=Vx-1ONuOEFN6hv0sdzdU6Jhum37dO4rq2UT9iZpEiFdXw@mail.gmail.com>
Message-ID: <20150206224129.GB25613@nicira.com>

On Fri, Feb 06, 2015 at 05:40:53PM -0500, Krishna Pratap wrote:
> Thanks for the help. that "ip" in the match fixed all the problems .
> this is the flow that i applied
> ovs-ofctl -O OpenFlow13  add-flow br0
> in_port=254,ip,actions=output:1,mod_nw_src:'192.1.1.1',controller:6633
> 
> on a side note, you mentioned about  "controller:6633". were you pointing
> out the incorrect port number? or anything else you would like to
> highlight. ?

I was pointing out that the operand to "controller" isn't a port
number.  Please read the documentation.

From masoom.alam at wanclouds.net  Fri Feb  6 20:02:48 2015
From: masoom.alam at wanclouds.net (masoom alam)
Date: Fri, 6 Feb 2015 20:02:48 -0800
Subject: [ovs-discuss] BUG in OpenVswitch version
Message-ID: <CABk5PjL6K9uqpzvC4qCLjoD8vOayJABt94E1P7nQvm6Fq9Gjbw@mail.gmail.com>

Hi every one,

Can any one spot why the following bug will appear in Openstack leaving all
services of Neutron to unusable state....?

To give you an idea that I was trying:

"I tried to configure 173.39.237.0 ip to a VM, with the CIDR 173.39.236.0/23,
however the OVS gave error and now all the neutron services are completely
unusable"

2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent Traceback (most recent
call last):
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
"/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
line 1197, in rpc_loop
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent     port_info =
self.scan_ports(ports, updated_ports_copy)
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
"/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
line 821, in scan_ports
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent
updated_ports.update(self.check_changed_vlans(registered_ports))
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
"/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
line 848, in check_changed_vlans
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent     port_tags =
self.int_br.get_port_tag_dict()
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
"/opt/stack/neutron/neutron/agent/linux/ovs_lib.py", line 394, in
get_port_tag_dict
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent     result =
self.run_vsctl(args, check_error=True)
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
"/opt/stack/neutron/neutron/agent/linux/ovs_lib.py", line 67, in run_vsctl
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent     return
utils.execute(full_args, root_helper=self.root_helper)
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
"/opt/stack/neutron/neutron/agent/linux/utils.py", line 75, in execute
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent     raise
RuntimeError(m)
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent RuntimeError:
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent Command: ['sudo',
'/usr/local/bin/neutron-rootwrap', '/etc/neutron/rootwrap.conf',
'ovs-vsctl', '--timeout=10', '--format=json', '--', '--columns=name,tag',
'list', 'Port']
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent Exit code: 1
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent Stdout: ''
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent Stderr: 'Traceback
(most recent call last):\n  File "/usr/local/bin/neutron-rootwrap", line 4,
in <module>\n
 __import__(\'pkg_resources\').require(\'neutron==2013.2.4.dev32\')\n  File
"/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
3018, in <module>\n    working_set = WorkingSet._build_master()\n  File
"/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
614, in _build_master\n    return
cls._build_from_requirements(__requires__)\n  File
"/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
627, in _build_from_requirements\n    dists = ws.resolve(reqs,
Environment())\n  File
"/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
805, in resolve\n    raise
DistributionNotFound(req)\npkg_resources.DistributionNotFound:
alembic<0.6.4,>=0.4.1\n'
2015-02-04 05:25:06.993 TRACE
neutron.plugins.openvswitch.agent.ovs_neutron_agent
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150206/a558c9d4/attachment-0001.html>

From masoom.alam at wanclouds.net  Fri Feb  6 20:05:53 2015
From: masoom.alam at wanclouds.net (masoom alam)
Date: Fri, 6 Feb 2015 20:05:53 -0800
Subject: [ovs-discuss] BUG in OpenVswitch version
In-Reply-To: <CABk5PjL6K9uqpzvC4qCLjoD8vOayJABt94E1P7nQvm6Fq9Gjbw@mail.gmail.com>
References: <CABk5PjL6K9uqpzvC4qCLjoD8vOayJABt94E1P7nQvm6Fq9Gjbw@mail.gmail.com>
Message-ID: <CABk5PjK11f7qEzSdBemDCN99Z+H_QFVYPmzSwSyprZ9eyC=xHg@mail.gmail.com>

openvswitch version:

ovs-vswitchd (Open vSwitch) 1.4.6



On Fri, Feb 6, 2015 at 8:02 PM, masoom alam <masoom.alam at wanclouds.net>
wrote:

> Hi every one,
>
> Can any one spot why the following bug will appear in Openstack leaving
> all services of Neutron to unusable state....?
>
> To give you an idea that I was trying:
>
> "I tried to configure 173.39.237.0 ip to a VM, with the CIDR
> 173.39.236.0/23, however the OVS gave error and now all the neutron
> services are completely unusable"
>
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Traceback (most recent
> call last):
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
> line 1197, in rpc_loop
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     port_info =
> self.scan_ports(ports, updated_ports_copy)
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
> line 821, in scan_ports
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent
> updated_ports.update(self.check_changed_vlans(registered_ports))
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
> line 848, in check_changed_vlans
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     port_tags =
> self.int_br.get_port_tag_dict()
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/agent/linux/ovs_lib.py", line 394, in
> get_port_tag_dict
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     result =
> self.run_vsctl(args, check_error=True)
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/agent/linux/ovs_lib.py", line 67, in run_vsctl
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     return
> utils.execute(full_args, root_helper=self.root_helper)
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/agent/linux/utils.py", line 75, in execute
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     raise
> RuntimeError(m)
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent RuntimeError:
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Command: ['sudo',
> '/usr/local/bin/neutron-rootwrap', '/etc/neutron/rootwrap.conf',
> 'ovs-vsctl', '--timeout=10', '--format=json', '--', '--columns=name,tag',
> 'list', 'Port']
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Exit code: 1
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Stdout: ''
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Stderr: 'Traceback
> (most recent call last):\n  File "/usr/local/bin/neutron-rootwrap", line 4,
> in <module>\n
>  __import__(\'pkg_resources\').require(\'neutron==2013.2.4.dev32\')\n  File
> "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> 3018, in <module>\n    working_set = WorkingSet._build_master()\n  File
> "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> 614, in _build_master\n    return
> cls._build_from_requirements(__requires__)\n  File
> "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> 627, in _build_from_requirements\n    dists = ws.resolve(reqs,
> Environment())\n  File
> "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> 805, in resolve\n    raise
> DistributionNotFound(req)\npkg_resources.DistributionNotFound:
> alembic<0.6.4,>=0.4.1\n'
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150206/757ba06f/attachment.html>

From blp at nicira.com  Fri Feb  6 23:06:01 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Feb 2015 23:06:01 -0800
Subject: [ovs-discuss] BUG in OpenVswitch version
In-Reply-To: <CABk5PjL6K9uqpzvC4qCLjoD8vOayJABt94E1P7nQvm6Fq9Gjbw@mail.gmail.com>
References: <CABk5PjL6K9uqpzvC4qCLjoD8vOayJABt94E1P7nQvm6Fq9Gjbw@mail.gmail.com>
Message-ID: <20150207070601.GC6351@nicira.com>

Unless you're very lucky no one here will be able to guess what's
wrong.  An error from an OpenStack service is going to be meaningless to
most Open vSwitch experts.  I'd start by trying an appropriate OpenStack
mailing list; once they've dug into the problem, they may direct you
back here with a more specific question.

On Fri, Feb 06, 2015 at 08:02:48PM -0800, masoom alam wrote:
> Hi every one,
> 
> Can any one spot why the following bug will appear in Openstack leaving all
> services of Neutron to unusable state....?
> 
> To give you an idea that I was trying:
> 
> "I tried to configure 173.39.237.0 ip to a VM, with the CIDR 173.39.236.0/23,
> however the OVS gave error and now all the neutron services are completely
> unusable"
> 
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Traceback (most recent
> call last):
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
> line 1197, in rpc_loop
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     port_info =
> self.scan_ports(ports, updated_ports_copy)
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
> line 821, in scan_ports
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent
> updated_ports.update(self.check_changed_vlans(registered_ports))
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
> line 848, in check_changed_vlans
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     port_tags =
> self.int_br.get_port_tag_dict()
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/agent/linux/ovs_lib.py", line 394, in
> get_port_tag_dict
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     result =
> self.run_vsctl(args, check_error=True)
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/agent/linux/ovs_lib.py", line 67, in run_vsctl
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     return
> utils.execute(full_args, root_helper=self.root_helper)
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> "/opt/stack/neutron/neutron/agent/linux/utils.py", line 75, in execute
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent     raise
> RuntimeError(m)
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent RuntimeError:
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Command: ['sudo',
> '/usr/local/bin/neutron-rootwrap', '/etc/neutron/rootwrap.conf',
> 'ovs-vsctl', '--timeout=10', '--format=json', '--', '--columns=name,tag',
> 'list', 'Port']
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Exit code: 1
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Stdout: ''
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent Stderr: 'Traceback
> (most recent call last):\n  File "/usr/local/bin/neutron-rootwrap", line 4,
> in <module>\n
>  __import__(\'pkg_resources\').require(\'neutron==2013.2.4.dev32\')\n  File
> "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> 3018, in <module>\n    working_set = WorkingSet._build_master()\n  File
> "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> 614, in _build_master\n    return
> cls._build_from_requirements(__requires__)\n  File
> "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> 627, in _build_from_requirements\n    dists = ws.resolve(reqs,
> Environment())\n  File
> "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> 805, in resolve\n    raise
> DistributionNotFound(req)\npkg_resources.DistributionNotFound:
> alembic<0.6.4,>=0.4.1\n'
> 2015-02-04 05:25:06.993 TRACE
> neutron.plugins.openvswitch.agent.ovs_neutron_agent

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Fri Feb  6 23:06:21 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Feb 2015 23:06:21 -0800
Subject: [ovs-discuss] BUG in OpenVswitch version
In-Reply-To: <CABk5PjK11f7qEzSdBemDCN99Z+H_QFVYPmzSwSyprZ9eyC=xHg@mail.gmail.com>
References: <CABk5PjL6K9uqpzvC4qCLjoD8vOayJABt94E1P7nQvm6Fq9Gjbw@mail.gmail.com>
 <CABk5PjK11f7qEzSdBemDCN99Z+H_QFVYPmzSwSyprZ9eyC=xHg@mail.gmail.com>
Message-ID: <20150207070621.GD6351@nicira.com>

That's an antique.  I'd upgrade.

On Fri, Feb 06, 2015 at 08:05:53PM -0800, masoom alam wrote:
> openvswitch version:
> 
> ovs-vswitchd (Open vSwitch) 1.4.6
> 
> 
> 
> On Fri, Feb 6, 2015 at 8:02 PM, masoom alam <masoom.alam at wanclouds.net>
> wrote:
> 
> > Hi every one,
> >
> > Can any one spot why the following bug will appear in Openstack leaving
> > all services of Neutron to unusable state....?
> >
> > To give you an idea that I was trying:
> >
> > "I tried to configure 173.39.237.0 ip to a VM, with the CIDR
> > 173.39.236.0/23, however the OVS gave error and now all the neutron
> > services are completely unusable"
> >
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent Traceback (most recent
> > call last):
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> > "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
> > line 1197, in rpc_loop
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent     port_info =
> > self.scan_ports(ports, updated_ports_copy)
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> > "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
> > line 821, in scan_ports
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent
> > updated_ports.update(self.check_changed_vlans(registered_ports))
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> > "/opt/stack/neutron/neutron/plugins/openvswitch/agent/ovs_neutron_agent.py",
> > line 848, in check_changed_vlans
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent     port_tags =
> > self.int_br.get_port_tag_dict()
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> > "/opt/stack/neutron/neutron/agent/linux/ovs_lib.py", line 394, in
> > get_port_tag_dict
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent     result =
> > self.run_vsctl(args, check_error=True)
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> > "/opt/stack/neutron/neutron/agent/linux/ovs_lib.py", line 67, in run_vsctl
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent     return
> > utils.execute(full_args, root_helper=self.root_helper)
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent   File
> > "/opt/stack/neutron/neutron/agent/linux/utils.py", line 75, in execute
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent     raise
> > RuntimeError(m)
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent RuntimeError:
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent Command: ['sudo',
> > '/usr/local/bin/neutron-rootwrap', '/etc/neutron/rootwrap.conf',
> > 'ovs-vsctl', '--timeout=10', '--format=json', '--', '--columns=name,tag',
> > 'list', 'Port']
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent Exit code: 1
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent Stdout: ''
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent Stderr: 'Traceback
> > (most recent call last):\n  File "/usr/local/bin/neutron-rootwrap", line 4,
> > in <module>\n
> >  __import__(\'pkg_resources\').require(\'neutron==2013.2.4.dev32\')\n  File
> > "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> > 3018, in <module>\n    working_set = WorkingSet._build_master()\n  File
> > "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> > 614, in _build_master\n    return
> > cls._build_from_requirements(__requires__)\n  File
> > "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> > 627, in _build_from_requirements\n    dists = ws.resolve(reqs,
> > Environment())\n  File
> > "/usr/local/lib/python2.7/dist-packages/pkg_resources/__init__.py", line
> > 805, in resolve\n    raise
> > DistributionNotFound(req)\npkg_resources.DistributionNotFound:
> > alembic<0.6.4,>=0.4.1\n'
> > 2015-02-04 05:25:06.993 TRACE
> > neutron.plugins.openvswitch.agent.ovs_neutron_agent
> >

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Fri Feb  6 23:18:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Feb 2015 23:18:42 -0800
Subject: [ovs-discuss] OVS-controller crashing on enabling SSL on
 Mininet Environment
In-Reply-To: <CACHK9BEE1W7kNq4G9bdJBFQ5dBXBnELwUZL3028xKD-C8uc6ng@mail.gmail.com>
References: <CACHK9BGp9Pan6mY=NS3n5zgOy_LR_CX-gBnenGqhumKEeJTWoQ@mail.gmail.com>
 <20150203185907.GN18144@nicira.com>
 <CACHK9BG9tfx3m1guJpxhpw_EY-MzurNGGA0ziYxKFVLWfUaG7A@mail.gmail.com>
 <20150204055907.GB19349@nicira.com>
 <CACHK9BGpbATheFSZw8c4Nr_Jwc53XT6FvjK4_L4B=OYeW4dksA@mail.gmail.com>
 <20150204175547.GB5737@nicira.com>
 <CACHK9BEE1W7kNq4G9bdJBFQ5dBXBnELwUZL3028xKD-C8uc6ng@mail.gmail.com>
Message-ID: <20150207071842.GI6351@nicira.com>

Hi Ruchika.

Can you get a coredump from OVS, then a backtrace?

Thanks,

Ben.

On Thu, Feb 05, 2015 at 09:52:38AM +0530, Ruchika Verma wrote:
> hi Ben,
> 
> I tried this with 2.0.2 as well and i see crash with that OVS-Vesion as
> well.
> 
> As i am new to SDN and OVS-Controller I hope the settings done are correct?
> And no additional settings/configuration changes are required? Request you
> to please check that once and let me know.
> 
> BR,
> Ruchika
> 
> On Wed, Feb 4, 2015 at 11:25 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Please don't drop the list.
> >
> > That's a really old version.  Does it happen with 1.9.3?
> >
> > On Wed, Feb 04, 2015 at 02:51:04PM +0530, Ruchika Verma wrote:
> > > sorry missed that information ovs version is 1.9.0
> > >
> > > On Wed, Feb 4, 2015 at 11:29 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > What version of OVS is this?
> > > >
> > > > On Tue, Feb 03, 2015 at 09:48:13PM -0800, Ruchika Verma wrote:
> > > > > hi Ben,
> > > > >
> > > > > please find the backtrace attached.
> > > > >
> > > > > Regards
> > > > > Ruchika???
> > > > >  error_ssl.txt
> > > > > <
> > > >
> > https://docs.google.com/file/d/0B7Bgk_t_PzaGQlF3eklQQjN3NGM/edit?usp=drive_web
> > > > >
> > > > > ???
> > > > >
> > > > > On Tue, Feb 3, 2015 at 10:59 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > > >
> > > > > > On Tue, Feb 03, 2015 at 12:07:02PM +0530, Ruchika Verma wrote:
> > > > > > > hi,
> > > > > > >
> > > > > > > I am running ovs-controller with SSL enabled option using
> > command -
> > > > > > >
> > > > > > >     sudo ovs-controller -v pssl:6633  -p
> > > > /mininet/mininet/ctl-privkey.pem
> > > > > > > -c /mininet/mininet/ctl-cert.pem -C
> > > > > > > /var/lib/openvswitch/pki/switchca/cacert.pem
> > > > > > >
> > > > > > > I have enabled BOOTSTRAP option at switch through -
> > > > > > >
> > > > > > > ovs-vsctl -- --bootstrap set-ssl /mininet/mininet/sc-privkey.pem
> > > > > > > /mininet/mininet/sc-cert.pem /etc/openvswitch/cacert.pem
> > > > > > >
> > > > > > > the keys and certificates are generated as -
> > > > > > >
> > > > > > > sudo ovs-pki req+sign ctl controller
> > > > > > > sudo ovs-pki req+sign sc switch
> > > > > > >
> > > > > > > Now when i create the OpenVSwitch in virtual environment (on
> > > > mininet),
> > > > > > > using command -
> > > > > > >
> > > > > > > sudo mn --topo=linear,1 --controller=remote
> > > > > > >
> > > > > > > I get following error and OVS-Controller crashes after sometime.
> > On
> > > > > > mininet
> > > > > > > window however the topology is created successfully.
> > > > > >
> > > > > > What version of OVS is this?
> > > > > >
> > > > > > Can you provide a backtrace for the crash?
> > > > > >
> > > >
> >

From rukhsana.ansari at oneconvergence.com  Wed Feb 11 12:17:48 2015
From: rukhsana.ansari at oneconvergence.com (Rukhsana Ansari)
Date: Wed, 11 Feb 2015 12:17:48 -0800
Subject: [ovs-discuss] configuration of vxlans
In-Reply-To: <CAP5z0CA--3tQY4jj2OW8=DPks2fVY-Yi1YAY-sYUA_VSTmm4kQ@mail.gmail.com>
References: <CAP5z0CA--3tQY4jj2OW8=DPks2fVY-Yi1YAY-sYUA_VSTmm4kQ@mail.gmail.com>
Message-ID: <CAMkjQ1dVfbJGjQ=-WMHXfX0eu=6gObObc8PFBYt6JRLxpkodBQ@mail.gmail.com>

The vxlan section of OVS FAQ provides a concise description:
http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=FAQ;hb=HEAD

Couple of other links:
Configuring VXLan and GRE tunnels on OpenvSwitch
<http://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=0CCAQFjAA&url=http%3A%2F%2Fnetworkstatic.net%2Fconfiguring-vxlan-and-gre-tunnels-on-openvswitch%2F&ei=3bfbVM_WOcqpogS-loD4CQ&usg=AFQjCNEQOYEFaqzHNldmPlixlXXSBHe5bg&bvm=bv.85761416,d.cGU>
13.4.4. Configure Open vSwitch Tunnels
<https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=2&ved=0CCYQFjAB&url=https%3A%2F%2Faccess.redhat.com%2Fdocumentation%2Fen-US%2FRed_Hat_Enterprise_Linux_OpenStack_Platform%2F4%2Fhtml%2FInstallation_and_Configuration_Guide%2FConfiguring_Open_vSwitch_tunnels.html&ei=3bfbVM_WOcqpogS-loD4CQ&usg=AFQjCNHKUhWWqwWvdLwYxNIiifYh4L3edA&bvm=bv.85761416,d.cGU>
VXLAN overlay networks with Open vSwitch - YouTube
<http://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=3&cad=rja&uact=8&ved=0CCwQtwIwAg&url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DtnSkHhsLqpM&ei=3bfbVM_WOcqpogS-loD4CQ&usg=AFQjCNErGAGm2FTenBrzXiEdwqT8Y9yXwQ&bvm=bv.85761416,d.cGU>

-Rukhsana

On Fri, Feb 6, 2015 at 7:04 AM, Flora Mittal <mittal.flora at gmail.com> wrote:

> Hi All,
>
>       We are new to Networking and we need to experiment how vxlans work.
> So we need to have multiple interfaces to the outgoing port, so that each
> interface can act
> as a pipe for the packets for that virtual Lan.
> Can you please give a good link from where we can get this info.
> The man pages are very long, and we need the info ASAP.
>
> Thanks.
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/08683f4a/attachment.html>

From benoitne at gmail.com  Wed Feb 11 01:32:17 2015
From: benoitne at gmail.com (Ben)
Date: Wed, 11 Feb 2015 10:32:17 +0100
Subject: [ovs-discuss] OVS + Docker (namespace)
Message-ID: <54DB21A1.9030406@gmail.com>

Hi,

I am starting to work with Docker and saw an section at the end of this 
article (http://www.opencloudblog.com/?p=66).
Basically I am creating some containers and want to use ovs for virtual 
switching purpose.

On my host, OVS(2.3.1) & Docker(1.4.1) are installed.
What I am doing :

ovs-vsctl add-port vswitch-untrust vlan8 tag=8 -- set Interface vlan8 
type=internal
ovs-vsctl add-port vswitch-untrust vlan9 tag=9 -- set Interface vlan9 
type=internal

Then I am retrieving the pid of the new containers thanks to a docker 
command (sudo docker inspect -f '{{.State.Pid}}' id)
Then I am moving the interface into the container's workspace :
ip link set vlan8 netns pid
ip link set vlan9 netns pid

Firing up the interface
ip netns exec pid ip link set vlan8 up
ip netns exec pid ip link set vlan9 up

Giving an IP address
ip netns exec pid_master ip addr add 10.20.8.254/24 dev vlan8
ip netns exec pid_master ip addr add 10.20.9.254/24 dev vlan9

Everything is working as expected expect one thing :
When I tried to stop the container and start it again I am in a strange 
situation where the vlan8 & vlan9 are present in ovs-vsctl but not on 
the default workspace as they have move to the container workspace! If I 
try to delete vlan8 or vlan0 with ovs-vsctl del-port then I got a kernel 
panic :(

Is there a proper way to deal with ovs and namespace? If anyone has some 
experience with ovs & docker I would love to hear about that...
Many thanks

belette
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/a549101a/attachment.html>

From djhon9813 at gmail.com  Tue Feb 10 22:58:37 2015
From: djhon9813 at gmail.com (david jhon)
Date: Wed, 11 Feb 2015 11:58:37 +0500
Subject: [ovs-discuss] debugging openvswitch command-line clients
In-Reply-To: <20150203165144.GH18144@nicira.com>
References: <CANPUzQ0hmMBdRLt5rg7GOV7mQf_WM3jxTR5_k_SZ-V4TYcYFxg@mail.gmail.com>
 <20150201215439.GC24647@nicira.com>
 <CANPUzQ0qwW65PVUvwKQxvyZLtBwqd--dWh7fSx4XJK82uT+6jA@mail.gmail.com>
 <20150203165144.GH18144@nicira.com>
Message-ID: <CANPUzQ0gsrzzxvSL_H6cF6d3EbTjoi6YjVytC4OJUvCqqyOX2A@mail.gmail.com>

Hi Ben,

I have been striving hard lately to debug openvswitch after building it
from source on Ubuntu 14.04, but still not successful. Could you please
suggest me some document or link which might be helpful for a noob to get
his hands dirty on ovs debugging and development.

Waiting for your response...................

On Tue, Feb 3, 2015 at 9:51 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Feb 03, 2015 at 12:12:09AM +0500, david jhon wrote:
> > Hi Ben,
> >
> > Thanks for your response.
> >
> > It means that after setting up a break point at cmd_show() method and
> > attaching gdb to ovsdb-server pid (i.e., gdb ovs-vsctl.o
> > --pid=ovsdb-serverpid), I am not able to debug this specific file as
> single
> > stepping results in the following output:
> >      (gdb) n
> >      Single stepping until exit from function __kernel_vsyscall,
> >      which has no line number information.
> >      Warning:
> >      Cannot insert breakpoint 1.
> >      Cannot access memory at address 0x9353
> >
> > please guide me what I am doing wrong. how gdb can be used to debug
> > openvswitch. Thank you!
>
> That's not anything OVS-specific.  It means that you can't single-step
> into a system call.  If you need more information, then please ask about
> it on a GDB or Linux-kernel mailing list.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/456c5878/attachment.html>

From alexw at nicira.com  Mon Feb  9 09:01:54 2015
From: alexw at nicira.com (Alex Wang)
Date: Mon, 9 Feb 2015 09:01:54 -0800
Subject: [ovs-discuss] In flow entries should 'action' be set to normal
 for BFD control packets
In-Reply-To: <CACveyyL7W=1y-BA3ruhz0AvUgn=7NYcBKRCF6FCiCdauN1BgHg@mail.gmail.com>
References: <CACveyy+9K4DH_2LUFRyGUpf4d_3_T3HQEYoSZYSm8ksEUC+y1Q@mail.gmail.com>
 <CAArS4XWv_M3WJUK0EsyZtS67Q_hJN2h3OOqZmukw_SCU8CPFqg@mail.gmail.com>
 <CACveyyL7W=1y-BA3ruhz0AvUgn=7NYcBKRCF6FCiCdauN1BgHg@mail.gmail.com>
Message-ID: <CAArS4XXSNsvAMGX4DtCnUP60y3oNRhZmfz3+RPXrHDFgDoOjrQ@mail.gmail.com>

On Mon, Feb 9, 2015 at 6:26 AM, Padma Jayasankar <padmajs80 at gmail.com>
wrote:

> Hi,
>  I want to monitor the links that form a path between two hosts. when any
> of the link fails the source switch has to be intimated so that it can
> reroute the traffic through the next alive bucket. for this bfd session has
> to be established between the the source switch and destination
> switch(which are connected to the respective hosts).
>  Now i am able to enable bfd for those to switches using ovs-vsctl
> commands. i also added flow entries for BFD packets, in the switches that
> lie in the path.when a link fails in the path, bfd state of these switches
> is changes to 'down' and when the link is up again , it again changes to
> 'up'. So i thought it supports multi-hop. Is it not so? I am using OVS
> 2.1.1. Please clarify.
>


No, it does not support multi-hop.  If the intermediate switches just
forward
using flows and do not decrement the ttl, then, it could work but it is not
really
multi-hop.  When you have intermediate vendor routers, the ttl of the udp
packets will change.  In ovs bfd implementation, the received udp packet
must have TTL=255.

Thanks,
Alex Wang,


> Thanks and Regards,
> Padma V
>
> On Tue, Feb 3, 2015 at 11:26 PM, Alex Wang <alexw at nicira.com> wrote:
>
>>
>>
>> On Sun, Feb 1, 2015 at 8:43 PM, Padma Jayasankar <padmajs80 at gmail.com>
>> wrote:
>>
>>> Hi,
>>>   I have to use BFD for failure detection and when i went through some
>>> examples the action field for the flow entries were set to 'Normal". Can't
>>> we use 'output' action. In that case i have to add two entries (one for
>>> each direction). Please claridy
>>>
>>
>>
>> The BFD implementation in OVS is mainly used for tunnel link failure
>> detection.  You need to have a tunnel port first and then can you enable
>> bfd on the tunnel port.  The BFD state machine in OVS will compose/send
>> control packets through the tunnel... No OpenFlow rules are involved...
>>
>> We currently do not support multi-hop bfd.
>>
>> However, at this time, it is still unclear what kind of link
>> (tunnel/point-to-point physical link) you want you monitor... maybe you
>> should clarify first,
>>
>> Thanks,
>> Alex Wang,
>>
>>
>>> Thanks and Regards,
>>> Padma V
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150209/c8ed0c1c/attachment-0001.html>

From blp at nicira.com  Mon Feb  9 10:47:31 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 9 Feb 2015 10:47:31 -0800
Subject: [ovs-discuss] mailing list archive down?
Message-ID: <20150209184731.GB2168@nicira.com>

The mailing list archive seems to me to be down.  Can you check?

From hardik.soni at inria.fr  Mon Feb  9 02:19:05 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Mon, 9 Feb 2015 11:19:05 +0100 (CET)
Subject: [ovs-discuss] wireless interface support on OVS
In-Reply-To: <645161483.22514596.1423476942570.JavaMail.zimbra@inria.fr>
Message-ID: <1248427269.22518279.1423477145418.JavaMail.zimbra@inria.fr>

Hi All, 

I would like to know if anyone is working on providing wireless interface support with OVS. 

I have read the FAQ. I know that it is not the limitation of OVS. 
I also know that openwrt exists for this purpose but for embedded devices. 

Thanks, 
Hardik Soni 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150209/6b306622/attachment.html>

From kevin.traynor at intel.com  Wed Feb 11 02:16:26 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Wed, 11 Feb 2015 10:16:26 +0000
Subject: [ovs-discuss] Tunneling and vhost support for dpdk
In-Reply-To: <93A3A2A2-68B1-4DDC-88A0-5D9566451E2B@att.com>
References: <75F26445-256F-4335-B0FE-4E87F2A079D3@att.com>
 <20141122184218.GA12309@nicira.com>
 <6FF294DC-8EEB-4542-99D2-E1184463ED92@nicira.com>
 <1263C341-A91F-45F1-8AE2-CCAA0334DD36@att.com>
 <BC0FEEC7D7650749874CEC11314A88F730685622@IRSMSX104.ger.corp.intel.com>
 <93A3A2A2-68B1-4DDC-88A0-5D9566451E2B@att.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F730695618@IRSMSX102.ger.corp.intel.com>


> -----Original Message-----
> From: MCGRATH, GIL [mailto:gm2391 at att.com]
> Sent: Tuesday, February 3, 2015 5:00 PM
> To: Traynor, Kevin; Justin Pettit; Ben Pfaff
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Tunneling and vhost support for dpdk
> 
> A few questions:
> 
> Can I use the linux bonding driver and bind the dpdk port to bond0?
> If not (which I suspect), can I do LACP bonding in OVS when using DPDK?

No, it's not supported at present

> 
> If I apply the dpdk vhost patches as described below should I build OVS
> with IVSHMEM?

Assuming you mean link OVS against a DPDK build with ivshmem enabled, 
then that's what I would normally do and it works fine. 

I can't think of any reason you shouldn't be able to use vhost without 
ivshmem, but I can't say I run it. 

> 
> — Gil
> 
> 
> 
> On 1/30/15, 6:57 PM, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:
> 
> >
> >> -----Original Message-----
> >> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> >>MCGRATH, GIL
> >> Sent: Friday, January 30, 2015 3:53 PM
> >> To: Justin Pettit; Ben Pfaff
> >> Cc: discuss at openvswitch.org
> >> Subject: Re: [ovs-discuss] Tunneling and vhost support for dpdk
> >>
> >> Checking again on whether support for VhostNet is integrated in OVS DPDK
> >> yet - if so I assume I can just use the version from trunk in github.
> >
> >It's not upstreamed into OVS yet. The model now will be slightly
> >different as a
> >vhost library now exists in DPDK 1.8. If you want to try it out have a
> >look at
> >this post
> >http://www.openvswitch.org/pipermail/dev/2015-January/050278.html
> >
> >>
> >>
> >>
> >> On 11/22/14, 6:55 PM, "Justin Pettit" <jpettit at nicira.com> wrote:
> >>
> >> >
> >> >> On Nov 22, 2014, at 10:42 AM, Ben Pfaff <blp at nicira.com> wrote:
> >> >>
> >> >> On Sat, Nov 22, 2014 at 03:00:48PM +0000, MCGRATH, GIL wrote:
> >> >>> Has tunneling support and vhost support for dpdk been integrated
> >>yet?
> >> >>> I assume the tunneling includes vxlan?
> >> >>
> >> >> Yes, see README-native-tunneling.md.
> >> >
> >> >Just to be clear, though, I don't believe vhost support is integrated
> >> >yet.  We spoke with Intel at the OVS Conference this week, and they're
> >>in
> >> >the process of re-spinning the patches based on feedback they received.
> >> >
> >> >--Justin
> >> >
> >> >
> >> _______________________________________________
> >> discuss mailing list
> >> discuss at openvswitch.org
> >> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Mon Feb  9 11:12:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 9 Feb 2015 11:12:02 -0800
Subject: [ovs-discuss] looking for a good explanation of core dumps and
	backtraces
Message-ID: <20150209191202.GC2168@nicira.com>

Occasionally (as today) I find myself asking a user to get a core dump
and a backtrace, and find that the user doesn't have any of the skills
or knowledge to do that.  Does anyone know of a good document that
walks a user through how to do this (not necessarily OVS-specific)?  I
don't want to hand-hold but I do want to help.

Thanks,

Ben.

From hex0x5f at gmail.com  Sat Feb  7 11:05:51 2015
From: hex0x5f at gmail.com (0x5f 0x5f)
Date: Sat, 7 Feb 2015 21:05:51 +0200
Subject: [ovs-discuss] OVSSwitch STP
Message-ID: <CAOcyfUmAZw9iQa4vORrS7Hb5iouG3ZowpgyFSHc5xVW9B1Cbmw@mail.gmail.com>

Hello,
I've created a custom Switch in Mininet by deriving from OVSSwitch and
enabling STP
actually using the following commands:

ovs-vsctl set-fail-mode s1 standalone
ovs-vsctl set-controller s1
ovs-vsctl set Bridge s1 stp-enable=true

when testing the network, every host can ping other host in
a topology with loops.

However, when I dump flows from s1, the flow I see is wildcarded and
its action is NORMAL.

How can get to the information of the actual spanning tree and connections ?
Is it possible to modify this action to be not NORMAL ?

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150207/b0aaef5d/attachment.html>

From davidjoshuaevans at gmail.com  Tue Feb 10 13:52:08 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Tue, 10 Feb 2015 15:52:08 -0600
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
Message-ID: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>

Hi OVS,

I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1

I find that the outer ip & mac are not populated ???  The ofproto/trace
output thinks that the gre output will have the right src/dest on the outer
but then it¹s gone
1. a bug? 
2. am I missing some setup?
3. Wrong kernel ip_gre?
Originating GRE:
ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
options:remote_ip=192.168.56.101
ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk

Output Bridge:
ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
ifconfig b1 192.168.56.102 netmask 255.255.255.0

Set up flows:
ovs-ofctl del-flows b0
ovs-ofctl del-flows b1
-force traffic to gre from dpdk0
ovs-ofctl add-flow b0 in_port=2,action=output:1
ovs-ofctl add-flow b0 in_port=1,action=output:0
-force traffic from b1 to output
ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL

A ofproto/trace says

ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
Bridge: b0
Flow: 
in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:cd,
dl_type=0x0000

Rule: table=0 cookie=0 in_port=1
OpenFlow actions=output:2

Final flow: 
in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:cd,
dl_type=0x0000
Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
Datapath actions: 
tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,src=00:
e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.56.101,pr
oto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),out_port(2))


Regards,

Dave


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150210/3a187526/attachment-0001.html>

From pg201372016 at iitj.ac.in  Sun Feb  8 22:44:59 2015
From: pg201372016 at iitj.ac.in (Sumit Paliwal)
Date: Mon, 9 Feb 2015 12:14:59 +0530
Subject: [ovs-discuss] use of datapath/vport in OVS
Message-ID: <CAEhKQHJmkAaVg2zKXJ=6A=ntgq4XQ7BnakPiZJmyu0_dGCOKMg@mail.gmail.com>

Hello everyone,

I'm in a little bit confusion here.
I've read that there are 2 dpif implementations in ovs named as dpif-linux
and dpif-netdev.

I want to know :-
1. which implementation is used by default in mininet environment and how
to switch     to other one.
2. What is the use of the code written under datapath directory. As i tried
to change the code of datapath/vport.c, but there was no effect on the
output.
So how does this datapath/ directory serves the purpose.


Thanks & Regards,
-- 
Sumit Paliwal
M.Tech. ICT,
IIT Jodhpur


*"Have a great Day... "*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150209/272d081f/attachment.html>

From yaroni at radcom.com  Wed Feb 11 09:14:15 2015
From: yaroni at radcom.com (Yaron Illouz)
Date: Wed, 11 Feb 2015 19:14:15 +0200
Subject: [ovs-discuss] qvb filter level
Message-ID: <1A791056FCD70F458405B58B79F5C2F706D2071A@rad-w2ksrv11>

 

 

Hi 

 

I am trying to do port mirroring between vms.

I did it with the openvswitch.

Packet are copied to the mirrored qvo, but then stop at the qvb Rx. I
don't see where it is stuck.

>From iptable output it dosen't seem to be drop in one of the chain or
many packet in fallback.

Iptables are at qvb level? If not so what block my packets

 

 

You can see only 201 packet reach qbr but more than 72 Million packet
arrived to qvb

ifconfig | grep -A 5 3ede5b3

qbr3ede5b3e-39: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500

        inet6 fe80::e4ae:56ff:fe5f:137d  prefixlen 64  scopeid
0x20<link>

        ether aa:8c:e8:75:72:d2  txqueuelen 0  (Ethernet)

        RX packets 201  bytes 16528 (16.1 KiB)

        RX errors 0  dropped 0  overruns 0  frame 0

        TX packets 8  bytes 648 (648.0 B)

--

qvb3ede5b3e-39: flags=4419<UP,BROADCAST,RUNNING,PROMISC,MULTICAST>  mtu
1500

        inet6 fe80::a88c:e8ff:fe75:72d2  prefixlen 64  scopeid
0x20<link>

        ether aa:8c:e8:75:72:d2  txqueuelen 1000  (Ethernet)

        RX packets 72789130  bytes 20271610754 (18.8 GiB)

        RX errors 0  dropped 0  overruns 0  frame 0

        TX packets 30  bytes 3394 (3.3 KiB)

--

qvo3ede5b3e-39: flags=4419<UP,BROADCAST,RUNNING,PROMISC,MULTICAST>  mtu
1500

        inet6 fe80::c70:cff:fef0:d432  prefixlen 64  scopeid 0x20<link>

        ether 0e:70:0c:f0:d4:32  txqueuelen 1000  (Ethernet)

        RX packets 30  bytes 3394 (3.3 KiB)

        RX errors 0  dropped 0  overruns 0  frame 0

        TX packets 72789140  bytes 20271612780 (18.8 GiB)

--

tap3ede5b3e-39: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500

        inet6 fe80::fc16:3eff:fe3b:34de  prefixlen 64  scopeid
0x20<link>

        ether fe:16:3e:3b:34:de  txqueuelen 500  (Ethernet)

        RX packets 15  bytes 2188 (2.1 KiB)

        RX errors 0  dropped 0  overruns 0  frame 0

        TX packets 3526  bytes 966661 (944.0 KiB)

 

 

Neutron port list

| 3ede5b3e-396e-48a9-b24a-6cb2dc7509fe |      | fa:16:3e:3b:34:de |
{"subnet_id": "f960ee77-77a8-45c1-8eef-e3878f0bea9f", "ip_address":
"10.67.82.2"}  |

| 435f35c6-80be-47ee-b30f-8376e1ea78d9 |      | fa:16:3e:41:fd:59 |
{"subnet_id": "f960ee77-77a8-45c1-8eef-e3878f0bea9f", "ip_address":
"10.67.82.5"}  |

| 89193daa-bf67-4237-8045-30a6e3c107a2 |      | fa:16:3e:a5:56:38 |
{"subnet_id": "f960ee77-77a8-45c1-8eef-e3878f0bea9f", "ip_address":
"10.67.82.4"}  |

| bd80bab5-424d-4e5c-8993-b8bb8c6f3e49 |      | fa:16:3e:f7:4f:ea |
{"subnet_id": "f960ee77-77a8-45c1-8eef-e3878f0bea9f", "ip_address":
"10.67.82.3"}  |

 

 

Command that I ran

ovs-vsctl -- set Bridge br-int mirrors=@m  -- --id=@qvobd80bab5-42 get
Port  qvobd80bab5-42 -- --id=@qvo3ede5b3e-39 get Port qvo3ede5b3e-39 --
--id=@m create Mirror name=mymirror select-dst-port=@qvobd80bab5-42
select-src-port=@qvobd80bab5-42 output-port=@qvo3ede5b3e-39

 

 

This is iptables output filtered, you can see I added a allowed address
pair.

3     3518  919K neutron-openvswi-sg-chain  all  --  *      *
0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-out
tap3ede5b3e-39 --physdev-is-bridged

4        4  1358 neutron-openvswi-sg-chain  all  --  *      *
0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-in
tap3ede5b3e-39 --physdev-is-bridged

 

Chain neutron-openvswi-INPUT (1 references)

--

2        0     0 neutron-openvswi-o3ede5b3e-3  all  --  *      *
0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-in
tap3ede5b3e-39 --physdev-is-bridged

3        0     0 neutron-openvswi-o7e200e92-4  all  --  *      *
0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-in
tap7e200e92-44 --physdev-is-bridged

4        0     0 neutron-openvswi-o435f35c6-8  all  --  *      *
0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-in
tap435f35c6-80 --physdev-is-bridged

5        0     0 neutron-openvswi-o6a1bb345-9  all  --  *      *
0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-in
tap6a1bb345-93 --physdev-is-bridged

6        0     0 neutron-openvswi-ofc0a7800-a  all  --  *      *
0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-in
tapfc0a7800-a0 --physdev-is-bridged

 

Chain neutron-openvswi-OUTPUT (1 references)

num   pkts bytes target     prot opt in     out     source
destination

 

Chain neutron-openvswi-i3ede5b3e-3 (1 references)

num   pkts bytes target     prot opt in     out     source
destination

1        0     0 DROP       all  --  *      *       0.0.0.0/0
0.0.0.0/0            state INVALID

2       91  8550 RETURN     all  --  *      *       0.0.0.0/0
0.0.0.0/0            state RELATED,ESTABLISHED

3        0     0 RETURN     udp  --  *      *       10.67.82.4
0.0.0.0/0            udp spt:67 dpt:68

4        0     0 RETURN     icmp --  *      *       0.0.0.0/0
0.0.0.0/0

5        0     0 RETURN     tcp  --  *      *       0.0.0.0/0
0.0.0.0/0            tcp multiport dports 1:65535

6     3416  907K RETURN     all  --  *      *       0.0.0.0/0
0.0.0.0/0            match-set IPv4ecb94f49-0fdd-4f6f-b src

7        9  3054 neutron-openvswi-sg-fallback  all  --  *      *
0.0.0.0/0            0.0.0.0/0

 

--

Chain neutron-openvswi-o3ede5b3e-3 (2 references)

num   pkts bytes target     prot opt in     out     source
destination

1        4  1358 RETURN     udp  --  *      *       0.0.0.0/0
0.0.0.0/0            udp spt:68 dpt:67

2        0     0 neutron-openvswi-s3ede5b3e-3  all  --  *      *
0.0.0.0/0            0.0.0.0/0

3        0     0 DROP       udp  --  *      *       0.0.0.0/0
0.0.0.0/0            udp spt:67 dpt:68

4        0     0 DROP       all  --  *      *       0.0.0.0/0
0.0.0.0/0            state INVALID

5        0     0 RETURN     all  --  *      *       0.0.0.0/0
0.0.0.0/0            state RELATED,ESTABLISHED

6        0     0 RETURN     all  --  *      *       0.0.0.0/0
0.0.0.0/0

7        0     0 neutron-openvswi-sg-fallback  all  --  *      *
0.0.0.0/0            0.0.0.0/0

 

--

Chain neutron-openvswi-s3ede5b3e-3 (1 references)

num   pkts bytes target     prot opt in     out     source
destination

1        0     0 RETURN     all  --  *      *       10.67.82.0/24
0.0.0.0/0            MAC FA:16:3E:41:FD:59

2        0     0 RETURN     all  --  *      *       10.67.82.2
0.0.0.0/0            MAC FA:16:3E:3B:34:DE

3        0     0 DROP       all  --  *      *       0.0.0.0/0
0.0.0.0/0

 

 

--

3     3518  919K neutron-openvswi-i3ede5b3e-3  all  --  *      *
0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-out
tap3ede5b3e-39 --physdev-is-bridged

4        4  1358 neutron-openvswi-o3ede5b3e-3  all  --  *      *
0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-in
tap3ede5b3e-39 --physdev-is-bridged

...

13    397M 1617G ACCEPT     all  --  *      *       0.0.0.0/0
0.0.0.0/0

 

--

error=`neutron-openvswi-i3ede5b3e-3'

 

Entry 63 (19664):

SRC IP: 0.0.0.0/0.0.0.0

DST IP: 0.0.0.0/0.0.0.0

Interface: `'/................to `'/................

Protocol: 0

Flags: 00

Invflags: 00

Counters: 0 packets, 0 bytes

Cache: 00000000

--

error=`neutron-openvswi-o3ede5b3e-3'

 

Entry 119 (32280):

SRC IP: 0.0.0.0/0.0.0.0

DST IP: 0.0.0.0/0.0.0.0

Interface: `'/................to `'/................

Protocol: 17

Flags: 00

Invflags: 00

Counters: 4 packets, 1358 bytes

Cache: 00000000

--

error=`neutron-openvswi-s3ede5b3e-3'

 

Entry 173 (43608):

SRC IP: 10.67.82.0/255.255.255.0

DST IP: 0.0.0.0/0.0.0.0

Interface: `'/................to `'/................

Protocol: 0

Flags: 00

Invflags: 00

Counters: 0 packets, 0 bytes

Cache: 00000000

 

 

 

 

 

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/ffb0ca62/attachment-0001.html>

From blp at nicira.com  Wed Feb 11 16:17:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 11 Feb 2015 16:17:26 -0800
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
Message-ID: <CACjuMbyXwdgRrxba9vsxFzeni+WrzN+QrMAm=tjwmTOHkAh=Ug@mail.gmail.com>

Pravin, I know that our DPDK native tunneling supports VXLAN.  David
is trying to use GRE.  Is this supported?

On Tue, Feb 10, 2015 at 1:52 PM, David Evans <davidjoshuaevans at gmail.com> wrote:
> Hi OVS,
>
> I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1
>
> I find that the outer ip & mac are not populated ???  The ofproto/trace
> output thinks that the gre output will have the right src/dest on the outer
> but then it’s gone…
>
> a bug?
> am I missing some setup?
> Wrong kernel ip_gre?
>
> Originating GRE:
> ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
> options:remote_ip=192.168.56.101
> ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
>
> Output Bridge:
> ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
> ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
> ifconfig b1 192.168.56.102 netmask 255.255.255.0
>
> Set up flows:
> ovs-ofctl del-flows b0
> ovs-ofctl del-flows b1
> -force traffic to gre from dpdk0
> ovs-ofctl add-flow b0 in_port=2,action=output:1
> ovs-ofctl add-flow b0 in_port=1,action=output:0
> -force traffic from b1 to output
> ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
> ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL
>
> A ofproto/trace says
>
> ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
> Bridge: b0
> Flow:
> in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:cd,dl_type=0x0000
>
> Rule: table=0 cookie=0 in_port=1
> OpenFlow actions=output:2
>
> Final flow:
> in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:cd,dl_type=0x0000
> Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
> Datapath actions:
> tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,src=00:e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.56.101,proto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),out_port(2))
>
>
> Regards,
>
> Dave
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>



-- 
"I don't normally do acked-by's.  I think it's my way of avoiding
getting blamed when it all blows up."               Andrew Morton

From blp at nicira.com  Wed Feb 11 16:26:00 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 11 Feb 2015 16:26:00 -0800
Subject: [ovs-discuss] OVS + Docker (namespace)
In-Reply-To: <54DB21A1.9030406@gmail.com>
References: <54DB21A1.9030406@gmail.com>
Message-ID: <20150212002600.GB30420@nicira.com>

On Wed, Feb 11, 2015 at 10:32:17AM +0100, Ben wrote:
> I am starting to work with Docker and saw an section at the end of this
> article (http://www.opencloudblog.com/?p=66).
> Basically I am creating some containers and want to use ovs for virtual
> switching purpose.

You should probably start from INSTALL.Docker.md in current OVS master.

From pshelar at nicira.com  Wed Feb 11 16:53:04 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Wed, 11 Feb 2015 16:53:04 -0800
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <CACjuMbyXwdgRrxba9vsxFzeni+WrzN+QrMAm=tjwmTOHkAh=Ug@mail.gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
 <CACjuMbyXwdgRrxba9vsxFzeni+WrzN+QrMAm=tjwmTOHkAh=Ug@mail.gmail.com>
Message-ID: <CALnjE+rtPObxROGG8v6fXgwgyOqWzhMLRvH0z=dpwSDqXetzAQ@mail.gmail.com>

On Wed, Feb 11, 2015 at 4:17 PM, Ben Pfaff <blp at nicira.com> wrote:
> Pravin, I know that our DPDK native tunneling supports VXLAN.  David
> is trying to use GRE.  Is this supported?
>
Yes, It supports VXLAN and GRE tunneling.


> On Tue, Feb 10, 2015 at 1:52 PM, David Evans <davidjoshuaevans at gmail.com> wrote:
>> Hi OVS,
>>
>> I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1
>>
>> I find that the outer ip & mac are not populated ???  The ofproto/trace
>> output thinks that the gre output will have the right src/dest on the outer
>> but then it’s gone…
>>
>> a bug?
>> am I missing some setup?
>> Wrong kernel ip_gre?
>>
>> Originating GRE:
>> ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
>> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
>> options:remote_ip=192.168.56.101
>> ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
>>
>> Output Bridge:
>> ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
>> ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
>> ifconfig b1 192.168.56.102 netmask 255.255.255.0
>>
>> Set up flows:
>> ovs-ofctl del-flows b0
>> ovs-ofctl del-flows b1
>> -force traffic to gre from dpdk0
>> ovs-ofctl add-flow b0 in_port=2,action=output:1
>> ovs-ofctl add-flow b0 in_port=1,action=output:0
>> -force traffic from b1 to output
>> ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
>> ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL
>>
>> A ofproto/trace says
>>
>> ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
>> Bridge: b0
>> Flow:
>> in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:cd,dl_type=0x0000
>>
>> Rule: table=0 cookie=0 in_port=1
>> OpenFlow actions=output:2
>>
>> Final flow:
>> in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:cd,dl_type=0x0000
>> Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
>> Datapath actions:
>> tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,src=00:e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.56.101,proto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),out_port(2))
>>
>>
>> Regards,
>>
>> Dave
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>
>
>
> --
> "I don't normally do acked-by's.  I think it's my way of avoiding
> getting blamed when it all blows up."               Andrew Morton

From pshelar at nicira.com  Wed Feb 11 16:55:43 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Wed, 11 Feb 2015 16:55:43 -0800
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
Message-ID: <CALnjE+pz7uuh314-7oFTGiia9ev71-7KOV2A80NVTuWGGLpbWw@mail.gmail.com>

On Tue, Feb 10, 2015 at 1:52 PM, David Evans <davidjoshuaevans at gmail.com> wrote:
> Hi OVS,
>
> I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1
>
Userspace tunneling does not need ip_gre module, tunneling is handled
in userspace.

> I find that the outer ip & mac are not populated ???  The ofproto/trace
> output thinks that the gre output will have the right src/dest on the outer
> but then it’s gone…
>
What do you mean by "its gone"? Can you post tcpdump for ping test?


> a bug?
> am I missing some setup?
> Wrong kernel ip_gre?
>
> Originating GRE:
> ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
> options:remote_ip=192.168.56.101
> ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
>
> Output Bridge:
> ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
> ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
> ifconfig b1 192.168.56.102 netmask 255.255.255.0
>
> Set up flows:
> ovs-ofctl del-flows b0
> ovs-ofctl del-flows b1
> -force traffic to gre from dpdk0
> ovs-ofctl add-flow b0 in_port=2,action=output:1
> ovs-ofctl add-flow b0 in_port=1,action=output:0
> -force traffic from b1 to output
> ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
> ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL
>
> A ofproto/trace says
>
> ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
> Bridge: b0
> Flow:
> in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:cd,dl_type=0x0000
>
> Rule: table=0 cookie=0 in_port=1
> OpenFlow actions=output:2
>
> Final flow:
> in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:cd,dl_type=0x0000
> Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
> Datapath actions:
> tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,src=00:e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.56.101,proto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),out_port(2))
>
>
> Regards,
>
> Dave
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From hsn.noun at gmail.com  Fri Feb  6 22:32:02 2015
From: hsn.noun at gmail.com (hassan hassan)
Date: Sat, 7 Feb 2015 08:32:02 +0200
Subject: [ovs-discuss] Enable GTP-U tunneling protocol support in OVS
Message-ID: <CAJfbj=E1GcUKjcz4Ceu4vRc2A4Oi3udmLc_J0jnESiKuTg+X8w@mail.gmail.com>

hi,i'am hassan From Lebanon,
please can send me the steps to  Implement GTP tunneling support in OVS
i highly appreciate your cooperation

BRs,
Hassan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150207/5b65d32e/attachment-0001.html>

From myip at juniper.net  Wed Feb 11 13:39:07 2015
From: myip at juniper.net (Michael Yip)
Date: Wed, 11 Feb 2015 21:39:07 +0000
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 16 17 failed
Message-ID: <BLUPR0501MB868E634F74C05D4B363ECC7D9250@BLUPR0501MB868.namprd05.prod.outlook.com>

Additional logs from test/testsuite.dir

_____________________________________________
From: Michael Yip
Sent: Wednesday, February 11, 2015 4:13 PM
To: 'bugs at openvswitch.org'
Subject: [openvswitch 2.3.1] testsuite: 16 17 failed
Importance: High


Hi,

Building ovs failed in Ubuntu 14.04 virtual machine. Please find information in the log.

 Thanks,

....................................
Michael Yip
Sr. Director of Engineering
[C:\Users\myip\AppData\Roaming\Microsoft\Signatures\jn_email_logo.gif]
10 Technology Park Drive
Westford, MA 01886

o: +1 978 589 8949
myip at juniper.net
www.juniper.net<http://www.juniper.net/>


 << File: dev-server-log >>  << File: config.log >>  << File: config.status >>  << File: testsuite.log >>  << File: ovs-pki.log >>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/71b06250/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: testsuite.dir.tgz
Type: application/x-compressed
Size: 9027 bytes
Desc: testsuite.dir.tgz
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/71b06250/attachment-0001.bin>

From padmajs80 at gmail.com  Mon Feb  9 06:26:32 2015
From: padmajs80 at gmail.com (Padma Jayasankar)
Date: Mon, 9 Feb 2015 19:56:32 +0530
Subject: [ovs-discuss] In flow entries should 'action' be set to normal
 for BFD control packets
In-Reply-To: <CAArS4XWv_M3WJUK0EsyZtS67Q_hJN2h3OOqZmukw_SCU8CPFqg@mail.gmail.com>
References: <CACveyy+9K4DH_2LUFRyGUpf4d_3_T3HQEYoSZYSm8ksEUC+y1Q@mail.gmail.com>
 <CAArS4XWv_M3WJUK0EsyZtS67Q_hJN2h3OOqZmukw_SCU8CPFqg@mail.gmail.com>
Message-ID: <CACveyyL7W=1y-BA3ruhz0AvUgn=7NYcBKRCF6FCiCdauN1BgHg@mail.gmail.com>

Hi,
 I want to monitor the links that form a path between two hosts. when any
of the link fails the source switch has to be intimated so that it can
reroute the traffic through the next alive bucket. for this bfd session has
to be established between the the source switch and destination
switch(which are connected to the respective hosts).
 Now i am able to enable bfd for those to switches using ovs-vsctl
commands. i also added flow entries for BFD packets, in the switches that
lie in the path.when a link fails in the path, bfd state of these switches
is changes to 'down' and when the link is up again , it again changes to
'up'. So i thought it supports multi-hop. Is it not so? I am using OVS
2.1.1. Please clarify.

Thanks and Regards,
Padma V

On Tue, Feb 3, 2015 at 11:26 PM, Alex Wang <alexw at nicira.com> wrote:

>
>
> On Sun, Feb 1, 2015 at 8:43 PM, Padma Jayasankar <padmajs80 at gmail.com>
> wrote:
>
>> Hi,
>>   I have to use BFD for failure detection and when i went through some
>> examples the action field for the flow entries were set to 'Normal". Can't
>> we use 'output' action. In that case i have to add two entries (one for
>> each direction). Please claridy
>>
>
>
> The BFD implementation in OVS is mainly used for tunnel link failure
> detection.  You need to have a tunnel port first and then can you enable
> bfd on the tunnel port.  The BFD state machine in OVS will compose/send
> control packets through the tunnel... No OpenFlow rules are involved...
>
> We currently do not support multi-hop bfd.
>
> However, at this time, it is still unclear what kind of link
> (tunnel/point-to-point physical link) you want you monitor... maybe you
> should clarify first,
>
> Thanks,
> Alex Wang,
>
>
>> Thanks and Regards,
>> Padma V
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150209/6b3115a4/attachment-0001.html>

From salvatore.cambria at citrix.com  Tue Feb 10 07:57:04 2015
From: salvatore.cambria at citrix.com (Salvatore Cambria)
Date: Tue, 10 Feb 2015 15:57:04 +0000
Subject: [ovs-discuss] OVS segfault in recirculation
Message-ID: <54DA2A50.4040201@citrix.com>

Hello,

I am a Software Engineer from Citrix, Cambridge UK office.

We are having a problem when running our nightly test on a XenServer 
host with lacp bonds with OVS. Indeed, when deleting the bond the 
following /segfault/ error appears (from GDB):

Program terminated with signal 11, Segmentation fault.

#0  0x0000000000411d2f in hmap_remove (node=0x7fd9d402e730, hmap=0x1c3e9e8)

     at lib/hmap.h:236

236         while (*bucket != node) {

(gdb) bt

#0  0x0000000000411843 in hmap_remove (node=0x7fd9d402e730, hmap=0x1c3e9e8)

     at lib/hmap.h:236

#1  update_recirc_rules (bond=0x1c3e920) at ofproto/bond.c:382

#2  0x0000000000001ff5 in ?? ()

(gdb) p *hmap

$1 = {buckets = 0x7fd9d4039b70, one = 0x0, mask = 255, n = 147}

(gdb) p *node

$2 = {hash = 2450845263, next = 0x0}

(gdb) p *bucket

Cannot access memory at address 0x8

(gdb) p *(hmap->buckets)

$3 = (struct hmap_node *) 0x0

(gdb) p node->hash & hmap->mask

$4 = 79

(gdb) p *(&hmap->buckets[79])

$5 = (struct hmap_node *) 0x0

I managed to reproduce the error using a while loop in which I 
repeatedly create and destroy a lacp bond, waiting for 15 seconds after 
each of these operations.

The error is not constant in timing and I think that it can be a race 
condition due to the recirculation process. It happens indeed that when 
calling /hmap_remove()/ from /update_recirc_rules()/ (in case of DEL), 
the bucket points to NULL. My idea is the following:

/hmap_remove()/ is called from two different places in /ofproto/bond.c/:

1. from /update_recirc_rules()/ (in which it raises the /segfault/)

hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
*pr_op->pr_rule = NULL;
free(pr_op);

2. and from /bond_unref()/ (called when I try to delete the bond)

HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
     hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
     free(pr_op);
}

Now, if these two calls happen at the same time, a conflict on the /bond 
pr_rule/ may happen. Looking at the code I can see that the 
recirculation /hmap_remove()/ is executed inside an external lock 
(/ovs_rwlock_wrlock(&rwlock)/) if called by /bond_rebalance()/

void bond_rebalance(struct bond *bond) {
...
ovs_rwlock_wrlock(&rwlock);
...
...
if (use_recirc && rebalanced) {
     bond_update_post_recirc_rules(bond,true); <---- hmap_remove()
}

done:
     ovs_rwlock_unlock(&rwlock);
}

but I can't see any lock when called by /output_normal()/

static void output_normal(struct xlate_ctx *ctx, const struct xbundle *out_xbundle, uint16_t vlan) {
...
if (ctx->use_recirc) {
     ...
     bond_update_post_recirc_rules(out_xbundle->bond, false); <---- hmap_remove()
     ...
}
...

The same lock is used in /bond_unref()/ but only for 
/hmap_remove(all_bonds, &bond->hmap_node)/ and not for 
/hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node)/.

...
ovs_rwlock_wrlock(&rwlock);
hmap_remove(all_bonds, &bond->hmap_node);
ovs_rwlock_unlock(&rwlock);
...
HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
     hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
     free(pr_op);
}
...

I suppose that the goal is to remove any pointer to the bond, from 
all_bonds, inside the lock and to work on it locally. My doubt is: can 
the bond be still accessible from somewhere else (let's say from a 
/bundle/)? If yes, what happen if a /bundle/ tries to access a bond 
which was previously removed from /all_bonds/ (let's say from 
/bundle_destroy()/)?

The version of OVS that I am using is /openvswitch-2.3.0-7.8312.x86_64/.

Could you please help me to find the problem?


Thank you for the help & kind regards,

Salvatore


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150210/bb0c1f58/attachment-0001.html>

From eyalr5 at hotmail.com  Mon Feb  9 06:49:49 2015
From: eyalr5 at hotmail.com (eyal)
Date: Mon, 9 Feb 2015 16:49:49 +0200
Subject: [ovs-discuss] can't load openvswitch.ko for Unknown symbol
 problem
In-Reply-To: <CAArS4XU8p2T_WV1ne1vrN1AAJxeJ0QEkx284oJmXrS5nb9azEQ@mail.gmail.com>
References: <DUB127-W10719C291AA8806F184CF7993B0@phx.gbl>,
 <CAArS4XU8p2T_WV1ne1vrN1AAJxeJ0QEkx284oJmXrS5nb9azEQ@mail.gmail.com>
Message-ID: <DUB127-W21A5B5CD653EFD617E141199270@phx.gbl>

Hey,thanks, works !Eyal.

From: alexw at nicira.com
Date: Fri, 6 Feb 2015 09:33:20 -0800
Subject: Re: [ovs-discuss] can't load openvswitch.ko for Unknown symbol problem
To: eyalr5 at hotmail.com
CC: discuss at openvswitch.org

Hey,
Have you tried with this commit?  Should be fine now,
commit 4ceb6c87968da7bcf025e4d4aef1a8da81eb24b4Author: Thomas Graf <tgraf at noironetworks.com>Date:   Wed Feb 4 07:45:06 2015 -0800
    datapath: Fix missing symbols when required to use own VXLAN stack        Fixes an insufficient ifdef in compat/vxlan.c which caused required    symbols not to be included in the build. The declarations were properly    enabled so the build would succeed but the module would spit missing    symbols when being inserted.        The fix uses a new define USE_UPSTREAM_VXLAN which is set in the compat    header <net/vxlan.h> as required. This centralizes the decision when to    include VXLAN compat code to a single place which eases further changes.        Reported-by: Pravin Shelar <pshelar at nicira.com>    Signed-off-by: Thomas Graf <tgraf at noironetworks.com>    Acked-by: Pravin B Shelar <pshelar at nicira.com>
Thanks,Alex Wang,
On Thu, Feb 5, 2015 at 8:50 AM, eyal <eyalr5 at hotmail.com> wrote:



OS: Centos7kernel: latest - 3.10.0-123.20.1.el7.x86_64OVS : 2.3.90 . the latest master - openvswitch-ovs-4d9226a The H file datapath/linux/compat/include/net/vxlan.h  has :IFNDEF HAVE_VXLAN_METADATA Which define prototype rpl_vxlan_xmit_skb. However the c file datapath/linux/compat/vxlan.cDoesn't implement this function because USE_KERNEL_TUNNEL_API  isn't define in the kernel header/ .config of 3.10.0-123.20.1.el7.x86_64. For that reason I have on dmesg file :dmesg | grep openvswitch[ 7177.899305] openvswitch: Unknown symbol rpl_vxlan_xmit_skb (err 0)[ 7177.899338] openvswitch: Unknown symbol rpl_vxlan_sock_release (err 0)[ 7177.899371] openvswitch: Unknown symbol rpl_vxlan_sock_add (err 0) Which kernel version contain this feature ? Thanks !  		 	   		  

_______________________________________________

discuss mailing list

discuss at openvswitch.org

http://openvswitch.org/mailman/listinfo/discuss



 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150209/fd8a4688/attachment-0001.html>

From spandan.777 at gmail.com  Tue Feb 10 11:35:03 2015
From: spandan.777 at gmail.com (Spandan Bemby)
Date: Tue, 10 Feb 2015 14:35:03 -0500
Subject: [ovs-discuss] Ubuntu 14.04 unable to ping through vxlan tunnel
Message-ID: <CAK6w+Dk46rwMPGKj-MtJzEh1WVWovyx92b6B7=N+Ybh5FYhF5w@mail.gmail.com>

I am unable to ping through a vxlan link in Open vSwitch (OVS) when the
frame size is too big. It seems ovs doesn’t fragment big frames when
sending then through the vxlan tunnel. Pinging worked in Ubuntu12.04
(3.2.0-61-virtual) works; this problem only appeared in Ubuntu14.04
(kernel: 3.13.0-39-generic ). Is this known issue? Does a solution exist?

-- 
Regards,
Spandan Bemby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150210/1e2926a3/attachment-0001.html>

From myip at juniper.net  Wed Feb 11 13:13:20 2015
From: myip at juniper.net (Michael Yip)
Date: Wed, 11 Feb 2015 21:13:20 +0000
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 16 17 failed
Message-ID: <BLUPR0501MB868936CC3683E16888ABE41D9250@BLUPR0501MB868.namprd05.prod.outlook.com>

Hi,

Building ovs failed in Ubuntu 14.04 virtual machine. Please find information in the log.

 Thanks,

....................................
Michael Yip
Sr. Director of Engineering
[C:\Users\myip\AppData\Roaming\Microsoft\Signatures\jn_email_logo.gif]
10 Technology Park Drive
Westford, MA 01886

o: +1 978 589 8949
myip at juniper.net
www.juniper.net<http://www.juniper.net/>




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/8d2bf486/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: dev-server-log
Type: application/octet-stream
Size: 682797 bytes
Desc: dev-server-log
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/8d2bf486/attachment-0005.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: config.log
Type: application/octet-stream
Size: 108050 bytes
Desc: config.log
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/8d2bf486/attachment-0006.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: config.status
Type: application/octet-stream
Size: 68191 bytes
Desc: config.status
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/8d2bf486/attachment-0007.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: testsuite.log
Type: application/octet-stream
Size: 266267 bytes
Desc: testsuite.log
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/8d2bf486/attachment-0008.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ovs-pki.log
Type: application/octet-stream
Size: 3355 bytes
Desc: ovs-pki.log
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150211/8d2bf486/attachment-0009.obj>

From jesse at nicira.com  Wed Feb 11 18:22:25 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 11 Feb 2015 18:22:25 -0800
Subject: [ovs-discuss] Ubuntu 14.04 unable to ping through vxlan tunnel
In-Reply-To: <CAK6w+Dk46rwMPGKj-MtJzEh1WVWovyx92b6B7=N+Ybh5FYhF5w@mail.gmail.com>
References: <CAK6w+Dk46rwMPGKj-MtJzEh1WVWovyx92b6B7=N+Ybh5FYhF5w@mail.gmail.com>
Message-ID: <CAEP_g=-JCw7owrx3N+gFb7_VAU=CqzukV2toDxYPiK5oqKmRNw@mail.gmail.com>

On Tue, Feb 10, 2015 at 11:35 AM, Spandan Bemby <spandan.777 at gmail.com> wrote:
> I am unable to ping through a vxlan link in Open vSwitch (OVS) when the
> frame size is too big. It seems ovs doesn’t fragment big frames when sending
> then through the vxlan tunnel. Pinging worked in Ubuntu12.04
> (3.2.0-61-virtual) works; this problem only appeared in Ubuntu14.04 (kernel:
> 3.13.0-39-generic ). Is this known issue? Does a solution exist?

Yes, it is necessary to set the MTU properly to account for the tunnel overhead.

From blp at nicira.com  Wed Feb 11 23:55:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 11 Feb 2015 23:55:55 -0800
Subject: [ovs-discuss] Enable GTP-U tunneling protocol support in OVS
In-Reply-To: <CAJfbj=E1GcUKjcz4Ceu4vRc2A4Oi3udmLc_J0jnESiKuTg+X8w@mail.gmail.com>
References: <CAJfbj=E1GcUKjcz4Ceu4vRc2A4Oi3udmLc_J0jnESiKuTg+X8w@mail.gmail.com>
Message-ID: <20150212075555.GA13561@nicira.com>

On Sat, Feb 07, 2015 at 08:32:02AM +0200, hassan hassan wrote:
> please can send me the steps to  Implement GTP tunneling support in OVS

OVS does not support GTP tunneling.

From blp at nicira.com  Wed Feb 11 23:57:34 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 11 Feb 2015 23:57:34 -0800
Subject: [ovs-discuss] OVS segfault in recirculation
In-Reply-To: <54DA2A50.4040201@citrix.com>
References: <54DA2A50.4040201@citrix.com>
Message-ID: <20150212075734.GB13561@nicira.com>

On Tue, Feb 10, 2015 at 03:57:04PM +0000, Salvatore Cambria wrote:
> I am a Software Engineer from Citrix, Cambridge UK office.
> 
> We are having a problem when running our nightly test on a XenServer host
> with lacp bonds with OVS. Indeed, when deleting the bond the following
> /segfault/ error appears (from GDB):
> 
> Program terminated with signal 11, Segmentation fault.

Andy, do you want to take an initial look at this?  You are probably
more familiar with the code than anyone else, since I believe that you
implemented the recirculation-based bonds.

From benoitne at gmail.com  Thu Feb 12 01:19:16 2015
From: benoitne at gmail.com (Ben)
Date: Thu, 12 Feb 2015 10:19:16 +0100
Subject: [ovs-discuss] OVS + Docker (namespace)
In-Reply-To: <20150212002600.GB30420@nicira.com>
References: <54DB21A1.9030406@gmail.com> <20150212002600.GB30420@nicira.com>
Message-ID: <54DC7014.1090309@gmail.com>

Many thanks Ben!

I was about to post my workaround I created yesterday to make it work, 
and I realize now (please correct me if I am wrong) that the ovs-docker 
script is doing what I found yesterday :

pid=$(docker inspect -f '{{.State.Pid}}' $id) ## getting the PID of the 
container
ln -s /proc/$pid/ns/net /var/run/netns/$pid ## creating a ln
ip link add eth0 type veth peer name ovs-eth0 ## creating a veth peer
ovs-vsctl add-port br ovs-eth0 ## adding one end of the peer to ovs
ip link set eth0 netns $pid ## sending the second end to container namespace

Many thanks Ben!

On 12/02/2015 1:26, Ben Pfaff wrote:
> On Wed, Feb 11, 2015 at 10:32:17AM +0100, Ben wrote:
>> I am starting to work with Docker and saw an section at the end of this
>> article (http://www.opencloudblog.com/?p=66).
>> Basically I am creating some containers and want to use ovs for virtual
>> switching purpose.
> You should probably start from INSTALL.Docker.md in current OVS master.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150212/5d72ff70/attachment.html>

From eyaln at ceragon.com  Thu Feb 12 04:26:14 2015
From: eyaln at ceragon.com (Eyal Nissim)
Date: Thu, 12 Feb 2015 12:26:14 +0000
Subject: [ovs-discuss] 4 byte long port numbers
Message-ID: <AM3PR04MB0759D5928AA7598F7E5A1F1CB9220@AM3PR04MB0759.eurprd04.prod.outlook.com>

Hi all,

While openflow1.3 and up supports 4 byte long port numbers (see spec and OFPP_MAX)
(I'm also referring to messages such as multi part port description, packet out etc...), I've found out lately that
OVS and OVSDB support only 2 byte long port  numbers

root at IP20C:/root> ovs-vsctl add-port IP20C-2 alpha -- set interface alpha type=internal ofport_request=268443713
ovs-vsctl: constraint violation: 268443713 is not in the valid range 1 to 65279 (inclusive)

even if I bypass ofport_request and use ofport directly, vswitch still doesn't accept 4 bytes for the port number
Is there any intension to change ofport_request type to unsigned integer in the future?

Thanks
Eyal


[Description: cid:image002.png at 01D0463D.98EF18A0]
This email message and any attachments are intended solely for the use of the addressees hereof. 
This message and any attachments may contain information that is confidential, privileged and exempt from disclosure under applicable law.
If you are not the intended recipient of this message, you are prohibited from reading, disclosing, reproducing, distributing, disseminating or otherwise using this transmission.
If you have received this message in error, please promptly notify the sender at Ceragon by reply E-mail and immediately delete this message from your system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150212/ae6bdb18/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 39112 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150212/ae6bdb18/attachment-0001.png>

From shettyg at nicira.com  Thu Feb 12 06:18:13 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 12 Feb 2015 06:18:13 -0800
Subject: [ovs-discuss] OVS + Docker (namespace)
In-Reply-To: <54DC7014.1090309@gmail.com>
References: <54DB21A1.9030406@gmail.com> <20150212002600.GB30420@nicira.com>
 <54DC7014.1090309@gmail.com>
Message-ID: <CAHbON5oemjagoCLXgn6g9GWfYAm56nK5DGHHwwQzJZi_p9BqOA@mail.gmail.com>

On Thu, Feb 12, 2015 at 1:19 AM, Ben <benoitne at gmail.com> wrote:
> Many thanks Ben!
>
> I was about to post my workaround I created yesterday to make it work, and I
> realize now (please correct me if I am wrong) that the ovs-docker script is
> doing what I found yesterday :
>
> pid=$(docker inspect -f '{{.State.Pid}}' $id) ## getting the PID of the
> container
> ln -s /proc/$pid/ns/net /var/run/netns/$pid ## creating a ln
> ip link add eth0 type veth peer name ovs-eth0 ## creating a veth peer
> ovs-vsctl add-port br ovs-eth0 ## adding one end of the peer to ovs
> ip link set eth0 netns $pid ## sending the second end to container namespace
Yes. That is all it does.

>
> Many thanks Ben!
>
> On 12/02/2015 1:26, Ben Pfaff wrote:
>
> On Wed, Feb 11, 2015 at 10:32:17AM +0100, Ben wrote:
>
> I am starting to work with Docker and saw an section at the end of this
> article (http://www.opencloudblog.com/?p=66).
> Basically I am creating some containers and want to use ovs for virtual
> switching purpose.
>
> You should probably start from INSTALL.Docker.md in current OVS master.
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From kevin.traynor at intel.com  Thu Feb 12 07:05:14 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 12 Feb 2015 15:05:14 +0000
Subject: [ovs-discuss] Packet drops during non-exhaustive flood with OVS
	and 1.8.0
In-Reply-To: <CABYiri8qr2v8r_XQO35swWt_OO=WQtW0jO=KAz70f5VojhM6kg@mail.gmail.com>
References: <CABYiri-qn_HGYeRSxH+z0+LGi0se9NEOk0q9hzFg4R+wg05ABw@mail.gmail.com>
 <CABYiri9WwQMn1u7TbJNEGCs804f_hvP2cKxet2sGMbrx1rJUyw@mail.gmail.com>
 <CABYiri_q4QqWrhTQL-UZ1wf3FLz-wj9SbtBJrDntz2Bw4cEPoQ@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F730688B53@IRSMSX104.ger.corp.intel.com>
 <CABYiri8qr2v8r_XQO35swWt_OO=WQtW0jO=KAz70f5VojhM6kg@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7306A3D77@IRSMSX104.ger.corp.intel.com>

> -----Original Message-----
> From: Andrey Korolyov [mailto:andrey at xdel.ru]
> Sent: Tuesday, February 3, 2015 5:21 PM
> To: Traynor, Kevin
> Cc: dev at dpdk.org; discuss at openvswitch.org
> Subject: Re: Packet drops during non-exhaustive flood with OVS and 1.8.0
> 
> > These patches are to enable DPDK 1.8 only. What 'bulk processing' are you referring to?
> > By default there is a batch size of 192 in netdev-dpdk for rx from the NIC - the linked
> > patch doesn't change this, just the DPDK version.
> 
> Sorry, I referred the wrong part there: bulk transmission, which is
> clearly not involved in my case. The idea was that the conditionally
> enabling prefetch for rx queues (BULK_ALLOC) may help somehow, but
> it`s probably will mask issue instead of solving it directly. By my
> understanding, strict drop rule should have a zero impact on a main
> ovs thread (and this is true) and work just fine with a line rate
> (this is not).

I've set a similar drop rule and I'm seeing the first packet drops occurring 
at 13.9 mpps for 64 byte pkts. I'm not sure if there is a config that can be 
changed or if it just the cost of the emc/lookups

> 
> >
> > Main things to consider are to isocpu's, pin the pmd thread and keep everything
> > on 1 NUMA socket. At 11 mpps without packet loss on that processor I suspect you are
> > doing those things already.
> 
> Yes, with all tuning improvements I was able to do this, but bare
> Linux stack on same machine is able to handle 12Mpps and there are
> absolutely no hints of what exactly is being congested.

From davidjoshuaevans at gmail.com  Thu Feb 12 07:16:29 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Thu, 12 Feb 2015 09:16:29 -0600
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <CALnjE+pz7uuh314-7oFTGiia9ev71-7KOV2A80NVTuWGGLpbWw@mail.gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
 <CALnjE+pz7uuh314-7oFTGiia9ev71-7KOV2A80NVTuWGGLpbWw@mail.gmail.com>
Message-ID: <D1021C1E.23A29%davidjoshuaevans@gmail.com>

Hi Pravin,

Thank you for helping out.

As you saw below from ofproto/trace, the b0 bridge Datapath Actions says
it sends out gre packets with a header src .102 dest .101 destination
But the packet captured on the receiving host¹s ethernet port is as
follows (GRE header in tact from 2F) but the outer MAC & IP are 00...

00 00 00 00 00 00 00 00 00 00 00 00 00 00 02 00
00 00 00 00 00 00 40 2F 46 9F C0 A8 38 66 C0 A8
38 65 00 00 65 58 00 00 04 04 12 34 00 00 04 56
78 90 08 00 45 00 01 EE 00 00 00 00 40 FF A6 B9
C0 A8 A8 05 C0 A8 A8 01

Trying to trace this through:

1) How did the Datapath Actions on b0 work out the src ip?


2) What is supposed to happen to the packet when it leaves the first
bridge b0? 
How does it get to b1? I am guessing linux host routing?

3) Could B1 be corrupting the header for some reason?

4 other possible factors ( netdev bridge? - DPDK ports?  linux stack arp
cache issue?)

I can ping both directions between 102 & 101 across the wire. So that
connection is good.






default_hugepagesz=2M hugepagesz=2M hugepages=2048

On 2/11/15, 6:55 PM, "Pravin Shelar" <pshelar at nicira.com> wrote:

>On Tue, Feb 10, 2015 at 1:52 PM, David Evans <davidjoshuaevans at gmail.com>
>wrote:
>> Hi OVS,
>>
>> I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1
>>
>Userspace tunneling does not need ip_gre module, tunneling is handled
>in userspace.
>
>> I find that the outer ip & mac are not populated ???  The ofproto/trace
>> output thinks that the gre output will have the right src/dest on the
>>outer
>> but then it¹s gone
>>
>What do you mean by "its gone"? Can you post tcpdump for ping test?
>
>
>> a bug?
>> am I missing some setup?
>> Wrong kernel ip_gre?
>>
>> Originating GRE:
>> ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
>> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
>> options:remote_ip=192.168.56.101
>> ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
>>
>> Output Bridge:
>> ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
>> ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
>> ifconfig b1 192.168.56.102 netmask 255.255.255.0
>>
>> Set up flows:
>> ovs-ofctl del-flows b0
>> ovs-ofctl del-flows b1
>> -force traffic to gre from dpdk0
>> ovs-ofctl add-flow b0 in_port=2,action=output:1
>> ovs-ofctl add-flow b0 in_port=1,action=output:0
>> -force traffic from b1 to output
>> ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
>> ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL
>>
>> A ofproto/trace says
>>
>> ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
>> Bridge: b0
>> Flow:
>> 
>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:
>>cd,dl_type=0x0000
>>
>> Rule: table=0 cookie=0 in_port=1
>> OpenFlow actions=output:2
>>
>> Final flow:
>> 
>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97:
>>cd,dl_type=0x0000
>> Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
>> Datapath actions:
>> 
>>tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,src=
>>00:e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.56.
>>101,proto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),out_p
>>ort(2))
>>
>>
>> Regards,
>>
>> Dave
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>



From andrey at xdel.ru  Thu Feb 12 07:15:58 2015
From: andrey at xdel.ru (Andrey Korolyov)
Date: Thu, 12 Feb 2015 19:15:58 +0400
Subject: [ovs-discuss] Packet drops during non-exhaustive flood with OVS
	and 1.8.0
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F7306A3D77@IRSMSX104.ger.corp.intel.com>
References: <CABYiri-qn_HGYeRSxH+z0+LGi0se9NEOk0q9hzFg4R+wg05ABw@mail.gmail.com>
 <CABYiri9WwQMn1u7TbJNEGCs804f_hvP2cKxet2sGMbrx1rJUyw@mail.gmail.com>
 <CABYiri_q4QqWrhTQL-UZ1wf3FLz-wj9SbtBJrDntz2Bw4cEPoQ@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F730688B53@IRSMSX104.ger.corp.intel.com>
 <CABYiri8qr2v8r_XQO35swWt_OO=WQtW0jO=KAz70f5VojhM6kg@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F7306A3D77@IRSMSX104.ger.corp.intel.com>
Message-ID: <CABYiri9b_fZJNg186vHLTWVWsAy9UqBvN32WTi26bO5+o93mPQ@mail.gmail.com>

On Thu, Feb 12, 2015 at 6:05 PM, Traynor, Kevin <kevin.traynor at intel.com> wrote:
>> -----Original Message-----
>> From: Andrey Korolyov [mailto:andrey at xdel.ru]
>> Sent: Tuesday, February 3, 2015 5:21 PM
>> To: Traynor, Kevin
>> Cc: dev at dpdk.org; discuss at openvswitch.org
>> Subject: Re: Packet drops during non-exhaustive flood with OVS and 1.8.0
>>
>> > These patches are to enable DPDK 1.8 only. What 'bulk processing' are you referring to?
>> > By default there is a batch size of 192 in netdev-dpdk for rx from the NIC - the linked
>> > patch doesn't change this, just the DPDK version.
>>
>> Sorry, I referred the wrong part there: bulk transmission, which is
>> clearly not involved in my case. The idea was that the conditionally
>> enabling prefetch for rx queues (BULK_ALLOC) may help somehow, but
>> it`s probably will mask issue instead of solving it directly. By my
>> understanding, strict drop rule should have a zero impact on a main
>> ovs thread (and this is true) and work just fine with a line rate
>> (this is not).
>
> I've set a similar drop rule and I'm seeing the first packet drops occurring
> at 13.9 mpps for 64 byte pkts. I'm not sure if there is a config that can be
> changed or if it just the cost of the emc/lookups
>

Do you mind to compare this case with forward to the dummy port
(ifconfig dummy0; ovs-vsctl add-port br0 dummy0; ip link set dev
dummy0 up; flush rule table; create a single forward rule; start an
attack)? As I mentioned there are no signs of syscall congestion for a
drop or dpdk-dpdk forward case.

From davidjoshuaevans at gmail.com  Thu Feb 12 09:29:35 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Thu, 12 Feb 2015 11:29:35 -0600
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <D1021C1E.23A29%davidjoshuaevans@gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
 <CALnjE+pz7uuh314-7oFTGiia9ev71-7KOV2A80NVTuWGGLpbWw@mail.gmail.com>
 <D1021C1E.23A29%davidjoshuaevans@gmail.com>
Message-ID: <D1023EE3.23A97%davidjoshuaevans@gmail.com>

BTW- it works fine when b0 bridge type is NOT netdev and port is not
accessed via DPDK.
Something in the userspace data path may be broken?

On 2/12/15, 9:16 AM, "David Evans" <davidjoshuaevans at gmail.com> wrote:

>Hi Pravin,
>
>Thank you for helping out.
>
>As you saw below from ofproto/trace, the b0 bridge Datapath Actions says
>it sends out gre packets with a header src .102 dest .101 destination
>But the packet captured on the receiving host��s ethernet port is as
>follows (GRE header in tact from 2F) but the outer MAC & IP are 00...
>
>00 00 00 00 00 00 00 00 00 00 00 00 00 00 02 00
>00 00 00 00 00 00 40 2F 46 9F C0 A8 38 66 C0 A8
>38 65 00 00 65 58 00 00 04 04 12 34 00 00 04 56
>78 90 08 00 45 00 01 EE 00 00 00 00 40 FF A6 B9
>C0 A8 A8 05 C0 A8 A8 01
>
>Trying to trace this through:
>
>1) How did the Datapath Actions on b0 work out the src ip?
>
>
>2) What is supposed to happen to the packet when it leaves the first
>bridge b0? 
>How does it get to b1? I am guessing linux host routing?
>
>3) Could B1 be corrupting the header for some reason?
>
>4� other possible factors ( netdev bridge? - DPDK ports?  linux stack arp
>cache issue?)
>
>I can ping both directions between 102 & 101 across the wire. So that
>connection is good.
>
>
>
>
>
>
>default_hugepagesz=2M hugepagesz=2M hugepages=2048
>
>On 2/11/15, 6:55 PM, "Pravin Shelar" <pshelar at nicira.com> wrote:
>
>>On Tue, Feb 10, 2015 at 1:52 PM, David Evans <davidjoshuaevans at gmail.com>
>>wrote:
>>> Hi OVS,
>>>
>>> I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1
>>>
>>Userspace tunneling does not need ip_gre module, tunneling is handled
>>in userspace.
>>
>>> I find that the outer ip & mac are not populated ???  The ofproto/trace
>>> output thinks that the gre output will have the right src/dest on the
>>>outer
>>> but then it��s gone�
>>>
>>What do you mean by "its gone"? Can you post tcpdump for ping test?
>>
>>
>>> a bug?
>>> am I missing some setup?
>>> Wrong kernel ip_gre?
>>>
>>> Originating GRE:
>>> ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
>>> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
>>> options:remote_ip=192.168.56.101
>>> ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
>>>
>>> Output Bridge:
>>> ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
>>> ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
>>> ifconfig b1 192.168.56.102 netmask 255.255.255.0
>>>
>>> Set up flows:
>>> ovs-ofctl del-flows b0
>>> ovs-ofctl del-flows b1
>>> -force traffic to gre from dpdk0
>>> ovs-ofctl add-flow b0 in_port=2,action=output:1
>>> ovs-ofctl add-flow b0 in_port=1,action=output:0
>>> -force traffic from b1 to output
>>> ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
>>> ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL
>>>
>>> A ofproto/trace says
>>>
>>> ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
>>> Bridge: b0
>>> Flow:
>>> 
>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97
>>>:
>>>cd,dl_type=0x0000
>>>
>>> Rule: table=0 cookie=0 in_port=1
>>> OpenFlow actions=output:2
>>>
>>> Final flow:
>>> 
>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97
>>>:
>>>cd,dl_type=0x0000
>>> Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
>>> Datapath actions:
>>> 
>>>tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,src
>>>=
>>>00:e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.56
>>>.
>>>101,proto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),out_
>>>p
>>>ort(2))
>>>
>>>
>>> Regards,
>>>
>>> Dave
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>
>
>



From abliberato at gmail.com  Thu Feb 12 09:31:43 2015
From: abliberato at gmail.com (Alextian Bartholomeu Liberato)
Date: Thu, 12 Feb 2015 15:31:43 -0200
Subject: [ovs-discuss] Caching packets in kernel mode
Message-ID: <CAFAMtibZL7O5vTLSsmjSbiXkEnL4GpJSLx0pAJP=BxcaPMi9Dg@mail.gmail.com>

Hi All,

The Open vSwitch 2.3.0 uses one caching that is defined by time, believe <
2.6 sec , for packets in kernel mode.
Where I can to change this option?
There is possibility?


Regards,

Alextian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150212/02a609e7/attachment.html>

From salvatore.cambria at citrix.com  Thu Feb 12 10:28:58 2015
From: salvatore.cambria at citrix.com (Salvatore Cambria)
Date: Thu, 12 Feb 2015 18:28:58 +0000
Subject: [ovs-discuss] OVS segfault in recirculation
In-Reply-To: <20150212075734.GB13561@nicira.com>
References: <54DA2A50.4040201@citrix.com> <20150212075734.GB13561@nicira.com>
Message-ID: <54DCF0EA.60505@citrix.com>

On 12/02/15 07:57, Ben Pfaff wrote:
> On Tue, Feb 10, 2015 at 03:57:04PM +0000, Salvatore Cambria wrote:
>> I am a Software Engineer from Citrix, Cambridge UK office.
>>
>> We are having a problem when running our nightly test on a XenServer host
>> with lacp bonds with OVS. Indeed, when deleting the bond the following
>> /segfault/ error appears (from GDB):
>>
>> Program terminated with signal 11, Segmentation fault.
> Andy, do you want to take an initial look at this?  You are probably
> more familiar with the code than anyone else, since I believe that you
> implemented the recirculation-based bonds.

Thanks for looking into this.

Here is the full backtrace

Thread 6 (Thread 0x7faa8a083700 (LWP 3958)):
#0  0x00007faa8d3b2f7d in __lll_lock_wait () from /lib64/libpthread.so.0
#1  0x00007faa8d3aed41 in _L_lock_790 () from /lib64/libpthread.so.0
#2  0x00007faa8d3aec47 in pthread_mutex_lock () from /lib64/libpthread.so.0
#3  0x00000000004caae0 in ovs_mutex_lock_at ()
#4  0x000000000041fa91 in handle_flow_mod__ ()
#5  0x000000000041a0dc in ofproto_flow_mod ()
#6  0x0000000000430800 in ofproto_dpif_delete_internal_flow ()
#7  0x0000000000412764 in update_recirc_rules ()
#8  0x0000000000413733 in bond_update_post_recirc_rules ()
#9  0x000000000043e424 in output_normal ()
#10 0x000000000043f0e5 in xlate_normal ()
#11 0x000000000044143f in xlate_output_action ()
#12 0x0000000000441eb4 in do_xlate_actions ()
#13 0x0000000000443610 in xlate_actions__ ()
#14 0x0000000000442e67 in xlate_actions ()
#15 0x000000000043a0a6 in revalidate_ukey ()
#16 0x000000000043a918 in revalidate ()
#17 0x000000000043870a in udpif_revalidator ()
#18 0x00000000004cb896 in ovsthread_wrapper ()
#19 0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
#20 0x00007faa8cbd001d in clone () from /lib64/libc.so.6

Thread 5 (Thread 0x7faa8de1fa40 (LWP 1420)):
#0  0x00007faa8d3b2f7d in __lll_lock_wait () from /lib64/libpthread.so.0
#1  0x00007faa8d3aed41 in _L_lock_790 () from /lib64/libpthread.so.0
#2  0x00007faa8d3aec47 in pthread_mutex_lock () from /lib64/libpthread.so.0
#3  0x00000000004caae0 in ovs_mutex_lock_at ()
#4  0x000000000044b6ab in ofmonitor_run ()
#5  0x000000000044753f in connmgr_run ()
#6  0x00000000004193fb in ofproto_run ()
#7  0x000000000040ab7d in bridge_run__ ()
#8  0x000000000040ace8 in bridge_run ()
#9  0x00000000004101b5 in main ()

Thread 4 (Thread 0x7faa8b085700 (LWP 3956)):
#0  0x00007faa8cbc5a4d in poll () from /lib64/libc.so.6
#1  0x00000000004ed9d5 in time_poll ()
#2  0x00000000004dc1ef in poll_block ()
#3  0x00000000004384aa in udpif_upcall_handler ()
#4  0x00000000004cb896 in ovsthread_wrapper ()
#5  0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
#6  0x00007faa8cbd001d in clone () from /lib64/libc.so.6

Thread 3 (Thread 0x7faa8a884700 (LWP 3957)):
#0  0x00007faa8cbc5a4d in poll () from /lib64/libc.so.6
#1  0x00000000004ed9d5 in time_poll ()
#2  0x00000000004dc1ef in poll_block ()
#3  0x00000000004384aa in udpif_upcall_handler ()
#4  0x00000000004cb896 in ovsthread_wrapper ()
#5  0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
#6  0x00007faa8cbd001d in clone () from /lib64/libc.so.6

Thread 2 (Thread 0x7faa89081700 (LWP 1427)):
#0  0x00007faa8cbc5a4d in poll () from /lib64/libc.so.6
#1  0x00000000004ed9d5 in time_poll ()
#2  0x00000000004dc1ef in poll_block ()
#3  0x00000000004ca890 in ovsrcu_postpone_thread ()
#4  0x00000000004cb896 in ovsthread_wrapper ()
#5  0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
#6  0x00007faa8cbd001d in clone () from /lib64/libc.so.6

Thread 1 (Thread 0x7faa89882700 (LWP 3959)):
#0  0x0000000000411a16 in hmap_remove ()
#1  0x00000000004127e4 in update_recirc_rules ()
#2  0x0000000000413733 in bond_update_post_recirc_rules ()
#3  0x000000000043e424 in output_normal ()
#4  0x000000000043f0e5 in xlate_normal ()
#5  0x000000000044143f in xlate_output_action ()
#6  0x0000000000441eb4 in do_xlate_actions ()
#7  0x0000000000443610 in xlate_actions__ ()
#8  0x0000000000442e67 in xlate_actions ()
#9  0x000000000043a0a6 in revalidate_ukey ()
#10 0x000000000043a918 in revalidate ()
#11 0x000000000043870a in udpif_revalidator ()
#12 0x00000000004cb896 in ovsthread_wrapper ()
#13 0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
#14 0x00007faa8cbd001d in clone () from /lib64/libc.so.6

(gdb) thread
[Current thread is 1 (Thread 0x7faa89882700 (LWP 3959))]

Regards,
Salvatore


From azhou at nicira.com  Thu Feb 12 10:45:40 2015
From: azhou at nicira.com (Andy Zhou)
Date: Thu, 12 Feb 2015 10:45:40 -0800
Subject: [ovs-discuss] OVS segfault in recirculation
In-Reply-To: <54DCF0EA.60505@citrix.com>
References: <54DA2A50.4040201@citrix.com> <20150212075734.GB13561@nicira.com>
 <54DCF0EA.60505@citrix.com>
Message-ID: <CACzMAJLHT4ME12PJy9j23ezn7ziP+Z_U6bJU_gs_5Fo0DsBMHQ@mail.gmail.com>

I will take a look.

On Thu, Feb 12, 2015 at 10:28 AM, Salvatore Cambria
<salvatore.cambria at citrix.com> wrote:
> On 12/02/15 07:57, Ben Pfaff wrote:
>>
>> On Tue, Feb 10, 2015 at 03:57:04PM +0000, Salvatore Cambria wrote:
>>>
>>> I am a Software Engineer from Citrix, Cambridge UK office.
>>>
>>> We are having a problem when running our nightly test on a XenServer host
>>> with lacp bonds with OVS. Indeed, when deleting the bond the following
>>> /segfault/ error appears (from GDB):
>>>
>>> Program terminated with signal 11, Segmentation fault.
>>
>> Andy, do you want to take an initial look at this?  You are probably
>> more familiar with the code than anyone else, since I believe that you
>> implemented the recirculation-based bonds.
>
>
> Thanks for looking into this.
>
> Here is the full backtrace
>
> Thread 6 (Thread 0x7faa8a083700 (LWP 3958)):
> #0  0x00007faa8d3b2f7d in __lll_lock_wait () from /lib64/libpthread.so.0
> #1  0x00007faa8d3aed41 in _L_lock_790 () from /lib64/libpthread.so.0
> #2  0x00007faa8d3aec47 in pthread_mutex_lock () from /lib64/libpthread.so.0
> #3  0x00000000004caae0 in ovs_mutex_lock_at ()
> #4  0x000000000041fa91 in handle_flow_mod__ ()
> #5  0x000000000041a0dc in ofproto_flow_mod ()
> #6  0x0000000000430800 in ofproto_dpif_delete_internal_flow ()
> #7  0x0000000000412764 in update_recirc_rules ()
> #8  0x0000000000413733 in bond_update_post_recirc_rules ()
> #9  0x000000000043e424 in output_normal ()
> #10 0x000000000043f0e5 in xlate_normal ()
> #11 0x000000000044143f in xlate_output_action ()
> #12 0x0000000000441eb4 in do_xlate_actions ()
> #13 0x0000000000443610 in xlate_actions__ ()
> #14 0x0000000000442e67 in xlate_actions ()
> #15 0x000000000043a0a6 in revalidate_ukey ()
> #16 0x000000000043a918 in revalidate ()
> #17 0x000000000043870a in udpif_revalidator ()
> #18 0x00000000004cb896 in ovsthread_wrapper ()
> #19 0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
> #20 0x00007faa8cbd001d in clone () from /lib64/libc.so.6
>
> Thread 5 (Thread 0x7faa8de1fa40 (LWP 1420)):
> #0  0x00007faa8d3b2f7d in __lll_lock_wait () from /lib64/libpthread.so.0
> #1  0x00007faa8d3aed41 in _L_lock_790 () from /lib64/libpthread.so.0
> #2  0x00007faa8d3aec47 in pthread_mutex_lock () from /lib64/libpthread.so.0
> #3  0x00000000004caae0 in ovs_mutex_lock_at ()
> #4  0x000000000044b6ab in ofmonitor_run ()
> #5  0x000000000044753f in connmgr_run ()
> #6  0x00000000004193fb in ofproto_run ()
> #7  0x000000000040ab7d in bridge_run__ ()
> #8  0x000000000040ace8 in bridge_run ()
> #9  0x00000000004101b5 in main ()
>
> Thread 4 (Thread 0x7faa8b085700 (LWP 3956)):
> #0  0x00007faa8cbc5a4d in poll () from /lib64/libc.so.6
> #1  0x00000000004ed9d5 in time_poll ()
> #2  0x00000000004dc1ef in poll_block ()
> #3  0x00000000004384aa in udpif_upcall_handler ()
> #4  0x00000000004cb896 in ovsthread_wrapper ()
> #5  0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
> #6  0x00007faa8cbd001d in clone () from /lib64/libc.so.6
>
> Thread 3 (Thread 0x7faa8a884700 (LWP 3957)):
> #0  0x00007faa8cbc5a4d in poll () from /lib64/libc.so.6
> #1  0x00000000004ed9d5 in time_poll ()
> #2  0x00000000004dc1ef in poll_block ()
> #3  0x00000000004384aa in udpif_upcall_handler ()
> #4  0x00000000004cb896 in ovsthread_wrapper ()
> #5  0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
> #6  0x00007faa8cbd001d in clone () from /lib64/libc.so.6
>
> Thread 2 (Thread 0x7faa89081700 (LWP 1427)):
> #0  0x00007faa8cbc5a4d in poll () from /lib64/libc.so.6
> #1  0x00000000004ed9d5 in time_poll ()
> #2  0x00000000004dc1ef in poll_block ()
> #3  0x00000000004ca890 in ovsrcu_postpone_thread ()
> #4  0x00000000004cb896 in ovsthread_wrapper ()
> #5  0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
> #6  0x00007faa8cbd001d in clone () from /lib64/libc.so.6
>
> Thread 1 (Thread 0x7faa89882700 (LWP 3959)):
> #0  0x0000000000411a16 in hmap_remove ()
> #1  0x00000000004127e4 in update_recirc_rules ()
> #2  0x0000000000413733 in bond_update_post_recirc_rules ()
> #3  0x000000000043e424 in output_normal ()
> #4  0x000000000043f0e5 in xlate_normal ()
> #5  0x000000000044143f in xlate_output_action ()
> #6  0x0000000000441eb4 in do_xlate_actions ()
> #7  0x0000000000443610 in xlate_actions__ ()
> #8  0x0000000000442e67 in xlate_actions ()
> #9  0x000000000043a0a6 in revalidate_ukey ()
> #10 0x000000000043a918 in revalidate ()
> #11 0x000000000043870a in udpif_revalidator ()
> #12 0x00000000004cb896 in ovsthread_wrapper ()
> #13 0x00007faa8d3acdf3 in start_thread () from /lib64/libpthread.so.0
> #14 0x00007faa8cbd001d in clone () from /lib64/libc.so.6
>
> (gdb) thread
> [Current thread is 1 (Thread 0x7faa89882700 (LWP 3959))]
>
> Regards,
> Salvatore
>

From shankari.v.2014 at gmail.com  Thu Feb 12 11:20:47 2015
From: shankari.v.2014 at gmail.com (Shankari Vaidyalingam)
Date: Fri, 13 Feb 2015 00:50:47 +0530
Subject: [ovs-discuss] Need some info on integrating patches with main code
Message-ID: <CAGuFQhAPGDz7GfyUBKXJ1TeMbE7nv0yPiPN4PQtPtwGLC=fxRg@mail.gmail.com>

Please let me know the command to integrate a set of patches into the
mainstream OVS code (I'd like to have the command for doing this/especially
what are the steps that need to be followed)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150213/4c406e8d/attachment.html>

From pshelar at nicira.com  Thu Feb 12 13:38:06 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Thu, 12 Feb 2015 13:38:06 -0800
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <D1023EE3.23A97%davidjoshuaevans@gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
 <CALnjE+pz7uuh314-7oFTGiia9ev71-7KOV2A80NVTuWGGLpbWw@mail.gmail.com>
 <D1021C1E.23A29%davidjoshuaevans@gmail.com>
 <D1023EE3.23A97%davidjoshuaevans@gmail.com>
Message-ID: <CALnjE+ogV4uPbL8mXCo1b=tj3-qRQH9wdS74D2O2VtYwCqnp0A@mail.gmail.com>

On Thu, Feb 12, 2015 at 9:29 AM, David Evans <davidjoshuaevans at gmail.com> wrote:
> BTW- it works fine when b0 bridge type is NOT netdev and port is not
> accessed via DPDK.
> Something in the userspace data path may be broken?
>

Can you try same test with netdev datapath and userspace tunneling?

> On 2/12/15, 9:16 AM, "David Evans" <davidjoshuaevans at gmail.com> wrote:
>
>>Hi Pravin,
>>
>>Thank you for helping out.
>>
>>As you saw below from ofproto/trace, the b0 bridge Datapath Actions says
>>it sends out gre packets with a header src .102 dest .101 destination
>>But the packet captured on the receiving host©ös ethernet port is as
>>follows (GRE header in tact from 2F) but the outer MAC & IP are 00...
>>
>>00 00 00 00 00 00 00 00 00 00 00 00 00 00 02 00
>>00 00 00 00 00 00 40 2F 46 9F C0 A8 38 66 C0 A8
>>38 65 00 00 65 58 00 00 04 04 12 34 00 00 04 56
>>78 90 08 00 45 00 01 EE 00 00 00 00 40 FF A6 B9
>>C0 A8 A8 05 C0 A8 A8 01
>>
>>Trying to trace this through:
>>
>>1) How did the Datapath Actions on b0 work out the src ip?
>>
>>
>>2) What is supposed to happen to the packet when it leaves the first
>>bridge b0?
>>How does it get to b1? I am guessing linux host routing?
>>
>>3) Could B1 be corrupting the header for some reason?
>>
>>4Š other possible factors ( netdev bridge? - DPDK ports?  linux stack arp
>>cache issue?)
>>
>>I can ping both directions between 102 & 101 across the wire. So that
>>connection is good.
>>
>>
>>
>>
>>
>>
>>default_hugepagesz=2M hugepagesz=2M hugepages=2048
>>
>>On 2/11/15, 6:55 PM, "Pravin Shelar" <pshelar at nicira.com> wrote:
>>
>>>On Tue, Feb 10, 2015 at 1:52 PM, David Evans <davidjoshuaevans at gmail.com>
>>>wrote:
>>>> Hi OVS,
>>>>
>>>> I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1
>>>>
>>>Userspace tunneling does not need ip_gre module, tunneling is handled
>>>in userspace.
>>>
>>>> I find that the outer ip & mac are not populated ???  The ofproto/trace
>>>> output thinks that the gre output will have the right src/dest on the
>>>>outer
>>>> but then it©ös goneŠ
>>>>
>>>What do you mean by "its gone"? Can you post tcpdump for ping test?
>>>
>>>
>>>> a bug?
>>>> am I missing some setup?
>>>> Wrong kernel ip_gre?
>>>>
>>>> Originating GRE:
>>>> ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
>>>> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
>>>> options:remote_ip=192.168.56.101
>>>> ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
>>>>
>>>> Output Bridge:
>>>> ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
>>>> ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
>>>> ifconfig b1 192.168.56.102 netmask 255.255.255.0
>>>>
>>>> Set up flows:
>>>> ovs-ofctl del-flows b0
>>>> ovs-ofctl del-flows b1
>>>> -force traffic to gre from dpdk0
>>>> ovs-ofctl add-flow b0 in_port=2,action=output:1
>>>> ovs-ofctl add-flow b0 in_port=1,action=output:0
>>>> -force traffic from b1 to output
>>>> ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
>>>> ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL
>>>>
>>>> A ofproto/trace says
>>>>
>>>> ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
>>>> Bridge: b0
>>>> Flow:
>>>>
>>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97
>>>>:
>>>>cd,dl_type=0x0000
>>>>
>>>> Rule: table=0 cookie=0 in_port=1
>>>> OpenFlow actions=output:2
>>>>
>>>> Final flow:
>>>>
>>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:97
>>>>:
>>>>cd,dl_type=0x0000
>>>> Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
>>>> Datapath actions:
>>>>
>>>>tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,src
>>>>=
>>>>00:e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.56
>>>>.
>>>>101,proto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),out_
>>>>p
>>>>ort(2))
>>>>
>>>>
>>>> Regards,
>>>>
>>>> Dave
>>>>
>>>> _______________________________________________
>>>> discuss mailing list
>>>> discuss at openvswitch.org
>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>
>>
>>
>
>

From davidjoshuaevans at gmail.com  Thu Feb 12 13:58:14 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Thu, 12 Feb 2015 15:58:14 -0600
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <CALnjE+ogV4uPbL8mXCo1b=tj3-qRQH9wdS74D2O2VtYwCqnp0A@mail.gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
 <CALnjE+pz7uuh314-7oFTGiia9ev71-7KOV2A80NVTuWGGLpbWw@mail.gmail.com>
 <D1021C1E.23A29%davidjoshuaevans@gmail.com>
 <D1023EE3.23A97%davidjoshuaevans@gmail.com>
 <CALnjE+ogV4uPbL8mXCo1b=tj3-qRQH9wdS74D2O2VtYwCqnp0A@mail.gmail.com>
Message-ID: <D1027AE8.23ABE%davidjoshuaevans@gmail.com>

Hi Pravin,

Using ixgbe -> netdev bridge works

ovs-vsctl add-br b0 -- set bridge b0 datapath_type=netdev
/usr/share/dpdk/tools/dpdk_nic_bind.py -b ixgbe  0000:0a:00.0
ovs-vsctl add-port b0 enp10s0f0
ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
options:remote_ip=192.168.56.101


The id is not incremented (don't know if that's important..
Eg: tcpdump output:
08:52:18.006652 00:e0:ed:52:97:cd > 90:e2:ba:38:ad:3c, ethertype IPv4
(0x0800), length 546: (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto
GRE (47), length 532)
    192.168.56.102 > 192.168.56.101: GREv0, Flags [none], proto TEB
(0x6558), length 512
	00:00:04:56:78:90 > 00:00:04:04:12:34, ethertype IPv4 (0x0800), length
508: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto unknown (255),
length 494)
    192.168.168.5 > 192.168.168.1:  ip-proto-255 474
08:52:18.006725 00:e0:ed:52:97:cd > 90:e2:ba:38:ad:3c, ethertype IPv4
(0x0800), length 546: (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto
GRE (47), length 532)
    192.168.56.102 > 192.168.56.101: GREv0, Flags [none], proto TEB
(0x6558), length 512
	00:00:04:56:78:90 > 00:00:04:04:12:34, ethertype IPv4 (0x0800), length
508: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto unknown (255),
length 494)
    192.168.168.5 > 192.168.168.1:  ip-proto-255 474



If I switch to igb_uio and add the port as dpdk it fails.


Cheers,
Dave

On 2/12/15, 3:38 PM, "Pravin Shelar" <pshelar at nicira.com> wrote:

>On Thu, Feb 12, 2015 at 9:29 AM, David Evans <davidjoshuaevans at gmail.com>
>wrote:
>> BTW- it works fine when b0 bridge type is NOT netdev and port is not
>> accessed via DPDK.
>> Something in the userspace data path may be broken?
>>
>
>Can you try same test with netdev datapath and userspace tunneling?
>
>> On 2/12/15, 9:16 AM, "David Evans" <davidjoshuaevans at gmail.com> wrote:
>>
>>>Hi Pravin,
>>>
>>>Thank you for helping out.
>>>
>>>As you saw below from ofproto/trace, the b0 bridge Datapath Actions says
>>>it sends out gre packets with a header src .102 dest .101 destination
>>>But the packet captured on the receiving host(C)ös ethernet port is as
>>>follows (GRE header in tact from 2F) but the outer MAC & IP are 00...
>>>
>>>00 00 00 00 00 00 00 00 00 00 00 00 00 00 02 00
>>>00 00 00 00 00 00 40 2F 46 9F C0 A8 38 66 C0 A8
>>>38 65 00 00 65 58 00 00 04 04 12 34 00 00 04 56
>>>78 90 08 00 45 00 01 EE 00 00 00 00 40 FF A6 B9
>>>C0 A8 A8 05 C0 A8 A8 01
>>>
>>>Trying to trace this through:
>>>
>>>1) How did the Datapath Actions on b0 work out the src ip?
>>>
>>>
>>>2) What is supposed to happen to the packet when it leaves the first
>>>bridge b0?
>>>How does it get to b1? I am guessing linux host routing?
>>>
>>>3) Could B1 be corrupting the header for some reason?
>>>
>>>4Š other possible factors ( netdev bridge? - DPDK ports?  linux stack
>>>arp
>>>cache issue?)
>>>
>>>I can ping both directions between 102 & 101 across the wire. So that
>>>connection is good.
>>>
>>>
>>>
>>>
>>>
>>>
>>>default_hugepagesz=2M hugepagesz=2M hugepages=2048
>>>
>>>On 2/11/15, 6:55 PM, "Pravin Shelar" <pshelar at nicira.com> wrote:
>>>
>>>>On Tue, Feb 10, 2015 at 1:52 PM, David Evans
>>>><davidjoshuaevans at gmail.com>
>>>>wrote:
>>>>> Hi OVS,
>>>>>
>>>>> I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1
>>>>>
>>>>Userspace tunneling does not need ip_gre module, tunneling is handled
>>>>in userspace.
>>>>
>>>>> I find that the outer ip & mac are not populated ???  The
>>>>>ofproto/trace
>>>>> output thinks that the gre output will have the right src/dest on the
>>>>>outer
>>>>> but then it(C)ös goneŠ
>>>>>
>>>>What do you mean by "its gone"? Can you post tcpdump for ping test?
>>>>
>>>>
>>>>> a bug?
>>>>> am I missing some setup?
>>>>> Wrong kernel ip_gre?
>>>>>
>>>>> Originating GRE:
>>>>> ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
>>>>> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
>>>>> options:remote_ip=192.168.56.101
>>>>> ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
>>>>>
>>>>> Output Bridge:
>>>>> ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
>>>>> ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
>>>>> ifconfig b1 192.168.56.102 netmask 255.255.255.0
>>>>>
>>>>> Set up flows:
>>>>> ovs-ofctl del-flows b0
>>>>> ovs-ofctl del-flows b1
>>>>> -force traffic to gre from dpdk0
>>>>> ovs-ofctl add-flow b0 in_port=2,action=output:1
>>>>> ovs-ofctl add-flow b0 in_port=1,action=output:0
>>>>> -force traffic from b1 to output
>>>>> ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
>>>>> ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL
>>>>>
>>>>> A ofproto/trace says
>>>>>
>>>>> ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
>>>>> Bridge: b0
>>>>> Flow:
>>>>>
>>>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:
>>>>>97
>>>>>:
>>>>>cd,dl_type=0x0000
>>>>>
>>>>> Rule: table=0 cookie=0 in_port=1
>>>>> OpenFlow actions=output:2
>>>>>
>>>>> Final flow:
>>>>>
>>>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:
>>>>>97
>>>>>:
>>>>>cd,dl_type=0x0000
>>>>> Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
>>>>> Datapath actions:
>>>>>
>>>>>tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,s
>>>>>rc
>>>>>=
>>>>>00:e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.
>>>>>56
>>>>>.
>>>>>101,proto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),ou
>>>>>t_
>>>>>p
>>>>>ort(2))
>>>>>
>>>>>
>>>>> Regards,
>>>>>
>>>>> Dave
>>>>>
>>>>> _______________________________________________
>>>>> discuss mailing list
>>>>> discuss at openvswitch.org
>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>
>>>
>>>
>>
>>



From davidjoshuaevans at gmail.com  Thu Feb 12 14:59:01 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Thu, 12 Feb 2015 16:59:01 -0600
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <CALnjE+ogV4uPbL8mXCo1b=tj3-qRQH9wdS74D2O2VtYwCqnp0A@mail.gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
 <CALnjE+pz7uuh314-7oFTGiia9ev71-7KOV2A80NVTuWGGLpbWw@mail.gmail.com>
 <D1021C1E.23A29%davidjoshuaevans@gmail.com>
 <D1023EE3.23A97%davidjoshuaevans@gmail.com>
 <CALnjE+ogV4uPbL8mXCo1b=tj3-qRQH9wdS74D2O2VtYwCqnp0A@mail.gmail.com>
Message-ID: <D1028B6C.23ADF%davidjoshuaevans@gmail.com>

Hi Pravin,

While trying to figure this out - I'm looking at netdev-vport.c and
netdev-dpdk.c
I could conceivably integrate the vport's build/push/pop/get/set/config
for GRE into the DPDK netdev-dpdk.c.

Then I would only need one bridge and would not require the linux
networking/routing.

Does that sound foolish or wise to you?

Regards,
Dave.

On 2/12/15, 3:38 PM, "Pravin Shelar" <pshelar at nicira.com> wrote:

>On Thu, Feb 12, 2015 at 9:29 AM, David Evans <davidjoshuaevans at gmail.com>
>wrote:
>> BTW- it works fine when b0 bridge type is NOT netdev and port is not
>> accessed via DPDK.
>> Something in the userspace data path may be broken?
>>
>
>Can you try same test with netdev datapath and userspace tunneling?
>
>> On 2/12/15, 9:16 AM, "David Evans" <davidjoshuaevans at gmail.com> wrote:
>>
>>>Hi Pravin,
>>>
>>>Thank you for helping out.
>>>
>>>As you saw below from ofproto/trace, the b0 bridge Datapath Actions says
>>>it sends out gre packets with a header src .102 dest .101 destination
>>>But the packet captured on the receiving host(C)ös ethernet port is as
>>>follows (GRE header in tact from 2F) but the outer MAC & IP are 00...
>>>
>>>00 00 00 00 00 00 00 00 00 00 00 00 00 00 02 00
>>>00 00 00 00 00 00 40 2F 46 9F C0 A8 38 66 C0 A8
>>>38 65 00 00 65 58 00 00 04 04 12 34 00 00 04 56
>>>78 90 08 00 45 00 01 EE 00 00 00 00 40 FF A6 B9
>>>C0 A8 A8 05 C0 A8 A8 01
>>>
>>>Trying to trace this through:
>>>
>>>1) How did the Datapath Actions on b0 work out the src ip?
>>>
>>>
>>>2) What is supposed to happen to the packet when it leaves the first
>>>bridge b0?
>>>How does it get to b1? I am guessing linux host routing?
>>>
>>>3) Could B1 be corrupting the header for some reason?
>>>
>>>4Š other possible factors ( netdev bridge? - DPDK ports?  linux stack
>>>arp
>>>cache issue?)
>>>
>>>I can ping both directions between 102 & 101 across the wire. So that
>>>connection is good.
>>>
>>>
>>>
>>>
>>>
>>>
>>>default_hugepagesz=2M hugepagesz=2M hugepages=2048
>>>
>>>On 2/11/15, 6:55 PM, "Pravin Shelar" <pshelar at nicira.com> wrote:
>>>
>>>>On Tue, Feb 10, 2015 at 1:52 PM, David Evans
>>>><davidjoshuaevans at gmail.com>
>>>>wrote:
>>>>> Hi OVS,
>>>>>
>>>>> I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1
>>>>>
>>>>Userspace tunneling does not need ip_gre module, tunneling is handled
>>>>in userspace.
>>>>
>>>>> I find that the outer ip & mac are not populated ???  The
>>>>>ofproto/trace
>>>>> output thinks that the gre output will have the right src/dest on the
>>>>>outer
>>>>> but then it(C)ös goneŠ
>>>>>
>>>>What do you mean by "its gone"? Can you post tcpdump for ping test?
>>>>
>>>>
>>>>> a bug?
>>>>> am I missing some setup?
>>>>> Wrong kernel ip_gre?
>>>>>
>>>>> Originating GRE:
>>>>> ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
>>>>> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
>>>>> options:remote_ip=192.168.56.101
>>>>> ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
>>>>>
>>>>> Output Bridge:
>>>>> ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
>>>>> ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
>>>>> ifconfig b1 192.168.56.102 netmask 255.255.255.0
>>>>>
>>>>> Set up flows:
>>>>> ovs-ofctl del-flows b0
>>>>> ovs-ofctl del-flows b1
>>>>> -force traffic to gre from dpdk0
>>>>> ovs-ofctl add-flow b0 in_port=2,action=output:1
>>>>> ovs-ofctl add-flow b0 in_port=1,action=output:0
>>>>> -force traffic from b1 to output
>>>>> ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
>>>>> ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL
>>>>>
>>>>> A ofproto/trace says
>>>>>
>>>>> ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
>>>>> Bridge: b0
>>>>> Flow:
>>>>>
>>>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:
>>>>>97
>>>>>:
>>>>>cd,dl_type=0x0000
>>>>>
>>>>> Rule: table=0 cookie=0 in_port=1
>>>>> OpenFlow actions=output:2
>>>>>
>>>>> Final flow:
>>>>>
>>>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:
>>>>>97
>>>>>:
>>>>>cd,dl_type=0x0000
>>>>> Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
>>>>> Datapath actions:
>>>>>
>>>>>tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,s
>>>>>rc
>>>>>=
>>>>>00:e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.
>>>>>56
>>>>>.
>>>>>101,proto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),ou
>>>>>t_
>>>>>p
>>>>>ort(2))
>>>>>
>>>>>
>>>>> Regards,
>>>>>
>>>>> Dave
>>>>>
>>>>> _______________________________________________
>>>>> discuss mailing list
>>>>> discuss at openvswitch.org
>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>
>>>
>>>
>>
>>



From xchenum at gmail.com  Thu Feb 12 17:32:46 2015
From: xchenum at gmail.com (Xu (Simon) Chen)
Date: Thu, 12 Feb 2015 20:32:46 -0500
Subject: [ovs-discuss] kernel panic under heavy receive load
Message-ID: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>

Hi folks,


I can now consistently reproduce a kernel panic on my system. I am using
OVS 2.3.0 on 3.14.29 kernel, a sender and a receiver (two VMs) on two
identical hypervisors, using VXLAN tunnel connecting the two VMs. Iperf is
used inside of VMs for generating traffic. The sender side has no problem,
while the hypervisor with the receiving VM consistently crashes after
certain amount of time (or rather packets).


The kernel panic seems to be related to skb_shared check inside of
pskb_expand_head function:

 [ 7318.405112] ------------[ cut here ]------------

[ 7318.409796] kernel BUG at net/core/skbuff.c:1041!

[ 7318.414563] invalid opcode: 0000 [#1] SMP

[ 7318.418868] Modules linked in: ip6table_filter ip6_tables xt_mac
xt_tcpudp xt_state xt_physdev xt_set xt_multiport iptable_filter
iptable_nat nf_nat_ipv4 nf_nat ipta

ble_raw ip_tables x_tables ip_set_hash_ip ip_set nfnetlink vhost_net vhost
macvtap macvlan tun veth openvswitch(O) gre vxlan libcrc32c bridge 8021q
garp stp llc bonding

joydev hid_generic usbhid hid deflate ctr twofish_generic
twofish_avx_x86_64 nfsd twofish_x86_64_3way twofish_x86_64 twofish_common
auth_rpcgss oid_registry nfs_acl ca

mellia_generic camellia_aesni_avx_x86_64 camellia_x86_64 nfs lockd
serpent_avx_x86_64 fscache serpent_sse2_x86_64 xts serpent_generic sunrpc
blowfish_generic blowfish_x

86_64 blowfish_common cast5_avx_x86_64 cast5_generic cast_common
des_generic cbc cmac binfmt_misc xcbc rmd160 sha512_generic sha256_generic
hmac crypto_null af_key xfrm

_algo iTCO_wdt iTCO_vendor_support x86_pkg_temp_thermal coretemp kvm_intel
kvm crc32_pclmul crc32c_intel ghash_clmulni_intel aesni_intel aes_x86_64
lrw gf128mul glue_he

lper ablk_helper cryptd microcode evdev ehci_pci sb_edac ehci_hcd edac_core
usbcore lpc_ich ioatdma i2c_i801 usb_common mfd_core tpm_tis wmi tpm
acpi_cpufreq processor

thermal_sys button nf_conntrack_ipv4 nf_defrag_ipv4 nf_conntrack_ipv6
nf_defrag_ipv6 nf_conntrack ipmi_devintf ipmi_si ipmi_msghandler loop
tcp_scalable autofs4 ext4 cr

c16 jbd2 mbcache crc32c btrfs xor raid6_pq dm_mod mlx4_en(O) sg sd_mod
crc_t10dif crct10dif_common igb isci i2c_algo_bit ahci libsas i2c_core
libahci dca mlx4_core(O) m

egaraid_sas scsi_transport_sas ptp libata pps_core compat(O) scsi_mod

[ 7318.568195] CPU: 14 PID: 54124 Comm: vhost-54120 Tainted: G           O
3.14.25-ts1 #1

[ 7318.576227] Hardware name: Supermicro SYS-F617R2-R72+/X9DRFR, BIOS 3.0b
04/24/2014

[ 7318.583944] task: ffff887f25dde240 ti: ffff883ef6a32000 task.ti:
ffff883ef6a32000

[ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>]
pskb_expand_head+0x234/0x270

[ 7318.600295] RSP: 0018:ffff887f7f103978  EFLAGS: 00010202

[ 7318.605770] RAX: 0000000000000002 RBX: ffff887f23417700 RCX:
0000000000000020

[ 7318.613016] RDX: 00000000000002ee RSI: 0000000000000000 RDI:
ffff887f23417700

[ 7318.620278] RBP: ffff887f7f1039b8 R08: 000000005ff00000 R09:
ffff887f2113e040

[ 7318.627523] R10: 00000000ffffee43 R11: 0000000000000002 R12:
0000000000000000

[ 7318.634805] R13: ffff887f23417700 R14: 000000000000000d R15:
ffff887f23417700

[ 7318.642032] FS:  0000000000000000(0000) GS:ffff887f7f100000(0000)
knlGS:0000000000000000

[ 7318.650238] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033

[ 7318.656110] CR2: 00002ba78155e680 CR3: 0000007f1f8cd000 CR4:
00000000001427e0

[ 7318.663378] Stack:

[ 7318.665464]  ffff887f7f1039f8 ffffffff8142ae14 ffffffffa07b50f0
ffff887f23417700

[ 7318.673226]  ffff887f7f103b58 ffff887f7f103a70 000000000000000d
ffff887f23417700

[ 7318.681000]  ffff887f7f103a08 ffffffff813eb6fc ffff887f23417700
000001f823417700

[ 7318.688790] Call Trace:

[ 7318.691309]  <IRQ>

[ 7318.693290]  [<ffffffff8142ae14>] ? nf_hook_slow+0x74/0x130

[ 7318.699285]  [<ffffffffa07b50f0>] ? deliver_clone+0x60/0x60 [bridge]

[ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330

[ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0

[ 7318.717599]  [<ffffffffa07de8b0>] queue_userspace_packet+0x3f0/0x440
[openvswitch]

[ 7318.725289]  [<ffffffffa07dfcd5>] ovs_dp_upcall+0x65/0x70 [openvswitch]

[ 7318.732037]  [<ffffffffa07dc7b6>] do_execute_actions+0x366/0xc00
[openvswitch]

[ 7318.739403]  [<ffffffff8142ae14>] ? nf_hook_slow+0x74/0x130

[ 7318.745072]  [<ffffffff812a7c9a>] ? arch_fast_hash2+0xa/0x10

[ 7318.750883]  [<ffffffffa07dc7ec>] do_execute_actions+0x39c/0xc00
[openvswitch]

[ 7318.758221]  [<ffffffffa07b570d>] ? br_forward+0x5d/0x70 [bridge]

[ 7318.764419]  [<ffffffffa07dd0c6>] ovs_execute_actions+0x76/0x110
[openvswitch]

[ 7318.771773]  [<ffffffffa07dfd6f>]
ovs_dp_process_packet_with_key+0x8f/0xf0 [openvswitch]

[ 7318.779988]  [<ffffffffa07e0efa>] ? ovs_flow_extract+0x89a/0xab0
[openvswitch]

[ 7318.787355]  [<ffffffffa07dfe10>]
ovs_dp_process_received_packet+0x40/0x60 [openvswitch]

[ 7318.795535]  [<ffffffffa07e616a>] ovs_vport_receive+0x2a/0x30
[openvswitch]

[ 7318.802634]  [<ffffffffa07e7cf5>] netdev_frame_hook+0xc5/0x120
[openvswitch]

[ 7318.809773]  [<ffffffff813f9f42>] __netif_receive_skb_core+0x332/0x7f0

[ 7318.816418]  [<ffffffffa07e7c30>] ? netdev_create+0x150/0x150
[openvswitch]

[ 7318.823475]  [<ffffffff813fa426>] __netif_receive_skb+0x26/0x70

[ 7318.829472]  [<ffffffff813fa514>] process_backlog+0xa4/0x180

[ 7318.835223]  [<ffffffff813fa979>] net_rx_action+0x139/0x220

[ 7318.840894]  [<ffffffff81053218>] __do_softirq+0xf8/0x280

[ 7318.846391]  [<ffffffff81504b5c>] do_softirq_own_stack+0x1c/0x30

[ 7318.852517]  <EOI>

[ 7318.854504]  [<ffffffff81053425>] do_softirq+0x45/0x50

[ 7318.860084]  [<ffffffff813f9759>] netif_rx_ni+0x39/0x70

[ 7318.865416]  [<ffffffffa07f1ab3>] tun_get_user+0x413/0x840 [tun]

[ 7318.871506]  [<ffffffffa07f1f3a>] tun_sendmsg+0x5a/0x80 [tun]

[ 7318.877357]  [<ffffffffa0819e32>] handle_tx+0x382/0x400 [vhost_net]

[ 7318.883712]  [<ffffffffa0819ee5>] handle_tx_kick+0x15/0x20 [vhost_net]

[ 7318.890333]  [<ffffffffa080d4f6>] vhost_worker+0xf6/0x190 [vhost]

[ 7318.896528]  [<ffffffffa080d400>] ? vhost_log_access_ok+0x30/0x30 [vhost]

[ 7318.903454]  [<ffffffff81070c69>] kthread+0xc9/0xe0

[ 7318.908412]  [<ffffffff81070ba0>] ? flush_kthread_worker+0x80/0x80

[ 7318.914674]  [<ffffffff8150342c>] ret_from_fork+0x7c/0xb0

[ 7318.920163]  [<ffffffff81070ba0>] ? flush_kthread_worker+0x80/0x80

[ 7318.926426] Code: 55 c0 e8 f0 38 d4 ff 48 8b 55 c0 84 c0 0f 85 0b ff ff
ff e9 02 ff ff ff 0f 1f 80 00 00 00 00 41 81 cf 00 20 00 00 e9 1f fe ff ff
<0f> 0b 0f 0b 44 89 fe 4c 89 ef e8 ad e8 ff ff 85 c0 74 12 48 89

[ 7318.950040] RIP  [<ffffffff813eb634>] pskb_expand_head+0x234/0x270

[ 7318.956385]  RSP <ffff887f7f103978>

[ 7318.959988] ---[ end trace 221c17dcc65b8372 ]---

[ 7319.076935] Kernel panic - not syncing: Fatal exception in interrupt

[ 7319.086993] Kernel Offset: 0x0 from 0xffffffff81000000 (relocation
range: 0xffffffff80000000-0xffffffff9fffffff)

[ 7319.204560] Rebooting in 10 seconds..
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150212/1d0f4cdb/attachment-0001.html>

From xchenum at gmail.com  Thu Feb 12 17:35:37 2015
From: xchenum at gmail.com (Xu (Simon) Chen)
Date: Thu, 12 Feb 2015 20:35:37 -0500
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
Message-ID: <CAGNyuhVb1iAUsBduuU8jOfeVOt0_P=c3LKsCrw7MuRzw8+Ew5Q@mail.gmail.com>

Sorry, click send too fast...

I think this line causes the KP:
https://github.com/torvalds/linux/blob/v3.14/net/core/skbuff.c#L1039
But this is weird, because as I read from this mailing list, OVS doesn't
allow shared skb.

I tried turn off GRO: it made receive side slower, but it eventually
crashes too. Any ideas?

Thanks.
-Simon


On Thu, Feb 12, 2015 at 8:32 PM, Xu (Simon) Chen <xchenum at gmail.com> wrote:

> Hi folks,
>
>
> I can now consistently reproduce a kernel panic on my system. I am using
> OVS 2.3.0 on 3.14.29 kernel, a sender and a receiver (two VMs) on two
> identical hypervisors, using VXLAN tunnel connecting the two VMs. Iperf is
> used inside of VMs for generating traffic. The sender side has no problem,
> while the hypervisor with the receiving VM consistently crashes after
> certain amount of time (or rather packets).
>
>
> The kernel panic seems to be related to skb_shared check inside of
> pskb_expand_head function:
>
>  [ 7318.405112] ------------[ cut here ]------------
>
> [ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
>
> [ 7318.414563] invalid opcode: 0000 [#1] SMP
>
> [ 7318.418868] Modules linked in: ip6table_filter ip6_tables xt_mac
> xt_tcpudp xt_state xt_physdev xt_set xt_multiport iptable_filter
> iptable_nat nf_nat_ipv4 nf_nat ipta
>
> ble_raw ip_tables x_tables ip_set_hash_ip ip_set nfnetlink vhost_net vhost
> macvtap macvlan tun veth openvswitch(O) gre vxlan libcrc32c bridge 8021q
> garp stp llc bonding
>
> joydev hid_generic usbhid hid deflate ctr twofish_generic
> twofish_avx_x86_64 nfsd twofish_x86_64_3way twofish_x86_64 twofish_common
> auth_rpcgss oid_registry nfs_acl ca
>
> mellia_generic camellia_aesni_avx_x86_64 camellia_x86_64 nfs lockd
> serpent_avx_x86_64 fscache serpent_sse2_x86_64 xts serpent_generic sunrpc
> blowfish_generic blowfish_x
>
> 86_64 blowfish_common cast5_avx_x86_64 cast5_generic cast_common
> des_generic cbc cmac binfmt_misc xcbc rmd160 sha512_generic sha256_generic
> hmac crypto_null af_key xfrm
>
> _algo iTCO_wdt iTCO_vendor_support x86_pkg_temp_thermal coretemp kvm_intel
> kvm crc32_pclmul crc32c_intel ghash_clmulni_intel aesni_intel aes_x86_64
> lrw gf128mul glue_he
>
> lper ablk_helper cryptd microcode evdev ehci_pci sb_edac ehci_hcd
> edac_core usbcore lpc_ich ioatdma i2c_i801 usb_common mfd_core tpm_tis wmi
> tpm acpi_cpufreq processor
>
> thermal_sys button nf_conntrack_ipv4 nf_defrag_ipv4 nf_conntrack_ipv6
> nf_defrag_ipv6 nf_conntrack ipmi_devintf ipmi_si ipmi_msghandler loop
> tcp_scalable autofs4 ext4 cr
>
> c16 jbd2 mbcache crc32c btrfs xor raid6_pq dm_mod mlx4_en(O) sg sd_mod
> crc_t10dif crct10dif_common igb isci i2c_algo_bit ahci libsas i2c_core
> libahci dca mlx4_core(O) m
>
> egaraid_sas scsi_transport_sas ptp libata pps_core compat(O) scsi_mod
>
> [ 7318.568195] CPU: 14 PID: 54124 Comm: vhost-54120 Tainted: G           O
> 3.14.25-ts1 #1
>
> [ 7318.576227] Hardware name: Supermicro SYS-F617R2-R72+/X9DRFR, BIOS 3.0b
> 04/24/2014
>
> [ 7318.583944] task: ffff887f25dde240 ti: ffff883ef6a32000 task.ti:
> ffff883ef6a32000
>
> [ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>]
> pskb_expand_head+0x234/0x270
>
> [ 7318.600295] RSP: 0018:ffff887f7f103978  EFLAGS: 00010202
>
> [ 7318.605770] RAX: 0000000000000002 RBX: ffff887f23417700 RCX:
> 0000000000000020
>
> [ 7318.613016] RDX: 00000000000002ee RSI: 0000000000000000 RDI:
> ffff887f23417700
>
> [ 7318.620278] RBP: ffff887f7f1039b8 R08: 000000005ff00000 R09:
> ffff887f2113e040
>
> [ 7318.627523] R10: 00000000ffffee43 R11: 0000000000000002 R12:
> 0000000000000000
>
> [ 7318.634805] R13: ffff887f23417700 R14: 000000000000000d R15:
> ffff887f23417700
>
> [ 7318.642032] FS:  0000000000000000(0000) GS:ffff887f7f100000(0000)
> knlGS:0000000000000000
>
> [ 7318.650238] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
>
> [ 7318.656110] CR2: 00002ba78155e680 CR3: 0000007f1f8cd000 CR4:
> 00000000001427e0
>
> [ 7318.663378] Stack:
>
> [ 7318.665464]  ffff887f7f1039f8 ffffffff8142ae14 ffffffffa07b50f0
> ffff887f23417700
>
> [ 7318.673226]  ffff887f7f103b58 ffff887f7f103a70 000000000000000d
> ffff887f23417700
>
> [ 7318.681000]  ffff887f7f103a08 ffffffff813eb6fc ffff887f23417700
> 000001f823417700
>
> [ 7318.688790] Call Trace:
>
> [ 7318.691309]  <IRQ>
>
> [ 7318.693290]  [<ffffffff8142ae14>] ? nf_hook_slow+0x74/0x130
>
> [ 7318.699285]  [<ffffffffa07b50f0>] ? deliver_clone+0x60/0x60 [bridge]
>
> [ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
>
> [ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
>
> [ 7318.717599]  [<ffffffffa07de8b0>] queue_userspace_packet+0x3f0/0x440
> [openvswitch]
>
> [ 7318.725289]  [<ffffffffa07dfcd5>] ovs_dp_upcall+0x65/0x70 [openvswitch]
>
> [ 7318.732037]  [<ffffffffa07dc7b6>] do_execute_actions+0x366/0xc00
> [openvswitch]
>
> [ 7318.739403]  [<ffffffff8142ae14>] ? nf_hook_slow+0x74/0x130
>
> [ 7318.745072]  [<ffffffff812a7c9a>] ? arch_fast_hash2+0xa/0x10
>
> [ 7318.750883]  [<ffffffffa07dc7ec>] do_execute_actions+0x39c/0xc00
> [openvswitch]
>
> [ 7318.758221]  [<ffffffffa07b570d>] ? br_forward+0x5d/0x70 [bridge]
>
> [ 7318.764419]  [<ffffffffa07dd0c6>] ovs_execute_actions+0x76/0x110
> [openvswitch]
>
> [ 7318.771773]  [<ffffffffa07dfd6f>]
> ovs_dp_process_packet_with_key+0x8f/0xf0 [openvswitch]
>
> [ 7318.779988]  [<ffffffffa07e0efa>] ? ovs_flow_extract+0x89a/0xab0
> [openvswitch]
>
> [ 7318.787355]  [<ffffffffa07dfe10>]
> ovs_dp_process_received_packet+0x40/0x60 [openvswitch]
>
> [ 7318.795535]  [<ffffffffa07e616a>] ovs_vport_receive+0x2a/0x30
> [openvswitch]
>
> [ 7318.802634]  [<ffffffffa07e7cf5>] netdev_frame_hook+0xc5/0x120
> [openvswitch]
>
> [ 7318.809773]  [<ffffffff813f9f42>] __netif_receive_skb_core+0x332/0x7f0
>
> [ 7318.816418]  [<ffffffffa07e7c30>] ? netdev_create+0x150/0x150
> [openvswitch]
>
> [ 7318.823475]  [<ffffffff813fa426>] __netif_receive_skb+0x26/0x70
>
> [ 7318.829472]  [<ffffffff813fa514>] process_backlog+0xa4/0x180
>
> [ 7318.835223]  [<ffffffff813fa979>] net_rx_action+0x139/0x220
>
> [ 7318.840894]  [<ffffffff81053218>] __do_softirq+0xf8/0x280
>
> [ 7318.846391]  [<ffffffff81504b5c>] do_softirq_own_stack+0x1c/0x30
>
> [ 7318.852517]  <EOI>
>
> [ 7318.854504]  [<ffffffff81053425>] do_softirq+0x45/0x50
>
> [ 7318.860084]  [<ffffffff813f9759>] netif_rx_ni+0x39/0x70
>
> [ 7318.865416]  [<ffffffffa07f1ab3>] tun_get_user+0x413/0x840 [tun]
>
> [ 7318.871506]  [<ffffffffa07f1f3a>] tun_sendmsg+0x5a/0x80 [tun]
>
> [ 7318.877357]  [<ffffffffa0819e32>] handle_tx+0x382/0x400 [vhost_net]
>
> [ 7318.883712]  [<ffffffffa0819ee5>] handle_tx_kick+0x15/0x20 [vhost_net]
>
> [ 7318.890333]  [<ffffffffa080d4f6>] vhost_worker+0xf6/0x190 [vhost]
>
> [ 7318.896528]  [<ffffffffa080d400>] ? vhost_log_access_ok+0x30/0x30
> [vhost]
>
> [ 7318.903454]  [<ffffffff81070c69>] kthread+0xc9/0xe0
>
> [ 7318.908412]  [<ffffffff81070ba0>] ? flush_kthread_worker+0x80/0x80
>
> [ 7318.914674]  [<ffffffff8150342c>] ret_from_fork+0x7c/0xb0
>
> [ 7318.920163]  [<ffffffff81070ba0>] ? flush_kthread_worker+0x80/0x80
>
> [ 7318.926426] Code: 55 c0 e8 f0 38 d4 ff 48 8b 55 c0 84 c0 0f 85 0b ff ff
> ff e9 02 ff ff ff 0f 1f 80 00 00 00 00 41 81 cf 00 20 00 00 e9 1f fe ff ff
> <0f> 0b 0f 0b 44 89 fe 4c 89 ef e8 ad e8 ff ff 85 c0 74 12 48 89
>
> [ 7318.950040] RIP  [<ffffffff813eb634>] pskb_expand_head+0x234/0x270
>
> [ 7318.956385]  RSP <ffff887f7f103978>
>
> [ 7318.959988] ---[ end trace 221c17dcc65b8372 ]---
>
> [ 7319.076935] Kernel panic - not syncing: Fatal exception in interrupt
>
> [ 7319.086993] Kernel Offset: 0x0 from 0xffffffff81000000 (relocation
> range: 0xffffffff80000000-0xffffffff9fffffff)
>
> [ 7319.204560] Rebooting in 10 seconds..
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150212/a1e0e4e2/attachment.html>

From azhou at nicira.com  Thu Feb 12 18:10:03 2015
From: azhou at nicira.com (Andy Zhou)
Date: Thu, 12 Feb 2015 18:10:03 -0800
Subject: [ovs-discuss] Fwd:  OVS segfault in recirculation
In-Reply-To: <CACzMAJ+1w3XnKzuFKYtoLmfNmcCucjWQDFBv+yzeMo9OaWQScA@mail.gmail.com>
References: <54DA2A50.4040201@citrix.com>
 <CACzMAJ+1w3XnKzuFKYtoLmfNmcCucjWQDFBv+yzeMo9OaWQScA@mail.gmail.com>
Message-ID: <CACzMAJ+jAoLpdywerVPF3Xdk=cB+5xJaa+aMYiss7OsxGcQOYQ@mail.gmail.com>

Does not mean to drop the list.


---------- Forwarded message ----------
From: Andy Zhou <azhou at nicira.com>
Date: Thu, Feb 12, 2015 at 3:42 PM
Subject: Re: [ovs-discuss] OVS segfault in recirculation
To: Salvatore Cambria <salvatore.cambria at citrix.com>


Hi, Salvatore,

I think I found a bug: hmap_remove needs to be protected by a lock. As
you pointed out, the output_normal() path is not properly protected.
Would you please
try the attached patch to see if it helps?

Bond object is protected by reference counting.  Assuming reference
counter is valid, it should be O.K. for a bundle to hold on to the
object. Notice
bundle_destroy() calls unref_bond().  At any rate, I did not spot
anything obvious there.

Thanks for providing such a detailed description. It is very helpful.

Andy

================================

iff --git a/ofproto/bond.c b/ofproto/bond.c
index c4b3a3a..a9b7a83 100644
--- a/ofproto/bond.c
+++ b/ofproto/bond.c
@@ -923,8 +923,8 @@ bond_may_recirc(const struct bond *bond, uint32_t
*recirc_id,
     }
 }

-void
-bond_update_post_recirc_rules(struct bond* bond, const bool force)
+static void
+bond_update_post_recirc_rules__(struct bond* bond, const bool force)
 {
    struct bond_entry *e;
    bool update_rules = force;  /* Always update rules if caller forces it. */
@@ -945,6 +945,14 @@ bond_update_post_recirc_rules(struct bond* bond,
const bool force)
         update_recirc_rules(bond);
    }
 }
+
+void
+bond_update_post_recirc_rules(struct bond* bond, const bool force)
+{
+    ovs_rwlock_wrlock(&rwlock);
+    bond_update_post_recirc_rules__(bond, force);
+    ovs_rwlock_unlock(&rwlock);
+}
 ^L
 /* Rebalancing. */

@@ -1203,7 +1211,7 @@ bond_rebalance(struct bond *bond)
     }

     if (use_recirc && rebalanced) {
-        bond_update_post_recirc_rules(bond,true);
+        bond_update_post_recirc_rules__(bond,true);
     }

 done:


On Tue, Feb 10, 2015 at 7:57 AM, Salvatore Cambria
<salvatore.cambria at citrix.com> wrote:
> Hello,
>
> I am a Software Engineer from Citrix, Cambridge UK office.
>
> We are having a problem when running our nightly test on a XenServer host
> with lacp bonds with OVS. Indeed, when deleting the bond the following
> segfault error appears (from GDB):
>
> Program terminated with signal 11, Segmentation fault.
>
> #0  0x0000000000411d2f in hmap_remove (node=0x7fd9d402e730, hmap=0x1c3e9e8)
>
>     at lib/hmap.h:236
>
> 236         while (*bucket != node) {
>
> (gdb) bt
>
> #0  0x0000000000411843 in hmap_remove (node=0x7fd9d402e730, hmap=0x1c3e9e8)
>
>     at lib/hmap.h:236
>
> #1  update_recirc_rules (bond=0x1c3e920) at ofproto/bond.c:382
>
> #2  0x0000000000001ff5 in ?? ()
>
> (gdb) p *hmap
>
> $1 = {buckets = 0x7fd9d4039b70, one = 0x0, mask = 255, n = 147}
>
> (gdb) p *node
>
> $2 = {hash = 2450845263, next = 0x0}
>
> (gdb) p *bucket
>
> Cannot access memory at address 0x8
>
> (gdb) p *(hmap->buckets)
>
> $3 = (struct hmap_node *) 0x0
>
> (gdb) p node->hash & hmap->mask
>
> $4 = 79
>
> (gdb) p *(&hmap->buckets[79])
>
> $5 = (struct hmap_node *) 0x0
>
> I managed to reproduce the error using a while loop in which I repeatedly
> create and destroy a lacp bond, waiting for 15 seconds after each of these
> operations.
>
> The error is not constant in timing and I think that it can be a race
> condition due to the recirculation process. It happens indeed that when
> calling hmap_remove() from update_recirc_rules() (in case of DEL), the
> bucket points to NULL. My idea is the following:
>
> hmap_remove() is called from two different places in ofproto/bond.c:
>
> 1. from update_recirc_rules() (in which it raises the segfault)
>
> hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
> *pr_op->pr_rule = NULL;
> free(pr_op);
>
> 2. and from bond_unref() (called when I try to delete the bond)
>
> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>     hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>     free(pr_op);
> }
>
> Now, if these two calls happen at the same time, a conflict on the bond
> pr_rule may happen. Looking at the code I can see that the recirculation
> hmap_remove() is executed inside an external lock
> (ovs_rwlock_wrlock(&rwlock)) if called by bond_rebalance()
>
> void bond_rebalance(struct bond *bond) {
> ...
> ovs_rwlock_wrlock(&rwlock);
> ...
> ...
> if (use_recirc && rebalanced) {
>     bond_update_post_recirc_rules(bond,true); <---- hmap_remove()
> }
>
> done:
>     ovs_rwlock_unlock(&rwlock);
> }
>
> but I can't see any lock when called by output_normal()
>
> static void output_normal(struct xlate_ctx *ctx, const struct xbundle
> *out_xbundle, uint16_t vlan) {
> ...
> if (ctx->use_recirc) {
>     ...
>     bond_update_post_recirc_rules(out_xbundle->bond, false); <----
> hmap_remove()
>     ...
> }
> ...
>
> The same lock is used in bond_unref() but only for hmap_remove(all_bonds,
> &bond->hmap_node) and not for hmap_remove(&bond->pr_rule_ops,
> &pr_op->hmap_node).
>
> ...
> ovs_rwlock_wrlock(&rwlock);
> hmap_remove(all_bonds, &bond->hmap_node);
> ovs_rwlock_unlock(&rwlock);
> ...
> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>     hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>     free(pr_op);
> }
> ...
>
> I suppose that the goal is to remove any pointer to the bond, from
> all_bonds, inside the lock and to work on it locally. My doubt is: can the
> bond be still accessible from somewhere else (let's say from a bundle)? If
> yes, what happen if a bundle tries to access a bond which was previously
> removed from all_bonds (let's say from bundle_destroy())?
>
> The version of OVS that I am using is openvswitch-2.3.0-7.8312.x86_64.
>
> Could you please help me to find the problem?
>
>
> Thank you for the help & kind regards,
>
> Salvatore
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From kevin.traynor at intel.com  Fri Feb 13 02:58:23 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Fri, 13 Feb 2015 10:58:23 +0000
Subject: [ovs-discuss] Packet drops during non-exhaustive flood with OVS
	and 1.8.0
In-Reply-To: <CABYiri9b_fZJNg186vHLTWVWsAy9UqBvN32WTi26bO5+o93mPQ@mail.gmail.com>
References: <CABYiri-qn_HGYeRSxH+z0+LGi0se9NEOk0q9hzFg4R+wg05ABw@mail.gmail.com>
 <CABYiri9WwQMn1u7TbJNEGCs804f_hvP2cKxet2sGMbrx1rJUyw@mail.gmail.com>
 <CABYiri_q4QqWrhTQL-UZ1wf3FLz-wj9SbtBJrDntz2Bw4cEPoQ@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F730688B53@IRSMSX104.ger.corp.intel.com>
 <CABYiri8qr2v8r_XQO35swWt_OO=WQtW0jO=KAz70f5VojhM6kg@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F7306A3D77@IRSMSX104.ger.corp.intel.com>
 <CABYiri9b_fZJNg186vHLTWVWsAy9UqBvN32WTi26bO5+o93mPQ@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7306A5B5F@IRSMSX104.ger.corp.intel.com>

> -----Original Message-----
> From: Andrey Korolyov [mailto:andrey at xdel.ru]
> Sent: Thursday, February 12, 2015 3:16 PM
> To: Traynor, Kevin
> Cc: dev at dpdk.org; discuss at openvswitch.org
> Subject: Re: Packet drops during non-exhaustive flood with OVS and 1.8.0
> 
> On Thu, Feb 12, 2015 at 6:05 PM, Traynor, Kevin <kevin.traynor at intel.com> wrote:
> >> -----Original Message-----
> >> From: Andrey Korolyov [mailto:andrey at xdel.ru]
> >> Sent: Tuesday, February 3, 2015 5:21 PM
> >> To: Traynor, Kevin
> >> Cc: dev at dpdk.org; discuss at openvswitch.org
> >> Subject: Re: Packet drops during non-exhaustive flood with OVS and 1.8.0
> >>
> >> > These patches are to enable DPDK 1.8 only. What 'bulk processing' are you referring to?
> >> > By default there is a batch size of 192 in netdev-dpdk for rx from the NIC - the linked
> >> > patch doesn't change this, just the DPDK version.
> >>
> >> Sorry, I referred the wrong part there: bulk transmission, which is
> >> clearly not involved in my case. The idea was that the conditionally
> >> enabling prefetch for rx queues (BULK_ALLOC) may help somehow, but
> >> it`s probably will mask issue instead of solving it directly. By my
> >> understanding, strict drop rule should have a zero impact on a main
> >> ovs thread (and this is true) and work just fine with a line rate
> >> (this is not).
> >
> > I've set a similar drop rule and I'm seeing the first packet drops occurring
> > at 13.9 mpps for 64 byte pkts. I'm not sure if there is a config that can be
> > changed or if it just the cost of the emc/lookups
> >
> 
> Do you mind to compare this case with forward to the dummy port
> (ifconfig dummy0; ovs-vsctl add-port br0 dummy0; ip link set dev
> dummy0 up; flush rule table; create a single forward rule; start an
> attack)? As I mentioned there are no signs of syscall congestion for a
> drop or dpdk-dpdk forward case.

Assuming I've understood your setup, I get a very low rate (~1.1 mpps) 
without packet loss as I'm sending the packets from a dpdk port to a 
socket for the dummy port 

From salvatore.cambria at citrix.com  Fri Feb 13 03:56:27 2015
From: salvatore.cambria at citrix.com (Salvatore Cambria)
Date: Fri, 13 Feb 2015 11:56:27 +0000
Subject: [ovs-discuss] Fwd:  OVS segfault in recirculation
In-Reply-To: <CACzMAJ+jAoLpdywerVPF3Xdk=cB+5xJaa+aMYiss7OsxGcQOYQ@mail.gmail.com>
References: <54DA2A50.4040201@citrix.com>	<CACzMAJ+1w3XnKzuFKYtoLmfNmcCucjWQDFBv+yzeMo9OaWQScA@mail.gmail.com>
 <CACzMAJ+jAoLpdywerVPF3Xdk=cB+5xJaa+aMYiss7OsxGcQOYQ@mail.gmail.com>
Message-ID: <54DDE66B.7010503@citrix.com>

Hi Andy,

Yes, it makes a lot of sense!

I applied the patch and I'm running my script again in order to test it. 
It looks good so far!
I will leave the script running all across the weekend and I'll come 
back to you with my results on Monday.

Thank you for your very fast response and for your effort,

Salvatore

On 13/02/15 02:10, Andy Zhou wrote:
> Does not mean to drop the list.
>
>
> ---------- Forwarded message ----------
> From: Andy Zhou <azhou at nicira.com>
> Date: Thu, Feb 12, 2015 at 3:42 PM
> Subject: Re: [ovs-discuss] OVS segfault in recirculation
> To: Salvatore Cambria <salvatore.cambria at citrix.com>
>
>
> Hi, Salvatore,
>
> I think I found a bug: hmap_remove needs to be protected by a lock. As
> you pointed out, the output_normal() path is not properly protected.
> Would you please
> try the attached patch to see if it helps?
>
> Bond object is protected by reference counting.  Assuming reference
> counter is valid, it should be O.K. for a bundle to hold on to the
> object. Notice
> bundle_destroy() calls unref_bond().  At any rate, I did not spot
> anything obvious there.
>
> Thanks for providing such a detailed description. It is very helpful.
>
> Andy
>
> ================================
>
> iff --git a/ofproto/bond.c b/ofproto/bond.c
> index c4b3a3a..a9b7a83 100644
> --- a/ofproto/bond.c
> +++ b/ofproto/bond.c
> @@ -923,8 +923,8 @@ bond_may_recirc(const struct bond *bond, uint32_t
> *recirc_id,
>       }
>   }
>
> -void
> -bond_update_post_recirc_rules(struct bond* bond, const bool force)
> +static void
> +bond_update_post_recirc_rules__(struct bond* bond, const bool force)
>   {
>      struct bond_entry *e;
>      bool update_rules = force;  /* Always update rules if caller forces it. */
> @@ -945,6 +945,14 @@ bond_update_post_recirc_rules(struct bond* bond,
> const bool force)
>           update_recirc_rules(bond);
>      }
>   }
> +
> +void
> +bond_update_post_recirc_rules(struct bond* bond, const bool force)
> +{
> +    ovs_rwlock_wrlock(&rwlock);
> +    bond_update_post_recirc_rules__(bond, force);
> +    ovs_rwlock_unlock(&rwlock);
> +}
>   ^L
>   /* Rebalancing. */
>
> @@ -1203,7 +1211,7 @@ bond_rebalance(struct bond *bond)
>       }
>
>       if (use_recirc && rebalanced) {
> -        bond_update_post_recirc_rules(bond,true);
> +        bond_update_post_recirc_rules__(bond,true);
>       }
>
>   done:
>
>
> On Tue, Feb 10, 2015 at 7:57 AM, Salvatore Cambria
> <salvatore.cambria at citrix.com> wrote:
>> Hello,
>>
>> I am a Software Engineer from Citrix, Cambridge UK office.
>>
>> We are having a problem when running our nightly test on a XenServer host
>> with lacp bonds with OVS. Indeed, when deleting the bond the following
>> segfault error appears (from GDB):
>>
>> Program terminated with signal 11, Segmentation fault.
>>
>> #0  0x0000000000411d2f in hmap_remove (node=0x7fd9d402e730, hmap=0x1c3e9e8)
>>
>>      at lib/hmap.h:236
>>
>> 236         while (*bucket != node) {
>>
>> (gdb) bt
>>
>> #0  0x0000000000411843 in hmap_remove (node=0x7fd9d402e730, hmap=0x1c3e9e8)
>>
>>      at lib/hmap.h:236
>>
>> #1  update_recirc_rules (bond=0x1c3e920) at ofproto/bond.c:382
>>
>> #2  0x0000000000001ff5 in ?? ()
>>
>> (gdb) p *hmap
>>
>> $1 = {buckets = 0x7fd9d4039b70, one = 0x0, mask = 255, n = 147}
>>
>> (gdb) p *node
>>
>> $2 = {hash = 2450845263, next = 0x0}
>>
>> (gdb) p *bucket
>>
>> Cannot access memory at address 0x8
>>
>> (gdb) p *(hmap->buckets)
>>
>> $3 = (struct hmap_node *) 0x0
>>
>> (gdb) p node->hash & hmap->mask
>>
>> $4 = 79
>>
>> (gdb) p *(&hmap->buckets[79])
>>
>> $5 = (struct hmap_node *) 0x0
>>
>> I managed to reproduce the error using a while loop in which I repeatedly
>> create and destroy a lacp bond, waiting for 15 seconds after each of these
>> operations.
>>
>> The error is not constant in timing and I think that it can be a race
>> condition due to the recirculation process. It happens indeed that when
>> calling hmap_remove() from update_recirc_rules() (in case of DEL), the
>> bucket points to NULL. My idea is the following:
>>
>> hmap_remove() is called from two different places in ofproto/bond.c:
>>
>> 1. from update_recirc_rules() (in which it raises the segfault)
>>
>> hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>> *pr_op->pr_rule = NULL;
>> free(pr_op);
>>
>> 2. and from bond_unref() (called when I try to delete the bond)
>>
>> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>>      hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>      free(pr_op);
>> }
>>
>> Now, if these two calls happen at the same time, a conflict on the bond
>> pr_rule may happen. Looking at the code I can see that the recirculation
>> hmap_remove() is executed inside an external lock
>> (ovs_rwlock_wrlock(&rwlock)) if called by bond_rebalance()
>>
>> void bond_rebalance(struct bond *bond) {
>> ...
>> ovs_rwlock_wrlock(&rwlock);
>> ...
>> ...
>> if (use_recirc && rebalanced) {
>>      bond_update_post_recirc_rules(bond,true); <---- hmap_remove()
>> }
>>
>> done:
>>      ovs_rwlock_unlock(&rwlock);
>> }
>>
>> but I can't see any lock when called by output_normal()
>>
>> static void output_normal(struct xlate_ctx *ctx, const struct xbundle
>> *out_xbundle, uint16_t vlan) {
>> ...
>> if (ctx->use_recirc) {
>>      ...
>>      bond_update_post_recirc_rules(out_xbundle->bond, false); <----
>> hmap_remove()
>>      ...
>> }
>> ...
>>
>> The same lock is used in bond_unref() but only for hmap_remove(all_bonds,
>> &bond->hmap_node) and not for hmap_remove(&bond->pr_rule_ops,
>> &pr_op->hmap_node).
>>
>> ...
>> ovs_rwlock_wrlock(&rwlock);
>> hmap_remove(all_bonds, &bond->hmap_node);
>> ovs_rwlock_unlock(&rwlock);
>> ...
>> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>>      hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>      free(pr_op);
>> }
>> ...
>>
>> I suppose that the goal is to remove any pointer to the bond, from
>> all_bonds, inside the lock and to work on it locally. My doubt is: can the
>> bond be still accessible from somewhere else (let's say from a bundle)? If
>> yes, what happen if a bundle tries to access a bond which was previously
>> removed from all_bonds (let's say from bundle_destroy())?
>>
>> The version of OVS that I am using is openvswitch-2.3.0-7.8312.x86_64.
>>
>> Could you please help me to find the problem?
>>
>>
>> Thank you for the help & kind regards,
>>
>> Salvatore
>>
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>


From amuller at redhat.com  Fri Feb 13 06:59:05 2015
From: amuller at redhat.com (Assaf Muller)
Date: Fri, 13 Feb 2015 09:59:05 -0500 (EST)
Subject: [ovs-discuss] ovs-vswitchd crashes with reproducible script
In-Reply-To: <269737045.14416872.1423839413303.JavaMail.zimbra@redhat.com>
Message-ID: <1617944887.14420786.1423839545887.JavaMail.zimbra@redhat.com>

Hi everyone,

This issue started manifesting during OpenStack Neutron functional test runs:
https://bugs.launchpad.net/neutron/+bug/1418097

If I run this trimmed down script:
http://pastebin.com/raw.php?i=tbts9Ru0

One of two things happen:
1) ovs-vswitchd crashes
2) I get a kernel panic

ovs-vswitchd --version
ovs-vswitchd (Open vSwitch) 2.3.1
Compiled Dec 12 2014 21:42:15
OpenFlow versions 0x1:0x1

Linux version 3.17.2-200.fc20.x86_64
Fedora 20

Note: I sent this email once while I was not subscribed to the mailing
list. Please don't approve that earlier submission.


Assaf Muller, Cloud Networking Engineer
Red Hat

From blp at nicira.com  Fri Feb 13 08:09:50 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 13 Feb 2015 08:09:50 -0800
Subject: [ovs-discuss] ovs-vswitchd crashes with reproducible script
In-Reply-To: <1617944887.14420786.1423839545887.JavaMail.zimbra@redhat.com>
References: <269737045.14416872.1423839413303.JavaMail.zimbra@redhat.com>
 <1617944887.14420786.1423839545887.JavaMail.zimbra@redhat.com>
Message-ID: <20150213160950.GA793@nicira.com>

Pravin, can you take a look at the kernel crash part of this?  After
looking through the bug report for a minute, I found a link to the
kernel backtrace at
https://retrace.fedoraproject.org/faf/reports/566500/.  I notice that
that link has, in addition to the raw backtrace, a nicer one that
includes file names and line numbers.

On Fri, Feb 13, 2015 at 09:59:05AM -0500, Assaf Muller wrote:
> Hi everyone,
> 
> This issue started manifesting during OpenStack Neutron functional test runs:
> https://bugs.launchpad.net/neutron/+bug/1418097
> 
> If I run this trimmed down script:
> http://pastebin.com/raw.php?i=tbts9Ru0
> 
> One of two things happen:
> 1) ovs-vswitchd crashes
> 2) I get a kernel panic
> 
> ovs-vswitchd --version
> ovs-vswitchd (Open vSwitch) 2.3.1
> Compiled Dec 12 2014 21:42:15
> OpenFlow versions 0x1:0x1
> 
> Linux version 3.17.2-200.fc20.x86_64
> Fedora 20
> 
> Note: I sent this email once while I was not subscribed to the mailing
> list. Please don't approve that earlier submission.
> 
> 
> Assaf Muller, Cloud Networking Engineer
> Red Hat
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Fri Feb 13 08:11:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 13 Feb 2015 08:11:45 -0800
Subject: [ovs-discuss] ovs-vswitchd crashes with reproducible script
In-Reply-To: <1617944887.14420786.1423839545887.JavaMail.zimbra@redhat.com>
References: <269737045.14416872.1423839413303.JavaMail.zimbra@redhat.com>
 <1617944887.14420786.1423839545887.JavaMail.zimbra@redhat.com>
Message-ID: <20150213161145.GB793@nicira.com>

Hi Assaf.  I think we have enough information to take a look at the
kernel crash.  I don't see any information on the ovs-vswitchd crash,
though.  Can you provide a backtrace?

On Fri, Feb 13, 2015 at 09:59:05AM -0500, Assaf Muller wrote:
> This issue started manifesting during OpenStack Neutron functional test runs:
> https://bugs.launchpad.net/neutron/+bug/1418097
> 
> If I run this trimmed down script:
> http://pastebin.com/raw.php?i=tbts9Ru0
> 
> One of two things happen:
> 1) ovs-vswitchd crashes
> 2) I get a kernel panic
> 
> ovs-vswitchd --version
> ovs-vswitchd (Open vSwitch) 2.3.1
> Compiled Dec 12 2014 21:42:15
> OpenFlow versions 0x1:0x1
> 
> Linux version 3.17.2-200.fc20.x86_64
> Fedora 20

From blp at nicira.com  Fri Feb 13 08:37:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 13 Feb 2015 08:37:45 -0800
Subject: [ovs-discuss] 4 byte long port numbers
In-Reply-To: <AM3PR04MB0759D5928AA7598F7E5A1F1CB9220@AM3PR04MB0759.eurprd04.prod.outlook.com>
References: <AM3PR04MB0759D5928AA7598F7E5A1F1CB9220@AM3PR04MB0759.eurprd04.prod.outlook.com>
Message-ID: <20150213163745.GE793@nicira.com>

On Thu, Feb 12, 2015 at 12:26:14PM +0000, Eyal Nissim wrote:
> While openflow1.3 and up supports 4 byte long port numbers (see spec and OFPP_MAX)
> (I'm also referring to messages such as multi part port description, packet out etc...), I've found out lately that
> OVS and OVSDB support only 2 byte long port  numbers
> 
> root at IP20C:/root> ovs-vsctl add-port IP20C-2 alpha -- set interface alpha type=internal ofport_request=268443713
> ovs-vsctl: constraint violation: 268443713 is not in the valid range 1 to 65279 (inclusive)
> 
> even if I bypass ofport_request and use ofport directly, vswitch still doesn't accept 4 bytes for the port number
> Is there any intension to change ofport_request type to unsigned integer in the future?

OpenFlow 1.0 compatibility is the issue.  If you come up with a way to
make port numbers out of the 16-bit range compatible with OpenFlow 1.0,
we'd accept a patch to support a 32-bit range.  One acceptable way would
be to allow port numbers out of the 32-bit range only when OpenFlow 1.0
support is disabled.

From amuller at redhat.com  Thu Feb 12 13:03:47 2015
From: amuller at redhat.com (Assaf Muller)
Date: Thu, 12 Feb 2015 16:03:47 -0500 (EST)
Subject: [ovs-discuss] ovs-vswitchd crashes with reproducible script
In-Reply-To: <236503717.13849274.1423774007430.JavaMail.zimbra@redhat.com>
Message-ID: <210396083.13856665.1423775027433.JavaMail.zimbra@redhat.com>

Hi everyone,

This issue started manifesting during OpenStack Neutron functional test runs:
https://bugs.launchpad.net/neutron/+bug/1418097

If I run this trimmed down script:
http://pastebin.com/raw.php?i=tbts9Ru0

One of two things happen:
1) ovs-vswitchd crashes
2) I get a kernel panic

ovs-vswitchd --version
ovs-vswitchd (Open vSwitch) 2.3.1
Compiled Dec 12 2014 21:42:15
OpenFlow versions 0x1:0x1

Linux version 3.17.2-200.fc20.x86_64
Fedora 20


Assaf Muller, Cloud Networking Engineer
Red Hat

From blp at nicira.com  Fri Feb 13 09:06:05 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 13 Feb 2015 09:06:05 -0800
Subject: [ovs-discuss] Need some info on integrating patches with main
 code
In-Reply-To: <CAGuFQhAPGDz7GfyUBKXJ1TeMbE7nv0yPiPN4PQtPtwGLC=fxRg@mail.gmail.com>
References: <CAGuFQhAPGDz7GfyUBKXJ1TeMbE7nv0yPiPN4PQtPtwGLC=fxRg@mail.gmail.com>
Message-ID: <20150213170605.GI793@nicira.com>

On Fri, Feb 13, 2015 at 12:50:47AM +0530, Shankari Vaidyalingam wrote:
> Please let me know the command to integrate a set of patches into the
> mainstream OVS code (I'd like to have the command for doing this/especially
> what are the steps that need to be followed)

http://jungels.net/articles/diff-patch-ten-minutes.html

From azhou at nicira.com  Fri Feb 13 09:18:16 2015
From: azhou at nicira.com (Andy Zhou)
Date: Fri, 13 Feb 2015 09:18:16 -0800
Subject: [ovs-discuss] Fwd:  OVS segfault in recirculation
In-Reply-To: <54DDE66B.7010503@citrix.com>
References: <54DA2A50.4040201@citrix.com>
 <CACzMAJ+1w3XnKzuFKYtoLmfNmcCucjWQDFBv+yzeMo9OaWQScA@mail.gmail.com>
 <CACzMAJ+jAoLpdywerVPF3Xdk=cB+5xJaa+aMYiss7OsxGcQOYQ@mail.gmail.com>
 <54DDE66B.7010503@citrix.com>
Message-ID: <CACzMAJLdTgd5L3tz=o+4SFA5fLaZ=KVYbqtLX63rR43+q8XLAA@mail.gmail.com>

Great! looking forward to the test results.

On Fri, Feb 13, 2015 at 3:56 AM, Salvatore Cambria
<salvatore.cambria at citrix.com> wrote:
> Hi Andy,
>
> Yes, it makes a lot of sense!
>
> I applied the patch and I'm running my script again in order to test it. It
> looks good so far!
> I will leave the script running all across the weekend and I'll come back to
> you with my results on Monday.
>
> Thank you for your very fast response and for your effort,
>
> Salvatore
>
> On 13/02/15 02:10, Andy Zhou wrote:
>>
>> Does not mean to drop the list.
>>
>>
>> ---------- Forwarded message ----------
>> From: Andy Zhou <azhou at nicira.com>
>> Date: Thu, Feb 12, 2015 at 3:42 PM
>> Subject: Re: [ovs-discuss] OVS segfault in recirculation
>> To: Salvatore Cambria <salvatore.cambria at citrix.com>
>>
>>
>> Hi, Salvatore,
>>
>> I think I found a bug: hmap_remove needs to be protected by a lock. As
>> you pointed out, the output_normal() path is not properly protected.
>> Would you please
>> try the attached patch to see if it helps?
>>
>> Bond object is protected by reference counting.  Assuming reference
>> counter is valid, it should be O.K. for a bundle to hold on to the
>> object. Notice
>> bundle_destroy() calls unref_bond().  At any rate, I did not spot
>> anything obvious there.
>>
>> Thanks for providing such a detailed description. It is very helpful.
>>
>> Andy
>>
>> ================================
>>
>> iff --git a/ofproto/bond.c b/ofproto/bond.c
>> index c4b3a3a..a9b7a83 100644
>> --- a/ofproto/bond.c
>> +++ b/ofproto/bond.c
>> @@ -923,8 +923,8 @@ bond_may_recirc(const struct bond *bond, uint32_t
>> *recirc_id,
>>       }
>>   }
>>
>> -void
>> -bond_update_post_recirc_rules(struct bond* bond, const bool force)
>> +static void
>> +bond_update_post_recirc_rules__(struct bond* bond, const bool force)
>>   {
>>      struct bond_entry *e;
>>      bool update_rules = force;  /* Always update rules if caller forces
>> it. */
>> @@ -945,6 +945,14 @@ bond_update_post_recirc_rules(struct bond* bond,
>> const bool force)
>>           update_recirc_rules(bond);
>>      }
>>   }
>> +
>> +void
>> +bond_update_post_recirc_rules(struct bond* bond, const bool force)
>> +{
>> +    ovs_rwlock_wrlock(&rwlock);
>> +    bond_update_post_recirc_rules__(bond, force);
>> +    ovs_rwlock_unlock(&rwlock);
>> +}
>>   ^L
>>   /* Rebalancing. */
>>
>> @@ -1203,7 +1211,7 @@ bond_rebalance(struct bond *bond)
>>       }
>>
>>       if (use_recirc && rebalanced) {
>> -        bond_update_post_recirc_rules(bond,true);
>> +        bond_update_post_recirc_rules__(bond,true);
>>       }
>>
>>   done:
>>
>>
>> On Tue, Feb 10, 2015 at 7:57 AM, Salvatore Cambria
>> <salvatore.cambria at citrix.com> wrote:
>>>
>>> Hello,
>>>
>>> I am a Software Engineer from Citrix, Cambridge UK office.
>>>
>>> We are having a problem when running our nightly test on a XenServer host
>>> with lacp bonds with OVS. Indeed, when deleting the bond the following
>>> segfault error appears (from GDB):
>>>
>>> Program terminated with signal 11, Segmentation fault.
>>>
>>> #0  0x0000000000411d2f in hmap_remove (node=0x7fd9d402e730,
>>> hmap=0x1c3e9e8)
>>>
>>>      at lib/hmap.h:236
>>>
>>> 236         while (*bucket != node) {
>>>
>>> (gdb) bt
>>>
>>> #0  0x0000000000411843 in hmap_remove (node=0x7fd9d402e730,
>>> hmap=0x1c3e9e8)
>>>
>>>      at lib/hmap.h:236
>>>
>>> #1  update_recirc_rules (bond=0x1c3e920) at ofproto/bond.c:382
>>>
>>> #2  0x0000000000001ff5 in ?? ()
>>>
>>> (gdb) p *hmap
>>>
>>> $1 = {buckets = 0x7fd9d4039b70, one = 0x0, mask = 255, n = 147}
>>>
>>> (gdb) p *node
>>>
>>> $2 = {hash = 2450845263, next = 0x0}
>>>
>>> (gdb) p *bucket
>>>
>>> Cannot access memory at address 0x8
>>>
>>> (gdb) p *(hmap->buckets)
>>>
>>> $3 = (struct hmap_node *) 0x0
>>>
>>> (gdb) p node->hash & hmap->mask
>>>
>>> $4 = 79
>>>
>>> (gdb) p *(&hmap->buckets[79])
>>>
>>> $5 = (struct hmap_node *) 0x0
>>>
>>> I managed to reproduce the error using a while loop in which I repeatedly
>>> create and destroy a lacp bond, waiting for 15 seconds after each of
>>> these
>>> operations.
>>>
>>> The error is not constant in timing and I think that it can be a race
>>> condition due to the recirculation process. It happens indeed that when
>>> calling hmap_remove() from update_recirc_rules() (in case of DEL), the
>>> bucket points to NULL. My idea is the following:
>>>
>>> hmap_remove() is called from two different places in ofproto/bond.c:
>>>
>>> 1. from update_recirc_rules() (in which it raises the segfault)
>>>
>>> hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>> *pr_op->pr_rule = NULL;
>>> free(pr_op);
>>>
>>> 2. and from bond_unref() (called when I try to delete the bond)
>>>
>>> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>>>      hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>>      free(pr_op);
>>> }
>>>
>>> Now, if these two calls happen at the same time, a conflict on the bond
>>> pr_rule may happen. Looking at the code I can see that the recirculation
>>> hmap_remove() is executed inside an external lock
>>> (ovs_rwlock_wrlock(&rwlock)) if called by bond_rebalance()
>>>
>>> void bond_rebalance(struct bond *bond) {
>>> ...
>>> ovs_rwlock_wrlock(&rwlock);
>>> ...
>>> ...
>>> if (use_recirc && rebalanced) {
>>>      bond_update_post_recirc_rules(bond,true); <---- hmap_remove()
>>> }
>>>
>>> done:
>>>      ovs_rwlock_unlock(&rwlock);
>>> }
>>>
>>> but I can't see any lock when called by output_normal()
>>>
>>> static void output_normal(struct xlate_ctx *ctx, const struct xbundle
>>> *out_xbundle, uint16_t vlan) {
>>> ...
>>> if (ctx->use_recirc) {
>>>      ...
>>>      bond_update_post_recirc_rules(out_xbundle->bond, false); <----
>>> hmap_remove()
>>>      ...
>>> }
>>> ...
>>>
>>> The same lock is used in bond_unref() but only for hmap_remove(all_bonds,
>>> &bond->hmap_node) and not for hmap_remove(&bond->pr_rule_ops,
>>> &pr_op->hmap_node).
>>>
>>> ...
>>> ovs_rwlock_wrlock(&rwlock);
>>> hmap_remove(all_bonds, &bond->hmap_node);
>>> ovs_rwlock_unlock(&rwlock);
>>> ...
>>> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>>>      hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>>      free(pr_op);
>>> }
>>> ...
>>>
>>> I suppose that the goal is to remove any pointer to the bond, from
>>> all_bonds, inside the lock and to work on it locally. My doubt is: can
>>> the
>>> bond be still accessible from somewhere else (let's say from a bundle)?
>>> If
>>> yes, what happen if a bundle tries to access a bond which was previously
>>> removed from all_bonds (let's say from bundle_destroy())?
>>>
>>> The version of OVS that I am using is openvswitch-2.3.0-7.8312.x86_64.
>>>
>>> Could you please help me to find the problem?
>>>
>>>
>>> Thank you for the help & kind regards,
>>>
>>> Salvatore
>>>
>>>
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>
>

From blp at nicira.com  Fri Feb 13 09:24:35 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 13 Feb 2015 09:24:35 -0800
Subject: [ovs-discuss] debugging openvswitch command-line clients
In-Reply-To: <CANPUzQ0gsrzzxvSL_H6cF6d3EbTjoi6YjVytC4OJUvCqqyOX2A@mail.gmail.com>
References: <CANPUzQ0hmMBdRLt5rg7GOV7mQf_WM3jxTR5_k_SZ-V4TYcYFxg@mail.gmail.com>
 <20150201215439.GC24647@nicira.com>
 <CANPUzQ0qwW65PVUvwKQxvyZLtBwqd--dWh7fSx4XJK82uT+6jA@mail.gmail.com>
 <20150203165144.GH18144@nicira.com>
 <CANPUzQ0gsrzzxvSL_H6cF6d3EbTjoi6YjVytC4OJUvCqqyOX2A@mail.gmail.com>
Message-ID: <20150213172435.GK793@nicira.com>

It's no different from debugging any other program, so you can read any
introduction to debugging.

On Wed, Feb 11, 2015 at 11:58:37AM +0500, david jhon wrote:
> I have been striving hard lately to debug openvswitch after building it
> from source on Ubuntu 14.04, but still not successful. Could you please
> suggest me some document or link which might be helpful for a noob to get
> his hands dirty on ovs debugging and development.
> 
> Waiting for your response...................
> 
> On Tue, Feb 3, 2015 at 9:51 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Tue, Feb 03, 2015 at 12:12:09AM +0500, david jhon wrote:
> > > Hi Ben,
> > >
> > > Thanks for your response.
> > >
> > > It means that after setting up a break point at cmd_show() method and
> > > attaching gdb to ovsdb-server pid (i.e., gdb ovs-vsctl.o
> > > --pid=ovsdb-serverpid), I am not able to debug this specific file as
> > single
> > > stepping results in the following output:
> > >      (gdb) n
> > >      Single stepping until exit from function __kernel_vsyscall,
> > >      which has no line number information.
> > >      Warning:
> > >      Cannot insert breakpoint 1.
> > >      Cannot access memory at address 0x9353
> > >
> > > please guide me what I am doing wrong. how gdb can be used to debug
> > > openvswitch. Thank you!
> >
> > That's not anything OVS-specific.  It means that you can't single-step
> > into a system call.  If you need more information, then please ask about
> > it on a GDB or Linux-kernel mailing list.
> >

From pshelar at nicira.com  Fri Feb 13 14:06:04 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Fri, 13 Feb 2015 14:06:04 -0800
Subject: [ovs-discuss] ovs-vswitchd crashes with reproducible script
In-Reply-To: <20150213160950.GA793@nicira.com>
References: <269737045.14416872.1423839413303.JavaMail.zimbra@redhat.com>
 <1617944887.14420786.1423839545887.JavaMail.zimbra@redhat.com>
 <20150213160950.GA793@nicira.com>
Message-ID: <CALnjE+qg7JoSwxxhxhGoEeKRHZZpHNqoA0VyPmG8Af_8SKisgQ@mail.gmail.com>

I found a bug with OVS and namespace interaction. I am working on a fix.

On Fri, Feb 13, 2015 at 8:09 AM, Ben Pfaff <blp at nicira.com> wrote:
> Pravin, can you take a look at the kernel crash part of this?  After
> looking through the bug report for a minute, I found a link to the
> kernel backtrace at
> https://retrace.fedoraproject.org/faf/reports/566500/.  I notice that
> that link has, in addition to the raw backtrace, a nicer one that
> includes file names and line numbers.
>
> On Fri, Feb 13, 2015 at 09:59:05AM -0500, Assaf Muller wrote:
>> Hi everyone,
>>
>> This issue started manifesting during OpenStack Neutron functional test runs:
>> https://bugs.launchpad.net/neutron/+bug/1418097
>>
>> If I run this trimmed down script:
>> http://pastebin.com/raw.php?i=tbts9Ru0
>>
>> One of two things happen:
>> 1) ovs-vswitchd crashes
>> 2) I get a kernel panic
>>
>> ovs-vswitchd --version
>> ovs-vswitchd (Open vSwitch) 2.3.1
>> Compiled Dec 12 2014 21:42:15
>> OpenFlow versions 0x1:0x1
>>
>> Linux version 3.17.2-200.fc20.x86_64
>> Fedora 20
>>
>> Note: I sent this email once while I was not subscribed to the mailing
>> list. Please don't approve that earlier submission.
>>
>>
>> Assaf Muller, Cloud Networking Engineer
>> Red Hat
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss

From abhishek.lists at gmail.com  Fri Feb 13 14:57:07 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Fri, 13 Feb 2015 14:57:07 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
Message-ID: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>

Hi all,

I am trying to run OVS in a docker container. A process on the
container adds a bridge using ovs-vsctl and another queries it using
ip link show. After the bridge is added, it shows up on querying using
ovs-vsctl but does not show up on ip link show. ovs-vswitchd log shows
the bridge being added, being configured and after some time, it does
not show up. On the host, everything works fine till the container is
started. How do I debug this?

The container is running with host networking and in privileged mode.

For the host:
cloudscaling at mngmt2:~/ovs> uname -a
Linux mngmt2 3.16.7-7-desktop #1 SMP PREEMPT Wed Dec 17 18:00:44 UTC
2014 (762f27a) x86_64 x86_64 x86_64 GNU/Linux
cloudscaling at mngmt2:~/ovs> ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.3.90
Compiled Feb 13 2015 12:42:21
DB Schema 7.11.1

Thanks

From nodir.qodirov at gmail.com  Fri Feb 13 20:01:17 2015
From: nodir.qodirov at gmail.com (Nodir Kodirov)
Date: Fri, 13 Feb 2015 20:01:17 -0800
Subject: [ovs-discuss] ovs-docker fails to add port to the bridge
Message-ID: <CADL6tVMxpdAb9PDnd3rFBm=8bQPN4L2iUZp_yjsniAp=fhzc+Q@mail.gmail.com>

Hi,

I am trying to attach another interface to my Docker by:

sudo ovs-docker add-port br-int eth1 5338a16d7722

It fails with following error message:

2015-02-14T03:31:46Z|00002|fatal_signal|WARN|terminating with signal
14 (Alarm clock)
Alarm clock
ovs-docker: Failed to add 9b3a98108dd24_l port to bridge br-int

Here is what I get from `sudo ovs-vsctl show` after running the command
    Bridge br-int
        Port br-int
            Interface br-int
                type: internal
        Port "9b3a98108dd24_l"
            Interface "9b3a98108dd24_l"
    ovs_version: "2.3.90"

Although new port (9b3a98108dd24_l) is added to the br-int, Docker
does not have eth1; it has eth0 only. My Docker host machine (the one
running OVS) is Ubuntu 14.04 LTS and OVS was installed via `sudo
apt-get install openvswitch-switch`

Here is the output from `sudo ovs-vsctl --version`
ovs-vsctl (Open vSwitch) 2.3.90
Compiled Jan 11 2015 18:42:23
DB Schema 7.11.1

Any help is appreciated.

Nodir.

From shettyg at nicira.com  Fri Feb 13 20:25:14 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 13 Feb 2015 20:25:14 -0800
Subject: [ovs-discuss] ovs-docker fails to add port to the bridge
In-Reply-To: <CADL6tVMxpdAb9PDnd3rFBm=8bQPN4L2iUZp_yjsniAp=fhzc+Q@mail.gmail.com>
References: <CADL6tVMxpdAb9PDnd3rFBm=8bQPN4L2iUZp_yjsniAp=fhzc+Q@mail.gmail.com>
Message-ID: <777EF060-FA14-47E5-8977-B0CDFF97C30D@nicira.com>




> On Feb 13, 2015, at 8:01 PM, Nodir Kodirov <nodir.qodirov at gmail.com> wrote:
> 
> Hi,
> 
> I am trying to attach another interface to my Docker by:
> 
> sudo ovs-docker add-port br-int eth1 5338a16d7722
> 
> It fails with following error message:
> 
> 2015-02-14T03:31:46Z|00002|fatal_signal|WARN|terminating with signal
> 14 (Alarm clock)
> Alarm clock
> ovs-docker: Failed to add 9b3a98108dd24_l port to bridge br-int
What version of docker is this?
> 
> Here is what I get from `sudo ovs-vsctl show` after running the command
>    Bridge br-int
>        Port br-int
>            Interface br-int
>                type: internal
>        Port "9b3a98108dd24_l"
>            Interface "9b3a98108dd24_l"
>    ovs_version: "2.3.90"
> 
> Although new port (9b3a98108dd24_l) is added to the br-int, Docker
> does not have eth1; it has eth0 only. My Docker host machine (the one
> running OVS) is Ubuntu 14.04 LTS and OVS was installed via `sudo
> apt-get install openvswitch-switch`
> 
> Here is the output from `sudo ovs-vsctl --version`
> ovs-vsctl (Open vSwitch) 2.3.90
> Compiled Jan 11 2015 18:42:23
> DB Schema 7.11.1
> 
> Any help is appreciated.
> 
> Nodir.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From nodir.qodirov at gmail.com  Fri Feb 13 20:27:51 2015
From: nodir.qodirov at gmail.com (Nodir Kodirov)
Date: Fri, 13 Feb 2015 20:27:51 -0800
Subject: [ovs-discuss] ovs-docker fails to add port to the bridge
In-Reply-To: <777EF060-FA14-47E5-8977-B0CDFF97C30D@nicira.com>
References: <CADL6tVMxpdAb9PDnd3rFBm=8bQPN4L2iUZp_yjsniAp=fhzc+Q@mail.gmail.com>
 <777EF060-FA14-47E5-8977-B0CDFF97C30D@nicira.com>
Message-ID: <CADL6tVMrA9Z1fEivDstE1r_g5sq6K=G61tVbT60c4izKydTLcQ@mail.gmail.com>

$ sudo docker version

Client version: 1.4.1
Client API version: 1.16
Go version (client): go1.3.3
Git commit (client): 5bc2ff8
OS/Arch (client): linux/amd64
Server version: 1.4.1
Server API version: 1.16
Go version (server): go1.3.3
Git commit (server): 5bc2ff8

Nodir.


On 13 February 2015 at 20:25, Gurucharan Shetty <shettyg at nicira.com> wrote:
>
>
>
>> On Feb 13, 2015, at 8:01 PM, Nodir Kodirov <nodir.qodirov at gmail.com> wrote:
>>
>> Hi,
>>
>> I am trying to attach another interface to my Docker by:
>>
>> sudo ovs-docker add-port br-int eth1 5338a16d7722
>>
>> It fails with following error message:
>>
>> 2015-02-14T03:31:46Z|00002|fatal_signal|WARN|terminating with signal
>> 14 (Alarm clock)
>> Alarm clock
>> ovs-docker: Failed to add 9b3a98108dd24_l port to bridge br-int
> What version of docker is this?
>>
>> Here is what I get from `sudo ovs-vsctl show` after running the command
>>    Bridge br-int
>>        Port br-int
>>            Interface br-int
>>                type: internal
>>        Port "9b3a98108dd24_l"
>>            Interface "9b3a98108dd24_l"
>>    ovs_version: "2.3.90"
>>
>> Although new port (9b3a98108dd24_l) is added to the br-int, Docker
>> does not have eth1; it has eth0 only. My Docker host machine (the one
>> running OVS) is Ubuntu 14.04 LTS and OVS was installed via `sudo
>> apt-get install openvswitch-switch`
>>
>> Here is the output from `sudo ovs-vsctl --version`
>> ovs-vsctl (Open vSwitch) 2.3.90
>> Compiled Jan 11 2015 18:42:23
>> DB Schema 7.11.1
>>
>> Any help is appreciated.
>>
>> Nodir.
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss

From shettyg at nicira.com  Fri Feb 13 21:24:29 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 13 Feb 2015 21:24:29 -0800
Subject: [ovs-discuss] ovs-docker fails to add port to the bridge
In-Reply-To: <777EF060-FA14-47E5-8977-B0CDFF97C30D@nicira.com>
References: <CADL6tVMxpdAb9PDnd3rFBm=8bQPN4L2iUZp_yjsniAp=fhzc+Q@mail.gmail.com>
 <777EF060-FA14-47E5-8977-B0CDFF97C30D@nicira.com>
Message-ID: <CAHbON5pERogr7x9CQTcT9a8tieBasEY2Xtyg_wRo_8tJybEEWg@mail.gmail.com>

>>
>> 2015-02-14T03:31:46Z|00002|fatal_signal|WARN|terminating with signal
>> 14 (Alarm clock)
>> Alarm clock
That looks like a OVS executable throwing a fatal error message.

What happens if you now try to add 'eth2'?
sudo ovs-docker add-port br-int eth2 5338a16d7722

If you still see the error, make sure ovs-vswitchd and ovsdb-server is running:

ps -ef | grep ovs-vswitchd
ps -ef | grep ovsdb-server

You can also see whats going on by simply running:
/bin/bash -x ovs-docker add-port br-int eth3 5338a16d7722

From shettyg at nicira.com  Fri Feb 13 21:35:15 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 13 Feb 2015 21:35:15 -0800
Subject: [ovs-discuss] ovs-docker fails to add port to the bridge
In-Reply-To: <CADL6tVMxpdAb9PDnd3rFBm=8bQPN4L2iUZp_yjsniAp=fhzc+Q@mail.gmail.com>
References: <CADL6tVMxpdAb9PDnd3rFBm=8bQPN4L2iUZp_yjsniAp=fhzc+Q@mail.gmail.com>
Message-ID: <CAHbON5pBt_Gab548pFWmzovGeP0=j-MHmkHYc7PykLhE8AHrrQ@mail.gmail.com>

> Although new port (9b3a98108dd24_l) is added to the br-int, Docker
> does not have eth1; it has eth0 only. My Docker host machine (the one
> running OVS) is Ubuntu 14.04 LTS and OVS was installed via `sudo
> apt-get install openvswitch-switch`
It shouldn't matter, but doesn't 14.04 come with OVS 2.0.2. So you
likely manually installed OVS from master (2.3.90)? If so, I hope you
installed the new one in the right paths (find / -name ovs-vsctl
should show just one. 'ovs-appctl version' should show the correct
version.)
>
> Here is the output from `sudo ovs-vsctl --version`
> ovs-vsctl (Open vSwitch) 2.3.90
> Compiled Jan 11 2015 18:42:23
> DB Schema 7.11.1
>
> Any help is appreciated.
>
> Nodir.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From nodir.qodirov at gmail.com  Fri Feb 13 21:58:03 2015
From: nodir.qodirov at gmail.com (Nodir Kodirov)
Date: Fri, 13 Feb 2015 21:58:03 -0800
Subject: [ovs-discuss] ovs-docker fails to add port to the bridge
In-Reply-To: <CAHbON5pBt_Gab548pFWmzovGeP0=j-MHmkHYc7PykLhE8AHrrQ@mail.gmail.com>
References: <CADL6tVMxpdAb9PDnd3rFBm=8bQPN4L2iUZp_yjsniAp=fhzc+Q@mail.gmail.com>
 <CAHbON5pBt_Gab548pFWmzovGeP0=j-MHmkHYc7PykLhE8AHrrQ@mail.gmail.com>
Message-ID: <CADL6tVORdfHv=cS5scO4j56TJrM6-ucDfhyvUELnDNrscTTFZA@mail.gmail.com>

My bad: ovs-vswitchd was not running.

I also had two versions of ovs-vsctl installed (2.0.2 and 2.3.90). I
deleted the default one `sudo apt-get remove openvswitch-switch`,
after which only 2.3.90 was running. You are right, I did compile
manually from OVS master, but forgot about this as it was a while ago.
My apologies for both mistakes.

Lesson for others, do not forget to run:
ovs-vsctl --no-wait init
ovs-vswitchd --pidfile --detach

I can do `sudo ovs-docker add-port br-int eth2 5338a16d7722` and
`eth2` successfully shows up inside the Docker. This issue can be
closed now.

Thanks, Gurucharan! Appreciate your help very much.

Nodir.


On 13 February 2015 at 21:35, Gurucharan Shetty <shettyg at nicira.com> wrote:
>> Although new port (9b3a98108dd24_l) is added to the br-int, Docker
>> does not have eth1; it has eth0 only. My Docker host machine (the one
>> running OVS) is Ubuntu 14.04 LTS and OVS was installed via `sudo
>> apt-get install openvswitch-switch`
> It shouldn't matter, but doesn't 14.04 come with OVS 2.0.2. So you
> likely manually installed OVS from master (2.3.90)? If so, I hope you
> installed the new one in the right paths (find / -name ovs-vsctl
> should show just one. 'ovs-appctl version' should show the correct
> version.)
>>
>> Here is the output from `sudo ovs-vsctl --version`
>> ovs-vsctl (Open vSwitch) 2.3.90
>> Compiled Jan 11 2015 18:42:23
>> DB Schema 7.11.1
>>
>> Any help is appreciated.
>>
>> Nodir.
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss

From azhou at nicira.com  Sat Feb 14 00:05:00 2015
From: azhou at nicira.com (Andy Zhou)
Date: Sat, 14 Feb 2015 00:05:00 -0800
Subject: [ovs-discuss] looking for a good explanation of core dumps and
	backtraces
In-Reply-To: <20150209191202.GC2168@nicira.com>
References: <20150209191202.GC2168@nicira.com>
Message-ID: <CACzMAJ+UFiZT+CSQkVdCr-9aODzHpeNs7C4eBCdRd-pYx9WX3w@mail.gmail.com>

A quick web search did not lead to anything directly usable. How about
the following.

-------------------------------------------

Core files are usually generated in the same directory as the running
program with a name 'core'.  However,  whether a core file will be
generated, its filename and location can be influenced by a number of
factors. 'man core' gives more details.

When a core file is generated, the backtrace can be obtained by running gdb.
      gdb <program> <core file>
Once inside gdb, issue a 'bt' command to obtain the backtrace.
'man gdb' gives more details about gdb.

On Mon, Feb 9, 2015 at 11:12 AM, Ben Pfaff <blp at nicira.com> wrote:
> Occasionally (as today) I find myself asking a user to get a core dump
> and a backtrace, and find that the user doesn't have any of the skills
> or knowledge to do that.  Does anyone know of a good document that
> walks a user through how to do this (not necessarily OVS-specific)?  I
> don't want to hand-hold but I do want to help.
>
> Thanks,
>
> Ben.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From srinidhi.svr at gmail.com  Fri Feb 13 11:25:11 2015
From: srinidhi.svr at gmail.com (Srinidhi Srinivasaraghavan)
Date: Fri, 13 Feb 2015 11:25:11 -0800
Subject: [ovs-discuss] Open vSwitch database connection failure after reboot
Message-ID: <CAGATJq-r74KqE81EQs71ZnnqfRxMWwaP-D+fn+V-Z0YTqr4q5Q@mail.gmail.com>

 Hi,

After successfully insalling ovs and rebooting, the db.sock file goes
missing. It happens everytime after reboot. I get the following error.
ovs-vsctl: unix:/usr/local/var/run/openvswitch/db.sock: database connection
failed (no such file or directory)
I would like to know why that happens and also if there is any way to
rectify it.

-- 
srinidhi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150213/236a04b6/attachment-0001.html>

From marco at nuvula.ch  Fri Feb 13 12:25:40 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Fri, 13 Feb 2015 21:25:40 +0100
Subject: [ovs-discuss] STP / VXLAN mesh: ETH0,
	Connection lost to OVS 2.3.1 server
In-Reply-To: <39C260E0-5634-40E4-BD09-9F0FA1643922@nuvula.ch>
References: <39C260E0-5634-40E4-BD09-9F0FA1643922@nuvula.ch>
Message-ID: <CBC2C3B2-1718-48B7-B486-58DBADBC5FF7@nuvula.ch>

so far no answer from the list.

I have in the meantime also collected an ova-bug report if somebody has time to look at it, I can post it for download.

please send me your email address, I send you the link.

thanks
marco



> On 06 Feb 2015, at 00:23, Marco Kuendig <marco at nuvula.ch> wrote:
> 
> Folks,
> 
> I have a small testbed with 4 ubuntu servers, fully meshed with VXLAN. To avoid loops I use Spanning-Tree.
> 
> The 4 servers run Ubuntu 14.10 fully updated.
> 
> I upgraded manually to openvswitch 2.3.1 with the vivid packages from ubuntu.
> 
> 3 Servers run kvm and consume via rbd/ceph images. CEPH runs over openvswitch to sync data.
> 
> The 3 KVM servers share via VXLAN flat networks trunked with VLAN's.
> 
> These physical servers are single homed and therefore I need to bridge eth0 also to the outside world.
> 
> Randomly these servers loose connectivity to the outside world (eth0). Troubleshooting shows, that it is often related to STP events (VM's restarting/shutdown/hosts booting, etc).
> 
> After very long searches I think I found the culprit: A lock file ".conf.db.~lock~" is present in /etc/openvswitch directory. If I delete that file and reboot the host connectivity reappears.
> 
> When the host looses connectivity, no ipv4 traffic is forwarded anymore. No real culprits are visible in ovs-vswitch logs, except that a STP topology change happened.
> 
> local ovsbr0p1 bridged to eth0 interface can be ipv4 pinged. Gateway cannot be pinged anymore (sometimes ipv6 connectivity still works)
> 
> Any tips how to troubleshoot this and get rid of this sudden loss of connectivity ? Same problem happened on OVS 2.0 release.
> 
> Second question: How can I get rid of SPT events when VM's boot or similar ? On HW switches there is a concept of Access-Ports for end devices, where no STP event will be flood to the fabric.
> 
> thanks
> marco
> 
> 
> 
> Below some outputs that could help in troubleshooting:
> 
> 
> 
> 
> root at nuv-vir-kvm-server-3 ~ # ovs-vsctl show
> 5733eb7c-f4ac-446c-bfd1-c0121c0337b7
>    Bridge "ovsbr0"
>        Port "eth0"
>            Interface "eth0"
>        Port "ovsbr0p1"
>            Interface "ovsbr0p1"
>                type: internal
>        Port "ovsbr0"
>            Interface "ovsbr0"
>                type: internal
>    Bridge "ovsbr1"
>        Port "ovsbr1.8p1"
>            tag: 8
>            Interface "ovsbr1.8p1"
>                type: internal
>        Port "ovsbr1.12p1"
>            tag: 12
>            Interface "ovsbr1.12p1"
>                type: internal
>        Port "ovsbr1.3p1"
>            tag: 3
>            Interface "ovsbr1.3p1"
>                type: internal
>        Port "ovsbr1.4"
>            tag: 4
>            Interface "ovsbr1.4"
>                type: internal
>        Port "ovsbr1.101p1"
>            tag: 101
>            Interface "ovsbr1.101p1"
>                type: internal
>        Port "ovsvx5"
>            trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
>            Interface "ovsvx5"
>                type: vxlan
>                options: {key=flow, remote_ip="46.4.100.54"}
>        Port "ovsbr1.1"
>            tag: 1
>            Interface "ovsbr1.1"
>                type: internal
>        Port "ovsbr1.9"
>            tag: 9
>            Interface "ovsbr1.9"
>                type: internal
>        Port "ovsbr1.2"
>            tag: 2
>            Interface "ovsbr1.2"
>                type: internal
>        Port "ovsbr1.20"
>            tag: 20
>            Interface "ovsbr1.20"
>                type: internal
>        Port "ovsbr1.30p1"
>            tag: 30
>            Interface "ovsbr1.30p1"
>                type: internal
>        Port "ovsbr1.101"
>            tag: 101
>            Interface "ovsbr1.101"
>                type: internal
>        Port "ovsbr1.5"
>            tag: 5
>            Interface "ovsbr1.5"
>                type: internal
>        Port "ovsbr1.7"
>            tag: 7
>            Interface "ovsbr1.7"
>                type: internal
>        Port "ovsbr1.1p1"
>            tag: 1
>            Interface "ovsbr1.1p1"
>                type: internal
>        Port "ovsbr1.6"
>            tag: 6
>            Interface "ovsbr1.6"
>                type: internal
>        Port "ovsbr1.11p1"
>            tag: 11
>            Interface "ovsbr1.11p1"
>                type: internal
>        Port "ovsbr1.4p1"
>            tag: 4
>            Interface "ovsbr1.4p1"
>                type: internal
>        Port "ovsbr1"
>            Interface "ovsbr1"
>                type: internal
>        Port "ovsbr1.8"
>            tag: 8
>            Interface "ovsbr1.8"
>                type: internal
>        Port "ovsbr1.12"
>            tag: 12
>            Interface "ovsbr1.12"
>                type: internal
>        Port "ovsbr1.11"
>            tag: 11
>            Interface "ovsbr1.11"
>                type: internal
>        Port "ovsbr1.10p1"
>            tag: 10
>            Interface "ovsbr1.10p1"
>                type: internal
>        Port "ovsbr1.7p1"
>            tag: 7
>            Interface "ovsbr1.7p1"
>                type: internal
>        Port "ovsbr1.2p1"
>            tag: 2
>            Interface "ovsbr1.2p1"
>                type: internal
>        Port "ovsbr1.9p1"
>            tag: 9
>            Interface "ovsbr1.9p1"
>                type: internal
>        Port "ovsbr1.30"
>            tag: 30
>            Interface "ovsbr1.30"
>                type: internal
>        Port "ovsvxnuv-vir-aci-ubuntu-1"
>            trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
>            Interface "ovsvxnuv-vir-aci-ubuntu-1"
>                type: vxlan
>                options: {key=flow, remote_ip="46.4.17.109"}
>        Port "ovsbr1.10"
>            tag: 10
>            Interface "ovsbr1.10"
>                type: internal
>        Port "ovsvx7"
>            trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
>            Interface "ovsvx7"
>                type: vxlan
>                options: {key=flow, remote_ip="46.4.17.67"}
>        Port "ovsbr1.5p1"
>            tag: 5
>            Interface "ovsbr1.5p1"
>                type: internal
>        Port "ovsvx6"
>            trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
>            Interface "ovsvx6"
>                type: vxlan
>                options: {key=flow, remote_ip="46.4.109.146"}
>        Port "ovsbr1.6p1"
>            tag: 6
>            Interface "ovsbr1.6p1"
>                type: internal
>        Port "ovsbr1.3"
>            tag: 3
>            Interface "ovsbr1.3"
>                type: internal
>        Port "ovsbr1.20p1"
>            tag: 20
>            Interface "ovsbr1.20p1"
>                type: internal
>    ovs_version: "2.3.1"
> 
> _uuid               : c960a8da-aa1a-4c8a-a3f3-1b7863424313
> bond_active_slave   : []
> bond_downdelay      : 0
> bond_fake_iface     : false
> bond_mode           : []
> bond_updelay        : 0
> external_ids        : {}
> fake_bridge         : false
> interfaces          : [e8ec16b3-1a83-44a0-b3f8-f3dccfdde91d]
> lacp                : []
> mac                 : []
> name                : "eth0"
> other_config        : {}
> qos                 : []
> statistics          : {}
> status              : {}
> tag                 : []
> trunks              : []
> vlan_mode           : []
> 
> root at nuv-vir-kvm-server-5 ~ # ovs-vsctl list port
> _uuid               : 6b14b501-a85b-4fc0-8cd3-1302830ff35c
> bond_active_slave   : []
> bond_downdelay      : 0
> bond_fake_iface     : false
> bond_mode           : []
> bond_updelay        : 0
> external_ids        : {}
> fake_bridge         : false
> interfaces          : [7dfc6aa1-23bf-4784-98c3-583ea20884c6]
> lacp                : []
> mac                 : []
> name                : "ovsbr1.1p1"
> other_config        : {}
> qos                 : []
> statistics          : {}
> status              : {}
> tag                 : 1
> trunks              : []
> vlan_mode           : []
> 
> 
> _uuid               : eec4c406-3cf5-4507-9ca3-251741631e77
> bond_active_slave   : []
> bond_downdelay      : 0
> bond_fake_iface     : false
> bond_mode           : []
> bond_updelay        : 0
> external_ids        : {}
> fake_bridge         : false
> interfaces          : [8e88f0c9-31e0-4c44-81b8-53511ab8d8bd]
> lacp                : []
> mac                 : []
> name                : "ovsbr1"
> other_config        : {}
> qos                 : []
> statistics          : {}
> status              : {}
> tag                 : []
> trunks              : []
> vlan_mode           : []
> 
> _uuid               : a191cc12-89d3-4a79-bdaf-55502c5b213d
> bond_active_slave   : []
> bond_downdelay      : 0
> bond_fake_iface     : false
> bond_mode           : []
> bond_updelay        : 0
> external_ids        : {}
> fake_bridge         : false
> interfaces          : [4281866e-11b4-4c04-8a6c-066aea7af246]
> lacp                : []
> mac                 : []
> name                : "ovsbr0p1"
> other_config        : {}
> qos                 : []
> statistics          : {}
> status              : {}
> tag                 : []
> trunks              : []
> vlan_mode           : []
> 
> 
> 
> _uuid               : 22ee48dc-7fec-4742-b577-a5293f7e3bd9
> admin_state         : up
> bfd                 : {}
> bfd_status          : {}
> cfm_fault           : []
> cfm_fault_status    : []
> cfm_flap_count      : []
> cfm_health          : []
> cfm_mpid            : []
> cfm_remote_mpids    : []
> cfm_remote_opstate  : []
> duplex              : []
> external_ids        : {}
> ifindex             : 5
> ingress_policing_burst: 0
> ingress_policing_rate: 0
> lacp_current        : []
> link_resets         : 1
> link_speed          : []
> link_state          : up
> mac                 : []
> mac_in_use          : "c8:60:00:5f:f0:3f"
> mtu                 : 1500
> name                : "ovsbr0"
> ofport              : 65534
> ofport_request      : []
> options             : {}
> other_config        : {}
> statistics          : {collisions=0, rx_bytes=360, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=4, tx_bytes=44058, tx_dropped=0, tx_errors=0, tx_packets=328}
> status              : {driver_name=openvswitch}
> type                : internal
> 
> 
> _uuid               : e8ec16b3-1a83-44a0-b3f8-f3dccfdde91d
> admin_state         : up
> bfd                 : {}
> bfd_status          : {}
> cfm_fault           : []
> cfm_fault_status    : []
> cfm_flap_count      : []
> cfm_health          : []
> cfm_mpid            : []
> cfm_remote_mpids    : []
> cfm_remote_opstate  : []
> duplex              : full
> external_ids        : {}
> ifindex             : 2
> ingress_policing_burst: 0
> ingress_policing_rate: 0
> lacp_current        : []
> link_resets         : 1
> link_speed          : 1000000000
> link_state          : up
> mac                 : []
> mac_in_use          : "c8:60:00:5f:f0:3f"
> mtu                 : 1500
> name                : "eth0"
> ofport              : 2
> ofport_request      : []
> options             : {}
> other_config        : {}
> statistics          : {collisions=0, rx_bytes=1381410080, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=6910253, tx_bytes=1055169046, tx_dropped=0, tx_errors=0, tx_packets=2504716}
> status              : {driver_name="r8169", driver_version="2.3LK-NAPI", firmware_version="rtl_nic/rtl8168e-2.fw"}
> type                : ""
> 
> 
> _uuid               : 4281866e-11b4-4c04-8a6c-066aea7af246
> admin_state         : up
> bfd                 : {}
> bfd_status          : {}
> cfm_fault           : []
> cfm_fault_status    : []
> cfm_flap_count      : []
> cfm_health          : []
> cfm_mpid            : []
> cfm_remote_mpids    : []
> cfm_remote_opstate  : []
> duplex              : []
> external_ids        : {}
> ifindex             : 4
> ingress_policing_burst: 0
> ingress_policing_rate: 0
> lacp_current        : []
> link_resets         : 1
> link_speed          : []
> link_state          : up
> mac                 : []
> mac_in_use          : "62:ee:a5:83:b5:7e"
> mtu                 : 1500
> name                : "ovsbr0p1"
> ofport              : 1
> ofport_request      : []
> options             : {}
> other_config        : {}
> statistics          : {collisions=0, rx_bytes=1053520420, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=2474191, tx_bytes=9971342322, tx_dropped=0, tx_errors=0, tx_packets=6910215}
> status              : {driver_name=openvswitch}
> type                : internal
> 
> _uuid               : 7dfc6aa1-23bf-4784-98c3-583ea20884c6
> admin_state         : up
> bfd                 : {}
> bfd_status          : {}
> cfm_fault           : []
> cfm_fault_status    : []
> cfm_flap_count      : []
> cfm_health          : []
> cfm_mpid            : []
> cfm_remote_mpids    : []
> cfm_remote_opstate  : []
> duplex              : []
> external_ids        : {}
> ifindex             : 36
> ingress_policing_burst: 0
> ingress_policing_rate: 0
> lacp_current        : []
> link_resets         : 1
> link_speed          : []
> link_state          : up
> mac                 : []
> mac_in_use          : "6e:e8:ec:44:f9:1a"
> mtu                 : 1400
> name                : "ovsbr1.1p1"
> ofport              : 2
> ofport_request      : []
> options             : {}
> other_config        : {}
> statistics          : {collisions=0, rx_bytes=800790181, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=2044691, tx_bytes=9595662921, tx_dropped=0, tx_errors=0, tx_packets=6887123}
> status              : {driver_name=openvswitch}
> type                : internal
> 
> _uuid               : 8c602077-b2b1-4f2c-9201-93304008a814
> bond_active_slave   : []
> bond_downdelay      : 0
> bond_fake_iface     : false
> bond_mode           : []
> bond_updelay        : 0
> external_ids        : {}
> fake_bridge         : false
> interfaces          : [18cb6a6c-1f66-4eb5-bc78-304e8b404ac0]
> lacp                : []
> mac                 : []
> name                : "ovsvx3"
> other_config        : {}
> qos                 : []
> statistics          : {stp_error_count=0, stp_rx_count=311, stp_tx_count=4}
> status              : {stp_port_id="8002", stp_role=root, stp_sec_in_state="592", stp_state=forwarding}
> tag                 : []
> trunks              : [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
> vlan_mode           : trunk
> 
> 
> 2015-02-05T10:54:04.316Z|00082|bridge|INFO|bridge ovsbr1: added interface ovsvxnuv-vir-aci-ubuntu-1 on port 35
> 2015-02-05T10:54:34.562Z|00083|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T18:13:52.953Z|00014|stp(handler10)|INFO|ovsbr1: detected topology change.
> 2015-02-05T20:58:13.680Z|00084|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T20:58:14.181Z|00085|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T20:59:49.410Z|00086|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T21:13:56.899Z|00015|stp(handler10)|INFO|ovsbr1: detected topology change.
> 2015-02-05T21:16:05.136Z|00087|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T21:16:05.637Z|00088|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T21:16:34.178Z|00089|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T21:39:46.234Z|00016|stp(handler10)|INFO|ovsbr1: detected topology change.
> 2015-02-05T22:44:19.686Z|00090|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T22:44:49.218Z|00091|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T23:01:55.688Z|00001|fatal_signal(urcu5)|WARN|terminating with signal 15 (Terminated)
> 2015-02-05T23:07:39.407Z|00001|vlog|INFO|opened log file /var/log/openvswitch/ovs-vswitchd.log
> 2015-02-05T23:07:39.446Z|00002|reconnect|INFO|unix:/var/run/openvswitch/db.sock: connecting...
> 2015-02-05T23:07:39.446Z|00003|reconnect|INFO|unix:/var/run/openvswitch/db.sock: connected
> 2015-02-05T23:07:39.450Z|00004|dpif|WARN|system at ovs-system: failed to put[create] (Invalid argument) skb_priority(0),skb_mark(0),recirc_id(0x1),dp_hash(0x1),in_port(0),eth(src=00:00:00:00:00:00,dst=00:00:00:00:00:00)
> 2015-02-05T23:07:39.450Z|00005|ofproto_dpif|INFO|system at ovs-system: Datapath does not support recirculation
> 2015-02-05T23:07:39.450Z|00006|dpif|WARN|system at ovs-system: execute userspace(pid=0,userdata(00000000)) failed (Invalid argument) on packet metadata=0,in_port=0,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x1234
> 2015-02-05T23:07:39.450Z|00007|ofproto_dpif|WARN|system at ovs-system: variable-length userdata feature probe failed (Invalid argument)
> 2015-02-05T23:07:39.450Z|00008|dpif|WARN|system at ovs-system: failed to put[create] (Invalid argument) skb_priority(0),skb_mark(0),in_port(0),eth(src=00:00:00:00:00:00,dst=00:00:00:00:00:00),eth_type(0x8847),mpls(label=0,tc=0,ttl=0,bos=1)
> 2015-02-05T23:07:39.450Z|00009|ofproto_dpif|INFO|system at ovs-system: MPLS label stack length probed as 0
> 2015-02-05T23:07:39.454Z|00010|dpif|WARN|system at ovs-system: failed to query port ovsvxnuv-vir-aci-ubuntu-1: Invalid argument
> 2015-02-05T23:07:39.455Z|00011|bridge|INFO|bridge ovsbr0: added interface ovsbr0p1 on port 1
> 2015-02-05T23:07:39.456Z|00012|bridge|INFO|bridge ovsbr0: added interface eth0 on port 2
> 2015-02-05T23:07:39.457Z|00013|bridge|INFO|bridge ovsbr0: added interface ovsbr0 on port 65534
> 2015-02-05T23:07:39.459Z|00014|bridge|INFO|bridge ovsbr1: added interface ovsbr1.2p1 on port 4
> 2015-02-05T23:07:39.460Z|00015|bridge|INFO|bridge ovsbr1: added interface ovsbr1.6 on port 11
> 2015-02-05T23:07:39.461Z|00016|bridge|INFO|bridge ovsbr1: added interface ovsvx6 on port 31
> 2015-02-05T23:07:39.463Z|00017|bridge|INFO|bridge ovsbr1: added interface ovsbr1.7 on port 13
> 2015-02-05T23:07:39.467Z|00018|bridge|INFO|bridge ovsbr1: added interface ovsbr1.9 on port 17
> 2015-02-05T23:07:39.469Z|00019|bridge|INFO|bridge ovsbr1: added interface ovsbr1.9p1 on port 18
> 2015-02-05T23:07:39.472Z|00020|bridge|INFO|bridge ovsbr1: added interface ovsbr1.1 on port 1
> 2015-02-05T23:07:39.473Z|00021|bridge|INFO|bridge ovsbr1: added interface ovsbr1.6p1 on port 12
> 2015-02-05T23:07:39.476Z|00022|bridge|INFO|bridge ovsbr1: added interface ovsbr1.10p1 on port 20
> 2015-02-05T23:07:39.476Z|00023|bridge|INFO|bridge ovsbr1: added interface ovsvx3 on port 33
> 2015-02-05T23:07:39.481Z|00024|bridge|INFO|bridge ovsbr1: added interface ovsbr1.4p1 on port 8
> 2015-02-05T23:07:39.485Z|00025|bridge|INFO|bridge ovsbr1: added interface ovsbr1 on port 65534
> 2015-02-05T23:07:39.489Z|00001|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 1
> 2015-02-05T23:07:39.490Z|00026|bridge|INFO|bridge ovsbr1: added interface ovsbr1.3p1 on port 6
> 2015-02-05T23:07:39.495Z|00027|bridge|INFO|bridge ovsbr1: added interface ovsbr1.10 on port 19
> 2015-02-05T23:07:39.497Z|00002|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 3
> 2015-02-05T23:07:39.508Z|00028|bridge|INFO|bridge ovsbr1: added interface ovsbr1.30 on port 27
> 2015-02-05T23:07:39.510Z|00029|bridge|INFO|bridge ovsbr1: added interface ovsbr1.7p1 on port 14
> 2015-02-05T23:07:39.514Z|00030|bridge|INFO|bridge ovsbr1: added interface ovsbr1.11p1 on port 22
> 2015-02-05T23:07:39.514Z|00031|bridge|INFO|bridge ovsbr1: added interface ovsvx7 on port 34
> 2015-02-05T23:07:39.516Z|00032|bridge|INFO|bridge ovsbr1: added interface ovsbr1.20p1 on port 26
> 2015-02-05T23:07:39.516Z|00033|bridge|INFO|bridge ovsbr1: added interface ovsvxnuv-vir-aci-ubuntu-1 on port 35
> 2015-02-05T23:07:39.518Z|00034|bridge|INFO|bridge ovsbr1: added interface ovsbr1.20 on port 25
> 2015-02-05T23:07:39.521Z|00035|bridge|INFO|bridge ovsbr1: added interface ovsbr1.3 on port 5
> 2015-02-05T23:07:39.525Z|00036|bridge|INFO|bridge ovsbr1: added interface ovsbr1.4 on port 7
> 2015-02-05T23:07:39.529Z|00037|bridge|INFO|bridge ovsbr1: added interface ovsbr1.5p1 on port 10
> 2015-02-05T23:07:39.532Z|00038|bridge|INFO|bridge ovsbr1: added interface ovsbr1.8p1 on port 16
> 2015-02-05T23:07:39.539Z|00003|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 10
> 2015-02-05T23:07:39.541Z|00039|bridge|INFO|bridge ovsbr1: added interface ovsbr1.11 on port 21
> 2015-02-05T23:07:39.546Z|00040|bridge|INFO|bridge ovsbr1: added interface ovsbr1.5 on port 9
> 2015-02-05T23:07:39.549Z|00041|bridge|INFO|bridge ovsbr1: added interface ovsbr1.101 on port 29
> 2015-02-05T23:07:39.553Z|00042|bridge|INFO|bridge ovsbr1: added interface ovsbr1.2 on port 3
> 2015-02-05T23:07:39.563Z|00043|bridge|INFO|bridge ovsbr1: added interface ovsbr1.12p1 on port 24
> 2015-02-05T23:07:39.569Z|00044|bridge|INFO|bridge ovsbr1: added interface ovsbr1.8 on port 15
> 2015-02-05T23:07:39.570Z|00004|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 14
> 2015-02-05T23:07:39.573Z|00045|bridge|INFO|bridge ovsbr1: added interface ovsbr1.12 on port 23
> 2015-02-05T23:07:39.575Z|00046|bridge|INFO|bridge ovsbr1: added interface ovsbr1.101p1 on port 30
> 2015-02-05T23:07:39.581Z|00047|bridge|INFO|bridge ovsbr1: added interface ovsbr1.30p1 on port 28
> 2015-02-05T23:07:39.584Z|00048|bridge|INFO|bridge ovsbr1: added interface ovsbr1.1p1 on port 2
> 2015-02-05T23:07:39.584Z|00049|bridge|INFO|bridge ovsbr0: using datapath ID 0000c860005ff03f
> 2015-02-05T23:07:39.584Z|00050|connmgr|INFO|ovsbr0: added service controller "punix:/var/run/openvswitch/ovsbr0.mgmt"
> 2015-02-05T23:07:39.584Z|00051|bridge|INFO|bridge ovsbr1: using datapath ID 0000de63bff5aa47
> 2015-02-05T23:07:39.585Z|00052|connmgr|INFO|ovsbr1: added service controller "punix:/var/run/openvswitch/ovsbr1.mgmt"
> 2015-02-05T23:07:39.586Z|00053|dpif|WARN|system at ovs-system: failed to query port ovsvxnuv-vir-aci-ubuntu-1: Invalid argument
> 2015-02-05T23:07:39.595Z|00054|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.3.1
> 2015-02-05T23:07:49.598Z|00055|memory|INFO|49472 kB peak resident set size after 10.2 seconds
> 2015-02-05T23:07:49.598Z|00056|memory|INFO|handlers:2 ports:38 revalidators:2 rules:12 udpif keys:11
> 2015-02-05T23:08:09.607Z|00057|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T23:08:09.607Z|00058|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T23:08:09.607Z|00059|stp|INFO|ovsbr1: detected topology change.
> 2015-02-05T23:08:45.990Z|00060|bridge|INFO|bridge ovsbr1: added interface vnet0 on port 32
> 2015-02-05T23:09:16.213Z|00061|stp|INFO|ovsbr1: detected topology change.
> 
> 


From nodir.qodirov at gmail.com  Fri Feb 13 19:59:02 2015
From: nodir.qodirov at gmail.com (Nodir Kodirov)
Date: Fri, 13 Feb 2015 19:59:02 -0800
Subject: [ovs-discuss] ovs-docker fails to add port to the bridge
Message-ID: <CADL6tVP+eoxG7AEagnxjrfsaA=vnHcQ6QORehGq4Wp6WPnaZjw@mail.gmail.com>

Hi,

I am trying to attach another interface to my Docker by:

sudo ovs-docker add-port br-int eth1 5338a16d7722

It fails with following error message:

2015-02-14T03:31:46Z|00002|fatal_signal|WARN|terminating with signal
14 (Alarm clock)
Alarm clock
ovs-docker: Failed to add 9b3a98108dd24_l port to bridge br-int

Here is what I get from `sudo ovs-vsctl show` after running the command
    Bridge br-int
        Port br-int
            Interface br-int
                type: internal
        Port "9b3a98108dd24_l"
            Interface "9b3a98108dd24_l"
    ovs_version: "2.3.90"

Although new port (9b3a98108dd24_l) is added to the br-int, Docker
does not have eth1; it has eth0 only. My Docker host machine (the one
running OVS) is Ubuntu 14.04 LTS and OVS was installed via `sudo
apt-get install openvswitch-switch`

Here is the output from `sudo ovs-vsctl --version`
ovs-vsctl (Open vSwitch) 2.3.90
Compiled Jan 11 2015 18:42:23
DB Schema 7.11.1

Any help is appreciated.

Nodir.

From apocalipse89 at gmail.com  Sat Feb 14 04:13:51 2015
From: apocalipse89 at gmail.com (Salvatore Mazzarino)
Date: Sat, 14 Feb 2015 13:13:51 +0100
Subject: [ovs-discuss] Works in kernel support
Message-ID: <23EE099A-B879-42C3-BE6A-A7AB29953A5D@gmail.com>

How to verify if OvS is working with kernel support?



From jpettit at nicira.com  Sat Feb 14 08:19:47 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Sat, 14 Feb 2015 11:19:47 -0500
Subject: [ovs-discuss] Works in kernel support
In-Reply-To: <23EE099A-B879-42C3-BE6A-A7AB29953A5D@gmail.com>
References: <23EE099A-B879-42C3-BE6A-A7AB29953A5D@gmail.com>
Message-ID: <70E835FC-3B21-4D6A-A878-9B0C730A7610@nicira.com>

You can run "ovs-dpctl show" to see if the counters are incrementing.  If traffic is running, you can also run  "ovs-dpctl dump-flows" to see if flows are passing traffic.

--Justin


> On Feb 14, 2015, at 7:13 AM, Salvatore Mazzarino <apocalipse89 at gmail.com> wrote:
> 
> How to verify if OvS is working with kernel support?
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From jpettit at nicira.com  Sat Feb 14 08:23:14 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Sat, 14 Feb 2015 11:23:14 -0500
Subject: [ovs-discuss] Open vSwitch database connection failure after
	reboot
In-Reply-To: <CAGATJq-r74KqE81EQs71ZnnqfRxMWwaP-D+fn+V-Z0YTqr4q5Q@mail.gmail.com>
References: <CAGATJq-r74KqE81EQs71ZnnqfRxMWwaP-D+fn+V-Z0YTqr4q5Q@mail.gmail.com>
Message-ID: <46F6E84F-6816-4538-9782-1E9FE5C2130D@nicira.com>

Is ovsdb-server running on reboot and is it configured to create a socket at that location?  If you do a web search, you should see some answers from people who had issues after a reboot due to misconfiguration.

--Justin


> On Feb 13, 2015, at 2:25 PM, Srinidhi Srinivasaraghavan <srinidhi.svr at gmail.com> wrote:
> 
> Hi,
>  
> After successfully insalling ovs and rebooting, the db.sock file goes missing. It happens everytime after reboot. I get the following error.
> ovs-vsctl: unix:/usr/local/var/run/openvswitch/db.sock: database connection failed (no such file or directory)
> I would like to know why that happens and also if there is any way to rectify it.
> 
> -- 
> srinidhi 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From joestringer at nicira.com  Sat Feb 14 21:00:56 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Sat, 14 Feb 2015 21:00:56 -0800
Subject: [ovs-discuss] use of datapath/vport in OVS
In-Reply-To: <CAEhKQHJmkAaVg2zKXJ=6A=ntgq4XQ7BnakPiZJmyu0_dGCOKMg@mail.gmail.com>
References: <CAEhKQHJmkAaVg2zKXJ=6A=ntgq4XQ7BnakPiZJmyu0_dGCOKMg@mail.gmail.com>
Message-ID: <CANr6G5wn-v+jQh2OMGfrwBNA+a7WXZpWH-SeoRHGSfo30mC=pw@mail.gmail.com>

On 8 February 2015 at 22:44, Sumit Paliwal <pg201372016 at iitj.ac.in> wrote:
> Hello everyone,
>
> I'm in a little bit confusion here.
> I've read that there are 2 dpif implementations in ovs named as dpif-linux
> and dpif-netdev.
>
> I want to know :-
> 1. which implementation is used by default in mininet environment and how to
> switch     to other one.
> 2. What is the use of the code written under datapath directory. As i tried
> to change the code of datapath/vport.c, but there was no effect on the
> output.
> So how does this datapath/ directory serves the purpose.

I don't know how mininet configures OVS by default. You can use this
command to check:

ovs-vsctl get bridge breth0 datapath_type
("" or "system" means linux, "netdev" means userspace datapath).

This will change the datapath type:
ovs-vsctl set Bridge br0 datapath_type=netdev

datapath/ houses the linux datapath code. It compiles into a Linux
module that you can load into the kernel.

From blp at nicira.com  Sun Feb 15 08:29:46 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 15 Feb 2015 08:29:46 -0800
Subject: [ovs-discuss] [ovs-issues] Network netspace is cleared when adding
 new unrelated port (#68)
Message-ID: <20150215162946.GA22040@nicira.com>

This was filed in OVS's github bug tracker.  I'm forwarding it to the
bugs list to make sure it doesn't get lost.

----- Forwarded message from Robert Åkerblom-Andersson <notifications at github.com> -----

Date: Sun, 15 Feb 2015 07:40:55 -0800
From: Robert Åkerblom-Andersson <notifications at github.com>
To: openvswitch/ovs-issues <ovs-issues at noreply.github.com>
Subject: [ovs-issues] Network netspace is cleared when adding new unrelated port
	(#68)

Hi, 

I think I have found a bug, I'm using Linux running:
```
uname -a
Linux rb-00001 3.13.0-44-generic #73-Ubuntu SMP Tue Dec 16 00:22:43 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux

sudo ovs-vsctl -V
ovs-vsctl (Open vSwitch) 2.3.1
Compiled Feb 11 2015 13:39:02
DB Schema 7.6.2
```

Simply put, if I setup an OVS port connected to a network namespace, setup it's ip settings etc, then things looks and works good. However, if I add a new internal port to the bridge, then all netns stuff is simply cleared. I create added some commands here to reproduce this.

To test this I assume this:
- Running Ubuntu 14.04 (but by all means try on a different distro, I don't think this is Ubuntu specific)
- Docker is installed and the docker deamon has been started with these settings DOCKER_OPTS="-b none --dns 8.8.8.8 --dns 8.8.4.4", meaning it does not create or touch any bridge on it's own. This can be setup in "/etc/default/docker" on Ubuntu (or otherwise in other dists).

To test this the best way, start a bash shell, and then copy paste these command (the first "sudo echo" just to cache sudo access so the other commands can be pasted without issues. I suggest the pasting method of the commands since you can at any point stop and check with additional commands while still keeping all env vars etc):
```
sudo echo

# Settings 
BR="br0"
MATE_ETH="mate-eth"
GWADDR="172.17.0.1"

# Bridge network and ip
BR_NET="172.17.0.0/24"
BR_IP="172.17.0.1/24"

# Enable ip ip_forward
sudo sysctl -w net.ipv4.ip_forward=1

# Create bridge
sudo ovs-vsctl add-br $BR

# Start containers 
M1=$(sudo docker run --privileged -d --net="none" -t -i ubuntu:14.04 /bin/bash)

# Setup ip on $BR
sudo ip addr add $BR_IP dev $BR 
sudo ip link set dev $BR up

M1_ETH0="m1-eth0"
M1_IP="172.16.0.11/22"
M1_GW="172.16.0.1"
M1_NSPID=`sudo docker inspect -f '{{.State.Pid}}' $M1`

# Setup network namespace pids (namespaces created by Docker)
sudo mkdir -p /var/run/netns
sudo rm -f /var/run/netns/$M1_NSPID | true
sudo ln -s /proc/$M1_NSPID/ns/net /var/run/netns/$M1_NSPID

# Add ovs port 
sudo ovs-vsctl add-port $BR $M1_ETH0 -- set interface $M1_ETH0 type=internal

# Create new ovs ports for router
sudo ip link set dev $M1_ETH0 up

# Move ports into the containers network namespace 
sudo ip link set $M1_ETH0 netns $M1_NSPID

# Setup IP settings for the netns  
sudo ip netns exec $M1_NSPID ip link set $M1_ETH0 name eth0
sudo ip netns exec $M1_NSPID ip addr add $M1_IP dev eth0
sudo ip netns exec $M1_NSPID ip link set dev eth0 up 
sudo ip netns exec $M1_NSPID ip route add default via $M1_GW
```

When these command have been run, you can now with this command to see the ip settings:
```
# Check that netns settings looks good, yes, they do
sudo ip netns exec $M1_NSPID ip link
sudo ip netns exec $M1_NSPID ip address
```

Now try and add a new, unrelated port to the bridge:
```
# Add a unrelated test port to the bridge 
sudo ovs-vsctl add-port br0 testPort -- set interface testPort type=internal
```

After this, you can now see how the netns settings have disappeared:
```
# Check again and see how the netns settings have been blown away...
sudo ip netns exec $M1_NSPID ip link
sudo ip netns exec $M1_NSPID ip address
```

Do anyone have a clue on why this is happening? Feel free to ask if I've been unclear in any way.

Best Regards, Robert

---
Reply to this email directly or view it on GitHub:
https://github.com/openvswitch/ovs-issues/issues/68

----- End forwarded message -----

From blp at nicira.com  Sun Feb 15 08:42:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 15 Feb 2015 08:42:10 -0800
Subject: [ovs-discuss] looking for a good explanation of core dumps and
 backtraces
In-Reply-To: <CACzMAJ+UFiZT+CSQkVdCr-9aODzHpeNs7C4eBCdRd-pYx9WX3w@mail.gmail.com>
References: <20150209191202.GC2168@nicira.com>
 <CACzMAJ+UFiZT+CSQkVdCr-9aODzHpeNs7C4eBCdRd-pYx9WX3w@mail.gmail.com>
Message-ID: <20150215164210.GD22040@nicira.com>

It's a start but I was really hoping for something that covers the
common pitfalls, too, and includes more of a walkthrough for the
uninitiated.  I think I'll have to write it.

On Sat, Feb 14, 2015 at 12:05:00AM -0800, Andy Zhou wrote:
> A quick web search did not lead to anything directly usable. How about
> the following.
> 
> -------------------------------------------
> 
> Core files are usually generated in the same directory as the running
> program with a name 'core'.  However,  whether a core file will be
> generated, its filename and location can be influenced by a number of
> factors. 'man core' gives more details.
> 
> When a core file is generated, the backtrace can be obtained by running gdb.
>       gdb <program> <core file>
> Once inside gdb, issue a 'bt' command to obtain the backtrace.
> 'man gdb' gives more details about gdb.
> 
> On Mon, Feb 9, 2015 at 11:12 AM, Ben Pfaff <blp at nicira.com> wrote:
> > Occasionally (as today) I find myself asking a user to get a core dump
> > and a backtrace, and find that the user doesn't have any of the skills
> > or knowledge to do that.  Does anyone know of a good document that
> > walks a user through how to do this (not necessarily OVS-specific)?  I
> > don't want to hand-hold but I do want to help.
> >
> > Thanks,
> >
> > Ben.
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss

From salvatore.cambria at citrix.com  Mon Feb 16 02:23:07 2015
From: salvatore.cambria at citrix.com (Salvatore Cambria)
Date: Mon, 16 Feb 2015 10:23:07 +0000
Subject: [ovs-discuss] Fwd:  OVS segfault in recirculation
In-Reply-To: <CACzMAJLdTgd5L3tz=o+4SFA5fLaZ=KVYbqtLX63rR43+q8XLAA@mail.gmail.com>
References: <54DA2A50.4040201@citrix.com>	<CACzMAJ+1w3XnKzuFKYtoLmfNmcCucjWQDFBv+yzeMo9OaWQScA@mail.gmail.com>	<CACzMAJ+jAoLpdywerVPF3Xdk=cB+5xJaa+aMYiss7OsxGcQOYQ@mail.gmail.com>	<54DDE66B.7010503@citrix.com>
 <CACzMAJLdTgd5L3tz=o+4SFA5fLaZ=KVYbqtLX63rR43+q8XLAA@mail.gmail.com>
Message-ID: <54E1C50B.90207@citrix.com>

Hi Andy,

I can tell you that this morning the test is still running without any 
segfault. The patch seems to fix the problem!

Thanks for your help,

Salvatore


On 13/02/15 17:18, Andy Zhou wrote:
> Great! looking forward to the test results.
>
> On Fri, Feb 13, 2015 at 3:56 AM, Salvatore Cambria
> <salvatore.cambria at citrix.com> wrote:
>> Hi Andy,
>>
>> Yes, it makes a lot of sense!
>>
>> I applied the patch and I'm running my script again in order to test it. It
>> looks good so far!
>> I will leave the script running all across the weekend and I'll come back to
>> you with my results on Monday.
>>
>> Thank you for your very fast response and for your effort,
>>
>> Salvatore
>>
>> On 13/02/15 02:10, Andy Zhou wrote:
>>> Does not mean to drop the list.
>>>
>>>
>>> ---------- Forwarded message ----------
>>> From: Andy Zhou <azhou at nicira.com>
>>> Date: Thu, Feb 12, 2015 at 3:42 PM
>>> Subject: Re: [ovs-discuss] OVS segfault in recirculation
>>> To: Salvatore Cambria <salvatore.cambria at citrix.com>
>>>
>>>
>>> Hi, Salvatore,
>>>
>>> I think I found a bug: hmap_remove needs to be protected by a lock. As
>>> you pointed out, the output_normal() path is not properly protected.
>>> Would you please
>>> try the attached patch to see if it helps?
>>>
>>> Bond object is protected by reference counting.  Assuming reference
>>> counter is valid, it should be O.K. for a bundle to hold on to the
>>> object. Notice
>>> bundle_destroy() calls unref_bond().  At any rate, I did not spot
>>> anything obvious there.
>>>
>>> Thanks for providing such a detailed description. It is very helpful.
>>>
>>> Andy
>>>
>>> ================================
>>>
>>> iff --git a/ofproto/bond.c b/ofproto/bond.c
>>> index c4b3a3a..a9b7a83 100644
>>> --- a/ofproto/bond.c
>>> +++ b/ofproto/bond.c
>>> @@ -923,8 +923,8 @@ bond_may_recirc(const struct bond *bond, uint32_t
>>> *recirc_id,
>>>        }
>>>    }
>>>
>>> -void
>>> -bond_update_post_recirc_rules(struct bond* bond, const bool force)
>>> +static void
>>> +bond_update_post_recirc_rules__(struct bond* bond, const bool force)
>>>    {
>>>       struct bond_entry *e;
>>>       bool update_rules = force;  /* Always update rules if caller forces
>>> it. */
>>> @@ -945,6 +945,14 @@ bond_update_post_recirc_rules(struct bond* bond,
>>> const bool force)
>>>            update_recirc_rules(bond);
>>>       }
>>>    }
>>> +
>>> +void
>>> +bond_update_post_recirc_rules(struct bond* bond, const bool force)
>>> +{
>>> +    ovs_rwlock_wrlock(&rwlock);
>>> +    bond_update_post_recirc_rules__(bond, force);
>>> +    ovs_rwlock_unlock(&rwlock);
>>> +}
>>>    ^L
>>>    /* Rebalancing. */
>>>
>>> @@ -1203,7 +1211,7 @@ bond_rebalance(struct bond *bond)
>>>        }
>>>
>>>        if (use_recirc && rebalanced) {
>>> -        bond_update_post_recirc_rules(bond,true);
>>> +        bond_update_post_recirc_rules__(bond,true);
>>>        }
>>>
>>>    done:
>>>
>>>
>>> On Tue, Feb 10, 2015 at 7:57 AM, Salvatore Cambria
>>> <salvatore.cambria at citrix.com> wrote:
>>>> Hello,
>>>>
>>>> I am a Software Engineer from Citrix, Cambridge UK office.
>>>>
>>>> We are having a problem when running our nightly test on a XenServer host
>>>> with lacp bonds with OVS. Indeed, when deleting the bond the following
>>>> segfault error appears (from GDB):
>>>>
>>>> Program terminated with signal 11, Segmentation fault.
>>>>
>>>> #0  0x0000000000411d2f in hmap_remove (node=0x7fd9d402e730,
>>>> hmap=0x1c3e9e8)
>>>>
>>>>       at lib/hmap.h:236
>>>>
>>>> 236         while (*bucket != node) {
>>>>
>>>> (gdb) bt
>>>>
>>>> #0  0x0000000000411843 in hmap_remove (node=0x7fd9d402e730,
>>>> hmap=0x1c3e9e8)
>>>>
>>>>       at lib/hmap.h:236
>>>>
>>>> #1  update_recirc_rules (bond=0x1c3e920) at ofproto/bond.c:382
>>>>
>>>> #2  0x0000000000001ff5 in ?? ()
>>>>
>>>> (gdb) p *hmap
>>>>
>>>> $1 = {buckets = 0x7fd9d4039b70, one = 0x0, mask = 255, n = 147}
>>>>
>>>> (gdb) p *node
>>>>
>>>> $2 = {hash = 2450845263, next = 0x0}
>>>>
>>>> (gdb) p *bucket
>>>>
>>>> Cannot access memory at address 0x8
>>>>
>>>> (gdb) p *(hmap->buckets)
>>>>
>>>> $3 = (struct hmap_node *) 0x0
>>>>
>>>> (gdb) p node->hash & hmap->mask
>>>>
>>>> $4 = 79
>>>>
>>>> (gdb) p *(&hmap->buckets[79])
>>>>
>>>> $5 = (struct hmap_node *) 0x0
>>>>
>>>> I managed to reproduce the error using a while loop in which I repeatedly
>>>> create and destroy a lacp bond, waiting for 15 seconds after each of
>>>> these
>>>> operations.
>>>>
>>>> The error is not constant in timing and I think that it can be a race
>>>> condition due to the recirculation process. It happens indeed that when
>>>> calling hmap_remove() from update_recirc_rules() (in case of DEL), the
>>>> bucket points to NULL. My idea is the following:
>>>>
>>>> hmap_remove() is called from two different places in ofproto/bond.c:
>>>>
>>>> 1. from update_recirc_rules() (in which it raises the segfault)
>>>>
>>>> hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>>> *pr_op->pr_rule = NULL;
>>>> free(pr_op);
>>>>
>>>> 2. and from bond_unref() (called when I try to delete the bond)
>>>>
>>>> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>>>>       hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>>>       free(pr_op);
>>>> }
>>>>
>>>> Now, if these two calls happen at the same time, a conflict on the bond
>>>> pr_rule may happen. Looking at the code I can see that the recirculation
>>>> hmap_remove() is executed inside an external lock
>>>> (ovs_rwlock_wrlock(&rwlock)) if called by bond_rebalance()
>>>>
>>>> void bond_rebalance(struct bond *bond) {
>>>> ...
>>>> ovs_rwlock_wrlock(&rwlock);
>>>> ...
>>>> ...
>>>> if (use_recirc && rebalanced) {
>>>>       bond_update_post_recirc_rules(bond,true); <---- hmap_remove()
>>>> }
>>>>
>>>> done:
>>>>       ovs_rwlock_unlock(&rwlock);
>>>> }
>>>>
>>>> but I can't see any lock when called by output_normal()
>>>>
>>>> static void output_normal(struct xlate_ctx *ctx, const struct xbundle
>>>> *out_xbundle, uint16_t vlan) {
>>>> ...
>>>> if (ctx->use_recirc) {
>>>>       ...
>>>>       bond_update_post_recirc_rules(out_xbundle->bond, false); <----
>>>> hmap_remove()
>>>>       ...
>>>> }
>>>> ...
>>>>
>>>> The same lock is used in bond_unref() but only for hmap_remove(all_bonds,
>>>> &bond->hmap_node) and not for hmap_remove(&bond->pr_rule_ops,
>>>> &pr_op->hmap_node).
>>>>
>>>> ...
>>>> ovs_rwlock_wrlock(&rwlock);
>>>> hmap_remove(all_bonds, &bond->hmap_node);
>>>> ovs_rwlock_unlock(&rwlock);
>>>> ...
>>>> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>>>>       hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>>>       free(pr_op);
>>>> }
>>>> ...
>>>>
>>>> I suppose that the goal is to remove any pointer to the bond, from
>>>> all_bonds, inside the lock and to work on it locally. My doubt is: can
>>>> the
>>>> bond be still accessible from somewhere else (let's say from a bundle)?
>>>> If
>>>> yes, what happen if a bundle tries to access a bond which was previously
>>>> removed from all_bonds (let's say from bundle_destroy())?
>>>>
>>>> The version of OVS that I am using is openvswitch-2.3.0-7.8312.x86_64.
>>>>
>>>> Could you please help me to find the problem?
>>>>
>>>>
>>>> Thank you for the help & kind regards,
>>>>
>>>> Salvatore
>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> discuss mailing list
>>>> discuss at openvswitch.org
>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>


From agmimidi at gmail.com  Mon Feb 16 03:04:46 2015
From: agmimidi at gmail.com (Angelos Mimidis)
Date: Mon, 16 Feb 2015 12:04:46 +0100
Subject: [ovs-discuss] Max number of flow entries?
Message-ID: <CAEq3c_+EubF_+whtLvh5cX5Yk0KmV6e33p4+L75QUhQVDVoXoQ@mail.gmail.com>

Hi all,

Is there a maximum number of flow entries that can reside in OVS at one
time?
Also is there a way to change this number?

Best regards Angelos Mimidis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150216/3e773be2/attachment.html>

From blp at nicira.com  Mon Feb 16 09:58:58 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 16 Feb 2015 09:58:58 -0800
Subject: [ovs-discuss] Max number of flow entries?
In-Reply-To: <CAEq3c_+EubF_+whtLvh5cX5Yk0KmV6e33p4+L75QUhQVDVoXoQ@mail.gmail.com>
References: <CAEq3c_+EubF_+whtLvh5cX5Yk0KmV6e33p4+L75QUhQVDVoXoQ@mail.gmail.com>
Message-ID: <20150216175858.GB9749@nicira.com>

On Mon, Feb 16, 2015 at 12:04:46PM +0100, Angelos Mimidis wrote:
> Is there a maximum number of flow entries that can reside in OVS at one
> time?

No.

> Also is there a way to change this number?

Yes, please read the documentation for the Flow_Table table in
ovs-vswitchd.conf.db(5).

From mittal.flora at gmail.com  Mon Feb 16 02:44:30 2015
From: mittal.flora at gmail.com (Flora Mittal)
Date: Mon, 16 Feb 2015 16:14:30 +0530
Subject: [ovs-discuss] ovs-vsctl Set Interface does not work
Message-ID: <CAP5z0CADk0mWGkQwhVK6s1ORvnOLf=9wgqaxEzDf59pDS+==FA@mail.gmail.com>

Hi All,
We are facing a problem in
ovs-vsctl set interface <interface> ofport_request=<no>

The OutPut is as follows :

[root at localhost student]# ovs-vsctl show
bded31da-c5ad-4d51-93bd-136c0fbdde43
    ovs_version: "1.4.2"

[root at localhost student]# ovs-vsctl add-br br0

[root at localhost student]# ovs-vsctl add-port br0 p1

[root at localhost student]# ovs-vsctl show
bded31da-c5ad-4d51-93bd-136c0fbdde43
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
        Port "p1"
            Interface "p1"
    ovs_version: "1.4.2"

[root at localhost student]# ovs-vsctl list interface
_uuid               : 6e0dcdc9-d48f-40c5-bc9b-243817acc48a
admin_state         : []
cfm_fault           : []
cfm_mpid            : []
cfm_remote_mpids    : []
duplex              : []
external_ids        : {}
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : []
link_speed          : []
link_state          : []
mac                 : []
mtu                 : []
name                : "p1"
ofport              : -1
options             : {}
other_config        : {}
statistics          : {}
status              : {}
type                : ""

_uuid               : 6dd7b916-574a-444e-867e-44150fff3a5f
name                : "br0"
type                : internal
...<edited>more info for br0

[root at localhost student]# ovs-vsctl set interface p1 ofport=11

[root at localhost student]# ovs-vsctl list interface
_uuid               : 6e0dcdc9-d48f-40c5-bc9b-243817acc48a
admin_state         : []
cfm_fault           : []
cfm_mpid            : []
cfm_remote_mpids    : []
duplex              : []
external_ids        : {}
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : []
link_speed          : []
link_state          : []
mac                 : []
mtu                 : []
name                : "p1"
ofport              : -1
options             : {}
other_config        : {}
statistics          : {}
status              : {}
type                : ""

_uuid               : 6dd7b916-574a-444e-867e-44150fff3a5f
name                : "br0"
type                : internal
...<edited>more info for br0

[root at localhost student]# ovs-vsctl set interface p1 ofport_request=11
ovs-vsctl: Interface does not contain a column whose name matches
"ofport_request"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150216/8015c0fb/attachment.html>

From aatteka at nicira.com  Mon Feb 16 13:38:22 2015
From: aatteka at nicira.com (Ansis Atteka)
Date: Mon, 16 Feb 2015 13:38:22 -0800
Subject: [ovs-discuss] ovs-vsctl Set Interface does not work
In-Reply-To: <CAP5z0CADk0mWGkQwhVK6s1ORvnOLf=9wgqaxEzDf59pDS+==FA@mail.gmail.com>
References: <CAP5z0CADk0mWGkQwhVK6s1ORvnOLf=9wgqaxEzDf59pDS+==FA@mail.gmail.com>
Message-ID: <CAA=3Oq=3rJwUKCods6-SEmOM2du2_G4Vw8NbGQAdDe-P54=nBA@mail.gmail.com>

On Mon, Feb 16, 2015 at 2:44 AM, Flora Mittal <mittal.flora at gmail.com> wrote:
> Hi All,
> We are facing a problem in
> ovs-vsctl set interface <interface> ofport_request=<no>
>
> The OutPut is as follows :
>
> [root at localhost student]# ovs-vsctl show
> bded31da-c5ad-4d51-93bd-136c0fbdde43
>     ovs_version: "1.4.2"
>
> [root at localhost student]# ovs-vsctl add-br br0
>
> [root at localhost student]# ovs-vsctl add-port br0 p1
>
> [root at localhost student]# ovs-vsctl show
> bded31da-c5ad-4d51-93bd-136c0fbdde43
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "p1"
>             Interface "p1"
>     ovs_version: "1.4.2"
>
> [root at localhost student]# ovs-vsctl list interface
> _uuid               : 6e0dcdc9-d48f-40c5-bc9b-243817acc48a
> admin_state         : []
> cfm_fault           : []
> cfm_mpid            : []
> cfm_remote_mpids    : []
> duplex              : []
> external_ids        : {}
> ingress_policing_burst: 0
> ingress_policing_rate: 0
> lacp_current        : []
> link_resets         : []
> link_speed          : []
> link_state          : []
> mac                 : []
> mtu                 : []
> name                : "p1"
> ofport              : -1
> options             : {}
> other_config        : {}
> statistics          : {}
> status              : {}
> type                : ""
>
> _uuid               : 6dd7b916-574a-444e-867e-44150fff3a5f
> name                : "br0"
> type                : internal
> ...<edited>more info for br0
>
> [root at localhost student]# ovs-vsctl set interface p1 ofport=11
>
> [root at localhost student]# ovs-vsctl list interface
> _uuid               : 6e0dcdc9-d48f-40c5-bc9b-243817acc48a
> admin_state         : []
> cfm_fault           : []
> cfm_mpid            : []
> cfm_remote_mpids    : []
> duplex              : []
> external_ids        : {}
> ingress_policing_burst: 0
> ingress_policing_rate: 0
> lacp_current        : []
> link_resets         : []
> link_speed          : []
> link_state          : []
> mac                 : []
> mtu                 : []
> name                : "p1"
> ofport              : -1
> options             : {}
> other_config        : {}
> statistics          : {}
> status              : {}
> type                : ""
>
> _uuid               : 6dd7b916-574a-444e-867e-44150fff3a5f
> name                : "br0"
> type                : internal
> ...<edited>more info for br0
>
> [root at localhost student]# ovs-vsctl set interface p1 ofport_request=11
> ovs-vsctl: Interface does not contain a column whose name matches
> "ofport_request"

Such errors that indicate that column does not exist typically mean
that you are running old Open vSwitch version that has old OVSDB
schema definition.

Try to upgrade to 1.10 or later OVS version to get the OVSDB schema
that has ofport_request column.
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From andrey at xdel.ru  Mon Feb 16 14:37:37 2015
From: andrey at xdel.ru (Andrey Korolyov)
Date: Tue, 17 Feb 2015 02:37:37 +0400
Subject: [ovs-discuss] Packet drops during non-exhaustive flood with OVS
	and 1.8.0
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F7306A5B5F@IRSMSX104.ger.corp.intel.com>
References: <CABYiri-qn_HGYeRSxH+z0+LGi0se9NEOk0q9hzFg4R+wg05ABw@mail.gmail.com>
 <CABYiri9WwQMn1u7TbJNEGCs804f_hvP2cKxet2sGMbrx1rJUyw@mail.gmail.com>
 <CABYiri_q4QqWrhTQL-UZ1wf3FLz-wj9SbtBJrDntz2Bw4cEPoQ@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F730688B53@IRSMSX104.ger.corp.intel.com>
 <CABYiri8qr2v8r_XQO35swWt_OO=WQtW0jO=KAz70f5VojhM6kg@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F7306A3D77@IRSMSX104.ger.corp.intel.com>
 <CABYiri9b_fZJNg186vHLTWVWsAy9UqBvN32WTi26bO5+o93mPQ@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F7306A5B5F@IRSMSX104.ger.corp.intel.com>
Message-ID: <CABYiri8jknCnMsijhS0TYakbLqG==pZydejfKKun5utro_tUUA@mail.gmail.com>

On Fri, Feb 13, 2015 at 1:58 PM, Traynor, Kevin <kevin.traynor at intel.com> wrote:
>> -----Original Message-----
>> From: Andrey Korolyov [mailto:andrey at xdel.ru]
>> Sent: Thursday, February 12, 2015 3:16 PM
>> To: Traynor, Kevin
>> Cc: dev at dpdk.org; discuss at openvswitch.org
>> Subject: Re: Packet drops during non-exhaustive flood with OVS and 1.8.0
>>
>> On Thu, Feb 12, 2015 at 6:05 PM, Traynor, Kevin <kevin.traynor at intel.com> wrote:
>> >> -----Original Message-----
>> >> From: Andrey Korolyov [mailto:andrey at xdel.ru]
>> >> Sent: Tuesday, February 3, 2015 5:21 PM
>> >> To: Traynor, Kevin
>> >> Cc: dev at dpdk.org; discuss at openvswitch.org
>> >> Subject: Re: Packet drops during non-exhaustive flood with OVS and 1.8.0
>> >>
>> >> > These patches are to enable DPDK 1.8 only. What 'bulk processing' are you referring to?
>> >> > By default there is a batch size of 192 in netdev-dpdk for rx from the NIC - the linked
>> >> > patch doesn't change this, just the DPDK version.
>> >>
>> >> Sorry, I referred the wrong part there: bulk transmission, which is
>> >> clearly not involved in my case. The idea was that the conditionally
>> >> enabling prefetch for rx queues (BULK_ALLOC) may help somehow, but
>> >> it`s probably will mask issue instead of solving it directly. By my
>> >> understanding, strict drop rule should have a zero impact on a main
>> >> ovs thread (and this is true) and work just fine with a line rate
>> >> (this is not).
>> >
>> > I've set a similar drop rule and I'm seeing the first packet drops occurring
>> > at 13.9 mpps for 64 byte pkts. I'm not sure if there is a config that can be
>> > changed or if it just the cost of the emc/lookups
>> >
>>
>> Do you mind to compare this case with forward to the dummy port
>> (ifconfig dummy0; ovs-vsctl add-port br0 dummy0; ip link set dev
>> dummy0 up; flush rule table; create a single forward rule; start an
>> attack)? As I mentioned there are no signs of syscall congestion for a
>> drop or dpdk-dpdk forward case.
>
> Assuming I've understood your setup, I get a very low rate (~1.1 mpps)
> without packet loss as I'm sending the packets from a dpdk port to a
> socket for the dummy port

Yes, but in other hand flow control from the dpdk port allows line
rate to come in, despite the actual loss during the transfer inside
receiving instance. With drop/output to dpdkY port the horizontal
asymptote with congestion is somewhat lower and this is hardly
explainable.

From aatteka at nicira.com  Mon Feb 16 19:06:58 2015
From: aatteka at nicira.com (Ansis Atteka)
Date: Mon, 16 Feb 2015 19:06:58 -0800
Subject: [ovs-discuss] [ovs-issues] Network netspace is cleared when
 adding new unrelated port (#68)
In-Reply-To: <20150215162946.GA22040@nicira.com>
References: <20150215162946.GA22040@nicira.com>
Message-ID: <CAA=3Oqn3X3A3PXkS1LJ27zGcH7mNu+PS2J+yM2F2+Wjkw5Dgag@mail.gmail.com>

It seems that this bug (interface being moved out of namespace) was
triggered because interface name was changed from m1-eth0 to eth0:

sudo ip netns exec $M1_NSPID ip link set $M1_ETH0 name eth0

I reduced original test to:

#ovs-vsctl add-br brTest
#ovs-vsctl add-port brTest pTest -- set Interface pTest type=internal
#ip netns add nsTest
#ip link set pTest netns nsTest
#ip netns exec nsTest ifconfig -a
lo        Link encap:Local Loopback
          LOOPBACK  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

pTest     Link encap:Ethernet  HWaddr 72:d7:b6:d9:67:61
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

#ip netns exec nsTest ip link set pTest name Test
#ip netns exec nsTest ifconfig -a
Test      Link encap:Ethernet  HWaddr 72:d7:b6:d9:67:61
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

lo        Link encap:Local Loopback
          LOOPBACK  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

#ovs-vsctl add-port brTest pTest2 -- set Interface pTest2 type=internal
#ip netns exec nsTest ifconfig -a
lo        Link encap:Local Loopback
          LOOPBACK  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)


However, I think there is a bigger issue where OVS does not handle
net-device renames at all, Each rename seem to correlate with
following error message in ovs-vswitchd.log:

2015-02-17T02:35:04.950Z|00052|netdev_linux|WARN|pTest: obtaining
netdev stats via vport failed (No such device)

and then the renamed interface simply disappears and OVS creates a new
one with the original name as specified in OVSDB.

On Sun, Feb 15, 2015 at 8:29 AM, Ben Pfaff <blp at nicira.com> wrote:
> This was filed in OVS's github bug tracker.  I'm forwarding it to the
> bugs list to make sure it doesn't get lost.
>
> ----- Forwarded message from Robert Åkerblom-Andersson <notifications at github.com> -----
>
> Date: Sun, 15 Feb 2015 07:40:55 -0800
> From: Robert Åkerblom-Andersson <notifications at github.com>
> To: openvswitch/ovs-issues <ovs-issues at noreply.github.com>
> Subject: [ovs-issues] Network netspace is cleared when adding new unrelated port
>         (#68)
>
> Hi,
>
> I think I have found a bug, I'm using Linux running:
> ```
> uname -a
> Linux rb-00001 3.13.0-44-generic #73-Ubuntu SMP Tue Dec 16 00:22:43 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
>
> sudo ovs-vsctl -V
> ovs-vsctl (Open vSwitch) 2.3.1
> Compiled Feb 11 2015 13:39:02
> DB Schema 7.6.2
> ```
>
> Simply put, if I setup an OVS port connected to a network namespace, setup it's ip settings etc, then things looks and works good. However, if I add a new internal port to the bridge, then all netns stuff is simply cleared. I create added some commands here to reproduce this.
>
> To test this I assume this:
> - Running Ubuntu 14.04 (but by all means try on a different distro, I don't think this is Ubuntu specific)
> - Docker is installed and the docker deamon has been started with these settings DOCKER_OPTS="-b none --dns 8.8.8.8 --dns 8.8.4.4", meaning it does not create or touch any bridge on it's own. This can be setup in "/etc/default/docker" on Ubuntu (or otherwise in other dists).
>
> To test this the best way, start a bash shell, and then copy paste these command (the first "sudo echo" just to cache sudo access so the other commands can be pasted without issues. I suggest the pasting method of the commands since you can at any point stop and check with additional commands while still keeping all env vars etc):
> ```
> sudo echo
>
> # Settings
> BR="br0"
> MATE_ETH="mate-eth"
> GWADDR="172.17.0.1"
>
> # Bridge network and ip
> BR_NET="172.17.0.0/24"
> BR_IP="172.17.0.1/24"
>
> # Enable ip ip_forward
> sudo sysctl -w net.ipv4.ip_forward=1
>
> # Create bridge
> sudo ovs-vsctl add-br $BR
>
> # Start containers
> M1=$(sudo docker run --privileged -d --net="none" -t -i ubuntu:14.04 /bin/bash)
>
> # Setup ip on $BR
> sudo ip addr add $BR_IP dev $BR
> sudo ip link set dev $BR up
>
> M1_ETH0="m1-eth0"
> M1_IP="172.16.0.11/22"
> M1_GW="172.16.0.1"
> M1_NSPID=`sudo docker inspect -f '{{.State.Pid}}' $M1`
>
> # Setup network namespace pids (namespaces created by Docker)
> sudo mkdir -p /var/run/netns
> sudo rm -f /var/run/netns/$M1_NSPID | true
> sudo ln -s /proc/$M1_NSPID/ns/net /var/run/netns/$M1_NSPID
>
> # Add ovs port
> sudo ovs-vsctl add-port $BR $M1_ETH0 -- set interface $M1_ETH0 type=internal
>
> # Create new ovs ports for router
> sudo ip link set dev $M1_ETH0 up
>
> # Move ports into the containers network namespace
> sudo ip link set $M1_ETH0 netns $M1_NSPID
>
> # Setup IP settings for the netns
> sudo ip netns exec $M1_NSPID ip link set $M1_ETH0 name eth0
> sudo ip netns exec $M1_NSPID ip addr add $M1_IP dev eth0
> sudo ip netns exec $M1_NSPID ip link set dev eth0 up
> sudo ip netns exec $M1_NSPID ip route add default via $M1_GW
> ```
>
> When these command have been run, you can now with this command to see the ip settings:
> ```
> # Check that netns settings looks good, yes, they do
> sudo ip netns exec $M1_NSPID ip link
> sudo ip netns exec $M1_NSPID ip address
> ```
>
> Now try and add a new, unrelated port to the bridge:
> ```
> # Add a unrelated test port to the bridge
> sudo ovs-vsctl add-port br0 testPort -- set interface testPort type=internal
> ```
>
> After this, you can now see how the netns settings have disappeared:
> ```
> # Check again and see how the netns settings have been blown away...
> sudo ip netns exec $M1_NSPID ip link
> sudo ip netns exec $M1_NSPID ip address
> ```
>
> Do anyone have a clue on why this is happening? Feel free to ask if I've been unclear in any way.
>
> Best Regards, Robert
>
> ---
> Reply to this email directly or view it on GitHub:
> https://github.com/openvswitch/ovs-issues/issues/68
>
> ----- End forwarded message -----
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From shettyg at nicira.com  Tue Feb 17 07:44:42 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 17 Feb 2015 07:44:42 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
Message-ID: <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>

On Fri, Feb 13, 2015 at 2:57 PM, Abhishek Chanda
<abhishek.lists at gmail.com> wrote:
> Hi all,
>
> I am trying to run OVS in a docker container. A process on the
> container adds a bridge using ovs-vsctl and another queries it using
> ip link show. After the bridge is added, it shows up on querying using
> ovs-vsctl but does not show up on ip link show. ovs-vswitchd log shows
> the bridge being added, being configured and after some time, it does
> not show up. On the host, everything works fine till the container is
> started. How do I debug this?
>
> The container is running with host networking and in privileged mode.

What is your end goal? Do you want to see OVS bridge inside the
container or in the host?

From george.shuklin at gmail.com  Tue Feb 17 09:28:33 2015
From: george.shuklin at gmail.com (George Shuklin)
Date: Tue, 17 Feb 2015 19:28:33 +0200
Subject: [ovs-discuss] How to change sflow sampleType_tag
Message-ID: <54E37A41.2050005@gmail.com>

Hello.

We're playing with sFlow features of OVS. We want to collect sflow with 
em-sflow <https://github.com/normelton/em-sflow> library (ruby, 
ttps://github.com/normelton/em-sflow 
<https://github.com/normelton/em-sflow>). Unfortunately it can not 
process received sflow packets deep enough.

After some research I found there are few types of sFlow packes, with 
different structure. As far as I understand it parse payload only for 
the sampleType_tag 0:3, but it leaves unprocessed header in
sampleType_tag 0:1 (which is fine according to specs).

Is any way to configure OVS to send sFlow samples of type 3?


Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150217/df7eb5ba/attachment.html>

From abhishek.lists at gmail.com  Tue Feb 17 10:23:25 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Tue, 17 Feb 2015 10:23:25 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
Message-ID: <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>

In the container, but since it is in host networking mode, I believe
it should show up on the host as well. We observed this issue on the
container, and while debugging we found that this happens on the host
as well.

Thanks

On Tue, Feb 17, 2015 at 7:44 AM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> On Fri, Feb 13, 2015 at 2:57 PM, Abhishek Chanda
> <abhishek.lists at gmail.com> wrote:
>> Hi all,
>>
>> I am trying to run OVS in a docker container. A process on the
>> container adds a bridge using ovs-vsctl and another queries it using
>> ip link show. After the bridge is added, it shows up on querying using
>> ovs-vsctl but does not show up on ip link show. ovs-vswitchd log shows
>> the bridge being added, being configured and after some time, it does
>> not show up. On the host, everything works fine till the container is
>> started. How do I debug this?
>>
>> The container is running with host networking and in privileged mode.
>
> What is your end goal? Do you want to see OVS bridge inside the
> container or in the host?

From shettyg at nicira.com  Tue Feb 17 10:35:08 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 17 Feb 2015 10:35:08 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
Message-ID: <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>

On Tue, Feb 17, 2015 at 10:23 AM, Abhishek Chanda
<abhishek.lists at gmail.com> wrote:
> In the container, but since it is in host networking mode, I believe
> it should show up on the host as well. We observed this issue on the
> container, and while debugging we found that this happens on the host
> as well.
So you want it both in container and host. I think you should run
using '--pid=host' (atleast that is how I have used it). You don't
need to use the --privileged in that case.


>
> Thanks
>
> On Tue, Feb 17, 2015 at 7:44 AM, Gurucharan Shetty <shettyg at nicira.com> wrote:
>> On Fri, Feb 13, 2015 at 2:57 PM, Abhishek Chanda
>> <abhishek.lists at gmail.com> wrote:
>>> Hi all,
>>>
>>> I am trying to run OVS in a docker container. A process on the
>>> container adds a bridge using ovs-vsctl and another queries it using
>>> ip link show. After the bridge is added, it shows up on querying using
>>> ovs-vsctl but does not show up on ip link show. ovs-vswitchd log shows
>>> the bridge being added, being configured and after some time, it does
>>> not show up. On the host, everything works fine till the container is
>>> started. How do I debug this?
>>>
>>> The container is running with host networking and in privileged mode.
>>
>> What is your end goal? Do you want to see OVS bridge inside the
>> container or in the host?

From blp at nicira.com  Tue Feb 17 11:34:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Feb 2015 11:34:06 -0800
Subject: [ovs-discuss] How to change sflow sampleType_tag
In-Reply-To: <54E37A41.2050005@gmail.com>
References: <54E37A41.2050005@gmail.com>
Message-ID: <20150217193406.GC25632@nicira.com>

I'm adding Neil McKee, who knows much more about sflow than I do.

On Tue, Feb 17, 2015 at 07:28:33PM +0200, George Shuklin wrote:
> We're playing with sFlow features of OVS. We want to collect sflow
> with em-sflow <https://github.com/normelton/em-sflow> library (ruby,
> ttps://github.com/normelton/em-sflow
> <https://github.com/normelton/em-sflow>). Unfortunately it can not
> process received sflow packets deep enough.
> 
> After some research I found there are few types of sFlow packes,
> with different structure. As far as I understand it parse payload
> only for the sampleType_tag 0:3, but it leaves unprocessed header in
> sampleType_tag 0:1 (which is fine according to specs).
> 
> Is any way to configure OVS to send sFlow samples of type 3?

I don't think OVS has knobs like that.  It's not obvious to me whether
the correct solution here is to improve the library you're using or to
change OVS to do something different.  Neil?

Thanks,

Ben.

From abhishek.lists at gmail.com  Tue Feb 17 11:39:48 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Tue, 17 Feb 2015 11:39:48 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
Message-ID: <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>

That did not seem to help with the problem. Here is the vswitchd log
on my host, the interface is called test1:

cloudscaling at mngmt2:~> grep -rn test1 /var/log/openvswitch/ovs-vswitchd.log
11718:2015-02-17T18:55:14.497Z|00052|bridge|INFO|bridge test1: added
interface test1 on port 65534
11724:2015-02-17T18:55:14.518Z|00058|bridge|INFO|bridge test1: using
datapath ID 00003aba0fcbf849
11725:2015-02-17T18:55:14.518Z|00059|connmgr|INFO|test1: added service
controller "punix:/var/run/openvswitch/test1.mgmt"
11738:2015-02-17T19:13:06.355Z|00072|netdev_linux|INFO|ioctl(SIOCGIFHWADDR)
on test1 device failed: No such device
11739:2015-02-17T19:13:06.368Z|00073|netdev_linux|WARN|ioctl(SIOCGIFINDEX)
on test1 device failed: No such device
11744:2015-02-17T19:13:06.556Z|00078|netdev_linux|WARN|test1:
obtaining netdev stats via vport failed (No such device)
11751:2015-02-17T19:14:06.559Z|00085|ofproto|WARN|test1: cannot get
STP stats on nonexistent port 65534
11801:2015-02-17T19:15:19.479Z|00010|bridge|INFO|bridge test1: added
interface test1 on port 65534
11810:2015-02-17T19:15:19.589Z|00019|netdev_linux|ERR|ioctl(SIOCSIFHWADDR)
on test1 device failed: No such device
11811:2015-02-17T19:15:19.589Z|00020|bridge|ERR|bridge test1: failed
to set bridge Ethernet address: No such device
11812:2015-02-17T19:15:19.589Z|00021|bridge|INFO|bridge test1: using
datapath ID 00003aba0fcbf849
11813:2015-02-17T19:15:19.589Z|00022|netdev_linux|WARN|query test1
qdisc failed (No such device)
11814:2015-02-17T19:15:19.590Z|00023|netdev_linux|WARN|test1: removing
policing failed: No such device
11815:2015-02-17T19:15:19.590Z|00024|connmgr|INFO|test1: added service
controller "punix:/var/run/openvswitch/test1.mgmt"
11840:2015-02-17T19:15:19.597Z|00049|netdev_linux|WARN|test1:
obtaining netdev stats via vport failed (No such device)
11841:2015-02-17T19:15:19.597Z|00050|ofproto|WARN|test1: cannot get
STP stats on nonexistent port 65534
11849:2015-02-17T19:15:19.600Z|00058|netdev_linux|INFO|ioctl(SIOCGIFHWADDR)
on test1 device failed: No such device
11850:2015-02-17T19:15:19.602Z|00059|netdev_linux|WARN|ioctl(SIOCGIFINDEX)
on test1 device failed: No such device
11867:2015-02-17T19:15:34.227Z|00076|bridge|INFO|bridge test1: added
interface test1 on port 65534
11877:2015-02-17T19:15:34.259Z|00086|netdev_linux|ERR|ioctl(SIOCSIFHWADDR)
on test1 device failed: No such device
11886:2015-02-17T19:15:34.290Z|00095|netdev_linux|INFO|ioctl(SIOCGIFHWADDR)
on test1 device failed: No such device
11904:2015-02-17T19:17:33.988Z|00016|bridge|INFO|bridge test1: added
interface test1 on port 65534
11918:2015-02-17T19:17:33.997Z|00030|bridge|INFO|bridge test1: using
datapath ID 00003aba0fcbf849
11919:2015-02-17T19:17:33.997Z|00031|connmgr|INFO|test1: added service
controller "punix:/var/run/openvswitch/test1.mgmt"
11943:2015-02-17T19:26:56.159Z|00055|bridge|INFO|bridge test1: added
interface test1 on port 65534
11944:2015-02-17T19:26:56.159Z|00056|bridge|INFO|bridge test1: using
datapath ID 0000a2a5465c2e44
11945:2015-02-17T19:26:56.159Z|00057|connmgr|INFO|test1: added service
controller "punix:/var/run/openvswitch/test1.mgmt"
11947:2015-02-17T19:32:37.931Z|00059|ofproto|WARN|test1: cannot get
STP status on nonexistent port 65534
11948:2015-02-17T19:32:37.931Z|00060|ofproto|WARN|test1: cannot get
RSTP status on nonexistent port 65534
11949:2015-02-17T19:32:37.944Z|00061|netdev_linux|INFO|ioctl(SIOCGIFHWADDR)
on test1 device failed: No such device
11950:2015-02-17T19:32:37.947Z|00062|netdev_linux|WARN|ioctl(SIOCGIFINDEX)
on test1 device failed: No such device
11955:2015-02-17T19:32:37.954Z|00067|ofproto|WARN|test1: cannot get
STP status on nonexistent port 65534
11960:2015-02-17T19:32:38.951Z|00072|netdev_linux|WARN|test1:
obtaining netdev stats via vport failed (No such device)

Not sure if it's relevant, but one interface on the host is bonded.

Is there something else I should check?

Thanks

On Tue, Feb 17, 2015 at 10:35 AM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> On Tue, Feb 17, 2015 at 10:23 AM, Abhishek Chanda
> <abhishek.lists at gmail.com> wrote:
>> In the container, but since it is in host networking mode, I believe
>> it should show up on the host as well. We observed this issue on the
>> container, and while debugging we found that this happens on the host
>> as well.
> So you want it both in container and host. I think you should run
> using '--pid=host' (atleast that is how I have used it). You don't
> need to use the --privileged in that case.
>
>
>>
>> Thanks
>>
>> On Tue, Feb 17, 2015 at 7:44 AM, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>> On Fri, Feb 13, 2015 at 2:57 PM, Abhishek Chanda
>>> <abhishek.lists at gmail.com> wrote:
>>>> Hi all,
>>>>
>>>> I am trying to run OVS in a docker container. A process on the
>>>> container adds a bridge using ovs-vsctl and another queries it using
>>>> ip link show. After the bridge is added, it shows up on querying using
>>>> ovs-vsctl but does not show up on ip link show. ovs-vswitchd log shows
>>>> the bridge being added, being configured and after some time, it does
>>>> not show up. On the host, everything works fine till the container is
>>>> started. How do I debug this?
>>>>
>>>> The container is running with host networking and in privileged mode.
>>>
>>> What is your end goal? Do you want to see OVS bridge inside the
>>> container or in the host?

From shettyg at nicira.com  Tue Feb 17 11:46:13 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 17 Feb 2015 11:46:13 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
Message-ID: <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>

On Tue, Feb 17, 2015 at 11:39 AM, Abhishek Chanda
<abhishek.lists at gmail.com> wrote:
> That did not seem to help with the problem. Here is the vswitchd log
> on my host
You are running ovs-vswitchd in the host? I made an assumption that
you want to run it inside the container based on the following two
lines in your first message.

"I am trying to run OVS in a docker container. A process on the
container adds a bridge using ovs-vsctl and another queries it using
ip link show."

You will need to clearly state what you are trying to do.

From abhishek.lists at gmail.com  Tue Feb 17 11:58:44 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Tue, 17 Feb 2015 11:58:44 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
 <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
Message-ID: <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>

Sorry for being vague.

I am trying to run neutron in a container. A container runs neutron
and OVS in host mode. While starting up, neutron creates an internal
bridge using ovs-vsctl. Later, it tries to look it up using `ip link
show` which does not return a result, causing neutron to crash. I
noticed that if I attach to my container at this point and add an ovs
bridge manually, it show up in ovs-vsctl but not in `ip link show`. I
ran ovs on the host to check if this issue happens on the host. I do
not need to run ovs on the host. Here is whats happening:

mngmt2:/opt/ocs # ovs-vsctl show
96d8a92e-c8f2-469d-be8b-73b8d8ec5c20
    Bridge br-int
        fail_mode: secure
        Port br-int
            Interface br-int
                type: internal
    ovs_version: "2.3.90"
mngmt2:/opt/ocs # ip link show br-int
Device "br-int" does not exist.
mngmt2:/opt/ocs # ovs-vsctl add-br test1
mngmt2:/opt/ocs # ip link show test1
Device "test1" does not exist.
mngmt2:/opt/ocs # ovs-vsctl show
96d8a92e-c8f2-469d-be8b-73b8d8ec5c20
    Bridge "test1"
        Port "test1"
            Interface "test1"
                type: internal
    Bridge br-int
        fail_mode: secure
        Port br-int
            Interface br-int
                type: internal
    ovs_version: "2.3.90"
mngmt2:/opt/ocs # grep -rn test1 /var/log/openvswitch/ovs-vswitchd.log
56:2015-02-17T19:54:06.575Z|00055|bridge|INFO|bridge test1: added
interface test1 on port 65534
62:2015-02-17T19:54:06.603Z|00061|netdev_linux|ERR|ioctl(SIOCSIFHWADDR)
on test1 device failed: No such device
63:2015-02-17T19:54:06.603Z|00062|bridge|ERR|bridge test1: failed to
set bridge Ethernet address: No such device
64:2015-02-17T19:54:06.603Z|00063|bridge|INFO|bridge test1: using
datapath ID 00003e34108c1b47
65:2015-02-17T19:54:06.603Z|00064|netdev_linux|WARN|query test1 qdisc
failed (No such device)
66:2015-02-17T19:54:06.603Z|00065|netdev_linux|WARN|test1: removing
policing failed: No such device
67:2015-02-17T19:54:06.603Z|00066|connmgr|INFO|test1: added service
controller "punix:/var/run/openvswitch/test1.mgmt"
74:2015-02-17T19:54:06.630Z|00073|netdev_linux|INFO|ioctl(SIOCGIFHWADDR)
on test1 device failed: No such device
75:2015-02-17T19:54:06.632Z|00074|netdev_linux|WARN|ioctl(SIOCGIFINDEX)
on test1 device failed: No such device
79:2015-02-17T19:54:08.116Z|00078|netdev_linux|WARN|test1: obtaining
netdev stats via vport failed (No such device)
mngmt2:/opt/ocs #

br-int has similar entries in that file.

Thanks

On Tue, Feb 17, 2015 at 11:46 AM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> On Tue, Feb 17, 2015 at 11:39 AM, Abhishek Chanda
> <abhishek.lists at gmail.com> wrote:
>> That did not seem to help with the problem. Here is the vswitchd log
>> on my host
> You are running ovs-vswitchd in the host? I made an assumption that
> you want to run it inside the container based on the following two
> lines in your first message.
>
> "I am trying to run OVS in a docker container. A process on the
> container adds a bridge using ovs-vsctl and another queries it using
> ip link show."
>
> You will need to clearly state what you are trying to do.

From shettyg at nicira.com  Tue Feb 17 12:35:15 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 17 Feb 2015 12:35:15 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
 <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
 <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>
Message-ID: <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>

On Tue, Feb 17, 2015 at 11:58 AM, Abhishek Chanda
<abhishek.lists at gmail.com> wrote:
> Sorry for being vague.
>
> I am trying to run neutron in a container. A container runs neutron
> and OVS in host mode.
What do you mean when you say that a container runs OVS in host mode?
Sorry for being fussy, but the above can mean different things and I
don't want to guess. So instead of you trying to frame your problem,
let me show how I can create OVS bridge inside a container.


* Create a container
root at ubuntu14:~# docker run -d  --pid=host --net=host ubuntu /bin/sh
-c "while true; do echo hello world; sleep 1;
done"6d5508adca20a4c60d9fb35c18e88170852ffe6b63775c27013188034b7a7393

* Enter the container
root at ubuntu14:~# docker-enter
6d5508adca20a4c60d9fb35c18e88170852ffe6b63775c27013188034b7a7393

* Install OVS inside the container
root at ubuntu14:~# apt-get update
Ign http://archive.ubuntu.com trusty InRelease
Ign http://archive.ubuntu.com trusty-updates InRelease
Ign http://archive.ubuntu.com trusty-security InRelease
Hit http://archive.ubuntu.com trusty Release.gpg
Get:1 http://archive.ubuntu.com trusty-updates Release.gpg [933 B]
Get:2 http://archive.ubuntu.com trusty-security Release.gpg [933 B]
Hit http://archive.ubuntu.com trusty Release
Get:3 http://archive.ubuntu.com trusty-updates Release [62.0 kB]
Get:4 http://archive.ubuntu.com trusty-security Release [62.0 kB]
Get:5 http://archive.ubuntu.com trusty/main Sources [1335 kB]
Get:6 http://archive.ubuntu.com trusty/restricted Sources [5335 B]
Get:7 http://archive.ubuntu.com trusty/universe Sources [7926 kB]
Get:8 http://archive.ubuntu.com trusty/main amd64 Packages [1743 kB]
Get:9 http://archive.ubuntu.com trusty/restricted amd64 Packages [16.0 kB]
Get:10 http://archive.ubuntu.com trusty/universe amd64 Packages [7589 kB]
Get:11 http://archive.ubuntu.com trusty-updates/main Sources [229 kB]
Get:12 http://archive.ubuntu.com trusty-updates/restricted Sources [1874 B]
Get:13 http://archive.ubuntu.com trusty-updates/universe Sources [130 kB]
Get:14 http://archive.ubuntu.com trusty-updates/main amd64 Packages [557 kB]
Get:15 http://archive.ubuntu.com trusty-updates/restricted amd64
Packages [14.8 kB]
Get:16 http://archive.ubuntu.com trusty-updates/universe amd64 Packages [329 kB]
Get:17 http://archive.ubuntu.com trusty-security/main Sources [86.9 kB]
Get:18 http://archive.ubuntu.com trusty-security/restricted Sources [1874 B]
Get:19 http://archive.ubuntu.com trusty-security/universe Sources [19.6 kB]
Get:20 http://archive.ubuntu.com trusty-security/main amd64 Packages [269 kB]
Get:21 http://archive.ubuntu.com trusty-security/restricted amd64
Packages [14.8 kB]
Get:22 http://archive.ubuntu.com trusty-security/universe amd64
Packages [113 kB]
Fetched 20.5 MB in 14s (1461 kB/s)
Reading package lists... Done


root at ubuntu14:~# apt-get install openvswitch-switch
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
  libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
  openvswitch-common python python-minimal python2.7 python2.7-minimal
  uuid-runtime
Suggested packages:
  ca-certificates ethtool openvswitch-datapath-module python-doc python-tk
  python2.7-doc binutils binfmt-support
The following NEW packages will be installed:
  libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
  openvswitch-common openvswitch-switch python python-minimal python2.7
  python2.7-minimal uuid-runtime
0 upgraded, 11 newly installed, 0 to remove and 10 not upgraded.
Need to get 5543 kB of archives.
After this operation, 23.3 MB of additional disk space will be used.
Do you want to continue? [Y/n] Y
Get:1 http://archive.ubuntu.com/ubuntu/ trusty/main
libpython2.7-minimal amd64 2.7.6-8 [307 kB]
Get:2 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7-minimal
amd64 2.7.6-8 [1190 kB]
Get:3 http://archive.ubuntu.com/ubuntu/ trusty-updates/main openssl
amd64 1.0.1f-1ubuntu2.8 [489 kB]
Get:4 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
uuid-runtime amd64 2.20.1-5.1ubuntu20.3 [12.2 kB]
Get:5 http://archive.ubuntu.com/ubuntu/ trusty/main
libpython2.7-stdlib amd64 2.7.6-8 [1872 kB]
Get:6 http://archive.ubuntu.com/ubuntu/ trusty/main libpython-stdlib
amd64 2.7.5-5ubuntu3 [7012 B]
Get:7 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7 amd64
2.7.6-8 [197 kB]
Get:8 http://archive.ubuntu.com/ubuntu/ trusty/main python-minimal
amd64 2.7.5-5ubuntu3 [27.5 kB]
Get:9 http://archive.ubuntu.com/ubuntu/ trusty/main python amd64
2.7.5-5ubuntu3 [134 kB]
Get:10 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
openvswitch-common amd64 2.0.2-0ubuntu0.14.04.1 [444 kB]
Get:11 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
openvswitch-switch amd64 2.0.2-0ubuntu0.14.04.1 [863 kB]
Fetched 5543 kB in 5s (1083 kB/s)
Selecting previously unselected package libpython2.7-minimal:amd64.
(Reading database ... 11527 files and directories currently installed.)
Preparing to unpack .../libpython2.7-minimal_2.7.6-8_amd64.deb ...
Unpacking libpython2.7-minimal:amd64 (2.7.6-8) ...
Selecting previously unselected package python2.7-minimal.
Preparing to unpack .../python2.7-minimal_2.7.6-8_amd64.deb ...
Unpacking python2.7-minimal (2.7.6-8) ...
Selecting previously unselected package openssl.
Preparing to unpack .../openssl_1.0.1f-1ubuntu2.8_amd64.deb ...
Unpacking openssl (1.0.1f-1ubuntu2.8) ...
Selecting previously unselected package uuid-runtime.
Preparing to unpack .../uuid-runtime_2.20.1-5.1ubuntu20.3_amd64.deb ...
Unpacking uuid-runtime (2.20.1-5.1ubuntu20.3) ...
Selecting previously unselected package libpython2.7-stdlib:amd64.
Preparing to unpack .../libpython2.7-stdlib_2.7.6-8_amd64.deb ...
Unpacking libpython2.7-stdlib:amd64 (2.7.6-8) ...
Selecting previously unselected package libpython-stdlib:amd64.
Preparing to unpack .../libpython-stdlib_2.7.5-5ubuntu3_amd64.deb ...
Unpacking libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
Selecting previously unselected package python2.7.
Preparing to unpack .../python2.7_2.7.6-8_amd64.deb ...
Unpacking python2.7 (2.7.6-8) ...
Selecting previously unselected package python-minimal.
Preparing to unpack .../python-minimal_2.7.5-5ubuntu3_amd64.deb ...
Unpacking python-minimal (2.7.5-5ubuntu3) ...
Selecting previously unselected package python.
Preparing to unpack .../python_2.7.5-5ubuntu3_amd64.deb ...
Unpacking python (2.7.5-5ubuntu3) ...
Selecting previously unselected package openvswitch-common.
Preparing to unpack .../openvswitch-common_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
Unpacking openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
Selecting previously unselected package openvswitch-switch.
Preparing to unpack .../openvswitch-switch_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
Unpacking openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
Processing triggers for mime-support (3.54ubuntu1.1) ...
Processing triggers for ureadahead (0.100.0-16) ...
Setting up libpython2.7-minimal:amd64 (2.7.6-8) ...
Setting up python2.7-minimal (2.7.6-8) ...
Linking and byte-compiling packages for runtime python2.7...
Setting up openssl (1.0.1f-1ubuntu2.8) ...
Setting up uuid-runtime (2.20.1-5.1ubuntu20.3) ...
Setting up libpython2.7-stdlib:amd64 (2.7.6-8) ...
Setting up libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
Setting up python2.7 (2.7.6-8) ...
Setting up python-minimal (2.7.5-5ubuntu3) ...
Setting up python (2.7.5-5ubuntu3) ...
Setting up openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
Setting up openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
invoke-rc.d: policy-rc.d denied execution of start.
Processing triggers for ureadahead (0.100.0-16) ...

* Start OVS inside the container

root at ubuntu14:~# /etc/init.d/openvswitch-switch start
 * /etc/openvswitch/conf.db does not exist
 * Creating empty database /etc/openvswitch/conf.db
 * Starting ovsdb-server
 * Configuring Open vSwitch system IDs
 * Starting ovs-vswitchd
 * Enabling remote OVSDB managers
root at ubuntu14:~# ovs-vsctl show
76eb6660-c7ac-4dc1-8ee7-ebbfeee46175
    ovs_version: "2.0.2"
root at ubuntu14:~# ovs-vsctl add-br br0
root at ubuntu14:~# ovs-vsctl show
76eb6660-c7ac-4dc1-8ee7-ebbfeee46175
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
    ovs_version: "2.0.2"
root at ubuntu14:~#
root at ubuntu14:~# ip link show br0
807: br0: <BROADCAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN
mode DEFAULT group default
    link/ether 0a:e2:0e:ca:f3:47 brd ff:ff:ff:ff:ff:ff
root at ubuntu14:~#
root at ubuntu14:~#

* Exit the container and see whether "br0" is visible inside the host

root at ubuntu14:~# exit
logout
root at ubuntu14:~# ip link show br0
807: br0: <BROADCAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN
mode DEFAULT group default
    link/ether 0a:e2:0e:ca:f3:47 brd ff:ff:ff:ff:ff:ff
root at ubuntu14:~#

From shettyg at nicira.com  Tue Feb 17 12:57:17 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 17 Feb 2015 12:57:17 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
 <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
 <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>
 <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>
Message-ID: <CAHbON5o4pKWPG9K9ixH=g0JzVhosCjBKJfm_Pco21zcXQXZNmw@mail.gmail.com>

Let me make one guess. Are you running OVS daemons both inside a
container as wells as outside the container (and you are running the
container where it shared the pid and network space with the host?) If
you are doing it, you are stepping on each other's toes and it is
expected that bridge created by one ovs-vswitchd will be deleted by
bridge created by another ovs-vswitchd.

If you just want to create a OVS bridge inside a container, don't run
your container and ask it to share the host's network. Or the other
option is don't start OVS in the host.

On Tue, Feb 17, 2015 at 12:35 PM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> On Tue, Feb 17, 2015 at 11:58 AM, Abhishek Chanda
> <abhishek.lists at gmail.com> wrote:
>> Sorry for being vague.
>>
>> I am trying to run neutron in a container. A container runs neutron
>> and OVS in host mode.
> What do you mean when you say that a container runs OVS in host mode?
> Sorry for being fussy, but the above can mean different things and I
> don't want to guess. So instead of you trying to frame your problem,
> let me show how I can create OVS bridge inside a container.
>
>
> * Create a container
> root at ubuntu14:~# docker run -d  --pid=host --net=host ubuntu /bin/sh
> -c "while true; do echo hello world; sleep 1;
> done"6d5508adca20a4c60d9fb35c18e88170852ffe6b63775c27013188034b7a7393
>
> * Enter the container
> root at ubuntu14:~# docker-enter
> 6d5508adca20a4c60d9fb35c18e88170852ffe6b63775c27013188034b7a7393
>
> * Install OVS inside the container
> root at ubuntu14:~# apt-get update
> Ign http://archive.ubuntu.com trusty InRelease
> Ign http://archive.ubuntu.com trusty-updates InRelease
> Ign http://archive.ubuntu.com trusty-security InRelease
> Hit http://archive.ubuntu.com trusty Release.gpg
> Get:1 http://archive.ubuntu.com trusty-updates Release.gpg [933 B]
> Get:2 http://archive.ubuntu.com trusty-security Release.gpg [933 B]
> Hit http://archive.ubuntu.com trusty Release
> Get:3 http://archive.ubuntu.com trusty-updates Release [62.0 kB]
> Get:4 http://archive.ubuntu.com trusty-security Release [62.0 kB]
> Get:5 http://archive.ubuntu.com trusty/main Sources [1335 kB]
> Get:6 http://archive.ubuntu.com trusty/restricted Sources [5335 B]
> Get:7 http://archive.ubuntu.com trusty/universe Sources [7926 kB]
> Get:8 http://archive.ubuntu.com trusty/main amd64 Packages [1743 kB]
> Get:9 http://archive.ubuntu.com trusty/restricted amd64 Packages [16.0 kB]
> Get:10 http://archive.ubuntu.com trusty/universe amd64 Packages [7589 kB]
> Get:11 http://archive.ubuntu.com trusty-updates/main Sources [229 kB]
> Get:12 http://archive.ubuntu.com trusty-updates/restricted Sources [1874 B]
> Get:13 http://archive.ubuntu.com trusty-updates/universe Sources [130 kB]
> Get:14 http://archive.ubuntu.com trusty-updates/main amd64 Packages [557 kB]
> Get:15 http://archive.ubuntu.com trusty-updates/restricted amd64
> Packages [14.8 kB]
> Get:16 http://archive.ubuntu.com trusty-updates/universe amd64 Packages [329 kB]
> Get:17 http://archive.ubuntu.com trusty-security/main Sources [86.9 kB]
> Get:18 http://archive.ubuntu.com trusty-security/restricted Sources [1874 B]
> Get:19 http://archive.ubuntu.com trusty-security/universe Sources [19.6 kB]
> Get:20 http://archive.ubuntu.com trusty-security/main amd64 Packages [269 kB]
> Get:21 http://archive.ubuntu.com trusty-security/restricted amd64
> Packages [14.8 kB]
> Get:22 http://archive.ubuntu.com trusty-security/universe amd64
> Packages [113 kB]
> Fetched 20.5 MB in 14s (1461 kB/s)
> Reading package lists... Done
>
>
> root at ubuntu14:~# apt-get install openvswitch-switch
> Reading package lists... Done
> Building dependency tree
> Reading state information... Done
> The following extra packages will be installed:
>   libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
>   openvswitch-common python python-minimal python2.7 python2.7-minimal
>   uuid-runtime
> Suggested packages:
>   ca-certificates ethtool openvswitch-datapath-module python-doc python-tk
>   python2.7-doc binutils binfmt-support
> The following NEW packages will be installed:
>   libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
>   openvswitch-common openvswitch-switch python python-minimal python2.7
>   python2.7-minimal uuid-runtime
> 0 upgraded, 11 newly installed, 0 to remove and 10 not upgraded.
> Need to get 5543 kB of archives.
> After this operation, 23.3 MB of additional disk space will be used.
> Do you want to continue? [Y/n] Y
> Get:1 http://archive.ubuntu.com/ubuntu/ trusty/main
> libpython2.7-minimal amd64 2.7.6-8 [307 kB]
> Get:2 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7-minimal
> amd64 2.7.6-8 [1190 kB]
> Get:3 http://archive.ubuntu.com/ubuntu/ trusty-updates/main openssl
> amd64 1.0.1f-1ubuntu2.8 [489 kB]
> Get:4 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
> uuid-runtime amd64 2.20.1-5.1ubuntu20.3 [12.2 kB]
> Get:5 http://archive.ubuntu.com/ubuntu/ trusty/main
> libpython2.7-stdlib amd64 2.7.6-8 [1872 kB]
> Get:6 http://archive.ubuntu.com/ubuntu/ trusty/main libpython-stdlib
> amd64 2.7.5-5ubuntu3 [7012 B]
> Get:7 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7 amd64
> 2.7.6-8 [197 kB]
> Get:8 http://archive.ubuntu.com/ubuntu/ trusty/main python-minimal
> amd64 2.7.5-5ubuntu3 [27.5 kB]
> Get:9 http://archive.ubuntu.com/ubuntu/ trusty/main python amd64
> 2.7.5-5ubuntu3 [134 kB]
> Get:10 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
> openvswitch-common amd64 2.0.2-0ubuntu0.14.04.1 [444 kB]
> Get:11 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
> openvswitch-switch amd64 2.0.2-0ubuntu0.14.04.1 [863 kB]
> Fetched 5543 kB in 5s (1083 kB/s)
> Selecting previously unselected package libpython2.7-minimal:amd64.
> (Reading database ... 11527 files and directories currently installed.)
> Preparing to unpack .../libpython2.7-minimal_2.7.6-8_amd64.deb ...
> Unpacking libpython2.7-minimal:amd64 (2.7.6-8) ...
> Selecting previously unselected package python2.7-minimal.
> Preparing to unpack .../python2.7-minimal_2.7.6-8_amd64.deb ...
> Unpacking python2.7-minimal (2.7.6-8) ...
> Selecting previously unselected package openssl.
> Preparing to unpack .../openssl_1.0.1f-1ubuntu2.8_amd64.deb ...
> Unpacking openssl (1.0.1f-1ubuntu2.8) ...
> Selecting previously unselected package uuid-runtime.
> Preparing to unpack .../uuid-runtime_2.20.1-5.1ubuntu20.3_amd64.deb ...
> Unpacking uuid-runtime (2.20.1-5.1ubuntu20.3) ...
> Selecting previously unselected package libpython2.7-stdlib:amd64.
> Preparing to unpack .../libpython2.7-stdlib_2.7.6-8_amd64.deb ...
> Unpacking libpython2.7-stdlib:amd64 (2.7.6-8) ...
> Selecting previously unselected package libpython-stdlib:amd64.
> Preparing to unpack .../libpython-stdlib_2.7.5-5ubuntu3_amd64.deb ...
> Unpacking libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
> Selecting previously unselected package python2.7.
> Preparing to unpack .../python2.7_2.7.6-8_amd64.deb ...
> Unpacking python2.7 (2.7.6-8) ...
> Selecting previously unselected package python-minimal.
> Preparing to unpack .../python-minimal_2.7.5-5ubuntu3_amd64.deb ...
> Unpacking python-minimal (2.7.5-5ubuntu3) ...
> Selecting previously unselected package python.
> Preparing to unpack .../python_2.7.5-5ubuntu3_amd64.deb ...
> Unpacking python (2.7.5-5ubuntu3) ...
> Selecting previously unselected package openvswitch-common.
> Preparing to unpack .../openvswitch-common_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
> Unpacking openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
> Selecting previously unselected package openvswitch-switch.
> Preparing to unpack .../openvswitch-switch_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
> Unpacking openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
> Processing triggers for mime-support (3.54ubuntu1.1) ...
> Processing triggers for ureadahead (0.100.0-16) ...
> Setting up libpython2.7-minimal:amd64 (2.7.6-8) ...
> Setting up python2.7-minimal (2.7.6-8) ...
> Linking and byte-compiling packages for runtime python2.7...
> Setting up openssl (1.0.1f-1ubuntu2.8) ...
> Setting up uuid-runtime (2.20.1-5.1ubuntu20.3) ...
> Setting up libpython2.7-stdlib:amd64 (2.7.6-8) ...
> Setting up libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
> Setting up python2.7 (2.7.6-8) ...
> Setting up python-minimal (2.7.5-5ubuntu3) ...
> Setting up python (2.7.5-5ubuntu3) ...
> Setting up openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
> Setting up openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
> invoke-rc.d: policy-rc.d denied execution of start.
> Processing triggers for ureadahead (0.100.0-16) ...
>
> * Start OVS inside the container
>
> root at ubuntu14:~# /etc/init.d/openvswitch-switch start
>  * /etc/openvswitch/conf.db does not exist
>  * Creating empty database /etc/openvswitch/conf.db
>  * Starting ovsdb-server
>  * Configuring Open vSwitch system IDs
>  * Starting ovs-vswitchd
>  * Enabling remote OVSDB managers
> root at ubuntu14:~# ovs-vsctl show
> 76eb6660-c7ac-4dc1-8ee7-ebbfeee46175
>     ovs_version: "2.0.2"
> root at ubuntu14:~# ovs-vsctl add-br br0
> root at ubuntu14:~# ovs-vsctl show
> 76eb6660-c7ac-4dc1-8ee7-ebbfeee46175
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>     ovs_version: "2.0.2"
> root at ubuntu14:~#
> root at ubuntu14:~# ip link show br0
> 807: br0: <BROADCAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN
> mode DEFAULT group default
>     link/ether 0a:e2:0e:ca:f3:47 brd ff:ff:ff:ff:ff:ff
> root at ubuntu14:~#
> root at ubuntu14:~#
>
> * Exit the container and see whether "br0" is visible inside the host
>
> root at ubuntu14:~# exit
> logout
> root at ubuntu14:~# ip link show br0
> 807: br0: <BROADCAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN
> mode DEFAULT group default
>     link/ether 0a:e2:0e:ca:f3:47 brd ff:ff:ff:ff:ff:ff
> root at ubuntu14:~#

From abhishek.lists at gmail.com  Tue Feb 17 13:30:59 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Tue, 17 Feb 2015 13:30:59 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
 <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
 <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>
 <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>
Message-ID: <CACom5vrxRdUgnJz1ckEuN=SDLzj0uM0J42BS+j6VCc=FR1m-2w@mail.gmail.com>

I meant that there is a container which runs in host networking mode,
and it runs OVS server and neutron agents (the L3, DHCP and metadata
agents).

I attached to the container directly and I used bash instead of sh.
But it did not work on my setup, there were similar errors in vswitchd
logs as I posted in an earlier email. I did see a permission denied
while trying to set ulimit in the init script, even though it was
being run as root. The services started up fine.

cloudscaling at mngmt2:~/> docker run -it --pid=host --net=host ubuntu bash
root at mngmt2:/# apt-get update
Ign http://archive.ubuntu.com trusty InRelease
Ign http://archive.ubuntu.com trusty-updates InRelease
Ign http://archive.ubuntu.com trusty-security InRelease
Hit http://archive.ubuntu.com trusty Release.gpg
Get:1 http://archive.ubuntu.com trusty-updates Release.gpg [933 B]
Get:2 http://archive.ubuntu.com trusty-security Release.gpg [933 B]
Hit http://archive.ubuntu.com trusty Release
Get:3 http://archive.ubuntu.com trusty-updates Release [62.0 kB]
Get:4 http://archive.ubuntu.com trusty-security Release [62.0 kB]
Get:5 http://archive.ubuntu.com trusty/main Sources [1335 kB]
Get:6 http://archive.ubuntu.com trusty/restricted Sources [5335 B]
Get:7 http://archive.ubuntu.com trusty/universe Sources [7926 kB]
Get:8 http://archive.ubuntu.com trusty/main amd64 Packages [1743 kB]
Get:9 http://archive.ubuntu.com trusty/restricted amd64 Packages [16.0 kB]
Get:10 http://archive.ubuntu.com trusty/universe amd64 Packages [7589 kB]
Get:11 http://archive.ubuntu.com trusty-updates/main Sources [229 kB]
Get:12 http://archive.ubuntu.com trusty-updates/restricted Sources [1874 B]
Get:13 http://archive.ubuntu.com trusty-updates/universe Sources [130 kB]
Get:14 http://archive.ubuntu.com trusty-updates/main amd64 Packages [557 kB]
Get:15 http://archive.ubuntu.com trusty-updates/restricted amd64
Packages [14.8 kB]
Get:16 http://archive.ubuntu.com trusty-updates/universe amd64 Packages [329 kB]
Get:17 http://archive.ubuntu.com trusty-security/main Sources [86.9 kB]
Get:18 http://archive.ubuntu.com trusty-security/restricted Sources [1874 B]
Get:19 http://archive.ubuntu.com trusty-security/universe Sources [19.6 kB]
Get:20 http://archive.ubuntu.com trusty-security/main amd64 Packages [269 kB]
Get:21 http://archive.ubuntu.com trusty-security/restricted amd64
Packages [14.8 kB]
Get:22 http://archive.ubuntu.com trusty-security/universe amd64
Packages [113 kB]
Fetched 20.5 MB in 13s (1515 kB/s)
Reading package lists... Done
root at mngmt2:/# apt-get install openvswitch-switch
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
  libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
  openvswitch-common python python-minimal python2.7 python2.7-minimal
  uuid-runtime
Suggested packages:
  ca-certificates ethtool openvswitch-datapath-module python-doc python-tk
  python2.7-doc binutils binfmt-support
The following NEW packages will be installed:
  libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
  openvswitch-common openvswitch-switch python python-minimal python2.7
  python2.7-minimal uuid-runtime
0 upgraded, 11 newly installed, 0 to remove and 9 not upgraded.
Need to get 5543 kB of archives.
After this operation, 23.3 MB of additional disk space will be used.
Do you want to continue? [Y/n] Y
Get:1 http://archive.ubuntu.com/ubuntu/ trusty/main
libpython2.7-minimal amd64 2.7.6-8 [307 kB]
Get:2 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7-minimal
amd64 2.7.6-8 [1190 kB]
Get:3 http://archive.ubuntu.com/ubuntu/ trusty-updates/main openssl
amd64 1.0.1f-1ubuntu2.8 [489 kB]
Get:4 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
uuid-runtime amd64 2.20.1-5.1ubuntu20.3 [12.2 kB]
Get:5 http://archive.ubuntu.com/ubuntu/ trusty/main
libpython2.7-stdlib amd64 2.7.6-8 [1872 kB]
Get:6 http://archive.ubuntu.com/ubuntu/ trusty/main libpython-stdlib
amd64 2.7.5-5ubuntu3 [7012 B]
Get:7 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7 amd64
2.7.6-8 [197 kB]
Get:8 http://archive.ubuntu.com/ubuntu/ trusty/main python-minimal
amd64 2.7.5-5ubuntu3 [27.5 kB]
Get:9 http://archive.ubuntu.com/ubuntu/ trusty/main python amd64
2.7.5-5ubuntu3 [134 kB]
Get:10 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
openvswitch-common amd64 2.0.2-0ubuntu0.14.04.1 [444 kB]
Get:11 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
openvswitch-switch amd64 2.0.2-0ubuntu0.14.04.1 [863 kB]
Fetched 5543 kB in 4s (1141 kB/s)
Selecting previously unselected package libpython2.7-minimal:amd64.
(Reading database ... 11527 files and directories currently installed.)
Preparing to unpack .../libpython2.7-minimal_2.7.6-8_amd64.deb ...
Unpacking libpython2.7-minimal:amd64 (2.7.6-8) ...
Selecting previously unselected package python2.7-minimal.
Preparing to unpack .../python2.7-minimal_2.7.6-8_amd64.deb ...
Unpacking python2.7-minimal (2.7.6-8) ...
Selecting previously unselected package openssl.
Preparing to unpack .../openssl_1.0.1f-1ubuntu2.8_amd64.deb ...
Unpacking openssl (1.0.1f-1ubuntu2.8) ...
Selecting previously unselected package uuid-runtime.
Preparing to unpack .../uuid-runtime_2.20.1-5.1ubuntu20.3_amd64.deb ...
Unpacking uuid-runtime (2.20.1-5.1ubuntu20.3) ...
Selecting previously unselected package libpython2.7-stdlib:amd64.
Preparing to unpack .../libpython2.7-stdlib_2.7.6-8_amd64.deb ...
Unpacking libpython2.7-stdlib:amd64 (2.7.6-8) ...
Selecting previously unselected package libpython-stdlib:amd64.
Preparing to unpack .../libpython-stdlib_2.7.5-5ubuntu3_amd64.deb ...
Unpacking libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
Selecting previously unselected package python2.7.
Preparing to unpack .../python2.7_2.7.6-8_amd64.deb ...
Unpacking python2.7 (2.7.6-8) ...
Selecting previously unselected package python-minimal.
Preparing to unpack .../python-minimal_2.7.5-5ubuntu3_amd64.deb ...
Unpacking python-minimal (2.7.5-5ubuntu3) ...
Selecting previously unselected package python.
Preparing to unpack .../python_2.7.5-5ubuntu3_amd64.deb ...
Unpacking python (2.7.5-5ubuntu3) ...
Selecting previously unselected package openvswitch-common.
Preparing to unpack .../openvswitch-common_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
Unpacking openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
Selecting previously unselected package openvswitch-switch.
Preparing to unpack .../openvswitch-switch_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
Unpacking openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
Processing triggers for mime-support (3.54ubuntu1.1) ...
Processing triggers for ureadahead (0.100.0-16) ...
Setting up libpython2.7-minimal:amd64 (2.7.6-8) ...
Setting up python2.7-minimal (2.7.6-8) ...
Linking and byte-compiling packages for runtime python2.7...
Setting up openssl (1.0.1f-1ubuntu2.8) ...
Setting up uuid-runtime (2.20.1-5.1ubuntu20.3) ...
Setting up libpython2.7-stdlib:amd64 (2.7.6-8) ...
Setting up libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
Setting up python2.7 (2.7.6-8) ...
Setting up python-minimal (2.7.5-5ubuntu3) ...
Setting up python (2.7.5-5ubuntu3) ...
Setting up openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
Setting up openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
invoke-rc.d: policy-rc.d denied execution of start.
Processing triggers for ureadahead (0.100.0-16) ...
root at mngmt2:/# /etc/init.d/openvswitch-switch start
 * /etc/openvswitch/conf.db does not exist
 * Creating empty database /etc/openvswitch/conf.db
nice: cannot set niceness: Permission denied
 * Starting ovsdb-server
 * Configuring Open vSwitch system IDs
/usr/share/openvswitch/scripts/ovs-ctl: 232: ulimit: error setting
limit (Operation not permitted)
nice: cannot set niceness: Permission denied
 * Starting ovs-vswitchd
 * Enabling remote OVSDB managers
root at mngmt2:/# /etc/init.d/openvswitch-switch status
ovsdb-server is running with pid 18093
ovs-vswitchd is running with pid 18103
root at mngmt2:/# ovs-vsctl show
0e2931e7-d1d5-4681-8dcb-f0087a2f7aef
    ovs_version: "2.0.2"
root at mngmt2:/# ovs-vsctl add-br br0
root at mngmt2:/# ovs-vsctl show
0e2931e7-d1d5-4681-8dcb-f0087a2f7aef
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
    ovs_version: "2.0.2"
root at mngmt2:/# ip link show br0
Device "br0" does not exist.
root at mngmt2:/# exit
cloudscaling at mngmt2:~/> ip link show br0
Device "br0" does not exist.
cloudscaling at mngmt2:~/>

I wonder if this can be due to some oddity on my host.

Thanks

On Tue, Feb 17, 2015 at 12:35 PM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> On Tue, Feb 17, 2015 at 11:58 AM, Abhishek Chanda
> <abhishek.lists at gmail.com> wrote:
>> Sorry for being vague.
>>
>> I am trying to run neutron in a container. A container runs neutron
>> and OVS in host mode.
> What do you mean when you say that a container runs OVS in host mode?
> Sorry for being fussy, but the above can mean different things and I
> don't want to guess. So instead of you trying to frame your problem,
> let me show how I can create OVS bridge inside a container.
>
>
> * Create a container
> root at ubuntu14:~# docker run -d  --pid=host --net=host ubuntu /bin/sh
> -c "while true; do echo hello world; sleep 1;
> done"6d5508adca20a4c60d9fb35c18e88170852ffe6b63775c27013188034b7a7393
>
> * Enter the container
> root at ubuntu14:~# docker-enter
> 6d5508adca20a4c60d9fb35c18e88170852ffe6b63775c27013188034b7a7393
>
> * Install OVS inside the container
> root at ubuntu14:~# apt-get update
> Ign http://archive.ubuntu.com trusty InRelease
> Ign http://archive.ubuntu.com trusty-updates InRelease
> Ign http://archive.ubuntu.com trusty-security InRelease
> Hit http://archive.ubuntu.com trusty Release.gpg
> Get:1 http://archive.ubuntu.com trusty-updates Release.gpg [933 B]
> Get:2 http://archive.ubuntu.com trusty-security Release.gpg [933 B]
> Hit http://archive.ubuntu.com trusty Release
> Get:3 http://archive.ubuntu.com trusty-updates Release [62.0 kB]
> Get:4 http://archive.ubuntu.com trusty-security Release [62.0 kB]
> Get:5 http://archive.ubuntu.com trusty/main Sources [1335 kB]
> Get:6 http://archive.ubuntu.com trusty/restricted Sources [5335 B]
> Get:7 http://archive.ubuntu.com trusty/universe Sources [7926 kB]
> Get:8 http://archive.ubuntu.com trusty/main amd64 Packages [1743 kB]
> Get:9 http://archive.ubuntu.com trusty/restricted amd64 Packages [16.0 kB]
> Get:10 http://archive.ubuntu.com trusty/universe amd64 Packages [7589 kB]
> Get:11 http://archive.ubuntu.com trusty-updates/main Sources [229 kB]
> Get:12 http://archive.ubuntu.com trusty-updates/restricted Sources [1874 B]
> Get:13 http://archive.ubuntu.com trusty-updates/universe Sources [130 kB]
> Get:14 http://archive.ubuntu.com trusty-updates/main amd64 Packages [557 kB]
> Get:15 http://archive.ubuntu.com trusty-updates/restricted amd64
> Packages [14.8 kB]
> Get:16 http://archive.ubuntu.com trusty-updates/universe amd64 Packages [329 kB]
> Get:17 http://archive.ubuntu.com trusty-security/main Sources [86.9 kB]
> Get:18 http://archive.ubuntu.com trusty-security/restricted Sources [1874 B]
> Get:19 http://archive.ubuntu.com trusty-security/universe Sources [19.6 kB]
> Get:20 http://archive.ubuntu.com trusty-security/main amd64 Packages [269 kB]
> Get:21 http://archive.ubuntu.com trusty-security/restricted amd64
> Packages [14.8 kB]
> Get:22 http://archive.ubuntu.com trusty-security/universe amd64
> Packages [113 kB]
> Fetched 20.5 MB in 14s (1461 kB/s)
> Reading package lists... Done
>
>
> root at ubuntu14:~# apt-get install openvswitch-switch
> Reading package lists... Done
> Building dependency tree
> Reading state information... Done
> The following extra packages will be installed:
>   libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
>   openvswitch-common python python-minimal python2.7 python2.7-minimal
>   uuid-runtime
> Suggested packages:
>   ca-certificates ethtool openvswitch-datapath-module python-doc python-tk
>   python2.7-doc binutils binfmt-support
> The following NEW packages will be installed:
>   libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
>   openvswitch-common openvswitch-switch python python-minimal python2.7
>   python2.7-minimal uuid-runtime
> 0 upgraded, 11 newly installed, 0 to remove and 10 not upgraded.
> Need to get 5543 kB of archives.
> After this operation, 23.3 MB of additional disk space will be used.
> Do you want to continue? [Y/n] Y
> Get:1 http://archive.ubuntu.com/ubuntu/ trusty/main
> libpython2.7-minimal amd64 2.7.6-8 [307 kB]
> Get:2 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7-minimal
> amd64 2.7.6-8 [1190 kB]
> Get:3 http://archive.ubuntu.com/ubuntu/ trusty-updates/main openssl
> amd64 1.0.1f-1ubuntu2.8 [489 kB]
> Get:4 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
> uuid-runtime amd64 2.20.1-5.1ubuntu20.3 [12.2 kB]
> Get:5 http://archive.ubuntu.com/ubuntu/ trusty/main
> libpython2.7-stdlib amd64 2.7.6-8 [1872 kB]
> Get:6 http://archive.ubuntu.com/ubuntu/ trusty/main libpython-stdlib
> amd64 2.7.5-5ubuntu3 [7012 B]
> Get:7 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7 amd64
> 2.7.6-8 [197 kB]
> Get:8 http://archive.ubuntu.com/ubuntu/ trusty/main python-minimal
> amd64 2.7.5-5ubuntu3 [27.5 kB]
> Get:9 http://archive.ubuntu.com/ubuntu/ trusty/main python amd64
> 2.7.5-5ubuntu3 [134 kB]
> Get:10 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
> openvswitch-common amd64 2.0.2-0ubuntu0.14.04.1 [444 kB]
> Get:11 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
> openvswitch-switch amd64 2.0.2-0ubuntu0.14.04.1 [863 kB]
> Fetched 5543 kB in 5s (1083 kB/s)
> Selecting previously unselected package libpython2.7-minimal:amd64.
> (Reading database ... 11527 files and directories currently installed.)
> Preparing to unpack .../libpython2.7-minimal_2.7.6-8_amd64.deb ...
> Unpacking libpython2.7-minimal:amd64 (2.7.6-8) ...
> Selecting previously unselected package python2.7-minimal.
> Preparing to unpack .../python2.7-minimal_2.7.6-8_amd64.deb ...
> Unpacking python2.7-minimal (2.7.6-8) ...
> Selecting previously unselected package openssl.
> Preparing to unpack .../openssl_1.0.1f-1ubuntu2.8_amd64.deb ...
> Unpacking openssl (1.0.1f-1ubuntu2.8) ...
> Selecting previously unselected package uuid-runtime.
> Preparing to unpack .../uuid-runtime_2.20.1-5.1ubuntu20.3_amd64.deb ...
> Unpacking uuid-runtime (2.20.1-5.1ubuntu20.3) ...
> Selecting previously unselected package libpython2.7-stdlib:amd64.
> Preparing to unpack .../libpython2.7-stdlib_2.7.6-8_amd64.deb ...
> Unpacking libpython2.7-stdlib:amd64 (2.7.6-8) ...
> Selecting previously unselected package libpython-stdlib:amd64.
> Preparing to unpack .../libpython-stdlib_2.7.5-5ubuntu3_amd64.deb ...
> Unpacking libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
> Selecting previously unselected package python2.7.
> Preparing to unpack .../python2.7_2.7.6-8_amd64.deb ...
> Unpacking python2.7 (2.7.6-8) ...
> Selecting previously unselected package python-minimal.
> Preparing to unpack .../python-minimal_2.7.5-5ubuntu3_amd64.deb ...
> Unpacking python-minimal (2.7.5-5ubuntu3) ...
> Selecting previously unselected package python.
> Preparing to unpack .../python_2.7.5-5ubuntu3_amd64.deb ...
> Unpacking python (2.7.5-5ubuntu3) ...
> Selecting previously unselected package openvswitch-common.
> Preparing to unpack .../openvswitch-common_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
> Unpacking openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
> Selecting previously unselected package openvswitch-switch.
> Preparing to unpack .../openvswitch-switch_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
> Unpacking openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
> Processing triggers for mime-support (3.54ubuntu1.1) ...
> Processing triggers for ureadahead (0.100.0-16) ...
> Setting up libpython2.7-minimal:amd64 (2.7.6-8) ...
> Setting up python2.7-minimal (2.7.6-8) ...
> Linking and byte-compiling packages for runtime python2.7...
> Setting up openssl (1.0.1f-1ubuntu2.8) ...
> Setting up uuid-runtime (2.20.1-5.1ubuntu20.3) ...
> Setting up libpython2.7-stdlib:amd64 (2.7.6-8) ...
> Setting up libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
> Setting up python2.7 (2.7.6-8) ...
> Setting up python-minimal (2.7.5-5ubuntu3) ...
> Setting up python (2.7.5-5ubuntu3) ...
> Setting up openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
> Setting up openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
> invoke-rc.d: policy-rc.d denied execution of start.
> Processing triggers for ureadahead (0.100.0-16) ...
>
> * Start OVS inside the container
>
> root at ubuntu14:~# /etc/init.d/openvswitch-switch start
>  * /etc/openvswitch/conf.db does not exist
>  * Creating empty database /etc/openvswitch/conf.db
>  * Starting ovsdb-server
>  * Configuring Open vSwitch system IDs
>  * Starting ovs-vswitchd
>  * Enabling remote OVSDB managers
> root at ubuntu14:~# ovs-vsctl show
> 76eb6660-c7ac-4dc1-8ee7-ebbfeee46175
>     ovs_version: "2.0.2"
> root at ubuntu14:~# ovs-vsctl add-br br0
> root at ubuntu14:~# ovs-vsctl show
> 76eb6660-c7ac-4dc1-8ee7-ebbfeee46175
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>     ovs_version: "2.0.2"
> root at ubuntu14:~#
> root at ubuntu14:~# ip link show br0
> 807: br0: <BROADCAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN
> mode DEFAULT group default
>     link/ether 0a:e2:0e:ca:f3:47 brd ff:ff:ff:ff:ff:ff
> root at ubuntu14:~#
> root at ubuntu14:~#
>
> * Exit the container and see whether "br0" is visible inside the host
>
> root at ubuntu14:~# exit
> logout
> root at ubuntu14:~# ip link show br0
> 807: br0: <BROADCAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN
> mode DEFAULT group default
>     link/ether 0a:e2:0e:ca:f3:47 brd ff:ff:ff:ff:ff:ff
> root at ubuntu14:~#

From shettyg at nicira.com  Tue Feb 17 13:50:39 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 17 Feb 2015 13:50:39 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CACom5vrxRdUgnJz1ckEuN=SDLzj0uM0J42BS+j6VCc=FR1m-2w@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
 <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
 <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>
 <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>
 <CACom5vrxRdUgnJz1ckEuN=SDLzj0uM0J42BS+j6VCc=FR1m-2w@mail.gmail.com>
Message-ID: <CAHbON5rpO=k4RnpAKrKTMWi5bRorNnNQddagWgtmPDiCEuBykw@mail.gmail.com>

> root at mngmt2:/# /etc/init.d/openvswitch-switch start
>  * /etc/openvswitch/conf.db does not exist
>  * Creating empty database /etc/openvswitch/conf.db
> nice: cannot set niceness: Permission denied
>  * Starting ovsdb-server
>  * Configuring Open vSwitch system IDs
> /usr/share/openvswitch/scripts/ovs-ctl: 232: ulimit: error setting
> limit (Operation not permitted)
> nice: cannot set niceness: Permission denied
>  * Starting ovs-vswitchd
>  * Enabling remote OVSDB managers
There are some permission denied errors above. So I wonder
ovs-vswitchd does not have permissions to create a network device.
I am not very familiar with why you are getting the above errors even
thought you are running as "root". Does doing --cap-add NET_ADMIN
while running the container help? I would suggest that you look into
that. Once you figure out how to not get the above errors, please do
share on the list so that others can find it helpful.

From abhishek.lists at gmail.com  Tue Feb 17 13:59:39 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Tue, 17 Feb 2015 13:59:39 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CAHbON5rpO=k4RnpAKrKTMWi5bRorNnNQddagWgtmPDiCEuBykw@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
 <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
 <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>
 <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>
 <CACom5vrxRdUgnJz1ckEuN=SDLzj0uM0J42BS+j6VCc=FR1m-2w@mail.gmail.com>
 <CAHbON5rpO=k4RnpAKrKTMWi5bRorNnNQddagWgtmPDiCEuBykw@mail.gmail.com>
Message-ID: <CACom5vo=7Nq_=g8+1PGKCUXcWkU7VxOjcypOHP9pevYUwiOH8w@mail.gmail.com>

That error went away on running the container in priviledged mode,
NET_ADMIN capability did not seem to make a difference. In both cases,
the original issue is still present.

cloudscaling at mngmt2:~/dockstack> docker run -it --pid=host
--privileged --net=host ubuntu bash
root at mngmt2:/# apt-get update
Ign http://archive.ubuntu.com trusty InRelease
Ign http://archive.ubuntu.com trusty-updates InRelease
Ign http://archive.ubuntu.com trusty-security InRelease
Hit http://archive.ubuntu.com trusty Release.gpg
Get:1 http://archive.ubuntu.com trusty-updates Release.gpg [933 B]
Get:2 http://archive.ubuntu.com trusty-security Release.gpg [933 B]
Hit http://archive.ubuntu.com trusty Release
Get:3 http://archive.ubuntu.com trusty-updates Release [62.0 kB]
Get:4 http://archive.ubuntu.com trusty-security Release [62.0 kB]
Get:5 http://archive.ubuntu.com trusty/main Sources [1335 kB]
Get:6 http://archive.ubuntu.com trusty/restricted Sources [5335 B]
Get:7 http://archive.ubuntu.com trusty/universe Sources [7926 kB]
Get:8 http://archive.ubuntu.com trusty/main amd64 Packages [1743 kB]
Get:9 http://archive.ubuntu.com trusty/restricted amd64 Packages [16.0 kB]
Get:10 http://archive.ubuntu.com trusty/universe amd64 Packages [7589 kB]
Get:11 http://archive.ubuntu.com trusty-updates/main Sources [229 kB]
Get:12 http://archive.ubuntu.com trusty-updates/restricted Sources [1874 B]
Get:13 http://archive.ubuntu.com trusty-updates/universe Sources [130 kB]
Get:14 http://archive.ubuntu.com trusty-updates/main amd64 Packages [557 kB]
Get:15 http://archive.ubuntu.com trusty-updates/restricted amd64
Packages [14.8 kB]
Get:16 http://archive.ubuntu.com trusty-updates/universe amd64 Packages [329 kB]
Get:17 http://archive.ubuntu.com trusty-security/main Sources [86.9 kB]
Get:18 http://archive.ubuntu.com trusty-security/restricted Sources [1874 B]
Get:19 http://archive.ubuntu.com trusty-security/universe Sources [19.6 kB]
Get:20 http://archive.ubuntu.com trusty-security/main amd64 Packages [269 kB]
Get:21 http://archive.ubuntu.com trusty-security/restricted amd64
Packages [14.8 kB]
Get:22 http://archive.ubuntu.com trusty-security/universe amd64
Packages [113 kB]
Fetched 20.5 MB in 17s (1149 kB/s)
Reading package lists... Done
root at mngmt2:/# apt-get install openvswitch-switch
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following extra packages will be installed:
  libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
  openvswitch-common python python-minimal python2.7 python2.7-minimal
  uuid-runtime
Suggested packages:
  ca-certificates ethtool openvswitch-datapath-module python-doc python-tk
  python2.7-doc binutils binfmt-support
The following NEW packages will be installed:
  libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
  openvswitch-common openvswitch-switch python python-minimal python2.7
  python2.7-minimal uuid-runtime
0 upgraded, 11 newly installed, 0 to remove and 9 not upgraded.
Need to get 5543 kB of archives.
After this operation, 23.3 MB of additional disk space will be used.
Do you want to continue? [Y/n] Y
Get:1 http://archive.ubuntu.com/ubuntu/ trusty/main
libpython2.7-minimal amd64 2.7.6-8 [307 kB]
Get:2 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7-minimal
amd64 2.7.6-8 [1190 kB]
Get:3 http://archive.ubuntu.com/ubuntu/ trusty-updates/main openssl
amd64 1.0.1f-1ubuntu2.8 [489 kB]
Get:4 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
uuid-runtime amd64 2.20.1-5.1ubuntu20.3 [12.2 kB]
Get:5 http://archive.ubuntu.com/ubuntu/ trusty/main
libpython2.7-stdlib amd64 2.7.6-8 [1872 kB]
Get:6 http://archive.ubuntu.com/ubuntu/ trusty/main libpython-stdlib
amd64 2.7.5-5ubuntu3 [7012 B]
Get:7 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7 amd64
2.7.6-8 [197 kB]
Get:8 http://archive.ubuntu.com/ubuntu/ trusty/main python-minimal
amd64 2.7.5-5ubuntu3 [27.5 kB]
Get:9 http://archive.ubuntu.com/ubuntu/ trusty/main python amd64
2.7.5-5ubuntu3 [134 kB]
Get:10 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
openvswitch-common amd64 2.0.2-0ubuntu0.14.04.1 [444 kB]
Get:11 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
openvswitch-switch amd64 2.0.2-0ubuntu0.14.04.1 [863 kB]
Fetched 5543 kB in 8s (683 kB/s)
Selecting previously unselected package libpython2.7-minimal:amd64.
(Reading database ... 11527 files and directories currently installed.)
Preparing to unpack .../libpython2.7-minimal_2.7.6-8_amd64.deb ...
Unpacking libpython2.7-minimal:amd64 (2.7.6-8) ...
Selecting previously unselected package python2.7-minimal.
Preparing to unpack .../python2.7-minimal_2.7.6-8_amd64.deb ...
Unpacking python2.7-minimal (2.7.6-8) ...
Selecting previously unselected package openssl.
Preparing to unpack .../openssl_1.0.1f-1ubuntu2.8_amd64.deb ...
Unpacking openssl (1.0.1f-1ubuntu2.8) ...
Selecting previously unselected package uuid-runtime.
Preparing to unpack .../uuid-runtime_2.20.1-5.1ubuntu20.3_amd64.deb ...
Unpacking uuid-runtime (2.20.1-5.1ubuntu20.3) ...
Selecting previously unselected package libpython2.7-stdlib:amd64.
Preparing to unpack .../libpython2.7-stdlib_2.7.6-8_amd64.deb ...
Unpacking libpython2.7-stdlib:amd64 (2.7.6-8) ...
Selecting previously unselected package libpython-stdlib:amd64.
Preparing to unpack .../libpython-stdlib_2.7.5-5ubuntu3_amd64.deb ...
Unpacking libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
Selecting previously unselected package python2.7.
Preparing to unpack .../python2.7_2.7.6-8_amd64.deb ...
Unpacking python2.7 (2.7.6-8) ...
Selecting previously unselected package python-minimal.
Preparing to unpack .../python-minimal_2.7.5-5ubuntu3_amd64.deb ...
Unpacking python-minimal (2.7.5-5ubuntu3) ...
Selecting previously unselected package python.
Preparing to unpack .../python_2.7.5-5ubuntu3_amd64.deb ...
Unpacking python (2.7.5-5ubuntu3) ...
Selecting previously unselected package openvswitch-common.
Preparing to unpack .../openvswitch-common_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
Unpacking openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
Selecting previously unselected package openvswitch-switch.
Preparing to unpack .../openvswitch-switch_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
Unpacking openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
Processing triggers for mime-support (3.54ubuntu1.1) ...
Processing triggers for ureadahead (0.100.0-16) ...
Setting up libpython2.7-minimal:amd64 (2.7.6-8) ...
Setting up python2.7-minimal (2.7.6-8) ...
Linking and byte-compiling packages for runtime python2.7...
Setting up openssl (1.0.1f-1ubuntu2.8) ...
Setting up uuid-runtime (2.20.1-5.1ubuntu20.3) ...
Setting up libpython2.7-stdlib:amd64 (2.7.6-8) ...
Setting up libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
Setting up python2.7 (2.7.6-8) ...
Setting up python-minimal (2.7.5-5ubuntu3) ...
Setting up python (2.7.5-5ubuntu3) ...
Setting up openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
Setting up openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
invoke-rc.d: policy-rc.d denied execution of start.
Processing triggers for ureadahead (0.100.0-16) ...
root at mngmt2:/# /etc/init.d/openvswitch-switch status
ovsdb-server is not running
ovs-vswitchd is not running
root at mngmt2:/# /etc/init.d/openvswitch-switch start
 * /etc/openvswitch/conf.db does not exist
 * Creating empty database /etc/openvswitch/conf.db
 * Starting ovsdb-server
 * Configuring Open vSwitch system IDs
 * Starting ovs-vswitchd
 * Enabling remote OVSDB managers
root at mngmt2:/#
root at mngmt2:/#
root at mngmt2:/# /etc/init.d/openvswitch-switch status
ovsdb-server is running with pid 18931
ovs-vswitchd is running with pid 18941
root at mngmt2:/# ovs-vsctl show
8ce09967-d2da-4034-a052-07680bb1caf9
    ovs_version: "2.0.2"
root at mngmt2:/# ovs-vsctl add-br br0
root at mngmt2:/#
root at mngmt2:/#
root at mngmt2:/# ip link show br0
Device "br0" does not exist.
root at mngmt2:/# grep -rn br0 /var/log/openvswitch/ovs-vswitchd.log
6:2015-02-17T21:55:55.226Z|00006|bridge|INFO|bridge br0: added
interface br0 on port 0
7:2015-02-17T21:55:55.226Z|00007|netdev|WARN|failed to set flags for
network device br0: No such device
8:2015-02-17T21:55:55.226Z|00008|netdev_linux|WARN|br0: obtaining
netdev stats via vport failed (No such device)
9:2015-02-17T21:55:55.226Z|00009|netdev_linux|INFO|ioctl(SIOCGIFHWADDR)
on br0 device failed: No such device
10:2015-02-17T21:55:55.226Z|00010|netdev_linux|WARN|ioctl(SIOCGIFINDEX)
on br0 device failed: No such device
11:2015-02-17T21:55:55.240Z|00011|bridge|INFO|bridge br0: using
datapath ID 00001a263e067541
12:2015-02-17T21:55:55.240Z|00012|ofproto|WARN|br0: cannot set queues
on nonexistent port 0
13:2015-02-17T21:55:55.240Z|00013|netdev_linux|WARN|br0: removing
policing failed: No such device
14:2015-02-17T21:55:55.240Z|00014|ofproto|WARN|br0: cannot configure
bfd on nonexistent port 0
15:2015-02-17T21:55:55.240Z|00015|connmgr|INFO|br0: added service
controller "punix:/var/run/openvswitch/br0.mgmt"
16:2015-02-17T21:55:55.240Z|00016|ofproto|WARN|br0: cannot get STP
status on nonexistent port 0
17:2015-02-17T21:55:55.242Z|00017|ofproto|WARN|br0: cannot set queues
on nonexistent port 0
18:2015-02-17T21:55:55.242Z|00018|ofproto|WARN|br0: cannot configure
bfd on nonexistent port 0
19:2015-02-17T21:55:55.341Z|00019|ofproto|WARN|br0: cannot get STP
status on nonexistent port 0
20:2015-02-17T21:55:55.495Z|00020|ofproto|WARN|br0: cannot get STP
status on nonexistent port 0
21:2015-02-17T21:55:56.212Z|00021|ofproto|WARN|br0: cannot get STP
status on nonexistent port 0
22:2015-02-17T21:55:57.213Z|00022|ofproto|WARN|br0: cannot get STP
status on nonexistent port 0
root at mngmt2:/# ovs-vsctl show
8ce09967-d2da-4034-a052-07680bb1caf9
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
    ovs_version: "2.0.2"
root at mngmt2:/#

I will surely report back if I find anything useful. Thanks a lot for
looking into this.

Thanks

On Tue, Feb 17, 2015 at 1:50 PM, Gurucharan Shetty <shettyg at nicira.com> wrote:
>> root at mngmt2:/# /etc/init.d/openvswitch-switch start
>>  * /etc/openvswitch/conf.db does not exist
>>  * Creating empty database /etc/openvswitch/conf.db
>> nice: cannot set niceness: Permission denied
>>  * Starting ovsdb-server
>>  * Configuring Open vSwitch system IDs
>> /usr/share/openvswitch/scripts/ovs-ctl: 232: ulimit: error setting
>> limit (Operation not permitted)
>> nice: cannot set niceness: Permission denied
>>  * Starting ovs-vswitchd
>>  * Enabling remote OVSDB managers
> There are some permission denied errors above. So I wonder
> ovs-vswitchd does not have permissions to create a network device.
> I am not very familiar with why you are getting the above errors even
> thought you are running as "root". Does doing --cap-add NET_ADMIN
> while running the container help? I would suggest that you look into
> that. Once you figure out how to not get the above errors, please do
> share on the list so that others can find it helpful.

From shettyg at nicira.com  Tue Feb 17 14:12:55 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 17 Feb 2015 14:12:55 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CACom5vo=7Nq_=g8+1PGKCUXcWkU7VxOjcypOHP9pevYUwiOH8w@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
 <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
 <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>
 <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>
 <CACom5vrxRdUgnJz1ckEuN=SDLzj0uM0J42BS+j6VCc=FR1m-2w@mail.gmail.com>
 <CAHbON5rpO=k4RnpAKrKTMWi5bRorNnNQddagWgtmPDiCEuBykw@mail.gmail.com>
 <CACom5vo=7Nq_=g8+1PGKCUXcWkU7VxOjcypOHP9pevYUwiOH8w@mail.gmail.com>
Message-ID: <CAHbON5pt1S-LGq1Me44KFTbGDTkRQ2EPJU+jhAKiEWMZw+v6wQ@mail.gmail.com>

On Tue, Feb 17, 2015 at 1:59 PM, Abhishek Chanda
<abhishek.lists at gmail.com> wrote:
> That error went away on running the container in priviledged mode,
> NET_ADMIN capability did not seem to make a difference. In both cases,
> the original issue is still present.
>
> cloudscaling at mngmt2:~/dockstack> docker run -it --pid=host
> --privileged --net=host ubuntu bash

Does "cloudscaling" user have permission to create network device? Can
you create a non OVS network device from inside the container? Can you
login as a root user and try? I don't know what else is the problem
here.

From wliu43 at illinois.edu  Tue Feb 17 14:51:48 2015
From: wliu43 at illinois.edu (Liu, Weijie)
Date: Tue, 17 Feb 2015 22:51:48 +0000
Subject: [ovs-discuss] client transaction failed; time out error;
	OVSDB still empty
Message-ID: <4A68B2E57B0A3D4CABFC2180C088F9980115778F@CITESMBX1.ad.uillinois.edu>

Hi,

I tried to use the command bellow to send a transaction to the OVSDB:


# sudo ovsdb-client -v transact tcp:127.0.0.1:6640 '["Open_vSwitch",{"rows":[{"bridges":["set",[]]}],"until":"==","where":[["_uuid","==",["uuid","7b733b72-17f7-41c7-9f0a-641686db2dcd"]]],"timeout":0,"op":"wait","table":"Open_vSwitch","columns":["bridges"]},{"uuid-name":"row095f7ccc_ccb9_4c1e_94e8_b304deb6986f","op":"insert","table":"Port","row":{"interfaces":["named-uuid","row3886989c_5708_4eac_bfcb_329b2d5da01c"],"name":"br0"}},{"uuid-name":"row3886989c_5708_4eac_bfcb_329b2d5da01c","op":"insert","table":"Interface","row":{"name":"br0","type":"internal"}},{"uuid-name":"rowcd9eb1b9_090f_4a0e_bd08_bc57ade47441","op":"insert","table":"Bridge","row":{"name":"br0","ports":["named-uuid","row095f7ccc_ccb9_4c1e_94e8_b304deb6986f"]}},{"where":[["_uuid","==",["uuid","7b733b72-17f7-41c7-9f0a-641686db2dcd"]]],"op":"update","table":"Open_vSwitch","row":{"bridges":["named-uuid","rowcd9eb1b9_090f_4a0e_bd08_bc57ade47441"]}},{"mutations":[["next_cfg","+=",1]],"where":[["_uuid","==",["uuid","7b733b72-17f7-41c7-9f0a-641686db2dcd"]]],"op":"mutate","table":"Open_vSwitch"},{"where":[["_uuid","==",["uuid","7b733b72-17f7-41c7-9f0a-641686db2dcd"]]],"op":"select","table":"Open_vSwitch","columns":["next_cfg"]},{"comment":"ovs-vsctl: ovs-vsctl --verbose add-br br0","op":"comment"}]'


But it says:


# 2015-02-17T22:49:20Z|00003|jsonrpc|DBG|tcp:127.0.0.1:6640: received reply, result=[{"error":"timed out","details":"\"wait\" timed out after 101 ms"},null,null,null,null,null,null,null], id=0

[{"details":"\"wait\" timed out after 101 ms","error":"timed out"},null,null,null,null,null,null,null]

Any thoughts? I tried deleting the 'wait' operation and there is no such 'time out' error; but the OVSDB is still empty. Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150217/63af03e0/attachment-0001.html>

From blp at nicira.com  Tue Feb 17 15:02:21 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Feb 2015 15:02:21 -0800
Subject: [ovs-discuss] client transaction failed; time out error;
 OVSDB still empty
In-Reply-To: <4A68B2E57B0A3D4CABFC2180C088F9980115778F@CITESMBX1.ad.uillinois.edu>
References: <4A68B2E57B0A3D4CABFC2180C088F9980115778F@CITESMBX1.ad.uillinois.edu>
Message-ID: <20150217230221.GK25632@nicira.com>

On Tue, Feb 17, 2015 at 10:51:48PM +0000, Liu, Weijie wrote:
> I tried to use the command bellow to send a transaction to the OVSDB:
> 
> 
> # sudo ovsdb-client -v transact tcp:127.0.0.1:6640 '["Open_vSwitch",{"rows":[{"bridges":["set",[]]}],"until":"==","where":[["_uuid","==",["uuid","7b733b72-17f7-41c7-9f0a-641686db2dcd"]]],"timeout":0,"op":"wait","table":"Open_vSwitch","columns":["bridges"]},{"uuid-name":"row095f7ccc_ccb9_4c1e_94e8_b304deb6986f","op":"insert","table":"Port","row":{"interfaces":["named-uuid","row3886989c_5708_4eac_bfcb_329b2d5da01c"],"name":"br0"}},{"uuid-name":"row3886989c_5708_4eac_bfcb_329b2d5da01c","op":"insert","table":"Interface","row":{"name":"br0","type":"internal"}},{"uuid-name":"rowcd9eb1b9_090f_4a0e_bd08_bc57ade47441","op":"insert","table":"Bridge","row":{"name":"br0","ports":["named-uuid","row095f7ccc_ccb9_4c1e_94e8_b304deb6986f"]}},{"where":[["_uuid","==",["uuid","7b733b72-17f7-41c7-9f0a-641686db2dcd"]]],"op":"update","table":"Open_vSwitch","row":{"bridges":["named-uuid","rowcd9eb1b9_090f_4a0e_bd08_bc57ade47441"]}},{"mutations":[["next_cfg","+=",1]],"where":[["_uuid","==",["uuid","7b733b72-17f7-41c7-9f0a-641686db2dcd"]]],"op":"mutate","table":"Open_vSwitch"},{"where":[["_uuid","==",["uuid","7b733b72-17f7-41c7-9f0a-641686db2dcd"]]],"op":"select","table":"Open_vSwitch","columns":["next_cfg"]},{"comment":"ovs-vsctl: ovs-vsctl --verbose add-br br0","op":"comment"}]'
> 
> 
> But it says:
> 
> 
> # 2015-02-17T22:49:20Z|00003|jsonrpc|DBG|tcp:127.0.0.1:6640: received reply, result=[{"error":"timed out","details":"\"wait\" timed out after 101 ms"},null,null,null,null,null,null,null], id=0
> 
> [{"details":"\"wait\" timed out after 101 ms","error":"timed out"},null,null,null,null,null,null,null]
> 
> Any thoughts? I tried deleting the 'wait' operation and there is no such 'time out' error; but the OVSDB is still empty. Thanks.

This transaction will only do something useful if the database has the
contents that it did when ovs-vsctl generated it, in particular if the
Open_vSwitch table's row has UUID 7b733b72-17f7-41c7-9f0a-641686db2dcd.

From azhou at nicira.com  Tue Feb 17 15:24:30 2015
From: azhou at nicira.com (Andy Zhou)
Date: Tue, 17 Feb 2015 15:24:30 -0800
Subject: [ovs-discuss] Fwd:  OVS segfault in recirculation
In-Reply-To: <54E1C50B.90207@citrix.com>
References: <54DA2A50.4040201@citrix.com>
 <CACzMAJ+1w3XnKzuFKYtoLmfNmcCucjWQDFBv+yzeMo9OaWQScA@mail.gmail.com>
 <CACzMAJ+jAoLpdywerVPF3Xdk=cB+5xJaa+aMYiss7OsxGcQOYQ@mail.gmail.com>
 <54DDE66B.7010503@citrix.com>
 <CACzMAJLdTgd5L3tz=o+4SFA5fLaZ=KVYbqtLX63rR43+q8XLAA@mail.gmail.com>
 <54E1C50B.90207@citrix.com>
Message-ID: <CACzMAJKvbuKdrM-yFMi1E2OAeQWWiyKLoqjUuht2p-9qoPCOHQ@mail.gmail.com>

Thanks for the confirmation. I have pushed the fix to both master and
branch-2.3. Race conditions can some times hard to track down. Glad
this is not one of those painful experiences.

On Mon, Feb 16, 2015 at 2:23 AM, Salvatore Cambria
<salvatore.cambria at citrix.com> wrote:
> Hi Andy,
>
> I can tell you that this morning the test is still running without any
> segfault. The patch seems to fix the problem!
>
> Thanks for your help,
>
> Salvatore
>
>
>
> On 13/02/15 17:18, Andy Zhou wrote:
>>
>> Great! looking forward to the test results.
>>
>> On Fri, Feb 13, 2015 at 3:56 AM, Salvatore Cambria
>> <salvatore.cambria at citrix.com> wrote:
>>>
>>> Hi Andy,
>>>
>>> Yes, it makes a lot of sense!
>>>
>>> I applied the patch and I'm running my script again in order to test it.
>>> It
>>> looks good so far!
>>> I will leave the script running all across the weekend and I'll come back
>>> to
>>> you with my results on Monday.
>>>
>>> Thank you for your very fast response and for your effort,
>>>
>>> Salvatore
>>>
>>> On 13/02/15 02:10, Andy Zhou wrote:
>>>>
>>>> Does not mean to drop the list.
>>>>
>>>>
>>>> ---------- Forwarded message ----------
>>>> From: Andy Zhou <azhou at nicira.com>
>>>> Date: Thu, Feb 12, 2015 at 3:42 PM
>>>> Subject: Re: [ovs-discuss] OVS segfault in recirculation
>>>> To: Salvatore Cambria <salvatore.cambria at citrix.com>
>>>>
>>>>
>>>> Hi, Salvatore,
>>>>
>>>> I think I found a bug: hmap_remove needs to be protected by a lock. As
>>>> you pointed out, the output_normal() path is not properly protected.
>>>> Would you please
>>>> try the attached patch to see if it helps?
>>>>
>>>> Bond object is protected by reference counting.  Assuming reference
>>>> counter is valid, it should be O.K. for a bundle to hold on to the
>>>> object. Notice
>>>> bundle_destroy() calls unref_bond().  At any rate, I did not spot
>>>> anything obvious there.
>>>>
>>>> Thanks for providing such a detailed description. It is very helpful.
>>>>
>>>> Andy
>>>>
>>>> ================================
>>>>
>>>> iff --git a/ofproto/bond.c b/ofproto/bond.c
>>>> index c4b3a3a..a9b7a83 100644
>>>> --- a/ofproto/bond.c
>>>> +++ b/ofproto/bond.c
>>>> @@ -923,8 +923,8 @@ bond_may_recirc(const struct bond *bond, uint32_t
>>>> *recirc_id,
>>>>        }
>>>>    }
>>>>
>>>> -void
>>>> -bond_update_post_recirc_rules(struct bond* bond, const bool force)
>>>> +static void
>>>> +bond_update_post_recirc_rules__(struct bond* bond, const bool force)
>>>>    {
>>>>       struct bond_entry *e;
>>>>       bool update_rules = force;  /* Always update rules if caller
>>>> forces
>>>> it. */
>>>> @@ -945,6 +945,14 @@ bond_update_post_recirc_rules(struct bond* bond,
>>>> const bool force)
>>>>            update_recirc_rules(bond);
>>>>       }
>>>>    }
>>>> +
>>>> +void
>>>> +bond_update_post_recirc_rules(struct bond* bond, const bool force)
>>>> +{
>>>> +    ovs_rwlock_wrlock(&rwlock);
>>>> +    bond_update_post_recirc_rules__(bond, force);
>>>> +    ovs_rwlock_unlock(&rwlock);
>>>> +}
>>>>    ^L
>>>>    /* Rebalancing. */
>>>>
>>>> @@ -1203,7 +1211,7 @@ bond_rebalance(struct bond *bond)
>>>>        }
>>>>
>>>>        if (use_recirc && rebalanced) {
>>>> -        bond_update_post_recirc_rules(bond,true);
>>>> +        bond_update_post_recirc_rules__(bond,true);
>>>>        }
>>>>
>>>>    done:
>>>>
>>>>
>>>> On Tue, Feb 10, 2015 at 7:57 AM, Salvatore Cambria
>>>> <salvatore.cambria at citrix.com> wrote:
>>>>>
>>>>> Hello,
>>>>>
>>>>> I am a Software Engineer from Citrix, Cambridge UK office.
>>>>>
>>>>> We are having a problem when running our nightly test on a XenServer
>>>>> host
>>>>> with lacp bonds with OVS. Indeed, when deleting the bond the following
>>>>> segfault error appears (from GDB):
>>>>>
>>>>> Program terminated with signal 11, Segmentation fault.
>>>>>
>>>>> #0  0x0000000000411d2f in hmap_remove (node=0x7fd9d402e730,
>>>>> hmap=0x1c3e9e8)
>>>>>
>>>>>       at lib/hmap.h:236
>>>>>
>>>>> 236         while (*bucket != node) {
>>>>>
>>>>> (gdb) bt
>>>>>
>>>>> #0  0x0000000000411843 in hmap_remove (node=0x7fd9d402e730,
>>>>> hmap=0x1c3e9e8)
>>>>>
>>>>>       at lib/hmap.h:236
>>>>>
>>>>> #1  update_recirc_rules (bond=0x1c3e920) at ofproto/bond.c:382
>>>>>
>>>>> #2  0x0000000000001ff5 in ?? ()
>>>>>
>>>>> (gdb) p *hmap
>>>>>
>>>>> $1 = {buckets = 0x7fd9d4039b70, one = 0x0, mask = 255, n = 147}
>>>>>
>>>>> (gdb) p *node
>>>>>
>>>>> $2 = {hash = 2450845263, next = 0x0}
>>>>>
>>>>> (gdb) p *bucket
>>>>>
>>>>> Cannot access memory at address 0x8
>>>>>
>>>>> (gdb) p *(hmap->buckets)
>>>>>
>>>>> $3 = (struct hmap_node *) 0x0
>>>>>
>>>>> (gdb) p node->hash & hmap->mask
>>>>>
>>>>> $4 = 79
>>>>>
>>>>> (gdb) p *(&hmap->buckets[79])
>>>>>
>>>>> $5 = (struct hmap_node *) 0x0
>>>>>
>>>>> I managed to reproduce the error using a while loop in which I
>>>>> repeatedly
>>>>> create and destroy a lacp bond, waiting for 15 seconds after each of
>>>>> these
>>>>> operations.
>>>>>
>>>>> The error is not constant in timing and I think that it can be a race
>>>>> condition due to the recirculation process. It happens indeed that when
>>>>> calling hmap_remove() from update_recirc_rules() (in case of DEL), the
>>>>> bucket points to NULL. My idea is the following:
>>>>>
>>>>> hmap_remove() is called from two different places in ofproto/bond.c:
>>>>>
>>>>> 1. from update_recirc_rules() (in which it raises the segfault)
>>>>>
>>>>> hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>>>> *pr_op->pr_rule = NULL;
>>>>> free(pr_op);
>>>>>
>>>>> 2. and from bond_unref() (called when I try to delete the bond)
>>>>>
>>>>> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>>>>>       hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>>>>       free(pr_op);
>>>>> }
>>>>>
>>>>> Now, if these two calls happen at the same time, a conflict on the bond
>>>>> pr_rule may happen. Looking at the code I can see that the
>>>>> recirculation
>>>>> hmap_remove() is executed inside an external lock
>>>>> (ovs_rwlock_wrlock(&rwlock)) if called by bond_rebalance()
>>>>>
>>>>> void bond_rebalance(struct bond *bond) {
>>>>> ...
>>>>> ovs_rwlock_wrlock(&rwlock);
>>>>> ...
>>>>> ...
>>>>> if (use_recirc && rebalanced) {
>>>>>       bond_update_post_recirc_rules(bond,true); <---- hmap_remove()
>>>>> }
>>>>>
>>>>> done:
>>>>>       ovs_rwlock_unlock(&rwlock);
>>>>> }
>>>>>
>>>>> but I can't see any lock when called by output_normal()
>>>>>
>>>>> static void output_normal(struct xlate_ctx *ctx, const struct xbundle
>>>>> *out_xbundle, uint16_t vlan) {
>>>>> ...
>>>>> if (ctx->use_recirc) {
>>>>>       ...
>>>>>       bond_update_post_recirc_rules(out_xbundle->bond, false); <----
>>>>> hmap_remove()
>>>>>       ...
>>>>> }
>>>>> ...
>>>>>
>>>>> The same lock is used in bond_unref() but only for
>>>>> hmap_remove(all_bonds,
>>>>> &bond->hmap_node) and not for hmap_remove(&bond->pr_rule_ops,
>>>>> &pr_op->hmap_node).
>>>>>
>>>>> ...
>>>>> ovs_rwlock_wrlock(&rwlock);
>>>>> hmap_remove(all_bonds, &bond->hmap_node);
>>>>> ovs_rwlock_unlock(&rwlock);
>>>>> ...
>>>>> HMAP_FOR_EACH_SAFE(pr_op, next_op, hmap_node, &bond->pr_rule_ops) {
>>>>>       hmap_remove(&bond->pr_rule_ops, &pr_op->hmap_node);
>>>>>       free(pr_op);
>>>>> }
>>>>> ...
>>>>>
>>>>> I suppose that the goal is to remove any pointer to the bond, from
>>>>> all_bonds, inside the lock and to work on it locally. My doubt is: can
>>>>> the
>>>>> bond be still accessible from somewhere else (let's say from a bundle)?
>>>>> If
>>>>> yes, what happen if a bundle tries to access a bond which was
>>>>> previously
>>>>> removed from all_bonds (let's say from bundle_destroy())?
>>>>>
>>>>> The version of OVS that I am using is openvswitch-2.3.0-7.8312.x86_64.
>>>>>
>>>>> Could you please help me to find the problem?
>>>>>
>>>>>
>>>>> Thank you for the help & kind regards,
>>>>>
>>>>> Salvatore
>>>>>
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> discuss mailing list
>>>>> discuss at openvswitch.org
>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>
>

From atanu at acm.org  Tue Feb 17 16:59:37 2015
From: atanu at acm.org (Atanu Ghosh)
Date: Tue, 17 Feb 2015 16:59:37 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384 1385
 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404 1405
 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424 1425
 1426 1427 1428 failed
Message-ID: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>

Hi,

I have been trying to use OVS on FreeBSD 10.1. I have hit a number of
issues.

1) This simple command fails:
k3$ sudo ovs-vsctl add-br br0
ovs-vsctl: Error detected while setting up 'br0'.  See ovs-vswitchd log for
details.
 k3$ sudo ovs-vswitchd
2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
connecting...
2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
connected
2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.3.1
2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type system
2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type system
2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath br0 of
unknown type system
2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0: Address
family not supported by protocol family

2) I ran "make check" and hit a number of problems with ovsdb-server
interactions, which were due to set_dscp failing on FreeBSD. I have not
looked into how to make it work.

diff --git a/socket-util.c b/socket-util.c
index aa0c719..c17f0d9 100644
--- a/socket-util.c
+++ b/socket-util.c
@@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
     int val;
     bool success;

+    return 0;
+
     if (dscp > 63) {
         return EINVAL;
     }

3) I ran "make check" again and hit the problems on the subject line. I
looked at 1381 a little and it doesn't look like it even manages to contact
the server. I have attached the log file.

My python version:
k3$ python -V
Python 2.7.9

        Atanu.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150217/694aa8dd/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: testsuite.log
Type: application/octet-stream
Size: 276454 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150217/694aa8dd/attachment-0001.obj>

From chethu123 at gmail.com  Wed Feb 18 01:19:12 2015
From: chethu123 at gmail.com (Chethan C R)
Date: Wed, 18 Feb 2015 14:49:12 +0530
Subject: [ovs-discuss] Query regarding Bundle Commit and Rollback
Message-ID: <CAAnq3DhUWFVNAuVnQA2HzMGDEMB9BVdemsFr=rTQGZDOApL3OA@mail.gmail.com>

Hello,

I am currently investigating on the implementation of OF 1.4 bundles.

Per Spec, the implementation should be able to support at least port mod
and flow mod in any order.

However, its not clear about handling commands which will modify multiple
matching flows. For example, a flow mod with delete on OFPTT_ALL will
trigger a lot of churn in the openflow flow tables. To support rollback, we
need to be backing up a considerable amount of data.

When the switch has tables spread across SW and HW, keeping a staging area
where the bundle messages are applied may not be straight forward.

I am curious to know how the commit and rollback logic is handled and if
these scenarios are thought of.

Any pointers/suggestions will be of great help.

Thanks,
Chethan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150218/b37ab1ce/attachment.html>

From mittal.flora at gmail.com  Wed Feb 18 02:35:11 2015
From: mittal.flora at gmail.com (Flora Mittal)
Date: Wed, 18 Feb 2015 16:05:11 +0530
Subject: [ovs-discuss] Fwd:  ovs-vsctl Set Interface does not work
In-Reply-To: <BAY404-EAS2886D2476A9EDB679637CA2FE2F0@phx.gbl>
References: <BAY404-EAS2886D2476A9EDB679637CA2FE2F0@phx.gbl>
Message-ID: <CAP5z0CDrh-oowtFLGuqESv5m=ZdaLrOpp8fZsZE4fE-WCEa4ww@mail.gmail.com>

Hi All,

    We got ovs by "yum install openvswitch"

Thanks.

On Tue, Feb 17, 2015 at 9:55 PM, Monica Gawas <monica_gawas93 at hotmail.com>
wrote:

>  Please reply to the mail and say that we got ovs by
> "yum install openvswitch"
>
> Sent via Phone.
>
> Flora Mittal <mittal.flora at gmail.com> wrote:
>
>
> ---------- Forwarded message ----------
> From: *Ansis Atteka* <aatteka at nicira.com>
> Date: Tue, Feb 17, 2015 at 3:08 AM
> Subject: Re: [ovs-discuss] ovs-vsctl Set Interface does not work
> To: Flora Mittal <mittal.flora at gmail.com>
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
>
>
>  On Mon, Feb 16, 2015 at 2:44 AM, Flora Mittal <mittal.flora at gmail.com>
> wrote:
> > Hi All,
> > We are facing a problem in
> > ovs-vsctl set interface <interface> ofport_request=<no>
> >
> > The OutPut is as follows :
> >
> > [root at localhost student]# ovs-vsctl show
> > bded31da-c5ad-4d51-93bd-136c0fbdde43
> >     ovs_version: "1.4.2"
> >
> > [root at localhost student]# ovs-vsctl add-br br0
> >
> > [root at localhost student]# ovs-vsctl add-port br0 p1
> >
> > [root at localhost student]# ovs-vsctl show
> > bded31da-c5ad-4d51-93bd-136c0fbdde43
> >     Bridge "br0"
> >         Port "br0"
> >             Interface "br0"
> >                 type: internal
> >         Port "p1"
> >             Interface "p1"
> >     ovs_version: "1.4.2"
> >
> > [root at localhost student]# ovs-vsctl list interface
> > _uuid               : 6e0dcdc9-d48f-40c5-bc9b-243817acc48a
> > admin_state         : []
> > cfm_fault           : []
> > cfm_mpid            : []
> > cfm_remote_mpids    : []
> > duplex              : []
> > external_ids        : {}
> > ingress_policing_burst: 0
> > ingress_policing_rate: 0
> > lacp_current        : []
> > link_resets         : []
> > link_speed          : []
> > link_state          : []
> > mac                 : []
> > mtu                 : []
> > name                : "p1"
> > ofport              : -1
> > options             : {}
> > other_config        : {}
> > statistics          : {}
> > status              : {}
> > type                : ""
> >
> > _uuid               : 6dd7b916-574a-444e-867e-44150fff3a5f
> > name                : "br0"
> > type                : internal
> > ...<edited>more info for br0
> >
> > [root at localhost student]# ovs-vsctl set interface p1 ofport=11
> >
> > [root at localhost student]# ovs-vsctl list interface
> > _uuid               : 6e0dcdc9-d48f-40c5-bc9b-243817acc48a
> > admin_state         : []
> > cfm_fault           : []
> > cfm_mpid            : []
> > cfm_remote_mpids    : []
> > duplex              : []
> > external_ids        : {}
> > ingress_policing_burst: 0
> > ingress_policing_rate: 0
> > lacp_current        : []
> > link_resets         : []
> > link_speed          : []
> > link_state          : []
> > mac                 : []
> > mtu                 : []
> > name                : "p1"
> > ofport              : -1
> > options             : {}
> > other_config        : {}
> > statistics          : {}
> > status              : {}
> > type                : ""
> >
> > _uuid               : 6dd7b916-574a-444e-867e-44150fff3a5f
> > name                : "br0"
> > type                : internal
> > ...<edited>more info for br0
> >
> > [root at localhost student]# ovs-vsctl set interface p1 ofport_request=11
> > ovs-vsctl: Interface does not contain a column whose name matches
> > "ofport_request"
>
>  Such errors that indicate that column does not exist typically mean
> that you are running old Open vSwitch version that has old OVSDB
> schema definition.
>
> Try to upgrade to 1.10 or later OVS version to get the OVSDB schema
> that has ofport_request column.
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150218/a4e98d18/attachment.html>

From jayakeerthik82 at gmail.com  Wed Feb 18 01:55:33 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Wed, 18 Feb 2015 15:25:33 +0530
Subject: [ovs-discuss] BUG
Message-ID: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>

Hi,
I installed openvswitch and i could able to add port and connect it to vm
on KVM  only when the port created in the following way.
ovs-vsctl add-port br3 vport1 -- set interface vport1 type=internal.

is the correct way of creating port and connecting it the vm.

Also when i connect it the controller (ODL) . It shows many hosts which are
not really connected particular port i created.

Thanking you,
Jayakeerthi k
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150218/00be764c/attachment-0001.html>

From dean.smolic at ericsson.com  Wed Feb 18 02:11:35 2015
From: dean.smolic at ericsson.com (Dean Smolic)
Date: Wed, 18 Feb 2015 10:11:35 +0000
Subject: [ovs-discuss] OVS
Message-ID: <4F36C9C62B5CD24D910C80B00643387547CDB4EE@ESESSMB303.ericsson.se>

Hello,

I am wondering whether the tenant in a certain DC have permission to influence OVS behavior (i.e flow rules)
on the bridge connected to VM?

In other words can we define for different VNFs a different OVS working mode (normal or flow)?

Thanks,
/DEAN
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150218/a175c2dc/attachment-0001.html>

From blp at nicira.com  Wed Feb 18 08:06:48 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Feb 2015 08:06:48 -0800
Subject: [ovs-discuss] Query regarding Bundle Commit and Rollback
In-Reply-To: <CAAnq3DhUWFVNAuVnQA2HzMGDEMB9BVdemsFr=rTQGZDOApL3OA@mail.gmail.com>
References: <CAAnq3DhUWFVNAuVnQA2HzMGDEMB9BVdemsFr=rTQGZDOApL3OA@mail.gmail.com>
Message-ID: <20150218160648.GB25752@nicira.com>

On Wed, Feb 18, 2015 at 02:49:12PM +0530, Chethan C R wrote:
> I am currently investigating on the implementation of OF 1.4 bundles.
> 
> Per Spec, the implementation should be able to support at least port mod
> and flow mod in any order.
> 
> However, its not clear about handling commands which will modify multiple
> matching flows. For example, a flow mod with delete on OFPTT_ALL will
> trigger a lot of churn in the openflow flow tables. To support rollback, we
> need to be backing up a considerable amount of data.
> 
> When the switch has tables spread across SW and HW, keeping a staging area
> where the bundle messages are applied may not be straight forward.
> 
> I am curious to know how the commit and rollback logic is handled and if
> these scenarios are thought of.

The bundle requests aren't supported yet.  When they are, though, it's
pretty important to handle general-purpose rollback.  Jarno has done
some preliminary work on bundle support, so I'm bringing him into the
conversation to share his thoughts.

Hardware support isn't a priority because no one has ever contributed
support for a hardware platform.

From blp at nicira.com  Wed Feb 18 08:08:36 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Feb 2015 08:08:36 -0800
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
Message-ID: <20150218160836.GC25752@nicira.com>

On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k wrote:
> I installed openvswitch and i could able to add port and connect it to vm
> on KVM  only when the port created in the following way.
> ovs-vsctl add-port br3 vport1 -- set interface vport1 type=internal.
> 
> is the correct way of creating port and connecting it the vm.

No.  VM interfaces aren't "internal".

> Also when i connect it the controller (ODL) . It shows many hosts which are
> not really connected particular port i created.

It's hard to tell what you mean.

From blp at nicira.com  Wed Feb 18 08:12:37 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Feb 2015 08:12:37 -0800
Subject: [ovs-discuss] OVS
In-Reply-To: <4F36C9C62B5CD24D910C80B00643387547CDB4EE@ESESSMB303.ericsson.se>
References: <4F36C9C62B5CD24D910C80B00643387547CDB4EE@ESESSMB303.ericsson.se>
Message-ID: <20150218161237.GD25752@nicira.com>

On Wed, Feb 18, 2015 at 10:11:35AM +0000, Dean Smolic wrote:
> I am wondering whether the tenant in a certain DC have permission to
> influence OVS behavior (i.e flow rules) on the bridge connected to VM?

I think this would be an unusual configuration.  To implement this, you
would probably want to assign each tenant its own bridge and connect
that bridge to a central bridge over patch ports.

It would be more usual to have each of the tenants use the API to a
multi-tenant controller to influence behavior.

> In other words can we define for different VNFs a different OVS
> working mode (normal or flow)?

Sure, that's not a problem.

From blp at nicira.com  Wed Feb 18 08:21:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Feb 2015 08:21:52 -0800
Subject: [ovs-discuss] client transaction failed; time out error;
 OVSDB still empty
In-Reply-To: <4A68B2E57B0A3D4CABFC2180C088F998011579A3@CITESMBX1.ad.uillinois.edu>
References: <4A68B2E57B0A3D4CABFC2180C088F9980115778F@CITESMBX1.ad.uillinois.edu>
 <20150217230221.GK25632@nicira.com>
 <4A68B2E57B0A3D4CABFC2180C088F998011579A3@CITESMBX1.ad.uillinois.edu>
Message-ID: <20150218162152.GG25752@nicira.com>

On Wed, Feb 18, 2015 at 05:15:21AM +0000, Liu, Weijie wrote:
> Can I add a row that is filled by myself into a completely empty
> Open_vSwitch table?

You can add an operation to do that.  RFC 7047 explains the syntax.

From blp at nicira.com  Wed Feb 18 08:26:00 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Feb 2015 08:26:00 -0800
Subject: [ovs-discuss] Fwd:  ovs-vsctl Set Interface does not work
In-Reply-To: <CAP5z0CDrh-oowtFLGuqESv5m=ZdaLrOpp8fZsZE4fE-WCEa4ww@mail.gmail.com>
References: <BAY404-EAS2886D2476A9EDB679637CA2FE2F0@phx.gbl>
 <CAP5z0CDrh-oowtFLGuqESv5m=ZdaLrOpp8fZsZE4fE-WCEa4ww@mail.gmail.com>
Message-ID: <20150218162600.GH25752@nicira.com>

Regardless of how you got OVS, it's still too old.

On Wed, Feb 18, 2015 at 04:05:11PM +0530, Flora Mittal wrote:
> Hi All,
> 
>     We got ovs by "yum install openvswitch"
> 
> Thanks.
> 
> On Tue, Feb 17, 2015 at 9:55 PM, Monica Gawas <monica_gawas93 at hotmail.com>
> wrote:
> 
> >  Please reply to the mail and say that we got ovs by
> > "yum install openvswitch"
> >
> > Sent via Phone.
> >
> > Flora Mittal <mittal.flora at gmail.com> wrote:
> >
> >
> > ---------- Forwarded message ----------
> > From: *Ansis Atteka* <aatteka at nicira.com>
> > Date: Tue, Feb 17, 2015 at 3:08 AM
> > Subject: Re: [ovs-discuss] ovs-vsctl Set Interface does not work
> > To: Flora Mittal <mittal.flora at gmail.com>
> > Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
> >
> >
> >  On Mon, Feb 16, 2015 at 2:44 AM, Flora Mittal <mittal.flora at gmail.com>
> > wrote:
> > > Hi All,
> > > We are facing a problem in
> > > ovs-vsctl set interface <interface> ofport_request=<no>
> > >
> > > The OutPut is as follows :
> > >
> > > [root at localhost student]# ovs-vsctl show
> > > bded31da-c5ad-4d51-93bd-136c0fbdde43
> > >     ovs_version: "1.4.2"
> > >
> > > [root at localhost student]# ovs-vsctl add-br br0
> > >
> > > [root at localhost student]# ovs-vsctl add-port br0 p1
> > >
> > > [root at localhost student]# ovs-vsctl show
> > > bded31da-c5ad-4d51-93bd-136c0fbdde43
> > >     Bridge "br0"
> > >         Port "br0"
> > >             Interface "br0"
> > >                 type: internal
> > >         Port "p1"
> > >             Interface "p1"
> > >     ovs_version: "1.4.2"
> > >
> > > [root at localhost student]# ovs-vsctl list interface
> > > _uuid               : 6e0dcdc9-d48f-40c5-bc9b-243817acc48a
> > > admin_state         : []
> > > cfm_fault           : []
> > > cfm_mpid            : []
> > > cfm_remote_mpids    : []
> > > duplex              : []
> > > external_ids        : {}
> > > ingress_policing_burst: 0
> > > ingress_policing_rate: 0
> > > lacp_current        : []
> > > link_resets         : []
> > > link_speed          : []
> > > link_state          : []
> > > mac                 : []
> > > mtu                 : []
> > > name                : "p1"
> > > ofport              : -1
> > > options             : {}
> > > other_config        : {}
> > > statistics          : {}
> > > status              : {}
> > > type                : ""
> > >
> > > _uuid               : 6dd7b916-574a-444e-867e-44150fff3a5f
> > > name                : "br0"
> > > type                : internal
> > > ...<edited>more info for br0
> > >
> > > [root at localhost student]# ovs-vsctl set interface p1 ofport=11
> > >
> > > [root at localhost student]# ovs-vsctl list interface
> > > _uuid               : 6e0dcdc9-d48f-40c5-bc9b-243817acc48a
> > > admin_state         : []
> > > cfm_fault           : []
> > > cfm_mpid            : []
> > > cfm_remote_mpids    : []
> > > duplex              : []
> > > external_ids        : {}
> > > ingress_policing_burst: 0
> > > ingress_policing_rate: 0
> > > lacp_current        : []
> > > link_resets         : []
> > > link_speed          : []
> > > link_state          : []
> > > mac                 : []
> > > mtu                 : []
> > > name                : "p1"
> > > ofport              : -1
> > > options             : {}
> > > other_config        : {}
> > > statistics          : {}
> > > status              : {}
> > > type                : ""
> > >
> > > _uuid               : 6dd7b916-574a-444e-867e-44150fff3a5f
> > > name                : "br0"
> > > type                : internal
> > > ...<edited>more info for br0
> > >
> > > [root at localhost student]# ovs-vsctl set interface p1 ofport_request=11
> > > ovs-vsctl: Interface does not contain a column whose name matches
> > > "ofport_request"
> >
> >  Such errors that indicate that column does not exist typically mean
> > that you are running old Open vSwitch version that has old OVSDB
> > schema definition.
> >
> > Try to upgrade to 1.10 or later OVS version to get the OVSDB schema
> > that has ofport_request column.
> > >
> > >
> > > _______________________________________________
> > > discuss mailing list
> > > discuss at openvswitch.org
> > > http://openvswitch.org/mailman/listinfo/discuss
> > >
> >
> >

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Wed Feb 18 08:49:54 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Feb 2015 08:49:54 -0800
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
Message-ID: <20150218164954.GI25752@nicira.com>

Please don't drop the list.

KVM creates the interfaces, then you add them to a bridge.  Creating
internal interfaces isn't going to do what you want, because those
interfaces won't be used by the VM.

Did you read INSTALL.Libvirt.md?

On Wed, Feb 18, 2015 at 10:18:09PM +0530, jayakeerthi k wrote:
> Hi,
> then how to create the openvswitch interfaces to connect to the VM's. But
> it works fine with above method.
> i'm creating the vm with virt-manager(kvm-qemu) and when i give the
> specified shared name i could not able to create the vm. it says that
> unable to add vneto port on the bridge.
> 
> ovs-vsctl add-port br3 vport1--  port created this way is not shown in the
> available interfaces.
> please suggest any resources regarding this.
> 
> Thanking you,
> Jayakeerthi k
> 
> 
> 
> On Wed, Feb 18, 2015 at 9:38 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k wrote:
> > > I installed openvswitch and i could able to add port and connect it to vm
> > > on KVM  only when the port created in the following way.
> > > ovs-vsctl add-port br3 vport1 -- set interface vport1 type=internal.
> > >
> > > is the correct way of creating port and connecting it the vm.
> >
> > No.  VM interfaces aren't "internal".
> >
> > > Also when i connect it the controller (ODL) . It shows many hosts which
> > are
> > > not really connected particular port i created.
> >
> > It's hard to tell what you mean.
> >

From aryan.taherimonfared at uis.no  Wed Feb 18 08:40:35 2015
From: aryan.taherimonfared at uis.no (Aryan TaheriMonfared)
Date: Wed, 18 Feb 2015 17:40:35 +0100
Subject: [ovs-discuss] OVS
In-Reply-To: <b619a95f30f047dba0500e433507cdbc@EXCAS01.uis.no>
References: <4F36C9C62B5CD24D910C80B00643387547CDB4EE@ESESSMB303.ericsson.se>
 <b619a95f30f047dba0500e433507cdbc@EXCAS01.uis.no>
Message-ID: <54E4C083.3090901@uis.no>

On 02/18/2015 05:12 PM, Ben Pfaff wrote:
>> I am wondering whether the tenant in a certain DC have permission to
>> >influence OVS behavior (i.e flow rules) on the bridge connected to VM?
> I think this would be an unusual configuration.  To implement this, you
> would probably want to assign each tenant its own bridge and connect
> that bridge to a central bridge over patch ports.
>
> It would be more usual to have each of the tenants use the API to a
> multi-tenant controller to influence behavior.
>
I've implemented this case here: (on top of ODL and integrated with 
OpenStack)
http://www.ux.uis.no/~aryan/docs/dnb/programmable_vn.pdf
and briefly discussed pros and cons.

--Aryan

From blp at nicira.com  Wed Feb 18 09:15:19 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Feb 2015 09:15:19 -0800
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
Message-ID: <20150218171519.GJ25752@nicira.com>

Since you are using libvirt, please read INSTALL.Libvirt.md.

On Wed, Feb 18, 2015 at 10:43:54PM +0530, jayakeerthi k wrote:
> i'm following the steps in below link
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD
> .
> and i installed libvirt (sudo apt-get install libvirt-bin)
> how KVM creates the interfaces??
> 
> On Wed, Feb 18, 2015 at 10:19 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Please don't drop the list.
> >
> > KVM creates the interfaces, then you add them to a bridge.  Creating
> > internal interfaces isn't going to do what you want, because those
> > interfaces won't be used by the VM.
> >
> > Did you read INSTALL.Libvirt.md?
> >
> > On Wed, Feb 18, 2015 at 10:18:09PM +0530, jayakeerthi k wrote:
> > > Hi,
> > > then how to create the openvswitch interfaces to connect to the VM's. But
> > > it works fine with above method.
> > > i'm creating the vm with virt-manager(kvm-qemu) and when i give the
> > > specified shared name i could not able to create the vm. it says that
> > > unable to add vneto port on the bridge.
> > >
> > > ovs-vsctl add-port br3 vport1--  port created this way is not shown in
> > the
> > > available interfaces.
> > > please suggest any resources regarding this.
> > >
> > > Thanking you,
> > > Jayakeerthi k
> > >
> > >
> > >
> > > On Wed, Feb 18, 2015 at 9:38 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k wrote:
> > > > > I installed openvswitch and i could able to add port and connect it
> > to vm
> > > > > on KVM  only when the port created in the following way.
> > > > > ovs-vsctl add-port br3 vport1 -- set interface vport1 type=internal.
> > > > >
> > > > > is the correct way of creating port and connecting it the vm.
> > > >
> > > > No.  VM interfaces aren't "internal".
> > > >
> > > > > Also when i connect it the controller (ODL) . It shows many hosts
> > which
> > > > are
> > > > > not really connected particular port i created.
> > > >
> > > > It's hard to tell what you mean.
> > > >
> >

From prashant.upadhyaya at aricent.com  Wed Feb 18 09:28:39 2015
From: prashant.upadhyaya at aricent.com (Prashant Upadhyaya)
Date: Wed, 18 Feb 2015 17:28:39 +0000
Subject: [ovs-discuss] Regarding OVS2.4
Message-ID: <5f73853ad27c41b6b72faef195e6c214@GURMBXV02.AD.ARICENT.COM>

Hi,

Any expected timeline when OVS2.4 release will be published.... ?

Regards
-Prashant

"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150218/5520f0ff/attachment.html>

From blp at nicira.com  Wed Feb 18 09:29:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Feb 2015 09:29:42 -0800
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
Message-ID: <20150218172942.GK25752@nicira.com>

Do you have a specific question?

On Wed, Feb 18, 2015 at 10:57:49PM +0530, jayakeerthi k wrote:
> gone through that link it explain only how to install libvirt.
> it is not help full to resolve my issue.
> 
> 
> On Wed, Feb 18, 2015 at 10:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Since you are using libvirt, please read INSTALL.Libvirt.md.
> >
> > On Wed, Feb 18, 2015 at 10:43:54PM +0530, jayakeerthi k wrote:
> > > i'm following the steps in below link
> > >
> > http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD
> > > .
> > > and i installed libvirt (sudo apt-get install libvirt-bin)
> > > how KVM creates the interfaces??
> > >
> > > On Wed, Feb 18, 2015 at 10:19 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > Please don't drop the list.
> > > >
> > > > KVM creates the interfaces, then you add them to a bridge.  Creating
> > > > internal interfaces isn't going to do what you want, because those
> > > > interfaces won't be used by the VM.
> > > >
> > > > Did you read INSTALL.Libvirt.md?
> > > >
> > > > On Wed, Feb 18, 2015 at 10:18:09PM +0530, jayakeerthi k wrote:
> > > > > Hi,
> > > > > then how to create the openvswitch interfaces to connect to the
> > VM's. But
> > > > > it works fine with above method.
> > > > > i'm creating the vm with virt-manager(kvm-qemu) and when i give the
> > > > > specified shared name i could not able to create the vm. it says that
> > > > > unable to add vneto port on the bridge.
> > > > >
> > > > > ovs-vsctl add-port br3 vport1--  port created this way is not shown
> > in
> > > > the
> > > > > available interfaces.
> > > > > please suggest any resources regarding this.
> > > > >
> > > > > Thanking you,
> > > > > Jayakeerthi k
> > > > >
> > > > >
> > > > >
> > > > > On Wed, Feb 18, 2015 at 9:38 PM, Ben Pfaff <blp at nicira.com> wrote:
> > > > >
> > > > > > On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k wrote:
> > > > > > > I installed openvswitch and i could able to add port and connect
> > it
> > > > to vm
> > > > > > > on KVM  only when the port created in the following way.
> > > > > > > ovs-vsctl add-port br3 vport1 -- set interface vport1
> > type=internal.
> > > > > > >
> > > > > > > is the correct way of creating port and connecting it the vm.
> > > > > >
> > > > > > No.  VM interfaces aren't "internal".
> > > > > >
> > > > > > > Also when i connect it the controller (ODL) . It shows many hosts
> > > > which
> > > > > > are
> > > > > > > not really connected particular port i created.
> > > > > >
> > > > > > It's hard to tell what you mean.
> > > > > >
> > > >
> >

From scott.lowe at scottlowe.org  Wed Feb 18 09:40:51 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Wed, 18 Feb 2015 10:40:51 -0700
Subject: [ovs-discuss] Working with libvirt (was Re:  BUG)
In-Reply-To: <20150218172942.GK25752@nicira.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
Message-ID: <E05AD0AC-CFA3-4D41-AD9C-F7B9B8243414@scottlowe.org>

Jayakeerthi, at the risk of sounding self-serving, please have a look at
this URL:

<http://blog.scottlowe.org/tags/#Libvirt>

This will provide a list of articles I've written about Libvirt; pay
particular attention to the articles talking about Libvirt-OVS integration.
(Though, to be fair, the material in these posts closely mirrors what's
found in INSTALL.Libvirt.md.)

Also, it sounds like you might be a bit new to KVM, so you might find the
"Working with KVM Guests" article useful as well.

Good luck!


Ben Pfaff <blp at nicira.com> wrote:

> Do you have a specific question?
> 
> On Wed, Feb 18, 2015 at 10:57:49PM +0530, jayakeerthi k wrote:
>> gone through that link it explain only how to install libvirt. it is not help full to resolve my issue.
>> 
>> 
>> On Wed, Feb 18, 2015 at 10:45 PM, Ben Pfaff <blp at nicira.com> wrote:
>> 
>>> Since you are using libvirt, please read INSTALL.Libvirt.md.
>>> 
>>> On Wed, Feb 18, 2015 at 10:43:54PM +0530, jayakeerthi k wrote:
>>>> i'm following the steps in below link http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD
>>>> .
>>>> and i installed libvirt (sudo apt-get install libvirt-bin)
>>>> how KVM creates the interfaces??
>>>> 
>>>> On Wed, Feb 18, 2015 at 10:19 PM, Ben Pfaff <blp at nicira.com> wrote:
>>>> 
>>>>> Please don't drop the list.
>>>>> 
>>>>> KVM creates the interfaces, then you add them to a bridge.  Creating internal interfaces isn't going to do what you want, because those interfaces won't be used by the VM.
>>>>> 
>>>>> Did you read INSTALL.Libvirt.md?
>>>>> 
>>>>> On Wed, Feb 18, 2015 at 10:18:09PM +0530, jayakeerthi k wrote:
>>>>>> Hi,
>>>>>> then how to create the openvswitch interfaces to connect to the VM's. But it works fine with above method. i'm creating the vm with virt-manager(kvm-qemu) and when i give the specified shared name i could not able to create the vm. it says that unable to add vneto port on the bridge.
>>>>>> 
>>>>>> ovs-vsctl add-port br3 vport1--  port created this way is not shown in the available interfaces. please suggest any resources regarding this.
>>>>>> 
>>>>>> Thanking you,
>>>>>> Jayakeerthi k
>>>>>> 
>>>>>> 
>>>>>> 
>>>>>> On Wed, Feb 18, 2015 at 9:38 PM, Ben Pfaff <blp at nicira.com> wrote:
>>>>>> 
>>>>>>> On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k wrote:
>>>>>>>> I installed openvswitch and i could able to add port and connect it to vm on KVM  only when the port created in the following way. ovs-vsctl add-port br3 vport1 -- set interface vport1 type=internal. is the correct way of creating port and connecting it the vm.
>>>>>>> 
>>>>>>> No.  VM interfaces aren't "internal".
>>>>>>> 
>>>>>>>> Also when i connect it the controller (ODL) . It shows many hosts which are not really connected particular port i created.
>>>>>>> 
>>>>>>> It's hard to tell what you mean.



From shettyg at nicira.com  Wed Feb 18 10:09:13 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Wed, 18 Feb 2015 10:09:13 -0800
Subject: [ovs-discuss] Regarding OVS2.4
In-Reply-To: <5f73853ad27c41b6b72faef195e6c214@GURMBXV02.AD.ARICENT.COM>
References: <5f73853ad27c41b6b72faef195e6c214@GURMBXV02.AD.ARICENT.COM>
Message-ID: <CAHbON5qMDLLA1Ds2gfq4d7W6jAis=UvDU5Ex7q7DUQFGVX8tCQ@mail.gmail.com>

On Wed, Feb 18, 2015 at 9:28 AM, Prashant Upadhyaya
<prashant.upadhyaya at aricent.com> wrote:
> Hi,
>
>
>
> Any expected timeline when OVS2.4 release will be published…. ?
>From what I understand, there is an attempt to get conntrack
integration in OVS 2.4 for firewall capabilities. For this to happen
some code will have to get merged with upstream Linux kernel (code was
sent for preliminary feedback). So OVS 2.4 release date is dependent
on that.

From blp at nicira.com  Wed Feb 18 20:31:58 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Feb 2015 20:31:58 -0800
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
Message-ID: <20150219043158.GC20024@nicira.com>

I don't think you can.  KVM creates the port, OVS only handles
switching.

On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
> how to create port's in openvswitch that can be assigned to vm created with
> KVM?
> 
> On Wed, Feb 18, 2015 at 10:59 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Do you have a specific question?
> >
> > On Wed, Feb 18, 2015 at 10:57:49PM +0530, jayakeerthi k wrote:
> > > gone through that link it explain only how to install libvirt.
> > > it is not help full to resolve my issue.
> > >
> > >
> > > On Wed, Feb 18, 2015 at 10:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > Since you are using libvirt, please read INSTALL.Libvirt.md.
> > > >
> > > > On Wed, Feb 18, 2015 at 10:43:54PM +0530, jayakeerthi k wrote:
> > > > > i'm following the steps in below link
> > > > >
> > > >
> > http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD
> > > > > .
> > > > > and i installed libvirt (sudo apt-get install libvirt-bin)
> > > > > how KVM creates the interfaces??
> > > > >
> > > > > On Wed, Feb 18, 2015 at 10:19 PM, Ben Pfaff <blp at nicira.com> wrote:
> > > > >
> > > > > > Please don't drop the list.
> > > > > >
> > > > > > KVM creates the interfaces, then you add them to a bridge.
> > Creating
> > > > > > internal interfaces isn't going to do what you want, because those
> > > > > > interfaces won't be used by the VM.
> > > > > >
> > > > > > Did you read INSTALL.Libvirt.md?
> > > > > >
> > > > > > On Wed, Feb 18, 2015 at 10:18:09PM +0530, jayakeerthi k wrote:
> > > > > > > Hi,
> > > > > > > then how to create the openvswitch interfaces to connect to the
> > > > VM's. But
> > > > > > > it works fine with above method.
> > > > > > > i'm creating the vm with virt-manager(kvm-qemu) and when i give
> > the
> > > > > > > specified shared name i could not able to create the vm. it says
> > that
> > > > > > > unable to add vneto port on the bridge.
> > > > > > >
> > > > > > > ovs-vsctl add-port br3 vport1--  port created this way is not
> > shown
> > > > in
> > > > > > the
> > > > > > > available interfaces.
> > > > > > > please suggest any resources regarding this.
> > > > > > >
> > > > > > > Thanking you,
> > > > > > > Jayakeerthi k
> > > > > > >
> > > > > > >
> > > > > > >
> > > > > > > On Wed, Feb 18, 2015 at 9:38 PM, Ben Pfaff <blp at nicira.com>
> > wrote:
> > > > > > >
> > > > > > > > On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k wrote:
> > > > > > > > > I installed openvswitch and i could able to add port and
> > connect
> > > > it
> > > > > > to vm
> > > > > > > > > on KVM  only when the port created in the following way.
> > > > > > > > > ovs-vsctl add-port br3 vport1 -- set interface vport1
> > > > type=internal.
> > > > > > > > >
> > > > > > > > > is the correct way of creating port and connecting it the vm.
> > > > > > > >
> > > > > > > > No.  VM interfaces aren't "internal".
> > > > > > > >
> > > > > > > > > Also when i connect it the controller (ODL) . It shows many
> > hosts
> > > > > > which
> > > > > > > > are
> > > > > > > > > not really connected particular port i created.
> > > > > > > >
> > > > > > > > It's hard to tell what you mean.
> > > > > > > >
> > > > > >
> > > >
> >

From abhishek.lists at gmail.com  Wed Feb 18 23:47:39 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Wed, 18 Feb 2015 23:47:39 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CAHbON5o4pKWPG9K9ixH=g0JzVhosCjBKJfm_Pco21zcXQXZNmw@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
 <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
 <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>
 <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>
 <CAHbON5o4pKWPG9K9ixH=g0JzVhosCjBKJfm_Pco21zcXQXZNmw@mail.gmail.com>
Message-ID: <CACom5voC-9+KkyKMxQOxy07rgs=FOUzBavQSf+2-ahGLFTwWqQ@mail.gmail.com>

Sorry, I missed this one email.

This turned out to be the reason. Everything went fine when I stopped
the OVS instance on my host.
Thanks for looking into this.

Thanks

On Tue, Feb 17, 2015 at 12:57 PM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> Let me make one guess. Are you running OVS daemons both inside a
> container as wells as outside the container (and you are running the
> container where it shared the pid and network space with the host?) If
> you are doing it, you are stepping on each other's toes and it is
> expected that bridge created by one ovs-vswitchd will be deleted by
> bridge created by another ovs-vswitchd.
>
> If you just want to create a OVS bridge inside a container, don't run
> your container and ask it to share the host's network. Or the other
> option is don't start OVS in the host.
>
> On Tue, Feb 17, 2015 at 12:35 PM, Gurucharan Shetty <shettyg at nicira.com> wrote:
>> On Tue, Feb 17, 2015 at 11:58 AM, Abhishek Chanda
>> <abhishek.lists at gmail.com> wrote:
>>> Sorry for being vague.
>>>
>>> I am trying to run neutron in a container. A container runs neutron
>>> and OVS in host mode.
>> What do you mean when you say that a container runs OVS in host mode?
>> Sorry for being fussy, but the above can mean different things and I
>> don't want to guess. So instead of you trying to frame your problem,
>> let me show how I can create OVS bridge inside a container.
>>
>>
>> * Create a container
>> root at ubuntu14:~# docker run -d  --pid=host --net=host ubuntu /bin/sh
>> -c "while true; do echo hello world; sleep 1;
>> done"6d5508adca20a4c60d9fb35c18e88170852ffe6b63775c27013188034b7a7393
>>
>> * Enter the container
>> root at ubuntu14:~# docker-enter
>> 6d5508adca20a4c60d9fb35c18e88170852ffe6b63775c27013188034b7a7393
>>
>> * Install OVS inside the container
>> root at ubuntu14:~# apt-get update
>> Ign http://archive.ubuntu.com trusty InRelease
>> Ign http://archive.ubuntu.com trusty-updates InRelease
>> Ign http://archive.ubuntu.com trusty-security InRelease
>> Hit http://archive.ubuntu.com trusty Release.gpg
>> Get:1 http://archive.ubuntu.com trusty-updates Release.gpg [933 B]
>> Get:2 http://archive.ubuntu.com trusty-security Release.gpg [933 B]
>> Hit http://archive.ubuntu.com trusty Release
>> Get:3 http://archive.ubuntu.com trusty-updates Release [62.0 kB]
>> Get:4 http://archive.ubuntu.com trusty-security Release [62.0 kB]
>> Get:5 http://archive.ubuntu.com trusty/main Sources [1335 kB]
>> Get:6 http://archive.ubuntu.com trusty/restricted Sources [5335 B]
>> Get:7 http://archive.ubuntu.com trusty/universe Sources [7926 kB]
>> Get:8 http://archive.ubuntu.com trusty/main amd64 Packages [1743 kB]
>> Get:9 http://archive.ubuntu.com trusty/restricted amd64 Packages [16.0 kB]
>> Get:10 http://archive.ubuntu.com trusty/universe amd64 Packages [7589 kB]
>> Get:11 http://archive.ubuntu.com trusty-updates/main Sources [229 kB]
>> Get:12 http://archive.ubuntu.com trusty-updates/restricted Sources [1874 B]
>> Get:13 http://archive.ubuntu.com trusty-updates/universe Sources [130 kB]
>> Get:14 http://archive.ubuntu.com trusty-updates/main amd64 Packages [557 kB]
>> Get:15 http://archive.ubuntu.com trusty-updates/restricted amd64
>> Packages [14.8 kB]
>> Get:16 http://archive.ubuntu.com trusty-updates/universe amd64 Packages [329 kB]
>> Get:17 http://archive.ubuntu.com trusty-security/main Sources [86.9 kB]
>> Get:18 http://archive.ubuntu.com trusty-security/restricted Sources [1874 B]
>> Get:19 http://archive.ubuntu.com trusty-security/universe Sources [19.6 kB]
>> Get:20 http://archive.ubuntu.com trusty-security/main amd64 Packages [269 kB]
>> Get:21 http://archive.ubuntu.com trusty-security/restricted amd64
>> Packages [14.8 kB]
>> Get:22 http://archive.ubuntu.com trusty-security/universe amd64
>> Packages [113 kB]
>> Fetched 20.5 MB in 14s (1461 kB/s)
>> Reading package lists... Done
>>
>>
>> root at ubuntu14:~# apt-get install openvswitch-switch
>> Reading package lists... Done
>> Building dependency tree
>> Reading state information... Done
>> The following extra packages will be installed:
>>   libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
>>   openvswitch-common python python-minimal python2.7 python2.7-minimal
>>   uuid-runtime
>> Suggested packages:
>>   ca-certificates ethtool openvswitch-datapath-module python-doc python-tk
>>   python2.7-doc binutils binfmt-support
>> The following NEW packages will be installed:
>>   libpython-stdlib libpython2.7-minimal libpython2.7-stdlib openssl
>>   openvswitch-common openvswitch-switch python python-minimal python2.7
>>   python2.7-minimal uuid-runtime
>> 0 upgraded, 11 newly installed, 0 to remove and 10 not upgraded.
>> Need to get 5543 kB of archives.
>> After this operation, 23.3 MB of additional disk space will be used.
>> Do you want to continue? [Y/n] Y
>> Get:1 http://archive.ubuntu.com/ubuntu/ trusty/main
>> libpython2.7-minimal amd64 2.7.6-8 [307 kB]
>> Get:2 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7-minimal
>> amd64 2.7.6-8 [1190 kB]
>> Get:3 http://archive.ubuntu.com/ubuntu/ trusty-updates/main openssl
>> amd64 1.0.1f-1ubuntu2.8 [489 kB]
>> Get:4 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
>> uuid-runtime amd64 2.20.1-5.1ubuntu20.3 [12.2 kB]
>> Get:5 http://archive.ubuntu.com/ubuntu/ trusty/main
>> libpython2.7-stdlib amd64 2.7.6-8 [1872 kB]
>> Get:6 http://archive.ubuntu.com/ubuntu/ trusty/main libpython-stdlib
>> amd64 2.7.5-5ubuntu3 [7012 B]
>> Get:7 http://archive.ubuntu.com/ubuntu/ trusty/main python2.7 amd64
>> 2.7.6-8 [197 kB]
>> Get:8 http://archive.ubuntu.com/ubuntu/ trusty/main python-minimal
>> amd64 2.7.5-5ubuntu3 [27.5 kB]
>> Get:9 http://archive.ubuntu.com/ubuntu/ trusty/main python amd64
>> 2.7.5-5ubuntu3 [134 kB]
>> Get:10 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
>> openvswitch-common amd64 2.0.2-0ubuntu0.14.04.1 [444 kB]
>> Get:11 http://archive.ubuntu.com/ubuntu/ trusty-updates/main
>> openvswitch-switch amd64 2.0.2-0ubuntu0.14.04.1 [863 kB]
>> Fetched 5543 kB in 5s (1083 kB/s)
>> Selecting previously unselected package libpython2.7-minimal:amd64.
>> (Reading database ... 11527 files and directories currently installed.)
>> Preparing to unpack .../libpython2.7-minimal_2.7.6-8_amd64.deb ...
>> Unpacking libpython2.7-minimal:amd64 (2.7.6-8) ...
>> Selecting previously unselected package python2.7-minimal.
>> Preparing to unpack .../python2.7-minimal_2.7.6-8_amd64.deb ...
>> Unpacking python2.7-minimal (2.7.6-8) ...
>> Selecting previously unselected package openssl.
>> Preparing to unpack .../openssl_1.0.1f-1ubuntu2.8_amd64.deb ...
>> Unpacking openssl (1.0.1f-1ubuntu2.8) ...
>> Selecting previously unselected package uuid-runtime.
>> Preparing to unpack .../uuid-runtime_2.20.1-5.1ubuntu20.3_amd64.deb ...
>> Unpacking uuid-runtime (2.20.1-5.1ubuntu20.3) ...
>> Selecting previously unselected package libpython2.7-stdlib:amd64.
>> Preparing to unpack .../libpython2.7-stdlib_2.7.6-8_amd64.deb ...
>> Unpacking libpython2.7-stdlib:amd64 (2.7.6-8) ...
>> Selecting previously unselected package libpython-stdlib:amd64.
>> Preparing to unpack .../libpython-stdlib_2.7.5-5ubuntu3_amd64.deb ...
>> Unpacking libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
>> Selecting previously unselected package python2.7.
>> Preparing to unpack .../python2.7_2.7.6-8_amd64.deb ...
>> Unpacking python2.7 (2.7.6-8) ...
>> Selecting previously unselected package python-minimal.
>> Preparing to unpack .../python-minimal_2.7.5-5ubuntu3_amd64.deb ...
>> Unpacking python-minimal (2.7.5-5ubuntu3) ...
>> Selecting previously unselected package python.
>> Preparing to unpack .../python_2.7.5-5ubuntu3_amd64.deb ...
>> Unpacking python (2.7.5-5ubuntu3) ...
>> Selecting previously unselected package openvswitch-common.
>> Preparing to unpack .../openvswitch-common_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
>> Unpacking openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
>> Selecting previously unselected package openvswitch-switch.
>> Preparing to unpack .../openvswitch-switch_2.0.2-0ubuntu0.14.04.1_amd64.deb ...
>> Unpacking openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
>> Processing triggers for mime-support (3.54ubuntu1.1) ...
>> Processing triggers for ureadahead (0.100.0-16) ...
>> Setting up libpython2.7-minimal:amd64 (2.7.6-8) ...
>> Setting up python2.7-minimal (2.7.6-8) ...
>> Linking and byte-compiling packages for runtime python2.7...
>> Setting up openssl (1.0.1f-1ubuntu2.8) ...
>> Setting up uuid-runtime (2.20.1-5.1ubuntu20.3) ...
>> Setting up libpython2.7-stdlib:amd64 (2.7.6-8) ...
>> Setting up libpython-stdlib:amd64 (2.7.5-5ubuntu3) ...
>> Setting up python2.7 (2.7.6-8) ...
>> Setting up python-minimal (2.7.5-5ubuntu3) ...
>> Setting up python (2.7.5-5ubuntu3) ...
>> Setting up openvswitch-common (2.0.2-0ubuntu0.14.04.1) ...
>> Setting up openvswitch-switch (2.0.2-0ubuntu0.14.04.1) ...
>> invoke-rc.d: policy-rc.d denied execution of start.
>> Processing triggers for ureadahead (0.100.0-16) ...
>>
>> * Start OVS inside the container
>>
>> root at ubuntu14:~# /etc/init.d/openvswitch-switch start
>>  * /etc/openvswitch/conf.db does not exist
>>  * Creating empty database /etc/openvswitch/conf.db
>>  * Starting ovsdb-server
>>  * Configuring Open vSwitch system IDs
>>  * Starting ovs-vswitchd
>>  * Enabling remote OVSDB managers
>> root at ubuntu14:~# ovs-vsctl show
>> 76eb6660-c7ac-4dc1-8ee7-ebbfeee46175
>>     ovs_version: "2.0.2"
>> root at ubuntu14:~# ovs-vsctl add-br br0
>> root at ubuntu14:~# ovs-vsctl show
>> 76eb6660-c7ac-4dc1-8ee7-ebbfeee46175
>>     Bridge "br0"
>>         Port "br0"
>>             Interface "br0"
>>                 type: internal
>>     ovs_version: "2.0.2"
>> root at ubuntu14:~#
>> root at ubuntu14:~# ip link show br0
>> 807: br0: <BROADCAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN
>> mode DEFAULT group default
>>     link/ether 0a:e2:0e:ca:f3:47 brd ff:ff:ff:ff:ff:ff
>> root at ubuntu14:~#
>> root at ubuntu14:~#
>>
>> * Exit the container and see whether "br0" is visible inside the host
>>
>> root at ubuntu14:~# exit
>> logout
>> root at ubuntu14:~# ip link show br0
>> 807: br0: <BROADCAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN
>> mode DEFAULT group default
>>     link/ether 0a:e2:0e:ca:f3:47 brd ff:ff:ff:ff:ff:ff
>> root at ubuntu14:~#

From shettyg at nicira.com  Thu Feb 19 08:57:21 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 19 Feb 2015 08:57:21 -0800
Subject: [ovs-discuss] Problem while trying to add bridge in a container
In-Reply-To: <CACom5voC-9+KkyKMxQOxy07rgs=FOUzBavQSf+2-ahGLFTwWqQ@mail.gmail.com>
References: <CACom5vrXeiXktphZmbh1kVZcf3GkTDq85-eGLjWSyexzbyQRvw@mail.gmail.com>
 <CAHbON5qvhkAqrzo-m7g1LTaH3iA2=ZJNFoEm231XoVcwcgj+PQ@mail.gmail.com>
 <CACom5vp-gwg5wtCk1b=hkMYi=BML_G8csxpomrd-=-Asshi11Q@mail.gmail.com>
 <CAHbON5qz10k82Aoaf8oNQvBFvUawqm=EMtW_qvOB01dJ9omdOQ@mail.gmail.com>
 <CACom5voAosLQYS0TBtdsv_o3_o3Rxmwq0tupXhLNoAg1xEybEA@mail.gmail.com>
 <CAHbON5peBH15kCLCiDEA4z0To3tSTSX7ZuR+oH+pf4oQ6YMYvA@mail.gmail.com>
 <CACom5vpW2Nc6oxEqLo6VczTAFF1BMCKSo9H=bq6VsA+=2HtWJQ@mail.gmail.com>
 <CAHbON5qZpP9cK5OxVvEas-rrEqMQy60Fp=j9j0ZYKV_XqC5Epw@mail.gmail.com>
 <CAHbON5o4pKWPG9K9ixH=g0JzVhosCjBKJfm_Pco21zcXQXZNmw@mail.gmail.com>
 <CACom5voC-9+KkyKMxQOxy07rgs=FOUzBavQSf+2-ahGLFTwWqQ@mail.gmail.com>
Message-ID: <CAHbON5pnrzcGaPd2gh3qM1RcweGEvW_EU9sbHyrdizOQcUxnWg@mail.gmail.com>

On Wed, Feb 18, 2015 at 11:47 PM, Abhishek Chanda
<abhishek.lists at gmail.com> wrote:
> Sorry, I missed this one email.
>
> This turned out to be the reason. Everything went fine when I stopped
> the OVS instance on my host.
> Thanks for looking into this.
Thank you for posting back. I am glad that it worked out.

From apocalipse89 at gmail.com  Wed Feb 18 07:06:33 2015
From: apocalipse89 at gmail.com (Salvatore Mazzarino)
Date: Wed, 18 Feb 2015 16:06:33 +0100
Subject: [ovs-discuss] Connect two physical eth port on ubuntu
Message-ID: <F8C6CA86-C8D8-43DD-B4EA-9B479F2DA0E1@gmail.com>

I’m trying to connect to connect two physical interfaces to the bridge. The issues is the first one NIC get ip through dhcp while the second one get static ip

The following configuration should be the work

allow-ovs br0
iface br0 inet dhcp
    ovs_type OVSBridge
    ovs_ports eth0 eth1

allow-br0 eth0
iface eth0 inet manual
    ovs_bridge br0
    ovs_type OVSPort

allow-br0 eth1
iface eth1 inet manual
    ovs_bridge br0
    ovs_type OVSPort
but in my case doesn’t work because the first get ip address dynamically while the second not. Any solution or any sort of workaround?



From jayakeerthik82 at gmail.com  Wed Feb 18 09:13:54 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Wed, 18 Feb 2015 22:43:54 +0530
Subject: [ovs-discuss] BUG
In-Reply-To: <20150218164954.GI25752@nicira.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
Message-ID: <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>

i'm following the steps in below link
http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD
.
and i installed libvirt (sudo apt-get install libvirt-bin)
how KVM creates the interfaces??

On Wed, Feb 18, 2015 at 10:19 PM, Ben Pfaff <blp at nicira.com> wrote:

> Please don't drop the list.
>
> KVM creates the interfaces, then you add them to a bridge.  Creating
> internal interfaces isn't going to do what you want, because those
> interfaces won't be used by the VM.
>
> Did you read INSTALL.Libvirt.md?
>
> On Wed, Feb 18, 2015 at 10:18:09PM +0530, jayakeerthi k wrote:
> > Hi,
> > then how to create the openvswitch interfaces to connect to the VM's. But
> > it works fine with above method.
> > i'm creating the vm with virt-manager(kvm-qemu) and when i give the
> > specified shared name i could not able to create the vm. it says that
> > unable to add vneto port on the bridge.
> >
> > ovs-vsctl add-port br3 vport1--  port created this way is not shown in
> the
> > available interfaces.
> > please suggest any resources regarding this.
> >
> > Thanking you,
> > Jayakeerthi k
> >
> >
> >
> > On Wed, Feb 18, 2015 at 9:38 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k wrote:
> > > > I installed openvswitch and i could able to add port and connect it
> to vm
> > > > on KVM  only when the port created in the following way.
> > > > ovs-vsctl add-port br3 vport1 -- set interface vport1 type=internal.
> > > >
> > > > is the correct way of creating port and connecting it the vm.
> > >
> > > No.  VM interfaces aren't "internal".
> > >
> > > > Also when i connect it the controller (ODL) . It shows many hosts
> which
> > > are
> > > > not really connected particular port i created.
> > >
> > > It's hard to tell what you mean.
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150218/6841d8d4/attachment-0001.html>

From jayakeerthik82 at gmail.com  Wed Feb 18 09:27:49 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Wed, 18 Feb 2015 22:57:49 +0530
Subject: [ovs-discuss] BUG
In-Reply-To: <20150218171519.GJ25752@nicira.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
Message-ID: <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>

gone through that link it explain only how to install libvirt.
it is not help full to resolve my issue.


On Wed, Feb 18, 2015 at 10:45 PM, Ben Pfaff <blp at nicira.com> wrote:

> Since you are using libvirt, please read INSTALL.Libvirt.md.
>
> On Wed, Feb 18, 2015 at 10:43:54PM +0530, jayakeerthi k wrote:
> > i'm following the steps in below link
> >
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD
> > .
> > and i installed libvirt (sudo apt-get install libvirt-bin)
> > how KVM creates the interfaces??
> >
> > On Wed, Feb 18, 2015 at 10:19 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > Please don't drop the list.
> > >
> > > KVM creates the interfaces, then you add them to a bridge.  Creating
> > > internal interfaces isn't going to do what you want, because those
> > > interfaces won't be used by the VM.
> > >
> > > Did you read INSTALL.Libvirt.md?
> > >
> > > On Wed, Feb 18, 2015 at 10:18:09PM +0530, jayakeerthi k wrote:
> > > > Hi,
> > > > then how to create the openvswitch interfaces to connect to the
> VM's. But
> > > > it works fine with above method.
> > > > i'm creating the vm with virt-manager(kvm-qemu) and when i give the
> > > > specified shared name i could not able to create the vm. it says that
> > > > unable to add vneto port on the bridge.
> > > >
> > > > ovs-vsctl add-port br3 vport1--  port created this way is not shown
> in
> > > the
> > > > available interfaces.
> > > > please suggest any resources regarding this.
> > > >
> > > > Thanking you,
> > > > Jayakeerthi k
> > > >
> > > >
> > > >
> > > > On Wed, Feb 18, 2015 at 9:38 PM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k wrote:
> > > > > > I installed openvswitch and i could able to add port and connect
> it
> > > to vm
> > > > > > on KVM  only when the port created in the following way.
> > > > > > ovs-vsctl add-port br3 vport1 -- set interface vport1
> type=internal.
> > > > > >
> > > > > > is the correct way of creating port and connecting it the vm.
> > > > >
> > > > > No.  VM interfaces aren't "internal".
> > > > >
> > > > > > Also when i connect it the controller (ODL) . It shows many hosts
> > > which
> > > > > are
> > > > > > not really connected particular port i created.
> > > > >
> > > > > It's hard to tell what you mean.
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150218/bc7dd68c/attachment-0001.html>

From moradi at umich.edu  Wed Feb 18 14:12:42 2015
From: moradi at umich.edu (Mehrdad Moradi)
Date: Wed, 18 Feb 2015 17:12:42 -0500
Subject: [ovs-discuss] Meter Tables
Message-ID: <CAPEGEiFHoeZKNhMdfqASUauRmcEcb3Nt=jGkU58s-qJN4NNygg@mail.gmail.com>

Hello,

I am trying to use meters (rate-limiters) by adding them to flow entries. I
am using
the latest RYU and Mininet. However, it seems when the flow mods are
installed into
the tables, I get some errors similar to the following. Thus my question is
if this is OVS
limitation?

OFPErrorMsg(code=10,data='\x04\x1d\x00
\xf7\xcd@\x0e\x00\x00\x00\x01\x00\x00\x00\x02\x00\x01\x00\x10\x00\x00\x01\xf4\x00\x00\x00\x05\x00\x00\x00\x00',type=12)
type 0xc code 0xa 0x4 0x1d 0x0 0x20 0xf7 0xcd 0x40 0xe 0x0 0x0 0x0 0x1 0x0
0x0 0x0 0x2 0x0 0x1 0x0 0x10 0x0 0x0 0x1 0xf4 0x0 0x0 0x0 0x5 0x0 0x0 0x0 0



Best Regards,

---Mehrdad
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150218/c410ef4d/attachment-0001.html>

From jayakeerthik82 at gmail.com  Wed Feb 18 19:38:49 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Thu, 19 Feb 2015 09:08:49 +0530
Subject: [ovs-discuss] BUG
In-Reply-To: <20150218172942.GK25752@nicira.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
Message-ID: <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>

how to create port's in openvswitch that can be assigned to vm created with
KVM?

On Wed, Feb 18, 2015 at 10:59 PM, Ben Pfaff <blp at nicira.com> wrote:

> Do you have a specific question?
>
> On Wed, Feb 18, 2015 at 10:57:49PM +0530, jayakeerthi k wrote:
> > gone through that link it explain only how to install libvirt.
> > it is not help full to resolve my issue.
> >
> >
> > On Wed, Feb 18, 2015 at 10:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > Since you are using libvirt, please read INSTALL.Libvirt.md.
> > >
> > > On Wed, Feb 18, 2015 at 10:43:54PM +0530, jayakeerthi k wrote:
> > > > i'm following the steps in below link
> > > >
> > >
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD
> > > > .
> > > > and i installed libvirt (sudo apt-get install libvirt-bin)
> > > > how KVM creates the interfaces??
> > > >
> > > > On Wed, Feb 18, 2015 at 10:19 PM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > Please don't drop the list.
> > > > >
> > > > > KVM creates the interfaces, then you add them to a bridge.
> Creating
> > > > > internal interfaces isn't going to do what you want, because those
> > > > > interfaces won't be used by the VM.
> > > > >
> > > > > Did you read INSTALL.Libvirt.md?
> > > > >
> > > > > On Wed, Feb 18, 2015 at 10:18:09PM +0530, jayakeerthi k wrote:
> > > > > > Hi,
> > > > > > then how to create the openvswitch interfaces to connect to the
> > > VM's. But
> > > > > > it works fine with above method.
> > > > > > i'm creating the vm with virt-manager(kvm-qemu) and when i give
> the
> > > > > > specified shared name i could not able to create the vm. it says
> that
> > > > > > unable to add vneto port on the bridge.
> > > > > >
> > > > > > ovs-vsctl add-port br3 vport1--  port created this way is not
> shown
> > > in
> > > > > the
> > > > > > available interfaces.
> > > > > > please suggest any resources regarding this.
> > > > > >
> > > > > > Thanking you,
> > > > > > Jayakeerthi k
> > > > > >
> > > > > >
> > > > > >
> > > > > > On Wed, Feb 18, 2015 at 9:38 PM, Ben Pfaff <blp at nicira.com>
> wrote:
> > > > > >
> > > > > > > On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k wrote:
> > > > > > > > I installed openvswitch and i could able to add port and
> connect
> > > it
> > > > > to vm
> > > > > > > > on KVM  only when the port created in the following way.
> > > > > > > > ovs-vsctl add-port br3 vport1 -- set interface vport1
> > > type=internal.
> > > > > > > >
> > > > > > > > is the correct way of creating port and connecting it the vm.
> > > > > > >
> > > > > > > No.  VM interfaces aren't "internal".
> > > > > > >
> > > > > > > > Also when i connect it the controller (ODL) . It shows many
> hosts
> > > > > which
> > > > > > > are
> > > > > > > > not really connected particular port i created.
> > > > > > >
> > > > > > > It's hard to tell what you mean.
> > > > > > >
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150219/e2596841/attachment-0001.html>

From jayakeerthik82 at gmail.com  Wed Feb 18 20:47:51 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Thu, 19 Feb 2015 10:17:51 +0530
Subject: [ovs-discuss] BUG
In-Reply-To: <20150219043158.GC20024@nicira.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
Message-ID: <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>

OK..
when i try to create vm i'm gettting error unable to add vnet0 port on the
bridge br3.

On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com> wrote:

> I don't think you can.  KVM creates the port, OVS only handles
> switching.
>
> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
> > how to create port's in openvswitch that can be assigned to vm created
> with
> > KVM?
> >
> > On Wed, Feb 18, 2015 at 10:59 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > Do you have a specific question?
> > >
> > > On Wed, Feb 18, 2015 at 10:57:49PM +0530, jayakeerthi k wrote:
> > > > gone through that link it explain only how to install libvirt.
> > > > it is not help full to resolve my issue.
> > > >
> > > >
> > > > On Wed, Feb 18, 2015 at 10:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > Since you are using libvirt, please read INSTALL.Libvirt.md.
> > > > >
> > > > > On Wed, Feb 18, 2015 at 10:43:54PM +0530, jayakeerthi k wrote:
> > > > > > i'm following the steps in below link
> > > > > >
> > > > >
> > >
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.KVM;hb=HEAD
> > > > > > .
> > > > > > and i installed libvirt (sudo apt-get install libvirt-bin)
> > > > > > how KVM creates the interfaces??
> > > > > >
> > > > > > On Wed, Feb 18, 2015 at 10:19 PM, Ben Pfaff <blp at nicira.com>
> wrote:
> > > > > >
> > > > > > > Please don't drop the list.
> > > > > > >
> > > > > > > KVM creates the interfaces, then you add them to a bridge.
> > > Creating
> > > > > > > internal interfaces isn't going to do what you want, because
> those
> > > > > > > interfaces won't be used by the VM.
> > > > > > >
> > > > > > > Did you read INSTALL.Libvirt.md?
> > > > > > >
> > > > > > > On Wed, Feb 18, 2015 at 10:18:09PM +0530, jayakeerthi k wrote:
> > > > > > > > Hi,
> > > > > > > > then how to create the openvswitch interfaces to connect to
> the
> > > > > VM's. But
> > > > > > > > it works fine with above method.
> > > > > > > > i'm creating the vm with virt-manager(kvm-qemu) and when i
> give
> > > the
> > > > > > > > specified shared name i could not able to create the vm. it
> says
> > > that
> > > > > > > > unable to add vneto port on the bridge.
> > > > > > > >
> > > > > > > > ovs-vsctl add-port br3 vport1--  port created this way is not
> > > shown
> > > > > in
> > > > > > > the
> > > > > > > > available interfaces.
> > > > > > > > please suggest any resources regarding this.
> > > > > > > >
> > > > > > > > Thanking you,
> > > > > > > > Jayakeerthi k
> > > > > > > >
> > > > > > > >
> > > > > > > >
> > > > > > > > On Wed, Feb 18, 2015 at 9:38 PM, Ben Pfaff <blp at nicira.com>
> > > wrote:
> > > > > > > >
> > > > > > > > > On Wed, Feb 18, 2015 at 03:25:33PM +0530, jayakeerthi k
> wrote:
> > > > > > > > > > I installed openvswitch and i could able to add port and
> > > connect
> > > > > it
> > > > > > > to vm
> > > > > > > > > > on KVM  only when the port created in the following way.
> > > > > > > > > > ovs-vsctl add-port br3 vport1 -- set interface vport1
> > > > > type=internal.
> > > > > > > > > >
> > > > > > > > > > is the correct way of creating port and connecting it
> the vm.
> > > > > > > > >
> > > > > > > > > No.  VM interfaces aren't "internal".
> > > > > > > > >
> > > > > > > > > > Also when i connect it the controller (ODL) . It shows
> many
> > > hosts
> > > > > > > which
> > > > > > > > > are
> > > > > > > > > > not really connected particular port i created.
> > > > > > > > >
> > > > > > > > > It's hard to tell what you mean.
> > > > > > > > >
> > > > > > >
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150219/3c3ee285/attachment.html>

From goharirfan94 at gmail.com  Wed Feb 18 08:09:57 2015
From: goharirfan94 at gmail.com (Gohar Irfan)
Date: Wed, 18 Feb 2015 21:09:57 +0500
Subject: [ovs-discuss] Query
Message-ID: <CAPe5K8jBYUkX7e9ev3yDQ3+-AmVW_LaV96oqnnfqJLwikKdbvA@mail.gmail.com>

Hi,

We are a group of students from Pakistan and are working on a research
project. We would like to know if Open vSwitch supports changing
(dynamically) the buffer/queue sizes of the switch?
If so, could you please refer to a suitable resource that guides how to go
about it?

Regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150218/a11f8c5c/attachment.html>

From shettyg at nicira.com  Thu Feb 19 09:09:41 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 19 Feb 2015 09:09:41 -0800
Subject: [ovs-discuss] Connect two physical eth port on ubuntu
In-Reply-To: <F8C6CA86-C8D8-43DD-B4EA-9B479F2DA0E1@gmail.com>
References: <F8C6CA86-C8D8-43DD-B4EA-9B479F2DA0E1@gmail.com>
Message-ID: <CAHbON5qFHJ5Q0CzL-+vi2qEC-qfj2ArMWB4fqonrqjcTP4vpFw@mail.gmail.com>

On Wed, Feb 18, 2015 at 7:06 AM, Salvatore Mazzarino
<apocalipse89 at gmail.com> wrote:
> I’m trying to connect to connect two physical interfaces to the bridge.
This is generally a bad idea. Are you sure you want to connect 2
physical NICs to the same OVS bridge? Doing this usually creates
network loops. What you usually do is create a bridge for each NIC.


>The issues is the first one NIC get ip through dhcp while the second one get static ip
In the OVS world, we apply IP address to the bridge and not to the
physical NIC. Since you are connecting 2 physical NICs to the same
bridge, you can only apply one IP address




>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From scott.lowe at scottlowe.org  Thu Feb 19 09:17:23 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Thu, 19 Feb 2015 10:17:23 -0700
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
Message-ID: <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>

Please see my responses inline, prefixed by [SL].

jayakeerthi k <jayakeerthik82 at gmail.com> wrote:

> OK..
> 
> when i try to create vm i'm gettting error unable to add vnet0 port on the
> bridge br3.

[SL] Jayakeerthi, can you share the following information to help us help
you?

- The network portion of the domain XML configuration for your VM (obtained
via 'virsh dumpxml <vm-name>'

- The versions of OVS and libvirt installed on your system

- The command(s) you are using to create and/or start the VM

Feel free to use a service like pastebin.com to share the domain XML
configuration, if you'd like.

Thanks!

>> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com> wrote:
>> 
>> I don't think you can. KVM creates the port, OVS only handles switching.
>> 
>>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
>>> 
>>> how to create port's in openvswitch that can be assigned to vm created
>>> with KVM?

-- 
Scott


From jrajahalme at nicira.com  Thu Feb 19 09:34:01 2015
From: jrajahalme at nicira.com (Jarno Rajahalme)
Date: Thu, 19 Feb 2015 09:34:01 -0800
Subject: [ovs-discuss] Query regarding Bundle Commit and Rollback
In-Reply-To: <20150218160648.GB25752@nicira.com>
References: <CAAnq3DhUWFVNAuVnQA2HzMGDEMB9BVdemsFr=rTQGZDOApL3OA@mail.gmail.com>
 <20150218160648.GB25752@nicira.com>
Message-ID: <6A9246B6-B5CF-4B49-B9D8-278B7579FC29@nicira.com>


On Feb 18, 2015, at 8:06 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Feb 18, 2015 at 02:49:12PM +0530, Chethan C R wrote:
>> I am currently investigating on the implementation of OF 1.4 bundles.
>> 
>> Per Spec, the implementation should be able to support at least port mod
>> and flow mod in any order.
>> 
>> However, its not clear about handling commands which will modify multiple
>> matching flows. For example, a flow mod with delete on OFPTT_ALL will
>> trigger a lot of churn in the openflow flow tables. To support rollback, we
>> need to be backing up a considerable amount of data.
>> 
>> When the switch has tables spread across SW and HW, keeping a staging area
>> where the bundle messages are applied may not be straight forward.
>> 
>> I am curious to know how the commit and rollback logic is handled and if
>> these scenarios are thought of.
> 
> The bundle requests aren't supported yet.  When they are, though, it's
> pretty important to handle general-purpose rollback.  Jarno has done
> some preliminary work on bundle support, so I'm bringing him into the
> conversation to share his thoughts.
> 

I have done some initial work on the rollback, but this has not been posted yet. The gist of it is to stage changes so that they are not visible to lookups (e.g., staging a delete on OFPTT_ALL will mark all rules to be deleted, but the actual delete will be postponed). When all messages in the bundle are successfully staged we know that nothing can fail, and we can finalize the commit at this point. If any conflicts are found, all staged changes are rolled back.

> Hardware support isn't a priority because no one has ever contributed
> support for a hardware platform.


I’d imagine HW could be managed by keeping all flows in SW and reflecting the changes to HW flows only after a successful commit.

  Jarno

From blp at nicira.com  Thu Feb 19 09:13:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 19 Feb 2015 09:13:52 -0800
Subject: [ovs-discuss] Meter Tables
In-Reply-To: <CAPEGEiFHoeZKNhMdfqASUauRmcEcb3Nt=jGkU58s-qJN4NNygg@mail.gmail.com>
References: <CAPEGEiFHoeZKNhMdfqASUauRmcEcb3Nt=jGkU58s-qJN4NNygg@mail.gmail.com>
Message-ID: <20150219171352.GB19301@nicira.com>

On Wed, Feb 18, 2015 at 05:12:42PM -0500, Mehrdad Moradi wrote:
> I am trying to use meters (rate-limiters) by adding them to flow entries. I
> am using
> the latest RYU and Mininet. However, it seems when the flow mods are
> installed into
> the tables, I get some errors similar to the following. Thus my question is
> if this is OVS
> limitation?

Please read the FAQ.

### Q: Does Open vSwitch support OpenFlow meters?

A: Since version 2.0, Open vSwitch has OpenFlow protocol support for
   OpenFlow meters.  There is no implementation of meters in the Open
   vSwitch software switch (neither the kernel-based nor userspace
   switches).

From apocalipse89 at gmail.com  Thu Feb 19 09:10:58 2015
From: apocalipse89 at gmail.com (Salvatore Mazzarino)
Date: Thu, 19 Feb 2015 18:10:58 +0100
Subject: [ovs-discuss] Connect two physical eth port on ubuntu
In-Reply-To: <CAHbON5qFHJ5Q0CzL-+vi2qEC-qfj2ArMWB4fqonrqjcTP4vpFw@mail.gmail.com>
References: <F8C6CA86-C8D8-43DD-B4EA-9B479F2DA0E1@gmail.com>
 <CAHbON5qFHJ5Q0CzL-+vi2qEC-qfj2ArMWB4fqonrqjcTP4vpFw@mail.gmail.com>
Message-ID: <F373EE79-3BCF-41A7-BAF8-5395C52F425B@gmail.com>

Thank you. It was what I have done and now it works. I wasn’t considering the way how switch work
> On 19 Feb 2015, at 18:09, Gurucharan Shetty <shettyg at nicira.com> wrote:
> 
> On Wed, Feb 18, 2015 at 7:06 AM, Salvatore Mazzarino
> <apocalipse89 at gmail.com> wrote:
>> I’m trying to connect to connect two physical interfaces to the bridge.
> This is generally a bad idea. Are you sure you want to connect 2
> physical NICs to the same OVS bridge? Doing this usually creates
> network loops. What you usually do is create a bridge for each NIC.
> 
> 
>> The issues is the first one NIC get ip through dhcp while the second one get static ip
> In the OVS world, we apply IP address to the bridge and not to the
> physical NIC. Since you are connecting 2 physical NICs to the same
> bridge, you can only apply one IP address
> 
> 
> 
> 
>> 
>> 
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss


From jpettit at nicira.com  Thu Feb 19 17:36:09 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 19 Feb 2015 17:36:09 -0800
Subject: [ovs-discuss] Query
In-Reply-To: <CAPe5K8jBYUkX7e9ev3yDQ3+-AmVW_LaV96oqnnfqJLwikKdbvA@mail.gmail.com>
References: <CAPe5K8jBYUkX7e9ev3yDQ3+-AmVW_LaV96oqnnfqJLwikKdbvA@mail.gmail.com>
Message-ID: <FF9E43F1-B825-4194-B060-950102FEF630@nicira.com>

The answer is probably a no, but which buffers or queues were you thinking of in particular?

--Justin


> On Feb 18, 2015, at 8:09 AM, Gohar Irfan <goharirfan94 at gmail.com> wrote:
> 
> Hi,
> 
> We are a group of students from Pakistan and are working on a research project. We would like to know if Open vSwitch supports changing (dynamically) the buffer/queue sizes of the switch?
> If so, could you please refer to a suitable resource that guides how to go about it?
> 
> Regards.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From ppnaik at cse.iitb.ac.in  Thu Feb 19 20:23:40 2015
From: ppnaik at cse.iitb.ac.in (Priyanka Naik)
Date: Fri, 20 Feb 2015 09:53:40 +0530
Subject: [ovs-discuss] issue regarding port-mirroring
Message-ID: <54E6B6CC.5040804@cse.iitb.ac.in>

Hi,

I have an openstack juno setup with one server as controller+neutron and 
other three servers as compute nodes. I am doing port mirroring on 
br-int of one compute node. I noticed that incoming packets from VM on 
other compute node where not getting captured on the mirrored port. The 
incoming packets from other VM on the same compute node where getting 
captured.

qvo5fa64d30-2e is the br-int interface which I had mirrored using the 
commands as below:

ip link add name snooper2 type dummy
ip link set dev snooper2 up
ovs-vsctl add-port br-int snooper2

ovs-vsctl -- set Bridge br-int mirrors=@m  -- --id=@snooper2 \
get Port snooper2  -- --id=@qvo5fa64d30-2e get Port qvo5fa64d30-2e \
-- --id=@m create Mirror name=mymirror select-dst-port=@qvo5fa64d30-2e \
select-src-port=@qvo5fa64d30-2e output-port=@snooper2

Can someone please help me solve this issue.

Thanks,

Priyanka

From ebiken.g at gmail.com  Fri Feb 20 01:39:03 2015
From: ebiken.g at gmail.com (Kentaro Ebisawa)
Date: Fri, 20 Feb 2015 18:39:03 +0900
Subject: [ovs-discuss] LTS releases
In-Reply-To: <50D0179C-7B74-41D3-B4D0-FD859BFF77A4@nicira.com>
References: <54850278.408@oracle.com>
 <B26622C2-49D2-498E-8CFB-6E941FBC75E7@nicira.com>
 <54877810.2070609@oracle.com>
 <50D0179C-7B74-41D3-B4D0-FD859BFF77A4@nicira.com>
Message-ID: <54E700B7.3020302@gmail.com>

Hi,

So should we fix the FAQ to say "The current LTS release is 2.3.x." ?
Or are both 1.9.x and 2.3.x currently in LTS ?

-- 
Kentaro Ebisawa <ebiken.g at gmail.com>

On 2014/12/11 7:25, Justin Pettit wrote:
>> On Dec 9, 2014, at 2:30 PM, Mark Haywood <mark.haywood at oracle.com> wrote:
>>
>> On 12/8/14, 2:02 AM, Justin Pettit wrote:
>>>> On Dec 7, 2014, at 5:44 PM, Mark Haywood <mark.haywood at oracle.com> wrote:
>>>>
>>>> The FAQ says that there are usually several long-term support releases a year. What determines when an LTS is released and when would there be another one taking the place of 2.3.0?
>>> The LTS releases happen as critical bug fixes are fixed or every few months otherwise. We're going to try to introduce more regularity with a new QA process that is in the early planning stages.
>> So, I think you this means 2.3.1 might be released as bug fixes require or possibly in a few months as a mechanism to release a collection of non-critical bug fixes?
> Correct.  In fact, we already released 2.3.1:
>
> 	http://openvswitch.org/pipermail/announce/2014-December/000071.html
>
>>> As for when new LTS branches are chosen, that's less predictable. In the past we tried to do them roughly once a year, but we made so many fundamental architectural changes between 1.10 and 2.2 that we deliberately locked 1.9 as the LTS until 2.3. I don't expect that we'll need to do that again, so there should be a more regular cadence between LTSs.
>> And this means a new branch, say 2.4 maybe, would possibly be released in about a year?
> 2.4 will likely be released early in the first quarter of 2015.  However, 2.4 will not be an LTS.  Some later version of OVS will be LTS, which will likely be a year or so from now.  Put another way, not every "y" in a "x.y.z" version is LTS.
>
> --Justin
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From ebiken.g at gmail.com  Fri Feb 20 01:53:31 2015
From: ebiken.g at gmail.com (Kentaro Ebisawa)
Date: Fri, 20 Feb 2015 18:53:31 +0900
Subject: [ovs-discuss] IPFIX in upstream kernel
Message-ID: <54E7041B.2070908@gmail.com>

Hi,

Are there any  upstream kernel version which IPFIX works?

FAQ says I need kernel from OVS version 1.10.90 or later, but does not 
explicitly say which upstream kernel would work.
So wanted to double check if there are any upstream version which works.

 > Q: What Linux kernel versions does IPFIX flow monitoring work with?
 > A: IPFIX flow monitoring requires the Linux kernel module from Open
 >    vSwitch version 1.10.90 or later.

-- 
Kentaro Ebisawa <ebiken.g at gmail.com>


From ebiken.g at gmail.com  Fri Feb 20 05:32:07 2015
From: ebiken.g at gmail.com (Kentaro Ebisawa)
Date: Fri, 20 Feb 2015 22:32:07 +0900
Subject: [ovs-discuss] Sending proposed fix for FAQ
Message-ID: <54E73757.8050800@gmail.com>

Hi,

I found outdated description in FAQ and modified it in my forked tree on 
GitHUB.
https://github.com/ebiken/ovs/commit/dd65361117ce88915618853501427f24dcb2b7b3
I also created patch with format described in CONTRIBUTING.md.

However, I was not sure if anybody (including me) can send patch to dev@ 
or only specific people who has authority to check in.

Could someone kindly let me know how I should proceed?
Should I send ti to dev@, send pull request etc?

Thanks,

Subject: [PATCH] FAQ: Update VXLAN reference from draft to RFC7348

VXLAN is now RFC, so we better to change the pointer to it.

Signed-off-by: Kentaro Ebisawa <ebiken.g at gmail.com>
---
  FAQ.md |    4 ++--
  1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/FAQ.md b/FAQ.md
index 2de4936..0c578f3 100644
--- a/FAQ.md
+++ b/FAQ.md
@@ -1183,9 +1183,9 @@ A: VXLAN stands for Virtual eXtensible Local Area 
Network, and is a means
     to solve the scaling challenges of VLAN networks in a multi-tenant
     environment. VXLAN is an overlay network which transports an L2 network
     over an existing L3 network. For more information on VXLAN, please see
-   the IETF draft available here:
+   the IETF RFC available here:

-   http://tools.ietf.org/html/draft-mahalingam-dutt-dcops-vxlan-03
+   http://tools.ietf.org/html/rfc7348

  ### Q: How much of the VXLAN protocol does Open vSwitch currently support?

-- 
1.7.1

From ppnaik at cse.iitb.ac.in  Thu Feb 19 20:18:03 2015
From: ppnaik at cse.iitb.ac.in (Priyanka Naik)
Date: Fri, 20 Feb 2015 09:48:03 +0530
Subject: [ovs-discuss] VXLAN tunnel incoming packets are not captured on
 mirror port
In-Reply-To: <53B05AC1.9010908@veryxtech.com>
References: <53B05AC1.9010908@veryxtech.com>
Message-ID: <54E6B57B.9020701@cse.iitb.ac.in>

Hi,

I am too facing the same issue. Can you please tell me how you resolved it?

Thanks,

Priyanka




From ahmedest61 at hotmail.com  Fri Feb 20 02:39:00 2015
From: ahmedest61 at hotmail.com (Ahmad khaliq)
Date: Fri, 20 Feb 2015 10:39:00 +0000
Subject: [ovs-discuss] compiling error when build ovdk in Ubuntu 12.04
Message-ID: <BAY169-W1060D164F80BACCC374F4FCF2A0@phx.gbl>



    
      
          First build dpdk, succeeded.


Then ovdk, 

./configure RTE_SDK=$(RTE_SDK) --disable-ssl           (succeeded)

make  (failed)


lib/dpdk-link.c:25:24: fatal error: rte_config.h: No such file or directory

compilation terminated.

make[2]: *** [lib/dpdk-link.o] Error 1

make[2]: Leaving directory /root/ovdk/openvswitch'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory/root/ovdk/openvswitch'

make: *** [all] Error 2


I was following the install guide step by step.

      
    

   		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150220/4549b855/attachment-0001.html>

From marco at nuvula.ch  Fri Feb 20 04:33:28 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Fri, 20 Feb 2015 13:33:28 +0100
Subject: [ovs-discuss] 3rd try: Re: STP / VXLAN mesh: ETH0,
	Connection lost to OVS 2.3.1 server
In-Reply-To: <CBC2C3B2-1718-48B7-B486-58DBADBC5FF7@nuvula.ch>
References: <39C260E0-5634-40E4-BD09-9F0FA1643922@nuvula.ch>
 <CBC2C3B2-1718-48B7-B486-58DBADBC5FF7@nuvula.ch>
Message-ID: <B908FAD4-19D1-4503-A7C0-E02DFE7EE7E0@nuvula.ch>

Hello

really no answer from the list ? Three weeks, two emails. Nothing so far.

I really want to use OVS for my cloud but I can't if every second day network connectivity is lost.

Please help in debugging this issue, or let me know what I need to deliver as information.

ovs-bug report is collected and can be shared.

cheers and thanks for any help
marco






> On 13 Feb 2015, at 21:25, Marco Kuendig <marco at nuvula.ch> wrote:
> 
> so far no answer from the list.
> 
> I have in the meantime also collected an ova-bug report if somebody has time to look at it, I can post it for download.
> 
> please send me your email address, I send you the link.
> 
> thanks
> marco
> 
> 
> 
>> On 06 Feb 2015, at 00:23, Marco Kuendig <marco at nuvula.ch> wrote:
>> 
>> Folks,
>> 
>> I have a small testbed with 4 ubuntu servers, fully meshed with VXLAN. To avoid loops I use Spanning-Tree.
>> 
>> The 4 servers run Ubuntu 14.10 fully updated.
>> 
>> I upgraded manually to openvswitch 2.3.1 with the vivid packages from ubuntu.
>> 
>> 3 Servers run kvm and consume via rbd/ceph images. CEPH runs over openvswitch to sync data.
>> 
>> The 3 KVM servers share via VXLAN flat networks trunked with VLAN's.
>> 
>> These physical servers are single homed and therefore I need to bridge eth0 also to the outside world.
>> 
>> Randomly these servers loose connectivity to the outside world (eth0). Troubleshooting shows, that it is often related to STP events (VM's restarting/shutdown/hosts booting, etc).
>> 
>> After very long searches I think I found the culprit: A lock file ".conf.db.~lock~" is present in /etc/openvswitch directory. If I delete that file and reboot the host connectivity reappears.
>> 
>> When the host looses connectivity, no ipv4 traffic is forwarded anymore. No real culprits are visible in ovs-vswitch logs, except that a STP topology change happened.
>> 
>> local ovsbr0p1 bridged to eth0 interface can be ipv4 pinged. Gateway cannot be pinged anymore (sometimes ipv6 connectivity still works)
>> 
>> Any tips how to troubleshoot this and get rid of this sudden loss of connectivity ? Same problem happened on OVS 2.0 release.
>> 
>> Second question: How can I get rid of SPT events when VM's boot or similar ? On HW switches there is a concept of Access-Ports for end devices, where no STP event will be flood to the fabric.
>> 
>> thanks
>> marco
>> 
>> 
>> 
>> Below some outputs that could help in troubleshooting:
>> 
>> 
>> 
>> 
>> root at nuv-vir-kvm-server-3 ~ # ovs-vsctl show
>> 5733eb7c-f4ac-446c-bfd1-c0121c0337b7
>>   Bridge "ovsbr0"
>>       Port "eth0"
>>           Interface "eth0"
>>       Port "ovsbr0p1"
>>           Interface "ovsbr0p1"
>>               type: internal
>>       Port "ovsbr0"
>>           Interface "ovsbr0"
>>               type: internal
>>   Bridge "ovsbr1"
>>       Port "ovsbr1.8p1"
>>           tag: 8
>>           Interface "ovsbr1.8p1"
>>               type: internal
>>       Port "ovsbr1.12p1"
>>           tag: 12
>>           Interface "ovsbr1.12p1"
>>               type: internal
>>       Port "ovsbr1.3p1"
>>           tag: 3
>>           Interface "ovsbr1.3p1"
>>               type: internal
>>       Port "ovsbr1.4"
>>           tag: 4
>>           Interface "ovsbr1.4"
>>               type: internal
>>       Port "ovsbr1.101p1"
>>           tag: 101
>>           Interface "ovsbr1.101p1"
>>               type: internal
>>       Port "ovsvx5"
>>           trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
>>           Interface "ovsvx5"
>>               type: vxlan
>>               options: {key=flow, remote_ip="46.4.100.54"}
>>       Port "ovsbr1.1"
>>           tag: 1
>>           Interface "ovsbr1.1"
>>               type: internal
>>       Port "ovsbr1.9"
>>           tag: 9
>>           Interface "ovsbr1.9"
>>               type: internal
>>       Port "ovsbr1.2"
>>           tag: 2
>>           Interface "ovsbr1.2"
>>               type: internal
>>       Port "ovsbr1.20"
>>           tag: 20
>>           Interface "ovsbr1.20"
>>               type: internal
>>       Port "ovsbr1.30p1"
>>           tag: 30
>>           Interface "ovsbr1.30p1"
>>               type: internal
>>       Port "ovsbr1.101"
>>           tag: 101
>>           Interface "ovsbr1.101"
>>               type: internal
>>       Port "ovsbr1.5"
>>           tag: 5
>>           Interface "ovsbr1.5"
>>               type: internal
>>       Port "ovsbr1.7"
>>           tag: 7
>>           Interface "ovsbr1.7"
>>               type: internal
>>       Port "ovsbr1.1p1"
>>           tag: 1
>>           Interface "ovsbr1.1p1"
>>               type: internal
>>       Port "ovsbr1.6"
>>           tag: 6
>>           Interface "ovsbr1.6"
>>               type: internal
>>       Port "ovsbr1.11p1"
>>           tag: 11
>>           Interface "ovsbr1.11p1"
>>               type: internal
>>       Port "ovsbr1.4p1"
>>           tag: 4
>>           Interface "ovsbr1.4p1"
>>               type: internal
>>       Port "ovsbr1"
>>           Interface "ovsbr1"
>>               type: internal
>>       Port "ovsbr1.8"
>>           tag: 8
>>           Interface "ovsbr1.8"
>>               type: internal
>>       Port "ovsbr1.12"
>>           tag: 12
>>           Interface "ovsbr1.12"
>>               type: internal
>>       Port "ovsbr1.11"
>>           tag: 11
>>           Interface "ovsbr1.11"
>>               type: internal
>>       Port "ovsbr1.10p1"
>>           tag: 10
>>           Interface "ovsbr1.10p1"
>>               type: internal
>>       Port "ovsbr1.7p1"
>>           tag: 7
>>           Interface "ovsbr1.7p1"
>>               type: internal
>>       Port "ovsbr1.2p1"
>>           tag: 2
>>           Interface "ovsbr1.2p1"
>>               type: internal
>>       Port "ovsbr1.9p1"
>>           tag: 9
>>           Interface "ovsbr1.9p1"
>>               type: internal
>>       Port "ovsbr1.30"
>>           tag: 30
>>           Interface "ovsbr1.30"
>>               type: internal
>>       Port "ovsvxnuv-vir-aci-ubuntu-1"
>>           trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
>>           Interface "ovsvxnuv-vir-aci-ubuntu-1"
>>               type: vxlan
>>               options: {key=flow, remote_ip="46.4.17.109"}
>>       Port "ovsbr1.10"
>>           tag: 10
>>           Interface "ovsbr1.10"
>>               type: internal
>>       Port "ovsvx7"
>>           trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
>>           Interface "ovsvx7"
>>               type: vxlan
>>               options: {key=flow, remote_ip="46.4.17.67"}
>>       Port "ovsbr1.5p1"
>>           tag: 5
>>           Interface "ovsbr1.5p1"
>>               type: internal
>>       Port "ovsvx6"
>>           trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
>>           Interface "ovsvx6"
>>               type: vxlan
>>               options: {key=flow, remote_ip="46.4.109.146"}
>>       Port "ovsbr1.6p1"
>>           tag: 6
>>           Interface "ovsbr1.6p1"
>>               type: internal
>>       Port "ovsbr1.3"
>>           tag: 3
>>           Interface "ovsbr1.3"
>>               type: internal
>>       Port "ovsbr1.20p1"
>>           tag: 20
>>           Interface "ovsbr1.20p1"
>>               type: internal
>>   ovs_version: "2.3.1"
>> 
>> _uuid               : c960a8da-aa1a-4c8a-a3f3-1b7863424313
>> bond_active_slave   : []
>> bond_downdelay      : 0
>> bond_fake_iface     : false
>> bond_mode           : []
>> bond_updelay        : 0
>> external_ids        : {}
>> fake_bridge         : false
>> interfaces          : [e8ec16b3-1a83-44a0-b3f8-f3dccfdde91d]
>> lacp                : []
>> mac                 : []
>> name                : "eth0"
>> other_config        : {}
>> qos                 : []
>> statistics          : {}
>> status              : {}
>> tag                 : []
>> trunks              : []
>> vlan_mode           : []
>> 
>> root at nuv-vir-kvm-server-5 ~ # ovs-vsctl list port
>> _uuid               : 6b14b501-a85b-4fc0-8cd3-1302830ff35c
>> bond_active_slave   : []
>> bond_downdelay      : 0
>> bond_fake_iface     : false
>> bond_mode           : []
>> bond_updelay        : 0
>> external_ids        : {}
>> fake_bridge         : false
>> interfaces          : [7dfc6aa1-23bf-4784-98c3-583ea20884c6]
>> lacp                : []
>> mac                 : []
>> name                : "ovsbr1.1p1"
>> other_config        : {}
>> qos                 : []
>> statistics          : {}
>> status              : {}
>> tag                 : 1
>> trunks              : []
>> vlan_mode           : []
>> 
>> 
>> _uuid               : eec4c406-3cf5-4507-9ca3-251741631e77
>> bond_active_slave   : []
>> bond_downdelay      : 0
>> bond_fake_iface     : false
>> bond_mode           : []
>> bond_updelay        : 0
>> external_ids        : {}
>> fake_bridge         : false
>> interfaces          : [8e88f0c9-31e0-4c44-81b8-53511ab8d8bd]
>> lacp                : []
>> mac                 : []
>> name                : "ovsbr1"
>> other_config        : {}
>> qos                 : []
>> statistics          : {}
>> status              : {}
>> tag                 : []
>> trunks              : []
>> vlan_mode           : []
>> 
>> _uuid               : a191cc12-89d3-4a79-bdaf-55502c5b213d
>> bond_active_slave   : []
>> bond_downdelay      : 0
>> bond_fake_iface     : false
>> bond_mode           : []
>> bond_updelay        : 0
>> external_ids        : {}
>> fake_bridge         : false
>> interfaces          : [4281866e-11b4-4c04-8a6c-066aea7af246]
>> lacp                : []
>> mac                 : []
>> name                : "ovsbr0p1"
>> other_config        : {}
>> qos                 : []
>> statistics          : {}
>> status              : {}
>> tag                 : []
>> trunks              : []
>> vlan_mode           : []
>> 
>> 
>> 
>> _uuid               : 22ee48dc-7fec-4742-b577-a5293f7e3bd9
>> admin_state         : up
>> bfd                 : {}
>> bfd_status          : {}
>> cfm_fault           : []
>> cfm_fault_status    : []
>> cfm_flap_count      : []
>> cfm_health          : []
>> cfm_mpid            : []
>> cfm_remote_mpids    : []
>> cfm_remote_opstate  : []
>> duplex              : []
>> external_ids        : {}
>> ifindex             : 5
>> ingress_policing_burst: 0
>> ingress_policing_rate: 0
>> lacp_current        : []
>> link_resets         : 1
>> link_speed          : []
>> link_state          : up
>> mac                 : []
>> mac_in_use          : "c8:60:00:5f:f0:3f"
>> mtu                 : 1500
>> name                : "ovsbr0"
>> ofport              : 65534
>> ofport_request      : []
>> options             : {}
>> other_config        : {}
>> statistics          : {collisions=0, rx_bytes=360, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=4, tx_bytes=44058, tx_dropped=0, tx_errors=0, tx_packets=328}
>> status              : {driver_name=openvswitch}
>> type                : internal
>> 
>> 
>> _uuid               : e8ec16b3-1a83-44a0-b3f8-f3dccfdde91d
>> admin_state         : up
>> bfd                 : {}
>> bfd_status          : {}
>> cfm_fault           : []
>> cfm_fault_status    : []
>> cfm_flap_count      : []
>> cfm_health          : []
>> cfm_mpid            : []
>> cfm_remote_mpids    : []
>> cfm_remote_opstate  : []
>> duplex              : full
>> external_ids        : {}
>> ifindex             : 2
>> ingress_policing_burst: 0
>> ingress_policing_rate: 0
>> lacp_current        : []
>> link_resets         : 1
>> link_speed          : 1000000000
>> link_state          : up
>> mac                 : []
>> mac_in_use          : "c8:60:00:5f:f0:3f"
>> mtu                 : 1500
>> name                : "eth0"
>> ofport              : 2
>> ofport_request      : []
>> options             : {}
>> other_config        : {}
>> statistics          : {collisions=0, rx_bytes=1381410080, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=6910253, tx_bytes=1055169046, tx_dropped=0, tx_errors=0, tx_packets=2504716}
>> status              : {driver_name="r8169", driver_version="2.3LK-NAPI", firmware_version="rtl_nic/rtl8168e-2.fw"}
>> type                : ""
>> 
>> 
>> _uuid               : 4281866e-11b4-4c04-8a6c-066aea7af246
>> admin_state         : up
>> bfd                 : {}
>> bfd_status          : {}
>> cfm_fault           : []
>> cfm_fault_status    : []
>> cfm_flap_count      : []
>> cfm_health          : []
>> cfm_mpid            : []
>> cfm_remote_mpids    : []
>> cfm_remote_opstate  : []
>> duplex              : []
>> external_ids        : {}
>> ifindex             : 4
>> ingress_policing_burst: 0
>> ingress_policing_rate: 0
>> lacp_current        : []
>> link_resets         : 1
>> link_speed          : []
>> link_state          : up
>> mac                 : []
>> mac_in_use          : "62:ee:a5:83:b5:7e"
>> mtu                 : 1500
>> name                : "ovsbr0p1"
>> ofport              : 1
>> ofport_request      : []
>> options             : {}
>> other_config        : {}
>> statistics          : {collisions=0, rx_bytes=1053520420, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=2474191, tx_bytes=9971342322, tx_dropped=0, tx_errors=0, tx_packets=6910215}
>> status              : {driver_name=openvswitch}
>> type                : internal
>> 
>> _uuid               : 7dfc6aa1-23bf-4784-98c3-583ea20884c6
>> admin_state         : up
>> bfd                 : {}
>> bfd_status          : {}
>> cfm_fault           : []
>> cfm_fault_status    : []
>> cfm_flap_count      : []
>> cfm_health          : []
>> cfm_mpid            : []
>> cfm_remote_mpids    : []
>> cfm_remote_opstate  : []
>> duplex              : []
>> external_ids        : {}
>> ifindex             : 36
>> ingress_policing_burst: 0
>> ingress_policing_rate: 0
>> lacp_current        : []
>> link_resets         : 1
>> link_speed          : []
>> link_state          : up
>> mac                 : []
>> mac_in_use          : "6e:e8:ec:44:f9:1a"
>> mtu                 : 1400
>> name                : "ovsbr1.1p1"
>> ofport              : 2
>> ofport_request      : []
>> options             : {}
>> other_config        : {}
>> statistics          : {collisions=0, rx_bytes=800790181, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=2044691, tx_bytes=9595662921, tx_dropped=0, tx_errors=0, tx_packets=6887123}
>> status              : {driver_name=openvswitch}
>> type                : internal
>> 
>> _uuid               : 8c602077-b2b1-4f2c-9201-93304008a814
>> bond_active_slave   : []
>> bond_downdelay      : 0
>> bond_fake_iface     : false
>> bond_mode           : []
>> bond_updelay        : 0
>> external_ids        : {}
>> fake_bridge         : false
>> interfaces          : [18cb6a6c-1f66-4eb5-bc78-304e8b404ac0]
>> lacp                : []
>> mac                 : []
>> name                : "ovsvx3"
>> other_config        : {}
>> qos                 : []
>> statistics          : {stp_error_count=0, stp_rx_count=311, stp_tx_count=4}
>> status              : {stp_port_id="8002", stp_role=root, stp_sec_in_state="592", stp_state=forwarding}
>> tag                 : []
>> trunks              : [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 101]
>> vlan_mode           : trunk
>> 
>> 
>> 2015-02-05T10:54:04.316Z|00082|bridge|INFO|bridge ovsbr1: added interface ovsvxnuv-vir-aci-ubuntu-1 on port 35
>> 2015-02-05T10:54:34.562Z|00083|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T18:13:52.953Z|00014|stp(handler10)|INFO|ovsbr1: detected topology change.
>> 2015-02-05T20:58:13.680Z|00084|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T20:58:14.181Z|00085|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T20:59:49.410Z|00086|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T21:13:56.899Z|00015|stp(handler10)|INFO|ovsbr1: detected topology change.
>> 2015-02-05T21:16:05.136Z|00087|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T21:16:05.637Z|00088|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T21:16:34.178Z|00089|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T21:39:46.234Z|00016|stp(handler10)|INFO|ovsbr1: detected topology change.
>> 2015-02-05T22:44:19.686Z|00090|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T22:44:49.218Z|00091|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T23:01:55.688Z|00001|fatal_signal(urcu5)|WARN|terminating with signal 15 (Terminated)
>> 2015-02-05T23:07:39.407Z|00001|vlog|INFO|opened log file /var/log/openvswitch/ovs-vswitchd.log
>> 2015-02-05T23:07:39.446Z|00002|reconnect|INFO|unix:/var/run/openvswitch/db.sock: connecting...
>> 2015-02-05T23:07:39.446Z|00003|reconnect|INFO|unix:/var/run/openvswitch/db.sock: connected
>> 2015-02-05T23:07:39.450Z|00004|dpif|WARN|system at ovs-system: failed to put[create] (Invalid argument) skb_priority(0),skb_mark(0),recirc_id(0x1),dp_hash(0x1),in_port(0),eth(src=00:00:00:00:00:00,dst=00:00:00:00:00:00)
>> 2015-02-05T23:07:39.450Z|00005|ofproto_dpif|INFO|system at ovs-system: Datapath does not support recirculation
>> 2015-02-05T23:07:39.450Z|00006|dpif|WARN|system at ovs-system: execute userspace(pid=0,userdata(00000000)) failed (Invalid argument) on packet metadata=0,in_port=0,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x1234
>> 2015-02-05T23:07:39.450Z|00007|ofproto_dpif|WARN|system at ovs-system: variable-length userdata feature probe failed (Invalid argument)
>> 2015-02-05T23:07:39.450Z|00008|dpif|WARN|system at ovs-system: failed to put[create] (Invalid argument) skb_priority(0),skb_mark(0),in_port(0),eth(src=00:00:00:00:00:00,dst=00:00:00:00:00:00),eth_type(0x8847),mpls(label=0,tc=0,ttl=0,bos=1)
>> 2015-02-05T23:07:39.450Z|00009|ofproto_dpif|INFO|system at ovs-system: MPLS label stack length probed as 0
>> 2015-02-05T23:07:39.454Z|00010|dpif|WARN|system at ovs-system: failed to query port ovsvxnuv-vir-aci-ubuntu-1: Invalid argument
>> 2015-02-05T23:07:39.455Z|00011|bridge|INFO|bridge ovsbr0: added interface ovsbr0p1 on port 1
>> 2015-02-05T23:07:39.456Z|00012|bridge|INFO|bridge ovsbr0: added interface eth0 on port 2
>> 2015-02-05T23:07:39.457Z|00013|bridge|INFO|bridge ovsbr0: added interface ovsbr0 on port 65534
>> 2015-02-05T23:07:39.459Z|00014|bridge|INFO|bridge ovsbr1: added interface ovsbr1.2p1 on port 4
>> 2015-02-05T23:07:39.460Z|00015|bridge|INFO|bridge ovsbr1: added interface ovsbr1.6 on port 11
>> 2015-02-05T23:07:39.461Z|00016|bridge|INFO|bridge ovsbr1: added interface ovsvx6 on port 31
>> 2015-02-05T23:07:39.463Z|00017|bridge|INFO|bridge ovsbr1: added interface ovsbr1.7 on port 13
>> 2015-02-05T23:07:39.467Z|00018|bridge|INFO|bridge ovsbr1: added interface ovsbr1.9 on port 17
>> 2015-02-05T23:07:39.469Z|00019|bridge|INFO|bridge ovsbr1: added interface ovsbr1.9p1 on port 18
>> 2015-02-05T23:07:39.472Z|00020|bridge|INFO|bridge ovsbr1: added interface ovsbr1.1 on port 1
>> 2015-02-05T23:07:39.473Z|00021|bridge|INFO|bridge ovsbr1: added interface ovsbr1.6p1 on port 12
>> 2015-02-05T23:07:39.476Z|00022|bridge|INFO|bridge ovsbr1: added interface ovsbr1.10p1 on port 20
>> 2015-02-05T23:07:39.476Z|00023|bridge|INFO|bridge ovsbr1: added interface ovsvx3 on port 33
>> 2015-02-05T23:07:39.481Z|00024|bridge|INFO|bridge ovsbr1: added interface ovsbr1.4p1 on port 8
>> 2015-02-05T23:07:39.485Z|00025|bridge|INFO|bridge ovsbr1: added interface ovsbr1 on port 65534
>> 2015-02-05T23:07:39.489Z|00001|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 1
>> 2015-02-05T23:07:39.490Z|00026|bridge|INFO|bridge ovsbr1: added interface ovsbr1.3p1 on port 6
>> 2015-02-05T23:07:39.495Z|00027|bridge|INFO|bridge ovsbr1: added interface ovsbr1.10 on port 19
>> 2015-02-05T23:07:39.497Z|00002|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 3
>> 2015-02-05T23:07:39.508Z|00028|bridge|INFO|bridge ovsbr1: added interface ovsbr1.30 on port 27
>> 2015-02-05T23:07:39.510Z|00029|bridge|INFO|bridge ovsbr1: added interface ovsbr1.7p1 on port 14
>> 2015-02-05T23:07:39.514Z|00030|bridge|INFO|bridge ovsbr1: added interface ovsbr1.11p1 on port 22
>> 2015-02-05T23:07:39.514Z|00031|bridge|INFO|bridge ovsbr1: added interface ovsvx7 on port 34
>> 2015-02-05T23:07:39.516Z|00032|bridge|INFO|bridge ovsbr1: added interface ovsbr1.20p1 on port 26
>> 2015-02-05T23:07:39.516Z|00033|bridge|INFO|bridge ovsbr1: added interface ovsvxnuv-vir-aci-ubuntu-1 on port 35
>> 2015-02-05T23:07:39.518Z|00034|bridge|INFO|bridge ovsbr1: added interface ovsbr1.20 on port 25
>> 2015-02-05T23:07:39.521Z|00035|bridge|INFO|bridge ovsbr1: added interface ovsbr1.3 on port 5
>> 2015-02-05T23:07:39.525Z|00036|bridge|INFO|bridge ovsbr1: added interface ovsbr1.4 on port 7
>> 2015-02-05T23:07:39.529Z|00037|bridge|INFO|bridge ovsbr1: added interface ovsbr1.5p1 on port 10
>> 2015-02-05T23:07:39.532Z|00038|bridge|INFO|bridge ovsbr1: added interface ovsbr1.8p1 on port 16
>> 2015-02-05T23:07:39.539Z|00003|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 10
>> 2015-02-05T23:07:39.541Z|00039|bridge|INFO|bridge ovsbr1: added interface ovsbr1.11 on port 21
>> 2015-02-05T23:07:39.546Z|00040|bridge|INFO|bridge ovsbr1: added interface ovsbr1.5 on port 9
>> 2015-02-05T23:07:39.549Z|00041|bridge|INFO|bridge ovsbr1: added interface ovsbr1.101 on port 29
>> 2015-02-05T23:07:39.553Z|00042|bridge|INFO|bridge ovsbr1: added interface ovsbr1.2 on port 3
>> 2015-02-05T23:07:39.563Z|00043|bridge|INFO|bridge ovsbr1: added interface ovsbr1.12p1 on port 24
>> 2015-02-05T23:07:39.569Z|00044|bridge|INFO|bridge ovsbr1: added interface ovsbr1.8 on port 15
>> 2015-02-05T23:07:39.570Z|00004|ofproto_dpif_upcall(handler1)|INFO|received packet on unassociated datapath port 14
>> 2015-02-05T23:07:39.573Z|00045|bridge|INFO|bridge ovsbr1: added interface ovsbr1.12 on port 23
>> 2015-02-05T23:07:39.575Z|00046|bridge|INFO|bridge ovsbr1: added interface ovsbr1.101p1 on port 30
>> 2015-02-05T23:07:39.581Z|00047|bridge|INFO|bridge ovsbr1: added interface ovsbr1.30p1 on port 28
>> 2015-02-05T23:07:39.584Z|00048|bridge|INFO|bridge ovsbr1: added interface ovsbr1.1p1 on port 2
>> 2015-02-05T23:07:39.584Z|00049|bridge|INFO|bridge ovsbr0: using datapath ID 0000c860005ff03f
>> 2015-02-05T23:07:39.584Z|00050|connmgr|INFO|ovsbr0: added service controller "punix:/var/run/openvswitch/ovsbr0.mgmt"
>> 2015-02-05T23:07:39.584Z|00051|bridge|INFO|bridge ovsbr1: using datapath ID 0000de63bff5aa47
>> 2015-02-05T23:07:39.585Z|00052|connmgr|INFO|ovsbr1: added service controller "punix:/var/run/openvswitch/ovsbr1.mgmt"
>> 2015-02-05T23:07:39.586Z|00053|dpif|WARN|system at ovs-system: failed to query port ovsvxnuv-vir-aci-ubuntu-1: Invalid argument
>> 2015-02-05T23:07:39.595Z|00054|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.3.1
>> 2015-02-05T23:07:49.598Z|00055|memory|INFO|49472 kB peak resident set size after 10.2 seconds
>> 2015-02-05T23:07:49.598Z|00056|memory|INFO|handlers:2 ports:38 revalidators:2 rules:12 udpif keys:11
>> 2015-02-05T23:08:09.607Z|00057|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T23:08:09.607Z|00058|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T23:08:09.607Z|00059|stp|INFO|ovsbr1: detected topology change.
>> 2015-02-05T23:08:45.990Z|00060|bridge|INFO|bridge ovsbr1: added interface vnet0 on port 32
>> 2015-02-05T23:09:16.213Z|00061|stp|INFO|ovsbr1: detected topology change.
>> 
>> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150220/74e62b0a/attachment-0001.html>

From blp at nicira.com  Fri Feb 20 08:15:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 20 Feb 2015 08:15:44 -0800
Subject: [ovs-discuss] compiling error when build ovdk in Ubuntu 12.04
In-Reply-To: <BAY169-W1060D164F80BACCC374F4FCF2A0@phx.gbl>
References: <BAY169-W1060D164F80BACCC374F4FCF2A0@phx.gbl>
Message-ID: <20150220161544.GC6013@nicira.com>

Please report OVDK problems to the OVDK mailing list.

On Fri, Feb 20, 2015 at 10:39:00AM +0000, Ahmad khaliq wrote:
> 
> 
>     
>       
>           First build dpdk, succeeded.
> 
> 
> Then ovdk, 
> 
> ./configure RTE_SDK=$(RTE_SDK) --disable-ssl           (succeeded)
> 
> make  (failed)
> 
> 
> lib/dpdk-link.c:25:24: fatal error: rte_config.h: No such file or directory
> 
> compilation terminated.
> 
> make[2]: *** [lib/dpdk-link.o] Error 1
> 
> make[2]: Leaving directory /root/ovdk/openvswitch'
> make[1]: *** [all-recursive] Error 1
> make[1]: Leaving directory/root/ovdk/openvswitch'
> 
> make: *** [all] Error 2
> 
> 
> I was following the install guide step by step.
> 
>       
>     
> 
>    		 	   		  

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Fri Feb 20 08:53:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 20 Feb 2015 08:53:43 -0800
Subject: [ovs-discuss] Sending proposed fix for FAQ
In-Reply-To: <54E73757.8050800@gmail.com>
References: <54E73757.8050800@gmail.com>
Message-ID: <20150220165343.GE6013@nicira.com>

On Fri, Feb 20, 2015 at 10:32:07PM +0900, Kentaro Ebisawa wrote:
> I found outdated description in FAQ and modified it in my forked tree on
> GitHUB.
> https://github.com/ebiken/ovs/commit/dd65361117ce88915618853501427f24dcb2b7b3
> I also created patch with format described in CONTRIBUTING.md.
> 
> However, I was not sure if anybody (including me) can send patch to dev@ or
> only specific people who has authority to check in.
> 
> Could someone kindly let me know how I should proceed?
> Should I send ti to dev@, send pull request etc?

Anyone can send a patch to dev at .

I applied this one to master.  (I updated another reference to the
Internet-Draft while I was at it.)

From blp at nicira.com  Fri Feb 20 09:02:21 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 20 Feb 2015 09:02:21 -0800
Subject: [ovs-discuss] LTS releases
In-Reply-To: <54E700B7.3020302@gmail.com>
References: <54850278.408@oracle.com>
 <B26622C2-49D2-498E-8CFB-6E941FBC75E7@nicira.com>
 <54877810.2070609@oracle.com>
 <50D0179C-7B74-41D3-B4D0-FD859BFF77A4@nicira.com>
 <54E700B7.3020302@gmail.com>
Message-ID: <20150220170221.GG6013@nicira.com>

It should say 2.3.  Thanks for pointing out the error.

I sent out a fix for review.

On Fri, Feb 20, 2015 at 06:39:03PM +0900, Kentaro Ebisawa wrote:
> Hi,
> 
> So should we fix the FAQ to say "The current LTS release is 2.3.x." ?
> Or are both 1.9.x and 2.3.x currently in LTS ?
> 
> -- 
> Kentaro Ebisawa <ebiken.g at gmail.com>
> 
> On 2014/12/11 7:25, Justin Pettit wrote:
> >>On Dec 9, 2014, at 2:30 PM, Mark Haywood <mark.haywood at oracle.com> wrote:
> >>
> >>On 12/8/14, 2:02 AM, Justin Pettit wrote:
> >>>>On Dec 7, 2014, at 5:44 PM, Mark Haywood <mark.haywood at oracle.com> wrote:
> >>>>
> >>>>The FAQ says that there are usually several long-term support releases a year. What determines when an LTS is released and when would there be another one taking the place of 2.3.0?
> >>>The LTS releases happen as critical bug fixes are fixed or every few months otherwise. We're going to try to introduce more regularity with a new QA process that is in the early planning stages.
> >>So, I think you this means 2.3.1 might be released as bug fixes require or possibly in a few months as a mechanism to release a collection of non-critical bug fixes?
> >Correct.  In fact, we already released 2.3.1:
> >
> >	http://openvswitch.org/pipermail/announce/2014-December/000071.html
> >
> >>>As for when new LTS branches are chosen, that's less predictable. In the past we tried to do them roughly once a year, but we made so many fundamental architectural changes between 1.10 and 2.2 that we deliberately locked 1.9 as the LTS until 2.3. I don't expect that we'll need to do that again, so there should be a more regular cadence between LTSs.
> >>And this means a new branch, say 2.4 maybe, would possibly be released in about a year?
> >2.4 will likely be released early in the first quarter of 2015.  However, 2.4 will not be an LTS.  Some later version of OVS will be LTS, which will likely be a year or so from now.  Put another way, not every "y" in a "x.y.z" version is LTS.
> >
> >--Justin
> >
> >
> >_______________________________________________
> >discuss mailing list
> >discuss at openvswitch.org
> >http://openvswitch.org/mailman/listinfo/discuss
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From pshelar at nicira.com  Fri Feb 20 09:54:28 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Fri, 20 Feb 2015 09:54:28 -0800
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <D1028B6C.23ADF%davidjoshuaevans@gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
 <CALnjE+pz7uuh314-7oFTGiia9ev71-7KOV2A80NVTuWGGLpbWw@mail.gmail.com>
 <D1021C1E.23A29%davidjoshuaevans@gmail.com>
 <D1023EE3.23A97%davidjoshuaevans@gmail.com>
 <CALnjE+ogV4uPbL8mXCo1b=tj3-qRQH9wdS74D2O2VtYwCqnp0A@mail.gmail.com>
 <D1028B6C.23ADF%davidjoshuaevans@gmail.com>
Message-ID: <CALnjE+psiza4WVM78GwTcX12X0=4KUehgSQVesRzuLk8KA7MeQ@mail.gmail.com>

On Thu, Feb 12, 2015 at 2:59 PM, David Evans <davidjoshuaevans at gmail.com> wrote:
> Hi Pravin,
>
> While trying to figure this out - I'm looking at netdev-vport.c and
> netdev-dpdk.c
> I could conceivably integrate the vport's build/push/pop/get/set/config
> for GRE into the DPDK netdev-dpdk.c.
>
> Then I would only need one bridge and would not require the linux
> networking/routing.
>
The reason for using two bridge is that we want to share core with
linux networking so that there is no need to rewrite those components
and management utilities.

> Does that sound foolish or wise to you?
>
> Regards,
> Dave.
>
> On 2/12/15, 3:38 PM, "Pravin Shelar" <pshelar at nicira.com> wrote:
>
>>On Thu, Feb 12, 2015 at 9:29 AM, David Evans <davidjoshuaevans at gmail.com>
>>wrote:
>>> BTW- it works fine when b0 bridge type is NOT netdev and port is not
>>> accessed via DPDK.
>>> Something in the userspace data path may be broken?
>>>
>>
>>Can you try same test with netdev datapath and userspace tunneling?
>>
>>> On 2/12/15, 9:16 AM, "David Evans" <davidjoshuaevans at gmail.com> wrote:
>>>
>>>>Hi Pravin,
>>>>
>>>>Thank you for helping out.
>>>>
>>>>As you saw below from ofproto/trace, the b0 bridge Datapath Actions says
>>>>it sends out gre packets with a header src .102 dest .101 destination
>>>>But the packet captured on the receiving host(C)ös ethernet port is as
>>>>follows (GRE header in tact from 2F) but the outer MAC & IP are 00...
>>>>
>>>>00 00 00 00 00 00 00 00 00 00 00 00 00 00 02 00
>>>>00 00 00 00 00 00 40 2F 46 9F C0 A8 38 66 C0 A8
>>>>38 65 00 00 65 58 00 00 04 04 12 34 00 00 04 56
>>>>78 90 08 00 45 00 01 EE 00 00 00 00 40 FF A6 B9
>>>>C0 A8 A8 05 C0 A8 A8 01
>>>>
>>>>Trying to trace this through:
>>>>
>>>>1) How did the Datapath Actions on b0 work out the src ip?
>>>>
>>>>
>>>>2) What is supposed to happen to the packet when it leaves the first
>>>>bridge b0?
>>>>How does it get to b1? I am guessing linux host routing?
>>>>
>>>>3) Could B1 be corrupting the header for some reason?
>>>>
>>>>4Š other possible factors ( netdev bridge? - DPDK ports?  linux stack
>>>>arp
>>>>cache issue?)
>>>>
>>>>I can ping both directions between 102 & 101 across the wire. So that
>>>>connection is good.
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>default_hugepagesz=2M hugepagesz=2M hugepages=2048
>>>>
>>>>On 2/11/15, 6:55 PM, "Pravin Shelar" <pshelar at nicira.com> wrote:
>>>>
>>>>>On Tue, Feb 10, 2015 at 1:52 PM, David Evans
>>>>><davidjoshuaevans at gmail.com>
>>>>>wrote:
>>>>>> Hi OVS,
>>>>>>
>>>>>> I have 3.18 kernel containing ip_gre & Ovs 2.3.90 & Dpdk 1.7.1
>>>>>>
>>>>>Userspace tunneling does not need ip_gre module, tunneling is handled
>>>>>in userspace.
>>>>>
>>>>>> I find that the outer ip & mac are not populated ???  The
>>>>>>ofproto/trace
>>>>>> output thinks that the gre output will have the right src/dest on the
>>>>>>outer
>>>>>> but then it(C)ös goneŠ
>>>>>>
>>>>>What do you mean by "its gone"? Can you post tcpdump for ping test?
>>>>>
>>>>>
>>>>>> a bug?
>>>>>> am I missing some setup?
>>>>>> Wrong kernel ip_gre?
>>>>>>
>>>>>> Originating GRE:
>>>>>> ovs-vsctl add-br b0  -- set bridge b0 datapath_type=netdev
>>>>>> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
>>>>>> options:remote_ip=192.168.56.101
>>>>>> ovs-vsctl add-port b0 dpdk0 -- set Interface dpdk0 type=dpdk
>>>>>>
>>>>>> Output Bridge:
>>>>>> ovs-vsctl add-br b1  -- set bridge b1 datapath_type=netdev
>>>>>> ovs-vsctl add-port b1 dpdk1 -- set Interface dpdk1 type=dpdk
>>>>>> ifconfig b1 192.168.56.102 netmask 255.255.255.0
>>>>>>
>>>>>> Set up flows:
>>>>>> ovs-ofctl del-flows b0
>>>>>> ovs-ofctl del-flows b1
>>>>>> -force traffic to gre from dpdk0
>>>>>> ovs-ofctl add-flow b0 in_port=2,action=output:1
>>>>>> ovs-ofctl add-flow b0 in_port=1,action=output:0
>>>>>> -force traffic from b1 to output
>>>>>> ovs-ofctl add-flow b1 in_port=LOCAL,action=output:1
>>>>>> ovs-ofctl add-flow b1 in_port=1,action=output:LOCAL
>>>>>>
>>>>>> A ofproto/trace says
>>>>>>
>>>>>> ovs-appctl ofproto/trace b0 in_port=1,dl_dst=00:e0:ed:52:97:cd
>>>>>> Bridge: b0
>>>>>> Flow:
>>>>>>
>>>>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:
>>>>>>97
>>>>>>:
>>>>>>cd,dl_type=0x0000
>>>>>>
>>>>>> Rule: table=0 cookie=0 in_port=1
>>>>>> OpenFlow actions=output:2
>>>>>>
>>>>>> Final flow:
>>>>>>
>>>>>>in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:e0:ed:52:
>>>>>>97
>>>>>>:
>>>>>>cd,dl_type=0x0000
>>>>>> Megaflow: recirc_id=0,in_port=1,dl_type=0x0000
>>>>>> Datapath actions:
>>>>>>
>>>>>>tnl_push(tnl_port(5),header(size=38,type=3,eth(dst=00:00:04:04:12:34,s
>>>>>>rc
>>>>>>=
>>>>>>00:e0:ed:52:97:cb,dl_type=0x0800),ipv4(src=192.168.56.102,dst=192.168.
>>>>>>56
>>>>>>.
>>>>>>101,proto=47,tos=0,ttl=64,frag=0x40),gre((flags=0x0,proto=0x6558))),ou
>>>>>>t_
>>>>>>p
>>>>>>ort(2))
>>>>>>
>>>>>>
>>>>>> Regards,
>>>>>>
>>>>>> Dave
>>>>>>
>>>>>> _______________________________________________
>>>>>> discuss mailing list
>>>>>> discuss at openvswitch.org
>>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>>
>>>>
>>>>
>>>
>>>
>
>

From alexw at nicira.com  Fri Feb 20 09:54:16 2015
From: alexw at nicira.com (Alex Wang)
Date: Fri, 20 Feb 2015 09:54:16 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384
 1385 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404
 1405 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424
 1425 1426 1427 1428 failed
In-Reply-To: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
References: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
Message-ID: <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>

Sorry for this delayed reply,

We found the issue, and working on a fix.  Will send more updates soon,

Thanks,
Alex Wang,

On Tue, Feb 17, 2015 at 4:59 PM, Atanu Ghosh <atanu at acm.org> wrote:

> Hi,
>
> I have been trying to use OVS on FreeBSD 10.1. I have hit a number of
> issues.
>
> 1) This simple command fails:
> k3$ sudo ovs-vsctl add-br br0
> ovs-vsctl: Error detected while setting up 'br0'.  See ovs-vswitchd log
> for details.
>  k3$ sudo ovs-vswitchd
> 2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
> connecting...
> 2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
> connected
> 2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.3.1
> 2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type system
> 2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type system
> 2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath br0 of
> unknown type system
> 2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0: Address
> family not supported by protocol family
>
> 2) I ran "make check" and hit a number of problems with ovsdb-server
> interactions, which were due to set_dscp failing on FreeBSD. I have not
> looked into how to make it work.
>
> diff --git a/socket-util.c b/socket-util.c
> index aa0c719..c17f0d9 100644
> --- a/socket-util.c
> +++ b/socket-util.c
> @@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
>      int val;
>      bool success;
>
> +    return 0;
> +
>      if (dscp > 63) {
>          return EINVAL;
>      }
>
> 3) I ran "make check" again and hit the problems on the subject line. I
> looked at 1381 a little and it doesn't look like it even manages to contact
> the server. I have attached the log file.
>
> My python version:
> k3$ python -V
> Python 2.7.9
>
>         Atanu.
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150220/40bc7441/attachment-0001.html>

From pshelar at nicira.com  Fri Feb 20 09:56:58 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Fri, 20 Feb 2015 09:56:58 -0800
Subject: [ovs-discuss] GRE tunnel outer IP & MAC.
In-Reply-To: <D1027AE8.23ABE%davidjoshuaevans@gmail.com>
References: <D0FFD9A8.233DB%davidjoshuaevans@gmail.com>
 <CALnjE+pz7uuh314-7oFTGiia9ev71-7KOV2A80NVTuWGGLpbWw@mail.gmail.com>
 <D1021C1E.23A29%davidjoshuaevans@gmail.com>
 <D1023EE3.23A97%davidjoshuaevans@gmail.com>
 <CALnjE+ogV4uPbL8mXCo1b=tj3-qRQH9wdS74D2O2VtYwCqnp0A@mail.gmail.com>
 <D1027AE8.23ABE%davidjoshuaevans@gmail.com>
Message-ID: <CALnjE+rnbPgVUCybzt1EBXwh-kiqAig61DT5ifS5aWjX2kXTtQ@mail.gmail.com>

On Thu, Feb 12, 2015 at 1:58 PM, David Evans <davidjoshuaevans at gmail.com> wrote:
> Hi Pravin,
>
> Using ixgbe -> netdev bridge works
>
> ovs-vsctl add-br b0 -- set bridge b0 datapath_type=netdev
> /usr/share/dpdk/tools/dpdk_nic_bind.py -b ixgbe  0000:0a:00.0
> ovs-vsctl add-port b0 enp10s0f0
> ovs-vsctl add-port b0 gre0 -- set Interface gre0 type=gre
> options:remote_ip=192.168.56.101
>
>
> The id is not incremented (don't know if that's important..
> Eg: tcpdump output:
> 08:52:18.006652 00:e0:ed:52:97:cd > 90:e2:ba:38:ad:3c, ethertype IPv4
> (0x0800), length 546: (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto
> GRE (47), length 532)
>     192.168.56.102 > 192.168.56.101: GREv0, Flags [none], proto TEB
> (0x6558), length 512
>         00:00:04:56:78:90 > 00:00:04:04:12:34, ethertype IPv4 (0x0800), length
> 508: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto unknown (255),
> length 494)
>     192.168.168.5 > 192.168.168.1:  ip-proto-255 474
> 08:52:18.006725 00:e0:ed:52:97:cd > 90:e2:ba:38:ad:3c, ethertype IPv4
> (0x0800), length 546: (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto
> GRE (47), length 532)
>     192.168.56.102 > 192.168.56.101: GREv0, Flags [none], proto TEB
> (0x6558), length 512
>         00:00:04:56:78:90 > 00:00:04:04:12:34, ethertype IPv4 (0x0800), length
> 508: (tos 0x0, ttl 64, id 0, offset 0, flags [none], proto unknown (255),
> length 494)
>     192.168.168.5 > 192.168.168.1:  ip-proto-255 474
>
>
>
> If I switch to igb_uio and add the port as dpdk it fails.
>
I tried it on intel 10G nic and it works for me. Can you check OVS
routing table and arp table?

ovs-appctl ovs/route/show
ovs-appctl tnl/arp/show

Thanks,
Pravin.

From alexw at nicira.com  Fri Feb 20 14:32:55 2015
From: alexw at nicira.com (Alex Wang)
Date: Fri, 20 Feb 2015 14:32:55 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384
 1385 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404
 1405 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424
 1425 1426 1427 1428 failed
In-Reply-To: <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>
References: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
 <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>
Message-ID: <CAArS4XVdmiSheiWcfs2T1NYEYs4onfAJPaf9aiAzQMwrmnOH0w@mail.gmail.com>

Hey Atanu,

We pushed the fixes to master and branch-2.3.  I tested on my FreeBSD-9.3
VM.  Everything should work fine now,

Thanks,
Alex Wang,

On Fri, Feb 20, 2015 at 9:54 AM, Alex Wang <alexw at nicira.com> wrote:

> Sorry for this delayed reply,
>
> We found the issue, and working on a fix.  Will send more updates soon,
>
> Thanks,
> Alex Wang,
>
> On Tue, Feb 17, 2015 at 4:59 PM, Atanu Ghosh <atanu at acm.org> wrote:
>
>> Hi,
>>
>> I have been trying to use OVS on FreeBSD 10.1. I have hit a number of
>> issues.
>>
>> 1) This simple command fails:
>> k3$ sudo ovs-vsctl add-br br0
>> ovs-vsctl: Error detected while setting up 'br0'.  See ovs-vswitchd log
>> for details.
>>  k3$ sudo ovs-vswitchd
>> 2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>> connecting...
>> 2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>> connected
>> 2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.3.1
>> 2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type system
>> 2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type system
>> 2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath br0 of
>> unknown type system
>> 2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0:
>> Address family not supported by protocol family
>>
>> 2) I ran "make check" and hit a number of problems with ovsdb-server
>> interactions, which were due to set_dscp failing on FreeBSD. I have not
>> looked into how to make it work.
>>
>> diff --git a/socket-util.c b/socket-util.c
>> index aa0c719..c17f0d9 100644
>> --- a/socket-util.c
>> +++ b/socket-util.c
>> @@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
>>      int val;
>>      bool success;
>>
>> +    return 0;
>> +
>>      if (dscp > 63) {
>>          return EINVAL;
>>      }
>>
>> 3) I ran "make check" again and hit the problems on the subject line. I
>> looked at 1381 a little and it doesn't look like it even manages to contact
>> the server. I have attached the log file.
>>
>> My python version:
>> k3$ python -V
>> Python 2.7.9
>>
>>         Atanu.
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150220/e9177f33/attachment.html>

From andrei.manescu at ivorde.ro  Fri Feb 20 16:07:34 2015
From: andrei.manescu at ivorde.ro (Andrei Manescu)
Date: Sat, 21 Feb 2015 01:07:34 +0100
Subject: [ovs-discuss] userspace datapath (for MPLS and VLAN tagging) seems
	to be broken in 2.3.1
Message-ID: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>

Hello list,

Just started using openvswitch and ran either into a bug or I am missing something. According to various mailing list emails, MPLS label operations are available in userspace datapath. To configure a vswitch in the userspace DP, it needs to be set as a “netdev”, but after doing so, all vswitch operational commands fail with "br0 is not a bridge or a socket”. 

Found a similar report from back in October: http://openvswitch.org/pipermail/discuss/2014-October/015138.html <http://openvswitch.org/pipermail/discuss/2014-October/015138.html>, but I can’t find if the specified commit made it into 2.3.1 or this is a regression bug.

Here is the sequence of commands to reproduce (same error for ovs-ofctl add-flow):

root at pve:~# ovs-vsctl -V
ovs-vsctl (Open vSwitch) 2.3.1
Compiled Dec 27 2014 11:00:30
DB Schema 7.6.2

root at pve:~# ovs-vsctl del-br br0
root at pve:~# ovs-vsctl add-br br0
root at pve:~# ovs-vsctl add-port br0 eth1
root at pve:~# ovs-vsctl add-port br0 tap100i0
root at pve:~# ovs-ofctl show br0
OFPT_FEATURES_REPLY (xid=0x2): dpid:0000000c29e93542
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
 1(eth1): addr:00:0c:29:e9:35:42
     config:     0
     state:      0
     current:    1GB-FD COPPER AUTO_NEG
     advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     speed: 1000 Mbps now, 1000 Mbps max
 2(tap100i0): addr:ae:6f:8b:e7:50:3a
     config:     0
     state:      0
     current:    10MB-FD COPPER
     speed: 10 Mbps now, 0 Mbps max
 LOCAL(br0): addr:00:0c:29:e9:35:42
     config:     PORT_DOWN
     state:      LINK_DOWN
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
root at pve:~# ovs-vsctl set bridge br0 datapath_type=netdev
root at pve:~# ovs-ofctl show br0
ovs-ofctl: br0 is not a bridge or a socket

Regards,
Andrei
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150221/1e4b6f0b/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4154 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150221/1e4b6f0b/attachment-0001.bin>

From andrei.manescu at ivorde.ro  Fri Feb 20 16:55:28 2015
From: andrei.manescu at ivorde.ro (Andrei Manescu)
Date: Sat, 21 Feb 2015 01:55:28 +0100
Subject: [ovs-discuss] userspace datapath (for MPLS and VLAN tagging)
	seems to be broken in 2.3.1
In-Reply-To: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
References: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
Message-ID: <1F58A74E-0A58-4700-84FA-AFE5246C495D@ivorde.ro>

The issue was on 3.10.0-7-pve kernel. After reverting to standard 2.6.32, the problem seems to be gone.

Strange.
Should this still be treated by OVS or proxmox bug ? (the host is proxmox 3.4).


Thanks.
Andrei
> On 21 Feb 2015, at 01:07, Andrei Manescu <andrei.manescu at ivorde.ro> wrote:
> 
> Hello list,
> 
> Just started using openvswitch and ran either into a bug or I am missing something. According to various mailing list emails, MPLS label operations are available in userspace datapath. To configure a vswitch in the userspace DP, it needs to be set as a “netdev”, but after doing so, all vswitch operational commands fail with "br0 is not a bridge or a socket”. 
> 
> Found a similar report from back in October: http://openvswitch.org/pipermail/discuss/2014-October/015138.html <http://openvswitch.org/pipermail/discuss/2014-October/015138.html>, but I can’t find if the specified commit made it into 2.3.1 or this is a regression bug.
> 
> Here is the sequence of commands to reproduce (same error for ovs-ofctl add-flow):
> 
> root at pve:~# ovs-vsctl -V
> ovs-vsctl (Open vSwitch) 2.3.1
> Compiled Dec 27 2014 11:00:30
> DB Schema 7.6.2
> 
> root at pve:~# ovs-vsctl del-br br0
> root at pve:~# ovs-vsctl add-br br0
> root at pve:~# ovs-vsctl add-port br0 eth1
> root at pve:~# ovs-vsctl add-port br0 tap100i0
> root at pve:~# ovs-ofctl show br0
> OFPT_FEATURES_REPLY (xid=0x2): dpid:0000000c29e93542
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>  1(eth1): addr:00:0c:29:e9:35:42
>      config:     0
>      state:      0
>      current:    1GB-FD COPPER AUTO_NEG
>      advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>      supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>      speed: 1000 Mbps now, 1000 Mbps max
>  2(tap100i0): addr:ae:6f:8b:e7:50:3a
>      config:     0
>      state:      0
>      current:    10MB-FD COPPER
>      speed: 10 Mbps now, 0 Mbps max
>  LOCAL(br0): addr:00:0c:29:e9:35:42
>      config:     PORT_DOWN
>      state:      LINK_DOWN
>      speed: 0 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> root at pve:~# ovs-vsctl set bridge br0 datapath_type=netdev
> root at pve:~# ovs-ofctl show br0
> ovs-ofctl: br0 is not a bridge or a socket
> 
> Regards,
> Andrei

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150221/8122310a/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4154 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150221/8122310a/attachment-0001.bin>

From blp at nicira.com  Sat Feb 21 15:12:16 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 21 Feb 2015 15:12:16 -0800
Subject: [ovs-discuss] userspace datapath (for MPLS and VLAN tagging)
 seems to be broken in 2.3.1
In-Reply-To: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
References: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
Message-ID: <20150221231216.GC24165@nicira.com>

On Sat, Feb 21, 2015 at 01:07:34AM +0100, Andrei Manescu wrote:
> Hello list,
> 
> Just started using openvswitch and ran either into a bug or I am missing something. According to various mailing list emails, MPLS label operations are available in userspace datapath. To configure a vswitch in the userspace DP, it needs to be set as a “netdev”, but after doing so, all vswitch operational commands fail with "br0 is not a bridge or a socket”. 
> 
> Found a similar report from back in October: http://openvswitch.org/pipermail/discuss/2014-October/015138.html <http://openvswitch.org/pipermail/discuss/2014-October/015138.html>, but I can’t find if the specified commit made it into 2.3.1 or this is a regression bug.
> 
> Here is the sequence of commands to reproduce (same error for ovs-ofctl add-flow):
> 
> root at pve:~# ovs-vsctl -V
> ovs-vsctl (Open vSwitch) 2.3.1
> Compiled Dec 27 2014 11:00:30
> DB Schema 7.6.2
> 
> root at pve:~# ovs-vsctl del-br br0
> root at pve:~# ovs-vsctl add-br br0
> root at pve:~# ovs-vsctl add-port br0 eth1
> root at pve:~# ovs-vsctl add-port br0 tap100i0
> root at pve:~# ovs-ofctl show br0
> OFPT_FEATURES_REPLY (xid=0x2): dpid:0000000c29e93542
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>  1(eth1): addr:00:0c:29:e9:35:42
>      config:     0
>      state:      0
>      current:    1GB-FD COPPER AUTO_NEG
>      advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>      supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>      speed: 1000 Mbps now, 1000 Mbps max
>  2(tap100i0): addr:ae:6f:8b:e7:50:3a
>      config:     0
>      state:      0
>      current:    10MB-FD COPPER
>      speed: 10 Mbps now, 0 Mbps max
>  LOCAL(br0): addr:00:0c:29:e9:35:42
>      config:     PORT_DOWN
>      state:      LINK_DOWN
>      speed: 0 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> root at pve:~# ovs-vsctl set bridge br0 datapath_type=netdev

What's in the ovs-vswitchd log?

From mark.d.gray at intel.com  Sun Feb 22 09:35:55 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Sun, 22 Feb 2015 17:35:55 +0000
Subject: [ovs-discuss] Tunneling and vhost support for dpdk
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F730695618@IRSMSX102.ger.corp.intel.com>
References: <75F26445-256F-4335-B0FE-4E87F2A079D3@att.com>
 <20141122184218.GA12309@nicira.com>
 <6FF294DC-8EEB-4542-99D2-E1184463ED92@nicira.com>
 <1263C341-A91F-45F1-8AE2-CCAA0334DD36@att.com>
 <BC0FEEC7D7650749874CEC11314A88F730685622@IRSMSX104.ger.corp.intel.com>
 <93A3A2A2-68B1-4DDC-88A0-5D9566451E2B@att.com>
 <BC0FEEC7D7650749874CEC11314A88F730695618@IRSMSX102.ger.corp.intel.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E1C0AD1@IRSMSX108.ger.corp.intel.com>

> > A few questions:
> >
> > Can I use the linux bonding driver and bind the dpdk port to bond0?
> > If not (which I suspect), can I do LACP bonding in OVS when using DPDK?
> 
> No, it's not supported at present
> 
I spent a bit of time looking at active-backup and we will spend more time in
the future. Bonding support in OVS *should* be independent of the netdev 
implementation (correct me if I am wrong?) so it should work with dpdk-netdev.

When you set up a bond, it just adds a bundle to the ofproto provider. Then
if the action for the associated rule outputs to that bundle, when a new flow arrives
before it gets installed in the dpif provider, the active interface is identified
and the flow will get output to that interface.

That said, I spent some time looking at it and I couldn’t get it working. I
think it may have been due to my rather awkward test setup. Two things that are
worth noting though:
1. you need to setup OVS as in normal mode as bonding is only supported
in this mode (according to the FAQ)
2. As the vsctl add-bond commands also tries to add the ports, you need to
add a dpdk bond as follows to ensure they are added as type=dpdk.
ovs-vsctl add-bond br0 dpdkbond0 dpdk0 dpdk1 -- set Interface dpdk0 type=dpdk -- set Interface dpdk1 type=dpdk
  
This may help you. If we look at this in the future, we will reply on this thread.

Mark

From blp at nicira.com  Sun Feb 22 11:27:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 22 Feb 2015 11:27:32 -0800
Subject: [ovs-discuss] IPFIX in upstream kernel
In-Reply-To: <54E7041B.2070908@gmail.com>
References: <54E7041B.2070908@gmail.com>
Message-ID: <20150222192732.GG24165@nicira.com>

On Fri, Feb 20, 2015 at 06:53:31PM +0900, Kentaro Ebisawa wrote:
> Hi,
> 
> Are there any  upstream kernel version which IPFIX works?
> 
> FAQ says I need kernel from OVS version 1.10.90 or later, but does not
> explicitly say which upstream kernel would work.
> So wanted to double check if there are any upstream version which works.
> 
> > Q: What Linux kernel versions does IPFIX flow monitoring work with?
> > A: IPFIX flow monitoring requires the Linux kernel module from Open
> >    vSwitch version 1.10.90 or later.

It looks like this was added to Linux 3.10.

From blp at nicira.com  Sun Feb 22 12:35:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 22 Feb 2015 12:35:13 -0800
Subject: [ovs-discuss] userspace datapath (for MPLS and VLAN tagging)
 seems to be broken in 2.3.1
In-Reply-To: <35947EDB-3FBF-4538-9D48-1A905416D511@ivorde.ro>
References: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
 <20150221231216.GC24165@nicira.com>
 <35947EDB-3FBF-4538-9D48-1A905416D511@ivorde.ro>
Message-ID: <20150222203513.GI24165@nicira.com>

The log is probably longer than that, can you provide the whole thing?

On Sun, Feb 22, 2015 at 09:32:39PM +0100, Andrei Manescu wrote:
> Hi Ben,
> 
> Just reproduced it. Booted back to kernel 3.10.0-7 (it’s proxmox) and after setting the switch as netdev, the error appears again. the log does not get updated when I run a command like “ovs-ofctl show vmbr1” but it got populated when I turned the switch to “netdev” device (logs below).
> 
> Let me know what else I can provide.
> 
> Regards,
> Andrei
> 
> root at pve:~# uname -a
> Linux pve 3.10.0-7-pve #1 SMP Thu Jan 22 11:20:00 CET 2015 x86_64 GNU/Linux
> root at pve:~# ovs-ofctl show vmbr1
> OFPT_FEATURES_REPLY (xid=0x2): dpid:0000000c29e93542
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>  1(eth1): addr:00:0c:29:e9:35:42
>      config:     0
>      state:      0
>      current:    1GB-FD COPPER AUTO_NEG
>      advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>      supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>      speed: 1000 Mbps now, 1000 Mbps max
>  LOCAL(vmbr1): addr:00:0c:29:e9:35:42
>      config:     PORT_DOWN
>      state:      LINK_DOWN
>      speed: 0 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> root at pve:~# ovs-ofctl  dump-flows vmbr1 -O OpenFlow13
> OFPST_FLOW reply (OF1.3) (xid=0x2):
>  cookie=0x0, duration=44.442s, table=0, n_packets=76, n_bytes=7595, priority=0 actions=NORMAL
>  cookie=0x0, duration=24.070s, table=0, n_packets=0, n_bytes=0, in_port=5 actions=push_mpls:0x8847,set_field:10->mpls_label,output:1
> root at pve:~# ovs-vsctl set bridge vmbr1 datapath_type=netdev
> root at pve:~# ovs-ofctl show vmbr1
> ovs-ofctl: vmbr1 is not a bridge or a socket
> root at pve:~# tail -f /var/log/openvswitch/ovs-
> ovs-ctl.log         ovs-ctl.log.1       ovs-vswitchd.log    ovs-vswitchd.log.1
> root at pve:~# tail -f /var/log/openvswitch/ovs-vswitchd.log
> 2015-02-22T20:29:39.515Z|00019|ofproto_dpif|INFO|netdev at ovs-netdev: Datapath supports recirculation
> 2015-02-22T20:29:39.515Z|00020|ofproto_dpif|INFO|netdev at ovs-netdev: MPLS label stack length probed as 3
> 2015-02-22T20:29:39.516Z|00021|bridge|INFO|bridge vmbr1: added interface vmbr1 on port 65534
> 2015-02-22T20:29:39.516Z|00022|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
> 2015-02-22T20:29:39.520Z|00023|bridge|INFO|bridge vmbr1: added interface eth1 on port 1
> 2015-02-22T20:29:39.520Z|00024|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
> 2015-02-22T20:29:39.520Z|00025|bridge|INFO|bridge vmbr1: using datapath ID 0000000c29e93542
> 2015-02-22T20:29:39.520Z|00026|connmgr|INFO|vmbr1: added service controller "punix:/var/run/openvswitch/vmbr1.mgmt"
> 2015-02-22T20:29:42.752Z|00027|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
> 2015-02-22T20:29:42.752Z|00028|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
> 
> 
> 
> 
> root at pve:~# ls /var/run/openvswitch/vmbr1.mgmt
> ls: cannot access /var/run/openvswitch/vmbr1.mgmt: No such file or directory
> 
> 
> 
> > On 22 Feb 2015, at 00:12, Ben Pfaff <blp at nicira.com> wrote:
> > 
> > On Sat, Feb 21, 2015 at 01:07:34AM +0100, Andrei Manescu wrote:
> >> Hello list,
> >> 
> >> Just started using openvswitch and ran either into a bug or I am missing something. According to various mailing list emails, MPLS label operations are available in userspace datapath. To configure a vswitch in the userspace DP, it needs to be set as a “netdev”, but after doing so, all vswitch operational commands fail with "br0 is not a bridge or a socket”. 
> >> 
> >> Found a similar report from back in October: http://openvswitch.org/pipermail/discuss/2014-October/015138.html <http://openvswitch.org/pipermail/discuss/2014-October/015138.html>, but I can’t find if the specified commit made it into 2.3.1 or this is a regression bug.
> >> 
> >> Here is the sequence of commands to reproduce (same error for ovs-ofctl add-flow):
> >> 
> >> root at pve:~# ovs-vsctl -V
> >> ovs-vsctl (Open vSwitch) 2.3.1
> >> Compiled Dec 27 2014 11:00:30
> >> DB Schema 7.6.2
> >> 
> >> root at pve:~# ovs-vsctl del-br br0
> >> root at pve:~# ovs-vsctl add-br br0
> >> root at pve:~# ovs-vsctl add-port br0 eth1
> >> root at pve:~# ovs-vsctl add-port br0 tap100i0
> >> root at pve:~# ovs-ofctl show br0
> >> OFPT_FEATURES_REPLY (xid=0x2): dpid:0000000c29e93542
> >> n_tables:254, n_buffers:256
> >> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> >> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
> >> 1(eth1): addr:00:0c:29:e9:35:42
> >>     config:     0
> >>     state:      0
> >>     current:    1GB-FD COPPER AUTO_NEG
> >>     advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
> >>     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
> >>     speed: 1000 Mbps now, 1000 Mbps max
> >> 2(tap100i0): addr:ae:6f:8b:e7:50:3a
> >>     config:     0
> >>     state:      0
> >>     current:    10MB-FD COPPER
> >>     speed: 10 Mbps now, 0 Mbps max
> >> LOCAL(br0): addr:00:0c:29:e9:35:42
> >>     config:     PORT_DOWN
> >>     state:      LINK_DOWN
> >>     speed: 0 Mbps now, 0 Mbps max
> >> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> >> root at pve:~# ovs-vsctl set bridge br0 datapath_type=netdev
> > 
> > What's in the ovs-vswitchd log?
> 



From blp at nicira.com  Sun Feb 22 12:42:38 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 22 Feb 2015 12:42:38 -0800
Subject: [ovs-discuss] userspace datapath (for MPLS and VLAN tagging)
 seems to be broken in 2.3.1
In-Reply-To: <AB72A333-F64F-4DEC-A92F-13CE4BA826D9@ivorde.ro>
References: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
 <20150221231216.GC24165@nicira.com>
 <35947EDB-3FBF-4538-9D48-1A905416D511@ivorde.ro>
 <20150222203513.GI24165@nicira.com>
 <AB72A333-F64F-4DEC-A92F-13CE4BA826D9@ivorde.ro>
Message-ID: <20150222204238.GJ24165@nicira.com>

Does it make any difference if you set the datapath type as part of
creating the bridge instead of afterward?  Or if you restart vswitchd
after setting the datapath type?

On Sun, Feb 22, 2015 at 09:40:22PM +0100, Andrei Manescu wrote:
> Nope. That’s the whole thing AFTER I set the ‘netdev’ switch:
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 
> 2015-02-22T20:39:05.099Z|00018|ofproto_dpif|INFO|netdev at ovs-netdev: Datapath supports recirculation
> 2015-02-22T20:39:05.099Z|00019|ofproto_dpif|INFO|netdev at ovs-netdev: MPLS label stack length probed as 3
> 2015-02-22T20:39:05.099Z|00020|bridge|INFO|bridge vmbr1: added interface vmbr1 on port 65534
> 2015-02-22T20:39:05.099Z|00021|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
> 2015-02-22T20:39:05.102Z|00022|bridge|INFO|bridge vmbr1: added interface eth1 on port 1
> 2015-02-22T20:39:05.102Z|00023|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
> 2015-02-22T20:39:05.102Z|00024|bridge|INFO|bridge vmbr1: using datapath ID 0000000c29e93542
> 2015-02-22T20:39:05.102Z|00025|connmgr|INFO|vmbr1: added service controller "punix:/var/run/openvswitch/vmbr1.mgmt"
> 2015-02-22T20:39:08.079Z|00026|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
> 2015-02-22T20:39:08.079Z|00027|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
> 
> Anyway specific debugs I can enable ?
> 
> 
> 
> 
> 
> > On 22 Feb 2015, at 21:35, Ben Pfaff <blp at nicira.com> wrote:
> > 
> > The log is probably longer than that, can you provide the whole thing?
> 



From blp at nicira.com  Sun Feb 22 13:08:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 22 Feb 2015 13:08:29 -0800
Subject: [ovs-discuss] userspace datapath (for MPLS and VLAN tagging)
 seems to be broken in 2.3.1
In-Reply-To: <6F2C45B2-BCB0-4111-8FC8-2ABD9D1F7D09@ivorde.ro>
References: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
 <20150221231216.GC24165@nicira.com>
 <35947EDB-3FBF-4538-9D48-1A905416D511@ivorde.ro>
 <20150222203513.GI24165@nicira.com>
 <AB72A333-F64F-4DEC-A92F-13CE4BA826D9@ivorde.ro>
 <20150222204238.GJ24165@nicira.com>
 <6F2C45B2-BCB0-4111-8FC8-2ABD9D1F7D09@ivorde.ro>
Message-ID: <20150222210829.GK24165@nicira.com>

OK, since it works when vswitchd is freshly started, that means it's a
bug in switching a bridge at runtime between the kernel and userspace
datapaths.  That doesn't get much testing so problems do come up from
time to time.

You restart vswitchd with its init script, which is probably
/etc/init.d/openvswitch or /etc/init.d/openvswitch-switch.

You can confirm that it's a netdev device by running "ovs-dpctl show";
if your devices don't show up there then it's not kernel-based.

On Sun, Feb 22, 2015 at 10:01:55PM +0100, Andrei Manescu wrote:
> Didn’t find how to gracefully restart vswitchd (no init script). After rebooting the hypervisor, it’s gone. I tried adding a new switch and set the dp type at creation and it still works.
> root at pve:~# ovs-vsctl add-br vmbr2  -- set bridge vmbr2 datapath_type=netdev
> root at pve:~# ovs-ofctl show vmbr2
> OFPT_FEATURES_REPLY (xid=0x2): dpid:00006a2ebc0d894a
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>  LOCAL(vmbr2): addr:6a:2e:bc:0d:89:4a
>      config:     PORT_DOWN
>      state:      LINK_DOWN
>      current:    10MB-FD COPPER
>      speed: 10 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> 
> 
> P.S.: Anyway I can restart vswitchd ? From ovs-vsctl maybe ? How do I confirm it’s still a “netdev” device ? I see MPLS label is being pushed so I don’t doubt that. Just learning bit by bit.
> 
> 
> Would you
> Thanks.
> 
> 
> > On 22 Feb 2015, at 21:42, Ben Pfaff <blp at nicira.com> wrote:
> > 
> > Does it make any difference if you set the datapath type as part of
> > creating the bridge instead of afterward?  Or if you restart vswitchd
> > after setting the datapath type?
> > 
> > On Sun, Feb 22, 2015 at 09:40:22PM +0100, Andrei Manescu wrote:
> >> Nope. That’s the whole thing AFTER I set the ‘netdev’ switch:
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 
> >> 2015-02-22T20:39:05.099Z|00018|ofproto_dpif|INFO|netdev at ovs-netdev: Datapath supports recirculation
> >> 2015-02-22T20:39:05.099Z|00019|ofproto_dpif|INFO|netdev at ovs-netdev: MPLS label stack length probed as 3
> >> 2015-02-22T20:39:05.099Z|00020|bridge|INFO|bridge vmbr1: added interface vmbr1 on port 65534
> >> 2015-02-22T20:39:05.099Z|00021|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
> >> 2015-02-22T20:39:05.102Z|00022|bridge|INFO|bridge vmbr1: added interface eth1 on port 1
> >> 2015-02-22T20:39:05.102Z|00023|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
> >> 2015-02-22T20:39:05.102Z|00024|bridge|INFO|bridge vmbr1: using datapath ID 0000000c29e93542
> >> 2015-02-22T20:39:05.102Z|00025|connmgr|INFO|vmbr1: added service controller "punix:/var/run/openvswitch/vmbr1.mgmt"
> >> 2015-02-22T20:39:08.079Z|00026|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
> >> 2015-02-22T20:39:08.079Z|00027|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
> >> 
> >> Anyway specific debugs I can enable ?
> >> 
> >> 
> >> 
> >> 
> >> 
> >>> On 22 Feb 2015, at 21:35, Ben Pfaff <blp at nicira.com> wrote:
> >>> 
> >>> The log is probably longer than that, can you provide the whole thing?
> >> 
> > 
> > 
> 



From sandesh1 at ualberta.ca  Sun Feb 22 13:11:04 2015
From: sandesh1 at ualberta.ca (Sandesh Shrestha)
Date: Sun, 22 Feb 2015 14:11:04 -0700
Subject: [ovs-discuss] Network Monitoring in software defined networks
Message-ID: <CAL8bN2mHUNXk0BahWUOZ52mjK-zuVxDM0B2toPiDNrK-w_45VQ@mail.gmail.com>

Dear All,

I have an open vswitch connected to a mininet host acting as a http server.
I want to monitor the bandwidth and delay of the link between open vswitch
and server.
How can I do that using openvswitch and controller like pox(or anything
else)

Thanks,
Sandesh Shrestha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150222/f3d9914d/attachment-0001.html>

From scott.lowe at scottlowe.org  Mon Feb 23 09:23:01 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Mon, 23 Feb 2015 10:23:01 -0700
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
 <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
 <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>
Message-ID: <7410C5DA-7F4A-4368-9603-7AB9D469497B@scottlowe.org>

Please see my responses inline, prefixed by [SL].

jayakeerthi k <jayakeerthik82 at gmail.com> wrote:

> sorry for the delay,
> libvirt version is 1.2.2
> ovs_version: "2.0.2"
> i'm installing it through Virt-manager.
> xml file is
> 
> <snip>
> 
>     <interface type='bridge'>
>       <mac address='52:54:00:f1:51:47'/>
>       <source bridge='1511'/>
>       <model type='virtio'/>
>       <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
>     </interface>


[SL] This section is the issue. The guest domain (VM) is set to use a bridge ("1511"?), but you haven't specified "virtualport type=openvswitch", so Libvirt isn't able to properly communicate with OVS.

If you look at the example XML that I supplied here:

<http://blog.scottlowe.org/2012/11/12/libvirt-ovs-integration-revisited/>

then you can see a snippet of network XML configuration that *will* work with OVS. This should get you started down the right path.

Good luck!

> On Thu, Feb 19, 2015 at 10:47 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> Please see my responses inline, prefixed by [SL].
> 
> jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> 
> > OK..
> >
> > when i try to create vm i'm gettting error unable to add vnet0 port on the
> > bridge br3.
> 
> [SL] Jayakeerthi, can you share the following information to help us help
> you?
> 
> - The network portion of the domain XML configuration for your VM (obtained
> via 'virsh dumpxml <vm-name>'
> 
> - The versions of OVS and libvirt installed on your system
> 
> - The command(s) you are using to create and/or start the VM
> 
> Feel free to use a service like pastebin.com to share the domain XML
> configuration, if you'd like.
> 
> Thanks!
> 
> >> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com> wrote:
> >>
> >> I don't think you can. KVM creates the port, OVS only handles switching.
> >>
> >>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
> >>>
> >>> how to create port's in openvswitch that can be assigned to vm created
> >>> with KVM?


--
Scott


From abhishek.lists at gmail.com  Mon Feb 23 10:35:45 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Mon, 23 Feb 2015 10:35:45 -0800
Subject: [ovs-discuss] =?utf-8?q?=28no_subject=29?=
Message-ID: <CACom5vprY3UKVDruFtHYp=BLQhJ4WXODDDnD+k-iDQRK9+oxOw@mail.gmail.com>

HI all,

I am running openstack in containers. My compute container has the
standard OVS setup for neutron:

mngmt3:/opt/openstack # ovs-vsctl show
afc8ab2b-96b4-4363-b258-660efeb5f92f
    Bridge br-tun
        Port br-tun
            Interface br-tun
                type: internal
        Port patch-int
            Interface patch-int
                type: patch
                options: {peer=patch-tun}
        Port "vxlan-ac1a400c"
            Interface "vxlan-ac1a400c"
                type: vxlan
                options: {df_default="true", in_key=flow,
local_ip="172.26.64.13", out_key=flow, remote_ip="172.26.64.12"}
    Bridge br-int
        fail_mode: secure
        Port int-br-ex
            Interface int-br-ex
                type: patch
                options: {peer=phy-br-ex}
        Port "qvo020cae33-fb"
            Interface "qvo020cae33-fb"
        Port br-int
            Interface br-int
                type: internal
        Port patch-tun
            Interface patch-tun
                type: patch
                options: {peer=patch-int}
    Bridge br-ex
        Port phy-br-ex
            Interface phy-br-ex
                type: patch
                options: {peer=int-br-ex}
        Port br-ex
            Interface br-ex
                type: internal
        Port "eth0"
            Interface "eth0"
    ovs_version: "2.1.3"

mngmt3:/opt/openstack # brctl show
bridge name            bridge id                       STP enabled
         interfaces
docker0                   8000.56847afe9799      no
qbr020cae33-fb        8000.bea5fc15ea51     no
    qvb020cae33-fb

                                tap020cae33-fb

mngmt3:/opt/openstack # ovs-ofctl dump-flows br-int
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=245697.535s, table=0, n_packets=25253,
n_bytes=8125454, idle_age=10, hard_age=65534, priority=1
actions=NORMAL
 cookie=0x0, duration=245696.905s, table=0, n_packets=59,
n_bytes=3540, idle_age=1680, hard_age=65534, priority=2,in_port=1
actions=drop
 cookie=0x0, duration=245697.516s, table=23, n_packets=0, n_bytes=0,
idle_age=65534, hard_age=65534, priority=0 actions=drop

mngmt3:/opt/openstack # ovs-ofctl dump-flows br-tun
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=245702.144s, table=0, n_packets=2, n_bytes=180,
idle_age=65534, hard_age=65534, priority=0 actions=drop
 cookie=0x0, duration=245702.152s, table=0, n_packets=25251,
n_bytes=8125274, idle_age=15, hard_age=65534, priority=1,in_port=1
actions=resubmit(,2)
 cookie=0x0, duration=245701.592s, table=0, n_packets=1, n_bytes=90,
idle_age=65534, hard_age=65534, priority=1,in_port=2
actions=resubmit(,4)
 cookie=0x0, duration=245702.127s, table=2, n_packets=25251,
n_bytes=8125274, idle_age=15, hard_age=65534,
priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00
actions=resubmit(,22)
 cookie=0x0, duration=245702.136s, table=2, n_packets=0, n_bytes=0,
idle_age=65534, hard_age=65534,
priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00
actions=resubmit(,20)
 cookie=0x0, duration=245702.118s, table=3, n_packets=0, n_bytes=0,
idle_age=65534, hard_age=65534, priority=0 actions=drop
 cookie=0x0, duration=245702.110s, table=4, n_packets=1, n_bytes=90,
idle_age=65534, hard_age=65534, priority=0 actions=drop
 cookie=0x0, duration=245702.101s, table=10, n_packets=0, n_bytes=0,
idle_age=65534, hard_age=65534, priority=1
actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
 cookie=0x0, duration=245702.093s, table=20, n_packets=0, n_bytes=0,
idle_age=65534, hard_age=65534, priority=0 actions=resubmit(,22)
 cookie=0x0, duration=245702.084s, table=22, n_packets=25251,
n_bytes=8125274, idle_age=15, hard_age=65534, priority=0 actions=drop

When I start a VM, it sends DHCP broadcast which never reaches br-tun.
Here is what I see:
1. tcpdump on tap020cae33-fb, which is the VM's interface on the host,
shows outgoing DHCP broadcasts.
2. Those also show up in qbr020cae33-fb, qvb020cae33-fb and br-int
3. No traffic shows up in br-tun

>From the FAQ, I do understand that two bridges connected by patch
ports is equivalent to a single bridge. So I expected traffic to show
up on br-tun.

How should I debug this?

Thanks

From pshelar at nicira.com  Mon Feb 23 11:04:12 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Mon, 23 Feb 2015 11:04:12 -0800
Subject: [ovs-discuss] [ovs-dev] Open vSwitch STT support
In-Reply-To: <CACaajQvZ2Goo5qXSL3pBHkybTPGN_c1G6Tp+LvbZknvhBKz_kA@mail.gmail.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
 <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
 <20150203181956.GA9500@tuxdriver.com>
 <CALnjE+pDG8G1=g-rJHpcn324X4nz8Pi9PthnMiz63mYbJx2yYA@mail.gmail.com>
 <20150205111643.GB733@pox.localdomain>
 <CACaajQsKhrS4F=qJaGK85WOnb-zzkG0_J520815-kK4MOiwL_Q@mail.gmail.com>
 <CACaajQvZ2Goo5qXSL3pBHkybTPGN_c1G6Tp+LvbZknvhBKz_kA@mail.gmail.com>
Message-ID: <CALnjE+rMMC+m6mk93jsTAjgfgtqvF6_92DEqkW85jaXLuHa7Ag@mail.gmail.com>

On Mon, Feb 23, 2015 at 5:51 AM, Vasiliy Tolstov <v.tolstov at selfip.ru> wrote:
> 2015-02-05 16:56 GMT+03:00 Vasiliy Tolstov <v.tolstov at selfip.ru>:
>> As STT have performance benefits to me (i'm use tunnels to transfer traffic
>> from vps also i have mutipath tcp enabled hosts to decrease cost in switches
>> that not have stacking support), i'm very happy if STT integrated with
>> openvswitch data path module. I look forward =)
>
>
> Do you have any plans to add STT support to next ovs release?
>
I am working on STT support for OVS repo. I hope it will get into 2.4.


> --
> Vasiliy Tolstov,
> e-mail: v.tolstov at selfip.ru
> jabber: vase at selfip.ru

From abhishek.lists at gmail.com  Mon Feb 23 15:38:14 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Mon, 23 Feb 2015 15:38:14 -0800
Subject: [ovs-discuss] Traffic between bridges
Message-ID: <CACom5vq6UXReU7u0nmopwC0ZY4KAZdMGBY36gb+2T7arkY3zNw@mail.gmail.com>

Sorry, I sent the mail before writing a title.

On Mon, Feb 23, 2015 at 10:35 AM, Abhishek Chanda
<abhishek.lists at gmail.com> wrote:
> HI all,
>
> I am running openstack in containers. My compute container has the
> standard OVS setup for neutron:
>
> mngmt3:/opt/openstack # ovs-vsctl show
> afc8ab2b-96b4-4363-b258-660efeb5f92f
>     Bridge br-tun
>         Port br-tun
>             Interface br-tun
>                 type: internal
>         Port patch-int
>             Interface patch-int
>                 type: patch
>                 options: {peer=patch-tun}
>         Port "vxlan-ac1a400c"
>             Interface "vxlan-ac1a400c"
>                 type: vxlan
>                 options: {df_default="true", in_key=flow,
> local_ip="172.26.64.13", out_key=flow, remote_ip="172.26.64.12"}
>     Bridge br-int
>         fail_mode: secure
>         Port int-br-ex
>             Interface int-br-ex
>                 type: patch
>                 options: {peer=phy-br-ex}
>         Port "qvo020cae33-fb"
>             Interface "qvo020cae33-fb"
>         Port br-int
>             Interface br-int
>                 type: internal
>         Port patch-tun
>             Interface patch-tun
>                 type: patch
>                 options: {peer=patch-int}
>     Bridge br-ex
>         Port phy-br-ex
>             Interface phy-br-ex
>                 type: patch
>                 options: {peer=int-br-ex}
>         Port br-ex
>             Interface br-ex
>                 type: internal
>         Port "eth0"
>             Interface "eth0"
>     ovs_version: "2.1.3"
>
> mngmt3:/opt/openstack # brctl show
> bridge name            bridge id                       STP enabled
>          interfaces
> docker0                   8000.56847afe9799      no
> qbr020cae33-fb        8000.bea5fc15ea51     no
>     qvb020cae33-fb
>
>                                 tap020cae33-fb
>
> mngmt3:/opt/openstack # ovs-ofctl dump-flows br-int
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=245697.535s, table=0, n_packets=25253,
> n_bytes=8125454, idle_age=10, hard_age=65534, priority=1
> actions=NORMAL
>  cookie=0x0, duration=245696.905s, table=0, n_packets=59,
> n_bytes=3540, idle_age=1680, hard_age=65534, priority=2,in_port=1
> actions=drop
>  cookie=0x0, duration=245697.516s, table=23, n_packets=0, n_bytes=0,
> idle_age=65534, hard_age=65534, priority=0 actions=drop
>
> mngmt3:/opt/openstack # ovs-ofctl dump-flows br-tun
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=245702.144s, table=0, n_packets=2, n_bytes=180,
> idle_age=65534, hard_age=65534, priority=0 actions=drop
>  cookie=0x0, duration=245702.152s, table=0, n_packets=25251,
> n_bytes=8125274, idle_age=15, hard_age=65534, priority=1,in_port=1
> actions=resubmit(,2)
>  cookie=0x0, duration=245701.592s, table=0, n_packets=1, n_bytes=90,
> idle_age=65534, hard_age=65534, priority=1,in_port=2
> actions=resubmit(,4)
>  cookie=0x0, duration=245702.127s, table=2, n_packets=25251,
> n_bytes=8125274, idle_age=15, hard_age=65534,
> priority=0,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00
> actions=resubmit(,22)
>  cookie=0x0, duration=245702.136s, table=2, n_packets=0, n_bytes=0,
> idle_age=65534, hard_age=65534,
> priority=0,dl_dst=00:00:00:00:00:00/01:00:00:00:00:00
> actions=resubmit(,20)
>  cookie=0x0, duration=245702.118s, table=3, n_packets=0, n_bytes=0,
> idle_age=65534, hard_age=65534, priority=0 actions=drop
>  cookie=0x0, duration=245702.110s, table=4, n_packets=1, n_bytes=90,
> idle_age=65534, hard_age=65534, priority=0 actions=drop
>  cookie=0x0, duration=245702.101s, table=10, n_packets=0, n_bytes=0,
> idle_age=65534, hard_age=65534, priority=1
> actions=learn(table=20,hard_timeout=300,priority=1,NXM_OF_VLAN_TCI[0..11],NXM_OF_ETH_DST[]=NXM_OF_ETH_SRC[],load:0->NXM_OF_VLAN_TCI[],load:NXM_NX_TUN_ID[]->NXM_NX_TUN_ID[],output:NXM_OF_IN_PORT[]),output:1
>  cookie=0x0, duration=245702.093s, table=20, n_packets=0, n_bytes=0,
> idle_age=65534, hard_age=65534, priority=0 actions=resubmit(,22)
>  cookie=0x0, duration=245702.084s, table=22, n_packets=25251,
> n_bytes=8125274, idle_age=15, hard_age=65534, priority=0 actions=drop
>
> When I start a VM, it sends DHCP broadcast which never reaches br-tun.
> Here is what I see:
> 1. tcpdump on tap020cae33-fb, which is the VM's interface on the host,
> shows outgoing DHCP broadcasts.
> 2. Those also show up in qbr020cae33-fb, qvb020cae33-fb and br-int
> 3. No traffic shows up in br-tun
>
> From the FAQ, I do understand that two bridges connected by patch
> ports is equivalent to a single bridge. So I expected traffic to show
> up on br-tun.
>
> How should I debug this?
>
> Thanks

From v.tolstov at selfip.ru  Mon Feb 23 22:17:36 2015
From: v.tolstov at selfip.ru (Vasiliy Tolstov)
Date: Tue, 24 Feb 2015 10:17:36 +0400
Subject: [ovs-discuss] [ovs-dev] Open vSwitch STT support
In-Reply-To: <CALnjE+rMMC+m6mk93jsTAjgfgtqvF6_92DEqkW85jaXLuHa7Ag@mail.gmail.com>
References: <CALnjE+oCNM71yWKUyyLVfqKiJstU-qcn9snwTGDT0CYCcQBN3g@mail.gmail.com>
 <20150202192016.GA13141@tuxdriver.com>
 <CALnjE+otWQMD=AdeGv39ThT_YEiJCkvwcOkDYjgbFRkOn_xbwA@mail.gmail.com>
 <20150203181956.GA9500@tuxdriver.com>
 <CALnjE+pDG8G1=g-rJHpcn324X4nz8Pi9PthnMiz63mYbJx2yYA@mail.gmail.com>
 <20150205111643.GB733@pox.localdomain>
 <CACaajQsKhrS4F=qJaGK85WOnb-zzkG0_J520815-kK4MOiwL_Q@mail.gmail.com>
 <CACaajQvZ2Goo5qXSL3pBHkybTPGN_c1G6Tp+LvbZknvhBKz_kA@mail.gmail.com>
 <CALnjE+rMMC+m6mk93jsTAjgfgtqvF6_92DEqkW85jaXLuHa7Ag@mail.gmail.com>
Message-ID: <CACaajQvF8Y84tcA8wFSwEKw_OQyyf9wvvrPkc8uo43gneq3Wqg@mail.gmail.com>

2015-02-23 22:04 GMT+03:00 Pravin Shelar <pshelar at nicira.com>:
> I am working on STT support for OVS repo. I hope it will get into 2.4.


Thanks!

-- 
Vasiliy Tolstov,
e-mail: v.tolstov at selfip.ru
jabber: vase at selfip.ru

From chetan.bali at aricent.com  Tue Feb 24 05:33:29 2015
From: chetan.bali at aricent.com (Chetan Bali)
Date: Tue, 24 Feb 2015 13:33:29 +0000
Subject: [ovs-discuss] query related to GRE encapsulation
Message-ID: <97d1f519234e463e89ecf9f88882dbe6@GURMBXV02.AD.ARICENT.COM>

Hi,

I am configuring gre-port in my ovs bridge, for establishing gre-tunnel between 2 machines. I am trying to parse the tunnelling key params sent by OVS while adding flow, when it sets action as OVS_ACTION_ATTR_SET. I am parsing the tun-key attributes in dpif-linux.c in exact manner as ovs does, i.e., nla_data(nla_data(action)) where action is in "nlattr"  type. Tun-key params that I am trying to fetch are as per struct "ovs_key_ipv4_tunnel" i.e.,
struct ovs_key_ipv4_tunnel {
    __be64 tun_id;
    __be32 ipv4_src;
    __be32 ipv4_dst;
    __be16 tun_flags;
    u8   ipv4_tos;
    u8   ipv4_ttl;
};
The problem is that, while parsing I am getting incorrect tun-key params, whereas I can see by putting prints that openvswitchd.ko is getting correct tun-key params.

Please help how I can parse the tun-key params in my own dpif class plugin and also let me know if I am parsing the tun-key params in correct manner.

Thanks
Chetan
"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150224/d19583d4/attachment.html>

From inaki.murilloa at ehu.eus  Tue Feb 24 08:42:16 2015
From: inaki.murilloa at ehu.eus (=?UTF-8?B?ScOxYWtpTXVyaWxsbw==?=)
Date: Tue, 24 Feb 2015 17:42:16 +0100
Subject: [ovs-discuss] Fwd: Doubt: QEMU <-> OVS using DPDK
In-Reply-To: <20150211154918.Horde.GusL15O-_ZpdikbZDP7FsQ4@www.ehu.eus>
References: <20150211154918.Horde.GusL15O-_ZpdikbZDP7FsQ4@www.ehu.eus>
Message-ID: <54ECA9E8.6090802@ehu.eus>



Hello,

I am trying to connect a virtual machine with a openvswitch using DPDK
for performance, as you can see in the next figure.

+-----------------------------------------------+
| QMEU VM                                       |
|                                               |
|                          +--------+--------+  |
|                          |    DPDK  APP    |  |
|                          |                 |  |
|                          +--------^--------+  |
|                                   |           |
|                          +--------V--------+  |
|                          |   DPDK virtual  |  |
|                          |    interface    |  |
+--------------------------+--------^--------+--+
                                     |   Ivshmen ¿?
                                     |   MEMNIC  ¿?
                                     |
+-----+--------------------+--------V--------+--+
|  OVS+DPDK                |   DPDK virtual  |  |
|                          |    interface    |  |
|                          +-----------------+  |
|                                               |
|                                               |
|  +--------------+         +----------------+  |
|  |              |         |                |  |
+--+------^-------+---------+----------^-----+--+
           |                            |
           |                            |
           |                            |
+---------V---+                 +------V--------+
|  10G NIC    |                 |  10G NIC      |
|   DPDK      |                 |   DPDK        |
+-------------+                 +---------------+

I do not have any problem connecting with 10G NICs, but I do have when
it comes to QEMU. I am nor pretty sure how to connect qemu with ovs.

As far as I know, I think that I have to use MEMNIC or Ivshmem, but I
cannot find much information about how to do it.

Could someone explain to me how can it be done?

Thank you in advanced.

Iñaki Murillo





From blp at nicira.com  Tue Feb 24 08:44:48 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 24 Feb 2015 08:44:48 -0800
Subject: [ovs-discuss] query related to GRE encapsulation
In-Reply-To: <97d1f519234e463e89ecf9f88882dbe6@GURMBXV02.AD.ARICENT.COM>
References: <97d1f519234e463e89ecf9f88882dbe6@GURMBXV02.AD.ARICENT.COM>
Message-ID: <20150224164448.GE17053@nicira.com>

On Tue, Feb 24, 2015 at 01:33:29PM +0000, Chetan Bali wrote:
> I am configuring gre-port in my ovs bridge, for establishing gre-tunnel between 2 machines. I am trying to parse the tunnelling key params sent by OVS while adding flow, when it sets action as OVS_ACTION_ATTR_SET. I am parsing the tun-key attributes in dpif-linux.c in exact manner as ovs does, i.e., nla_data(nla_data(action)) where action is in "nlattr"  type. Tun-key params that I am trying to fetch are as per struct "ovs_key_ipv4_tunnel" i.e.,
> struct ovs_key_ipv4_tunnel {
>     __be64 tun_id;
>     __be32 ipv4_src;
>     __be32 ipv4_dst;
>     __be16 tun_flags;
>     u8   ipv4_tos;
>     u8   ipv4_ttl;
> };
> The problem is that, while parsing I am getting incorrect tun-key params, whereas I can see by putting prints that openvswitchd.ko is getting correct tun-key params.

I guess you're doing something wrong.  Show us your code?

From chetan.bali at aricent.com  Tue Feb 24 09:00:31 2015
From: chetan.bali at aricent.com (Chetan Bali)
Date: Tue, 24 Feb 2015 17:00:31 +0000
Subject: [ovs-discuss] query related to GRE encapsulation
In-Reply-To: <20150224164448.GE17053@nicira.com>
References: <97d1f519234e463e89ecf9f88882dbe6@GURMBXV02.AD.ARICENT.COM>
 <20150224164448.GE17053@nicira.com>
Message-ID: <4a04405a40c84bbd9fd2b3c424383c62@GURMBXV02.AD.ARICENT.COM>

Hi Ben,

Thanks for the quick response. Please find the code snippet below:

This below function is called from flow_put in dpif class code.

uint8_t dpif_tunnel_parse_actions(s_action_t *action_list, const struct nlattr *actions, size_t actions_len, struct flow_tnl *tun_param)
{
if(OVS_LIKELY(NULL != actions))
    {
        NL_ATTR_FOR_EACH_UNSAFE(a, len, actions, actions_len)
        {
            switch (nl_attr_type(a))
            {
                case OVS_ACTION_ATTR_SET:
                    VLOG_INFO("Action type is ACTION_SET \n");
                        action_list[num_action].action_type = ACTION_SET_IPV4_TUNNEL;
                    if (nla_type(nla_data(a)) == OVS_KEY_ATTR_TUNNEL)
                    {
                        tun_param = nla_data(nla_data(a));
                        VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TUN_ID : %u\n",tun_param->tun_id);
                        VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL SRC_ADRR : %x\n",ntohl(tun_param->ipv4_src));
                        VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL SRC_DST : %x\n",ntohl(tun_param->ipv4_dst));
                        VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TUN_FLAG : %u\n",tun_param->tun_flags);
                        VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TOS : %u\n",tun_param->ipv4_tos);
                        VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TTL : %u\n",tun_param->ipv4_ttl);
                    }

We are not getting correct values of tun_id, tun_src, tun_dst, tun_ttl, etc.

It will be great if you could help us here.

Thanks
Chetan Bali

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com]
Sent: 24 February 2015 22:15
To: Chetan Bali
Cc: dev at openvswitch.org; discuss at openvswitch.org; Mohit Malik
Subject: Re: [ovs-discuss] query related to GRE encapsulation

On Tue, Feb 24, 2015 at 01:33:29PM +0000, Chetan Bali wrote:
> I am configuring gre-port in my ovs bridge, for establishing
> gre-tunnel between 2 machines. I am trying to parse the tunnelling key params sent by OVS while adding flow, when it sets action as OVS_ACTION_ATTR_SET. I am parsing the tun-key attributes in dpif-linux.c in exact manner as ovs does, i.e., nla_data(nla_data(action)) where action is in "nlattr"  type. Tun-key params that I am trying to fetch are as per struct "ovs_key_ipv4_tunnel" i.e., struct ovs_key_ipv4_tunnel {
>     __be64 tun_id;
>     __be32 ipv4_src;
>     __be32 ipv4_dst;
>     __be16 tun_flags;
>     u8   ipv4_tos;
>     u8   ipv4_ttl;
> };
> The problem is that, while parsing I am getting incorrect tun-key params, whereas I can see by putting prints that openvswitchd.ko is getting correct tun-key params.

I guess you're doing something wrong.  Show us your code?
"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."

From andrei.manescu at ivorde.ro  Sun Feb 22 12:32:39 2015
From: andrei.manescu at ivorde.ro (Andrei Manescu)
Date: Sun, 22 Feb 2015 21:32:39 +0100
Subject: [ovs-discuss] userspace datapath (for MPLS and VLAN tagging)
	seems to be broken in 2.3.1
In-Reply-To: <20150221231216.GC24165@nicira.com>
References: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
 <20150221231216.GC24165@nicira.com>
Message-ID: <35947EDB-3FBF-4538-9D48-1A905416D511@ivorde.ro>

Hi Ben,

Just reproduced it. Booted back to kernel 3.10.0-7 (it’s proxmox) and after setting the switch as netdev, the error appears again. the log does not get updated when I run a command like “ovs-ofctl show vmbr1” but it got populated when I turned the switch to “netdev” device (logs below).

Let me know what else I can provide.

Regards,
Andrei

root at pve:~# uname -a
Linux pve 3.10.0-7-pve #1 SMP Thu Jan 22 11:20:00 CET 2015 x86_64 GNU/Linux
root at pve:~# ovs-ofctl show vmbr1
OFPT_FEATURES_REPLY (xid=0x2): dpid:0000000c29e93542
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
 1(eth1): addr:00:0c:29:e9:35:42
     config:     0
     state:      0
     current:    1GB-FD COPPER AUTO_NEG
     advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     speed: 1000 Mbps now, 1000 Mbps max
 LOCAL(vmbr1): addr:00:0c:29:e9:35:42
     config:     PORT_DOWN
     state:      LINK_DOWN
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
root at pve:~# ovs-ofctl  dump-flows vmbr1 -O OpenFlow13
OFPST_FLOW reply (OF1.3) (xid=0x2):
 cookie=0x0, duration=44.442s, table=0, n_packets=76, n_bytes=7595, priority=0 actions=NORMAL
 cookie=0x0, duration=24.070s, table=0, n_packets=0, n_bytes=0, in_port=5 actions=push_mpls:0x8847,set_field:10->mpls_label,output:1
root at pve:~# ovs-vsctl set bridge vmbr1 datapath_type=netdev
root at pve:~# ovs-ofctl show vmbr1
ovs-ofctl: vmbr1 is not a bridge or a socket
root at pve:~# tail -f /var/log/openvswitch/ovs-
ovs-ctl.log         ovs-ctl.log.1       ovs-vswitchd.log    ovs-vswitchd.log.1
root at pve:~# tail -f /var/log/openvswitch/ovs-vswitchd.log
2015-02-22T20:29:39.515Z|00019|ofproto_dpif|INFO|netdev at ovs-netdev: Datapath supports recirculation
2015-02-22T20:29:39.515Z|00020|ofproto_dpif|INFO|netdev at ovs-netdev: MPLS label stack length probed as 3
2015-02-22T20:29:39.516Z|00021|bridge|INFO|bridge vmbr1: added interface vmbr1 on port 65534
2015-02-22T20:29:39.516Z|00022|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
2015-02-22T20:29:39.520Z|00023|bridge|INFO|bridge vmbr1: added interface eth1 on port 1
2015-02-22T20:29:39.520Z|00024|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
2015-02-22T20:29:39.520Z|00025|bridge|INFO|bridge vmbr1: using datapath ID 0000000c29e93542
2015-02-22T20:29:39.520Z|00026|connmgr|INFO|vmbr1: added service controller "punix:/var/run/openvswitch/vmbr1.mgmt"
2015-02-22T20:29:42.752Z|00027|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
2015-02-22T20:29:42.752Z|00028|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)




root at pve:~# ls /var/run/openvswitch/vmbr1.mgmt
ls: cannot access /var/run/openvswitch/vmbr1.mgmt: No such file or directory



> On 22 Feb 2015, at 00:12, Ben Pfaff <blp at nicira.com> wrote:
> 
> On Sat, Feb 21, 2015 at 01:07:34AM +0100, Andrei Manescu wrote:
>> Hello list,
>> 
>> Just started using openvswitch and ran either into a bug or I am missing something. According to various mailing list emails, MPLS label operations are available in userspace datapath. To configure a vswitch in the userspace DP, it needs to be set as a “netdev”, but after doing so, all vswitch operational commands fail with "br0 is not a bridge or a socket”. 
>> 
>> Found a similar report from back in October: http://openvswitch.org/pipermail/discuss/2014-October/015138.html <http://openvswitch.org/pipermail/discuss/2014-October/015138.html>, but I can’t find if the specified commit made it into 2.3.1 or this is a regression bug.
>> 
>> Here is the sequence of commands to reproduce (same error for ovs-ofctl add-flow):
>> 
>> root at pve:~# ovs-vsctl -V
>> ovs-vsctl (Open vSwitch) 2.3.1
>> Compiled Dec 27 2014 11:00:30
>> DB Schema 7.6.2
>> 
>> root at pve:~# ovs-vsctl del-br br0
>> root at pve:~# ovs-vsctl add-br br0
>> root at pve:~# ovs-vsctl add-port br0 eth1
>> root at pve:~# ovs-vsctl add-port br0 tap100i0
>> root at pve:~# ovs-ofctl show br0
>> OFPT_FEATURES_REPLY (xid=0x2): dpid:0000000c29e93542
>> n_tables:254, n_buffers:256
>> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
>> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>> 1(eth1): addr:00:0c:29:e9:35:42
>>     config:     0
>>     state:      0
>>     current:    1GB-FD COPPER AUTO_NEG
>>     advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>>     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>>     speed: 1000 Mbps now, 1000 Mbps max
>> 2(tap100i0): addr:ae:6f:8b:e7:50:3a
>>     config:     0
>>     state:      0
>>     current:    10MB-FD COPPER
>>     speed: 10 Mbps now, 0 Mbps max
>> LOCAL(br0): addr:00:0c:29:e9:35:42
>>     config:     PORT_DOWN
>>     state:      LINK_DOWN
>>     speed: 0 Mbps now, 0 Mbps max
>> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>> root at pve:~# ovs-vsctl set bridge br0 datapath_type=netdev
> 
> What's in the ovs-vswitchd log?

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4154 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150222/cda97f2b/attachment-0001.bin>

From andrei.manescu at ivorde.ro  Sun Feb 22 12:40:22 2015
From: andrei.manescu at ivorde.ro (Andrei Manescu)
Date: Sun, 22 Feb 2015 21:40:22 +0100
Subject: [ovs-discuss] userspace datapath (for MPLS and VLAN tagging)
	seems to be broken in 2.3.1
In-Reply-To: <20150222203513.GI24165@nicira.com>
References: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
 <20150221231216.GC24165@nicira.com>
 <35947EDB-3FBF-4538-9D48-1A905416D511@ivorde.ro>
 <20150222203513.GI24165@nicira.com>
Message-ID: <AB72A333-F64F-4DEC-A92F-13CE4BA826D9@ivorde.ro>

Nope. That’s the whole thing AFTER I set the ‘netdev’ switch:












2015-02-22T20:39:05.099Z|00018|ofproto_dpif|INFO|netdev at ovs-netdev: Datapath supports recirculation
2015-02-22T20:39:05.099Z|00019|ofproto_dpif|INFO|netdev at ovs-netdev: MPLS label stack length probed as 3
2015-02-22T20:39:05.099Z|00020|bridge|INFO|bridge vmbr1: added interface vmbr1 on port 65534
2015-02-22T20:39:05.099Z|00021|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
2015-02-22T20:39:05.102Z|00022|bridge|INFO|bridge vmbr1: added interface eth1 on port 1
2015-02-22T20:39:05.102Z|00023|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
2015-02-22T20:39:05.102Z|00024|bridge|INFO|bridge vmbr1: using datapath ID 0000000c29e93542
2015-02-22T20:39:05.102Z|00025|connmgr|INFO|vmbr1: added service controller "punix:/var/run/openvswitch/vmbr1.mgmt"
2015-02-22T20:39:08.079Z|00026|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
2015-02-22T20:39:08.079Z|00027|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)

Anyway specific debugs I can enable ?





> On 22 Feb 2015, at 21:35, Ben Pfaff <blp at nicira.com> wrote:
> 
> The log is probably longer than that, can you provide the whole thing?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150222/252e0c53/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4154 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150222/252e0c53/attachment-0001.bin>

From andrei.manescu at ivorde.ro  Sun Feb 22 13:01:55 2015
From: andrei.manescu at ivorde.ro (Andrei Manescu)
Date: Sun, 22 Feb 2015 22:01:55 +0100
Subject: [ovs-discuss] userspace datapath (for MPLS and VLAN tagging)
	seems to be broken in 2.3.1
In-Reply-To: <20150222204238.GJ24165@nicira.com>
References: <A476C9A7-D582-4AE1-89EC-5ACDB7AF75AE@ivorde.ro>
 <20150221231216.GC24165@nicira.com>
 <35947EDB-3FBF-4538-9D48-1A905416D511@ivorde.ro>
 <20150222203513.GI24165@nicira.com>
 <AB72A333-F64F-4DEC-A92F-13CE4BA826D9@ivorde.ro>
 <20150222204238.GJ24165@nicira.com>
Message-ID: <6F2C45B2-BCB0-4111-8FC8-2ABD9D1F7D09@ivorde.ro>

Didn’t find how to gracefully restart vswitchd (no init script). After rebooting the hypervisor, it’s gone. I tried adding a new switch and set the dp type at creation and it still works.
root at pve:~# ovs-vsctl add-br vmbr2  -- set bridge vmbr2 datapath_type=netdev
root at pve:~# ovs-ofctl show vmbr2
OFPT_FEATURES_REPLY (xid=0x2): dpid:00006a2ebc0d894a
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
 LOCAL(vmbr2): addr:6a:2e:bc:0d:89:4a
     config:     PORT_DOWN
     state:      LINK_DOWN
     current:    10MB-FD COPPER
     speed: 10 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0


P.S.: Anyway I can restart vswitchd ? From ovs-vsctl maybe ? How do I confirm it’s still a “netdev” device ? I see MPLS label is being pushed so I don’t doubt that. Just learning bit by bit.


Would you
Thanks.


> On 22 Feb 2015, at 21:42, Ben Pfaff <blp at nicira.com> wrote:
> 
> Does it make any difference if you set the datapath type as part of
> creating the bridge instead of afterward?  Or if you restart vswitchd
> after setting the datapath type?
> 
> On Sun, Feb 22, 2015 at 09:40:22PM +0100, Andrei Manescu wrote:
>> Nope. That’s the whole thing AFTER I set the ‘netdev’ switch:
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 
>> 2015-02-22T20:39:05.099Z|00018|ofproto_dpif|INFO|netdev at ovs-netdev: Datapath supports recirculation
>> 2015-02-22T20:39:05.099Z|00019|ofproto_dpif|INFO|netdev at ovs-netdev: MPLS label stack length probed as 3
>> 2015-02-22T20:39:05.099Z|00020|bridge|INFO|bridge vmbr1: added interface vmbr1 on port 65534
>> 2015-02-22T20:39:05.099Z|00021|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
>> 2015-02-22T20:39:05.102Z|00022|bridge|INFO|bridge vmbr1: added interface eth1 on port 1
>> 2015-02-22T20:39:05.102Z|00023|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
>> 2015-02-22T20:39:05.102Z|00024|bridge|INFO|bridge vmbr1: using datapath ID 0000000c29e93542
>> 2015-02-22T20:39:05.102Z|00025|connmgr|INFO|vmbr1: added service controller "punix:/var/run/openvswitch/vmbr1.mgmt"
>> 2015-02-22T20:39:08.079Z|00026|netdev_linux|WARN|vmbr1: obtaining netdev stats via vport failed (No such device)
>> 2015-02-22T20:39:08.079Z|00027|netdev_linux|WARN|eth1: obtaining netdev stats via vport failed (No such device)
>> 
>> Anyway specific debugs I can enable ?
>> 
>> 
>> 
>> 
>> 
>>> On 22 Feb 2015, at 21:35, Ben Pfaff <blp at nicira.com> wrote:
>>> 
>>> The log is probably longer than that, can you provide the whole thing?
>> 
> 
> 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4154 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150222/d407fc68/attachment-0001.bin>

From jayakeerthik82 at gmail.com  Mon Feb 23 02:31:24 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Mon, 23 Feb 2015 16:01:24 +0530
Subject: [ovs-discuss] BUG
In-Reply-To: <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
 <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
Message-ID: <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>

sorry for the delay,
libvirt version is 1.2.2
ovs_version: "2.0.2"
i'm installing it through Virt-manager.
xml file is

WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE
OVERWRITTEN AND LOST. Changes to this xml configuration should be made
using:
  virsh edit 1511_secondary
or other application using the libvirt API.
-->

<domain type='kvm'>
  <name>1511_secondary</name>
  <uuid>ed9fbe99-500d-15f1-a5b7-d470d0cca837</uuid>
  <memory unit='KiB'>12288000</memory>
  <currentMemory unit='KiB'>12288000</currentMemory>
  <vcpu placement='static'>8</vcpu>
  <os>
    <type arch='x86_64' machine='pc-i440fx-trusty'>hvm</type>
    <boot dev='hd'/>
  </os>
  <features>
    <acpi/>
    <apic/>
    <pae/>
  </features>
  <clock offset='utc'/>
  <on_poweroff>destroy</on_poweroff>
  <on_reboot>restart</on_reboot>
  <on_crash>restart</on_crash>
  <devices>
    <emulator>/usr/bin/kvm-spice</emulator>
    <disk type='file' device='disk'>
      <driver name='qemu' type='raw'/>
      <source file='/var/lib/libvirt/images/1511_primary-clone.img'/>
      <target dev='hda' bus='ide'/>
      <address type='drive' controller='0' bus='0' target='0' unit='0'/>
    </disk>
    <disk type='block' device='cdrom'>
      <driver name='qemu' type='raw'/>
      <target dev='hdc' bus='ide'/>
      <readonly/>
      <address type='drive' controller='0' bus='1' target='0' unit='0'/>
    </disk>
    <controller type='usb' index='0'>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x01'
function='0x2'/>
    </controller>
    <controller type='pci' index='0' model='pci-root'/>
    <controller type='ide' index='0'>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x01'
function='0x1'/>
    </controller>
    <interface type='bridge'>
      <mac address='52:54:00:f1:51:47'/>
      <source bridge='1511'/>
      <model type='virtio'/>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/>
    </interface>
    <serial type='pty'>
      <target port='0'/>
    </serial>
    <console type='pty'>
      <target type='serial' port='0'/>
    </console>
    <input type='mouse' bus='ps2'/>
    <input type='keyboard' bus='ps2'/>
    <graphics type='vnc' port='-1' autoport='yes'/>
    <sound model='ich6'>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x04'
function='0x0'/>
    </sound>
    <video>
      <model type='cirrus' vram='9216' heads='1'/>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x02'
function='0x0'/>
    </video>
    <memballoon model='virtio'>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x05'
function='0x0'/>
    </memballoon>
  </devices>
</domain>



On Thu, Feb 19, 2015 at 10:47 PM, Scott Lowe <scott.lowe at scottlowe.org>
wrote:

> Please see my responses inline, prefixed by [SL].
>
> jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
>
> > OK..
> >
> > when i try to create vm i'm gettting error unable to add vnet0 port on
> the
> > bridge br3.
>
> [SL] Jayakeerthi, can you share the following information to help us help
> you?
>
> - The network portion of the domain XML configuration for your VM (obtained
> via 'virsh dumpxml <vm-name>'
>
> - The versions of OVS and libvirt installed on your system
>
> - The command(s) you are using to create and/or start the VM
>
> Feel free to use a service like pastebin.com to share the domain XML
> configuration, if you'd like.
>
> Thanks!
>
> >> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com> wrote:
> >>
> >> I don't think you can. KVM creates the port, OVS only handles switching.
> >>
> >>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
> >>>
> >>> how to create port's in openvswitch that can be assigned to vm created
> >>> with KVM?
>
> --
> Scott
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150223/0761c96b/attachment-0001.html>

From atanu at acm.org  Mon Feb 23 15:29:24 2015
From: atanu at acm.org (Atanu Ghosh)
Date: Mon, 23 Feb 2015 15:29:24 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384
 1385 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404
 1405 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424
 1425 1426 1427 1428 failed
In-Reply-To: <CAArS4XVdmiSheiWcfs2T1NYEYs4onfAJPaf9aiAzQMwrmnOH0w@mail.gmail.com>
References: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
 <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>
 <CAArS4XVdmiSheiWcfs2T1NYEYs4onfAJPaf9aiAzQMwrmnOH0w@mail.gmail.com>
Message-ID: <CAFEwj6D30oYaXLGjuD=CJXkzUwWQyVNY4Whv2H6ycJ+Z8QbkfA@mail.gmail.com>

Hi,

The code in the master branch now passes all the tests on FreeBSD 10.1.
However, I still see the same errors when trying to create a bridge.
Setting the datapath type to netdev doesn't seem to help the situation.

        Atanu.

On Fri, Feb 20, 2015 at 2:32 PM, Alex Wang <alexw at nicira.com> wrote:

> Hey Atanu,
>
> We pushed the fixes to master and branch-2.3.  I tested on my FreeBSD-9.3
> VM.  Everything should work fine now,
>
> Thanks,
> Alex Wang,
>
> On Fri, Feb 20, 2015 at 9:54 AM, Alex Wang <alexw at nicira.com> wrote:
>
>> Sorry for this delayed reply,
>>
>> We found the issue, and working on a fix.  Will send more updates soon,
>>
>> Thanks,
>> Alex Wang,
>>
>> On Tue, Feb 17, 2015 at 4:59 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>
>>> Hi,
>>>
>>> I have been trying to use OVS on FreeBSD 10.1. I have hit a number of
>>> issues.
>>>
>>> 1) This simple command fails:
>>> k3$ sudo ovs-vsctl add-br br0
>>> ovs-vsctl: Error detected while setting up 'br0'.  See ovs-vswitchd log
>>> for details.
>>>  k3$ sudo ovs-vswitchd
>>> 2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>> connecting...
>>> 2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>> connected
>>> 2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.3.1
>>> 2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type system
>>> 2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type system
>>> 2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath br0 of
>>> unknown type system
>>> 2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0:
>>> Address family not supported by protocol family
>>>
>>> 2) I ran "make check" and hit a number of problems with ovsdb-server
>>> interactions, which were due to set_dscp failing on FreeBSD. I have not
>>> looked into how to make it work.
>>>
>>> diff --git a/socket-util.c b/socket-util.c
>>> index aa0c719..c17f0d9 100644
>>> --- a/socket-util.c
>>> +++ b/socket-util.c
>>> @@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
>>>      int val;
>>>      bool success;
>>>
>>> +    return 0;
>>> +
>>>      if (dscp > 63) {
>>>          return EINVAL;
>>>      }
>>>
>>> 3) I ran "make check" again and hit the problems on the subject line. I
>>> looked at 1381 a little and it doesn't look like it even manages to contact
>>> the server. I have attached the log file.
>>>
>>> My python version:
>>> k3$ python -V
>>> Python 2.7.9
>>>
>>>         Atanu.
>>>
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150223/1d3a2c0a/attachment.html>

From alexw at nicira.com  Tue Feb 24 09:29:44 2015
From: alexw at nicira.com (Alex Wang)
Date: Tue, 24 Feb 2015 09:29:44 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384
 1385 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404
 1405 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424
 1425 1426 1427 1428 failed
In-Reply-To: <CAFEwj6D30oYaXLGjuD=CJXkzUwWQyVNY4Whv2H6ycJ+Z8QbkfA@mail.gmail.com>
References: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
 <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>
 <CAArS4XVdmiSheiWcfs2T1NYEYs4onfAJPaf9aiAzQMwrmnOH0w@mail.gmail.com>
 <CAFEwj6D30oYaXLGjuD=CJXkzUwWQyVNY4Whv2H6ycJ+Z8QbkfA@mail.gmail.com>
Message-ID: <CAArS4XUiubzeGg5YpvL1wtZdbo4mbb6BMw+vQh28Dur8eHDbkA@mail.gmail.com>

Hey,

I think you need to load the 'if_tap.ko'~

Thanks,
Alex Wang,

On Mon, Feb 23, 2015 at 3:29 PM, Atanu Ghosh <atanu at acm.org> wrote:

> Hi,
>
> The code in the master branch now passes all the tests on FreeBSD 10.1.
> However, I still see the same errors when trying to create a bridge.
> Setting the datapath type to netdev doesn't seem to help the situation.
>
>         Atanu.
>
> On Fri, Feb 20, 2015 at 2:32 PM, Alex Wang <alexw at nicira.com> wrote:
>
>> Hey Atanu,
>>
>> We pushed the fixes to master and branch-2.3.  I tested on my FreeBSD-9.3
>> VM.  Everything should work fine now,
>>
>> Thanks,
>> Alex Wang,
>>
>> On Fri, Feb 20, 2015 at 9:54 AM, Alex Wang <alexw at nicira.com> wrote:
>>
>>> Sorry for this delayed reply,
>>>
>>> We found the issue, and working on a fix.  Will send more updates soon,
>>>
>>> Thanks,
>>> Alex Wang,
>>>
>>> On Tue, Feb 17, 2015 at 4:59 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>>
>>>> Hi,
>>>>
>>>> I have been trying to use OVS on FreeBSD 10.1. I have hit a number of
>>>> issues.
>>>>
>>>> 1) This simple command fails:
>>>> k3$ sudo ovs-vsctl add-br br0
>>>> ovs-vsctl: Error detected while setting up 'br0'.  See ovs-vswitchd log
>>>> for details.
>>>>  k3$ sudo ovs-vswitchd
>>>> 2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>> connecting...
>>>> 2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>> connected
>>>> 2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.3.1
>>>> 2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type system
>>>> 2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type system
>>>> 2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath br0
>>>> of unknown type system
>>>> 2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0:
>>>> Address family not supported by protocol family
>>>>
>>>> 2) I ran "make check" and hit a number of problems with ovsdb-server
>>>> interactions, which were due to set_dscp failing on FreeBSD. I have not
>>>> looked into how to make it work.
>>>>
>>>> diff --git a/socket-util.c b/socket-util.c
>>>> index aa0c719..c17f0d9 100644
>>>> --- a/socket-util.c
>>>> +++ b/socket-util.c
>>>> @@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
>>>>      int val;
>>>>      bool success;
>>>>
>>>> +    return 0;
>>>> +
>>>>      if (dscp > 63) {
>>>>          return EINVAL;
>>>>      }
>>>>
>>>> 3) I ran "make check" again and hit the problems on the subject line. I
>>>> looked at 1381 a little and it doesn't look like it even manages to contact
>>>> the server. I have attached the log file.
>>>>
>>>> My python version:
>>>> k3$ python -V
>>>> Python 2.7.9
>>>>
>>>>         Atanu.
>>>>
>>>>
>>>> _______________________________________________
>>>> discuss mailing list
>>>> discuss at openvswitch.org
>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150224/aebe75e7/attachment.html>

From atanu at acm.org  Tue Feb 24 09:33:11 2015
From: atanu at acm.org (Atanu Ghosh)
Date: Tue, 24 Feb 2015 09:33:11 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384
 1385 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404
 1405 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424
 1425 1426 1427 1428 failed
In-Reply-To: <CAArS4XUiubzeGg5YpvL1wtZdbo4mbb6BMw+vQh28Dur8eHDbkA@mail.gmail.com>
References: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
 <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>
 <CAArS4XVdmiSheiWcfs2T1NYEYs4onfAJPaf9aiAzQMwrmnOH0w@mail.gmail.com>
 <CAFEwj6D30oYaXLGjuD=CJXkzUwWQyVNY4Whv2H6ycJ+Z8QbkfA@mail.gmail.com>
 <CAArS4XUiubzeGg5YpvL1wtZdbo4mbb6BMw+vQh28Dur8eHDbkA@mail.gmail.com>
Message-ID: <CAFEwj6BbzPsscGYeM0KWgtV+m1YocEZw4o1tPBkM+2efm56KMw@mail.gmail.com>

Hi,

It seems to be loaded:

k3$ kldstat  | grep if_tap
13    1 0xffffffff81b93000 5584     if_tap.ko

       Atanu.

On Tue, Feb 24, 2015 at 9:29 AM, Alex Wang <alexw at nicira.com> wrote:

> Hey,
>
> I think you need to load the 'if_tap.ko'~
>
> Thanks,
> Alex Wang,
>
> On Mon, Feb 23, 2015 at 3:29 PM, Atanu Ghosh <atanu at acm.org> wrote:
>
>> Hi,
>>
>> The code in the master branch now passes all the tests on FreeBSD 10.1.
>> However, I still see the same errors when trying to create a bridge.
>> Setting the datapath type to netdev doesn't seem to help the situation.
>>
>>         Atanu.
>>
>> On Fri, Feb 20, 2015 at 2:32 PM, Alex Wang <alexw at nicira.com> wrote:
>>
>>> Hey Atanu,
>>>
>>> We pushed the fixes to master and branch-2.3.  I tested on my FreeBSD-9.3
>>> VM.  Everything should work fine now,
>>>
>>> Thanks,
>>> Alex Wang,
>>>
>>> On Fri, Feb 20, 2015 at 9:54 AM, Alex Wang <alexw at nicira.com> wrote:
>>>
>>>> Sorry for this delayed reply,
>>>>
>>>> We found the issue, and working on a fix.  Will send more updates soon,
>>>>
>>>> Thanks,
>>>> Alex Wang,
>>>>
>>>> On Tue, Feb 17, 2015 at 4:59 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> I have been trying to use OVS on FreeBSD 10.1. I have hit a number of
>>>>> issues.
>>>>>
>>>>> 1) This simple command fails:
>>>>> k3$ sudo ovs-vsctl add-br br0
>>>>> ovs-vsctl: Error detected while setting up 'br0'.  See ovs-vswitchd
>>>>> log for details.
>>>>>  k3$ sudo ovs-vswitchd
>>>>> 2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>> connecting...
>>>>> 2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>> connected
>>>>> 2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch)
>>>>> 2.3.1
>>>>> 2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type system
>>>>> 2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type system
>>>>> 2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath br0
>>>>> of unknown type system
>>>>> 2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0:
>>>>> Address family not supported by protocol family
>>>>>
>>>>> 2) I ran "make check" and hit a number of problems with ovsdb-server
>>>>> interactions, which were due to set_dscp failing on FreeBSD. I have not
>>>>> looked into how to make it work.
>>>>>
>>>>> diff --git a/socket-util.c b/socket-util.c
>>>>> index aa0c719..c17f0d9 100644
>>>>> --- a/socket-util.c
>>>>> +++ b/socket-util.c
>>>>> @@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
>>>>>      int val;
>>>>>      bool success;
>>>>>
>>>>> +    return 0;
>>>>> +
>>>>>      if (dscp > 63) {
>>>>>          return EINVAL;
>>>>>      }
>>>>>
>>>>> 3) I ran "make check" again and hit the problems on the subject line.
>>>>> I looked at 1381 a little and it doesn't look like it even manages to
>>>>> contact the server. I have attached the log file.
>>>>>
>>>>> My python version:
>>>>> k3$ python -V
>>>>> Python 2.7.9
>>>>>
>>>>>         Atanu.
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> discuss mailing list
>>>>> discuss at openvswitch.org
>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150224/6a72783b/attachment-0001.html>

From alexw at nicira.com  Tue Feb 24 09:34:23 2015
From: alexw at nicira.com (Alex Wang)
Date: Tue, 24 Feb 2015 09:34:23 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384
 1385 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404
 1405 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424
 1425 1426 1427 1428 failed
In-Reply-To: <CAFEwj6BbzPsscGYeM0KWgtV+m1YocEZw4o1tPBkM+2efm56KMw@mail.gmail.com>
References: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
 <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>
 <CAArS4XVdmiSheiWcfs2T1NYEYs4onfAJPaf9aiAzQMwrmnOH0w@mail.gmail.com>
 <CAFEwj6D30oYaXLGjuD=CJXkzUwWQyVNY4Whv2H6ycJ+Z8QbkfA@mail.gmail.com>
 <CAArS4XUiubzeGg5YpvL1wtZdbo4mbb6BMw+vQh28Dur8eHDbkA@mail.gmail.com>
 <CAFEwj6BbzPsscGYeM0KWgtV+m1YocEZw4o1tPBkM+2efm56KMw@mail.gmail.com>
Message-ID: <CAArS4XUs6O=6k8f05+np8S_ASF623RcjnReZLdKnGoPjDH315g@mail.gmail.com>

Okay, could you show me the ovs-vswitchd.log?

Usually, there should be some messages explaining the error.

Thanks,
Alex Wang,

On Tue, Feb 24, 2015 at 9:33 AM, Atanu Ghosh <atanu at acm.org> wrote:

> Hi,
>
> It seems to be loaded:
>
> k3$ kldstat  | grep if_tap
> 13    1 0xffffffff81b93000 5584     if_tap.ko
>
>        Atanu.
>
> On Tue, Feb 24, 2015 at 9:29 AM, Alex Wang <alexw at nicira.com> wrote:
>
>> Hey,
>>
>> I think you need to load the 'if_tap.ko'~
>>
>> Thanks,
>> Alex Wang,
>>
>> On Mon, Feb 23, 2015 at 3:29 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>
>>> Hi,
>>>
>>> The code in the master branch now passes all the tests on FreeBSD 10.1.
>>> However, I still see the same errors when trying to create a bridge.
>>> Setting the datapath type to netdev doesn't seem to help the situation.
>>>
>>>         Atanu.
>>>
>>> On Fri, Feb 20, 2015 at 2:32 PM, Alex Wang <alexw at nicira.com> wrote:
>>>
>>>> Hey Atanu,
>>>>
>>>> We pushed the fixes to master and branch-2.3.  I tested on my
>>>> FreeBSD-9.3
>>>> VM.  Everything should work fine now,
>>>>
>>>> Thanks,
>>>> Alex Wang,
>>>>
>>>> On Fri, Feb 20, 2015 at 9:54 AM, Alex Wang <alexw at nicira.com> wrote:
>>>>
>>>>> Sorry for this delayed reply,
>>>>>
>>>>> We found the issue, and working on a fix.  Will send more updates soon,
>>>>>
>>>>> Thanks,
>>>>> Alex Wang,
>>>>>
>>>>> On Tue, Feb 17, 2015 at 4:59 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>>>>
>>>>>> Hi,
>>>>>>
>>>>>> I have been trying to use OVS on FreeBSD 10.1. I have hit a number of
>>>>>> issues.
>>>>>>
>>>>>> 1) This simple command fails:
>>>>>> k3$ sudo ovs-vsctl add-br br0
>>>>>> ovs-vsctl: Error detected while setting up 'br0'.  See ovs-vswitchd
>>>>>> log for details.
>>>>>>  k3$ sudo ovs-vswitchd
>>>>>> 2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>>> connecting...
>>>>>> 2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>>> connected
>>>>>> 2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch)
>>>>>> 2.3.1
>>>>>> 2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type system
>>>>>> 2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type system
>>>>>> 2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath br0
>>>>>> of unknown type system
>>>>>> 2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0:
>>>>>> Address family not supported by protocol family
>>>>>>
>>>>>> 2) I ran "make check" and hit a number of problems with ovsdb-server
>>>>>> interactions, which were due to set_dscp failing on FreeBSD. I have not
>>>>>> looked into how to make it work.
>>>>>>
>>>>>> diff --git a/socket-util.c b/socket-util.c
>>>>>> index aa0c719..c17f0d9 100644
>>>>>> --- a/socket-util.c
>>>>>> +++ b/socket-util.c
>>>>>> @@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
>>>>>>      int val;
>>>>>>      bool success;
>>>>>>
>>>>>> +    return 0;
>>>>>> +
>>>>>>      if (dscp > 63) {
>>>>>>          return EINVAL;
>>>>>>      }
>>>>>>
>>>>>> 3) I ran "make check" again and hit the problems on the subject line.
>>>>>> I looked at 1381 a little and it doesn't look like it even manages to
>>>>>> contact the server. I have attached the log file.
>>>>>>
>>>>>> My python version:
>>>>>> k3$ python -V
>>>>>> Python 2.7.9
>>>>>>
>>>>>>         Atanu.
>>>>>>
>>>>>>
>>>>>> _______________________________________________
>>>>>> discuss mailing list
>>>>>> discuss at openvswitch.org
>>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150224/6961f901/attachment.html>

From blp at nicira.com  Tue Feb 24 10:26:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 24 Feb 2015 10:26:41 -0800
Subject: [ovs-discuss] query related to GRE encapsulation
In-Reply-To: <4a04405a40c84bbd9fd2b3c424383c62@GURMBXV02.AD.ARICENT.COM>
References: <97d1f519234e463e89ecf9f88882dbe6@GURMBXV02.AD.ARICENT.COM>
 <20150224164448.GE17053@nicira.com>
 <4a04405a40c84bbd9fd2b3c424383c62@GURMBXV02.AD.ARICENT.COM>
Message-ID: <20150224182641.GB30125@nicira.com>

Have you looked at the code in odp-util.c that prints these
structures, e.g. format_odp_key_attr()?

On Tue, Feb 24, 2015 at 05:00:31PM +0000, Chetan Bali wrote:
> Hi Ben,
> 
> Thanks for the quick response. Please find the code snippet below:
> 
> This below function is called from flow_put in dpif class code.
> 
> uint8_t dpif_tunnel_parse_actions(s_action_t *action_list, const struct nlattr *actions, size_t actions_len, struct flow_tnl *tun_param)
> {
> if(OVS_LIKELY(NULL != actions))
>     {
>         NL_ATTR_FOR_EACH_UNSAFE(a, len, actions, actions_len)
>         {
>             switch (nl_attr_type(a))
>             {
>                 case OVS_ACTION_ATTR_SET:
>                     VLOG_INFO("Action type is ACTION_SET \n");
>                         action_list[num_action].action_type = ACTION_SET_IPV4_TUNNEL;
>                     if (nla_type(nla_data(a)) == OVS_KEY_ATTR_TUNNEL)
>                     {
>                         tun_param = nla_data(nla_data(a));
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TUN_ID : %u\n",tun_param->tun_id);
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL SRC_ADRR : %x\n",ntohl(tun_param->ipv4_src));
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL SRC_DST : %x\n",ntohl(tun_param->ipv4_dst));
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TUN_FLAG : %u\n",tun_param->tun_flags);
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TOS : %u\n",tun_param->ipv4_tos);
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TTL : %u\n",tun_param->ipv4_ttl);
>                     }
> 
> We are not getting correct values of tun_id, tun_src, tun_dst, tun_ttl, etc.
> 
> It will be great if you could help us here.
> 
> Thanks
> Chetan Bali
> 
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: 24 February 2015 22:15
> To: Chetan Bali
> Cc: dev at openvswitch.org; discuss at openvswitch.org; Mohit Malik
> Subject: Re: [ovs-discuss] query related to GRE encapsulation
> 
> On Tue, Feb 24, 2015 at 01:33:29PM +0000, Chetan Bali wrote:
> > I am configuring gre-port in my ovs bridge, for establishing
> > gre-tunnel between 2 machines. I am trying to parse the tunnelling key params sent by OVS while adding flow, when it sets action as OVS_ACTION_ATTR_SET. I am parsing the tun-key attributes in dpif-linux.c in exact manner as ovs does, i.e., nla_data(nla_data(action)) where action is in "nlattr"  type. Tun-key params that I am trying to fetch are as per struct "ovs_key_ipv4_tunnel" i.e., struct ovs_key_ipv4_tunnel {
> >     __be64 tun_id;
> >     __be32 ipv4_src;
> >     __be32 ipv4_dst;
> >     __be16 tun_flags;
> >     u8   ipv4_tos;
> >     u8   ipv4_ttl;
> > };
> > The problem is that, while parsing I am getting incorrect tun-key params, whereas I can see by putting prints that openvswitchd.ko is getting correct tun-key params.
> 
> I guess you're doing something wrong.  Show us your code?
> "DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."

From kevin.traynor at intel.com  Tue Feb 24 11:15:08 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 24 Feb 2015 19:15:08 +0000
Subject: [ovs-discuss] Fwd: Doubt: QEMU <-> OVS using DPDK
In-Reply-To: <54ECA9E8.6090802@ehu.eus>
References: <20150211154918.Horde.GusL15O-_ZpdikbZDP7FsQ4@www.ehu.eus>
 <54ECA9E8.6090802@ehu.eus>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7306B12A7@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> IñakiMurillo
> Sent: Tuesday, February 24, 2015 4:42 PM
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] Fwd: Doubt: QEMU <-> OVS using DPDK
> 
> 
> 
> Hello,
> 
> I am trying to connect a virtual machine with a openvswitch using DPDK
> for performance, as you can see in the next figure.
> 
> +-----------------------------------------------+
> | QMEU VM                                       |
> |                                               |
> |                          +--------+--------+  |
> |                          |    DPDK  APP    |  |
> |                          |                 |  |
> |                          +--------^--------+  |
> |                                   |           |
> |                          +--------V--------+  |
> |                          |   DPDK virtual  |  |
> |                          |    interface    |  |
> +--------------------------+--------^--------+--+
>                                      |   Ivshmen ¿?
>                                      |   MEMNIC  ¿?
>                                      |
> +-----+--------------------+--------V--------+--+
> |  OVS+DPDK                |   DPDK virtual  |  |
> |                          |    interface    |  |
> |                          +-----------------+  |
> |                                               |
> |                                               |
> |  +--------------+         +----------------+  |
> |  |              |         |                |  |
> +--+------^-------+---------+----------^-----+--+
>            |                            |
>            |                            |
>            |                            |
> +---------V---+                 +------V--------+
> |  10G NIC    |                 |  10G NIC      |
> |   DPDK      |                 |   DPDK        |
> +-------------+                 +---------------+
> 
> I do not have any problem connecting with 10G NICs, but I do have when
> it comes to QEMU. I am nor pretty sure how to connect qemu with ovs.
> 
> As far as I know, I think that I have to use MEMNIC or Ivshmem, but I
> cannot find much information about how to do it.
At present you can use ivshmem or vhost-cuse. The instructions for ivshmem are in 
INSTALL.DPDK

> 
> Could someone explain to me how can it be done?
vhost is not upstreamed yet, so you'd need this patch 
http://openvswitch.org/pipermail/dev/2015-January/050278.html the instructions will 
patch into INSTALL.DPDK and be sure to note the dependencies in the cover letter.

If you want info about the differences between ivshmem and vhost - have a look at 
the video from the OVS conf http://youtu.be/FmQmo8zG4y8

> 
> Thank you in advanced.
> 
> Iñaki Murillo
> 
> 
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From alexw at nicira.com  Tue Feb 24 11:49:12 2015
From: alexw at nicira.com (Alex Wang)
Date: Tue, 24 Feb 2015 11:49:12 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384
 1385 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404
 1405 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424
 1425 1426 1427 1428 failed
In-Reply-To: <CAArS4XUs6O=6k8f05+np8S_ASF623RcjnReZLdKnGoPjDH315g@mail.gmail.com>
References: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
 <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>
 <CAArS4XVdmiSheiWcfs2T1NYEYs4onfAJPaf9aiAzQMwrmnOH0w@mail.gmail.com>
 <CAFEwj6D30oYaXLGjuD=CJXkzUwWQyVNY4Whv2H6ycJ+Z8QbkfA@mail.gmail.com>
 <CAArS4XUiubzeGg5YpvL1wtZdbo4mbb6BMw+vQh28Dur8eHDbkA@mail.gmail.com>
 <CAFEwj6BbzPsscGYeM0KWgtV+m1YocEZw4o1tPBkM+2efm56KMw@mail.gmail.com>
 <CAArS4XUs6O=6k8f05+np8S_ASF623RcjnReZLdKnGoPjDH315g@mail.gmail.com>
Message-ID: <CAArS4XVhnf+LxUNnSnpjehk1=s__nKScGg__LU9WZyw-mP6GbQ@mail.gmail.com>

According to
https://www.freebsd.org/cgi/man.cgi?query=tap&apropos=0&sektion=4&manpath=FreeBSD+9.3-RELEASE&arch=default&format=html

it seems that freebsd does not support setting SIOCSIFNAME for tap
interfaces.

I think I'll just remove the code in ovs.

Thanks,
Alex Wang,

On Tue, Feb 24, 2015 at 9:34 AM, Alex Wang <alexw at nicira.com> wrote:

> Okay, could you show me the ovs-vswitchd.log?
>
> Usually, there should be some messages explaining the error.
>
> Thanks,
> Alex Wang,
>
> On Tue, Feb 24, 2015 at 9:33 AM, Atanu Ghosh <atanu at acm.org> wrote:
>
>> Hi,
>>
>> It seems to be loaded:
>>
>> k3$ kldstat  | grep if_tap
>> 13    1 0xffffffff81b93000 5584     if_tap.ko
>>
>>        Atanu.
>>
>> On Tue, Feb 24, 2015 at 9:29 AM, Alex Wang <alexw at nicira.com> wrote:
>>
>>> Hey,
>>>
>>> I think you need to load the 'if_tap.ko'~
>>>
>>> Thanks,
>>> Alex Wang,
>>>
>>> On Mon, Feb 23, 2015 at 3:29 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>>
>>>> Hi,
>>>>
>>>> The code in the master branch now passes all the tests on FreeBSD 10.1.
>>>> However, I still see the same errors when trying to create a bridge.
>>>> Setting the datapath type to netdev doesn't seem to help the situation.
>>>>
>>>>         Atanu.
>>>>
>>>> On Fri, Feb 20, 2015 at 2:32 PM, Alex Wang <alexw at nicira.com> wrote:
>>>>
>>>>> Hey Atanu,
>>>>>
>>>>> We pushed the fixes to master and branch-2.3.  I tested on my
>>>>> FreeBSD-9.3
>>>>> VM.  Everything should work fine now,
>>>>>
>>>>> Thanks,
>>>>> Alex Wang,
>>>>>
>>>>> On Fri, Feb 20, 2015 at 9:54 AM, Alex Wang <alexw at nicira.com> wrote:
>>>>>
>>>>>> Sorry for this delayed reply,
>>>>>>
>>>>>> We found the issue, and working on a fix.  Will send more updates
>>>>>> soon,
>>>>>>
>>>>>> Thanks,
>>>>>> Alex Wang,
>>>>>>
>>>>>> On Tue, Feb 17, 2015 at 4:59 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>>>>>
>>>>>>> Hi,
>>>>>>>
>>>>>>> I have been trying to use OVS on FreeBSD 10.1. I have hit a number
>>>>>>> of issues.
>>>>>>>
>>>>>>> 1) This simple command fails:
>>>>>>> k3$ sudo ovs-vsctl add-br br0
>>>>>>> ovs-vsctl: Error detected while setting up 'br0'.  See ovs-vswitchd
>>>>>>> log for details.
>>>>>>>  k3$ sudo ovs-vswitchd
>>>>>>> 2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>>>> connecting...
>>>>>>> 2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>>>> connected
>>>>>>> 2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch)
>>>>>>> 2.3.1
>>>>>>> 2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type system
>>>>>>> 2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type system
>>>>>>> 2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath
>>>>>>> br0 of unknown type system
>>>>>>> 2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0:
>>>>>>> Address family not supported by protocol family
>>>>>>>
>>>>>>> 2) I ran "make check" and hit a number of problems with ovsdb-server
>>>>>>> interactions, which were due to set_dscp failing on FreeBSD. I have not
>>>>>>> looked into how to make it work.
>>>>>>>
>>>>>>> diff --git a/socket-util.c b/socket-util.c
>>>>>>> index aa0c719..c17f0d9 100644
>>>>>>> --- a/socket-util.c
>>>>>>> +++ b/socket-util.c
>>>>>>> @@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
>>>>>>>      int val;
>>>>>>>      bool success;
>>>>>>>
>>>>>>> +    return 0;
>>>>>>> +
>>>>>>>      if (dscp > 63) {
>>>>>>>          return EINVAL;
>>>>>>>      }
>>>>>>>
>>>>>>> 3) I ran "make check" again and hit the problems on the subject
>>>>>>> line. I looked at 1381 a little and it doesn't look like it even manages to
>>>>>>> contact the server. I have attached the log file.
>>>>>>>
>>>>>>> My python version:
>>>>>>> k3$ python -V
>>>>>>> Python 2.7.9
>>>>>>>
>>>>>>>         Atanu.
>>>>>>>
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> discuss mailing list
>>>>>>> discuss at openvswitch.org
>>>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150224/aaa6c906/attachment.html>

From neil.mckee at inmon.com  Tue Feb 24 13:47:51 2015
From: neil.mckee at inmon.com (Neil McKee)
Date: Tue, 24 Feb 2015 13:47:51 -0800
Subject: [ovs-discuss] How to change sflow sampleType_tag
In-Reply-To: <20150217193406.GC25632@nicira.com>
References: <54E37A41.2050005@gmail.com> <20150217193406.GC25632@nicira.com>
Message-ID: <CAB1FvaKxtiQAfKH8irkdVciYxam0mXoz1-yzzfg7+J5DY4CXbQ@mail.gmail.com>

Sorry for the slow response.

The answer is to add more decoding at the collector.   You could refer to
the "sflowtool" source code for a simple example.

The "struct sampled_ipv4" record (flow sample type 0:3) is only there in
case there is a device somewhere that has that decoded information,  but
somehow cannot access the original packet that was sampled  (believe it or
not,  there was a router once that found itself in this unlikely
predicament).   Since OVS has the original packet it is required to export
that instead.  Much better.  This is how the simplest layer-2 switch can
provide visibility into higher-layers, tunnels, complex relationships etc.
without having to do anything more than sample packets in a stateless way.

In fact,  when OVS sends samples up from the kernel to sFlow it does rather
more packet-decoding work that it strictly needs to.   We could trim a few
cycles there,  but it's hardly worth changing because it only happens for
sampled packets and typical sampling rates are of the order of 1:1000.

Regards,
Neil




------
Neil McKee
InMon Corp.
http://www.inmon.com

On Tue, Feb 17, 2015 at 11:34 AM, Ben Pfaff <blp at nicira.com> wrote:

> I'm adding Neil McKee, who knows much more about sflow than I do.
>
> On Tue, Feb 17, 2015 at 07:28:33PM +0200, George Shuklin wrote:
> > We're playing with sFlow features of OVS. We want to collect sflow
> > with em-sflow <https://github.com/normelton/em-sflow> library (ruby,
> > ttps://github.com/normelton/em-sflow
> > <https://github.com/normelton/em-sflow>). Unfortunately it can not
> > process received sflow packets deep enough.
> >
> > After some research I found there are few types of sFlow packes,
> > with different structure. As far as I understand it parse payload
> > only for the sampleType_tag 0:3, but it leaves unprocessed header in
> > sampleType_tag 0:1 (which is fine according to specs).
> >
> > Is any way to configure OVS to send sFlow samples of type 3?
>
> I don't think OVS has knobs like that.  It's not obvious to me whether
> the correct solution here is to improve the library you're using or to
> change OVS to do something different.  Neil?
>
> Thanks,
>
> Ben.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150224/121b2dbe/attachment.html>

From atanu at acm.org  Tue Feb 24 15:35:32 2015
From: atanu at acm.org (Atanu Ghosh)
Date: Tue, 24 Feb 2015 15:35:32 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384
 1385 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404
 1405 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424
 1425 1426 1427 1428 failed
In-Reply-To: <CAArS4XVhnf+LxUNnSnpjehk1=s__nKScGg__LU9WZyw-mP6GbQ@mail.gmail.com>
References: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
 <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>
 <CAArS4XVdmiSheiWcfs2T1NYEYs4onfAJPaf9aiAzQMwrmnOH0w@mail.gmail.com>
 <CAFEwj6D30oYaXLGjuD=CJXkzUwWQyVNY4Whv2H6ycJ+Z8QbkfA@mail.gmail.com>
 <CAArS4XUiubzeGg5YpvL1wtZdbo4mbb6BMw+vQh28Dur8eHDbkA@mail.gmail.com>
 <CAFEwj6BbzPsscGYeM0KWgtV+m1YocEZw4o1tPBkM+2efm56KMw@mail.gmail.com>
 <CAArS4XUs6O=6k8f05+np8S_ASF623RcjnReZLdKnGoPjDH315g@mail.gmail.com>
 <CAArS4XVhnf+LxUNnSnpjehk1=s__nKScGg__LU9WZyw-mP6GbQ@mail.gmail.com>
Message-ID: <CAFEwj6AaYHeR-K8VYm-wHvPY56BJ4ub0L5iLaadZDj_FfiGUmg@mail.gmail.com>

Hi,

If SIOCSIFNAME is used to change the name of the tap interface it seems to
work on FreeBSD 10.1:
ovs-netdev: flags=ffdc8802<BROADCAST,SIMPLEX,MULTICAST,MONITOR,STATICARP>
metric 0 mtu 1500
    options=80000<LINKSTATE>
    ether 00:bd:43:48:02:00
    nd6 options=21<PERFORMNUD,AUTO_LINKLOCAL>
    media: Ethernet autoselect
    status: no carrier
br0: flags=ffdc8802<BROADCAST,SIMPLEX,MULTICAST,MONITOR,STATICARP> metric 0
mtu 1500
    options=80000<LINKSTATE>
    ether 00:30:18:c0:44:c4
    nd6 options=21<PERFORMNUD,AUTO_LINKLOCAL>
    media: Ethernet autoselect
    status: no carrier

After you mentioned that the problem may be with the tap interface I
remembered that at some point I had created a tap0, in am attempt to get
OVS working. I think the existence of this tap interface may have been
causing the problems that I have been seeing. I still see some warnings and
errors but it looks like the bridge may be working.

       Atanu.

On Tue, Feb 24, 2015 at 11:49 AM, Alex Wang <alexw at nicira.com> wrote:

> According to
> https://www.freebsd.org/cgi/man.cgi?query=tap&apropos=0&sektion=4&manpath=FreeBSD+9.3-RELEASE&arch=default&format=html
>
> it seems that freebsd does not support setting SIOCSIFNAME for tap
> interfaces.
>
> I think I'll just remove the code in ovs.
>
> Thanks,
> Alex Wang,
>
> On Tue, Feb 24, 2015 at 9:34 AM, Alex Wang <alexw at nicira.com> wrote:
>
>> Okay, could you show me the ovs-vswitchd.log?
>>
>> Usually, there should be some messages explaining the error.
>>
>> Thanks,
>> Alex Wang,
>>
>> On Tue, Feb 24, 2015 at 9:33 AM, Atanu Ghosh <atanu at acm.org> wrote:
>>
>>> Hi,
>>>
>>> It seems to be loaded:
>>>
>>> k3$ kldstat  | grep if_tap
>>> 13    1 0xffffffff81b93000 5584     if_tap.ko
>>>
>>>        Atanu.
>>>
>>> On Tue, Feb 24, 2015 at 9:29 AM, Alex Wang <alexw at nicira.com> wrote:
>>>
>>>> Hey,
>>>>
>>>> I think you need to load the 'if_tap.ko'~
>>>>
>>>> Thanks,
>>>> Alex Wang,
>>>>
>>>> On Mon, Feb 23, 2015 at 3:29 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> The code in the master branch now passes all the tests on FreeBSD 10.1.
>>>>> However, I still see the same errors when trying to create a bridge.
>>>>> Setting the datapath type to netdev doesn't seem to help the situation.
>>>>>
>>>>>         Atanu.
>>>>>
>>>>> On Fri, Feb 20, 2015 at 2:32 PM, Alex Wang <alexw at nicira.com> wrote:
>>>>>
>>>>>> Hey Atanu,
>>>>>>
>>>>>> We pushed the fixes to master and branch-2.3.  I tested on my
>>>>>> FreeBSD-9.3
>>>>>> VM.  Everything should work fine now,
>>>>>>
>>>>>> Thanks,
>>>>>> Alex Wang,
>>>>>>
>>>>>> On Fri, Feb 20, 2015 at 9:54 AM, Alex Wang <alexw at nicira.com> wrote:
>>>>>>
>>>>>>> Sorry for this delayed reply,
>>>>>>>
>>>>>>> We found the issue, and working on a fix.  Will send more updates
>>>>>>> soon,
>>>>>>>
>>>>>>> Thanks,
>>>>>>> Alex Wang,
>>>>>>>
>>>>>>> On Tue, Feb 17, 2015 at 4:59 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>>>>>>
>>>>>>>> Hi,
>>>>>>>>
>>>>>>>> I have been trying to use OVS on FreeBSD 10.1. I have hit a number
>>>>>>>> of issues.
>>>>>>>>
>>>>>>>> 1) This simple command fails:
>>>>>>>> k3$ sudo ovs-vsctl add-br br0
>>>>>>>> ovs-vsctl: Error detected while setting up 'br0'.  See ovs-vswitchd
>>>>>>>> log for details.
>>>>>>>>  k3$ sudo ovs-vswitchd
>>>>>>>> 2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>>>>> connecting...
>>>>>>>> 2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>>>>> connected
>>>>>>>> 2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch)
>>>>>>>> 2.3.1
>>>>>>>> 2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type system
>>>>>>>> 2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type system
>>>>>>>> 2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath
>>>>>>>> br0 of unknown type system
>>>>>>>> 2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0:
>>>>>>>> Address family not supported by protocol family
>>>>>>>>
>>>>>>>> 2) I ran "make check" and hit a number of problems with
>>>>>>>> ovsdb-server interactions, which were due to set_dscp failing on FreeBSD. I
>>>>>>>> have not looked into how to make it work.
>>>>>>>>
>>>>>>>> diff --git a/socket-util.c b/socket-util.c
>>>>>>>> index aa0c719..c17f0d9 100644
>>>>>>>> --- a/socket-util.c
>>>>>>>> +++ b/socket-util.c
>>>>>>>> @@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
>>>>>>>>      int val;
>>>>>>>>      bool success;
>>>>>>>>
>>>>>>>> +    return 0;
>>>>>>>> +
>>>>>>>>      if (dscp > 63) {
>>>>>>>>          return EINVAL;
>>>>>>>>      }
>>>>>>>>
>>>>>>>> 3) I ran "make check" again and hit the problems on the subject
>>>>>>>> line. I looked at 1381 a little and it doesn't look like it even manages to
>>>>>>>> contact the server. I have attached the log file.
>>>>>>>>
>>>>>>>> My python version:
>>>>>>>> k3$ python -V
>>>>>>>> Python 2.7.9
>>>>>>>>
>>>>>>>>         Atanu.
>>>>>>>>
>>>>>>>>
>>>>>>>> _______________________________________________
>>>>>>>> discuss mailing list
>>>>>>>> discuss at openvswitch.org
>>>>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150224/39cbdf31/attachment.html>

From alexw at nicira.com  Tue Feb 24 15:45:24 2015
From: alexw at nicira.com (Alex Wang)
Date: Tue, 24 Feb 2015 15:45:24 -0800
Subject: [ovs-discuss] [openvswitch 2.3.1] testsuite: 1381 1382 1384
 1385 1386 1388 1389 1390 1392 1393 1394 1396 1397 1398 1400 1401 1402 1404
 1405 1406 1408 1409 1410 1412 1413 1414 1416 1417 1418 1420 1421 1422 1424
 1425 1426 1427 1428 failed
In-Reply-To: <CAFEwj6AaYHeR-K8VYm-wHvPY56BJ4ub0L5iLaadZDj_FfiGUmg@mail.gmail.com>
References: <CAFEwj6B5NwssxqCbaU0aC2HYhft6e_wo6NEobZ65bK4L_706Ag@mail.gmail.com>
 <CAArS4XVktQKc6k72M465cnirnUCNbwqFnO0na_oTk-noJ33scw@mail.gmail.com>
 <CAArS4XVdmiSheiWcfs2T1NYEYs4onfAJPaf9aiAzQMwrmnOH0w@mail.gmail.com>
 <CAFEwj6D30oYaXLGjuD=CJXkzUwWQyVNY4Whv2H6ycJ+Z8QbkfA@mail.gmail.com>
 <CAArS4XUiubzeGg5YpvL1wtZdbo4mbb6BMw+vQh28Dur8eHDbkA@mail.gmail.com>
 <CAFEwj6BbzPsscGYeM0KWgtV+m1YocEZw4o1tPBkM+2efm56KMw@mail.gmail.com>
 <CAArS4XUs6O=6k8f05+np8S_ASF623RcjnReZLdKnGoPjDH315g@mail.gmail.com>
 <CAArS4XVhnf+LxUNnSnpjehk1=s__nKScGg__LU9WZyw-mP6GbQ@mail.gmail.com>
 <CAFEwj6AaYHeR-K8VYm-wHvPY56BJ4ub0L5iLaadZDj_FfiGUmg@mail.gmail.com>
Message-ID: <CAArS4XWQ9QyvFK=ZmNSNbYbD7U94YRw59drdad9_39QKuJYMWA@mail.gmail.com>

Also, just make sure you did not terminate ovs by 'kill' it, since that way,
the opened tap interfaces are not removed and could cause errors when
you restart ovs.

Thanks,
Alex Wang,

On Tue, Feb 24, 2015 at 3:35 PM, Atanu Ghosh <atanu at acm.org> wrote:

> Hi,
>
> If SIOCSIFNAME is used to change the name of the tap interface it seems to
> work on FreeBSD 10.1:
> ovs-netdev: flags=ffdc8802<BROADCAST,SIMPLEX,MULTICAST,MONITOR,STATICARP>
> metric 0 mtu 1500
>     options=80000<LINKSTATE>
>     ether 00:bd:43:48:02:00
>     nd6 options=21<PERFORMNUD,AUTO_LINKLOCAL>
>     media: Ethernet autoselect
>     status: no carrier
> br0: flags=ffdc8802<BROADCAST,SIMPLEX,MULTICAST,MONITOR,STATICARP> metric
> 0 mtu 1500
>     options=80000<LINKSTATE>
>     ether 00:30:18:c0:44:c4
>     nd6 options=21<PERFORMNUD,AUTO_LINKLOCAL>
>     media: Ethernet autoselect
>     status: no carrier
>
> After you mentioned that the problem may be with the tap interface I
> remembered that at some point I had created a tap0, in am attempt to get
> OVS working. I think the existence of this tap interface may have been
> causing the problems that I have been seeing. I still see some warnings and
> errors but it looks like the bridge may be working.
>
>        Atanu.
>
> On Tue, Feb 24, 2015 at 11:49 AM, Alex Wang <alexw at nicira.com> wrote:
>
>> According to
>> https://www.freebsd.org/cgi/man.cgi?query=tap&apropos=0&sektion=4&manpath=FreeBSD+9.3-RELEASE&arch=default&format=html
>>
>> it seems that freebsd does not support setting SIOCSIFNAME for tap
>> interfaces.
>>
>> I think I'll just remove the code in ovs.
>>
>> Thanks,
>> Alex Wang,
>>
>> On Tue, Feb 24, 2015 at 9:34 AM, Alex Wang <alexw at nicira.com> wrote:
>>
>>> Okay, could you show me the ovs-vswitchd.log?
>>>
>>> Usually, there should be some messages explaining the error.
>>>
>>> Thanks,
>>> Alex Wang,
>>>
>>> On Tue, Feb 24, 2015 at 9:33 AM, Atanu Ghosh <atanu at acm.org> wrote:
>>>
>>>> Hi,
>>>>
>>>> It seems to be loaded:
>>>>
>>>> k3$ kldstat  | grep if_tap
>>>> 13    1 0xffffffff81b93000 5584     if_tap.ko
>>>>
>>>>        Atanu.
>>>>
>>>> On Tue, Feb 24, 2015 at 9:29 AM, Alex Wang <alexw at nicira.com> wrote:
>>>>
>>>>> Hey,
>>>>>
>>>>> I think you need to load the 'if_tap.ko'~
>>>>>
>>>>> Thanks,
>>>>> Alex Wang,
>>>>>
>>>>> On Mon, Feb 23, 2015 at 3:29 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>>>>
>>>>>> Hi,
>>>>>>
>>>>>> The code in the master branch now passes all the tests on FreeBSD
>>>>>> 10.1.
>>>>>> However, I still see the same errors when trying to create a bridge.
>>>>>> Setting the datapath type to netdev doesn't seem to help the situation.
>>>>>>
>>>>>>         Atanu.
>>>>>>
>>>>>> On Fri, Feb 20, 2015 at 2:32 PM, Alex Wang <alexw at nicira.com> wrote:
>>>>>>
>>>>>>> Hey Atanu,
>>>>>>>
>>>>>>> We pushed the fixes to master and branch-2.3.  I tested on my
>>>>>>> FreeBSD-9.3
>>>>>>> VM.  Everything should work fine now,
>>>>>>>
>>>>>>> Thanks,
>>>>>>> Alex Wang,
>>>>>>>
>>>>>>> On Fri, Feb 20, 2015 at 9:54 AM, Alex Wang <alexw at nicira.com> wrote:
>>>>>>>
>>>>>>>> Sorry for this delayed reply,
>>>>>>>>
>>>>>>>> We found the issue, and working on a fix.  Will send more updates
>>>>>>>> soon,
>>>>>>>>
>>>>>>>> Thanks,
>>>>>>>> Alex Wang,
>>>>>>>>
>>>>>>>> On Tue, Feb 17, 2015 at 4:59 PM, Atanu Ghosh <atanu at acm.org> wrote:
>>>>>>>>
>>>>>>>>> Hi,
>>>>>>>>>
>>>>>>>>> I have been trying to use OVS on FreeBSD 10.1. I have hit a number
>>>>>>>>> of issues.
>>>>>>>>>
>>>>>>>>> 1) This simple command fails:
>>>>>>>>> k3$ sudo ovs-vsctl add-br br0
>>>>>>>>> ovs-vsctl: Error detected while setting up 'br0'.  See
>>>>>>>>> ovs-vswitchd log for details.
>>>>>>>>>  k3$ sudo ovs-vswitchd
>>>>>>>>> 2015-02-18T00:29:29Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>>>>>> connecting...
>>>>>>>>> 2015-02-18T00:29:29Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
>>>>>>>>> connected
>>>>>>>>> 2015-02-18T00:29:29Z|00003|bridge|INFO|ovs-vswitchd (Open vSwitch)
>>>>>>>>> 2.3.1
>>>>>>>>> 2015-02-18T00:29:34Z|00004|ofproto|WARN|unknown datapath type
>>>>>>>>> system
>>>>>>>>> 2015-02-18T00:29:34Z|00005|ofproto|WARN|unknown datapath type
>>>>>>>>> system
>>>>>>>>> 2015-02-18T00:29:34Z|00006|ofproto|WARN|could not create datapath
>>>>>>>>> br0 of unknown type system
>>>>>>>>> 2015-02-18T00:29:34Z|00007|bridge|ERR|failed to create bridge br0:
>>>>>>>>> Address family not supported by protocol family
>>>>>>>>>
>>>>>>>>> 2) I ran "make check" and hit a number of problems with
>>>>>>>>> ovsdb-server interactions, which were due to set_dscp failing on FreeBSD. I
>>>>>>>>> have not looked into how to make it work.
>>>>>>>>>
>>>>>>>>> diff --git a/socket-util.c b/socket-util.c
>>>>>>>>> index aa0c719..c17f0d9 100644
>>>>>>>>> --- a/socket-util.c
>>>>>>>>> +++ b/socket-util.c
>>>>>>>>> @@ -112,6 +112,8 @@ set_dscp(int fd, uint8_t dscp)
>>>>>>>>>      int val;
>>>>>>>>>      bool success;
>>>>>>>>>
>>>>>>>>> +    return 0;
>>>>>>>>> +
>>>>>>>>>      if (dscp > 63) {
>>>>>>>>>          return EINVAL;
>>>>>>>>>      }
>>>>>>>>>
>>>>>>>>> 3) I ran "make check" again and hit the problems on the subject
>>>>>>>>> line. I looked at 1381 a little and it doesn't look like it even manages to
>>>>>>>>> contact the server. I have attached the log file.
>>>>>>>>>
>>>>>>>>> My python version:
>>>>>>>>> k3$ python -V
>>>>>>>>> Python 2.7.9
>>>>>>>>>
>>>>>>>>>         Atanu.
>>>>>>>>>
>>>>>>>>>
>>>>>>>>> _______________________________________________
>>>>>>>>> discuss mailing list
>>>>>>>>> discuss at openvswitch.org
>>>>>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>>>>>
>>>>>>>>>
>>>>>>>>
>>>>>>>
>>>>>>
>>>>>
>>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150224/fb7bffab/attachment-0001.html>

From chetan.bali at aricent.com  Tue Feb 24 21:02:39 2015
From: chetan.bali at aricent.com (Chetan Bali)
Date: Wed, 25 Feb 2015 05:02:39 +0000
Subject: [ovs-discuss] query related to GRE encapsulation
In-Reply-To: <20150224182641.GB30125@nicira.com>
References: <97d1f519234e463e89ecf9f88882dbe6@GURMBXV02.AD.ARICENT.COM>
 <20150224164448.GE17053@nicira.com>
 <4a04405a40c84bbd9fd2b3c424383c62@GURMBXV02.AD.ARICENT.COM>
 <20150224182641.GB30125@nicira.com>
Message-ID: <aaadda66d90e445d881811192a6be83f@GURMBXV02.AD.ARICENT.COM>

Hi Ben,

Checked out the function format_odp_key_attr(), it has the correct parameters in form of struct ds->string. This string shows correct set of tunnelling params. But we need to do parsing in dpif class. Can you suggest how can we do this? Looks like we aren't doing the correct netlink parsing as mentioned in below code snippet.

Thanks
Chetan Bali

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com]
Sent: 24 February 2015 23:57
To: Chetan Bali
Cc: dev at openvswitch.org; discuss at openvswitch.org; Mohit Malik
Subject: Re: [ovs-discuss] query related to GRE encapsulation

Have you looked at the code in odp-util.c that prints these structures, e.g. format_odp_key_attr()?

On Tue, Feb 24, 2015 at 05:00:31PM +0000, Chetan Bali wrote:
> Hi Ben,
>
> Thanks for the quick response. Please find the code snippet below:
>
> This below function is called from flow_put in dpif class code.
>
> uint8_t dpif_tunnel_parse_actions(s_action_t *action_list, const
> struct nlattr *actions, size_t actions_len, struct flow_tnl
> *tun_param) { if(OVS_LIKELY(NULL != actions))
>     {
>         NL_ATTR_FOR_EACH_UNSAFE(a, len, actions, actions_len)
>         {
>             switch (nl_attr_type(a))
>             {
>                 case OVS_ACTION_ATTR_SET:
>                     VLOG_INFO("Action type is ACTION_SET \n");
>                         action_list[num_action].action_type = ACTION_SET_IPV4_TUNNEL;
>                     if (nla_type(nla_data(a)) == OVS_KEY_ATTR_TUNNEL)
>                     {
>                         tun_param = nla_data(nla_data(a));
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TUN_ID : %u\n",tun_param->tun_id);
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL SRC_ADRR : %x\n",ntohl(tun_param->ipv4_src));
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL SRC_DST : %x\n",ntohl(tun_param->ipv4_dst));
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TUN_FLAG : %u\n",tun_param->tun_flags);
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TOS : %u\n",tun_param->ipv4_tos);
>                         VLOG_INFO(" OVS_ACTION_ATTR_TUNNEL TTL : %u\n",tun_param->ipv4_ttl);
>                     }
>
> We are not getting correct values of tun_id, tun_src, tun_dst, tun_ttl, etc.
>
> It will be great if you could help us here.
>
> Thanks
> Chetan Bali
>
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: 24 February 2015 22:15
> To: Chetan Bali
> Cc: dev at openvswitch.org; discuss at openvswitch.org; Mohit Malik
> Subject: Re: [ovs-discuss] query related to GRE encapsulation
>
> On Tue, Feb 24, 2015 at 01:33:29PM +0000, Chetan Bali wrote:
> > I am configuring gre-port in my ovs bridge, for establishing
> > gre-tunnel between 2 machines. I am trying to parse the tunnelling key params sent by OVS while adding flow, when it sets action as OVS_ACTION_ATTR_SET. I am parsing the tun-key attributes in dpif-linux.c in exact manner as ovs does, i.e., nla_data(nla_data(action)) where action is in "nlattr"  type. Tun-key params that I am trying to fetch are as per struct "ovs_key_ipv4_tunnel" i.e., struct ovs_key_ipv4_tunnel {
> >     __be64 tun_id;
> >     __be32 ipv4_src;
> >     __be32 ipv4_dst;
> >     __be16 tun_flags;
> >     u8   ipv4_tos;
> >     u8   ipv4_ttl;
> > };
> > The problem is that, while parsing I am getting incorrect tun-key params, whereas I can see by putting prints that openvswitchd.ko is getting correct tun-key params.
>
> I guess you're doing something wrong.  Show us your code?
> "DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."
"DISCLAIMER: This message is proprietary to Aricent and is intended solely for the use of the individual to whom it is addressed. It may contain privileged or confidential information and should not be circulated or used for any purpose other than for what it is intended. If you have received this message in error, please notify the originator immediately. If you are not the intended recipient, you are notified that you are strictly prohibited from using, copying, altering, or disclosing the contents of this message. Aricent accepts no responsibility for loss or damage arising from the use of the information transmitted by this email including damage from virus."

From torshie at gmail.com  Wed Feb 25 02:40:54 2015
From: torshie at gmail.com (=?UTF-8?B?6YKT5bCn?=)
Date: Wed, 25 Feb 2015 18:40:54 +0800
Subject: [ovs-discuss] looking for a good explanation of core dumps and
	backtraces
In-Reply-To: <20150209191202.GC2168@nicira.com>
References: <20150209191202.GC2168@nicira.com>
Message-ID: <CAOb3iugBxhnObYSPi7PHVFsi=7=+f+yRGp84bWyz6kJ5AZLhKQ@mail.gmail.com>

IMHO, coredumps are for developers only, not even suitable for ops,
asking users for a coredump is really too much. If you want to deep
analyze a coredump, not only the coredump itself but also the system
shared libraries are also needed, most users have don't have the
skills to do this.

If you only need the backtrace (most of the time this is the
situation), you can generate one yourself, there is a library in GCC's
code base called libbacktrace (developed by google, released under BSD
licence) which could generate nice backtrace as long as debug symbols
aren't stripped.

libbacktrace is part of GCC, so you need to dig it from GCC's code
base and integrate it into OVS's code base. I have done this before
for my employer's project, because of company policies I cannot
release the final code, sorry.

If the full coredump is needed, you may want to try breakpad
https://code.google.com/p/google-breakpad, I have used it in a hobby
project, no production system experience though.

Thanks
Deng Yao

On Tue, Feb 10, 2015 at 3:12 AM, Ben Pfaff <blp at nicira.com> wrote:
> Occasionally (as today) I find myself asking a user to get a core dump
> and a backtrace, and find that the user doesn't have any of the skills
> or knowledge to do that.  Does anyone know of a good document that
> walks a user through how to do this (not necessarily OVS-specific)?  I
> don't want to hand-hold but I do want to help.
>
> Thanks,
>
> Ben.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From djhon9813 at gmail.com  Wed Feb 25 03:09:59 2015
From: djhon9813 at gmail.com (david jhon)
Date: Wed, 25 Feb 2015 16:09:59 +0500
Subject: [ovs-discuss] getting packets on ovs kernel module for
	testing/debugging
Message-ID: <CANPUzQ3BOy0baiJqmFA4vy1+=DL-c6DE61US8PNu_d358BDUew@mail.gmail.com>

hi,
In order to debug ovs kernel module in gdb, I have set a breakpoint at
ovs_dp_process_packet() method in datapath/datapath.c, generating traffic
with ping command from one mininet host to other, but not able to debug it
at all because on running n in gdb, I get "The program is not being run."

I am using the following steps to debug openvswitch kernel module:
-> gdb vmlinux /proc/kcore
-> cd /sys/modules/openvswitch/sections/; ls A1; cat .text .data .bss
-> add-symbol-file /root/ovs/_build-gcc/datapath/linux/openvswitch.ko
0xf8819000 \
-s .data 0xf8825000 \
-s .bss 0xf8825380
b datapath/datapath.c:288

Please guide me how do I make it work.


David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150225/9f25a05b/attachment.html>

From stephen.finucane at intel.com  Wed Feb 25 07:31:23 2015
From: stephen.finucane at intel.com (Finucane, Stephen)
Date: Wed, 25 Feb 2015 15:31:23 +0000
Subject: [ovs-discuss] toit (Open vSwitch Integration Testsuite) pushed to
	OPNFV
Message-ID: <6A74A01C3512C646A9ED99AFA28AEB9818249344@IRSMSX108.ger.corp.intel.com>

Folks,

We've pushed a good chunk of our integration test framework, known as 'toit' (The Open vSwitch Integration Testsuite), to the OPNFV community. You can find the mail with links to the reviews here:

	http://lists.opnfv.org/pipermail/opnfv-tech-discuss/2015-February/001244.html

'toit' is an integration/performance testing framework I developed to replace a legacy, Bash-based one we used for Intel DPDK vSwitch. We use 'toit' to validate any significant changes we make to Open vSwitch (such as the vHost RFC) and also run it in our nightly builds to highlight any performance issues that may have made their way into upstream master.

The expectation is that 'toit' will be refactored to genericize it for different switches/platforms (it currently focuses on Open vSwitch w/ DPDK datapath on Fedora). However, there's a good chance that, given a little work (mainly making use of libvirt/vagrant for VMs + supporting other datapath types), much of it would be suitable for use in the integration test framework that appears to be in development:

	http://openvswitch.org/pipermail/discuss/2015-January/016235.html

The OPNFV mail includes links to the actual Gerrit reviews (note that you will require Linux Foundation credentials to access this). I also have slides that I can share (does the mailing list support attachments?). I would welcome feedback on any aspect of the framework, should it interest anyone.

Cheers,
Stephen

From swairshah at gmail.com  Wed Feb 25 09:28:56 2015
From: swairshah at gmail.com (swair shah)
Date: Wed, 25 Feb 2015 11:28:56 -0600
Subject: [ovs-discuss] packet reorderoing
Message-ID: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>

Hi,

When packets which does not match any rule in ovs, are buffered at the
ingress switch, say first n packets are buffered. Switch sends a flow_mod
and message and packet_out for the buffered packets, meanwhile if some more
packets of the same flow arrive (say n+1 to m), they'll also get buffered
(as flow_mod) hasn't arrived yet.

Once flow_mod message arrives at the switch then subsequent packets of the
flow will be forwarded but packets (n+1 to m) will still be buffered
waiting for their packet_outs. This results in reordering of packets.

Is there a way around this, besides from proactively setting up a flow?

Is there a way to match flow_mod to existing buffered packets?

thanks,
swair.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150225/cb0b82d9/attachment-0001.html>

From nuno.carrulo at ua.pt  Wed Feb 25 11:05:44 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Wed, 25 Feb 2015 19:05:44 +0000
Subject: [ovs-discuss] OVSwitch - Meters
Message-ID: <1424891138795.95407@ua.pt>

Hello.


I looked into the FAQ from openvswitch.org and it says there:

"Since version 2.0, Open vSwitch has OpenFlow protocol support for OpenFlow meters. There is no implementation of meters in the Open vSwitch software switch (neither the kernel-based nor userspace switches)."


It means that we still can install meters, for instance using a controller API such as Northbound API from OpenDaylight, however the meter won't be applied ?

Or its just we just can't add meters using ovs-vsctl command ?


I'm currently using mininet 2.2 which has openvswitch version 2.0.2


Regards,

Nuno B.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150225/f0cdafac/attachment.html>

From blp at nicira.com  Wed Feb 25 11:46:46 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 25 Feb 2015 11:46:46 -0800
Subject: [ovs-discuss] OVSwitch - Meters
In-Reply-To: <1424891138795.95407@ua.pt>
References: <1424891138795.95407@ua.pt>
Message-ID: <20150225194646.GA10186@nicira.com>

On Wed, Feb 25, 2015 at 07:05:44PM +0000, Rui Braz wrote:
> I looked into the FAQ from openvswitch.org and it says there:
> 
> "Since version 2.0, Open vSwitch has OpenFlow protocol support for
> OpenFlow meters. There is no implementation of meters in the Open
> vSwitch software switch (neither the kernel-based nor userspace
> switches)."
> 
> It means that we still can install meters, for instance using a
> controller API such as Northbound API from OpenDaylight, however the
> meter won't be applied ?

You can't install meters, because the datapaths do not support them.

> Or its just we just can't add meters using ovs-vsctl command ?

ovs-ofctl is the command that would add meters.  It can't install
meters, because the datapaths do not support them.

From badveli_vishnuus at yahoo.com  Wed Feb 25 11:53:05 2015
From: badveli_vishnuus at yahoo.com (vis reddy)
Date: Wed, 25 Feb 2015 19:53:05 +0000 (UTC)
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <20150204221710.GK5737@nicira.com>
References: <20150204221710.GK5737@nicira.com>
Message-ID: <2063828000.6187452.1424893985564.JavaMail.yahoo@mail.yahoo.com>

Thanks Sir,I have another question i have my own schema vis.schemahow do i use ovsdb-idlc to generate my own idl header filei see that vtep-idl.h generated from vtep.ovsschema, vtep.xmlnot able to figure out how, could you please explain? ThanksVishnu
      From: Ben Pfaff <blp at nicira.com>
 To: vis reddy <badveli_vishnuus at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Wednesday, 4 February 2015 2:17 PM
 Subject: Re: [ovs-discuss] ovsdb update operation
   
On Wed, Feb 04, 2015 at 08:09:41PM +0000, vis reddy wrote:


> 
> Hello All,Going through rfc 7047
> The operation updates rows in a table.  It searches "table" for rows
>    that match all the conditions specified in "where".  For each
>    matching row, it changes the value of each column specified in "row"
>    to the value for that column specified in "row". 
> I am not able to find out if there is an operation??which tries to find a row that match conditions and if does not exist, it can insert,??how do we achieve some thing like this?
> this is useful as I do not have a idea if the row is existing??i would want to update itor insert it if it does not exist. Should i always use select followed by insert or update operations.

I think you'll have to select then insert or update in that case.


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150225/21dcbc7e/attachment.html>

From badveli_vishnuus at yahoo.com  Wed Feb 25 12:01:26 2015
From: badveli_vishnuus at yahoo.com (vis reddy)
Date: Wed, 25 Feb 2015 20:01:26 +0000 (UTC)
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <2063828000.6187452.1424893985564.JavaMail.yahoo@mail.yahoo.com>
References: <20150204221710.GK5737@nicira.com>
 <2063828000.6187452.1424893985564.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <675467178.6164994.1424894486468.JavaMail.yahoo@mail.yahoo.com>

Sorry SirJust realized it might be far away place from my office, how about 12:30?ThanksVishnu
      From: vis reddy <badveli_vishnuus at yahoo.com>
 To: Ben Pfaff <blp at nicira.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Wednesday, 25 February 2015 11:53 AM
 Subject: Re: [ovs-discuss] ovsdb update operation
   
Thanks Sir,I have another question i have my own schema vis.schemahow do i use ovsdb-idlc to generate my own idl header filei see that vtep-idl.h generated from vtep.ovsschema, vtep.xmlnot able to figure out how, could you please explain? ThanksVishnu
 

     From: Ben Pfaff <blp at nicira.com>
 To: vis reddy <badveli_vishnuus at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Wednesday, 4 February 2015 2:17 PM
 Subject: Re: [ovs-discuss] ovsdb update operation
   
On Wed, Feb 04, 2015 at 08:09:41PM +0000, vis reddy wrote:


> 
> Hello All,Going through rfc 7047
> The operation updates rows in a table.  It searches "table" for rows
>    that match all the conditions specified in "where".  For each
>    matching row, it changes the value of each column specified in "row"
>    to the value for that column specified in "row". 
> I am not able to find out if there is an operation??which tries to find a row that match conditions and if does not exist, it can insert,??how do we achieve some thing like this?
> this is useful as I do not have a idea if the row is existing??i would want to update itor insert it if it does not exist. Should i always use select followed by insert or update operations.

I think you'll have to select then insert or update in that case.


   

  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150225/908877e6/attachment.html>

From blp at nicira.com  Wed Feb 25 12:06:33 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 25 Feb 2015 12:06:33 -0800
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <2063828000.6187452.1424893985564.JavaMail.yahoo@mail.yahoo.com>
References: <20150204221710.GK5737@nicira.com>
 <2063828000.6187452.1424893985564.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150225200633.GC10186@nicira.com>

Please see the OVS makefiles, specifically the idlc related stuff in
ovsdb/automake.mk, also the manpage for ovsdb-idlc.

On Wed, Feb 25, 2015 at 07:53:05PM +0000, vis reddy wrote:
> Thanks Sir,I have another question i have my own schema vis.schemahow do i use??ovsdb-idlc to generate my own idl header filei see that vtep-idl.h generated from??vtep.ovsschema, vtep.xmlnot able to figure out how,??could you please explain???ThanksVishnu
>       From: Ben Pfaff <blp at nicira.com>
>  To: vis reddy <badveli_vishnuus at yahoo.com> 
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
>  Sent: Wednesday, 4 February 2015 2:17 PM
>  Subject: Re: [ovs-discuss] ovsdb update operation
>    
> On Wed, Feb 04, 2015 at 08:09:41PM +0000, vis reddy wrote:
> 
> 
> > 
> > Hello All,Going through rfc 7047
> > The operation updates rows in a table.?? It searches "table" for rows
> >?? ?? that match all the conditions specified in "where".?? For each
> >?? ?? matching row, it changes the value of each column specified in "row"
> >?? ?? to the value for that column specified in "row". 
> > I am not able to find out if there is an operation??which tries to find a row that match conditions and if does not exist, it can insert,??how do we achieve some thing like this?
> > this is useful as I do not have a idea if the row is existing??i would want to update itor insert it if it does not exist. Should i always use select followed by insert or update operations.
> 
> I think you'll have to select then insert or update in that case.
> 
> 
>   

From nuno.carrulo at ua.pt  Wed Feb 25 15:23:34 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Wed, 25 Feb 2015 23:23:34 +0000
Subject: [ovs-discuss] OVSwitch - Meters
In-Reply-To: <20150225194646.GA10186@nicira.com>
References: <1424891138795.95407@ua.pt>,<20150225194646.GA10186@nicira.com>
Message-ID: <1424906609296.63293@ua.pt>

Got it, thanks Ben. One last question, sbsides meters, are queues also not supported on openvswitch ?

Regards, 
Nuno B.

________________________________________
De: Ben Pfaff <blp at nicira.com>
Enviado: 25 de fevereiro de 2015 19:46
Para: Rui Braz
Cc: discuss at openvswitch.org
Assunto: Re: [ovs-discuss] OVSwitch - Meters

On Wed, Feb 25, 2015 at 07:05:44PM +0000, Rui Braz wrote:
> I looked into the FAQ from openvswitch.org and it says there:
>
> "Since version 2.0, Open vSwitch has OpenFlow protocol support for
> OpenFlow meters. There is no implementation of meters in the Open
> vSwitch software switch (neither the kernel-based nor userspace
> switches)."
>
> It means that we still can install meters, for instance using a
> controller API such as Northbound API from OpenDaylight, however the
> meter won't be applied ?

You can't install meters, because the datapaths do not support them.

> Or its just we just can't add meters using ovs-vsctl command ?

ovs-ofctl is the command that would add meters.  It can't install
meters, because the datapaths do not support them.

From blp at nicira.com  Wed Feb 25 15:25:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 25 Feb 2015 15:25:32 -0800
Subject: [ovs-discuss] OVSwitch - Meters
In-Reply-To: <1424906609296.63293@ua.pt>
References: <1424891138795.95407@ua.pt> <20150225194646.GA10186@nicira.com>
 <1424906609296.63293@ua.pt>
Message-ID: <20150225232532.GB11161@nicira.com>

Queues are supported, please read the documentation for details.

On Wed, Feb 25, 2015 at 11:23:34PM +0000, Rui Braz wrote:
> Got it, thanks Ben. One last question, sbsides meters, are queues also not supported on openvswitch ?
> 
> Regards, 
> Nuno B.
> 
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 25 de fevereiro de 2015 19:46
> Para: Rui Braz
> Cc: discuss at openvswitch.org
> Assunto: Re: [ovs-discuss] OVSwitch - Meters
> 
> On Wed, Feb 25, 2015 at 07:05:44PM +0000, Rui Braz wrote:
> > I looked into the FAQ from openvswitch.org and it says there:
> >
> > "Since version 2.0, Open vSwitch has OpenFlow protocol support for
> > OpenFlow meters. There is no implementation of meters in the Open
> > vSwitch software switch (neither the kernel-based nor userspace
> > switches)."
> >
> > It means that we still can install meters, for instance using a
> > controller API such as Northbound API from OpenDaylight, however the
> > meter won't be applied ?
> 
> You can't install meters, because the datapaths do not support them.
> 
> > Or its just we just can't add meters using ovs-vsctl command ?
> 
> ovs-ofctl is the command that would add meters.  It can't install
> meters, because the datapaths do not support them.

From cvinllen at gmail.com  Wed Feb 25 21:52:39 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Thu, 26 Feb 2015 13:52:39 +0800
Subject: [ovs-discuss] bridge adapter problem with VirtualBox
Message-ID: <CAN2QyzY=m5_fTb-9YFq1T6S6Vm8Qg7UNxS1a25M2ybhjJLN_CQ@mail.gmail.com>

Hi, all:
    I create two vhost, and connect to my ovs bridge with bridge apapter,
but there is no ip address when i start them, ofcourse, the two vhosts
cann't connect to the Internet.
    Here comes my code :

#!/bin/bash
ovs-vsctl add-br mybr
ovs-vsctl add-port mybr wlan0
ifconfig wlan0 0
dhclient mybr
ifconfig mybr up
ip tuntap add mod tap vport1
ip tuntap add mod tap vport2
ifconfig vport1 up
ifconfig vport2 up
ovs-vsctl add-port mybr vport1
ovs-vsctl add-port mybr vport2

    Greate appreciate for anyone's reply.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150226/4384866d/attachment.html>

From blp at nicira.com  Wed Feb 25 22:30:11 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 25 Feb 2015 22:30:11 -0800
Subject: [ovs-discuss] getting packets on ovs kernel module for
 testing/debugging
In-Reply-To: <CANPUzQ3BOy0baiJqmFA4vy1+=DL-c6DE61US8PNu_d358BDUew@mail.gmail.com>
References: <CANPUzQ3BOy0baiJqmFA4vy1+=DL-c6DE61US8PNu_d358BDUew@mail.gmail.com>
Message-ID: <20150226063011.GE12872@nicira.com>

On Wed, Feb 25, 2015 at 04:09:59PM +0500, david jhon wrote:
> In order to debug ovs kernel module in gdb, I have set a breakpoint at
> ovs_dp_process_packet() method in datapath/datapath.c, generating traffic
> with ping command from one mininet host to other, but not able to debug it
> at all because on running n in gdb, I get "The program is not being run."
> 
> I am using the following steps to debug openvswitch kernel module:
> -> gdb vmlinux /proc/kcore
> -> cd /sys/modules/openvswitch/sections/; ls A1; cat .text .data .bss
> -> add-symbol-file /root/ovs/_build-gcc/datapath/linux/openvswitch.ko
> 0xf8819000 \
> -s .data 0xf8825000 \
> -s .bss 0xf8825380
> b datapath/datapath.c:288
> 
> Please guide me how do I make it work.

I don't think you can debug the kernel that way.

I know a few kernel programmers.  None of them have ever mentioned using
GDB to debug the kernel.  I don't think it's commonly done.

From scott.lowe at scottlowe.org  Wed Feb 25 22:45:03 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Wed, 25 Feb 2015 23:45:03 -0700
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNBm=kBo+YUeisWcKWN8h82AY25sNkdRjbVX-dkzxJxp-FA@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
 <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
 <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>
 <7410C5DA-7F4A-4368-9603-7AB9D469497B@scottlowe.org>
 <CAGnqNBm=kBo+YUeisWcKWN8h82AY25sNkdRjbVX-dkzxJxp-FA@mail.gmail.com>
Message-ID: <B9C83149-11DE-4A9A-A128-609664659AD3@scottlowe.org>

Please see my responses inline, prefixed by [SL].

jayakeerthi k <jayakeerthik82 at gmail.com> wrote:

> Hi,
> i couldn't able to resolve the issue with above steps.i got the following error in virt-manager.
> 
> Error starting domain: Unable to add bridge 1511 port vnet0: Operation not supported
> 
> Traceback (most recent call last):
>   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 96, in cb_wrapper
>     callback(asyncjob, *args, **kwargs)
>   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 117, in tmpcb
>     callback(*args, **kwargs)
>   File "/usr/share/virt-manager/virtManager/domain.py", line 1162, in startup
>     self._backend.create()
>   File "/usr/lib/python2.7/dist-packages/libvirt.py", line 866, in create
>     if ret == -1: raise libvirtError ('virDomainCreate() failed', dom=self)
> libvirtError: Unable to add bridge 1511 port vnet0: Operation not supported


[SL] Jayakeerthi, does an OVS bridge named "1511" exist? If not, then you'll
see an error.

Did you edit the libvirt domain XML to be sure to tell libvirt that you're
using OVS? If not, then you'll see an error.

It's entirely possible (I don't use virt-manager, so I don't know for
certain) that this is a virt-manager issue. Have you tried using virsh
instead of virt-manager?


> Thanking you,
> jayakeerthi k
> 
> 
> On Mon, Feb 23, 2015 at 10:53 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> Please see my responses inline, prefixed by [SL].
> 
> jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> 
> > sorry for the delay,
> > libvirt version is 1.2.2
> > ovs_version: "2.0.2"
> > i'm installing it through Virt-manager.
> > xml file is
> >
> > <snip>
> >
> >     <interface type='bridge'>
> >       <mac address='52:54:00:f1:51:47'/>
> >       <source bridge='1511'/>
> >       <model type='virtio'/>
> >       <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
> >     </interface>
> 
> 
> [SL] This section is the issue. The guest domain (VM) is set to use a bridge ("1511"?), but you haven't specified "virtualport type=openvswitch", so Libvirt isn't able to properly communicate with OVS.
> 
> If you look at the example XML that I supplied here:
> 
> <http://blog.scottlowe.org/2012/11/12/libvirt-ovs-integration-revisited/>
> 
> then you can see a snippet of network XML configuration that *will* work with OVS. This should get you started down the right path.
> 
> Good luck!
> 
> > On Thu, Feb 19, 2015 at 10:47 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> > Please see my responses inline, prefixed by [SL].
> >
> > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> >
> > > OK..
> > >
> > > when i try to create vm i'm gettting error unable to add vnet0 port on the
> > > bridge br3.
> >
> > [SL] Jayakeerthi, can you share the following information to help us help
> > you?
> >
> > - The network portion of the domain XML configuration for your VM (obtained
> > via 'virsh dumpxml <vm-name>'
> >
> > - The versions of OVS and libvirt installed on your system
> >
> > - The command(s) you are using to create and/or start the VM
> >
> > Feel free to use a service like pastebin.com to share the domain XML
> > configuration, if you'd like.
> >
> > Thanks!
> >
> > >> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >>
> > >> I don't think you can. KVM creates the port, OVS only handles switching.
> > >>
> > >>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
> > >>>
> > >>> how to create port's in openvswitch that can be assigned to vm created
> > >>> with KVM?


--
Scott


From djhon9813 at gmail.com  Wed Feb 25 23:00:35 2015
From: djhon9813 at gmail.com (david jhon)
Date: Thu, 26 Feb 2015 12:00:35 +0500
Subject: [ovs-discuss] getting packets on ovs kernel module for
	testing/debugging
In-Reply-To: <20150226063011.GE12872@nicira.com>
References: <CANPUzQ3BOy0baiJqmFA4vy1+=DL-c6DE61US8PNu_d358BDUew@mail.gmail.com>
 <20150226063011.GE12872@nicira.com>
Message-ID: <CANPUzQ3900QVnjPjXAuH9jLTNh_0CWpBMt5jg4OO0HPN_5AsFQ@mail.gmail.com>

Thanks Ben,

I want to test how ovs kernel module processes packets and update a
corresponding flow entry in flow_table. Any suggestions please?

On Thu, Feb 26, 2015 at 11:30 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Feb 25, 2015 at 04:09:59PM +0500, david jhon wrote:
> > In order to debug ovs kernel module in gdb, I have set a breakpoint at
> > ovs_dp_process_packet() method in datapath/datapath.c, generating traffic
> > with ping command from one mininet host to other, but not able to debug
> it
> > at all because on running n in gdb, I get "The program is not being run."
> >
> > I am using the following steps to debug openvswitch kernel module:
> > -> gdb vmlinux /proc/kcore
> > -> cd /sys/modules/openvswitch/sections/; ls A1; cat .text .data .bss
> > -> add-symbol-file /root/ovs/_build-gcc/datapath/linux/openvswitch.ko
> > 0xf8819000 \
> > -s .data 0xf8825000 \
> > -s .bss 0xf8825380
> > b datapath/datapath.c:288
> >
> > Please guide me how do I make it work.
>
> I don't think you can debug the kernel that way.
>
> I know a few kernel programmers.  None of them have ever mentioned using
> GDB to debug the kernel.  I don't think it's commonly done.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150226/01598976/attachment.html>

From blp at nicira.com  Wed Feb 25 23:05:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 25 Feb 2015 23:05:20 -0800
Subject: [ovs-discuss] getting packets on ovs kernel module for
 testing/debugging
In-Reply-To: <CANPUzQ3900QVnjPjXAuH9jLTNh_0CWpBMt5jg4OO0HPN_5AsFQ@mail.gmail.com>
References: <CANPUzQ3BOy0baiJqmFA4vy1+=DL-c6DE61US8PNu_d358BDUew@mail.gmail.com>
 <20150226063011.GE12872@nicira.com>
 <CANPUzQ3900QVnjPjXAuH9jLTNh_0CWpBMt5jg4OO0HPN_5AsFQ@mail.gmail.com>
Message-ID: <20150226070520.GG12872@nicira.com>

I think you need to ask a more specific question, because so far my
answer is just "Write some code to do that."

On Thu, Feb 26, 2015 at 12:00:35PM +0500, david jhon wrote:
> Thanks Ben,
> 
> I want to test how ovs kernel module processes packets and update a
> corresponding flow entry in flow_table. Any suggestions please?
> 
> On Thu, Feb 26, 2015 at 11:30 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Feb 25, 2015 at 04:09:59PM +0500, david jhon wrote:
> > > In order to debug ovs kernel module in gdb, I have set a breakpoint at
> > > ovs_dp_process_packet() method in datapath/datapath.c, generating traffic
> > > with ping command from one mininet host to other, but not able to debug
> > it
> > > at all because on running n in gdb, I get "The program is not being run."
> > >
> > > I am using the following steps to debug openvswitch kernel module:
> > > -> gdb vmlinux /proc/kcore
> > > -> cd /sys/modules/openvswitch/sections/; ls A1; cat .text .data .bss
> > > -> add-symbol-file /root/ovs/_build-gcc/datapath/linux/openvswitch.ko
> > > 0xf8819000 \
> > > -s .data 0xf8825000 \
> > > -s .bss 0xf8825380
> > > b datapath/datapath.c:288
> > >
> > > Please guide me how do I make it work.
> >
> > I don't think you can debug the kernel that way.
> >
> > I know a few kernel programmers.  None of them have ever mentioned using
> > GDB to debug the kernel.  I don't think it's commonly done.
> >

From stefano.salsano at uniroma2.it  Thu Feb 26 05:17:01 2015
From: stefano.salsano at uniroma2.it (Stefano Salsano)
Date: Thu, 26 Feb 2015 14:17:01 +0100
Subject: [ovs-discuss] match/push/pop more than 3 MPLS labels
Message-ID: <54EF1CCD.4010705@uniroma2.it>

Hi,

there is a limit of 3 MPLS labels that are supported by Open vSwitch

we need to raise it at 5 labels, to implement a segment routing scenario

we are ready to patch/recompile the kernel if needed and patch/recompile 
Open vSwitch, we'd like to understand if it is a matter of changing some 
configuration parameters in the kernel and/or in Open vSwitch or if more 
substantial patches are needed

any help or suggestion is welcome!

I am trying on ovs-discuss list... may be the ovs-dev list is more 
appropriate for this type of questions?

thank you

ciao
Stefano
-- 
*******************************************************************
Stefano Salsano
Professore Associato
Dipartimento Ingegneria Elettronica
Universita' di Roma Tor Vergata
Via del Politecnico, 1 - 00133 Roma - ITALY

http://netgroup.uniroma2.it/Stefano_Salsano/

E-mail  : stefano.salsano at uniroma2.it
Cell.   : +39 320 4307310
Office  : (Tel.) +39 06 72597770  (Fax.) +39 06 72597435
*******************************************************************

From jayakeerthik82 at gmail.com  Wed Feb 25 21:29:38 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Thu, 26 Feb 2015 10:59:38 +0530
Subject: [ovs-discuss] BUG
In-Reply-To: <7410C5DA-7F4A-4368-9603-7AB9D469497B@scottlowe.org>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
 <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
 <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>
 <7410C5DA-7F4A-4368-9603-7AB9D469497B@scottlowe.org>
Message-ID: <CAGnqNBm=kBo+YUeisWcKWN8h82AY25sNkdRjbVX-dkzxJxp-FA@mail.gmail.com>

Hi,
i couldn't able to resolve the issue with above steps.i got the following
error in virt-manager.

Error starting domain: Unable to add bridge 1511 port vnet0: Operation not
supported

Traceback (most recent call last):
  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 96, in
cb_wrapper
    callback(asyncjob, *args, **kwargs)
  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 117, in tmpcb
    callback(*args, **kwargs)
  File "/usr/share/virt-manager/virtManager/domain.py", line 1162, in
startup
    self._backend.create()
  File "/usr/lib/python2.7/dist-packages/libvirt.py", line 866, in create
    if ret == -1: raise libvirtError ('virDomainCreate() failed', dom=self)
libvirtError: Unable to add bridge 1511 port vnet0: Operation not supported


Thanking you,
jayakeerthi k


On Mon, Feb 23, 2015 at 10:53 PM, Scott Lowe <scott.lowe at scottlowe.org>
wrote:

> Please see my responses inline, prefixed by [SL].
>
> jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
>
> > sorry for the delay,
> > libvirt version is 1.2.2
> > ovs_version: "2.0.2"
> > i'm installing it through Virt-manager.
> > xml file is
> >
> > <snip>
> >
> >     <interface type='bridge'>
> >       <mac address='52:54:00:f1:51:47'/>
> >       <source bridge='1511'/>
> >       <model type='virtio'/>
> >       <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> function='0x0'/>
> >     </interface>
>
>
> [SL] This section is the issue. The guest domain (VM) is set to use a
> bridge ("1511"?), but you haven't specified "virtualport type=openvswitch",
> so Libvirt isn't able to properly communicate with OVS.
>
> If you look at the example XML that I supplied here:
>
> <http://blog.scottlowe.org/2012/11/12/libvirt-ovs-integration-revisited/>
>
> then you can see a snippet of network XML configuration that *will* work
> with OVS. This should get you started down the right path.
>
> Good luck!
>
> > On Thu, Feb 19, 2015 at 10:47 PM, Scott Lowe <scott.lowe at scottlowe.org>
> wrote:
> > Please see my responses inline, prefixed by [SL].
> >
> > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> >
> > > OK..
> > >
> > > when i try to create vm i'm gettting error unable to add vnet0 port on
> the
> > > bridge br3.
> >
> > [SL] Jayakeerthi, can you share the following information to help us help
> > you?
> >
> > - The network portion of the domain XML configuration for your VM
> (obtained
> > via 'virsh dumpxml <vm-name>'
> >
> > - The versions of OVS and libvirt installed on your system
> >
> > - The command(s) you are using to create and/or start the VM
> >
> > Feel free to use a service like pastebin.com to share the domain XML
> > configuration, if you'd like.
> >
> > Thanks!
> >
> > >> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >>
> > >> I don't think you can. KVM creates the port, OVS only handles
> switching.
> > >>
> > >>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
> > >>>
> > >>> how to create port's in openvswitch that can be assigned to vm
> created
> > >>> with KVM?
>
>
> --
> Scott
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150226/541b688d/attachment-0001.html>

From jayakeerthik82 at gmail.com  Wed Feb 25 23:10:01 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Thu, 26 Feb 2015 12:40:01 +0530
Subject: [ovs-discuss] BUG
In-Reply-To: <B9C83149-11DE-4A9A-A128-609664659AD3@scottlowe.org>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
 <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
 <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>
 <7410C5DA-7F4A-4368-9603-7AB9D469497B@scottlowe.org>
 <CAGnqNBm=kBo+YUeisWcKWN8h82AY25sNkdRjbVX-dkzxJxp-FA@mail.gmail.com>
 <B9C83149-11DE-4A9A-A128-609664659AD3@scottlowe.org>
Message-ID: <CAGnqNB=U70P-9XjXO+J=eXzkJhWPPhTV-yXJj+WbvOz-k3qkEA@mail.gmail.com>

Hi,
i tried with virsh but again issue.

perf at shakthi:/etc/libvirt/qemu$ virsh start 1511_secondary
error: Failed to start domain 1511_secondary
error: Unable to add bridge 1511 port vnet0: Operation not supported

*domain xml file contents*
 <interface type='bridge'>
      <virtualport type='openvswitch'/>
      <mac address='52:54:00:f1:51:47'/>
      <source bridge='1511'/>
      <model type='virtio'/>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x00'
function='0x0'/>
    </interface>

output of ovs-vsctl show
54ee0814-7243-42df-8a04-17b028f07f99
    Bridge "1511"
        Port "1511pr"
            Interface "1511pr"
                type: internal
        Port "1511"
            Interface "1511"
                type: internal
        Port "em2"
            Interface "em2"
    l
    ovs_version: "2.0.2"


thax,
jayakeerthi

On Thu, Feb 26, 2015 at 12:15 PM, Scott Lowe <scott.lowe at scottlowe.org>
wrote:

> Please see my responses inline, prefixed by [SL].
>
> jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
>
> > Hi,
> > i couldn't able to resolve the issue with above steps.i got the
> following error in virt-manager.
> >
> > Error starting domain: Unable to add bridge 1511 port vnet0: Operation
> not supported
> >
> > Traceback (most recent call last):
> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 96, in
> cb_wrapper
> >     callback(asyncjob, *args, **kwargs)
> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 117, in
> tmpcb
> >     callback(*args, **kwargs)
> >   File "/usr/share/virt-manager/virtManager/domain.py", line 1162, in
> startup
> >     self._backend.create()
> >   File "/usr/lib/python2.7/dist-packages/libvirt.py", line 866, in create
> >     if ret == -1: raise libvirtError ('virDomainCreate() failed',
> dom=self)
> > libvirtError: Unable to add bridge 1511 port vnet0: Operation not
> supported
>
>
> [SL] Jayakeerthi, does an OVS bridge named "1511" exist? If not, then
> you'll
> see an error.
>
> Did you edit the libvirt domain XML to be sure to tell libvirt that you're
> using OVS? If not, then you'll see an error.
>
> It's entirely possible (I don't use virt-manager, so I don't know for
> certain) that this is a virt-manager issue. Have you tried using virsh
> instead of virt-manager?
>
>
> > Thanking you,
> > jayakeerthi k
> >
> >
> > On Mon, Feb 23, 2015 at 10:53 PM, Scott Lowe <scott.lowe at scottlowe.org>
> wrote:
> > Please see my responses inline, prefixed by [SL].
> >
> > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> >
> > > sorry for the delay,
> > > libvirt version is 1.2.2
> > > ovs_version: "2.0.2"
> > > i'm installing it through Virt-manager.
> > > xml file is
> > >
> > > <snip>
> > >
> > >     <interface type='bridge'>
> > >       <mac address='52:54:00:f1:51:47'/>
> > >       <source bridge='1511'/>
> > >       <model type='virtio'/>
> > >       <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> function='0x0'/>
> > >     </interface>
> >
> >
> > [SL] This section is the issue. The guest domain (VM) is set to use a
> bridge ("1511"?), but you haven't specified "virtualport type=openvswitch",
> so Libvirt isn't able to properly communicate with OVS.
> >
> > If you look at the example XML that I supplied here:
> >
> > <http://blog.scottlowe.org/2012/11/12/libvirt-ovs-integration-revisited/
> >
> >
> > then you can see a snippet of network XML configuration that *will* work
> with OVS. This should get you started down the right path.
> >
> > Good luck!
> >
> > > On Thu, Feb 19, 2015 at 10:47 PM, Scott Lowe <scott.lowe at scottlowe.org>
> wrote:
> > > Please see my responses inline, prefixed by [SL].
> > >
> > > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> > >
> > > > OK..
> > > >
> > > > when i try to create vm i'm gettting error unable to add vnet0 port
> on the
> > > > bridge br3.
> > >
> > > [SL] Jayakeerthi, can you share the following information to help us
> help
> > > you?
> > >
> > > - The network portion of the domain XML configuration for your VM
> (obtained
> > > via 'virsh dumpxml <vm-name>'
> > >
> > > - The versions of OVS and libvirt installed on your system
> > >
> > > - The command(s) you are using to create and/or start the VM
> > >
> > > Feel free to use a service like pastebin.com to share the domain XML
> > > configuration, if you'd like.
> > >
> > > Thanks!
> > >
> > > >> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > >>
> > > >> I don't think you can. KVM creates the port, OVS only handles
> switching.
> > > >>
> > > >>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
> > > >>>
> > > >>> how to create port's in openvswitch that can be assigned to vm
> created
> > > >>> with KVM?
>
>
> --
> Scott
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150226/3aedeb23/attachment-0001.html>

From jayakeerthik82 at gmail.com  Wed Feb 25 23:25:53 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Thu, 26 Feb 2015 12:55:53 +0530
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNB=U70P-9XjXO+J=eXzkJhWPPhTV-yXJj+WbvOz-k3qkEA@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
 <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
 <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>
 <7410C5DA-7F4A-4368-9603-7AB9D469497B@scottlowe.org>
 <CAGnqNBm=kBo+YUeisWcKWN8h82AY25sNkdRjbVX-dkzxJxp-FA@mail.gmail.com>
 <B9C83149-11DE-4A9A-A128-609664659AD3@scottlowe.org>
 <CAGnqNB=U70P-9XjXO+J=eXzkJhWPPhTV-yXJj+WbvOz-k3qkEA@mail.gmail.com>
Message-ID: <CAGnqNB=VpGsfZZxA9NWw=bcC-SYe0NR4Wiafbxooo+hqeeKoQQ@mail.gmail.com>

Also edited #virsh net-edit default



On Thu, Feb 26, 2015 at 12:40 PM, jayakeerthi k <jayakeerthik82 at gmail.com>
wrote:

> Hi,
> i tried with virsh but again issue.
>
> perf at shakthi:/etc/libvirt/qemu$ virsh start 1511_secondary
> error: Failed to start domain 1511_secondary
> error: Unable to add bridge 1511 port vnet0: Operation not supported
>
> *domain xml file contents*
>  <interface type='bridge'>
>       <virtualport type='openvswitch'/>
>       <mac address='52:54:00:f1:51:47'/>
>       <source bridge='1511'/>
>       <model type='virtio'/>
>       <address type='pci' domain='0x0000' bus='0x00' slot='0x00'
> function='0x0'/>
>     </interface>
>
> output of ovs-vsctl show
> 54ee0814-7243-42df-8a04-17b028f07f99
>     Bridge "1511"
>         Port "1511pr"
>             Interface "1511pr"
>                 type: internal
>         Port "1511"
>             Interface "1511"
>                 type: internal
>         Port "em2"
>             Interface "em2"
>     l
>     ovs_version: "2.0.2"
>
>
> thax,
> jayakeerthi
>
> On Thu, Feb 26, 2015 at 12:15 PM, Scott Lowe <scott.lowe at scottlowe.org>
> wrote:
>
>> Please see my responses inline, prefixed by [SL].
>>
>> jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
>>
>> > Hi,
>> > i couldn't able to resolve the issue with above steps.i got the
>> following error in virt-manager.
>> >
>> > Error starting domain: Unable to add bridge 1511 port vnet0: Operation
>> not supported
>> >
>> > Traceback (most recent call last):
>> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 96, in
>> cb_wrapper
>> >     callback(asyncjob, *args, **kwargs)
>> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 117, in
>> tmpcb
>> >     callback(*args, **kwargs)
>> >   File "/usr/share/virt-manager/virtManager/domain.py", line 1162, in
>> startup
>> >     self._backend.create()
>> >   File "/usr/lib/python2.7/dist-packages/libvirt.py", line 866, in
>> create
>> >     if ret == -1: raise libvirtError ('virDomainCreate() failed',
>> dom=self)
>> > libvirtError: Unable to add bridge 1511 port vnet0: Operation not
>> supported
>>
>>
>> [SL] Jayakeerthi, does an OVS bridge named "1511" exist? If not, then
>> you'll
>> see an error.
>>
>> Did you edit the libvirt domain XML to be sure to tell libvirt that you're
>> using OVS? If not, then you'll see an error.
>>
>> It's entirely possible (I don't use virt-manager, so I don't know for
>> certain) that this is a virt-manager issue. Have you tried using virsh
>> instead of virt-manager?
>>
>>
>> > Thanking you,
>> > jayakeerthi k
>> >
>> >
>> > On Mon, Feb 23, 2015 at 10:53 PM, Scott Lowe <scott.lowe at scottlowe.org>
>> wrote:
>> > Please see my responses inline, prefixed by [SL].
>> >
>> > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
>> >
>> > > sorry for the delay,
>> > > libvirt version is 1.2.2
>> > > ovs_version: "2.0.2"
>> > > i'm installing it through Virt-manager.
>> > > xml file is
>> > >
>> > > <snip>
>> > >
>> > >     <interface type='bridge'>
>> > >       <mac address='52:54:00:f1:51:47'/>
>> > >       <source bridge='1511'/>
>> > >       <model type='virtio'/>
>> > >       <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
>> function='0x0'/>
>> > >     </interface>
>> >
>> >
>> > [SL] This section is the issue. The guest domain (VM) is set to use a
>> bridge ("1511"?), but you haven't specified "virtualport type=openvswitch",
>> so Libvirt isn't able to properly communicate with OVS.
>> >
>> > If you look at the example XML that I supplied here:
>> >
>> > <
>> http://blog.scottlowe.org/2012/11/12/libvirt-ovs-integration-revisited/>
>> >
>> > then you can see a snippet of network XML configuration that *will*
>> work with OVS. This should get you started down the right path.
>> >
>> > Good luck!
>> >
>> > > On Thu, Feb 19, 2015 at 10:47 PM, Scott Lowe <
>> scott.lowe at scottlowe.org> wrote:
>> > > Please see my responses inline, prefixed by [SL].
>> > >
>> > > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
>> > >
>> > > > OK..
>> > > >
>> > > > when i try to create vm i'm gettting error unable to add vnet0 port
>> on the
>> > > > bridge br3.
>> > >
>> > > [SL] Jayakeerthi, can you share the following information to help us
>> help
>> > > you?
>> > >
>> > > - The network portion of the domain XML configuration for your VM
>> (obtained
>> > > via 'virsh dumpxml <vm-name>'
>> > >
>> > > - The versions of OVS and libvirt installed on your system
>> > >
>> > > - The command(s) you are using to create and/or start the VM
>> > >
>> > > Feel free to use a service like pastebin.com to share the domain XML
>> > > configuration, if you'd like.
>> > >
>> > > Thanks!
>> > >
>> > > >> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com>
>> wrote:
>> > > >>
>> > > >> I don't think you can. KVM creates the port, OVS only handles
>> switching.
>> > > >>
>> > > >>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
>> > > >>>
>> > > >>> how to create port's in openvswitch that can be assigned to vm
>> created
>> > > >>> with KVM?
>>
>>
>> --
>> Scott
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150226/de39e6da/attachment.html>

From aatteka at nicira.com  Thu Feb 26 10:32:41 2015
From: aatteka at nicira.com (Ansis Atteka)
Date: Thu, 26 Feb 2015 10:32:41 -0800
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNB=VpGsfZZxA9NWw=bcC-SYe0NR4Wiafbxooo+hqeeKoQQ@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
 <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
 <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>
 <7410C5DA-7F4A-4368-9603-7AB9D469497B@scottlowe.org>
 <CAGnqNBm=kBo+YUeisWcKWN8h82AY25sNkdRjbVX-dkzxJxp-FA@mail.gmail.com>
 <B9C83149-11DE-4A9A-A128-609664659AD3@scottlowe.org>
 <CAGnqNB=U70P-9XjXO+J=eXzkJhWPPhTV-yXJj+WbvOz-k3qkEA@mail.gmail.com>
 <CAGnqNB=VpGsfZZxA9NWw=bcC-SYe0NR4Wiafbxooo+hqeeKoQQ@mail.gmail.com>
Message-ID: <CAA=3OqmOZ7yBqBGTuMx_ffAkpbK9XWOoY6CQcgZLrODfJJeXnw@mail.gmail.com>

On Wed, Feb 25, 2015 at 11:25 PM, jayakeerthi k
<jayakeerthik82 at gmail.com> wrote:
> Also edited #virsh net-edit default
>
>
>
> On Thu, Feb 26, 2015 at 12:40 PM, jayakeerthi k <jayakeerthik82 at gmail.com>
> wrote:
>>
>> Hi,
>> i tried with virsh but again issue.
>>
>> perf at shakthi:/etc/libvirt/qemu$ virsh start 1511_secondary
>> error: Failed to start domain 1511_secondary
>> error: Unable to add bridge 1511 port vnet0: Operation not supported

Can you tell us which libvirt version you are using?

After looking into libvirt source code it seems that "Unable to add
bridge ..." error message indicates that libvirt is treating bridge
1511 as Linux Bridge and not as OVS bridge:

in src/util/virnetdevbridge.c:

    if (ioctl(fd, SIOCBRADDIF, &ifr) < 0) {
        virReportSystemError(errno,
                             _("Unable to add bridge %s port %s"),
brname, ifname);
        goto cleanup;
    }

The code that adds interface to OVS bridge is in

src/util/virnetdevopenvswitch.c

and in case of failure the error message would look like:

    if (virCommandRun(cmd, NULL) < 0) {
        virReportError(VIR_ERR_INTERNAL_ERROR,
                       _("Unable to add port %s to OVS bridge %s"),
                       ifname, brname);
        goto cleanup;
    }


As you can see you are missing OVS keyword in your error message! So
this is not an OVS bug but rather:
1. misconfiguration (i.e. you really haven't edited VM's XML file correctly)
2. you are using old libvirt (OVS support was introduced in libvirt 0.9.11)
3. this is a libvirt bug (if 1. and 2. is not the case).



>>
>> domain xml file contents
>>  <interface type='bridge'>
>>       <virtualport type='openvswitch'/>
>>       <mac address='52:54:00:f1:51:47'/>
>>       <source bridge='1511'/>
>>       <model type='virtio'/>
>>       <address type='pci' domain='0x0000' bus='0x00' slot='0x00'
>> function='0x0'/>
>>     </interface>
>>
>> output of ovs-vsctl show
>> 54ee0814-7243-42df-8a04-17b028f07f99
>>     Bridge "1511"
>>         Port "1511pr"
>>             Interface "1511pr"
>>                 type: internal
>>         Port "1511"
>>             Interface "1511"
>>                 type: internal
>>         Port "em2"
>>             Interface "em2"
>>     l
>>     ovs_version: "2.0.2"
>>
>>
>> thax,
>> jayakeerthi
>>
>> On Thu, Feb 26, 2015 at 12:15 PM, Scott Lowe <scott.lowe at scottlowe.org>
>> wrote:
>>>
>>> Please see my responses inline, prefixed by [SL].
>>>
>>> jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
>>>
>>> > Hi,
>>> > i couldn't able to resolve the issue with above steps.i got the
>>> > following error in virt-manager.
>>> >
>>> > Error starting domain: Unable to add bridge 1511 port vnet0: Operation
>>> > not supported
>>> >
>>> > Traceback (most recent call last):
>>> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 96, in
>>> > cb_wrapper
>>> >     callback(asyncjob, *args, **kwargs)
>>> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 117, in
>>> > tmpcb
>>> >     callback(*args, **kwargs)
>>> >   File "/usr/share/virt-manager/virtManager/domain.py", line 1162, in
>>> > startup
>>> >     self._backend.create()
>>> >   File "/usr/lib/python2.7/dist-packages/libvirt.py", line 866, in
>>> > create
>>> >     if ret == -1: raise libvirtError ('virDomainCreate() failed',
>>> > dom=self)
>>> > libvirtError: Unable to add bridge 1511 port vnet0: Operation not
>>> > supported
>>>
>>>
>>> [SL] Jayakeerthi, does an OVS bridge named "1511" exist? If not, then
>>> you'll
>>> see an error.
>>>
>>> Did you edit the libvirt domain XML to be sure to tell libvirt that
>>> you're
>>> using OVS? If not, then you'll see an error.
>>>
>>> It's entirely possible (I don't use virt-manager, so I don't know for
>>> certain) that this is a virt-manager issue. Have you tried using virsh
>>> instead of virt-manager?
>>>
>>>
>>> > Thanking you,
>>> > jayakeerthi k
>>> >
>>> >
>>> > On Mon, Feb 23, 2015 at 10:53 PM, Scott Lowe <scott.lowe at scottlowe.org>
>>> > wrote:
>>> > Please see my responses inline, prefixed by [SL].
>>> >
>>> > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
>>> >
>>> > > sorry for the delay,
>>> > > libvirt version is 1.2.2
>>> > > ovs_version: "2.0.2"
>>> > > i'm installing it through Virt-manager.
>>> > > xml file is
>>> > >
>>> > > <snip>
>>> > >
>>> > >     <interface type='bridge'>
>>> > >       <mac address='52:54:00:f1:51:47'/>
>>> > >       <source bridge='1511'/>
>>> > >       <model type='virtio'/>
>>> > >       <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
>>> > > function='0x0'/>
>>> > >     </interface>
>>> >
>>> >
>>> > [SL] This section is the issue. The guest domain (VM) is set to use a
>>> > bridge ("1511"?), but you haven't specified "virtualport type=openvswitch",
>>> > so Libvirt isn't able to properly communicate with OVS.
>>> >
>>> > If you look at the example XML that I supplied here:
>>> >
>>> >
>>> > <http://blog.scottlowe.org/2012/11/12/libvirt-ovs-integration-revisited/>
>>> >
>>> > then you can see a snippet of network XML configuration that *will*
>>> > work with OVS. This should get you started down the right path.
>>> >
>>> > Good luck!
>>> >
>>> > > On Thu, Feb 19, 2015 at 10:47 PM, Scott Lowe
>>> > > <scott.lowe at scottlowe.org> wrote:
>>> > > Please see my responses inline, prefixed by [SL].
>>> > >
>>> > > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
>>> > >
>>> > > > OK..
>>> > > >
>>> > > > when i try to create vm i'm gettting error unable to add vnet0 port
>>> > > > on the
>>> > > > bridge br3.
>>> > >
>>> > > [SL] Jayakeerthi, can you share the following information to help us
>>> > > help
>>> > > you?
>>> > >
>>> > > - The network portion of the domain XML configuration for your VM
>>> > > (obtained
>>> > > via 'virsh dumpxml <vm-name>'
>>> > >
>>> > > - The versions of OVS and libvirt installed on your system
>>> > >
>>> > > - The command(s) you are using to create and/or start the VM
>>> > >
>>> > > Feel free to use a service like pastebin.com to share the domain XML
>>> > > configuration, if you'd like.
>>> > >
>>> > > Thanks!
>>> > >
>>> > > >> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com>
>>> > > >> wrote:
>>> > > >>
>>> > > >> I don't think you can. KVM creates the port, OVS only handles
>>> > > >> switching.
>>> > > >>
>>> > > >>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
>>> > > >>>
>>> > > >>> how to create port's in openvswitch that can be assigned to vm
>>> > > >>> created
>>> > > >>> with KVM?
>>>
>>>
>>> --
>>> Scott
>>>
>>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From alexw at nicira.com  Thu Feb 26 10:44:05 2015
From: alexw at nicira.com (Alex Wang)
Date: Thu, 26 Feb 2015 10:44:05 -0800
Subject: [ovs-discuss] [PATCH] hash: Improve 128-bit hash to 32-bit
	output.
In-Reply-To: <CAOnzOC+EfNcn4p-+9SfSXhTm0gJF1Sd=x4OUH3Z_w5urjNG6zw@mail.gmail.com>
References: <CANr6G5wit7X-3dpHzziaxeyVA+nzigG3jqhb-LKLEEom_-r-fA@mail.gmail.com>
 <1419291323-17411-1-git-send-email-joestringer@nicira.com>
 <20141229210802.GE8989@nicira.com>
 <CAOnzOC+EfNcn4p-+9SfSXhTm0gJF1Sd=x4OUH3Z_w5urjNG6zw@mail.gmail.com>
Message-ID: <CAArS4XXgD-nNuABSKb-zQ6unOQ4sPKtY+eEjNXcSy4RP_LGUiQ@mail.gmail.com>

Hey All,

I'm helping Joe to look at this issue.

Here is excerpt of Joe's comment on his original patch:
"""
My thoughts are converging towards this: The test is very strict,
particularly for inputs that have little variance (eg, single bit set
in the whole input). The hash function itself has been thoroughly
tested by the original developers at Google, and I shouldn't have done
anything to decrease the hash quality. I'm inclined to push the
testsuite change that modifies the seed to something which passes on
both big- and little-endian systems.
"""

Seems to me that the hash function is meant to compute hash for very long
words (longer than 128 bits, e.g. struct flow).  And we already have test
for
checking the 1-bit set case for hash of 16*128-bit word.  So, could we just
remove the this failing test that uses uint32_t as input and add comment to
warn users (that the function should only be called with > 128-bit word)?

The patch is sent out here:
http://openvswitch.org/pipermail/dev/2015-February/051727.html

Thanks,
Alex Wang,

On Tue, Dec 30, 2014 at 10:28 AM, Andrew Mann <andrew at divvycloud.com> wrote:

> For what it's worth, Bob Jenkins has some good discussion around this, and
> some code that can help measure such properties of hashes:
>
> http://burtleburtle.net/bob/hash/index.html
>
> Specifically the "tests" section may offer a good start for measuring the
> characteristics of the hash output with quantitative results.
>
> On Mon, Dec 29, 2014 at 3:08 PM, Ben Pfaff <blp at nicira.com> wrote:
>
>> On Mon, Dec 22, 2014 at 03:35:22PM -0800, Joe Stringer wrote:
>> > Previously, when using the 128-bit hash in conjunction with the 32-bit
>> > hash tables, we would ignore the upper 96 bits rather than attempting to
>> > redistribute the hash across the 32-bit output space. This patch adds a
>> > new function to translate the hash down from 128 bits to 32 bits for
>> > this use case.
>>
>> Suppose that we had 128-bit random numbers instead of 128-bit hashes.
>> Then, if combining the 32-bit pieces of that random number gave us a
>> higher-quality random 32-bit number than just taking any one 32-bit
>> piece, it would mean that the random numbers weren't very random.
>>
>> By analogy, I think that this patch (without reading it) should only
>> make a difference if the 128-bit hash isn't very high-quality.  If so,
>> it might be better to consider improving our 128-bit hash function,
>> instead of the approach taken here.
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>
>
>
> --
> Andrew Mann
> DivvyCloud Inc.
> www.divvycloud.com
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150226/2e6d44ea/attachment.html>

From joestringer at nicira.com  Thu Feb 26 12:55:01 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 26 Feb 2015 12:55:01 -0800
Subject: [ovs-discuss] [PATCH] hash: Improve 128-bit hash to 32-bit
	output.
In-Reply-To: <CAArS4XXgD-nNuABSKb-zQ6unOQ4sPKtY+eEjNXcSy4RP_LGUiQ@mail.gmail.com>
References: <CANr6G5wit7X-3dpHzziaxeyVA+nzigG3jqhb-LKLEEom_-r-fA@mail.gmail.com>
 <1419291323-17411-1-git-send-email-joestringer@nicira.com>
 <20141229210802.GE8989@nicira.com>
 <CAOnzOC+EfNcn4p-+9SfSXhTm0gJF1Sd=x4OUH3Z_w5urjNG6zw@mail.gmail.com>
 <CAArS4XXgD-nNuABSKb-zQ6unOQ4sPKtY+eEjNXcSy4RP_LGUiQ@mail.gmail.com>
Message-ID: <CANr6G5yOFYq7wUMv_1j-p671_PQ40R8kTgAO4rWiJp=ytqCDRQ@mail.gmail.com>

I appreciate you spending the time to look into this, Alex. Thanks.

This approach sounds reasonable to me. I think my only concern is that
if we remove the test, then we will only be testing quite large (256
byte) inputs, and nothing smaller. I wonder if it would be useful to
have a test on smaller input, but larger than 32-bit (perhaps 128 or
256 bits).

On 26 February 2015 at 10:44, Alex Wang <alexw at nicira.com> wrote:
> Hey All,
>
> I'm helping Joe to look at this issue.
>
> Here is excerpt of Joe's comment on his original patch:
> """
> My thoughts are converging towards this: The test is very strict,
> particularly for inputs that have little variance (eg, single bit set
> in the whole input). The hash function itself has been thoroughly
> tested by the original developers at Google, and I shouldn't have done
> anything to decrease the hash quality. I'm inclined to push the
> testsuite change that modifies the seed to something which passes on
> both big- and little-endian systems.
> """
>
> Seems to me that the hash function is meant to compute hash for very long
> words (longer than 128 bits, e.g. struct flow).  And we already have test
> for
> checking the 1-bit set case for hash of 16*128-bit word.  So, could we just
> remove the this failing test that uses uint32_t as input and add comment to
> warn users (that the function should only be called with > 128-bit word)?
>
> The patch is sent out here:
> http://openvswitch.org/pipermail/dev/2015-February/051727.html
>
> Thanks,
> Alex Wang,
>
> On Tue, Dec 30, 2014 at 10:28 AM, Andrew Mann <andrew at divvycloud.com> wrote:
>>
>> For what it's worth, Bob Jenkins has some good discussion around this, and
>> some code that can help measure such properties of hashes:
>>
>> http://burtleburtle.net/bob/hash/index.html
>>
>> Specifically the "tests" section may offer a good start for measuring the
>> characteristics of the hash output with quantitative results.
>>
>> On Mon, Dec 29, 2014 at 3:08 PM, Ben Pfaff <blp at nicira.com> wrote:
>>>
>>> On Mon, Dec 22, 2014 at 03:35:22PM -0800, Joe Stringer wrote:
>>> > Previously, when using the 128-bit hash in conjunction with the 32-bit
>>> > hash tables, we would ignore the upper 96 bits rather than attempting
>>> > to
>>> > redistribute the hash across the 32-bit output space. This patch adds a
>>> > new function to translate the hash down from 128 bits to 32 bits for
>>> > this use case.
>>>
>>> Suppose that we had 128-bit random numbers instead of 128-bit hashes.
>>> Then, if combining the 32-bit pieces of that random number gave us a
>>> higher-quality random 32-bit number than just taking any one 32-bit
>>> piece, it would mean that the random numbers weren't very random.
>>>
>>> By analogy, I think that this patch (without reading it) should only
>>> make a difference if the 128-bit hash isn't very high-quality.  If so,
>>> it might be better to consider improving our 128-bit hash function,
>>> instead of the approach taken here.
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>>
>>
>> --
>> Andrew Mann
>> DivvyCloud Inc.
>> www.divvycloud.com
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From alexw at nicira.com  Thu Feb 26 13:00:56 2015
From: alexw at nicira.com (Alex Wang)
Date: Thu, 26 Feb 2015 13:00:56 -0800
Subject: [ovs-discuss] [PATCH] hash: Improve 128-bit hash to 32-bit
	output.
In-Reply-To: <CANr6G5yOFYq7wUMv_1j-p671_PQ40R8kTgAO4rWiJp=ytqCDRQ@mail.gmail.com>
References: <CANr6G5wit7X-3dpHzziaxeyVA+nzigG3jqhb-LKLEEom_-r-fA@mail.gmail.com>
 <1419291323-17411-1-git-send-email-joestringer@nicira.com>
 <20141229210802.GE8989@nicira.com>
 <CAOnzOC+EfNcn4p-+9SfSXhTm0gJF1Sd=x4OUH3Z_w5urjNG6zw@mail.gmail.com>
 <CAArS4XXgD-nNuABSKb-zQ6unOQ4sPKtY+eEjNXcSy4RP_LGUiQ@mail.gmail.com>
 <CANr6G5yOFYq7wUMv_1j-p671_PQ40R8kTgAO4rWiJp=ytqCDRQ@mail.gmail.com>
Message-ID: <CAArS4XV36Rz0jKLLeNdhAXw4Ct83NmjoG3nQq3wnJg8SPu3RCA@mail.gmail.com>

On Thu, Feb 26, 2015 at 12:55 PM, Joe Stringer <joestringer at nicira.com>
wrote:

> I appreciate you spending the time to look into this, Alex. Thanks.
>
> This approach sounds reasonable to me. I think my only concern is that
> if we remove the test, then we will only be testing quite large (256
> byte) inputs, and nothing smaller. I wonder if it would be useful to
> have a test on smaller input, but larger than 32-bit (perhaps 128 or
> 256 bits).
>

Makes sense to me,

Working on adding it.

Alex Wang,


>
> On 26 February 2015 at 10:44, Alex Wang <alexw at nicira.com> wrote:
> > Hey All,
> >
> > I'm helping Joe to look at this issue.
> >
> > Here is excerpt of Joe's comment on his original patch:
> > """
> > My thoughts are converging towards this: The test is very strict,
> > particularly for inputs that have little variance (eg, single bit set
> > in the whole input). The hash function itself has been thoroughly
> > tested by the original developers at Google, and I shouldn't have done
> > anything to decrease the hash quality. I'm inclined to push the
> > testsuite change that modifies the seed to something which passes on
> > both big- and little-endian systems.
> > """
> >
> > Seems to me that the hash function is meant to compute hash for very long
> > words (longer than 128 bits, e.g. struct flow).  And we already have test
> > for
> > checking the 1-bit set case for hash of 16*128-bit word.  So, could we
> just
> > remove the this failing test that uses uint32_t as input and add comment
> to
> > warn users (that the function should only be called with > 128-bit word)?
> >
> > The patch is sent out here:
> > http://openvswitch.org/pipermail/dev/2015-February/051727.html
> >
> > Thanks,
> > Alex Wang,
> >
> > On Tue, Dec 30, 2014 at 10:28 AM, Andrew Mann <andrew at divvycloud.com>
> wrote:
> >>
> >> For what it's worth, Bob Jenkins has some good discussion around this,
> and
> >> some code that can help measure such properties of hashes:
> >>
> >> http://burtleburtle.net/bob/hash/index.html
> >>
> >> Specifically the "tests" section may offer a good start for measuring
> the
> >> characteristics of the hash output with quantitative results.
> >>
> >> On Mon, Dec 29, 2014 at 3:08 PM, Ben Pfaff <blp at nicira.com> wrote:
> >>>
> >>> On Mon, Dec 22, 2014 at 03:35:22PM -0800, Joe Stringer wrote:
> >>> > Previously, when using the 128-bit hash in conjunction with the
> 32-bit
> >>> > hash tables, we would ignore the upper 96 bits rather than attempting
> >>> > to
> >>> > redistribute the hash across the 32-bit output space. This patch
> adds a
> >>> > new function to translate the hash down from 128 bits to 32 bits for
> >>> > this use case.
> >>>
> >>> Suppose that we had 128-bit random numbers instead of 128-bit hashes.
> >>> Then, if combining the 32-bit pieces of that random number gave us a
> >>> higher-quality random 32-bit number than just taking any one 32-bit
> >>> piece, it would mean that the random numbers weren't very random.
> >>>
> >>> By analogy, I think that this patch (without reading it) should only
> >>> make a difference if the 128-bit hash isn't very high-quality.  If so,
> >>> it might be better to consider improving our 128-bit hash function,
> >>> instead of the approach taken here.
> >>> _______________________________________________
> >>> discuss mailing list
> >>> discuss at openvswitch.org
> >>> http://openvswitch.org/mailman/listinfo/discuss
> >>
> >>
> >>
> >>
> >> --
> >> Andrew Mann
> >> DivvyCloud Inc.
> >> www.divvycloud.com
> >>
> >> _______________________________________________
> >> discuss mailing list
> >> discuss at openvswitch.org
> >> http://openvswitch.org/mailman/listinfo/discuss
> >>
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150226/b24d6341/attachment.html>

From pshelar at nicira.com  Thu Feb 26 15:52:18 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Thu, 26 Feb 2015 15:52:18 -0800
Subject: [ovs-discuss] match/push/pop more than 3 MPLS labels
In-Reply-To: <54EF1CCD.4010705@uniroma2.it>
References: <54EF1CCD.4010705@uniroma2.it>
Message-ID: <CALnjE+o8m-yyww_4K5zkf3-hF23R_KxgjiLFAdOfN5f0rpq-RQ@mail.gmail.com>

On Thu, Feb 26, 2015 at 5:17 AM, Stefano Salsano
<stefano.salsano at uniroma2.it> wrote:
> Hi,
>
> there is a limit of 3 MPLS labels that are supported by Open vSwitch
>
> we need to raise it at 5 labels, to implement a segment routing scenario
>
> we are ready to patch/recompile the kernel if needed and patch/recompile
> Open vSwitch, we'd like to understand if it is a matter of changing some
> configuration parameters in the kernel and/or in Open vSwitch or if more
> substantial patches are needed
>
You can start with changing FLOW_MAX_MPLS_LABELS to 5.


> any help or suggestion is welcome!
>
> I am trying on ovs-discuss list... may be the ovs-dev list is more
> appropriate for this type of questions?
>
> thank you
>
> ciao
> Stefano
> --
> *******************************************************************
> Stefano Salsano
> Professore Associato
> Dipartimento Ingegneria Elettronica
> Universita' di Roma Tor Vergata
> Via del Politecnico, 1 - 00133 Roma - ITALY
>
> http://netgroup.uniroma2.it/Stefano_Salsano/
>
> E-mail  : stefano.salsano at uniroma2.it
> Cell.   : +39 320 4307310
> Office  : (Tel.) +39 06 72597770  (Fax.) +39 06 72597435
> *******************************************************************
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Thu Feb 26 16:21:21 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 26 Feb 2015 16:21:21 -0800
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
Message-ID: <20150227002121.GC30714@nicira.com>

On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> When packets which does not match any rule in ovs, are buffered at the
> ingress switch, say first n packets are buffered. Switch sends a flow_mod
> and message and packet_out for the buffered packets, meanwhile if some more
> packets of the same flow arrive (say n+1 to m), they'll also get buffered
> (as flow_mod) hasn't arrived yet.
> 
> Once flow_mod message arrives at the switch then subsequent packets of the
> flow will be forwarded but packets (n+1 to m) will still be buffered
> waiting for their packet_outs. This results in reordering of packets.
> 
> Is there a way around this, besides from proactively setting up a flow?
> 
> Is there a way to match flow_mod to existing buffered packets?

Reordering can happen.  There isn't a way to avoid it entirely
(besides proactive flow setup).  It isn't usually a problem, though,
because most protocols only send one packet before they receive a
reply from the opposite end.

From chris at onthe.net.au  Thu Feb 26 21:13:30 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Fri, 27 Feb 2015 16:13:30 +1100
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
Message-ID: <20150227051330.GA7198@onthe.net.au>

Hi,

"Me too" on Simon's BUG() described below (apologies for the top post).
Basically:

[ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
...
[ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>] pskb_expand_head+0x234/0x270
...
[ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
[ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
[ 7318.717599]  [<ffffffffa07de8b0>] queue_userspace_packet+0x3f0/0x440 [openvswitch]

I've hit this BUG() several times within hours or days of running on v3.14.27
and v3.14.33, whereas the box previously ran for months on v3.10.33 without an
issue.

It looks like it's related to this commit which went into v3.14-rc1 and
introduced performing skb_checksum_help() on a (non-vlan) skb passed into
queue_userspace_packet():

commit bda56f143c9dc38ae7926ba21ebeb35359a6c051
Author: Thomas Graf <tgraf at suug.ch>

    openvswitch: Use skb_zerocopy() for upcall

It seems in some cases the skb is shared, causing us to hit the
BUG() in pskb_expand_head(), per:

----------------------------------------------------------------------
static int queue_userspace_packet(struct net *net, int dp_ifindex,
                                  struct sk_buff *skb,
                                  const struct dp_upcall_info *upcall_info)
{
        if (vlan_tx_tag_present(skb)) {
		nskb = skb_clone(skb, GFP_ATOMIC);
		...
		skb = nskb;
        }
        ...
	if (skb->ip_summed == CHECKSUM_PARTIAL &&
	    (err = skb_checksum_help(skb)))
		...
}

int skb_checksum_help(struct sk_buff *skb)
{
	...
	if (skb_has_shared_frag(skb)) {
		ret = __skb_linearize(skb);
		...
}

static inline int __skb_linearize(struct sk_buff *skb)
{
	return __pskb_pull_tail(skb, skb->data_len) ? 0 : -ENOMEM;
}

unsigned char *__pskb_pull_tail(struct sk_buff *skb, int delta)
{
	int eat = (skb->tail + delta) - skb->end;
	...
	if (eat > 0 || skb_cloned(skb)) {
		if (pskb_expand_head(skb, 0, eat > 0 ? eat + 128 : 0,
				GFP_ATOMIC))
			return NULL;
	}
	...
}

pskb_expand_head(skb, 0, eat > 0 ? eat + 128 : 0, GFP_ATOMIC)
{
	...
	if (skb_shared(skb))
		BUG();				<<< BOOM!!!
	...
}
----------------------------------------------------------------------

Cheers,

Chris

On Thu, Feb 12, 2015 at 08:32:46PM -0500, Xu (Simon) Chen wrote:
> Hi folks,
> 
> I can now consistently reproduce a kernel panic on my system. I am using
> OVS 2.3.0 on 3.14.29 kernel, a sender and a receiver (two VMs) on two
> identical hypervisors, using VXLAN tunnel connecting the two VMs. Iperf is
> used inside of VMs for generating traffic. The sender side has no problem,
> while the hypervisor with the receiving VM consistently crashes after
> certain amount of time (or rather packets).
> 
> 
> The kernel panic seems to be related to skb_shared check inside of
> pskb_expand_head function:
> 
>  [ 7318.405112] ------------[ cut here ]------------
> [ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
> [ 7318.414563] invalid opcode: 0000 [#1] SMP
> [ 7318.418868] Modules linked in: ip6table_filter ip6_tables xt_mac xt_tcpudp xt_state xt_physdev xt_set xt_multiport iptable_filter iptable_nat nf_nat_ipv4 nf_nat iptable_raw ip_tables x_tables ip_set_hash_ip ip_set nfnetlink vhost_net vhost macvtap macvlan tun veth openvswitch(O) gre vxlan libcrc32c bridge 8021q garp stp llc bonding joydev hid_generic usbhid hid deflate ctr twofish_generic twofish_avx_x86_64 nfsd twofish_x86_64_3way twofish_x86_64 twofish_common auth_rpcgss oid_registry nfs_acl camellia_generic camellia_aesni_avx_x86_64 camellia_x86_64 nfs lockd serpent_avx_x86_64 fscache serpent_sse2_x86_64 xts serpent_generic sunrpc blowfish_generic blowfish_x86_64 blowfish_common cast5_avx_x86_64 cast5_generic cast_common des_generic cbc cmac binfmt_misc xcbc rmd160 sha512_generic sha256_generic hmac crypto_null af_key xfrm_algo iTCO_wdt iTCO_vendor_support x86_pkg_temp_thermal coretemp kvm_intel kvm crc32_pclmul crc32c_intel ghash_clmulni_intel aesni_intel aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd microcode evdev ehci_pci sb_edac ehci_hcd edac_core usbcore lpc_ich ioatdma i2c_i801 usb_common mfd_core tpm_tis wmi tpm acpi_cpufreq processor thermal_sys button nf_conntrack_ipv4 nf_defrag_ipv4 nf_conntrack_ipv6 nf_defrag_ipv6 nf_conntrack ipmi_devintf ipmi_si ipmi_msghandler loop tcp_scalable autofs4 ext4 cr c16 jbd2 mbcache crc32c btrfs xor raid6_pq dm_mod mlx4_en(O) sg sd_mod crc_t10dif crct10dif_common igb isci i2c_algo_bit ahci libsas i2c_core libahci dca mlx4_core(O) megaraid_sas scsi_transport_sas ptp libata pps_core compat(O) scsi_mod
> [ 7318.568195] CPU: 14 PID: 54124 Comm: vhost-54120 Tainted: G           O 3.14.25-ts1 #1
> [ 7318.576227] Hardware name: Supermicro SYS-F617R2-R72+/X9DRFR, BIOS 3.0b 04/24/2014
> [ 7318.583944] task: ffff887f25dde240 ti: ffff883ef6a32000 task.ti: ffff883ef6a32000
> [ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>] pskb_expand_head+0x234/0x270
> [ 7318.600295] RSP: 0018:ffff887f7f103978  EFLAGS: 00010202
> [ 7318.605770] RAX: 0000000000000002 RBX: ffff887f23417700 RCX: 0000000000000020
> [ 7318.613016] RDX: 00000000000002ee RSI: 0000000000000000 RDI: ffff887f23417700
> [ 7318.620278] RBP: ffff887f7f1039b8 R08: 000000005ff00000 R09: ffff887f2113e040
> [ 7318.627523] R10: 00000000ffffee43 R11: 0000000000000002 R12: 0000000000000000
> [ 7318.634805] R13: ffff887f23417700 R14: 000000000000000d R15: ffff887f23417700
> [ 7318.642032] FS:  0000000000000000(0000) GS:ffff887f7f100000(0000) knlGS:0000000000000000
> [ 7318.650238] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
> [ 7318.656110] CR2: 00002ba78155e680 CR3: 0000007f1f8cd000 CR4: 00000000001427e0
> [ 7318.663378] Stack:
> [ 7318.665464]  ffff887f7f1039f8 ffffffff8142ae14 ffffffffa07b50f0 ffff887f23417700
> [ 7318.673226]  ffff887f7f103b58 ffff887f7f103a70 000000000000000d ffff887f23417700
> [ 7318.681000]  ffff887f7f103a08 ffffffff813eb6fc ffff887f23417700 000001f823417700
> [ 7318.688790] Call Trace:
> [ 7318.691309]  <IRQ>
> [ 7318.693290]  [<ffffffff8142ae14>] ? nf_hook_slow+0x74/0x130
> [ 7318.699285]  [<ffffffffa07b50f0>] ? deliver_clone+0x60/0x60 [bridge]
> [ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
> [ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
> [ 7318.717599]  [<ffffffffa07de8b0>] queue_userspace_packet+0x3f0/0x440 [openvswitch]
> [ 7318.725289]  [<ffffffffa07dfcd5>] ovs_dp_upcall+0x65/0x70 [openvswitch]
> [ 7318.732037]  [<ffffffffa07dc7b6>] do_execute_actions+0x366/0xc00 [openvswitch]
> [ 7318.739403]  [<ffffffff8142ae14>] ? nf_hook_slow+0x74/0x130
> [ 7318.745072]  [<ffffffff812a7c9a>] ? arch_fast_hash2+0xa/0x10
> [ 7318.750883]  [<ffffffffa07dc7ec>] do_execute_actions+0x39c/0xc00 [openvswitch]
> [ 7318.758221]  [<ffffffffa07b570d>] ? br_forward+0x5d/0x70 [bridge]
> [ 7318.764419]  [<ffffffffa07dd0c6>] ovs_execute_actions+0x76/0x110 [openvswitch]
> [ 7318.771773]  [<ffffffffa07dfd6f>] ovs_dp_process_packet_with_key+0x8f/0xf0 [openvswitch]
> [ 7318.779988]  [<ffffffffa07e0efa>] ? ovs_flow_extract+0x89a/0xab0 [openvswitch]
> [ 7318.787355]  [<ffffffffa07dfe10>] ovs_dp_process_received_packet+0x40/0x60 [openvswitch]
> [ 7318.795535]  [<ffffffffa07e616a>] ovs_vport_receive+0x2a/0x30 [openvswitch]
> [ 7318.802634]  [<ffffffffa07e7cf5>] netdev_frame_hook+0xc5/0x120 [openvswitch]
> [ 7318.809773]  [<ffffffff813f9f42>] __netif_receive_skb_core+0x332/0x7f0
> [ 7318.816418]  [<ffffffffa07e7c30>] ? netdev_create+0x150/0x150 [openvswitch]
> [ 7318.823475]  [<ffffffff813fa426>] __netif_receive_skb+0x26/0x70
> [ 7318.829472]  [<ffffffff813fa514>] process_backlog+0xa4/0x180
> [ 7318.835223]  [<ffffffff813fa979>] net_rx_action+0x139/0x220
> [ 7318.840894]  [<ffffffff81053218>] __do_softirq+0xf8/0x280
> [ 7318.846391]  [<ffffffff81504b5c>] do_softirq_own_stack+0x1c/0x30
> [ 7318.852517]  <EOI>
> [ 7318.854504]  [<ffffffff81053425>] do_softirq+0x45/0x50
> [ 7318.860084]  [<ffffffff813f9759>] netif_rx_ni+0x39/0x70
> [ 7318.865416]  [<ffffffffa07f1ab3>] tun_get_user+0x413/0x840 [tun]
> [ 7318.871506]  [<ffffffffa07f1f3a>] tun_sendmsg+0x5a/0x80 [tun]
> [ 7318.877357]  [<ffffffffa0819e32>] handle_tx+0x382/0x400 [vhost_net]
> [ 7318.883712]  [<ffffffffa0819ee5>] handle_tx_kick+0x15/0x20 [vhost_net]
> [ 7318.890333]  [<ffffffffa080d4f6>] vhost_worker+0xf6/0x190 [vhost]
> [ 7318.896528]  [<ffffffffa080d400>] ? vhost_log_access_ok+0x30/0x30 [vhost]
> [ 7318.903454]  [<ffffffff81070c69>] kthread+0xc9/0xe0
> [ 7318.908412]  [<ffffffff81070ba0>] ? flush_kthread_worker+0x80/0x80
> [ 7318.914674]  [<ffffffff8150342c>] ret_from_fork+0x7c/0xb0
> [ 7318.920163]  [<ffffffff81070ba0>] ? flush_kthread_worker+0x80/0x80
> [ 7318.926426] Code: 55 c0 e8 f0 38 d4 ff 48 8b 55 c0 84 c0 0f 85 0b ff ff ff e9 02 ff ff ff 0f 1f 80 00 00 00 00 41 81 cf 00 20 00 00 e9 1f fe ff ff <0f> 0b 0f 0b 44 89 fe 4c 89 ef e8 ad e8 ff ff 85 c0 74 12 48 89
> [ 7318.950040] RIP  [<ffffffff813eb634>] pskb_expand_head+0x234/0x270
> [ 7318.956385]  RSP <ffff887f7f103978>
> [ 7318.959988] ---[ end trace 221c17dcc65b8372 ]---
> [ 7319.076935] Kernel panic - not syncing: Fatal exception in interrupt
> [ 7319.086993] Kernel Offset: 0x0 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffff9fffffff)
> [ 7319.204560] Rebooting in 10 seconds..
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From liu923526 at gmail.com  Thu Feb 26 21:54:49 2015
From: liu923526 at gmail.com (=?UTF-8?B?5YqJ55GL5Yex?=)
Date: Fri, 27 Feb 2015 13:54:49 +0800
Subject: [ovs-discuss] Add new action.
Message-ID: <CAHC2dCAbdXJYSW+WtgsBPXwD7g9LTWhwB0qdEnB2A2ARVdLJrA@mail.gmail.com>

I would like to add a new action,and I follow the FAQ below.(OVS version
2.3.1 and OVS-master)
Q: How do I add support for a new OpenFlow action?

A: Add your new action to "enum ofp_raw_action_type" in lib/ofp-actions.c,
following the existing pattern. Then recompile and fix all of the new
warnings, implementing new functionality for the new action as needed. (If
you configure with --enable-Werror, as described in INSTALL.md
<https://github.com/openvswitch/ovs/blob/master/INSTALL.md>, then it is
impossible to miss any warnings.)

If you need to add an OpenFlow vendor extension action for a vendor that
doesn't yet have any extension actions, then you will also need to edit
build-aux/extract-ofp-actions.

then I got this message when I add this action.

OFPT_ERROR (xid=0x4): OFPBAC_BAD_TYPE

OFPT_FLOW_MOD (xid=0x4):

(***truncated to 64 bytes from 80***)

00000000  01 0e 00 50 00 00 00 04-00 38 20 fe 00 01 00 00 |...P.....8 .....|

00000010  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00 |................|

00000020  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00 |................|

00000030  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00 |................|
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150227/3dbfa11e/attachment.html>

From pshelar at nicira.com  Fri Feb 27 11:08:21 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Fri, 27 Feb 2015 11:08:21 -0800
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <20150227051330.GA7198@onthe.net.au>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
Message-ID: <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>

On Thu, Feb 26, 2015 at 9:13 PM, Chris Dunlop <chris at onthe.net.au> wrote:
> Hi,
>
> "Me too" on Simon's BUG() described below (apologies for the top post).
> Basically:
>
> [ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
> ...
> [ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>] pskb_expand_head+0x234/0x270
> ...
> [ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
> [ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
> [ 7318.717599]  [<ffffffffa07de8b0>] queue_userspace_packet+0x3f0/0x440 [openvswitch]
>
> I've hit this BUG() several times within hours or days of running on v3.14.27
> and v3.14.33, whereas the box previously ran for months on v3.10.33 without an
> issue.
>

Can you reproduce this bug on hypervisor to hypervisor test without any VMs?

From pshelar at nicira.com  Fri Feb 27 11:37:18 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Fri, 27 Feb 2015 11:37:18 -0800
Subject: [ovs-discuss] query related to GRE encapsulation
In-Reply-To: <97d1f519234e463e89ecf9f88882dbe6@GURMBXV02.AD.ARICENT.COM>
References: <97d1f519234e463e89ecf9f88882dbe6@GURMBXV02.AD.ARICENT.COM>
Message-ID: <CALnjE+p6xYgczeCBbypw7p77HHS8OfcBKp8mErLDkUSjR-16uQ@mail.gmail.com>

On Tue, Feb 24, 2015 at 5:33 AM, Chetan Bali <chetan.bali at aricent.com> wrote:
> Hi,
>
>
>
> I am configuring gre-port in my ovs bridge, for establishing gre-tunnel
> between 2 machines. I am trying to parse the tunnelling key params sent by
> OVS while adding flow, when it sets action as OVS_ACTION_ATTR_SET. I am
> parsing the tun-key attributes in dpif-linux.c in exact manner as ovs does,
> i.e., nla_data(nla_data(action)) where action is in “nlattr”  type. Tun-key
> params that I am trying to fetch are as per struct “ovs_key_ipv4_tunnel”
> i.e.,
>
> struct ovs_key_ipv4_tunnel {
>
>     __be64 tun_id;
>
>     __be32 ipv4_src;
>
>     __be32 ipv4_dst;
>
>     __be16 tun_flags;
>
>     u8   ipv4_tos;
>
>     u8   ipv4_ttl;
>
> };
>
> The problem is that, while parsing I am getting incorrect tun-key params,
> whereas I can see by putting prints that openvswitchd.ko is getting correct
> tun-key params.
>
>
ovs_key_ipv4_tunnel is a kernel structure. Userspace serializes
individual members of tunnel parameters. At flow install OVS kernel
module translate this into ovs_key_ipv4_tunnel object. Thats how
kernel can access it during tunnel action execution. You can look at
OVS_TUNNEL_KEY_* to parse tunnel parameters in dpif-linux.c


>
> Please help how I can parse the tun-key params in my own dpif class plugin
> and also let me know if I am parsing the tun-key params in correct manner.
>
>
>
> Thanks
>
> Chetan
>
> "DISCLAIMER: This message is proprietary to Aricent and is intended solely
> for the use of the individual to whom it is addressed. It may contain
> privileged or confidential information and should not be circulated or used
> for any purpose other than for what it is intended. If you have received
> this message in error, please notify the originator immediately. If you are
> not the intended recipient, you are notified that you are strictly
> prohibited from using, copying, altering, or disclosing the contents of this
> message. Aricent accepts no responsibility for loss or damage arising from
> the use of the information transmitted by this email including damage from
> virus."
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From jayakeerthik82 at gmail.com  Thu Feb 26 21:23:04 2015
From: jayakeerthik82 at gmail.com (jayakeerthi k)
Date: Fri, 27 Feb 2015 10:53:04 +0530
Subject: [ovs-discuss] BUG
In-Reply-To: <CAA=3OqmOZ7yBqBGTuMx_ffAkpbK9XWOoY6CQcgZLrODfJJeXnw@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
 <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
 <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>
 <7410C5DA-7F4A-4368-9603-7AB9D469497B@scottlowe.org>
 <CAGnqNBm=kBo+YUeisWcKWN8h82AY25sNkdRjbVX-dkzxJxp-FA@mail.gmail.com>
 <B9C83149-11DE-4A9A-A128-609664659AD3@scottlowe.org>
 <CAGnqNB=U70P-9XjXO+J=eXzkJhWPPhTV-yXJj+WbvOz-k3qkEA@mail.gmail.com>
 <CAGnqNB=VpGsfZZxA9NWw=bcC-SYe0NR4Wiafbxooo+hqeeKoQQ@mail.gmail.com>
 <CAA=3OqmOZ7yBqBGTuMx_ffAkpbK9XWOoY6CQcgZLrODfJJeXnw@mail.gmail.com>
Message-ID: <CAGnqNBnWbYnOsOaQn+EFGxM8i5C7YQcVFno-CSo086Ex9dHCQA@mail.gmail.com>

i'm using libvirt 1.2.2

On Fri, Feb 27, 2015 at 12:02 AM, Ansis Atteka <aatteka at nicira.com> wrote:

> On Wed, Feb 25, 2015 at 11:25 PM, jayakeerthi k
> <jayakeerthik82 at gmail.com> wrote:
> > Also edited #virsh net-edit default
> >
> >
> >
> > On Thu, Feb 26, 2015 at 12:40 PM, jayakeerthi k <
> jayakeerthik82 at gmail.com>
> > wrote:
> >>
> >> Hi,
> >> i tried with virsh but again issue.
> >>
> >> perf at shakthi:/etc/libvirt/qemu$ virsh start 1511_secondary
> >> error: Failed to start domain 1511_secondary
> >> error: Unable to add bridge 1511 port vnet0: Operation not supported
>
> Can you tell us which libvirt version you are using?
>
> After looking into libvirt source code it seems that "Unable to add
> bridge ..." error message indicates that libvirt is treating bridge
> 1511 as Linux Bridge and not as OVS bridge:
>
> in src/util/virnetdevbridge.c:
>
>     if (ioctl(fd, SIOCBRADDIF, &ifr) < 0) {
>         virReportSystemError(errno,
>                              _("Unable to add bridge %s port %s"),
> brname, ifname);
>         goto cleanup;
>     }
>
> The code that adds interface to OVS bridge is in
>
> src/util/virnetdevopenvswitch.c
>
> and in case of failure the error message would look like:
>
>     if (virCommandRun(cmd, NULL) < 0) {
>         virReportError(VIR_ERR_INTERNAL_ERROR,
>                        _("Unable to add port %s to OVS bridge %s"),
>                        ifname, brname);
>         goto cleanup;
>     }
>
>
> As you can see you are missing OVS keyword in your error message! So
> this is not an OVS bug but rather:
> 1. misconfiguration (i.e. you really haven't edited VM's XML file
> correctly)
> 2. you are using old libvirt (OVS support was introduced in libvirt 0.9.11)
> 3. this is a libvirt bug (if 1. and 2. is not the case).
>
>
>
> >>
> >> domain xml file contents
> >>  <interface type='bridge'>
> >>       <virtualport type='openvswitch'/>
> >>       <mac address='52:54:00:f1:51:47'/>
> >>       <source bridge='1511'/>
> >>       <model type='virtio'/>
> >>       <address type='pci' domain='0x0000' bus='0x00' slot='0x00'
> >> function='0x0'/>
> >>     </interface>
> >>
> >> output of ovs-vsctl show
> >> 54ee0814-7243-42df-8a04-17b028f07f99
> >>     Bridge "1511"
> >>         Port "1511pr"
> >>             Interface "1511pr"
> >>                 type: internal
> >>         Port "1511"
> >>             Interface "1511"
> >>                 type: internal
> >>         Port "em2"
> >>             Interface "em2"
> >>     l
> >>     ovs_version: "2.0.2"
> >>
> >>
> >> thax,
> >> jayakeerthi
> >>
> >> On Thu, Feb 26, 2015 at 12:15 PM, Scott Lowe <scott.lowe at scottlowe.org>
> >> wrote:
> >>>
> >>> Please see my responses inline, prefixed by [SL].
> >>>
> >>> jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> >>>
> >>> > Hi,
> >>> > i couldn't able to resolve the issue with above steps.i got the
> >>> > following error in virt-manager.
> >>> >
> >>> > Error starting domain: Unable to add bridge 1511 port vnet0:
> Operation
> >>> > not supported
> >>> >
> >>> > Traceback (most recent call last):
> >>> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 96, in
> >>> > cb_wrapper
> >>> >     callback(asyncjob, *args, **kwargs)
> >>> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 117,
> in
> >>> > tmpcb
> >>> >     callback(*args, **kwargs)
> >>> >   File "/usr/share/virt-manager/virtManager/domain.py", line 1162, in
> >>> > startup
> >>> >     self._backend.create()
> >>> >   File "/usr/lib/python2.7/dist-packages/libvirt.py", line 866, in
> >>> > create
> >>> >     if ret == -1: raise libvirtError ('virDomainCreate() failed',
> >>> > dom=self)
> >>> > libvirtError: Unable to add bridge 1511 port vnet0: Operation not
> >>> > supported
> >>>
> >>>
> >>> [SL] Jayakeerthi, does an OVS bridge named "1511" exist? If not, then
> >>> you'll
> >>> see an error.
> >>>
> >>> Did you edit the libvirt domain XML to be sure to tell libvirt that
> >>> you're
> >>> using OVS? If not, then you'll see an error.
> >>>
> >>> It's entirely possible (I don't use virt-manager, so I don't know for
> >>> certain) that this is a virt-manager issue. Have you tried using virsh
> >>> instead of virt-manager?
> >>>
> >>>
> >>> > Thanking you,
> >>> > jayakeerthi k
> >>> >
> >>> >
> >>> > On Mon, Feb 23, 2015 at 10:53 PM, Scott Lowe <
> scott.lowe at scottlowe.org>
> >>> > wrote:
> >>> > Please see my responses inline, prefixed by [SL].
> >>> >
> >>> > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> >>> >
> >>> > > sorry for the delay,
> >>> > > libvirt version is 1.2.2
> >>> > > ovs_version: "2.0.2"
> >>> > > i'm installing it through Virt-manager.
> >>> > > xml file is
> >>> > >
> >>> > > <snip>
> >>> > >
> >>> > >     <interface type='bridge'>
> >>> > >       <mac address='52:54:00:f1:51:47'/>
> >>> > >       <source bridge='1511'/>
> >>> > >       <model type='virtio'/>
> >>> > >       <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> >>> > > function='0x0'/>
> >>> > >     </interface>
> >>> >
> >>> >
> >>> > [SL] This section is the issue. The guest domain (VM) is set to use a
> >>> > bridge ("1511"?), but you haven't specified "virtualport
> type=openvswitch",
> >>> > so Libvirt isn't able to properly communicate with OVS.
> >>> >
> >>> > If you look at the example XML that I supplied here:
> >>> >
> >>> >
> >>> > <
> http://blog.scottlowe.org/2012/11/12/libvirt-ovs-integration-revisited/>
> >>> >
> >>> > then you can see a snippet of network XML configuration that *will*
> >>> > work with OVS. This should get you started down the right path.
> >>> >
> >>> > Good luck!
> >>> >
> >>> > > On Thu, Feb 19, 2015 at 10:47 PM, Scott Lowe
> >>> > > <scott.lowe at scottlowe.org> wrote:
> >>> > > Please see my responses inline, prefixed by [SL].
> >>> > >
> >>> > > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> >>> > >
> >>> > > > OK..
> >>> > > >
> >>> > > > when i try to create vm i'm gettting error unable to add vnet0
> port
> >>> > > > on the
> >>> > > > bridge br3.
> >>> > >
> >>> > > [SL] Jayakeerthi, can you share the following information to help
> us
> >>> > > help
> >>> > > you?
> >>> > >
> >>> > > - The network portion of the domain XML configuration for your VM
> >>> > > (obtained
> >>> > > via 'virsh dumpxml <vm-name>'
> >>> > >
> >>> > > - The versions of OVS and libvirt installed on your system
> >>> > >
> >>> > > - The command(s) you are using to create and/or start the VM
> >>> > >
> >>> > > Feel free to use a service like pastebin.com to share the domain
> XML
> >>> > > configuration, if you'd like.
> >>> > >
> >>> > > Thanks!
> >>> > >
> >>> > > >> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com>
> >>> > > >> wrote:
> >>> > > >>
> >>> > > >> I don't think you can. KVM creates the port, OVS only handles
> >>> > > >> switching.
> >>> > > >>
> >>> > > >>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
> >>> > > >>>
> >>> > > >>> how to create port's in openvswitch that can be assigned to vm
> >>> > > >>> created
> >>> > > >>> with KVM?
> >>>
> >>>
> >>> --
> >>> Scott
> >>>
> >>
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150227/122512ef/attachment.html>

From chris at onthe.net.au  Fri Feb 27 14:52:58 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Sat, 28 Feb 2015 09:52:58 +1100
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
Message-ID: <20150227225258.GA6530@onthe.net.au>

On Fri, Feb 27, 2015 at 11:08:21AM -0800, Pravin Shelar wrote:
> On Thu, Feb 26, 2015 at 9:13 PM, Chris Dunlop <chris at onthe.net.au> wrote:
> > Hi,
> >
> > "Me too" on Simon's BUG() described below (apologies for the top post).
> > Basically:
> >
> > [ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
> > ...
> > [ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>] pskb_expand_head+0x234/0x270
> > ...
> > [ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
> > [ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
> > [ 7318.717599]  [<ffffffffa07de8b0>] queue_userspace_packet+0x3f0/0x440 [openvswitch]
> >
> > I've hit this BUG() several times within hours or days of running on v3.14.27
> > and v3.14.33, whereas the box previously ran for months on v3.10.33 without an
> > issue.
> 
> Can you reproduce this bug on hypervisor to hypervisor test without any VMs?

I don't know.

Sorry, I've only seen the problem after many hours of running in
a production environment, and I don't have the spare facilities
to run the hypervisor to hypervisor testing and risk the crash.

Simon, are you able to try your test running direct hypervisor
to hypervisor?

From xchenum at gmail.com  Fri Feb 27 15:06:25 2015
From: xchenum at gmail.com (Xu (Simon) Chen)
Date: Fri, 27 Feb 2015 18:06:25 -0500
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <20150227225258.GA6530@onthe.net.au>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
Message-ID: <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>

On Friday, February 27, 2015, Chris Dunlop <chris at onthe.net.au> wrote:

> On Fri, Feb 27, 2015 at 11:08:21AM -0800, Pravin Shelar wrote:
> > On Thu, Feb 26, 2015 at 9:13 PM, Chris Dunlop <chris at onthe.net.au
> <javascript:;>> wrote:
> > > Hi,
> > >
> > > "Me too" on Simon's BUG() described below (apologies for the top post).
> > > Basically:
> > >
> > > [ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
> > > ...
> > > [ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>]
> pskb_expand_head+0x234/0x270
> > > ...
> > > [ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
> > > [ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
> > > [ 7318.717599]  [<ffffffffa07de8b0>]
> queue_userspace_packet+0x3f0/0x440 [openvswitch]
> > >
> > > I've hit this BUG() several times within hours or days of running on
> v3.14.27
> > > and v3.14.33, whereas the box previously ran for months on v3.10.33
> without an
> > > issue.
> >
> > Can you reproduce this bug on hypervisor to hypervisor test without any
> VMs?
>
> I don't know.
>
> Sorry, I've only seen the problem after many hours of running in
> a production environment, and I don't have the spare facilities
> to run the hypervisor to hypervisor testing and risk the crash.
>
> Simon, are you able to try your test running direct hypervisor
> to hypervisor?
>

Nope...  I have only seen this between VMs. After repeated tests, it has
got worse that an iperf run would almost immediately trigger a crash.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150227/a62b1f3e/attachment.html>

From pshelar at nicira.com  Fri Feb 27 15:14:50 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Fri, 27 Feb 2015 15:14:50 -0800
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
 <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
Message-ID: <CALnjE+pe+0qqzq0citR=KfdrW90yh7wKEuxrq6vzeeoNaR_gdw@mail.gmail.com>

On Fri, Feb 27, 2015 at 3:06 PM, Xu (Simon) Chen <xchenum at gmail.com> wrote:
>
>
> On Friday, February 27, 2015, Chris Dunlop <chris at onthe.net.au> wrote:
>>
>> On Fri, Feb 27, 2015 at 11:08:21AM -0800, Pravin Shelar wrote:
>> > On Thu, Feb 26, 2015 at 9:13 PM, Chris Dunlop <chris at onthe.net.au>
>> > wrote:
>> > > Hi,
>> > >
>> > > "Me too" on Simon's BUG() described below (apologies for the top
>> > > post).
>> > > Basically:
>> > >
>> > > [ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
>> > > ...
>> > > [ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>]
>> > > pskb_expand_head+0x234/0x270
>> > > ...
>> > > [ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
>> > > [ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
>> > > [ 7318.717599]  [<ffffffffa07de8b0>]
>> > > queue_userspace_packet+0x3f0/0x440 [openvswitch]
>> > >
>> > > I've hit this BUG() several times within hours or days of running on
>> > > v3.14.27
>> > > and v3.14.33, whereas the box previously ran for months on v3.10.33
>> > > without an
>> > > issue.
>> >
>> > Can you reproduce this bug on hypervisor to hypervisor test without any
>> > VMs?
>>
>> I don't know.
>>
>> Sorry, I've only seen the problem after many hours of running in
>> a production environment, and I don't have the spare facilities
>> to run the hypervisor to hypervisor testing and risk the crash.
>>
>> Simon, are you able to try your test running direct hypervisor
>> to hypervisor?
>
>
> Nope...  I have only seen this between VMs. After repeated tests, it has got
> worse that an iperf run would almost immediately trigger a crash.

So it looks like vhost is generating shared skb. Can you try same test
on latest upstream kernel?

From chris at onthe.net.au  Fri Feb 27 15:49:39 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Sat, 28 Feb 2015 10:49:39 +1100
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
 <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
Message-ID: <20150227234939.GA9635@onthe.net.au>

On Fri, Feb 27, 2015 at 06:06:25PM -0500, Xu (Simon) Chen wrote:
> On Friday, February 27, 2015, Chris Dunlop <chris at onthe.net.au> wrote:
> > Simon, are you able to try your test running direct hypervisor
> > to hypervisor?
> 
> Nope...  I have only seen this between VMs. After repeated tests, it has
> got worse that an iperf run would almost immediately trigger a crash.

Was this trying the hypervisor to hypervisor testing via the OVS tunnel?

From chris at onthe.net.au  Fri Feb 27 16:13:48 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Sat, 28 Feb 2015 11:13:48 +1100
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
Message-ID: <20150228001348.GA10877@onthe.net.au>

On Fri, Feb 27, 2015 at 11:08:21AM -0800, Pravin Shelar wrote:
> On Thu, Feb 26, 2015 at 9:13 PM, Chris Dunlop <chris at onthe.net.au> wrote:
> > Hi,
> >
> > "Me too" on Simon's BUG() described below (apologies for the top post).
> > Basically:
> >
> > [ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
> > ...
> > [ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>] pskb_expand_head+0x234/0x270
> > ...
> > [ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
> > [ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
> > [ 7318.717599]  [<ffffffffa07de8b0>] queue_userspace_packet+0x3f0/0x440 [openvswitch]
> >
> > I've hit this BUG() several times within hours or days of running on v3.14.27
> > and v3.14.33, whereas the box previously ran for months on v3.10.33 without an
> > issue.
> >
> 
> Can you reproduce this bug on hypervisor to hypervisor test without any VMs?

The thought just struck me: my two crashes were when all my VMs
were on the one hypervisor, i.e. there was no OVS traffic
between the hypervisors.

From xchenum at gmail.com  Fri Feb 27 17:30:42 2015
From: xchenum at gmail.com (Xu (Simon) Chen)
Date: Fri, 27 Feb 2015 20:30:42 -0500
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CALnjE+pe+0qqzq0citR=KfdrW90yh7wKEuxrq6vzeeoNaR_gdw@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
 <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
 <CALnjE+pe+0qqzq0citR=KfdrW90yh7wKEuxrq6vzeeoNaR_gdw@mail.gmail.com>
Message-ID: <CAGNyuhXSSjnUrcqQ46xtSQz0k6NP4cSpReq074=vkZG5LtddAg@mail.gmail.com>

On Fri, Feb 27, 2015 at 6:14 PM, Pravin Shelar <pshelar at nicira.com> wrote:

> On Fri, Feb 27, 2015 at 3:06 PM, Xu (Simon) Chen <xchenum at gmail.com>
> wrote:
> >
> >
> > On Friday, February 27, 2015, Chris Dunlop <chris at onthe.net.au> wrote:
> >>
> >> On Fri, Feb 27, 2015 at 11:08:21AM -0800, Pravin Shelar wrote:
> >> > On Thu, Feb 26, 2015 at 9:13 PM, Chris Dunlop <chris at onthe.net.au>
> >> > wrote:
> >> > > Hi,
> >> > >
> >> > > "Me too" on Simon's BUG() described below (apologies for the top
> >> > > post).
> >> > > Basically:
> >> > >
> >> > > [ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
> >> > > ...
> >> > > [ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>]
> >> > > pskb_expand_head+0x234/0x270
> >> > > ...
> >> > > [ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
> >> > > [ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
> >> > > [ 7318.717599]  [<ffffffffa07de8b0>]
> >> > > queue_userspace_packet+0x3f0/0x440 [openvswitch]
> >> > >
> >> > > I've hit this BUG() several times within hours or days of running on
> >> > > v3.14.27
> >> > > and v3.14.33, whereas the box previously ran for months on v3.10.33
> >> > > without an
> >> > > issue.
> >> >
> >> > Can you reproduce this bug on hypervisor to hypervisor test without
> any
> >> > VMs?
> >>
> >> I don't know.
> >>
> >> Sorry, I've only seen the problem after many hours of running in
> >> a production environment, and I don't have the spare facilities
> >> to run the hypervisor to hypervisor testing and risk the crash.
> >>
> >> Simon, are you able to try your test running direct hypervisor
> >> to hypervisor?
> >
> >
> > Nope...  I have only seen this between VMs. After repeated tests, it has
> got
> > worse that an iperf run would almost immediately trigger a crash.
>
> So it looks like vhost is generating shared skb. Can you try same test
> on latest upstream kernel?
>

I don't know whether it's vhost, as for me the VM receiving high volume
consistently crashes.

I previously had trouble building OVS datapath module on newer kernels.
What is the latest kernel that I should try?

Thanks.
-Simon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150227/a8343e6d/attachment-0001.html>

From xchenum at gmail.com  Fri Feb 27 17:31:46 2015
From: xchenum at gmail.com (Xu (Simon) Chen)
Date: Fri, 27 Feb 2015 20:31:46 -0500
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <20150227234939.GA9635@onthe.net.au>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
 <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
 <20150227234939.GA9635@onthe.net.au>
Message-ID: <CAGNyuhVtoV=84bn=PF88JDRfpYd_d5kPWaEueDjRt9E-xdY=qg@mail.gmail.com>

On Fri, Feb 27, 2015 at 6:49 PM, Chris Dunlop <chris at onthe.net.au> wrote:

> On Fri, Feb 27, 2015 at 06:06:25PM -0500, Xu (Simon) Chen wrote:
> > On Friday, February 27, 2015, Chris Dunlop <chris at onthe.net.au> wrote:
> > > Simon, are you able to try your test running direct hypervisor
> > > to hypervisor?
> >
> > Nope...  I have only seen this between VMs. After repeated tests, it has
> > got worse that an iperf run would almost immediately trigger a crash.
>
> Was this trying the hypervisor to hypervisor testing via the OVS tunnel?


VM-to-VM over VXLAN tunnel built by OVS.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150227/a54bedbb/attachment.html>

From xchenum at gmail.com  Fri Feb 27 17:33:13 2015
From: xchenum at gmail.com (Xu (Simon) Chen)
Date: Fri, 27 Feb 2015 20:33:13 -0500
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <20150228001348.GA10877@onthe.net.au>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150228001348.GA10877@onthe.net.au>
Message-ID: <CAGNyuhWZBQE8TRMTC7ZFQYb=HcB+w11ANYZh1yG79rE5Cw3L2A@mail.gmail.com>

On Fri, Feb 27, 2015 at 7:13 PM, Chris Dunlop <chris at onthe.net.au> wrote:

> On Fri, Feb 27, 2015 at 11:08:21AM -0800, Pravin Shelar wrote:
> > On Thu, Feb 26, 2015 at 9:13 PM, Chris Dunlop <chris at onthe.net.au>
> wrote:
> > > Hi,
> > >
> > > "Me too" on Simon's BUG() described below (apologies for the top post).
> > > Basically:
> > >
> > > [ 7318.409796] kernel BUG at net/core/skbuff.c:1041!
> > > ...
> > > [ 7318.591562] RIP: 0010:[<ffffffff813eb634>]  [<ffffffff813eb634>]
> pskb_expand_head+0x234/0x270
> > > ...
> > > [ 7318.705710]  [<ffffffff813eb6fc>] __pskb_pull_tail+0x4c/0x330
> > > [ 7318.711571]  [<ffffffff813f8ca7>] skb_checksum_help+0x147/0x1a0
> > > [ 7318.717599]  [<ffffffffa07de8b0>]
> queue_userspace_packet+0x3f0/0x440 [openvswitch]
> > >
> > > I've hit this BUG() several times within hours or days of running on
> v3.14.27
> > > and v3.14.33, whereas the box previously ran for months on v3.10.33
> without an
> > > issue.
> > >
> >
> > Can you reproduce this bug on hypervisor to hypervisor test without any
> VMs?
>
> The thought just struck me: my two crashes were when all my VMs
> were on the one hypervisor, i.e. there was no OVS traffic
> between the hypervisors.
>

VM to VM on the same hypervisor still goes through OVS, just not via
cross-machine VXLAN tunnels. In this case, vhost is more suspicious...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150227/138565a4/attachment.html>

From chris at onthe.net.au  Fri Feb 27 17:49:31 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Sat, 28 Feb 2015 12:49:31 +1100
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CAGNyuhXSSjnUrcqQ46xtSQz0k6NP4cSpReq074=vkZG5LtddAg@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
 <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
 <CALnjE+pe+0qqzq0citR=KfdrW90yh7wKEuxrq6vzeeoNaR_gdw@mail.gmail.com>
 <CAGNyuhXSSjnUrcqQ46xtSQz0k6NP4cSpReq074=vkZG5LtddAg@mail.gmail.com>
Message-ID: <20150228014931.GA11906@onthe.net.au>

On Fri, Feb 27, 2015 at 08:30:42PM -0500, Xu (Simon) Chen wrote:
> On Fri, Feb 27, 2015 at 6:14 PM, Pravin Shelar <pshelar at nicira.com> wrote:
> > So it looks like vhost is generating shared skb. Can you try same test
> > on latest upstream kernel?
> 
> I don't know whether it's vhost, as for me the VM receiving high volume
> consistently crashes.
> 
> I previously had trouble building OVS datapath module on newer kernels.
> What is the latest kernel that I should try?

According to:

https://github.com/openvswitch/ovs/blob/master/FAQ.md

...v3.14 *is* the latest kernel supported by the out-of-tree OVS
kernel module, given that ovs 2.4.x isn't tagged yet and "git
log v2.3..master" doesn't reveal anything obviously aimed at
providing >v3.14 compatibility.

Can you try with the in-tree OVS module?

From chris at onthe.net.au  Fri Feb 27 17:53:51 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Sat, 28 Feb 2015 12:53:51 +1100
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CAGNyuhVtoV=84bn=PF88JDRfpYd_d5kPWaEueDjRt9E-xdY=qg@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
 <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
 <20150227234939.GA9635@onthe.net.au>
 <CAGNyuhVtoV=84bn=PF88JDRfpYd_d5kPWaEueDjRt9E-xdY=qg@mail.gmail.com>
Message-ID: <20150228015351.GB11906@onthe.net.au>

On Fri, Feb 27, 2015 at 08:31:46PM -0500, Xu (Simon) Chen wrote:
> On Fri, Feb 27, 2015 at 6:49 PM, Chris Dunlop <chris at onthe.net.au> wrote:
> > On Fri, Feb 27, 2015 at 06:06:25PM -0500, Xu (Simon) Chen wrote:
> > > On Friday, February 27, 2015, Chris Dunlop <chris at onthe.net.au> wrote:
> > > > Simon, are you able to try your test running direct hypervisor
> > > > to hypervisor?
> > >
> > > Nope...  I have only seen this between VMs. After repeated tests, it has
> > > got worse that an iperf run would almost immediately trigger a crash.
> >
> > Was this trying the hypervisor to hypervisor testing via the OVS tunnel?
> 
> VM-to-VM over VXLAN tunnel built by OVS.

Is it possible to test hypervisor to hypervisor via the tunnel
(i.e. without VMs) by running your test between IPs on the OVS
switches?

From chris at onthe.net.au  Fri Feb 27 17:59:17 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Sat, 28 Feb 2015 12:59:17 +1100
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CAGNyuhWZBQE8TRMTC7ZFQYb=HcB+w11ANYZh1yG79rE5Cw3L2A@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150228001348.GA10877@onthe.net.au>
 <CAGNyuhWZBQE8TRMTC7ZFQYb=HcB+w11ANYZh1yG79rE5Cw3L2A@mail.gmail.com>
Message-ID: <20150228015917.GC11906@onthe.net.au>

On Fri, Feb 27, 2015 at 08:33:13PM -0500, Xu (Simon) Chen wrote:
> On Fri, Feb 27, 2015 at 7:13 PM, Chris Dunlop <chris at onthe.net.au> wrote:
> > On Fri, Feb 27, 2015 at 11:08:21AM -0800, Pravin Shelar wrote:
> > > Can you reproduce this bug on hypervisor to hypervisor
> > > test without any VMs?
> >
> > The thought just struck me: my two crashes were when all my
> > VMs were on the one hypervisor, i.e. there was no OVS
> > traffic between the hypervisors.
> 
> VM to VM on the same hypervisor still goes through OVS, just
> not via cross-machine VXLAN tunnels. In this case, vhost is
> more suspicious...

Yes, it takes the tunnel out of the picture.

Another data point: the vast bulk (probably >99%) of my VM
traffic is VM<=>not-VM.

From wuyunfei at huawei.com  Fri Feb 27 18:53:33 2015
From: wuyunfei at huawei.com (Wuyunfei)
Date: Sat, 28 Feb 2015 10:53:33 +0800
Subject: [ovs-discuss] Port mirroring patch only sees egress traffic
In-Reply-To: <548B7F22.5090303@pnnl.gov>
References: <548B7F22.5090303@pnnl.gov>
Message-ID: <54F12DAD.70505@huawei.com>

Hi Tom，

I'm doing some tests on OVS port mirroring and find the same issue you met with.
I wonder if you have already solved this issue, if so, would you please tell me how to fix it.

By the way, you've metioned in your last mail that using Open Flow rule to duplicate the traffic, does it work as fine as the port mirroring method?

~ James



From scott.lowe at scottlowe.org  Fri Feb 27 19:28:13 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Fri, 27 Feb 2015 20:28:13 -0700
Subject: [ovs-discuss] BUG
In-Reply-To: <CAGnqNB=U70P-9XjXO+J=eXzkJhWPPhTV-yXJj+WbvOz-k3qkEA@mail.gmail.com>
References: <CAGnqNBm5YUxigNDLjREkrRE2b470doB77tTkwuA9XmSHr3P5QQ@mail.gmail.com>
 <20150218160836.GC25752@nicira.com>
 <CAGnqNBk2ucU4T7a-62UPkHqAq7OHwjYmo3665Azm5hcCsJ-X=w@mail.gmail.com>
 <20150218164954.GI25752@nicira.com>
 <CAGnqNB=mHUwWGXj7YTgw4vQwM_v-SiR+XB2_GXQNXp01w1+-CQ@mail.gmail.com>
 <20150218171519.GJ25752@nicira.com>
 <CAGnqNBmPY1Cbtv1DafZXYaw49mtgLF9FF=RCipndv44Jzgqf7A@mail.gmail.com>
 <20150218172942.GK25752@nicira.com>
 <CAGnqNBn0A7Hq1Qk0arq54yU=pQFHUU+upkofyjAxDmD89KNSCQ@mail.gmail.com>
 <20150219043158.GC20024@nicira.com>
 <CAGnqNBneujxn7Oi2HkKn9=X2UybePAnVdabOxaQ-EgpeoZ4A+Q@mail.gmail.com>
 <C4625DE6-4D4F-4F90-9F1F-69936B184D3B@scottlowe.org>
 <CAGnqNBn-omS1qUkZYSnNnhh72WpjtcqhEBRjLr_JsJkjGdewjA@mail.gmail.com>
 <7410C5DA-7F4A-4368-9603-7AB9D469497B@scottlowe.org>
 <CAGnqNBm=kBo+YUeisWcKWN8h82AY25sNkdRjbVX-dkzxJxp-FA@mail.gmail.com>
 <B9C83149-11DE-4A9A-A128-609664659AD3@scottlowe.org>
 <CAGnqNB=U70P-9XjXO+J=eXzkJhWPPhTV-yXJj+WbvOz-k3qkEA@mail.gmail.com>
Message-ID: <C0E5740A-BD82-43F3-B141-89E360254622@scottlowe.org>

Please see my responses inline, prefixed by [SL].


jayakeerthi k <jayakeerthik82 at gmail.com> wrote:

> Hi,
> i tried with virsh but again issue.
> 
> perf at shakthi:/etc/libvirt/qemu$ virsh start 1511_secondary
> error: Failed to start domain 1511_secondary
> error: Unable to add bridge 1511 port vnet0: Operation not supported
> 
> domain xml file contents
>  <interface type='bridge'>
>       <virtualport type='openvswitch'/>
>       <mac address='52:54:00:f1:51:47'/>
>       <source bridge='1511'/>
>       <model type='virtio'/>
>       <address type='pci' domain='0x0000' bus='0x00' slot='0x00' function='0x0'/>
>     </interface>
> 
> output of ovs-vsctl show
> 54ee0814-7243-42df-8a04-17b028f07f99
>     Bridge "1511"
>         Port "1511pr"
>             Interface "1511pr"
>                 type: internal
>         Port "1511"
>             Interface "1511"
>                 type: internal
>         Port "em2"
>             Interface "em2"
>     l
>     ovs_version: "2.0.2"

[SL] The domain XML configuration looks correct, so I'm not sure what's
happening on your system. I saw a response from someone else indicating that
the error message implies libvirt is still not using OVS, so perhaps there
is an issue with your libvirt installation? At this point, I think I would
remove all Linux bridges, remove all OVS bridges, and start from a clean
slate to see if the error continues to persist. Be aware that girt-manager
may not have native/built-in support for OVS bridges, so you may have to
manually edit the domain XML to include "<virtualport type='openvswitch'>"
yourself after creating a new VM.

> thax,
> jayakeerthi
> 
> On Thu, Feb 26, 2015 at 12:15 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> Please see my responses inline, prefixed by [SL].
> 
> jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> 
> > Hi,
> > i couldn't able to resolve the issue with above steps.i got the following error in virt-manager.
> >
> > Error starting domain: Unable to add bridge 1511 port vnet0: Operation not supported
> >
> > Traceback (most recent call last):
> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 96, in cb_wrapper
> >     callback(asyncjob, *args, **kwargs)
> >   File "/usr/share/virt-manager/virtManager/asyncjob.py", line 117, in tmpcb
> >     callback(*args, **kwargs)
> >   File "/usr/share/virt-manager/virtManager/domain.py", line 1162, in startup
> >     self._backend.create()
> >   File "/usr/lib/python2.7/dist-packages/libvirt.py", line 866, in create
> >     if ret == -1: raise libvirtError ('virDomainCreate() failed', dom=self)
> > libvirtError: Unable to add bridge 1511 port vnet0: Operation not supported
> 
> 
> [SL] Jayakeerthi, does an OVS bridge named "1511" exist? If not, then you'll
> see an error.
> 
> Did you edit the libvirt domain XML to be sure to tell libvirt that you're
> using OVS? If not, then you'll see an error.
> 
> It's entirely possible (I don't use virt-manager, so I don't know for
> certain) that this is a virt-manager issue. Have you tried using virsh
> instead of virt-manager?
> 
> 
> > Thanking you,
> > jayakeerthi k
> >
> >
> > On Mon, Feb 23, 2015 at 10:53 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> > Please see my responses inline, prefixed by [SL].
> >
> > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> >
> > > sorry for the delay,
> > > libvirt version is 1.2.2
> > > ovs_version: "2.0.2"
> > > i'm installing it through Virt-manager.
> > > xml file is
> > >
> > > <snip>
> > >
> > >     <interface type='bridge'>
> > >       <mac address='52:54:00:f1:51:47'/>
> > >       <source bridge='1511'/>
> > >       <model type='virtio'/>
> > >       <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
> > >     </interface>
> >
> >
> > [SL] This section is the issue. The guest domain (VM) is set to use a bridge ("1511"?), but you haven't specified "virtualport type=openvswitch", so Libvirt isn't able to properly communicate with OVS.
> >
> > If you look at the example XML that I supplied here:
> >
> > <http://blog.scottlowe.org/2012/11/12/libvirt-ovs-integration-revisited/>
> >
> > then you can see a snippet of network XML configuration that *will* work with OVS. This should get you started down the right path.
> >
> > Good luck!
> >
> > > On Thu, Feb 19, 2015 at 10:47 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> > > Please see my responses inline, prefixed by [SL].
> > >
> > > jayakeerthi k <jayakeerthik82 at gmail.com> wrote:
> > >
> > > > OK..
> > > >
> > > > when i try to create vm i'm gettting error unable to add vnet0 port on the
> > > > bridge br3.
> > >
> > > [SL] Jayakeerthi, can you share the following information to help us help
> > > you?
> > >
> > > - The network portion of the domain XML configuration for your VM (obtained
> > > via 'virsh dumpxml <vm-name>'
> > >
> > > - The versions of OVS and libvirt installed on your system
> > >
> > > - The command(s) you are using to create and/or start the VM
> > >
> > > Feel free to use a service like pastebin.com to share the domain XML
> > > configuration, if you'd like.
> > >
> > > Thanks!
> > >
> > > >> On Thu, Feb 19, 2015 at 10:01 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > >>
> > > >> I don't think you can. KVM creates the port, OVS only handles switching.
> > > >>
> > > >>> On Thu, Feb 19, 2015 at 09:08:49AM +0530, jayakeerthi k wrote:
> > > >>>
> > > >>> how to create port's in openvswitch that can be assigned to vm created
> > > >>> with KVM?


--
Scott



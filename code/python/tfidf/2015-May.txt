From blp at nicira.com  Fri May  1 07:33:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 1 May 2015 07:33:43 -0700
Subject: [ovs-discuss] why ovs it does not ask the controller
In-Reply-To: <CAAsS9QRK7crv=y75S0n5DAHG+RDpnUn7+x9w-dc=4WUJox2H5g@mail.gmail.com>
References: <CAAsS9QRK7crv=y75S0n5DAHG+RDpnUn7+x9w-dc=4WUJox2H5g@mail.gmail.com>
Message-ID: <20150501143343.GA32710@nicira.com>

On Fri, May 01, 2015 at 03:51:07PM +0900, Minh Nghiem Gia wrote:
> I have a simple question, however I could not find any way to answer is
> "why ovs has no rules, it does not ask the controller". In theory, when a
> new packet comes, if there is no matching found, the switch will ask the
> controller for actions. In fact, I can see the Packet_in message if I use
> mininet to connect to a controller on a different PC.
> What I did is I installed both controller and OVS on the same PC which has
> multiple network interfaces act as ports of OVS. Then I deleted all flow
> rules on the switch (sudo ovs-ofctl del-flows br0) and executed a ping from
> that PC to the gateway. I think the switch must ask the controller, but
> there is no OF messages!

OVS should work the same way in the second case as in the first.  OVS
doesn't know whether the controller is on the same PC or a different
one.

From blp at nicira.com  Fri May  1 07:52:05 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 1 May 2015 07:52:05 -0700
Subject: [ovs-discuss] What is the relationship between ofproto and
 ofproto_dpif?
In-Reply-To: <CAHmvmjGQmF4x8_4MEEb7F1K81FGMXE1Z7h4+ofshjp40BJLmTA@mail.gmail.com>
References: <CAHmvmjGQmF4x8_4MEEb7F1K81FGMXE1Z7h4+ofshjp40BJLmTA@mail.gmail.com>
Message-ID: <20150501145205.GB32710@nicira.com>

On Thu, Apr 30, 2015 at 10:40:07PM -0700, Hao Wu wrote:
>    I am confused about the relationship between struct ofproto and struct
> ofproto_dpif. Intuitionally, ofproto_dpif should be the datapath interface
> for a certain ofproto switch, but it is not included in the struct ofproto.
> On the contrary, in struct ofproto_dpif, there is a ofproto instance, not a
> pointer! It seems that it is the datapath interface that contains the
> ofproto switch?

ofproto is an abstract interface, and ofproto_dpif is an implementation
of that abstract interface that works in terms of an underlying datapath
device.  The actual structure layout is similar to how a subclass of a
C++ class is implemented; thus, the subclass includes an instance of the
superclass.

From davidjoshuaevans at gmail.com  Fri May  1 08:13:37 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Fri, 01 May 2015 10:13:37 -0500
Subject: [ovs-discuss] How does OpenFlow protocol action become flow
 table entry?
In-Reply-To: <20150427205237.GD22567@nicira.com>
References: <D163FFBC.27B25%davidjoshuaevans@gmail.com>
 <20150427201838.GA22567@nicira.com>
 <D1640534.27B2E%davidjoshuaevans@gmail.com>
 <20150427205237.GD22567@nicira.com>
Message-ID: <D168FEEA.27DED%davidjoshuaevans@gmail.com>

Hi Ben,

What I mean is - how does a new packet action in action.c - aka
OVS_ACTION_ATTR_STRIP_FOO strip_foo_header end up getting called on a
packet from OpenFlow flow rule?

I can¹t make the connection between open flow handling code (ofp_action.c
ofproto-dpif-xlate.c) to the ovs code for manipulating packets.
Am I completely off track here?
Where do I put my packet modifier on skbuf¹s coming into the sw. And how
do I connect them up to the Open Flow side.

I would have expected to write a fn in packets.c and reference that in
action.c via OVS_ACTION_ATTR* enum, and ?somehow? generate that by
behaviour in a flow table entry from the open flow side (ofp_action etc..).
I only see parse,encode,decode,format types of functions in ofp_action.c
and some magically generated put_* and ofpact_put_* fns in ofp-action.inc2

So I know I need an entry in ofp_raw_action_type
/* ZZ1.0+(4): void. */
ZZ_RAW_STRIP_FOO,
And it¹s relevant parse,encode,decode,format fns.. But what next?



Thanks for your enlightenment so far.. :)

Dave.


On 4/27/15, 3:52 PM, "Ben Pfaff" <blp at nicira.com> wrote:

>Do you mean, where is the code that actually performs the action?
>Usually that's in ofproto/ofproto-dpif-xlate.c, as part of action
>translation.
>
>On Mon, Apr 27, 2015 at 03:50:13PM -0500, David Evans wrote:
>> Thanks Ben 
>> Yes.
>> And I have that side of it written, but which part pushes the action
>>into
>> the tables for a bridge?
>> How is it dispatched when ovs is running?
>> 
>> 
>> Regards,
>> Dave.
>> 
>> On 4/27/15, 3:18 PM, "Ben Pfaff" <blp at nicira.com> wrote:
>> 
>> >On Mon, Apr 27, 2015 at 03:01:16PM -0500, David Evans wrote:
>> >> I have been trolling through the source looking for  how OXM/NXM
>> >>actions end
>> >> up as functioning entries in flow tables.
>> >> I understand that ofp-actions.c and the ofp_raw_action_type
>>enumeration
>> >>is
>> >> at the centre of it all.
>> >> I get how the incoming OpenFlow command strings are processed  by
>> >> encode/decode fns but that?s about it?
>> >> But I don?t understand the path of adding these actions
>> >> 
>> >> I want to use the ActionExperimenter from RYU to drive new arbitrary
>> >>packet
>> >> modifiers via the experimenter extension to open flow.
>> >> I know I could use ovs-ofctl and actions.c  and add new instructions
>> >>that
>> >> way, but I want to stick to OpenFlow so I can drive with other
>> >>controllers
>> >> like Ryu.
>> >
>> >Did you read the FAQ?
>> >
>> >### Q: How do I add support for a new OpenFlow action?
>> >
>> >A: Add your new action to "enum ofp_raw_action_type" in
>> >   lib/ofp-actions.c, following the existing pattern.  Then recompile
>> >   and fix all of the new warnings, implementing new functionality for
>> >   the new action as needed.  (If you configure with --enable-Werror,
>> >   as described in [INSTALL.md], then it is impossible to miss any
>> >   warnings.)
>> >
>> >   If you need to add an OpenFlow vendor extension action for a vendor
>> >   that doesn't yet have any extension actions, then you will also
>> >   need to edit build-aux/extract-ofp-actions.
>> 
>> 



From blp at nicira.com  Fri May  1 08:41:09 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 1 May 2015 08:41:09 -0700
Subject: [ovs-discuss] How does OpenFlow protocol action become flow
 table entry?
In-Reply-To: <D168FEEA.27DED%davidjoshuaevans@gmail.com>
References: <D163FFBC.27B25%davidjoshuaevans@gmail.com>
 <20150427201838.GA22567@nicira.com>
 <D1640534.27B2E%davidjoshuaevans@gmail.com>
 <20150427205237.GD22567@nicira.com>
 <D168FEEA.27DED%davidjoshuaevans@gmail.com>
Message-ID: <20150501154109.GC32710@nicira.com>

There's a couple of layers here.  ofp-actions translates raw OpenFlow
actions into ofpact structures.  (This translation allows the rest of
the Open vSwitch code not to have to deal with differences between
OpenFlow versions.)  Later, ofproto-dpif-xlate translates ofpacts into
the Netlink format used by the Linux kernel module.  (This translation
simplifies a lot of OpenFlow concepts into simpler datapath ones.)  The
Linux kernel module implements the datapath actions.

So you need to define a datapath action, have ofproto-dpif-xlate
translate into those actions, then implement your datapath action in the
kernel module.

On Fri, May 01, 2015 at 10:13:37AM -0500, David Evans wrote:
> Hi Ben,
> 
> What I mean is - how does a new packet action in action.c - aka
> OVS_ACTION_ATTR_STRIP_FOO strip_foo_header end up getting called on a
> packet from OpenFlow flow rule?
> 
> I can¹t make the connection between open flow handling code (ofp_action.c
> ofproto-dpif-xlate.c) to the ovs code for manipulating packets.
> Am I completely off track here?
> Where do I put my packet modifier on skbuf¹s coming into the sw. And how
> do I connect them up to the Open Flow side.
> 
> I would have expected to write a fn in packets.c and reference that in
> action.c via OVS_ACTION_ATTR* enum, and ?somehow? generate that by
> behaviour in a flow table entry from the open flow side (ofp_action etc..).
> I only see parse,encode,decode,format types of functions in ofp_action.c
> and some magically generated put_* and ofpact_put_* fns in ofp-action.inc2
> 
> So I know I need an entry in ofp_raw_action_type
> /* ZZ1.0+(4): void. */
> ZZ_RAW_STRIP_FOO,
> And it¹s relevant parse,encode,decode,format fns.. But what next?
> 
> 
> 
> Thanks for your enlightenment so far.. :)
> 
> Dave.
> 
> 
> On 4/27/15, 3:52 PM, "Ben Pfaff" <blp at nicira.com> wrote:
> 
> >Do you mean, where is the code that actually performs the action?
> >Usually that's in ofproto/ofproto-dpif-xlate.c, as part of action
> >translation.
> >
> >On Mon, Apr 27, 2015 at 03:50:13PM -0500, David Evans wrote:
> >> Thanks Ben 
> >> Yes.
> >> And I have that side of it written, but which part pushes the action
> >>into
> >> the tables for a bridge?
> >> How is it dispatched when ovs is running?
> >> 
> >> 
> >> Regards,
> >> Dave.
> >> 
> >> On 4/27/15, 3:18 PM, "Ben Pfaff" <blp at nicira.com> wrote:
> >> 
> >> >On Mon, Apr 27, 2015 at 03:01:16PM -0500, David Evans wrote:
> >> >> I have been trolling through the source looking for  how OXM/NXM
> >> >>actions end
> >> >> up as functioning entries in flow tables.
> >> >> I understand that ofp-actions.c and the ofp_raw_action_type
> >>enumeration
> >> >>is
> >> >> at the centre of it all.
> >> >> I get how the incoming OpenFlow command strings are processed  by
> >> >> encode/decode fns but that?s about it?
> >> >> But I don?t understand the path of adding these actions
> >> >> 
> >> >> I want to use the ActionExperimenter from RYU to drive new arbitrary
> >> >>packet
> >> >> modifiers via the experimenter extension to open flow.
> >> >> I know I could use ovs-ofctl and actions.c  and add new instructions
> >> >>that
> >> >> way, but I want to stick to OpenFlow so I can drive with other
> >> >>controllers
> >> >> like Ryu.
> >> >
> >> >Did you read the FAQ?
> >> >
> >> >### Q: How do I add support for a new OpenFlow action?
> >> >
> >> >A: Add your new action to "enum ofp_raw_action_type" in
> >> >   lib/ofp-actions.c, following the existing pattern.  Then recompile
> >> >   and fix all of the new warnings, implementing new functionality for
> >> >   the new action as needed.  (If you configure with --enable-Werror,
> >> >   as described in [INSTALL.md], then it is impossible to miss any
> >> >   warnings.)
> >> >
> >> >   If you need to add an OpenFlow vendor extension action for a vendor
> >> >   that doesn't yet have any extension actions, then you will also
> >> >   need to edit build-aux/extract-ofp-actions.
> >> 
> >> 
> 
> 

From edward.ryabikov at gmail.com  Fri May  1 07:24:43 2015
From: edward.ryabikov at gmail.com (Edward Ryabikov)
Date: Fri, 1 May 2015 17:24:43 +0300
Subject: [ovs-discuss] Open vSwitch, in-band control: How it works?
Message-ID: <CAN-EbcMJbU0dhxMsxKXCUr8Uu66SNoi_OLZD=GKULWN2NF--LA@mail.gmail.com>

Hi,

I try to measure the control flow impact on Open vSwitch performance
while using in-band connections.

So in this task I need to count the messages sent from controller to
every switch in the network that uses in-band control.

I try to understand how the controller installs flows into Open
vSwitch while using in-band connection. I've created an example
topology using mininet and this
article:http://tocai.dia.uniroma3.it/compunet-wiki/index.php/In-band_control_with_Open_vSwitch

The topology contains 5 switches connected one-by-one (as show on the
first picture of the article).

The controller is launched on the h3 host. In my case the POX
controller is used. And all is pingable.

So when I try to sniff the traffic on s1 ... s5 interfaces, I see that
OpenFlow messages (PacketIn, PacketOut etc) appear only on the s3
interface. On other interfaces I don't see any TCP or OpenFlow
packets. But as 'ovs-vsctl dump-flows' command shows, the flow are
automatically installed on switches.

The question is how the controller installs new flows on s1, s2, s4,
s5 switches? And how the controller messages are delivered to the
switch that is not directly connected to controller?

Thanks in advance.

Edward

From blp at nicira.com  Fri May  1 11:15:16 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 1 May 2015 11:15:16 -0700
Subject: [ovs-discuss] OVS connection with OpenDayLight via
 OF-CONFIG/OpenFlow
In-Reply-To: <CAKv4ra8_daOPqebD9JbH5nSNb8xGMb3_Jkguin9EGS_kZOXu1w@mail.gmail.com>
References: <CAKv4ra8_daOPqebD9JbH5nSNb8xGMb3_Jkguin9EGS_kZOXu1w@mail.gmail.com>
Message-ID: <20150501181516.GB2378@nicira.com>

On Thu, Apr 30, 2015 at 11:37:58PM -0700, Vipin Garg wrote:
> 1.       In my switch, I do have any bridge interface (in linux kernel on
> physical switch ). So, is there a way to setup  controller IP address
> without bridge.CLI --  ovs-vsctl set-controller BRIDGE TARGET  -- requires
> BRIDGE as one of the parameter.
> 
> Is there a workaround for this ?

OpenFlow controllers work with OpenFlow switches (bridges).  If you
don't have a switch, then it doesn't make any sense to tell OVS to
connect to a controller.

> 2.       What is  CLI -- ovs-vsctl set-manager --  command for ?  Which
> this CLI (with my controller IP set-manager tcp:192.168.222.100:6640 ), I
> can see my switch on OpenDayLight  under ‘Connection Manager’ tab. What is
> this for and it this channel also use OpenFlow/OF-CONFIG protocol ?

There's a separate project developing OF-CONFIG for OVS.  See
https://github.com/openvswitch/of-config.  But Open Daylight also
supports OVSDB, which is the OVS native configuration protocol, so it
would be easier for you to use that.

From ajn.bin at gmail.com  Fri May  1 14:01:44 2015
From: ajn.bin at gmail.com (AJ NOURI)
Date: Fri, 1 May 2015 23:01:44 +0200
Subject: [ovs-discuss] Mirroring works only for layer2 traffic.
Message-ID: <CAO=Hd=g2G2F_=r0fvmVm6o-BY9J7xGwoO9prH4Borw3SFdqAdA@mail.gmail.com>

Hi everyone,

For testing purposes, I am using Open vswitch to mirror traffic from 2
interfaces eth1 and eth2 to eth3. I am using the following command:

ovs-vsctl -- set Bridge br0 mirrors=@m \
 -- --id=@eth1 get Port eth1 \
 -- --id=@eth2 get Port eth2 \
 -- --id=@eth3 get Port eth3 \
 -- --id=@m create Mirror name=e1e2toe3 select-dst-port=@eth1
select-src-port=@eth1 output-port=@eth3

A node with tcpdump is connected to eth3.

tcpdump shows only layer2 traffic: ARP, CDP (Cisco devices connected to
eth1 and eth2) conversations between devices connected to eth1 and eth2,
but no upper layers:
ex: pings, ssh, telnet not visible.

Any hint?

AJ NOURI
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150501/6eebfa08/attachment.html>

From westlake2012 at videotron.ca  Fri May  1 14:59:38 2015
From: westlake2012 at videotron.ca (westlake)
Date: Fri, 01 May 2015 17:59:38 -0400
Subject: [ovs-discuss] issue with traffic flow
Message-ID: <5543F74A.2060902@videotron.ca>

There is a traffic flow issue with openvswitch when sessioning between a 
main bridge port and a member port.

eg,
ovs-vsctl add-br br0
ovs-vsctl add-port br0 eth0

a tuntap device is added to br0
ovs-vsctl add-port br0 tap0

and this tap0 device is used by a virtual machine.

br0 gets a dhcp ip address without issue, and the VM machine which uses 
tap0 also gets a dhcp ip address from an external routing box, so these 
two ip's are on the same network.

Here's where it gets fuzzy and difficult to explain, and it tends to 
happen all the time when ssh is used with iptables. The main problem is 
a large delay when there is a session going on between the hypervisor 
and VM.

I'll start with the noticeable problem,

Hypervisor-on-br0<-openvswitch->VM-on-tap0

When an ssh(client) command is issued to talk to the VM, there is no 
delay at all. ssh -vv shows nothing particular and the starting of the 
ssh session with the login prompt shows up immediately.

However, exactly the same scenario, only having to use iptables (and 
this occurs regardless of the distro in the VM)

--> tcpdump shows there is traffic immediately returned -- and this is 
tcpdump running on the VM, ... only that the login prompt on the 
hypervisor does not show the prompt until 30 seconds later! weird.

I've tried to file this and thought it might have been iptables or the 
distro's kernel that I'm using at fault, but apparently this also 
happens with another distro as a VM guest.

For some reason "iptables" in a VM is creating a "delay" with 
openvswitch, .. I have no idea why this is, but even ssh -vv doesn't 
seem to indicate to me much.

All I know is there is a "delay".. furthermore to clarify something, 
traffic between a wired client issuing ssh outside the hypervisor gets 
an instantaneous ssh login prompt regardless iptables is up or not.  For 
some reason having "iptables" enabled (in the VM) is creating a delay 
between the hypervisor and VM guest.

the iptables rule is very simple,

iptables -I INPUT -p tcp --dport 22 -j ACCEPT
iptables -P INPUT DROP

iptables -L -n -v (there is nothing detail revealing anything other than 
port 22 being set)

Openvswitch is running on a debian system, and I thought it may have 
been due to a bug with iptables or the the new default kernel being used 
on the recent release of debian but I'm pretty sure something odd is 
happening with openvswitch causing this.  It doesn't make sense why 
"iptables" in a VM would be causing a delay in ssh session but it is.

I've tried to bring this up on debian bugreporting, but I don't think it 
has anything to do with iptables or kernel because tcpdump tells me the 
packets from the VM are timely responding.. there is a long delay (30 
seconds) in tcpdump before the client suddently starts to show a login 
prompt. According to what I'm seeing there is a "prompt" after the 30 
second delay before there is new traffic to be seen -- telling me there 
are packets hanging somewhere around back at the hypervisor side.

anyone want to take a jab at it be my guest..

https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=783747
https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=783958

From blp at nicira.com  Fri May  1 15:57:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 1 May 2015 15:57:59 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
Message-ID: <20150501225759.GA2889@nicira.com>

On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia Mahmood wrote:
> So I am trying to configure queues on a mininet topology. The command that I use is, (here s1-eth1 is my port 1) 
> 
> sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  - -id=@newqos create qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create queue other-config:max-rate=100000000 other-config:min-rate=5000000 - -
> 
> The qos is attached to the port, checked it from sudo ovs-vsctl list port s1-eth1, and the queues are created.

Probably the queues aren't really created.  Check the ovs-vswitchd log
for error messages.

From maniksidana019 at gmail.com  Fri May  1 20:27:42 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Sat, 02 May 2015 08:57:42 +0530
Subject: [ovs-discuss] Mirroring works only for layer2 traffic.
Message-ID: <i23bkf9tbr666k18uexij4sj.1430537141814@email.android.com>

Hi Aj Nouri,

Can you also share the output of below commands
ovs-ofctl dump-flows br0
ovs-ofctl show br0
ovs-vsctl show
ifconfig -a

-------- Original message --------
From: AJ NOURI <ajn.bin at gmail.com> 
Date: 02/05/2015  02:31  (GMT+05:30) 
To: discuss at openvswitch.org 
Subject: [ovs-discuss] Mirroring works only for layer2 traffic. 
 
Hi everyone,

For testing purposes, I am using Open vswitch to mirror traffic from 2 interfaces eth1 and eth2 to eth3. I am using the following command:

ovs-vsctl -- set Bridge br0 mirrors=@m \
 -- --id=@eth1 get Port eth1 \
 -- --id=@eth2 get Port eth2 \
 -- --id=@eth3 get Port eth3 \
 -- --id=@m create Mirror name=e1e2toe3 select-dst-port=@eth1 select-src-port=@eth1 output-port=@eth3

A node with tcpdump is connected to eth3.

tcpdump shows only layer2 traffic: ARP, CDP (Cisco devices connected to eth1 and eth2) conversations between devices connected to eth1 and eth2, but no upper layers: 
ex: pings, ssh, telnet not visible.

Any hint?

AJ NOURI
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150502/478c529c/attachment.html>

From nghiem.gia.minh at gmail.com  Fri May  1 21:58:36 2015
From: nghiem.gia.minh at gmail.com (Minh Nghiem Gia)
Date: Sat, 2 May 2015 13:58:36 +0900
Subject: [ovs-discuss] why ovs it does not ask the controller
In-Reply-To: <20150501143343.GA32710@nicira.com>
References: <CAAsS9QRK7crv=y75S0n5DAHG+RDpnUn7+x9w-dc=4WUJox2H5g@mail.gmail.com>
 <20150501143343.GA32710@nicira.com>
Message-ID: <CAAsS9QT0_G4tNdH1Ju=wS_eFf686ruZYUyuSF8gzJ6+PPC0UCA@mail.gmail.com>

Thanks Ben for your confirmation.
I used wireshark to capture packets on the bridge br0 and physical wlan NIC
(wlan0).
I executed a simple ping from the PC to the gateway. No arp cache so I only
saw arp request for the gatway. when OVS still has normal rule, I saw the
arp packet on both br0 and wlan0. When I deleted all flow rules, I did not
see arp on the bridge but saw arp on the wlan0.

Could you tell me why there is no flow rule, the packet can reach wlan0? I
mean should the OVS drop the packet? Or do arp packets not go through the
switch? And is there any ways to debug/capture this behavior (i.e., OVS
communicate with the system via netlink? The system sends out arp packets?)

Best regards,
Minh.

2015-05-01 23:33 GMT+09:00 Ben Pfaff <blp at nicira.com>:

> On Fri, May 01, 2015 at 03:51:07PM +0900, Minh Nghiem Gia wrote:
> > I have a simple question, however I could not find any way to answer is
> > "why ovs has no rules, it does not ask the controller". In theory, when a
> > new packet comes, if there is no matching found, the switch will ask the
> > controller for actions. In fact, I can see the Packet_in message if I use
> > mininet to connect to a controller on a different PC.
> > What I did is I installed both controller and OVS on the same PC which
> has
> > multiple network interfaces act as ports of OVS. Then I deleted all flow
> > rules on the switch (sudo ovs-ofctl del-flows br0) and executed a ping
> from
> > that PC to the gateway. I think the switch must ask the controller, but
> > there is no OF messages!
>
> OVS should work the same way in the second case as in the first.  OVS
> doesn't know whether the controller is on the same PC or a different
> one.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150502/bf0596b8/attachment-0001.html>

From mb at us.ibm.com  Sat May  2 08:27:36 2015
From: mb at us.ibm.com (Mohammad Banikazemi)
Date: Sat, 2 May 2015 11:27:36 -0400
Subject: [ovs-discuss] CPU Utilization
Message-ID: <OF7156E22A.98302AC1-ON85257E39.0054D250-85257E39.0054ECDD@us.ibm.com>



I know this has been reported (and fixed in some cases) earlier but in our
setup with
Ubuntu 14.04 and 10 Gbps links, using something like Iperf with a single
flow we max out at a 3-4 Gbps and see 100% CPU utilization on one of the
cores. Is this expected? If not, are there configuration parameters we need
to adjust? Any particular system info needed to know what is happening? Any
suggestions or pointers to where we can find more information is much
appreciated.

Best,

Mohammad
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150502/a6673864/attachment.html>

From blp at nicira.com  Sat May  2 09:17:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 2 May 2015 09:17:04 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
Message-ID: <20150502161704.GA19570@nicira.com>

Check whether the kernel shows the qdisc being configured: "tc qdisc
show".

On Sat, May 02, 2015 at 05:11:30PM +0500, Haleema Sadia wrote:
> Hi Ben,
> 
> Thanks for your response!
> 
> The ovs-vswitchd log shows shows no error and neither does it says anything
> about the queue creation. Is that fine? However, I do get the qos id and
> the queue id when I create them.
> 
> On Sat, May 2, 2015 at 3:57 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia Mahmood wrote:
> > > So I am trying to configure queues on a mininet topology. The command
> > that I use is, (here s1-eth1 is my port 1)
> > >
> > > sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  - -id=@newqos create
> > qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create queue
> > other-config:max-rate=100000000 other-config:min-rate=5000000 - -
> > >
> > > The qos is attached to the port, checked it from sudo ovs-vsctl list
> > port s1-eth1, and the queues are created.
> >
> > Probably the queues aren't really created.  Check the ovs-vswitchd log
> > for error messages.
> >

From blp at nicira.com  Sat May  2 09:33:30 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 2 May 2015 09:33:30 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
Message-ID: <20150502163330.GB19570@nicira.com>

OK, the linux-htb qdisc isn't really getting configured.  We'll have to
figure out why.

Is the htb kernel module loaded?  Is there anything in the kernel log
related to htb?

On Sat, May 02, 2015 at 09:20:19AM -0700, Haleema Sadia wrote:
> It says:
> 
> qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2 1 2 0 0
> 1 1 1 1 1 1 1 1
> 
> 
> On Sat, May 2, 2015 at 9:17 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Check whether the kernel shows the qdisc being configured: "tc qdisc
> > show".
> >
> > On Sat, May 02, 2015 at 05:11:30PM +0500, Haleema Sadia wrote:
> > > Hi Ben,
> > >
> > > Thanks for your response!
> > >
> > > The ovs-vswitchd log shows shows no error and neither does it says
> > anything
> > > about the queue creation. Is that fine? However, I do get the qos id and
> > > the queue id when I create them.
> > >
> > > On Sat, May 2, 2015 at 3:57 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia Mahmood wrote:
> > > > > So I am trying to configure queues on a mininet topology. The command
> > > > that I use is, (here s1-eth1 is my port 1)
> > > > >
> > > > > sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  - -id=@newqos create
> > > > qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create queue
> > > > other-config:max-rate=100000000 other-config:min-rate=5000000 - -
> > > > >
> > > > > The qos is attached to the port, checked it from sudo ovs-vsctl list
> > > > port s1-eth1, and the queues are created.
> > > >
> > > > Probably the queues aren't really created.  Check the ovs-vswitchd log
> > > > for error messages.
> > > >
> >

From blp at nicira.com  Sat May  2 09:37:57 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 2 May 2015 09:37:57 -0700
Subject: [ovs-discuss] CPU Utilization
In-Reply-To: <OF7156E22A.98302AC1-ON85257E39.0054D250-85257E39.0054ECDD@us.ibm.com>
References: <OF7156E22A.98302AC1-ON85257E39.0054D250-85257E39.0054ECDD@us.ibm.com>
Message-ID: <20150502163757.GC19570@nicira.com>

On Sat, May 02, 2015 at 11:27:36AM -0400, Mohammad Banikazemi wrote:
> I know this has been reported (and fixed in some cases) earlier but in our
> setup with
> Ubuntu 14.04 and 10 Gbps links, using something like Iperf with a single
> flow we max out at a 3-4 Gbps and see 100% CPU utilization on one of the
> cores. Is this expected? 

No.

> If not, are there configuration parameters we need to adjust? Any
> particular system info needed to know what is happening? Any
> suggestions or pointers to where we can find more information is much
> appreciated.

What's your flow table?  What's your OVS version?  What's your hardware?

From blp at nicira.com  Sat May  2 09:57:50 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 2 May 2015 09:57:50 -0700
Subject: [ovs-discuss] why ovs it does not ask the controller
In-Reply-To: <CAAsS9QT0_G4tNdH1Ju=wS_eFf686ruZYUyuSF8gzJ6+PPC0UCA@mail.gmail.com>
References: <CAAsS9QRK7crv=y75S0n5DAHG+RDpnUn7+x9w-dc=4WUJox2H5g@mail.gmail.com>
 <20150501143343.GA32710@nicira.com>
 <CAAsS9QT0_G4tNdH1Ju=wS_eFf686ruZYUyuSF8gzJ6+PPC0UCA@mail.gmail.com>
Message-ID: <20150502165750.GD19570@nicira.com>

I noticed that you mentioned wireless.  Are you sure that isn't the
problem?  The FAQ says:

### Q: I can't seem to use Open vSwitch in a wireless network.

A: Wireless base stations generally only allow packets with the source
   MAC address of NIC that completed the initial handshake.
   Therefore, without MAC rewriting, only a single device can
   communicate over a single wireless link.

   This isn't specific to Open vSwitch, it's enforced by the access
   point, so the same problems will show up with the Linux bridge or
   any other way to do bridging.


On Sat, May 02, 2015 at 01:58:36PM +0900, Minh Nghiem Gia wrote:
> Thanks Ben for your confirmation.
> I used wireshark to capture packets on the bridge br0 and physical wlan NIC
> (wlan0).
> I executed a simple ping from the PC to the gateway. No arp cache so I only
> saw arp request for the gatway. when OVS still has normal rule, I saw the
> arp packet on both br0 and wlan0. When I deleted all flow rules, I did not
> see arp on the bridge but saw arp on the wlan0.
> 
> Could you tell me why there is no flow rule, the packet can reach wlan0? I
> mean should the OVS drop the packet? Or do arp packets not go through the
> switch? And is there any ways to debug/capture this behavior (i.e., OVS
> communicate with the system via netlink? The system sends out arp packets?)
> 
> Best regards,
> Minh.
> 
> 2015-05-01 23:33 GMT+09:00 Ben Pfaff <blp at nicira.com>:
> 
> > On Fri, May 01, 2015 at 03:51:07PM +0900, Minh Nghiem Gia wrote:
> > > I have a simple question, however I could not find any way to answer is
> > > "why ovs has no rules, it does not ask the controller". In theory, when a
> > > new packet comes, if there is no matching found, the switch will ask the
> > > controller for actions. In fact, I can see the Packet_in message if I use
> > > mininet to connect to a controller on a different PC.
> > > What I did is I installed both controller and OVS on the same PC which
> > has
> > > multiple network interfaces act as ports of OVS. Then I deleted all flow
> > > rules on the switch (sudo ovs-ofctl del-flows br0) and executed a ping
> > from
> > > that PC to the gateway. I think the switch must ask the controller, but
> > > there is no OF messages!
> >
> > OVS should work the same way in the second case as in the first.  OVS
> > doesn't know whether the controller is on the same PC or a different
> > one.
> >

From blp at nicira.com  Sat May  2 10:16:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 2 May 2015 10:16:28 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
 <20150502163330.GB19570@nicira.com>
 <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>
Message-ID: <20150502171628.GF19570@nicira.com>

Can you provide the ovs-vswitchd log?

On Sat, May 02, 2015 at 09:58:34AM -0700, Haleema Sadia wrote:
> My mininet wasn't working before when I type the command, but I restarted
> it and now the command shows this:
> 
> qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2 1 2 0 0
> 1 1 1 1 1 1 1 1
> qdisc htb 5: dev s1-eth1 root refcnt 2 r2q 10 default 1 direct_packets_stat
> 0 direct_qlen 1000
> qdisc netem 10: dev s1-eth1 parent 5:1 limit 1000 delay 99us
> qdisc htb 5: dev s1-eth2 root refcnt 2 r2q 10 default 1 direct_packets_stat
> 0 direct_qlen 1000
> qdisc netem 10: dev s1-eth2 parent 5:1 limit 1000 delay 99us
> qdisc htb 5: dev s1-eth3 root refcnt 2 r2q 10 default 1 direct_packets_stat
> 0 direct_qlen 1000
> qdisc netem 10: dev s1-eth3 parent 5:1 limit 1000 delay 99us
> 
> (the topology is one switch and three hosts)
> 
> And I am attaching my kern.log
> 
> 
> 
> On Sat, May 2, 2015 at 9:33 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > OK, the linux-htb qdisc isn't really getting configured.  We'll have to
> > figure out why.
> >
> > Is the htb kernel module loaded?  Is there anything in the kernel log
> > related to htb?
> >
> > On Sat, May 02, 2015 at 09:20:19AM -0700, Haleema Sadia wrote:
> > > It says:
> > >
> > > qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2 1 2
> > 0 0
> > > 1 1 1 1 1 1 1 1
> > >
> > >
> > > On Sat, May 2, 2015 at 9:17 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > Check whether the kernel shows the qdisc being configured: "tc qdisc
> > > > show".
> > > >
> > > > On Sat, May 02, 2015 at 05:11:30PM +0500, Haleema Sadia wrote:
> > > > > Hi Ben,
> > > > >
> > > > > Thanks for your response!
> > > > >
> > > > > The ovs-vswitchd log shows shows no error and neither does it says
> > > > anything
> > > > > about the queue creation. Is that fine? However, I do get the qos id
> > and
> > > > > the queue id when I create them.
> > > > >
> > > > > On Sat, May 2, 2015 at 3:57 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > > >
> > > > > > On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia Mahmood
> > wrote:
> > > > > > > So I am trying to configure queues on a mininet topology. The
> > command
> > > > > > that I use is, (here s1-eth1 is my port 1)
> > > > > > >
> > > > > > > sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  - -id=@newqos
> > create
> > > > > > qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create queue
> > > > > > other-config:max-rate=100000000 other-config:min-rate=5000000 - -
> > > > > > >
> > > > > > > The qos is attached to the port, checked it from sudo ovs-vsctl
> > list
> > > > > > port s1-eth1, and the queues are created.
> > > > > >
> > > > > > Probably the queues aren't really created.  Check the ovs-vswitchd
> > log
> > > > > > for error messages.
> > > > > >
> > > >
> >



From blp at nicira.com  Sat May  2 10:25:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 2 May 2015 10:25:06 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <CAN-u-63Dxz0itOJiMN7sixnFVPgiSnUJ6n4EvM6A+mERRg2whg@mail.gmail.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
 <20150502163330.GB19570@nicira.com>
 <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>
 <20150502171628.GF19570@nicira.com>
 <CAN-u-63Dxz0itOJiMN7sixnFVPgiSnUJ6n4EvM6A+mERRg2whg@mail.gmail.com>
Message-ID: <20150502172506.GG19570@nicira.com>

It looks like mininet is taking charge of the qdisc on s1-eth1.  There
can only be one configuration, so if mininet wants to set it one way and
OVS the other then only one can win.  I suspect you should talk to the
mininet folks.

On Sat, May 02, 2015 at 10:17:19AM -0700, Haleema Sadia wrote:
> Here it is!
> 
> On Sat, May 2, 2015 at 10:16 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Can you provide the ovs-vswitchd log?
> >
> > On Sat, May 02, 2015 at 09:58:34AM -0700, Haleema Sadia wrote:
> > > My mininet wasn't working before when I type the command, but I restarted
> > > it and now the command shows this:
> > >
> > > qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2 1 2
> > 0 0
> > > 1 1 1 1 1 1 1 1
> > > qdisc htb 5: dev s1-eth1 root refcnt 2 r2q 10 default 1
> > direct_packets_stat
> > > 0 direct_qlen 1000
> > > qdisc netem 10: dev s1-eth1 parent 5:1 limit 1000 delay 99us
> > > qdisc htb 5: dev s1-eth2 root refcnt 2 r2q 10 default 1
> > direct_packets_stat
> > > 0 direct_qlen 1000
> > > qdisc netem 10: dev s1-eth2 parent 5:1 limit 1000 delay 99us
> > > qdisc htb 5: dev s1-eth3 root refcnt 2 r2q 10 default 1
> > direct_packets_stat
> > > 0 direct_qlen 1000
> > > qdisc netem 10: dev s1-eth3 parent 5:1 limit 1000 delay 99us
> > >
> > > (the topology is one switch and three hosts)
> > >
> > > And I am attaching my kern.log
> > >
> > >
> > >
> > > On Sat, May 2, 2015 at 9:33 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > OK, the linux-htb qdisc isn't really getting configured.  We'll have to
> > > > figure out why.
> > > >
> > > > Is the htb kernel module loaded?  Is there anything in the kernel log
> > > > related to htb?
> > > >
> > > > On Sat, May 02, 2015 at 09:20:19AM -0700, Haleema Sadia wrote:
> > > > > It says:
> > > > >
> > > > > qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2
> > 1 2
> > > > 0 0
> > > > > 1 1 1 1 1 1 1 1
> > > > >
> > > > >
> > > > > On Sat, May 2, 2015 at 9:17 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > > >
> > > > > > Check whether the kernel shows the qdisc being configured: "tc
> > qdisc
> > > > > > show".
> > > > > >
> > > > > > On Sat, May 02, 2015 at 05:11:30PM +0500, Haleema Sadia wrote:
> > > > > > > Hi Ben,
> > > > > > >
> > > > > > > Thanks for your response!
> > > > > > >
> > > > > > > The ovs-vswitchd log shows shows no error and neither does it
> > says
> > > > > > anything
> > > > > > > about the queue creation. Is that fine? However, I do get the
> > qos id
> > > > and
> > > > > > > the queue id when I create them.
> > > > > > >
> > > > > > > On Sat, May 2, 2015 at 3:57 AM, Ben Pfaff <blp at nicira.com>
> > wrote:
> > > > > > >
> > > > > > > > On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia Mahmood
> > > > wrote:
> > > > > > > > > So I am trying to configure queues on a mininet topology. The
> > > > command
> > > > > > > > that I use is, (here s1-eth1 is my port 1)
> > > > > > > > >
> > > > > > > > > sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  -
> > -id=@newqos
> > > > create
> > > > > > > > qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create queue
> > > > > > > > other-config:max-rate=100000000 other-config:min-rate=5000000
> > - -
> > > > > > > > >
> > > > > > > > > The qos is attached to the port, checked it from sudo
> > ovs-vsctl
> > > > list
> > > > > > > > port s1-eth1, and the queues are created.
> > > > > > > >
> > > > > > > > Probably the queues aren't really created.  Check the
> > ovs-vswitchd
> > > > log
> > > > > > > > for error messages.
> > > > > > > >
> > > > > >
> > > >
> >
> >
> >



From a_azouni at esi.dz  Sun May  3 07:17:43 2015
From: a_azouni at esi.dz (Azouni Abdelhadi)
Date: Sun, 3 May 2015 16:17:43 +0200
Subject: [ovs-discuss] Why does'nt OVS flood ARP packets when connected to
	POX?
Message-ID: <CA+_RhB2vF_u7tZ4X9nsCyCXzW3XXtue0NP6MY6zCReR5HZpcFw@mail.gmail.com>

Hello everyone,

I have ovs connecting two hosts and connected to POX controller. When I
send an ARP request from host1 to an unknown host, OVS send a packet-in to
POX. POx responds with a packet-out with action: flood on all physical
ports except those blocked by STP. By sniffing the physical ports not
blocked by STP I do'nt see any ARP packets.
(same problem when connected to floodlight)

PS. OVS floods ARP packets when connected to Opendaylight

Any ideas?

Thanks!

Abdelhadi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150503/82156b03/attachment.html>

From blp at nicira.com  Sun May  3 10:10:33 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 3 May 2015 10:10:33 -0700
Subject: [ovs-discuss] Why does'nt OVS flood ARP packets when connected
 to POX?
In-Reply-To: <CA+_RhB2vF_u7tZ4X9nsCyCXzW3XXtue0NP6MY6zCReR5HZpcFw@mail.gmail.com>
References: <CA+_RhB2vF_u7tZ4X9nsCyCXzW3XXtue0NP6MY6zCReR5HZpcFw@mail.gmail.com>
Message-ID: <20150503171033.GB20763@nicira.com>

On Sun, May 03, 2015 at 04:17:43PM +0200, Azouni Abdelhadi wrote:
> I have ovs connecting two hosts and connected to POX controller. When I
> send an ARP request from host1 to an unknown host, OVS send a packet-in to
> POX. POx responds with a packet-out with action: flood on all physical
> ports except those blocked by STP. By sniffing the physical ports not
> blocked by STP I do'nt see any ARP packets.
> (same problem when connected to floodlight)
> 
> PS. OVS floods ARP packets when connected to Opendaylight

I guess that OpenDaylight and the other controllers must be doing
different things.  Perhaps you should figure out what.

From vkg.2006 at gmail.com  Fri May  1 12:58:58 2015
From: vkg.2006 at gmail.com (Vipin Garg)
Date: Fri, 1 May 2015 12:58:58 -0700
Subject: [ovs-discuss] ovs-vswitchd crash while setting up controller IP
Message-ID: <CAKv4ra_4g7eTU50_7ASzWDguDCnP7D5AwCfpYcAieYNxJx9Fwg@mail.gmail.com>

Hello,

I added a bridge (br0) in my physical switch Linux kernel...  and set the
controller IP address as
   ovs-vsctl set-controller 192.168.222.100:6633.

Just to make it clear, my controller is running on a separate machine ..On
the switch, ovs-vsctl show following --

# ./ovs-vsctl show
57928703-e317-4e71-b9b4-d98352c44701
    Bridge "br0"
        Controller "tcp:192.168.222.100:6633"
        Port "br0"
            Interface "br0"
                type: internal

Now, when I start ovs-vswitchd, it crash with segmentation fault (see
attached logs for more detail ...)

015-05-01T18:56:56Z|00059|connmgr|INFO|br0: added service controller
"punix:/usr/local/var/run/openvswitch/br0.mgmt"
2015-05-01T18:56:56Z|00060|connmgr|INFO|br0: added primary controller "tcp:
192.168.222.100:6633"
2015-05-01T18:56:56Z|00061|rconn|INFO|br0<->tcp:192.168.222.100:6633:
reconnect()==>connecting...
2015-05-01T18:56:56Z|00062|rconn|DBG|br0<->tcp:192.168.222.100:6633:
entering CONNECTING
2015-05-01T18:56:56Z|00063|socket_util_unix|DBG|br0: ioctl(SIOCGIFFLAGS)
failed: No such device
2015-05-01T18:56:56Z|00001|daemon_unix|ERR|fork child died before signaling
startup (killed (Segmentation fault))
ovs-vswitchd: could not detach from foreground session


-- What am I doing wrong here and what else is missing ..?

Thanks
Vipin Garg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150501/5863560a/attachment-0001.html>
-------------- next part --------------
/data2 # ./ovs-vswitchd  --verbose --pidfile --detach
2015-05-01T06:40:03Z|00001|daemon_unix|DBG|/usr/local/var/run/openvswitch/ovs-vswitchd.pid: deleted stale pidfile
2015-05-01T06:40:03Z|00002|reconnect|DBG|unix:/usr/local/var/run/openvswitch/db.sock: entering BACKOFF
2015-05-01T06:40:03Z|00003|ovs_numa|INFO|Discovered 0 NUMA nodes and 0 CPU cores
2015-05-01T06:40:03Z|00004|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock: connecting...
2015-05-01T06:40:03Z|00005|reconnect|DBG|unix:/usr/local/var/run/openvswitch/db.sock: entering CONNECTING
2015-05-01T06:40:03Z|00006|poll_loop|DBG|wakeup due to [POLLOUT] on fd 13 (<->/usr/local/var/run/openvswitch/db.sock) at lib/stream-fd.c:151
2015-05-01T06:40:03Z|00007|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock: connected
2015-05-01T06:40:03Z|00008|reconnect|DBG|unix:/usr/local/var/run/openvswitch/db.sock: entering ACTIVE
2015-05-01T06:40:03Z|00009|jsonrpc|DBG|unix:/usr/local/var/run/openvswitch/db.sock: send request, method="get_schema", params=["Open_vSwitch"], id=0
2015-05-01T06:40:03Z|00010|jsonrpc|DBG|unix:/usr/local/var/run/openvswitch/db.sock: send request, method="lock", params=["ovs_vswitchd"], id=1
2015-05-01T06:40:03Z|00011|poll_loop|DBG|wakeup due to [POLLIN] on fd 13 (<->/usr/local/var/run/openvswitch/db.sock) at lib/stream-fd.c:155
2015-05-01T06:40:03Z|00012|hmap|DBG|lib/shash.c:112: 6 nodes in bucket (8 nodes, 4 buckets)
2015-05-01T06:40:03Z|00013|jsonrpc|DBG|unix:/usr/local/var/run/openvswitch/db.sock: received reply, result={"name":"Open_vSwitch","tables":{"Mirror":{"columns":{"select_src_port":{"type":{"key":{"type":"uuid","refTable":"Port","refType":"weak"},"min":0,"max":"unlimited"}},"select_dst_port":{"type":{"key":{"type":"uuid","refTable":"Port","refType":"weak"},"min":0,"max":"unlimited"}},"name":{"type":"string"},"output_vlan":{"type":{"key":{"maxInteger":4095,"type":"integer","minInteger":1},"min":0}},"select_vlan":{"type":{"key":{"maxInteger":4095,"type":"integer","minInteger":0},"min":0,"max":4096}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"output_port":{"type":{"key":{"type":"uuid","refTable":"Port","refType":"weak"},"min":0}},"statistics":{"ephemeral":true,"type":{"min":0,"key":"string","value":"integer","max":"unlimited"}},"select_all":{"type":"boolean"}}},"IPFIX":{"columns":{"sampling":{"type":{"key":{"maxInteger":4294967295,"type":"integer","minInteger":1},"min":0}},"targets":{"type":{"key":"string","min":0,"max":"unlimited"}},"obs_domain_id":{"type":{"key":{"maxInteger":4294967295,"type":"integer","minInteger":0},"min":0}},"cache_max_flows":{"type":{"key":{"maxInteger":4294967295,"type":"integer","minInteger":0},"min":0}},"cache_active_timeout":{"type":{"key":{"maxInteger":4200,"type":"integer","minInteger":0},"min":0}},"obs_point_id":{"type":{"key":{"maxInteger":4294967295,"type":"integer","minInteger":0},"min":0}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"other_config":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}}}},"Manager":{"columns":{"max_backoff":{"type":{"key":{"type":"integer","minInteger":1000},"min":0}},"target":{"type":"string"},"is_connected":{"ephemeral":true,"type":"boolean"},"status":{"ephemeral":true,"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"connection_mode":{"type":{"key":{"type":"string","enum":["set",["in-band","out-of-band"]]},"min":0}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"inactivity_probe":{"type":{"key":"integer","min":0}},"other_config":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}}},"indexes":[["target"]]},"AutoAttach":{"columns":{"system_name":{"type":"string"},"mappings":{"type":{"min":0,"key":{"maxInteger":16777215,"type":"integer","minInteger":0},"value":{"maxInteger":4095,"type":"integer","minInteger":0},"max":"unlimited"}},"system_description":{"type":"string"}}},"Controller":{"columns":{"controller_rate_limit":{"type":{"key":{"type":"integer","minInteger":100},"min":0}},"max_backoff":{"type":{"key":{"type":"integer","minInteger":1000},"min":0}},"target":{"type":"string"},"is_connected":{"ephemeral":true,"type":"boolean"},"local_netmask":{"type":{"key":"string","min":0}},"role":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["master","other","slave"]]},"min":0}},"local_gateway":{"type":{"key":"string","min":0}},"status":{"ephemeral":true,"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"enable_async_messages":{"type":{"key":"boolean","min":0}},"controller_burst_limit":{"type":{"key":{"type":"integer","minInteger":25},"min":0}},"connection_mode":{"type":{"key":{"type":"string","enum":["set",["in-band","out-of-band"]]},"min":0}},"local_ip":{"type":{"key":"string","min":0}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"other_config":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"inactivity_probe":{"type":{"key":"integer","min":0}}}},"Queue":{"columns":{"dscp":{"type":{"key":{"maxInteger":63,"type":"integer","minInteger":0},"min":0}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"other_config":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}}},"isRoot":true},"Interface":{"columns":{"cfm_mpid":{"type":{"key":"integer","min":0}},"ofport_request":{"type":{"key":{"maxInteger":65279,"type":"integer","minInteger":1},"min":0}},"cfm_health":{"ephemeral":true,"type":{"key":{"maxInteger":100,"type":"integer","minInteger":0},"min":0}},"ofport":{"type":{"key":"integer","min":0}},"link_speed":{"ephemeral":true,"type":{"key":"integer","min":0}},"status":{"ephemeral":true,"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"mtu":{"ephemeral":true,"type":{"key":"integer","min":0}},"cfm_remote_mpids":{"ephemeral":true,"type":{"key":"integer","min":0,"max":"unlimited"}},"other_config":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"link_state":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["down","up"]]},"min":0}},"bfd":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"type":{"type":"string"},"duplex":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["full","half"]]},"min":0}},"options":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"cfm_fault":{"ephemeral":true,"type":{"key":"boolean","min":0}},"cfm_fault_status":{"ephemeral":true,"type":{"key":"string","min":0,"max":"unlimited"}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"cfm_flap_count":{"type":{"key":"integer","min":0}},"link_resets":{"ephemeral":true,"type":{"key":"integer","min":0}},"mac_in_use":{"ephemeral":true,"type":{"key":"string","min":0}},"statistics":{"ephemeral":true,"type":{"min":0,"key":"string","value":"integer","max":"unlimited"}},"bfd_status":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"error":{"type":{"key":"string","min":0}},"admin_state":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["down","up"]]},"min":0}},"name":{"mutable":false,"type":"string"},"ingress_policing_rate":{"type":{"key":{"type":"integer","minInteger":0}}},"mac":{"type":{"key":"string","min":0}},"cfm_remote_opstate":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["down","up"]]},"min":0}},"ifindex":{"ephemeral":true,"type":{"key":{"maxInteger":4294967295,"type":"integer","minInteger":0},"min":0}},"ingress_policing_burst":{"type":{"key":{"type":"integer","minInteger":0}}},"lldp":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"lacp_current":{"ephemeral":true,"type":{"key":"boolean","min":0}}},"indexes":[["name"]]},"Open_vSwitch":{"maxRows":1,"columns":{"ovs_version":{"type":{"key":"string","min":0}},"cur_cfg":{"type":"integer"},"ssl":{"type":{"key":{"type":"uuid","refTable":"SSL"},"min":0}},"iface_types":{"type":{"key":"string","min":0,"max":"unlimited"}},"manager_options":{"type":{"key":{"type":"uuid","refTable":"Manager"},"min":0,"max":"unlimited"}},"bridges":{"type":{"key":{"type":"uuid","refTable":"Bridge"},"min":0,"max":"unlimited"}},"system_version":{"type":{"key":"string","min":0}},"db_version":{"type":{"key":"string","min":0}},"datapath_types":{"type":{"key":"string","min":0,"max":"unlimited"}},"statistics":{"ephemeral":true,"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"next_cfg":{"type":"integer"},"other_config":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"system_type":{"type":{"key":"string","min":0}}},"isRoot":true},"Flow_Sample_Collector_Set":{"indexes":[["id","bridge"]],"columns":{"bridge":{"type":{"key":{"type":"uuid","refTable":"Bridge"}}},"ipfix":{"type":{"key":{"type":"uuid","refTable":"IPFIX"},"min":0}},"id":{"type":{"key":{"maxInteger":4294967295,"type":"integer","minInteger":0}}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}}},"isRoot":true},"SSL":{"maxRows":1,"columns":{"ca_cert":{"type":"string"},"certificate":{"type":"string"},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"bootstrap_ca_cert":{"type":"boolean"},"private_key":{"type":"string"}}},"sFlow":{"columns":{"agent":{"type":{"key":"string","min":0}},"polling":{"type":{"key":"integer","min":0}},"sampling":{"type":{"key":"integer","min":0}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"header":{"type":{"key":"integer","min":0}},"targets":{"type":{"key":"string","max":"unlimited"}}}},"QoS":{"columns":{"type":{"type":"string"},"queues":{"type":{"min":0,"key":{"maxInteger":4294967295,"type":"integer","minInteger":0},"value":{"type":"uuid","refTable":"Queue"},"max":"unlimited"}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"other_config":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}}},"isRoot":true},"Port":{"columns":{"bond_fake_iface":{"type":"boolean"},"interfaces":{"type":{"key":{"type":"uuid","refTable":"Interface"},"max":"unlimited"}},"fake_bridge":{"type":"boolean"},"tag":{"type":{"key":{"maxInteger":4095,"type":"integer","minInteger":0},"min":0}},"vlan_mode":{"type":{"key":{"type":"string","enum":["set",["access","native-tagged","native-untagged","trunk"]]},"min":0}},"trunks":{"type":{"key":{"maxInteger":4095,"type":"integer","minInteger":0},"min":0,"max":4096}},"status":{"ephemeral":true,"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"statistics":{"ephemeral":true,"type":{"min":0,"key":"string","value":"integer","max":"unlimited"}},"other_config":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"rstp_statistics":{"ephemeral":true,"type":{"min":0,"key":"string","value":"integer","max":"unlimited"}},"name":{"mutable":false,"type":"string"},"lacp":{"type":{"key":{"type":"string","enum":["set",["active","off","passive"]]},"min":0}},"mac":{"type":{"key":"string","min":0}},"bond_mode":{"type":{"key":{"type":"string","enum":["set",["active-backup","balance-slb","balance-tcp"]]},"min":0}},"qos":{"type":{"key":{"type":"uuid","refTable":"QoS"},"min":0}},"bond_updelay":{"type":"integer"},"bond_active_slave":{"type":{"key":"string","min":0}},"rstp_status":{"ephemeral":true,"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"bond_downdelay":{"type":"integer"}},"indexes":[["name"]]},"Flow_Table":{"columns":{"flow_limit":{"type":{"key":{"type":"integer","minInteger":0},"min":0}},"name":{"type":{"key":"string","min":0}},"groups":{"type":{"key":"string","min":0,"max":"unlimited"}},"overflow_policy":{"type":{"key":{"type":"string","enum":["set",["evict","refuse"]]},"min":0}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"prefixes":{"type":{"key":"string","min":0,"max":3}}}},"NetFlow":{"columns":{"active_timeout":{"type":{"key":{"type":"integer","minInteger":-1}}},"add_id_to_interface":{"type":"boolean"},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"engine_id":{"type":{"key":{"maxInteger":255,"type":"integer","minInteger":0},"min":0}},"targets":{"type":{"key":"string","max":"unlimited"}},"engine_type":{"type":{"key":{"maxInteger":255,"type":"integer","minInteger":0},"min":0}}}},"Bridge":{"columns":{"mcast_snooping_enable":{"type":"boolean"},"fail_mode":{"type":{"key":{"type":"string","enum":["set",["secure","standalone"]]},"min":0}},"auto_attach":{"type":{"key":{"type":"uuid","refTable":"AutoAttach"},"min":0}},"controller":{"type":{"key":{"type":"uuid","refTable":"Controller"},"min":0,"max":"unlimited"}},"flow_tables":{"type":{"min":0,"key":{"maxInteger":254,"type":"integer","minInteger":0},"value":{"type":"uuid","refTable":"Flow_Table"},"max":"unlimited"}},"datapath_version":{"type":"string"},"mirrors":{"type":{"key":{"type":"uuid","refTable":"Mirror"},"min":0,"max":"unlimited"}},"sflow":{"type":{"key":{"type":"uuid","refTable":"sFlow"},"min":0}},"ipfix":{"type":{"key":{"type":"uuid","refTable":"IPFIX"},"min":0}},"status":{"ephemeral":true,"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"other_config":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"stp_enable":{"type":"boolean"},"datapath_id":{"ephemeral":true,"type":{"key":"string","min":0}},"netflow":{"type":{"key":{"type":"uuid","refTable":"NetFlow"},"min":0}},"ports":{"type":{"key":{"type":"uuid","refTable":"Port"},"min":0,"max":"unlimited"}},"name":{"mutable":false,"type":"string"},"flood_vlans":{"type":{"key":{"maxInteger":4095,"type":"integer","minInteger":0},"min":0,"max":4096}},"protocols":{"type":{"key":{"type":"string","enum":["set",["OpenFlow10","OpenFlow11","OpenFlow12","OpenFlow13","OpenFlow14","OpenFlow15"]]},"min":0,"max":"unlimited"}},"rstp_enable":{"type":"boolean"},"rstp_status":{"ephemeral":true,"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"external_ids":{"type":{"min":0,"key":"string","value":"string","max":"unlimited"}},"datapath_type":{"type":"string"}},"indexes":[["name"]]}},"cksum":"2211824403 22535","version":"7.12.1"}, id=0
2015-05-01T06:40:04Z|00014|hmap|DBG|lib/sset.c:53: 6 nodes in bucket (8 nodes, 4 buckets)
2015-05-01T06:40:04Z|00015|jsonrpc|DBG|unix:/usr/local/var/run/openvswitch/db.sock: send request, method="monitor", params=["Open_vSwitch",null,{"IPFIX":{"columns":["cache_active_timeout","cache_max_flows","obs_domain_id","obs_point_id","other_config","sampling","targets"]},"Mirror":{"columns":["name","output_port","output_vlan","select_all","select_dst_port","select_src_port","select_vlan","statistics"]},"Manager":{"columns":["connection_mode","other_config","target"]},"AutoAttach":{"columns":["mappings","system_description","system_name"]},"Controller":{"columns":["connection_mode","controller_burst_limit","controller_rate_limit","enable_async_messages","inactivity_probe","is_connected","local_gateway","local_ip","local_netmask","max_backoff","other_config","role","status","target"]},"Interface":{"columns":["admin_state","bfd","bfd_status","cfm_fault","cfm_fault_status","cfm_flap_count","cfm_health","cfm_mpid","cfm_remote_mpids","cfm_remote_opstate","duplex","error","ifindex","ingress_policing_burst","ingress_policing_rate","lacp_current","link_resets","link_speed","link_state","lldp","mac","mac_in_use","mtu","name","ofport","ofport_request","options","other_config","statistics","status","type"]},"Open_vSwitch":{"columns":["bridges","cur_cfg","datapath_types","iface_types","manager_options","next_cfg","other_config","ssl","statistics"]},"Queue":{"columns":["dscp","other_config"]},"Flow_Sample_Collector_Set":{"columns":["bridge","id","ipfix"]},"SSL":{"columns":["bootstrap_ca_cert","ca_cert","certificate","private_key"]},"sFlow":{"columns":["agent","header","polling","sampling","targets"]},"Port":{"columns":["bond_active_slave","bond_downdelay","bond_fake_iface","bond_mode","bond_updelay","fake_bridge","interfaces","lacp","mac","name","other_config","qos","rstp_statistics","rstp_status","statistics","status","tag","trunks","vlan_mode"]},"QoS":{"columns":["other_config","queues","type"]},"Flow_Table":{"columns":["external_ids","flow_limit","groups","name","overflow_policy","prefixes"]},"NetFlow":{"columns":["active_timeout","add_id_to_interface","engine_id","engine_type","targets"]},"Bridge":{"columns":["auto_attach","controller","datapath_id","datapath_type","datapath_version","fail_mode","flood_vlans","flow_tables","ipfix","mcast_snooping_enable","mirrors","name","netflow","other_config","ports","protocols","rstp_enable","rstp_status","sflow","status","stp_enable"]}}], id=2
2015-05-01T06:40:04Z|00016|jsonrpc|DBG|unix:/usr/local/var/run/openvswitch/db.sock: received reply, result={"locked":true}, id=1
2015-05-01T06:40:04Z|00017|timeval|WARN|Unreasonably long 1344ms poll interval (10ms user, 0ms system)
2015-05-01T06:40:04Z|00018|timeval|WARN|faults: 67 minor, 0 major
2015-05-01T06:40:04Z|00019|timeval|WARN|context switches: 4 voluntary, 0 involuntary
2015-05-01T06:40:04Z|00020|coverage|INFO|Event coverage, avg rate over last: 5 seconds, last minute, last hour,  hash=803065a0:
2015-05-01T06:40:04Z|00021|coverage|INFO|util_xalloc                0.0/sec     0.000/sec        0.0000/sec   total: 6431
2015-05-01T06:40:04Z|00022|coverage|INFO|stream_open                0.0/sec     0.000/sec        0.0000/sec   total: 1
2015-05-01T06:40:04Z|00023|coverage|INFO|pstream_open               0.0/sec     0.000/sec        0.0000/sec   total: 1
2015-05-01T06:40:04Z|00024|coverage|INFO|poll_create_node           0.0/sec     0.000/sec        0.0000/sec   total: 18
2015-05-01T06:40:04Z|00025|coverage|INFO|hmap_expand                0.0/sec     0.000/sec        0.0000/sec   total: 343
2015-05-01T06:40:04Z|00026|coverage|INFO|hmap_pathological          0.0/sec     0.000/sec        0.0000/sec   total: 2
2015-05-01T06:40:04Z|00027|coverage|INFO|93 events never hit
2015-05-01T06:40:04Z|00028|poll_loop|DBG|wakeup due to [POLLIN] on fd 13 (<->/usr/local/var/run/openvswitch/db.sock) at lib/stream-fd.c:155
2015-05-01T06:40:04Z|00029|hmap|DBG|lib/shash.c:112: 6 nodes in bucket (8 nodes, 4 buckets)
2015-05-01T06:40:04Z|00030|jsonrpc|DBG|unix:/usr/local/var/run/openvswitch/db.sock: received reply, result={"Port":{"7c820f25-8538-4240-8d0a-db153d132cf8":{"new":{"bond_fake_iface":false,"fake_bridge":false,"interfaces":["uuid","1b87f8e9-8c5b-4a56-be1f-3e0e83cb9859"],"tag":["set",[]],"trunks":["set",[]],"vlan_mode":["set",[]],"status":["map",[]],"statistics":["map",[]],"other_config":["map",[]],"rstp_statistics":["map",[]],"name":"br0","lacp":["set",[]],"mac":["set",[]],"bond_mode":["set",[]],"rstp_status":["map",[]],"bond_active_slave":["set",[]],"bond_updelay":0,"qos":["set",[]],"bond_downdelay":0}}},"Controller":{"dee80e50-dcc7-4759-b157-293a38e6a8e5":{"new":{"controller_rate_limit":["set",[]],"max_backoff":["set",[]],"target":"tcp:192.168.222.100:6633","is_connected":false,"local_netmask":["set",[]],"role":["set",[]],"local_gateway":["set",[]],"enable_async_messages":["set",[]],"status":["map",[]],"connection_mode":["set",[]],"controller_burst_limit":["set",[]],"local_ip":["set",[]],"inactivity_probe":["set",[]],"other_config":["map",[]]}}},"Interface":{"1b87f8e9-8c5b-4a56-be1f-3e0e83cb9859":{"new":{"link_resets":["set",[]],"cfm_mpid":["set",[]],"ofport_request":["set",[]],"cfm_health":["set",[]],"ofport":["set",[]],"link_speed":["set",[]],"mac_in_use":["set",[]],"status":["map",[]],"statistics":["map",[]],"mtu":["set",[]],"error":["set",[]],"bfd_status":["map",[]],"link_state":["set",[]],"other_config":["map",[]],"cfm_remote_mpids":["set",[]],"bfd":["map",[]],"type":"internal","duplex":["set",[]],"admin_state":["set",[]],"name":"br0","ingress_policing_rate":0,"mac":["set",[]],"cfm_remote_opstate":["set",[]],"cfm_fault":["set",[]],"options":["map",[]],"cfm_fault_status":["set",[]],"ifindex":["set",[]],"ingress_policing_burst":0,"lldp":["map",[]],"cfm_flap_count":["set",[]],"lacp_current":["set",[]]}}},"Open_vSwitch":{"57928703-e317-4e71-b9b4-d98352c44701":{"new":{"cur_cfg":3,"ssl":["set",[]],"iface_types":["set",["geneve","gre","gre64","internal","ipsec_gre","ipsec_gre64","lisp","patch","system","tap","vxlan"]],"manager_options":["set",[]],"bridges":["uuid","2def7b08-6cdc-4d8f-a739-f578005038a7"],"statistics":["map",[]],"datapath_types":["set",["netdev","system"]],"next_cfg":5,"other_config":["map",[]]}}},"Bridge":{"2def7b08-6cdc-4d8f-a739-f578005038a7":{"new":{"fail_mode":["set",[]],"mcast_snooping_enable":false,"auto_attach":["set",[]],"controller":["uuid","dee80e50-dcc7-4759-b157-293a38e6a8e5"],"datapath_version":"","flow_tables":["map",[]],"mirrors":["set",[]],"sflow":["set",[]],"ipfix":["set",[]],"status":["map",[]],"other_config":["map",[]],"stp_enable":false,"datapath_id":["set",[]],"netflow":["set",[]],"name":"br0","ports":["uuid","7c820f25-8538-4240-8d0a-db153d132cf8"],"flood_vlans":["set",[]],"protocols":["set",[]],"rstp_enable":false,"rstp_status":["map",[]],"datapath_type":""}}}}, id=2
2015-05-01T06:40:04Z|00035|netlink_socket|DBG|nl_sock_send__ (Success): nl(len:21, type=26(family-defined), flags=305[REQUEST][ACK][DUMP], seq=1, pid=4294963142
2015-05-01T06:40:04Z|00036|netlink_socket|DBG|nl_sock_recv__ (Success): nl(len:56, type=24(family-defined), flags=2[MULTI], seq=1, pid=4294963142
2015-05-01T06:40:04Z|00037|netlink_socket|DBG|nl_sock_recv__ (Success): nl(len:24, type=3(done), flags=2[MULTI], seq=1, pid=4294963142 done(0)
2015-05-01T06:40:04Z|00038|ofproto|ERR|ofproto_create:478:: FORTI_OVSDB ...datapath_type=system
2015-05-01T06:40:04Z|00039|netlink_socket|DBG|nl_sock_transact_multiple__ (Success): nl(len:44, type=16(control), flags=1[REQUEST], seq=1, pid=1530,genl(cmd=3,version=1)
2015-05-01T06:40:04Z|00040|netlink_socket|DBG|nl_sock_recv__ (Success): nl(len:68, type=2(error), flags=0, seq=1, pid=1530 error(-2(No such file or directory), in-reply-to(nl(len:44, type=16(control), flags=1[REQUEST], seq=1, pid=1530))
2015-05-01T06:40:04Z|00041|netlink_socket|DBG|received NAK error=0 (No such file or directory)
2015-05-01T06:40:04Z|00042|dpif_netlink|ERR|Generic Netlink family 'ovs_datapath' does not exist. The Open vSwitch kernel module is probably not loaded.
2015-05-01T06:40:04Z|00043|dpif|WARN|failed to enumerate system datapaths: No such file or directory
2015-05-01T06:40:04Z|00044|dpif|WARN|failed to create datapath ovs-system: No such file or directory
2015-05-01T06:40:04Z|00045|ofproto_dpif|ERR|failed to open datapath of type system: No such file or directory
2015-05-01T06:40:04Z|00046|ofproto|ERR|LINE:543: failed to open datapath br0: No such file or directory
2015-05-01T06:40:05Z|00066|connmgr|INFO|br0: added service controller "punix:/usr/local/var/run/openvswitch/br0.mgmt"
2015-05-01T06:40:05Z|00067|connmgr|INFO|br0: added primary controller "tcp:192.168.222.100:6633"
2015-05-01T06:40:05Z|00068|rconn|INFO|br0<->tcp:192.168.222.100:6633: connecting...
2015-05-01T06:40:05Z|00069|rconn|DBG|br0<->tcp:192.168.222.100:6633: entering CONNECTING
2015-05-01T06:40:05Z|00070|socket_util_unix|DBG|br0: ioctl(SIOCGIFFLAGS) failed: No such device
2015-05-01T06:40:05Z|00001|daemon_unix|ERR|fork child died before signaling startup (killed (Segmentation fault))
ovs-vswitchd: could not detach from foreground session

From haleema.s.mahmood at gmail.com  Sat May  2 05:11:30 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Sat, 2 May 2015 17:11:30 +0500
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <20150501225759.GA2889@nicira.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
Message-ID: <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>

Hi Ben,

Thanks for your response!

The ovs-vswitchd log shows shows no error and neither does it says anything
about the queue creation. Is that fine? However, I do get the qos id and
the queue id when I create them.

On Sat, May 2, 2015 at 3:57 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia Mahmood wrote:
> > So I am trying to configure queues on a mininet topology. The command
> that I use is, (here s1-eth1 is my port 1)
> >
> > sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  - -id=@newqos create
> qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create queue
> other-config:max-rate=100000000 other-config:min-rate=5000000 - -
> >
> > The qos is attached to the port, checked it from sudo ovs-vsctl list
> port s1-eth1, and the queues are created.
>
> Probably the queues aren't really created.  Check the ovs-vswitchd log
> for error messages.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150502/f0ebd46e/attachment-0001.html>

From haleema.s.mahmood at gmail.com  Sat May  2 09:20:19 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Sat, 2 May 2015 09:20:19 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <20150502161704.GA19570@nicira.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
Message-ID: <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>

It says:

qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2 1 2 0 0
1 1 1 1 1 1 1 1


On Sat, May 2, 2015 at 9:17 AM, Ben Pfaff <blp at nicira.com> wrote:

> Check whether the kernel shows the qdisc being configured: "tc qdisc
> show".
>
> On Sat, May 02, 2015 at 05:11:30PM +0500, Haleema Sadia wrote:
> > Hi Ben,
> >
> > Thanks for your response!
> >
> > The ovs-vswitchd log shows shows no error and neither does it says
> anything
> > about the queue creation. Is that fine? However, I do get the qos id and
> > the queue id when I create them.
> >
> > On Sat, May 2, 2015 at 3:57 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia Mahmood wrote:
> > > > So I am trying to configure queues on a mininet topology. The command
> > > that I use is, (here s1-eth1 is my port 1)
> > > >
> > > > sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  - -id=@newqos create
> > > qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create queue
> > > other-config:max-rate=100000000 other-config:min-rate=5000000 - -
> > > >
> > > > The qos is attached to the port, checked it from sudo ovs-vsctl list
> > > port s1-eth1, and the queues are created.
> > >
> > > Probably the queues aren't really created.  Check the ovs-vswitchd log
> > > for error messages.
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150502/e8ffe56a/attachment-0001.html>

From haleema.s.mahmood at gmail.com  Sat May  2 09:58:34 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Sat, 2 May 2015 09:58:34 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <20150502163330.GB19570@nicira.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
 <20150502163330.GB19570@nicira.com>
Message-ID: <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>

My mininet wasn't working before when I type the command, but I restarted
it and now the command shows this:

qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2 1 2 0 0
1 1 1 1 1 1 1 1
qdisc htb 5: dev s1-eth1 root refcnt 2 r2q 10 default 1 direct_packets_stat
0 direct_qlen 1000
qdisc netem 10: dev s1-eth1 parent 5:1 limit 1000 delay 99us
qdisc htb 5: dev s1-eth2 root refcnt 2 r2q 10 default 1 direct_packets_stat
0 direct_qlen 1000
qdisc netem 10: dev s1-eth2 parent 5:1 limit 1000 delay 99us
qdisc htb 5: dev s1-eth3 root refcnt 2 r2q 10 default 1 direct_packets_stat
0 direct_qlen 1000
qdisc netem 10: dev s1-eth3 parent 5:1 limit 1000 delay 99us

(the topology is one switch and three hosts)

And I am attaching my kern.log



On Sat, May 2, 2015 at 9:33 AM, Ben Pfaff <blp at nicira.com> wrote:

> OK, the linux-htb qdisc isn't really getting configured.  We'll have to
> figure out why.
>
> Is the htb kernel module loaded?  Is there anything in the kernel log
> related to htb?
>
> On Sat, May 02, 2015 at 09:20:19AM -0700, Haleema Sadia wrote:
> > It says:
> >
> > qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2 1 2
> 0 0
> > 1 1 1 1 1 1 1 1
> >
> >
> > On Sat, May 2, 2015 at 9:17 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > Check whether the kernel shows the qdisc being configured: "tc qdisc
> > > show".
> > >
> > > On Sat, May 02, 2015 at 05:11:30PM +0500, Haleema Sadia wrote:
> > > > Hi Ben,
> > > >
> > > > Thanks for your response!
> > > >
> > > > The ovs-vswitchd log shows shows no error and neither does it says
> > > anything
> > > > about the queue creation. Is that fine? However, I do get the qos id
> and
> > > > the queue id when I create them.
> > > >
> > > > On Sat, May 2, 2015 at 3:57 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia Mahmood
> wrote:
> > > > > > So I am trying to configure queues on a mininet topology. The
> command
> > > > > that I use is, (here s1-eth1 is my port 1)
> > > > > >
> > > > > > sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  - -id=@newqos
> create
> > > > > qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create queue
> > > > > other-config:max-rate=100000000 other-config:min-rate=5000000 - -
> > > > > >
> > > > > > The qos is attached to the port, checked it from sudo ovs-vsctl
> list
> > > > > port s1-eth1, and the queues are created.
> > > > >
> > > > > Probably the queues aren't really created.  Check the ovs-vswitchd
> log
> > > > > for error messages.
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150502/46039899/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kern.log
Type: application/octet-stream
Size: 137884 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150502/46039899/attachment-0001.obj>

From haleema.s.mahmood at gmail.com  Sat May  2 10:17:19 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Sat, 2 May 2015 10:17:19 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <20150502171628.GF19570@nicira.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
 <20150502163330.GB19570@nicira.com>
 <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>
 <20150502171628.GF19570@nicira.com>
Message-ID: <CAN-u-63Dxz0itOJiMN7sixnFVPgiSnUJ6n4EvM6A+mERRg2whg@mail.gmail.com>

Here it is!

On Sat, May 2, 2015 at 10:16 AM, Ben Pfaff <blp at nicira.com> wrote:

> Can you provide the ovs-vswitchd log?
>
> On Sat, May 02, 2015 at 09:58:34AM -0700, Haleema Sadia wrote:
> > My mininet wasn't working before when I type the command, but I restarted
> > it and now the command shows this:
> >
> > qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2 1 2
> 0 0
> > 1 1 1 1 1 1 1 1
> > qdisc htb 5: dev s1-eth1 root refcnt 2 r2q 10 default 1
> direct_packets_stat
> > 0 direct_qlen 1000
> > qdisc netem 10: dev s1-eth1 parent 5:1 limit 1000 delay 99us
> > qdisc htb 5: dev s1-eth2 root refcnt 2 r2q 10 default 1
> direct_packets_stat
> > 0 direct_qlen 1000
> > qdisc netem 10: dev s1-eth2 parent 5:1 limit 1000 delay 99us
> > qdisc htb 5: dev s1-eth3 root refcnt 2 r2q 10 default 1
> direct_packets_stat
> > 0 direct_qlen 1000
> > qdisc netem 10: dev s1-eth3 parent 5:1 limit 1000 delay 99us
> >
> > (the topology is one switch and three hosts)
> >
> > And I am attaching my kern.log
> >
> >
> >
> > On Sat, May 2, 2015 at 9:33 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > OK, the linux-htb qdisc isn't really getting configured.  We'll have to
> > > figure out why.
> > >
> > > Is the htb kernel module loaded?  Is there anything in the kernel log
> > > related to htb?
> > >
> > > On Sat, May 02, 2015 at 09:20:19AM -0700, Haleema Sadia wrote:
> > > > It says:
> > > >
> > > > qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2
> 1 2
> > > 0 0
> > > > 1 1 1 1 1 1 1 1
> > > >
> > > >
> > > > On Sat, May 2, 2015 at 9:17 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > Check whether the kernel shows the qdisc being configured: "tc
> qdisc
> > > > > show".
> > > > >
> > > > > On Sat, May 02, 2015 at 05:11:30PM +0500, Haleema Sadia wrote:
> > > > > > Hi Ben,
> > > > > >
> > > > > > Thanks for your response!
> > > > > >
> > > > > > The ovs-vswitchd log shows shows no error and neither does it
> says
> > > > > anything
> > > > > > about the queue creation. Is that fine? However, I do get the
> qos id
> > > and
> > > > > > the queue id when I create them.
> > > > > >
> > > > > > On Sat, May 2, 2015 at 3:57 AM, Ben Pfaff <blp at nicira.com>
> wrote:
> > > > > >
> > > > > > > On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia Mahmood
> > > wrote:
> > > > > > > > So I am trying to configure queues on a mininet topology. The
> > > command
> > > > > > > that I use is, (here s1-eth1 is my port 1)
> > > > > > > >
> > > > > > > > sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  -
> -id=@newqos
> > > create
> > > > > > > qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create queue
> > > > > > > other-config:max-rate=100000000 other-config:min-rate=5000000
> - -
> > > > > > > >
> > > > > > > > The qos is attached to the port, checked it from sudo
> ovs-vsctl
> > > list
> > > > > > > port s1-eth1, and the queues are created.
> > > > > > >
> > > > > > > Probably the queues aren't really created.  Check the
> ovs-vswitchd
> > > log
> > > > > > > for error messages.
> > > > > > >
> > > > >
> > >
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150502/a0404c9f/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ovs-vswitchd.log
Type: application/octet-stream
Size: 35188 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150502/a0404c9f/attachment-0001.obj>

From actionmystique at gmail.com  Sun May  3 10:37:16 2015
From: actionmystique at gmail.com (jean-christophe manciot)
Date: Sun, 3 May 2015 19:37:16 +0200
Subject: [ovs-discuss] Cannot add a port to a created bridge
Message-ID: <CAKcFC3aCvRwuqup2U1GCESTvOpzt5XaQD=PiJ8x3apL09CEhPw@mail.gmail.com>

Hello guys,

I've manually compiled and installed openvswitch from the git sources,
following all the installation procedures from the install.md file, with
one exception:
I've replaced the last line of the step 6 with:
ovsdb-tool create /usr/local/etc/openvswitch/conf.db
/usr/local/share/openvswitch/vswitch.ovsschema

All the steps have been successfully completed, except the last one:
*ovs-vsctl add-br ovsbr0*
*ovs-vsctl add-port ovsbr0 eth0*
*ovs-vsctl: Error detected while setting up 'eth0'.  See ovs-vswitchd log
for details*

Unfortunately, no log file has been created so what is going on?
-- 
Jean-Christophe Manciot
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150503/ba40bc3a/attachment.html>

From blp at nicira.com  Sun May  3 11:18:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 3 May 2015 11:18:24 -0700
Subject: [ovs-discuss] ovs-vswitchd crash while setting up controller IP
In-Reply-To: <CAKv4ra_4g7eTU50_7ASzWDguDCnP7D5AwCfpYcAieYNxJx9Fwg@mail.gmail.com>
References: <CAKv4ra_4g7eTU50_7ASzWDguDCnP7D5AwCfpYcAieYNxJx9Fwg@mail.gmail.com>
Message-ID: <20150503181824.GC20763@nicira.com>

On Fri, May 01, 2015 at 12:58:58PM -0700, Vipin Garg wrote:
> I added a bridge (br0) in my physical switch Linux kernel...  and set the
> controller IP address as
>    ovs-vsctl set-controller 192.168.222.100:6633.
> 
> Just to make it clear, my controller is running on a separate machine ..On
> the switch, ovs-vsctl show following --
> 
> # ./ovs-vsctl show
> 57928703-e317-4e71-b9b4-d98352c44701
>     Bridge "br0"
>         Controller "tcp:192.168.222.100:6633"
>         Port "br0"
>             Interface "br0"
>                 type: internal
> 
> Now, when I start ovs-vswitchd, it crash with segmentation fault (see
> attached logs for more detail ...)

The logs contain messages that appear uncharacteristic of upstream OVS.
Are you using a modified OVS?  Does the crash appear with unmodified
OVS?

From blp at nicira.com  Sun May  3 11:19:23 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 3 May 2015 11:19:23 -0700
Subject: [ovs-discuss] Cannot add a port to a created bridge
In-Reply-To: <CAKcFC3aCvRwuqup2U1GCESTvOpzt5XaQD=PiJ8x3apL09CEhPw@mail.gmail.com>
References: <CAKcFC3aCvRwuqup2U1GCESTvOpzt5XaQD=PiJ8x3apL09CEhPw@mail.gmail.com>
Message-ID: <20150503181923.GD20763@nicira.com>

On Sun, May 03, 2015 at 07:37:16PM +0200, jean-christophe manciot wrote:
> I've manually compiled and installed openvswitch from the git sources,
> following all the installation procedures from the install.md file, with
> one exception:
> I've replaced the last line of the step 6 with:
> ovsdb-tool create /usr/local/etc/openvswitch/conf.db
> /usr/local/share/openvswitch/vswitch.ovsschema
> 
> All the steps have been successfully completed, except the last one:
> *ovs-vsctl add-br ovsbr0*
> *ovs-vsctl add-port ovsbr0 eth0*
> *ovs-vsctl: Error detected while setting up 'eth0'.  See ovs-vswitchd log
> for details*
> 
> Unfortunately, no log file has been created so what is going on?

You'll need to look in the log.  Try syslog if you didn't configure a
log file.

From daniel.dehennin at baby-gnu.org  Mon May  4 02:50:58 2015
From: daniel.dehennin at baby-gnu.org (Daniel Dehennin)
Date: Mon, 04 May 2015 11:50:58 +0200
Subject: [ovs-discuss] Network issue with spanning-tree
In-Reply-To: <87lhhh5kvh.fsf@hati.baby-gnu.org> (Daniel Dehennin's message of
 "Fri, 24 Apr 2015 22:31:14 +0200")
References: <87lhhh5kvh.fsf@hati.baby-gnu.org>
Message-ID: <877fso4qnx.fsf@hati.baby-gnu.org>

Daniel Dehennin <daniel.dehennin at baby-gnu.org> writes:

> Hello,

Hello,


> We are experimenting network issues each time we start a new VM.
>
> The other VMs have their network blocked until I see “a topology change
> is detected” in Open vSwitch logs.
>
> Do you have any advice for such configuration?

It seems that there is no fast spanning tree in Open vSwitch[1].

I'm wondering if I need spanning tree at the first place.

Looking at a web article “Setting Up Overlays on Open vSwitch”[2], the
author setup a full mesh configuration but does not use spanning-tree to
prevent loop.

Maybe the solution is in the created flows, which looks like magical
incantation to me?

Regards.

Footnotes: 
[1]  http://openvswitch.org/features/

[2]  http://networkstatic.net/setting-overlays-open-vswitch/

-- 
Daniel Dehennin
Récupérer ma clef GPG: gpg --recv-keys 0xCC1E9E5B7A6FE2DF
Fingerprint: 3E69 014E 5C23 50E8 9ED6  2AAD CC1E 9E5B 7A6F E2DF
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 342 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/c1970f7f/attachment.sig>

From Gergely.Pongracz at ericsson.com  Mon May  4 02:59:51 2015
From: Gergely.Pongracz at ericsson.com (Gergely Pongracz)
Date: Mon, 4 May 2015 11:59:51 +0200
Subject: [ovs-discuss] Fwd: [Dpdk-ovs] scalability issues
In-Reply-To: <554742AC.9090805@ericsson.com>
References: <554742AC.9090805@ericsson.com>
Message-ID: <55474317.6020900@ericsson.com>

Hi,

We ran into some issues using the DPDK based OVS switch (2.3.90). We 
used pktgen for traffic generation.

*1. Multiple flows -> degrading performance*

Everything looks nice, but when we generate multiple flows with 
different MAC addresses the switch performance drops. On an Intel Atom 
system the packet rate was dropping from 4 Mpps to 2 Mpps when 
increasing the number of flows to 10.

*2. Set Queue -> severe performance degradation*

After setting a queue, irrespectively of the bandwidth limit set the 
performance drops to ~1.5 Mpps on a Xeon machine (from ~10 Mpps - we use 
only 1 core for the given port)

Any ideas?
If you need more data, let me know.
Thanks!

Gergely



From jgao at Hillstonenet.com  Mon May  4 03:05:49 2015
From: jgao at Hillstonenet.com (=?gb2312?B?SmllIEdhbyi4373cKQ==?=)
Date: Mon, 4 May 2015 10:05:49 +0000
Subject: [ovs-discuss] abuto ovs support qinq
Message-ID: <0463889CE2226041953756FDBB1F6DB6A057CD16@MAIL1.Hillstonenet.com>

Who have the solution, please share it, thank you
The information contained in this e-mail message (and any attachment transmitted herewith) is privileged and confidential and is intended for the exclusive use of the addressee(s). If you are not an intended addressee, any disclosure, reproduction, distribution or other dissemination or use of this communication is strictly prohibited. If you have received this communication in error, please delete this communication and contact us by replying to this e-mail immediately.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/6b7c554f/attachment.html>

From diproiettod at vmware.com  Mon May  4 03:43:13 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Mon, 4 May 2015 11:43:13 +0100
Subject: [ovs-discuss] Fwd: [Dpdk-ovs] scalability issues
In-Reply-To: <55474317.6020900@ericsson.com>
References: <554742AC.9090805@ericsson.com> <55474317.6020900@ericsson.com>
Message-ID: <DF6750CB-8C5C-4C86-A646-CEB9ED948870@vmware.com>


> On 4 May 2015, at 10:59, Gergely Pongracz <Gergely.Pongracz at ericsson.com> wrote:
> 
> Hi,
> 
> We ran into some issues using the DPDK based OVS switch (2.3.90). We used pktgen for traffic generation.

Hi Gergely,

thanks for sharing these results

> *1. Multiple flows -> degrading performance*
> 
> Everything looks nice, but when we generate multiple flows with different MAC addresses the switch performance drops. On an Intel Atom system the packet rate was dropping from 4 Mpps to 2 Mpps when increasing the number of flows to 10.

There are some patches that (I hope) should improve
the throughput in these scenarios.  You might give them
a try or wait until they get merged (the series is at
http://openvswitch.org/pipermail/dev/2015-April/054553.html)

> *2. Set Queue -> severe performance degradation*
> 
> After setting a queue, irrespectively of the bandwidth limit set the performance drops to ~1.5 Mpps on a Xeon machine (from ~10 Mpps - we use only 1 core for the given port)
> 

QoS is not supported (yet) in the userspace datapath
(used with DPDK devices).  Can you share the commands that
you're using?

Daniele

From jgao at Hillstonenet.com  Mon May  4 04:39:50 2015
From: jgao at Hillstonenet.com (=?gb2312?B?SmllIEdhbyi4373cKQ==?=)
Date: Mon, 4 May 2015 11:39:50 +0000
Subject: [ovs-discuss] Do you support Q-in-Q(802.1ad) or have any plans?
Message-ID: <0463889CE2226041953756FDBB1F6DB6A057CDE7@MAIL1.Hillstonenet.com>

How will the new QinQ patch update, thank you
The information contained in this e-mail message (and any attachment transmitted herewith) is privileged and confidential and is intended for the exclusive use of the addressee(s). If you are not an intended addressee, any disclosure, reproduction, distribution or other dissemination or use of this communication is strictly prohibited. If you have received this communication in error, please delete this communication and contact us by replying to this e-mail immediately.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/9ad34364/attachment-0001.html>

From frankzfz at 163.com  Mon May  4 05:36:23 2015
From: frankzfz at 163.com (frankzfz)
Date: Mon, 4 May 2015 20:36:23 +0800 (CST)
Subject: [ovs-discuss] =?gbk?q?SKB_is_modified_42_bytes_in_ovs_module?=
 =?gbk?b?o6FoZWxwo6E=?=
In-Reply-To: <CAEP_g=86o3g8odFa4jOUmiutzdLanBOH-WBNGYSaMJqXZjCW6Q@mail.gmail.com>
References: <7c2c0171.1b0ed.14cd645be62.Coremail.frankzfz@163.com>
 <CAEP_g=-6_MFznLiHDGdDdGCbS_ZM4t3Ex4NRroE8Q1Fqhod+VQ@mail.gmail.com>
 <3874da1.12220.14cdefdeaf8.Coremail.wenx05124561@163.com>
 <CAEP_g=86o3g8odFa4jOUmiutzdLanBOH-WBNGYSaMJqXZjCW6Q@mail.gmail.com>
Message-ID: <4572e25e.160d3.14d1eed6185.Coremail.frankzfz@163.com>

                                                                     Figure 1 Sender side



                                                                                                             Figure 2 Receiver side
The VM sends a packet with 1500 bytes and the ovs will encapsulate the packet with gre tunnel and the packet length will larger than 1500,On the sender side, the  packet will be fragment to 2 packets,as shown in figure 1,The size of the two packets of (data load)1406 and 42 respectively, On the receiver side we find the last 42 bytes(user data) of the second packet was tampered by linux ovs.Please check the contents of the red box in the figure.







At 2015-04-22 10:53:27, "Jesse Gross" <jesse at nicira.com> wrote:
>On Tue, Apr 21, 2015 at 7:38 PM, wenxu <wenx05124561 at 163.com> wrote:
>>
>>>What does it mean that the packet is modified? What specifically happens?
>>
>> The VM sends a packet with 1500 bytes and the ovs will encapsulate the
>> packet with gre tunnel and the packet length will larger than 1500. So the
>> packet will be fragment to 2 packets. On the receiver side we find the last
>> 42 bytes(user data) of the second packet was tampered by linux os.
>>
>> I think it's a matter with ovs and reassembly in linux kernel.  if we set
>> the mtu of VM to 1458, the problem is gone.
>
>You'll need to be specific about what happens to the second fragment.
>Otherwise, there is no way for people to know where to start looking.
>It would also be helpful if you look at the fragments on the wire to
>see if anything unusual is happening (same IP IDs?).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/05dcbf44/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2222.png
Type: image/png
Size: 70076 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/05dcbf44/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 3333.png
Type: image/png
Size: 74718 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/05dcbf44/attachment-0003.png>

From blp at nicira.com  Mon May  4 09:39:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 4 May 2015 09:39:43 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <CAN-u-60H0pwCqUGPOBZ9iOyXDdU1Rw4r7mj6rrkWXOtMwSLj6A@mail.gmail.com>
References: <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
 <20150502163330.GB19570@nicira.com>
 <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>
 <20150502171628.GF19570@nicira.com>
 <CAN-u-63Dxz0itOJiMN7sixnFVPgiSnUJ6n4EvM6A+mERRg2whg@mail.gmail.com>
 <20150502172506.GG19570@nicira.com>
 <CAN-u-60H0pwCqUGPOBZ9iOyXDdU1Rw4r7mj6rrkWXOtMwSLj6A@mail.gmail.com>
Message-ID: <20150504163943.GA19660@nicira.com>

On Mon, May 04, 2015 at 05:22:24PM +0500, Haleema Sadia wrote:
> The issue is resolved now.. I was setting up the bandwidth and delay
> variable in the mininet custom topology that I created. Once I removed them
> the queues starting working. However, if I have different min/max rate for
> the queues the min rate threshold is not maintained.
> 
> For ex, if min-rate is 4 Megabit and I specify the udp packet rate to be 3
> Megabit, the bandwidth on the server side(where the queue is being
> maintained) for iperf goes to 3 Megabit.
> 
> Do you have any idea why?

It's hard for me to understand exactly what you're asking, but this FAQ
might help.

### Q: I configured QoS, correctly, but my measurements show that it isn't
   working as well as I expect.

A: With the Linux kernel, the Open vSwitch implementation of QoS has
   two aspects:

   - Open vSwitch configures a subset of Linux kernel QoS
     features, according to what is in OVSDB.  It is possible that
     this code has bugs.  If you believe that this is so, then you
     can configure the Linux traffic control (QoS) stack directly
     with the "tc" program.  If you get better results that way,
     you can send a detailed bug report to bugs at openvswitch.org.

     It is certain that Open vSwitch cannot configure every Linux
     kernel QoS feature.  If you need some feature that OVS cannot
     configure, then you can also use "tc" directly (or add that
     feature to OVS).

   - The Open vSwitch implementation of OpenFlow allows flows to
     be directed to particular queues.  This is pretty simple and
     unlikely to have serious bugs at this point.

   However, most problems with QoS on Linux are not bugs in Open
   vSwitch at all.  They tend to be either configuration errors
   (please see the earlier questions in this section) or issues with
   the traffic control (QoS) stack in Linux.  The Open vSwitch
   developers are not experts on Linux traffic control.  We suggest
   that, if you believe you are encountering a problem with Linux
   traffic control, that you consult the tc manpages (e.g. tc(8),
   tc-htb(8), tc-hfsc(8)), web resources (e.g. http://lartc.org/), or
   mailing lists (e.g. http://vger.kernel.org/vger-lists.html#netdev).

From sankets.raut at gmail.com  Sun May  3 19:40:58 2015
From: sankets.raut at gmail.com (sanket raut)
Date: Sun, 3 May 2015 22:40:58 -0400
Subject: [ovs-discuss] About open flow flow entries ( dl_dst error ( Invalid
	Ethernet address))
Message-ID: <CACcRUixe_4U1DpHL7+WmhXDCnXoLMc3VKOaVVpkeq4wdGE1Trw@mail.gmail.com>

Hello,
My topology is as follows and I am implementing vxlan on both openvswitches
in mininet.
I had configured my tunneling end point as s1-vtep and s2-vtep.
I had used pingall command to check network connectivity, and network is
able to ping all hosts.
When I give my manual-flows by  sh ovs-ofctl add-flows s1 s1text.txt
It gives me error in dl_dst command that Ethernet address is invalid.
But it is valid mac address I'm specifying as per topology.
I'm not able to figure out what are the problem associated with dl_dst
command, and I had followed
http://openvswitch.org/support/dist-docs/ovs-ofctl.8.txt rules to define my
flow table.
I had attached my python script and flow files along with this email.
So, could you please help me with the same.

[image: Inline image 2]




-- 
With Regards,

*Sanket*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150503/96b195a5/attachment-0001.html>
-------------- next part --------------
table=0,in_port=1,actions=set_field:100->tun_id,resubmit(,1)
table=0,in_port=2,actions=set_field:200->tun_id,resubmit(,1)
table=0,in_port=3,actions=set_field:5500->tun_id,resubmit(,1)
table=0,in_port=4,actions=set_field:12000->tun_id,resubmit(,1)
table=0,actions=resubmit(,1)

table=1,tun_id=100,dl_dst=00.00.00.00.00.00.01,actions=output:1 
table=1,tun_id=200,dl_dst=00.00.00.00.00.00.02,actions=output:2 
table=1,tun_id=5500,dl_dst=00.00.00.00.00.00.03,actions=output:3
table=1,tun_id=12000,dl_dst=00.00.00.00.00.00.04,actions=output:4
table=1,tun_id=100,dl_dst=00.00.00.00.00.00.05,actions=output:10
table=1,tun_id=200,dl_dst=00.00.00.00.00.00.06,actions=output:10
table=1,tun_id=5500,dl_dst=00.00.00.00.00.00.07,actions=output:10
table=1,tun_id=12000,dl_dst=00.00.00.00.00.00.08,actions=output:10 
table=1,tun_id=100,arp,nw_dst=10.0.0.1,actions=output:1
table=1,tun_id=200,arp,nw_dst=10.0.0.2,actions=output:2
table=1,tun_id=5500,arp,nw_dst=10.0.0.3,actions=output:3
table=1,tun_id=12000,arp,nw_dst=10.0.0.4,actions=output:4 
table=1,tun_id=100,arp,nw_dst=10.0.0.5,actions=output:10 
table=1,tun_id=200,arp,nw_dst=10.0.0.6,actions=output:10 
table=1,tun_id=5500,arp,nw_dst=10.0.0.7,actions=output:10 
table=1,tun_id=12000,arp,nw_dst=10.0.0.8,actions=output:10 
table=1,priority=100,actions=drop
 
    
-------------- next part --------------
table=0,in_port=1,actions=set_field:100->tun_id,resubmit(,1)
table=0,in_port=2,actions=set_field:200->tun_id,resubmit(,1)
table=0,in_port=3,actions=set_field:5500->tun_id,resubmit(,1)
table=0,in_port=4,actions=set_field:12000->tun_id,resubmit(,1)
table=0,actions=resubmit(,1)

table=1,tun_id=100,dl_dst=00.00.00.00.00.00.05,actions=output:1 
table=1,tun_id=200,dl_dst=00.00.00.00.00.00.06,actions=output:2 
table=1,tun_id=5500,dl_dst=00.00.00.00.00.00.07,actions=output:3
table=1,tun_id=12000,dl_dst=00.00.00.00.00.00.08,actions=output:4
table=1,tun_id=100,dl_dst=00.00.00.00.00.00.01,actions=output:10
table=1,tun_id=200,dl_dst=00.00.00.00.00.00.02,actions=output:10
table=1,tun_id=5500,dl_dst=00.00.00.00.00.00.03,actions=output:10
table=1,tun_id=12000,dl_dst=00.00.00.00.00.00.04,actions=output:10 
table=1,tun_id=100,arp,nw_dst=10.0.0.5,actions=output:1
table=1,tun_id=200,arp,nw_dst=10.0.0.6,actions=output:2
table=1,tun_id=5500,arp,nw_dst=10.0.0.7,actions=output:3
table=1,tun_id=12000,arp,nw_dst=10.0.0.8,actions=output:4 
table=1,tun_id=100,arp,nw_dst=10.0.0.1,actions=output:10 
table=1,tun_id=200,arp,nw_dst=10.0.0.2,actions=output:10 
table=1,tun_id=5500,arp,nw_dst=10.0.0.3,actions=output:10 
table=1,tun_id=12000,arp,nw_dst=10.0.0.4,actions=output:10 
table=1,priority=100,actions=drop
 
    
-------------- next part --------------
A non-text attachment was scrubbed...
Name: vx.py
Type: text/x-python
Size: 1880 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150503/96b195a5/attachment-0001.py>

From lindongyi at bingosoft.net  Sun May  3 19:55:54 2015
From: lindongyi at bingosoft.net (=?gb2312?B?wda2rNLV?=)
Date: Mon, 4 May 2015 02:55:54 +0000
Subject: [ovs-discuss] OVS no packet_in to controller
Message-ID: <FF2F4EC3D0CFB74A88792D19E6C1C8C8365B1D@yt-mail-02>

An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/762df690/attachment-0001.html>

From Gergely.Pongracz at ericsson.com  Mon May  4 02:58:04 2015
From: Gergely.Pongracz at ericsson.com (Gergely Pongracz)
Date: Mon, 4 May 2015 11:58:04 +0200
Subject: [ovs-discuss] Fwd: [Dpdk-ovs] scalability issues
In-Reply-To: <5540F1B2.3080300@ericsson.com>
References: <5540F1B2.3080300@ericsson.com>
Message-ID: <554742AC.9090805@ericsson.com>

Hi,

We ran into some issues using the DPDK based OVS switch (2.3.90). We 
used pktgen for traffic generation.

*1. Multiple flows -> degrading performance*

Everything looks nice, but when we generate multiple flows with 
different MAC addresses the switch performance drops. On an Intel Atom 
system the packet rate was dropping from 4 Mpps to 2 Mpps when 
increasing the number of flows to 10.

*2. Set Queue -> severe performance degradation*

After setting a queue, irrespectively of the bandwidth limit set the 
performance drops to ~1.5 Mpps on a Xeon machine (from ~10 Mpps - we use 
only 1 core for the given port)

Any ideas?

If you need more data, let me know.
Thanks!

Gergely


From haleema.s.mahmood at gmail.com  Mon May  4 05:18:21 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Mon, 4 May 2015 17:18:21 +0500
Subject: [ovs-discuss] OVS Queues min rate not maintained
Message-ID: <CAN-u-63FRiTUjhGwB+=J+qTXVjyOsOEt_adk3WDPX9spTYOmVg@mail.gmail.com>

Hi everyone,

I am trying to configure queues on OVS. The topology I have is one switch
and three hosts connected to it. The issue with my queues is that when I
give different min and max rates for a queue, the min-rate threshold is not
being maintained. The bandwidth goes below the min-rate specified. However,
the bandwidth never exceeds the max-rate specified.

Can you please explain to me this phenomena? Moreover, where else should I
look to understand queues better?

Thanks!

Haleema.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/895108b7/attachment-0001.html>

From haleema.s.mahmood at gmail.com  Mon May  4 05:22:24 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Mon, 4 May 2015 17:22:24 +0500
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <20150502172506.GG19570@nicira.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
 <20150502163330.GB19570@nicira.com>
 <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>
 <20150502171628.GF19570@nicira.com>
 <CAN-u-63Dxz0itOJiMN7sixnFVPgiSnUJ6n4EvM6A+mERRg2whg@mail.gmail.com>
 <20150502172506.GG19570@nicira.com>
Message-ID: <CAN-u-60H0pwCqUGPOBZ9iOyXDdU1Rw4r7mj6rrkWXOtMwSLj6A@mail.gmail.com>

The issue is resolved now.. I was setting up the bandwidth and delay
variable in the mininet custom topology that I created. Once I removed them
the queues starting working. However, if I have different min/max rate for
the queues the min rate threshold is not maintained.

For ex, if min-rate is 4 Megabit and I specify the udp packet rate to be 3
Megabit, the bandwidth on the server side(where the queue is being
maintained) for iperf goes to 3 Megabit.

Do you have any idea why?

Thanks!

Haleema

On Sat, May 2, 2015 at 10:25 PM, Ben Pfaff <blp at nicira.com> wrote:

> It looks like mininet is taking charge of the qdisc on s1-eth1.  There
> can only be one configuration, so if mininet wants to set it one way and
> OVS the other then only one can win.  I suspect you should talk to the
> mininet folks.
>
> On Sat, May 02, 2015 at 10:17:19AM -0700, Haleema Sadia wrote:
> > Here it is!
> >
> > On Sat, May 2, 2015 at 10:16 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > Can you provide the ovs-vswitchd log?
> > >
> > > On Sat, May 02, 2015 at 09:58:34AM -0700, Haleema Sadia wrote:
> > > > My mininet wasn't working before when I type the command, but I
> restarted
> > > > it and now the command shows this:
> > > >
> > > > qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2 2 2
> 1 2
> > > 0 0
> > > > 1 1 1 1 1 1 1 1
> > > > qdisc htb 5: dev s1-eth1 root refcnt 2 r2q 10 default 1
> > > direct_packets_stat
> > > > 0 direct_qlen 1000
> > > > qdisc netem 10: dev s1-eth1 parent 5:1 limit 1000 delay 99us
> > > > qdisc htb 5: dev s1-eth2 root refcnt 2 r2q 10 default 1
> > > direct_packets_stat
> > > > 0 direct_qlen 1000
> > > > qdisc netem 10: dev s1-eth2 parent 5:1 limit 1000 delay 99us
> > > > qdisc htb 5: dev s1-eth3 root refcnt 2 r2q 10 default 1
> > > direct_packets_stat
> > > > 0 direct_qlen 1000
> > > > qdisc netem 10: dev s1-eth3 parent 5:1 limit 1000 delay 99us
> > > >
> > > > (the topology is one switch and three hosts)
> > > >
> > > > And I am attaching my kern.log
> > > >
> > > >
> > > >
> > > > On Sat, May 2, 2015 at 9:33 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > OK, the linux-htb qdisc isn't really getting configured.  We'll
> have to
> > > > > figure out why.
> > > > >
> > > > > Is the htb kernel module loaded?  Is there anything in the kernel
> log
> > > > > related to htb?
> > > > >
> > > > > On Sat, May 02, 2015 at 09:20:19AM -0700, Haleema Sadia wrote:
> > > > > > It says:
> > > > > >
> > > > > > qdisc pfifo_fast 0: dev eth0 root refcnt 2 bands 3 priomap  1 2
> 2 2
> > > 1 2
> > > > > 0 0
> > > > > > 1 1 1 1 1 1 1 1
> > > > > >
> > > > > >
> > > > > > On Sat, May 2, 2015 at 9:17 AM, Ben Pfaff <blp at nicira.com>
> wrote:
> > > > > >
> > > > > > > Check whether the kernel shows the qdisc being configured: "tc
> > > qdisc
> > > > > > > show".
> > > > > > >
> > > > > > > On Sat, May 02, 2015 at 05:11:30PM +0500, Haleema Sadia wrote:
> > > > > > > > Hi Ben,
> > > > > > > >
> > > > > > > > Thanks for your response!
> > > > > > > >
> > > > > > > > The ovs-vswitchd log shows shows no error and neither does it
> > > says
> > > > > > > anything
> > > > > > > > about the queue creation. Is that fine? However, I do get the
> > > qos id
> > > > > and
> > > > > > > > the queue id when I create them.
> > > > > > > >
> > > > > > > > On Sat, May 2, 2015 at 3:57 AM, Ben Pfaff <blp at nicira.com>
> > > wrote:
> > > > > > > >
> > > > > > > > > On Thu, Apr 30, 2015 at 11:52:45AM +0500, Haleema Sadia
> Mahmood
> > > > > wrote:
> > > > > > > > > > So I am trying to configure queues on a mininet
> topology. The
> > > > > command
> > > > > > > > > that I use is, (here s1-eth1 is my port 1)
> > > > > > > > > >
> > > > > > > > > > sudo ovs-vsctl set port s1-eth1 qos=@newqos - -  -
> > > -id=@newqos
> > > > > create
> > > > > > > > > qos type=linux-htb queues=0=@q0  - -  - -id=@q0 create
> queue
> > > > > > > > > other-config:max-rate=100000000
> other-config:min-rate=5000000
> > > - -
> > > > > > > > > >
> > > > > > > > > > The qos is attached to the port, checked it from sudo
> > > ovs-vsctl
> > > > > list
> > > > > > > > > port s1-eth1, and the queues are created.
> > > > > > > > >
> > > > > > > > > Probably the queues aren't really created.  Check the
> > > ovs-vswitchd
> > > > > log
> > > > > > > > > for error messages.
> > > > > > > > >
> > > > > > >
> > > > >
> > >
> > >
> > >
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/890e4b10/attachment-0001.html>

From duankebo at huawei.com  Mon May  4 05:40:00 2015
From: duankebo at huawei.com (Duankebo (Frank))
Date: Mon, 4 May 2015 12:40:00 +0000
Subject: [ovs-discuss] Difference between access ovs port and native ovs
	untagged port
Message-ID: <D7E5E3A5A61527479B3F85C3FB29614D8917A8B8@SZXEMA504-MBX.china.huawei.com>

Dear guys:
	I have an ovs working as both L2 switch and L3 router, L2 switch is a typical learning switch(using "normal" flow entry) and works fine.

    To L3 router function, things become difficult. In my setting, each port on ovs is access port, when I route one packet from one port to

    another port with a difference access vlan tag, I have to modify the vlan tag to that of the destination port, then use NORMAL action to

    forwarding the packet to the destination port.

       ________________
       |               |
       |      OVS      |
       |               |
       ----2----------1----------
          |       | 
          |       |
         VM2    VM1

	Showing in the diagram above, VM2 has a access vlan of 20, VM1 has a access vlan of 10. The flow entry looks like this:


		In_port=1, dl_dst=gateway_mac, nw_dst=VM2_IP, actions=mod_dl_dst:VM2_MAC, mod_vlan_vid:20, output:NORMAL

    To my surprise, the packets from VM1 to VM2 were dropped, Log of ovs said I can't modify vlan id of an access port. 

    By changing VM1 and VM2's port type to "NATIVE-UNTAGGED", I can solve this problem, but I'm unsure of the different between access port and native-untagged

    port, are their behavior exactly the same? Can I replace a access port with a native-untagged port?

    The mail is a bit long and the problem somewhat complicated, thank you for your patience!
Yours
Frank

From shettyg at nicira.com  Mon May  4 10:21:06 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 4 May 2015 10:21:06 -0700
Subject: [ovs-discuss] Difference between access ovs port and native ovs
 untagged port
In-Reply-To: <D7E5E3A5A61527479B3F85C3FB29614D8917A8B8@SZXEMA504-MBX.china.huawei.com>
References: <D7E5E3A5A61527479B3F85C3FB29614D8917A8B8@SZXEMA504-MBX.china.huawei.com>
Message-ID: <CAHbON5p6Ku6+VfE-Kepbbr4HqTzJPu1xo81O=M2Jyd_9b2W3Ug@mail.gmail.com>

>     By changing VM1 and VM2's port type to "NATIVE-UNTAGGED", I can solve this problem, but I'm unsure of the different between access port and native-untagged
>

I did not read the entire email, but for the specific question about
the difference, the documentation is in 'man ovs-vswitchd.conf.db'.

From jesse at nicira.com  Mon May  4 11:55:27 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 4 May 2015 11:55:27 -0700
Subject: [ovs-discuss] =?utf-8?q?SKB_is_modified_42_bytes_in_ovs_module?=
	=?utf-8?b?77yBaGVscO+8gQ==?=
In-Reply-To: <4572e25e.160d3.14d1eed6185.Coremail.frankzfz@163.com>
References: <7c2c0171.1b0ed.14cd645be62.Coremail.frankzfz@163.com>
 <CAEP_g=-6_MFznLiHDGdDdGCbS_ZM4t3Ex4NRroE8Q1Fqhod+VQ@mail.gmail.com>
 <3874da1.12220.14cdefdeaf8.Coremail.wenx05124561@163.com>
 <CAEP_g=86o3g8odFa4jOUmiutzdLanBOH-WBNGYSaMJqXZjCW6Q@mail.gmail.com>
 <4572e25e.160d3.14d1eed6185.Coremail.frankzfz@163.com>
Message-ID: <CAEP_g=9ki7ucijUeDE7SdZaV71qziu7QnBikZBntSuqxDH=XYg@mail.gmail.com>

On Mon, May 4, 2015 at 5:36 AM, frankzfz <frankzfz at 163.com> wrote:

>                                                                      Figure
> 1 Sender side
>
>
>                                   Figure 2 Receiver side
> The VM sends a packet with 1500 bytes and the ovs will encapsulate the
> packet with gre tunnel and the packet length will larger than 1500,On the
> sender side, the  packet will be fragment to 2 packets,as shown in figure 1,The
> size of the two packets of (data load)1406 and 42 respectively, On the
> receiver side we find the last 42 bytes(user data) of the second packet was
> tampered by linux ovs.Please check the contents of the red box in the
> figure.
>

Sorry, there really isn't enough information here to debug this. You'll
need to investigate more yourself as I mentioned in the previous email.
Further, as I said before, fragmentation/reassembly happens as part of the
Linux IP stack and not OVS, so that's the right place for this discussion
to happen.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/82582a55/attachment.html>

From maniksidana019 at gmail.com  Mon May  4 18:35:21 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Tue, 05 May 2015 07:05:21 +0530
Subject: [ovs-discuss] OVS Queues min rate not maintained
Message-ID: <8hmoogirhv69hndxgw09955k.1430789721187@email.android.com>

This is a good short tutorial for qos.

http://dannykim.me/danny/openflow/57771?ckattempt=1

How are you generating traffic ? One issue could be that the network bandwidth is below the mininum rate that you have specified.

Are you using mininet and iperf for your topology?


Sent from Samsung Galaxy Note!!!

-------- Original message --------
From: Haleema Sadia <haleema.s.mahmood at gmail.com> 
Date: 04/05/2015  17:48  (GMT+05:30) 
To: discuss at openvswitch.org 
Subject: [ovs-discuss] OVS Queues min rate not maintained 
 
Hi everyone,

I am trying to configure queues on OVS. The topology I have is one switch and three hosts connected to it. The issue with my queues is that when I give different min and max rates for a queue, the min-rate threshold is not being maintained. The bandwidth goes below the min-rate specified. However, the bandwidth never exceeds the max-rate specified. 

Can you please explain to me this phenomena? Moreover, where else should I look to understand queues better?

Thanks!

Haleema.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150505/b547049c/attachment.html>

From blp at nicira.com  Mon May  4 21:03:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 4 May 2015 21:03:20 -0700
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <734693049.1356116.1430768525967.JavaMail.yahoo@mail.yahoo.com>
References: <20150324034950.GB21543@nicira.com>
 <734693049.1356116.1430768525967.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150505040320.GA29387@nicira.com>

They're in review.  It will probably be a few weeks.

On Mon, May 04, 2015 at 07:42:05PM +0000, vis reddy wrote:
> Hello Sir,When can we expect the patches to be applied? ThanksVishnu
>       From: Ben Pfaff <blp at nicira.com>
>  To: vis reddy <badveli_vishnuus at yahoo.com> 
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
>  Sent: Monday, 23 March 2015 8:49 PM
>  Subject: Re: [ovs-discuss] ovsdb update operation
>    
> The current OVSDB implementation isn't designed for a large number of
> clients.  Since OVSDB in OVN will need to handle a larger number of
> clients, we (specifically Andy Zhou) are working on increasing its
> scalability along that dimension.  He has already posted some patches,
> although they have not yet been applied.
> 
> 
> 
> On Tue, Mar 24, 2015 at 01:24:06AM +0000, vis reddy wrote:
> > i would like to extend this to my own configurations(which are not
> > Open vSwitch environments) to be pushed to remote clients by a
> > centralized entity,I have several clients monitoring on this
> > configuration changes, the configurations could be anything which is
> > not restricted to only Open vSwitch could you please let me know if it
> > is not designed/ cannot use . I am going through your OVN architecture
> > but my immediate requirement is i want to  use ovsdb and design a
> > system that contains a centralized entity and thousands of entity
> > listening to it for the configuration, could you please let me know if
> > ovsdb is not designed for this.ThanksVishnu
> >
> >      From: Ben Pfaff <blp at nicira.com>
> >  To: vis reddy <badveli_vishnuus at yahoo.com> 
> > Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
> >  Sent: Monday, 23 March 2015 5:17 PM
> >  Subject: Re: [ovs-discuss] ovsdb update operation
> >    
> > On Mon, Mar 23, 2015 at 11:27:01PM +0000, vis reddy wrote:
> > 
> > 
> > > Thanks Sir,I have another question, was there any scalability numbers that are available?
> > > I had created 2000 ovsdb-client monitoring on a database and??
> > > when i do a transact (insert operation) from another client i get following error,
> > > error: Connection reset by peerovsdb-client: transaction failed (Connection reset by peer)
> > > Was there any profiling done on ??ovsdb in terms of how many clients??can be supported and also does it depend on ??data in tables?I am using a very large tables (potentially running into couple of mb's)
> > 
> > We don't have a use case for that, so we didn't test for it.
> > 
> > In Open vSwitch environments there are normally only a single-digit
> > number of clients.
> > 
> > What is your use case?
> > 
> > 
> >  
> 
> 
>   

From blp at nicira.com  Mon May  4 21:04:15 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 4 May 2015 21:04:15 -0700
Subject: [ovs-discuss] About open flow flow entries ( dl_dst error (
 Invalid Ethernet address))
In-Reply-To: <CACcRUixe_4U1DpHL7+WmhXDCnXoLMc3VKOaVVpkeq4wdGE1Trw@mail.gmail.com>
References: <CACcRUixe_4U1DpHL7+WmhXDCnXoLMc3VKOaVVpkeq4wdGE1Trw@mail.gmail.com>
Message-ID: <20150505040415.GB29387@nicira.com>

On Sun, May 03, 2015 at 10:40:58PM -0400, sanket raut wrote:
> When I give my manual-flows by  sh ovs-ofctl add-flows s1 s1text.txt
> It gives me error in dl_dst command that Ethernet address is invalid.
> But it is valid mac address I'm specifying as per topology.

Ethernet addresses are delimited with ":", not ".".

From marco at nuvula.ch  Tue May  5 00:25:04 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 5 May 2015 09:25:04 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <DEB79FE9-5392-4CDB-9EC7-04FCB784CD61@nuvula.ch>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>
 <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>
 <321030EF-0481-4FD2-B979-8B0A63C3D19D@nuvula.ch>
 <CANr6G5weMs1tLeLmDSfb_yL9Gk6Zz88dy0XpZ99UjQVi+_w_Sw@mail.gmail.com>
 <68DDEDA0-481E-49EF-BB94-7FD9AE7373EF@nuvula.ch>
 <20DD9129-AEDD-4FC6-BFD5-A8F10545230B@nuvula.ch>
 <CANr6G5znSOe9gFUMwa6AP-zaRNiRXrfnqM6UUHsoVgQWEsN2Jg@mail.gmail.com>
 <EF09D73F-A631-484A-AE08-307C927ABEB3@nuvula.ch>
 <62395DBA-764B-4332-8D77-EF5EF189D623@canonical.com>
 <3E5B9556-CB9F-4D5B-8A6D-A615C099BAD7@nuvula.ch>
 <3FE189EC-49E0-47CC-BD59-2F6E7B04B9A4@ubuntu.com>
 <8CE70C04-9A31-4499-938A-85EC4D13E0BB@nuvula.ch>
 <C222441F-23C1-470A-987E-123B00879EA9@ubuntu.com>
 <117DA076-BD34-4C01-94AE-22949AEF0E42@nuvula.ch> <55241FD8.1040704@ubuntu.com>
 <A00A93E9-6A58-458C-8E8B-C8542176ADDA@nuvula.ch> <553519F7.3060901@ubuntu.com>
 <CA907DB2-9B8D-4BEA-A902-8F9E436268A8@nuvula.ch> <5537613B.5070804@ubuntu.com>
 <DEB79FE9-5392-4CDB-9EC7-04FCB784CD61@nuvula.ch>
Message-ID: <A56ACE3F-3BAC-4777-9D7C-46029D1D0D6E@nuvula.ch>

Have some new information. Don't know if it is relevant to the problem. This time it is not a clear process restart but a complete crash. I do see openvswitch also in there, and as the server loose complete connectivity I think it is involved. Here the available info:

[ 1094.060220] SysRq : Trigger a crash
[ 1094.060255] BUG: unable to handle kernel NULL pointer dereference at           (null)
[ 1094.060275] IP: [<ffffffff81478606>] sysrq_handle_crash+0x16/0x20
[ 1094.060296] PGD 7d879c067 PUD 7889b2067 PMD 0
[ 1094.060322] Oops: 0002 [#1] SMP
[ 1094.060334] Modules linked in: vhost_net vhost macvtap macvlan ebtable_nat ebtables ip6table_filter ip6_tables xt_limit xt_LOG ipt_REJECT xt_recent xt_conntrack xt_multiport iptable_filter ipt_MASQUERADE xt_nat xt_tcpudp iptable_nat nf_conntrack_ipv4 nf_defrag_ipv4 nf_nat_ipv4 nf_nat nf_conntrack iptable_mangle ip_tables x_tables nfnetlink_queue nfnetlink_log nfnetlink bluetooth 6lowpan_iphc openvswitch gre vxlan eeepc_wmi asus_wmi sparse_keymap ppdev intel_rapl x86_pkg_temp_thermal intel_powerclamp coretemp kvm_intel kvm crct10dif_pclmul crc32_pclmul ghash_clmulni_intel aesni_intel aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd serio_raw lpc_ich shpchp wmi parport_pc tpm_infineon video mac_hid lp parport nfsd auth_rpcgss nfs_acl nfs lockd sunrpc ceph libceph libcrc32c fscache btrfs raid10
[ 1094.060590]  raid456 async_raid6_recov async_memcpy async_pq async_xor async_tx xor raid6_pq ahci raid1 libahci r8169 raid0 mii multipath linear
[ 1094.060635] CPU: 7 PID: 5643 Comm: bash Not tainted 3.16.0-34-generic #47~14.04.1-Ubuntu
[ 1094.060654] Hardware name: System manufacturer System Product Name/P8H67-M PRO, BIOS 3604 02/23/2012
[ 1094.060687] task: ffff8807f1efb2f0 ti: ffff880788920000 task.ti: ffff880788920000
[ 1094.060730] RIP: 0010:[<ffffffff81478606>]  [<ffffffff81478606>] sysrq_handle_crash+0x16/0x20
[ 1094.060779] RSP: 0018:ffff880788923e90  EFLAGS: 00010292
[ 1094.060804] RAX: 000000000000000f RBX: ffffffff81ca5680 RCX: 0000000000000000
[ 1094.060833] RDX: ffff88081f3cee40 RSI: ffff88081f3cd418 RDI: 0000000000000063
[ 1094.060862] RBP: ffff880788923e90 R08: 0000000000000082 R09: 00000000000004bc
[ 1094.060891] R10: 00000000000004bb R11: 0000000000000003 R12: 0000000000000063
[ 1094.060919] R13: 0000000000000000 R14: 0000000000000004 R15: 0000000000000000
[ 1094.060949] FS:  00007f6e8d005740(0000) GS:ffff88081f3c0000(0000) knlGS:0000000000000000
[ 1094.060993] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 1094.061019] CR2: 0000000000000000 CR3: 00000007aa52d000 CR4: 00000000000427e0
[ 1094.061048] Stack:
[ 1094.061067]  ffff880788923ec0 ffffffff81478e07 0000000000000002 000000000181b008
[ 1094.061113]  0000000000000002 ffff880788923f50 ffff880788923ed8 ffffffff814792af
[ 1094.061159]  ffff8807ef1ec780 ffff880788923ef8 ffffffff8123729d ffff880788923f50
[ 1094.061204] Call Trace:
[ 1094.061227]  [<ffffffff81478e07>] __handle_sysrq+0x107/0x170
[ 1094.061254]  [<ffffffff814792af>] write_sysrq_trigger+0x2f/0x40
[ 1094.061285]  [<ffffffff8123729d>] proc_reg_write+0x3d/0x80
[ 1094.061315]  [<ffffffff811d4297>] vfs_write+0xb7/0x1f0
[ 1094.061342]  [<ffffffff811d4e36>] SyS_write+0x46/0xb0
[ 1094.061371]  [<ffffffff8176ca6d>] system_call_fastpath+0x1a/0x1f
[ 1094.061397] Code: 65 34 75 e5 4c 89 ef e8 f9 f7 ff ff eb db 0f 1f 80 00 00 00 00 66 66 66 66 90 55 c7 05 84 12 a4 00 01 00 00 00 48 89 e5 0f ae f8 <c6> 04 25 00 00 00 00 01 5d c3 66 66 66 66 90 55 31 c0 c7 05 2e
[ 1094.061538] RIP  [<ffffffff81478606>] sysrq_handle_crash+0x16/0x20
[ 1094.061568]  RSP <ffff880788923e90>
[ 1094.061589] CR2: 0000000000000000

This is Ubuntu 14.0.4 with HWE kernel 3.16 and OVS 2.0.2 with disabled optimization package from James. I can make the whole crash dump available if that helps.

cheers
marco


 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
> On 30 Apr 2015, at 12:08, Marco Kuendig <marco at nuvula.ch> wrote:
> 
> Hi James
> 
> sorry for the very late reply. Had some email filtering issues and missed that message. 
> 
> have now updated all servers to that non-optimized package.
> 
> So I do have now:
> 
> 4 servers with 3.16 kernel and unoptimized ovs package
> 1 server with 3.13 kernel and unoptimized ovs package
> 
> Will report back how it goes.
> 
> cheers
> marco
> 
> 
>  <http://www.nuvula.ch/>
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71
> 
> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch <http://www.nuvula.ch/>
>> On 22 Apr 2015, at 10:52, James Page <james.page at ubuntu.com <mailto:james.page at ubuntu.com>> wrote:
>> 
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA256
>> 
>> Marco
>> 
>> Apologies for my foobar in not managing to provide un-optimized
>> binaries when I thought I had - apparently the ovs packaging
>> outsmarted me.
>> 
>> I've push a verified -O0 build to ppa:james-page/openvswitch
>> 
>> If you could retry with the latest packages from that PPA that would
>> be great - then we can really figure out whether this is an optimizer
>> issue or not...
>> 
>> Regards
>> 
>> James
>> 
>> On 21/04/15 08:01, Marco Kuendig wrote:
>>> thanks James for the answer. No problem.
>>> 
>>> Let me know if I can test anything and I will give it a try.
>>> 
>>> cheers marco
>>> 
>>> 
>>> Nuvula AG <http://www.nuvula.ch/ <http://www.nuvula.ch/>>
>>> 
>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch>
>>> <mailto:marco at nuvula.ch <mailto:marco at nuvula.ch>> / +41 78 751 99 71
>>> 
>>> Marco's Google Hangout
>>> <https://plus.google.com/hangouts/_/nuvula.ch/marco <https://plus.google.com/hangouts/_/nuvula.ch/marco>>
>>> 
>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau
>>> Switzerland http://www.nuvula.ch <http://www.nuvula.ch/> <http://www.nuvula.ch/ <http://www.nuvula.ch/>>
>>> 
>>> 
>>>> On 20 Apr 2015, at 17:23, James Page <james.page at ubuntu.com <mailto:james.page at ubuntu.com> 
>>>> <mailto:james.page at ubuntu.com <mailto:james.page at ubuntu.com>>> wrote:
>>>> 
>>> Hi Marco
>>> 
>>> Not ignoring you - just a bit busy with Ubuntu 15.04 release at
>>> the moment - so apologies for any lag.
>>> 
>>> On 16/04/15 21:13, Marco Kuendig wrote:
>>>>>> #2  0x0000000000460cd2 in format_odp_key_attr 
>>>>>> (a=a at entry=0x19798d4, ma=ma at entry=0x0,
>>>>>> ds=ds at entry=0x7ffc6c10bd10, verbose=verbose at entry=true) at
>>>>>> ../lib/odp-util.c:1332
>>> 
>>> The thing that has us puzzled is why at this point in the stack is
>>> the automatic variable 'is_exact' not true:
>>> 
>>> case OVS_KEY_ATTR_UNSPEC: case __OVS_KEY_ATTR_MAX: default: 
>>> format_generic_odp_key(a, ds); if (!is_exact) { ds_put_char(ds,
>>> '/'); format_generic_odp_key(ma, ds); } break; }
>>> 
>>> As the 'ma' parameter is 0, this should mean that is_exact
>>> follows:
>>> 
>>> is_exact = ma ? odp_mask_attr_is_exact(ma) : true;
>>> 
>>> and as ma == 0 then is_exact should == true.  But for some reason
>>> its no t.
>>> 
>>> As you see this with the un-optimized package, we can't blame the 
>>> optimizer - so something else must be happening - maybe an
>>> overflow?
>>> 
>>> That would have to happen in L952->L978 so not a huge amount of
>>> scope.
>>> 
>>> It might be good to see if we can determine whether namebuf is the 
>>> culprit.
>>> 
>>> 
>> 
>> - -- 
>> James Page
>> Ubuntu and Debian Developer
>> james.page at ubuntu.com <mailto:james.page at ubuntu.com>
>> jamespage at debian.org
>> -----BEGIN PGP SIGNATURE-----
>> Version: GnuPG v2
>> 
>> iQIcBAEBCAAGBQJVN2E7AAoJEL/srsug59jDLJcQAKKzaKdfp7YvrEcasIaLKffh
>> mO0KO6MbVWp+42gaW/1XuT3wa2nZuVgjGaytb5NC/EJy1O3viQVQMWJIJosBoK5f
>> xbxC1z+3IRhnF8r27elql8nE/bxLVGpj4jUXySV7Ad1ede/3P3T30TcnhCkXNaKi
>> 2CcOE9MUAj+2sp4C3VUXwRxdTZio1dJ+A6lDoA65p7brWroKNhY1Y0g1ct97tVE+
>> YLaZK3oOuVt6++CX5KPE7hR1XBk5ojKxMUtIDP5T/az7zDSokVk2GR3CYJHg57kh
>> SfvGw4r0PbkKn0W3E4u3HSCimlizy40Ior9qUuvNC8F4kDq7LWW3WE6ggb+X34N0
>> 5AetDHEgRB7eFBTWlLmC4Gop7mrQP/wBqmDJJoMr+jxEJC8HoSpRYoFixAPi+6w7
>> O3SqOPCMpND0EHqCF60fn5zUFyXWEqWgrunEauhqPJ6swo1Uzyu52ONSZQ+V27UY
>> bqnDBjq5JAU5QbSTAY52ugAsW+GGobykdduxuL0Uz8cppZ/Vlkm/wh8XtAfN3nTh
>> GbYItkp9xRNesq6Q+beL0tFVLJWuvQNDv4LsFBzgAGRE/9Aw91A1T2GtOvLbLACa
>> SmM2FMt4NBVV7ANqKUP1F8mACyKtbhepPVO2Oidx/ytogO+oZYtNaRNK+UwQvj/0
>> lFtr4VM3A0nI8s0zFeyP
>> =mulJ
>> -----END PGP SIGNATURE-----
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150505/aeea901e/attachment-0001.html>

From gulam at gulam.in  Tue May  5 02:46:02 2015
From: gulam at gulam.in (Bakshi Gulam)
Date: Tue, 5 May 2015 15:16:02 +0530
Subject: [ovs-discuss] OVS - Change Interface Speed
Message-ID: <CA+P_w0y+kys2qgsuLf0N2gbc6fy=MDcT4VMkcPj1FV7a-idqMA@mail.gmail.com>

Hi All!

I'm trying to change interface speed of OVS but I couldn't. When I searched
OVS mailing list archives, I found a answer that OVS doesn't offer a way to
set speed rather it just advertises what the kernel reports.

Using ethtool, I got that my driver for virtual interfaces created by OVS
is "veth". I tried changing the veth driver's speed using ethtool. But it
says "operation not supported". Can anyone please tell me how to change the
speed of veth driver so that OVS advertises new speed?

P.S.: This may be beyond the scope of OVS. But suggestions will be of great
help.

-- 
/////////////////////////
// Bakshi Gulam        //
// http://www.gulam.in //
/////////////////////////
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150505/22e54bd2/attachment.html>

From mark.d.gray at intel.com  Tue May  5 03:56:08 2015
From: mark.d.gray at intel.com (Mark D. Gray)
Date: Tue, 05 May 2015 11:56:08 +0100
Subject: [ovs-discuss] Fwd: [Dpdk-ovs] scalability issues
In-Reply-To: <DF6750CB-8C5C-4C86-A646-CEB9ED948870@vmware.com>
References: <554742AC.9090805@ericsson.com> <55474317.6020900@ericsson.com>
 <DF6750CB-8C5C-4C86-A646-CEB9ED948870@vmware.com>
Message-ID: <5548A1C8.8080109@intel.com>

On 05/04/15 11:43, Daniele Di Proietto wrote:
>
>> On 4 May 2015, at 10:59, Gergely Pongracz<Gergely.Pongracz at ericsson.com>  wrote:
>>
>> Hi,
>>
>> We ran into some issues using the DPDK based OVS switch (2.3.90). We used pktgen for traffic generation.
>
> Hi Gergely,
>
> thanks for sharing these results
>
>> *1. Multiple flows ->  degrading performance*
>>
>> Everything looks nice, but when we generate multiple flows with different MAC addresses the switch performance drops. On an Intel Atom system the packet rate was dropping from 4 Mpps to 2 Mpps when increasing the number of flows to 10.
>

Is the MAC address the only thing that is different between the
flows? Daniele has some great patches to check EMC hit rate. You can use 
them via ovs-appctl to determine if you are hitting the EMC.If you are 
missing the EMC your performance may be degrading.

ovs-appctl dpif-netdev/pmd-stats-clear
ovs-appctl dpif-netdev/pmd-stats-show
> There are some patches that (I hope) should improve
> the throughput in these scenarios.  You might give them
> a try or wait until they get merged (the series is at
> http://openvswitch.org/pipermail/dev/2015-April/054553.html)
>
>> *2. Set Queue ->  severe performance degradation*
>>
>> After setting a queue, irrespectively of the bandwidth limit set the performance drops to ~1.5 Mpps on a Xeon machine (from ~10 Mpps - we use only 1 core for the given port)
>>
>
> QoS is not supported (yet) in the userspace datapath
> (used with DPDK devices).  Can you share the commands that
> you're using?
>
> Daniele
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Tue May  5 09:48:30 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 5 May 2015 09:48:30 -0700
Subject: [ovs-discuss] OVS - Change Interface Speed
In-Reply-To: <CA+P_w0y+kys2qgsuLf0N2gbc6fy=MDcT4VMkcPj1FV7a-idqMA@mail.gmail.com>
References: <CA+P_w0y+kys2qgsuLf0N2gbc6fy=MDcT4VMkcPj1FV7a-idqMA@mail.gmail.com>
Message-ID: <20150505164830.GA9168@nicira.com>

On Tue, May 05, 2015 at 03:16:02PM +0530, Bakshi Gulam wrote:
> Using ethtool, I got that my driver for virtual interfaces created by OVS
> is "veth". I tried changing the veth driver's speed using ethtool. But it
> says "operation not supported". Can anyone please tell me how to change the
> speed of veth driver so that OVS advertises new speed?

A veth is a software interface, so it doesn't have a meaningful speed.

From marco at nuvula.ch  Tue May  5 13:33:56 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 5 May 2015 22:33:56 +0200
Subject: [ovs-discuss] Issue with 802.1q trunks on eth ports
Message-ID: <44787D0B-1B6A-4AED-9897-84B626317202@nuvula.ch>

Folks,

I really struggle to get 802.1q trunks with VLANS working with openvswitch.




The server that got issues is a VXLAN GW on an ESX machine. That server should create connectivity for the VM's on ESX to the domains in KVM.

The VXLAN-GW machine has two interfaces:

eth0: native untagged for mgmt connectivity
eth1: 802.1q tagged for all user VLAN's


eth0 is up and forwards traffic as intended.

eth1 can talk to IP' addresses via vlans if there is no OVS involved. eth1.1, eth1.100, eth1.101 work fine if directly addressed.

I have tried now over three days dozens of configuration but can't get these scenario up and running correctly.

I would like to connect VLAN 1, 100 and 101 to the local VXLAN GW and also tunnel these VLANs over VXLAN to the KVM host. (Tunnel works fine)

Strange is that I do see the ARP reply, but no L3 connectivity goes trough.

I have tried "normal" ovs-vsctl based configuration and also ovs-stanza configuration. I have pasted below the OVS-Stanza config as I think that is most clean.

Any tip please ?

ovs-vsctl show
5cb98216-7245-45c1-ac3c-8d546c891306
    Bridge "ovsbr1"
        Port "eth1.1"
            tag: 1
            Interface "eth1.1"
        Port "eth1.100"
            tag: 100
            Interface "eth1.100"
        Port "ovsvx3"
            trunks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 20, 30, 100, 101]
            Interface "ovsvx3"
                type: vxlan
                options: {key=flow, remote_ip="2.2.2.2"}
        Port "ovsbr1.101"
            tag: 101
            Interface "ovsbr1.101"
                type: internal
        Port "ovsbr1"
            Interface "ovsbr1"
                type: internal
        Port "ovsbr1.1"
            tag: 1
            Interface "ovsbr1.1"
                type: internal
        Port "ovsbr1.100"
            tag: 100
            Interface "ovsbr1.100"
                type: internal
        Port "eth1.101"
            tag: 101
            Interface "eth1.101"
        Port "eth1"
            Interface "eth1"
    Bridge "ovsbr0"
        Port "ovsbr0"
            Interface "ovsbr0"
                type: internal
        Port "eth0"
            Interface "eth0"
    ovs_version: "2.3.1"



cat  /etc/network/interfaces
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

# The loopback network interface
auto lo
iface lo inet loopback

allow-ovs ovsbr0
auto ovsbr0
iface ovsbr0 inet static
        address 1.1.1.2
        netmask 255.255.255.224
        gateway 1.1.1.1
        ovs_type OVSBridge

allow-ovsbr0 eth0
auto eth0
iface eth0 inet manual
up ifconfig $IFACE 0.0.0.0 up
down ifconfig $IFACE down
ovs_bridge ovsbr0
  ovs_type OVSPort


allow-ovs ovsbr1
auto ovsbr1
iface ovsbr1 inet manual
up ifconfig $IFACE 0.0.0.0 up
down ifconfig $IFACE down
  ovs_type OVSBridge
  ovs_ports ovsbr1.1,ovsbr1.100,ovsbr1.101

allow-ovsbr1 eth1
auto eth1
iface eth1 inet manual
up ifconfig $IFACE 0.0.0.0 up
down ifconfig $IFACE down
ovs_bridge ovsbr1
  ovs_type OVSPort

allow-ovsbr1 ovsbr1.1
auto ovsbr1.1
iface ovsbr1.1 inet static
address 192.168.1.32
broadcast 192.168.1.254
netmask 255.255.255.0
mtu 1400
ovs_bridge ovsbr1
ovs_type OVSIntPort
ovs_options tag=1
ovs_extra set interface ${IFACE} external-ids:iface-id=$(hostname -s)

allow-ovsbr1 ovsbr1.100
auto ovsbr1.100
iface ovsbr1.100 inet static
address 192.168.100.32
broadcast 192.168.100.254
netmask 255.255.255.0
mtu 1400
ovs_bridge ovsbr1
ovs_type OVSIntPort
ovs_options tag=100
ovs_extra set interface ${IFACE} external-ids:iface-id=$(hostname -s)

allow-ovsbr1 ovsbr1.101
auto ovsbr1.101
iface ovsbr1.101 inet static
address 192.168.101.32
broadcast 192.168.101.254
netmask 255.255.255.0
mtu 1400
ovs_bridge ovsbr1
ovs_type OVSIntPort
ovs_options tag=101
ovs_extra set interface ${IFACE} external-ids:iface-id=$(hostname -s)

auto eth1.1
iface eth1.1 inet manual
up ifconfig $IFACE 0.0.0.0 up
down ifconfig $IFACE down
ovs_bridge ovsbr1
  ovs_type OVSPort
ovs_options tag=1

auto eth1.100
iface eth1.100 inet manual
up ifconfig $IFACE 0.0.0.0 up
down ifconfig $IFACE down
ovs_bridge ovsbr1
  ovs_type OVSPort
ovs_options tag=100

auto eth1.101
iface eth1.101 inet manual
up ifconfig $IFACE 0.0.0.0 up
down ifconfig $IFACE down
ovs_bridge ovsbr1
  ovs_type OVSPort
ovs_options tag=101


ping 192.168.1.22
PING 192.168.1.22 (192.168.1.22) 56(84) bytes of data.
^C
--- 192.168.1.22 ping statistics ---
2 packets transmitted, 0 received, 100% packet loss, time 1008ms

root at nuv-vir-esx-ubuntu-2 ~ # arp n
n: Unknown host
root at nuv-vir-esx-ubuntu-2 ~ # arp -n
Address                  HWtype  HWaddress           Flags Mask            Iface
192.168.1.102            ether   62:ca:86:a6:25:73   C                     ovsbr1.1
192.168.1.21             ether   0e:f6:43:87:f7:2a   C                     ovsbr1.1
192.168.1.22             ether   00:50:56:69:15:cb   C                     ovsbr1.1
192.168.1.8              ether   52:54:00:a8:a4:37   C                     ovsbr1.1
192.168.100.104                  (incomplete)                              ovsbr1.100
192.168.101.104                  (incomplete)                              ovsbr1.101
192.168.1.104            ether   56:8e:0c:62:78:ad   C                     ovsbr1.1

1.22 is the vmkernel interface on the ESX host that hosts the VM

Thanks and cheers
marco


 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150505/ebba11b1/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PastedGraphic-1.png
Type: image/png
Size: 57966 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150505/ebba11b1/attachment-0001.png>

From badveli_vishnuus at yahoo.com  Mon May  4 12:42:05 2015
From: badveli_vishnuus at yahoo.com (vis reddy)
Date: Mon, 4 May 2015 19:42:05 +0000 (UTC)
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <20150324034950.GB21543@nicira.com>
References: <20150324034950.GB21543@nicira.com>
Message-ID: <734693049.1356116.1430768525967.JavaMail.yahoo@mail.yahoo.com>

Hello Sir,When can we expect the patches to be applied? ThanksVishnu
      From: Ben Pfaff <blp at nicira.com>
 To: vis reddy <badveli_vishnuus at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Monday, 23 March 2015 8:49 PM
 Subject: Re: [ovs-discuss] ovsdb update operation
   
The current OVSDB implementation isn't designed for a large number of
clients.  Since OVSDB in OVN will need to handle a larger number of
clients, we (specifically Andy Zhou) are working on increasing its
scalability along that dimension.  He has already posted some patches,
although they have not yet been applied.



On Tue, Mar 24, 2015 at 01:24:06AM +0000, vis reddy wrote:
> i would like to extend this to my own configurations(which are not
> Open vSwitch environments) to be pushed to remote clients by a
> centralized entity,I have several clients monitoring on this
> configuration changes, the configurations could be anything which is
> not restricted to only Open vSwitch could you please let me know if it
> is not designed/ cannot use . I am going through your OVN architecture
> but my immediate requirement is i want to  use ovsdb and design a
> system that contains a centralized entity and thousands of entity
> listening to it for the configuration, could you please let me know if
> ovsdb is not designed for this.ThanksVishnu
>
>      From: Ben Pfaff <blp at nicira.com>
>  To: vis reddy <badveli_vishnuus at yahoo.com> 
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
>  Sent: Monday, 23 March 2015 5:17 PM
>  Subject: Re: [ovs-discuss] ovsdb update operation
>    
> On Mon, Mar 23, 2015 at 11:27:01PM +0000, vis reddy wrote:
> 
> 
> > Thanks Sir,I have another question, was there any scalability numbers that are available?
> > I had created 2000 ovsdb-client monitoring on a database and??
> > when i do a transact (insert operation) from another client i get following error,
> > error: Connection reset by peerovsdb-client: transaction failed (Connection reset by peer)
> > Was there any profiling done on ??ovsdb in terms of how many clients??can be supported and also does it depend on ??data in tables?I am using a very large tables (potentially running into couple of mb's)
> 
> We don't have a use case for that, so we didn't test for it.
> 
> In Open vSwitch environments there are normally only a single-digit
> number of clients.
> 
> What is your use case?
> 
> 
>  


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150504/2a3514df/attachment.html>

From haleema.s.mahmood at gmail.com  Mon May  4 23:28:55 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Tue, 5 May 2015 11:28:55 +0500
Subject: [ovs-discuss] OVS Queues min rate not maintained
In-Reply-To: <8hmoogirhv69hndxgw09955k.1430789721187@email.android.com>
References: <8hmoogirhv69hndxgw09955k.1430789721187@email.android.com>
Message-ID: <CAN-u-62YV5OWnDRmVq88FEXL1sv4gTGmubYnZhHBKACysiQMVA@mail.gmail.com>

I followed the same tutorial. I am generating traffic through iperf. And my
topology is from the mininet, one switch and three hosts.

I generate udp packets, with the network bandwidth below the minimum rate.
And that is what I can't understand. If I have set a minimum rate and my
specified bandwidth is below it, shouldn't it just stop the packets? or
perhaps increase the bandwidth till the minimum rate?



On Tue, May 5, 2015 at 6:35 AM, Manik Sidana <maniksidana019 at gmail.com>
wrote:

> This is a good short tutorial for qos.
>
> http://dannykim.me/danny/openflow/57771?ckattempt=1
>
> How are you generating traffic ? One issue could be that the network
> bandwidth is below the mininum rate that you have specified.
>
> Are you using mininet and iperf for your topology?
>
>
> *Sent from Samsung Galaxy Note!!!*
>
>
>
> -------- Original message --------
> From: Haleema Sadia <haleema.s.mahmood at gmail.com>
> Date: 04/05/2015 17:48 (GMT+05:30)
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] OVS Queues min rate not maintained
>
>
> Hi everyone,
>
> I am trying to configure queues on OVS. The topology I have is one switch
> and three hosts connected to it. The issue with my queues is that when I
> give different min and max rates for a queue, the min-rate threshold is not
> being maintained. The bandwidth goes below the min-rate specified. However,
> the bandwidth never exceeds the max-rate specified.
>
> Can you please explain to me this phenomena? Moreover, where else should I
> look to understand queues better?
>
> Thanks!
>
> Haleema.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150505/bf0ba717/attachment.html>

From wuhao.thu at gmail.com  Tue May  5 21:50:46 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Tue, 5 May 2015 21:50:46 -0700
Subject: [ovs-discuss] To add a file into /datapath, how to modify Makefile?
Message-ID: <CAHmvmjESiYOktQX6y=9_hbMYUFQD_hnNJeRFQb1K8RX1aVLJiw@mail.gmail.com>

Hi all,

   I'm trying to add some .h and .c files where my funcs are defined into
OVS kernel, that is, path /datapath. So, how to modify the makefile or some
other configuration files to make them compiled?

  Thanks.

+++++++++++++++++
Best,
Hao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150505/dbe54fe5/attachment.html>

From jpettit at nicira.com  Tue May  5 22:05:56 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 5 May 2015 22:05:56 -0700
Subject: [ovs-discuss] To add a file into /datapath,
	how to modify Makefile?
In-Reply-To: <CAHmvmjESiYOktQX6y=9_hbMYUFQD_hnNJeRFQb1K8RX1aVLJiw@mail.gmail.com>
References: <CAHmvmjESiYOktQX6y=9_hbMYUFQD_hnNJeRFQb1K8RX1aVLJiw@mail.gmail.com>
Message-ID: <6836D4C0-8F00-43D4-B2DC-CE8BD552710E@nicira.com>

It's about a year old, but you could look at my commit that adds a prototype for elephant flow detection:

	https://github.com/openvswitch/ovs/commit/816f3bca9f5d23a0cf3b2ec922382f72b7b1b0d6

It likely touches a lot of the files that you may need to modify.

--Justin


> On May 5, 2015, at 9:50 PM, Hao Wu <wuhao.thu at gmail.com> wrote:
> 
> Hi all,
> 
>    I'm trying to add some .h and .c files where my funcs are defined into OVS kernel, that is, path /datapath. So, how to modify the makefile or some other configuration files to make them compiled? 
> 
>   Thanks.
> 
> +++++++++++++++++
> Best,
> Hao
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From wuhao.thu at gmail.com  Tue May  5 22:42:39 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Tue, 5 May 2015 22:42:39 -0700
Subject: [ovs-discuss] To add a file into /datapath,
	how to modify Makefile?
In-Reply-To: <6836D4C0-8F00-43D4-B2DC-CE8BD552710E@nicira.com>
References: <CAHmvmjESiYOktQX6y=9_hbMYUFQD_hnNJeRFQb1K8RX1aVLJiw@mail.gmail.com>
 <6836D4C0-8F00-43D4-B2DC-CE8BD552710E@nicira.com>
Message-ID: <CAHmvmjG65USQYYyGGhdK_qJBfUz=X7CzmMt7HX-kA8gk0rhv1A@mail.gmail.com>

yes. I got it! many thanks!!

+++++++++++++++++
Best,
Hao

On Tue, May 5, 2015 at 10:05 PM, Justin Pettit <jpettit at nicira.com> wrote:

> It's about a year old, but you could look at my commit that adds a
> prototype for elephant flow detection:
>
>
> https://github.com/openvswitch/ovs/commit/816f3bca9f5d23a0cf3b2ec922382f72b7b1b0d6
>
> It likely touches a lot of the files that you may need to modify.
>
> --Justin
>
>
> > On May 5, 2015, at 9:50 PM, Hao Wu <wuhao.thu at gmail.com> wrote:
> >
> > Hi all,
> >
> >    I'm trying to add some .h and .c files where my funcs are defined
> into OVS kernel, that is, path /datapath. So, how to modify the makefile or
> some other configuration files to make them compiled?
> >
> >   Thanks.
> >
> > +++++++++++++++++
> > Best,
> > Hao
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150505/4528a3f8/attachment.html>

From phoracek at redhat.com  Tue May  5 23:53:57 2015
From: phoracek at redhat.com (Petr Horacek)
Date: Wed, 6 May 2015 02:53:57 -0400 (EDT)
Subject: [ovs-discuss] Change slaves of running OVS Bond
In-Reply-To: <1696260050.13561391.1430895018534.JavaMail.zimbra@redhat.com>
Message-ID: <2057399201.13562863.1430895237268.JavaMail.zimbra@redhat.com>

Hello,

is it possible to change slaves of an existing OVS Bonding?
I haven't found another way than just removing existing bond
and adding a new one.

Thanks and best regards,
Petr

From sbiswas7 at linux.vnet.ibm.com  Wed May  6 02:49:48 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Wed, 06 May 2015 15:19:48 +0530
Subject: [ovs-discuss]  Unable to add port to OVS Bridge.
Message-ID: <5549E3BC.4070906@linux.vnet.ibm.com>

Hi,

We are using Openstack to deploy close to 1000 VMs.
Around 5 of the deploys fail with the error:
/
//Unable to add port tap668d1203-84 to OVS bridge br-int: Operation not 
permitted/

The ovs-vswitchd.log file shows:
/
//bridge|WARN|could not open network device tap668d1203-84 (No such device)/

Same is seen during few restart operations on the VMs
There are no additional logs in the ovs logs that would suggest anything 
related to this device.
The OVS version being used here is OVS 2.0.0

Any help on how to debug this issue and what might be causing this?

Thanks,
Sudipto


From davidjoshuaevans at gmail.com  Wed May  6 06:00:07 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Wed, 6 May 2015 08:00:07 -0500
Subject: [ovs-discuss] stat request reply malformatted,
	on new experimenter action.
Message-ID: <CAB8HAh4FoxAb2EONCEyLxw5p5V-J1pSu8DuiHwubqicrrtpRVQ@mail.gmail.com>

Hi Ben,
I have gotten a little further.
My new flow action registers ok in ovs, but when i use ovs-ofctl to dump
the flows, the reply message parser in ovs-ofctl bails out trying to read
the instruction/actions from the message saying that they're an invalid
length.
Do i need a vendor_id specific stats reply or something like that to fix
this?

Cheers,
Dave.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150506/8da583fb/attachment.html>

From blp at nicira.com  Wed May  6 09:02:50 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 6 May 2015 09:02:50 -0700
Subject: [ovs-discuss] Unable to add port to OVS Bridge.
In-Reply-To: <5549E3BC.4070906@linux.vnet.ibm.com>
References: <5549E3BC.4070906@linux.vnet.ibm.com>
Message-ID: <20150506160250.GA11136@nicira.com>

On Wed, May 06, 2015 at 03:19:48PM +0530, Sudipto Biswas wrote:
> We are using Openstack to deploy close to 1000 VMs.
> Around 5 of the deploys fail with the error:
> /
> //Unable to add port tap668d1203-84 to OVS bridge br-int: Operation not
> permitted/
> 
> The ovs-vswitchd.log file shows:
> /
> //bridge|WARN|could not open network device tap668d1203-84 (No such device)/
> 
> Same is seen during few restart operations on the VMs
> There are no additional logs in the ovs logs that would suggest anything
> related to this device.
> The OVS version being used here is OVS 2.0.0
> 
> Any help on how to debug this issue and what might be causing this?

Usually that would mean that the tap had not been created at the point
the request to add the port was issued.

From blp at nicira.com  Wed May  6 09:07:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 6 May 2015 09:07:29 -0700
Subject: [ovs-discuss] Change slaves of running OVS Bond
In-Reply-To: <2057399201.13562863.1430895237268.JavaMail.zimbra@redhat.com>
References: <1696260050.13561391.1430895018534.JavaMail.zimbra@redhat.com>
 <2057399201.13562863.1430895237268.JavaMail.zimbra@redhat.com>
Message-ID: <20150506160729.GB11136@nicira.com>

On Wed, May 06, 2015 at 02:53:57AM -0400, Petr Horacek wrote:
> is it possible to change slaves of an existing OVS Bonding?
> I haven't found another way than just removing existing bond
> and adding a new one.

It's possible, but ovs-vsctl does not have a built-in command to do it.
You can use the database commands to construct these operations by hand,
e.g.:

    blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl add-br br0
    blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl add-bond br0 bond0 eth0 eth1
    blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl --id=@eth0 get Interface eth0 -- remove Port bond0 interfaces @eth0
    blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl --id=@eth2 create Interface name=eth2 -- add Port bond0 interfaces @eth2
    4c582d42-267d-4687-bc15-79461d3cd44c
    blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl show
    88d3c0d3-3669-4146-bb16-f767689b0fed
        Bridge "br0"
            Port "br0"
                Interface "br0"
                    type: internal
            Port "bond0"
                Interface "eth2"
                Interface "eth1"

From haleema.s.mahmood at gmail.com  Tue May  5 22:19:48 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Wed, 6 May 2015 10:19:48 +0500
Subject: [ovs-discuss] OVS Queues min rate not maintained
In-Reply-To: <CAN-u-62YV5OWnDRmVq88FEXL1sv4gTGmubYnZhHBKACysiQMVA@mail.gmail.com>
References: <8hmoogirhv69hndxgw09955k.1430789721187@email.android.com>
 <CAN-u-62YV5OWnDRmVq88FEXL1sv4gTGmubYnZhHBKACysiQMVA@mail.gmail.com>
Message-ID: <CAN-u-63943evmaFATQ9WJkb7SJO6-=P=N1X9WpKOeZBaPxpTQA@mail.gmail.com>

Okay I dug a little deeper in htb queues and I have realized that my
concept was a little messed up. What I thought was if we send packets at a
rate less than that of the minimum rate the egress queue should either stop
it or increase it to its minimum specified rate.

But thats not the case.

On Tue, May 5, 2015 at 11:28 AM, Haleema Sadia <haleema.s.mahmood at gmail.com>
wrote:

> I followed the same tutorial. I am generating traffic through iperf. And
> my topology is from the mininet, one switch and three hosts.
>
> I generate udp packets, with the network bandwidth below the minimum rate.
> And that is what I can't understand. If I have set a minimum rate and my
> specified bandwidth is below it, shouldn't it just stop the packets? or
> perhaps increase the bandwidth till the minimum rate?
>
>
>
> On Tue, May 5, 2015 at 6:35 AM, Manik Sidana <maniksidana019 at gmail.com>
> wrote:
>
>> This is a good short tutorial for qos.
>>
>> http://dannykim.me/danny/openflow/57771?ckattempt=1
>>
>> How are you generating traffic ? One issue could be that the network
>> bandwidth is below the mininum rate that you have specified.
>>
>> Are you using mininet and iperf for your topology?
>>
>>
>> *Sent from Samsung Galaxy Note!!!*
>>
>>
>>
>> -------- Original message --------
>> From: Haleema Sadia <haleema.s.mahmood at gmail.com>
>> Date: 04/05/2015 17:48 (GMT+05:30)
>> To: discuss at openvswitch.org
>> Subject: [ovs-discuss] OVS Queues min rate not maintained
>>
>>
>> Hi everyone,
>>
>> I am trying to configure queues on OVS. The topology I have is one switch
>> and three hosts connected to it. The issue with my queues is that when I
>> give different min and max rates for a queue, the min-rate threshold is not
>> being maintained. The bandwidth goes below the min-rate specified. However,
>> the bandwidth never exceeds the max-rate specified.
>>
>> Can you please explain to me this phenomena? Moreover, where else should
>> I look to understand queues better?
>>
>> Thanks!
>>
>> Haleema.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150506/bd25cb8a/attachment-0001.html>

From vcheruk2 at ncsu.edu  Tue May  5 22:32:07 2015
From: vcheruk2 at ncsu.edu (Venkata Ravichandra Cherukuri)
Date: Wed, 6 May 2015 01:32:07 -0400
Subject: [ovs-discuss] Testing GRE Tunneling in OVS
Message-ID: <CADNT2Wc+dayWbDaBYzMz0qf5bZGtkqmghvvGhO0E6SPgMJjb3A@mail.gmail.com>

Hi all,

    I have configured GRE Tunnel between two switches using the following
command. The simulator that I am using is GENI hence, I won't be able to
use the eth0 interface.

S1 (eth1 192.168.1.10/24) ---------- S2 (eth1 192.168.1.1/24)

S1 Configuration:

/* (For OVS Installation) */
apt-get install openvswitch-switch
apt-get update

/* (For GRE Tunnel Creation) */
ovs-vsctl add-br br0
ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
options:remote_ip=192.168.1.1

S2 Configuration:
apt-get install openvswitch-switch
apt-get update
ovs-vsctl add-br br0
ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
options:remote_ip=192.168.1.10

After completion I have tried pinging the two switches and they are able to
communicate successfully but when I take the pcap file of the communication
between the switches (tcpdump -i eth1 -w testing.pcap) *I am not able to
see the GRE encapsulation over packets. *I have used wire-shark to analyze
the packets.

All I am able to see is ICMP request/reply messages.

root at Node1:~# tcpdump -i eth1
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes
01:28:43.945308 IP 192.168.1.10 > 192.168.1.1: ICMP echo request, id 4322,
seq 10, length 64
01:28:43.945334 IP 192.168.1.1 > 192.168.1.10: ICMP echo reply, id 4322,
seq 10, length 64
01:28:44.945890 IP 192.168.1.10 > 192.168.1.1: ICMP echo request, id 4322,
seq 11, length 64
01:28:44.945907 IP 192.168.1.1 > 192.168.1.10: ICMP echo reply, id 4322,
seq 11, length 64
01:28:45.946464 IP 192.168.1.10 > 192.168.1.1: ICMP echo request, id 4322,
seq 12, length 64


Is this the correct way to test? or
Am I missing something?

Kindly, help.

Thanks,
Venkata Ravichandra Cherukuri,
Student, MS in Computer Networks,
North Carolina State University, Raleigh, NC.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150506/8045f9e6/attachment-0001.html>

From jayachandran.subramanian at wipro.com  Tue May  5 23:33:32 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Wed, 6 May 2015 06:33:32 +0000
Subject: [ovs-discuss] Openvswitch Bug for open flow version 1.2
Message-ID: <SINPR03MB331540BA20CD83BA915F9E395D00@SINPR03MB331.apcprd03.prod.outlook.com>

Hi ,

I would like to report a bug for OpenVSwitch while running OFtest script with openflow version 1.2 and please find the details below

Openvswitch version : openvswitch - 2.3.1
OS version                    : Ubuntu 14.04 Ttusty
Open flow version      : 1.2

I have executed the  GitHub open flow 1.2 version script in openvswitch and observed that script is failing and unable to match the ofp message for eg . (OFPET_GROUP_MOD_FAILED/OFPGMFC_INVALID_GROUP) .

When we are commenting these lines in the script , script successfully passed.

And the same script passed without adding /deleting in the script with Ericsson (of12softswitch)

PFA fail log and pass log for your observation .Kindly let me know the fix for the same.

Thanks
Jayachandran
+91-8861883300


The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150506/3bfd55a2/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: OpenvSwitch Bug-Openflow version1.2.docx
Type: application/vnd.openxmlformats-officedocument.wordprocessingml.document
Size: 12988 bytes
Desc: OpenvSwitch Bug-Openflow version1.2.docx
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150506/3bfd55a2/attachment-0001.docx>

From blp at nicira.com  Wed May  6 10:40:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 6 May 2015 10:40:10 -0700
Subject: [ovs-discuss] stat request reply malformatted,
 on new experimenter action.
In-Reply-To: <CAB8HAh4FoxAb2EONCEyLxw5p5V-J1pSu8DuiHwubqicrrtpRVQ@mail.gmail.com>
References: <CAB8HAh4FoxAb2EONCEyLxw5p5V-J1pSu8DuiHwubqicrrtpRVQ@mail.gmail.com>
Message-ID: <20150506174010.GB17402@nicira.com>

On Wed, May 06, 2015 at 08:00:07AM -0500, David Evans wrote:
> I have gotten a little further.
> My new flow action registers ok in ovs, but when i use ovs-ofctl to dump
> the flows, the reply message parser in ovs-ofctl bails out trying to read
> the instruction/actions from the message saying that they're an invalid
> length.
> Do i need a vendor_id specific stats reply or something like that to fix
> this?

It seems likely that the encode_*() function that you wrote does not
properly encode the new action.  Does it use the generated
ofpact_put_*() function to encode the action?  I would also check the
hexdump for the action to make sure that it has the expected format.

You do need a "vendor extension" or "experimenter" action but the
generated ofpact_put_*() function should take care of that for you.

From blp at nicira.com  Wed May  6 10:41:22 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 6 May 2015 10:41:22 -0700
Subject: [ovs-discuss] Testing GRE Tunneling in OVS
In-Reply-To: <CADNT2Wc+dayWbDaBYzMz0qf5bZGtkqmghvvGhO0E6SPgMJjb3A@mail.gmail.com>
References: <CADNT2Wc+dayWbDaBYzMz0qf5bZGtkqmghvvGhO0E6SPgMJjb3A@mail.gmail.com>
Message-ID: <20150506174122.GC17402@nicira.com>

On Wed, May 06, 2015 at 01:32:07AM -0400, Venkata Ravichandra Cherukuri wrote:
> Hi all,
> 
>     I have configured GRE Tunnel between two switches using the following
> command. The simulator that I am using is GENI hence, I won't be able to
> use the eth0 interface.
> 
> S1 (eth1 192.168.1.10/24) ---------- S2 (eth1 192.168.1.1/24)
> 
> S1 Configuration:
> 
> /* (For OVS Installation) */
> apt-get install openvswitch-switch
> apt-get update
> 
> /* (For GRE Tunnel Creation) */
> ovs-vsctl add-br br0
> ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> options:remote_ip=192.168.1.1
> 
> S2 Configuration:
> apt-get install openvswitch-switch
> apt-get update
> ovs-vsctl add-br br0
> ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> options:remote_ip=192.168.1.10
> 
> After completion I have tried pinging the two switches and they are able to
> communicate successfully but when I take the pcap file of the communication
> between the switches (tcpdump -i eth1 -w testing.pcap) *I am not able to
> see the GRE encapsulation over packets. *I have used wire-shark to analyze
> the packets.

What did you use to direct traffic into the tunnels?

From blp at nicira.com  Wed May  6 10:48:49 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 6 May 2015 10:48:49 -0700
Subject: [ovs-discuss] Testing GRE Tunneling in OVS
In-Reply-To: <CADNT2WdqRqhry5-x6iTdgT=NM9teBHw8-g+-hqq4_3bgxnPv4g@mail.gmail.com>
References: <CADNT2Wc+dayWbDaBYzMz0qf5bZGtkqmghvvGhO0E6SPgMJjb3A@mail.gmail.com>
 <20150506174122.GC17402@nicira.com>
 <CADNT2WdqRqhry5-x6iTdgT=NM9teBHw8-g+-hqq4_3bgxnPv4g@mail.gmail.com>
Message-ID: <20150506174849.GD17402@nicira.com>

That doesn't direct traffic into the tunnel.

You would normally use an OpenFlow flow to direct traffic to the tunnel.

On Wed, May 06, 2015 at 01:45:21PM -0400, Venkata Ravichandra Cherukuri wrote:
> Hi Ben,
> 
>     I have used normal "ping" to generate traffic.
> 
> From S1 I tried to ping S2 using "ping 192,168.1.1"
> 
> Best Regards,
> Venkata Ravichandra Cherukuri,
> Student, MS in Computer Networks,
> North Carolina State University, Raleigh, NC.
> 
> On Wed, May 6, 2015 at 1:41 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, May 06, 2015 at 01:32:07AM -0400, Venkata Ravichandra Cherukuri
> > wrote:
> > > Hi all,
> > >
> > >     I have configured GRE Tunnel between two switches using the following
> > > command. The simulator that I am using is GENI hence, I won't be able to
> > > use the eth0 interface.
> > >
> > > S1 (eth1 192.168.1.10/24) ---------- S2 (eth1 192.168.1.1/24)
> > >
> > > S1 Configuration:
> > >
> > > /* (For OVS Installation) */
> > > apt-get install openvswitch-switch
> > > apt-get update
> > >
> > > /* (For GRE Tunnel Creation) */
> > > ovs-vsctl add-br br0
> > > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> > > options:remote_ip=192.168.1.1
> > >
> > > S2 Configuration:
> > > apt-get install openvswitch-switch
> > > apt-get update
> > > ovs-vsctl add-br br0
> > > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> > > options:remote_ip=192.168.1.10
> > >
> > > After completion I have tried pinging the two switches and they are able
> > to
> > > communicate successfully but when I take the pcap file of the
> > communication
> > > between the switches (tcpdump -i eth1 -w testing.pcap) *I am not able to
> > > see the GRE encapsulation over packets. *I have used wire-shark to
> > analyze
> > > the packets.
> >
> > What did you use to direct traffic into the tunnels?
> >

From vcheruk2 at ncsu.edu  Wed May  6 10:45:21 2015
From: vcheruk2 at ncsu.edu (Venkata Ravichandra Cherukuri)
Date: Wed, 6 May 2015 13:45:21 -0400
Subject: [ovs-discuss] Testing GRE Tunneling in OVS
In-Reply-To: <20150506174122.GC17402@nicira.com>
References: <CADNT2Wc+dayWbDaBYzMz0qf5bZGtkqmghvvGhO0E6SPgMJjb3A@mail.gmail.com>
 <20150506174122.GC17402@nicira.com>
Message-ID: <CADNT2WdqRqhry5-x6iTdgT=NM9teBHw8-g+-hqq4_3bgxnPv4g@mail.gmail.com>

Hi Ben,

    I have used normal "ping" to generate traffic.

>From S1 I tried to ping S2 using "ping 192,168.1.1"

Best Regards,
Venkata Ravichandra Cherukuri,
Student, MS in Computer Networks,
North Carolina State University, Raleigh, NC.

On Wed, May 6, 2015 at 1:41 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, May 06, 2015 at 01:32:07AM -0400, Venkata Ravichandra Cherukuri
> wrote:
> > Hi all,
> >
> >     I have configured GRE Tunnel between two switches using the following
> > command. The simulator that I am using is GENI hence, I won't be able to
> > use the eth0 interface.
> >
> > S1 (eth1 192.168.1.10/24) ---------- S2 (eth1 192.168.1.1/24)
> >
> > S1 Configuration:
> >
> > /* (For OVS Installation) */
> > apt-get install openvswitch-switch
> > apt-get update
> >
> > /* (For GRE Tunnel Creation) */
> > ovs-vsctl add-br br0
> > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> > options:remote_ip=192.168.1.1
> >
> > S2 Configuration:
> > apt-get install openvswitch-switch
> > apt-get update
> > ovs-vsctl add-br br0
> > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> > options:remote_ip=192.168.1.10
> >
> > After completion I have tried pinging the two switches and they are able
> to
> > communicate successfully but when I take the pcap file of the
> communication
> > between the switches (tcpdump -i eth1 -w testing.pcap) *I am not able to
> > see the GRE encapsulation over packets. *I have used wire-shark to
> analyze
> > the packets.
>
> What did you use to direct traffic into the tunnels?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150506/8c306eeb/attachment.html>

From davidjoshuaevans at gmail.com  Wed May  6 15:58:20 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Wed, 06 May 2015 17:58:20 -0500
Subject: [ovs-discuss] stat request reply malformatted,
 on new experimenter action.
In-Reply-To: <20150506174010.GB17402@nicira.com>
References: <CAB8HAh4FoxAb2EONCEyLxw5p5V-J1pSu8DuiHwubqicrrtpRVQ@mail.gmail.com>
 <20150506174010.GB17402@nicira.com>
Message-ID: <D1700094.27FAF%davidjoshuaevans@gmail.com>

Thank you.
That was helpful.
I found that using the default ofpact_put* failed. And I used
ofpact_put_raw() instead. I don¹t know why. But I kept getting illegal
length not %8 from ovs-ofctl.

Now I see some compose_* actions in the ofproto-dpif-xlate.c
But I don¹t see how anything turns from a OFPACT_* into an
OVS_ACTION_ATTR_* ?
Where does this part of the translation from openflow action to datapath
action happen.
I don¹t see any tables, or comparison items that would lead me to be able
to match my OVS_ACTION_ATTR_FOO_MY_PKTS against my new ofp_raw_action_type
Value DE_RAW_FOO_MY_PKTS action.

I think do_xlate_actions is supposed to build a ctx for this but I am at
a loss to understand how I do the above.

Regards,
Dave.


On 5/6/15, 12:40 PM, "Ben Pfaff" <blp at nicira.com> wrote:

>On Wed, May 06, 2015 at 08:00:07AM -0500, David Evans wrote:
>> I have gotten a little further.
>> My new flow action registers ok in ovs, but when i use ovs-ofctl to dump
>> the flows, the reply message parser in ovs-ofctl bails out trying to
>>read
>> the instruction/actions from the message saying that they're an invalid
>> length.
>> Do i need a vendor_id specific stats reply or something like that to fix
>> this?
>
>It seems likely that the encode_*() function that you wrote does not
>properly encode the new action.  Does it use the generated
>ofpact_put_*() function to encode the action?  I would also check the
>hexdump for the action to make sure that it has the expected format.
>
>You do need a "vendor extension" or "experimenter" action but the
>generated ofpact_put_*() function should take care of that for you.



From fbl at sysclose.org  Wed May  6 19:14:37 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Wed, 6 May 2015 23:14:37 -0300
Subject: [ovs-discuss] ovs-docker: why need to use veth pair instead of
 internal port?
In-Reply-To: <CAHbON5q-XTrTYgKN-NTO5mNs-R9OMKBhrujgcXWxjD=-4=qWOg@mail.gmail.com>
References: <CADtzDC=BUjAgPThRjQwHKg+Ff-15vLnRa98dtiH+MnBmhq4PpA@mail.gmail.com>
 <CANb-gXSKJwxxubXf1Z77O1vx834u+Wzo2sB=xwreNdmuNmEs8Q@mail.gmail.com>
 <CADtzDC=v1_tOGpE3ZNCUpjAc=cCvU31354WZ8uURxJEHP__a4w@mail.gmail.com>
 <CAHbON5pATRCwOEU+Aoms+oWG7zp9X_w3sAetaJ9AaLALSKh59g@mail.gmail.com>
 <20150428142520.7501e6c6@x240.home>
 <CADtzDCkvAb5on2Qo6dZ+rtDwfPcj9DSG4ZykHdk6hjvhSiq6vw@mail.gmail.com>
 <CAHbON5q-XTrTYgKN-NTO5mNs-R9OMKBhrujgcXWxjD=-4=qWOg@mail.gmail.com>
Message-ID: <20150507021437.GA13136@x240.home>

On Wed, Apr 29, 2015 at 08:28:19AM -0700, Gurucharan Shetty wrote:
> >>
> >
> > Make sense. So it seems not worth the effort of replacing veth pairs
> > by internal ports, if there is no or little performance penalty,
> > according to your test results.
> I have personally not done any testing, so I have heard conflicting reports.
> There are a couple of blog entries which show that OVS internal
> devices perform a lot better.
> http://www.opencloudblog.com/?p=96

I blogged my analysis and results here:
http://flavioleitner.blogspot.com.br/2015/05/open-vswitch-internal-ports-and-linux.html

fbl


From djhon9813 at gmail.com  Wed May  6 22:46:23 2015
From: djhon9813 at gmail.com (david jhon)
Date: Thu, 7 May 2015 10:46:23 +0500
Subject: [ovs-discuss] Deploying a multi-tenant datacenter testbed using GENI
Message-ID: <CANPUzQ15qUDuWT9SNv6-+JiDB6z1UhcA_=JRUnyyy9k9n1M_Zw@mail.gmail.com>

Hello everyone,

I apologize if it is not a relevant question but I need an honest advice
from you.

I want to deploy a testbed on GENI for my thesis research. The testbed I
want to deploy is a multi-tenant datacenter with sixteen physical hosts,
eight edge switches, eight aggregate switches and four core switches,
basically a fat-tree topology with k=4. Topology should run multiple
tenants on physical hosts setting-up with GRE tunnels. I tried to use
mininet for this purpose but it is not suitable for simulating this kind of
testbed. Please let me know if it is possible to deploy a testbed for
multi-tenant datacenter using GENI.

I'll be really grateful for your valuable guideline/help. Thanking you in
advance.

Regards,
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150507/b8bcba33/attachment.html>

From nick.bastin at gmail.com  Wed May  6 22:51:29 2015
From: nick.bastin at gmail.com (Nicholas Bastin)
Date: Wed, 6 May 2015 23:51:29 -0600
Subject: [ovs-discuss] Deploying a multi-tenant datacenter testbed using
	GENI
In-Reply-To: <CANPUzQ15qUDuWT9SNv6-+JiDB6z1UhcA_=JRUnyyy9k9n1M_Zw@mail.gmail.com>
References: <CANPUzQ15qUDuWT9SNv6-+JiDB6z1UhcA_=JRUnyyy9k9n1M_Zw@mail.gmail.com>
Message-ID: <CADmMkWeVPNgJn4HcOqiW_6nbKO-yBG8PB6ovOesvA8pY1BpVYg@mail.gmail.com>

On Wed, May 6, 2015 at 11:46 PM, david jhon <djhon9813 at gmail.com> wrote:

> I apologize if it is not a relevant question but I need an honest advice
> from you.
>

These are not the right lists for this question - you'll want to join the
geni-users google group (https://groups.google.com/forum/#!forum/geni-users)

--
Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150506/1339e1a7/attachment.html>

From phoracek at redhat.com  Wed May  6 23:07:40 2015
From: phoracek at redhat.com (Petr Horacek)
Date: Thu, 7 May 2015 02:07:40 -0400 (EDT)
Subject: [ovs-discuss] Change slaves of running OVS Bond
In-Reply-To: <20150506160729.GB11136@nicira.com>
References: <1696260050.13561391.1430895018534.JavaMail.zimbra@redhat.com>
 <2057399201.13562863.1430895237268.JavaMail.zimbra@redhat.com>
 <20150506160729.GB11136@nicira.com>
Message-ID: <38074325.14765656.1430978860795.JavaMail.zimbra@redhat.com>

----- Original Message -----
> From: "Ben Pfaff" <blp at nicira.com>
> To: "Petr Horacek" <phoracek at redhat.com>
> Cc: discuss at openvswitch.org
> Sent: Wednesday, May 6, 2015 6:07:29 PM
> Subject: Re: [ovs-discuss] Change slaves of running OVS Bond
> 
> On Wed, May 06, 2015 at 02:53:57AM -0400, Petr Horacek wrote:
> > is it possible to change slaves of an existing OVS Bonding?
> > I haven't found another way than just removing existing bond
> > and adding a new one.
> 
> It's possible, but ovs-vsctl does not have a built-in command to do it.
> You can use the database commands to construct these operations by hand,
> e.g.:
> 
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl add-br br0
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl add-bond br0 bond0 eth0
>     eth1
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl --id=@eth0 get Interface
>     eth0 -- remove Port bond0 interfaces @eth0
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl --id=@eth2 create
>     Interface name=eth2 -- add Port bond0 interfaces @eth2
>     4c582d42-267d-4687-bc15-79461d3cd44c
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl show
>     88d3c0d3-3669-4146-bb16-f767689b0fed
>         Bridge "br0"
>             Port "br0"
>                 Interface "br0"
>                     type: internal
>             Port "bond0"
>                 Interface "eth2"
>                 Interface "eth1"
> 
Thanks a lot! :)

From gowrishankar.m at linux.vnet.ibm.com  Wed May  6 23:10:22 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Thu, 07 May 2015 11:40:22 +0530
Subject: [ovs-discuss] Testing GRE Tunneling in OVS
In-Reply-To: <CADNT2WdqRqhry5-x6iTdgT=NM9teBHw8-g+-hqq4_3bgxnPv4g@mail.gmail.com>
References: <CADNT2Wc+dayWbDaBYzMz0qf5bZGtkqmghvvGhO0E6SPgMJjb3A@mail.gmail.com>
 <20150506174122.GC17402@nicira.com>
 <CADNT2WdqRqhry5-x6iTdgT=NM9teBHw8-g+-hqq4_3bgxnPv4g@mail.gmail.com>
Message-ID: <554B01CE.7030306@linux.vnet.ibm.com>

You would need tunnel endpoints to complete tunnel setup.

add-port br0 tep0 -- set interface tep0 type=internal (in each switch)

Assign a private subnet IP on tep0 (different than 192.168.1.x) and then 
you would see GRE encapsulated packets
on pinging tep0.

Regards,
Gowrishankar


On Wednesday 06 May 2015 11:15 PM, Venkata Ravichandra Cherukuri wrote:
> Hi Ben,
>
>     I have used normal "ping" to generate traffic.
>
> From S1 I tried to ping S2 using "ping 192,168.1.1"
>
> Best Regards,
> Venkata Ravichandra Cherukuri,
> Student, MS in Computer Networks,
> North Carolina State University, Raleigh, NC.
>
> On Wed, May 6, 2015 at 1:41 PM, Ben Pfaff <blp at nicira.com 
> <mailto:blp at nicira.com>> wrote:
>
>     On Wed, May 06, 2015 at 01:32:07AM -0400, Venkata Ravichandra
>     Cherukuri wrote:
>     > Hi all,
>     >
>     >     I have configured GRE Tunnel between two switches using the
>     following
>     > command. The simulator that I am using is GENI hence, I won't be
>     able to
>     > use the eth0 interface.
>     >
>     > S1 (eth1 192.168.1.10/24 <http://192.168.1.10/24>) ---------- S2
>     (eth1 192.168.1.1/24 <http://192.168.1.1/24>)
>     >
>     > S1 Configuration:
>     >
>     > /* (For OVS Installation) */
>     > apt-get install openvswitch-switch
>     > apt-get update
>     >
>     > /* (For GRE Tunnel Creation) */
>     > ovs-vsctl add-br br0
>     > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
>     > options:remote_ip=192.168.1.1
>     >
>     > S2 Configuration:
>     > apt-get install openvswitch-switch
>     > apt-get update
>     > ovs-vsctl add-br br0
>     > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
>     > options:remote_ip=192.168.1.10
>     >
>     > After completion I have tried pinging the two switches and they
>     are able to
>     > communicate successfully but when I take the pcap file of the
>     communication
>     > between the switches (tcpdump -i eth1 -w testing.pcap) *I am not
>     able to
>     > see the GRE encapsulation over packets. *I have used wire-shark
>     to analyze
>     > the packets.
>
>     What did you use to direct traffic into the tunnels?
>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


-- 
Regards,
Gowrishankar M
Linux Networking

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150507/9eb18fa2/attachment-0001.html>

From sbiswas7 at linux.vnet.ibm.com  Thu May  7 03:13:45 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Thu, 07 May 2015 15:43:45 +0530
Subject: [ovs-discuss] Unable to add port to OVS Bridge.
In-Reply-To: <20150506160250.GA11136@nicira.com>
References: <5549E3BC.4070906@linux.vnet.ibm.com>
 <20150506160250.GA11136@nicira.com>
Message-ID: <554B3AD9.8090100@linux.vnet.ibm.com>


On Wednesday 06 May 2015 09:32 PM, Ben Pfaff wrote:
> On Wed, May 06, 2015 at 03:19:48PM +0530, Sudipto Biswas wrote:
>> We are using Openstack to deploy close to 1000 VMs.
>> Around 5 of the deploys fail with the error:
>> /
>> //Unable to add port tap668d1203-84 to OVS bridge br-int: Operation not
>> permitted/
>>
>> The ovs-vswitchd.log file shows:
>> /
>> //bridge|WARN|could not open network device tap668d1203-84 (No such device)/
>>
>> Same is seen during few restart operations on the VMs
>> There are no additional logs in the ovs logs that would suggest anything
>> related to this device.
>> The OVS version being used here is OVS 2.0.0
>>
>> Any help on how to debug this issue and what might be causing this?
> Usually that would mean that the tap had not been created at the point
> the request to add the port was issued.
Thx Ben. In ovs 2.0.0 - I could add any device (without creating it 
using ip link add) to the bridge without any issues.
I saw that this behavior has changed in 2.3.1 where the device should 
have to be created prior to the request.

In the present deployment, OVS 2.0.0 is being used. Even though, 
openstack is expected to create the device, would you
suggest that something on the kernel wasn't able to create this device 
successfully before the add-port was fired (and that is a must for the 
port to get added)?




From vcheruk2 at ncsu.edu  Wed May  6 11:00:22 2015
From: vcheruk2 at ncsu.edu (Venkata Ravichandra Cherukuri)
Date: Wed, 6 May 2015 14:00:22 -0400
Subject: [ovs-discuss] Testing GRE Tunneling in OVS
In-Reply-To: <20150506174849.GD17402@nicira.com>
References: <CADNT2Wc+dayWbDaBYzMz0qf5bZGtkqmghvvGhO0E6SPgMJjb3A@mail.gmail.com>
 <20150506174122.GC17402@nicira.com>
 <CADNT2WdqRqhry5-x6iTdgT=NM9teBHw8-g+-hqq4_3bgxnPv4g@mail.gmail.com>
 <20150506174849.GD17402@nicira.com>
Message-ID: <CADNT2WfrWq9Uk4P0FEsBwJqab1YS9gzi2kiuht8CX+eruq8JCA@mail.gmail.com>

Please correct me if I am wrong.

I have added flows already ( sorry for not mentioning it earlier.)

S1:
ovs-ofctl add-flow br0 in_port=1,actions=output:2 (where my logical port 1
is gre0 and logical 2 is eth1).

S2:
ovs-ofctl add-flow br0 in_port=1,actions=output:2 (where my logical port 1
is gre0 and logical 2 is eth1).

I am sure that this is not the perfect flow but this should atleast give me
partial result when I analyze the pcap.

Thanks for the quick revert.


Best Regards,
Venkata Ravichandra Cherukuri,
Student, MS in Computer Networks,
North Carolina State University, Raleigh, NC.
+1 919 590 2168

On Wed, May 6, 2015 at 1:48 PM, Ben Pfaff <blp at nicira.com> wrote:

> That doesn't direct traffic into the tunnel.
>
> You would normally use an OpenFlow flow to direct traffic to the tunnel.
>
> On Wed, May 06, 2015 at 01:45:21PM -0400, Venkata Ravichandra Cherukuri
> wrote:
> > Hi Ben,
> >
> >     I have used normal "ping" to generate traffic.
> >
> > From S1 I tried to ping S2 using "ping 192,168.1.1"
> >
> > Best Regards,
> > Venkata Ravichandra Cherukuri,
> > Student, MS in Computer Networks,
> > North Carolina State University, Raleigh, NC.
> >
> > On Wed, May 6, 2015 at 1:41 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Wed, May 06, 2015 at 01:32:07AM -0400, Venkata Ravichandra Cherukuri
> > > wrote:
> > > > Hi all,
> > > >
> > > >     I have configured GRE Tunnel between two switches using the
> following
> > > > command. The simulator that I am using is GENI hence, I won't be
> able to
> > > > use the eth0 interface.
> > > >
> > > > S1 (eth1 192.168.1.10/24) ---------- S2 (eth1 192.168.1.1/24)
> > > >
> > > > S1 Configuration:
> > > >
> > > > /* (For OVS Installation) */
> > > > apt-get install openvswitch-switch
> > > > apt-get update
> > > >
> > > > /* (For GRE Tunnel Creation) */
> > > > ovs-vsctl add-br br0
> > > > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> > > > options:remote_ip=192.168.1.1
> > > >
> > > > S2 Configuration:
> > > > apt-get install openvswitch-switch
> > > > apt-get update
> > > > ovs-vsctl add-br br0
> > > > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> > > > options:remote_ip=192.168.1.10
> > > >
> > > > After completion I have tried pinging the two switches and they are
> able
> > > to
> > > > communicate successfully but when I take the pcap file of the
> > > communication
> > > > between the switches (tcpdump -i eth1 -w testing.pcap) *I am not
> able to
> > > > see the GRE encapsulation over packets. *I have used wire-shark to
> > > analyze
> > > > the packets.
> > >
> > > What did you use to direct traffic into the tunnels?
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150506/6350c63b/attachment-0001.html>

From vkg.2006 at gmail.com  Wed May  6 14:52:16 2015
From: vkg.2006 at gmail.com (Vipin Garg)
Date: Wed, 6 May 2015 14:52:16 -0700
Subject: [ovs-discuss] OVS-OFCTL - negotiated OpenFlow version
Message-ID: <CAKv4ra8DB65THD48uLqEegD-cm5O-uGhzWsaCEBP5+eRQD-E-Q@mail.gmail.com>

Hello,

I am trying to update the status of one of the port using following command
-


data2 # ./ovs-ofctl mod-port  vlan20-odl sp4 up

And I got following error message ...

2015-05-06T20:52:49Z|00001|vconn|WARN|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt:
version negotiation failed (we support version 0x01, peer supports version
0x04)
ovs-ofctl: vlan20-odl: failed to connect to socket (Protocol error)


As suggested on some mailing list, I added openflow versions as follows -

./ovs-vsctl set bridge vlan20-odl
protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15

and then again update the port ..

./ovs-ofctl --verbose mod-port  vlan20-odl sp4 up

In the logs, I see that --

2015-05-06T21:39:55Z|00015|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt:
negotiated OpenFlow version 0x01 (we support version 0x01, peer supports
version 0x06 and earlier)


My question is -

1. Why the negotiated OF version is 1 (not 1.4) when peer (OpenDayLight )
can support higher version
2 How can I make  trained OVS to communicate using higher version of OF ..

3. Why I still don't see port status getting update , Am I missing
something ?

Thanks

Vipin Garg

Fortinet ..
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150506/4ee90da1/attachment-0001.html>
-------------- next part --------------
/data2 # ./ovs-ofctl --verbose mod-port  vlan20-odl sp2 up
2015-05-06T21:39:55Z|00001|stream_unix|DBG|/usr/local/var/run/openvswitch/vlan20-odl: connection failed (No such file or directory)
2015-05-06T21:39:55Z|00002|ofctl|DBG|connecting to unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt
2015-05-06T21:39:55Z|00003|hmap|DBG|lib/ofp-msgs.c:1080: 8 nodes in bucket (32 nodes, 16 buckets)
2015-05-06T21:39:55Z|00004|hmap|DBG|lib/ofp-msgs.c:1080: 8 nodes in bucket (64 nodes, 32 buckets)
2015-05-06T21:39:55Z|00005|hmap|DBG|lib/ofp-msgs.c:1080: 6 nodes in bucket (128 nodes, 64 buckets)
2015-05-06T21:39:55Z|00006|hmap|DBG|lib/ofp-msgs.c:1080: 6 nodes in bucket (256 nodes, 128 buckets)
2015-05-06T21:39:55Z|00007|hmap|DBG|lib/ofp-msgs.c:1080: 6 nodes in bucket (256 nodes, 128 buckets)
2015-05-06T21:39:55Z|00008|hmap|DBG|lib/ofp-msgs.c:1080: 6 nodes in bucket (512 nodes, 256 buckets)
2015-05-06T21:39:55Z|00009|hmap|DBG|lib/ofp-msgs.c:1080: 6 nodes in bucket (512 nodes, 256 buckets)
2015-05-06T21:39:55Z|00010|hmap|DBG|lib/ofp-msgs.c:1080: 6 nodes in bucket (512 nodes, 256 buckets)
2015-05-06T21:39:55Z|00011|hmap|DBG|lib/ofp-msgs.c:1080: 6 nodes in bucket (512 nodes, 256 buckets)
2015-05-06T21:39:55Z|00012|hmap|DBG|lib/ofp-msgs.c:1080: 7 nodes in bucket (512 nodes, 256 buckets)
2015-05-06T21:39:55Z|00013|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: sent (Success): OFPT_HELLO (xid=0x1):
 version bitmap: 0x01
2015-05-06T21:39:55Z|00014|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: received: OFPT_HELLO (OF1.5) (xid=0x11):
 version bitmap: 0x01, 0x02, 0x03, 0x04, 0x05, 0x06
2015-05-06T21:39:55Z|00015|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: negotiated OpenFlow version 0x01 (we support version 0x01, peer supports version 0x06 and earlier)
2015-05-06T21:39:55Z|00016|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: sent (Success): OFPT_FEATURES_REQUEST (xid=0x2):
2015-05-06T21:39:55Z|00017|poll_loop|DBG|wakeup due to 0-ms timeout
2015-05-06T21:39:55Z|00018|poll_loop|DBG|wakeup due to [POLLIN] on fd 8 (<->/usr/local/var/run/openvswitch/vlan20-odl.mgmt) at lib/stream-fd.c:155
2015-05-06T21:39:55Z|00019|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: received: OFPT_FEATURES_REPLY (xid=0x2): dpid:0000001a4aa8be06
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
 1(sp10): addr:00:1a:4a:a8:be:06
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 2(sp2): addr:00:00:00:00:00:00
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 3(sp3): addr:00:00:00:00:00:00
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
2015-05-06T21:39:55Z|00020|stream_unix|DBG|/usr/local/var/run/openvswitch/vlan20-odl: connection failed (No such file or directory)
2015-05-06T21:39:55Z|00021|ofctl|DBG|connecting to unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt
2015-05-06T21:39:55Z|00022|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: sent (Success): OFPT_HELLO (xid=0x3):
 version bitmap: 0x01
2015-05-06T21:39:55Z|00023|poll_loop|DBG|wakeup due to [POLLIN] on fd 8 (<->/usr/local/var/run/openvswitch/vlan20-odl.mgmt) at lib/stream-fd.c:155
2015-05-06T21:39:55Z|00024|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: received: OFPT_HELLO (OF1.5) (xid=0x12):
 version bitmap: 0x01, 0x02, 0x03, 0x04, 0x05, 0x06
2015-05-06T21:39:55Z|00025|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: negotiated OpenFlow version 0x01 (we support version 0x01, peer supports version 0x06 and earlier)
2015-05-06T21:39:55Z|00026|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: sent (Success): OFPT_PORT_MOD (xid=0x4):port: 2: addr:00:00:00:00:00:00
     config: 0
     mask:   PORT_DOWN
     advertise: UNCHANGED
2015-05-06T21:39:55Z|00027|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: sent (Success): OFPT_BARRIER_REQUEST (xid=0x5):
2015-05-06T21:39:55Z|00028|poll_loop|DBG|wakeup due to [POLLIN] on fd 8 (<->/usr/local/var/run/openvswitch/vlan20-odl.mgmt) at lib/stream-fd.c:155
2015-05-06T21:39:55Z|00029|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt: received: OFPT_BARRIER_REPLY (xid=0x5):

From blp at nicira.com  Thu May  7 09:53:22 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 7 May 2015 09:53:22 -0700
Subject: [ovs-discuss] Unable to add port to OVS Bridge.
In-Reply-To: <554B3AD9.8090100@linux.vnet.ibm.com>
References: <5549E3BC.4070906@linux.vnet.ibm.com>
 <20150506160250.GA11136@nicira.com>
 <554B3AD9.8090100@linux.vnet.ibm.com>
Message-ID: <20150507165322.GB20879@nicira.com>

On Thu, May 07, 2015 at 03:43:45PM +0530, Sudipto Biswas wrote:
> 
> On Wednesday 06 May 2015 09:32 PM, Ben Pfaff wrote:
> >On Wed, May 06, 2015 at 03:19:48PM +0530, Sudipto Biswas wrote:
> >>We are using Openstack to deploy close to 1000 VMs.
> >>Around 5 of the deploys fail with the error:
> >>/
> >>//Unable to add port tap668d1203-84 to OVS bridge br-int: Operation not
> >>permitted/
> >>
> >>The ovs-vswitchd.log file shows:
> >>/
> >>//bridge|WARN|could not open network device tap668d1203-84 (No such device)/
> >>
> >>Same is seen during few restart operations on the VMs
> >>There are no additional logs in the ovs logs that would suggest anything
> >>related to this device.
> >>The OVS version being used here is OVS 2.0.0
> >>
> >>Any help on how to debug this issue and what might be causing this?
> >Usually that would mean that the tap had not been created at the point
> >the request to add the port was issued.
> Thx Ben. In ovs 2.0.0 - I could add any device (without creating it
> using ip link add) to the bridge without any issues.
> I saw that this behavior has changed in 2.3.1 where the device
> should have to be created prior to the request.
> 
> In the present deployment, OVS 2.0.0 is being used. Even though,
> openstack is expected to create the device, would you
> suggest that something on the kernel wasn't able to create this
> device successfully before the add-port was fired (and that is a
> must for the port to get added)?

There has been no change from one OVS version to another on this
point.  If you perceive a change, it is probably due to some timing
difference.

I don't understand your new question.

From blp at nicira.com  Thu May  7 09:54:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 7 May 2015 09:54:41 -0700
Subject: [ovs-discuss] stat request reply malformatted,
 on new experimenter action.
In-Reply-To: <D1700094.27FAF%davidjoshuaevans@gmail.com>
References: <CAB8HAh4FoxAb2EONCEyLxw5p5V-J1pSu8DuiHwubqicrrtpRVQ@mail.gmail.com>
 <20150506174010.GB17402@nicira.com>
 <D1700094.27FAF%davidjoshuaevans@gmail.com>
Message-ID: <20150507165441.GC20879@nicira.com>

On Wed, May 06, 2015 at 05:58:20PM -0500, David Evans wrote:
> Now I see some compose_* actions in the ofproto-dpif-xlate.c
> But I don?t see how anything turns from a OFPACT_* into an
> OVS_ACTION_ATTR_* ?
> Where does this part of the translation from openflow action to datapath
> action happen.
> I don?t see any tables, or comparison items that would lead me to be able
> to match my OVS_ACTION_ATTR_FOO_MY_PKTS against my new ofp_raw_action_type
> Value DE_RAW_FOO_MY_PKTS action.

do_xlate_actions() in ofproto-dpif-xlate.c does the translation.

From blp at nicira.com  Thu May  7 10:45:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 7 May 2015 10:45:44 -0700
Subject: [ovs-discuss] OVS-OFCTL - negotiated OpenFlow version
In-Reply-To: <CAKv4ra8DB65THD48uLqEegD-cm5O-uGhzWsaCEBP5+eRQD-E-Q@mail.gmail.com>
References: <CAKv4ra8DB65THD48uLqEegD-cm5O-uGhzWsaCEBP5+eRQD-E-Q@mail.gmail.com>
Message-ID: <20150507174544.GC25694@nicira.com>

On Wed, May 06, 2015 at 02:52:16PM -0700, Vipin Garg wrote:
> I am trying to update the status of one of the port using following command
> -
> 
> 
> data2 # ./ovs-ofctl mod-port  vlan20-odl sp4 up
> 
> And I got following error message ...
> 
> 2015-05-06T20:52:49Z|00001|vconn|WARN|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt:
> version negotiation failed (we support version 0x01, peer supports version
> 0x04)
> ovs-ofctl: vlan20-odl: failed to connect to socket (Protocol error)
> 
> 
> As suggested on some mailing list, I added openflow versions as follows -
> 
> ./ovs-vsctl set bridge vlan20-odl
> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
> 
> and then again update the port ..
> 
> ./ovs-ofctl --verbose mod-port  vlan20-odl sp4 up
> 
> In the logs, I see that --
> 
> 2015-05-06T21:39:55Z|00015|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt:
> negotiated OpenFlow version 0x01 (we support version 0x01, peer supports
> version 0x06 and earlier)
> 
> 
> My question is -
> 
> 1. Why the negotiated OF version is 1 (not 1.4) when peer (OpenDayLight )
> can support higher version

ovs-ofctl isn't OpenDaylight.  ovs-ofctl defaults to supporting only
OF version 1.0.

> 2 How can I make  trained OVS to communicate using higher version of OF ..

This is in the FAQ.

### Q: What versions of OpenFlow does Open vSwitch support?

A: The following table lists the versions of OpenFlow supported by
   each version of Open vSwitch:

       Open vSwitch      OF1.0  OF1.1  OF1.2  OF1.3  OF1.4  OF1.5
       ###============   =====  =====  =====  =====  =====  =====
       1.9 and earlier    yes    ---    ---    ---    ---    ---
       1.10               yes    ---    [*]    [*]    ---    ---
       1.11               yes    ---    [*]    [*]    ---    ---
       2.0                yes    [*]    [*]    [*]    ---    ---
       2.1                yes    [*]    [*]    [*]    ---    ---
       2.2                yes    [*]    [*]    [*]    [%]    [*]
       2.3                yes    yes    yes    yes    [*]    [*]

       [*] Supported, with one or more missing features.
       [%] Experimental, unsafe implementation.

   Open vSwitch 2.3 enables OpenFlow 1.0, 1.1, 1.2, and 1.3 by default
   in ovs-vswitchd.  In Open vSwitch 1.10 through 2.2, OpenFlow 1.1,
   1.2, and 1.3 must be enabled manually in ovs-vswitchd.  OpenFlow
   1.4 and 1.5 are also supported, with missing features, in Open
   vSwitch 2.3 and later, but not enabled by default.  In any case,
   the user may override the default:

   - To enable OpenFlow 1.0, 1.1, 1.2, and 1.3 on bridge br0:

     ovs-vsctl set bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13

   - To enable OpenFlow 1.0, 1.1, 1.2, 1.3, 1.4, and 1.5 on bridge br0:

     ovs-vsctl set bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15

   - To enable only OpenFlow 1.0 on bridge br0:

     ovs-vsctl set bridge br0 protocols=OpenFlow10

   All current versions of ovs-ofctl enable only OpenFlow 1.0 by
   default.  Use the -O option to enable support for later versions of
   OpenFlow in ovs-ofctl.  For example:

       ovs-ofctl -O OpenFlow13 dump-flows br0

   (Open vSwitch 2.2 had an experimental implementation of OpenFlow
   1.4 that could cause crashes.  We don't recommend enabling it.)

   [OPENFLOW-1.1+.md] in the Open vSwitch source tree tracks support for
   OpenFlow 1.1 and later features.  When support for OpenFlow 1.4 and
   1.5 is solidly implemented, Open vSwitch will enable those version
   by default.  Also, the OpenFlow 1.5 specification is still under
   development and thus subject to change.

> 3. Why I still don't see port status getting update , Am I missing
> something ?

I would expect to see the PORT_DOWN going away quickly after "mod-port
up".  In a test I ran just now, I did see it go away.  You see
something else?

From blp at nicira.com  Thu May  7 16:11:23 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 7 May 2015 16:11:23 -0700
Subject: [ovs-discuss] Testing GRE Tunneling in OVS
In-Reply-To: <CADNT2WfrWq9Uk4P0FEsBwJqab1YS9gzi2kiuht8CX+eruq8JCA@mail.gmail.com>
References: <CADNT2Wc+dayWbDaBYzMz0qf5bZGtkqmghvvGhO0E6SPgMJjb3A@mail.gmail.com>
 <20150506174122.GC17402@nicira.com>
 <CADNT2WdqRqhry5-x6iTdgT=NM9teBHw8-g+-hqq4_3bgxnPv4g@mail.gmail.com>
 <20150506174849.GD17402@nicira.com>
 <CADNT2WfrWq9Uk4P0FEsBwJqab1YS9gzi2kiuht8CX+eruq8JCA@mail.gmail.com>
Message-ID: <20150507231123.GL25694@nicira.com>

Those flows don't output to the tunnel, they input from it.  You can't
expect to receive traffic from a tunnel if nothing ever sends traffic
on it.

On Wed, May 06, 2015 at 02:00:22PM -0400, Venkata Ravichandra Cherukuri wrote:
> Please correct me if I am wrong.
> 
> I have added flows already ( sorry for not mentioning it earlier.)
> 
> S1:
> ovs-ofctl add-flow br0 in_port=1,actions=output:2 (where my logical port 1
> is gre0 and logical 2 is eth1).
> 
> S2:
> ovs-ofctl add-flow br0 in_port=1,actions=output:2 (where my logical port 1
> is gre0 and logical 2 is eth1).
> 
> I am sure that this is not the perfect flow but this should atleast give me
> partial result when I analyze the pcap.
> 
> Thanks for the quick revert.
> 
> 
> Best Regards,
> Venkata Ravichandra Cherukuri,
> Student, MS in Computer Networks,
> North Carolina State University, Raleigh, NC.
> +1 919 590 2168
> 
> On Wed, May 6, 2015 at 1:48 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > That doesn't direct traffic into the tunnel.
> >
> > You would normally use an OpenFlow flow to direct traffic to the tunnel.
> >
> > On Wed, May 06, 2015 at 01:45:21PM -0400, Venkata Ravichandra Cherukuri
> > wrote:
> > > Hi Ben,
> > >
> > >     I have used normal "ping" to generate traffic.
> > >
> > > From S1 I tried to ping S2 using "ping 192,168.1.1"
> > >
> > > Best Regards,
> > > Venkata Ravichandra Cherukuri,
> > > Student, MS in Computer Networks,
> > > North Carolina State University, Raleigh, NC.
> > >
> > > On Wed, May 6, 2015 at 1:41 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Wed, May 06, 2015 at 01:32:07AM -0400, Venkata Ravichandra Cherukuri
> > > > wrote:
> > > > > Hi all,
> > > > >
> > > > >     I have configured GRE Tunnel between two switches using the
> > following
> > > > > command. The simulator that I am using is GENI hence, I won't be
> > able to
> > > > > use the eth0 interface.
> > > > >
> > > > > S1 (eth1 192.168.1.10/24) ---------- S2 (eth1 192.168.1.1/24)
> > > > >
> > > > > S1 Configuration:
> > > > >
> > > > > /* (For OVS Installation) */
> > > > > apt-get install openvswitch-switch
> > > > > apt-get update
> > > > >
> > > > > /* (For GRE Tunnel Creation) */
> > > > > ovs-vsctl add-br br0
> > > > > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> > > > > options:remote_ip=192.168.1.1
> > > > >
> > > > > S2 Configuration:
> > > > > apt-get install openvswitch-switch
> > > > > apt-get update
> > > > > ovs-vsctl add-br br0
> > > > > ovs-vsctl add-port br0 gre0 -- set interface gre0 type=gre
> > > > > options:remote_ip=192.168.1.10
> > > > >
> > > > > After completion I have tried pinging the two switches and they are
> > able
> > > > to
> > > > > communicate successfully but when I take the pcap file of the
> > > > communication
> > > > > between the switches (tcpdump -i eth1 -w testing.pcap) *I am not
> > able to
> > > > > see the GRE encapsulation over packets. *I have used wire-shark to
> > > > analyze
> > > > > the packets.
> > > >
> > > > What did you use to direct traffic into the tunnels?
> > > >
> >

From blp at nicira.com  Thu May  7 16:28:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 7 May 2015 16:28:32 -0700
Subject: [ovs-discuss] Openvswitch Bug for open flow version 1.2
In-Reply-To: <SINPR03MB331540BA20CD83BA915F9E395D00@SINPR03MB331.apcprd03.prod.outlook.com>
References: <SINPR03MB331540BA20CD83BA915F9E395D00@SINPR03MB331.apcprd03.prod.outlook.com>
Message-ID: <20150507232832.GN25694@nicira.com>

On Wed, May 06, 2015 at 06:33:32AM +0000, jayachandran.subramanian at wipro.com wrote:
> Hi ,
> 
> I would like to report a bug for OpenVSwitch while running OFtest script with openflow version 1.2 and please find the details below
> 
> Openvswitch version : openvswitch - 2.3.1
> OS version                    : Ubuntu 14.04 Ttusty
> Open flow version      : 1.2
> 
> I have executed the  GitHub open flow 1.2 version script in openvswitch and observed that script is failing and unable to match the ofp message for eg . (OFPET_GROUP_MOD_FAILED/OFPGMFC_INVALID_GROUP) .
> 
> When we are commenting these lines in the script , script successfully passed.
> 
> And the same script passed without adding /deleting in the script with Ericsson (of12softswitch)

I do get the expected error with OVS 2.3.1 here:

    blp at sigsegv:~/ovs/tutorial$ ovs-ofctl -O OpenFlow11 add-group br0 group_id=all,type=all,buckets=output:1
    OFPT_ERROR (OF1.1) (xid=0x2): OFPGMFC_INVALID_GROUP
    OFPT_GROUP_MOD (OF1.1) (xid=0x2):
     ADD group_id=4294967292,type=all,bucket=actions=output:1
    blp at sigsegv:~/ovs/tutorial$ 

From maniksidana019 at gmail.com  Fri May  8 05:39:00 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Fri, 8 May 2015 18:09:00 +0530
Subject: [ovs-discuss] OVS-OFCTL - negotiated OpenFlow version
In-Reply-To: <CAKv4ra8DB65THD48uLqEegD-cm5O-uGhzWsaCEBP5+eRQD-E-Q@mail.gmail.com>
References: <CAKv4ra8DB65THD48uLqEegD-cm5O-uGhzWsaCEBP5+eRQD-E-Q@mail.gmail.com>
Message-ID: <CAG-CZ9e=yVJcn56j8QHSHQpvXxC3YqyQh7A6nFXHCLLxhh00=Q@mail.gmail.com>

Hi Vipin,

Which version of OVS are you using.
Check this link for your OVS version:
 http://openvswitch.org/pipermail/dev/2013-June/028026.html

Thanks
Manik Sidana

On Thu, May 7, 2015 at 3:22 AM, Vipin Garg <vkg.2006 at gmail.com> wrote:

> Hello,
>
> I am trying to update the status of one of the port using following
> command -
>
>
> data2 # ./ovs-ofctl mod-port  vlan20-odl sp4 up
>
> And I got following error message ...
>
> 2015-05-06T20:52:49Z|00001|vconn|WARN|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt:
> version negotiation failed (we support version 0x01, peer supports version
> 0x04)
> ovs-ofctl: vlan20-odl: failed to connect to socket (Protocol error)
>
>
> As suggested on some mailing list, I added openflow versions as follows -
>
> ./ovs-vsctl set bridge vlan20-odl
> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
>
> and then again update the port ..
>
> ./ovs-ofctl --verbose mod-port  vlan20-odl sp4 up
>
> In the logs, I see that --
>
> 2015-05-06T21:39:55Z|00015|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt:
> negotiated OpenFlow version 0x01 (we support version 0x01, peer supports
> version 0x06 and earlier)
>
>
> My question is -
>
> 1. Why the negotiated OF version is 1 (not 1.4) when peer (OpenDayLight )
> can support higher version
> 2 How can I make  trained OVS to communicate using higher version of OF ..
>
> 3. Why I still don't see port status getting update , Am I missing
> something ?
>
> Thanks
>
> Vipin Garg
>
> Fortinet ..
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150508/a9be2b42/attachment.html>

From maniksidana019 at gmail.com  Fri May  8 05:48:05 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Fri, 8 May 2015 18:18:05 +0530
Subject: [ovs-discuss] Mirroring works only for layer2 traffic.
In-Reply-To: <CAO=Hd=hsTYrYTr5__PezaaPx0+VRzhTO0r2SzjRZ-ef9h3Jiww@mail.gmail.com>
References: <i23bkf9tbr666k18uexij4sj.1430537141814@email.android.com>
 <CAO=Hd=gp=4WMuTPJu22UJmXi6x5dd79posdn0EKOuBvvOGWzpQ@mail.gmail.com>
 <CAG-CZ9fG+kgVcY-uzao0CpDzaAJVQxs4CEYoNQbXD1mM32nC5A@mail.gmail.com>
 <CAO=Hd=hsTYrYTr5__PezaaPx0+VRzhTO0r2SzjRZ-ef9h3Jiww@mail.gmail.com>
Message-ID: <CAG-CZ9doqe7zxCbOdMPZKhnTVRp0kAffcxaEmM585OBcKkhrfg@mail.gmail.com>

Hi Aj Nouri,

I still have some doubts.
When you add eth1,eth2 and eth3 to your bridge, then only your OVS bridge
should have an IP address. Thus pinging eth1 and eth2 has no meaning.
Any ping,ssh,L3 traffic should be directed to IP address of your bridge.
What you can do is, you can download a packet generator and generate L3
traffic form eth1 and check whether it gets dumped on eth3.

[Please correct me if I am wrong]

Thanks
Manik Sidana


On Sat, May 2, 2015 at 10:23 PM, AJ NOURI <ajn.bin at gmail.com> wrote:

> 1) You are right Manik, I have just pasted the wrong code, in fact I have
> used the following (without the brackets):
> select-dst-port=@eth1, at eth2 select-src-port=@eth1, at eth2 output-port=@eth3
> 2) I used the comand provided by openvswitch QA:
>
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=FAQ;hb=HEAD
> 3) The tested scenario is a layer2 switch, so I have supposed no need to
> set IP to the bridge.
>
> I have tried your version with the square brackets and assiged an IP
> address to br0, still only layer2 traffic:
>
> ## Monitoring station connected to eth3:
> tcpdump -i eth0
> 12:30:51.833391 ARP, Request who-has 192.168.1.1 tell 192.168.1.4, length
> 46
> 12:30:53.837238 ARP, Request who-has 192.168.1.1 tell 192.168.1.4, length
> 46
> 12:31:01.236287 CDPv2, ttl: 180s, Device-ID 'R3', length 322
> 12:31:19.427126 CDPv2, ttl: 180s, Device-ID 'R4', length 291
>
> ### Traffic generated between eth1 and eth2:
> - ARP traffic shows up when I try to ping a non existing ip (192.168.1.1)
> from eth1(connected to 192.168.1.3) to eth2 (connected to 192.168.1.4).
> - CDP is a layer 2 discovery protocol exchanged regularly between Cisco
> devices.
> - For layer 3 traffic, I generate ping, telnet and ssh between the two
> devices connected to eth1 and eth2 and it works perfectly.
>
>
>
> On Sat, May 2, 2015 at 5:29 PM, Manik Sidana <maniksidana019 at gmail.com>
> wrote:
>
>> Hi Aj Nouri,
>>
>> I have some doubts on the mirror that you have created
>> 1) You have specified only eth1 as dst-port/src-port.
>> 2) Why have you specified "-- --id=@eth3 get Port eth3" when you intend
>> to mirror only eth1 and eth2 traffic ?
>> 3) There's no IP on eth1,eth2,eth3 and br0. I think you are using some
>> packet generator internally on the machine itself.
>>
>>
>> I think you should re-create your mirror as below
>> ovs-vsctl -- set Bridge br0 mirrors=@m \
>>  -- --id=@eth1 get Port eth1 \
>>  -- --id=@eth2 get Port eth2 \
>>  -- --id=@eth3 get Port eth3 \
>>  -- --id=@m create Mirror name=e1e2toe3 select-dst-port=[@eth1, at eth2]
>> select-src-port=[@eth1, at eth2] output-port=@eth3
>> I would also suggest you to enable promiscuous mode on eth3 using
>> "ifconfig eth3 promisc"
>> If it still doesn't works, please share the kind of traffic that you are
>> generating.
>>
>>
>> On Sat, May 2, 2015 at 6:44 PM, AJ NOURI <ajn.bin at gmail.com> wrote:
>>
>>> Hi Manik, thanks for your reply.
>>>
>>> ###
>>> *sudo ovs-ofctl dump-flows br0*
>>> NXST_FLOW reply (xid=0x4):
>>>  cookie=0x0, duration=2954.754s, table=0, n_packets=641, n_bytes=76685,
>>> idle_age=4, priority=0 actions=NORMAL
>>>
>>> ###
>>> *sudo ovs-ofctl show br0*
>>> OFPT_FEATURES_REPLY (xid=0x2): dpid:0000080027a8d04b
>>> n_tables:254, n_buffers:256
>>> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
>>> actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src
>>> mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
>>>  2(eth3): addr:08:00:27:b9:97:65
>>>      config:     0
>>>      state:      0
>>>      current:    1GB-FD COPPER AUTO_NEG
>>>      advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>>>      supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>>>      speed: 1000 Mbps now, 1000 Mbps max
>>>  4(eth1): addr:08:00:27:a8:d0:4b
>>>      config:     0
>>>      state:      0
>>>      current:    1GB-FD COPPER AUTO_NEG
>>>      advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>>>      supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>>>      speed: 1000 Mbps now, 1000 Mbps max
>>>  5(eth2): addr:08:00:27:e9:fa:c9
>>>      config:     0
>>>      state:      0
>>>      current:    1GB-FD COPPER AUTO_NEG
>>>      advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>>>      supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
>>>      speed: 1000 Mbps now, 1000 Mbps max
>>>  LOCAL(br0): addr:08:00:27:a8:d0:4b
>>>      config:     PORT_DOWN
>>>      state:      LINK_DOWN
>>>      speed: 0 Mbps now, 0 Mbps max
>>> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>>>
>>> ###
>>> *sudo ovs-vsctl list bridge*
>>> _uuid               : 79b9be3c-8722-4427-9c23-42408094d04c
>>> controller          : []
>>> datapath_id         : "0000080027a8d04b"
>>> datapath_type       : ""
>>> datapath_version    : "2.3.90"
>>> external_ids        : {}
>>> fail_mode           : []
>>> flood_vlans         : []
>>> flow_tables         : {}
>>> ipfix               : []
>>> mcast_snooping_enable: false
>>> mirrors             : [56e727b0-508e-4291-a3cf-a1501fb83f2b]
>>> name                : "br0"
>>> netflow             : []
>>> other_config        : {}
>>> ports               : [0fa3fcfc-24fd-4094-9586-81652d418e19,
>>> a6bac80c-7ec7-408b-be95-00e70b768cd0, a789b92d-c686-4bd4-bec5-3abc0458a83c,
>>> eacc6f53-4b0c-4c1b-bee6-b16167cd237a]
>>> protocols           : []
>>> rstp_enable         : false
>>> rstp_status         : {}
>>> sflow               : []
>>> status              : {}
>>> stp_enable          : false
>>>
>>> ###
>>> *sudo ovs-vsctl show*
>>> 922ea05c-7625-4978-b3ce-7ca3558a05ef
>>>     Bridge "br0"
>>>         Port "eth3"
>>>             Interface "eth3"
>>>         Port "eth2"
>>>             Interface "eth2"
>>>         Port "eth1"
>>>             Interface "eth1"
>>>         Port "br0"
>>>             Interface "br0"
>>>                 type: internal
>>>     ovs_version: "2.3.90"
>>>
>>> ###
>>> *ifconfig -a*
>>> br0       Link encap:Ethernet  HWaddr 08:00:27:a8:d0:4b
>>>           BROADCAST MULTICAST  MTU:1500  Metric:1
>>>           RX packets:0 errors:0 dropped:6 overruns:0 frame:0
>>>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>>>           collisions:0 txqueuelen:0
>>>           RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
>>>
>>> eth0      Link encap:Ethernet  HWaddr 08:00:27:6a:b1:b6
>>>           UP BROADCAST MULTICAST  MTU:1500  Metric:1
>>>           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>>>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>>>           collisions:0 txqueuelen:1000
>>>           RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
>>>
>>> eth1      Link encap:Ethernet  HWaddr 08:00:27:a8:d0:4b
>>>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>>>           RX packets:254 errors:0 dropped:0 overruns:0 frame:0
>>>           TX packets:3 errors:0 dropped:0 overruns:0 carrier:0
>>>           collisions:0 txqueuelen:1000
>>>           RX bytes:25158 (25.1 KB)  TX bytes:231 (231.0 B)
>>>
>>> eth2      Link encap:Ethernet  HWaddr 08:00:27:e9:fa:c9
>>>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>>>           RX packets:254 errors:0 dropped:0 overruns:0 frame:0
>>>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>>>           collisions:0 txqueuelen:1000
>>>           RX bytes:26367 (26.3 KB)  TX bytes:0 (0.0 B)
>>>
>>> eth3      Link encap:Ethernet  HWaddr 08:00:27:b9:97:65
>>>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>>>           RX packets:49 errors:0 dropped:0 overruns:0 frame:0
>>>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>>>           collisions:0 txqueuelen:1000
>>>           RX bytes:15174 (15.1 KB)  TX bytes:0 (0.0 B)
>>>
>>> lo        Link encap:Local Loopback
>>>           inet addr:127.0.0.1  Mask:255.0.0.0
>>>           UP LOOPBACK RUNNING  MTU:65536  Metric:1
>>>           RX packets:3346 errors:0 dropped:0 overruns:0 frame:0
>>>           TX packets:3346 errors:0 dropped:0 overruns:0 carrier:0
>>>           collisions:0 txqueuelen:0
>>>           RX bytes:266036 (266.0 KB)  TX bytes:266036 (266.0 KB)
>>>
>>> ovs-system Link encap:Ethernet  HWaddr 52:ad:7b:47:e3:97
>>>           BROADCAST MULTICAST  MTU:1500  Metric:1
>>>           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>>>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>>>           collisions:0 txqueuelen:0
>>>           RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
>>>
>>>
>>> On Sat, May 2, 2015 at 5:27 AM, Manik Sidana <maniksidana019 at gmail.com>
>>> wrote:
>>>
>>>> Hi Aj Nouri,
>>>>
>>>> Can you also share the output of below commands
>>>> ovs-ofctl dump-flows br0
>>>> ovs-ofctl show br0
>>>> ovs-vsctl show
>>>> ifconfig -a
>>>>
>>>>
>>>>
>>>> -------- Original message --------
>>>> From: AJ NOURI <ajn.bin at gmail.com>
>>>> Date: 02/05/2015 02:31 (GMT+05:30)
>>>> To: discuss at openvswitch.org
>>>> Subject: [ovs-discuss] Mirroring works only for layer2 traffic.
>>>>
>>>>
>>>> Hi everyone,
>>>>
>>>> For testing purposes, I am using Open vswitch to mirror traffic from 2
>>>> interfaces eth1 and eth2 to eth3. I am using the following command:
>>>>
>>>> ovs-vsctl -- set Bridge br0 mirrors=@m \
>>>>  -- --id=@eth1 get Port eth1 \
>>>>  -- --id=@eth2 get Port eth2 \
>>>>  -- --id=@eth3 get Port eth3 \
>>>>  -- --id=@m create Mirror name=e1e2toe3 select-dst-port=@eth1
>>>> select-src-port=@eth1 output-port=@eth3
>>>>
>>>> A node with tcpdump is connected to eth3.
>>>>
>>>> tcpdump shows only layer2 traffic: ARP, CDP (Cisco devices connected to
>>>> eth1 and eth2) conversations between devices connected to eth1 and eth2,
>>>> but no upper layers:
>>>> ex: pings, ssh, telnet not visible.
>>>>
>>>> Any hint?
>>>>
>>>> AJ NOURI
>>>>
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150508/1f8fed65/attachment-0001.html>

From blp at nicira.com  Fri May  8 09:00:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 8 May 2015 09:00:43 -0700
Subject: [ovs-discuss] Openvswitch Bug for open flow version 1.2
In-Reply-To: <SINPR03MB3316815B5FE95AAF1C16B2595DE0@SINPR03MB331.apcprd03.prod.outlook.com>
References: <SINPR03MB331540BA20CD83BA915F9E395D00@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150507232832.GN25694@nicira.com>
 <SINPR03MB3316815B5FE95AAF1C16B2595DE0@SINPR03MB331.apcprd03.prod.outlook.com>
Message-ID: <20150508160043.GA22853@nicira.com>

I believe you reported the following:

        1. An OpenFlow switch should report an OFPGMFC_INVALID_GROUP
           error in response to an "add-group" message with an invalid
           group_id.

        2. OVS does not report such an error.

However, as I said, OVS does report such an error in my testing, so I
cannot reproduce the problem.

On Fri, May 08, 2015 at 05:33:23AM +0000, jayachandran.subramanian at wipro.com wrote:
> Hi Ben Pfaff,
> 
> Thank you for confirming the issue . Please let me know is there any fix for this bug .
> 
> Thanks
> Jayachandran S
> +91-8861883300
> 
> 
> 
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: 08 May 2015 04:59
> To: Jayachandran Subramanian (WT01 - PES)
> Cc: bugs at openvswitch.org
> Subject: Re: [ovs-discuss] Openvswitch Bug for open flow version 1.2
> 
> On Wed, May 06, 2015 at 06:33:32AM +0000, jayachandran.subramanian at wipro.com wrote:
> > Hi ,
> >
> > I would like to report a bug for OpenVSwitch while running OFtest script with openflow version 1.2 and please find the details below
> >
> > Openvswitch version : openvswitch - 2.3.1
> > OS version                    : Ubuntu 14.04 Ttusty
> > Open flow version      : 1.2
> >
> > I have executed the  GitHub open flow 1.2 version script in openvswitch and observed that script is failing and unable to match the ofp message for eg . (OFPET_GROUP_MOD_FAILED/OFPGMFC_INVALID_GROUP) .
> >
> > When we are commenting these lines in the script , script successfully passed.
> >
> > And the same script passed without adding /deleting in the script with Ericsson (of12softswitch)
> 
> I do get the expected error with OVS 2.3.1 here:
> 
>     blp at sigsegv:~/ovs/tutorial$ ovs-ofctl -O OpenFlow11 add-group br0 group_id=all,type=all,buckets=output:1
>     OFPT_ERROR (OF1.1) (xid=0x2): OFPGMFC_INVALID_GROUP
>     OFPT_GROUP_MOD (OF1.1) (xid=0x2):
>      ADD group_id=4294967292,type=all,bucket=actions=output:1
>     blp at sigsegv:~/ovs/tutorial$
> The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com

From jayachandran.subramanian at wipro.com  Thu May  7 22:33:23 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Fri, 8 May 2015 05:33:23 +0000
Subject: [ovs-discuss] Openvswitch Bug for open flow version 1.2
In-Reply-To: <20150507232832.GN25694@nicira.com>
References: <SINPR03MB331540BA20CD83BA915F9E395D00@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150507232832.GN25694@nicira.com>
Message-ID: <SINPR03MB3316815B5FE95AAF1C16B2595DE0@SINPR03MB331.apcprd03.prod.outlook.com>

Hi Ben Pfaff,

Thank you for confirming the issue . Please let me know is there any fix for this bug .

Thanks
Jayachandran S
+91-8861883300



-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com]
Sent: 08 May 2015 04:59
To: Jayachandran Subramanian (WT01 - PES)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] Openvswitch Bug for open flow version 1.2

On Wed, May 06, 2015 at 06:33:32AM +0000, jayachandran.subramanian at wipro.com wrote:
> Hi ,
>
> I would like to report a bug for OpenVSwitch while running OFtest script with openflow version 1.2 and please find the details below
>
> Openvswitch version : openvswitch - 2.3.1
> OS version                    : Ubuntu 14.04 Ttusty
> Open flow version      : 1.2
>
> I have executed the  GitHub open flow 1.2 version script in openvswitch and observed that script is failing and unable to match the ofp message for eg . (OFPET_GROUP_MOD_FAILED/OFPGMFC_INVALID_GROUP) .
>
> When we are commenting these lines in the script , script successfully passed.
>
> And the same script passed without adding /deleting in the script with Ericsson (of12softswitch)

I do get the expected error with OVS 2.3.1 here:

    blp at sigsegv:~/ovs/tutorial$ ovs-ofctl -O OpenFlow11 add-group br0 group_id=all,type=all,buckets=output:1
    OFPT_ERROR (OF1.1) (xid=0x2): OFPGMFC_INVALID_GROUP
    OFPT_GROUP_MOD (OF1.1) (xid=0x2):
     ADD group_id=4294967292,type=all,bucket=actions=output:1
    blp at sigsegv:~/ovs/tutorial$
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com

From davidjoshuaevans at gmail.com  Fri May  8 13:47:17 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Fri, 08 May 2015 15:47:17 -0500
Subject: [ovs-discuss] new experimenter action.
Message-ID: <D1728213.28062%davidjoshuaevans@gmail.com>

Hi Ben,
Thank you for your guidance so far  - here is my accumulated knowledge
back into the discussion.

As I understand it - and this could be the beginning of a HOWTO of sorts
for adding a custom packet action - munger/modifier/handler

openvswitch.h  
    add OVS_ACTION_ATTR_FOO_MY_PACKET and describe arguments if required
packets.c & packets.h  - my fn & pro to goes here.
    void foo_my_packet(struct dp_packet *packet)�� Etc.
actions.c 
    do_execute_actions() requires a case to handle
OVS_ACTION_ATTR_FOO_MY_PACKET


Open flow side
ofp-actions.c
    Add enum value to ofp_raw_action_type for experimenter
    DE_RAW_FOO_MY_PACKET (with comment formatted as required for possible
additional data & id for experimenter)
    Add Format / decode / encode / parse functions
    ��nb for encode, I couldn��t get ofpact_put_FOO_MY_PACKET(out) to behave
and 
     I��m not sure why.
     But ofpact_put_raw(out, ofp_version, DE_RAW_FOO_MY_PACKET, 0); did
the trick


ofp-actions.h
    Add to #define OFPACTS and include matching data structure if required.
build-aux/extract-ofp-actions  (the python magic that makes .inc files)
    Add my experimenter vendor id
ofproto-dpif-xlate.c
    static void compose_foo_my_packet_action(struct xlate_ctx *ctx){
        nl_msg_put_u32(ctx->xout->odp_actions,
OVS_ACTION_ATTR_FOO_MY_PACKET,0);
        if(ctx->xin->packet) foo_my_packet(ctx->xin->packet);
    }

    And 
    To do_xlate_actions() add
    case OFPACT_FOO_MY_PACKET:
                compose_foo_my_packet_action(...
odp-util.c
    format_odp_action() requires a case as does odp_action_len() entry for
the size of required param if any.
flow-netlink.c
    __ovs_nla_copy_actions requires an action_lens array entry for the
size of required param if any.

dpif-netdev.c

    May require dp_execute_cb() OVS_NOT_REACHED case.
dpif.c
    May require dpif_execute_helper_cb OVS_NOT_REACHED case

odp-execute.c 
    add to odp_execute_actions a case to handle
OVS_ACTION_ATTR_FOO_MY_PACKET

Compile and catch bugs - repeat.

Thanks again!


On 5/6/15, 5:58 PM, "David Evans" <davidjoshuaevans at gmail.com> wrote:

>Thank you.
>That was helpful.
>I found that using the default ofpact_put* failed. And I used
>ofpact_put_raw() instead. I don��t know why. But I kept getting illegal
>length not %8 from ovs-ofctl.
>
>Now I see some compose_* actions in the ofproto-dpif-xlate.c
>But I don��t see how anything turns from a OFPACT_* into an
>OVS_ACTION_ATTR_* ?
>Where does this part of the translation from openflow action to datapath
>action happen.
>I don��t see any tables, or comparison items that would lead me to be able
>to match my OVS_ACTION_ATTR_FOO_MY_PKTS against my new ofp_raw_action_type
>Value DE_RAW_FOO_MY_PKTS action.
>
>I think do_xlate_actions is supposed to build a ctx for this� but I am at
>a loss to understand how I do the above.
>
>Regards,
>Dave.
>
>
>On 5/6/15, 12:40 PM, "Ben Pfaff" <blp at nicira.com> wrote:
>
>>On Wed, May 06, 2015 at 08:00:07AM -0500, David Evans wrote:
>>> I have gotten a little further.
>>> My new flow action registers ok in ovs, but when i use ovs-ofctl to
>>>dump
>>> the flows, the reply message parser in ovs-ofctl bails out trying to
>>>read
>>> the instruction/actions from the message saying that they're an invalid
>>> length.
>>> Do i need a vendor_id specific stats reply or something like that to
>>>fix
>>> this?
>>
>>It seems likely that the encode_*() function that you wrote does not
>>properly encode the new action.  Does it use the generated
>>ofpact_put_*() function to encode the action?  I would also check the
>>hexdump for the action to make sure that it has the expected format.
>>
>>You do need a "vendor extension" or "experimenter" action but the
>>generated ofpact_put_*() function should take care of that for you.
>
>



From joestringer at nicira.com  Fri May  8 16:00:31 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Fri, 8 May 2015 16:00:31 -0700
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <5537613B.5070804@ubuntu.com>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>
 <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>
 <321030EF-0481-4FD2-B979-8B0A63C3D19D@nuvula.ch>
 <CANr6G5weMs1tLeLmDSfb_yL9Gk6Zz88dy0XpZ99UjQVi+_w_Sw@mail.gmail.com>
 <68DDEDA0-481E-49EF-BB94-7FD9AE7373EF@nuvula.ch>
 <20DD9129-AEDD-4FC6-BFD5-A8F10545230B@nuvula.ch>
 <CANr6G5znSOe9gFUMwa6AP-zaRNiRXrfnqM6UUHsoVgQWEsN2Jg@mail.gmail.com>
 <EF09D73F-A631-484A-AE08-307C927ABEB3@nuvula.ch>
 <62395DBA-764B-4332-8D77-EF5EF189D623@canonical.com>
 <3E5B9556-CB9F-4D5B-8A6D-A615C099BAD7@nuvula.ch>
 <3FE189EC-49E0-47CC-BD59-2F6E7B04B9A4@ubuntu.com>
 <8CE70C04-9A31-4499-938A-85EC4D13E0BB@nuvula.ch>
 <C222441F-23C1-470A-987E-123B00879EA9@ubuntu.com>
 <117DA076-BD34-4C01-94AE-22949AEF0E42@nuvula.ch> <55241FD8.1040704@ubuntu.com>
 <A00A93E9-6A58-458C-8E8B-C8542176ADDA@nuvula.ch> <553519F7.3060901@ubuntu.com>
 <CA907DB2-9B8D-4BEA-A902-8F9E436268A8@nuvula.ch> <5537613B.5070804@ubuntu.com>
Message-ID: <CANr6G5wcnfy0YMeaBbs_xM1YupQbE+u80iv-wAWPgtRoOPaJnA@mail.gmail.com>

Marco, James,

I wonder if this patch fixes the issue:
https://github.com/openvswitch/ovs/commit/546953509095cec6fad42663b659171618b765d2

Note that the last three lines within the bad_key_len / bad_mask_len
conditional statement are the following:

format_generic_odp_key(ma, ds);
ds_put_char(ds, ')');
return;

This is the same logic as the end of the function, where the backtrace
is reporting the callstack to be. Jarno pointed out that the compiler
could optimize out the first copy of this code to turn into a jump
instruction which jumps inside the if (!is_exact) statement. Hence the
backtrace shows this confusing callstack.

Note that this problem would only present itself if there is:
A) A mismatch between a newer kernel version and an older userspace
(OVS<2.3), where
B) The kernel has a new flow match field available which ovs-vswitchd
doesn't understand, and
C) A flow_del command fails for some reason.

It would be great if we could confirm by getting the existing build of
OVS and applying the patch above.


On 22 April 2015 at 01:52, James Page <james.page at ubuntu.com> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA256
>
> Marco
>
> Apologies for my foobar in not managing to provide un-optimized
> binaries when I thought I had - apparently the ovs packaging
> outsmarted me.
>
> I've push a verified -O0 build to ppa:james-page/openvswitch
>
> If you could retry with the latest packages from that PPA that would
> be great - then we can really figure out whether this is an optimizer
> issue or not...
>
> Regards
>
> James
>
> On 21/04/15 08:01, Marco Kuendig wrote:
>> thanks James for the answer. No problem.
>>
>> Let me know if I can test anything and I will give it a try.
>>
>> cheers marco
>>
>>
>> Nuvula AG <http://www.nuvula.ch/>
>>
>> Marco Kuendig / CEO / Founder marco at nuvula.ch
>> <mailto:marco at nuvula.ch> / +41 78 751 99 71
>>
>> Marco's Google Hangout
>> <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>>
>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau
>> Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>
>>
>>> On 20 Apr 2015, at 17:23, James Page <james.page at ubuntu.com
>>> <mailto:james.page at ubuntu.com>> wrote:
>>>
>> Hi Marco
>>
>> Not ignoring you - just a bit busy with Ubuntu 15.04 release at
>> the moment - so apologies for any lag.
>>
>> On 16/04/15 21:13, Marco Kuendig wrote:
>>>>> #2  0x0000000000460cd2 in format_odp_key_attr
>>>>> (a=a at entry=0x19798d4, ma=ma at entry=0x0,
>>>>> ds=ds at entry=0x7ffc6c10bd10, verbose=verbose at entry=true) at
>>>>> ../lib/odp-util.c:1332
>>
>> The thing that has us puzzled is why at this point in the stack is
>> the automatic variable 'is_exact' not true:
>>
>> case OVS_KEY_ATTR_UNSPEC: case __OVS_KEY_ATTR_MAX: default:
>> format_generic_odp_key(a, ds); if (!is_exact) { ds_put_char(ds,
>> '/'); format_generic_odp_key(ma, ds); } break; }
>>
>> As the 'ma' parameter is 0, this should mean that is_exact
>> follows:
>>
>> is_exact = ma ? odp_mask_attr_is_exact(ma) : true;
>>
>> and as ma == 0 then is_exact should == true.  But for some reason
>> its no t.
>>
>> As you see this with the un-optimized package, we can't blame the
>> optimizer - so something else must be happening - maybe an
>> overflow?
>>
>> That would have to happen in L952->L978 so not a huge amount of
>> scope.
>>
>> It might be good to see if we can determine whether namebuf is the
>> culprit.
>>
>>
>
> - --
> James Page
> Ubuntu and Debian Developer
> james.page at ubuntu.com
> jamespage at debian.org
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQIcBAEBCAAGBQJVN2E7AAoJEL/srsug59jDLJcQAKKzaKdfp7YvrEcasIaLKffh
> mO0KO6MbVWp+42gaW/1XuT3wa2nZuVgjGaytb5NC/EJy1O3viQVQMWJIJosBoK5f
> xbxC1z+3IRhnF8r27elql8nE/bxLVGpj4jUXySV7Ad1ede/3P3T30TcnhCkXNaKi
> 2CcOE9MUAj+2sp4C3VUXwRxdTZio1dJ+A6lDoA65p7brWroKNhY1Y0g1ct97tVE+
> YLaZK3oOuVt6++CX5KPE7hR1XBk5ojKxMUtIDP5T/az7zDSokVk2GR3CYJHg57kh
> SfvGw4r0PbkKn0W3E4u3HSCimlizy40Ior9qUuvNC8F4kDq7LWW3WE6ggb+X34N0
> 5AetDHEgRB7eFBTWlLmC4Gop7mrQP/wBqmDJJoMr+jxEJC8HoSpRYoFixAPi+6w7
> O3SqOPCMpND0EHqCF60fn5zUFyXWEqWgrunEauhqPJ6swo1Uzyu52ONSZQ+V27UY
> bqnDBjq5JAU5QbSTAY52ugAsW+GGobykdduxuL0Uz8cppZ/Vlkm/wh8XtAfN3nTh
> GbYItkp9xRNesq6Q+beL0tFVLJWuvQNDv4LsFBzgAGRE/9Aw91A1T2GtOvLbLACa
> SmM2FMt4NBVV7ANqKUP1F8mACyKtbhepPVO2Oidx/ytogO+oZYtNaRNK+UwQvj/0
> lFtr4VM3A0nI8s0zFeyP
> =mulJ
> -----END PGP SIGNATURE-----

From vkg.2006 at gmail.com  Fri May  8 12:16:29 2015
From: vkg.2006 at gmail.com (Vipin Garg)
Date: Fri, 8 May 2015 12:16:29 -0700
Subject: [ovs-discuss] OVS-OFCTL - negotiated OpenFlow version
In-Reply-To: <CAG-CZ9e=yVJcn56j8QHSHQpvXxC3YqyQh7A6nFXHCLLxhh00=Q@mail.gmail.com>
References: <CAKv4ra8DB65THD48uLqEegD-cm5O-uGhzWsaCEBP5+eRQD-E-Q@mail.gmail.com>
 <CAG-CZ9e=yVJcn56j8QHSHQpvXxC3YqyQh7A6nFXHCLLxhh00=Q@mail.gmail.com>
Message-ID: <CAKv4ra8x72X-fgeCUEtGo-xxsDccY6e9Vfane5rvU6EU9oxn8Q@mail.gmail.com>

Hello,

I am using version 2.3.90 (See below )

/data2 # ./ovs-ofctl --version
ovs-ofctl (Open vSwitch) 2.3.90
Compiled May  8 2015 18:58:43
OpenFlow versions 0x1:0x4

Thanks
Vipin Garg



On Fri, May 8, 2015 at 5:39 AM, Manik Sidana <maniksidana019 at gmail.com>
wrote:

> Hi Vipin,
>
> Which version of OVS are you using.
> Check this link for your OVS version:
>  http://openvswitch.org/pipermail/dev/2013-June/028026.html
>
> Thanks
> Manik Sidana
>
> On Thu, May 7, 2015 at 3:22 AM, Vipin Garg <vkg.2006 at gmail.com> wrote:
>
>> Hello,
>>
>> I am trying to update the status of one of the port using following
>> command -
>>
>>
>> data2 # ./ovs-ofctl mod-port  vlan20-odl sp4 up
>>
>> And I got following error message ...
>>
>> 2015-05-06T20:52:49Z|00001|vconn|WARN|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt:
>> version negotiation failed (we support version 0x01, peer supports version
>> 0x04)
>> ovs-ofctl: vlan20-odl: failed to connect to socket (Protocol error)
>>
>>
>> As suggested on some mailing list, I added openflow versions as follows -
>>
>> ./ovs-vsctl set bridge vlan20-odl
>> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
>>
>> and then again update the port ..
>>
>> ./ovs-ofctl --verbose mod-port  vlan20-odl sp4 up
>>
>> In the logs, I see that --
>>
>> 2015-05-06T21:39:55Z|00015|vconn|DBG|unix:/usr/local/var/run/openvswitch/vlan20-odl.mgmt:
>> negotiated OpenFlow version 0x01 (we support version 0x01, peer supports
>> version 0x06 and earlier)
>>
>>
>> My question is -
>>
>> 1. Why the negotiated OF version is 1 (not 1.4) when peer (OpenDayLight )
>> can support higher version
>> 2 How can I make  trained OVS to communicate using higher version of OF ..
>>
>> 3. Why I still don't see port status getting update , Am I missing
>> something ?
>>
>> Thanks
>>
>> Vipin Garg
>>
>> Fortinet ..
>>
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150508/c97c3ff5/attachment.html>

From james.page at ubuntu.com  Mon May 11 00:23:32 2015
From: james.page at ubuntu.com (James Page)
Date: Mon, 11 May 2015 08:23:32 +0100
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <CANr6G5wcnfy0YMeaBbs_xM1YupQbE+u80iv-wAWPgtRoOPaJnA@mail.gmail.com>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <321030EF-0481-4FD2-B979-8B0A63C3D19D@nuvula.ch>
 <CANr6G5weMs1tLeLmDSfb_yL9Gk6Zz88dy0XpZ99UjQVi+_w_Sw@mail.gmail.com>
 <68DDEDA0-481E-49EF-BB94-7FD9AE7373EF@nuvula.ch>
 <20DD9129-AEDD-4FC6-BFD5-A8F10545230B@nuvula.ch>
 <CANr6G5znSOe9gFUMwa6AP-zaRNiRXrfnqM6UUHsoVgQWEsN2Jg@mail.gmail.com>
 <EF09D73F-A631-484A-AE08-307C927ABEB3@nuvula.ch>
 <62395DBA-764B-4332-8D77-EF5EF189D623@canonical.com>
 <3E5B9556-CB9F-4D5B-8A6D-A615C099BAD7@nuvula.ch>
 <3FE189EC-49E0-47CC-BD59-2F6E7B04B9A4@ubuntu.com>
 <8CE70C04-9A31-4499-938A-85EC4D13E0BB@nuvula.ch>
 <C222441F-23C1-470A-987E-123B00879EA9@ubuntu.com>
 <117DA076-BD34-4C01-94AE-22949AEF0E42@nuvula.ch>
 <55241FD8.1040704@ubuntu.com>
 <A00A93E9-6A58-458C-8E8B-C8542176ADDA@nuvula.ch>
 <553519F7.3060901@ubuntu.com>
 <CA907DB2-9B8D-4BEA-A902-8F9E436268A8@nuvula.ch>
 <5537613B.5070804@ubuntu.com>
 <CANr6G5wcnfy0YMeaBbs_xM1YupQbE+u80iv-wAWPgtRoOPaJnA@mail.gmail.com>
Message-ID: <555058F4.904@ubuntu.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

Hi Joe

On 09/05/15 00:00, Joe Stringer wrote:
> I wonder if this patch fixes the issue: 
> https://github.com/openvswitch/ovs/commit/546953509095cec6fad42663b659
171618b765d2
>
>  Note that the last three lines within the bad_key_len /
> bad_mask_len conditional statement are the following:
> 
> format_generic_odp_key(ma, ds); ds_put_char(ds, ')'); return;
> 
> This is the same logic as the end of the function, where the
> backtrace is reporting the callstack to be. Jarno pointed out that
> the compiler could optimize out the first copy of this code to turn
> into a jump instruction which jumps inside the if (!is_exact)
> statement. Hence the backtrace shows this confusing callstack.
> 
> Note that this problem would only present itself if there is: A) A
> mismatch between a newer kernel version and an older userspace 
> (OVS<2.3), where B) The kernel has a new flow match field available
> which ovs-vswitchd doesn't understand, and C) A flow_del command
> fails for some reason.
> 
> It would be great if we could confirm by getting the existing build
> of OVS and applying the patch above.

Actually that's really interesting - once I actually managed to get
the unoptimized build sorted out correctly, we hit this particular
issue in our test OpenStack cloud within a couple of days - I picked
the commit you detailed above into the PPA at that point in time, and
we've not seen a crash since.

I'd assumed it was something new - but your analysis would point to
the source of the problem.

Marco - have you seen any recurrence of this issue with the PPA packages
?

I'll get this picked and uploaded as a stable update today.

Cheers

James

- -- 
James Page
Ubuntu and Debian Developer
james.page at ubuntu.com
jamespage at debian.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQIcBAEBCAAGBQJVUFjzAAoJEL/srsug59jD9i8P/3enTsCMZldk/5tb2neIhsnp
uQYj4ef9YKD4WQ1lSy9/gGfBsPpLNihB0f3xdFWrKDkNelDtX8hky6yD7o+PhE7L
IC/T41XMEYnXFDZ70gCWCVXUd+TAIHNqV8o9Aqr1wKex5hQ4AjEpGWH2du/3hE6t
fHrOmffF/K/eL8txrj0D6YizT006tUxPhlF0uxDdzXyC0lyivWG+9+pVMKo63M6d
/wXhyAJFej70woOlIAQrp6A93y9FPLLOWSqcRth82dNfu04gtajANpb4k7XXoh1I
1D1tGVc7ixSHROsGETx1ucyaRpmfn73MXfN1MxhFB8f2bug2FVI5EYz5HY63lEIY
7fgM3wQf4igqmLNEzBCna0evRQIJy4+HRYoJt3OqCM5Ei4ZXWfzZlaSnvAEzyKD/
M6mvGcTEZNwQJH0+4oj9YGhiPJQpPZBNyu7TQvLPVarAjdL4cimJBiKFmCHsJ2ER
awBAWMWN3xR1vvwUArMXNaT3hhIEczC+fkOCXfklAiHIjId7aFJqJ7w7N1nfiNWN
Z37N4hBbJi2T6H4XHzosdUO71V/LVs31eTVUJ3gmA3jOdeKjAAKGnYOpx+8LkUEb
ZUfxxVqCyLPmpIc7j9ApK1qat1bIetCKRP8E6CfCsGW31Laveqc6RmBvYzeLEuZa
pP40ymvkDh0gc0EypJuT
=bBZ9
-----END PGP SIGNATURE-----

From moisesber at gmail.com  Mon May 11 09:50:46 2015
From: moisesber at gmail.com (Moises Rodrigues)
Date: Mon, 11 May 2015 18:50:46 +0200
Subject: [ovs-discuss] Packet inspection with Open vSwitch
Message-ID: <CAJ-9mAKoRqb3-Wvho8y5zNj_xDg=NphEfy8JMuWQddS94BhKYw@mail.gmail.com>

Hello,

I am trying to reproduce what was done in
http://dl.acm.org/citation.cfm?id=2620735
For those who cannot access the paper, what authors proposed that
"switches in our system are augmented to have a stateful app
processing capability that uses higher layer information in packets",
this way an application running on top of Open vSwitch can access
information beyond L2-L4.
Is there some sort of API for such extension? I mean, if I want to do
extra analyses with incoming packets, how could I do that? Do I have
to make direct modification in Open vSwitch's code or is there an
easier way?
I googled for a while but I could not find anything that helps. Maybe
I used the wrong words but, if any of you guys could help I would
really appreciate it.

Thanks for your time.
Best regards,

Moisés Rodrigues

From fbl at sysclose.org  Mon May 11 10:29:44 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Mon, 11 May 2015 14:29:44 -0300
Subject: [ovs-discuss] Packet inspection with Open vSwitch
In-Reply-To: <CAJ-9mAKoRqb3-Wvho8y5zNj_xDg=NphEfy8JMuWQddS94BhKYw@mail.gmail.com>
References: <CAJ-9mAKoRqb3-Wvho8y5zNj_xDg=NphEfy8JMuWQddS94BhKYw@mail.gmail.com>
Message-ID: <20150511172944.GA7726@x240.home>

On Mon, May 11, 2015 at 06:50:46PM +0200, Moises Rodrigues wrote:
> Hello,
> 
> I am trying to reproduce what was done in
> http://dl.acm.org/citation.cfm?id=2620735
> For those who cannot access the paper, what authors proposed that
> "switches in our system are augmented to have a stateful app
> processing capability that uses higher layer information in packets",
> this way an application running on top of Open vSwitch can access
> information beyond L2-L4.
> Is there some sort of API for such extension? I mean, if I want to do
> extra analyses with incoming packets, how could I do that? Do I have
> to make direct modification in Open vSwitch's code or is there an
> easier way?
> I googled for a while but I could not find anything that helps. Maybe
> I used the wrong words but, if any of you guys could help I would
> really appreciate it.

You can use the standard L2~L4 flow matching and if the packet is
interesting, it can send to the controller. In this case the controller
would pick the packet and do whatever additional processing needed.

fbl


From moisesber at gmail.com  Mon May 11 13:57:29 2015
From: moisesber at gmail.com (Moises Rodrigues)
Date: Mon, 11 May 2015 22:57:29 +0200
Subject: [ovs-discuss] Packet inspection with Open vSwitch
In-Reply-To: <20150511172944.GA7726@x240.home>
References: <CAJ-9mAKoRqb3-Wvho8y5zNj_xDg=NphEfy8JMuWQddS94BhKYw@mail.gmail.com>
 <20150511172944.GA7726@x240.home>
Message-ID: <CAJ-9mALFFMOv=E2JnQ0T1O_p7XfoeBnaj-vUTOgXfsk-jXQgWA@mail.gmail.com>

Hello Flavio,

Thanks for such a quick response :)
I forgot to mention that the idea is to make the inspection as close
to the switch as possible. Trying to avoid the need to contact another
entity, and all the overhead that may come with it.
Yes, using the controller is for sure a way to solve this but this is
like the plan B. Maybe, inspecting directly from the switch could
result in less overhead.
Thanks for the response anyway. If you or anyone has any other
suggestion please share.

Best regards,

Moisés Rodrigues

On Mon, May 11, 2015 at 7:29 PM, Flavio Leitner <fbl at sysclose.org> wrote:
> On Mon, May 11, 2015 at 06:50:46PM +0200, Moises Rodrigues wrote:
>> Hello,
>>
>> I am trying to reproduce what was done in
>> http://dl.acm.org/citation.cfm?id=2620735
>> For those who cannot access the paper, what authors proposed that
>> "switches in our system are augmented to have a stateful app
>> processing capability that uses higher layer information in packets",
>> this way an application running on top of Open vSwitch can access
>> information beyond L2-L4.
>> Is there some sort of API for such extension? I mean, if I want to do
>> extra analyses with incoming packets, how could I do that? Do I have
>> to make direct modification in Open vSwitch's code or is there an
>> easier way?
>> I googled for a while but I could not find anything that helps. Maybe
>> I used the wrong words but, if any of you guys could help I would
>> really appreciate it.
>
> You can use the standard L2~L4 flow matching and if the packet is
> interesting, it can send to the controller. In this case the controller
> would pick the packet and do whatever additional processing needed.
>
> fbl
>

From nick.bastin at gmail.com  Mon May 11 14:01:34 2015
From: nick.bastin at gmail.com (Nicholas Bastin)
Date: Mon, 11 May 2015 17:01:34 -0400
Subject: [ovs-discuss] Packet inspection with Open vSwitch
In-Reply-To: <CAJ-9mALFFMOv=E2JnQ0T1O_p7XfoeBnaj-vUTOgXfsk-jXQgWA@mail.gmail.com>
References: <CAJ-9mAKoRqb3-Wvho8y5zNj_xDg=NphEfy8JMuWQddS94BhKYw@mail.gmail.com>
 <20150511172944.GA7726@x240.home>
 <CAJ-9mALFFMOv=E2JnQ0T1O_p7XfoeBnaj-vUTOgXfsk-jXQgWA@mail.gmail.com>
Message-ID: <CADmMkWfVEGy4T4K0kw+dGS+Xj=2U_b--Qu-Si2OYEpzJyxkwRg@mail.gmail.com>

On Mon, May 11, 2015 at 4:57 PM, Moises Rodrigues <moisesber at gmail.com>
wrote:

> I forgot to mention that the idea is to make the inspection as close
> to the switch as possible. Trying to avoid the need to contact another
> entity, and all the overhead that may come with it.
>

The common way to do this would be to run a process that does your
inspection and expose it to the OVS datapath as a tap interface, which you
can then just forward packets to and from.

--
Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150511/b21c0285/attachment.html>

From s.redaelli20 at campus.unimib.it  Tue May 12 04:43:09 2015
From: s.redaelli20 at campus.unimib.it (Samuele Redaelli)
Date: Tue, 12 May 2015 13:43:09 +0200
Subject: [ovs-discuss] openVswitch refuses connection
Message-ID: <CAA7wx_z_=+3XQL1saosKZAsz4zRbRiFSjfuCwbGZ_wgm9bKKvQ@mail.gmail.com>

Hi everybody,

I'm using openvswitch in a mininet topology. I'm trying to establish a TCP
connection between the switch and a host attached to him. When I try it
says "connection refused". I don't understand if this is regarding the
configuration of the switch. Can someone help? My openvswitch version is
2.3.1

Thanks in advance

SR
Università degli studi di Milano-Bicocca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150512/a8ce21f0/attachment.html>

From Franck.BAUDIN at qosmos.com  Tue May 12 05:32:34 2015
From: Franck.BAUDIN at qosmos.com (Franck BAUDIN)
Date: Tue, 12 May 2015 12:32:34 +0000
Subject: [ovs-discuss] Packet inspection with Open vSwitch
In-Reply-To: <CAJ-9mAKoRqb3-Wvho8y5zNj_xDg=NphEfy8JMuWQddS94BhKYw@mail.gmail.com>
References: <CAJ-9mAKoRqb3-Wvho8y5zNj_xDg=NphEfy8JMuWQddS94BhKYw@mail.gmail.com>
Message-ID: <D84D5A6C1B26E448A0F35B539111D0E765EED1@LILAS.jungle.qosmos.com>

Hi Moisés,

The architecture for DPI integration on OVS that has been presented during OVS fall conference:
        http://www.openvswitch.org/support/ovscon2014/17/1100-OVS-L7-matchers-v1-1.pptx

This architecture relies on conntracker and nfqueue actions to be added very soon in openvswitch 2.4 (coming version):  http://www.openvswitch.org/support/ovscon2014/17/1030-conntrack_nat.pdf

Best Regards,
Franck

> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> Moises Rodrigues
> Sent: lundi 11 mai 2015 18:51
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] Packet inspection with Open vSwitch
>
> Hello,
>
> I am trying to reproduce what was done in
> http://dl.acm.org/citation.cfm?id=2620735
> For those who cannot access the paper, what authors proposed that
> "switches in our system are augmented to have a stateful app processing
> capability that uses higher layer information in packets", this way an
> application running on top of Open vSwitch can access information beyond
> L2-L4.
> Is there some sort of API for such extension? I mean, if I want to do extra
> analyses with incoming packets, how could I do that? Do I have to make
> direct modification in Open vSwitch's code or is there an easier way?
> I googled for a while but I could not find anything that helps. Maybe I used
> the wrong words but, if any of you guys could help I would really appreciate
> it.
>
> Thanks for your time.
> Best regards,
>
> Moisés Rodrigues
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
This message and any attachments (the "message") are confidential, intended solely for the addressees. If you are not the intended recipient, please notify the sender immediately by e-mail and delete this message from your system. In this case, you are not authorized to use, copy this message and/or disclose the content to any other person. E-mails are susceptible to alteration. Neither Qosmos nor any of its subsidiaries or affiliates shall be liable for the message if altered, changed or falsified.

Ce message et toutes ses pièces jointes (ci-après le "message")sont confidentiels et établis à l'intention exclusive de ses destinataires. Si vous avez reçu ce message par erreur, merci d’en informer immédiatement son émetteur par courrier électronique et d’effacer ce message de votre système. Dans cette hypothèse, vous n’êtes pas autorisé à utiliser, copier ce message et/ou en divulguer le contenu à un tiers. Tout message électronique est susceptible d'altération. Qosmos et ses filiales déclinent toute responsabilité au titre de ce message s'il a été altéré, déformé ou falsifié.

From rlantz at cs.stanford.edu  Tue May 12 14:26:10 2015
From: rlantz at cs.stanford.edu (Bob Lantz)
Date: Tue, 12 May 2015 14:26:10 -0700
Subject: [ovs-discuss] openVswitch refuses connection
In-Reply-To: <CAA7wx_z_=+3XQL1saosKZAsz4zRbRiFSjfuCwbGZ_wgm9bKKvQ@mail.gmail.com>
References: <CAA7wx_z_=+3XQL1saosKZAsz4zRbRiFSjfuCwbGZ_wgm9bKKvQ@mail.gmail.com>
Message-ID: <57CD6215-CE72-44A2-AC44-92169CF7ED03@cs.stanford.edu>

This is a MIninet question rather than an OVS question, so please follow up on mininet-discuss.

The problem is that you have separate control and data networks and haven’t added any links between them (usually you don’t want to!)


> On May 12, 2015, at 4:43 AM, Samuele Redaelli <s.redaelli20 at campus.unimib.it> wrote:
> 
> Hi everybody,
> 
> I'm using openvswitch in a mininet topology. I'm trying to establish a TCP connection between the switch and a host attached to him. When I try it says "connection refused". I don't understand if this is regarding the configuration of the switch. Can someone help? My openvswitch version is 2.3.1
> 
> Thanks in advance
> 
> SR
> Università degli studi di Milano-Bicocca
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From rlantz at cs.stanford.edu  Tue May 12 15:18:32 2015
From: rlantz at cs.stanford.edu (Bob Lantz)
Date: Tue, 12 May 2015 15:18:32 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <20150504163943.GA19660@nicira.com>
References: <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
 <20150502163330.GB19570@nicira.com>
 <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>
 <20150502171628.GF19570@nicira.com>
 <CAN-u-63Dxz0itOJiMN7sixnFVPgiSnUJ6n4EvM6A+mERRg2whg@mail.gmail.com>
 <20150502172506.GG19570@nicira.com>
 <CAN-u-60H0pwCqUGPOBZ9iOyXDdU1Rw4r7mj6rrkWXOtMwSLj6A@mail.gmail.com>
 <20150504163943.GA19660@nicira.com>
Message-ID: <4D58417E-922F-4D32-B57D-4CBA380F5F28@cs.stanford.edu>

I agree with the OVS FAQ entry, and I will add one comment:

For now, you should configure tc/QoS using either Mininet *or* OVS, but not both;
if you try to use both of them on the same interface, one will overwrite the other.
Probably you want to use ovs-vsctl for OVS data ports, and Mininet’s TCIntf for others.

Andrew Ferguson submitted a pull request to both mechanisms to coexist,
but this has not been merged into the mainline code base.

> On May 4, 2015, at 9:39 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> On Mon, May 04, 2015 at 05:22:24PM +0500, Haleema Sadia wrote:
>> The issue is resolved now.. I was setting up the bandwidth and delay
>> variable in the mininet custom topology that I created. Once I removed them
>> the queues starting working. However, if I have different min/max rate for
>> the queues the min rate threshold is not maintained.
>> 
>> For ex, if min-rate is 4 Megabit and I specify the udp packet rate to be 3
>> Megabit, the bandwidth on the server side(where the queue is being
>> maintained) for iperf goes to 3 Megabit.
>> 
>> Do you have any idea why?
> 
> It's hard for me to understand exactly what you're asking, but this FAQ
> might help.
> 
> ### Q: I configured QoS, correctly, but my measurements show that it isn't
>   working as well as I expect.
> 
> A: With the Linux kernel, the Open vSwitch implementation of QoS has
>   two aspects:
> 
>   - Open vSwitch configures a subset of Linux kernel QoS
>     features, according to what is in OVSDB.  It is possible that
>     this code has bugs.  If you believe that this is so, then you
>     can configure the Linux traffic control (QoS) stack directly
>     with the "tc" program.  If you get better results that way,
>     you can send a detailed bug report to bugs at openvswitch.org.
> 
>     It is certain that Open vSwitch cannot configure every Linux
>     kernel QoS feature.  If you need some feature that OVS cannot
>     configure, then you can also use "tc" directly (or add that
>     feature to OVS).
> 
>   - The Open vSwitch implementation of OpenFlow allows flows to
>     be directed to particular queues.  This is pretty simple and
>     unlikely to have serious bugs at this point.
> 
>   However, most problems with QoS on Linux are not bugs in Open
>   vSwitch at all.  They tend to be either configuration errors
>   (please see the earlier questions in this section) or issues with
>   the traffic control (QoS) stack in Linux.  The Open vSwitch
>   developers are not experts on Linux traffic control.  We suggest
>   that, if you believe you are encountering a problem with Linux
>   traffic control, that you consult the tc manpages (e.g. tc(8),
>   tc-htb(8), tc-hfsc(8)), web resources (e.g. http://lartc.org/), or
>   mailing lists (e.g. http://vger.kernel.org/vger-lists.html#netdev).
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From nick.bastin at gmail.com  Tue May 12 15:35:26 2015
From: nick.bastin at gmail.com (Nicholas Bastin)
Date: Tue, 12 May 2015 18:35:26 -0400
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <CAN-u-60H0pwCqUGPOBZ9iOyXDdU1Rw4r7mj6rrkWXOtMwSLj6A@mail.gmail.com>
References: <D96B032E-A664-4D8D-A876-03C94E517290@gmail.com>
 <20150501225759.GA2889@nicira.com>
 <CAN-u-62_KybPExQMpqd-6HYEznB4kdwDowRkXxVnATDAziEGfw@mail.gmail.com>
 <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
 <20150502163330.GB19570@nicira.com>
 <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>
 <20150502171628.GF19570@nicira.com>
 <CAN-u-63Dxz0itOJiMN7sixnFVPgiSnUJ6n4EvM6A+mERRg2whg@mail.gmail.com>
 <20150502172506.GG19570@nicira.com>
 <CAN-u-60H0pwCqUGPOBZ9iOyXDdU1Rw4r7mj6rrkWXOtMwSLj6A@mail.gmail.com>
Message-ID: <CADmMkWfLPW_BGVvgbF5oWr+ieQWDaTScW=W=CMRyqd-1HDvuzg@mail.gmail.com>

On Mon, May 4, 2015 at 8:22 AM, Haleema Sadia <haleema.s.mahmood at gmail.com>
wrote:

> The issue is resolved now.. I was setting up the bandwidth and delay
> variable in the mininet custom topology that I created. Once I removed them
> the queues starting working. However, if I have different min/max rate for
> the queues the min rate threshold is not maintained.
>
> For ex, if min-rate is 4 Megabit and I specify the udp packet rate to be 3
> Megabit, the bandwidth on the server side(where the queue is being
> maintained) for iperf goes to 3 Megabit.
>
> Do you have any idea why?
>

I think you are misunderstanding the idea of "min-rate".  It is not going
to create traffic for you just to make the link utilized, which is
effectively what you are asking for.  If you tell iperf to create 3Mbps of
traffic, the QoS implementation isn't going to "pad" that with another
megabit to meet your min-rate threshold.

Min-rate is just used to reserve a "slot" of a given size - all other flows
traversing the interface that are *not* hitting this queue cannot consume
the "last" 4 megabits of available bandwidth, preserving that "minimum
rate" for flows which traverse this queue (this is a gross
oversimplification of how it works).  That being said, this generally
doesn't work under large traffic volumes as the tc stack starts to fall
over when you give it that much work.

--
Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150512/2a2abc83/attachment.html>

From blp at nicira.com  Tue May 12 15:53:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 12 May 2015 15:53:20 -0700
Subject: [ovs-discuss] Queue-Stats command not working
In-Reply-To: <4D58417E-922F-4D32-B57D-4CBA380F5F28@cs.stanford.edu>
References: <20150502161704.GA19570@nicira.com>
 <CAN-u-633RcghteOhoJUw8oA5cdhh7X-Yf-yRbP7-jCwU8QhJSQ@mail.gmail.com>
 <20150502163330.GB19570@nicira.com>
 <CAN-u-60jod=04LmUgAKSxCm+9H=gAfjeBH5Nf87OdacE2uM14Q@mail.gmail.com>
 <20150502171628.GF19570@nicira.com>
 <CAN-u-63Dxz0itOJiMN7sixnFVPgiSnUJ6n4EvM6A+mERRg2whg@mail.gmail.com>
 <20150502172506.GG19570@nicira.com>
 <CAN-u-60H0pwCqUGPOBZ9iOyXDdU1Rw4r7mj6rrkWXOtMwSLj6A@mail.gmail.com>
 <20150504163943.GA19660@nicira.com>
 <4D58417E-922F-4D32-B57D-4CBA380F5F28@cs.stanford.edu>
Message-ID: <20150512225320.GA12578@nicira.com>

On Tue, May 12, 2015 at 03:18:32PM -0700, Bob Lantz wrote:
> I agree with the OVS FAQ entry, and I will add one comment:
> 
> For now, you should configure tc/QoS using either Mininet *or* OVS, but not both;
> if you try to use both of them on the same interface, one will overwrite the other.
> Probably you want to use ovs-vsctl for OVS data ports, and Mininet’s TCIntf for others.
> 
> Andrew Ferguson submitted a pull request to both mechanisms to coexist,
> but this has not been merged into the mainline code base.

Thanks for confirming this.

Is that a pull request for mininet?  For OVS, I haven't noticed anything
from Andrew Fergson.

From maniksidana019 at gmail.com  Tue May 12 22:34:35 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Wed, 13 May 2015 11:04:35 +0530
Subject: [ovs-discuss] Linux GRE ports don't show up in ovs-ofctl
Message-ID: <CAG-CZ9c7z5FDQJSoPs1iL0vm8Le9Xr0wNh9OfFT8dPFC4mrb7A@mail.gmail.com>

Hi all,

I have created GRE tunnel between two PCs connected through a switch and
the GRE tunnel is working fine.

Command used to create tunnel
ip tunnel add gre1 mode GRE remote <IP> local <IP> TTL 255

Now I want to control the traffic on the GRE interface using ovs.
When I add the GRE interface in ovs, it doesn't shows up in ovs-ofctl but I
can see it in ovs-vsctl.
Thanks for any help
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150513/65863107/attachment-0001.html>

From krzysztof.wojciechowski at techstorage.pl  Mon May 11 01:07:37 2015
From: krzysztof.wojciechowski at techstorage.pl (Krzysztof Wojciechowski)
Date: Mon, 11 May 2015 10:07:37 +0200
Subject: [ovs-discuss] Ovs-testcontroller hard timeout
Message-ID: <s34s9nh60aujxq9b9wo4iu5l.1431331657787@email.android.com>

Hello

I am searching for this for 2 days. Is it possible to change flows hard timeout using ovs-testcontroller? I need to set it for something like 3 seconds. Is there such a possibility? Maybe its hardcoded somewhere?

Greetings
Krzysztof Wojciechowski
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150511/34a4679c/attachment-0001.html>

From jayachandran.subramanian at wipro.com  Tue May 12 04:56:06 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Tue, 12 May 2015 11:56:06 +0000
Subject: [ovs-discuss] openvswitch issue with openflow version 1.3 script
Message-ID: <SINPR03MB3315273AEAC8A6D887B396895DA0@SINPR03MB331.apcprd03.prod.outlook.com>

Hi ,

I have executed github openflow 1.3 scripts with Openvswitch and got the below error as openvswitch not accepting the message (OFPBRC_EPERM)

======================================================================
FAIL: bsn_gentable.SetBucketsSizeError
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/root/oftest/tests-1.3/bsn_gentable.py", line 657, in runTest
    self.assertEquals(error.code, ofp.OFPBRC_EPERM)
AssertionError: 3 != 5

Scripts:
class EntryStatsFragmented(BaseGenTableTest):
    """
    Test retrieving entry stats in mutiple replies
    """
    def runTest(self):
        # Add a bunch of entries
        # Enough for 3 stats replies
        for i in range(0, 4095):
            self.do_add(vlan_vid=i, ipv4=0x12345678, mac=(0, 1, 2, 3, 4, 5))

        do_barrier(self.controller)
        verify_no_errors(self.controller)

        entries = self.do_entry_stats()
        seen = set()
        for entry in entries:
            key = tlv_dict(entry.key)
            vlan_vid = key[ofp.bsn_tlv.vlan_vid]
            self.assertNotIn(vlan_vid, seen)
            seen.add(vlan_vid)

        self.assertEquals(seen, set(range(0, 4095)))

Also , bsn_gentable scripts all are failing due to "error.err_type, error.code" .PFA errors.

Thanks
Jay


The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150512/61bc599d/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: bsn_gentable error.docx
Type: application/vnd.openxmlformats-officedocument.wordprocessingml.document
Size: 13590 bytes
Desc: bsn_gentable error.docx
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150512/61bc599d/attachment-0001.docx>

From hanxueluo at gmail.com  Tue May 12 16:38:02 2015
From: hanxueluo at gmail.com (Huanle Han)
Date: Wed, 13 May 2015 07:38:02 +0800
Subject: [ovs-discuss] How implent ACL rule in 'out' direction.
Message-ID: <CACRYWpv0kUHV4NGdOs=YUEpYD8RGVW3fOUc6q0UDzBc4a9EpMw@mail.gmail.com>

Hi, guys
I'm working with ovs in normal mode.

I have a question about the implent ACL rule in 'out' direction.
For example, How can I implement such rules using ovs flow table?

Rule 1: deny the flow whose tp_dst==22 output to VIF1, but permit to other
VIFs
Rule 2: permit the flow whose nw_src==1.1.1.1 output to VIF2, but deny to
other VIFs

Thanks.
Huanle
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150513/5d4878df/attachment.html>

From s.redaelli20 at campus.unimib.it  Wed May 13 00:31:59 2015
From: s.redaelli20 at campus.unimib.it (Samuele Redaelli)
Date: Wed, 13 May 2015 09:31:59 +0200
Subject: [ovs-discuss] openVswitch refuses connection
In-Reply-To: <57CD6215-CE72-44A2-AC44-92169CF7ED03@cs.stanford.edu>
References: <CAA7wx_z_=+3XQL1saosKZAsz4zRbRiFSjfuCwbGZ_wgm9bKKvQ@mail.gmail.com>
 <57CD6215-CE72-44A2-AC44-92169CF7ED03@cs.stanford.edu>
Message-ID: <CAA7wx_x3Me6jczOSqQXEFA2D4=6Sp23cG7_C6ATaiJDUsEU5fg@mail.gmail.com>

Thanks for tip.

SR

2015-05-12 23:26 GMT+02:00 Bob Lantz <rlantz at cs.stanford.edu>:

> This is a MIninet question rather than an OVS question, so please follow
> up on mininet-discuss.
>
> The problem is that you have separate control and data networks and
> haven’t added any links between them (usually you don’t want to!)
>
>
> > On May 12, 2015, at 4:43 AM, Samuele Redaelli <
> s.redaelli20 at campus.unimib.it> wrote:
> >
> > Hi everybody,
> >
> > I'm using openvswitch in a mininet topology. I'm trying to establish a
> TCP connection between the switch and a host attached to him. When I try it
> says "connection refused". I don't understand if this is regarding the
> configuration of the switch. Can someone help? My openvswitch version is
> 2.3.1
> >
> > Thanks in advance
> >
> > SR
> > Università degli studi di Milano-Bicocca
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150513/2241ca25/attachment.html>

From ashalimov at arccn.ru  Wed May 13 09:30:40 2015
From: ashalimov at arccn.ru (Alexander Shalimov)
Date: Wed, 13 May 2015 19:30:40 +0300
Subject: [ovs-discuss] DPDK & LLDP & OpenFlow
Message-ID: <55537C30.5000405@arccn.ru>

Hi all,

I use the latest OVS (master branch) running only DPDK ports.  I have 
connected an OpenFlow controller that iteratively sends LLDP packets via 
OpenFlow Packet Out messages across all ports.

I see that LLDP messages finally ends up in lib/netdev-dpdk.c and 
successfully goes throught rte_eth_tx_burst(). But I don't see anything 
coming on other side of the link. It looks the packets get stuck 
somewhere inside dpdk, nic, etc.

Has anyone seen such behavior before? What can I do to figure out the 
problem?

Thanks!

-- 
С уважением, |  Sincerely,
Александр.   |  Alexander.


From diproiettod at vmware.com  Wed May 13 10:03:21 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Wed, 13 May 2015 18:03:21 +0100
Subject: [ovs-discuss] DPDK & LLDP & OpenFlow
In-Reply-To: <55537C30.5000405@arccn.ru>
References: <55537C30.5000405@arccn.ru>
Message-ID: <6D89AEE9-9460-4FEA-8623-DEB047A31D5A@vmware.com>

Hi Alexander,

> On 13 May 2015, at 17:30, Alexander Shalimov <ashalimov at arccn.ru> wrote:
> 
> Hi all,
> 
> I use the latest OVS (master branch) running only DPDK ports.  I have connected an OpenFlow controller that iteratively sends LLDP packets via OpenFlow Packet Out messages across all ports.
> 
> I see that LLDP messages finally ends up in lib/netdev-dpdk.c and successfully goes throught rte_eth_tx_burst(). But I don't see anything coming on other side of the link. It looks the packets get stuck somewhere inside dpdk, nic, etc.

I don't know enough about your setup, but if the DPDK
NIC is connected to a switch, LLDP packets will likely
be consumed by the switch itself and will not be forwarded.

> Has anyone seen such behavior before? What can I do to figure out the problem?

The following command can be used to gather NIC statistics:

    ovs-appctl dpctl/show -s

The counters are implemented in hardware for physical NICs so,
by monitoring the TX values, you could understand if the packets
are being sent.

Hope this helps,

Daniele

> -- 
> С уважением, |  Sincerely,
> Александр.   |  Alexander.
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_mailman_listinfo_discuss&d=AwIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=qT162QdiLUMquj5j9p-1kQK7vSwyO_6Uct-KeC7X21Q&s=K8GJP4PKMsPjAFZOxAhWnEB0K7HFFPWu2kejFD6mldQ&e= 


From jesse at nicira.com  Wed May 13 15:20:56 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 13 May 2015 15:20:56 -0700
Subject: [ovs-discuss] Linux GRE ports don't show up in ovs-ofctl
In-Reply-To: <CAG-CZ9c7z5FDQJSoPs1iL0vm8Le9Xr0wNh9OfFT8dPFC4mrb7A@mail.gmail.com>
References: <CAG-CZ9c7z5FDQJSoPs1iL0vm8Le9Xr0wNh9OfFT8dPFC4mrb7A@mail.gmail.com>
Message-ID: <CAEP_g=8aKFJGve=16reqGxO5dxHy4Y7mxxntud+VjrHdUP+6_A@mail.gmail.com>

On Tue, May 12, 2015 at 10:34 PM, Manik Sidana <maniksidana019 at gmail.com> wrote:
> Hi all,
>
> I have created GRE tunnel between two PCs connected through a switch and the
> GRE tunnel is working fine.
>
> Command used to create tunnel
> ip tunnel add gre1 mode GRE remote <IP> local <IP> TTL 255
>
> Now I want to control the traffic on the GRE interface using ovs.
> When I add the GRE interface in ovs, it doesn't shows up in ovs-ofctl but I
> can see it in ovs-vsctl.

You created an L3 tunnel but OVS is an Ethernet switch, so it doesn't
know how to send traffic over it. It is better to create tunnels
directly through OVS than using the ip command as it is more scalable
and less error prone. There are a number of tutorials on how to do
this floating around.

From sharis at Brocade.com  Wed May 13 18:58:49 2015
From: sharis at Brocade.com (Shiv Haris)
Date: Thu, 14 May 2015 01:58:49 +0000
Subject: [ovs-discuss] Query on LLDP support added as a patch
Message-ID: <2C8E39B1-3C17-43AC-A051-F728547D3759@Brocade.com>

Ben, 

Can you send me more info on this patch.

Re: lldp patch to ova

Thanks.

Sent from my iPhone

From maniksidana019 at gmail.com  Wed May 13 22:14:05 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Thu, 14 May 2015 10:44:05 +0530
Subject: [ovs-discuss] Linux GRE ports don't show up in ovs-ofctl
In-Reply-To: <CAEP_g=8aKFJGve=16reqGxO5dxHy4Y7mxxntud+VjrHdUP+6_A@mail.gmail.com>
References: <CAG-CZ9c7z5FDQJSoPs1iL0vm8Le9Xr0wNh9OfFT8dPFC4mrb7A@mail.gmail.com>
 <CAEP_g=8aKFJGve=16reqGxO5dxHy4Y7mxxntud+VjrHdUP+6_A@mail.gmail.com>
Message-ID: <CAG-CZ9fXNqGp7ZMQNLhdHBnfwRY46UmC1ooXZfq2ZS2b38kw5w@mail.gmail.com>

Thanks for your reply Jesse.

>>You created an L3 tunnel but OVS is an Ethernet switch, so it doesn't
>>know how to send traffic over it
OVS can work on L2/L3/L4, then why it doesn't knows how to send
traffic over it ?
Do you mean that the tunnels created using OVS are L2 tunnels ? I
understand that when we create tunnels using OVS, we specify remote
and local IPs. Aren't these L3 tunnels.

>>It is better to create tunnels
>>directly through OVS than using the ip command as it is more scalable
>>and less error prone. There are a number of tutorials on how to do
>>this floating around.

I'll have a look at it.

I came across the below link while googling
http://t32940.network-openvswitch-development.opennetworks.info/openswitch-and-gre-kernel-module-t32940.html
The link says that OVS GRE tunnels support Ethernet encapsulation. But
again, we give remote and local IP information in OVS GRE tunnels, so
aren't these IP encapsulated tunnels.

I am new to tunneling so some of my questions might sound silly. But,
I'd be glad if you can give me some pointers.

Thanks



On Thu, May 14, 2015 at 3:50 AM, Jesse Gross <jesse at nicira.com> wrote:
>
> On Tue, May 12, 2015 at 10:34 PM, Manik Sidana <maniksidana019 at gmail.com> wrote:
> > Hi all,
> >
> > I have created GRE tunnel between two PCs connected through a switch and the
> > GRE tunnel is working fine.
> >
> > Command used to create tunnel
> > ip tunnel add gre1 mode GRE remote <IP> local <IP> TTL 255
> >
> > Now I want to control the traffic on the GRE interface using ovs.
> > When I add the GRE interface in ovs, it doesn't shows up in ovs-ofctl but I
> > can see it in ovs-vsctl.
>
> You created an L3 tunnel but OVS is an Ethernet switch, so it doesn't
> know how to send traffic over it. It is better to create tunnels
> directly through OVS than using the ip command as it is more scalable
> and less error prone. There are a number of tutorials on how to do
> this floating around.

From jesse at nicira.com  Wed May 13 22:24:09 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 13 May 2015 22:24:09 -0700
Subject: [ovs-discuss] Linux GRE ports don't show up in ovs-ofctl
In-Reply-To: <CAG-CZ9fXNqGp7ZMQNLhdHBnfwRY46UmC1ooXZfq2ZS2b38kw5w@mail.gmail.com>
References: <CAG-CZ9c7z5FDQJSoPs1iL0vm8Le9Xr0wNh9OfFT8dPFC4mrb7A@mail.gmail.com>
 <CAEP_g=8aKFJGve=16reqGxO5dxHy4Y7mxxntud+VjrHdUP+6_A@mail.gmail.com>
 <CAG-CZ9fXNqGp7ZMQNLhdHBnfwRY46UmC1ooXZfq2ZS2b38kw5w@mail.gmail.com>
Message-ID: <CAEP_g=84wZiG95O-3thNy5QaZv2NOLDgaoE=HuqW81w0mA9v+g@mail.gmail.com>

On Wed, May 13, 2015 at 10:14 PM, Manik Sidana <maniksidana019 at gmail.com> wrote:
> Thanks for your reply Jesse.
>
>>>You created an L3 tunnel but OVS is an Ethernet switch, so it doesn't
>>>know how to send traffic over it
> OVS can work on L2/L3/L4, then why it doesn't knows how to send
> traffic over it ?
> Do you mean that the tunnels created using OVS are L2 tunnels ? I
> understand that when we create tunnels using OVS, we specify remote
> and local IPs. Aren't these L3 tunnels.
>
>>>It is better to create tunnels
>>>directly through OVS than using the ip command as it is more scalable
>>>and less error prone. There are a number of tutorials on how to do
>>>this floating around.
>
> I'll have a look at it.
>
> I came across the below link while googling
> http://t32940.network-openvswitch-development.opennetworks.info/openswitch-and-gre-kernel-module-t32940.html
> The link says that OVS GRE tunnels support Ethernet encapsulation. But
> again, we give remote and local IP information in OVS GRE tunnels, so
> aren't these IP encapsulated tunnels.

The frames being encapsulated inside the tunnel are Ethernet (L2). The
outer headers that are used to transport the frame are IP (L3). OVS is
switching packets before they are encapsulated and so it needs to work
on the inner Ethernet frames.

From adampavlidis at gmail.com  Thu May 14 03:08:49 2015
From: adampavlidis at gmail.com (Adam Pavlidis)
Date: Thu, 14 May 2015 13:08:49 +0300
Subject: [ovs-discuss] Ports in sflow samples from OVS
Message-ID: <CAJZwxTpr5HEKNQEJNC4SBRnfvge8aqiwdGFS871muYwXJtft-w@mail.gmail.com>

Hello all,

I am currently trying to use sflow in an SDN environment (mininet).
I have successfully set up the sflow agent in the ovs bridge that is
created by mininet.

My main problem is this that the rules installed by my openflow controller
specify some ports (e.g. port 1, port 2).
However the ports i see in sflow samples are not the same ones. Each time
mininet topology is re-estabilished, ingress and egress ports in the sflow
sample vary.

This is a sample from an ICMP Reply from host1 to host2.



*sflow sample:*
startSample ----------------------
sampleType_tag 0:1
sampleType FLOWSAMPLE
sampleSequenceNo 20
sourceId 2:1000
meanSkipCount 1
samplePool 20
dropEvents 0

*inputPort 675outputPort 677*
flowBlock_tag 0:1001
extendedType SWITCH
in_vlan 0
in_priority 0
out_vlan 0
out_priority 0
flowBlock_tag 0:1
flowSampleType HEADER
headerProtocol 1
sampledPacketSize 102
strippedBytes 4
headerLen 98
headerBytes
00-00-00-00-00-02-00-00-00-00-00-01-08-00-45-00-00-54-CC-BC-00-00-40-01-99-EA-0A-00-00-01-0A-00-00-02-00-00-36-5F-64-2C-00-01-D4-CE-54-55-00-00-00-00-6F-7C-0E-00-00-00-00-00-10-11-12-13-14-15-16-17-18-19-1A-1B-1C-1D-1E-1F-20-21-22-23-24-25-26-27-28-29-2A-2B-2C-2D-2E-2F-30-31-32-33-34-35-36-37
dstMAC 000000000002
srcMAC 000000000001
IPSize 84
ip.tot_len 84
srcIP 10.0.0.1
dstIP 10.0.0.2
IPProtocol 1
IPTOS 0
IPTTL 64
ICMPType 0
ICMPCode 0
endSample   ----------------------


*ovs-dpctl dump-flows <DPath>*

*in_port(2),*
eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),
eth_type(0x0800),
ipv4(src=10.0.0.1,dst=10.0.0.2,proto=1,tos=0,ttl=64,frag=no),
icmp(type=0,code=0),
packets:0,
bytes:0,
used:never,
*actions:sample(sample=100.0%,actions(userspace(pid=4294962193,sFlow(vid=0,pcp=0,output=677)))),
3*


*ovs-ofctl dump-flows s1*

cookie=0x0, duration=1.939s, table=0, n_packets=1, n_bytes=98,
idle_timeout=10, hard_timeout=30, idle_age=1, priority=65535,icmp,
*in_port=1*,vlan_tci=0x0000,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,icmp_type=0,icmp_code=0

*actions=output:2*





Is there any way to map the ports in the sflow sample, to the ports
understood by the openflow controller, and virtual topology?

My aim is to find something like the following mapping:

sflow  -> openflow

"675" -> "port 1"
"677" -> "port 2"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150514/cc39c322/attachment-0001.html>

From a_azouni at esi.dz  Thu May 14 03:43:49 2015
From: a_azouni at esi.dz (Azouni Abdelhadi)
Date: Thu, 14 May 2015 12:43:49 +0200
Subject: [ovs-discuss] in-band control
Message-ID: <CA+_RhB0DJCjzD1h=RzJeJoo1_dHEOEWbiS+18ugLTtuiA2gzqQ@mail.gmail.com>

Hello everyone,

I followed step by step this tutorial to create in-band control
architecture in mininet discuss at openvswitch.org but when sniffing the
traffic on any of the bridges' interfaces (other than s3-eth1) I can't see
any openflow traffic and all what I see on internal interfaces are is ARP
messages. Any ideas why?

Thank you

Abdelhadi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150514/ca17206e/attachment.html>

From peter.phaal at inmon.com  Thu May 14 07:05:59 2015
From: peter.phaal at inmon.com (Peter Phaal)
Date: Thu, 14 May 2015 07:05:59 -0700
Subject: [ovs-discuss] Ports in sflow samples from OVS
In-Reply-To: <CAJZwxTpr5HEKNQEJNC4SBRnfvge8aqiwdGFS871muYwXJtft-w@mail.gmail.com>
References: <CAJZwxTpr5HEKNQEJNC4SBRnfvge8aqiwdGFS871muYwXJtft-w@mail.gmail.com>
Message-ID: <C5BBBD1E-5621-4897-966F-4A8F5B9DFB6B@inmon.com>

You can use ovs-vsctl to dump the naming information for the ports and extract the mapping between the SNMP ifIndex that sFlow uses to identify ports and the OpenFlow port number / name that the controller uses to identify ports:

mininet at mininet-vm:~$ sudo ovs-vsctl --format json --columns name,ofport,ifindex list Interface
{"data":[["s1-eth2",2,172],["s8-eth1",1,189],["s6",65534,203],["s7-eth8",8,159],["s3-eth2",2,176],["s4-eth3",3,186],["s3-eth4",4,192],["s3-eth1",1,168],["s4-eth2",2,178],["s8-eth4",4,195],["s1",65534,199],["s2-eth3",3,182],["s6-eth3",3,177],["s2-eth2",2,174],["s7",65534,202],["s5-eth7",7,150],["s4",65534,201],["s6-eth5",5,152],["s2-eth4",4,190],["s3",65534,200],["s7-eth5",5,156],["s7-eth2",2,183],["s3-eth3",3,184],["s8-eth6",6,161],["s6-eth1",1,173],["s1-eth3",3,180],["s7-eth1",1,181],["s8-eth7",7,162],["s8-eth8",8,163],["s4-eth4",4,194],["s8-eth2",2,191],["s7-eth6",6,157],["s1-eth4",4,188],["s5",65534,196],["s5-eth4",4,171],["s2-eth1",1,166],["s7-eth7",7,158],["s6-eth2",2,175],["s2",65534,197],["s8",65534,198],["s8-eth3",3,193],["s6-eth6",6,153],["s8-eth5",5,160],["s7-eth4",4,187],["s5-eth3",3,169],["s6-eth4",4,179],["s1-eth1",1,164],["s6-eth7",7,154],["s4-eth1",1,170],["s5-eth8",8,151],["s7-eth3",3,185],["s5-eth2",2,167],["s6-eth8",8,155],["s5-eth1",1,165],["s5-eth5",5,148],["s5-eth6",6,149]],"headings":["name","ofport","ifindex"]}


> On May 14, 2015, at 3:08 AM, Adam Pavlidis <adampavlidis at gmail.com> wrote:
> 
> Hello all,
> 
> I am currently trying to use sflow in an SDN environment (mininet).
> I have successfully set up the sflow agent in the ovs bridge that is created by mininet.
> 
> My main problem is this that the rules installed by my openflow controller specify some ports (e.g. port 1, port 2). 
> However the ports i see in sflow samples are not the same ones. Each time mininet topology is re-estabilished, ingress and egress ports in the sflow sample vary.
> 
> This is a sample from an ICMP Reply from host1 to host2.
> 
> 
> sflow sample:
> 
> startSample ----------------------
> sampleType_tag 0:1
> sampleType FLOWSAMPLE
> sampleSequenceNo 20
> sourceId 2:1000
> meanSkipCount 1
> samplePool 20
> dropEvents 0
> inputPort 675
> outputPort 677
> flowBlock_tag 0:1001
> extendedType SWITCH
> in_vlan 0
> in_priority 0
> out_vlan 0
> out_priority 0
> flowBlock_tag 0:1
> flowSampleType HEADER
> headerProtocol 1
> sampledPacketSize 102
> strippedBytes 4
> headerLen 98
> headerBytes 00-00-00-00-00-02-00-00-00-00-00-01-08-00-45-00-00-54-CC-BC-00-00-40-01-99-EA-0A-00-00-01-0A-00-00-02-00-00-36-5F-64-2C-00-01-D4-CE-54-55-00-00-00-00-6F-7C-0E-00-00-00-00-00-10-11-12-13-14-15-16-17-18-19-1A-1B-1C-1D-1E-1F-20-21-22-23-24-25-26-27-28-29-2A-2B-2C-2D-2E-2F-30-31-32-33-34-35-36-37
> dstMAC 000000000002
> srcMAC 000000000001
> IPSize 84
> ip.tot_len 84
> srcIP 10.0.0.1
> dstIP 10.0.0.2
> IPProtocol 1
> IPTOS 0
> IPTTL 64
> ICMPType 0
> ICMPCode 0
> endSample   ----------------------
> 
> 
> ovs-dpctl dump-flows <DPath>
> 
> in_port(2),
> eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),
> eth_type(0x0800),
> ipv4(src=10.0.0.1,dst=10.0.0.2,proto=1,tos=0,ttl=64,frag=no),
> icmp(type=0,code=0), 
> packets:0, 
> bytes:0, 
> used:never, 
> actions:sample(sample=100.0%,actions(userspace(pid=4294962193,sFlow(vid=0,pcp=0,output=677)))),   3
> 
> 
> ovs-ofctl dump-flows s1
> 
> cookie=0x0, duration=1.939s, table=0, n_packets=1, n_bytes=98, idle_timeout=10, hard_timeout=30, idle_age=1, priority=65535,icmp,
> in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,icmp_type=0,icmp_code=0 
> actions=output:2
> 
> 
> 
> 
> 
> Is there any way to map the ports in the sflow sample, to the ports understood by the openflow controller, and virtual topology?
> 
> My aim is to find something like the following mapping:
> 
> sflow  -> openflow
> 
> "675" -> "port 1"
> "677" -> "port 2"
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150514/e11f9eb0/attachment.html>

From liw at dtdream.com  Fri May 15 01:03:06 2015
From: liw at dtdream.com (=?UTF-8?B?6ZKi6ZSBMDMxMA==?=)
Date: Fri, 15 May 2015 16:03:06 +0800
Subject: [ovs-discuss] =?utf-8?q?For_help_about_how_to_connect_vm_to_ovs-d?=
	=?utf-8?q?kdp?=
Message-ID: <5109d9b6-c165-4486-b885-7fbab07973ba@dtdream.com>

i have compiled ovs-dpdk using ovs master code by following the step in Install.dpdk

excu cmdvsdb-server --remote=punix:/usr/local/var/run/openvswitch/db.sock --pidfile --detach
ovs-vswitchd  --dpdk -c 0xf -n 4 --socket-mem 128 -- unix:/usr/local/var/run/openvswitch/db.sock --detach
srwxr-xr-x  1 root root      0 May 14 18:29 vhost-net      a socket is created
how can i connect the qemu vm?the socket vhost-net is what and  how use ?
anyone has some step-by-step doc for ovs-dpdk? pls send me   tks
*********************RTFSC*********************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150515/432a5cf0/attachment.html>

From adampavlidis at gmail.com  Fri May 15 03:13:56 2015
From: adampavlidis at gmail.com (Adam Pavlidis)
Date: Fri, 15 May 2015 13:13:56 +0300
Subject: [ovs-discuss] Ports in sflow samples from OVS
In-Reply-To: <C5BBBD1E-5621-4897-966F-4A8F5B9DFB6B@inmon.com>
References: <CAJZwxTpr5HEKNQEJNC4SBRnfvge8aqiwdGFS871muYwXJtft-w@mail.gmail.com>
 <C5BBBD1E-5621-4897-966F-4A8F5B9DFB6B@inmon.com>
Message-ID: <CAJZwxTrsJzK0or=8PhY3UkJODy5YT3ALjHHS+U0-UAXxR=6wCQ@mail.gmail.com>

Thank you very much! That's exactly what i am searching for. However when i
try the above command i get this:

*ovs-vsctl: Interface does not contain a column whose name matches
"ifindex"*

i tried something more general, and as the above command stated no such
column:




























*sudo ovs-vsctl list Interface_uuid               :
18ee3470-ef22-4b6f-b9c3-4c6111842f1eadmin_state         :
upcfm_fault           : []cfm_fault_status    : []cfm_health          :
[]cfm_mpid            : []cfm_remote_mpids    : []cfm_remote_opstate  :
[]duplex              : fullexternal_ids        : {}ingress_policing_burst:
0ingress_policing_rate: 0lacp_current        : []link_resets         :
0link_speed          : 10000000000link_state          :
upmac                 : []mac_in_use          :
"3a:c5:8b:44:ab:4d"mtu                 : 1500name                :
"s1-eth2"ofport              : 2ofport_request      : []options
: {}other_config        : {}statistics          : {collisions=0,
rx_bytes=558, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0,
rx_over_err=0, rx_packets=7, tx_bytes=320, tx_dropped=0, tx_errors=0,
tx_packets=4}status              : {driver_name=veth, driver_version="1.0",
firmware_version=""}type                : ""*

I guess my mininet vm uses an older version of ovs that perhaps does not
support ifIndex?



*sudo ovs-vsctl --versionovs-vsctl (Open vSwitch) 1.10.2*



I would like to ask something else about sflow and ovs.

Lets say i have a mininet topology again with a couple virtual switches (s1
, s2)
I again add the sflow agents. I want to sort the samples based on which
switch they are received from.
I am thinking  *agentSubId* & *sourceId*  fields are the ones i must focus
on. However again, is there anyway to map
the sflow sample to the datapath Id my openflow controller understands?

sflow sample:

*sourceId 2:1000*


openflow controller:

*Connection [00-00-00-00-00-01 1]*




Thanks in advance

On Thu, May 14, 2015 at 5:05 PM, Peter Phaal <peter.phaal at inmon.com> wrote:

> You can use ovs-vsctl to dump the naming information for the ports and
> extract the mapping between the SNMP ifIndex that sFlow uses to identify
> ports and the OpenFlow port number / name that the controller uses to
> identify ports:
>
> mininet at mininet-vm:~$ sudo ovs-vsctl --format json --columns
> name,ofport,ifindex list Interface
>
> {"data":[["s1-eth2",2,172],["s8-eth1",1,189],["s6",65534,203],["s7-eth8",8,159],["s3-eth2",2,176],["s4-eth3",3,186],["s3-eth4",4,192],["s3-eth1",1,168],["s4-eth2",2,178],["s8-eth4",4,195],["s1",65534,199],["s2-eth3",3,182],["s6-eth3",3,177],["s2-eth2",2,174],["s7",65534,202],["s5-eth7",7,150],["s4",65534,201],["s6-eth5",5,152],["s2-eth4",4,190],["s3",65534,200],["s7-eth5",5,156],["s7-eth2",2,183],["s3-eth3",3,184],["s8-eth6",6,161],["s6-eth1",1,173],["s1-eth3",3,180],["s7-eth1",1,181],["s8-eth7",7,162],["s8-eth8",8,163],["s4-eth4",4,194],["s8-eth2",2,191],["s7-eth6",6,157],["s1-eth4",4,188],["s5",65534,196],["s5-eth4",4,171],["s2-eth1",1,166],["s7-eth7",7,158],["s6-eth2",2,175],["s2",65534,197],["s8",65534,198],["s8-eth3",3,193],["s6-eth6",6,153],["s8-eth5",5,160],["s7-eth4",4,187],["s5-eth3",3,169],["s6-eth4",4,179],["s1-eth1",1,164],["s6-eth7",7,154],["s4-eth1",1,170],["s5-eth8",8,151],["s7-eth3",3,185],["s5-eth2",2,167],["s6-eth8",8,155],["s5-eth1",1,165],["s5-eth5",5,148],["s5-eth6",6,149]],"headings":["name","ofport","ifindex"]}
>
>
> On May 14, 2015, at 3:08 AM, Adam Pavlidis <adampavlidis at gmail.com> wrote:
>
> Hello all,
>
> I am currently trying to use sflow in an SDN environment (mininet).
> I have successfully set up the sflow agent in the ovs bridge that is
> created by mininet.
>
> My main problem is this that the rules installed by my openflow controller
> specify some ports (e.g. port 1, port 2).
> However the ports i see in sflow samples are not the same ones. Each time
> mininet topology is re-estabilished, ingress and egress ports in the sflow
> sample vary.
>
> This is a sample from an ICMP Reply from host1 to host2.
>
>
>
> *sflow sample:*
> startSample ----------------------
> sampleType_tag 0:1
> sampleType FLOWSAMPLE
> sampleSequenceNo 20
> sourceId 2:1000
> meanSkipCount 1
> samplePool 20
> dropEvents 0
>
> *inputPort 675outputPort 677*
> flowBlock_tag 0:1001
> extendedType SWITCH
> in_vlan 0
> in_priority 0
> out_vlan 0
> out_priority 0
> flowBlock_tag 0:1
> flowSampleType HEADER
> headerProtocol 1
> sampledPacketSize 102
> strippedBytes 4
> headerLen 98
> headerBytes
> 00-00-00-00-00-02-00-00-00-00-00-01-08-00-45-00-00-54-CC-BC-00-00-40-01-99-EA-0A-00-00-01-0A-00-00-02-00-00-36-5F-64-2C-00-01-D4-CE-54-55-00-00-00-00-6F-7C-0E-00-00-00-00-00-10-11-12-13-14-15-16-17-18-19-1A-1B-1C-1D-1E-1F-20-21-22-23-24-25-26-27-28-29-2A-2B-2C-2D-2E-2F-30-31-32-33-34-35-36-37
> dstMAC 000000000002
> srcMAC 000000000001
> IPSize 84
> ip.tot_len 84
> srcIP 10.0.0.1
> dstIP 10.0.0.2
> IPProtocol 1
> IPTOS 0
> IPTTL 64
> ICMPType 0
> ICMPCode 0
> endSample   ----------------------
>
>
> *ovs-dpctl dump-flows <DPath>*
>
> *in_port(2),*
> eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),
> eth_type(0x0800),
> ipv4(src=10.0.0.1,dst=10.0.0.2,proto=1,tos=0,ttl=64,frag=no),
> icmp(type=0,code=0),
> packets:0,
> bytes:0,
> used:never,
> *actions:sample(sample=100.0%,actions(userspace(pid=4294962193,sFlow(vid=0,pcp=0,output=677)))),
> 3*
>
>
> *ovs-ofctl dump-flows s1*
>
> cookie=0x0, duration=1.939s, table=0, n_packets=1, n_bytes=98,
> idle_timeout=10, hard_timeout=30, idle_age=1, priority=65535,icmp,
> *in_port=1*,vlan_tci=0x0000,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,icmp_type=0,icmp_code=0
>
> *actions=output:2*
>
>
>
>
>
> Is there any way to map the ports in the sflow sample, to the ports
> understood by the openflow controller, and virtual topology?
>
> My aim is to find something like the following mapping:
>
> sflow  -> openflow
>
> "675" -> "port 1"
> "677" -> "port 2"
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150515/e25ba60b/attachment.html>

From daniels at research.att.com  Fri May 15 04:41:36 2015
From: daniels at research.att.com (Scott Daniels)
Date: Fri, 15 May 2015 07:41:36 -0400 (EDT)
Subject: [ovs-discuss] Meter implementation
Message-ID: <alpine.LSU.2.11.1505150737080.27120@ybpnyubfg>


It appears that meters are implemented in ovs-ofctl, but not in the 
underlying datapath code.  Is there a technical limitation that has 
prevented the addition, or has it been just a matter of needing the work 
to be contributed?

Thanks,
Scott

------------------------------------------------------------------------
E. Scott Daniels
PMTS - Cloud Software Research
AT&T Labs - Research
daniels at research.att.com
440.389.0011


From kevin.traynor at intel.com  Fri May 15 04:51:44 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Fri, 15 May 2015 11:51:44 +0000
Subject: [ovs-discuss] For help about how to connect vm to ovs-dkdp
In-Reply-To: <5109d9b6-c165-4486-b885-7fbab07973ba@dtdream.com>
References: <5109d9b6-c165-4486-b885-7fbab07973ba@dtdream.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F730752A8D@IRSMSX104.ger.corp.intel.com>


From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of ??0310
Sent: Friday, May 15, 2015 9:03 AM
To: discuss at openvswitch.org
Subject: [ovs-discuss] For help about how to connect vm to ovs-dkdp


i have compiled ovs-dpdk using ovs master code by following the step in Install.dpdk



excu cmd

vsdb-server --remote=punix:/usr/local/var/run/openvswitch/db.sock --pidfile --detach
ovs-vswitchd  --dpdk -c 0xf -n 4 --socket-mem 128 -- unix:/usr/local/var/run/openvswitch/db.sock --detach



srwxr-xr-x  1 root root      0 May 14 18:29 vhost-net      a socket is created



how can i connect the qemu vm?

the socket vhost-net is what and  how use ?



If you have a look at this section in the INSTALL.DPDK.md it should explain these

https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#dpdk-vhost-vm-configuration





anyone has some step-by-step doc for ovs-dpdk? pls send me   tks



*********************

RTFSC

*********************


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150515/341438e5/attachment.html>

From peter.phaal at inmon.com  Fri May 15 07:23:08 2015
From: peter.phaal at inmon.com (Peter Phaal)
Date: Fri, 15 May 2015 07:23:08 -0700
Subject: [ovs-discuss] Ports in sflow samples from OVS
In-Reply-To: <CAJZwxTrsJzK0or=8PhY3UkJODy5YT3ALjHHS+U0-UAXxR=6wCQ@mail.gmail.com>
References: <CAJZwxTpr5HEKNQEJNC4SBRnfvge8aqiwdGFS871muYwXJtft-w@mail.gmail.com>
 <C5BBBD1E-5621-4897-966F-4A8F5B9DFB6B@inmon.com>
 <CAJZwxTrsJzK0or=8PhY3UkJODy5YT3ALjHHS+U0-UAXxR=6wCQ@mail.gmail.com>
Message-ID: <8836DA74-1AE5-4FEB-A1C6-774B4F0110C5@inmon.com>

I believe the ifIndex was added as an ovs-vsctl list option in OVS 2.0+ (which is included in the latest Mininet VM). Mininet 2.0 is useful for performance studies since it it lets you set link speeds and queueing policies.

As far as sFlow is concerned OVS is a single switch, irrespective of the number of logical OpenFlow bridges that have been defined. Mininet uses a single OVS with multiple OpeFlow bridges to build the network so you need to map between sFlow ifIndex to [ofbridge,ofport] pairs. By default, Mininet encodes the logical switch name as part of the interface name, e.g. “s1-eth2”, so it is easy to split the name and extract the switch the port is attached to.

The following article provides a comprehensive example of integrating sFlow and OpenFlow data in Mininet:

http://blog.sflow.com/2015/01/hybrid-openflow-ecmp-testbed.html <http://blog.sflow.com/2015/01/hybrid-openflow-ecmp-testbed.html>

If you look at the leafandspine.py script in the example it will show you how to export a combined sFlow/OpenFlow topology.

> On May 15, 2015, at 3:13 AM, Adam Pavlidis <adampavlidis at gmail.com> wrote:
> 
> Thank you very much! That's exactly what i am searching for. However when i try the above command i get this: 
> 
> ovs-vsctl: Interface does not contain a column whose name matches "ifindex" 
> 
> i tried something more general, and as the above command stated no such column:
> 
> sudo ovs-vsctl list Interface
> _uuid               : 18ee3470-ef22-4b6f-b9c3-4c6111842f1e
> admin_state         : up
> cfm_fault           : []
> cfm_fault_status    : []
> cfm_health          : []
> cfm_mpid            : []
> cfm_remote_mpids    : []
> cfm_remote_opstate  : []
> duplex              : full
> external_ids        : {}
> ingress_policing_burst: 0
> ingress_policing_rate: 0
> lacp_current        : []
> link_resets         : 0
> link_speed          : 10000000000
> link_state          : up
> mac                 : []
> mac_in_use          : "3a:c5:8b:44:ab:4d"
> mtu                 : 1500
> name                : "s1-eth2"
> ofport              : 2
> ofport_request      : []
> options             : {}
> other_config        : {}
> statistics          : {collisions=0, rx_bytes=558, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=7, tx_bytes=320, tx_dropped=0, tx_errors=0, tx_packets=4}
> status              : {driver_name=veth, driver_version="1.0", firmware_version=""}
> type                : ""
> 
> I guess my mininet vm uses an older version of ovs that perhaps does not support ifIndex?
> 
> 
> sudo ovs-vsctl --version
> ovs-vsctl (Open vSwitch) 1.10.2
> 
> 
> 
> I would like to ask something else about sflow and ovs.
> 
> Lets say i have a mininet topology again with a couple virtual switches (s1 , s2)
> I again add the sflow agents. I want to sort the samples based on which switch they are received from. 
> I am thinking  agentSubId & sourceId  fields are the ones i must focus on. However again, is there anyway to map 
> the sflow sample to the datapath Id my openflow controller understands?
> 
> sflow sample:
> 
> sourceId 2:1000
> 
> 
> openflow controller:
> 
> Connection [00-00-00-00-00-01 1]
> 
> 
> 
> 
> Thanks in advance
> 
> On Thu, May 14, 2015 at 5:05 PM, Peter Phaal <peter.phaal at inmon.com <mailto:peter.phaal at inmon.com>> wrote:
> You can use ovs-vsctl to dump the naming information for the ports and extract the mapping between the SNMP ifIndex that sFlow uses to identify ports and the OpenFlow port number / name that the controller uses to identify ports:
> 
> mininet at mininet-vm:~$ sudo ovs-vsctl --format json --columns name,ofport,ifindex list Interface
> {"data":[["s1-eth2",2,172],["s8-eth1",1,189],["s6",65534,203],["s7-eth8",8,159],["s3-eth2",2,176],["s4-eth3",3,186],["s3-eth4",4,192],["s3-eth1",1,168],["s4-eth2",2,178],["s8-eth4",4,195],["s1",65534,199],["s2-eth3",3,182],["s6-eth3",3,177],["s2-eth2",2,174],["s7",65534,202],["s5-eth7",7,150],["s4",65534,201],["s6-eth5",5,152],["s2-eth4",4,190],["s3",65534,200],["s7-eth5",5,156],["s7-eth2",2,183],["s3-eth3",3,184],["s8-eth6",6,161],["s6-eth1",1,173],["s1-eth3",3,180],["s7-eth1",1,181],["s8-eth7",7,162],["s8-eth8",8,163],["s4-eth4",4,194],["s8-eth2",2,191],["s7-eth6",6,157],["s1-eth4",4,188],["s5",65534,196],["s5-eth4",4,171],["s2-eth1",1,166],["s7-eth7",7,158],["s6-eth2",2,175],["s2",65534,197],["s8",65534,198],["s8-eth3",3,193],["s6-eth6",6,153],["s8-eth5",5,160],["s7-eth4",4,187],["s5-eth3",3,169],["s6-eth4",4,179],["s1-eth1",1,164],["s6-eth7",7,154],["s4-eth1",1,170],["s5-eth8",8,151],["s7-eth3",3,185],["s5-eth2",2,167],["s6-eth8",8,155],["s5-eth1",1,165],["s5-eth5",5,148],["s5-eth6",6,149]],"headings":["name","ofport","ifindex"]}
> 
> 
>> On May 14, 2015, at 3:08 AM, Adam Pavlidis <adampavlidis at gmail.com <mailto:adampavlidis at gmail.com>> wrote:
>> 
>> Hello all,
>> 
>> I am currently trying to use sflow in an SDN environment (mininet).
>> I have successfully set up the sflow agent in the ovs bridge that is created by mininet.
>> 
>> My main problem is this that the rules installed by my openflow controller specify some ports (e.g. port 1, port 2). 
>> However the ports i see in sflow samples are not the same ones. Each time mininet topology is re-estabilished, ingress and egress ports in the sflow sample vary.
>> 
>> This is a sample from an ICMP Reply from host1 to host2.
>> 
>> 
>> sflow sample:
>> 
>> startSample ----------------------
>> sampleType_tag 0:1
>> sampleType FLOWSAMPLE
>> sampleSequenceNo 20
>> sourceId 2:1000
>> meanSkipCount 1
>> samplePool 20
>> dropEvents 0
>> inputPort 675
>> outputPort 677
>> flowBlock_tag 0:1001
>> extendedType SWITCH
>> in_vlan 0
>> in_priority 0
>> out_vlan 0
>> out_priority 0
>> flowBlock_tag 0:1
>> flowSampleType HEADER
>> headerProtocol 1
>> sampledPacketSize 102
>> strippedBytes 4
>> headerLen 98
>> headerBytes 00-00-00-00-00-02-00-00-00-00-00-01-08-00-45-00-00-54-CC-BC-00-00-40-01-99-EA-0A-00-00-01-0A-00-00-02-00-00-36-5F-64-2C-00-01-D4-CE-54-55-00-00-00-00-6F-7C-0E-00-00-00-00-00-10-11-12-13-14-15-16-17-18-19-1A-1B-1C-1D-1E-1F-20-21-22-23-24-25-26-27-28-29-2A-2B-2C-2D-2E-2F-30-31-32-33-34-35-36-37
>> dstMAC 000000000002
>> srcMAC 000000000001
>> IPSize 84
>> ip.tot_len 84
>> srcIP 10.0.0.1
>> dstIP 10.0.0.2
>> IPProtocol 1
>> IPTOS 0
>> IPTTL 64
>> ICMPType 0
>> ICMPCode 0
>> endSample   ----------------------
>> 
>> 
>> ovs-dpctl dump-flows <DPath>
>> 
>> in_port(2),
>> eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),
>> eth_type(0x0800),
>> ipv4(src=10.0.0.1,dst=10.0.0.2,proto=1,tos=0,ttl=64,frag=no),
>> icmp(type=0,code=0), 
>> packets:0, 
>> bytes:0, 
>> used:never, 
>> actions:sample(sample=100.0%,actions(userspace(pid=4294962193,sFlow(vid=0,pcp=0,output=677)))),   3
>> 
>> 
>> ovs-ofctl dump-flows s1
>> 
>> cookie=0x0, duration=1.939s, table=0, n_packets=1, n_bytes=98, idle_timeout=10, hard_timeout=30, idle_age=1, priority=65535,icmp,
>> in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,icmp_type=0,icmp_code=0 
>> actions=output:2
>> 
>> 
>> 
>> 
>> 
>> Is there any way to map the ports in the sflow sample, to the ports understood by the openflow controller, and virtual topology?
>> 
>> My aim is to find something like the following mapping:
>> 
>> sflow  -> openflow
>> 
>> "675" -> "port 1"
>> "677" -> "port 2"
>> 
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150515/78aaf39c/attachment-0001.html>

From krzysztof.wojciechowski at techstorage.pl  Wed May 13 13:49:50 2015
From: krzysztof.wojciechowski at techstorage.pl (Krzysztof Wojciechowski)
Date: Wed, 13 May 2015 22:49:50 +0200
Subject: [ovs-discuss] Ovs-testcontroller hard timeout
Message-ID: <5553B8EE.8000704@techstorage.pl>

Hello

I am searching for this for 2 days. Is it possible to change flows hard timeout using ovs-testcontroller? I need to set it for something like 3 seconds. Is there such a possibility? Maybe its hardcoded somewhere? Or i can set it somewhere in other (no controller) configuration?

Greetings
Krzysztof Wojciechowski


From ddesimon at cisco.com  Fri May 15 05:33:39 2015
From: ddesimon at cisco.com (Dave DeSimone (ddesimon))
Date: Fri, 15 May 2015 12:33:39 +0000
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <D17A35F6.18A0FA%ddesimon@cisco.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
Message-ID: <D17B5F0A.18A276%ddesimon@cisco.com>


Hi,

I’m running an OVS rpm (no source code) on RHEL 7.0

ovs-vswitchd (Open vSwitch) 2.3.1
Compiled Dec 26 2014 15:35:15
OpenFlow versions 0x1:0x1


Is there support in this version for LLDP?

On the wiki it says


  *   IETF Auto-Attach SPBM and rudimentary required LLDP support

Is there any documentation on this as it looks like a new feature on this latest release?

What exactly has to be configured to get LLDP working?
I have lldpad installed on my OS. When I send lldp packets to an interface which is not connected to an ovs bridge, the lldp process receives the packets.
If lldp packets go through an ovs bridge, then the packets never make it to the lldp process.


I can see from tcpdump, the lldp pkts coming in on the physical interface, but lldptool doesn’t see any lldp packets. I also do not see any drops on the ovs stats for the interface.

I have set other-config,

ovs-vsctl set Bridge br0 other_config:forward-bpdu=true

But that hasn’t helped either.

The interface in question is tied to an ovs bridge named br0, where enp130s0f0 is the physical interface,.


    Bridge "br0"
        Port "mgmt0"
            Interface "mgmt0"
                type: internal
        Port "enp130s0f0"
            Interface "enp130s0f0"
        Port "br0"
            Interface "br0"
                type: internal
    ovs_version: "2.3.1"


ovs-vsctl list bridge br0
_uuid               : c25fe339-92a6-4a1c-be82-5d224e96d72e
controller          : []
datapath_id         : "0000a0369f33e41c"
datapath_type       : ""
external_ids        : {}
fail_mode           : []
flood_vlans         : []
flow_tables         : {}
ipfix               : []
mirrors             : []
name                : "br0"
netflow             : []
other_config        : {}
ports               : [02d42891-4376-4c5a-aefe-a46e2492eff8, 58257145-9a3e-4644-aae5-539464a71498, 6b424294-5bc8-40e5-9b12-efffd86c50b7]
protocols           : []
sflow               : []
status              : {}
stp_enable          : false



What is rudimentary required LLDP support?


Thanks,

—Dave DeSimone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150515/830dd19b/attachment.html>

From chan7781 at kettering.edu  Fri May 15 08:56:42 2015
From: chan7781 at kettering.edu (Alison C.)
Date: Fri, 15 May 2015 11:56:42 -0400
Subject: [ovs-discuss] OVS 2.3.1 build fail using openwrt buildroot
Message-ID: <CABcSDhfSK54rswY9Z5E7kgBRodw-0xQkpQMZmf88Vvbx8dndhw@mail.gmail.com>

Hey everybody,

Is there a minimum binutils version required to build OVS 2.3.1?

I'm trying to build it in a openwrt buildroot environment, but it
fails with "{standard input}:1116: Error: unknown pseudo-op:
`.tprelword'". According to a [Stack Overflow
thread](http://stackoverflow.com/questions/8872517) this could be due
to too old version of binutils or gcc/g++ version mismatch. The
versions of gcc, g++, and binutils are as follows:

[11:42:40] erinacity:~/Code/openwrt/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin
alisonc $ ./mips-openwrt-linux-uclibc-gcc --version | head -1
mips-openwrt-linux-uclibc-gcc (OpenWrt/Linaro GCC 4.8-2014.04 r45620) 4.8.3

alisonc $ ./mips-openwrt-linux-uclibc-g++ --version | head -1
mips-openwrt-linux-uclibc-g++ (OpenWrt/Linaro GCC 4.8-2014.04 r45620) 4.8.3

alisonc $ ./mips-openwrt-linux-uclibc-as --version | head -1
GNU assembler (GNU Binutils) 2.22

Thanks for any input you might have.

Cheers,
Alison

--
Alison C.
Kettering University
chan7781 at kettering.edu

From blp at nicira.com  Fri May 15 09:18:34 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 15 May 2015 09:18:34 -0700
Subject: [ovs-discuss] Ovs-testcontroller hard timeout
In-Reply-To: <5553B8EE.8000704@techstorage.pl>
References: <5553B8EE.8000704@techstorage.pl>
Message-ID: <20150515161834.GB9947@nicira.com>

On Wed, May 13, 2015 at 10:49:50PM +0200, Krzysztof Wojciechowski wrote:
> I am searching for this for 2 days. Is it possible to change flows
> hard timeout using ovs-testcontroller? I need to set it for something
> like 3 seconds. Is there such a possibility? Maybe its hardcoded
> somewhere? Or i can set it somewhere in other (no controller)
> configuration?

ovs-testcontroller doesn't have that feature.

From alexw at nicira.com  Fri May 15 09:20:57 2015
From: alexw at nicira.com (Alex Wang)
Date: Fri, 15 May 2015 09:20:57 -0700
Subject: [ovs-discuss] Ovs-testcontroller hard timeout
In-Reply-To: <20150515161834.GB9947@nicira.com>
References: <5553B8EE.8000704@techstorage.pl>
 <20150515161834.GB9947@nicira.com>
Message-ID: <CAArS4XX2VAFNO5+8y0RgXwmH0axO8L=t_eB_c=s+LzYcQRj9tQ@mail.gmail.com>

You may want to check the '--with-flows file' option if you want  to hack
something out.
~

On Fri, May 15, 2015 at 9:18 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, May 13, 2015 at 10:49:50PM +0200, Krzysztof Wojciechowski wrote:
> > I am searching for this for 2 days. Is it possible to change flows
> > hard timeout using ovs-testcontroller? I need to set it for something
> > like 3 seconds. Is there such a possibility? Maybe its hardcoded
> > somewhere? Or i can set it somewhere in other (no controller)
> > configuration?
>
> ovs-testcontroller doesn't have that feature.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150515/815e8ccd/attachment.html>

From blp at nicira.com  Fri May 15 09:27:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 15 May 2015 09:27:17 -0700
Subject: [ovs-discuss] [ovs-dev] OVS 2.3.1 build fail using openwrt
	buildroot
In-Reply-To: <CABcSDhfSK54rswY9Z5E7kgBRodw-0xQkpQMZmf88Vvbx8dndhw@mail.gmail.com>
References: <CABcSDhfSK54rswY9Z5E7kgBRodw-0xQkpQMZmf88Vvbx8dndhw@mail.gmail.com>
Message-ID: <20150515162717.GF9947@nicira.com>

On Fri, May 15, 2015 at 11:56:42AM -0400, Alison C. wrote:
> Hey everybody,
> 
> Is there a minimum binutils version required to build OVS 2.3.1?
> 
> I'm trying to build it in a openwrt buildroot environment, but it
> fails with "{standard input}:1116: Error: unknown pseudo-op:
> `.tprelword'". According to a [Stack Overflow
> thread](http://stackoverflow.com/questions/8872517) this could be due
> to too old version of binutils or gcc/g++ version mismatch. The
> versions of gcc, g++, and binutils are as follows:
> 
> [11:42:40] erinacity:~/Code/openwrt/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin
> alisonc $ ./mips-openwrt-linux-uclibc-gcc --version | head -1
> mips-openwrt-linux-uclibc-gcc (OpenWrt/Linaro GCC 4.8-2014.04 r45620) 4.8.3
> 
> alisonc $ ./mips-openwrt-linux-uclibc-g++ --version | head -1
> mips-openwrt-linux-uclibc-g++ (OpenWrt/Linaro GCC 4.8-2014.04 r45620) 4.8.3
> 
> alisonc $ ./mips-openwrt-linux-uclibc-as --version | head -1
> GNU assembler (GNU Binutils) 2.22
> 
> Thanks for any input you might have.

OVS doesn't have any particular binutils requirement.  OVS does do a
couple of minor "linker tricks" but binutils has supported those from
well before the time OVS started development around 2009.

From blp at nicira.com  Fri May 15 11:20:34 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 15 May 2015 11:20:34 -0700
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <D17B5F0A.18A276%ddesimon@cisco.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
 <D17B5F0A.18A276%ddesimon@cisco.com>
Message-ID: <20150515181031.GA14637@nicira.com>

On Fri, May 15, 2015 at 12:33:39PM +0000, Dave DeSimone (ddesimon) wrote:
> 
> Hi,
> 
> I?m running an OVS rpm (no source code) on RHEL 7.0
> 
> ovs-vswitchd (Open vSwitch) 2.3.1
> Compiled Dec 26 2014 15:35:15
> OpenFlow versions 0x1:0x1
> 
> 
> Is there support in this version for LLDP?
> 
> On the wiki it says
> 
> 
>   *   IETF Auto-Attach SPBM and rudimentary required LLDP support
> 
> Is there any documentation on this as it looks like a new feature on this latest release?

This support is only going to be useful if you want to use Auto-Attach
SPBM.

From blp at nicira.com  Fri May 15 11:23:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 15 May 2015 11:23:28 -0700
Subject: [ovs-discuss] Meter implementation
In-Reply-To: <alpine.LSU.2.11.1505150737080.27120@ybpnyubfg>
References: <alpine.LSU.2.11.1505150737080.27120@ybpnyubfg>
Message-ID: <20150515182328.GB14637@nicira.com>

On Fri, May 15, 2015 at 07:41:36AM -0400, Scott Daniels wrote:
> It appears that meters are implemented in ovs-ofctl, but not in the
> underlying datapath code.  Is there a technical limitation that has
> prevented the addition, or has it been just a matter of needing the
> work to be contributed?

A series was posted sometime last year, but it required some changes
which haven't been made yet.

In general, meters don't map well to Linux tc-based qdiscs, and we
expect that the Linux network maintainers are unlikely to be
enthusiastic about adding a new kind of OpenFlow-specific QoS.

From blp at nicira.com  Fri May 15 16:34:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 15 May 2015 16:34:29 -0700
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <D17BB16E.18A33F%ddesimon@cisco.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
 <D17B5F0A.18A276%ddesimon@cisco.com>
 <20150515181031.GA14637@nicira.com>
 <D17BB16E.18A33F%ddesimon@cisco.com>
Message-ID: <20150515233429.GC14637@nicira.com>

On Fri, May 15, 2015 at 07:19:51PM +0000, Dave DeSimone (ddesimon) wrote:
> Thanks for the quick reply!
> 
> Ok. How do I get the lldp packets through ovs to the lldp process?

One common way is to implement lldp as an OpenFlow controller and
direct packets to it with "controller" actions that send OpenFlow
"packet-in" messages to the controller.

From blp at nicira.com  Fri May 15 16:39:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 15 May 2015 16:39:10 -0700
Subject: [ovs-discuss] Ovs-testcontroller hard timeout
In-Reply-To: <555682F5.6020405@techstorage.pl>
References: <5553B8EE.8000704@techstorage.pl>
 <20150515161834.GB9947@nicira.com>
 <CAArS4XX2VAFNO5+8y0RgXwmH0axO8L=t_eB_c=s+LzYcQRj9tQ@mail.gmail.com>
 <555682F5.6020405@techstorage.pl>
Message-ID: <CACjuMbwctk_hyQe30M=DBNMS190tV94E40BQ5369PZK-3jxG4Q@mail.gmail.com>

On Fri, May 15, 2015 at 4:36 PM, Krzysztof Wojciechowski
<krzysztof.wojciechowski at techstorage.pl> wrote:
> Maybe i can add some "fm." line (something like fm.hard_timeout ?), and just
> hardcode it?

Sure, that ought to work.
-- 
"I don't normally do acked-by's.  I think it's my way of avoiding
getting blamed when it all blows up."               Andrew Morton

From blp at nicira.com  Fri May 15 16:52:46 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 15 May 2015 16:52:46 -0700
Subject: [ovs-discuss] Query on LLDP support added as a patch
In-Reply-To: <2C8E39B1-3C17-43AC-A051-F728547D3759@Brocade.com>
References: <2C8E39B1-3C17-43AC-A051-F728547D3759@Brocade.com>
Message-ID: <20150515235246.GE14637@nicira.com>

On Thu, May 14, 2015 at 01:58:49AM +0000, Shiv Haris wrote:
> Can you send me more info on this patch.
> 
> Re: lldp patch to ova

I do not know of any patch with that name.

From ddesimon at cisco.com  Fri May 15 12:19:51 2015
From: ddesimon at cisco.com (Dave DeSimone (ddesimon))
Date: Fri, 15 May 2015 19:19:51 +0000
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <20150515181031.GA14637@nicira.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
 <D17B5F0A.18A276%ddesimon@cisco.com> <20150515181031.GA14637@nicira.com>
Message-ID: <D17BB16E.18A33F%ddesimon@cisco.com>

Hi Ben,

Thanks for the quick reply!

Ok. How do I get the lldp packets through ovs to the lldp process?

Initially I think they were dropped.

ovs-appctl ofproto/trace br0 in_port=3,dl_dst=01:80:c2:00:00:0e,dl_type=0x88cc
Bridge: br0
Flow: metadata=0,in_port=3,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=01:80:c2:00:00:0e,dl_type=0x88cc
Rule: table=0 cookie=0 priority=0
OpenFlow actions=NORMAL
no input bundle, dropping

Final flow: unchanged
Megaflow: skb_priority=0,in_port=3,vlan_tci=0x0000/0x1fff,dl_src=00:00:00:00:00:00,dl_dst=01:80:c2:00:00:0e,dl_type=0x88cc
Datapath actions: drop


I then added

ovs-vsctl set Bridge br0 other_config:forward-bpdu=true

Now at least the packets aren’t getting dropped.


ovs-appctl ofproto/trace br0 in_port=3,dl_dst=01:80:c2:00:00:0e,dl_type=0x88cc
Bridge: br0
Flow: metadata=0,in_port=3,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=01:80:c2:00:00:0e,dl_type=0x88cc
Rule: table=0 cookie=0 priority=65535,dl_dst=01:00:00:00:00:00/ff:00:00:00:00:00
OpenFlow actions=ALL

Final flow: unchanged
Megaflow: skb_priority=0,in_port=3,dl_dst=01:00:00:00:00:00/ff:00:00:00:00:00,dl_type=0x88cc
Datapath actions: 1,2,3



But the packets still don’t get counted by lldp. I think I need to add a flow, something like this:

ovs-ofctl add-flow br0 priority=65535,dl_dst=01:80:c2:00:00:0e/ff:00:00:00:00:00,idle_timeout=0,actions=all

But not sure what I should be setting action to?

Thanks,

—Dave



On 5/15/15, 2:20 PM, "Ben Pfaff" <blp at nicira.com<mailto:blp at nicira.com>> wrote:

On Fri, May 15, 2015 at 12:33:39PM +0000, Dave DeSimone (ddesimon) wrote:
Hi,
I?m running an OVS rpm (no source code) on RHEL 7.0
ovs-vswitchd (Open vSwitch) 2.3.1
Compiled Dec 26 2014 15:35:15
OpenFlow versions 0x1:0x1
Is there support in this version for LLDP?
On the wiki it says
   *   IETF Auto-Attach SPBM and rudimentary required LLDP support
Is there any documentation on this as it looks like a new feature on this latest release?

This support is only going to be useful if you want to use Auto-Attach
SPBM.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150515/c0961a9e/attachment-0001.html>

From krzysztof.wojciechowski at techstorage.pl  Fri May 15 16:36:21 2015
From: krzysztof.wojciechowski at techstorage.pl (Krzysztof Wojciechowski)
Date: Sat, 16 May 2015 01:36:21 +0200
Subject: [ovs-discuss] Ovs-testcontroller hard timeout
In-Reply-To: <CAArS4XX2VAFNO5+8y0RgXwmH0axO8L=t_eB_c=s+LzYcQRj9tQ@mail.gmail.com>
References: <5553B8EE.8000704@techstorage.pl>
 <20150515161834.GB9947@nicira.com>
 <CAArS4XX2VAFNO5+8y0RgXwmH0axO8L=t_eB_c=s+LzYcQRj9tQ@mail.gmail.com>
Message-ID: <555682F5.6020405@techstorage.pl>

Thank you for your replies.
Well imho if i can set max idle time, there should be possibility to set 
hard timeout...

I am not best programmer (well... i am not programmer), but i found this 
in code (in lib/learning-switch.c):

/* The output port is known, or we always flood everything, so add a* 
new flow. */memset(&fm, 0, sizeof fm);match_init(&fm.match, &flow, 
&sw->wc);ofputil_normalize_match_quiet(&fm.match);fm.priority = 
0;fm.table_id = 0xff;fm.command = OFPFC_ADD;fm.idle_timeout = 
sw->max_idle;fm.buffer_id = pi.buffer_id;fm.out_port = 
OFPP_NONE;fm.ofpacts = ofpbuf_data(&ofpacts);fm.ofpacts_len = 
ofpbuf_size(&ofpacts);buffer = ofputil_encode_flow_mod(&fm, 
sw->protocol);queue_tx(sw, buffer);

Maybe i can add some "fm." line (something like fm.hard_timeout ?), and 
just hardcode it?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150516/d7354e94/attachment-0001.html>

From maniksidana019 at gmail.com  Sat May 16 00:50:49 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Sat, 16 May 2015 13:20:49 +0530
Subject: [ovs-discuss] GRE tunnels in OpenvSwitch - Packet flow and
	encapsulation/decapsulation
Message-ID: <CAG-CZ9dnnaxd9aWFSL_u5HxaQoQDXenBBzBh2roDq6-ezFdA6w@mail.gmail.com>

Hi All,

I am new to GRE tunneling in OVS. I tried the below example
http://linuxmantra.com/2013/08/gre-tunneling-with-open-vswitch.html
and I was able to establish the tunnel between the two VMs on two
different physical machines.

This link talks about creating isolated bridges br0 and br2 but I was
able to achieve it with a single bridge br2.
Now I want to understand the packet flow of how the actual
communication happens when VM1 pings VM2.

1. Data from VM1 reaches br2 through the tap interface. At this point,
the ARP entry is not learnt, so br2 broadcasts the packets and thus
the packet reaches gre0 interface on br2.
2. Packet is encapsulated with GRE header.
3. Now, how this packet reaches br0 and leaves the host machine from
eth0 is not clear. Who picks the encapsulated packet ? Is it the OVS
GRE kernel module ? If yes, then after the packet is encapsulated, is
the route for remote host applied ?
4. Similarly when the packet reaches the destination host machine's
br0, is it the kernel module that checks GRE header and handsover it
to gre0 interface of br0

If its the kernel module doing all the wonders, how does it fetches
the packets. DOes this module takes over the linux networking stack. ?

It would be great help if anybody can explain me the flow.

Thanks

From adampavlidis at gmail.com  Sat May 16 04:29:34 2015
From: adampavlidis at gmail.com (Adam Pavlidis)
Date: Sat, 16 May 2015 14:29:34 +0300
Subject: [ovs-discuss] Ports in sflow samples from OVS
In-Reply-To: <8836DA74-1AE5-4FEB-A1C6-774B4F0110C5@inmon.com>
References: <CAJZwxTpr5HEKNQEJNC4SBRnfvge8aqiwdGFS871muYwXJtft-w@mail.gmail.com>
 <C5BBBD1E-5621-4897-966F-4A8F5B9DFB6B@inmon.com>
 <CAJZwxTrsJzK0or=8PhY3UkJODy5YT3ALjHHS+U0-UAXxR=6wCQ@mail.gmail.com>
 <8836DA74-1AE5-4FEB-A1C6-774B4F0110C5@inmon.com>
Message-ID: <CAJZwxTrd5M6eBYgaQCzuJ580B6jGqo55JjdYmWRr1-SMfO+Muw@mail.gmail.com>

I find it strange that my mininet version is 2.1 where my ovs version 1.10,
in any case i will grab the latest vm! :)

Thank you very much for your helpful and detailed responses.

On Fri, May 15, 2015 at 5:23 PM, Peter Phaal <peter.phaal at inmon.com> wrote:

> I believe the ifIndex was added as an ovs-vsctl list option in OVS 2.0+
> (which is included in the latest Mininet VM). Mininet 2.0 is useful for
> performance studies since it it lets you set link speeds and queueing
> policies.
>
> As far as sFlow is concerned OVS is a single switch, irrespective of the
> number of logical OpenFlow bridges that have been defined. Mininet uses a
> single OVS with multiple OpeFlow bridges to build the network so you need
> to map between sFlow ifIndex to [ofbridge,ofport] pairs. By default,
> Mininet encodes the logical switch name as part of the interface name, e.g.
> “s1-eth2”, so it is easy to split the name and extract the switch the port
> is attached to.
>
> The following article provides a comprehensive example of integrating
> sFlow and OpenFlow data in Mininet:
>
> http://blog.sflow.com/2015/01/hybrid-openflow-ecmp-testbed.html
>
> If you look at the leafandspine.py script in the example it will show you
> how to export a combined sFlow/OpenFlow topology.
>
>
> On May 15, 2015, at 3:13 AM, Adam Pavlidis <adampavlidis at gmail.com> wrote:
>
> Thank you very much! That's exactly what i am searching for. However when
> i try the above command i get this:
>
> *ovs-vsctl: Interface does not contain a column whose name matches
> "ifindex"*
>
> i tried something more general, and as the above command stated no such
> column:
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
> *sudo ovs-vsctl list Interface_uuid               :
> 18ee3470-ef22-4b6f-b9c3-4c6111842f1eadmin_state         :
> upcfm_fault           : []cfm_fault_status    : []cfm_health          :
> []cfm_mpid            : []cfm_remote_mpids    : []cfm_remote_opstate  :
> []duplex              : fullexternal_ids        : {}ingress_policing_burst:
> 0ingress_policing_rate: 0lacp_current        : []link_resets         :
> 0link_speed          : 10000000000link_state          :
> upmac                 : []mac_in_use          :
> "3a:c5:8b:44:ab:4d"mtu                 : 1500name                :
> "s1-eth2"ofport              : 2ofport_request      : []options
> : {}other_config        : {}statistics          : {collisions=0,
> rx_bytes=558, rx_crc_err=0, rx_dropped=0, rx_errors=0, rx_frame_err=0,
> rx_over_err=0, rx_packets=7, tx_bytes=320, tx_dropped=0, tx_errors=0,
> tx_packets=4}status              : {driver_name=veth, driver_version="1.0",
> firmware_version=""}type                : ""*
>
> I guess my mininet vm uses an older version of ovs that perhaps does not
> support ifIndex?
>
>
>
> *sudo ovs-vsctl --versionovs-vsctl (Open vSwitch) 1.10.2*
>
>
>
> I would like to ask something else about sflow and ovs.
>
> Lets say i have a mininet topology again with a couple virtual switches
> (s1 , s2)
> I again add the sflow agents. I want to sort the samples based on which
> switch they are received from.
> I am thinking  *agentSubId* & *sourceId*  fields are the ones i must
> focus on. However again, is there anyway to map
> the sflow sample to the datapath Id my openflow controller understands?
>
> sflow sample:
>
> *sourceId 2:1000*
>
>
> openflow controller:
>
> *Connection [00-00-00-00-00-01 1]*
>
>
>
>
> Thanks in advance
>
> On Thu, May 14, 2015 at 5:05 PM, Peter Phaal <peter.phaal at inmon.com>
> wrote:
>
>> You can use ovs-vsctl to dump the naming information for the ports and
>> extract the mapping between the SNMP ifIndex that sFlow uses to identify
>> ports and the OpenFlow port number / name that the controller uses to
>> identify ports:
>>
>> mininet at mininet-vm:~$ sudo ovs-vsctl --format json --columns
>> name,ofport,ifindex list Interface
>>
>> {"data":[["s1-eth2",2,172],["s8-eth1",1,189],["s6",65534,203],["s7-eth8",8,159],["s3-eth2",2,176],["s4-eth3",3,186],["s3-eth4",4,192],["s3-eth1",1,168],["s4-eth2",2,178],["s8-eth4",4,195],["s1",65534,199],["s2-eth3",3,182],["s6-eth3",3,177],["s2-eth2",2,174],["s7",65534,202],["s5-eth7",7,150],["s4",65534,201],["s6-eth5",5,152],["s2-eth4",4,190],["s3",65534,200],["s7-eth5",5,156],["s7-eth2",2,183],["s3-eth3",3,184],["s8-eth6",6,161],["s6-eth1",1,173],["s1-eth3",3,180],["s7-eth1",1,181],["s8-eth7",7,162],["s8-eth8",8,163],["s4-eth4",4,194],["s8-eth2",2,191],["s7-eth6",6,157],["s1-eth4",4,188],["s5",65534,196],["s5-eth4",4,171],["s2-eth1",1,166],["s7-eth7",7,158],["s6-eth2",2,175],["s2",65534,197],["s8",65534,198],["s8-eth3",3,193],["s6-eth6",6,153],["s8-eth5",5,160],["s7-eth4",4,187],["s5-eth3",3,169],["s6-eth4",4,179],["s1-eth1",1,164],["s6-eth7",7,154],["s4-eth1",1,170],["s5-eth8",8,151],["s7-eth3",3,185],["s5-eth2",2,167],["s6-eth8",8,155],["s5-eth1",1,165],["s5-eth5",5,148],["s5-eth6",6,149]],"headings":["name","ofport","ifindex"]}
>>
>>
>> On May 14, 2015, at 3:08 AM, Adam Pavlidis <adampavlidis at gmail.com>
>> wrote:
>>
>> Hello all,
>>
>> I am currently trying to use sflow in an SDN environment (mininet).
>> I have successfully set up the sflow agent in the ovs bridge that is
>> created by mininet.
>>
>> My main problem is this that the rules installed by my openflow
>> controller specify some ports (e.g. port 1, port 2).
>> However the ports i see in sflow samples are not the same ones. Each time
>> mininet topology is re-estabilished, ingress and egress ports in the sflow
>> sample vary.
>>
>> This is a sample from an ICMP Reply from host1 to host2.
>>
>>
>>
>> *sflow sample:*
>> startSample ----------------------
>> sampleType_tag 0:1
>> sampleType FLOWSAMPLE
>> sampleSequenceNo 20
>> sourceId 2:1000
>> meanSkipCount 1
>> samplePool 20
>> dropEvents 0
>>
>> *inputPort 675outputPort 677*
>> flowBlock_tag 0:1001
>> extendedType SWITCH
>> in_vlan 0
>> in_priority 0
>> out_vlan 0
>> out_priority 0
>> flowBlock_tag 0:1
>> flowSampleType HEADER
>> headerProtocol 1
>> sampledPacketSize 102
>> strippedBytes 4
>> headerLen 98
>> headerBytes
>> 00-00-00-00-00-02-00-00-00-00-00-01-08-00-45-00-00-54-CC-BC-00-00-40-01-99-EA-0A-00-00-01-0A-00-00-02-00-00-36-5F-64-2C-00-01-D4-CE-54-55-00-00-00-00-6F-7C-0E-00-00-00-00-00-10-11-12-13-14-15-16-17-18-19-1A-1B-1C-1D-1E-1F-20-21-22-23-24-25-26-27-28-29-2A-2B-2C-2D-2E-2F-30-31-32-33-34-35-36-37
>> dstMAC 000000000002
>> srcMAC 000000000001
>> IPSize 84
>> ip.tot_len 84
>> srcIP 10.0.0.1
>> dstIP 10.0.0.2
>> IPProtocol 1
>> IPTOS 0
>> IPTTL 64
>> ICMPType 0
>> ICMPCode 0
>> endSample   ----------------------
>>
>>
>> *ovs-dpctl dump-flows <DPath>*
>>
>> *in_port(2),*
>> eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),
>> eth_type(0x0800),
>> ipv4(src=10.0.0.1,dst=10.0.0.2,proto=1,tos=0,ttl=64,frag=no),
>> icmp(type=0,code=0),
>> packets:0,
>> bytes:0,
>> used:never,
>> *actions:sample(sample=100.0%,actions(userspace(pid=4294962193,sFlow(vid=0,pcp=0,output=677)))),
>> 3*
>>
>>
>> *ovs-ofctl dump-flows s1*
>>
>> cookie=0x0, duration=1.939s, table=0, n_packets=1, n_bytes=98,
>> idle_timeout=10, hard_timeout=30, idle_age=1, priority=65535,icmp,
>> *in_port=1*,vlan_tci=0x0000,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,icmp_type=0,icmp_code=0
>>
>> *actions=output:2*
>>
>>
>>
>>
>>
>> Is there any way to map the ports in the sflow sample, to the ports
>> understood by the openflow controller, and virtual topology?
>>
>> My aim is to find something like the following mapping:
>>
>> sflow  -> openflow
>>
>> "675" -> "port 1"
>> "677" -> "port 2"
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150516/8deef8b8/attachment-0001.html>

From zhangzhiming at yunshan.net.cn  Sun May 17 04:29:27 2015
From: zhangzhiming at yunshan.net.cn (zhangzhiming)
Date: Sun, 17 May 2015 19:29:27 +0800
Subject: [ovs-discuss] one patch was omitted to be pushed to
	branch-2.3---datapath: Fix recirc bug where skb is double freed
Message-ID: <201505171929246957801@yunshan.net.cn>

Hi,

I found one patch was omitted to be pushed to branch-2.3, which leads to double freed skb.
Could someone to confirm the patch and submit it to branch-2.3? 
Thanks!

Here is the patch information:


commit 867e37ba00091b3e319c4c47c1598f1ae84dd32e
Author: Andy Zhou <azhou at nicira.com>
Date:   Mon Aug 25 15:18:19 2014 -0700

    datapath: Fix recirc bug where skb is double freed.
    
    If recirc action is the last action of a action list, the SKB triggers
    the recirc will be freed twice. This patch fixes this bug.
    
    Reported-by: Justin Pettit <jpettit at nicira.com>
    Signed-off-by: Andy Zhou <azhou at nicira.com>

diff --git a/datapath/actions.c b/datapath/actions.c
index ad22467..7f25553 100644
--- a/datapath/actions.c
+++ b/datapath/actions.c
@@ -809,7 +809,16 @@ static int execute_recirc(struct datapath *dp, struct sk_buff *skb,
                          const struct nlattr *a, int rem)
 {
        struct sw_flow_key recirc_key;
-       int err;
+
+       if (!is_skb_flow_key_valid(skb)) {
+               int err;
+
+               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
+               if (err)
+                       return err;
+
+       }
+       BUG_ON(!is_skb_flow_key_valid(skb));

        if (!last_action(a, rem)) {
                /* Recirc action is the not the last action
@@ -820,19 +829,9 @@ static int execute_recirc(struct datapath *dp, struct sk_buff *skb,
                 * continue on with the rest of the action list. */
                if (!skb)
                        return 0;
-       }

-       if (!is_skb_flow_key_valid(skb)) {
-               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
-               if (err) {
-                       kfree_skb(skb);
-                       return err;
-               }
-       }
-       BUG_ON(!is_skb_flow_key_valid(skb));
-
-       if (!last_action(a, rem))
                flow_key_clone(skb, &recirc_key);
+       }

        flow_key_set_recirc_id(skb, nla_get_u32(a));
        ovs_dp_process_packet(skb, true);
@@ -897,6 +896,12 @@ static int do_execute_actions(struct datapath *dp, struct sk_buff *skb,

                case OVS_ACTION_ATTR_RECIRC:
                        err = execute_recirc(dp, skb, a, rem);
+                       if (last_action(a, rem)) {
+                               /* If this is the last action, the skb has
+                                * been consumed or freed.
+                                * Return immediately. */
+                               return err;
+                       }
                        break;

                case OVS_ACTION_ATTR_SET:




Jeremy Zhang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150517/43d54250/attachment.html>

From alexw at nicira.com  Sun May 17 09:41:23 2015
From: alexw at nicira.com (Alex Wang)
Date: Sun, 17 May 2015 09:41:23 -0700
Subject: [ovs-discuss] one patch was omitted to be pushed to
 branch-2.3---datapath: Fix recirc bug where skb is double freed
In-Reply-To: <201505171929246957801@yunshan.net.cn>
References: <201505171929246957801@yunshan.net.cn>
Message-ID: <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>

Fwd to Andy,~

On Sun, May 17, 2015 at 4:29 AM, zhangzhiming <zhangzhiming at yunshan.net.cn>
wrote:

>   Hi,
>
> I found one patch was omitted to be pushed to branch-2.3, which leads to
> double freed skb.
> Could someone to confirm the patch and submit it to branch-2.3?
> Thanks!
>
> Here is the patch information:
>
>
> commit 867e37ba00091b3e319c4c47c1598f1ae84dd32e
> Author: Andy Zhou <azhou at nicira.com>
> Date:   Mon Aug 25 15:18:19 2014 -0700
>
>     datapath: Fix recirc bug where skb is double freed.
>
>     If recirc action is the last action of a action list, the SKB triggers
>     the recirc will be freed twice. This patch fixes this bug.
>
>     Reported-by: Justin Pettit <jpettit at nicira.com>
>     Signed-off-by: Andy Zhou <azhou at nicira.com>
>
> diff --git a/datapath/actions.c b/datapath/actions.c
> index ad22467..7f25553 100644
> --- a/datapath/actions.c
> +++ b/datapath/actions.c
>
> @@ -809,7 +809,16 @@ static int execute_recirc(struct datapath *dp, struct sk_buff *skb,
>                           const struct nlattr *a, int rem)
>  {
>         struct sw_flow_key recirc_key;
> -       int err;
> +
> +       if (!is_skb_flow_key_valid(skb)) {
> +               int err;
> +
> +               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
> +               if (err)
> +                       return err;
> +
> +       }
> +       BUG_ON(!is_skb_flow_key_valid(skb));
>
>         if (!last_action(a, rem)) {
>                 /* Recirc action is the not the last action
>
> @@ -820,19 +829,9 @@ static int execute_recirc(struct datapath *dp, struct sk_buff *skb,
>                  * continue on with the rest of the action list. */
>                 if (!skb)
>                         return 0;
> -       }
>
> -       if (!is_skb_flow_key_valid(skb)) {
> -               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
> -               if (err) {
> -                       kfree_skb(skb);
> -                       return err;
> -               }
> -       }
> -       BUG_ON(!is_skb_flow_key_valid(skb));
> -
> -       if (!last_action(a, rem))
>                 flow_key_clone(skb, &recirc_key);
> +       }
>
>         flow_key_set_recirc_id(skb, nla_get_u32(a));
>         ovs_dp_process_packet(skb, true);
>
> @@ -897,6 +896,12 @@ static int do_execute_actions(struct datapath *dp, struct sk_buff *skb,
>
>                 case OVS_ACTION_ATTR_RECIRC:
>                         err = execute_recirc(dp, skb, a, rem);
> +                       if (last_action(a, rem)) {
> +                               /* If this is the last action, the skb has
> +                                * been consumed or freed.
> +                                * Return immediately. */
> +                               return err;
> +                       }
>                         break;
>
>                 case OVS_ACTION_ATTR_SET:
>
> ------------------------------
> Jeremy Zhang
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150517/31ba997c/attachment-0001.html>

From zhangzhiming at yunshan.net.cn  Sun May 17 09:45:44 2015
From: zhangzhiming at yunshan.net.cn (zhangzhiming)
Date: Mon, 18 May 2015 00:45:44 +0800
Subject: [ovs-discuss] one patch was omitted to be pushed to
	branch-2.3---datapath: Fix recirc bug where skb is double freed
References: <201505171929246957801@yunshan.net.cn>, 
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
Message-ID: <201505180045421589961@yunshan.net.cn>


Thanks!

By the way, this bug is triggered by setting bond_mode=balance-tcp and lacp=active to a bond port simultanemously. The server will restart in less 30 seconds after the setting.




zhangzhiming

From: Alex Wang
Date: 2015-05-18 00:41
To: zhangzhiming; Andy Zhou
CC: discuss
Subject: Re: [ovs-discuss] one patch was omitted to be pushed to branch-2.3---datapath: Fix recirc bug where skb is double freed
Fwd to Andy,~


On Sun, May 17, 2015 at 4:29 AM, zhangzhiming <zhangzhiming at yunshan.net.cn> wrote:

Hi,

I found one patch was omitted to be pushed to branch-2.3, which leads to double freed skb.
Could someone to confirm the patch and submit it to branch-2.3? 
Thanks!

Here is the patch information:


commit 867e37ba00091b3e319c4c47c1598f1ae84dd32e
Author: Andy Zhou <azhou at nicira.com>
Date:   Mon Aug 25 15:18:19 2014 -0700

    datapath: Fix recirc bug where skb is double freed.
    
    If recirc action is the last action of a action list, the SKB triggers
    the recirc will be freed twice. This patch fixes this bug.
    
    Reported-by: Justin Pettit <jpettit at nicira.com>
    Signed-off-by: Andy Zhou <azhou at nicira.com>

diff --git a/datapath/actions.c b/datapath/actions.c
index ad22467..7f25553 100644
--- a/datapath/actions.c
+++ b/datapath/actions.c
@@ -809,7 +809,16 @@ static int execute_recirc(struct datapath *dp, struct sk_buff *skb,
                          const struct nlattr *a, int rem)
 {
        struct sw_flow_key recirc_key;
-       int err;
+
+       if (!is_skb_flow_key_valid(skb)) {
+               int err;
+
+               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
+               if (err)
+                       return err;
+
+       }
+       BUG_ON(!is_skb_flow_key_valid(skb));

        if (!last_action(a, rem)) {
                /* Recirc action is the not the last action
@@ -820,19 +829,9 @@ static int execute_recirc(struct datapath *dp, struct sk_buff *skb,
                 * continue on with the rest of the action list. */
                if (!skb)
                        return 0;
-       }

-       if (!is_skb_flow_key_valid(skb)) {
-               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
-               if (err) {
-                       kfree_skb(skb);
-                       return err;
-               }
-       }
-       BUG_ON(!is_skb_flow_key_valid(skb));
-
-       if (!last_action(a, rem))
                flow_key_clone(skb, &recirc_key);
+       }

        flow_key_set_recirc_id(skb, nla_get_u32(a));
        ovs_dp_process_packet(skb, true);
@@ -897,6 +896,12 @@ static int do_execute_actions(struct datapath *dp, struct sk_buff *skb,

                case OVS_ACTION_ATTR_RECIRC:
                        err = execute_recirc(dp, skb, a, rem);
+                       if (last_action(a, rem)) {
+                               /* If this is the last action, the skb has
+                                * been consumed or freed.
+                                * Return immediately. */
+                               return err;
+                       }
                        break;

                case OVS_ACTION_ATTR_SET:




Jeremy Zhang

_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150518/ac39be2d/attachment.html>

From hardik.soni at inria.fr  Mon May 18 08:27:27 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Mon, 18 May 2015 17:27:27 +0200 (CEST)
Subject: [ovs-discuss] syntax question
In-Reply-To: <1755376494.6309026.1431962606546.JavaMail.zimbra@inria.fr>
Message-ID: <249153297.6310553.1431962847721.JavaMail.zimbra@inria.fr>



Hi All, 




I want to set other_config : n-handler-threads & other_config : n-rev alidator-threads in Open_vSwitch table as described in following link. 

http://openvswitch.org/ovs-vswitchd.conf.db.5.pdf 
Can anyone give me correct ovs-vsctl syntax for this? 

I dont know record identifier of the record in Open_vSwitch table. As I understood, there will be exactly one row in Open_vSwitch table. 
So, I am trying to figure out how to get the id of the record and set those two columns in one ovs-vsctl command. 

Thanks, 
Hardik Soni 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150518/9eb6d8de/attachment.html>

From jpettit at nicira.com  Mon May 18 08:41:09 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 18 May 2015 08:41:09 -0700
Subject: [ovs-discuss] syntax question
In-Reply-To: <249153297.6310553.1431962847721.JavaMail.zimbra@inria.fr>
References: <249153297.6310553.1431962847721.JavaMail.zimbra@inria.fr>
Message-ID: <680DDDD9-C77A-4624-864C-CB1B1447D2CC@nicira.com>

You can use "." to refer to the one row in the Open_vSwitch table, like this:

    ovs-vsctl --no-wait set Open_vSwitch . other_config:n-handler-threads=1

--Justin


> On May 18, 2015, at 8:27 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
> 
> Hi All,
> 
> I want to set other_config : n-handler-threads  & other_config : n-rev alidator-threads in  Open_vSwitch table as described in following link.
> http://openvswitch.org/ovs-vswitchd.conf.db.5.pdf
> Can anyone give me correct ovs-vsctl syntax for this?
> 
> I dont know record identifier of the record in Open_vSwitch table. As I understood, there will be exactly one row in Open_vSwitch table.
> So, I am trying to figure out  how to get the id of the record and set those two columns in one ovs-vsctl command.
> 
> Thanks,
> Hardik Soni
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From hardik.soni at inria.fr  Mon May 18 08:59:35 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Mon, 18 May 2015 17:59:35 +0200 (CEST)
Subject: [ovs-discuss] syntax question
In-Reply-To: <680DDDD9-C77A-4624-864C-CB1B1447D2CC@nicira.com>
References: <249153297.6310553.1431962847721.JavaMail.zimbra@inria.fr>
 <680DDDD9-C77A-4624-864C-CB1B1447D2CC@nicira.com>
Message-ID: <1403980750.6321764.1431964775733.JavaMail.zimbra@inria.fr>

worked.. thanks


-Hardik Soni

----- Original Message -----
> From: "Justin Pettit" <jpettit at nicira.com>
> To: "Hardik Soni" <hardik.soni at inria.fr>
> Cc: discuss at openvswitch.org
> Sent: Monday, 18 May, 2015 5:41:09 PM
> Subject: Re: [ovs-discuss] syntax question
> 
> You can use "." to refer to the one row in the Open_vSwitch table, like this:
> 
>     ovs-vsctl --no-wait set Open_vSwitch . other_config:n-handler-threads=1
> 
> --Justin
> 
> 
> > On May 18, 2015, at 8:27 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
> > 
> > Hi All,
> > 
> > I want to set other_config : n-handler-threads  & other_config : n-rev
> > alidator-threads in  Open_vSwitch table as described in following link.
> > http://openvswitch.org/ovs-vswitchd.conf.db.5.pdf
> > Can anyone give me correct ovs-vsctl syntax for this?
> > 
> > I dont know record identifier of the record in Open_vSwitch table. As I
> > understood, there will be exactly one row in Open_vSwitch table.
> > So, I am trying to figure out  how to get the id of the record and set
> > those two columns in one ovs-vsctl command.
> > 
> > Thanks,
> > Hardik Soni
> > 
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> 
> 

From marco at nuvula.ch  Mon May 18 09:18:52 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Mon, 18 May 2015 18:18:52 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <555058F4.904@ubuntu.com>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <321030EF-0481-4FD2-B979-8B0A63C3D19D@nuvula.ch>
 <CANr6G5weMs1tLeLmDSfb_yL9Gk6Zz88dy0XpZ99UjQVi+_w_Sw@mail.gmail.com>
 <68DDEDA0-481E-49EF-BB94-7FD9AE7373EF@nuvula.ch>
 <20DD9129-AEDD-4FC6-BFD5-A8F10545230B@nuvula.ch>
 <CANr6G5znSOe9gFUMwa6AP-zaRNiRXrfnqM6UUHsoVgQWEsN2Jg@mail.gmail.com>
 <EF09D73F-A631-484A-AE08-307C927ABEB3@nuvula.ch>
 <62395DBA-764B-4332-8D77-EF5EF189D623@canonical.com>
 <3E5B9556-CB9F-4D5B-8A6D-A615C099BAD7@nuvula.ch>
 <3FE189EC-49E0-47CC-BD59-2F6E7B04B9A4@ubuntu.com>
 <8CE70C04-9A31-4499-938A-85EC4D13E0BB@nuvula.ch>
 <C222441F-23C1-470A-987E-123B00879EA9@ubuntu.com>
 <117DA076-BD34-4C01-94AE-22949AEF0E42@nuvula.ch>
 <55241FD8.1040704@ubuntu.com>
 <A00A93E9-6A58-458C-8E8B-C8542176ADDA@nuvula.ch>
 <553519F7.3060901@ubuntu.com>
 <CA907DB2-9B8D-4BEA-A902-8F9E436268A8@nuvula.ch>
 <5537613B.5070804@ubuntu.com>
 <CANr6G5wcnfy0YMeaBbs_xM1YupQbE+u80iv-wAWPgtRoOPaJnA@mail.gmail.com>
 <555058F4.904@ubuntu.com>
Message-ID: <A51DB93A-FD1C-4C52-BB98-A465EA302656@nuvula.ch>

Hi James

sorry for the late reply. Have not seen the issue anymore with the ppa files.

Cheers
marco


 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
> On 11 May 2015, at 09:23, James Page <james.page at ubuntu.com> wrote:
> 
> 
> Hi Joe
> 
> On 09/05/15 00:00, Joe Stringer wrot

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150518/b45e52ab/attachment-0001.html>

From james.page at ubuntu.com  Mon May 18 09:55:56 2015
From: james.page at ubuntu.com (James Page)
Date: Mon, 18 May 2015 09:55:56 -0700
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <A51DB93A-FD1C-4C52-BB98-A465EA302656@nuvula.ch>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CANr6G5weMs1tLeLmDSfb_yL9Gk6Zz88dy0XpZ99UjQVi+_w_Sw@mail.gmail.com>
 <68DDEDA0-481E-49EF-BB94-7FD9AE7373EF@nuvula.ch>
 <20DD9129-AEDD-4FC6-BFD5-A8F10545230B@nuvula.ch>
 <CANr6G5znSOe9gFUMwa6AP-zaRNiRXrfnqM6UUHsoVgQWEsN2Jg@mail.gmail.com>
 <EF09D73F-A631-484A-AE08-307C927ABEB3@nuvula.ch>
 <62395DBA-764B-4332-8D77-EF5EF189D623@canonical.com>
 <3E5B9556-CB9F-4D5B-8A6D-A615C099BAD7@nuvula.ch>
 <3FE189EC-49E0-47CC-BD59-2F6E7B04B9A4@ubuntu.com>
 <8CE70C04-9A31-4499-938A-85EC4D13E0BB@nuvula.ch>
 <C222441F-23C1-470A-987E-123B00879EA9@ubuntu.com>
 <117DA076-BD34-4C01-94AE-22949AEF0E42@nuvula.ch>
 <55241FD8.1040704@ubuntu.com>
 <A00A93E9-6A58-458C-8E8B-C8542176ADDA@nuvula.ch>
 <553519F7.3060901@ubuntu.com>
 <CA907DB2-9B8D-4BEA-A902-8F9E436268A8@nuvula.ch>
 <5537613B.5070804@ubuntu.com>
 <CANr6G5wcnfy0YMeaBbs_xM1YupQbE+u80iv-wAWPgtRoOPaJnA@mail.gmail.com>
 <555058F4.904@ubuntu.com> <A51DB93A-FD1C-4C52-BB98-A465EA302656@nuvula.ch>
Message-ID: <555A199C.4050907@ubuntu.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

Hi Marco

On 18/05/15 09:18, Marco Kuendig wrote:
> sorry for the late reply. Have not seen the issue anymore with the
> ppa files.

No problem - glad to hear that - an updated ovs is in testing for
14.04 as a result of this work - so thanks for the testing!

Cheers

James

- -- 
James Page
Ubuntu and Debian Developer
james.page at ubuntu.com
jamespage at debian.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQIcBAEBCAAGBQJVWhmcAAoJEL/srsug59jDHFYP/1WEe3fmg7Hy/nI7tDI7xRmN
PXYFg0fcxC33rL4NLYy3FU0kAh2j6Eeg1iGQoFyfV1jPeSYCwIsBLQuip+Lthmbc
5mKING+pwdVAEwlR3OWMxjFDEk476vOR1WsoUyo4A/DqUd9oEbo64WeUsgZgPOzY
ohR8R+oVNn4X2SH70XkCVId2qioMF5AsUXR6AW1NTBxMkfT6zc0u13RgGSB8zF19
emgccUWFKWn4QNIhkKd9kRyaA7pwM53bBW/OWI2o+d5tQU1d0XubxTR2ctBFc5z2
oBrqOn7M0NgqzX23XihqIKKtYgK72seCfNbGgCzz0+u8YaPwzOkZ51NtL+N81UMe
vQBa+s8W5H3UCvknFCOXhdxwaIlJYSc/h43p+IOdOnd9C9ap2GBgmfl33sZHYefL
ntwpVtf6kt2Q92goYwCNzhEiyRxjVITuZd8CXcKBv3TTbOYKS9/0McCntcfMYn6n
vstC6vUIJKgNOsLXjcVrdqZ5/6J1AmKReyEKTeiD4rRWMxoTZCYsdkXSoP8uNk5D
h7leFKZ6ncBZWkhgsNlVQxzP1gmJ3iGuTaRhTT8KcYVZxuuDwkKMpjbtCZ4v9DEM
scJ+KeZ6oTdBy1RESHFKdQCv2G6Koz85vTLOS4auW+KZyBBFK23OsVf7H+Qn+/sD
riLUowur8wDHyGViQGHx
=Wi18
-----END PGP SIGNATURE-----

From chan7781 at kettering.edu  Mon May 18 11:28:53 2015
From: chan7781 at kettering.edu (Alison C.)
Date: Mon, 18 May 2015 14:28:53 -0400
Subject: [ovs-discuss] [ovs-dev] OVS 2.3.1 build fail using openwrt
	buildroot
In-Reply-To: <20150515162717.GF9947@nicira.com>
References: <CABcSDhfSK54rswY9Z5E7kgBRodw-0xQkpQMZmf88Vvbx8dndhw@mail.gmail.com>
 <20150515162717.GF9947@nicira.com>
Message-ID: <CABcSDhcbKwRPxb-6e_0APTLK+0L2UZTDWWD3FZJ8yhzAiON_Eg@mail.gmail.com>

Okay. Any other ideas why the build might be failing, then?

2015-05-15 12:27 GMT-04:00 Ben Pfaff <blp at nicira.com>:
> On Fri, May 15, 2015 at 11:56:42AM -0400, Alison C. wrote:
>> Hey everybody,
>>
>> Is there a minimum binutils version required to build OVS 2.3.1?
>>
>> I'm trying to build it in a openwrt buildroot environment, but it
>> fails with "{standard input}:1116: Error: unknown pseudo-op:
>> `.tprelword'". According to a [Stack Overflow
>> thread](http://stackoverflow.com/questions/8872517) this could be due
>> to too old version of binutils or gcc/g++ version mismatch. The
>> versions of gcc, g++, and binutils are as follows:
>>
>> [11:42:40] erinacity:~/Code/openwrt/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin
>> alisonc $ ./mips-openwrt-linux-uclibc-gcc --version | head -1
>> mips-openwrt-linux-uclibc-gcc (OpenWrt/Linaro GCC 4.8-2014.04 r45620) 4.8.3
>>
>> alisonc $ ./mips-openwrt-linux-uclibc-g++ --version | head -1
>> mips-openwrt-linux-uclibc-g++ (OpenWrt/Linaro GCC 4.8-2014.04 r45620) 4.8.3
>>
>> alisonc $ ./mips-openwrt-linux-uclibc-as --version | head -1
>> GNU assembler (GNU Binutils) 2.22
>>
>> Thanks for any input you might have.
>
> OVS doesn't have any particular binutils requirement.  OVS does do a
> couple of minor "linker tricks" but binutils has supported those from
> well before the time OVS started development around 2009.



-- 
Alison
Kettering University
chan7781 at kettering.edu
+1 248 635 6672

From blp at nicira.com  Mon May 18 16:50:53 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 18 May 2015 16:50:53 -0700
Subject: [ovs-discuss] syntax question
In-Reply-To: <249153297.6310553.1431962847721.JavaMail.zimbra@inria.fr>
References: <1755376494.6309026.1431962606546.JavaMail.zimbra@inria.fr>
 <249153297.6310553.1431962847721.JavaMail.zimbra@inria.fr>
Message-ID: <20150518235053.GB6582@nicira.com>

On Mon, May 18, 2015 at 05:27:27PM +0200, Hardik Soni wrote:
> I want to set other_config : n-handler-threads & other_config : n-rev alidator-threads in Open_vSwitch table as described in following link. 
> 
> http://openvswitch.org/ovs-vswitchd.conf.db.5.pdf 
> Can anyone give me correct ovs-vsctl syntax for this? 
> 
> I dont know record identifier of the record in Open_vSwitch table. As I understood, there will be exactly one row in Open_vSwitch table. 
> So, I am trying to figure out how to get the id of the record and set those two columns in one ovs-vsctl command. 

ovs-vsctl set Open_vSwitch . other-config:n-handler-threads=1 other-config:n-revalidator-threads=1

From blp at nicira.com  Mon May 18 16:54:08 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 18 May 2015 16:54:08 -0700
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <D17F667F.18A5FB%ddesimon@cisco.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
 <D17B5F0A.18A276%ddesimon@cisco.com>
 <20150515181031.GA14637@nicira.com>
 <D17BB16E.18A33F%ddesimon@cisco.com>
 <20150515233429.GC14637@nicira.com>
 <D17F667F.18A5FB%ddesimon@cisco.com>
Message-ID: <20150518235408.GC6582@nicira.com>

That's the solution I've heard of most.  Open vSwitch doesn't have
built-in support for LLDP, except in the context of Auto-Attach.

On Mon, May 18, 2015 at 01:51:54PM +0000, Dave DeSimone (ddesimon) wrote:
> I need to investigate this as I¹m not familiar with OpenFlow.
> Is this the only option?
> Thank you.
> 
> On 5/15/15, 7:34 PM, "Ben Pfaff" <blp at nicira.com> wrote:
> 
> >On Fri, May 15, 2015 at 07:19:51PM +0000, Dave DeSimone (ddesimon) wrote:
> >> Thanks for the quick reply!
> >> 
> >> Ok. How do I get the lldp packets through ovs to the lldp process?
> >
> >One common way is to implement lldp as an OpenFlow controller and
> >direct packets to it with "controller" actions that send OpenFlow
> >"packet-in" messages to the controller.
> 

From blp at nicira.com  Mon May 18 16:54:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 18 May 2015 16:54:51 -0700
Subject: [ovs-discuss] [ovs-dev] OVS 2.3.1 build fail using openwrt
	buildroot
In-Reply-To: <CABcSDhcbKwRPxb-6e_0APTLK+0L2UZTDWWD3FZJ8yhzAiON_Eg@mail.gmail.com>
References: <CABcSDhfSK54rswY9Z5E7kgBRodw-0xQkpQMZmf88Vvbx8dndhw@mail.gmail.com>
 <20150515162717.GF9947@nicira.com>
 <CABcSDhcbKwRPxb-6e_0APTLK+0L2UZTDWWD3FZJ8yhzAiON_Eg@mail.gmail.com>
Message-ID: <20150518235451.GD6582@nicira.com>

I don't know; this is the first report of this kind that I remember
seeing.

On Mon, May 18, 2015 at 02:28:53PM -0400, Alison C. wrote:
> Okay. Any other ideas why the build might be failing, then?
> 
> 2015-05-15 12:27 GMT-04:00 Ben Pfaff <blp at nicira.com>:
> > On Fri, May 15, 2015 at 11:56:42AM -0400, Alison C. wrote:
> >> Hey everybody,
> >>
> >> Is there a minimum binutils version required to build OVS 2.3.1?
> >>
> >> I'm trying to build it in a openwrt buildroot environment, but it
> >> fails with "{standard input}:1116: Error: unknown pseudo-op:
> >> `.tprelword'". According to a [Stack Overflow
> >> thread](http://stackoverflow.com/questions/8872517) this could be due
> >> to too old version of binutils or gcc/g++ version mismatch. The
> >> versions of gcc, g++, and binutils are as follows:
> >>
> >> [11:42:40] erinacity:~/Code/openwrt/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin
> >> alisonc $ ./mips-openwrt-linux-uclibc-gcc --version | head -1
> >> mips-openwrt-linux-uclibc-gcc (OpenWrt/Linaro GCC 4.8-2014.04 r45620) 4.8.3
> >>
> >> alisonc $ ./mips-openwrt-linux-uclibc-g++ --version | head -1
> >> mips-openwrt-linux-uclibc-g++ (OpenWrt/Linaro GCC 4.8-2014.04 r45620) 4.8.3
> >>
> >> alisonc $ ./mips-openwrt-linux-uclibc-as --version | head -1
> >> GNU assembler (GNU Binutils) 2.22
> >>
> >> Thanks for any input you might have.
> >
> > OVS doesn't have any particular binutils requirement.  OVS does do a
> > couple of minor "linker tricks" but binutils has supported those from
> > well before the time OVS started development around 2009.
> 
> 
> 
> -- 
> Alison
> Kettering University
> chan7781 at kettering.edu
> +1 248 635 6672

From maniksidana019 at gmail.com  Mon May 18 18:20:39 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Tue, 19 May 2015 06:50:39 +0530
Subject: [ovs-discuss] GRE tunnels in OpenvSwitch - Packet flow and
	encapsulation/decapsulation
In-Reply-To: <CAG-CZ9dnnaxd9aWFSL_u5HxaQoQDXenBBzBh2roDq6-ezFdA6w@mail.gmail.com>
References: <CAG-CZ9dnnaxd9aWFSL_u5HxaQoQDXenBBzBh2roDq6-ezFdA6w@mail.gmail.com>
Message-ID: <CAG-CZ9cNwf1F=7gSLqk4MnFZphNbgDseG59wRuSauVOS_7gsDg@mail.gmail.com>

Sorry for posting again. Can anybody help me in understanding this.
On 16 May 2015 13:20, "Manik Sidana" <maniksidana019 at gmail.com> wrote:

> Hi All,
>
> I am new to GRE tunneling in OVS. I tried the below example
> http://linuxmantra.com/2013/08/gre-tunneling-with-open-vswitch.html
> and I was able to establish the tunnel between the two VMs on two
> different physical machines.
>
> This link talks about creating isolated bridges br0 and br2 but I was
> able to achieve it with a single bridge br2.
> Now I want to understand the packet flow of how the actual
> communication happens when VM1 pings VM2.
>
> 1. Data from VM1 reaches br2 through the tap interface. At this point,
> the ARP entry is not learnt, so br2 broadcasts the packets and thus
> the packet reaches gre0 interface on br2.
> 2. Packet is encapsulated with GRE header.
> 3. Now, how this packet reaches br0 and leaves the host machine from
> eth0 is not clear. Who picks the encapsulated packet ? Is it the OVS
> GRE kernel module ? If yes, then after the packet is encapsulated, is
> the route for remote host applied ?
> 4. Similarly when the packet reaches the destination host machine's
> br0, is it the kernel module that checks GRE header and handsover it
> to gre0 interface of br0
>
> If its the kernel module doing all the wonders, how does it fetches
> the packets. DOes this module takes over the linux networking stack. ?
>
> It would be great help if anybody can explain me the flow.
>
> Thanks
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150519/f699b113/attachment.html>

From nagesh.nitish at gmail.com  Mon May 18 23:17:30 2015
From: nagesh.nitish at gmail.com (nitish nagesh)
Date: Tue, 19 May 2015 11:47:30 +0530
Subject: [ovs-discuss] Increasing the probe-interval of ovs-controller
Message-ID: <CAK6_9mO=1SHmqoPxjBm4UUk5g5oCR1tHC5k42UE3BsCNmTkewQ@mail.gmail.com>

Hi All,

    Please help with the following questions:

    1) Is there a way to change the default probe-interval of 60 seconds in
ovs-controller through the command line?

    2) Also can you point me to a document or a link which explains how i
can compile ovs-controller from sources on linux (Ubuntu)? Please note i
only want to compile the ovs-controller package and not the whole
ovs-vswitch.

Regards,
Nitish
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150519/966d52a9/attachment-0001.html>

From liw at dtdream.com  Tue May 19 02:24:51 2015
From: liw at dtdream.com (=?UTF-8?B?6ZKi6ZSBMDMxMA==?=)
Date: Tue, 19 May 2015 17:24:51 +0800
Subject: [ovs-discuss] =?utf-8?q?For_help_=3A_failed_to_bind__I217-LM_to_o?=
	=?utf-8?q?vs-dpdk?=
Message-ID: <5be9dd33-38d0-4765-a9de-3cb13f839077@dtdream.com>

I setup ovs-dpdk by following INSTALL.DPDK.md
[root at 25 tools]# ./dpdk_nic_bind.py --status

Network devices using DPDK-compatible driver
============================================
0000:00:19.0 'Ethernet Connection I217-LM' drv=igb_uio unused=vfio-pci

crw------- 1 root root 247, 0 May 19 17:07 /dev/uio0                 uio0 is ok

but
[root at 25 tools]# ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk
ovs-vsctl: Error detected while setting up 'dpdk0'.  See ovs-vswitchd log for details.

i had bound 02:01.0 Ethernet controller: Intel Corporation 82545EM Gigabit Ethernet Controller (Copper) (rev 01) to ovs earlier  and  that is ok  
so i realy want to know what is wrong with binding I217-LM to ovs   it does not to be support?

*********************RTFSC*********************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150519/54a8d230/attachment.html>

From diproiettod at vmware.com  Tue May 19 03:36:32 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 19 May 2015 10:36:32 +0000
Subject: [ovs-discuss] For help : failed to bind  I217-LM to ovs-dpdk
In-Reply-To: <5be9dd33-38d0-4765-a9de-3cb13f839077@dtdream.com>
References: <5be9dd33-38d0-4765-a9de-3cb13f839077@dtdream.com>
Message-ID: <D180CCA4.14B5%diproiettod@vmware.com>



On 19/05/2015 10:24, "钢锁0310" <liw at dtdream.com> wrote:

>
>
>I setup ovs-dpdk by following INSTALL.DPDK.md
>
>
>[root at 25 tools]# ./dpdk_nic_bind.py --status
>
>Network devices using DPDK-compatible driver
>============================================
>0000:00:19.0 'Ethernet Connection I217-LM' drv=igb_uio unused=vfio-pci
>
>
>crw------- 1 root root 247, 0 May 19 17:07 /dev/uio0                 uio0
>is ok
>
>
>
>but
>
>
>[root at 25 tools]# ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0
>type=dpdk
>ovs-vsctl: Error detected while setting up 'dpdk0'.  See ovs-vswitchd log
>for details.
>

Could you post the content of the ovs-vswitchd log?

>
>
>i had bound 02:01.0 Ethernet controller: Intel Corporation 82545EM
>Gigabit Ethernet Controller (Copper) (rev 01)
> to ovs earlier  and  that is ok
>
>
>so i realy want to know what is wrong with binding I217-LM
>to ovs   it does not to be support?
>
>
>
>*********************
>RTFSC
>*********************
>
>
>


From blp at nicira.com  Tue May 19 08:22:18 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 19 May 2015 08:22:18 -0700
Subject: [ovs-discuss] Increasing the probe-interval of ovs-controller
In-Reply-To: <CAK6_9mO=1SHmqoPxjBm4UUk5g5oCR1tHC5k42UE3BsCNmTkewQ@mail.gmail.com>
References: <CAK6_9mO=1SHmqoPxjBm4UUk5g5oCR1tHC5k42UE3BsCNmTkewQ@mail.gmail.com>
Message-ID: <20150519152218.GA9818@nicira.com>

On Tue, May 19, 2015 at 11:47:30AM +0530, nitish nagesh wrote:
>     Please help with the following questions:
> 
>     1) Is there a way to change the default probe-interval of 60 seconds in
> ovs-controller through the command line?

No, it doesn't have an option for that.

>     2) Also can you point me to a document or a link which explains how i
> can compile ovs-controller from sources on linux (Ubuntu)? Please note i
> only want to compile the ovs-controller package and not the whole
> ovs-vswitch.

./configure
make utilities/ovs-controller

From gowrishankar.m at linux.vnet.ibm.com  Tue May 19 09:23:13 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Tue, 19 May 2015 21:53:13 +0530
Subject: [ovs-discuss] For help : failed to bind  I217-LM to ovs-dpdk
In-Reply-To: <D180CCA4.14B5%diproiettod@vmware.com>
References: <5be9dd33-38d0-4765-a9de-3cb13f839077@dtdream.com>
 <D180CCA4.14B5%diproiettod@vmware.com>
Message-ID: <555B6371.6050406@linux.vnet.ibm.com>

I am facing same problem. It seems it complained no such device. p3p1 is 
dpdk compatible driver now as well.

dpdk_nic_bind.py --status

Network devices using DPDK-compatible driver
============================================
0000:0e:00.0 '82599ES 10-Gigabit SFI/SFP+ Network Connection' 
drv=igb_uio unused=vfio-pci
0000:0e:00.1 '82599ES 10-Gigabit SFI/SFP+ Network Connection' 
drv=igb_uio unused=vfio-pci


ovs-vsctl add-port br0 p3p1 -- set Interface p3p1 type=dpdk

ovs-vsctl: Error detected while setting up 'p3p1'.  See ovs-vswitchd log 
for details.

ovs-vswitchd.log:

2015-05-19T16:05:45.835Z|00231|poll_loop|DBG|wakeup due to [POLLIN] on 
fd 22 (<->/usr/local/var/run/openvswitch/db.sock) at lib/stream-fd.c:155
2015-05-19T16:05:45.836Z|00232|jsonrpc|DBG|unix:/usr/local/var/run/openvswitch/db.sock: 
received notification, method="update", 
params=[null,{"Interface":{"34f674b5-9d66-4412-b2bb-a87223800c80":{"new":{"name":"p3p1","statistics":["map",[]],"mac":["set",[]],"options":["map",[]],"cfm_flap_count":["set",[]],"ifindex":["set",[]],"cfm_health":["set",[]],"type":"dpdk","bfd_status":["map",[]],"ofport":["set",[]],"admin_state":["set",[]],"error":["set",[]],"link_resets":["set",[]],"mac_in_use":["set",[]],"cfm_fault_status":["set",[]],"lacp_current":["set",[]],"mtu":["set",[]],"lldp":["map",[]],"ofport_request":["set",[]],"status":["map",[]],"other_config":["map",[]],"link_state":["set",[]],"cfm_remote_mpids":["set",[]],"bfd":["map",[]],"cfm_remote_opstate":["set",[]],"cfm_mpid":["set",[]],"cfm_fault":["set",[]],"link_speed":["set",[]],"duplex":["set",[]],"ingress_policing_burst":0,"ingress_policing_rate":0}}},"Port":{"1dd81fa9-9e92-4392-a280-5bc9a9642a4b":{"new":{"statistics":["map",[]],"bond_downdelay":0,"name":"p3p1","fake_bridge":false,"mac":["set",[]],"trunks":["set",[]],"tag":["set",[]],"rstp_status":["map",[]],"bond_updelay":0,"bond_active_slave":["set",[]],"other_config":["map",[]],"status":["map",[]],"qos":["set",[]],"bond_mode":["set",[]],"interfaces":["uuid","34f674b5-9d66-4412-b2bb-a87223800c80"],"bond_fake_iface":false,"rstp_statistics":["map",[]],"vlan_mode":["set",[]],"lacp":["set",[]]}}},"Bridge":{"d64a8e1a-0e69-4cbd-9081-332e5a4e04e6":{"new":{"name":"br0","flood_vlans":["set",[]],"stp_enable":false,"ports":["set",[["uuid","1dd81fa9-9e92-4392-a280-5bc9a9642a4b"],["uuid","37f926ae-5388-481e-a9da-4447904c1bf6"]]],"auto_attach":["set",[]],"rstp_enable":false,"fail_mode":["set",[]],"rstp_status":["map",[]],"flow_tables":["map",[]],"netflow":["set",[]],"datapath_type":"netdev","controller":["set",[]],"status":["map",[]],"ipfix":["set",[]],"other_config":["map",[]],"mirrors":["set",[]],"datapath_id":"00001a8e4ad6bd4c","mcast_snooping_enable":false,"protocols":["set",[]],"sflow":["set",[]],"datapath_version":"<built-in>"},"old":{"ports":["uuid","37f926ae-5388-481e-a9da-4447904c1bf6"]}}},"Open_vSwitch":{"d384f9bb-072c-4505-afc8-f136fb2e860d":{"new":{"manager_options":["set",[]],"bridges":["uuid","d64a8e1a-0e69-4cbd-9081-332e5a4e04e6"],"statistics":["map",[]],"other_config":["map",[]],"cur_cfg":1,"next_cfg":2,"iface_types":["set",["dpdk","dpdkr","geneve","gre","gre64","internal","ipsec_gre","ipsec_gre64","lisp","patch","stt","system","tap","vxlan"]],"ssl":["set",[]],"datapath_types":["set",["netdev","system"]]},"old":{"next_cfg":1}}}}]
2015-05-19T16:05:45.836Z|00233|dpif|DBG|netdev at ovs-netdev: device br0 is 
on port 1
2015-05-19T16:05:45.836Z|00234|bridge|WARN|could not open network device 
p3p1 (No such device)
2015-05-19T16:05:45.836Z|00235|netlink_socket|DBG|nl_sock_transact_multiple__ 
(Success): nl(len:52, type=37(family-defined), flags=1[REQUEST], seq=f, 
pid=4294962906
2015-05-19T16:05:45.836Z|00236|netlink_socket|DBG|nl_sock_recv__ 
(Success): nl(len:72, type=2(error), flags=0, seq=f, pid=4294962906 
error(-2(No such file or directory), in-reply-to(nl(len:52, 
type=37(family-defined), flags=1[REQUEST], seq=f, pid=4294962906))
2015-05-19T16:05:45.836Z|00237|netlink_socket|DBG|received NAK error=0 
(No such file or directory)
2015-05-19T16:05:45.836Z|00238|jsonrpc|DBG|unix:/usr/local/var/run/openvswitch/db.sock: 
send request, method="transact", 
params=["Open_vSwitch",{"lock":"ovs_vswitchd","op":"assert"},{"where":[["_uuid","==",["uuid","34f674b5-9d66-4412-b2bb-a87223800c80"]]],"row":{"ofport":-1,"error":"could 
not open network device p3p1 (No such 
device)"},"op":"update","table":"Interface"},{"where":[["_uuid","==",["uuid","d384f9bb-072c-4505-afc8-f136fb2e860d"]]],"row":{"cur_cfg":2},"op":"update","table":"Open_vSwitch"}], 
id=7


Thanks,
Gowrishankar

On Tuesday 19 May 2015 04:06 PM, Daniele Di Proietto wrote:
>
> On 19/05/2015 10:24, "钢锁0310" <liw at dtdream.com> wrote:
>
>>
>> I setup ovs-dpdk by following INSTALL.DPDK.md
>>
>>
>> [root at 25 tools]# ./dpdk_nic_bind.py --status
>>
>> Network devices using DPDK-compatible driver
>> ============================================
>> 0000:00:19.0 'Ethernet Connection I217-LM' drv=igb_uio unused=vfio-pci
>>
>>
>> crw------- 1 root root 247, 0 May 19 17:07 /dev/uio0                 uio0
>> is ok
>>
>>
>>
>> but
>>
>>
>> [root at 25 tools]# ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0
>> type=dpdk
>> ovs-vsctl: Error detected while setting up 'dpdk0'.  See ovs-vswitchd log
>> for details.
>>
> Could you post the content of the ovs-vswitchd log?
>
>>
>> i had bound 02:01.0 Ethernet controller: Intel Corporation 82545EM
>> Gigabit Ethernet Controller (Copper) (rev 01)
>> to ovs earlier  and  that is ok
>>
>>
>> so i realy want to know what is wrong with binding I217-LM
>> to ovs   it does not to be support?
>>
>>
>>
>> *********************
>> RTFSC
>> *********************
>>
>>
>>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss




From diproiettod at vmware.com  Tue May 19 09:54:25 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 19 May 2015 16:54:25 +0000
Subject: [ovs-discuss] For help : failed to bind  I217-LM to ovs-dpdk
In-Reply-To: <555B6371.6050406@linux.vnet.ibm.com>
References: <5be9dd33-38d0-4765-a9de-3cb13f839077@dtdream.com>
 <D180CCA4.14B5%diproiettod@vmware.com> <555B6371.6050406@linux.vnet.ibm.com>
Message-ID: <D18124FC.1558%diproiettod@vmware.com>

This seems a different issue.  When an interface is bound to the
igb_uio driver, it loses its system name ("p3p1").  DPDK uses
small integers (port ids) to identify interfaces.

OVS prefixes the portid with the "dpdk" string.  This is the command
to add the NIC with port id 0 to bridge br0:

ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk
 
Please refer to INSTALL.DPDK.md in the source distribution for
more details.

On 19/05/2015 17:23, "gowrishankar" <gowrishankar.m at linux.vnet.ibm.com>
wrote:

>I am facing same problem. It seems it complained no such device. p3p1 is
>dpdk compatible driver now as well.
>
>dpdk_nic_bind.py --status
>
>Network devices using DPDK-compatible driver
>============================================
>0000:0e:00.0 '82599ES 10-Gigabit SFI/SFP+ Network Connection'
>drv=igb_uio unused=vfio-pci
>0000:0e:00.1 '82599ES 10-Gigabit SFI/SFP+ Network Connection'
>drv=igb_uio unused=vfio-pci
>
>
>ovs-vsctl add-port br0 p3p1 -- set Interface p3p1 type=dpdk
>
>ovs-vsctl: Error detected while setting up 'p3p1'.  See ovs-vswitchd log
>for details.
>
>ovs-vswitchd.log:
>
>2015-05-19T16:05:45.835Z|00231|poll_loop|DBG|wakeup due to [POLLIN] on
>fd 22 (<->/usr/local/var/run/openvswitch/db.sock) at lib/stream-fd.c:155
>2015-05-19T16:05:45.836Z|00232|jsonrpc|DBG|unix:/usr/local/var/run/openvsw
>itch/db.sock: 
>received notification, method="update",
>params=[null,{"Interface":{"34f674b5-9d66-4412-b2bb-a87223800c80":{"new":{
>"name":"p3p1","statistics":["map",[]],"mac":["set",[]],"options":["map",[]
>],"cfm_flap_count":["set",[]],"ifindex":["set",[]],"cfm_health":["set",[]]
>,"type":"dpdk","bfd_status":["map",[]],"ofport":["set",[]],"admin_state":[
>"set",[]],"error":["set",[]],"link_resets":["set",[]],"mac_in_use":["set",
>[]],"cfm_fault_status":["set",[]],"lacp_current":["set",[]],"mtu":["set",[
>]],"lldp":["map",[]],"ofport_request":["set",[]],"status":["map",[]],"othe
>r_config":["map",[]],"link_state":["set",[]],"cfm_remote_mpids":["set",[]]
>,"bfd":["map",[]],"cfm_remote_opstate":["set",[]],"cfm_mpid":["set",[]],"c
>fm_fault":["set",[]],"link_speed":["set",[]],"duplex":["set",[]],"ingress_
>policing_burst":0,"ingress_policing_rate":0}}},"Port":{"1dd81fa9-9e92-4392
>-a280-5bc9a9642a4b":{"new":{"statistics":["map",[]],"bond_downdelay":0,"na
>me":"p3p1","fake_bridge":false,"mac":["set",[]],"trunks":["set",[]],"tag":
>["set",[]],"rstp_status":["map",[]],"bond_updelay":0,"bond_active_slave":[
>"set",[]],"other_config":["map",[]],"status":["map",[]],"qos":["set",[]],"
>bond_mode":["set",[]],"interfaces":["uuid","34f674b5-9d66-4412-b2bb-a87223
>800c80"],"bond_fake_iface":false,"rstp_statistics":["map",[]],"vlan_mode":
>["set",[]],"lacp":["set",[]]}}},"Bridge":{"d64a8e1a-0e69-4cbd-9081-332e5a4
>e04e6":{"new":{"name":"br0","flood_vlans":["set",[]],"stp_enable":false,"p
>orts":["set",[["uuid","1dd81fa9-9e92-4392-a280-5bc9a9642a4b"],["uuid","37f
>926ae-5388-481e-a9da-4447904c1bf6"]]],"auto_attach":["set",[]],"rstp_enabl
>e":false,"fail_mode":["set",[]],"rstp_status":["map",[]],"flow_tables":["m
>ap",[]],"netflow":["set",[]],"datapath_type":"netdev","controller":["set",
>[]],"status":["map",[]],"ipfix":["set",[]],"other_config":["map",[]],"mirr
>ors":["set",[]],"datapath_id":"00001a8e4ad6bd4c","mcast_snooping_enable":f
>alse,"protocols":["set",[]],"sflow":["set",[]],"datapath_version":"<built-
>in>"},"old":{"ports":["uuid","37f926ae-5388-481e-a9da-4447904c1bf6"]}}},"O
>pen_vSwitch":{"d384f9bb-072c-4505-afc8-f136fb2e860d":{"new":{"manager_opti
>ons":["set",[]],"bridges":["uuid","d64a8e1a-0e69-4cbd-9081-332e5a4e04e6"],
>"statistics":["map",[]],"other_config":["map",[]],"cur_cfg":1,"next_cfg":2
>,"iface_types":["set",["dpdk","dpdkr","geneve","gre","gre64","internal","i
>psec_gre","ipsec_gre64","lisp","patch","stt","system","tap","vxlan"]],"ssl
>":["set",[]],"datapath_types":["set",["netdev","system"]]},"old":{"next_cf
>g":1}}}}]
>2015-05-19T16:05:45.836Z|00233|dpif|DBG|netdev at ovs-netdev: device br0 is
>on port 1
>2015-05-19T16:05:45.836Z|00234|bridge|WARN|could not open network device
>p3p1 (No such device)
>2015-05-19T16:05:45.836Z|00235|netlink_socket|DBG|nl_sock_transact_multipl
>e__ 
>(Success): nl(len:52, type=37(family-defined), flags=1[REQUEST], seq=f,
>pid=4294962906
>2015-05-19T16:05:45.836Z|00236|netlink_socket|DBG|nl_sock_recv__
>(Success): nl(len:72, type=2(error), flags=0, seq=f, pid=4294962906
>error(-2(No such file or directory), in-reply-to(nl(len:52,
>type=37(family-defined), flags=1[REQUEST], seq=f, pid=4294962906))
>2015-05-19T16:05:45.836Z|00237|netlink_socket|DBG|received NAK error=0
>(No such file or directory)
>2015-05-19T16:05:45.836Z|00238|jsonrpc|DBG|unix:/usr/local/var/run/openvsw
>itch/db.sock: 
>send request, method="transact",
>params=["Open_vSwitch",{"lock":"ovs_vswitchd","op":"assert"},{"where":[["_
>uuid","==",["uuid","34f674b5-9d66-4412-b2bb-a87223800c80"]]],"row":{"ofpor
>t":-1,"error":"could
>not open network device p3p1 (No such
>device)"},"op":"update","table":"Interface"},{"where":[["_uuid","==",["uui
>d","d384f9bb-072c-4505-afc8-f136fb2e860d"]]],"row":{"cur_cfg":2},"op":"upd
>ate","table":"Open_vSwitch"}],
>id=7
>
>
>Thanks,
>Gowrishankar
>
>On Tuesday 19 May 2015 04:06 PM, Daniele Di Proietto wrote:
>>
>> On 19/05/2015 10:24, "钢锁0310" <liw at dtdream.com> wrote:
>>
>>>
>>> I setup ovs-dpdk by following INSTALL.DPDK.md
>>>
>>>
>>> [root at 25 tools]# ./dpdk_nic_bind.py --status
>>>
>>> Network devices using DPDK-compatible driver
>>> ============================================
>>> 0000:00:19.0 'Ethernet Connection I217-LM' drv=igb_uio unused=vfio-pci
>>>
>>>
>>> crw------- 1 root root 247, 0 May 19 17:07 /dev/uio0
>>>uio0
>>> is ok
>>>
>>>
>>>
>>> but
>>>
>>>
>>> [root at 25 tools]# ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0
>>> type=dpdk
>>> ovs-vsctl: Error detected while setting up 'dpdk0'.  See ovs-vswitchd
>>>log
>>> for details.
>>>
>> Could you post the content of the ovs-vswitchd log?
>>
>>>
>>> i had bound 02:01.0 Ethernet controller: Intel Corporation 82545EM
>>> Gigabit Ethernet Controller (Copper) (rev 01)
>>> to ovs earlier  and  that is ok
>>>
>>>
>>> so i realy want to know what is wrong with binding I217-LM
>>> to ovs   it does not to be support?
>>>
>>>
>>>
>>> *********************
>>> RTFSC
>>> *********************
>>>
>>>
>>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> 
>>https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_mailm
>>an_listinfo_discuss&d=AwIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uE
>>s&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=DxhydkAC7TMU1m7Dxi6OpqD
>>z5J6kfGB6S6sWA7Ydxfo&s=cKoQFzj0olOKzh-rcL7svmhqpWE-7rQaFD2We6yYga8&e=
>
>
>
>_______________________________________________
>discuss mailing list
>discuss at openvswitch.org
>https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_mailma
>n_listinfo_discuss&d=AwIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&
>r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=DxhydkAC7TMU1m7Dxi6OpqDz5J
>6kfGB6S6sWA7Ydxfo&s=cKoQFzj0olOKzh-rcL7svmhqpWE-7rQaFD2We6yYga8&e= 


From davidjoshuaevans at gmail.com  Tue May 19 11:57:57 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Tue, 19 May 2015 13:57:57 -0500
Subject: [ovs-discuss] openflow 1.3 flow mod with experimenter match
Message-ID: <D180F1E5.28512%davidjoshuaevans@gmail.com>

Hi Discuss Group.

I¹d like to implement a custom match on my  custom ether_type,  custom layer
2.5 value (not VLAN/MPLS etc.)
I understand that I need to modify at least:
* match.c with match_set* functions and add to the flow¹ struct my foomatch
variable. 
* Meta-flow.c with all the behaviors I need to MFF_FOOMATCH_TYPE required
for my functions in match.c
*  OXM_CLASSES needs a vendor to match my controller in the
extract-ofp-fields py script  for translation functions
* in ofp-util.c I need a handler for OFPTFPT13_EXPERIMENTER, but what to add
I have no idea other than it should look something like parse_oxms.

How do I connect up to openflow messaging to implement flow mod with an
experimenter match ?

Regards,

Dave.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150519/5381c096/attachment.html>

From hollemanietf at gmail.com  Tue May 19 13:48:24 2015
From: hollemanietf at gmail.com (Keith Holleman)
Date: Tue, 19 May 2015 13:48:24 -0700
Subject: [ovs-discuss] Tunnels with duplicate configuration
Message-ID: <CAEpyMTDrTSKwZPEGzBECczDcH7agkS9Tbm82KwsfFs7er6TPbg@mail.gmail.com>

Running OVS 2.3.0 on Ubuntu from a debian package.

I am creating two interfaces that are tunnels with duplicate configuration
as shown below and noticed that this causes some interesting behavior.
Everything appears to work but in reality, only one of the of-ports is able
to send traffic.

ovs-vsctl add-port br0 test1 -- set interface test1 type=gre
options:remote_ip=1.1.1.1 options:local_ip=2.2.2.2 options:key=1234
ovs-vsctl add-port br0 test2 -- set interface test2 type=gre
options:remote_ip=1.1.1.1 options:local_ip=2.2.2.2 options:key=1234

>From the ovs-vswitch.log it has detected the conflict, but allows things to
silently proceed and assigns them both an ofport.

2015-05-16T00:32:35.817Z|01079|bridge|INFO|bridge br0: added interface
test1 on port 10
2015-05-16T00:32:46.026Z|01086|tunnel|WARN|test2: attempting to add tunnel
port with same config as port 'test1' (2.2.2.2->1.1.1.1, key=0x4d2, dp
port=4, pkt mark=0)
2015-05-16T00:32:46.026Z|01087|bridge|INFO|bridge br0: added interface
test2 on port 11

Both ports end up getting marked up and have distinct configured flows
attempting to output to the ports.  The flows are seeing the statistics
increment.  But only which ever tunnel was added first actually sends out
packets on the wire and has statistics shown in the INTERFACE table or in
the "ovs-ofctl dump-ports" output, the second tunnel never sends or has
stats even though flows using it as the output action are incrementing.

Is this expected behavior?  I can argue both ways, but would have though
that if the interface/port is going to be rendered useless, it would be
better to fail at install time rather than dumping a log and letting things
quietly proceed.  Or was the intention to let both
tunnels/interface/ofports work and it's just a bug that only one works?

This is the ending output of the interface state before traffic is passed:

~# ovs-vsctl list INTERFACE test1
_uuid               : f31b95ad-d8dd-43ba-a4a3-2fdbf9bd0627
admin_state         : up
bfd                 : {}
bfd_status          : {}
cfm_fault           : []
cfm_fault_status    : []
cfm_flap_count      : []
cfm_health          : []
cfm_mpid            : []
cfm_remote_mpids    : []
cfm_remote_opstate  : []
duplex              : []
external_ids        : {}
ifindex             : 0
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : 0
link_speed          : []
link_state          : up
mac                 : []
mac_in_use          : "8e:cb:43:d5:77:ef"
mtu                 : []
name                : "test1"
ofport              : 10
ofport_request      : []
options             : {key="1234", local_ip="2.2.2.2", remote_ip="1.1.1.1"}
other_config        : {}
statistics          : {collisions=0, rx_bytes=0, rx_crc_err=0,
rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=0,
tx_bytes=0, tx_dropped=0, tx_errors=0, tx_packets=0}
status              : {tunnel_egress_iface="lan0",
tunnel_egress_iface_carrier=up}
type                : gre

~# ovs-vsctl list INTERFACE test2
_uuid               : dfc254e1-a4f2-41fe-b02b-0a0128af38c2
admin_state         : up
bfd                 : {}
bfd_status          : {}
cfm_fault           : []
cfm_fault_status    : []
cfm_flap_count      : []
cfm_health          : []
cfm_mpid            : []
cfm_remote_mpids    : []
cfm_remote_opstate  : []
duplex              : []
external_ids        : {}
ifindex             : 0
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : 0
link_speed          : []
link_state          : up
mac                 : []
mac_in_use          : "ee:9d:36:18:6a:1d"
mtu                 : []
name                : "test2"
ofport              : 11
ofport_request      : []
options             : {key="1234", local_ip="2.2.2.2", remote_ip="1.1.1.1"}
other_config        : {}
statistics          : {collisions=0, rx_bytes=0, rx_crc_err=0,
rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=0,
tx_bytes=0, tx_dropped=0, tx_errors=0, tx_packets=0}
status              : {tunnel_egress_iface="lan0",
tunnel_egress_iface_carrier=up}
type                : gre
~#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150519/f21fb7b4/attachment.html>

From kevin.traynor at intel.com  Tue May 19 14:48:13 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 19 May 2015 21:48:13 +0000
Subject: [ovs-discuss] For help : failed to bind  I217-LM to ovs-dpdk
In-Reply-To: <D180CCA4.14B5%diproiettod@vmware.com>
References: <5be9dd33-38d0-4765-a9de-3cb13f839077@dtdream.com>
 <D180CCA4.14B5%diproiettod@vmware.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7307560A2@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Daniele
> Di Proietto
> Sent: Tuesday, May 19, 2015 11:37 AM
> To: 钢锁0310
> Cc: 通天晓0280; discuss
> Subject: Re: [ovs-discuss] For help : failed to bind I217-LM to ovs-dpdk
> 
> 
> 
> On 19/05/2015 10:24, "钢锁0310" <liw at dtdream.com> wrote:
> 
> >
> >
> >I setup ovs-dpdk by following INSTALL.DPDK.md
> >
> >
> >[root at 25 tools]# ./dpdk_nic_bind.py --status
> >
> >Network devices using DPDK-compatible driver
> >============================================
> >0000:00:19.0 'Ethernet Connection I217-LM' drv=igb_uio unused=vfio-pci
> >
> >
> >crw------- 1 root root 247, 0 May 19 17:07 /dev/uio0                 uio0
> >is ok
> >
> >
> >
> >but
> >
> >
> >[root at 25 tools]# ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0
> >type=dpdk
> >ovs-vsctl: Error detected while setting up 'dpdk0'.  See ovs-vswitchd log
> >for details.
> >
> 
> Could you post the content of the ovs-vswitchd log?
> 
> >
> >
> >i had bound 02:01.0 Ethernet controller: Intel Corporation 82545EM
> >Gigabit Ethernet Controller (Copper) (rev 01)
> > to ovs earlier  and  that is ok
> >
> >
> >so i realy want to know what is wrong with binding I217-LM
> >to ovs   it does not to be support?

There's a list of NICs supported by DPDK here http://dpdk.org/doc/nics

> >
> >
> >
> >*********************
> >RTFSC
> >*********************
> >
> >
> >
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From nagesh.nitish at gmail.com  Wed May 20 00:02:54 2015
From: nagesh.nitish at gmail.com (nitish nagesh)
Date: Wed, 20 May 2015 12:32:54 +0530
Subject: [ovs-discuss] Increasing the probe-interval of ovs-controller
In-Reply-To: <20150519152218.GA9818@nicira.com>
References: <CAK6_9mO=1SHmqoPxjBm4UUk5g5oCR1tHC5k42UE3BsCNmTkewQ@mail.gmail.com>
 <20150519152218.GA9818@nicira.com>
Message-ID: <CAK6_9mMSjd1bUu0r6Eh1rR7DwnfuAzjGhPCtXSdcBd3Ec4EjZg@mail.gmail.com>

Thanks Ben.

Apparently the ovs-controller has been renamed to test-controller and moved
to tests directory.
"make tests/test-controller"

Regards,
Nitish

On Tue, May 19, 2015 at 8:52 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, May 19, 2015 at 11:47:30AM +0530, nitish nagesh wrote:
> >     Please help with the following questions:
> >
> >     1) Is there a way to change the default probe-interval of 60 seconds
> in
> > ovs-controller through the command line?
>
> No, it doesn't have an option for that.
>
> >     2) Also can you point me to a document or a link which explains how i
> > can compile ovs-controller from sources on linux (Ubuntu)? Please note i
> > only want to compile the ovs-controller package and not the whole
> > ovs-vswitch.
>
> ./configure
> make utilities/ovs-controller
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150520/c295db67/attachment.html>

From fengyuleidian0615 at gmail.com  Wed May 20 00:05:13 2015
From: fengyuleidian0615 at gmail.com (leidian fengyu)
Date: Wed, 20 May 2015 15:05:13 +0800
Subject: [ovs-discuss] vhost-cuse ports with qemu-2.3.0
Message-ID: <CAL2Z+UB-T-L+euyUDc14xvwACGuXJ2pnKJ+c2jdJaMG39Y8xQw@mail.gmail.com>

Hi, Traynor

Several month ago, I setup a user space ovs bridge with vhost-cuse v8 patch
set.
It all works well with qemu-kvm, but now when I switched to qemu-2.3.0,
with the same
image, and same boot parameters as OTHER_ARGS stated in INSTALL.DPDK.md
"DPDK vHost
VM configuration with standard vHost" section, kvm guest cannot DHCPed
valid ip address,
actually ifconfig guest_eth0 shows no traffic at all.

Am I using the right qemu version or
Am I missing something obviously when using qemu-2.3.0?
Thanks in advance!

OTHER_ARGS="-smp 4 -m 2048 -hda centos7-1.img
            -netdev
tap,id=nic1,script=no,downscript=no,ifname=dpdkvhost1,vhost=on \
            -device virtio-net-pci,netdev=nic1,mac=00:16:3d:22:33:54,\
            csum=off,gso=off,guest_tso4=off,guest_tso6=off,guest_ecn=off \
            -mem-path /dev/hugepages -mem-prealloc"



(1) Use qemu-kvm from https://git.kernel.org/pub/scm/virt/kvm/qemu-kvm.git
qemu-kvm/x86_64-softmmu/qemu-system-x86_64 $OTHER_ARGS

(2) Use qemu-2.3.0
qemu-2.3.0/x86_64-softmmu/qemu-system-x86_64 -enable-kvm $OTHER_ARGS

-- 
天下英雄出我辈，一入江湖岁月催。
宏图霸业谈笑中，不胜人生一场醉。
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150520/8793e283/attachment-0001.html>

From cvinllen at gmail.com  Wed May 20 01:16:51 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Wed, 20 May 2015 16:16:51 +0800
Subject: [ovs-discuss] Does ovs support static router
Message-ID: <CAN2QyzY9KfGXO8a5K2fbWdZjMfb-E+ENk4EB_h7yFE4vtRUULA@mail.gmail.com>

Dear all,

    As i kown, ovs support flow table to direct forwarding packets. Now i
want to send the static route tables from controller to ovs, in a word, ovs
play as a hybrid switch in openflow protocal 1.3.

    Great appreciate for anyone's reply.

Best regards,
Vinllen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150520/98713bf2/attachment.html>

From liw at dtdream.com  Wed May 20 02:39:53 2015
From: liw at dtdream.com (=?UTF-8?B?6ZKi6ZSBMDMxMA==?=)
Date: Wed, 20 May 2015 17:39:53 +0800
Subject: [ovs-discuss] =?utf-8?q?For_help_about_ssh_between_vms_through_ov?=
	=?utf-8?q?s-dkdp?=
Message-ID: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>

i build the vm-ovsdpdk-vm environment by using vhost-cuse
the cmd is following
ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
ovs-vsctl add-port br0 tap0 -- set Interface tap0 type=dpdkvhost  
ovs-vsctl add-port br0 tap1 -- set Interface tap1 type=dpdkvhost

qemu-system-x86_64 cirros.img -m 2G -vnc :1 -object memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on -device virtio-net-pci,netdev=net1
qemu-system-x86_64 cirros.img -m 2G -vnc :2 -object memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on -device virtio-net-pci,netdev=net1

# add ovs flow
ovs-ofctl add-flow br0 in_port=1,action:output=2
ovs-ofctl add-flow br0 in_port=2,action:output=1
mac of vm1 is 00:00:00:00:00:01   vm2 is 00:00:00:00:00:02
ping form vm1 to vm2 is ok, but ssh is not ok
On vm1 run ssh to vm2,   Run tcpdump on vm2,  the catching packet as follow 
it seems the packets is all wrong
Anyone meet this situation?
*********************RTFSC*********************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150520/8090fbe8/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: temp4cj.png
Type: application/octet-stream
Size: 25941 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150520/8090fbe8/attachment-0001.obj>

From diproiettod at vmware.com  Wed May 20 05:46:55 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Wed, 20 May 2015 12:46:55 +0000
Subject: [ovs-discuss] For help about ssh between vms through ovs-dkdp
In-Reply-To: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
Message-ID: <D1823F0C.15C5%diproiettod@vmware.com>

This might be related to offloading features.

Could you try again with this qemu "-device" option and let us know?
-device 
virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off,g
uest_ecn=off


Kevin, do you this we should mention this in INSTALL.DPDk.md?


On 20/05/2015 10:39, "钢锁0310" <liw at dtdream.com> wrote:

>i build the vm-ovsdpdk-vm environment by using vhost-cuse
>
>
>the cmd is following
>
>
>ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
>ovs-vsctl add-port br0 tap0 -- set Interface tap0 type=dpdkvhost
>ovs-vsctl add-port br0 tap1 -- set Interface tap1 type=dpdkvhost
>
>qemu-system-x86_64 cirros.img -m 2G -vnc :1 -object
>memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa
>node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on
>-device virtio-net-pci,netdev=net1
>qemu-system-x86_64 cirros.img -m 2G -vnc :2 -object
>memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa
>node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on
>-device virtio-net-pci,netdev=net1
>
># add ovs flow
>ovs-ofctl add-flow br0 in_port=1,action:output=2
>ovs-ofctl add-flow br0 in_port=2,action:output=1
>
>
>mac of vm1 is 00:00:00:00:00:01   vm2 is 00:00:00:00:00:02
>
>
>ping form vm1 to vm2 is ok, but ssh is not ok
>
>
>On vm1 run ssh to vm2,   Run tcpdump on vm2,  the catching packet as
>follow
> 
>
>
>it seems the packets is all wrong
>
>
>Anyone meet this situation?
>
>
>*********************
>RTFSC
>*********************
>
>
>


From kevin.traynor at intel.com  Wed May 20 07:21:29 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Wed, 20 May 2015 14:21:29 +0000
Subject: [ovs-discuss] For help about ssh between vms through ovs-dkdp
In-Reply-To: <D1823F0C.15C5%diproiettod@vmware.com>
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> Sent: Wednesday, May 20, 2015 1:47 PM
> To: 钢锁0310
> Cc: 通天晓0280; discuss; Traynor, Kevin
> Subject: Re: [ovs-discuss] For help about ssh between vms through ovs-dkdp
> 
> This might be related to offloading features.
> 
> Could you try again with this qemu "-device" option and let us know?
> -device
> virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off,g
> uest_ecn=off

I checked this previously and the DPDK vhost lib will report those features
as not available during negotiation so you should be ok with not specifying
them explicitly in the qemu cmd line. I haven't tested with qemu 2.3.

> 
> 
> Kevin, do you this we should mention this in INSTALL.DPDk.md?

I had changed the original patch to make it optional in 3a based on feedback
from Michael Tsirkin and testing. So unless we find an issue, I'd prefer to
leave optional. 
https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#dpdk-vhost-vm-configuration

> 
> 
> On 20/05/2015 10:39, "钢锁0310" <liw at dtdream.com> wrote:
> 
> >i build the vm-ovsdpdk-vm environment by using vhost-cuse
> >
> >
> >the cmd is following
> >
> >
> >ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
> >ovs-vsctl add-port br0 tap0 -- set Interface tap0 type=dpdkvhost
> >ovs-vsctl add-port br0 tap1 -- set Interface tap1 type=dpdkvhost
> >
> >qemu-system-x86_64 cirros.img -m 2G -vnc :1 -object
> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa
> >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on
> >-device virtio-net-pci,netdev=net1
> >qemu-system-x86_64 cirros.img -m 2G -vnc :2 -object
> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa
> >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on
> >-device virtio-net-pci,netdev=net1

You are not specifying the ifname on the command line. What does the
vswitchd.log say regarding the adding/removing of vhost ports?
e.g. |INFO|vHost Device 'dpdkvhost1' (1) has been added

> >
> ># add ovs flow
> >ovs-ofctl add-flow br0 in_port=1,action:output=2
> >ovs-ofctl add-flow br0 in_port=2,action:output=1
> >
> >
> >mac of vm1 is 00:00:00:00:00:01   vm2 is 00:00:00:00:00:02
> >
> >
> >ping form vm1 to vm2 is ok, but ssh is not ok
> >
> >
> >On vm1 run ssh to vm2,   Run tcpdump on vm2,  the catching packet as
> >follow
> >
> >
> >
> >it seems the packets is all wrong
> >
> >
> >Anyone meet this situation?

What kernel version are you using in the guest? There is a known DPDK issue
with 3.19.5 in the guest when using the kernel to fwd pkts. The fix for it
is here: http://dpdk.org/ml/archives/dev/2015-May/017251.html

> >
> >
> >*********************
> >RTFSC
> >*********************
> >
> >
> >


From kevin.traynor at intel.com  Wed May 20 07:38:16 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Wed, 20 May 2015 14:38:16 +0000
Subject: [ovs-discuss] vhost-cuse ports with qemu-2.3.0
In-Reply-To: <CAL2Z+UB-T-L+euyUDc14xvwACGuXJ2pnKJ+c2jdJaMG39Y8xQw@mail.gmail.com>
References: <CAL2Z+UB-T-L+euyUDc14xvwACGuXJ2pnKJ+c2jdJaMG39Y8xQw@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F730756CA1@IRSMSX104.ger.corp.intel.com>

> From: leidian fengyu [mailto:fengyuleidian0615 at gmail.com]

> Sent: Wednesday, May 20, 2015 8:05 AM

> To: discuss at openvswitch.org<mailto:discuss at openvswitch.org>

> Cc: Traynor, Kevin

> Subject: vhost-cuse ports with qemu-2.3.0

>

> Hi, Traynor

>

> Several month ago, I setup a user space ovs bridge with vhost-cuse v8 patch

> set.

> It all works well with qemu-kvm, but now when I switched to qemu-2.3.0, with

> the same

> image, and same boot parameters as OTHER_ARGS stated in INSTALL.DPDK.md "DPDK

> vHost

> VM configuration with standard vHost" section, kvm guest cannot DHCPed valid

> ip address,

> actually ifconfig guest_eth0 shows no traffic at all.

>

> Am I using the right qemu version or

> Am I missing something obviously when using qemu-2.3.0?

> Thanks in advance!

>

> OTHER_ARGS="-smp 4 -m 2048 -hda centos7-1.img

>             -netdev

> tap,id=nic1,script=no,downscript=no,ifname=dpdkvhost1,vhost=on \

>             -device virtio-net-pci,netdev=nic1,mac=00:16:3d:22:33:54,\

>             csum=off,gso=off,guest_tso4=off,guest_tso6=off,guest_ecn=off \

>             -mem-path /dev/hugepages -mem-prealloc"

>



I’m guessing you previously tested with qemu <2.0.0. You need to explicitly

share the memory in the command line now. It’s the very last line of this

section:

https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#dpdk-vhost-vm-configuration



>

>

> (1) Use qemu-kvm from https://git.kernel.org/pub/scm/virt/kvm/qemu-kvm.git

> qemu-kvm/x86_64-softmmu/qemu-system-x86_64 $OTHER_ARGS

>

> (2) Use qemu-2.3.0

> qemu-2.3.0/x86_64-softmmu/qemu-system-x86_64 -enable-kvm $OTHER_ARGS

>

> --

> 天下英雄出我辈，一入江湖岁月催。

> 宏图霸业谈笑中，不胜人生一场醉。
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150520/0093f169/attachment-0001.html>

From diproiettod at vmware.com  Wed May 20 08:12:15 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Wed, 20 May 2015 15:12:15 +0000
Subject: [ovs-discuss] For help about ssh between vms through ovs-dkdp
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com>
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>
 <BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com>
Message-ID: <D1825AEA.15DE%diproiettod@vmware.com>


On 20/05/2015 15:21, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:

>
>
>> -----Original Message-----
>
>> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
>
>> Sent: Wednesday, May 20, 2015 1:47 PM
>
>> To: 钢锁0310
>
>> Cc: 通天晓0280; discuss; Traynor, Kevin
>
>> Subject: Re: [ovs-discuss] For help about ssh between vms through
>>ovs-dkdp
>
>> 
>
>> This might be related to offloading features.
>
>> 
>
>> Could you try again with this qemu "-device" option and let us know?
>
>> -device
>
>> 
>>virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off
>>,g
>
>> uest_ecn=off
>
>
>
>I checked this previously and the DPDK vhost lib will report those
>features
>
>as not available during negotiation so you should be ok with not
>specifying
>
>them explicitly in the qemu cmd line. I haven't tested with qemu 2.3.
>
>
>
>> 
>
>> 
>
>> Kevin, do you this we should mention this in INSTALL.DPDk.md?
>
>
>
>I had changed the original patch to make it optional in 3a based on
>feedback
>
>from Michael Tsirkin and testing. So unless we find an issue, I'd prefer
>to
>
>leave optional. 
>
>https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswitc
>h_ovs_blob_master_INSTALL.DPDK.md-23dpdk-2Dvhost-2Dvm-2Dconfiguration&d=Aw
>IGoQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_C
>w5yUNjxgD4v5kJqZ2uWLlE&m=iM-aCjDqF2zfP98Zeafj9Z78WnCYvkzPSyZeV1kVGWg&s=SOm
>_egKoAfzUwWioueTrQ9W2sa_WSUwKC74LO5SNvWs&e=
>

If I don't add the extra options, my guests (Debian wheezy kernel 3.2 and
Ubuntu 14.04 kernel 3.13, running on QEMU 2.1.3) see these features

# ethtool -k eth0

Features for eth0:
                                                rx-checksumming: off
[fixed]
                                                tx-checksumming: on
        tx-checksum-ipv4: off [fixed]
        tx-checksum-unneeded: off [fixed]
        tx-checksum-ip-generic: on
        tx-checksum-ipv6: off [fixed]
        tx-checksum-fcoe-crc: off [fixed]
        tx-checksum-sctp: off [fixed]
                                                scatter-gather: on
        tx-scatter-gather: on
        tx-scatter-gather-fraglist: on
                                                tcp-segmentation-offload:
on
        tx-tcp-segmentation: on
        tx-tcp-ecn-segmentation: on
        tx-tcp6-segmentation: on
                                                udp-fragmentation-offload:
on
                   
generic-segmentation-offload: on
                                                generic-receive-offload: on
                                                large-receive-offload: off
[fixed]
[...]


Pings work, but everything else (e.g. DNS lookups) doesn't.
To fix the setup I have either to add the extra options or to disable the
offloads (inside the guest) with

  ethtool -K eth0 tx off


From ashalimov at arccn.ru  Wed May 20 14:21:08 2015
From: ashalimov at arccn.ru (Alexander Shalimov)
Date: Thu, 21 May 2015 00:21:08 +0300
Subject: [ovs-discuss] change default table-miss behavior
Message-ID: <555CFAC4.7030002@arccn.ru>

Hi all,

The latest OVS drops all packets that don't match a flow. Is it possible 
to change this behavior back to packet_in to the OpenFlow controller? 
Any options?

One issues for us is if we add the rule 
"priority=0,actions=output:CONTROLLER", we receive packet_in with reason 
"to_controller", not "table miss".

Thanks!

-- 
С уважением, |  Sincerely,
Александр.   |  Alexander.


From blp at nicira.com  Wed May 20 15:49:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 20 May 2015 15:49:51 -0700
Subject: [ovs-discuss] change default table-miss behavior
In-Reply-To: <555CFAC4.7030002@arccn.ru>
References: <555CFAC4.7030002@arccn.ru>
Message-ID: <20150520224951.GA2525@nicira.com>

On Thu, May 21, 2015 at 12:21:08AM +0300, Alexander Shalimov wrote:
> The latest OVS drops all packets that don't match a flow. Is it possible to
> change this behavior back to packet_in to the OpenFlow controller? Any
> options?

What version of OpenFlow are you using?  The defaults are different for
OpenFlow 1.0 and 1.3.  If you're using OpenFlow 1.3, then you can get
packet-ins by default by requesting that through the table configuration
using an OpenFlow "table_mod" message.

From blp at nicira.com  Wed May 20 16:43:49 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 20 May 2015 16:43:49 -0700
Subject: [ovs-discuss] openflow 1.3 flow mod with experimenter match
In-Reply-To: <D180F1E5.28512%davidjoshuaevans@gmail.com>
References: <D180F1E5.28512%davidjoshuaevans@gmail.com>
Message-ID: <20150520234349.GB2525@nicira.com>

On Tue, May 19, 2015 at 01:57:57PM -0500, David Evans wrote:
> I¹d like to implement a custom match on my  custom ether_type,  custom layer
> 2.5 value (not VLAN/MPLS etc.)
> I understand that I need to modify at least:
> * match.c with match_set* functions and add to the flow¹ struct my foomatch
> variable. 
> * Meta-flow.c with all the behaviors I need to MFF_FOOMATCH_TYPE required
> for my functions in match.c
> *  OXM_CLASSES needs a vendor to match my controller in the
> extract-ofp-fields py script  for translation functions
> * in ofp-util.c I need a handler for OFPTFPT13_EXPERIMENTER, but what to add
> I have no idea other than it should look something like parse_oxms.
> 
> How do I connect up to openflow messaging to implement flow mod with an
> experimenter match ?

Just follow the example set by another commit that adds support for a
new experimenter match.  The most recent example is commit ac6073e3cda
(ofproto: Add NXM_NX_TUN_GBP_ID and NXM_NX_TUN_GBP_FLAGS).

From liw at dtdream.com  Wed May 20 19:55:17 2015
From: liw at dtdream.com (=?UTF-8?B?6ZKi6ZSBMDMxMA==?=)
Date: Thu, 21 May 2015 10:55:17 +0800
Subject: [ovs-discuss] =?utf-8?b?562U5aSN77yaIEZvciBoZWxwIGFib3V0IHNzaCBi?=
 =?utf-8?q?etween_vms_through_ovs-dkdp?=
In-Reply-To: D1825AEA.15DE%diproiettod@vmware.com
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>
 <BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com>,
 D1825AEA.15DE%diproiettod@vmware.com
Message-ID: <5c91106b-ea3c-412b-822b-48860a3498fc@dtdream.com>

i add the options 'csum=off,gso=off,guest_tso4=off,guest_tso6=off,guest_ecn=off'
on my guesttx-checksumming: off   that is ok
but 
rx-chechsumming:on [fixed]   it can not to be changed!
Is there some way to be change the 'fixed'?

*********************RTFSC*********************------------------------------------------------------------------发件人：Daniele Di Proietto <diproiettod at vmware.com>发送时间：2015年5月20日(星期三) 23:12收件人：Traynor, Kevin <kevin.traynor at intel.com>抄　送：通天晓0280 <dongj at dtdream.com>，discuss <discuss at openvswitch.org>，钢锁0310 <liw at dtdream.com>主　题：Re: [ovs-discuss] For help about ssh between vms through ovs-dkdpOn 20/05/2015 15:21, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:>>>> -----Original Message----->>> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]>>> Sent: Wednesday, May 20, 2015 1:47 PM>>> To: 钢锁0310>>> Cc: 通天晓0280; discuss; Traynor, Kevin>>> Subject: Re: [ovs-discuss] For help about ssh between vms through>>ovs-dkdp>>> >>> This might be related to offloading features.>>> >>> Could you try again with this qemu "-device" option and let us know?>>> -device>>> >>virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off>>,g>>> uest_ecn=off>>>>I checked this previously and the DPDK vhost lib will report those>features>>as not available during negotiation so you should be ok with not>specifying>>them explicitly in the qemu cmd line. I haven't tested with qemu 2.3.>>>>> >>> >>> Kevin, do you this we should mention this in INSTALL.DPDk.md?>>>>I had changed the original patch to make it optional in 3a based on>feedback>>from Michael Tsirkin and testing. So unless we find an issue, I'd prefer>to>>leave optional. >>https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswitc>h_ovs_blob_master_INSTALL.DPDK.md-23dpdk-2Dvhost-2Dvm-2Dconfiguration&d=Aw>IGoQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_C>w5yUNjxgD4v5kJqZ2uWLlE&m=iM-aCjDqF2zfP98Zeafj9Z78WnCYvkzPSyZeV1kVGWg&s=SOm>_egKoAfzUwWioueTrQ9W2sa_WSUwKC74LO5SNvWs&e=>If I don't add the extra options, my guests (Debian wheezy kernel 3.2 andUbuntu 14.04 kernel 3.13, running on QEMU 2.1.3) see these features# ethtool -k eth0Features for eth0:                                                rx-checksumming: off[fixed]                                                tx-checksumming: on        tx-checksum-ipv4: off [fixed]        tx-checksum-unneeded: off [fixed]        tx-checksum-ip-generic: on        tx-checksum-ipv6: off [fixed]        tx-checksum-fcoe-crc: off [fixed]        tx-checksum-sctp: off [fixed]                                                scatter-gather: on        tx-scatter-gather: on        tx-scatter-gather-fraglist: on                                                tcp-segmentation-offload:on        tx-tcp-segmentation: on        tx-tcp-ecn-segmentation: on        tx-tcp6-segmentation: on                                                udp-fragmentation-offload:on                   generic-segmentation-offload: on                                                generic-receive-offload: on                                                large-receive-offload: off[fixed][...]Pings work, but everything else (e.g. DNS lookups) doesn't.To fix the setup I have either to add the extra options or to disable theoffloads (inside the guest) with  ethtool -K eth0 tx off
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150521/80eef79f/attachment-0001.html>

From liw at dtdream.com  Wed May 20 22:07:13 2015
From: liw at dtdream.com (=?UTF-8?B?6ZKi6ZSBMDMxMA==?=)
Date: Thu, 21 May 2015 13:07:13 +0800
Subject: [ovs-discuss] =?utf-8?b?562U5aSN77yaIEZvciBoZWxwIGFib3V0IHNzaCBi?=
 =?utf-8?q?etween_vms_through_ovs-dkdp?=
In-Reply-To: BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>,
 BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com
Message-ID: <b9c723b0-b032-48cf-adcc-2f83ba3376f4@dtdream.com>

ovs log:2015-05-21T04:46:37.941Z|00023|connmgr|INFO|br0<->unix: 1 flow_mods in the last 0 s (1 adds)
2015-05-21T04:46:38.604Z|00024|connmgr|INFO|br0<->unix: 1 flow_mods in the last 0 s (1 adds)
2015-05-21T04:48:42.692Z|00001|dpdk(cuse_thread3)|INFO|vHost Device 'tap0' (0) has been added
2015-05-21T04:48:51.750Z|00002|dpdk(cuse_thread3)|INFO|vHost Device 'tap1' (1) has been added

qemu create tap with default name 'tap[id]'         adding port to ovs is ok    ping is work
and i add options 'csum=off,gso=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=off'
in guset   
ethtool -k eth0


all things is off but     
ssh is still not work    
qemu 2.3.0dpdk 2.0.0ovs   compiled by git master
the OS of host and guest both are  'Linux 25.dpdk 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux'
*********************RTFSC*********************------------------------------------------------------------------发件人：Traynor, Kevin <kevin.traynor at intel.com>发送时间：2015年5月20日(星期三) 22:21收件人：Daniele Di Proietto <diproiettod at vmware.com>，钢锁0310 <liw at dtdream.com>抄　送：通天晓0280 <dongj at dtdream.com>，discuss <discuss at openvswitch.org>主　题：RE: [ovs-discuss] For help about ssh between vms through ovs-dkdp> -----Original Message-----> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]> Sent: Wednesday, May 20, 2015 1:47 PM> To: 钢锁0310> Cc: 通天晓0280; discuss; Traynor, Kevin> Subject: Re: [ovs-discuss] For help about ssh between vms through ovs-dkdp> > This might be related to offloading features.> > Could you try again with this qemu "-device" option and let us know?> -device> virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off,g> uest_ecn=offI checked this previously and the DPDK vhost lib will report those featuresas not available during negotiation so you should be ok with not specifyingthem explicitly in the qemu cmd line. I haven't tested with qemu 2.3.> > > Kevin, do you this we should mention this in INSTALL.DPDk.md?I had changed the original patch to make it optional in 3a based on feedbackfrom Michael Tsirkin and testing. So unless we find an issue, I'd prefer toleave optional. https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#dpdk-vhost-vm-configuration> > > On 20/05/2015 10:39, "钢锁0310" <liw at dtdream.com> wrote:> > >i build the vm-ovsdpdk-vm environment by using vhost-cuse> >> >> >the cmd is following> >> >> >ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev> >ovs-vsctl add-port br0 tap0 -- set Interface tap0 type=dpdkvhost> >ovs-vsctl add-port br0 tap1 -- set Interface tap1 type=dpdkvhost> >> >qemu-system-x86_64 cirros.img -m 2G -vnc :1 -object> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa> >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on> >-device virtio-net-pci,netdev=net1> >qemu-system-x86_64 cirros.img -m 2G -vnc :2 -object> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa> >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on> >-device virtio-net-pci,netdev=net1You are not specifying the ifname on the command line. What does thevswitchd.log say regarding the adding/removing of vhost ports?e.g. |INFO|vHost Device 'dpdkvhost1' (1) has been added> >> ># add ovs flow> >ovs-ofctl add-flow br0 in_port=1,action:output=2> >ovs-ofctl add-flow br0 in_port=2,action:output=1> >> >> >mac of vm1 is 00:00:00:00:00:01   vm2 is 00:00:00:00:00:02> >> >> >ping form vm1 to vm2 is ok, but ssh is not ok> >> >> >On vm1 run ssh to vm2,   Run tcpdump on vm2,  the catching packet as> >follow> >> >> >> >it seems the packets is all wrong> >> >> >Anyone meet this situation?What kernel version are you using in the guest? There is a known DPDK issuewith 3.19.5 in the guest when using the kernel to fwd pkts. The fix for itis here: http://dpdk.org/ml/archives/dev/2015-May/017251.html> >> >> >*********************> >RTFSC> >*********************> >> >> >
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150521/0f744dfa/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: temp4cj.png
Type: application/octet-stream
Size: 2277 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150521/0f744dfa/attachment.obj>

From gowrishankar.m at linux.vnet.ibm.com  Wed May 20 22:53:18 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Thu, 21 May 2015 11:23:18 +0530
Subject: [ovs-discuss]
 =?utf-8?b?562U5aSN77yaIEZvciBoZWxwIGFib3V0IHNzaCBi?=
 =?utf-8?q?etween_vms_through_ovs-dkdp?=
In-Reply-To: <b9c723b0-b032-48cf-adcc-2f83ba3376f4@dtdream.com>
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>,
 BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com
 <b9c723b0-b032-48cf-adcc-2f83ba3376f4@dtdream.com>
Message-ID: <555D72CE.8030203@linux.vnet.ibm.com>

tcpdump from host on guest's vnic could help ? See if 3way handshake 
completes.

Also, check if csum correct on packets from guest (tcpdump -vvv).

Regards,
Gowrishankar

On Thursday 21 May 2015 10:37 AM, 钢锁0310 wrote:
>
> ovs log:
>
> 2015-05-21T04:46:37.941Z|00023|connmgr|INFO|br0<->unix: 1 flow_mods in the last 0 s (1 adds)
> 2015-05-21T04:46:38.604Z|00024|connmgr|INFO|br0<->unix: 1 flow_mods in the last 0 s (1 adds)
> 2015-05-21T04:48:42.692Z|00001|dpdk(cuse_thread3)|INFO|vHost Device 'tap0' (0) has been added
> 2015-05-21T04:48:51.750Z|00002|dpdk(cuse_thread3)|INFO|vHost Device 'tap1' (1) has been added
>
>
> qemu create tap with default name 'tap[id]'       adding port to ovs 
> is ok    ping is work
>
>
> and i add options 
> 'csum=off,gso=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=off'
>
>
> in guset ethtool -k eth0
>
>
> all things is off but
>
>
> ssh is still not work
>
>
> qemu 2.3.0
>
> dpdk 2.0.0
>
> ovs   compiled by git master
>
>
> the OS of host and guest both are 
>  'Linux 25.dpdk 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux'
>
>
> *********************
>
> RTFSC
>
> *********************
>
>
>     ------------------------------------------------------------------
>
>     发件人：Traynor, Kevin <kevin.traynor at intel.com>
>
>     发送时间：2015年5月20日(星期三) 22:21
>
>     收件人：Daniele Di Proietto <diproiettod at vmware.com>，钢锁0310
>     <liw at dtdream.com>
>
>     抄　送：通天晓0280 <dongj at dtdream.com>，discuss
>     <discuss at openvswitch.org>
>
>     主　题：RE: [ovs-discuss] For help about ssh between vms through
>     ovs-dkdp
>
>
>
>     > -----Original Message-----
>
>     > From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
>
>     > Sent: Wednesday, May 20, 2015 1:47 PM
>
>     > To: 钢锁0310
>
>     > Cc: 通天晓 0280; discuss; Traynor, Kevin
>
>     > Subject: Re: [ovs-discuss] For help about ssh between vms through ovs-dkdp
>
>     >
>
>     > This might be related to offloading features.
>
>     >
>
>     > Could you try again with this qemu "-device" option and let us know?
>
>     > -device
>
>     > virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off,g
>
>     > uest_ecn=off
>
>
>     I checked this previously and the DPDK vhost lib will report those features
>
>     as not available during negotiation so you should be ok with not specifying
>
>     them explicitly in the qemu cmd line. I haven't tested with qemu 2.3.
>
>
>     >
>
>     >
>
>     > Kevin, do you this we should mention this in INSTALL.DPDk.md?
>
>
>     I had changed the original patch to make it optional in 3a based on feedback
>
>     from Michael Tsirkin and testing. So unless we find an issue, I'd prefer to
>
>     leave optional.
>
>     https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#dpdk-vhost-vm-configuration
>
>
>     >
>
>     >
>
>     > On 20/05 /2015 10:39, "钢锁0310" <liw at dtdream.com> wrote:
>
>     >
>
>     > >i build the vm-ovsdpdk-vm environment by using vhost-cuse
>
>     > >
>
>     > >
>
>     > >the cmd is following
>
>     > >
>
>     > >
>
>     > >ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
>
>     > >ovs-vsctl add-port br0 tap0 -- set Interface tap0 type=dpdkvhost
>
>     > >ovs-vsctl add-port br0 tap1 -- set Interface tap1 type=dpdkvhost
>
>     > >
>
>     > >qemu-system-x86_64 cirros.img -m 2G -vnc :1 -object
>
>     > >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa
>
>     > >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on
>
>     > >-device virtio-net-pci,netdev=net1
>
>     > >qemu-system-x86_64 cirros.img -m 2G -vnc :2 -object
>
>     > >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa
>
>     > >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on
>
>     > >-device virtio-net-pci,netdev=net1
>
>
>     You are not specifying the ifname on the command line. What does the
>
>     vswitchd.log say regarding the adding/removing of vhost ports?
>
>     e.g. |INFO|vHost Device 'dpdkvhost1' (1) has been added
>
>
>     > >
>
>     > ># add ovs flow
>
>     > >ovs-ofctl add-flow br0 in_port=1,action:output=2
>
>     > >ovs-ofctl add-flow br0 in_port=2,action:output=1
>
>     > >
>
>     > >
>
>     > >mac of vm1 is 00:00:00:00:00:01   vm2 is 00:00:00:00:00:02
>
>     > >
>
>     > >
>
>     > >ping form vm1 to vm2 is ok, but ssh is not ok
>
>     > >
>
>     > >
>
>     > >On vm1 run ssh to vm2,   Run tcpdump on vm2,  the catching packet as
>
>     > >follow
>
>     > >
>
>     > >
>
>     > >
>
>     > >it seems the packets is all wrong
>
>     > >
>
>     > >
>
>     > >Anyone meet this situation?
>
>
>     What kernel version are you using in the guest? There is a known DPDK issue
>
>     with 3.19.5 in the guest when using the kernel to fwd pkts. The fix for it
>
>     is here: http://dpdk.org/ml/archives/dev/2015-May/017251.html
>
>
>     > >
>
>     > >
>
>     > >*********************
>
>     > >RTFSC
>
>     > >*********************
>
>     > >
>
>     > >
>
>     > >
>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150521/fb843c41/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 2277 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150521/fb843c41/attachment-0001.png>

From liw at dtdream.com  Wed May 20 23:47:46 2015
From: liw at dtdream.com (=?UTF-8?B?6ZKi6ZSBMDMxMA==?=)
Date: Thu, 21 May 2015 14:47:46 +0800
Subject: [ovs-discuss] =?utf-8?b?562U5aSN77ya562U5aSN77ya562U5aSN77yaIA==?=
 =?utf-8?b?562U5aSN77yaIEZvciBoZWxwIGFib3V0IHNzaCBiZXR3ZWVuIHZtcyB0aHJv?=
 =?utf-8?q?ugh_ovs-dkdp?=
In-Reply-To: 555D7A2C.7060901@linux.vnet.ibm.com
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>,
 BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com
 <b9c723b0-b032-48cf-adcc-2f83ba3376f4@dtdream.com>,
 555D72CE.8030203@linux.vnet.ibm.com
 <8400ab49-856a-4562-a6ea-bab10cac7c47@dtdream.com>,
 555D7641.9020808@linux.vnet.ibm.com
 <7a83258c-ba18-4647-bc1e-9d8c43376ae4@dtdream.com>,
 555D7A2C.7060901@linux.vnet.ibm.com
Message-ID: <f3dfc212-0182-47ba-ad48-28a6a40ee040@dtdream.com>

sorry  my fault  
tap0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet6 fe80::c469:e6ff:fe78:d30f  prefixlen 64  scopeid 0x20<link>
        ether c6:69:e6:78:d3:0f  txqueuelen 500  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

tap1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet6 fe80::3c73:6cff:fe7a:49c3  prefixlen 64  scopeid 0x20<link>
        ether 3e:73:6c:7a:49:c3  txqueuelen 500  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

no packet stat  in tap0 and tap1    neither to tcpdump -vvv -ni tap0
but ping is work
[root at 25 ~]# ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=536.513s, table=0, n_packets=207, n_bytes=18734, idle_age=0, in_port=1 actions=output:2
 cookie=0x0, duration=536.512s, table=0, n_packets=200, n_bytes=18440, idle_age=0, in_port=2 actions=output:1
 cookie=0x0, duration=551.217s, table=0, n_packets=8, n_bytes=648, idle_age=434, priority=0 actions=NORMAL
[root at 25 ~]# ovs-ofctl dump-ports br0
OFPST_PORT reply (xid=0x2): 3 ports
  port LOCAL: rx pkts=8, bytes=648, drop=0, errs=0, frame=0, over=0, crc=0
           tx pkts=0, bytes=0, drop=0, errs=0, coll=0
  port  1: rx pkts=213, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
           tx pkts=214, bytes=?, drop=0, errs=?, coll=?
  port  2: rx pkts=206, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
           tx pkts=199, bytes=?, drop=22, errs=?, coll=?

the stat of ovs is ok
*********************RTFSC*********************------------------------------------------------------------------发件人：gowrishankar <gowrishankar.m at linux.vnet.ibm.com>发送时间：2015年5月21日(星期四) 14:26收件人：钢锁0310 <liw at dtdream.com>主　题：Re: 答复：答复：[ovs-discuss] 答复： For help about ssh between vms through ovs-dkdpI think this is same as what you shared
      earlier in ML i.e captured from inside VM2.
      Or correct me if I am wrong.
      I wanted to see running tcpdump -vvv -ni vnet0 from host (for eg,
      vnet0 is vnic of guest VM1
      and connected to your ovs-dpdk switch as I hope).
      Could that be possible. You may please include ML in CC as well,
      if others also could help if some more
      traces there this time.
      Regards,
      Gowrishankar
      On Thursday 21 May 2015 11:43 AM, 钢锁0310 wrote:
        

        
          
        the screen picture  above
        
          
        *********************
        RTFSC
        *********************
        
          
        ------------------------------------------------------------------发件人：gowrishankar
              <gowrishankar.m at linux.vnet.ibm.com>发送时间：2015年5月21日(星期四) 14:08收件人：钢锁0310 <liw at dtdream.com>主　题：Re: 答复：[ovs-discuss] 答复： For help about
              ssh between vms through ovs-dkdp
            May be, you could share
            tcpdump -vvv for us to infer anything else (from host).
           Regards, Gowrishankar
           On Thursday 21 May 2015
            11:31 AM, 钢锁0310 wrote:
              the tcp state on vm
                which run ssh is SYNSEND
              
              
              VMs`csum is off
              
              
              the target vm catch
                wrong packet still    
              
              
              *********************
              RTFSC
              *********************
              
              
              ------------------------------------------------------------------发件人：gowrishankar <gowrishankar.m at linux.vnet.ibm.com>发送时间：2015年5月21日(星期
                  四) 13:55收件人：钢锁0310 <liw at dtdream.com>抄　送：discuss <discuss at openvswitch.org>主　题：Re:
                  [ovs-discuss] 答复： For help about ssh between vms
                  through ovs-dkdp
                tcpdump from host
                  on guest's vnic could help ? See if 3way handshake
                  completes.
                 Also, check if
                  csum correct on packets from guest (tcpdump -vvv).
                 Regards, Gowrishankar
                 On Thursday 21 May
                  2015 10:37 AM, 钢锁0310 wrote:
                    ovs log:
                    2015-05-21T04:46:37.941Z|00023|connmgr|INFO|br0<->unix: 1 flow_mods in the last 0 s (1 adds)
2015-05-21T04:46:38.604Z|00024|connmgr|INFO|br0<->unix: 1 flow_mods in the last 0 s (1 adds)
2015-05-21T04:48:42.692Z|00001|dpdk(cuse_thread3)|INFO|vHost Device 'tap0' (0) has been added
2015-05-21T04:48:51.750Z|00002|dpdk(cuse_thread3)|INFO|vHost Device 'tap1' (1) has been added
                    
                    
                    
                    qemu create tap
                      with default name 'tap[id]'         adding port to
                      ovs is ok    ping is work
                    
                    
                    and i add
                      options
'csum=off,gso=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=off'
                    
                    
                    in guset    ethtool -k eth0
                    
                    
                    
                    all things is
                      off but     
                    
                    
                    ssh is still
                      not work    
                    
                    
                    qemu 2.3.0
                    dpdk 2.0.0
                    ovs   compiled
                      by git master
                    
                    
                    the OS of host
                      and guest both are
 'Linux 25.dpdk 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux'
                    
                    
                    *********************
                    RTFSC
                    *********************
                    
                    
                    ------------------------------------------------------------------发件人：Traynor,
                        Kevin <kevin.traynor at intel.com>发送时间：2015年5月
                        20日(星期 三) 22:21收件人：Daniele
                        Di Proietto <diproiettod at vmware.com>，
                        钢锁0310 <liw at dtdream.com>抄　送：通天晓0280 <dongj at dtdream.com>，discuss
                        <discuss at openvswitch.org>主　题：RE:
                        [ovs-discuss] For help about ssh between vms
                        through ovs-dkdp
                      
                      > -----Original Message-----> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]> Sent: Wednesday, May 20, 2015 1:47 PM> To: 钢锁
                        0310> Cc: 通天晓
                        0280; discuss; Traynor, Kevin> Subject: Re: [ovs-discuss] For help about ssh between vms through ovs-dkdp> > This might be related to offloading features.> > Could you try again with this qemu "-device" option and let us know?> -device> virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off,g> uest_ecn=off
                      I checked this previously and the DPDK vhost lib will report those featuresas not available during negotiation so you should be ok with not specifyingthem explicitly in the qemu cmd line. I haven't tested with qemu 2.3.
                      > > > Kevin, do you this we should mention this in INSTALL.DPDk.md?
                      I had changed the original patch to make it optional in 3a based on feedbackfrom Michael Tsirkin and testing. So unless we find an issue, I'd prefer toleave optional. https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#dpdk-vhost-vm-configuration
                      > > > On 20/05
                        /2015 10:39, "钢锁0310" <liw at dtdream.com> wrote:> > >i build the vm-ovsdpdk-vm environment by using vhost-cuse> >> >> >the cmd is following> >> >> >ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev> >ovs-vsctl add-port br0 tap0 -- set Interface tap0 type=dpdkvhost> >ovs-vsctl add-port br0 tap1 -- set Interface tap1 type=dpdkvhost> >> >qemu-system-x86_64 cirros.img -m 2G -vnc :1 -object> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa> >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on> >-device virtio-net-pci,netdev=net1> >qemu-system-x86_64 cirros.img -m 2G -vnc :2 -object> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa> >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on> >-device virtio-net-pci,netdev=net1
                      You are not specifying the ifname on the command line. What does thevswitchd.log say regarding the adding/removing of vhost ports?e.g. |INFO|vHost Device 'dpdkvhost1' (1) has been added
                      > >> ># add ovs flow> >ovs-ofctl add-flow br0 in_port=1,action:output=2> >ovs-ofctl add-flow br0 in_port=2,action:output=1> >> >> >mac of vm1 is 00:00:00:00:00:01   vm2 is 00:00:00:00:00:02> >> >> >ping form vm1 to vm2 is ok, but ssh is not ok> >> >> >On vm1 run ssh to vm2,   Run tcpdump on vm2,  the catching packet as> >follow> >> >> >> >it seems the packets is all wrong> >> >> >Anyone meet this situation?
                      What kernel version are you using in the guest? There is a known DPDK issuewith 3.19.5 in the guest when using the kernel to fwd pkts. The fix for itis here: http://dpdk.org/ml/archives/dev/2015-May/017251.html
                      > >> >> >*********************> >RTFSC> >*********************> >> >> >
                      
                  
                  
                  _______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

                
                
            
          
          -- 
Regards,
Gowrishankar M
Linux Networking
      -- 
Regards,
Gowrishankar M
Linux Networking
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150521/c6058e6e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: att001.png
Type: application/octet-stream
Size: 2277 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150521/c6058e6e/attachment-0001.obj>

From davidjoshuaevans at gmail.com  Thu May 21 07:44:57 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Thu, 21 May 2015 09:44:57 -0500
Subject: [ovs-discuss] openflow 1.3 flow mod with experimenter match
In-Reply-To: <20150520234349.GB2525@nicira.com>
References: <D180F1E5.28512%davidjoshuaevans@gmail.com>
 <20150520234349.GB2525@nicira.com>
Message-ID: <D183597F.28644%davidjoshuaevans@gmail.com>

Thanks Ben!

On 5/20/15, 6:43 PM, "Ben Pfaff" <blp at nicira.com> wrote:

>On Tue, May 19, 2015 at 01:57:57PM -0500, David Evans wrote:
>> I��d like to implement a custom match on my  custom ether_type,  custom
>>layer
>> 2.5 value (not VLAN/MPLS etc.)
>> I understand that I need to modify at least:
>> * match.c with match_set* functions and add to the �flow�� struct my
>>foomatch
>> variable. 
>> * Meta-flow.c with all the behaviors I need to MFF_FOOMATCH_TYPE
>>required
>> for my functions in match.c
>> *  OXM_CLASSES needs a vendor to match my controller in the
>> extract-ofp-fields py script  for translation functions
>> * in ofp-util.c I need a handler for OFPTFPT13_EXPERIMENTER, but what
>>to add
>> I have no idea other than it should look something like parse_oxms.
>> 
>> How do I connect up to openflow messaging to implement flow mod with an
>> experimenter match ?
>
>Just follow the example set by another commit that adds support for a
>new experimenter match.  The most recent example is commit ac6073e3cda
>(ofproto: Add NXM_NX_TUN_GBP_ID and NXM_NX_TUN_GBP_FLAGS).



From kevin.traynor at intel.com  Thu May 21 07:48:36 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 21 May 2015 14:48:36 +0000
Subject: [ovs-discuss] For help about ssh between vms through ovs-dkdp
In-Reply-To: <D1825AEA.15DE%diproiettod@vmware.com>
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>
 <BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com>
 <D1825AEA.15DE%diproiettod@vmware.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F730757B63@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> Sent: Wednesday, May 20, 2015 4:12 PM
> To: Traynor, Kevin
> Cc: ???0280; discuss; ??0310
> Subject: Re: [ovs-discuss] For help about ssh between vms through ovs-dkdp
> 
> 
> On 20/05/2015 15:21, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:
> 
> >
> >
> >> -----Original Message-----
> >
> >> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> >
> >> Sent: Wednesday, May 20, 2015 1:47 PM
> >
> >> To: 钢锁0310
> >
> >> Cc: 通天晓0280; discuss; Traynor, Kevin
> >
> >> Subject: Re: [ovs-discuss] For help about ssh between vms through
> >>ovs-dkdp
> >
> >>
> >
> >> This might be related to offloading features.
> >
> >>
> >
> >> Could you try again with this qemu "-device" option and let us know?
> >
> >> -device
> >
> >>
> >>virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off
> >>,g
> >
> >> uest_ecn=off
> >
> >
> >
> >I checked this previously and the DPDK vhost lib will report those
> >features
> >
> >as not available during negotiation so you should be ok with not
> >specifying
> >
> >them explicitly in the qemu cmd line. I haven't tested with qemu 2.3.
> >
> >
> >
> >>
> >
> >>
> >
> >> Kevin, do you this we should mention this in INSTALL.DPDk.md?
> >
> >
> >
> >I had changed the original patch to make it optional in 3a based on
> >feedback
> >
> >from Michael Tsirkin and testing. So unless we find an issue, I'd prefer
> >to
> >
> >leave optional.
> >
> >https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswitc
> >h_ovs_blob_master_INSTALL.DPDK.md-23dpdk-2Dvhost-2Dvm-2Dconfiguration&d=Aw
> >IGoQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_C
> >w5yUNjxgD4v5kJqZ2uWLlE&m=iM-aCjDqF2zfP98Zeafj9Z78WnCYvkzPSyZeV1kVGWg&s=SOm
> >_egKoAfzUwWioueTrQ9W2sa_WSUwKC74LO5SNvWs&e=
> >
> 
> If I don't add the extra options, my guests (Debian wheezy kernel 3.2 and
> Ubuntu 14.04 kernel 3.13, running on QEMU 2.1.3) see these features
> 
> # ethtool -k eth0
> 
> Features for eth0:
>                                                 rx-checksumming: off
> [fixed]
>                                                 tx-checksumming: on
>         tx-checksum-ipv4: off [fixed]
>         tx-checksum-unneeded: off [fixed]
>         tx-checksum-ip-generic: on
>         tx-checksum-ipv6: off [fixed]
>         tx-checksum-fcoe-crc: off [fixed]
>         tx-checksum-sctp: off [fixed]
>                                                 scatter-gather: on
>         tx-scatter-gather: on
>         tx-scatter-gather-fraglist: on
>                                                 tcp-segmentation-offload:
> on
>         tx-tcp-segmentation: on
>         tx-tcp-ecn-segmentation: on
>         tx-tcp6-segmentation: on
>                                                 udp-fragmentation-offload:
> on
> 
> generic-segmentation-offload: on
>                                                 generic-receive-offload: on
>                                                 large-receive-offload: off
> [fixed]
> [...]
> 
> 
> Pings work, but everything else (e.g. DNS lookups) doesn't.
> To fix the setup I have either to add the extra options or to disable the
> offloads (inside the guest) with
> 
>   ethtool -K eth0 tx off

I'm seeing that too. I can see that the dpdk vhost is reporting the correct
features it supports:
VHOST_CONFIG: (0) Device configuration started
vhost: get_features() returning: pu=0x0000000000068000

where the bits represent
#define VIRTIO_NET_F_MRG_RXBUF  0x08000 /* Host can merge receive buffers. */
#define VIRTIO_NET_F_CTRL_VQ    0x20000 /* Control channel available */
#define VIRTIO_NET_F_CTRL_RX    0x40000 /* Control channel RX mode support */

and then the negotiation appears to complete correctly when the dpdk vhost
set_features() is called:

vhost: set_features called: pu=0x0000000000008000
2015-05-21T14:08:56Z|00001|dpdk(cuse_thread2)|INFO|vHost Device 'dpdkvhost0' (0) has been added

but it looks like the negotiated features are not being reported or used? 
# ethtool -k eth1
Offload parameters for eth1:
rx-checksumming: off
tx-checksumming: on
scatter-gather: on
tcp-segmentation-offload: on
udp-fragmentation-offload: on
generic-segmentation-offload: on
generic-receive-offload: on
large-receive-offload: off
rx-vlan-offload: off
tx-vlan-offload: off
ntuple-filters: off
receive-hashing: off

Previously when I had tested, I had checked the negotiation but went on to
run a dpdk app in the guest and didn't see this issue. So, I think it may
need to go back into the docs...let me know what you think and I can adjust.



From diproiettod at vmware.com  Thu May 21 08:23:13 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Thu, 21 May 2015 15:23:13 +0000
Subject: [ovs-discuss] For help about ssh between vms through ovs-dkdp
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F730757B63@IRSMSX104.ger.corp.intel.com>
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>
 <BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com>
 <D1825AEA.15DE%diproiettod@vmware.com>
 <BC0FEEC7D7650749874CEC11314A88F730757B63@IRSMSX104.ger.corp.intel.com>
Message-ID: <D183AF76.173B%diproiettod@vmware.com>



On 21/05/2015 15:48, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:

>
>> -----Original Message-----
>> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
>> Sent: Wednesday, May 20, 2015 4:12 PM
>> To: Traynor, Kevin
>> Cc: ???0280; discuss; ??0310
>> Subject: Re: [ovs-discuss] For help about ssh between vms through
>>ovs-dkdp
>> 
>> 
>> On 20/05/2015 15:21, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:
>> 
>> >
>> >
>> >> -----Original Message-----
>> >
>> >> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
>> >
>> >> Sent: Wednesday, May 20, 2015 1:47 PM
>> >
>> >> To: 钢锁0310
>> >
>> >> Cc: 通天晓0280; discuss; Traynor, Kevin
>> >
>> >> Subject: Re: [ovs-discuss] For help about ssh between vms through
>> >>ovs-dkdp
>> >
>> >>
>> >
>> >> This might be related to offloading features.
>> >
>> >>
>> >
>> >> Could you try again with this qemu "-device" option and let us know?
>> >
>> >> -device
>> >
>> >>
>> 
>>>>virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=o
>>>>ff
>> >>,g
>> >
>> >> uest_ecn=off
>> >
>> >
>> >
>> >I checked this previously and the DPDK vhost lib will report those
>> >features
>> >
>> >as not available during negotiation so you should be ok with not
>> >specifying
>> >
>> >them explicitly in the qemu cmd line. I haven't tested with qemu 2.3.
>> >
>> >
>> >
>> >>
>> >
>> >>
>> >
>> >> Kevin, do you this we should mention this in INSTALL.DPDk.md?
>> >
>> >
>> >
>> >I had changed the original patch to make it optional in 3a based on
>> >feedback
>> >
>> >from Michael Tsirkin and testing. So unless we find an issue, I'd
>>prefer
>> >to
>> >
>> >leave optional.
>> >
>> 
>>>https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswi
>>>tc
>> 
>>>h_ovs_blob_master_INSTALL.DPDK.md-23dpdk-2Dvhost-2Dvm-2Dconfiguration&d=
>>>Aw
>> 
>>>IGoQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s
>>>_C
>> 
>>>w5yUNjxgD4v5kJqZ2uWLlE&m=iM-aCjDqF2zfP98Zeafj9Z78WnCYvkzPSyZeV1kVGWg&s=S
>>>Om
>> >_egKoAfzUwWioueTrQ9W2sa_WSUwKC74LO5SNvWs&e=
>> >
>> 
>> If I don't add the extra options, my guests (Debian wheezy kernel 3.2
>>and
>> Ubuntu 14.04 kernel 3.13, running on QEMU 2.1.3) see these features
>> 
>> # ethtool -k eth0
>> 
>> Features for eth0:
>>                                                 rx-checksumming: off
>> [fixed]
>>                                                 tx-checksumming: on
>>         tx-checksum-ipv4: off [fixed]
>>         tx-checksum-unneeded: off [fixed]
>>         tx-checksum-ip-generic: on
>>         tx-checksum-ipv6: off [fixed]
>>         tx-checksum-fcoe-crc: off [fixed]
>>         tx-checksum-sctp: off [fixed]
>>                                                 scatter-gather: on
>>         tx-scatter-gather: on
>>         tx-scatter-gather-fraglist: on
>>                 
>>tcp-segmentation-offload:
>> on
>>         tx-tcp-segmentation: on
>>         tx-tcp-ecn-segmentation: on
>>         tx-tcp6-segmentation: on
>>                 
>>udp-fragmentation-offload:
>> on
>> 
>> generic-segmentation-offload: on
>>                 
>>generic-receive-offload: on
>>                                                 large-receive-offload:
>>off
>> [fixed]
>> [...]
>> 
>> 
>> Pings work, but everything else (e.g. DNS lookups) doesn't.
>> To fix the setup I have either to add the extra options or to disable
>>the
>> offloads (inside the guest) with
>> 
>>   ethtool -K eth0 tx off
>
>I'm seeing that too. I can see that the dpdk vhost is reporting the
>correct
>features it supports:
>VHOST_CONFIG: (0) Device configuration started
>vhost: get_features() returning: pu=0x0000000000068000
>
>where the bits represent
>#define VIRTIO_NET_F_MRG_RXBUF  0x08000 /* Host can merge receive
>buffers. */
>#define VIRTIO_NET_F_CTRL_VQ    0x20000 /* Control channel available */
>#define VIRTIO_NET_F_CTRL_RX    0x40000 /* Control channel RX mode
>support */
>
>and then the negotiation appears to complete correctly when the dpdk vhost
>set_features() is called:
>
>vhost: set_features called: pu=0x0000000000008000
>2015-05-21T14:08:56Z|00001|dpdk(cuse_thread2)|INFO|vHost Device
>'dpdkvhost0' (0) has been added
>
>but it looks like the negotiated features are not being reported or used?
># ethtool -k eth1
>Offload parameters for eth1:
>rx-checksumming: off
>tx-checksumming: on
>scatter-gather: on
>tcp-segmentation-offload: on
>udp-fragmentation-offload: on
>generic-segmentation-offload: on
>generic-receive-offload: on
>large-receive-offload: off
>rx-vlan-offload: off
>tx-vlan-offload: off
>ntuple-filters: off
>receive-hashing: off
>
>Previously when I had tested, I had checked the negotiation but went on to
>run a dpdk app in the guest and didn't see this issue. So, I think it may
>need to go back into the docs...let me know what you think and I can
>adjust.

Thanks for confirming that Kevin,

It appears that qemu only negotiates offloadings with a vhost-user peer.
Looking at qemu(2.3.0) hw/net/vhost_net.c:110 it seems that
`vhost_net_get_features()` will consider disabling offloadings only if
dealing with a `NET_CLIENT_OPTIONS_KIND_VHOST_USER` peer (since vhost-cuse
"emulates" a kernel vhost, our devices will appear as
`NET_CLIENT_OPTIONS_KIND_TAP`).

I don't know why qemu behaves like this (I'm definitely not a QEMU expert),
but I'm sure it has its good reasons.

Unless you want to dig further I suggest we add the extra QEMU options to
INSTALL.DPDK.md.  Vhost-user shouldn't have this problem.

What do you think?

Daniele


From alagalah at gmail.com  Thu May 21 19:19:48 2015
From: alagalah at gmail.com (alagalah)
Date: Thu, 21 May 2015 19:19:48 -0700
Subject: [ovs-discuss] OVSDB way to determine if port is NIC?
Message-ID: <D183E054.16AE8%alagalah@gmail.com>

Is there anyway in OVS 2.3.0 to determine via OVSDB remote manager
connection if a given port is a (physical) NIC?

I have docker containers linked to my OVS instance, as well as a PHY from
the host, and I couldn¹t see anything in the schema to discern them.

Any guidance appreciated.



From hollemanietf at gmail.com  Fri May 15 18:00:31 2015
From: hollemanietf at gmail.com (Keith Holleman)
Date: Fri, 15 May 2015 18:00:31 -0700
Subject: [ovs-discuss] Tunnels with duplicate configuration
Message-ID: <CAEpyMTD_MRpA8=ruzzXc4jeZ8Cvqy+hMq0Vb=v5PKCgPi5Ss1w@mail.gmail.com>

Running OVS 2.3.0 on Ubuntu from a debian package.

I am creating two interfaces that are tunnels with duplicate configuration
as shown below and noticed that this causes some interesting behavior.
Everything appears to work but in reality, only one of the of-ports is able
to send traffic.

ovs-vsctl add-port br0 test1 -- set interface test1 type=gre
options:remote_ip=1.1.1.1 options:local_ip=2.2.2.2 options:key=1234
ovs-vsctl add-port br0 test2 -- set interface test2 type=gre
options:remote_ip=1.1.1.1 options:local_ip=2.2.2.2 options:key=1234

>From the ovs-vswitch.log it has detected the conflict, but allows things to
silently proceed and assigns them both an ofport.

2015-05-16T00:32:35.817Z|01079|bridge|INFO|bridge br0: added interface
test1 on port 10
2015-05-16T00:32:46.026Z|01086|tunnel|WARN|test2: attempting to add tunnel
port with same config as port 'test1' (2.2.2.2->1.1.1.1, key=0x4d2, dp
port=4, pkt mark=0)
2015-05-16T00:32:46.026Z|01087|bridge|INFO|bridge br0: added interface
test2 on port 11

Both ports end up getting marked up and have distinct configured flows
attempting to output to the ports.  The flows are seeing the statistics
increment.  But only which ever tunnel was added first actually sends out
packets on the wire and has statistics shown in the INTERFACE table or in
the "ovs-ofctl dump-ports" output, the second tunnel never sends or has
stats even though flows using it as the output action are incrementing.

Is this expected behavior?  I can argue both ways, but would have though
that if the interface/port is going to be rendered useless, it would be
better to fail at install time rather than dumping a log and letting things
quietly proceed.  Or was the intention to let both
tunnels/interface/ofports work and it's just a bug that only one works?

This is the ending output of the interface state before traffic is passed:

~# ovs-vsctl list INTERFACE test1
_uuid               : f31b95ad-d8dd-43ba-a4a3-2fdbf9bd0627
admin_state         : up
bfd                 : {}
bfd_status          : {}
cfm_fault           : []
cfm_fault_status    : []
cfm_flap_count      : []
cfm_health          : []
cfm_mpid            : []
cfm_remote_mpids    : []
cfm_remote_opstate  : []
duplex              : []
external_ids        : {}
ifindex             : 0
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : 0
link_speed          : []
link_state          : up
mac                 : []
mac_in_use          : "8e:cb:43:d5:77:ef"
mtu                 : []
name                : "test1"
ofport              : 10
ofport_request      : []
options             : {key="1234", local_ip="2.2.2.2", remote_ip="1.1.1.1"}
other_config        : {}
statistics          : {collisions=0, rx_bytes=0, rx_crc_err=0,
rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=0,
tx_bytes=0, tx_dropped=0, tx_errors=0, tx_packets=0}
status              : {tunnel_egress_iface="lan0",
tunnel_egress_iface_carrier=up}
type                : gre

~# ovs-vsctl list INTERFACE test2
_uuid               : dfc254e1-a4f2-41fe-b02b-0a0128af38c2
admin_state         : up
bfd                 : {}
bfd_status          : {}
cfm_fault           : []
cfm_fault_status    : []
cfm_flap_count      : []
cfm_health          : []
cfm_mpid            : []
cfm_remote_mpids    : []
cfm_remote_opstate  : []
duplex              : []
external_ids        : {}
ifindex             : 0
ingress_policing_burst: 0
ingress_policing_rate: 0
lacp_current        : []
link_resets         : 0
link_speed          : []
link_state          : up
mac                 : []
mac_in_use          : "ee:9d:36:18:6a:1d"
mtu                 : []
name                : "test2"
ofport              : 11
ofport_request      : []
options             : {key="1234", local_ip="2.2.2.2", remote_ip="1.1.1.1"}
other_config        : {}
statistics          : {collisions=0, rx_bytes=0, rx_crc_err=0,
rx_dropped=0, rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=0,
tx_bytes=0, tx_dropped=0, tx_errors=0, tx_packets=0}
status              : {tunnel_egress_iface="lan0",
tunnel_egress_iface_carrier=up}
type                : gre
~#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150515/f9cdd287/attachment-0001.html>

From liu923526 at gmail.com  Sun May 17 02:24:42 2015
From: liu923526 at gmail.com (=?UTF-8?B?5YqJ55GL5Yex?=)
Date: Sun, 17 May 2015 17:24:42 +0800
Subject: [ovs-discuss] Check TCP ack seq
Message-ID: <CAHC2dCAz-AqhSp-vKZY-HZeQJJDetUmJMC6ef86n_B+vkqZe3w@mail.gmail.com>

Dear all,
I would like to check tcp ack sequence number.
Using a pointer point to ctx->xin->packet->frame,but the ovs crash when i
sending TCP frame over about 1Mbps.
What's happened?


Regards,
Liu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150517/49d4e8b9/attachment-0001.html>

From yxy12a at sohu.com  Sun May 17 18:31:12 2015
From: yxy12a at sohu.com (yxy12a at sohu.com)
Date: Mon, 18 May 2015 09:31:12 +0800
Subject: [ovs-discuss] one question about odp_util(revalidator23)|ERR|mask
 expected for non-Ethernet II frame
Message-ID: <1431912672.1757d6f3bc8f411fb60b55b04b8631f1.yxy12a@sohu.com>

Hello,<!--[if gte mso 9]>
 <w:WordDocument>
  <w:View>Normal</w:View>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves/>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:DrawingGridVerticalSpacing>7.8 磅</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>ZH-CN</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:EnableOpenTypeKerning/>
   <w:DontFlipMirrorIndents/>
   <w:OverrideTableStyleHps/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
<![endif]-->I am using
openvswitch-2.3.1-1.x86_64 as L2 plugin for openstack neutron, in a new
deployment env, I see a lot of error log from openvswitch. Does anyone can help <!--[if gte mso 9]>
 <w:WordDocument>
  <w:View>Normal</w:View>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves/>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:DrawingGridVerticalSpacing>7.8 磅</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>ZH-CN</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:EnableOpenTypeKerning/>
   <w:DontFlipMirrorIndents/>
   <w:OverrideTableStyleHps/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
<![endif]-->to
explain why this error happens, and what to do to avoid such error?
Thanks in advance.

<!--[if gte mso 9]>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
<![endif]--><!--[if gte mso 10]>

 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:普通表格;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}

<![endif]--><!--[if gte mso 9]>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
<![endif]--><!--[if gte mso 10]>

 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:普通表格;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}

<![endif]-->-------------------------------------------------------------------------------<!--[if gte mso 9]>
 <w:WordDocument>
  <w:View>Normal</w:View>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves/>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:DrawingGridVerticalSpacing>7.8 磅</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>ZH-CN</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:AdjustLineHeightInTable/>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:EnableOpenTypeKerning/>
   <w:DontFlipMirrorIndents/>
   <w:OverrideTableStyleHps/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
<![endif]-->

Env: Linux 2.6.32-431.11.2.el6.toa.2.x86_64
(CentOS release 6.5 (Final)

Error log:

May 15 14:51:29 n135026 ovs-vswitchd:
ovs|18342|odp_util(revalidator23)|ERR|Dropped 134 log messages in last 49
seconds (most recently, 3 seconds ago) due to excessive rate

May 15 14:51:29 n135026 ovs-vswitchd:
ovs|18343|odp_util(revalidator23)|ERR|mask expected for non-Ethernet II frame

May 15 14:52:34 n135026 ovs-vswitchd:
ovs|18344|odp_util(revalidator23)|ERR|Dropped 110 log messages in last 65
seconds (most recently, 12 seconds ago) due to excessive rate

May 15 14:52:34 n135026 ovs-vswitchd:
ovs|18345|odp_util(revalidator23)|ERR|mask expected for non-Ethernet II frame

May 15 14:53:29 n135026 ovs-vswitchd:
ovs|18346|odp_util(revalidator23)|ERR|Dropped 122 log messages in last 55
seconds (most recently, 9 seconds ago) due to excessive rate

May 15 14:53:29 n135026 ovs-vswitchd:
ovs|18347|odp_util(revalidator23)|ERR|mask expected for non-Ethernet II frame

May 15 14:54:40 n135026 ovs-vswitchd:
ovs|18348|odp_util(revalidator23)|ERR|Dropped 130 log messages in last 70
seconds (most recently, 11 seconds ago) due to excessive rate---------------------------------------------------------------------------------Best Regards,Yang Xiyu

<!--[if gte mso 9]>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
<![endif]--><!--[if gte mso 10]>

 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:普通表格;
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}

<![endif]-->
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150518/11c3be1e/attachment-0001.html>

From ddesimon at cisco.com  Mon May 18 06:51:54 2015
From: ddesimon at cisco.com (Dave DeSimone (ddesimon))
Date: Mon, 18 May 2015 13:51:54 +0000
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <20150515233429.GC14637@nicira.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
 <D17B5F0A.18A276%ddesimon@cisco.com> <20150515181031.GA14637@nicira.com>
 <D17BB16E.18A33F%ddesimon@cisco.com> <20150515233429.GC14637@nicira.com>
Message-ID: <D17F667F.18A5FB%ddesimon@cisco.com>

I need to investigate this as I¹m not familiar with OpenFlow.
Is this the only option?
Thank you.

On 5/15/15, 7:34 PM, "Ben Pfaff" <blp at nicira.com> wrote:

>On Fri, May 15, 2015 at 07:19:51PM +0000, Dave DeSimone (ddesimon) wrote:
>> Thanks for the quick reply!
>> 
>> Ok. How do I get the lldp packets through ovs to the lldp process?
>
>One common way is to implement lldp as an OpenFlow controller and
>direct packets to it with "controller" actions that send OpenFlow
>"packet-in" messages to the controller.


From bly454 at gmail.com  Mon May 18 11:24:08 2015
From: bly454 at gmail.com (Mike Bly)
Date: Mon, 18 May 2015 11:24:08 -0700
Subject: [ovs-discuss] EPL/EVPL support in OVS?
Message-ID: <CAB3eHOz3StU+2n=_=whH=vjF7kGfLaw=vsU97nd7B83Pd2xN_g@mail.gmail.com>

Does anyone have an example configuration that would show how to provide an
Ethernet Private Line (EPL) service using and OVS vSwitch? What about EVPL?
Each time I add a VLAN to a port trunk list, its associated traffic gets
bridged in a separate VLAN/MAC table entry.

EPL references:
http://en.wikipedia.org/wiki/Ethernet_Private_Line

-Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150518/6c973c59/attachment-0001.html>

From bly454 at gmail.com  Mon May 18 13:19:38 2015
From: bly454 at gmail.com (Mike Bly)
Date: Mon, 18 May 2015 13:19:38 -0700
Subject: [ovs-discuss]  EPL/EVPL support in OVS?
Message-ID: <CAB3eHOzsyC+31uKVdiqvco+f+ySc_ePs6Jom51MQRKZJUitw5Q@mail.gmail.com>

Does anyone have an example configuration that would show how to provide an
Ethernet Private Line (EPL) service using and OVS vSwitch? What about EVPL?
Each time I add a VLAN to a port trunk list, its associated traffic gets
bridged in a separate VLAN/MAC table entry.

EPL references:
http://en.wikipedia.org/wiki/Ethernet_Private_Line

-Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150518/79fde1b2/attachment-0001.html>

From yangwanli at jd.com  Tue May 19 03:32:03 2015
From: yangwanli at jd.com (yangwanli)
Date: Tue, 19 May 2015 18:32:03 +0800
Subject: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll interval
	(365882ms user, 464906ms system)
Message-ID: <2015051918320317100434@jd.com>

Hi, 
I'm a cloud computing R&D engineer. Use OVS as virtual switch, all virtual machines and containers communicate with OVS.
I use OVS  VLAN.
OpenvSwitch Version 2.3.1  (nothing change)
CentOS 6.6
In the process of I use, encounter the flowing problems.
Need your help!
1、ovs-vswitchd.log always report warnings:
2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll interval (365882ms user, 464906ms system)
2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142 voluntary, 2080 involuntary
2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of duplicate event coverage for hash=35d02982
2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll interval (380306ms user, 483259ms system)
2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734 voluntary, 2174 involuntary
2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of duplicate event coverage for hash=35d02982

2、I also encounter this problem:
    when I execute 
    ovs-ofctl dump-flows br-int 
   not always reponse,  but ovs-vsctl show is OK!

Thanks!
WanLi Yang




WanLi Yang
JD.COM 
*****************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150519/27a6868b/attachment-0001.html>

From seanmccully at gmail.com  Wed May 20 12:56:19 2015
From: seanmccully at gmail.com (Sean McCully)
Date: Wed, 20 May 2015 15:56:19 -0400
Subject: [ovs-discuss] OVS [vlan] Fake Bridge
Message-ID: <CAB-ezPFwUUD7fJB9rNXadHEG4Xpy8JggOXeE_fYeRjdYtin12Q@mail.gmail.com>

I am having a problem configuring open vswitch with my vlan configuration,
I am running Ubuntu 15.04 (3.16.0-37).


The following with ip/kernel configuration works,

$ ip link add link eth1 name eth1.120 type vlan id 120
$ ip add add 192.168.11.10 dev eth1.120
$ ip link set up dev eth1.120
$ route add default gw 192.168.11.1 eth1.120
$ ping -c 2 192.168.11.1

I am under the impression the following should work with ovs to establish
the same results, but does not.
$ ip link set promisc on dev eth1
$ ovs-vsctl --version
  ovs-vsctl (Open vSwitch) 2.3.1
  DB Schema 7.6.2
$ ovs-vsctl add-br br1
$ ovs-vsctl add-port br1 eth1
$ ovs-vsctl add-br vlan120 br1 120 # Create Fake Bridge with vlan 120
$ ovs-vsctl add-port vlan120 vif120 -- set interface vif120 type=internal
$ ifconfig vif120 192.168.11.10 up
$ route add default gw 192.168.11.1
$ ping -c 2 192.168.11.1

Loss of packets, have a missed something? How should I achieve same ip
stack configuration with ovs as shown above?

NOTE:
a. Creating eth1.120 and adding as port to bridge created with ovs and
assigning ip to bridge results in functioning interface but ultimately
fails with the creation of additional vlans on same bridge/interface and
expecting packets to be externally route-able.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150520/a0c6d1fe/attachment-0002.html>

From seanmccully at gmail.com  Wed May 20 12:56:19 2015
From: seanmccully at gmail.com (Sean McCully)
Date: Wed, 20 May 2015 15:56:19 -0400
Subject: [ovs-discuss] OVS [vlan] Fake Bridge
Message-ID: <CAB-ezPFwUUD7fJB9rNXadHEG4Xpy8JggOXeE_fYeRjdYtin12Q@mail.gmail.com>

I am having a problem configuring open vswitch with my vlan configuration,
I am running Ubuntu 15.04 (3.16.0-37).


The following with ip/kernel configuration works,

$ ip link add link eth1 name eth1.120 type vlan id 120
$ ip add add 192.168.11.10 dev eth1.120
$ ip link set up dev eth1.120
$ route add default gw 192.168.11.1 eth1.120
$ ping -c 2 192.168.11.1

I am under the impression the following should work with ovs to establish
the same results, but does not.
$ ip link set promisc on dev eth1
$ ovs-vsctl --version
  ovs-vsctl (Open vSwitch) 2.3.1
  DB Schema 7.6.2
$ ovs-vsctl add-br br1
$ ovs-vsctl add-port br1 eth1
$ ovs-vsctl add-br vlan120 br1 120 # Create Fake Bridge with vlan 120
$ ovs-vsctl add-port vlan120 vif120 -- set interface vif120 type=internal
$ ifconfig vif120 192.168.11.10 up
$ route add default gw 192.168.11.1
$ ping -c 2 192.168.11.1

Loss of packets, have a missed something? How should I achieve same ip
stack configuration with ovs as shown above?

NOTE:
a. Creating eth1.120 and adding as port to bridge created with ovs and
assigning ip to bridge results in functioning interface but ultimately
fails with the creation of additional vlans on same bridge/interface and
expecting packets to be externally route-able.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150520/a0c6d1fe/attachment-0003.html>

From jon.gainsley at pluribusnetworks.com  Wed May 20 13:45:37 2015
From: jon.gainsley at pluribusnetworks.com (Jon Gainsley)
Date: Wed, 20 May 2015 13:45:37 -0700
Subject: [ovs-discuss] pf_packet/af_packet socket with vlan tagging does not
	strip vlan tag
Message-ID: <CAAcrFUZW=nYFfaEYmWof+-SEaiW2LdCorjo3bgiX7=uYYUJBpw@mail.gmail.com>

Hi,

I'm wondering if anyone can help me with this. I am having trouble
inserting raw vlan tagged packets into the vswitch using an AF_PACKET
socket. I have the following simple bridge:

# ovs-vsctl show
9c4e5d06-31c5-4d65-a5c0-3f16a4f08cac
    Bridge "nvstub0"
        Port "vnic20"
            tag: 20
            Interface "vnic20"
                type: internal
        Port "nvstub0"
            Interface "nvstub0"
                type: internal
        Port "vdata0"
            Interface "vdata0"
                type: internal

I have an AF_PACKET socket in SOCK_RAW, protocol ETH_P_ALL open and bound
on nvstub0. I am inserting vlan 20 tagged ICMP request packets into the
vswitch, destined for vnic20:

# ifconfig vnic20
vnic20    Link encap:Ethernet  HWaddr 56:f2:01:aa:fd:d7
          inet addr:12.12.12.2  Bcast:12.12.12.255  Mask:255.255.255.0
          inet6 addr: fe80::54f2:1ff:feaa:fdd7/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1713 errors:0 dropped:1 overruns:0 frame:0
          TX packets:26 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:110446 (110.4 KB)  TX bytes:2188 (2.1 KB)

What I see is sometimes, the first few packets make it ok, but subsequent
packets always have the vlan header still on the packet when it is sent to
vnic20, so they are dropped, and linux does not respond to the ping. Note
the first few packets are working as I hope/expect, but later packets are
not.

# tcpdump -e -i vnic20
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on vnic20, link-type EN10MB (Ethernet), capture size 65535 bytes
13:26:28.315783 02:08:20:74:fe:3b (oui Unknown) > 56:f2:01:aa:fd:d7 (oui
Unknown), ethertype IPv4 (0x0800), length 98: 12.12.12.12 > 12.12.12.2:
ICMP echo request, id 27883, seq 0, length 64
13:26:28.315808 56:f2:01:aa:fd:d7 (oui Unknown) > 02:08:20:74:fe:3b (oui
Unknown), ethertype IPv4 (0x0800), length 98: 12.12.12.2 > 12.12.12.12:
ICMP echo reply, id 27883, seq 0, length 64
13:26:29.308271 02:08:20:74:fe:3b (oui Unknown) > 56:f2:01:aa:fd:d7 (oui
Unknown), ethertype 802.1Q (0x8100), length 102: vlan 20, p 0, ethertype
IPv4, 12.12.12.12 > 12.12.12.2: ICMP echo request, id 27883, seq 1, length
64
13:26:30.308261 02:08:20:74:fe:3b (oui Unknown) > 56:f2:01:aa:fd:d7 (oui
Unknown), ethertype 802.1Q (0x8100), length 102: vlan 20, p 0, ethertype
IPv4, 12.12.12.12 > 12.12.12.2: ICMP echo request, id 27883, seq 2, length
64
13:26:31.308167 02:08:20:74:fe:3b (oui Unknown) > 56:f2:01:aa:fd:d7 (oui
Unknown), ethertype 802.1Q (0x8100), length 102: vlan 20, p 0, ethertype
IPv4, 12.12.12.12 > 12.12.12.2: ICMP echo request, id 27883, seq 3, length
64

It seems like the first few packets are taking a different path through the
kernel than the later packets, since the first few packets correctly have
the vlan tag removed, while later packets do not.

This looks related to this post:
http://comments.gmane.org/gmane.network.openvswitch.devel/7289

But that's an old post and I am using recent software, so I don't know if
it's still relevant.

# uname -a
Linux jon-leo3 3.16.0-38-generic #52~14.04.1-Ubuntu SMP Fri May 8 09:43:57
UTC 2015 x86_64 x86_64 x86_64 GNU/Linux

I've tried openvswitch 2.0.2 (that came with Ubuntu), and also compiled
from git (also compiling and loading the kernel module):

Right now I'm using the built version:
# ovs-vsctl -V
ovs-vsctl (Open vSwitch) 2.3.90
Compiled May 20 2015 12:42:23
DB Schema 7.12.1

I have also tried:
- changing the tx/txvlan offload settings on both nvstub0 and vnic20 using
ethtool
- setting trunks=20 on nvstub0 and trying all possible vlan_mode values.

My intent is that whatever is on vnic20 does not have to understand vlans.
It should only get untagged packets. I just want to isolate it on vlan 20
using the vswitch.

Based on that old post I'm hoping this is a known issue and hoping there is
some work-around, or a different way to inject raw packets that will work
properly.

Thanks in advance!
-Jon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150520/462921e2/attachment.html>

From wangan1213 at gmail.com  Thu May 21 10:26:01 2015
From: wangan1213 at gmail.com (an wang)
Date: Thu, 21 May 2015 13:26:01 -0400
Subject: [ovs-discuss] Datapath megaflow issues
Message-ID: <CAAcQFL=1ejXw80T+efu8Az-i38B+75nfXGeGchbA79tcgpHmyQ@mail.gmail.com>

Hi, All,

I'm trying to figure out how datapath mega flows are generated. So I did a
very simple experiment on openvswitch 2.3.0. I inserted a rule ovs-ofctl
add-flow br0 in_port=2,ip,nw_dst=192.168.2.2/16,actions=output:1 to the
userspace flow table. And I used ovs-appctl dpif/dump-flows br0 to check
the flows in datapath flow table and this is what I observed.

skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:00:39:d3:34:3b),eth_type(0x0800),ipv4(src=
192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=62/0,frag=no/0xff),
packets:26670724, bytes:1762573766, used:0.000s, flags:SR., actions:2
skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:50:56:49:01:29),eth_type(0x0800),ipv4(src=
192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=63/0,frag=no/0xff),
packets:9469993, bytes:586123740, used:0.000s, flags:SF., actions:2

Somehow it seems that the ip dst field is not wildcarded at all. And I've
repeated the experiment for several times using different prefix and I
obtained the same result. Could anyone please explain why this happened and
how wildcarded flows are supported in the datapath?

p.s. I configured the dpdk openvswitch, not sure whether that's why the
wildcard doesn't work in datapath.

I'd really appreciate your help!
An Wang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150521/ed2ba7f1/attachment-0001.html>

From krzysztof.wojciechowski at techstorage.pl  Thu May 21 15:09:32 2015
From: krzysztof.wojciechowski at techstorage.pl (Krzysztof Wojciechowski)
Date: Fri, 22 May 2015 00:09:32 +0200
Subject: [ovs-discuss] Ovs-testcontroller hard timeout
In-Reply-To: <CACjuMbwctk_hyQe30M=DBNMS190tV94E40BQ5369PZK-3jxG4Q@mail.gmail.com>
References: <5553B8EE.8000704@techstorage.pl>	<20150515161834.GB9947@nicira.com>	<CAArS4XX2VAFNO5+8y0RgXwmH0axO8L=t_eB_c=s+LzYcQRj9tQ@mail.gmail.com>	<555682F5.6020405@techstorage.pl>
 <CACjuMbwctk_hyQe30M=DBNMS190tV94E40BQ5369PZK-3jxG4Q@mail.gmail.com>
Message-ID: <555E579C.8080906@techstorage.pl>

Thank you, it worked out very well :)

W dniu 2015-05-16 o 01:39, Ben Pfaff pisze:
> On Fri, May 15, 2015 at 4:36 PM, Krzysztof Wojciechowski
> <krzysztof.wojciechowski at techstorage.pl> wrote:
>> Maybe i can add some "fm." line (something like fm.hard_timeout ?), and just
>> hardcode it?
> Sure, that ought to work.


From ddesimon at cisco.com  Thu May 21 20:45:54 2015
From: ddesimon at cisco.com (Dave DeSimone (ddesimon))
Date: Fri, 22 May 2015 03:45:54 +0000
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <20150518235408.GC6582@nicira.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
 <D17B5F0A.18A276%ddesimon@cisco.com> <20150515181031.GA14637@nicira.com>
 <D17BB16E.18A33F%ddesimon@cisco.com> <20150515233429.GC14637@nicira.com>
 <D17F667F.18A5FB%ddesimon@cisco.com> <20150518235408.GC6582@nicira.com>
Message-ID: <D1841C82.18C29D%ddesimon@cisco.com>

Hi Ben,

Just a fundamental question, that I’m not understanding.

Here is my bridge

    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
        Port "enp130s0f0"
            Interface "enp130s0f0"
        Port "mgmt0"
            Interface "mgmt0"
                type: internal


mgmt0 is carrying the ip address.

I’ve added a flow with this:

ovs-ofctl add-flow br0 dl_type=0x88cc,action=flood



When I dump the flows, I see pkts

ovs-ofctl dump-flows br0
	NXST_FLOW reply (xid=0x4):
	cookie=0x0, duration=23254.816s, table=0, n_packets=4647,
n_bytes=1329042, idle_age=3, dl_type=0x88cc actions=FLOOD




I also ran tcpdump on the mgmt0 interface and I see the lldp packets there.


So, it looks like the pkts are coming in on the physical interface
(enp130s0f0) and getting sent to the internal interface mgmt0. But the
lldp daemon running on the linux os still is not seeing the pkts.


Is this valid? Why wouldn’t the lldp process see these packets is they
appear on the mgmt0 interface?

Thanks again for your time!




On 5/18/15, 7:54 PM, "Ben Pfaff" <blp at nicira.com> wrote:

>That's the solution I've heard of most.  Open vSwitch doesn't have
>built-in support for LLDP, except in the context of Auto-Attach.
>
>On Mon, May 18, 2015 at 01:51:54PM +0000, Dave DeSimone (ddesimon) wrote:
>> I need to investigate this as I¹m not familiar with OpenFlow.
>> Is this the only option?
>> Thank you.
>> 
>> On 5/15/15, 7:34 PM, "Ben Pfaff" <blp at nicira.com> wrote:
>> 
>> >On Fri, May 15, 2015 at 07:19:51PM +0000, Dave DeSimone (ddesimon)
>>wrote:
>> >> Thanks for the quick reply!
>> >> 
>> >> Ok. How do I get the lldp packets through ovs to the lldp process?
>> >
>> >One common way is to implement lldp as an OpenFlow controller and
>> >direct packets to it with "controller" actions that send OpenFlow
>> >"packet-in" messages to the controller.
>> 


From jayachandran.subramanian at wipro.com  Thu May 21 23:35:46 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Fri, 22 May 2015 06:35:46 +0000
Subject: [ovs-discuss] Openvswitch load bug-Performance issue
Message-ID: <SINPR03MB331150E9A025134D8433B5E95C00@SINPR03MB331.apcprd03.prod.outlook.com>

Hi ,

I have executed load.FlowRemovedLload  github scripts in Openvswitch and its getting failed with this intermittent error .

"Dropped 175 messages in last 1 seconds due to excessive rate"


Openvswitch version : openvswitch - 2.3.1

OS version                    : Ubuntu 14.04 Ttusty

Open flow version      : 1.0



And the same script passed without adding /deleting in the script with  Openflow switch.



PFA script details attached .



Kindly let me know your inputs on the same.



Thanks

Jayachandran S

+91-8861883300







The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150522/2b06364e/attachment-0001.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Load.FlowRemovedLoad.txt
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150522/2b06364e/attachment-0001.txt>

From subbaraomagunti at gmail.com  Fri May 22 01:44:53 2015
From: subbaraomagunti at gmail.com (Subbarao magunti)
Date: Fri, 22 May 2015 14:14:53 +0530
Subject: [ovs-discuss] OVS bonding vs Linux Bonding
Message-ID: <CAOqGw09DjAbwcGoZTXCNjJ+-Q4+puv5Ot+YJmty10iCRPAgp7g@mail.gmail.com>

Hello,

I am trying to understand the main differences between OVS bonding and
Linux bonding. I tried googling, but couldn't find much information. I have
few questions and appreciate your answers:

1. How is OVS bonding different from Linux bonding?
2. Is there any performance gain or loss of using OVS bonding as opposed to
Linux bonding? Does the latency increase because of bonding?
3. I am considering bonding for both host and VM traffic. Can I use OVS
bonding for host traffic as well?

Thanks,
Rao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150522/6e82d7ed/attachment.html>

From s54088.cs98 at g2.nctu.edu.tw  Fri May 22 06:09:42 2015
From: s54088.cs98 at g2.nctu.edu.tw (=?UTF-8?B?U2hhby1Zb3UgV3Ug5ZCz5bCR5Y+L?=)
Date: Fri, 22 May 2015 21:09:42 +0800
Subject: [ovs-discuss] Multiple MPLS label pushing?
Message-ID: <CAPv_OZDi-HfS5VKf=opvKP6UigMCdMtX48p5eGJ8gbxZKY9dUQ@mail.gmail.com>

Hi all,

I've tried to push/pop MPLS labels on the packets, but currently, ovs only
supports "3 MPLS label pushing".
I need longer MPLS label stack.

-------------------
Related code segments in "lib/flow.h":
#L76
/* Maximum number of supported MPLS labels. */
#define FLOW_MAX_MPLS_LABELS 3
#L158
BUILD_ASSERT_DECL(offsetof(struct flow, igmp_group_ip4) + sizeof(uint32_t)
== sizeof(struct flow_tnl) + 192
-------------------

I changed FLOW_MAX_MPLS_LABELS from 3 to another bigger value (saying, 9),
added additional 24 bytes ( (9-3)x4 = 24 ) in the end of line 158,
and re-built the ovs.

Unfortunately, it still supports only 3 stacked MPLS labels.
Does anyone knows what else I should do?
Your suggestions are welcome and appreciated!

*Thanks very much,
Wusy*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150522/153520bf/attachment-0001.html>

From shettyg at nicira.com  Fri May 22 07:16:40 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 22 May 2015 07:16:40 -0700
Subject: [ovs-discuss] OVSDB way to determine if port is NIC?
In-Reply-To: <D183E054.16AE8%alagalah@gmail.com>
References: <D183E054.16AE8%alagalah@gmail.com>
Message-ID: <CAHbON5oX8FvQXjh=sdXqWuKX7-uNCoHYdwru9nj0tmhcpJ8trA@mail.gmail.com>

On Thu, May 21, 2015 at 7:19 PM, alagalah <alagalah at gmail.com> wrote:
> Is there anyway in OVS 2.3.0 to determine via OVSDB remote manager
> connection if a given port is a (physical) NIC?
I don't think there is any.

>
> I have docker containers linked to my OVS instance, as well as a PHY from
> the host, and I couldn¹t see anything in the schema to discern them.
>
When you add your physical port, you can add a external_ids:foo=bar to
identify something.

> Any guidance appreciated.
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From hardik.soni at inria.fr  Fri May 22 07:52:09 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Fri, 22 May 2015 16:52:09 +0200 (CEST)
Subject: [ovs-discuss] QoS question: ovs- QoS configuration and linux-QoS
In-Reply-To: <49388820.7856013.1432305969395.JavaMail.zimbra@inria.fr>
Message-ID: <1348571400.7859072.1432306329841.JavaMail.zimbra@inria.fr>

Hi All, 

I went through QoS section of FAQ. 
https://github.com/openvswitch/ovs/blob/master/FAQ.md#quality-of-service-qos 

As I understood, OVS doesnt implement QoS, It configures linux-QoS for the interfaces it is handling. 
If I set linux QoS using 'tc' for a given interface and attach the interface to an OVS bridge using add-port command ovs-vsctl, will it retain the configuration? 
I want to make sure, OVS doesnt reset my pre-set linux-QoS for the interface it is handling. 

Example. 
tc qdisc add dev eth0 root tbf rate 0.5mbit burst 5kb latency 70ms peakrate 1mbit minburst 1540 
creating a bridge br-0 
ovs-vsctl add-port br-0 eth0 

Now, eth0 will retain the QoS set by tc. Am I right? 

Thanks, 
Hardik Soni 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150522/bc737e40/attachment.html>

From kevin.traynor at intel.com  Fri May 22 09:31:21 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Fri, 22 May 2015 16:31:21 +0000
Subject: [ovs-discuss] For help about ssh between vms through ovs-dkdp
In-Reply-To: <D183AF76.173B%diproiettod@vmware.com>
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>
 <BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com>
 <D1825AEA.15DE%diproiettod@vmware.com>
 <BC0FEEC7D7650749874CEC11314A88F730757B63@IRSMSX104.ger.corp.intel.com>
 <D183AF76.173B%diproiettod@vmware.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F730759EEA@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> Sent: Thursday, May 21, 2015 4:23 PM
> To: Traynor, Kevin
> Cc: discuss
> Subject: Re: [ovs-discuss] For help about ssh between vms through ovs-dkdp
> 
> 
> 
> On 21/05/2015 15:48, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:
> 
> >
> >> -----Original Message-----
> >> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> >> Sent: Wednesday, May 20, 2015 4:12 PM
> >> To: Traynor, Kevin
> >> Cc: ???0280; discuss; ??0310
> >> Subject: Re: [ovs-discuss] For help about ssh between vms through
> >>ovs-dkdp
> >>
> >>
> >> On 20/05/2015 15:21, "Traynor, Kevin" <kevin.traynor at intel.com> wrote:
> >>
> >> >
> >> >
> >> >> -----Original Message-----
> >> >
> >> >> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> >> >
> >> >> Sent: Wednesday, May 20, 2015 1:47 PM
> >> >
> >> >> To: 钢锁0310
> >> >
> >> >> Cc: 通天晓0280; discuss; Traynor, Kevin
> >> >
> >> >> Subject: Re: [ovs-discuss] For help about ssh between vms through
> >> >>ovs-dkdp
> >> >
> >> >>
> >> >
> >> >> This might be related to offloading features.
> >> >
> >> >>
> >> >
> >> >> Could you try again with this qemu "-device" option and let us know?
> >> >
> >> >> -device
> >> >
> >> >>
> >>
> >>>>virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=o
> >>>>ff
> >> >>,g
> >> >
> >> >> uest_ecn=off
> >> >
> >> >
> >> >
> >> >I checked this previously and the DPDK vhost lib will report those
> >> >features
> >> >
> >> >as not available during negotiation so you should be ok with not
> >> >specifying
> >> >
> >> >them explicitly in the qemu cmd line. I haven't tested with qemu 2.3.
> >> >
> >> >
> >> >
> >> >>
> >> >
> >> >>
> >> >
> >> >> Kevin, do you this we should mention this in INSTALL.DPDk.md?
> >> >
> >> >
> >> >
> >> >I had changed the original patch to make it optional in 3a based on
> >> >feedback
> >> >
> >> >from Michael Tsirkin and testing. So unless we find an issue, I'd
> >>prefer
> >> >to
> >> >
> >> >leave optional.
> >> >
> >>
> >>>https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswi
> >>>tc
> >>
> >>>h_ovs_blob_master_INSTALL.DPDK.md-23dpdk-2Dvhost-2Dvm-2Dconfiguration&d=
> >>>Aw
> >>
> >>>IGoQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s
> >>>_C
> >>
> >>>w5yUNjxgD4v5kJqZ2uWLlE&m=iM-aCjDqF2zfP98Zeafj9Z78WnCYvkzPSyZeV1kVGWg&s=S
> >>>Om
> >> >_egKoAfzUwWioueTrQ9W2sa_WSUwKC74LO5SNvWs&e=
> >> >
> >>
> >> If I don't add the extra options, my guests (Debian wheezy kernel 3.2
> >>and
> >> Ubuntu 14.04 kernel 3.13, running on QEMU 2.1.3) see these features
> >>
> >> # ethtool -k eth0
> >>
> >> Features for eth0:
> >>                                                 rx-checksumming: off
> >> [fixed]
> >>                                                 tx-checksumming: on
> >>         tx-checksum-ipv4: off [fixed]
> >>         tx-checksum-unneeded: off [fixed]
> >>         tx-checksum-ip-generic: on
> >>         tx-checksum-ipv6: off [fixed]
> >>         tx-checksum-fcoe-crc: off [fixed]
> >>         tx-checksum-sctp: off [fixed]
> >>                                                 scatter-gather: on
> >>         tx-scatter-gather: on
> >>         tx-scatter-gather-fraglist: on
> >>
> >>tcp-segmentation-offload:
> >> on
> >>         tx-tcp-segmentation: on
> >>         tx-tcp-ecn-segmentation: on
> >>         tx-tcp6-segmentation: on
> >>
> >>udp-fragmentation-offload:
> >> on
> >>
> >> generic-segmentation-offload: on
> >>
> >>generic-receive-offload: on
> >>                                                 large-receive-offload:
> >>off
> >> [fixed]
> >> [...]
> >>
> >>
> >> Pings work, but everything else (e.g. DNS lookups) doesn't.
> >> To fix the setup I have either to add the extra options or to disable
> >>the
> >> offloads (inside the guest) with
> >>
> >>   ethtool -K eth0 tx off
> >
> >I'm seeing that too. I can see that the dpdk vhost is reporting the
> >correct
> >features it supports:
> >VHOST_CONFIG: (0) Device configuration started
> >vhost: get_features() returning: pu=0x0000000000068000
> >
> >where the bits represent
> >#define VIRTIO_NET_F_MRG_RXBUF  0x08000 /* Host can merge receive
> >buffers. */
> >#define VIRTIO_NET_F_CTRL_VQ    0x20000 /* Control channel available */
> >#define VIRTIO_NET_F_CTRL_RX    0x40000 /* Control channel RX mode
> >support */
> >
> >and then the negotiation appears to complete correctly when the dpdk vhost
> >set_features() is called:
> >
> >vhost: set_features called: pu=0x0000000000008000
> >2015-05-21T14:08:56Z|00001|dpdk(cuse_thread2)|INFO|vHost Device
> >'dpdkvhost0' (0) has been added
> >
> >but it looks like the negotiated features are not being reported or used?
> ># ethtool -k eth1
> >Offload parameters for eth1:
> >rx-checksumming: off
> >tx-checksumming: on
> >scatter-gather: on
> >tcp-segmentation-offload: on
> >udp-fragmentation-offload: on
> >generic-segmentation-offload: on
> >generic-receive-offload: on
> >large-receive-offload: off
> >rx-vlan-offload: off
> >tx-vlan-offload: off
> >ntuple-filters: off
> >receive-hashing: off
> >
> >Previously when I had tested, I had checked the negotiation but went on to
> >run a dpdk app in the guest and didn't see this issue. So, I think it may
> >need to go back into the docs...let me know what you think and I can
> >adjust.
> 
> Thanks for confirming that Kevin,
> 
> It appears that qemu only negotiates offloadings with a vhost-user peer.
> Looking at qemu(2.3.0) hw/net/vhost_net.c:110 it seems that
> `vhost_net_get_features()` will consider disabling offloadings only if
> dealing with a `NET_CLIENT_OPTIONS_KIND_VHOST_USER` peer (since vhost-cuse
> "emulates" a kernel vhost, our devices will appear as
> `NET_CLIENT_OPTIONS_KIND_TAP`).
> 
> I don't know why qemu behaves like this (I'm definitely not a QEMU expert),
> but I'm sure it has its good reasons.
> 
> Unless you want to dig further I suggest we add the extra QEMU options to
> INSTALL.DPDK.md.  Vhost-user shouldn't have this problem.
> 
> What do you think?
> 
> Daniele

Yeah, I think we should add it. I'm not sure what the pipeline is like, but
maybe we could hold off until after vhost-user because it'll force another
rebase for INSTALL.DPDK and we can cover vhost-user qemu params then also.
If you want to put it in straight away I'm ok with that too.



From jayachandran.subramanian at wipro.com  Fri May 22 01:31:44 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Fri, 22 May 2015 08:31:44 +0000
Subject: [ovs-discuss] openvswitch issue for flow_removal message.
Message-ID: <SINPR03MB3312F5F513489C05D3C82ED95C00@SINPR03MB331.apcprd03.prod.outlook.com>

Hi ,

I would like to raise an issue with openvswitch while I executed the github openflow 1.0 version script and it didn't find the openflow message (ofp.OFPFF_SEND_FLOW_REM) in openvswitch.


Openvswitch version : openvswitch - 2.3.1

OS version                    : Ubuntu 14.04 Ttusty

Open flow version      : 1.0



And the same script passed without adding /deleting in the script with  Openflow switch.



PFA script details attached .



Kindly let me know your inputs on the same.



Thanks

Jayachandran S

+91-8861883300



The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150522/0b7017f6/attachment-0001.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: flow_expire.txt
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150522/0b7017f6/attachment-0001.txt>

From blp at nicira.com  Fri May 22 12:04:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 22 May 2015 12:04:03 -0700
Subject: [ovs-discuss] QoS question: ovs- QoS configuration and linux-QoS
In-Reply-To: <1348571400.7859072.1432306329841.JavaMail.zimbra@inria.fr>
References: <49388820.7856013.1432305969395.JavaMail.zimbra@inria.fr>
 <1348571400.7859072.1432306329841.JavaMail.zimbra@inria.fr>
Message-ID: <20150522190403.GE30148@nicira.com>

On Fri, May 22, 2015 at 04:52:09PM +0200, Hardik Soni wrote:
> I went through QoS section of FAQ. 
> https://github.com/openvswitch/ovs/blob/master/FAQ.md#quality-of-service-qos 
> 
> As I understood, OVS doesnt implement QoS, It configures linux-QoS for the interfaces it is handling. 
> If I set linux QoS using 'tc' for a given interface and attach the interface to an OVS bridge using add-port command ovs-vsctl, will it retain the configuration? 
> I want to make sure, OVS doesnt reset my pre-set linux-QoS for the interface it is handling. 
> 
> Example. 
> tc qdisc add dev eth0 root tbf rate 0.5mbit burst 5kb latency 70ms peakrate 1mbit minburst 1540 
> creating a bridge br-0 
> ovs-vsctl add-port br-0 eth0 
> 
> Now, eth0 will retain the QoS set by tc. Am I right? 

I think so.  That's certainly the intent.

From blp at nicira.com  Fri May 22 12:05:39 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 22 May 2015 12:05:39 -0700
Subject: [ovs-discuss] OVSDB way to determine if port is NIC?
In-Reply-To: <D183E054.16AE8%alagalah@gmail.com>
References: <D183E054.16AE8%alagalah@gmail.com>
Message-ID: <20150522190539.GF30148@nicira.com>

On Thu, May 21, 2015 at 07:19:48PM -0700, alagalah wrote:
> Is there anyway in OVS 2.3.0 to determine via OVSDB remote manager
> connection if a given port is a (physical) NIC?

Is there a way to do that locally?  Sometimes people do ask for this,
but I don't know of a reliable way to do it.

From blp at nicira.com  Fri May 22 12:10:00 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 22 May 2015 12:10:00 -0700
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <D1841C82.18C29D%ddesimon@cisco.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
 <D17B5F0A.18A276%ddesimon@cisco.com>
 <20150515181031.GA14637@nicira.com>
 <D17BB16E.18A33F%ddesimon@cisco.com>
 <20150515233429.GC14637@nicira.com>
 <D17F667F.18A5FB%ddesimon@cisco.com>
 <20150518235408.GC6582@nicira.com>
 <D1841C82.18C29D%ddesimon@cisco.com>
Message-ID: <20150522191000.GG30148@nicira.com>

On Fri, May 22, 2015 at 03:45:54AM +0000, Dave DeSimone (ddesimon) wrote:
> Just a fundamental question, that I’m not understanding.
> 
> Here is my bridge
> 
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "enp130s0f0"
>             Interface "enp130s0f0"
>         Port "mgmt0"
>             Interface "mgmt0"
>                 type: internal
> 
> 
> mgmt0 is carrying the ip address.
> 
> I’ve added a flow with this:
> 
> ovs-ofctl add-flow br0 dl_type=0x88cc,action=flood
> 
> 
> 
> When I dump the flows, I see pkts
> 
> ovs-ofctl dump-flows br0
> 	NXST_FLOW reply (xid=0x4):
> 	cookie=0x0, duration=23254.816s, table=0, n_packets=4647,
> n_bytes=1329042, idle_age=3, dl_type=0x88cc actions=FLOOD
> 
> 
> 
> 
> I also ran tcpdump on the mgmt0 interface and I see the lldp packets there.
> 
> 
> So, it looks like the pkts are coming in on the physical interface
> (enp130s0f0) and getting sent to the internal interface mgmt0. But the
> lldp daemon running on the linux os still is not seeing the pkts.
> 
> 
> Is this valid? Why wouldn’t the lldp process see these packets is they
> appear on the mgmt0 interface?

If the packets show up in tcpdump on mgmt0, then that means that OVS
sent them to the device.  Anything that happens beyond that point isn't
the responsibility of OVS; OVS has no control over it.  In fact, it
seems likely that the LLDP process receives packets from mgmt0 in the
same way that tcpdump does, so it is a puzzle to me why it wouldn't see
them.

I know that's not really very helpful but I don't have experience with
lldp daemons on Linux so I don't know what else to say.

If you figure out what's going on then I'd be happy to add something to
the FAQ to explain.

From azhou at nicira.com  Fri May 22 13:41:55 2015
From: azhou at nicira.com (Andy Zhou)
Date: Fri, 22 May 2015 13:41:55 -0700
Subject: [ovs-discuss] one patch was omitted to be pushed to
 branch-2.3---datapath: Fix recirc bug where skb is double freed
In-Reply-To: <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
Message-ID: <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>

Hi, Jeremy,

Sorry for the delay. I don't think this patch is required for branch
2.3. As you may have noticed, this part of code
is different on branch 2.3.  And it seems to work on my test.

Do you have the core dump from kernel crash? If yes, would you please
post the back trace?

Thanks,

Andy

On Sun, May 17, 2015 at 9:41 AM, Alex Wang <alexw at nicira.com> wrote:
> Fwd to Andy,~
>
> On Sun, May 17, 2015 at 4:29 AM, zhangzhiming <zhangzhiming at yunshan.net.cn>
> wrote:
>>
>> Hi,
>>
>> I found one patch was omitted to be pushed to branch-2.3, which leads to
>> double freed skb.
>> Could someone to confirm the patch and submit it to branch-2.3?
>> Thanks!
>>
>> Here is the patch information:
>>
>>
>> commit 867e37ba00091b3e319c4c47c1598f1ae84dd32e
>> Author: Andy Zhou <azhou at nicira.com>
>> Date:   Mon Aug 25 15:18:19 2014 -0700
>>
>>     datapath: Fix recirc bug where skb is double freed.
>>
>>     If recirc action is the last action of a action list, the SKB triggers
>>     the recirc will be freed twice. This patch fixes this bug.
>>
>>     Reported-by: Justin Pettit <jpettit at nicira.com>
>>     Signed-off-by: Andy Zhou <azhou at nicira.com>
>>
>> diff --git a/datapath/actions.c b/datapath/actions.c
>> index ad22467..7f25553 100644
>> --- a/datapath/actions.c
>> +++ b/datapath/actions.c
>> @@ -809,7 +809,16 @@ static int execute_recirc(struct datapath *dp, struct
>> sk_buff *skb,
>>                           const struct nlattr *a, int rem)
>>  {
>>         struct sw_flow_key recirc_key;
>> -       int err;
>> +
>> +       if (!is_skb_flow_key_valid(skb)) {
>> +               int err;
>> +
>> +               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
>> +               if (err)
>> +                       return err;
>> +
>> +       }
>> +       BUG_ON(!is_skb_flow_key_valid(skb));
>>
>>         if (!last_action(a, rem)) {
>>                 /* Recirc action is the not the last action
>> @@ -820,19 +829,9 @@ static int execute_recirc(struct datapath *dp, struct
>> sk_buff *skb,
>>                  * continue on with the rest of the action list. */
>>                 if (!skb)
>>                         return 0;
>> -       }
>>
>> -       if (!is_skb_flow_key_valid(skb)) {
>> -               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
>> -               if (err) {
>> -                       kfree_skb(skb);
>> -                       return err;
>> -               }
>> -       }
>> -       BUG_ON(!is_skb_flow_key_valid(skb));
>> -
>> -       if (!last_action(a, rem))
>>                 flow_key_clone(skb, &recirc_key);
>> +       }
>>
>>         flow_key_set_recirc_id(skb, nla_get_u32(a));
>>         ovs_dp_process_packet(skb, true);
>> @@ -897,6 +896,12 @@ static int do_execute_actions(struct datapath *dp,
>> struct sk_buff *skb,
>>
>>                 case OVS_ACTION_ATTR_RECIRC:
>>                         err = execute_recirc(dp, skb, a, rem);
>> +                       if (last_action(a, rem)) {
>> +                               /* If this is the last action, the skb has
>> +                                * been consumed or freed.
>> +                                * Return immediately. */
>> +                               return err;
>> +                       }
>>                         break;
>>
>>                 case OVS_ACTION_ATTR_SET:
>>
>> ________________________________
>> Jeremy Zhang
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>

From joestringer at nicira.com  Fri May 22 14:36:46 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Fri, 22 May 2015 14:36:46 -0700
Subject: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
 interval (365882ms user, 464906ms system)
In-Reply-To: <2015051918320317100434@jd.com>
References: <2015051918320317100434@jd.com>
Message-ID: <CANr6G5zmkv=cgdbMSCes2k_yYaCKGhuLWxiPgB85eYCanyaFKA@mail.gmail.com>

On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
> Hi,
> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all virtual
> machines and containers communicate with OVS.
> I use OVS  VLAN.
> OpenvSwitch Version 2.3.1  (nothing change)
> CentOS 6.6
> In the process of I use, encounter the flowing problems.
> Need your help!
>
> 1、ovs-vswitchd.log always report warnings:
>
> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
> interval (365882ms user, 464906ms system)
> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
> voluntary, 2080 involuntary
> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of duplicate
> event coverage for hash=35d02982
> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
> interval (380306ms user, 483259ms system)
> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
> voluntary, 2174 involuntary
> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of duplicate
> event coverage for hash=35d02982

The main loop of ovs-vswitchd usually expects to cycle at least once
per second. This message appears when this takes longer than usual,
which may indicate that ovs-vswitchd is under heavy load, or some sort
of bug.

>
> 2、I also encounter this problem:
>     when I execute
>     ovs-ofctl dump-flows br-int
>    not always reponse,  but ovs-vsctl show is OK!

The main thread of ovs-vswitchd assembles responses to OpenFlow
requests, and given the above messages it sounds like it's busy doing
other things. Ovs-vsctl on the other hand talks to ovsdb-server, which
looks like it is OK in this scenario.

These both seem like symptoms, but it's not obvious to me what the
underlying cause is. Is there anything else in the logs? Is
ovs-vswitchd using a lot of CPU?

Are you using the OVS kernel module from CentOS or one distributed
with the openvswitch package? ('modinfo openvswitch' should give a
hint here)

On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
> Hi,
> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all virtual
> machines and containers communicate with OVS.
> I use OVS  VLAN.
> OpenvSwitch Version 2.3.1  (nothing change)
> CentOS 6.6
> In the process of I use, encounter the flowing problems.
> Need your help!
>
> 1、ovs-vswitchd.log always report warnings:
>
> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
> interval (365882ms user, 464906ms system)
> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
> voluntary, 2080 involuntary
> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of duplicate
> event coverage for hash=35d02982
> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
> interval (380306ms user, 483259ms system)
> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
> voluntary, 2174 involuntary
> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of duplicate
> event coverage for hash=35d02982
>
> 2、I also encounter this problem:
>     when I execute
>     ovs-ofctl dump-flows br-int
>    not always reponse,  but ovs-vsctl show is OK!
>
> Thanks!
> WanLi Yang
>
>
> ________________________________
>
> WanLi Yang
>
> JD.COM
>
> *****************************************************************
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From hillad at gmail.com  Fri May 22 20:37:16 2015
From: hillad at gmail.com (Andy Hill)
Date: Fri, 22 May 2015 20:37:16 -0700
Subject: [ovs-discuss] QoS question: ovs- QoS configuration and linux-QoS
In-Reply-To: <1348571400.7859072.1432306329841.JavaMail.zimbra@inria.fr>
References: <49388820.7856013.1432305969395.JavaMail.zimbra@inria.fr>
 <1348571400.7859072.1432306329841.JavaMail.zimbra@inria.fr>
Message-ID: <CAC=Vi+pKWFBt0cE+TatmqFYvydWyXH2t_G9A2rWBThz0YKcT+w@mail.gmail.com>

You're right, but beware:

QoS set by tc does not survive a restart of the openvswitch service,
including ones during upgrades (verified on 2.1.0.34867). We've seen
this behavior at Rackspace across several OVS upgrades. We manually
rebuild QoS immediately following upgrades.

-AH


On Fri, May 22, 2015 at 7:52 AM, Hardik Soni <hardik.soni at inria.fr> wrote:
> Hi All,
>
> I went through QoS section of FAQ.
> https://github.com/openvswitch/ovs/blob/master/FAQ.md#quality-of-service-qos
>
> As I understood, OVS doesnt implement QoS, It configures linux-QoS for the
> interfaces it is handling.
> If I set linux QoS using 'tc' for a given interface and attach the interface
> to an OVS bridge using add-port command ovs-vsctl, will it retain the
> configuration?
> I want to make sure, OVS doesnt reset my pre-set linux-QoS for the interface
> it is handling.
>
> Example.
> tc qdisc add dev eth0 root tbf rate 0.5mbit burst 5kb latency 70ms peakrate
> 1mbit minburst 1540
> creating a bridge br-0
> ovs-vsctl add-port br-0 eth0
>
> Now, eth0 will retain the QoS set by tc. Am I right?
>
> Thanks,
> Hardik Soni
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From zhangzhiming at yunshan.net.cn  Sun May 24 01:46:04 2015
From: zhangzhiming at yunshan.net.cn (ZHANG Zhiming)
Date: Sun, 24 May 2015 16:46:04 +0800
Subject: [ovs-discuss] one patch was omitted to be pushed to
	branch-2.3---datapath: Fix recirc bug where skb is double freed
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>, 
 <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>
Message-ID: <201505241646035721464@yunshan.net.cn>

Hi,


Here you are. 
This bug is triggered by configuring bond_mode=banlace-tcp and lacp=active simultaneously.
The version of OVS is 2.3.1.


crash 7.0.2-6.el7
Copyright (C) 2002-2013  Red Hat, Inc.
Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
Copyright (C) 1999-2006  Hewlett-Packard Co
Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
Copyright (C) 2005, 2011  NEC Corporation
Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
This program is free software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter "help copying" to see the conditions.
This program has absolutely no warranty.  Enter "help warranty" for details.

GNU gdb (GDB) 7.6
Copyright (C) 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-unknown-linux-gnu"...

WARNING: kernel version inconsistency between vmlinux and dumpfile

      KERNEL: vmlinux                           
    DUMPFILE: vmcore  [PARTIAL DUMP]
        CPUS: 4
        DATE: Tue May 12 10:31:28 2015
      UPTIME: 00:02:02
LOAD AVERAGE: 0.43, 0.39, 0.16
       TASKS: 178
    NODENAME: centos125
     RELEASE: 3.10.0-123.el7.x86_64
     VERSION: #1 SMP Mon May 11 21:19:35 CST 2015
     MACHINE: x86_64  (3192 Mhz)
      MEMORY: 15.9 GB
       PANIC: "Kernel panic - not syncing: stack-protector: Kernel stack is corrupted in: ffffffffa04862ca"
         PID: 894
     COMMAND: "handler14"
        TASK: ffff8804059d2220  [THREAD_INFO: ffff8804064c4000]
         CPU: 3
       STATE: TASK_RUNNING (PANIC)

crash> bt
PID: 894    TASK: ffff8804059d2220  CPU: 3   COMMAND: "handler14"
 #0 [ffff8804064c5658] machine_kexec at ffffffff8104105b
 #1 [ffff8804064c56b8] crash_kexec at ffffffff810ceec2
 #2 [ffff8804064c5788] panic at ffffffff815dab1e
 #3 [ffff8804064c5808] __stack_chk_fail at ffffffff8105dc3b
 #4 [ffff8804064c5818] execute_recirc at ffffffffa04862ca [openvswitch]
 #5 [ffff8804064c58c8] do_execute_actions at ffffffffa04871ba [openvswitch]
 #6 [ffff8804064c5968] ovs_execute_actions at ffffffffa04873f7 [openvswitch]
 #7 [ffff8804064c59a0] ovs_packet_cmd_execute at ffffffffa04897b6 [openvswitch]
 #8 [ffff8804064c59f8] genl_family_rcv_msg at ffffffff814ff268
 #9 [ffff8804064c5ac0] genl_rcv_msg at ffffffff814ff471
#10 [ffff8804064c5ae8] netlink_rcv_skb at ffffffff814fd529
#11 [ffff8804064c5b10] genl_rcv at ffffffff814fda58
#12 [ffff8804064c5b28] netlink_unicast at ffffffff814fcb4d
#13 [ffff8804064c5b70] netlink_sendmsg at ffffffff814fcf37
#14 [ffff8804064c5c08] sock_sendmsg at ffffffff814b6f30
#15 [ffff8804064c5d70] ___sys_sendmsg at ffffffff814b7369
#16 [ffff8804064c5f00] __sys_sendmsg at ffffffff814b8251
#17 [ffff8804064c5f70] sys_sendmsg at ffffffff814b82a2
#18 [ffff8804064c5f80] system_call_fastpath at ffffffff815f1619
    RIP: 00007fca637c97bd  RSP: 00007fca5bfe5748  RFLAGS: 00000206
    RAX: 000000000000002e  RBX: ffffffff815f1619  RCX: 00007fca4c0480e0
    RDX: 0000000000000000  RSI: 00007fca5bfc9d30  RDI: 0000000000000012
    RBP: 0000000000000002   R8: 0000000000000000   R9: 000000000000037e
    R10: 0000000000ab32b0  R11: 0000000000000293  R12: ffffffff814b82a2
    R13: ffff8804064c5f78  R14: 000000000000027d  R15: 0000000000aad9b0
    ORIG_RAX: 000000000000002e  CS: 0033  SS: 002b
crash> dis execute_recirc
0xffffffffa0486240 <execute_recirc>:    nopl   0x0(%rax,%rax,1)
0xffffffffa0486245 <execute_recirc+5>:  push   %rbp
0xffffffffa0486246 <execute_recirc+6>:  mov    %rsp,%rbp
0xffffffffa0486249 <execute_recirc+9>:  push   %r12
0xffffffffa048624b <execute_recirc+11>: lea    -0xa0(%rbp),%rcx
0xffffffffa0486252 <execute_recirc+18>: push   %rbx
0xffffffffa0486253 <execute_recirc+19>: mov    %rdi,%rbx
0xffffffffa0486256 <execute_recirc+22>: mov    %rbx,%rdx
0xffffffffa0486259 <execute_recirc+25>: sub    $0x90,%rsp
0xffffffffa0486260 <execute_recirc+32>: mov    0x4(%rsi),%edi
0xffffffffa0486263 <execute_recirc+35>: mov    0x30(%rbx),%rsi
0xffffffffa0486267 <execute_recirc+39>: mov    %gs:0x28,%rax
0xffffffffa0486270 <execute_recirc+48>: mov    %rax,-0x18(%rbp)
0xffffffffa0486274 <execute_recirc+52>: xor    %eax,%eax
0xffffffffa0486276 <execute_recirc+54>: callq  0xffffffffa048bc00 <ovs_flow_key_extract_recirc>
0xffffffffa048627b <execute_recirc+59>: test   %eax,%eax
0xffffffffa048627d <execute_recirc+61>: mov    %eax,%r12d
0xffffffffa0486280 <execute_recirc+64>: jne    0xffffffffa04862b8
0xffffffffa0486282 <execute_recirc+66>: lea    -0xa0(%rbp),%rsi
0xffffffffa0486289 <execute_recirc+73>: mov    $0x1,%edx
0xffffffffa048628e <execute_recirc+78>: mov    %rbx,%rdi
0xffffffffa0486291 <execute_recirc+81>: callq  0xffffffffa048a5b0 <ovs_dp_process_packet_with_key>
0xffffffffa0486296 <execute_recirc+86>: xor    %eax,%eax
0xffffffffa0486298 <execute_recirc+88>: mov    -0x18(%rbp),%rdx
0xffffffffa048629c <execute_recirc+92>: xor    %gs:0x28,%rdx
0xffffffffa04862a5 <execute_recirc+101>:        jne    0xffffffffa04862c5
0xffffffffa04862a7 <execute_recirc+103>:        add    $0x90,%rsp
0xffffffffa04862ae <execute_recirc+110>:        pop    %rbx
0xffffffffa04862af <execute_recirc+111>:        pop    %r12
0xffffffffa04862b1 <execute_recirc+113>:        pop    %rbp
0xffffffffa04862b2 <execute_recirc+114>:        retq   
0xffffffffa04862b3 <execute_recirc+115>:        nopl   0x0(%rax,%rax,1)
0xffffffffa04862b8 <execute_recirc+120>:        mov    %rbx,%rdi
0xffffffffa04862bb <execute_recirc+123>:        callq  0xffffffff814c06f0 <kfree_skb>
0xffffffffa04862c0 <execute_recirc+128>:        mov    %r12d,%eax
0xffffffffa04862c3 <execute_recirc+131>:        jmp    0xffffffffa0486298
0xffffffffa04862c5 <execute_recirc+133>:        callq  0xffffffff8105dc20 <__stack_chk_fail>
0xffffffffa04862ca <execute_recirc+138>:        nopw   0x0(%rax,%rax,1)




ZHANG Zhiming
Yunshan Networks

From: Andy Zhou
Date: 2015-05-23 04:41
To: Alex Wang
CC: zhangzhiming; discuss
Subject: Re: [ovs-discuss] one patch was omitted to be pushed to branch-2.3---datapath: Fix recirc bug where skb is double freed
Hi, Jeremy,

Sorry for the delay. I don't think this patch is required for branch
2.3. As you may have noticed, this part of code
is different on branch 2.3.  And it seems to work on my test.

Do you have the core dump from kernel crash? If yes, would you please
post the back trace?

Thanks,

Andy

On Sun, May 17, 2015 at 9:41 AM, Alex Wang <alexw at nicira.com> wrote:
> Fwd to Andy,~
>
> On Sun, May 17, 2015 at 4:29 AM, zhangzhiming <zhangzhiming at yunshan.net.cn>
> wrote:
>>
>> Hi,
>>
>> I found one patch was omitted to be pushed to branch-2.3, which leads to
>> double freed skb.
>> Could someone to confirm the patch and submit it to branch-2.3?
>> Thanks!
>>
>> Here is the patch information:
>>
>>
>> commit 867e37ba00091b3e319c4c47c1598f1ae84dd32e
>> Author: Andy Zhou <azhou at nicira.com>
>> Date:   Mon Aug 25 15:18:19 2014 -0700
>>
>>     datapath: Fix recirc bug where skb is double freed.
>>
>>     If recirc action is the last action of a action list, the SKB triggers
>>     the recirc will be freed twice. This patch fixes this bug.
>>
>>     Reported-by: Justin Pettit <jpettit at nicira.com>
>>     Signed-off-by: Andy Zhou <azhou at nicira.com>
>>
>> diff --git a/datapath/actions.c b/datapath/actions.c
>> index ad22467..7f25553 100644
>> --- a/datapath/actions.c
>> +++ b/datapath/actions.c
>> @@ -809,7 +809,16 @@ static int execute_recirc(struct datapath *dp, struct
>> sk_buff *skb,
>>                           const struct nlattr *a, int rem)
>>  {
>>         struct sw_flow_key recirc_key;
>> -       int err;
>> +
>> +       if (!is_skb_flow_key_valid(skb)) {
>> +               int err;
>> +
>> +               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
>> +               if (err)
>> +                       return err;
>> +
>> +       }
>> +       BUG_ON(!is_skb_flow_key_valid(skb));
>>
>>         if (!last_action(a, rem)) {
>>                 /* Recirc action is the not the last action
>> @@ -820,19 +829,9 @@ static int execute_recirc(struct datapath *dp, struct
>> sk_buff *skb,
>>                  * continue on with the rest of the action list. */
>>                 if (!skb)
>>                         return 0;
>> -       }
>>
>> -       if (!is_skb_flow_key_valid(skb)) {
>> -               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
>> -               if (err) {
>> -                       kfree_skb(skb);
>> -                       return err;
>> -               }
>> -       }
>> -       BUG_ON(!is_skb_flow_key_valid(skb));
>> -
>> -       if (!last_action(a, rem))
>>                 flow_key_clone(skb, &recirc_key);
>> +       }
>>
>>         flow_key_set_recirc_id(skb, nla_get_u32(a));
>>         ovs_dp_process_packet(skb, true);
>> @@ -897,6 +896,12 @@ static int do_execute_actions(struct datapath *dp,
>> struct sk_buff *skb,
>>
>>                 case OVS_ACTION_ATTR_RECIRC:
>>                         err = execute_recirc(dp, skb, a, rem);
>> +                       if (last_action(a, rem)) {
>> +                               /* If this is the last action, the skb has
>> +                                * been consumed or freed.
>> +                                * Return immediately. */
>> +                               return err;
>> +                       }
>>                         break;
>>
>>                 case OVS_ACTION_ATTR_SET:
>>
>> ________________________________
>> Jeremy Zhang
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150524/350af1aa/attachment-0001.html>

From ddesimon at cisco.com  Fri May 22 12:11:46 2015
From: ddesimon at cisco.com (Dave DeSimone (ddesimon))
Date: Fri, 22 May 2015 19:11:46 +0000
Subject: [ovs-discuss] LLDP support on openvswitch
In-Reply-To: <20150522191000.GG30148@nicira.com>
References: <D17A35F6.18A0FA%ddesimon@cisco.com>
 <D17B5F0A.18A276%ddesimon@cisco.com> <20150515181031.GA14637@nicira.com>
 <D17BB16E.18A33F%ddesimon@cisco.com> <20150515233429.GC14637@nicira.com>
 <D17F667F.18A5FB%ddesimon@cisco.com> <20150518235408.GC6582@nicira.com>
 <D1841C82.18C29D%ddesimon@cisco.com> <20150522191000.GG30148@nicira.com>
Message-ID: <D184F7A9.18C509%ddesimon@cisco.com>

Thanks Ben! I¹ll keep digging.

On 5/22/15, 3:10 PM, "Ben Pfaff" <blp at nicira.com> wrote:

>On Fri, May 22, 2015 at 03:45:54AM +0000, Dave DeSimone (ddesimon) wrote:
>> Just a fundamental question, that I¹m not understanding.
>> 
>> Here is my bridge
>> 
>>     Bridge "br0"
>>         Port "br0"
>>             Interface "br0"
>>                 type: internal
>>         Port "enp130s0f0"
>>             Interface "enp130s0f0"
>>         Port "mgmt0"
>>             Interface "mgmt0"
>>                 type: internal
>> 
>> 
>> mgmt0 is carrying the ip address.
>> 
>> I¹ve added a flow with this:
>> 
>> ovs-ofctl add-flow br0 dl_type=0x88cc,action=flood
>> 
>> 
>> 
>> When I dump the flows, I see pkts
>> 
>> ovs-ofctl dump-flows br0
>> 	NXST_FLOW reply (xid=0x4):
>> 	cookie=0x0, duration=23254.816s, table=0, n_packets=4647,
>> n_bytes=1329042, idle_age=3, dl_type=0x88cc actions=FLOOD
>> 
>> 
>> 
>> 
>> I also ran tcpdump on the mgmt0 interface and I see the lldp packets
>>there.
>> 
>> 
>> So, it looks like the pkts are coming in on the physical interface
>> (enp130s0f0) and getting sent to the internal interface mgmt0. But the
>> lldp daemon running on the linux os still is not seeing the pkts.
>> 
>> 
>> Is this valid? Why wouldn¹t the lldp process see these packets is they
>> appear on the mgmt0 interface?
>
>If the packets show up in tcpdump on mgmt0, then that means that OVS
>sent them to the device.  Anything that happens beyond that point isn't
>the responsibility of OVS; OVS has no control over it.  In fact, it
>seems likely that the LLDP process receives packets from mgmt0 in the
>same way that tcpdump does, so it is a puzzle to me why it wouldn't see
>them.
>
>I know that's not really very helpful but I don't have experience with
>lldp daemons on Linux so I don't know what else to say.
>
>If you figure out what's going on then I'd be happy to add something to
>the FAQ to explain.


From yangwanli at jd.com  Fri May 22 21:54:16 2015
From: yangwanli at jd.com (yangwanli)
Date: Sat, 23 May 2015 12:54:16 +0800
Subject: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
	interval (365882ms user, 464906ms system)
References: <2015051918320317100434@jd.com>, 
 <CANr6G5zmkv=cgdbMSCes2k_yYaCKGhuLWxiPgB85eYCanyaFKA@mail.gmail.com>
Message-ID: <20150523125416388568139@jd.com>

Thank you for your response!

My servers OS are all  CentOS 6.6,  kernel version: 2.6.32-504.el6.x86_64, vCPU:32,  RAM:256G
#lscpu
Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                32
On-line CPU(s) list:   0-31
Thread(s) per core:    2
Core(s) per socket:    8
Socket(s):             2
NUMA node(s):          2
Vendor ID:             GenuineIntel
CPU family:            6
Model:                 63
Stepping:              2
CPU MHz:               2599.971
BogoMIPS:              5199.24
Virtualization:        VT-x
L1d cache:             32K
L1i cache:             32K
L2 cache:              256K
L3 cache:              20480K
NUMA node0 CPU(s):     0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30
NUMA node1 CPU(s):     1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31

OpenvSwitch kernel module(openvswitch.ko) and user space utilities are all build  I use OpenvSwitch-2.3.1 source (change nothing ) (http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz)
#modinfo openvswitch
/lib/modules/2.6.32-504.el6.x86_64/kernel/net/openvswitch/openvswitch.ko
version:        2.3.1
license:        GPL
description:    Open vSwitch switching datapath
srcversion:     4D7CD38A83A9A4A782F73A1
depends:        libcrc32c
vermagic:       2.6.32-504.el6.x86_64 SMP mod_unload modversions 
parm:           vlan_tso:Enable TSO for VLAN packets (int)

I have 300 servers are all the same hardware , OS and OpenvSwitch-2.3.1.
Since May 15, 2015, There are 6 servers  appear this problem that  when I execute  ovs-ofctl dump-flows br-int , not always reponse,
OVS ports not transmit datas, led to the virtual machines cannot be accessed.
When appear this problem , server load is not high, and while I excute netstat -anp , find some CONNECTING state of unix socket.
I restart ovs-vswitchd and ovdb-server, becames normal.
I doubt the thread dealock of ovs-vswitchd. 

All servers have the following log info:
/var/log/openvswitch/ovs-vswitd.log:
2015-05-18T12:13:04.491Z|00138|coverage|INFO|Event coverage, avg rate over last: 5 seconds, last minute, last hour,  hash=9e13ffc8:
2015-05-18T12:13:04.491Z|00139|coverage|INFO|nln_changed                0.0/sec     0.000/sec        0.0000/sec   total: 21
2015-05-18T12:13:04.491Z|00140|coverage|INFO|netlink_received          59.4/sec    53.850/sec       53.6072/sec   total: 1159232
2015-05-18T12:13:04.491Z|00141|coverage|INFO|netlink_recv_jumbo         3.8/sec     2.767/sec        2.6536/sec   total: 53239
2015-05-18T12:13:04.491Z|00142|coverage|INFO|netlink_sent              68.0/sec    62.783/sec       62.9394/sec   total: 1353375
2015-05-18T12:13:04.491Z|00143|coverage|INFO|netdev_set_policing        0.0/sec     0.000/sec        0.0000/sec   total: 12
2015-05-18T12:13:04.491Z|00144|coverage|INFO|netdev_get_ifindex         0.0/sec     0.000/sec        0.0000/sec   total: 6
2015-05-18T12:13:04.491Z|00145|coverage|INFO|netdev_get_hwaddr          0.0/sec     0.000/sec        0.0000/sec   total: 6
2015-05-18T12:13:04.491Z|00146|coverage|INFO|netdev_set_hwaddr          0.0/sec     0.000/sec        0.0000/sec   total: 3
2015-05-18T12:13:04.491Z|00147|coverage|INFO|netdev_get_ethtool         0.0/sec     0.000/sec        0.0000/sec   total: 22
2015-05-18T12:13:04.491Z|00148|coverage|INFO|netdev_set_ethtool         0.0/sec     0.000/sec        0.0000/sec   total: 4
2015-05-18T12:13:04.491Z|00149|coverage|INFO|vconn_received             2.4/sec     2.000/sec        1.9067/sec   total: 41642
2015-05-18T12:13:04.491Z|00150|coverage|INFO|vconn_sent                 1.8/sec     1.500/sec        1.4300/sec   total: 31228
2015-05-18T12:13:04.491Z|00151|coverage|INFO|util_xalloc              1987.2/sec  1867.150/sec     1817.8008/sec   total: 37808073
2015-05-18T12:13:04.491Z|00152|coverage|INFO|pstream_open               0.0/sec     0.000/sec        0.0000/sec   total: 5
2015-05-18T12:13:04.491Z|00153|coverage|INFO|stream_open                0.0/sec     0.000/sec        0.0000/sec   total: 1
2015-05-18T12:13:04.491Z|00154|coverage|INFO|rconn_queued               1.2/sec     1.000/sec        0.9533/sec   total: 20815
2015-05-18T12:13:04.491Z|00155|coverage|INFO|rconn_sent                 1.2/sec     1.000/sec        0.9533/sec   total: 20815
2015-05-18T12:13:04.491Z|00156|coverage|INFO|poll_fd_wait             537.2/sec   481.217/sec      462.1683/sec   total: 9762985
2015-05-18T12:13:04.491Z|00157|coverage|INFO|poll_zero_timeout          5.2/sec     4.333/sec        3.8581/sec   total: 83823
2015-05-18T12:13:04.491Z|00158|coverage|INFO|txn_unchanged              0.0/sec     0.000/sec        0.0000/sec   total: 11
2015-05-18T12:13:04.491Z|00159|coverage|INFO|txn_incomplete             8.8/sec     8.450/sec        8.3044/sec   total: 170811
2015-05-18T12:13:04.491Z|00160|coverage|INFO|txn_success                0.2/sec     0.200/sec        0.1989/sec   total: 4276
2015-05-18T12:13:04.491Z|00161|coverage|INFO|netdev_get_stats           1.6/sec     1.600/sec        1.5911/sec   total: 32833
2015-05-18T12:13:04.491Z|00162|coverage|INFO|mac_learning_learned       0.2/sec     0.133/sec        0.0686/sec   total: 1595
2015-05-18T12:13:04.491Z|00163|coverage|INFO|mac_learning_expired       0.4/sec     0.150/sec        0.0689/sec   total: 1518
2015-05-18T12:13:04.491Z|00164|coverage|INFO|hmap_pathological          0.0/sec     0.000/sec        0.0000/sec   total: 27
2015-05-18T12:13:04.491Z|00165|coverage|INFO|hmap_expand              102.4/sec    92.300/sec       88.6772/sec   total: 1853939
2015-05-18T12:13:04.491Z|00166|coverage|INFO|flow_extract              23.0/sec    19.883/sec       19.7067/sec   total: 416747
2015-05-18T12:13:04.491Z|00167|coverage|INFO|dpif_port_add              0.0/sec     0.000/sec        0.0000/sec   total: 6
2015-05-18T12:13:04.491Z|00168|coverage|INFO|dpif_flow_flush            0.0/sec     0.000/sec        0.0000/sec   total: 4
2015-05-18T12:13:04.491Z|00169|coverage|INFO|dpif_flow_put              0.0/sec     0.000/sec        0.0000/sec   total: 2
2015-05-18T12:13:04.491Z|00170|coverage|INFO|dpif_flow_del              0.0/sec     0.000/sec        0.0000/sec   total: 1
2015-05-18T12:13:04.491Z|00171|coverage|INFO|dpif_execute               0.0/sec     0.000/sec        0.0000/sec   total: 1
2015-05-18T12:13:04.491Z|00172|coverage|INFO|xlate_actions             38.8/sec    27.317/sec       22.9731/sec   total: 507271
2015-05-18T12:13:04.491Z|00173|coverage|INFO|rev_reconfigure            0.0/sec     0.000/sec        0.0000/sec   total: 20
2015-05-18T12:13:04.491Z|00174|coverage|INFO|rev_port_toggled           0.0/sec     0.000/sec        0.0000/sec   total: 3
2015-05-18T12:13:04.491Z|00175|coverage|INFO|rev_flow_table             0.0/sec     0.000/sec        0.0000/sec   total: 11
2015-05-18T12:13:04.491Z|00176|coverage|INFO|rev_mac_learning           0.6/sec     0.283/sec        0.1286/sec   total: 2813
2015-05-18T12:13:04.491Z|00177|coverage|INFO|ofproto_flush              0.0/sec     0.000/sec        0.0000/sec   total: 3
2015-05-18T12:13:04.491Z|00178|coverage|INFO|ofproto_recv_openflow      1.8/sec     1.500/sec        1.4300/sec   total: 31229
2015-05-18T12:13:04.491Z|00179|coverage|INFO|ofproto_update_port        0.0/sec     0.000/sec        0.0000/sec   total: 34
2015-05-18T12:13:04.491Z|00180|coverage|INFO|bridge_reconfigure         0.0/sec     0.000/sec        0.0000/sec   total: 15
2015-05-18T12:13:04.491Z|00181|coverage|INFO|49 events never hit
2015-05-18T14:59:05.014Z|00182|timeval|WARN|Unreasonably long 2019ms poll interval (43448ms user, 50465ms system)
2015-05-18T14:59:05.014Z|00183|timeval|WARN|faults: 840 minor, 0 major
2015-05-18T14:59:05.014Z|00184|timeval|WARN|disk: 0 reads, 120 writes
2015-05-18T14:59:05.014Z|00185|timeval|WARN|context switches: 2167382 voluntary, 529 involuntary
2015-05-18T14:59:05.014Z|00186|coverage|INFO|Skipping details of duplicate event coverage for hash=9e13ffc8
2015-05-18T17:46:50.578Z|00187|timeval|WARN|Unreasonably long 2018ms poll interval (56724ms user, 65745ms system)
2015-05-18T17:46:50.578Z|00188|timeval|WARN|faults: 841 minor, 0 major
2015-05-18T17:46:50.578Z|00189|timeval|WARN|disk: 0 reads, 128 writes
2015-05-18T17:46:50.578Z|00190|timeval|WARN|context switches: 2853218 voluntary, 538 involuntary
2015-05-18T17:46:50.578Z|00191|coverage|INFO|Skipping details of duplicate event coverage for hash=9e13ffc8
2015-05-18T20:29:36.092Z|00192|timeval|WARN|Unreasonably long 2018ms poll interval (69561ms user, 80775ms system)
2015-05-18T20:29:36.092Z|00193|timeval|WARN|faults: 841 minor, 0 major
2015-05-18T20:29:36.092Z|00194|timeval|WARN|disk: 0 reads, 136 writes
2015-05-18T20:29:36.092Z|00195|timeval|WARN|context switches: 3519924 voluntary, 544 involuntary
2015-05-18T20:29:36.092Z|00196|coverage|INFO|Skipping details of duplicate event coverage for hash=9e13ffc8
2015-05-18T23:21:51.729Z|00197|timeval|WARN|Unreasonably long 2021ms poll interval (83029ms user, 96728ms system)
2015-05-18T23:21:51.729Z|00198|timeval|WARN|faults: 841 minor, 0 major
2015-05-18T23:21:51.729Z|00199|timeval|WARN|disk: 0 reads, 144 writes
2015-05-18T23:21:51.729Z|00200|timeval|WARN|context switches: 4224452 voluntary, 553 involuntary
2015-05-18T23:21:51.729Z|00201|coverage|INFO|Skipping details of duplicate event coverage for hash=9e13ffc8



WanLi Yang
JD.COM 
*****************************************************************
 
From: Joe Stringer
Date: 2015-05-23 05:36
To: yangwanli
CC: bugs
Subject: Re: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll interval (365882ms user, 464906ms system)
On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
> Hi,
> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all virtual
> machines and containers communicate with OVS.
> I use OVS  VLAN.
> OpenvSwitch Version 2.3.1  (nothing change)
> CentOS 6.6
> In the process of I use, encounter the flowing problems.
> Need your help!
>
> 1、ovs-vswitchd.log always report warnings:
>
> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
> interval (365882ms user, 464906ms system)
> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
> voluntary, 2080 involuntary
> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of duplicate
> event coverage for hash=35d02982
> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
> interval (380306ms user, 483259ms system)
> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
> voluntary, 2174 involuntary
> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of duplicate
> event coverage for hash=35d02982
 
The main loop of ovs-vswitchd usually expects to cycle at least once
per second. This message appears when this takes longer than usual,
which may indicate that ovs-vswitchd is under heavy load, or some sort
of bug.
 
>
> 2、I also encounter this problem:
>     when I execute
>     ovs-ofctl dump-flows br-int
>    not always reponse,  but ovs-vsctl show is OK!
 
The main thread of ovs-vswitchd assembles responses to OpenFlow
requests, and given the above messages it sounds like it's busy doing
other things. Ovs-vsctl on the other hand talks to ovsdb-server, which
looks like it is OK in this scenario.
 
These both seem like symptoms, but it's not obvious to me what the
underlying cause is. Is there anything else in the logs? Is
ovs-vswitchd using a lot of CPU?
 
Are you using the OVS kernel module from CentOS or one distributed
with the openvswitch package? ('modinfo openvswitch' should give a
hint here)
 
On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
> Hi,
> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all virtual
> machines and containers communicate with OVS.
> I use OVS  VLAN.
> OpenvSwitch Version 2.3.1  (nothing change)
> CentOS 6.6
> In the process of I use, encounter the flowing problems.
> Need your help!
>
> 1、ovs-vswitchd.log always report warnings:
>
> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
> interval (365882ms user, 464906ms system)
> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
> voluntary, 2080 involuntary
> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of duplicate
> event coverage for hash=35d02982
> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
> interval (380306ms user, 483259ms system)
> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
> voluntary, 2174 involuntary
> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of duplicate
> event coverage for hash=35d02982
>
> 2、I also encounter this problem:
>     when I execute
>     ovs-ofctl dump-flows br-int
>    not always reponse,  but ovs-vsctl show is OK!
>
> Thanks!
> WanLi Yang
>
>
> ________________________________
>
> WanLi Yang
>
> JD.COM
>
> *****************************************************************
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150523/fa373636/attachment-0001.html>

From actionmystique at gmail.com  Sat May 23 02:28:56 2015
From: actionmystique at gmail.com (jean-christophe manciot)
Date: Sat, 23 May 2015 11:28:56 +0200
Subject: [ovs-discuss] Can't read private key & errors while creating bridge
	ports
Message-ID: <CAKcFC3aGbec3ofmX9ZAUoonWZ_urZEnmd1AWNcfEDEqZRDyRaA@mail.gmail.com>

Hello guys,

I'm compiling the sources from git repository:

./boot.sh
...
./configure --with-linux=/lib/modules/`uname -r`/build
...
make
...
sudo checkinstall
...
make modules_install
cd datapath/linux && make modules_install
make[1]: Entering directory
'/home/actionmystique/Program-Files/Ubuntu/OpenvSwicth/git-open-vswitch/datapath/linux'
make -C /lib/modules/3.19.0-18-generic/build
M=/home/actionmystique/Program-Files/Ubuntu/OpenvSwicth/git-open-vswitch/datapath/linux
modules_install
make[2]: Entering directory '/usr/src/linux-headers-3.19.0-18-generic'
  INSTALL
/home/actionmystique/Program-Files/Ubuntu/OpenvSwicth/git-open-vswitch/datapath/linux/openvswitch.ko
*Can't read private key*
  INSTALL
/home/actionmystique/Program-Files/Ubuntu/OpenvSwicth/git-open-vswitch/datapath/linux/vport-geneve.ko
*Can't read private key*
  INSTALL
/home/actionmystique/Program-Files/Ubuntu/OpenvSwicth/git-open-vswitch/datapath/linux/vport-gre.ko
*Can't read private key*
  INSTALL
/home/actionmystique/Program-Files/Ubuntu/OpenvSwicth/git-open-vswitch/datapath/linux/vport-lisp.ko
*Can't read private key*
  INSTALL
/home/actionmystique/Program-Files/Ubuntu/OpenvSwicth/git-open-vswitch/datapath/linux/vport-stt.ko
*Can't read private key*
  INSTALL
/home/actionmystique/Program-Files/Ubuntu/OpenvSwicth/git-open-vswitch/datapath/linux/vport-vxlan.ko
*Can't read private key*
  DEPMOD  3.19.0-18-generic
make[2]: Leaving directory '/usr/src/linux-headers-3.19.0-18-generic'
depmod `sed -n 's/#define UTS_RELEASE "\([^"]*\)"/\1/p'
/lib/modules/3.19.0-18-generic/build/include/generated/utsrelease.h`
make[1]: Leaving directory
'/home/actionmystique/Program-Files/Ubuntu/OpenvSwicth/git-open-vswitch/datapath/linux'

/sbin/modprobe openvswitch
ovsdb-tool create /usr/local/etc/openvswitch/conf.db
/usr/local/share/openvswitch/vswitch.ovsschema
ovs-vsctl --no-wait init
ovs-vswitchd --pidfile --detach
ovs-vsctl add-br ovsbr0

That may explain why there's a warning when I try to create a port:
add-port ovsbr0 eth0
ovs-vsctl: *Error detected while setting up 'eth0*'.  See ovs-vswitchd log
for details.
add-port ovsbr0 eth1
ovs-vsctl: *Error detected while setting up 'eth1*'.  See ovs-vswitchd log
for details.
May 23 11:11:37 msi-ge60 ovs-vsctl: ovs|00001|vsctl|INFO|Called as
ovs-vsctl add-port ovsbr0 eth1
May 23 11:11:37 msi-ge60 ovs-vswitchd: ovs|00015|bridge*|WARN|could not
open network device eth0 (No such device)*
May 23 11:11:37 msi-ge60 ovs-vswitchd: ovs|00016|bridge|*WARN|could not
open network device eth1 (No such device)*

ovs-vsctl list-br
ovsbr0

ovs-vsctl list-ports ovsbr0
eth0
eth1

*Other information:*

*ovs-vswitchd --version*
ovs-vswitchd (Open vSwitch) 2.3.90
Compiled May 23 2015 10:37:19

*git rev-parse HEAD*
8f19f0a70352dfa555cffa4f7f34dab22870dc49

*cat /proc/version*
Linux version 3.19.0-18-generic (buildd at batsu) (gcc version 4.9.2 (Ubuntu
4.9.2-10ubuntu13) ) #18-Ubuntu SMP Tue May 19 18:31:35 UTC 2015
Ubuntu Server 15.04

*cat /usr/local//etc/openvswitch/conf.db*
OVSDB JSON 12805 600d75cac9a8ecc7f1b3d0194813fc9534f5e6b5
{"cksum":"2211824403
22535","name":"Open_vSwitch","version":"7.12.1","tables":{"Controller":{"columns":{"is_connected":{"ephemeral":true,"type":"boolean"},"connection_mode":{"type":{"min":0,"key":{"type":"string","enum":["set",["in-band","out-of-band"]]}}},"local_gateway":{"type":{"min":0,"key":"string"}},"enable_async_messages":{"type":{"min":0,"key":"boolean"}},"other_config":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"status":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"local_netmask":{"type":{"min":0,"key":"string"}},"controller_burst_limit":{"type":{"min":0,"key":{"minInteger":25,"type":"integer"}}},"local_ip":{"type":{"min":0,"key":"string"}},"controller_rate_limit":{"type":{"min":0,"key":{"minInteger":100,"type":"integer"}}},"target":{"type":"string"},"role":{"ephemeral":true,"type":{"min":0,"key":{"type":"string","enum":["set",["master","other","slave"]]}}},"inactivity_probe":{"type":{"min":0,"key":"integer"}},"max_backoff":{"type":{"min":0,"key":{"minInteger":1000,"type":"integer"}}}}},"Bridge":{"indexes":[["name"]],"columns":{"name":{"mutable":false,"type":"string"},"flood_vlans":{"type":{"max":4096,"min":0,"key":{"minInteger":0,"maxInteger":4095,"type":"integer"}}},"auto_attach":{"type":{"min":0,"key":{"type":"uuid","refTable":"AutoAttach"}}},"ports":{"type":{"max":"unlimited","min":0,"key":{"type":"uuid","refTable":"Port"}}},"stp_enable":{"type":"boolean"},"fail_mode":{"type":{"min":0,"key":{"type":"string","enum":["set",["secure","standalone"]]}}},"rstp_enable":{"type":"boolean"},"rstp_status":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"flow_tables":{"type":{"max":"unlimited","min":0,"key":{"minInteger":0,"maxInteger":254,"type":"integer"},"value":{"type":"uuid","refTable":"Flow_Table"}}},"netflow":{"type":{"min":0,"key":{"type":"uuid","refTable":"NetFlow"}}},"datapath_type":{"type":"string"},"controller":{"type":{"max":"unlimited","min":0,"key":{"type":"uuid","refTable":"Controller"}}},"status":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"ipfix":{"type":{"min":0,"key":{"type":"uuid","refTable":"IPFIX"}}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"other_config":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"datapath_id":{"ephemeral":true,"type":{"min":0,"key":"string"}},"mirrors":{"type":{"max":"unlimited","min":0,"key":{"type":"uuid","refTable":"Mirror"}}},"mcast_snooping_enable":{"type":"boolean"},"datapath_version":{"type":"string"},"sflow":{"type":{"min":0,"key":{"type":"uuid","refTable":"sFlow"}}},"protocols":{"type":{"max":"unlimited","min":0,"key":{"type":"string","enum":["set",["OpenFlow10","OpenFlow11","OpenFlow12","OpenFlow13","OpenFlow14","OpenFlow15"]]}}}}},"Queue":{"isRoot":true,"columns":{"other_config":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"dscp":{"type":{"min":0,"key":{"minInteger":0,"maxInteger":63,"type":"integer"}}}}},"Open_vSwitch":{"maxRows":1,"isRoot":true,"columns":{"bridges":{"type":{"max":"unlimited","min":0,"key":{"type":"uuid","refTable":"Bridge"}}},"manager_options":{"type":{"max":"unlimited","min":0,"key":{"type":"uuid","refTable":"Manager"}}},"statistics":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"ovs_version":{"type":{"min":0,"key":"string"}},"other_config":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"cur_cfg":{"type":"integer"},"next_cfg":{"type":"integer"},"ssl":{"type":{"min":0,"key":{"type":"uuid","refTable":"SSL"}}},"iface_types":{"type":{"max":"unlimited","min":0,"key":"string"}},"datapath_types":{"type":{"max":"unlimited","min":0,"key":"string"}},"system_type":{"type":{"min":0,"key":"string"}},"system_version":{"type":{"min":0,"key":"string"}},"db_version":{"type":{"min":0,"key":"string"}}}},"NetFlow":{"columns":{"active_timeout":{"type":{"key":{"minInteger":-1,"type":"integer"}}},"engine_type":{"type":{"min":0,"key":{"minInteger":0,"maxInteger":255,"type":"integer"}}},"engine_id":{"type":{"min":0,"key":{"minInteger":0,"maxInteger":255,"type":"integer"}}},"add_id_to_interface":{"type":"boolean"},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"targets":{"type":{"max":"unlimited","key":"string"}}}},"IPFIX":{"columns":{"cache_active_timeout":{"type":{"min":0,"key":{"minInteger":0,"maxInteger":4200,"type":"integer"}}},"obs_point_id":{"type":{"min":0,"key":{"minInteger":0,"maxInteger":4294967295,"type":"integer"}}},"other_config":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"sampling":{"type":{"min":0,"key":{"minInteger":1,"maxInteger":4294967295,"type":"integer"}}},"targets":{"type":{"max":"unlimited","min":0,"key":"string"}},"cache_max_flows":{"type":{"min":0,"key":{"minInteger":0,"maxInteger":4294967295,"type":"integer"}}},"obs_domain_id":{"type":{"min":0,"key":{"minInteger":0,"maxInteger":4294967295,"type":"integer"}}}}},"QoS":{"isRoot":true,"columns":{"queues":{"type":{"max":"unlimited","min":0,"key":{"minInteger":0,"maxInteger":4294967295,"type":"integer"},"value":{"type":"uuid","refTable":"Queue"}}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"other_config":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"type":{"type":"string"}}},"Port":{"indexes":[["name"]],"columns":{"statistics":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"integer"}},"bond_downdelay":{"type":"integer"},"name":{"mutable":false,"type":"string"},"mac":{"type":{"min":0,"key":"string"}},"fake_bridge":{"type":"boolean"},"trunks":{"type":{"max":4096,"min":0,"key":{"minInteger":0,"maxInteger":4095,"type":"integer"}}},"rstp_status":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"tag":{"type":{"min":0,"key":{"minInteger":0,"maxInteger":4095,"type":"integer"}}},"bond_updelay":{"type":"integer"},"bond_active_slave":{"type":{"min":0,"key":"string"}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"other_config":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"status":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"qos":{"type":{"min":0,"key":{"type":"uuid","refTable":"QoS"}}},"bond_mode":{"type":{"min":0,"key":{"type":"string","enum":["set",["active-backup","balance-slb","balance-tcp"]]}}},"rstp_statistics":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"integer"}},"vlan_mode":{"type":{"min":0,"key":{"type":"string","enum":["set",["access","native-tagged","native-untagged","trunk"]]}}},"interfaces":{"type":{"max":"unlimited","key":{"type":"uuid","refTable":"Interface"}}},"bond_fake_iface":{"type":"boolean"},"lacp":{"type":{"min":0,"key":{"type":"string","enum":["set",["active","off","passive"]]}}}}},"sFlow":{"columns":{"agent":{"type":{"min":0,"key":"string"}},"header":{"type":{"min":0,"key":"integer"}},"polling":{"type":{"min":0,"key":"integer"}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"sampling":{"type":{"min":0,"key":"integer"}},"targets":{"type":{"max":"unlimited","key":"string"}}}},"SSL":{"maxRows":1,"columns":{"bootstrap_ca_cert":{"type":"boolean"},"private_key":{"type":"string"},"certificate":{"type":"string"},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"ca_cert":{"type":"string"}}},"Flow_Sample_Collector_Set":{"isRoot":true,"indexes":[["id","bridge"]],"columns":{"id":{"type":{"key":{"minInteger":0,"maxInteger":4294967295,"type":"integer"}}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"ipfix":{"type":{"min":0,"key":{"type":"uuid","refTable":"IPFIX"}}},"bridge":{"type":{"key":{"type":"uuid","refTable":"Bridge"}}}}},"Mirror":{"columns":{"name":{"type":"string"},"select_all":{"type":"boolean"},"output_vlan":{"type":{"min":0,"key":{"minInteger":1,"maxInteger":4095,"type":"integer"}}},"statistics":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"integer"}},"select_dst_port":{"type":{"max":"unlimited","min":0,"key":{"refType":"weak","type":"uuid","refTable":"Port"}}},"select_src_port":{"type":{"max":"unlimited","min":0,"key":{"refType":"weak","type":"uuid","refTable":"Port"}}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"output_port":{"type":{"min":0,"key":{"refType":"weak","type":"uuid","refTable":"Port"}}},"select_vlan":{"type":{"max":4096,"min":0,"key":{"minInteger":0,"maxInteger":4095,"type":"integer"}}}}},"Flow_Table":{"columns":{"name":{"type":{"min":0,"key":"string"}},"prefixes":{"type":{"max":3,"min":0,"key":"string"}},"groups":{"type":{"max":"unlimited","min":0,"key":"string"}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"overflow_policy":{"type":{"min":0,"key":{"type":"string","enum":["set",["evict","refuse"]]}}},"flow_limit":{"type":{"min":0,"key":{"minInteger":0,"type":"integer"}}}}},"Interface":{"indexes":[["name"]],"columns":{"statistics":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"integer"}},"mac":{"type":{"min":0,"key":"string"}},"options":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"bfd_status":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"cfm_health":{"ephemeral":true,"type":{"min":0,"key":{"minInteger":0,"maxInteger":100,"type":"integer"}}},"ofport":{"type":{"min":0,"key":"integer"}},"admin_state":{"ephemeral":true,"type":{"min":0,"key":{"type":"string","enum":["set",["down","up"]]}}},"error":{"type":{"min":0,"key":"string"}},"cfm_fault_status":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string"}},"lacp_current":{"ephemeral":true,"type":{"min":0,"key":"boolean"}},"mtu":{"ephemeral":true,"type":{"min":0,"key":"integer"}},"ofport_request":{"type":{"min":0,"key":{"minInteger":1,"maxInteger":65279,"type":"integer"}}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"status":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"link_state":{"ephemeral":true,"type":{"min":0,"key":{"type":"string","enum":["set",["down","up"]]}}},"cfm_remote_opstate":{"ephemeral":true,"type":{"min":0,"key":{"type":"string","enum":["set",["down","up"]]}}},"cfm_fault":{"ephemeral":true,"type":{"min":0,"key":"boolean"}},"link_speed":{"ephemeral":true,"type":{"min":0,"key":"integer"}},"duplex":{"ephemeral":true,"type":{"min":0,"key":{"type":"string","enum":["set",["full","half"]]}}},"ingress_policing_rate":{"type":{"key":{"minInteger":0,"type":"integer"}}},"name":{"mutable":false,"type":"string"},"cfm_flap_count":{"type":{"min":0,"key":"integer"}},"ifindex":{"ephemeral":true,"type":{"min":0,"key":{"minInteger":0,"maxInteger":4294967295,"type":"integer"}}},"type":{"type":"string"},"mac_in_use":{"ephemeral":true,"type":{"min":0,"key":"string"}},"link_resets":{"ephemeral":true,"type":{"min":0,"key":"integer"}},"lldp":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"other_config":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"cfm_remote_mpids":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"integer"}},"bfd":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"cfm_mpid":{"type":{"min":0,"key":"integer"}},"ingress_policing_burst":{"type":{"key":{"minInteger":0,"type":"integer"}}}}},"AutoAttach":{"columns":{"mappings":{"type":{"max":"unlimited","min":0,"key":{"minInteger":0,"maxInteger":16777215,"type":"integer"},"value":{"minInteger":0,"maxInteger":4095,"type":"integer"}}},"system_name":{"type":"string"},"system_description":{"type":"string"}}},"Manager":{"indexes":[["target"]],"columns":{"is_connected":{"ephemeral":true,"type":"boolean"},"connection_mode":{"type":{"min":0,"key":{"type":"string","enum":["set",["in-band","out-of-band"]]}}},"other_config":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"external_ids":{"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"status":{"ephemeral":true,"type":{"max":"unlimited","min":0,"key":"string","value":"string"}},"target":{"type":"string"},"inactivity_probe":{"type":{"min":0,"key":"integer"}},"max_backoff":{"type":{"min":0,"key":{"minInteger":1000,"type":"integer"}}}}}}}
OVSDB JSON 132 0de244567cc0e520570126360aa5306cbbc76ed1
{"_date":1430671863845,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{}},"_comment":"ovs-vsctl:
ovs-vsctl --no-wait init"}
OVSDB JSON 255 e8d60b9f34e93e26b1118ca3e2443e3f43777820
{"_date":1430671881129,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"datapath_types":["set",["netdev","system"]],"iface_types":["set",["geneve","gre","gre64","internal","ipsec_gre","ipsec_gre64","lisp","patch","stt","system","tap","vxlan"]]}}}
OVSDB JSON 541 0b21bdee54007ffed64ac3962582bb7a1a93ffdd
{"Port":{"50bdd10b-7615-4eaf-8532-687b4c77e9be":{"name":"ovsbr0","interfaces":["uuid","43910b49-546a-4dc1-904a-2e3b01bd2b93"]}},"Interface":{"43910b49-546a-4dc1-904a-2e3b01bd2b93":{"name":"ovsbr0","type":"internal"}},"_date":1430672183002,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"name":"ovsbr0","ports":["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"]}},"_comment":"ovs-vsctl:
ovs-vsctl add-br
ovsbr0","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"bridges":["uuid","a455396d-4119-416d-9e9f-4ecdef31169b"],"next_cfg":1}}}
OVSDB JSON 164 218b0b1ba6226755b609b730470585a849a5e67e
{"Interface":{"43910b49-546a-4dc1-904a-2e3b01bd2b93":{"ofport":65534}},"_date":1430672183059,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":1}}}
OVSDB JSON 104 22716114606175fc6144c5e5e07df7cd61e5263a
{"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"datapath_version":"2.3.90"}},"_date":1430672183059}
OVSDB JSON 510 665901be2bf909c54083f8a014003138609923a6
{"Interface":{"9b2126af-c930-480f-b56f-1d13b8a780f7":{"name":"eth0"}},"Port":{"704d2cce-9330-4ff0-b5cb-d02bf590501a":{"name":"eth0","interfaces":["uuid","9b2126af-c930-480f-b56f-1d13b8a780f7"]}},"_date":1430672200291,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["set",[["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"],["uuid","704d2cce-9330-4ff0-b5cb-d02bf590501a"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl add-port ovsbr0
eth0","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":2}}}
OVSDB JSON 223 4c3cbc92e12584bf370bcbb7d898654b235a8c16
{"Interface":{"9b2126af-c930-480f-b56f-1d13b8a780f7":{"ofport":-1,*"error":"could
not open network device eth0 (No such device)"*
}},"_date":1430672200293,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":2}}}
OVSDB JSON 558 b6e11a46634996705a635c263815202e749d089f
{"Port":{"cc95dfa2-e901-4f54-a7bb-eb5965c72547":{"name":"eth1","interfaces":["uuid","7f1e2f61-a69b-4331-a2f2-669d9f9b8bd8"]}},"Interface":{"7f1e2f61-a69b-4331-a2f2-669d9f9b8bd8":{"name":"eth1"}},"_date":1430672663237,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["set",[["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"],["uuid","704d2cce-9330-4ff0-b5cb-d02bf590501a"],["uuid","cc95dfa2-e901-4f54-a7bb-eb5965c72547"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl add-port ovsbr0
eth1","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":3}}}
OVSDB JSON 223 c9a07282d1c03e86370e8700cb2bf5bead85c9d6
{"Interface":{"7f1e2f61-a69b-4331-a2f2-669d9f9b8bd8":{"ofport":-1,*"error":"could
not open network device eth1 (No such device)"*
}},"_date":1430672663244,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":3}}}
OVSDB JSON 606 bb52f0cb47b415835a4270a77e4d8e846ba4c753
{"Interface":{"69770abf-bfa5-486b-bc59-78916061cde4":{"name":"eth5"}},"Port":{"464df008-ed2e-4cdf-92c2-4f10837e6542":{"name":"eth5","interfaces":["uuid","69770abf-bfa5-486b-bc59-78916061cde4"]}},"_date":1430672669189,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["set",[["uuid","464df008-ed2e-4cdf-92c2-4f10837e6542"],["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"],["uuid","704d2cce-9330-4ff0-b5cb-d02bf590501a"],["uuid","cc95dfa2-e901-4f54-a7bb-eb5965c72547"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl add-port ovsbr0
eth5","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":4}}}
OVSDB JSON 223 e1faed6e5aff45a25a189b6ddc311d33ecf456b4
{"Interface":{"69770abf-bfa5-486b-bc59-78916061cde4":{"ofport":-1,*"error":"could
not open network device eth5 (No such device)"}*
},"_date":1430672669201,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":4}}}
OVSDB JSON 475 152077ccfe330bacf411607cbb446f14b762e974
{"Interface":{"9b2126af-c930-480f-b56f-1d13b8a780f7":null},"Port":{"704d2cce-9330-4ff0-b5cb-d02bf590501a":null},"_date":1430672701020,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["set",[["uuid","464df008-ed2e-4cdf-92c2-4f10837e6542"],["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"],["uuid","cc95dfa2-e901-4f54-a7bb-eb5965c72547"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl del-port ovsbr0
eth0","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":5}}}
OVSDB JSON 94 d34ccd4b5a6e21475cfff40c7baa378dc7b83e6e
{"_date":1430672701024,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":5}}}
OVSDB JSON 427 f56fe7ebc723230eaade0e6faf867e641d50f990
{"Interface":{"7f1e2f61-a69b-4331-a2f2-669d9f9b8bd8":null},"Port":{"cc95dfa2-e901-4f54-a7bb-eb5965c72547":null},"_date":1430672703160,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["set",[["uuid","464df008-ed2e-4cdf-92c2-4f10837e6542"],["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl del-port ovsbr0
eth1","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":6}}}
OVSDB JSON 94 6b66f7b9af83246c215133583edd052a6d387dfe
{"_date":1430672703164,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":6}}}
OVSDB JSON 369 df73ad723b157eb72bbac03dfe3bdd8aca71ba60
{"Interface":{"69770abf-bfa5-486b-bc59-78916061cde4":null},"Port":{"464df008-ed2e-4cdf-92c2-4f10837e6542":null},"_date":1430672705024,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"]}},"_comment":"ovs-vsctl:
ovs-vsctl del-port ovsbr0
eth5","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":7}}}
OVSDB JSON 94 7d96058f0e65eedf1c2cf1e74e6ea4a5d32ad532
{"_date":1430672705025,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":7}}}
OVSDB JSON 510 add981d1f614e9de5e1c396c62ad6fceceb278e6
{"Interface":{"6eeb73d3-277e-448d-9305-49b24bb92324":{"name":"eth0"}},"Port":{"d77d8cf5-3049-414c-a0c8-2b6567e9e585":{"name":"eth0","interfaces":["uuid","6eeb73d3-277e-448d-9305-49b24bb92324"]}},"_date":1430673013651,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["set",[["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"],["uuid","d77d8cf5-3049-414c-a0c8-2b6567e9e585"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl add-port ovsbr0
eth0","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":8}}}
OVSDB JSON 223 75f401b060936e5e16b5c8acbb2a8591a22dce22
{"Interface":{"6eeb73d3-277e-448d-9305-49b24bb92324":{"ofport":-1,*"error":"could
not open network device eth0 (No such device)"}*
},"_date":1430673013654,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":8}}}
OVSDB JSON 369 a59d396a5ec66440596fc44c837030713643a2df
{"Interface":{"6eeb73d3-277e-448d-9305-49b24bb92324":null},"Port":{"d77d8cf5-3049-414c-a0c8-2b6567e9e585":null},"_date":1430674479907,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"]}},"_comment":"ovs-vsctl:
ovs-vsctl del-port ovsbr0
eth0","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":9}}}
OVSDB JSON 94 4172af3390c2dd6a9dd31f32280485ce1bbfdefb
{"_date":1430674479909,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":9}}}
OVSDB JSON 511 37ddb2c463bf2f27de82c87de97282c43cb8811c
{"Port":{"02e2b006-6ac2-4ce9-ad41-69ac23e4bf2e":{"name":"eth0","interfaces":["uuid","8d7a425c-32a1-40a7-970c-ad629a786ab5"]}},"Interface":{"8d7a425c-32a1-40a7-970c-ad629a786ab5":{"name":"eth0"}},"_date":1430674486213,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["set",[["uuid","02e2b006-6ac2-4ce9-ad41-69ac23e4bf2e"],["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl add-port ovsbr0
eth0","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":10}}}
OVSDB JSON 224 cadeb8ce849c7a4988a2327286f261f910cb6ed9
{"Interface":{"8d7a425c-32a1-40a7-970c-ad629a786ab5":{"ofport":-1,*"error":"could
not open network device eth0 (No such device)*
"}},"_date":1430674486216,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":10}}}
OVSDB JSON 559 d09b2bc5300eb332deb2862ec3f8b2f9d7eff1fe
{"Interface":{"1e388ad0-af78-472b-8293-903d5944af49":{"name":"eth1"}},"Port":{"db7a1178-e980-4125-a05b-060069a8342e":{"name":"eth1","interfaces":["uuid","1e388ad0-af78-472b-8293-903d5944af49"]}},"_date":1432372297897,"Bridge":{"a455396d-4119-416d-9e9f-4ecdef31169b":{"ports":["set",[["uuid","02e2b006-6ac2-4ce9-ad41-69ac23e4bf2e"],["uuid","50bdd10b-7615-4eaf-8532-687b4c77e9be"],["uuid","db7a1178-e980-4125-a05b-060069a8342e"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl add-port ovsbr0
eth1","Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"next_cfg":11}}}
OVSDB JSON 224 d699142edcde71e0ff0266364b4c9b82536f678a
{"Interface":{"1e388ad0-af78-472b-8293-903d5944af49":{"ofport":-1,*"error":"could
not open network device eth1 (No such device)"*
}},"_date":1432372297906,"Open_vSwitch":{"a6604c21-9a29-46d9-a812-bbecc74387ec":{"cur_cfg":11}}}

*ovs-dpctl show*
system at ovs-system:
lookups: hit:0 missed:0 lost:0
flows: 0
masks: hit:0 total:0 hit/pkt:0.00
port 0: ovs-system (internal)
port 1: ovsbr0 (internal)

What should be done to solve/workaround these issues?
-- 
Jean-Christophe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150523/897f7560/attachment-0001.html>

From cvinllen at gmail.com  Mon May 25 08:10:06 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Mon, 25 May 2015 23:10:06 +0800
Subject: [ovs-discuss] How to show group table and of1.3 table ?
Message-ID: <CAN2QyzYtqPF1anXA6W_i9ZN-=qEO_9e_y0+00ZrvTtWJ+2buag@mail.gmail.com>

Hi, Dear all:

    I want to kown how to use ovs-ofctl to dump the group table and all
of1.3 table like "port", "vlan", "mac", "unicast" ?

    Greate appreciate for anyone's reply.

Best Regards,
Vinllen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150525/d591d694/attachment.html>

From jayachandran.subramanian at wipro.com  Sun May 24 23:01:02 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Mon, 25 May 2015 06:01:02 +0000
Subject: [ovs-discuss] Openvswitch Bug for open flow version 1.2
In-Reply-To: <20150508160043.GA22853@nicira.com>
References: <SINPR03MB331540BA20CD83BA915F9E395D00@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150507232832.GN25694@nicira.com>
 <SINPR03MB3316815B5FE95AAF1C16B2595DE0@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150508160043.GA22853@nicira.com>
Message-ID: <SINPR03MB3315AA3A3C03B022595296A95CD0@SINPR03MB331.apcprd03.prod.outlook.com>

Hi Ben ,

Thank you for your mail , also we have identified that all groups test cases (Github oftest suite) failing with openvswitch with the below ofp message.

ofp.OFPGMFC_UNKNOWN_GROUP
ofp.OFPGMFC_LOOP

 Openvswitch version : openvswitch - 2.3.1
 OS version                    : Ubuntu 14.04 Trusty
 Open flow version      : 1.2

Is there any work around to fix this issue .

Thanks
Jayachandran S


-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com]
Sent: 08 May 2015 21:31
To: Jayachandran Subramanian (WT01 - PES)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] Openvswitch Bug for open flow version 1.2

I believe you reported the following:

        1. An OpenFlow switch should report an OFPGMFC_INVALID_GROUP
           error in response to an "add-group" message with an invalid
           group_id.

        2. OVS does not report such an error.

However, as I said, OVS does report such an error in my testing, so I cannot reproduce the problem.

On Fri, May 08, 2015 at 05:33:23AM +0000, jayachandran.subramanian at wipro.com wrote:
> Hi Ben Pfaff,
>
> Thank you for confirming the issue . Please let me know is there any fix for this bug .
>
> Thanks
> Jayachandran S
> +91-8861883300
>
>
>
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: 08 May 2015 04:59
> To: Jayachandran Subramanian (WT01 - PES)
> Cc: bugs at openvswitch.org
> Subject: Re: [ovs-discuss] Openvswitch Bug for open flow version 1.2
>
> On Wed, May 06, 2015 at 06:33:32AM +0000, jayachandran.subramanian at wipro.com wrote:
> > Hi ,
> >
> > I would like to report a bug for OpenVSwitch while running OFtest
> > script with openflow version 1.2 and please find the details below
> >
> > Openvswitch version : openvswitch - 2.3.1
> > OS version                    : Ubuntu 14.04 Ttusty
> > Open flow version      : 1.2
> >
> > I have executed the  GitHub open flow 1.2 version script in openvswitch and observed that script is failing and unable to match the ofp message for eg . (OFPET_GROUP_MOD_FAILED/OFPGMFC_INVALID_GROUP) .
> >
> > When we are commenting these lines in the script , script successfully passed.
> >
> > And the same script passed without adding /deleting in the script
> > with Ericsson (of12softswitch)
>
> I do get the expected error with OVS 2.3.1 here:
>
>     blp at sigsegv:~/ovs/tutorial$ ovs-ofctl -O OpenFlow11 add-group br0 group_id=all,type=all,buckets=output:1
>     OFPT_ERROR (OF1.1) (xid=0x2): OFPGMFC_INVALID_GROUP
>     OFPT_GROUP_MOD (OF1.1) (xid=0x2):
>      ADD group_id=4294967292,type=all,bucket=actions=output:1
>     blp at sigsegv:~/ovs/tutorial$
> The information contained in this electronic message and any
> attachments to this message are intended for the exclusive use of the
> addressee(s) and may contain proprietary, confidential or privileged
> information. If you are not the intended recipient, you should not
> disseminate, distribute or copy this e-mail. Please notify the sender
> immediately and destroy all copies of this message and any
> attachments. WARNING: Computer viruses can be transmitted via email.
> The recipient should check this email and any attachments for the
> presence of viruses. The company accepts no liability for any damage
> caused by any virus transmitted by this email. www.wipro.com
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com

From haleema.s.mahmood at gmail.com  Mon May 25 01:26:42 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Mon, 25 May 2015 13:26:42 +0500
Subject: [ovs-discuss] Priority Queues for OVS QoS
Message-ID: <CAN-u-60ckjdSE07+4X6o7WM=vm_0eKQr8jHrh4gWfHamiJipUQ@mail.gmail.com>

Hi,

I was wondering if we could use priority queues instead of linux-htb in ovs
QoS?

Is it possible? If no, can you please explain why?

Best Regards,
Haleema
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150525/09f46b74/attachment-0001.html>

From Leon.Bruckman at ecitele.com  Mon May 25 05:15:43 2015
From: Leon.Bruckman at ecitele.com (Leon Bruckman)
Date: Mon, 25 May 2015 12:15:43 +0000
Subject: [ovs-discuss] NSH support
Message-ID: <VI1PR03MB1119CDBA5E164F2FCABE15E1EBCD0@VI1PR03MB1119.eurprd03.prod.outlook.com>

I understand that NSH support in OVS is provided for an OVS version that branched a while ago from the main OVS tree. Am I wrong ? Does this mean that if I want OVS with NSH support I will lose advanced OVS patches and features ?
Thanks,
Leon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150525/b2a299be/attachment-0001.html>

From s03.deldar at gmail.com  Mon May 25 05:10:09 2015
From: s03.deldar at gmail.com (saeidehdeldar)
Date: Mon, 25 May 2015 16:40:09 +0430
Subject: [ovs-discuss] emergency question about openvswitch code
Message-ID: <93589ED6-F113-48DC-95D1-BD458AC205E3@gmail.com>

dear sir
> I am Saeideh Deldar a student at the Amirkabir polytechnic university,Tehran,Iran.
> I want to Implementation our paper('A Flow Entry management scheme for reducing controller overhead'). I'm asking for your help.
> what controller you use?
> explain about code openvswitch and function in ofproto.c & ofproto-dpif.c?!
> 
> Thank you
> Best regards
>  
> 

Sent from my iPhone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150525/2257693f/attachment-0001.html>

From jpettit at nicira.com  Mon May 25 10:31:13 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 25 May 2015 10:31:13 -0700
Subject: [ovs-discuss] emergency question about openvswitch code
In-Reply-To: <93589ED6-F113-48DC-95D1-BD458AC205E3@gmail.com>
References: <93589ED6-F113-48DC-95D1-BD458AC205E3@gmail.com>
Message-ID: <CCA246BE-8A4C-4399-B638-E44DC8EE706A@nicira.com>


> On May 25, 2015, at 5:10 AM, saeidehdeldar <s03.deldar at gmail.com> wrote:
> 
> dear sir
>> I am Saeideh Deldar a student at the Amirkabir polytechnic university,Tehran,Iran.
>> I want to Implementation our paper('A Flow Entry management scheme for reducing controller overhead'). I'm asking for your help.
>> what controller you use?
>> explain about code openvswitch and function in ofproto.c & ofproto-dpif.c?!

I don't have time to get into all the details, but I've attached some slides from a presentation I did a few years ago that describe the architecture and how the main components fit together.  The main take away is:

	- ofproto implements an OpenFlow switch and provides an interface for software and hardware switches
	- ofproto-dpif is an instance of an ofproto, and it provides an interface for software switches that don't have TCAMs and need flows that can be efficiently looked up in software

In the presentation, I refer to dpif as exploding entries into exact match.  This was before megaflows, so it now explodes them into megaflows, which allow some wildcarding.  If you want to get into the nit-gritty of that, I'd recommend looking at our NSDI paper:

	http://openvswitch.org/support/papers/nsdi2015.pdf

I hope that helps.

--Justin


-------------- next part --------------
A non-text attachment was scrubbed...
Name: OVS Dev.pdf
Type: application/pdf
Size: 182171 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150525/34e1844c/attachment-0001.pdf>
-------------- next part --------------




From jpettit at nicira.com  Mon May 25 10:44:49 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 25 May 2015 10:44:49 -0700
Subject: [ovs-discuss] NSH support
In-Reply-To: <VI1PR03MB1119CDBA5E164F2FCABE15E1EBCD0@VI1PR03MB1119.eurprd03.prod.outlook.com>
References: <VI1PR03MB1119CDBA5E164F2FCABE15E1EBCD0@VI1PR03MB1119.eurprd03.prod.outlook.com>
Message-ID: <A5C22854-30D7-41FD-AFF4-29D2D025CDD5@nicira.com>


> On May 25, 2015, at 5:15 AM, Leon Bruckman <Leon.Bruckman at ecitele.com> wrote:
> 
> I understand that NSH support in OVS is provided for an OVS version that branched a while ago from the main OVS tree. Am I wrong ? Does this mean that if I want OVS with NSH support I will lose advanced OVS patches and features ?

Yes, that branch will have whatever OVS code was current at the point of the branch.  From a quick look, it appears that the branch happened about a year ago.

--Justin



From blp at nicira.com  Mon May 25 12:49:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 25 May 2015 12:49:10 -0700
Subject: [ovs-discuss] Priority Queues for OVS QoS
In-Reply-To: <CAN-u-60ckjdSE07+4X6o7WM=vm_0eKQr8jHrh4gWfHamiJipUQ@mail.gmail.com>
References: <CAN-u-60ckjdSE07+4X6o7WM=vm_0eKQr8jHrh4gWfHamiJipUQ@mail.gmail.com>
Message-ID: <20150525194910.GA28242@nicira.com>

On Mon, May 25, 2015 at 01:26:42PM +0500, Haleema Sadia wrote:
> I was wondering if we could use priority queues instead of linux-htb in ovs
> QoS?
> 
> Is it possible? If no, can you please explain why?

This is addressed by the FAQ:

### Q: I'd like to take advantage of some QoS feature that Open vSwitch
   doesn't yet support.  How do I do that?

A: Open vSwitch does not implement QoS itself.  Instead, it can
   configure some, but not all, of the QoS features built into the
   Linux kernel.  If you need some QoS feature that OVS cannot
   configure itself, then the first step is to figure out whether
   Linux QoS supports that feature.  If it does, then you can submit a
   patch to support Open vSwitch configuration for that feature, or
   you can use "tc" directly to configure the feature in Linux.  (If
   Linux QoS doesn't support the feature you want, then first you have
   to add that support to Linux.)

From blp at nicira.com  Mon May 25 13:15:47 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 25 May 2015 13:15:47 -0700
Subject: [ovs-discuss] How to show group table and of1.3 table ?
In-Reply-To: <CAN2QyzYtqPF1anXA6W_i9ZN-=qEO_9e_y0+00ZrvTtWJ+2buag@mail.gmail.com>
References: <CAN2QyzYtqPF1anXA6W_i9ZN-=qEO_9e_y0+00ZrvTtWJ+2buag@mail.gmail.com>
Message-ID: <20150525201547.GC28242@nicira.com>

On Mon, May 25, 2015 at 11:10:06PM +0800, Vinllen Chen wrote:
>     I want to kown how to use ovs-ofctl to dump the group table and all
> of1.3 table like "port", "vlan", "mac", "unicast" ?

ovs-ofctl has commands to do this.  The manpage documents it.

From liw at dtdream.com  Mon May 25 17:32:29 2015
From: liw at dtdream.com (=?UTF-8?B?6ZKi6ZSBMDMxMA==?=)
Date: Tue, 26 May 2015 08:32:29 +0800
Subject: [ovs-discuss] =?utf-8?b?562U5aSN77ya562U5aSN77ya562U5aSN77yaIA==?=
 =?utf-8?b?562U5aSN77yaIEZvciBoZWxwIGFib3V0IHNzaCBiZXR3ZWVuIHZtcyB0aHJv?=
 =?utf-8?q?ugh_ovs-dkdp?=
In-Reply-To: f3dfc212-0182-47ba-ad48-28a6a40ee040@dtdream.com
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>,
 BC0FEEC7D7650749874CEC11314A88F730756C25@IRSMSX104.ger.corp.intel.com
 <b9c723b0-b032-48cf-adcc-2f83ba3376f4@dtdream.com>,
 555D72CE.8030203@linux.vnet.ibm.com
 <8400ab49-856a-4562-a6ea-bab10cac7c47@dtdream.com>,
 555D7641.9020808@linux.vnet.ibm.com
 <7a83258c-ba18-4647-bc1e-9d8c43376ae4@dtdream.com>,
 555D7A2C.7060901@linux.vnet.ibm.com,
 f3dfc212-0182-47ba-ad48-28a6a40ee040@dtdream.com
Message-ID: <----P3------meVv3$28e8da0a-22b2-44e3-9694-849cbb2abc8b@dtdream.com>

i find a mail  http://lists.freebsd.org/pipermail/freebsd-net/2015-January/040812.html
In that mail,virio drive add 12byte,
For instance, your
guest kernel can offload the TCP checksum to the virtio-net device,
which in turn uses the virtio-net header (that requires TAP driver
support) to postpone the checksum to the host kernel. If packets
arrive to a physical NIC that supports checksum offloading (e.g. a
r8169 NIC attached to the same bridge to which the TAP is attached),
you have effectively offloaded the checksum computation from the guest
kernel straight to the physical NIC in the physical host.


In my experiment  the tcp packet from vm to host has be added 12bytes,  so host can't interpret itit looks like the same Does the vhost-cuse consider the 12bytes?How should i do for skip the 12bytes?udp id ok  only tcp is bad *********************RTFSC*********************------------------------------------------------------------------发件人：钢锁0310 <liw at dtdream.com>发送时间：2015年5月21日(星期四) 14:47收件人：gowrishankar <gowrishankar.m at linux.vnet.ibm.com>，discuss <discuss at openvswitch.org>，通天晓0280 <dongj at dtdream.com>主　题：答复：答复：答复：[ovs-discuss] 答复： For help about ssh between vms through ovs-dkdpsorry  my fault  tap0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500        inet6 fe80::c469:e6ff:fe78:d30f  prefixlen 64  scopeid 0x20<link>        ether c6:69:e6:78:d3:0f  txqueuelen 500  (Ethernet)        RX packets 0  bytes 0 (0.0 B)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 0  bytes 0 (0.0 B)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0tap1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500        inet6 fe80::3c73:6cff:fe7a:49c3  prefixlen 64  scopeid 0x20<link>        ether 3e:73:6c:7a:49:c3  txqueuelen 500  (Ethernet)        RX packets 0  bytes 0 (0.0 B)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 0  bytes 0 (0.0 B)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0no packet stat  in tap0 and tap1    neither to tcpdump -vvv -ni tap0but ping is work[root at 25 ~]# ovs-ofctl dump-flows br0NXST_FLOW reply (xid=0x4): cookie=0x0, duration=536.513s, table=0, n_packets=207, n_bytes=18734, idle_age=0, in_port=1 actions=output:2 cookie=0x0, duration=536.512s, table=0, n_packets=200, n_bytes=18440, idle_age=0, in_port=2 actions=output:1 cookie=0x0, duration=551.217s, table=0, n_packets=8, n_bytes=648, idle_age=434, priority=0 actions=NORMAL[root at 25 ~]# ovs-ofctl dump-ports br0OFPST_PORT reply (xid=0x2): 3 ports  port LOCAL: rx pkts=8, bytes=648, drop=0, errs=0, frame=0, over=0, crc=0           tx pkts=0, bytes=0, drop=0, errs=0, coll=0  port  1: rx pkts=213, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?           tx pkts=214, bytes=?, drop=0, errs=?, coll=?  port  2: rx pkts=206, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?           tx pkts=199, bytes=?, drop=22, errs=?, coll=?the stat of ovs is ok*********************RTFSC*********************------------------------------------------------------------------发件人：gowrishankar <gowrishankar.m at linux.vnet.ibm.com>发送时间：2015年5月21日(星期四) 14:26收件人：钢锁0310 <liw at dtdream.com>主　题：Re: 答复：答复：[ovs-discuss] 答复： For help about ssh between vms through ovs-dkdpI think this is same as what you shared
      earlier in ML i.e captured from inside VM2.
      Or correct me if I am wrong.
      I wanted to see running tcpdump -vvv -ni vnet0 from host (for eg,
      vnet0 is vnic of guest VM1
      and connected to your ovs-dpdk switch as I hope).
      Could that be possible. You may please include ML in CC as well,
      if others also could help if some more
      traces there this time.
      Regards,
      Gowrishankar
      On Thursday 21 May 2015 11:43 AM, 钢锁0310 wrote:
        
        
          
        the screen picture  above
        
          
        *********************
        RTFSC
        *********************
        
          
        ------------------------------------------------------------------发件人：gowrishankar
              <gowrishankar.m at linux.vnet.ibm.com>发送时间：2015年5月21日(星期四) 14:08收件人：钢锁0310 <liw at dtdream.com>主　题：Re: 答复：[ovs-discuss] 答复： For help about
              ssh between vms through ovs-dkdp
            May be, you could share
            tcpdump -vvv for us to infer anything else (from host).
           Regards, Gowrishankar
           On Thursday 21 May 2015
            11:31 AM, 钢锁0310 wrote:
              the tcp state on vm
                which run ssh is SYNSEND
              
              
              VMs`csum is off
              
              
              the target vm catch
                wrong packet still    
              
              
              *********************
              RTFSC
              *********************
              
              
              ------------------------------------------------------------------发件人：gowrishankar <gowrishankar.m at linux.vnet.ibm.com>发送时间：2015年5月21日(星期
                  四) 13:55收件人：钢锁0310 <liw at dtdream.com>抄　送：discuss <discuss at openvswitch.org>主　题：Re:
                  [ovs-discuss] 答复： For help about ssh between vms
                  through ovs-dkdp
                tcpdump from host
                  on guest's vnic could help ? See if 3way handshake
                  completes.
                 Also, check if
                  csum correct on packets from guest (tcpdump -vvv).
                 Regards, Gowrishankar
                 On Thursday 21 May
                  2015 10:37 AM, 钢锁0310 wrote:
                    ovs log:
                    2015-05-21T04:46:37.941Z|00023|connmgr|INFO|br0<->unix: 1 flow_mods in the last 0 s (1 adds)
2015-05-21T04:46:38.604Z|00024|connmgr|INFO|br0<->unix: 1 flow_mods in the last 0 s (1 adds)
2015-05-21T04:48:42.692Z|00001|dpdk(cuse_thread3)|INFO|vHost Device 'tap0' (0) has been added
2015-05-21T04:48:51.750Z|00002|dpdk(cuse_thread3)|INFO|vHost Device 'tap1' (1) has been added
                    
                    
                    
                    qemu create tap
                      with default name 'tap[id]'         adding port to
                      ovs is ok    ping is work
                    
                    
                    and i add
                      options
'csum=off,gso=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=off'
                    
                    
                    in guset    ethtool -k eth0
                    
                    
                    
                    all things is
                      off but     
                    
                    
                    ssh is still
                      not work    
                    
                    
                    qemu 2.3.0
                    dpdk 2.0.0
                    ovs   compiled
                      by git master
                    
                    
                    the OS of host
                      and guest both are
 'Linux 25.dpdk 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux'
                    
                    
                    *********************
                    RTFSC
                    *********************
                    
                    
                    ------------------------------------------------------------------发件人：Traynor,
                        Kevin <kevin.traynor at intel.com>发送时间：2015年5月
                        20日(星期 三) 22:21收件人：Daniele
                        Di Proietto <diproiettod at vmware.com>，
                        钢锁0310 <liw at dtdream.com>抄　送：通天晓0280 <dongj at dtdream.com>，discuss
                        <discuss at openvswitch.org>主　题：RE:
                        [ovs-discuss] For help about ssh between vms
                        through ovs-dkdp
                      
                      > -----Original Message-----> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]> Sent: Wednesday, May 20, 2015 1:47 PM> To: 钢锁
                        0310> Cc: 通天晓
                        0280; discuss; Traynor, Kevin> Subject: Re: [ovs-discuss] For help about ssh between vms through ovs-dkdp> > This might be related to offloading features.> > Could you try again with this qemu "-device" option and let us know?> -device> virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off,g> uest_ecn=off
                      I checked this previously and the DPDK vhost lib will report those featuresas not available during negotiation so you should be ok with not specifyingthem explicitly in the qemu cmd line. I haven't tested with qemu 2.3.
                      > > > Kevin, do you this we should mention this in INSTALL.DPDk.md?
                      I had changed the original patch to make it optional in 3a based on feedbackfrom Michael Tsirkin and testing. So unless we find an issue, I'd prefer toleave optional. https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#dpdk-vhost-vm-configuration
                      > > > On 20/05
                        /2015 10:39, "钢锁0310" <liw at dtdream.com> wrote:> > >i build the vm-ovsdpdk-vm environment by using vhost-cuse> >> >> >the cmd is following> >> >> >ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev> >ovs-vsctl add-port br0 tap0 -- set Interface tap0 type=dpdkvhost> >ovs-vsctl add-port br0 tap1 -- set Interface tap1 type=dpdkvhost> >> >qemu-system-x86_64 cirros.img -m 2G -vnc :1 -object> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa> >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on> >-device virtio-net-pci,netdev=net1> >qemu-system-x86_64 cirros.img -m 2G -vnc :2 -object> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on -numa> >node,memdev=mem -mem-prealloc -netdev type=tap,id=net1,script=no,vhost=on> >-device virtio-net-pci,netdev=net1
                      You are not specifying the ifname on the command line. What does thevswitchd.log say regarding the adding/removing of vhost ports?e.g. |INFO|vHost Device 'dpdkvhost1' (1) has been added
                      > >> ># add ovs flow> >ovs-ofctl add-flow br0 in_port=1,action:output=2> >ovs-ofctl add-flow br0 in_port=2,action:output=1> >> >> >mac of vm1 is 00:00:00:00:00:01   vm2 is 00:00:00:00:00:02> >> >> >ping form vm1 to vm2 is ok, but ssh is not ok> >> >> >On vm1 run ssh to vm2,   Run tcpdump on vm2,  the catching packet as> >follow> >> >> >> >it seems the packets is all wrong> >> >> >Anyone meet this situation?
                      What kernel version are you using in the guest? There is a known DPDK issuewith 3.19.5 in the guest when using the kernel to fwd pkts. The fix for itis here: http://dpdk.org/ml/archives/dev/2015-May/017251.html
                      > >> >> >*********************> >RTFSC> >*********************> >> >> >
                      
                  
                  
                  _______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

                
                
            
          
          -- 
Regards,
Gowrishankar M
Linux Networking
      -- 
Regards,
Gowrishankar M
Linux Networking
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150526/500bd2e0/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: att001.png
Type: application/octet-stream
Size: 2277 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150526/500bd2e0/attachment-0001.obj>

From zhangzhiming at yunshan.net.cn  Tue May 26 06:18:10 2015
From: zhangzhiming at yunshan.net.cn (ZHANG Zhiming)
Date: Tue, 26 May 2015 21:18:10 +0800
Subject: [ovs-discuss] one patch was omitted to be pushed to
	branch-2.3---datapath: Fix recirc bug where skb is double freed
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>, 
 <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>
Message-ID: <201505262118086030330@yunshan.net.cn>

Hi Andy,

Is this the patch for the bug I found?

Thanks a lot!



[ovs-dev] [PATCH] ofproto/bond: Fix a race condition in updating post recirculation rules
Andy Zhou Tue, 17 Feb 2015 13:27:17 -0800
When updating post recirc rules, rule management requires calls to
hmap APIs, which requires proper locking to ensure mutual exclsion in
accessing the hmap internal data structure. The locking currently is
missing from the output_normal() xlate path, thus causing
a race condition.
The race condition leads to segfault crash of ovs-vswitchd, with the
following stack trace:

The crash was found by adding and deleting bond interfaces repeatedly
with on-going traffic hitting the bond interfaces.  The same test was
ran over multiple days with this patch to ensure the same crash was
not seen.

The patch added the necessary lock annotation that would have caught
the bug.

Reported-by: Salvator Cambria <salvatore.camb... at citrix.com>
Signed-off-by: Andy Zhou <az... at nicira.com>
---
 ofproto/bond.c | 16 +++++++++++++---
 1 file changed, 13 insertions(+), 3 deletions(-)

diff --git a/ofproto/bond.c b/ofproto/bond.c
index c4b3a3a..89979a0 100644
--- a/ofproto/bond.c
+++ b/ofproto/bond.c
@@ -320,6 +320,7 @@ add_pr_rule(struct bond *bond, const struct match *match,
 
 static void
 update_recirc_rules(struct bond *bond)
+    OVS_REQ_WRLOCK(rwlock)
 {
     struct match match;
     struct bond_pr_rule_op *pr_op, *next_op;
@@ -923,8 +924,9 @@ bond_may_recirc(const struct bond *bond, uint32_t 
*recirc_id,
     }
 }
 
-void
-bond_update_post_recirc_rules(struct bond* bond, const bool force)
+static void
+bond_update_post_recirc_rules__(struct bond* bond, const bool force)
+    OVS_REQ_WRLOCK(rwlock)
 {
    struct bond_entry *e;
    bool update_rules = force;  /* Always update rules if caller forces it. */
@@ -945,6 +947,14 @@ bond_update_post_recirc_rules(struct bond* bond, const 
bool force)
         update_recirc_rules(bond);
    }
 }
+
+void
+bond_update_post_recirc_rules(struct bond* bond, const bool force)
+{
+    ovs_rwlock_wrlock(&rwlock);
+    bond_update_post_recirc_rules__(bond, force);
+    ovs_rwlock_unlock(&rwlock);
+}
 
 /* Rebalancing. */
 
@@ -1203,7 +1213,7 @@ bond_rebalance(struct bond *bond)
     }
 
     if (use_recirc && rebalanced) {
-        bond_update_post_recirc_rules(bond,true);
+        bond_update_post_recirc_rules__(bond,true);
     }
 
 done:
-- 
1.9.1




ZHANG Zhiming
Yunshan Networks

From: Andy Zhou
Date: 2015-05-23 04:41
To: Alex Wang
CC: zhangzhiming; discuss
Subject: Re: [ovs-discuss] one patch was omitted to be pushed to branch-2.3---datapath: Fix recirc bug where skb is double freed
Hi, Jeremy,

Sorry for the delay. I don't think this patch is required for branch
2.3. As you may have noticed, this part of code
is different on branch 2.3.  And it seems to work on my test.

Do you have the core dump from kernel crash? If yes, would you please
post the back trace?

Thanks,

Andy

On Sun, May 17, 2015 at 9:41 AM, Alex Wang <alexw at nicira.com> wrote:
> Fwd to Andy,~
>
> On Sun, May 17, 2015 at 4:29 AM, zhangzhiming <zhangzhiming at yunshan.net.cn>
> wrote:
>>
>> Hi,
>>
>> I found one patch was omitted to be pushed to branch-2.3, which leads to
>> double freed skb.
>> Could someone to confirm the patch and submit it to branch-2.3?
>> Thanks!
>>
>> Here is the patch information:
>>
>>
>> commit 867e37ba00091b3e319c4c47c1598f1ae84dd32e
>> Author: Andy Zhou <azhou at nicira.com>
>> Date:   Mon Aug 25 15:18:19 2014 -0700
>>
>>     datapath: Fix recirc bug where skb is double freed.
>>
>>     If recirc action is the last action of a action list, the SKB triggers
>>     the recirc will be freed twice. This patch fixes this bug.
>>
>>     Reported-by: Justin Pettit <jpettit at nicira.com>
>>     Signed-off-by: Andy Zhou <azhou at nicira.com>
>>
>> diff --git a/datapath/actions.c b/datapath/actions.c
>> index ad22467..7f25553 100644
>> --- a/datapath/actions.c
>> +++ b/datapath/actions.c
>> @@ -809,7 +809,16 @@ static int execute_recirc(struct datapath *dp, struct
>> sk_buff *skb,
>>                           const struct nlattr *a, int rem)
>>  {
>>         struct sw_flow_key recirc_key;
>> -       int err;
>> +
>> +       if (!is_skb_flow_key_valid(skb)) {
>> +               int err;
>> +
>> +               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
>> +               if (err)
>> +                       return err;
>> +
>> +       }
>> +       BUG_ON(!is_skb_flow_key_valid(skb));
>>
>>         if (!last_action(a, rem)) {
>>                 /* Recirc action is the not the last action
>> @@ -820,19 +829,9 @@ static int execute_recirc(struct datapath *dp, struct
>> sk_buff *skb,
>>                  * continue on with the rest of the action list. */
>>                 if (!skb)
>>                         return 0;
>> -       }
>>
>> -       if (!is_skb_flow_key_valid(skb)) {
>> -               err = ovs_flow_key_update(skb, OVS_CB(skb)->pkt_key);
>> -               if (err) {
>> -                       kfree_skb(skb);
>> -                       return err;
>> -               }
>> -       }
>> -       BUG_ON(!is_skb_flow_key_valid(skb));
>> -
>> -       if (!last_action(a, rem))
>>                 flow_key_clone(skb, &recirc_key);
>> +       }
>>
>>         flow_key_set_recirc_id(skb, nla_get_u32(a));
>>         ovs_dp_process_packet(skb, true);
>> @@ -897,6 +896,12 @@ static int do_execute_actions(struct datapath *dp,
>> struct sk_buff *skb,
>>
>>                 case OVS_ACTION_ATTR_RECIRC:
>>                         err = execute_recirc(dp, skb, a, rem);
>> +                       if (last_action(a, rem)) {
>> +                               /* If this is the last action, the skb has
>> +                                * been consumed or freed.
>> +                                * Return immediately. */
>> +                               return err;
>> +                       }
>>                         break;
>>
>>                 case OVS_ACTION_ATTR_SET:
>>
>> ________________________________
>> Jeremy Zhang
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150526/420a6912/attachment-0001.html>

From fbl at sysclose.org  Tue May 26 06:58:20 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Tue, 26 May 2015 10:58:20 -0300
Subject: [ovs-discuss] How implent ACL rule in 'out' direction.
In-Reply-To: <CACRYWpv0kUHV4NGdOs=YUEpYD8RGVW3fOUc6q0UDzBc4a9EpMw@mail.gmail.com>
References: <CACRYWpv0kUHV4NGdOs=YUEpYD8RGVW3fOUc6q0UDzBc4a9EpMw@mail.gmail.com>
Message-ID: <20150526135820.GA2504@x240.home>

On Wed, May 13, 2015 at 07:38:02AM +0800, Huanle Han wrote:
> Hi, guys
> I'm working with ovs in normal mode.
> 
> I have a question about the implent ACL rule in 'out' direction.
> For example, How can I implement such rules using ovs flow table?
> 
> Rule 1: deny the flow whose tp_dst==22 output to VIF1, but permit to other
> VIFs

if you mean action NORMAL then that is not possible because once the
action is executed, the packet is forwarded to the ports and you have
no control over that.

> Rule 2: permit the flow whose nw_src==1.1.1.1 output to VIF2, but deny to
> other VIFs

I am afraid you will need to implement the action normal features
adding your restrictions yourself. Look at the Tutorial.md for
how to implement MAC-learning.

fbl



From awang10 at masonlive.gmu.edu  Mon May 25 10:34:41 2015
From: awang10 at masonlive.gmu.edu (awang10 at masonlive.gmu.edu)
Date: Mon, 25 May 2015 17:34:41 +0000
Subject: [ovs-discuss] help  - Datapath megaflow issues
In-Reply-To: <1432312356344.10902@masonlive.gmu.edu>
References: <1432312356344.10902@masonlive.gmu.edu>
Message-ID: <1432575285564.49892@masonlive.gmu.edu>


?
Hi, All,

I'm trying to figure out how datapath mega flows are generated. So I did a very simple experiment on openvswitch 2.3.0. I inserted a rule ovs-ofctl add-flow br0 in_port=2,ip,nw_dst=192.168.2.2/16,actions=output:1<http://192.168.2.2/16,actions=output:1> to the userspace flow table. And I used ovs-appctl dpif/dump-flows br0 to check the flows in datapath flow table and this is what I observed.

skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:00:39:d3:34:3b),eth_type(0x0800),ipv4(src=192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=62/0,frag=no/0xff<http://192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=62/0,frag=no/0xff>), packets:26670724, bytes:1762573766, used:0.000s, flags:SR., actions:2
skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:50:56:49:01:29),eth_type(0x0800),ipv4(src=192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=63/0,frag=no/0xff<http://192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=63/0,frag=no/0xff>), packets:9469993, bytes:586123740, used:0.000s, flags:SF., actions:2

Somehow it seems that the ip dst field is not wildcarded at all. And I've repeated the experiment for several times using different prefix and I obtained the same result. Could anyone please explain why this happened and how wildcarded flows are supported in the datapath?

p.s. I configured the dpdk openvswitch, not sure whether that's why the wildcard doesn't work in datapath.

I'd really appreciate your help!
?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150525/0d88e519/attachment.html>

From fichera.sil at gmail.com  Tue May 26 03:11:32 2015
From: fichera.sil at gmail.com (Silvia Fichera)
Date: Tue, 26 May 2015 12:11:32 +0200
Subject: [ovs-discuss] Connect OVS to a VM
Message-ID: <CAEFdjR092jKVWKqUj8oo18hyWNgmEvWRWH6LgjhSbhW2Wvu1Yw@mail.gmail.com>

Hi all,
maybe mine is a silly question but it's getting me crazy!
My university gave me five VMs in a server to make some experiments with
OpenStack+OpendayLight.
So I have:
vm1 -> ODL Controller
vm2 -> OpenStack Controller
vm3 / vm4 -> Compute nodes
vm5 -> OVS

TO configure my environment I've followed the ODL's wiki about VTN, but I
still do not understand how to attach the VMs that represent the compute
nodes  to the switch.
 I have already set the Controller ODL (in fact with 'sudo ovs-vsctl
get-controller bridge' I can see the IP address and the port of my
controller). My problem remains how to connect my hosts  that are VM to the
OVS.

If you need more clarification about the environment, please ask.

Thank you for your help.
Regards,
-- 
Silvia Fichera
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150526/39d20656/attachment.html>

From diproiettod at vmware.com  Tue May 26 10:50:15 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 26 May 2015 17:50:15 +0000
Subject: [ovs-discuss]
 =?utf-8?b?562U5aSN77ya562U5aSN77ya562U5aSN77yaIA==?=
 =?utf-8?b?562U5aSN77yaIEZvciBoZWxwIGFib3V0IHNzaCBiZXR3ZWVuIHZtcyB0aHJv?=
 =?utf-8?q?ugh_ovs-dkdp?=
In-Reply-To: <----P3------meVv3$28e8da0a-22b2-44e3-9694-849cbb2abc8b@dtdream.com>
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>
 <b9c723b0-b032-48cf-adcc-2f83ba3376f4@dtdream.com>
 <8400ab49-856a-4562-a6ea-bab10cac7c47@dtdream.com>
 <7a83258c-ba18-4647-bc1e-9d8c43376ae4@dtdream.com>
 <----P3------meVv3$28e8da0a-22b2-44e3-9694-849cbb2abc8b@dtdream.com>
Message-ID: <D18A6F35.19BD%diproiettod@vmware.com>

We've experienced the same problem during our testing.
Applying the following patch to DPDK seemed to solve
the issue:

http://dpdk.org/ml/archives/dev/2015-May/017919.html

On 26/05/2015 01:32, "钢锁0310" <liw at dtdream.com> wrote:

>i find a mail  
>http://lists.freebsd.org/pipermail/freebsd-net/2015-January/040812.html
>
>
>In that mail,virio drive add 12byte,
>
>For instance, your
>guest kernel can offload the TCP checksum to the virtio-net device,
>which in turn uses the virtio-net header (that requires TAP driver
>support) to postpone the checksum to the host kernel. If packets
>arrive to a physical NIC that supports checksum offloading (e.g. a
>r8169 NIC attached to the same bridge to which the TAP is attached),
>you have effectively offloaded the checksum computation from the guest
>kernel straight to the physical NIC in the physical host.
>In my experiment  the tcp packet from vm to host has be added 12bytes,
>so host can't interpret itit looks like the same Does the vhost-cuse
>consider the 12bytes?How should i do for skip the 12bytes?udp id ok  only
>tcp is bad 
>*********************
>RTFSC
>*********************
>
>
>
>------------------------------------------------------------------
>发件人：钢锁0310 <liw at dtdream.com>
>发送时间：2015年5月21日(星期四) 14:47
>收件人：gowrishankar <gowrishankar.m at linux.vnet.ibm.com>，discuss
><discuss at openvswitch.org>，通天晓0280 <dongj at dtdream.com>
>主　题：答复：答复：答复：[ovs-discuss] 答复： For help about ssh between vms through
>ovs-dkdp
>
>
>sorry  my fault  
>
>
>tap0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>        inet6 fe80::c469:e6ff:fe78:d30f  prefixlen 64  scopeid 0x20<link>
>        ether c6:69:e6:78:d3:0f  txqueuelen 500  (Ethernet)
>        RX packets 0  bytes 0 (0.0 B)
>        RX errors 0  dropped 0  overruns 0  frame 0
>        TX packets 0  bytes 0 (0.0 B)
>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
>
>tap1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>        inet6 fe80::3c73:6cff:fe7a:49c3  prefixlen 64  scopeid 0x20<link>
>        ether 3e:73:6c:7a:49:c3  txqueuelen 500  (Ethernet)
>        RX packets 0  bytes 0 (0.0 B)
>        RX errors 0  dropped 0  overruns 0  frame 0
>        TX packets 0  bytes 0 (0.0 B)
>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
>
>
>
>no packet stat  in tap0 and tap1    neither to tcpdump -vvv -ni tap0
>
>
>but ping is work
>
>
>[root at 25 ~]# ovs-ofctl dump-flows br0
>NXST_FLOW reply (xid=0x4):
> cookie=0x0, duration=536.513s, table=0, n_packets=207, n_bytes=18734,
>idle_age=0, in_port=1 actions=output:2
> cookie=0x0, duration=536.512s, table=0, n_packets=200, n_bytes=18440,
>idle_age=0, in_port=2 actions=output:1
> cookie=0x0, duration=551.217s, table=0, n_packets=8, n_bytes=648,
>idle_age=434, priority=0 actions=NORMAL
>[root at 25 ~]# ovs-ofctl dump-ports br0
>OFPST_PORT reply (xid=0x2): 3 ports
>  port LOCAL: rx pkts=8, bytes=648, drop=0, errs=0, frame=0, over=0, crc=0
>           tx pkts=0, bytes=0, drop=0, errs=0, coll=0
>  port  1: rx pkts=213, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>           tx pkts=214, bytes=?, drop=0, errs=?, coll=?
>  port  2: rx pkts=206, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
>           tx pkts=199, bytes=?, drop=22, errs=?, coll=?
>
>
>
>the stat of ovs is ok
>
>
>*********************
>RTFSC
>*********************
>
>
>------------------------------------------------------------------
>发件人：gowrishankar <gowrishankar.m at linux.vnet.ibm.com>
>发送时间：2015年5月21日(星期四) 14:26
>收件人：钢锁0310 <liw at dtdream.com>
>主　题：Re: 答复：答复：[ovs-discuss] 答复： For help about ssh between vms through
>ovs-dkdp
>
>
>I think this is same as what you shared earlier in ML i.e captured from
>inside VM2.
>Or correct me if I am wrong.
>
>
>I wanted to see running tcpdump -vvv -ni vnet0 from host (for eg, vnet0
>is vnic of guest VM1
>and connected to your ovs-dpdk switch as I hope).
>
>
>Could that be possible. You may please include ML in CC as well, if
>others also could help if some more
>traces there this time.
>
>
>Regards,
>Gowrishankar
>
>
>On Thursday 21 May 2015 11:43 AM, 钢锁0310 wrote:
>
>
>
>
>the screen picture  above
>
>
>*********************
>RTFSC
>*********************
>
>
>
>------------------------------------------------------------------
>发件人：gowrishankar 
><gowrishankar.m at linux.vnet.ibm.com>
><mailto:gowrishankar.m at linux.vnet.ibm.com>
>发送时间：2015年5月21日(星期四) 14:08
>收件人：钢锁0310 
><liw at dtdream.com> <mailto:liw at dtdream.com>
>主　题：Re: 答复：[ovs-discuss] 答复： For help about ssh between vms through
>ovs-dkdp
>
>
>May be, you could share tcpdump -vvv for us to infer anything else (from
>host).
>
>
>Regards,
>Gowrishankar
>
>
>On Thursday 21 May 2015 11:31 AM, 钢锁0310 wrote:
>the tcp state on vm which run ssh is SYNSEND
>
>
>VMs`csum is off
>
>
>the target vm catch wrong packet still
>
>
>*********************
>RTFSC
>*********************
>
>
>
>------------------------------------------------------------------
>发件人：gowrishankar 
><gowrishankar.m at linux.vnet.ibm.com>
><mailto:gowrishankar.m at linux.vnet.ibm.com>
>发送时间：2015年5月21日(星期 四) 13:55
>收件人：钢锁0310 
><liw at dtdream.com> <mailto:liw at dtdream.com>
>抄　送：discuss 
><discuss at openvswitch.org> <mailto:discuss at openvswitch.org>
>主　题：Re: [ovs-discuss] 答复： For help about ssh between vms through ovs-dkdp
>
>
>tcpdump from host on guest's vnic could help ? See if 3way handshake
>completes.
>
>
>Also, check if csum correct on packets from guest (tcpdump -vvv).
>
>
>Regards,
>Gowrishankar
>
>
>On Thursday 21 May 2015 10:37 AM, 钢锁0310 wrote:
>ovs log:
>2015-05-21T04:46:37.941Z|00023|connmgr|INFO|br0<->unix: 1 flow_mods in
>the last 0 s (1 adds)
>2015-05-21T04:46:38.604Z|00024|connmgr|INFO|br0<->unix: 1 flow_mods in
>the last 0 s (1 adds)
>2015-05-21T04:48:42.692Z|00001|dpdk(cuse_thread3)|INFO|vHost Device
>'tap0' (0) has been added
>2015-05-21T04:48:51.750Z|00002|dpdk(cuse_thread3)|INFO|vHost Device
>'tap1' (1) has been added
>
>
>
>qemu create tap with default name 'tap[id]'         adding port to ovs is
>ok    ping is work
>
>
>and i add options 
>'csum=off,gso=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=o
>ff'
>
>
>in guset    
>ethtool -k eth0 
>
>
>all things is off but
>
>
>ssh is still not work
>
>
>qemu 2.3.0
>dpdk 2.0.0
>ovs   compiled by git master
>
>
>the OS of host and guest both are  'Linux 25.dpdk 3.10.0-229.el7.x86_64
>#1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux'
>
>
>*********************
>RTFSC
>*********************
>
>
>
>------------------------------------------------------------------
>发件人：Traynor, Kevin
><kevin.traynor at intel.com> <mailto:kevin.traynor at intel.com>
>发送时间：2015年5月 20日(星期 三) 22:21
>收件人：Daniele Di Proietto
><diproiettod at vmware.com> <mailto:diproiettod at vmware.com>， 钢锁0310
><liw at dtdream.com> <mailto:liw at dtdream.com>
>抄　送：通天晓0280 
><dongj at dtdream.com> <mailto:dongj at dtdream.com>，discuss
><discuss at openvswitch.org> <mailto:discuss at openvswitch.org>
>主　题：RE: [ovs-discuss] For help about ssh between vms through ovs-dkdp
>
>
>
>
>> -----Original Message-----
>> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
>> Sent: Wednesday, May 20, 2015 1:47 PM
>> To: 钢锁 0310
>> Cc: 通天晓 0280; discuss; Traynor, Kevin
>> Subject: Re: [ovs-discuss] For help about ssh between vms through
>>ovs-dkdp
>> 
>> This might be related to offloading features.
>> 
>> Could you try again with this qemu "-device" option and let us know?
>> -device
>> 
>>virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off
>>,g
>> uest_ecn=off
>
>
>I checked this previously and the DPDK vhost lib will report those
>features
>as not available during negotiation so you should be ok with not
>specifying
>them explicitly in the qemu cmd line. I haven't tested with qemu 2.3.
>
>
>> 
>> 
>> Kevin, do you this we should mention this in INSTALL.DPDk.md?
>
>
>I had changed the original patch to make it optional in 3a based on
>feedback
>from Michael Tsirkin and testing. So unless we find an issue, I'd prefer
>to
>leave optional. 
>https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#dpdk-vhost-
>vm-configuration 
><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswit
>ch_ovs_blob_master_INSTALL.DPDK.md-23dpdk-2Dvhost-2Dvm-2Dconfiguration&d=B
>QMFaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_
>Cw5yUNjxgD4v5kJqZ2uWLlE&m=uyMUTwlAFqpkT9D3pmPQi1LFOOG-ByD1htMGkp5eXLc&s=Ob
>AhVG4R4gABevsLZVIKFuJ1snNlK84wH5JIFHmMX0o&e=>
>
>
>> 
>> 
>> On 20/05 /2015 10:39, "钢锁0310" <liw at dtdream.com>
>><mailto:liw at dtdream.com> wrote:
>> 
>> >i build the vm-ovsdpdk-vm environment by using vhost-cuse
>> >
>> >
>> >the cmd is following
>> >
>> >
>> >ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
>> >ovs-vsctl add-port br0 tap0 -- set Interface tap0 type=dpdkvhost
>> >ovs-vsctl add-port br0 tap1 -- set Interface tap1 type=dpdkvhost
>> >
>> >qemu-system-x86_64 cirros.img -m 2G -vnc :1 -object
>> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on
>>-numa
>> >node,memdev=mem -mem-prealloc -netdev
>>type=tap,id=net1,script=no,vhost=on
>> >-device virtio-net-pci,netdev=net1
>> >qemu-system-x86_64 cirros.img -m 2G -vnc :2 -object
>> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on
>>-numa
>> >node,memdev=mem -mem-prealloc -netdev
>>type=tap,id=net1,script=no,vhost=on
>> >-device virtio-net-pci,netdev=net1
>
>
>You are not specifying the ifname on the command line. What does the
>vswitchd.log say regarding the adding/removing of vhost ports?
>e.g. |INFO|vHost Device 'dpdkvhost1' (1) has been added
>
>
>> >
>> ># add ovs flow
>> >ovs-ofctl add-flow br0 in_port=1,action:output=2
>> >ovs-ofctl add-flow br0 in_port=2,action:output=1
>> >
>> >
>> >mac of vm1 is 00:00:00:00:00:01   vm2 is 00:00:00:00:00:02
>> >
>> >
>> >ping form vm1 to vm2 is ok, but ssh is not ok
>> >
>> >
>> >On vm1 run ssh to vm2,   Run tcpdump on vm2,  the catching packet as
>> >follow
>> >
>> >
>> >
>> >it seems the packets is all wrong
>> >
>> >
>> >Anyone meet this situation?
>
>
>What kernel version are you using in the guest? There is a known DPDK
>issue
>with 3.19.5 in the guest when using the kernel to fwd pkts. The fix for it
>is here: http://dpdk.org/ml/archives/dev/2015-May/017251.html
><https://urldefense.proofpoint.com/v2/url?u=http-3A__dpdk.org_ml_archives_
>dev_2015-2DMay_017251.html&d=BQMFaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMN
>tXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=uyMUTwlAFqpkT9D3pm
>PQi1LFOOG-ByD1htMGkp5eXLc&s=arX_2ZgEhNr8lPRr4LSZ2xlbzjvNSgIjq3k_e14OiDI&e=
>>
>
>
>> >
>> >
>> >*********************
>> >RTFSC
>> >*********************
>> >
>> >
>> >
>
>
>
>
>
>
>
>
>
>_______________________________________________
>discuss mailing list
>discuss at openvswitch.orghttp://openvswitch.org/mailman/listinfo/discuss
><https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_mailm
>an_listinfo_discuss&d=BQMFaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs
>&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=uyMUTwlAFqpkT9D3pmPQi1LFO
>OG-ByD1htMGkp5eXLc&s=4nNAuidLaEB358dGzxHZdMhXNbvM9Gi-C5JHG9Y3ye0&e=>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>-- 
>Regards,
>Gowrishankar M
>Linux Networking
>
>
>
>
>
>
>
>
>-- 
>Regards,
>Gowrishankar M
>Linux Networking
>
>
>
>


From jpettit at nicira.com  Tue May 26 13:17:01 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 26 May 2015 13:17:01 -0700
Subject: [ovs-discuss] Connect OVS to a VM
In-Reply-To: <CAEFdjR092jKVWKqUj8oo18hyWNgmEvWRWH6LgjhSbhW2Wvu1Yw@mail.gmail.com>
References: <CAEFdjR092jKVWKqUj8oo18hyWNgmEvWRWH6LgjhSbhW2Wvu1Yw@mail.gmail.com>
Message-ID: <CE3CFAEB-5CF2-4A6A-AD9A-3489E278DA27@nicira.com>


> On May 26, 2015, at 3:11 AM, Silvia Fichera <fichera.sil at gmail.com> wrote:
> 
> Hi all,
> maybe mine is a silly question but it's getting me crazy!
> My university gave me five VMs in a server to make some experiments with OpenStack+OpendayLight.
> So I have:
> vm1 -> ODL Controller
> vm2 -> OpenStack Controller
> vm3 / vm4 -> Compute nodes
> vm5 -> OVS
> 
> TO configure my environment I've followed the ODL's wiki about VTN, but I still do not understand how to attach the VMs that represent the compute nodes  to the switch.
>  I have already set the Controller ODL (in fact with 'sudo ovs-vsctl get-controller bridge' I can see the IP address and the port of my controller). My problem remains how to connect my hosts  that are VM to the OVS.
> 
> If you need more clarification about the environment, please ask.

You'll need to get interfaces from v3 and v4 into vm5.  Once you have that, you just need to use "ovs-vsctl add-port" to make them work with OVS.  I don't know enough about your environment to know how you'll plumb those compute nodes' interfaces into the VM, since it is going to be platform-dependent.  Normally, the OVS would be running in the hypervisor, which would then have access to the VMs' VIFs directly.

--Justin



From awang10 at masonlive.gmu.edu  Tue May 26 13:46:20 2015
From: awang10 at masonlive.gmu.edu (awang10 at masonlive.gmu.edu)
Date: Tue, 26 May 2015 20:46:20 +0000
Subject: [ovs-discuss] Datapath megaflow issues
In-Reply-To: <1432575285564.49892@masonlive.gmu.edu>
References: <1432312356344.10902@masonlive.gmu.edu>,
 <1432575285564.49892@masonlive.gmu.edu>
Message-ID: <BN3PR0101MB09459DAB3926F0E161EF0F63E6CC0@BN3PR0101MB0945.prod.exchangelabs.com>

________________________________
发件人: awang10 at masonlive.gmu.edu
发送时间: 2015年5月26日 1:34:41
收件人: discuss at openvswitch.org
主题: help - Datapath megaflow issues



?
Hi, All,

I'm trying to figure out how datapath mega flows are generated. So I did a very simple experiment on openvswitch 2.3.0. I inserted a rule ovs-ofctl add-flow br0 in_port=2,ip,nw_dst=192.168.2.2/16,actions=output:1<http://192.168.2.2/16,actions=output:1> to the userspace flow table. And I used ovs-appctl dpif/dump-flows br0 to check the flows in datapath flow table and this is what I observed.

skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:00:39:d3:34:3b),eth_type(0x0800),ipv4(src=192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=62/0,frag=no/0xff<http://192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=62/0,frag=no/0xff>), packets:26670724, bytes:1762573766, used:0.000s, flags:SR., actions:2
skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:50:56:49:01:29),eth_type(0x0800),ipv4(src=192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=63/0,frag=no/0xff<http://192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=63/0,frag=no/0xff>), packets:9469993, bytes:586123740, used:0.000s, flags:SF., actions:2

Somehow it seems that the ip dst field is not wildcarded at all. And I've repeated the experiment for several times using different prefix and I obtained the same result. Could anyone please explain why this happened and how wildcarded flows are supported in the datapath?

p.s. I configured the dpdk openvswitch, not sure whether that's why the wildcard doesn't work in datapath.

I'd really appreciate your help!
?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150526/496b091f/attachment.html>

From pshelar at nicira.com  Tue May 26 14:02:51 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Tue, 26 May 2015 14:02:51 -0700
Subject: [ovs-discuss] Multiple MPLS label pushing?
In-Reply-To: <CAPv_OZDi-HfS5VKf=opvKP6UigMCdMtX48p5eGJ8gbxZKY9dUQ@mail.gmail.com>
References: <CAPv_OZDi-HfS5VKf=opvKP6UigMCdMtX48p5eGJ8gbxZKY9dUQ@mail.gmail.com>
Message-ID: <CALnjE+pwHp=Y9NVQby7L+fvxpVjtjFduOrSWvD0yc9iqBsv+Zw@mail.gmail.com>

On Fri, May 22, 2015 at 6:09 AM, Shao-You Wu 吳少友 <s54088.cs98 at g2.nctu.edu.tw
> wrote:

> Hi all,
>
> I've tried to push/pop MPLS labels on the packets, but currently, ovs only
> supports "3 MPLS label pushing".
> I need longer MPLS label stack.
>
> -------------------
> Related code segments in "lib/flow.h":
> #L76
> /* Maximum number of supported MPLS labels. */
> #define FLOW_MAX_MPLS_LABELS 3
> #L158
> BUILD_ASSERT_DECL(offsetof(struct flow, igmp_group_ip4) + sizeof(uint32_t)
> == sizeof(struct flow_tnl) + 192
> -------------------
>
> I changed FLOW_MAX_MPLS_LABELS from 3 to another bigger value (saying,
> 9),
> added additional 24 bytes ( (9-3)x4 = 24 ) in the end of line 158,
> and re-built the ovs.
>
> Unfortunately, it still supports only 3 stacked MPLS labels.
> Does anyone knows what else I should do?
>

What error do you see after the rebuild?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150526/c8a80bd4/attachment.html>

From joestringer at nicira.com  Tue May 26 14:05:06 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Tue, 26 May 2015 14:05:06 -0700
Subject: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
 interval (365882ms user, 464906ms system)
In-Reply-To: <20150523125416388568139@jd.com>
References: <2015051918320317100434@jd.com>
 <CANr6G5zmkv=cgdbMSCes2k_yYaCKGhuLWxiPgB85eYCanyaFKA@mail.gmail.com>
 <20150523125416388568139@jd.com>
Message-ID: <CANr6G5wcbH3as0s1hSvyifr5-2SQDYkFDgJs=u8ZCL4Mnhy3FQ@mail.gmail.com>

Are you using STP?

On 22 May 2015 at 21:54, yangwanli <yangwanli at jd.com> wrote:
> Thank you for your response!
>
> My servers OS are all  CentOS 6.6,  kernel version: 2.6.32-504.el6.x86_64,
> vCPU:32,  RAM:256G
> #lscpu
> Architecture:          x86_64
> CPU op-mode(s):        32-bit, 64-bit
> Byte Order:            Little Endian
> CPU(s):                32
> On-line CPU(s) list:   0-31
> Thread(s) per core:    2
> Core(s) per socket:    8
> Socket(s):             2
> NUMA node(s):          2
> Vendor ID:             GenuineIntel
> CPU family:            6
> Model:                 63
> Stepping:              2
> CPU MHz:               2599.971
> BogoMIPS:              5199.24
> Virtualization:        VT-x
> L1d cache:             32K
> L1i cache:             32K
> L2 cache:              256K
> L3 cache:              20480K
> NUMA node0 CPU(s):     0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30
> NUMA node1 CPU(s):     1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31
>
> OpenvSwitch kernel module(openvswitch.ko) and user space utilities are all
> build  I use OpenvSwitch-2.3.1 source (change nothing )
> (http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz)
> #modinfo openvswitch
> /lib/modules/2.6.32-504.el6.x86_64/kernel/net/openvswitch/openvswitch.ko
> version:        2.3.1
> license:        GPL
> description:    Open vSwitch switching datapath
> srcversion:     4D7CD38A83A9A4A782F73A1
> depends:        libcrc32c
> vermagic:       2.6.32-504.el6.x86_64 SMP mod_unload modversions
> parm:           vlan_tso:Enable TSO for VLAN packets (int)
>
> I have 300 servers are all the same hardware , OS and OpenvSwitch-2.3.1.
> Since May 15, 2015, There are 6 servers  appear this problem that  when I
> execute  ovs-ofctl dump-flows br-int , not always reponse,
> OVS ports not transmit datas, led to the virtual machines cannot be
> accessed.
> When appear this problem , server load is not high, and while I excute
> netstat -anp , find some CONNECTING state of unix socket.
> I restart ovs-vswitchd and ovdb-server, becames normal.
> I doubt the thread dealock of ovs-vswitchd.
>
> All servers have the following log info:
> /var/log/openvswitch/ovs-vswitd.log:
> 2015-05-18T12:13:04.491Z|00138|coverage|INFO|Event coverage, avg rate over
> last: 5 seconds, last minute, last hour,  hash=9e13ffc8:
> 2015-05-18T12:13:04.491Z|00139|coverage|INFO|nln_changed
> 0.0/sec     0.000/sec        0.0000/sec   total: 21
> 2015-05-18T12:13:04.491Z|00140|coverage|INFO|netlink_received
> 59.4/sec    53.850/sec       53.6072/sec   total: 1159232
> 2015-05-18T12:13:04.491Z|00141|coverage|INFO|netlink_recv_jumbo
> 3.8/sec     2.767/sec        2.6536/sec   total: 53239
> 2015-05-18T12:13:04.491Z|00142|coverage|INFO|netlink_sent
> 68.0/sec    62.783/sec       62.9394/sec   total: 1353375
> 2015-05-18T12:13:04.491Z|00143|coverage|INFO|netdev_set_policing
> 0.0/sec     0.000/sec        0.0000/sec   total: 12
> 2015-05-18T12:13:04.491Z|00144|coverage|INFO|netdev_get_ifindex
> 0.0/sec     0.000/sec        0.0000/sec   total: 6
> 2015-05-18T12:13:04.491Z|00145|coverage|INFO|netdev_get_hwaddr
> 0.0/sec     0.000/sec        0.0000/sec   total: 6
> 2015-05-18T12:13:04.491Z|00146|coverage|INFO|netdev_set_hwaddr
> 0.0/sec     0.000/sec        0.0000/sec   total: 3
> 2015-05-18T12:13:04.491Z|00147|coverage|INFO|netdev_get_ethtool
> 0.0/sec     0.000/sec        0.0000/sec   total: 22
> 2015-05-18T12:13:04.491Z|00148|coverage|INFO|netdev_set_ethtool
> 0.0/sec     0.000/sec        0.0000/sec   total: 4
> 2015-05-18T12:13:04.491Z|00149|coverage|INFO|vconn_received
> 2.4/sec     2.000/sec        1.9067/sec   total: 41642
> 2015-05-18T12:13:04.491Z|00150|coverage|INFO|vconn_sent
> 1.8/sec     1.500/sec        1.4300/sec   total: 31228
> 2015-05-18T12:13:04.491Z|00151|coverage|INFO|util_xalloc
> 1987.2/sec  1867.150/sec     1817.8008/sec   total: 37808073
> 2015-05-18T12:13:04.491Z|00152|coverage|INFO|pstream_open
> 0.0/sec     0.000/sec        0.0000/sec   total: 5
> 2015-05-18T12:13:04.491Z|00153|coverage|INFO|stream_open
> 0.0/sec     0.000/sec        0.0000/sec   total: 1
> 2015-05-18T12:13:04.491Z|00154|coverage|INFO|rconn_queued
> 1.2/sec     1.000/sec        0.9533/sec   total: 20815
> 2015-05-18T12:13:04.491Z|00155|coverage|INFO|rconn_sent
> 1.2/sec     1.000/sec        0.9533/sec   total: 20815
> 2015-05-18T12:13:04.491Z|00156|coverage|INFO|poll_fd_wait
> 537.2/sec   481.217/sec      462.1683/sec   total: 9762985
> 2015-05-18T12:13:04.491Z|00157|coverage|INFO|poll_zero_timeout
> 5.2/sec     4.333/sec        3.8581/sec   total: 83823
> 2015-05-18T12:13:04.491Z|00158|coverage|INFO|txn_unchanged
> 0.0/sec     0.000/sec        0.0000/sec   total: 11
> 2015-05-18T12:13:04.491Z|00159|coverage|INFO|txn_incomplete
> 8.8/sec     8.450/sec        8.3044/sec   total: 170811
> 2015-05-18T12:13:04.491Z|00160|coverage|INFO|txn_success
> 0.2/sec     0.200/sec        0.1989/sec   total: 4276
> 2015-05-18T12:13:04.491Z|00161|coverage|INFO|netdev_get_stats
> 1.6/sec     1.600/sec        1.5911/sec   total: 32833
> 2015-05-18T12:13:04.491Z|00162|coverage|INFO|mac_learning_learned
> 0.2/sec     0.133/sec        0.0686/sec   total: 1595
> 2015-05-18T12:13:04.491Z|00163|coverage|INFO|mac_learning_expired
> 0.4/sec     0.150/sec        0.0689/sec   total: 1518
> 2015-05-18T12:13:04.491Z|00164|coverage|INFO|hmap_pathological
> 0.0/sec     0.000/sec        0.0000/sec   total: 27
> 2015-05-18T12:13:04.491Z|00165|coverage|INFO|hmap_expand
> 102.4/sec    92.300/sec       88.6772/sec   total: 1853939
> 2015-05-18T12:13:04.491Z|00166|coverage|INFO|flow_extract
> 23.0/sec    19.883/sec       19.7067/sec   total: 416747
> 2015-05-18T12:13:04.491Z|00167|coverage|INFO|dpif_port_add
> 0.0/sec     0.000/sec        0.0000/sec   total: 6
> 2015-05-18T12:13:04.491Z|00168|coverage|INFO|dpif_flow_flush
> 0.0/sec     0.000/sec        0.0000/sec   total: 4
> 2015-05-18T12:13:04.491Z|00169|coverage|INFO|dpif_flow_put
> 0.0/sec     0.000/sec        0.0000/sec   total: 2
> 2015-05-18T12:13:04.491Z|00170|coverage|INFO|dpif_flow_del
> 0.0/sec     0.000/sec        0.0000/sec   total: 1
> 2015-05-18T12:13:04.491Z|00171|coverage|INFO|dpif_execute
> 0.0/sec     0.000/sec        0.0000/sec   total: 1
> 2015-05-18T12:13:04.491Z|00172|coverage|INFO|xlate_actions
> 38.8/sec    27.317/sec       22.9731/sec   total: 507271
> 2015-05-18T12:13:04.491Z|00173|coverage|INFO|rev_reconfigure
> 0.0/sec     0.000/sec        0.0000/sec   total: 20
> 2015-05-18T12:13:04.491Z|00174|coverage|INFO|rev_port_toggled
> 0.0/sec     0.000/sec        0.0000/sec   total: 3
> 2015-05-18T12:13:04.491Z|00175|coverage|INFO|rev_flow_table
> 0.0/sec     0.000/sec        0.0000/sec   total: 11
> 2015-05-18T12:13:04.491Z|00176|coverage|INFO|rev_mac_learning
> 0.6/sec     0.283/sec        0.1286/sec   total: 2813
> 2015-05-18T12:13:04.491Z|00177|coverage|INFO|ofproto_flush
> 0.0/sec     0.000/sec        0.0000/sec   total: 3
> 2015-05-18T12:13:04.491Z|00178|coverage|INFO|ofproto_recv_openflow
> 1.8/sec     1.500/sec        1.4300/sec   total: 31229
> 2015-05-18T12:13:04.491Z|00179|coverage|INFO|ofproto_update_port
> 0.0/sec     0.000/sec        0.0000/sec   total: 34
> 2015-05-18T12:13:04.491Z|00180|coverage|INFO|bridge_reconfigure
> 0.0/sec     0.000/sec        0.0000/sec   total: 15
> 2015-05-18T12:13:04.491Z|00181|coverage|INFO|49 events never hit
> 2015-05-18T14:59:05.014Z|00182|timeval|WARN|Unreasonably long 2019ms poll
> interval (43448ms user, 50465ms system)
> 2015-05-18T14:59:05.014Z|00183|timeval|WARN|faults: 840 minor, 0 major
> 2015-05-18T14:59:05.014Z|00184|timeval|WARN|disk: 0 reads, 120 writes
> 2015-05-18T14:59:05.014Z|00185|timeval|WARN|context switches: 2167382
> voluntary, 529 involuntary
> 2015-05-18T14:59:05.014Z|00186|coverage|INFO|Skipping details of duplicate
> event coverage for hash=9e13ffc8
> 2015-05-18T17:46:50.578Z|00187|timeval|WARN|Unreasonably long 2018ms poll
> interval (56724ms user, 65745ms system)
> 2015-05-18T17:46:50.578Z|00188|timeval|WARN|faults: 841 minor, 0 major
> 2015-05-18T17:46:50.578Z|00189|timeval|WARN|disk: 0 reads, 128 writes
> 2015-05-18T17:46:50.578Z|00190|timeval|WARN|context switches: 2853218
> voluntary, 538 involuntary
> 2015-05-18T17:46:50.578Z|00191|coverage|INFO|Skipping details of duplicate
> event coverage for hash=9e13ffc8
> 2015-05-18T20:29:36.092Z|00192|timeval|WARN|Unreasonably long 2018ms poll
> interval (69561ms user, 80775ms system)
> 2015-05-18T20:29:36.092Z|00193|timeval|WARN|faults: 841 minor, 0 major
> 2015-05-18T20:29:36.092Z|00194|timeval|WARN|disk: 0 reads, 136 writes
> 2015-05-18T20:29:36.092Z|00195|timeval|WARN|context switches: 3519924
> voluntary, 544 involuntary
> 2015-05-18T20:29:36.092Z|00196|coverage|INFO|Skipping details of duplicate
> event coverage for hash=9e13ffc8
> 2015-05-18T23:21:51.729Z|00197|timeval|WARN|Unreasonably long 2021ms poll
> interval (83029ms user, 96728ms system)
> 2015-05-18T23:21:51.729Z|00198|timeval|WARN|faults: 841 minor, 0 major
> 2015-05-18T23:21:51.729Z|00199|timeval|WARN|disk: 0 reads, 144 writes
> 2015-05-18T23:21:51.729Z|00200|timeval|WARN|context switches: 4224452
> voluntary, 553 involuntary
> 2015-05-18T23:21:51.729Z|00201|coverage|INFO|Skipping details of duplicate
> event coverage for hash=9e13ffc8
>
> ________________________________
>
> WanLi Yang
>
> JD.COM
>
> *****************************************************************
>
>
> From: Joe Stringer
> Date: 2015-05-23 05:36
> To: yangwanli
> CC: bugs
> Subject: Re: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
> interval (365882ms user, 464906ms system)
> On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
>> Hi,
>> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all virtual
>> machines and containers communicate with OVS.
>> I use OVS  VLAN.
>> OpenvSwitch Version 2.3.1  (nothing change)
>> CentOS 6.6
>> In the process of I use, encounter the flowing problems.
>> Need your help!
>>
>> 1、ovs-vswitchd.log always report warnings:
>>
>> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
>> interval (365882ms user, 464906ms system)
>> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
>> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
>> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
>> voluntary, 2080 involuntary
>> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=35d02982
>> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
>> interval (380306ms user, 483259ms system)
>> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
>> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
>> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
>> voluntary, 2174 involuntary
>> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=35d02982
>
> The main loop of ovs-vswitchd usually expects to cycle at least once
> per second. This message appears when this takes longer than usual,
> which may indicate that ovs-vswitchd is under heavy load, or some sort
> of bug.
>
>>
>> 2、I also encounter this problem:
>>     when I execute
>>     ovs-ofctl dump-flows br-int
>>    not always reponse,  but ovs-vsctl show is OK!
>
> The main thread of ovs-vswitchd assembles responses to OpenFlow
> requests, and given the above messages it sounds like it's busy doing
> other things. Ovs-vsctl on the other hand talks to ovsdb-server, which
> looks like it is OK in this scenario.
>
> These both seem like symptoms, but it's not obvious to me what the
> underlying cause is. Is there anything else in the logs? Is
> ovs-vswitchd using a lot of CPU?
>
> Are you using the OVS kernel module from CentOS or one distributed
> with the openvswitch package? ('modinfo openvswitch' should give a
> hint here)
>
> On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
>> Hi,
>> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all virtual
>> machines and containers communicate with OVS.
>> I use OVS  VLAN.
>> OpenvSwitch Version 2.3.1  (nothing change)
>> CentOS 6.6
>> In the process of I use, encounter the flowing problems.
>> Need your help!
>>
>> 1、ovs-vswitchd.log always report warnings:
>>
>> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
>> interval (365882ms user, 464906ms system)
>> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
>> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
>> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
>> voluntary, 2080 involuntary
>> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=35d02982
>> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
>> interval (380306ms user, 483259ms system)
>> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
>> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
>> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
>> voluntary, 2174 involuntary
>> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=35d02982
>>
>> 2、I also encounter this problem:
>>     when I execute
>>     ovs-ofctl dump-flows br-int
>>    not always reponse,  but ovs-vsctl show is OK!
>>
>> Thanks!
>> WanLi Yang
>>
>>
>> ________________________________
>>
>> WanLi Yang
>>
>> JD.COM
>>
>> *****************************************************************
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>

From blp at nicira.com  Tue May 26 16:43:56 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 26 May 2015 16:43:56 -0700
Subject: [ovs-discuss] Openvswitch Bug for open flow version 1.2
In-Reply-To: <SINPR03MB3315AA3A3C03B022595296A95CD0@SINPR03MB331.apcprd03.prod.outlook.com>
References: <SINPR03MB331540BA20CD83BA915F9E395D00@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150507232832.GN25694@nicira.com>
 <SINPR03MB3316815B5FE95AAF1C16B2595DE0@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150508160043.GA22853@nicira.com>
 <SINPR03MB3315AA3A3C03B022595296A95CD0@SINPR03MB331.apcprd03.prod.outlook.com>
Message-ID: <20150526234356.GI18978@nicira.com>

On Mon, May 25, 2015 at 06:01:02AM +0000, jayachandran.subramanian at wipro.com wrote:
> Hi Ben ,
> 
> Thank you for your mail , also we have identified that all groups test cases (Github oftest suite) failing with openvswitch with the below ofp message.
> 
> ofp.OFPGMFC_UNKNOWN_GROUP
> ofp.OFPGMFC_LOOP
> 
>  Openvswitch version : openvswitch - 2.3.1
>  OS version                    : Ubuntu 14.04 Trusty
>  Open flow version      : 1.2
> 
> Is there any work around to fix this issue .

If you submit a bug fix through our regular patch submission process,
we'll apply it.  Thanks!

From blp at nicira.com  Tue May 26 17:40:07 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 26 May 2015 17:40:07 -0700
Subject: [ovs-discuss] QoS question: ovs- QoS configuration and linux-QoS
In-Reply-To: <CAC=Vi+pKWFBt0cE+TatmqFYvydWyXH2t_G9A2rWBThz0YKcT+w@mail.gmail.com>
References: <49388820.7856013.1432305969395.JavaMail.zimbra@inria.fr>
 <1348571400.7859072.1432306329841.JavaMail.zimbra@inria.fr>
 <CAC=Vi+pKWFBt0cE+TatmqFYvydWyXH2t_G9A2rWBThz0YKcT+w@mail.gmail.com>
Message-ID: <20150527004007.GM18978@nicira.com>

On Fri, May 22, 2015 at 08:37:16PM -0700, Andy Hill wrote:
> QoS set by tc does not survive a restart of the openvswitch service,
> including ones during upgrades (verified on 2.1.0.34867). We've seen
> this behavior at Rackspace across several OVS upgrades. We manually
> rebuild QoS immediately following upgrades.

For the record, I'm not saying that OVS behavior is ideal here.  It
would be better if OVS didn't do that.  We could change OVS not to do
that.  The only case where that would could really cause a problem is a
scenario like this:

        1. In the OVS database, the manager (which could be a human admin
           or a program) sets an interface to use some particular QoS
           settings.  OVS configures them on the interface.

        2. Someone stops OVS.

        3. The manager deletes the QoS settings from the OVS database.

        4. Someone starts OVS again.

Currently, following step 4, OVS clears the QoS settings, because it
always believes that it owns them, but with this change it would
preserve them.

Other possible changes in this area, with different tradeoffs:

        * Add a QoS type that says that OVS should leave the QoS
          settings alone for an interface.  This would solve the problem
          but it seems user-unfriendly, since it is surprising that OVS
          changes the QoS settings at all if it isn't asked to do so.

        * Make OVS record in the database when it changes the QoS
          settings (upon request only), so that it can change them back
          only if it set them up to begin with.  This might be hard to
          do reliably across system reboots and deletions and creations
          of distinct network devices that have the same name.

Feedback on this issue is very welcome!

From blp at nicira.com  Tue May 26 18:09:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 26 May 2015 18:09:44 -0700
Subject: [ovs-discuss] Datapath megaflow issues
In-Reply-To: <CAAcQFL=1ejXw80T+efu8Az-i38B+75nfXGeGchbA79tcgpHmyQ@mail.gmail.com>
References: <CAAcQFL=1ejXw80T+efu8Az-i38B+75nfXGeGchbA79tcgpHmyQ@mail.gmail.com>
Message-ID: <20150527010944.GS18978@nicira.com>

On Thu, May 21, 2015 at 01:26:01PM -0400, an wang wrote:
> Hi, All,
> 
> I'm trying to figure out how datapath mega flows are generated. So I did a
> very simple experiment on openvswitch 2.3.0. I inserted a rule ovs-ofctl
> add-flow br0 in_port=2,ip,nw_dst=192.168.2.2/16,actions=output:1 to the
> userspace flow table. And I used ovs-appctl dpif/dump-flows br0 to check
> the flows in datapath flow table and this is what I observed.
> 
> skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:00:39:d3:34:3b),eth_type(0x0800),ipv4(src=
> 192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=62/0,frag=no/0xff),
> packets:26670724, bytes:1762573766, used:0.000s, flags:SR., actions:2
> skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:50:56:49:01:29),eth_type(0x0800),ipv4(src=
> 192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=63/0,frag=no/0xff),
> packets:9469993, bytes:586123740, used:0.000s, flags:SF., actions:2
> 
> Somehow it seems that the ip dst field is not wildcarded at all. And I've
> repeated the experiment for several times using different prefix and I
> obtained the same result. Could anyone please explain why this happened and
> how wildcarded flows are supported in the datapath?

OVS 2.3 doesn't configure any prefix fields by default, so you have to
set the "prefixes" column in the OVSDB Flow_Table table.

OVS 2.4 uses IPV4 source and destination fields as prefixes by default.

From blp at nicira.com  Tue May 26 18:22:56 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 26 May 2015 18:22:56 -0700
Subject: [ovs-discuss] pf_packet/af_packet socket with vlan tagging does
 not strip vlan tag
In-Reply-To: <CAAcrFUZW=nYFfaEYmWof+-SEaiW2LdCorjo3bgiX7=uYYUJBpw@mail.gmail.com>
References: <CAAcrFUZW=nYFfaEYmWof+-SEaiW2LdCorjo3bgiX7=uYYUJBpw@mail.gmail.com>
Message-ID: <20150527012256.GU18978@nicira.com>

On Wed, May 20, 2015 at 01:45:37PM -0700, Jon Gainsley wrote:
> Hi,
> 
> I'm wondering if anyone can help me with this. I am having trouble
> inserting raw vlan tagged packets into the vswitch using an AF_PACKET
> socket. I have the following simple bridge:

This kind of sounds like this kernel bug described in the thread here:
        http://openvswitch.org/pipermail/dev/2011-December/013948.html

I don't know whether it's been fixed.

From blp at nicira.com  Tue May 26 18:33:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 26 May 2015 18:33:44 -0700
Subject: [ovs-discuss] OVS [vlan] Fake Bridge
In-Reply-To: <CAB-ezPFwUUD7fJB9rNXadHEG4Xpy8JggOXeE_fYeRjdYtin12Q@mail.gmail.com>
References: <CAB-ezPFwUUD7fJB9rNXadHEG4Xpy8JggOXeE_fYeRjdYtin12Q@mail.gmail.com>
Message-ID: <20150527013344.GW18978@nicira.com>

On Wed, May 20, 2015 at 03:56:19PM -0400, Sean McCully wrote:
> I am having a problem configuring open vswitch with my vlan configuration,
> I am running Ubuntu 15.04 (3.16.0-37).
> 
> 
> The following with ip/kernel configuration works,
> 
> $ ip link add link eth1 name eth1.120 type vlan id 120
> $ ip add add 192.168.11.10 dev eth1.120
> $ ip link set up dev eth1.120
> $ route add default gw 192.168.11.1 eth1.120
> $ ping -c 2 192.168.11.1
> 
> I am under the impression the following should work with ovs to establish
> the same results, but does not.
> $ ip link set promisc on dev eth1
> $ ovs-vsctl --version
>   ovs-vsctl (Open vSwitch) 2.3.1
>   DB Schema 7.6.2
> $ ovs-vsctl add-br br1
> $ ovs-vsctl add-port br1 eth1
> $ ovs-vsctl add-br vlan120 br1 120 # Create Fake Bridge with vlan 120
> $ ovs-vsctl add-port vlan120 vif120 -- set interface vif120 type=internal
> $ ifconfig vif120 192.168.11.10 up
> $ route add default gw 192.168.11.1
> $ ping -c 2 192.168.11.1
> 
> Loss of packets, have a missed something? How should I achieve same ip
> stack configuration with ovs as shown above?

The usual way to do this with an OVS "fake bridge" would be to configure
the VLAN IP on br1 rather than vlan120.  We used to test with this
pretty routinely under XenServer, for example.  I don't know why adding
the additional interface interface would make a difference but it at
least distinguishes this configuration from what I'm used to seeing.

You might also want to read the VLAN section of the FAQ, particularly
these two Q&A:

### Q: Can I configure an IP address on a VLAN?

A: Yes.  Use an "internal port" configured as an access port.  For
   example, the following configures IP address 192.168.0.7 on VLAN 9.
   That is, OVS will forward packets from eth0 to 192.168.0.7 only if
   they have an 802.1Q header with VLAN 9.  Conversely, traffic
   forwarded from 192.168.0.7 to eth0 will be tagged with an 802.1Q
   header with VLAN 9:

       ovs-vsctl add-br br0
       ovs-vsctl add-port br0 eth0
       ovs-vsctl add-port br0 vlan9 tag=9 -- set interface vlan9 type=internal
       ifconfig vlan9 192.168.0.7

   See also the following question.

### Q: I configured one IP address on VLAN 0 and another on VLAN 9, like
   this:

       ovs-vsctl add-br br0
       ovs-vsctl add-port br0 eth0
       ifconfig br0 192.168.0.5
       ovs-vsctl add-port br0 vlan9 tag=9 -- set interface vlan9 type=internal
       ifconfig vlan9 192.168.0.9

   but other hosts that are only on VLAN 0 can reach the IP address
   configured on VLAN 9.  What's going on?

A: RFC 1122 section 3.3.4.2 "Multihoming Requirements" describes two
   approaches to IP address handling in Internet hosts:

   - In the "Strong ES Model", where an ES is a host ("End
     System"), an IP address is primarily associated with a
     particular interface.  The host discards packets that arrive
     on interface A if they are destined for an IP address that is
     configured on interface B.  The host never sends packets from
     interface A using a source address configured on interface B.

   - In the "Weak ES Model", an IP address is primarily associated
     with a host.  The host accepts packets that arrive on any
     interface if they are destined for any of the host's IP
     addresses, even if the address is configured on some
     interface other than the one on which it arrived.  The host
     does not restrict itself to sending packets from an IP
     address associated with the originating interface.

   Linux uses the weak ES model.  That means that when packets
   destined to the VLAN 9 IP address arrive on eth0 and are bridged to
   br0, the kernel IP stack accepts them there for the VLAN 9 IP
   address, even though they were not received on vlan9, the network
   device for vlan9.

   To simulate the strong ES model on Linux, one may add iptables rule
   to filter packets based on source and destination address and
   adjust ARP configuration with sysctls.

   BSD uses the strong ES model.

From blp at nicira.com  Tue May 26 18:33:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 26 May 2015 18:33:44 -0700
Subject: [ovs-discuss] OVS [vlan] Fake Bridge
In-Reply-To: <CAB-ezPFwUUD7fJB9rNXadHEG4Xpy8JggOXeE_fYeRjdYtin12Q@mail.gmail.com>
References: <CAB-ezPFwUUD7fJB9rNXadHEG4Xpy8JggOXeE_fYeRjdYtin12Q@mail.gmail.com>
Message-ID: <20150527013344.GW18978@nicira.com>

On Wed, May 20, 2015 at 03:56:19PM -0400, Sean McCully wrote:
> I am having a problem configuring open vswitch with my vlan configuration,
> I am running Ubuntu 15.04 (3.16.0-37).
> 
> 
> The following with ip/kernel configuration works,
> 
> $ ip link add link eth1 name eth1.120 type vlan id 120
> $ ip add add 192.168.11.10 dev eth1.120
> $ ip link set up dev eth1.120
> $ route add default gw 192.168.11.1 eth1.120
> $ ping -c 2 192.168.11.1
> 
> I am under the impression the following should work with ovs to establish
> the same results, but does not.
> $ ip link set promisc on dev eth1
> $ ovs-vsctl --version
>   ovs-vsctl (Open vSwitch) 2.3.1
>   DB Schema 7.6.2
> $ ovs-vsctl add-br br1
> $ ovs-vsctl add-port br1 eth1
> $ ovs-vsctl add-br vlan120 br1 120 # Create Fake Bridge with vlan 120
> $ ovs-vsctl add-port vlan120 vif120 -- set interface vif120 type=internal
> $ ifconfig vif120 192.168.11.10 up
> $ route add default gw 192.168.11.1
> $ ping -c 2 192.168.11.1
> 
> Loss of packets, have a missed something? How should I achieve same ip
> stack configuration with ovs as shown above?

The usual way to do this with an OVS "fake bridge" would be to configure
the VLAN IP on br1 rather than vlan120.  We used to test with this
pretty routinely under XenServer, for example.  I don't know why adding
the additional interface interface would make a difference but it at
least distinguishes this configuration from what I'm used to seeing.

You might also want to read the VLAN section of the FAQ, particularly
these two Q&A:

### Q: Can I configure an IP address on a VLAN?

A: Yes.  Use an "internal port" configured as an access port.  For
   example, the following configures IP address 192.168.0.7 on VLAN 9.
   That is, OVS will forward packets from eth0 to 192.168.0.7 only if
   they have an 802.1Q header with VLAN 9.  Conversely, traffic
   forwarded from 192.168.0.7 to eth0 will be tagged with an 802.1Q
   header with VLAN 9:

       ovs-vsctl add-br br0
       ovs-vsctl add-port br0 eth0
       ovs-vsctl add-port br0 vlan9 tag=9 -- set interface vlan9 type=internal
       ifconfig vlan9 192.168.0.7

   See also the following question.

### Q: I configured one IP address on VLAN 0 and another on VLAN 9, like
   this:

       ovs-vsctl add-br br0
       ovs-vsctl add-port br0 eth0
       ifconfig br0 192.168.0.5
       ovs-vsctl add-port br0 vlan9 tag=9 -- set interface vlan9 type=internal
       ifconfig vlan9 192.168.0.9

   but other hosts that are only on VLAN 0 can reach the IP address
   configured on VLAN 9.  What's going on?

A: RFC 1122 section 3.3.4.2 "Multihoming Requirements" describes two
   approaches to IP address handling in Internet hosts:

   - In the "Strong ES Model", where an ES is a host ("End
     System"), an IP address is primarily associated with a
     particular interface.  The host discards packets that arrive
     on interface A if they are destined for an IP address that is
     configured on interface B.  The host never sends packets from
     interface A using a source address configured on interface B.

   - In the "Weak ES Model", an IP address is primarily associated
     with a host.  The host accepts packets that arrive on any
     interface if they are destined for any of the host's IP
     addresses, even if the address is configured on some
     interface other than the one on which it arrived.  The host
     does not restrict itself to sending packets from an IP
     address associated with the originating interface.

   Linux uses the weak ES model.  That means that when packets
   destined to the VLAN 9 IP address arrive on eth0 and are bridged to
   br0, the kernel IP stack accepts them there for the VLAN 9 IP
   address, even though they were not received on vlan9, the network
   device for vlan9.

   To simulate the strong ES model on Linux, one may add iptables rule
   to filter packets based on source and destination address and
   adjust ARP configuration with sysctls.

   BSD uses the strong ES model.

From blp at nicira.com  Tue May 26 18:48:56 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 26 May 2015 18:48:56 -0700
Subject: [ovs-discuss] Tunnels with duplicate configuration
In-Reply-To: <CAEpyMTDrTSKwZPEGzBECczDcH7agkS9Tbm82KwsfFs7er6TPbg@mail.gmail.com>
References: <CAEpyMTDrTSKwZPEGzBECczDcH7agkS9Tbm82KwsfFs7er6TPbg@mail.gmail.com>
Message-ID: <20150527014856.GX18978@nicira.com>

On Tue, May 19, 2015 at 01:48:24PM -0700, Keith Holleman wrote:
> Running OVS 2.3.0 on Ubuntu from a debian package.
> 
> I am creating two interfaces that are tunnels with duplicate configuration
> as shown below and noticed that this causes some interesting behavior.
> Everything appears to work but in reality, only one of the of-ports is able
> to send traffic.

I agree that that's surprising and undesirable.

I sent out a patch that I believe should fix the problem, although I
have not yet fully tested it.  Would you try it?  It is against master,
though I could backport it to branch-2.3 if necessary.

The patch is at:
        http://openvswitch.org/pipermail/dev/2015-May/055573.html

From eunho.cha at atto-research.com  Tue May 26 18:54:04 2015
From: eunho.cha at atto-research.com (=?UTF-8?B?7LCo7J2A7Zi4?=)
Date: Wed, 27 May 2015 10:54:04 +0900
Subject: [ovs-discuss] [Dpdk-ovs] How use userspace tunneling?
Message-ID: <CAJoD7yRxS6_KOgtzbZfxs0b8HTnhDMkrxRsNUh1U_DMkT8TwJw@mail.gmail.com>

Hi Discuss Group.

I want to use dpdk-ovs with vxlan tunneling.

I have build OVS(github master branch) with DPDK(2.0.0) as mentioned in the
INSTALL.DPDK.md <http://install.dpdk.md/>.
And I try use userspace tunneling as mentioned in
the README-native-tunneling.md.

ovs-vsctl add-br br-eth1  -- set bridge br-eth1 datapath_type=netdev
ovs-vsctl add-port br-eth1 dpdk0 -- set Interface dpdk0 type=dpdk;

However, when I try assign ip address to br-eth1, ovs-vswitchd is killed
with segfault.
ifconfig br-eth1 172.168.1.1 netmask 255.255.255.0

This is the log:

May 26 19:57:23 xeon kernel: ovs-vswitchd[2734]: segfault at a70938 ip
000000000067e214 sp 00007fff694cecb0 error 4 in ovs-vswitchd[400000+36d000]
May 26 19:57:25 xeon abrt-server[2815]: Executable
'/usr/local/sbin/ovs-vswitchd' doesn't belong to any package and
ProcessUnpackaged is set to 'no'
May 26 19:57:25 xeon abrt-server[2815]: 'post-create' on
'/var/tmp/abrt/ccpp-2015-05-26-19:57:23-2734' exited with 1

How can I use userspace tunneling with dpdk-ovs?

Thanks,
Cha.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/f232aab4/attachment.html>

From blp at nicira.com  Tue May 26 18:55:48 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 26 May 2015 18:55:48 -0700
Subject: [ovs-discuss] EPL/EVPL support in OVS?
In-Reply-To: <CAB3eHOz3StU+2n=_=whH=vjF7kGfLaw=vsU97nd7B83Pd2xN_g@mail.gmail.com>
References: <CAB3eHOz3StU+2n=_=whH=vjF7kGfLaw=vsU97nd7B83Pd2xN_g@mail.gmail.com>
Message-ID: <20150527015548.GZ18978@nicira.com>

On Mon, May 18, 2015 at 11:24:08AM -0700, Mike Bly wrote:
> Does anyone have an example configuration that would show how to provide an
> Ethernet Private Line (EPL) service using and OVS vSwitch? What about EVPL?

No one has mentioned those standards to us before on the mailing lists,
to the best of my knowledge, so I doubt that there is much use of them
with Open vSwitch.

> Each time I add a VLAN to a port trunk list, its associated traffic gets
> bridged in a separate VLAN/MAC table entry.

What should happen?

From azhou at nicira.com  Tue May 26 18:58:26 2015
From: azhou at nicira.com (Andy Zhou)
Date: Tue, 26 May 2015 18:58:26 -0700
Subject: [ovs-discuss] one patch was omitted to be pushed to
 branch-2.3---datapath: Fix recirc bug where skb is double freed
In-Reply-To: <201505262118086030330@yunshan.net.cn>
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
 <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>
 <201505262118086030330@yunshan.net.cn>
Message-ID: <CACzMAJJHV1ZXyVqNGeN1kMGRfZ8ExE_erEO8N5O0ycredSVV1w@mail.gmail.com>

On Tue, May 26, 2015 at 6:18 AM, ZHANG Zhiming
<zhangzhiming at yunshan.net.cn> wrote:
> Hi Andy,
>
> Is this the patch for the bug I found?
>
> Thanks a lot!
>
>
>
>
> [ovs-dev] [PATCH] ofproto/bond: Fix a race condition in updating post
> recirculation rules

Unlikely. It is a user space bug fix and should not lead to kernel crash.

From blp at nicira.com  Tue May 26 19:12:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 26 May 2015 19:12:32 -0700
Subject: [ovs-discuss] Check TCP ack seq
In-Reply-To: <CAHC2dCAz-AqhSp-vKZY-HZeQJJDetUmJMC6ef86n_B+vkqZe3w@mail.gmail.com>
References: <CAHC2dCAz-AqhSp-vKZY-HZeQJJDetUmJMC6ef86n_B+vkqZe3w@mail.gmail.com>
Message-ID: <20150527021232.GA18978@nicira.com>

On Sun, May 17, 2015 at 05:24:42PM +0800, 劉瑋凱 wrote:
> I would like to check tcp ack sequence number.
> Using a pointer point to ctx->xin->packet->frame,but the ovs crash when i
> sending TCP frame over about 1Mbps.
> What's happened?

I don't know.  Have you tried debugging your code?

From azhou at nicira.com  Tue May 26 19:13:31 2015
From: azhou at nicira.com (Andy Zhou)
Date: Tue, 26 May 2015 19:13:31 -0700
Subject: [ovs-discuss] one patch was omitted to be pushed to
 branch-2.3---datapath: Fix recirc bug where skb is double freed
In-Reply-To: <201505241646035721464@yunshan.net.cn>
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
 <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>
 <201505241646035721464@yunshan.net.cn>
Message-ID: <CACzMAJLBi1LmnAkOSX4yvd8McNp9-C7dAxbTqfOPji2LKyu2gg@mail.gmail.com>

On Sun, May 24, 2015 at 1:46 AM, ZHANG Zhiming
<zhangzhiming at yunshan.net.cn> wrote:
> Hi,
>
>
> Here you are.
> This bug is triggered by configuring bond_mode=banlace-tcp and lacp=active
> simultaneously.
> The version of OVS is 2.3.1.
>
>

Thanks, this helps. The backtrace suggested there is a stack
corruption from 'execute_recirc()',  But it not
obvious what is the problem.  I will need to think about it more. In
the mean time, would you please post
a snap shot of the datapath flows,  using the 'ovs-dpctl dump-flows' command.

Thanks,

Andy

From fengyuleidian0615 at gmail.com  Tue May 26 20:19:55 2015
From: fengyuleidian0615 at gmail.com (leidian fengyu)
Date: Wed, 27 May 2015 11:19:55 +0800
Subject: [ovs-discuss]
	=?utf-8?b?562U5aSN77ya562U5aSN77ya562U5aSN77yaIA==?=
	=?utf-8?b?562U5aSN77yaIEZvciBoZWxwIGFib3V0IHNzaCBiZXR3ZWVuIHZtcyB0?=
	=?utf-8?q?hrough_ovs-dkdp?=
In-Reply-To: <D18A6F35.19BD%diproiettod@vmware.com>
References: <14c27b19-619e-436d-af9b-23e37b328854@dtdream.com>
 <D1823F0C.15C5%diproiettod@vmware.com>
 <b9c723b0-b032-48cf-adcc-2f83ba3376f4@dtdream.com>
 <8400ab49-856a-4562-a6ea-bab10cac7c47@dtdream.com>
 <7a83258c-ba18-4647-bc1e-9d8c43376ae4@dtdream.com>
 <----P3------meVv3$28e8da0a-22b2-44e3-9694-849cbb2abc8b@dtdream.com>
 <D18A6F35.19BD%diproiettod@vmware.com>
Message-ID: <CAL2Z+UA6wJY23D=UR8Xs223pr3FaDvRyMRn-fh1ntPv0_hGJsA@mail.gmail.com>

Hi Daniele and Kevin

My env:
Host: Centos 7.0
qemu-2.3.0
dpdk-2.0.0
ovs master tree at commit 1190bedaea

boot commands:
qemu-system-x86_64 -enable-kvm -smp 4 -m 2048 -hda centos7-1.img \
-netdev tap,id=nic1,script=no,downscript=no,ifname=dpdkvhost1,vhost=on
-device
virtio-net-pci,netdev=nic1,mac=00:16:3d:22:33:54,csum=off,gso=off,guest_tso4=off,guest_tso6=off,guest_ecn=off
\
-object
memory-backend-file,id=mem,size=2048M,mem-path=/dev/hugepages,share=on
-numa node,memdev=mem -mem-prealloc

I have the same issue, ping works, dhcp also works well, but ssh no good,
ssh seems works with patch [1] applied, but connection will broke when scp
or iperf.
And qemu coredump by spitting:
qemu-system-x86_64: /qemu-2.3.0/hw/virtio/vhost.c:1003:
vhost_virtqueue_mask: Assertion `r >= 0' failed.

Qeury:
1. If dpdk user space bridge with vhost-cuse configuration has special
requirement on the qemu/dpdk/ovs version,
could you please recommend?

2. I'm willing to provide any other logs to debug this issue if required.

Thanks!

[1] http://dpdk.org/ml/archives/dev/2015-May/017251.html


2015-05-27 1:50 GMT+08:00 Daniele Di Proietto <diproiettod at vmware.com>:

> We've experienced the same problem during our testing.
> Applying the following patch to DPDK seemed to solve
> the issue:
>
> http://dpdk.org/ml/archives/dev/2015-May/017919.html
>
> On 26/05/2015 01:32, "钢锁0310" <liw at dtdream.com> wrote:
>
> >i find a mail
> >http://lists.freebsd.org/pipermail/freebsd-net/2015-January/040812.html
> >
> >
> >In that mail,virio drive add 12byte,
> >
> >For instance, your
> >guest kernel can offload the TCP checksum to the virtio-net device,
> >which in turn uses the virtio-net header (that requires TAP driver
> >support) to postpone the checksum to the host kernel. If packets
> >arrive to a physical NIC that supports checksum offloading (e.g. a
> >r8169 NIC attached to the same bridge to which the TAP is attached),
> >you have effectively offloaded the checksum computation from the guest
> >kernel straight to the physical NIC in the physical host.
> >In my experiment  the tcp packet from vm to host has be added 12bytes,
> >so host can't interpret itit looks like the same Does the vhost-cuse
> >consider the 12bytes?How should i do for skip the 12bytes?udp id ok  only
> >tcp is bad
> >*********************
> >RTFSC
> >*********************
> >
> >
> >
> >------------------------------------------------------------------
> >发件人：钢锁0310 <liw at dtdream.com>
> >发送时间：2015年5月21日(星期四) 14:47
> >收件人：gowrishankar <gowrishankar.m at linux.vnet.ibm.com>，discuss
> ><discuss at openvswitch.org>，通天晓0280 <dongj at dtdream.com>
> >主 题：答复：答复：答复：[ovs-discuss] 答复： For help about ssh between vms through
> >ovs-dkdp
> >
> >
> >sorry  my fault
> >
> >
> >tap0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
> >        inet6 fe80::c469:e6ff:fe78:d30f  prefixlen 64  scopeid 0x20<link>
> >        ether c6:69:e6:78:d3:0f  txqueuelen 500  (Ethernet)
> >        RX packets 0  bytes 0 (0.0 B)
> >        RX errors 0  dropped 0  overruns 0  frame 0
> >        TX packets 0  bytes 0 (0.0 B)
> >        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
> >
> >tap1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
> >        inet6 fe80::3c73:6cff:fe7a:49c3  prefixlen 64  scopeid 0x20<link>
> >        ether 3e:73:6c:7a:49:c3  txqueuelen 500  (Ethernet)
> >        RX packets 0  bytes 0 (0.0 B)
> >        RX errors 0  dropped 0  overruns 0  frame 0
> >        TX packets 0  bytes 0 (0.0 B)
> >        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
> >
> >
> >
> >no packet stat  in tap0 and tap1    neither to tcpdump -vvv -ni tap0
> >
> >
> >but ping is work
> >
> >
> >[root at 25 ~]# ovs-ofctl dump-flows br0
> >NXST_FLOW reply (xid=0x4):
> > cookie=0x0, duration=536.513s, table=0, n_packets=207, n_bytes=18734,
> >idle_age=0, in_port=1 actions=output:2
> > cookie=0x0, duration=536.512s, table=0, n_packets=200, n_bytes=18440,
> >idle_age=0, in_port=2 actions=output:1
> > cookie=0x0, duration=551.217s, table=0, n_packets=8, n_bytes=648,
> >idle_age=434, priority=0 actions=NORMAL
> >[root at 25 ~]# ovs-ofctl dump-ports br0
> >OFPST_PORT reply (xid=0x2): 3 ports
> >  port LOCAL: rx pkts=8, bytes=648, drop=0, errs=0, frame=0, over=0, crc=0
> >           tx pkts=0, bytes=0, drop=0, errs=0, coll=0
> >  port  1: rx pkts=213, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
> >           tx pkts=214, bytes=?, drop=0, errs=?, coll=?
> >  port  2: rx pkts=206, bytes=?, drop=?, errs=?, frame=?, over=?, crc=?
> >           tx pkts=199, bytes=?, drop=22, errs=?, coll=?
> >
> >
> >
> >the stat of ovs is ok
> >
> >
> >*********************
> >RTFSC
> >*********************
> >
> >
> >------------------------------------------------------------------
> >发件人：gowrishankar <gowrishankar.m at linux.vnet.ibm.com>
> >发送时间：2015年5月21日(星期四) 14:26
> >收件人：钢锁0310 <liw at dtdream.com>
> >主 题：Re: 答复：答复：[ovs-discuss] 答复： For help about ssh between vms through
> >ovs-dkdp
> >
> >
> >I think this is same as what you shared earlier in ML i.e captured from
> >inside VM2.
> >Or correct me if I am wrong.
> >
> >
> >I wanted to see running tcpdump -vvv -ni vnet0 from host (for eg, vnet0
> >is vnic of guest VM1
> >and connected to your ovs-dpdk switch as I hope).
> >
> >
> >Could that be possible. You may please include ML in CC as well, if
> >others also could help if some more
> >traces there this time.
> >
> >
> >Regards,
> >Gowrishankar
> >
> >
> >On Thursday 21 May 2015 11:43 AM, 钢锁0310 wrote:
> >
> >
> >
> >
> >the screen picture  above
> >
> >
> >*********************
> >RTFSC
> >*********************
> >
> >
> >
> >------------------------------------------------------------------
> >发件人：gowrishankar
> ><gowrishankar.m at linux.vnet.ibm.com>
> ><mailto:gowrishankar.m at linux.vnet.ibm.com>
> >发送时间：2015年5月21日(星期四) 14:08
> >收件人：钢锁0310
> ><liw at dtdream.com> <mailto:liw at dtdream.com>
> >主 题：Re: 答复：[ovs-discuss] 答复： For help about ssh between vms through
> >ovs-dkdp
> >
> >
> >May be, you could share tcpdump -vvv for us to infer anything else (from
> >host).
> >
> >
> >Regards,
> >Gowrishankar
> >
> >
> >On Thursday 21 May 2015 11:31 AM, 钢锁0310 wrote:
> >the tcp state on vm which run ssh is SYNSEND
> >
> >
> >VMs`csum is off
> >
> >
> >the target vm catch wrong packet still
> >
> >
> >*********************
> >RTFSC
> >*********************
> >
> >
> >
> >------------------------------------------------------------------
> >发件人：gowrishankar
> ><gowrishankar.m at linux.vnet.ibm.com>
> ><mailto:gowrishankar.m at linux.vnet.ibm.com>
> >发送时间：2015年5月21日(星期 四) 13:55
> >收件人：钢锁0310
> ><liw at dtdream.com> <mailto:liw at dtdream.com>
> >抄 送：discuss
> ><discuss at openvswitch.org> <mailto:discuss at openvswitch.org>
> >主 题：Re: [ovs-discuss] 答复： For help about ssh between vms through ovs-dkdp
> >
> >
> >tcpdump from host on guest's vnic could help ? See if 3way handshake
> >completes.
> >
> >
> >Also, check if csum correct on packets from guest (tcpdump -vvv).
> >
> >
> >Regards,
> >Gowrishankar
> >
> >
> >On Thursday 21 May 2015 10:37 AM, 钢锁0310 wrote:
> >ovs log:
> >2015-05-21T04:46:37.941Z|00023|connmgr|INFO|br0<->unix: 1 flow_mods in
> >the last 0 s (1 adds)
> >2015-05-21T04:46:38.604Z|00024|connmgr|INFO|br0<->unix: 1 flow_mods in
> >the last 0 s (1 adds)
> >2015-05-21T04:48:42.692Z|00001|dpdk(cuse_thread3)|INFO|vHost Device
> >'tap0' (0) has been added
> >2015-05-21T04:48:51.750Z|00002|dpdk(cuse_thread3)|INFO|vHost Device
> >'tap1' (1) has been added
> >
> >
> >
> >qemu create tap with default name 'tap[id]'         adding port to ovs is
> >ok    ping is work
> >
> >
> >and i add options
> >'csum=off,gso=off,guest_csum=off,guest_tso4=off,guest_tso6=off,guest_ecn=o
> >ff'
> >
> >
> >in guset
> >ethtool -k eth0
> >
> >
> >all things is off but
> >
> >
> >ssh is still not work
> >
> >
> >qemu 2.3.0
> >dpdk 2.0.0
> >ovs   compiled by git master
> >
> >
> >the OS of host and guest both are  'Linux 25.dpdk 3.10.0-229.el7.x86_64
> >#1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux'
> >
> >
> >*********************
> >RTFSC
> >*********************
> >
> >
> >
> >------------------------------------------------------------------
> >发件人：Traynor, Kevin
> ><kevin.traynor at intel.com> <mailto:kevin.traynor at intel.com>
> >发送时间：2015年5月 20日(星期 三) 22:21
> >收件人：Daniele Di Proietto
> ><diproiettod at vmware.com> <mailto:diproiettod at vmware.com>， 钢锁0310
> ><liw at dtdream.com> <mailto:liw at dtdream.com>
> >抄 送：通天晓0280
> ><dongj at dtdream.com> <mailto:dongj at dtdream.com>，discuss
> ><discuss at openvswitch.org> <mailto:discuss at openvswitch.org>
> >主 题：RE: [ovs-discuss] For help about ssh between vms through ovs-dkdp
> >
> >
> >
> >
> >> -----Original Message-----
> >> From: Daniele Di Proietto [mailto:diproiettod at vmware.com]
> >> Sent: Wednesday, May 20, 2015 1:47 PM
> >> To: 钢锁 0310
> >> Cc: 通天晓 0280; discuss; Traynor, Kevin
> >> Subject: Re: [ovs-discuss] For help about ssh between vms through
> >>ovs-dkdp
> >>
> >> This might be related to offloading features.
> >>
> >> Could you try again with this qemu "-device" option and let us know?
> >> -device
> >>
> >>virtio-net-pci,netdev=net1,csum=off,gso=off,guest_tso4=off,guest_tso6=off
> >>,g
> >> uest_ecn=off
> >
> >
> >I checked this previously and the DPDK vhost lib will report those
> >features
> >as not available during negotiation so you should be ok with not
> >specifying
> >them explicitly in the qemu cmd line. I haven't tested with qemu 2.3.
> >
> >
> >>
> >>
> >> Kevin, do you this we should mention this in INSTALL.DPDk.md?
> >
> >
> >I had changed the original patch to make it optional in 3a based on
> >feedback
> >from Michael Tsirkin and testing. So unless we find an issue, I'd prefer
> >to
> >leave optional.
> >
> https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#dpdk-vhost-
> >vm-configuration
> ><
> https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_openvswit
> >ch_ovs_blob_master_INSTALL.DPDK.md-23dpdk-2Dvhost-2Dvm-2Dconfiguration&d=B
> >QMFaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_
> >Cw5yUNjxgD4v5kJqZ2uWLlE&m=uyMUTwlAFqpkT9D3pmPQi1LFOOG-ByD1htMGkp5eXLc&s=Ob
> >AhVG4R4gABevsLZVIKFuJ1snNlK84wH5JIFHmMX0o&e=>
> >
> >
> >>
> >>
> >> On 20/05 /2015 10:39, "钢锁0310" <liw at dtdream.com>
> >><mailto:liw at dtdream.com> wrote:
> >>
> >> >i build the vm-ovsdpdk-vm environment by using vhost-cuse
> >> >
> >> >
> >> >the cmd is following
> >> >
> >> >
> >> >ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
> >> >ovs-vsctl add-port br0 tap0 -- set Interface tap0 type=dpdkvhost
> >> >ovs-vsctl add-port br0 tap1 -- set Interface tap1 type=dpdkvhost
> >> >
> >> >qemu-system-x86_64 cirros.img -m 2G -vnc :1 -object
> >> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on
> >>-numa
> >> >node,memdev=mem -mem-prealloc -netdev
> >>type=tap,id=net1,script=no,vhost=on
> >> >-device virtio-net-pci,netdev=net1
> >> >qemu-system-x86_64 cirros.img -m 2G -vnc :2 -object
> >> >memory-backend-file,id=mem,size=2G,mem-path=/dev/hugepages,share=on
> >>-numa
> >> >node,memdev=mem -mem-prealloc -netdev
> >>type=tap,id=net1,script=no,vhost=on
> >> >-device virtio-net-pci,netdev=net1
> >
> >
> >You are not specifying the ifname on the command line. What does the
> >vswitchd.log say regarding the adding/removing of vhost ports?
> >e.g. |INFO|vHost Device 'dpdkvhost1' (1) has been added
> >
> >
> >> >
> >> ># add ovs flow
> >> >ovs-ofctl add-flow br0 in_port=1,action:output=2
> >> >ovs-ofctl add-flow br0 in_port=2,action:output=1
> >> >
> >> >
> >> >mac of vm1 is 00:00:00:00:00:01   vm2 is 00:00:00:00:00:02
> >> >
> >> >
> >> >ping form vm1 to vm2 is ok, but ssh is not ok
> >> >
> >> >
> >> >On vm1 run ssh to vm2,   Run tcpdump on vm2,  the catching packet as
> >> >follow
> >> >
> >> >
> >> >
> >> >it seems the packets is all wrong
> >> >
> >> >
> >> >Anyone meet this situation?
> >
> >
> >What kernel version are you using in the guest? There is a known DPDK
> >issue
> >with 3.19.5 in the guest when using the kernel to fwd pkts. The fix for it
> >is here: http://dpdk.org/ml/archives/dev/2015-May/017251.html
> ><
> https://urldefense.proofpoint.com/v2/url?u=http-3A__dpdk.org_ml_archives_
> >dev_2015-2DMay_017251.html&d=BQMFaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMN
> >tXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=uyMUTwlAFqpkT9D3pm
> >PQi1LFOOG-ByD1htMGkp5eXLc&s=arX_2ZgEhNr8lPRr4LSZ2xlbzjvNSgIjq3k_e14OiDI&e=
> >>
> >
> >
> >> >
> >> >
> >> >*********************
> >> >RTFSC
> >> >*********************
> >> >
> >> >
> >> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >_______________________________________________
> >discuss mailing list
> >discuss at openvswitch.orghttp://openvswitch.org/mailman/listinfo/discuss
> ><
> https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_mailm
> >an_listinfo_discuss&d=BQMFaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs
> >&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=uyMUTwlAFqpkT9D3pmPQi1LFO
> >OG-ByD1htMGkp5eXLc&s=4nNAuidLaEB358dGzxHZdMhXNbvM9Gi-C5JHG9Y3ye0&e=>
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >--
> >Regards,
> >Gowrishankar M
> >Linux Networking
> >
> >
> >
> >
> >
> >
> >
> >
> >--
> >Regards,
> >Gowrishankar M
> >Linux Networking
> >
> >
> >
> >
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>



-- 
天下英雄出我辈，一入江湖岁月催。
宏图霸业谈笑中，不胜人生一场醉。
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/f69290d2/attachment-0001.html>

From zhangzhiming at yunshan.net.cn  Tue May 26 20:34:41 2015
From: zhangzhiming at yunshan.net.cn (ZHANG Zhiming)
Date: Wed, 27 May 2015 11:34:41 +0800
Subject: [ovs-discuss] one patch was omitted to be pushed to
	branch-2.3---datapath: Fix recirc bug where skb is double freed
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
 <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>
 <201505241646035721464@yunshan.net.cn>, 
 <CACzMAJLBi1LmnAkOSX4yvd8McNp9-C7dAxbTqfOPji2LKyu2gg@mail.gmail.com>
Message-ID: <201505271134400305568@yunshan.net.cn>

Hi Andy,

Could you please tell me why the bond needs recirculation?

Thanks!


Switch configurations:

interface eth-0-7
 jumboframe enable
 ip arp inspection trust
 switchport mode trunk
 switchport trunk allowed vlan add 10-2046
 channel-group 1 mode active

interface eth-0-19
 jumboframe enable
 ip arp inspection trust
 switchport mode trunk
 switchport trunk allowed vlan add 10-2046
 channel-group 1 mode active

interface agg1
 jumboframe enable
 switchport mode trunk
 switchport trunk allowed vlan add 10-2046

Before setting lacp=active:

[root at centos125 ~]# ovs-vsctl -- find port name=bond-eth24-eth25
_uuid               : 3c2ef220-5655-4b35-b0b0-d7de3e9250de
bond_active_slave   : "00:1b:21:bb:22:4c"
bond_downdelay      : 0
bond_fake_iface     : false
bond_mode           : balance-tcp
bond_updelay        : 0
external_ids        : {}
fake_bridge         : false
interfaces          : [49f7116a-79af-42dc-a803-cb71af2aa8a3, a8949d8e-666c-44a1-8634-55f72fe9478d]
lacp                : []
mac                 : []
name                : "bond-eth24-eth25"
other_config        : {}
qos                 : []
statistics          : {}
status              : {}
tag                 : []
trunks              : []
vlan_mode           : []
[root at centos125 ~]# ovs-appctl bond/show                        
---- bond-eth24-eth25 ----
bond_mode: balance-tcp
bond may use recirculation: yes, Recirc-ID : 301
bond-hash-basis: 0
updelay: 0 ms
downdelay: 0 ms
next rebalance: 64 ms
lacp_status: off
active slave mac: 00:1b:21:bb:22:4c(eth24)

slave eth24: enabled
        active slave
        may_enable: true

slave eth25: enabled
        may_enable: true
[root at centos125 ~]# ovs-dpctl dump-flows
recirc_id(0),skb_priority(0),in_port(1),eth(src=86:47:ee:35:8a:e6,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=172.16.37.1/255.255.255.255,tip=172.16.1.120/255.255.255.255,op=1/0xff,sha=86:47:ee:35:8a:e6/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:0, bytes:0, used:never, actions:2
recirc_id(0),skb_priority(0),in_port(1),eth(src=7e:51:5f:37:e0:58,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=172.16.39.2/255.255.255.255,tip=172.16.79.128/255.255.255.255,op=1/0xff,sha=7e:51:5f:37:e0:58/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:48123, bytes:2887380, used:0.249s, actions:2
recirc_id(0),skb_priority(0),in_port(1),eth(src=02:43:5a:97:75:a6,dst=f8:b1:56:de:3c:03),eth_type(0x0800),ipv4(src=172.16.37.32/0.0.0.0,dst=172.16.1.125/0.0.0.0,proto=6/0,tos=0x10/0,ttl=64/0,frag=no/0xff), packets:11, bytes:966, used:0.001s, flags:P., actions:2
recirc_id(0),skb_priority(0),in_port(1),eth(src=e4:68:a3:97:9b:f0,dst=01:80:c2:00:00:00),eth_type(0/0xffff), packets:0, bytes:0, used:never, actions:drop
recirc_id(0),skb_priority(0),in_port(1),eth(src=78:2b:cb:47:e4:4c,dst=78:2b:cb:79:8a:e2),eth_type(0x0806), packets:1, bytes:60, used:0.978s, actions:2
recirc_id(0),skb_priority(0),in_port(1),eth(src=b8:ca:3a:b0:62:a1,dst=01:00:5e:7f:01:d2),eth_type(0x0800),ipv4(src=172.16.1.119/0.0.0.0,dst=239.255.1.210/0.0.0.0,proto=17/0,tos=0/0,ttl=1/0,frag=no/0xff), packets:35193, bytes:5666073, used:0.086s, actions:2
recirc_id(0),skb_priority(0),in_port(1),eth(src=78:2b:cb:76:e5:9f,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.33.23.66/0.0.0.0,tip=10.33.23.66/0.0.0.0,op=2/0xff,sha=78:2b:cb:76:e5:9f/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:0, bytes:0, used:never, actions:2
recirc_id(0),skb_priority(0x6),in_port(2),eth(src=f8:b1:56:de:3c:03,dst=02:43:5a:97:75:a6),eth_type(0x0800),ipv4(src=172.16.1.125/0.0.0.0,dst=172.16.37.32/0.0.0.0,proto=6/0,tos=0x10/0,ttl=64/0,frag=no/0xff), packets:5, bytes:634, used:0.002s, flags:P., actions:1


After setting lacp=active and configure an IP address to the bridge of bond-eth24-eth25, the server rebooted immediately.
[root at centos125 ~]# ifconfig nspbr1 192.168.1.125/16 

The outputs of another console:
[root at centos125 ~]# watch -n 1 "ovs-dpctl dump-flows" 
recirc_id(0),skb_priority(0),in_port(5),eth(src=52:54:00:81:7f:38,dst=ff:ff:ff:ff:ff:ff),eth_type(0x8100),vlan(vid=41/0xfff,pcp=0/0x0,cfi=1/1),encap(eth_type(0x0806),ar
p(sip=10.10.3.10/255.255.255.255,tip=10.10.3.1/255.255.255.255,op=1/0xff,sha=52:54:00:81:7f:38/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00)), packets:0, b
ytes:0, used:never, actions:drop
recirc_id(0),skb_priority(0),in_port(1),eth(src=78:2b:cb:48:41:55,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=172.16.1.107/255.255.255.255,tip=172.16.148.0/255.255.
255.255,op=1/0xff,sha=78:2b:cb:48:41:55/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:0, bytes:0, used:never, actions:2
recirc_id(0),skb_priority(0),in_port(6),eth(src=78:2b:cb:79:8a:e2,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=192.168.0.1/255.255.255.255,tip=192.168.137.172/255.25
5.255.255,op=1/0xff,sha=78:2b:cb:79:8a:e2/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:0, bytes:0, used:never, actions:7
recirc_id(0),skb_priority(0),in_port(1),eth(src=7e:51:5f:37:e0:58,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=172.16.39.2/255.255.255.255,tip=172.16.79.128/255.255.
255.255,op=1/0xff,sha=7e:51:5f:37:e0:58/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:48325, bytes:2899500, used:0.370s, actions:2
recirc_id(0),skb_priority(0),in_port(1),eth(src=02:43:5a:97:75:a6,dst=f8:b1:56:de:3c:03),eth_type(0x0800),ipv4(src=172.16.37.32/0.0.0.0,dst=172.16.1.125/0.0.0.0,proto=6
/0,tos=0x10/0,ttl=64/0,frag=no/0xff), packets:99, bytes:9723, used:1.002s, flags:SFP., actions:2
recirc_id(0),skb_priority(0),in_port(1),eth(src=be:6e:e7:c1:4a:03,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=172.16.41.2/255.255.255.255,tip=172.16.44.253/255.255.
255.255,op=1/0xff,sha=be:6e:e7:c1:4a:03/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:2, bytes:120, used:0.379s, actions:2
recirc_id(0),skb_priority(0),in_port(1),eth(src=d4:ae:52:a2:56:e8,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=172.17.1.104/0.0.0.0,tip=172.17.1.104/0.0.0.0,op=2/0xf
f,sha=d4:ae:52:a2:56:e8/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:0, bytes:0, used:never, actions:2
recirc_id(0),skb_priority(0),in_port(6),eth(src=00:1c:73:69:7a:0f,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=192.168.22.111/255.255.255.255,tip=192.168.1.125/255.2
55.255.255,op=1/0xff,sha=00:1c:73:69:7a:0f/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:2, bytes:120, used:0.918s, actions:7
recirc_id(0),skb_priority(0),in_port(1),eth(src=e4:68:a3:97:9b:f0,dst=01:80:c2:00:00:00),eth_type(0/0xffff), packets:0, bytes:0, used:never, actions:drop
recirc_id(0),skb_priority(0),in_port(1),eth(src=78:2b:cb:48:41:55,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=172.16.1.107/255.255.255.255,tip=172.16.148.9/255.255.
255.255,op=1/0xff,sha=78:2b:cb:48:41:55/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00), packets:0, bytes:0, used:never, actions:2    
recirc_id(0),skb_priority(0),in_port(1),eth(src=b8:ca:3a:b0:62:a1,dst=01:00:5e:7f:01:d2),eth_type(0x0800),ipv4(src=172.16.1.119/0.0.0.0,dst=239.255.1.210/0.0.0.0,proto=
17/0,tos=0/0,ttl=1/0,frag=no/0xff), packets:35340, bytes:5689740, used:1.089s, actions:2
recirc_id(0),skb_priority(0x6),in_port(2),eth(src=f8:b1:56:de:3c:03,dst=02:43:5a:97:75:a6),eth_type(0x0800),ipv4(src=172.16.1.125/0.0.0.0,dst=172.16.37.32/0.0.0.0,proto
=6/0,tos=0x10/0,ttl=64/0,frag=no/0xff), packets:50, bytes:24916, used:1.002s, flags:P., actions:1







ZHANG Zhiming
Yunshan Networks

From: Andy Zhou
Date: 2015-05-27 10:13
To: zhangzhiming
CC: Alex Wang; discuss
Subject: Re: Re: [ovs-discuss] one patch was omitted to be pushed to branch-2.3---datapath: Fix recirc bug where skb is double freed
On Sun, May 24, 2015 at 1:46 AM, ZHANG Zhiming
<zhangzhiming at yunshan.net.cn> wrote:
> Hi,
>
>
> Here you are.
> This bug is triggered by configuring bond_mode=banlace-tcp and lacp=active
> simultaneously.
> The version of OVS is 2.3.1.
>
>

Thanks, this helps. The backtrace suggested there is a stack
corruption from 'execute_recirc()',  But it not
obvious what is the problem.  I will need to think about it more. In
the mean time, would you please post
a snap shot of the datapath flows,  using the 'ovs-dpctl dump-flows' command.

Thanks,

Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/d0c79a2d/attachment-0001.html>

From cvinllen at gmail.com  Tue May 26 20:38:17 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Wed, 27 May 2015 11:38:17 +0800
Subject: [ovs-discuss] How to show group table and of1.3 table ?
In-Reply-To: <CAN2QyzZA8NDQyDaLdWEpgvJwbzpW15tQ9CKExp81zwSeMP_ftw@mail.gmail.com>
References: <CAN2QyzYtqPF1anXA6W_i9ZN-=qEO_9e_y0+00ZrvTtWJ+2buag@mail.gmail.com>
 <20150525201547.GC28242@nicira.com>
 <CAN2QyzZA8NDQyDaLdWEpgvJwbzpW15tQ9CKExp81zwSeMP_ftw@mail.gmail.com>
Message-ID: <CAN2QyzbDAO3zHMZ23nq4zLTyeeYjx_8XvAQowEgiMtcwfwtwww@mail.gmail.com>

Hi, Dear Ben:

    I found the dump-flow command in ovs-ofctl, but i cannot find the
dump-group command as i look at the manpage.

On Tue, May 26, 2015 at 8:43 AM, Vinllen Chen <cvinllen at gmail.com> wrote:

> Thankyou Ben~
>
> On Tue, May 26, 2015 at 4:15 AM, Ben Pfaff <blp at nicira.com> wrote:
>
>> On Mon, May 25, 2015 at 11:10:06PM +0800, Vinllen Chen wrote:
>> >     I want to kown how to use ovs-ofctl to dump the group table and all
>> > of1.3 table like "port", "vlan", "mac", "unicast" ?
>>
>> ovs-ofctl has commands to do this.  The manpage documents it.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/7ec8906a/attachment.html>

From s54088.cs98 at g2.nctu.edu.tw  Tue May 26 22:37:41 2015
From: s54088.cs98 at g2.nctu.edu.tw (=?UTF-8?B?U2hhby1Zb3UgV3Ug5ZCz5bCR5Y+L?=)
Date: Wed, 27 May 2015 13:37:41 +0800
Subject: [ovs-discuss] Fwd:  Multiple MPLS label pushing?
In-Reply-To: <CAPv_OZAdqmSCWf=6GgvUg1ckoxjj0UHPvUcZNs-f8pUsmw-A1g@mail.gmail.com>
References: <CAPv_OZDi-HfS5VKf=opvKP6UigMCdMtX48p5eGJ8gbxZKY9dUQ@mail.gmail.com>
 <CALnjE+pwHp=Y9NVQby7L+fvxpVjtjFduOrSWvD0yc9iqBsv+Zw@mail.gmail.com>
 <CAPv_OZAdqmSCWf=6GgvUg1ckoxjj0UHPvUcZNs-f8pUsmw-A1g@mail.gmail.com>
Message-ID: <CAPv_OZCfQZJ1wGjo7kPYCyChZe36tWbSK5=ATFw0gtETaoX1yg@mail.gmail.com>

---------- Forwarded message ----------
From: Shao-You Wu 吳少友 <s54088.cs98 at g2.nctu.edu.tw>
Date: 2015-05-27 13:30 GMT+08:00
Subject: Re: [ovs-discuss] Multiple MPLS label pushing?
To: Pravin Shelar <pshelar at nicira.com>


Hi Pravin Shelar,

I succeeded in rebuilding, but OVS still cannot support >3 MPLS stack.
Thanks for your reply.

2015-05-27 5:02 GMT+08:00 Pravin Shelar <pshelar at nicira.com>:

>
>
> On Fri, May 22, 2015 at 6:09 AM, Shao-You Wu 吳少友 <
> s54088.cs98 at g2.nctu.edu.tw> wrote:
>
>> Hi all,
>>
>> I've tried to push/pop MPLS labels on the packets, but currently, ovs
>> only supports "3 MPLS label pushing".
>> I need longer MPLS label stack.
>>
>> -------------------
>> Related code segments in "lib/flow.h":
>> #L76
>> /* Maximum number of supported MPLS labels. */
>> #define FLOW_MAX_MPLS_LABELS 3
>> #L158
>> BUILD_ASSERT_DECL(offsetof(struct flow, igmp_group_ip4) + sizeof(uint32_t
>> ) == sizeof(struct flow_tnl) + 192
>> -------------------
>>
>> I changed FLOW_MAX_MPLS_LABELS from 3 to another bigger value (saying,
>> 9),
>> added additional 24 bytes ( (9-3)x4 = 24 ) in the end of line 158,
>> and re-built the ovs.
>>
>> Unfortunately, it still supports only 3 stacked MPLS labels.
>> Does anyone knows what else I should do?
>>
>
> What error do you see after the rebuild?
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/5caae0ff/attachment.html>

From cvinllen at gmail.com  Tue May 26 23:32:12 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Wed, 27 May 2015 14:32:12 +0800
Subject: [ovs-discuss] How to show group table and of1.3 table ?
In-Reply-To: <CAN2QyzbDAO3zHMZ23nq4zLTyeeYjx_8XvAQowEgiMtcwfwtwww@mail.gmail.com>
References: <CAN2QyzYtqPF1anXA6W_i9ZN-=qEO_9e_y0+00ZrvTtWJ+2buag@mail.gmail.com>
 <20150525201547.GC28242@nicira.com>
 <CAN2QyzZA8NDQyDaLdWEpgvJwbzpW15tQ9CKExp81zwSeMP_ftw@mail.gmail.com>
 <CAN2QyzbDAO3zHMZ23nq4zLTyeeYjx_8XvAQowEgiMtcwfwtwww@mail.gmail.com>
Message-ID: <CAN2QyzZaD_XO3_KR6-5kT8LEPHmhL=1J2icfNs6NyQuJg6_Ogg@mail.gmail.com>

sorry, ignore this stupid question, i got it. it's my ovs version problem

On Wed, May 27, 2015 at 11:38 AM, Vinllen Chen <cvinllen at gmail.com> wrote:

> Hi, Dear Ben:
>
>     I found the dump-flow command in ovs-ofctl, but i cannot find the
> dump-group command as i look at the manpage.
>
> On Tue, May 26, 2015 at 8:43 AM, Vinllen Chen <cvinllen at gmail.com> wrote:
>
>> Thankyou Ben~
>>
>> On Tue, May 26, 2015 at 4:15 AM, Ben Pfaff <blp at nicira.com> wrote:
>>
>>> On Mon, May 25, 2015 at 11:10:06PM +0800, Vinllen Chen wrote:
>>> >     I want to kown how to use ovs-ofctl to dump the group table and all
>>> > of1.3 table like "port", "vlan", "mac", "unicast" ?
>>>
>>> ovs-ofctl has commands to do this.  The manpage documents it.
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/2f9ca07d/attachment.html>

From zhangzhiming at yunshan.net.cn  Wed May 27 02:43:37 2015
From: zhangzhiming at yunshan.net.cn (ZHANG Zhiming)
Date: Wed, 27 May 2015 17:43:37 +0800
Subject: [ovs-discuss] one patch was omitted to be pushed to
	branch-2.3---datapath: Fix recirc bug where skb is double freed
References: <201505171929246957801@yunshan.net.cn>
 <CAArS4XUno+WTtxsAKKVu7DazSJSvfhi0QidJjhJvw2eTqOk=+g@mail.gmail.com>
 <CACzMAJLRzzR-CpcZ5cw4vsH9qfiuy1rPnTW278QCZqakthUjXQ@mail.gmail.com>
 <201505241646035721464@yunshan.net.cn>, 
 <CACzMAJLBi1LmnAkOSX4yvd8McNp9-C7dAxbTqfOPji2LKyu2gg@mail.gmail.com>
Message-ID: <2015052717433597004411@yunshan.net.cn>

Hi,  Andy,

Could you reproduce this bug?




ZHANG Zhiming
Yunshan Networks

From: Andy Zhou
Date: 2015-05-27 10:13
To: zhangzhiming
CC: Alex Wang; discuss
Subject: Re: Re: [ovs-discuss] one patch was omitted to be pushed to branch-2.3---datapath: Fix recirc bug where skb is double freed
On Sun, May 24, 2015 at 1:46 AM, ZHANG Zhiming
<zhangzhiming at yunshan.net.cn> wrote:
> Hi,
>
>
> Here you are.
> This bug is triggered by configuring bond_mode=banlace-tcp and lacp=active
> simultaneously.
> The version of OVS is 2.3.1.
>
>

Thanks, this helps. The backtrace suggested there is a stack
corruption from 'execute_recirc()',  But it not
obvious what is the problem.  I will need to think about it more. In
the mean time, would you please post
a snap shot of the datapath flows,  using the 'ovs-dpctl dump-flows' command.

Thanks,

Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/f2489c73/attachment-0001.html>

From maniksidana019 at gmail.com  Wed May 27 06:29:11 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Wed, 27 May 2015 18:59:11 +0530
Subject: [ovs-discuss] Secured tunnels in OVS
In-Reply-To: <CAG-CZ9cFXvks6wXEXSwkAtrG=FSymsXUouxKC+_tcxPswQB-yg@mail.gmail.com>
References: <CAG-CZ9cFXvks6wXEXSwkAtrG=FSymsXUouxKC+_tcxPswQB-yg@mail.gmail.com>
Message-ID: <CAG-CZ9c--brZ0xrj1FXmkqcLrn5eYMWiQfOQSjvpXBxj2JiWFQ@mail.gmail.com>

Hi all,

Is there any way to implement secured tunnels with OVS ( something similar
like openswan etc)  ?

As per my knowledge, ovs doesnt have such support(Correct me if I'm wrong).
Is there any plan for such support?

Thanks
Manik Sidana
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/c2c5194d/attachment.html>

From shettyg at nicira.com  Wed May 27 07:57:45 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Wed, 27 May 2015 07:57:45 -0700
Subject: [ovs-discuss] Secured tunnels in OVS
In-Reply-To: <CAG-CZ9c--brZ0xrj1FXmkqcLrn5eYMWiQfOQSjvpXBxj2JiWFQ@mail.gmail.com>
References: <CAG-CZ9cFXvks6wXEXSwkAtrG=FSymsXUouxKC+_tcxPswQB-yg@mail.gmail.com>
 <CAG-CZ9c--brZ0xrj1FXmkqcLrn5eYMWiQfOQSjvpXBxj2JiWFQ@mail.gmail.com>
Message-ID: <CAHbON5of1DwQxfyPa3+q8vuYoCjKN9+2Y6r_2H8nKS2GVS5Vvg@mail.gmail.com>

OVS does support ipsec. There is code in debian/ovs-monitor-ipsec that
does ipsec using the Racoon daemon. We have had success with
Strongswan too, but there is no opensource code for that yet (there is
a plan, though).

On Wed, May 27, 2015 at 6:29 AM, Manik Sidana <maniksidana019 at gmail.com> wrote:
> Hi all,
>
> Is there any way to implement secured tunnels with OVS ( something similar
> like openswan etc)  ?
>
> As per my knowledge, ovs doesnt have such support(Correct me if I'm wrong).
> Is there any plan for such support?
>
> Thanks
> Manik Sidana
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From blp at nicira.com  Wed May 27 08:38:19 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 08:38:19 -0700
Subject: [ovs-discuss] How to show group table and of1.3 table ?
In-Reply-To: <CAN2QyzbDAO3zHMZ23nq4zLTyeeYjx_8XvAQowEgiMtcwfwtwww@mail.gmail.com>
References: <CAN2QyzYtqPF1anXA6W_i9ZN-=qEO_9e_y0+00ZrvTtWJ+2buag@mail.gmail.com>
 <20150525201547.GC28242@nicira.com>
 <CAN2QyzZA8NDQyDaLdWEpgvJwbzpW15tQ9CKExp81zwSeMP_ftw@mail.gmail.com>
 <CAN2QyzbDAO3zHMZ23nq4zLTyeeYjx_8XvAQowEgiMtcwfwtwww@mail.gmail.com>
Message-ID: <20150527153819.GA12926@nicira.com>

It's documented there.  If it appears to be missing, perhaps you are
using an old version of OVS that lacks support.

On Wed, May 27, 2015 at 11:38:17AM +0800, Vinllen Chen wrote:
> Hi, Dear Ben:
> 
>     I found the dump-flow command in ovs-ofctl, but i cannot find the
> dump-group command as i look at the manpage.
> 
> On Tue, May 26, 2015 at 8:43 AM, Vinllen Chen <cvinllen at gmail.com> wrote:
> 
> > Thankyou Ben~
> >
> > On Tue, May 26, 2015 at 4:15 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> >> On Mon, May 25, 2015 at 11:10:06PM +0800, Vinllen Chen wrote:
> >> >     I want to kown how to use ovs-ofctl to dump the group table and all
> >> > of1.3 table like "port", "vlan", "mac", "unicast" ?
> >>
> >> ovs-ofctl has commands to do this.  The manpage documents it.
> >>
> >
> >

From blp at nicira.com  Wed May 27 08:39:22 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 08:39:22 -0700
Subject: [ovs-discuss] pf_packet/af_packet socket with vlan tagging does
 not strip vlan tag
In-Reply-To: <CAAcrFUZ=ja9Ki_D=Xquz-xetLjTKeSD5a-8DoavUdJeNtyStHw@mail.gmail.com>
References: <CAAcrFUZW=nYFfaEYmWof+-SEaiW2LdCorjo3bgiX7=uYYUJBpw@mail.gmail.com>
 <20150527012256.GU18978@nicira.com>
 <CAAcrFUZ=ja9Ki_D=Xquz-xetLjTKeSD5a-8DoavUdJeNtyStHw@mail.gmail.com>
Message-ID: <20150527153922.GB12926@nicira.com>

Jesse and Pravin, can you comment on the best way to deal with this
long-standing bug?

On Tue, May 26, 2015 at 09:18:30PM -0700, Jon Gainsley wrote:
> Hi Ben,
> 
> Thanks for your response. Yeah, that's exactly it. I tracked it down to
> pop_vlan(), which was not popping the vlan because skb->protocol was set to
> ETH_P_ALL, rather than ETH_P_8021Q. The reason it works on the first few
> packets is without a rule, the packet is upcalled, which clones skb and
> properly assigns skb->protocol by parsing the packet.
> 
> If it's a kernel bug, it's not fixed in 3.16. I've modified
> datapath/actions.c:pop_vlan to check the packet's eth proto and set
> skb->protocol to ETH_P_8021Q if that's what's in the packet, so the vlan
> gets popped correctly. I don't know if you have any comments on if that's a
> valid workaround, but it's what I'm going to try for now and see how it
> goes.
> 
> Thanks!
> -Jon
> 
> 
> 
> On Tue, May 26, 2015 at 6:22 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, May 20, 2015 at 01:45:37PM -0700, Jon Gainsley wrote:
> > > Hi,
> > >
> > > I'm wondering if anyone can help me with this. I am having trouble
> > > inserting raw vlan tagged packets into the vswitch using an AF_PACKET
> > > socket. I have the following simple bridge:
> >
> > This kind of sounds like this kernel bug described in the thread here:
> >         http://openvswitch.org/pipermail/dev/2011-December/013948.html
> >
> > I don't know whether it's been fixed.
> >

From blp at nicira.com  Wed May 27 08:46:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 08:46:04 -0700
Subject: [ovs-discuss] [Dpdk-ovs] How use userspace tunneling?
In-Reply-To: <CAJoD7yRxS6_KOgtzbZfxs0b8HTnhDMkrxRsNUh1U_DMkT8TwJw@mail.gmail.com>
References: <CAJoD7yRxS6_KOgtzbZfxs0b8HTnhDMkrxRsNUh1U_DMkT8TwJw@mail.gmail.com>
Message-ID: <20150527154604.GE12926@nicira.com>

On Wed, May 27, 2015 at 10:54:04AM +0900, 차은호 wrote:
> I want to use dpdk-ovs with vxlan tunneling.
> 
> I have build OVS(github master branch) with DPDK(2.0.0) as mentioned in the
> INSTALL.DPDK.md <http://install.dpdk.md/>.
> And I try use userspace tunneling as mentioned in
> the README-native-tunneling.md.
> 
> ovs-vsctl add-br br-eth1  -- set bridge br-eth1 datapath_type=netdev
> ovs-vsctl add-port br-eth1 dpdk0 -- set Interface dpdk0 type=dpdk;
> 
> However, when I try assign ip address to br-eth1, ovs-vswitchd is killed
> with segfault.
> ifconfig br-eth1 172.168.1.1 netmask 255.255.255.0

You must have found a bug.  Can you get us a backtrace?

From blp at nicira.com  Wed May 27 08:53:49 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 08:53:49 -0700
Subject: [ovs-discuss] openvswitch issue with openflow version 1.3 script
In-Reply-To: <SINPR03MB3315273AEAC8A6D887B396895DA0@SINPR03MB331.apcprd03.prod.outlook.com>
References: <SINPR03MB3315273AEAC8A6D887B396895DA0@SINPR03MB331.apcprd03.prod.outlook.com>
Message-ID: <20150527155349.GG12926@nicira.com>

On Tue, May 12, 2015 at 11:56:06AM +0000, jayachandran.subramanian at wipro.com wrote:
> FAIL: bsn_gentable.SetBucketsSizeError

All the bsn tests are going to fail because they require Big Switch
extensions that OVS does not implement.  If any of these extensions are
of general interest then we'd gratefully accept implementations for Open
vSwitch.

From blp at nicira.com  Wed May 27 08:59:18 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 08:59:18 -0700
Subject: [ovs-discuss] new experimenter action.
In-Reply-To: <D1728213.28062%davidjoshuaevans@gmail.com>
References: <D1728213.28062%davidjoshuaevans@gmail.com>
Message-ID: <20150527155918.GI12926@nicira.com>

Thanks for writing this up.

If you wanted to expand on this a bit then I'd be happy to see it posted
as a blog entry in some appropriate place.  Then it would be easier to
point people looking for guidance to it.

On Fri, May 08, 2015 at 03:47:17PM -0500, David Evans wrote:
> Hi Ben,
> Thank you for your guidance so far  - here is my accumulated knowledge
> back into the discussion.
> 
> As I understand it - and this could be the beginning of a HOWTO of sorts
> for adding a custom packet action - munger/modifier/handler
> 
> openvswitch.h  
>     add OVS_ACTION_ATTR_FOO_MY_PACKET and describe arguments if required
> packets.c & packets.h  - my fn & pro to goes here.
>     void foo_my_packet(struct dp_packet *packet)… Etc.
> actions.c 
>     do_execute_actions() requires a case to handle
> OVS_ACTION_ATTR_FOO_MY_PACKET
> 
> 
> Open flow side
> ofp-actions.c
>     Add enum value to ofp_raw_action_type for experimenter
>     DE_RAW_FOO_MY_PACKET (with comment formatted as required for possible
> additional data & id for experimenter)
>     Add Format / decode / encode / parse functions
>     ―nb for encode, I couldn’t get ofpact_put_FOO_MY_PACKET(out) to behave
> and 
>      I’m not sure why.
>      But ofpact_put_raw(out, ofp_version, DE_RAW_FOO_MY_PACKET, 0); did
> the trick
> 
> 
> ofp-actions.h
>     Add to #define OFPACTS and include matching data structure if required.
> build-aux/extract-ofp-actions  (the python magic that makes .inc files)
>     Add my experimenter vendor id
> ofproto-dpif-xlate.c
>     static void compose_foo_my_packet_action(struct xlate_ctx *ctx){
>         nl_msg_put_u32(ctx->xout->odp_actions,
> OVS_ACTION_ATTR_FOO_MY_PACKET,0);
>         if(ctx->xin->packet) foo_my_packet(ctx->xin->packet);
>     }
> 
>     And 
>     To do_xlate_actions() add
>     case OFPACT_FOO_MY_PACKET:
>                 compose_foo_my_packet_action(...
> odp-util.c
>     format_odp_action() requires a case as does odp_action_len() entry for
> the size of required param if any.
> flow-netlink.c
>     __ovs_nla_copy_actions requires an action_lens array entry for the
> size of required param if any.
> 
> dpif-netdev.c
> 
>     May require dp_execute_cb() OVS_NOT_REACHED case.
> dpif.c
>     May require dpif_execute_helper_cb OVS_NOT_REACHED case
> 
> odp-execute.c 
>     add to odp_execute_actions a case to handle
> OVS_ACTION_ATTR_FOO_MY_PACKET
> 
> Compile and catch bugs - repeat.
> 
> Thanks again!
> 
> 
> On 5/6/15, 5:58 PM, "David Evans" <davidjoshuaevans at gmail.com> wrote:
> 
> >Thank you.
> >That was helpful.
> >I found that using the default ofpact_put* failed. And I used
> >ofpact_put_raw() instead. I don¹t know why. But I kept getting illegal
> >length not %8 from ovs-ofctl.
> >
> >Now I see some compose_* actions in the ofproto-dpif-xlate.c
> >But I don¹t see how anything turns from a OFPACT_* into an
> >OVS_ACTION_ATTR_* ?
> >Where does this part of the translation from openflow action to datapath
> >action happen.
> >I don¹t see any tables, or comparison items that would lead me to be able
> >to match my OVS_ACTION_ATTR_FOO_MY_PKTS against my new ofp_raw_action_type
> >Value DE_RAW_FOO_MY_PKTS action.
> >
> >I think do_xlate_actions is supposed to build a ctx for this but I am at
> >a loss to understand how I do the above.
> >
> >Regards,
> >Dave.
> >
> >
> >On 5/6/15, 12:40 PM, "Ben Pfaff" <blp at nicira.com> wrote:
> >
> >>On Wed, May 06, 2015 at 08:00:07AM -0500, David Evans wrote:
> >>> I have gotten a little further.
> >>> My new flow action registers ok in ovs, but when i use ovs-ofctl to
> >>>dump
> >>> the flows, the reply message parser in ovs-ofctl bails out trying to
> >>>read
> >>> the instruction/actions from the message saying that they're an invalid
> >>> length.
> >>> Do i need a vendor_id specific stats reply or something like that to
> >>>fix
> >>> this?
> >>
> >>It seems likely that the encode_*() function that you wrote does not
> >>properly encode the new action.  Does it use the generated
> >>ofpact_put_*() function to encode the action?  I would also check the
> >>hexdump for the action to make sure that it has the expected format.
> >>
> >>You do need a "vendor extension" or "experimenter" action but the
> >>generated ofpact_put_*() function should take care of that for you.
> >
> >
> 
> 

From blp at nicira.com  Wed May 27 09:07:36 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 09:07:36 -0700
Subject: [ovs-discuss] release OVS 2.0.3? (was: Re: Crash in openvswitch
 2.0.2)
In-Reply-To: <555A199C.4050907@ubuntu.com>
References: <117DA076-BD34-4C01-94AE-22949AEF0E42@nuvula.ch>
 <55241FD8.1040704@ubuntu.com>
 <A00A93E9-6A58-458C-8E8B-C8542176ADDA@nuvula.ch>
 <553519F7.3060901@ubuntu.com>
 <CA907DB2-9B8D-4BEA-A902-8F9E436268A8@nuvula.ch>
 <5537613B.5070804@ubuntu.com>
 <CANr6G5wcnfy0YMeaBbs_xM1YupQbE+u80iv-wAWPgtRoOPaJnA@mail.gmail.com>
 <555058F4.904@ubuntu.com>
 <A51DB93A-FD1C-4C52-BB98-A465EA302656@nuvula.ch>
 <555A199C.4050907@ubuntu.com>
Message-ID: <20150527160736.GK12926@nicira.com>

Hi Justin.

It looks like commit 417d7a008b9f2 (lib/odp-util: Do not use mask if it
doesn't exist.) fixes a crash bug in OVS 2.0.2.  This commit is
currently on branch-2.0 but not part of an OVS release.  There are
several other commits beyond 2.0.2.  Should we release an OVS 2.0.3 from
branch-2.0?

Thanks,

Ben.

From blp at nicira.com  Wed May 27 09:16:50 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 09:16:50 -0700
Subject: [ovs-discuss] Network issue with spanning-tree
In-Reply-To: <87lhhh5kvh.fsf@hati.baby-gnu.org>
References: <87lhhh5kvh.fsf@hati.baby-gnu.org>
Message-ID: <20150527161650.GO12926@nicira.com>

[getting back to email after a month of craziness]

On Fri, Apr 24, 2015 at 10:31:14PM +0200, Daniel Dehennin wrote:
> We are experimenting network issues each time we start a new VM.
> 
> The other VMs have their network blocked until I see “a topology change
> is detected” in Open vSwitch logs.
> 
> Do you have any advice for such configuration?

Does it help to, when you add a VM, set stp-enable=false on the
interface?  You would, I think, need to add it in the same database
transaction (e.g. same ovs-vsctl invocation) that adds the port.

This is based on Jarno's suggestion here:
        http://openvswitch.org/pipermail/dev/2015-May/055266.html

From blp at nicira.com  Wed May 27 09:18:14 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 09:18:14 -0700
Subject: [ovs-discuss] Temporary loss of network connection during
 addition of a port to bridge
In-Reply-To: <55399E9D.9000300@smorg.co.uk>
References: <5538AD3F.3030908@smorg.co.uk> <20150423181801.GC30938@nicira.com>
 <553987C3.3020908@smorg.co.uk> <20150424003826.GA12203@nicira.com>
 <55399E9D.9000300@smorg.co.uk>
Message-ID: <20150527161814.GP12926@nicira.com>

[getting back to email after a month of craziness]

On Fri, Apr 24, 2015 at 02:38:37AM +0100, Mark Clarkson wrote:
> On 24/04/15 01:38, Ben Pfaff wrote:
> >On Fri, Apr 24, 2015 at 01:01:07AM +0100, Mark Clarkson wrote:
> >>On 23/04/15 19:18, Ben Pfaff wrote:
> >>>I don't think that the behavior you describe is intentional.  It sounds
> >>>like a bug or an unexpected interaction between features.  I think
> >>>you'll have to investigate and figure out why it's happening, and then
> >>>once we understand that it can be fixed.
> >>This is also how linux bridge works though, so maybe it is intentional(?).
> >>Although the linux bridge allows a forwarding delay of zero for cases where
> >>there's only one bridge.
> >We could make OVS support a forwarding delay of zero.  Presumably, that
> >risks loops, but we could argue that it's the sysadmin's choice.
> 
> Not sure I'd be comfortable with that. I used to get the same delays with
> linux bridges but now ping doesn't miss a single beat when an interface is
> added, and I don't understand why. The application quits every time on ovs
> and never with linux bridge. Maybe misconfiguration on my part?

Does it help to, when you add a VM, set stp-enable=false on the
interface?  You would, I think, need to add it in the same database
transaction (e.g. same ovs-vsctl invocation) that adds the port.

This is based on Jarno's suggestion here:
        http://openvswitch.org/pipermail/dev/2015-May/055266.html

From jpettit at nicira.com  Wed May 27 09:23:59 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 27 May 2015 09:23:59 -0700
Subject: [ovs-discuss] release OVS 2.0.3? (was: Re: Crash in openvswitch
	2.0.2)
In-Reply-To: <20150527160736.GK12926@nicira.com>
References: <117DA076-BD34-4C01-94AE-22949AEF0E42@nuvula.ch>
 <55241FD8.1040704@ubuntu.com>
 <A00A93E9-6A58-458C-8E8B-C8542176ADDA@nuvula.ch>
 <553519F7.3060901@ubuntu.com>
 <CA907DB2-9B8D-4BEA-A902-8F9E436268A8@nuvula.ch>
 <5537613B.5070804@ubuntu.com>
 <CANr6G5wcnfy0YMeaBbs_xM1YupQbE+u80iv-wAWPgtRoOPaJnA@mail.gmail.com>
 <555058F4.904@ubuntu.com> <A51DB93A-FD1C-4C52-BB98-A465EA302656@nuvula.ch>
 <555A199C.4050907@ubuntu.com> <20150527160736.GK12926@nicira.com>
Message-ID: <75574491-62B0-42BE-8668-39017758D297@nicira.com>

2.0 is not an LTS.  Is there a reason not to upgrade to 2.3, which is?  I've been planning to do a new 2.3 release, but a couple of bugs have been trickling in, so I wanted those to settle down.

--Justin


> On May 27, 2015, at 9:07 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> Hi Justin.
> 
> It looks like commit 417d7a008b9f2 (lib/odp-util: Do not use mask if it
> doesn't exist.) fixes a crash bug in OVS 2.0.2.  This commit is
> currently on branch-2.0 but not part of an OVS release.  There are
> several other commits beyond 2.0.2.  Should we release an OVS 2.0.3 from
> branch-2.0?
> 
> Thanks,
> 
> Ben.


From blp at nicira.com  Wed May 27 09:25:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 09:25:26 -0700
Subject: [ovs-discuss] release OVS 2.0.3? (was: Re: Crash in openvswitch
 2.0.2)
In-Reply-To: <75574491-62B0-42BE-8668-39017758D297@nicira.com>
References: <A00A93E9-6A58-458C-8E8B-C8542176ADDA@nuvula.ch>
 <553519F7.3060901@ubuntu.com>
 <CA907DB2-9B8D-4BEA-A902-8F9E436268A8@nuvula.ch>
 <5537613B.5070804@ubuntu.com>
 <CANr6G5wcnfy0YMeaBbs_xM1YupQbE+u80iv-wAWPgtRoOPaJnA@mail.gmail.com>
 <555058F4.904@ubuntu.com>
 <A51DB93A-FD1C-4C52-BB98-A465EA302656@nuvula.ch>
 <555A199C.4050907@ubuntu.com> <20150527160736.GK12926@nicira.com>
 <75574491-62B0-42BE-8668-39017758D297@nicira.com>
Message-ID: <20150527162526.GS12926@nicira.com>

It's part of an Ubuntu release, so the minimal effort to release a new
version seems worthwhile to me.

On Wed, May 27, 2015 at 09:23:59AM -0700, Justin Pettit wrote:
> 2.0 is not an LTS.  Is there a reason not to upgrade to 2.3, which is?
> I've been planning to do a new 2.3 release, but a couple of bugs have
> been trickling in, so I wanted those to settle down.
> 
> --Justin
> 
> 
> > On May 27, 2015, at 9:07 AM, Ben Pfaff <blp at nicira.com> wrote:
> > 
> > Hi Justin.
> > 
> > It looks like commit 417d7a008b9f2 (lib/odp-util: Do not use mask if it
> > doesn't exist.) fixes a crash bug in OVS 2.0.2.  This commit is
> > currently on branch-2.0 but not part of an OVS release.  There are
> > several other commits beyond 2.0.2.  Should we release an OVS 2.0.3 from
> > branch-2.0?
> > 
> > Thanks,
> > 
> > Ben.
> 

From jpettit at nicira.com  Wed May 27 13:23:56 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 27 May 2015 13:23:56 -0700
Subject: [ovs-discuss] release OVS 2.0.3? (was: Re: Crash in openvswitch
	2.0.2)
In-Reply-To: <20150527162526.GS12926@nicira.com>
References: <A00A93E9-6A58-458C-8E8B-C8542176ADDA@nuvula.ch>
 <553519F7.3060901@ubuntu.com>
 <CA907DB2-9B8D-4BEA-A902-8F9E436268A8@nuvula.ch>
 <5537613B.5070804@ubuntu.com>
 <CANr6G5wcnfy0YMeaBbs_xM1YupQbE+u80iv-wAWPgtRoOPaJnA@mail.gmail.com>
 <555058F4.904@ubuntu.com> <A51DB93A-FD1C-4C52-BB98-A465EA302656@nuvula.ch>
 <555A199C.4050907@ubuntu.com> <20150527160736.GK12926@nicira.com>
 <75574491-62B0-42BE-8668-39017758D297@nicira.com>
 <20150527162526.GS12926@nicira.com>
Message-ID: <238BF767-914E-473B-B0B9-B35BC8525C41@nicira.com>

OVS 1.11 and 2.0 added support for megaflows and multithreading, respectively.  We made a conscious decision to not make those LTS because we figured there'd be issues.  Aside from the fact that we have a very clear LTS policy, I worry about those releases in particular.  There have been fundamental changes to the architecture since then, and we haven't been actively backporting fixes--because it wasn't LTS and many wouldn't apply cleanly.

By doing a release, we're essentially saying it's supported a version.  While this segfault will be fixed, it wouldn't surprise me if there were other bugs and deadlocks that have been fixed in later versions.  My preference would be, since we've back ported the change to "branch-2.0", that anyone using it do their own builds off of that.

--Justin


> On May 27, 2015, at 9:25 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> It's part of an Ubuntu release, so the minimal effort to release a new
> version seems worthwhile to me.
> 
> On Wed, May 27, 2015 at 09:23:59AM -0700, Justin Pettit wrote:
>> 2.0 is not an LTS.  Is there a reason not to upgrade to 2.3, which is?
>> I've been planning to do a new 2.3 release, but a couple of bugs have
>> been trickling in, so I wanted those to settle down.
>> 
>> --Justin
>> 
>> 
>>> On May 27, 2015, at 9:07 AM, Ben Pfaff <blp at nicira.com> wrote:
>>> 
>>> Hi Justin.
>>> 
>>> It looks like commit 417d7a008b9f2 (lib/odp-util: Do not use mask if it
>>> doesn't exist.) fixes a crash bug in OVS 2.0.2.  This commit is
>>> currently on branch-2.0 but not part of an OVS release.  There are
>>> several other commits beyond 2.0.2.  Should we release an OVS 2.0.3 from
>>> branch-2.0?
>>> 
>>> Thanks,
>>> 
>>> Ben.
>> 


From jesse at nicira.com  Wed May 27 13:34:48 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 27 May 2015 13:34:48 -0700
Subject: [ovs-discuss] pf_packet/af_packet socket with vlan tagging does
 not strip vlan tag
In-Reply-To: <20150527153922.GB12926@nicira.com>
References: <CAAcrFUZW=nYFfaEYmWof+-SEaiW2LdCorjo3bgiX7=uYYUJBpw@mail.gmail.com>
 <20150527012256.GU18978@nicira.com>
 <CAAcrFUZ=ja9Ki_D=Xquz-xetLjTKeSD5a-8DoavUdJeNtyStHw@mail.gmail.com>
 <20150527153922.GB12926@nicira.com>
Message-ID: <CAEP_g=9H=xSEnOCy2399=7ebmsT+AUrpXdX_Xqc6KeVZQZbsrA@mail.gmail.com>

I think all of the discussion from the original thread still applies.
I believe that this issue must affect a ton of other things in the
kernel (including various filtering ton with iptables) so an
OVS-specific solution is not likely to go over well. The only real
solution is to initialize skb->protocol for raw sockets in the
upstream kernel.

On Wed, May 27, 2015 at 8:39 AM, Ben Pfaff <blp at nicira.com> wrote:
> Jesse and Pravin, can you comment on the best way to deal with this
> long-standing bug?
>
> On Tue, May 26, 2015 at 09:18:30PM -0700, Jon Gainsley wrote:
>> Hi Ben,
>>
>> Thanks for your response. Yeah, that's exactly it. I tracked it down to
>> pop_vlan(), which was not popping the vlan because skb->protocol was set to
>> ETH_P_ALL, rather than ETH_P_8021Q. The reason it works on the first few
>> packets is without a rule, the packet is upcalled, which clones skb and
>> properly assigns skb->protocol by parsing the packet.
>>
>> If it's a kernel bug, it's not fixed in 3.16. I've modified
>> datapath/actions.c:pop_vlan to check the packet's eth proto and set
>> skb->protocol to ETH_P_8021Q if that's what's in the packet, so the vlan
>> gets popped correctly. I don't know if you have any comments on if that's a
>> valid workaround, but it's what I'm going to try for now and see how it
>> goes.
>>
>> Thanks!
>> -Jon
>>
>>
>>
>> On Tue, May 26, 2015 at 6:22 PM, Ben Pfaff <blp at nicira.com> wrote:
>>
>> > On Wed, May 20, 2015 at 01:45:37PM -0700, Jon Gainsley wrote:
>> > > Hi,
>> > >
>> > > I'm wondering if anyone can help me with this. I am having trouble
>> > > inserting raw vlan tagged packets into the vswitch using an AF_PACKET
>> > > socket. I have the following simple bridge:
>> >
>> > This kind of sounds like this kernel bug described in the thread here:
>> >         http://openvswitch.org/pipermail/dev/2011-December/013948.html
>> >
>> > I don't know whether it's been fixed.
>> >

From blp at nicira.com  Wed May 27 14:29:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 27 May 2015 14:29:13 -0700
Subject: [ovs-discuss] Datapath megaflow issues
In-Reply-To: <CAAcQFLnT1m7mZB11neumDcLf+LkevA2GPoJ=zY1aTQFw+e6tFQ@mail.gmail.com>
References: <CAAcQFL=1ejXw80T+efu8Az-i38B+75nfXGeGchbA79tcgpHmyQ@mail.gmail.com>
 <20150527010944.GS18978@nicira.com>
 <CAAcQFLnT1m7mZB11neumDcLf+LkevA2GPoJ=zY1aTQFw+e6tFQ@mail.gmail.com>
Message-ID: <20150527212913.GB8927@nicira.com>

On Wed, May 27, 2015 at 05:23:11PM -0400, an wang wrote:
> Thank you for the clarification. Just one more question, are there any
> documentations that I could refer to for datapath flow mask generation?

The OVS NSDI paper is a good reference:
        http://openvswitch.org/support/papers/nsdi2015.pdf

From yangwanli at jd.com  Tue May 26 18:46:02 2015
From: yangwanli at jd.com (yangwanli)
Date: Wed, 27 May 2015 09:46:02 +0800
Subject: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
	interval (365882ms user, 464906ms system)
References: <2015051918320317100434@jd.com>, 
 <CANr6G5zmkv=cgdbMSCes2k_yYaCKGhuLWxiPgB85eYCanyaFKA@mail.gmail.com>, 
 <20150523125416388568139@jd.com>, 
 <CANr6G5wcbH3as0s1hSvyifr5-2SQDYkFDgJs=u8ZCL4Mnhy3FQ@mail.gmail.com>
Message-ID: <20150527094601949466194@jd.com>

I don't enable STP.

#ovs-vsctl show
350424e8-f03c-4f5c-aaa9-fd78ec78f97b
    Bridge br-int
        fail_mode: secure
        Port "int-br-eth1"
            Interface "int-br-eth1"
                type: patch
                options: {peer="phy-br-eth1"}
        Port "tap5c0d4002-26"
            tag: 1
            Interface "tap5c0d4002-26"
        Port "tap4954ce53-06"
            tag: 3
            Interface "tap4954ce53-06"
        Port "tap6631c08d-91"
            tag: 3
            Interface "tap6631c08d-91"
        Port "tapdfd3962f-3a"
            tag: 2
            Interface "tapdfd3962f-3a"
        Port br-int
            Interface br-int
                type: internal
        Port "tapb2cd1333-03"
            tag: 1
            Interface "tapb2cd1333-03"
        Port "tap0c1153d7-bb"
            tag: 1
            Interface "tap0c1153d7-bb"
    Bridge "br-eth1"
        Port "br-eth1"
            Interface "br-eth1"
                type: internal
        Port "eth3"
            Interface "eth3"
        Port "phy-br-eth1"
            Interface "phy-br-eth1"
                type: patch
                options: {peer="int-br-eth1"}
    ovs_version: "2.3.1"


eth3 is physical NIC.
The bidge of OVS is created by:
ovs-vsctl add-br br-int
ovs-vsctl add-br br-eth1
ovs-vsctl --timeout=10 -- set-fail-mode br-int secure



WanLi  Yang
JD.COM
*****************************************************************
 
From: Joe Stringer
Date: 2015-05-27 05:05
To: yangwanli
CC: bugs
Subject: Re: Re: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll interval (365882ms user, 464906ms system)
Are you using STP?
 
On 22 May 2015 at 21:54, yangwanli <yangwanli at jd.com> wrote:
> Thank you for your response!
>
> My servers OS are all  CentOS 6.6,  kernel version: 2.6.32-504.el6.x86_64,
> vCPU:32,  RAM:256G
> #lscpu
> Architecture:          x86_64
> CPU op-mode(s):        32-bit, 64-bit
> Byte Order:            Little Endian
> CPU(s):                32
> On-line CPU(s) list:   0-31
> Thread(s) per core:    2
> Core(s) per socket:    8
> Socket(s):             2
> NUMA node(s):          2
> Vendor ID:             GenuineIntel
> CPU family:            6
> Model:                 63
> Stepping:              2
> CPU MHz:               2599.971
> BogoMIPS:              5199.24
> Virtualization:        VT-x
> L1d cache:             32K
> L1i cache:             32K
> L2 cache:              256K
> L3 cache:              20480K
> NUMA node0 CPU(s):     0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30
> NUMA node1 CPU(s):     1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31
>
> OpenvSwitch kernel module(openvswitch.ko) and user space utilities are all
> build  I use OpenvSwitch-2.3.1 source (change nothing )
> (http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz)
> #modinfo openvswitch
> /lib/modules/2.6.32-504.el6.x86_64/kernel/net/openvswitch/openvswitch.ko
> version:        2.3.1
> license:        GPL
> description:    Open vSwitch switching datapath
> srcversion:     4D7CD38A83A9A4A782F73A1
> depends:        libcrc32c
> vermagic:       2.6.32-504.el6.x86_64 SMP mod_unload modversions
> parm:           vlan_tso:Enable TSO for VLAN packets (int)
>
> I have 300 servers are all the same hardware , OS and OpenvSwitch-2.3.1.
> Since May 15, 2015, There are 6 servers  appear this problem that  when I
> execute  ovs-ofctl dump-flows br-int , not always reponse,
> OVS ports not transmit datas, led to the virtual machines cannot be
> accessed.
> When appear this problem , server load is not high, and while I excute
> netstat -anp , find some CONNECTING state of unix socket.
> I restart ovs-vswitchd and ovdb-server, becames normal.
> I doubt the thread dealock of ovs-vswitchd.
>
> All servers have the following log info:
> /var/log/openvswitch/ovs-vswitd.log:
> 2015-05-18T12:13:04.491Z|00138|coverage|INFO|Event coverage, avg rate over
> last: 5 seconds, last minute, last hour,  hash=9e13ffc8:
> 2015-05-18T12:13:04.491Z|00139|coverage|INFO|nln_changed
> 0.0/sec     0.000/sec        0.0000/sec   total: 21
> 2015-05-18T12:13:04.491Z|00140|coverage|INFO|netlink_received
> 59.4/sec    53.850/sec       53.6072/sec   total: 1159232
> 2015-05-18T12:13:04.491Z|00141|coverage|INFO|netlink_recv_jumbo
> 3.8/sec     2.767/sec        2.6536/sec   total: 53239
> 2015-05-18T12:13:04.491Z|00142|coverage|INFO|netlink_sent
> 68.0/sec    62.783/sec       62.9394/sec   total: 1353375
> 2015-05-18T12:13:04.491Z|00143|coverage|INFO|netdev_set_policing
> 0.0/sec     0.000/sec        0.0000/sec   total: 12
> 2015-05-18T12:13:04.491Z|00144|coverage|INFO|netdev_get_ifindex
> 0.0/sec     0.000/sec        0.0000/sec   total: 6
> 2015-05-18T12:13:04.491Z|00145|coverage|INFO|netdev_get_hwaddr
> 0.0/sec     0.000/sec        0.0000/sec   total: 6
> 2015-05-18T12:13:04.491Z|00146|coverage|INFO|netdev_set_hwaddr
> 0.0/sec     0.000/sec        0.0000/sec   total: 3
> 2015-05-18T12:13:04.491Z|00147|coverage|INFO|netdev_get_ethtool
> 0.0/sec     0.000/sec        0.0000/sec   total: 22
> 2015-05-18T12:13:04.491Z|00148|coverage|INFO|netdev_set_ethtool
> 0.0/sec     0.000/sec        0.0000/sec   total: 4
> 2015-05-18T12:13:04.491Z|00149|coverage|INFO|vconn_received
> 2.4/sec     2.000/sec        1.9067/sec   total: 41642
> 2015-05-18T12:13:04.491Z|00150|coverage|INFO|vconn_sent
> 1.8/sec     1.500/sec        1.4300/sec   total: 31228
> 2015-05-18T12:13:04.491Z|00151|coverage|INFO|util_xalloc
> 1987.2/sec  1867.150/sec     1817.8008/sec   total: 37808073
> 2015-05-18T12:13:04.491Z|00152|coverage|INFO|pstream_open
> 0.0/sec     0.000/sec        0.0000/sec   total: 5
> 2015-05-18T12:13:04.491Z|00153|coverage|INFO|stream_open
> 0.0/sec     0.000/sec        0.0000/sec   total: 1
> 2015-05-18T12:13:04.491Z|00154|coverage|INFO|rconn_queued
> 1.2/sec     1.000/sec        0.9533/sec   total: 20815
> 2015-05-18T12:13:04.491Z|00155|coverage|INFO|rconn_sent
> 1.2/sec     1.000/sec        0.9533/sec   total: 20815
> 2015-05-18T12:13:04.491Z|00156|coverage|INFO|poll_fd_wait
> 537.2/sec   481.217/sec      462.1683/sec   total: 9762985
> 2015-05-18T12:13:04.491Z|00157|coverage|INFO|poll_zero_timeout
> 5.2/sec     4.333/sec        3.8581/sec   total: 83823
> 2015-05-18T12:13:04.491Z|00158|coverage|INFO|txn_unchanged
> 0.0/sec     0.000/sec        0.0000/sec   total: 11
> 2015-05-18T12:13:04.491Z|00159|coverage|INFO|txn_incomplete
> 8.8/sec     8.450/sec        8.3044/sec   total: 170811
> 2015-05-18T12:13:04.491Z|00160|coverage|INFO|txn_success
> 0.2/sec     0.200/sec        0.1989/sec   total: 4276
> 2015-05-18T12:13:04.491Z|00161|coverage|INFO|netdev_get_stats
> 1.6/sec     1.600/sec        1.5911/sec   total: 32833
> 2015-05-18T12:13:04.491Z|00162|coverage|INFO|mac_learning_learned
> 0.2/sec     0.133/sec        0.0686/sec   total: 1595
> 2015-05-18T12:13:04.491Z|00163|coverage|INFO|mac_learning_expired
> 0.4/sec     0.150/sec        0.0689/sec   total: 1518
> 2015-05-18T12:13:04.491Z|00164|coverage|INFO|hmap_pathological
> 0.0/sec     0.000/sec        0.0000/sec   total: 27
> 2015-05-18T12:13:04.491Z|00165|coverage|INFO|hmap_expand
> 102.4/sec    92.300/sec       88.6772/sec   total: 1853939
> 2015-05-18T12:13:04.491Z|00166|coverage|INFO|flow_extract
> 23.0/sec    19.883/sec       19.7067/sec   total: 416747
> 2015-05-18T12:13:04.491Z|00167|coverage|INFO|dpif_port_add
> 0.0/sec     0.000/sec        0.0000/sec   total: 6
> 2015-05-18T12:13:04.491Z|00168|coverage|INFO|dpif_flow_flush
> 0.0/sec     0.000/sec        0.0000/sec   total: 4
> 2015-05-18T12:13:04.491Z|00169|coverage|INFO|dpif_flow_put
> 0.0/sec     0.000/sec        0.0000/sec   total: 2
> 2015-05-18T12:13:04.491Z|00170|coverage|INFO|dpif_flow_del
> 0.0/sec     0.000/sec        0.0000/sec   total: 1
> 2015-05-18T12:13:04.491Z|00171|coverage|INFO|dpif_execute
> 0.0/sec     0.000/sec        0.0000/sec   total: 1
> 2015-05-18T12:13:04.491Z|00172|coverage|INFO|xlate_actions
> 38.8/sec    27.317/sec       22.9731/sec   total: 507271
> 2015-05-18T12:13:04.491Z|00173|coverage|INFO|rev_reconfigure
> 0.0/sec     0.000/sec        0.0000/sec   total: 20
> 2015-05-18T12:13:04.491Z|00174|coverage|INFO|rev_port_toggled
> 0.0/sec     0.000/sec        0.0000/sec   total: 3
> 2015-05-18T12:13:04.491Z|00175|coverage|INFO|rev_flow_table
> 0.0/sec     0.000/sec        0.0000/sec   total: 11
> 2015-05-18T12:13:04.491Z|00176|coverage|INFO|rev_mac_learning
> 0.6/sec     0.283/sec        0.1286/sec   total: 2813
> 2015-05-18T12:13:04.491Z|00177|coverage|INFO|ofproto_flush
> 0.0/sec     0.000/sec        0.0000/sec   total: 3
> 2015-05-18T12:13:04.491Z|00178|coverage|INFO|ofproto_recv_openflow
> 1.8/sec     1.500/sec        1.4300/sec   total: 31229
> 2015-05-18T12:13:04.491Z|00179|coverage|INFO|ofproto_update_port
> 0.0/sec     0.000/sec        0.0000/sec   total: 34
> 2015-05-18T12:13:04.491Z|00180|coverage|INFO|bridge_reconfigure
> 0.0/sec     0.000/sec        0.0000/sec   total: 15
> 2015-05-18T12:13:04.491Z|00181|coverage|INFO|49 events never hit
> 2015-05-18T14:59:05.014Z|00182|timeval|WARN|Unreasonably long 2019ms poll
> interval (43448ms user, 50465ms system)
> 2015-05-18T14:59:05.014Z|00183|timeval|WARN|faults: 840 minor, 0 major
> 2015-05-18T14:59:05.014Z|00184|timeval|WARN|disk: 0 reads, 120 writes
> 2015-05-18T14:59:05.014Z|00185|timeval|WARN|context switches: 2167382
> voluntary, 529 involuntary
> 2015-05-18T14:59:05.014Z|00186|coverage|INFO|Skipping details of duplicate
> event coverage for hash=9e13ffc8
> 2015-05-18T17:46:50.578Z|00187|timeval|WARN|Unreasonably long 2018ms poll
> interval (56724ms user, 65745ms system)
> 2015-05-18T17:46:50.578Z|00188|timeval|WARN|faults: 841 minor, 0 major
> 2015-05-18T17:46:50.578Z|00189|timeval|WARN|disk: 0 reads, 128 writes
> 2015-05-18T17:46:50.578Z|00190|timeval|WARN|context switches: 2853218
> voluntary, 538 involuntary
> 2015-05-18T17:46:50.578Z|00191|coverage|INFO|Skipping details of duplicate
> event coverage for hash=9e13ffc8
> 2015-05-18T20:29:36.092Z|00192|timeval|WARN|Unreasonably long 2018ms poll
> interval (69561ms user, 80775ms system)
> 2015-05-18T20:29:36.092Z|00193|timeval|WARN|faults: 841 minor, 0 major
> 2015-05-18T20:29:36.092Z|00194|timeval|WARN|disk: 0 reads, 136 writes
> 2015-05-18T20:29:36.092Z|00195|timeval|WARN|context switches: 3519924
> voluntary, 544 involuntary
> 2015-05-18T20:29:36.092Z|00196|coverage|INFO|Skipping details of duplicate
> event coverage for hash=9e13ffc8
> 2015-05-18T23:21:51.729Z|00197|timeval|WARN|Unreasonably long 2021ms poll
> interval (83029ms user, 96728ms system)
> 2015-05-18T23:21:51.729Z|00198|timeval|WARN|faults: 841 minor, 0 major
> 2015-05-18T23:21:51.729Z|00199|timeval|WARN|disk: 0 reads, 144 writes
> 2015-05-18T23:21:51.729Z|00200|timeval|WARN|context switches: 4224452
> voluntary, 553 involuntary
> 2015-05-18T23:21:51.729Z|00201|coverage|INFO|Skipping details of duplicate
> event coverage for hash=9e13ffc8
>
> ________________________________
>
> WanLi Yang
>
> JD.COM
>
> *****************************************************************
>
>
> From: Joe Stringer
> Date: 2015-05-23 05:36
> To: yangwanli
> CC: bugs
> Subject: Re: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
> interval (365882ms user, 464906ms system)
> On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
>> Hi,
>> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all virtual
>> machines and containers communicate with OVS.
>> I use OVS  VLAN.
>> OpenvSwitch Version 2.3.1  (nothing change)
>> CentOS 6.6
>> In the process of I use, encounter the flowing problems.
>> Need your help!
>>
>> 1、ovs-vswitchd.log always report warnings:
>>
>> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
>> interval (365882ms user, 464906ms system)
>> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
>> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
>> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
>> voluntary, 2080 involuntary
>> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=35d02982
>> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
>> interval (380306ms user, 483259ms system)
>> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
>> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
>> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
>> voluntary, 2174 involuntary
>> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=35d02982
>
> The main loop of ovs-vswitchd usually expects to cycle at least once
> per second. This message appears when this takes longer than usual,
> which may indicate that ovs-vswitchd is under heavy load, or some sort
> of bug.
>
>>
>> 2、I also encounter this problem:
>>     when I execute
>>     ovs-ofctl dump-flows br-int
>>    not always reponse,  but ovs-vsctl show is OK!
>
> The main thread of ovs-vswitchd assembles responses to OpenFlow
> requests, and given the above messages it sounds like it's busy doing
> other things. Ovs-vsctl on the other hand talks to ovsdb-server, which
> looks like it is OK in this scenario.
>
> These both seem like symptoms, but it's not obvious to me what the
> underlying cause is. Is there anything else in the logs? Is
> ovs-vswitchd using a lot of CPU?
>
> Are you using the OVS kernel module from CentOS or one distributed
> with the openvswitch package? ('modinfo openvswitch' should give a
> hint here)
>
> On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
>> Hi,
>> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all virtual
>> machines and containers communicate with OVS.
>> I use OVS  VLAN.
>> OpenvSwitch Version 2.3.1  (nothing change)
>> CentOS 6.6
>> In the process of I use, encounter the flowing problems.
>> Need your help!
>>
>> 1、ovs-vswitchd.log always report warnings:
>>
>> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
>> interval (365882ms user, 464906ms system)
>> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
>> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
>> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
>> voluntary, 2080 involuntary
>> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=35d02982
>> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
>> interval (380306ms user, 483259ms system)
>> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
>> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
>> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
>> voluntary, 2174 involuntary
>> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=35d02982
>>
>> 2、I also encounter this problem:
>>     when I execute
>>     ovs-ofctl dump-flows br-int
>>    not always reponse,  but ovs-vsctl show is OK!
>>
>> Thanks!
>> WanLi Yang
>>
>>
>> ________________________________
>>
>> WanLi Yang
>>
>> JD.COM
>>
>> *****************************************************************
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/f8f93254/attachment-0001.html>

From jon.gainsley at pluribusnetworks.com  Tue May 26 21:18:30 2015
From: jon.gainsley at pluribusnetworks.com (Jon Gainsley)
Date: Tue, 26 May 2015 21:18:30 -0700
Subject: [ovs-discuss] pf_packet/af_packet socket with vlan tagging does
 not strip vlan tag
In-Reply-To: <20150527012256.GU18978@nicira.com>
References: <CAAcrFUZW=nYFfaEYmWof+-SEaiW2LdCorjo3bgiX7=uYYUJBpw@mail.gmail.com>
 <20150527012256.GU18978@nicira.com>
Message-ID: <CAAcrFUZ=ja9Ki_D=Xquz-xetLjTKeSD5a-8DoavUdJeNtyStHw@mail.gmail.com>

Hi Ben,

Thanks for your response. Yeah, that's exactly it. I tracked it down to
pop_vlan(), which was not popping the vlan because skb->protocol was set to
ETH_P_ALL, rather than ETH_P_8021Q. The reason it works on the first few
packets is without a rule, the packet is upcalled, which clones skb and
properly assigns skb->protocol by parsing the packet.

If it's a kernel bug, it's not fixed in 3.16. I've modified
datapath/actions.c:pop_vlan to check the packet's eth proto and set
skb->protocol to ETH_P_8021Q if that's what's in the packet, so the vlan
gets popped correctly. I don't know if you have any comments on if that's a
valid workaround, but it's what I'm going to try for now and see how it
goes.

Thanks!
-Jon



On Tue, May 26, 2015 at 6:22 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, May 20, 2015 at 01:45:37PM -0700, Jon Gainsley wrote:
> > Hi,
> >
> > I'm wondering if anyone can help me with this. I am having trouble
> > inserting raw vlan tagged packets into the vswitch using an AF_PACKET
> > socket. I have the following simple bridge:
>
> This kind of sounds like this kernel bug described in the thread here:
>         http://openvswitch.org/pipermail/dev/2011-December/013948.html
>
> I don't know whether it's been fixed.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150526/e56569e4/attachment.html>

From dcaixinha at gmail.com  Wed May 27 08:10:45 2015
From: dcaixinha at gmail.com (Daniel Caixinha)
Date: Wed, 27 May 2015 16:10:45 +0100
Subject: [ovs-discuss] Maximum Number of Queues per Port
Message-ID: <CAP_KJebrz=ka8p=MoCvOgpEsUfD+BzdJd3rNPe1Ny618c5Xb0g@mail.gmail.com>

Hello,

I am using OVS in my research work and I plan to run a simulation where I
create a high number of queues in each port (to support BW slicing) of each
OVS instance. Can somebody please tell me what is the maximum number of
queues per port in OVS? And what is the reason for that maximum?

Thank you in advance for your help.

Best regards,

Daniel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/54f37d96/attachment.html>

From wangan1213 at gmail.com  Wed May 27 14:23:11 2015
From: wangan1213 at gmail.com (an wang)
Date: Wed, 27 May 2015 17:23:11 -0400
Subject: [ovs-discuss] Datapath megaflow issues
In-Reply-To: <20150527010944.GS18978@nicira.com>
References: <CAAcQFL=1ejXw80T+efu8Az-i38B+75nfXGeGchbA79tcgpHmyQ@mail.gmail.com>
 <20150527010944.GS18978@nicira.com>
Message-ID: <CAAcQFLnT1m7mZB11neumDcLf+LkevA2GPoJ=zY1aTQFw+e6tFQ@mail.gmail.com>

Hi, Ben,

Thank you for the clarification. Just one more question, are there any
documentations that I could refer to for datapath flow mask generation?
Thanks!

An Wang

On Tue, May 26, 2015 at 9:09 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, May 21, 2015 at 01:26:01PM -0400, an wang wrote:
> > Hi, All,
> >
> > I'm trying to figure out how datapath mega flows are generated. So I did
> a
> > very simple experiment on openvswitch 2.3.0. I inserted a rule ovs-ofctl
> > add-flow br0 in_port=2,ip,nw_dst=192.168.2.2/16,actions=output:1 to the
> > userspace flow table. And I used ovs-appctl dpif/dump-flows br0 to check
> > the flows in datapath flow table and this is what I observed.
> >
> >
> skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:00:39:d3:34:3b),eth_type(0x0800),ipv4(src=
> >
> 192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=62/0,frag=no/0xff
> ),
> > packets:26670724, bytes:1762573766, used:0.000s, flags:SR., actions:2
> >
> skb_priority(0),recirc_id(0),in_port(3),eth(src=00:c0:95:e0:0e:ad,dst=00:50:56:49:01:29),eth_type(0x0800),ipv4(src=
> >
> 192.168.2.1/255.255.255.255,dst=192.168.2.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=63/0,frag=no/0xff
> ),
> > packets:9469993, bytes:586123740, used:0.000s, flags:SF., actions:2
> >
> > Somehow it seems that the ip dst field is not wildcarded at all. And I've
> > repeated the experiment for several times using different prefix and I
> > obtained the same result. Could anyone please explain why this happened
> and
> > how wildcarded flows are supported in the datapath?
>
> OVS 2.3 doesn't configure any prefix fields by default, so you have to
> set the "prefixes" column in the OVSDB Flow_Table table.
>
> OVS 2.4 uses IPV4 source and destination fields as prefixes by default.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150527/ecdccb1b/attachment.html>

From joestringer at nicira.com  Wed May 27 18:55:23 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Wed, 27 May 2015 18:55:23 -0700
Subject: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
 interval (365882ms user, 464906ms system)
In-Reply-To: <20150527094601949466194@jd.com>
References: <2015051918320317100434@jd.com>
 <CANr6G5zmkv=cgdbMSCes2k_yYaCKGhuLWxiPgB85eYCanyaFKA@mail.gmail.com>
 <20150523125416388568139@jd.com>
 <CANr6G5wcbH3as0s1hSvyifr5-2SQDYkFDgJs=u8ZCL4Mnhy3FQ@mail.gmail.com>
 <20150527094601949466194@jd.com>
Message-ID: <CANr6G5yVArYUpp6hfrHCwHx3pVYnVZYcRbsswaHzk3kWKpte-Q@mail.gmail.com>

Hmm. I have a few of different paths that might help:

1) Can you get dmesg and/or syslog around the time of the event?

2) Does ovs-vswitchd crash or hang?

A backtrace of the code that ovs-vswitchd is executing would be really
useful. If it crashes, can you get a core dump and use gdb to get a
backtrace? If it hangs, perhaps you could attach gdb and print a
backtrace and post that?

3) If you're already compiling your own OVS-2.3, you could try
downloading the latest branch-2.3 from here:
https://github.com/openvswitch/ovs/tree/branch-2.3

There are a few bugfixes that have not made it into a new release yet.

4) Is OVS running on the bare metal or is it running within a VM?

5) Lastly, it's interesting that there is a delay of around ~2.5 hours
(or 10,000 seconds) between the "unreasonably long poll interval"
messages. Maybe this means something, maybe it's irrelevant.

On 26 May 2015 at 18:46, yangwanli <yangwanli at jd.com> wrote:
> I don't enable STP.
>
> #ovs-vsctl show
> 350424e8-f03c-4f5c-aaa9-fd78ec78f97b
>     Bridge br-int
>         fail_mode: secure
>         Port "int-br-eth1"
>             Interface "int-br-eth1"
>                 type: patch
>                 options: {peer="phy-br-eth1"}
>         Port "tap5c0d4002-26"
>             tag: 1
>             Interface "tap5c0d4002-26"
>         Port "tap4954ce53-06"
>             tag: 3
>             Interface "tap4954ce53-06"
>         Port "tap6631c08d-91"
>             tag: 3
>             Interface "tap6631c08d-91"
>         Port "tapdfd3962f-3a"
>             tag: 2
>             Interface "tapdfd3962f-3a"
>         Port br-int
>             Interface br-int
>                 type: internal
>         Port "tapb2cd1333-03"
>             tag: 1
>             Interface "tapb2cd1333-03"
>         Port "tap0c1153d7-bb"
>             tag: 1
>             Interface "tap0c1153d7-bb"
>     Bridge "br-eth1"
>         Port "br-eth1"
>             Interface "br-eth1"
>                 type: internal
>         Port "eth3"
>             Interface "eth3"
>         Port "phy-br-eth1"
>             Interface "phy-br-eth1"
>                 type: patch
>                 options: {peer="int-br-eth1"}
>     ovs_version: "2.3.1"
>
>
> eth3 is physical NIC.
> The bidge of OVS is created by:
> ovs-vsctl add-br br-int
> ovs-vsctl add-br br-eth1
> ovs-vsctl --timeout=10 -- set-fail-mode br-int secure
>
> ________________________________
>
> WanLi  Yang
>
> JD.COM
>
> *****************************************************************
>
>
> From: Joe Stringer
> Date: 2015-05-27 05:05
> To: yangwanli
> CC: bugs
> Subject: Re: Re: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
> interval (365882ms user, 464906ms system)
> Are you using STP?
>
> On 22 May 2015 at 21:54, yangwanli <yangwanli at jd.com> wrote:
>> Thank you for your response!
>>
>> My servers OS are all  CentOS 6.6,  kernel version: 2.6.32-504.el6.x86_64,
>> vCPU:32,  RAM:256G
>> #lscpu
>> Architecture:          x86_64
>> CPU op-mode(s):        32-bit, 64-bit
>> Byte Order:            Little Endian
>> CPU(s):                32
>> On-line CPU(s) list:   0-31
>> Thread(s) per core:    2
>> Core(s) per socket:    8
>> Socket(s):             2
>> NUMA node(s):          2
>> Vendor ID:             GenuineIntel
>> CPU family:            6
>> Model:                 63
>> Stepping:              2
>> CPU MHz:               2599.971
>> BogoMIPS:              5199.24
>> Virtualization:        VT-x
>> L1d cache:             32K
>> L1i cache:             32K
>> L2 cache:              256K
>> L3 cache:              20480K
>> NUMA node0 CPU(s):     0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30
>> NUMA node1 CPU(s):     1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31
>>
>> OpenvSwitch kernel module(openvswitch.ko) and user space utilities are all
>> build  I use OpenvSwitch-2.3.1 source (change nothing )
>> (http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz)
>> #modinfo openvswitch
>> /lib/modules/2.6.32-504.el6.x86_64/kernel/net/openvswitch/openvswitch.ko
>> version:        2.3.1
>> license:        GPL
>> description:    Open vSwitch switching datapath
>> srcversion:     4D7CD38A83A9A4A782F73A1
>> depends:        libcrc32c
>> vermagic:       2.6.32-504.el6.x86_64 SMP mod_unload modversions
>> parm:           vlan_tso:Enable TSO for VLAN packets (int)
>>
>> I have 300 servers are all the same hardware , OS and OpenvSwitch-2.3.1.
>> Since May 15, 2015, There are 6 servers  appear this problem that  when I
>> execute  ovs-ofctl dump-flows br-int , not always reponse,
>> OVS ports not transmit datas, led to the virtual machines cannot be
>> accessed.
>> When appear this problem , server load is not high, and while I excute
>> netstat -anp , find some CONNECTING state of unix socket.
>> I restart ovs-vswitchd and ovdb-server, becames normal.
>> I doubt the thread dealock of ovs-vswitchd.
>>
>> All servers have the following log info:
>> /var/log/openvswitch/ovs-vswitd.log:
>> 2015-05-18T12:13:04.491Z|00138|coverage|INFO|Event coverage, avg rate over
>> last: 5 seconds, last minute, last hour,  hash=9e13ffc8:
>> 2015-05-18T12:13:04.491Z|00139|coverage|INFO|nln_changed
>> 0.0/sec     0.000/sec        0.0000/sec   total: 21
>> 2015-05-18T12:13:04.491Z|00140|coverage|INFO|netlink_received
>> 59.4/sec    53.850/sec       53.6072/sec   total: 1159232
>> 2015-05-18T12:13:04.491Z|00141|coverage|INFO|netlink_recv_jumbo
>> 3.8/sec     2.767/sec        2.6536/sec   total: 53239
>> 2015-05-18T12:13:04.491Z|00142|coverage|INFO|netlink_sent
>> 68.0/sec    62.783/sec       62.9394/sec   total: 1353375
>> 2015-05-18T12:13:04.491Z|00143|coverage|INFO|netdev_set_policing
>> 0.0/sec     0.000/sec        0.0000/sec   total: 12
>> 2015-05-18T12:13:04.491Z|00144|coverage|INFO|netdev_get_ifindex
>> 0.0/sec     0.000/sec        0.0000/sec   total: 6
>> 2015-05-18T12:13:04.491Z|00145|coverage|INFO|netdev_get_hwaddr
>> 0.0/sec     0.000/sec        0.0000/sec   total: 6
>> 2015-05-18T12:13:04.491Z|00146|coverage|INFO|netdev_set_hwaddr
>> 0.0/sec     0.000/sec        0.0000/sec   total: 3
>> 2015-05-18T12:13:04.491Z|00147|coverage|INFO|netdev_get_ethtool
>> 0.0/sec     0.000/sec        0.0000/sec   total: 22
>> 2015-05-18T12:13:04.491Z|00148|coverage|INFO|netdev_set_ethtool
>> 0.0/sec     0.000/sec        0.0000/sec   total: 4
>> 2015-05-18T12:13:04.491Z|00149|coverage|INFO|vconn_received
>> 2.4/sec     2.000/sec        1.9067/sec   total: 41642
>> 2015-05-18T12:13:04.491Z|00150|coverage|INFO|vconn_sent
>> 1.8/sec     1.500/sec        1.4300/sec   total: 31228
>> 2015-05-18T12:13:04.491Z|00151|coverage|INFO|util_xalloc
>> 1987.2/sec  1867.150/sec     1817.8008/sec   total: 37808073
>> 2015-05-18T12:13:04.491Z|00152|coverage|INFO|pstream_open
>> 0.0/sec     0.000/sec        0.0000/sec   total: 5
>> 2015-05-18T12:13:04.491Z|00153|coverage|INFO|stream_open
>> 0.0/sec     0.000/sec        0.0000/sec   total: 1
>> 2015-05-18T12:13:04.491Z|00154|coverage|INFO|rconn_queued
>> 1.2/sec     1.000/sec        0.9533/sec   total: 20815
>> 2015-05-18T12:13:04.491Z|00155|coverage|INFO|rconn_sent
>> 1.2/sec     1.000/sec        0.9533/sec   total: 20815
>> 2015-05-18T12:13:04.491Z|00156|coverage|INFO|poll_fd_wait
>> 537.2/sec   481.217/sec      462.1683/sec   total: 9762985
>> 2015-05-18T12:13:04.491Z|00157|coverage|INFO|poll_zero_timeout
>> 5.2/sec     4.333/sec        3.8581/sec   total: 83823
>> 2015-05-18T12:13:04.491Z|00158|coverage|INFO|txn_unchanged
>> 0.0/sec     0.000/sec        0.0000/sec   total: 11
>> 2015-05-18T12:13:04.491Z|00159|coverage|INFO|txn_incomplete
>> 8.8/sec     8.450/sec        8.3044/sec   total: 170811
>> 2015-05-18T12:13:04.491Z|00160|coverage|INFO|txn_success
>> 0.2/sec     0.200/sec        0.1989/sec   total: 4276
>> 2015-05-18T12:13:04.491Z|00161|coverage|INFO|netdev_get_stats
>> 1.6/sec     1.600/sec        1.5911/sec   total: 32833
>> 2015-05-18T12:13:04.491Z|00162|coverage|INFO|mac_learning_learned
>> 0.2/sec     0.133/sec        0.0686/sec   total: 1595
>> 2015-05-18T12:13:04.491Z|00163|coverage|INFO|mac_learning_expired
>> 0.4/sec     0.150/sec        0.0689/sec   total: 1518
>> 2015-05-18T12:13:04.491Z|00164|coverage|INFO|hmap_pathological
>> 0.0/sec     0.000/sec        0.0000/sec   total: 27
>> 2015-05-18T12:13:04.491Z|00165|coverage|INFO|hmap_expand
>> 102.4/sec    92.300/sec       88.6772/sec   total: 1853939
>> 2015-05-18T12:13:04.491Z|00166|coverage|INFO|flow_extract
>> 23.0/sec    19.883/sec       19.7067/sec   total: 416747
>> 2015-05-18T12:13:04.491Z|00167|coverage|INFO|dpif_port_add
>> 0.0/sec     0.000/sec        0.0000/sec   total: 6
>> 2015-05-18T12:13:04.491Z|00168|coverage|INFO|dpif_flow_flush
>> 0.0/sec     0.000/sec        0.0000/sec   total: 4
>> 2015-05-18T12:13:04.491Z|00169|coverage|INFO|dpif_flow_put
>> 0.0/sec     0.000/sec        0.0000/sec   total: 2
>> 2015-05-18T12:13:04.491Z|00170|coverage|INFO|dpif_flow_del
>> 0.0/sec     0.000/sec        0.0000/sec   total: 1
>> 2015-05-18T12:13:04.491Z|00171|coverage|INFO|dpif_execute
>> 0.0/sec     0.000/sec        0.0000/sec   total: 1
>> 2015-05-18T12:13:04.491Z|00172|coverage|INFO|xlate_actions
>> 38.8/sec    27.317/sec       22.9731/sec   total: 507271
>> 2015-05-18T12:13:04.491Z|00173|coverage|INFO|rev_reconfigure
>> 0.0/sec     0.000/sec        0.0000/sec   total: 20
>> 2015-05-18T12:13:04.491Z|00174|coverage|INFO|rev_port_toggled
>> 0.0/sec     0.000/sec        0.0000/sec   total: 3
>> 2015-05-18T12:13:04.491Z|00175|coverage|INFO|rev_flow_table
>> 0.0/sec     0.000/sec        0.0000/sec   total: 11
>> 2015-05-18T12:13:04.491Z|00176|coverage|INFO|rev_mac_learning
>> 0.6/sec     0.283/sec        0.1286/sec   total: 2813
>> 2015-05-18T12:13:04.491Z|00177|coverage|INFO|ofproto_flush
>> 0.0/sec     0.000/sec        0.0000/sec   total: 3
>> 2015-05-18T12:13:04.491Z|00178|coverage|INFO|ofproto_recv_openflow
>> 1.8/sec     1.500/sec        1.4300/sec   total: 31229
>> 2015-05-18T12:13:04.491Z|00179|coverage|INFO|ofproto_update_port
>> 0.0/sec     0.000/sec        0.0000/sec   total: 34
>> 2015-05-18T12:13:04.491Z|00180|coverage|INFO|bridge_reconfigure
>> 0.0/sec     0.000/sec        0.0000/sec   total: 15
>> 2015-05-18T12:13:04.491Z|00181|coverage|INFO|49 events never hit
>> 2015-05-18T14:59:05.014Z|00182|timeval|WARN|Unreasonably long 2019ms poll
>> interval (43448ms user, 50465ms system)
>> 2015-05-18T14:59:05.014Z|00183|timeval|WARN|faults: 840 minor, 0 major
>> 2015-05-18T14:59:05.014Z|00184|timeval|WARN|disk: 0 reads, 120 writes
>> 2015-05-18T14:59:05.014Z|00185|timeval|WARN|context switches: 2167382
>> voluntary, 529 involuntary
>> 2015-05-18T14:59:05.014Z|00186|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=9e13ffc8
>> 2015-05-18T17:46:50.578Z|00187|timeval|WARN|Unreasonably long 2018ms poll
>> interval (56724ms user, 65745ms system)
>> 2015-05-18T17:46:50.578Z|00188|timeval|WARN|faults: 841 minor, 0 major
>> 2015-05-18T17:46:50.578Z|00189|timeval|WARN|disk: 0 reads, 128 writes
>> 2015-05-18T17:46:50.578Z|00190|timeval|WARN|context switches: 2853218
>> voluntary, 538 involuntary
>> 2015-05-18T17:46:50.578Z|00191|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=9e13ffc8
>> 2015-05-18T20:29:36.092Z|00192|timeval|WARN|Unreasonably long 2018ms poll
>> interval (69561ms user, 80775ms system)
>> 2015-05-18T20:29:36.092Z|00193|timeval|WARN|faults: 841 minor, 0 major
>> 2015-05-18T20:29:36.092Z|00194|timeval|WARN|disk: 0 reads, 136 writes
>> 2015-05-18T20:29:36.092Z|00195|timeval|WARN|context switches: 3519924
>> voluntary, 544 involuntary
>> 2015-05-18T20:29:36.092Z|00196|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=9e13ffc8
>> 2015-05-18T23:21:51.729Z|00197|timeval|WARN|Unreasonably long 2021ms poll
>> interval (83029ms user, 96728ms system)
>> 2015-05-18T23:21:51.729Z|00198|timeval|WARN|faults: 841 minor, 0 major
>> 2015-05-18T23:21:51.729Z|00199|timeval|WARN|disk: 0 reads, 144 writes
>> 2015-05-18T23:21:51.729Z|00200|timeval|WARN|context switches: 4224452
>> voluntary, 553 involuntary
>> 2015-05-18T23:21:51.729Z|00201|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=9e13ffc8
>>
>> ________________________________
>>
>> WanLi Yang
>>
>> JD.COM
>>
>> *****************************************************************
>>
>>
>> From: Joe Stringer
>> Date: 2015-05-23 05:36
>> To: yangwanli
>> CC: bugs
>> Subject: Re: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
>> interval (365882ms user, 464906ms system)
>> On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
>>> Hi,
>>> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all
>>> virtual
>>> machines and containers communicate with OVS.
>>> I use OVS  VLAN.
>>> OpenvSwitch Version 2.3.1  (nothing change)
>>> CentOS 6.6
>>> In the process of I use, encounter the flowing problems.
>>> Need your help!
>>>
>>> 1、ovs-vswitchd.log always report warnings:
>>>
>>> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
>>> interval (365882ms user, 464906ms system)
>>> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
>>> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
>>> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
>>> voluntary, 2080 involuntary
>>> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of
>>> duplicate
>>> event coverage for hash=35d02982
>>> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
>>> interval (380306ms user, 483259ms system)
>>> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
>>> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
>>> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
>>> voluntary, 2174 involuntary
>>> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of
>>> duplicate
>>> event coverage for hash=35d02982
>>
>> The main loop of ovs-vswitchd usually expects to cycle at least once
>> per second. This message appears when this takes longer than usual,
>> which may indicate that ovs-vswitchd is under heavy load, or some sort
>> of bug.
>>
>>>
>>> 2、I also encounter this problem:
>>>     when I execute
>>>     ovs-ofctl dump-flows br-int
>>>    not always reponse,  but ovs-vsctl show is OK!
>>
>> The main thread of ovs-vswitchd assembles responses to OpenFlow
>> requests, and given the above messages it sounds like it's busy doing
>> other things. Ovs-vsctl on the other hand talks to ovsdb-server, which
>> looks like it is OK in this scenario.
>>
>> These both seem like symptoms, but it's not obvious to me what the
>> underlying cause is. Is there anything else in the logs? Is
>> ovs-vswitchd using a lot of CPU?
>>
>> Are you using the OVS kernel module from CentOS or one distributed
>> with the openvswitch package? ('modinfo openvswitch' should give a
>> hint here)
>>
>> On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
>>> Hi,
>>> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all
>>> virtual
>>> machines and containers communicate with OVS.
>>> I use OVS  VLAN.
>>> OpenvSwitch Version 2.3.1  (nothing change)
>>> CentOS 6.6
>>> In the process of I use, encounter the flowing problems.
>>> Need your help!
>>>
>>> 1、ovs-vswitchd.log always report warnings:
>>>
>>> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
>>> interval (365882ms user, 464906ms system)
>>> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
>>> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
>>> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
>>> voluntary, 2080 involuntary
>>> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of
>>> duplicate
>>> event coverage for hash=35d02982
>>> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
>>> interval (380306ms user, 483259ms system)
>>> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
>>> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
>>> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
>>> voluntary, 2174 involuntary
>>> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of
>>> duplicate
>>> event coverage for hash=35d02982
>>>
>>> 2、I also encounter this problem:
>>>     when I execute
>>>     ovs-ofctl dump-flows br-int
>>>    not always reponse,  but ovs-vsctl show is OK!
>>>
>>> Thanks!
>>> WanLi Yang
>>>
>>>
>>> ________________________________
>>>
>>> WanLi Yang
>>>
>>> JD.COM
>>>
>>> *****************************************************************
>>>
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>

From eunho.cha at atto-research.com  Wed May 27 19:21:17 2015
From: eunho.cha at atto-research.com (=?UTF-8?B?7LCo7J2A7Zi4?=)
Date: Thu, 28 May 2015 11:21:17 +0900
Subject: [ovs-discuss] [Dpdk-ovs] How use userspace tunneling?
In-Reply-To: <20150527154604.GE12926@nicira.com>
References: <CAJoD7yRxS6_KOgtzbZfxs0b8HTnhDMkrxRsNUh1U_DMkT8TwJw@mail.gmail.com>
 <20150527154604.GE12926@nicira.com>
Message-ID: <CAJoD7yR=zRN=hUQVajV8nqUtisAqW-Ntg-yGu2yaVEw2HRWrPg@mail.gmail.com>

On Thu, May 28, 2015 at 12:46 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, May 27, 2015 at 10:54:04AM +0900, 차은호 wrote:
> > I want to use dpdk-ovs with vxlan tunneling.
> >
> > I have build OVS(github master branch) with DPDK(2.0.0) as mentioned in
> the
> > INSTALL.DPDK.md <http://install.dpdk.md/>.
> > And I try use userspace tunneling as mentioned in
> > the README-native-tunneling.md.
> >
> > ovs-vsctl add-br br-eth1  -- set bridge br-eth1 datapath_type=netdev
> > ovs-vsctl add-port br-eth1 dpdk0 -- set Interface dpdk0 type=dpdk;
> >
> > However, when I try assign ip address to br-eth1, ovs-vswitchd is killed
> > with segfault.
> > ifconfig br-eth1 172.168.1.1 netmask 255.255.255.0
>
> You must have found a bug.  Can you get us a backtrace?
>

Thanks Ben.

I build openvswitch with -g option (no optimization) and attach gdb.
(ovs revision is 8909c56c467881236b655e5c4f4c5caa63178cd5)

This is the gdb backtrace:


Program received signal SIGSEGV, Segmentation fault.
0x000000000069dd09 in rte_eth_tx_burst (port_id=0 '\000', queue_id=65535,
    tx_pkts=0x7fc8c0995e00, nb_pkts=1)
    at
/home/molla/work/dpdk-2.0.0/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:2561
2561 struct rte_eth_rxtx_callback *cb = dev->pre_tx_burst_cbs[queue_id];
(gdb) bt
#0  0x000000000069dd09 in rte_eth_tx_burst (port_id=0 '\000',
queue_id=65535,
    tx_pkts=0x7fc8c0995e00, nb_pkts=1)
    at
/home/molla/work/dpdk-2.0.0/x86_64-native-linuxapp-gcc/include/rte_ethdev.h:2561
#1  0x00000000006a156f in dpdk_queue_flush__ (dev=0x7fc8c0afbf00, qid=-1)
    at lib/netdev-dpdk.c:808
#2  0x00000000006a3e64 in dpdk_queue_pkts (dev=0x7fc8c0afbf00, qid=-1,
    pkts=0x7fff5c0d3880, cnt=1) at lib/netdev-dpdk.c:1007
#3  0x00000000006a4141 in dpdk_do_tx_copy (netdev=0x7fc8c0afbf00, qid=-1,
    pkts=0x7fff5c0d4780, cnt=1) at lib/netdev-dpdk.c:1073
#4  0x00000000006a42cc in netdev_dpdk_send__ (dev=0x7fc8c0afbf00, qid=-1,
    pkts=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev-dpdk.c:1116
#5  0x00000000006a4522 in netdev_dpdk_eth_send (netdev=0x7fc8c0afbf00,
qid=-1,
    pkts=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev-dpdk.c:1169
#6  0x00000000005dd16f in netdev_send (netdev=0x7fc8c0afbf00, qid=-1,
    buffers=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev.c:739
#7  0x00000000005b6049 in dp_execute_cb (aux_=0x7fff5c0d3da0,
    packets=0x7fff5c0d4780, cnt=1, a=0x7fff5c0d4048, may_steal=true)
    at lib/dpif-netdev.c:3390
#8  0x00000000005e6665 in odp_execute_actions (dp=0x7fff5c0d3da0,
    packets=0x7fff5c0d4780, cnt=1, steal=true, actions=0x7fff5c0d4048,
    actions_len=8, dp_execute_action=0x5b5f56 <dp_execute_cb>)
    at lib/odp-execute.c:492
#9  0x00000000005b65db in dp_netdev_execute_actions (pmd=0x23264b0,
    packets=0x7fff5c0d4780, cnt=1, may_steal=true, actions=0x7fff5c0d4048,
    actions_len=8) at lib/dpif-netdev.c:3530
#10 0x00000000005b5801 in fast_path_processing (pmd=0x23264b0,
    packets=0x7fff5c0d4780, cnt=1, keys=0x7fff5c0d4600,
    batches=0x7fff5c0d44e0, n_batches=0x7fff5c0d46d8) at
lib/dpif-netdev.c:3231
#11 0x00000000005b5d57 in dp_netdev_input (pmd=0x23264b0,
    packets=0x7fff5c0d4780, cnt=1) at lib/dpif-netdev.c:3306
#12 0x00000000005b3d08 in dp_netdev_process_rxq_port (pmd=0x23264b0,
    port=0x22ee810, rxq=0x22911f0) at lib/dpif-netdev.c:2528
#13 0x00000000005b3e3b in dpif_netdev_run (dpif=0x229f090)
    at lib/dpif-netdev.c:2554
#14 0x00000000005b81f8 in dpif_run (dpif=0x229f090) at lib/dpif.c:430
#15 0x00000000005663c7 in type_run (type=0x2325720 "netdev")
    at ofproto/ofproto-dpif.c:533
#16 0x0000000000558aab in ofproto_type_run (datapath_type=0x2325720
"netdev")
    at ofproto/ofproto.c:1594
#17 0x0000000000549220 in bridge_run__ () at vswitchd/bridge.c:2857
#18 0x0000000000549430 in bridge_run () at vswitchd/bridge.c:2916
#19 0x000000000054f0dd in main (argc=4, argv=0x7fff5c0d4c88)
    at vswitchd/ovs-vswitchd.c:116
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150528/76301b65/attachment.html>

From hillad at gmail.com  Thu May 28 04:07:54 2015
From: hillad at gmail.com (Andy Hill)
Date: Thu, 28 May 2015 07:07:54 -0400
Subject: [ovs-discuss] QoS question: ovs- QoS configuration and linux-QoS
In-Reply-To: <20150527004007.GM18978@nicira.com>
References: <49388820.7856013.1432305969395.JavaMail.zimbra@inria.fr>
 <1348571400.7859072.1432306329841.JavaMail.zimbra@inria.fr>
 <CAC=Vi+pKWFBt0cE+TatmqFYvydWyXH2t_G9A2rWBThz0YKcT+w@mail.gmail.com>
 <20150527004007.GM18978@nicira.com>
Message-ID: <CAC=Vi+rEMe4qLttdojMonmkshXx+R8CByuXzQz+cip+Lpf8g8Q@mail.gmail.com>

> For the record, I'm not saying that OVS behavior is ideal here.

I think the OVS approach is fine, our use case is atypical.

This was the first mailing list post I saw highlighting a similar use
case and I felt the need to speak up with some lessons learned.

> Feedback on this issue is very welcome!

What about a simple manage QoS configuration flag? The flag would be
enabled by default, but can be overridden.

From mark.d.gray at intel.com  Thu May 28 05:56:22 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Thu, 28 May 2015 12:56:22 +0000
Subject: [ovs-discuss] [Dpdk-ovs] How use userspace tunneling?
In-Reply-To: <CAJoD7yR=zRN=hUQVajV8nqUtisAqW-Ntg-yGu2yaVEw2HRWrPg@mail.gmail.com>
References: <CAJoD7yRxS6_KOgtzbZfxs0b8HTnhDMkrxRsNUh1U_DMkT8TwJw@mail.gmail.com>
 <20150527154604.GE12926@nicira.com>
 <CAJoD7yR=zRN=hUQVajV8nqUtisAqW-Ntg-yGu2yaVEw2HRWrPg@mail.gmail.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E2693A7@IRSMSX108.ger.corp.intel.com>

> 	>
> 	> I have build OVS(github master branch) with DPDK(2.0.0) as
> mentioned in the
> 	> INSTALL.DPDK.md <http://INSTALL.DPDK.md>
> <http://install.dpdk.md/>.
> 	> And I try use userspace tunneling as mentioned in
> 	> the README-native-tunneling.md.
> 	>
> 	> ovs-vsctl add-br br-eth1  -- set bridge br-eth1
> datapath_type=netdev
> 	> ovs-vsctl add-port br-eth1 dpdk0 -- set Interface dpdk0 type=dpdk;
> 	>
> 	> However, when I try assign ip address to br-eth1, ovs-vswitchd is
> killed
> 	> with segfault.
> 	> ifconfig br-eth1 172.168.1.1 netmask 255.255.255.0
> 
> 	You must have found a bug.  Can you get us a backtrace?
> 
> 
> 
> Thanks Ben.
> 
> I build openvswitch with -g option (no optimization) and attach gdb.
> (ovs revision is 8909c56c467881236b655e5c4f4c5caa63178cd5)
> 
> This is the gdb backtrace:
> 
> 
> Program received signal SIGSEGV, Segmentation fault.
> 0x000000000069dd09 in rte_eth_tx_burst (port_id=0 '\000', queue_id=65535,
>     tx_pkts=0x7fc8c0995e00, nb_pkts=1)
>     at /home/molla/work/dpdk-2.0.0/x86_64-native-linuxapp-
> gcc/include/rte_ethdev.h:2561
> 2561 struct rte_eth_rxtx_callback *cb = dev->pre_tx_burst_cbs[queue_id];
> (gdb) bt
> #0  0x000000000069dd09 in rte_eth_tx_burst (port_id=0 '\000',
> queue_id=65535,
>     tx_pkts=0x7fc8c0995e00, nb_pkts=1)
>     at /home/molla/work/dpdk-2.0.0/x86_64-native-linuxapp-
> gcc/include/rte_ethdev.h:2561
> #1  0x00000000006a156f in dpdk_queue_flush__ (dev=0x7fc8c0afbf00, qid=-
> 1)
>     at lib/netdev-dpdk.c:808
> #2  0x00000000006a3e64 in dpdk_queue_pkts (dev=0x7fc8c0afbf00, qid=-1,
>     pkts=0x7fff5c0d3880, cnt=1) at lib/netdev-dpdk.c:1007
> #3  0x00000000006a4141 in dpdk_do_tx_copy (netdev=0x7fc8c0afbf00, qid=-
> 1,
>     pkts=0x7fff5c0d4780, cnt=1) at lib/netdev-dpdk.c:1073
> #4  0x00000000006a42cc in netdev_dpdk_send__ (dev=0x7fc8c0afbf00, qid=-
> 1,
>     pkts=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev-dpdk.c:1116
> #5  0x00000000006a4522 in netdev_dpdk_eth_send (netdev=0x7fc8c0afbf00,
> qid=-1,
>     pkts=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev-dpdk.c:1169
> #6  0x00000000005dd16f in netdev_send (netdev=0x7fc8c0afbf00, qid=-1,

I guess the queue id shouldn’t be negative. It is defined as an int, should it
be an unsigned int?

>     buffers=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev.c:739
> #7  0x00000000005b6049 in dp_execute_cb (aux_=0x7fff5c0d3da0,
>     packets=0x7fff5c0d4780, cnt=1, a=0x7fff5c0d4048, may_steal=true)
>     at lib/dpif-netdev.c:3390
> #8  0x00000000005e6665 in odp_execute_actions (dp=0x7fff5c0d3da0,
>     packets=0x7fff5c0d4780, cnt=1, steal=true, actions=0x7fff5c0d4048,
>     actions_len=8, dp_execute_action=0x5b5f56 <dp_execute_cb>)
>     at lib/odp-execute.c:492
> #9  0x00000000005b65db in dp_netdev_execute_actions (pmd=0x23264b0,
>     packets=0x7fff5c0d4780, cnt=1, may_steal=true, actions=0x7fff5c0d4048,
>     actions_len=8) at lib/dpif-netdev.c:3530

Can you inspect frame #9 to see what actions are being executed?

> #10 0x00000000005b5801 in fast_path_processing (pmd=0x23264b0,
>     packets=0x7fff5c0d4780, cnt=1, keys=0x7fff5c0d4600,
>     batches=0x7fff5c0d44e0, n_batches=0x7fff5c0d46d8) at lib/dpif-
> netdev.c:3231
> #11 0x00000000005b5d57 in dp_netdev_input (pmd=0x23264b0,
>     packets=0x7fff5c0d4780, cnt=1) at lib/dpif-netdev.c:3306
> #12 0x00000000005b3d08 in dp_netdev_process_rxq_port (pmd=0x23264b0,
>     port=0x22ee810, rxq=0x22911f0) at lib/dpif-netdev.c:2528
> #13 0x00000000005b3e3b in dpif_netdev_run (dpif=0x229f090)
>     at lib/dpif-netdev.c:2554
> #14 0x00000000005b81f8 in dpif_run (dpif=0x229f090) at lib/dpif.c:430
> #15 0x00000000005663c7 in type_run (type=0x2325720 "netdev")
>     at ofproto/ofproto-dpif.c:533
> #16 0x0000000000558aab in ofproto_type_run (datapath_type=0x2325720
> "netdev")
>     at ofproto/ofproto.c:1594
> #17 0x0000000000549220 in bridge_run__ () at vswitchd/bridge.c:2857
> #18 0x0000000000549430 in bridge_run () at vswitchd/bridge.c:2916
> #19 0x000000000054f0dd in main (argc=4, argv=0x7fff5c0d4c88)
>     at vswitchd/ovs-vswitchd.c:116
> 


From diproiettod at vmware.com  Thu May 28 06:24:51 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Thu, 28 May 2015 13:24:51 +0000
Subject: [ovs-discuss] [Dpdk-ovs] How use userspace tunneling?
In-Reply-To: <CAJoD7yR=zRN=hUQVajV8nqUtisAqW-Ntg-yGu2yaVEw2HRWrPg@mail.gmail.com>
References: <CAJoD7yRxS6_KOgtzbZfxs0b8HTnhDMkrxRsNUh1U_DMkT8TwJw@mail.gmail.com>
 <20150527154604.GE12926@nicira.com>
 <CAJoD7yR=zRN=hUQVajV8nqUtisAqW-Ntg-yGu2yaVEw2HRWrPg@mail.gmail.com>
Message-ID: <D18CD4DE.1AF0%diproiettod@vmware.com>

Thanks for the report!

I sent out a fix:

http://openvswitch.org/pipermail/dev/2015-May/055675.html

Would you mind trying again with the above patch?

Thanks!

On 28/05/2015 03:21, "차은호" <eunho.cha at atto-research.com> wrote:

>
>On Thu, May 28, 2015 at 12:46 AM, Ben Pfaff
><blp at nicira.com> wrote:
>
>On Wed, May 27, 2015 at 10:54:04AM +0900, 차은호 wrote:
>> I want to use dpdk-ovs with vxlan tunneling.
>>
>> I have build OVS(github master branch) with DPDK(2.0.0) as mentioned in
>>the
>> 
>INSTALL.DPDK.md 
><https://urldefense.proofpoint.com/v2/url?u=http-3A__INSTALL.DPDK.md&d=BQM
>FaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw
>5yUNjxgD4v5kJqZ2uWLlE&m=jxzas3FFv7ACd22DKbif83gzbaxoubgCzSCXVTnRUf4&s=42ws
>dGSbxSo0_y9fu6dJXQmX61UwnoGlVqVnDEiYdnY&e=> <http://install.dpdk.md/
><https://urldefense.proofpoint.com/v2/url?u=http-3A__install.dpdk.md_&d=BQ
>MFaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_C
>w5yUNjxgD4v5kJqZ2uWLlE&m=jxzas3FFv7ACd22DKbif83gzbaxoubgCzSCXVTnRUf4&s=GFG
>3IR24h6XskJixqZK4LZbogcJULxg71KH2vvTePEg&e=>>.
>> And I try use userspace tunneling as mentioned in
>> the README-native-tunneling.md.
>>
>> ovs-vsctl add-br br-eth1  -- set bridge br-eth1 datapath_type=netdev
>> ovs-vsctl add-port br-eth1 dpdk0 -- set Interface dpdk0 type=dpdk;
>>
>> However, when I try assign ip address to br-eth1, ovs-vswitchd is killed
>> with segfault.
>> ifconfig br-eth1 172.168.1.1 netmask 255.255.255.0
>
>You must have found a bug.  Can you get us a backtrace?
>
>
>
>
>
>Thanks Ben.
>
>
>I build openvswitch with -g option (no optimization) and attach gdb.
>(ovs revision is 8909c56c467881236b655e5c4f4c5caa63178cd5)
>
>
>This is the gdb backtrace:
>
>
>
>
>Program received signal SIGSEGV, Segmentation fault.
>0x000000000069dd09 in rte_eth_tx_burst (port_id=0 '\000', queue_id=65535,
>    tx_pkts=0x7fc8c0995e00, nb_pkts=1)
>    at 
>/home/molla/work/dpdk-2.0.0/x86_64-native-linuxapp-gcc/include/rte_ethdev.
>h:2561
>2561 struct rte_eth_rxtx_callback *cb = dev->pre_tx_burst_cbs[queue_id];
>(gdb) bt
>#0  0x000000000069dd09 in rte_eth_tx_burst (port_id=0 '\000',
>queue_id=65535,
>    tx_pkts=0x7fc8c0995e00, nb_pkts=1)
>    at 
>/home/molla/work/dpdk-2.0.0/x86_64-native-linuxapp-gcc/include/rte_ethdev.
>h:2561
>#1  0x00000000006a156f in dpdk_queue_flush__ (dev=0x7fc8c0afbf00, qid=-1)
>    at lib/netdev-dpdk.c:808
>#2  0x00000000006a3e64 in dpdk_queue_pkts (dev=0x7fc8c0afbf00, qid=-1,
>    pkts=0x7fff5c0d3880, cnt=1) at lib/netdev-dpdk.c:1007
>#3  0x00000000006a4141 in dpdk_do_tx_copy (netdev=0x7fc8c0afbf00, qid=-1,
>    pkts=0x7fff5c0d4780, cnt=1) at lib/netdev-dpdk.c:1073
>#4  0x00000000006a42cc in netdev_dpdk_send__ (dev=0x7fc8c0afbf00, qid=-1,
>    pkts=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev-dpdk.c:1116
>#5  0x00000000006a4522 in netdev_dpdk_eth_send (netdev=0x7fc8c0afbf00,
>qid=-1,
>    pkts=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev-dpdk.c:1169
>#6  0x00000000005dd16f in netdev_send (netdev=0x7fc8c0afbf00, qid=-1,
>    buffers=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev.c:739
>#7  0x00000000005b6049 in dp_execute_cb (aux_=0x7fff5c0d3da0,
>    packets=0x7fff5c0d4780, cnt=1, a=0x7fff5c0d4048, may_steal=true)
>    at lib/dpif-netdev.c:3390
>#8  0x00000000005e6665 in odp_execute_actions (dp=0x7fff5c0d3da0,
>    packets=0x7fff5c0d4780, cnt=1, steal=true, actions=0x7fff5c0d4048,
>    actions_len=8, dp_execute_action=0x5b5f56 <dp_execute_cb>)
>    at lib/odp-execute.c:492
>#9  0x00000000005b65db in dp_netdev_execute_actions (pmd=0x23264b0,
>    packets=0x7fff5c0d4780, cnt=1, may_steal=true, actions=0x7fff5c0d4048,
>    actions_len=8) at lib/dpif-netdev.c:3530
>#10 0x00000000005b5801 in fast_path_processing (pmd=0x23264b0,
>    packets=0x7fff5c0d4780, cnt=1, keys=0x7fff5c0d4600,
>    batches=0x7fff5c0d44e0, n_batches=0x7fff5c0d46d8) at
>lib/dpif-netdev.c:3231
>#11 0x00000000005b5d57 in dp_netdev_input (pmd=0x23264b0,
>    packets=0x7fff5c0d4780, cnt=1) at lib/dpif-netdev.c:3306
>#12 0x00000000005b3d08 in dp_netdev_process_rxq_port (pmd=0x23264b0,
>    port=0x22ee810, rxq=0x22911f0) at lib/dpif-netdev.c:2528
>#13 0x00000000005b3e3b in dpif_netdev_run (dpif=0x229f090)
>    at lib/dpif-netdev.c:2554
>#14 0x00000000005b81f8 in dpif_run (dpif=0x229f090) at lib/dpif.c:430
>#15 0x00000000005663c7 in type_run (type=0x2325720 "netdev")
>    at ofproto/ofproto-dpif.c:533
>#16 0x0000000000558aab in ofproto_type_run (datapath_type=0x2325720
>"netdev")
>    at ofproto/ofproto.c:1594
>#17 0x0000000000549220 in bridge_run__ () at vswitchd/bridge.c:2857
>#18 0x0000000000549430 in bridge_run () at vswitchd/bridge.c:2916
>#19 0x000000000054f0dd in main (argc=4, argv=0x7fff5c0d4c88)
>    at vswitchd/ovs-vswitchd.c:116
>
>
>
>
>
>


From blp at nicira.com  Thu May 28 08:05:50 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 28 May 2015 08:05:50 -0700
Subject: [ovs-discuss] ovscon 2015 scheduling proposal: Nov. 16-17
Message-ID: <20150528150550.GF8426@nicira.com>

I'm thinking about scheduling this year's OVS conference for Nov. 16 and
17.  Any comments?  I haven't verified that the space is available on
those days yet, so this is a very tentative idea.

From blp at nicira.com  Thu May 28 08:17:05 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 28 May 2015 08:17:05 -0700
Subject: [ovs-discuss] Maximum Number of Queues per Port
In-Reply-To: <CAP_KJebrz=ka8p=MoCvOgpEsUfD+BzdJd3rNPe1Ny618c5Xb0g@mail.gmail.com>
References: <CAP_KJebrz=ka8p=MoCvOgpEsUfD+BzdJd3rNPe1Ny618c5Xb0g@mail.gmail.com>
Message-ID: <20150528151705.GG8426@nicira.com>

On Wed, May 27, 2015 at 04:10:45PM +0100, Daniel Caixinha wrote:
> I am using OVS in my research work and I plan to run a simulation where I
> create a high number of queues in each port (to support BW slicing) of each
> OVS instance. Can somebody please tell me what is the maximum number of
> queues per port in OVS? And what is the reason for that maximum?

OVS uses Linux's QoS, so the main limitation is Linux.  I think that the
way that OVS configures Linux QoS limits it to about 65000 queues.

OpenFlow is limited to about 4 billion queues.  That's mainly Justin
Pettit's fault, as the guy who said, "Four billion queues ought to be
enough for anyone":
        https://mailman.stanford.edu/pipermail/openflow-spec/2009-August/000394.html

From eunho.cha at atto-research.com  Thu May 28 10:43:33 2015
From: eunho.cha at atto-research.com (=?UTF-8?B?7LCo7J2A7Zi4?=)
Date: Fri, 29 May 2015 02:43:33 +0900
Subject: [ovs-discuss] [Dpdk-ovs] How use userspace tunneling?
In-Reply-To: <D18CD4DE.1AF0%diproiettod@vmware.com>
References: <CAJoD7yRxS6_KOgtzbZfxs0b8HTnhDMkrxRsNUh1U_DMkT8TwJw@mail.gmail.com>
 <20150527154604.GE12926@nicira.com>
 <CAJoD7yR=zRN=hUQVajV8nqUtisAqW-Ntg-yGu2yaVEw2HRWrPg@mail.gmail.com>
 <D18CD4DE.1AF0%diproiettod@vmware.com>
Message-ID: <CAJoD7ySoSRgVd8XE1K4xN93vqfOR=YvdpEA5NwY5F7Lt0AJnqg@mail.gmail.com>

Thank you.

This patch fixes this issue.

Thanks for the patch.


On Thu, May 28, 2015 at 10:24 PM, Daniele Di Proietto <
diproiettod at vmware.com> wrote:

> Thanks for the report!
>
> I sent out a fix:
>
> http://openvswitch.org/pipermail/dev/2015-May/055675.html
>
> Would you mind trying again with the above patch?
>
> Thanks!
>
> On 28/05/2015 03:21, "차은호" <eunho.cha at atto-research.com> wrote:
>
> >
> >On Thu, May 28, 2015 at 12:46 AM, Ben Pfaff
> ><blp at nicira.com> wrote:
> >
> >On Wed, May 27, 2015 at 10:54:04AM +0900, 차은호 wrote:
> >> I want to use dpdk-ovs with vxlan tunneling.
> >>
> >> I have build OVS(github master branch) with DPDK(2.0.0) as mentioned in
> >>the
> >>
> >INSTALL.DPDK.md
> ><
> https://urldefense.proofpoint.com/v2/url?u=http-3A__INSTALL.DPDK.md&d=BQM
> >FaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw
> >5yUNjxgD4v5kJqZ2uWLlE&m=jxzas3FFv7ACd22DKbif83gzbaxoubgCzSCXVTnRUf4&s=42ws
> >dGSbxSo0_y9fu6dJXQmX61UwnoGlVqVnDEiYdnY&e=> <http://install.dpdk.md/
> ><
> https://urldefense.proofpoint.com/v2/url?u=http-3A__install.dpdk.md_&d=BQ
> >MFaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_C
> >w5yUNjxgD4v5kJqZ2uWLlE&m=jxzas3FFv7ACd22DKbif83gzbaxoubgCzSCXVTnRUf4&s=GFG
> >3IR24h6XskJixqZK4LZbogcJULxg71KH2vvTePEg&e=>>.
> >> And I try use userspace tunneling as mentioned in
> >> the README-native-tunneling.md.
> >>
> >> ovs-vsctl add-br br-eth1  -- set bridge br-eth1 datapath_type=netdev
> >> ovs-vsctl add-port br-eth1 dpdk0 -- set Interface dpdk0 type=dpdk;
> >>
> >> However, when I try assign ip address to br-eth1, ovs-vswitchd is killed
> >> with segfault.
> >> ifconfig br-eth1 172.168.1.1 netmask 255.255.255.0
> >
> >You must have found a bug.  Can you get us a backtrace?
> >
> >
> >
> >
> >
> >Thanks Ben.
> >
> >
> >I build openvswitch with -g option (no optimization) and attach gdb.
> >(ovs revision is 8909c56c467881236b655e5c4f4c5caa63178cd5)
> >
> >
> >This is the gdb backtrace:
> >
> >
> >
> >
> >Program received signal SIGSEGV, Segmentation fault.
> >0x000000000069dd09 in rte_eth_tx_burst (port_id=0 '\000', queue_id=65535,
> >    tx_pkts=0x7fc8c0995e00, nb_pkts=1)
> >    at
> >/home/molla/work/dpdk-2.0.0/x86_64-native-linuxapp-gcc/include/rte_ethdev.
> >h:2561
> >2561 struct rte_eth_rxtx_callback *cb = dev->pre_tx_burst_cbs[queue_id];
> >(gdb) bt
> >#0  0x000000000069dd09 in rte_eth_tx_burst (port_id=0 '\000',
> >queue_id=65535,
> >    tx_pkts=0x7fc8c0995e00, nb_pkts=1)
> >    at
> >/home/molla/work/dpdk-2.0.0/x86_64-native-linuxapp-gcc/include/rte_ethdev.
> >h:2561
> >#1  0x00000000006a156f in dpdk_queue_flush__ (dev=0x7fc8c0afbf00, qid=-1)
> >    at lib/netdev-dpdk.c:808
> >#2  0x00000000006a3e64 in dpdk_queue_pkts (dev=0x7fc8c0afbf00, qid=-1,
> >    pkts=0x7fff5c0d3880, cnt=1) at lib/netdev-dpdk.c:1007
> >#3  0x00000000006a4141 in dpdk_do_tx_copy (netdev=0x7fc8c0afbf00, qid=-1,
> >    pkts=0x7fff5c0d4780, cnt=1) at lib/netdev-dpdk.c:1073
> >#4  0x00000000006a42cc in netdev_dpdk_send__ (dev=0x7fc8c0afbf00, qid=-1,
> >    pkts=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev-dpdk.c:1116
> >#5  0x00000000006a4522 in netdev_dpdk_eth_send (netdev=0x7fc8c0afbf00,
> >qid=-1,
> >    pkts=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev-dpdk.c:1169
> >#6  0x00000000005dd16f in netdev_send (netdev=0x7fc8c0afbf00, qid=-1,
> >    buffers=0x7fff5c0d4780, cnt=1, may_steal=true) at lib/netdev.c:739
> >#7  0x00000000005b6049 in dp_execute_cb (aux_=0x7fff5c0d3da0,
> >    packets=0x7fff5c0d4780, cnt=1, a=0x7fff5c0d4048, may_steal=true)
> >    at lib/dpif-netdev.c:3390
> >#8  0x00000000005e6665 in odp_execute_actions (dp=0x7fff5c0d3da0,
> >    packets=0x7fff5c0d4780, cnt=1, steal=true, actions=0x7fff5c0d4048,
> >    actions_len=8, dp_execute_action=0x5b5f56 <dp_execute_cb>)
> >    at lib/odp-execute.c:492
> >#9  0x00000000005b65db in dp_netdev_execute_actions (pmd=0x23264b0,
> >    packets=0x7fff5c0d4780, cnt=1, may_steal=true, actions=0x7fff5c0d4048,
> >    actions_len=8) at lib/dpif-netdev.c:3530
> >#10 0x00000000005b5801 in fast_path_processing (pmd=0x23264b0,
> >    packets=0x7fff5c0d4780, cnt=1, keys=0x7fff5c0d4600,
> >    batches=0x7fff5c0d44e0, n_batches=0x7fff5c0d46d8) at
> >lib/dpif-netdev.c:3231
> >#11 0x00000000005b5d57 in dp_netdev_input (pmd=0x23264b0,
> >    packets=0x7fff5c0d4780, cnt=1) at lib/dpif-netdev.c:3306
> >#12 0x00000000005b3d08 in dp_netdev_process_rxq_port (pmd=0x23264b0,
> >    port=0x22ee810, rxq=0x22911f0) at lib/dpif-netdev.c:2528
> >#13 0x00000000005b3e3b in dpif_netdev_run (dpif=0x229f090)
> >    at lib/dpif-netdev.c:2554
> >#14 0x00000000005b81f8 in dpif_run (dpif=0x229f090) at lib/dpif.c:430
> >#15 0x00000000005663c7 in type_run (type=0x2325720 "netdev")
> >    at ofproto/ofproto-dpif.c:533
> >#16 0x0000000000558aab in ofproto_type_run (datapath_type=0x2325720
> >"netdev")
> >    at ofproto/ofproto.c:1594
> >#17 0x0000000000549220 in bridge_run__ () at vswitchd/bridge.c:2857
> >#18 0x0000000000549430 in bridge_run () at vswitchd/bridge.c:2916
> >#19 0x000000000054f0dd in main (argc=4, argv=0x7fff5c0d4c88)
> >    at vswitchd/ovs-vswitchd.c:116
> >
> >
> >
> >
> >
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150529/8ec340bf/attachment-0001.html>

From blp at nicira.com  Thu May 28 12:27:01 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 28 May 2015 12:27:01 -0700
Subject: [ovs-discuss] Maximum Number of Queues per Port
In-Reply-To: <CAP_KJebfZsEkA=B98J92uGw-8NFS=zLwur66Xh3fp2_DnufrHA@mail.gmail.com>
References: <CAP_KJebrz=ka8p=MoCvOgpEsUfD+BzdJd3rNPe1Ny618c5Xb0g@mail.gmail.com>
 <20150528151705.GG8426@nicira.com>
 <CAP_KJebfZsEkA=B98J92uGw-8NFS=zLwur66Xh3fp2_DnufrHA@mail.gmail.com>
Message-ID: <20150528192701.GA11294@nicira.com>

Linux queues have 32-bit numbers divided into two 16-bit parts.  For the
qdiscs currently configured by OVS, only one of the parts is really
useful, so that's roughly 65000 queues.

On Thu, May 28, 2015 at 07:50:40PM +0100, Daniel Caixinha wrote:
> Hello Ben. Thank you for your help. Can you tell me what is the bottleneck
> in the Linux QoS configuration made by OVS? It is always about 65000
> queues? Or depends on RAM capacity (or disk)?
> 
> Thank you and my best regards,
> 
> Daniel
> 
> 
> 
> 2015-05-28 16:17 GMT+01:00 Ben Pfaff <blp at nicira.com>:
> 
> > On Wed, May 27, 2015 at 04:10:45PM +0100, Daniel Caixinha wrote:
> > > I am using OVS in my research work and I plan to run a simulation where I
> > > create a high number of queues in each port (to support BW slicing) of
> > each
> > > OVS instance. Can somebody please tell me what is the maximum number of
> > > queues per port in OVS? And what is the reason for that maximum?
> >
> > OVS uses Linux's QoS, so the main limitation is Linux.  I think that the
> > way that OVS configures Linux QoS limits it to about 65000 queues.
> >
> > OpenFlow is limited to about 4 billion queues.  That's mainly Justin
> > Pettit's fault, as the guy who said, "Four billion queues ought to be
> > enough for anyone":
> >
> > https://mailman.stanford.edu/pipermail/openflow-spec/2009-August/000394.html
> >

From cvinllen at gmail.com  Thu May 28 23:41:33 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Fri, 29 May 2015 14:41:33 +0800
Subject: [ovs-discuss] OFPBAC_BAD_SET_ARGUMENT received when set field of
	vlan id
Message-ID: <CAN2QyzYB1j2t8LwAWXgtJ--adPHDseOgpSaxE9eNu_BXOJbCdA@mail.gmail.com>

Hi, Dear all:

    I use the openflow13, ovs2.3 and ryu controller, and i send flow mod
message from controller to ovs:

"match":
            {
            "in_port" : "2",
            "vlan_vid" : "0"
            },
        "instructions":
            [
                {
                "apply":
                    [
                        {
                        "actions":
                            [
                            {
                            "set_field":
                                {
                                "vlan_vid":"11"
                                }
                            }
                            ]
                        }
                    ]
                },
                {
                "goto":
                    {
                    "table":"mac"
                    }
                }
            ]

    It receive OFPBAC_BAD_SET_ARGUMENT through wireshark when i send the
flow_mod message to ovs, but if i cut the apply-action, then i can send the
flow_mod successfully.

    Does anyone kowns the problem, i found the question without solution
posted before at here[1]

[1] http://comments.gmane.org/gmane.linux.network.openvswitch.general/7088

Best regards,
Vinllen
        }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150529/31d7f768/attachment.html>

From liw at dtdream.com  Fri May 29 02:42:56 2015
From: liw at dtdream.com (=?UTF-8?B?6ZKi6ZSBMDMxMA==?=)
Date: Fri, 29 May 2015 17:42:56 +0800
Subject: [ovs-discuss] =?utf-8?q?the_lock_in_dpdk=5Fvhost=5Fsend_is_really?=
	=?utf-8?q?_need=3F?=
Message-ID: <----P3------meVv3$4dca392c-02b0-4df9-bc94-d77a950d7611@dtdream.com>

static void
__netdev_dpdk_vhost_send(struct netdev *netdev, struct dp_packet **pkts,
                         int cnt, bool may_steal)
{
    rte_spinlock_lock(&vhost_dev->vhost_tx_lock);

    do {
        tx_pkts = rte_vhost_enqueue_burst(virtio_dev, VIRTIO_RXQ,
                                          cur_pkts, cnt);
    } while (cnt);
    rte_spinlock_unlock(&vhost_dev->vhost_tx_lock);
}
In 
rte_vhost_enqueue_burst, there is a reserved for vring, Does really need the lock with red color?  
if really need, protect what?
thanks for explaining  
static inline uint32_t __attribute__((always_inline))
virtio_dev_rx(struct virtio_net *dev, uint16_t queue_id,
 struct rte_mbuf **pkts, uint32_t count)
{
 /*
  * As many data cores may want access to available buffers,
  * they need to be reserved.
  */
 do {
  res_end_idx = res_base_idx + count;
  /* vq->last_used_idx_res is atomically updated. */
  /* TODO: Allow to disable cmpset if no concurrency in application. */
  success = rte_atomic16_cmpset(&vq->last_used_idx_res,
    res_base_idx, res_end_idx);
 } while (unlikely(success == 0));
}
*********************RTFSC*********************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150529/83b80a85/attachment.html>

From phoracek at redhat.com  Fri May 29 05:19:08 2015
From: phoracek at redhat.com (Petr Horacek)
Date: Fri, 29 May 2015 08:19:08 -0400 (EDT)
Subject: [ovs-discuss] Adding bond with one nic
In-Reply-To: <78218819.9173372.1432901646802.JavaMail.zimbra@redhat.com>
Message-ID: <481791919.9175943.1432901948005.JavaMail.zimbra@redhat.com>

Hello,

how could I create a bond with just one nic?
It's not possible via `ovs-vsctl add-bond`,
but I guess we can do it with some database
commands (?).

Thanks a lot!
Petr

From yangwanli at jd.com  Wed May 27 19:58:38 2015
From: yangwanli at jd.com (yangwanli)
Date: Thu, 28 May 2015 10:58:38 +0800
Subject: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
	interval (365882ms user, 464906ms system)
References: <2015051918320317100434@jd.com>, 
 <CANr6G5zmkv=cgdbMSCes2k_yYaCKGhuLWxiPgB85eYCanyaFKA@mail.gmail.com>, 
 <20150523125416388568139@jd.com>, 
 <CANr6G5wcbH3as0s1hSvyifr5-2SQDYkFDgJs=u8ZCL4Mnhy3FQ@mail.gmail.com>, 
 <20150527094601949466194@jd.com>, 
 <CANr6G5yVArYUpp6hfrHCwHx3pVYnVZYcRbsswaHzk3kWKpte-Q@mail.gmail.com>
Message-ID: <20150528105838154660248@jd.com>

Thank you very much!
I upgraded to the latest kernel 2.6.32-504.16.2.el6.x86_64 for 200 servers  and so far, this problem(the ovs-vswitchd hang) has not happened.
I seems to be related to this bug(http://bugs.centos.org/view.php?id=8703). But,  I'm not sure!


From: Joe Stringer
Date: 2015-05-28 09:55
To: yangwanli
CC: bugs
Subject: Re: Re: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll interval (365882ms user, 464906ms system)
>Hmm. I have a few of different paths that might help:
 
> 1) Can you get dmesg and/or syslog around the time of the event?
  Not find errors or warning in dmesg and syslog about ovs-vswitchd.
> 2) Does ovs-vswitchd crash or hang?
 Hang, I think so! Because when I excute netstat -anp, I find some unix sockets state is CONNECTING. ovs-ofctl dump-flows br-int, not always reponse.
 Recently, I found  the ovs-vswitchd process of a server later changed to normal, about 20 minutes. I do nothing! ovs-ofctl dump-flows br-int is OK!
> A backtrace of the code that ovs-vswitchd is executing would be really
> useful. If it crashes, can you get a core dump and use gdb to get a
> backtrace? If it hangs, perhaps you could attach gdb and print a
> backtrace and post that?
 
> 3) If you're already compiling your own OVS-2.3, you could try
> downloading the latest branch-2.3 from here:
> https://github.com/openvswitch/ovs/tree/branch-2.3 
> There are a few bugfixes that have not made it into a new release yet.
 OK! I will try it. 
4) Is OVS running on the bare metal or is it running within a VM?
 bare metal 
> 5) Lastly, it's interesting that there is a delay of around ~2.5 hours
> (or 10,000 seconds) between the "unreasonably long poll interval"
> messages. Maybe this means something, maybe it's irrelevant.
 
On 26 May 2015 at 18:46, yangwanli <yangwanli at jd.com> wrote:
> I don't enable STP.
>
> #ovs-vsctl show
> 350424e8-f03c-4f5c-aaa9-fd78ec78f97b
>     Bridge br-int
>         fail_mode: secure
>         Port "int-br-eth1"
>             Interface "int-br-eth1"
>                 type: patch
>                 options: {peer="phy-br-eth1"}
>         Port "tap5c0d4002-26"
>             tag: 1
>             Interface "tap5c0d4002-26"
>         Port "tap4954ce53-06"
>             tag: 3
>             Interface "tap4954ce53-06"
>         Port "tap6631c08d-91"
>             tag: 3
>             Interface "tap6631c08d-91"
>         Port "tapdfd3962f-3a"
>             tag: 2
>             Interface "tapdfd3962f-3a"
>         Port br-int
>             Interface br-int
>                 type: internal
>         Port "tapb2cd1333-03"
>             tag: 1
>             Interface "tapb2cd1333-03"
>         Port "tap0c1153d7-bb"
>             tag: 1
>             Interface "tap0c1153d7-bb"
>     Bridge "br-eth1"
>         Port "br-eth1"
>             Interface "br-eth1"
>                 type: internal
>         Port "eth3"
>             Interface "eth3"
>         Port "phy-br-eth1"
>             Interface "phy-br-eth1"
>                 type: patch
>                 options: {peer="int-br-eth1"}
>     ovs_version: "2.3.1"
>
>
> eth3 is physical NIC.
> The bidge of OVS is created by:
> ovs-vsctl add-br br-int
> ovs-vsctl add-br br-eth1
> ovs-vsctl --timeout=10 -- set-fail-mode br-int secure
>
> ________________________________
>
> WanLi  Yang
>
> JD.COM
>
> *****************************************************************
>
>
> From: Joe Stringer
> Date: 2015-05-27 05:05
> To: yangwanli
> CC: bugs
> Subject: Re: Re: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
> interval (365882ms user, 464906ms system)
> Are you using STP?
>
> On 22 May 2015 at 21:54, yangwanli <yangwanli at jd.com> wrote:
>> Thank you for your response!
>>
>> My servers OS are all  CentOS 6.6,  kernel version: 2.6.32-504.el6.x86_64,
>> vCPU:32,  RAM:256G
>> #lscpu
>> Architecture:          x86_64
>> CPU op-mode(s):        32-bit, 64-bit
>> Byte Order:            Little Endian
>> CPU(s):                32
>> On-line CPU(s) list:   0-31
>> Thread(s) per core:    2
>> Core(s) per socket:    8
>> Socket(s):             2
>> NUMA node(s):          2
>> Vendor ID:             GenuineIntel
>> CPU family:            6
>> Model:                 63
>> Stepping:              2
>> CPU MHz:               2599.971
>> BogoMIPS:              5199.24
>> Virtualization:        VT-x
>> L1d cache:             32K
>> L1i cache:             32K
>> L2 cache:              256K
>> L3 cache:              20480K
>> NUMA node0 CPU(s):     0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30
>> NUMA node1 CPU(s):     1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31
>>
>> OpenvSwitch kernel module(openvswitch.ko) and user space utilities are all
>> build  I use OpenvSwitch-2.3.1 source (change nothing )
>> (http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz)
>> #modinfo openvswitch
>> /lib/modules/2.6.32-504.el6.x86_64/kernel/net/openvswitch/openvswitch.ko
>> version:        2.3.1
>> license:        GPL
>> description:    Open vSwitch switching datapath
>> srcversion:     4D7CD38A83A9A4A782F73A1
>> depends:        libcrc32c
>> vermagic:       2.6.32-504.el6.x86_64 SMP mod_unload modversions
>> parm:           vlan_tso:Enable TSO for VLAN packets (int)
>>
>> I have 300 servers are all the same hardware , OS and OpenvSwitch-2.3.1.
>> Since May 15, 2015, There are 6 servers  appear this problem that  when I
>> execute  ovs-ofctl dump-flows br-int , not always reponse,
>> OVS ports not transmit datas, led to the virtual machines cannot be
>> accessed.
>> When appear this problem , server load is not high, and while I excute
>> netstat -anp , find some CONNECTING state of unix socket.
>> I restart ovs-vswitchd and ovdb-server, becames normal.
>> I doubt the thread dealock of ovs-vswitchd.
>>
>> All servers have the following log info:
>> /var/log/openvswitch/ovs-vswitd.log:
>> 2015-05-18T12:13:04.491Z|00138|coverage|INFO|Event coverage, avg rate over
>> last: 5 seconds, last minute, last hour,  hash=9e13ffc8:
>> 2015-05-18T12:13:04.491Z|00139|coverage|INFO|nln_changed
>> 0.0/sec     0.000/sec        0.0000/sec   total: 21
>> 2015-05-18T12:13:04.491Z|00140|coverage|INFO|netlink_received
>> 59.4/sec    53.850/sec       53.6072/sec   total: 1159232
>> 2015-05-18T12:13:04.491Z|00141|coverage|INFO|netlink_recv_jumbo
>> 3.8/sec     2.767/sec        2.6536/sec   total: 53239
>> 2015-05-18T12:13:04.491Z|00142|coverage|INFO|netlink_sent
>> 68.0/sec    62.783/sec       62.9394/sec   total: 1353375
>> 2015-05-18T12:13:04.491Z|00143|coverage|INFO|netdev_set_policing
>> 0.0/sec     0.000/sec        0.0000/sec   total: 12
>> 2015-05-18T12:13:04.491Z|00144|coverage|INFO|netdev_get_ifindex
>> 0.0/sec     0.000/sec        0.0000/sec   total: 6
>> 2015-05-18T12:13:04.491Z|00145|coverage|INFO|netdev_get_hwaddr
>> 0.0/sec     0.000/sec        0.0000/sec   total: 6
>> 2015-05-18T12:13:04.491Z|00146|coverage|INFO|netdev_set_hwaddr
>> 0.0/sec     0.000/sec        0.0000/sec   total: 3
>> 2015-05-18T12:13:04.491Z|00147|coverage|INFO|netdev_get_ethtool
>> 0.0/sec     0.000/sec        0.0000/sec   total: 22
>> 2015-05-18T12:13:04.491Z|00148|coverage|INFO|netdev_set_ethtool
>> 0.0/sec     0.000/sec        0.0000/sec   total: 4
>> 2015-05-18T12:13:04.491Z|00149|coverage|INFO|vconn_received
>> 2.4/sec     2.000/sec        1.9067/sec   total: 41642
>> 2015-05-18T12:13:04.491Z|00150|coverage|INFO|vconn_sent
>> 1.8/sec     1.500/sec        1.4300/sec   total: 31228
>> 2015-05-18T12:13:04.491Z|00151|coverage|INFO|util_xalloc
>> 1987.2/sec  1867.150/sec     1817.8008/sec   total: 37808073
>> 2015-05-18T12:13:04.491Z|00152|coverage|INFO|pstream_open
>> 0.0/sec     0.000/sec        0.0000/sec   total: 5
>> 2015-05-18T12:13:04.491Z|00153|coverage|INFO|stream_open
>> 0.0/sec     0.000/sec        0.0000/sec   total: 1
>> 2015-05-18T12:13:04.491Z|00154|coverage|INFO|rconn_queued
>> 1.2/sec     1.000/sec        0.9533/sec   total: 20815
>> 2015-05-18T12:13:04.491Z|00155|coverage|INFO|rconn_sent
>> 1.2/sec     1.000/sec        0.9533/sec   total: 20815
>> 2015-05-18T12:13:04.491Z|00156|coverage|INFO|poll_fd_wait
>> 537.2/sec   481.217/sec      462.1683/sec   total: 9762985
>> 2015-05-18T12:13:04.491Z|00157|coverage|INFO|poll_zero_timeout
>> 5.2/sec     4.333/sec        3.8581/sec   total: 83823
>> 2015-05-18T12:13:04.491Z|00158|coverage|INFO|txn_unchanged
>> 0.0/sec     0.000/sec        0.0000/sec   total: 11
>> 2015-05-18T12:13:04.491Z|00159|coverage|INFO|txn_incomplete
>> 8.8/sec     8.450/sec        8.3044/sec   total: 170811
>> 2015-05-18T12:13:04.491Z|00160|coverage|INFO|txn_success
>> 0.2/sec     0.200/sec        0.1989/sec   total: 4276
>> 2015-05-18T12:13:04.491Z|00161|coverage|INFO|netdev_get_stats
>> 1.6/sec     1.600/sec        1.5911/sec   total: 32833
>> 2015-05-18T12:13:04.491Z|00162|coverage|INFO|mac_learning_learned
>> 0.2/sec     0.133/sec        0.0686/sec   total: 1595
>> 2015-05-18T12:13:04.491Z|00163|coverage|INFO|mac_learning_expired
>> 0.4/sec     0.150/sec        0.0689/sec   total: 1518
>> 2015-05-18T12:13:04.491Z|00164|coverage|INFO|hmap_pathological
>> 0.0/sec     0.000/sec        0.0000/sec   total: 27
>> 2015-05-18T12:13:04.491Z|00165|coverage|INFO|hmap_expand
>> 102.4/sec    92.300/sec       88.6772/sec   total: 1853939
>> 2015-05-18T12:13:04.491Z|00166|coverage|INFO|flow_extract
>> 23.0/sec    19.883/sec       19.7067/sec   total: 416747
>> 2015-05-18T12:13:04.491Z|00167|coverage|INFO|dpif_port_add
>> 0.0/sec     0.000/sec        0.0000/sec   total: 6
>> 2015-05-18T12:13:04.491Z|00168|coverage|INFO|dpif_flow_flush
>> 0.0/sec     0.000/sec        0.0000/sec   total: 4
>> 2015-05-18T12:13:04.491Z|00169|coverage|INFO|dpif_flow_put
>> 0.0/sec     0.000/sec        0.0000/sec   total: 2
>> 2015-05-18T12:13:04.491Z|00170|coverage|INFO|dpif_flow_del
>> 0.0/sec     0.000/sec        0.0000/sec   total: 1
>> 2015-05-18T12:13:04.491Z|00171|coverage|INFO|dpif_execute
>> 0.0/sec     0.000/sec        0.0000/sec   total: 1
>> 2015-05-18T12:13:04.491Z|00172|coverage|INFO|xlate_actions
>> 38.8/sec    27.317/sec       22.9731/sec   total: 507271
>> 2015-05-18T12:13:04.491Z|00173|coverage|INFO|rev_reconfigure
>> 0.0/sec     0.000/sec        0.0000/sec   total: 20
>> 2015-05-18T12:13:04.491Z|00174|coverage|INFO|rev_port_toggled
>> 0.0/sec     0.000/sec        0.0000/sec   total: 3
>> 2015-05-18T12:13:04.491Z|00175|coverage|INFO|rev_flow_table
>> 0.0/sec     0.000/sec        0.0000/sec   total: 11
>> 2015-05-18T12:13:04.491Z|00176|coverage|INFO|rev_mac_learning
>> 0.6/sec     0.283/sec        0.1286/sec   total: 2813
>> 2015-05-18T12:13:04.491Z|00177|coverage|INFO|ofproto_flush
>> 0.0/sec     0.000/sec        0.0000/sec   total: 3
>> 2015-05-18T12:13:04.491Z|00178|coverage|INFO|ofproto_recv_openflow
>> 1.8/sec     1.500/sec        1.4300/sec   total: 31229
>> 2015-05-18T12:13:04.491Z|00179|coverage|INFO|ofproto_update_port
>> 0.0/sec     0.000/sec        0.0000/sec   total: 34
>> 2015-05-18T12:13:04.491Z|00180|coverage|INFO|bridge_reconfigure
>> 0.0/sec     0.000/sec        0.0000/sec   total: 15
>> 2015-05-18T12:13:04.491Z|00181|coverage|INFO|49 events never hit
>> 2015-05-18T14:59:05.014Z|00182|timeval|WARN|Unreasonably long 2019ms poll
>> interval (43448ms user, 50465ms system)
>> 2015-05-18T14:59:05.014Z|00183|timeval|WARN|faults: 840 minor, 0 major
>> 2015-05-18T14:59:05.014Z|00184|timeval|WARN|disk: 0 reads, 120 writes
>> 2015-05-18T14:59:05.014Z|00185|timeval|WARN|context switches: 2167382
>> voluntary, 529 involuntary
>> 2015-05-18T14:59:05.014Z|00186|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=9e13ffc8
>> 2015-05-18T17:46:50.578Z|00187|timeval|WARN|Unreasonably long 2018ms poll
>> interval (56724ms user, 65745ms system)
>> 2015-05-18T17:46:50.578Z|00188|timeval|WARN|faults: 841 minor, 0 major
>> 2015-05-18T17:46:50.578Z|00189|timeval|WARN|disk: 0 reads, 128 writes
>> 2015-05-18T17:46:50.578Z|00190|timeval|WARN|context switches: 2853218
>> voluntary, 538 involuntary
>> 2015-05-18T17:46:50.578Z|00191|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=9e13ffc8
>> 2015-05-18T20:29:36.092Z|00192|timeval|WARN|Unreasonably long 2018ms poll
>> interval (69561ms user, 80775ms system)
>> 2015-05-18T20:29:36.092Z|00193|timeval|WARN|faults: 841 minor, 0 major
>> 2015-05-18T20:29:36.092Z|00194|timeval|WARN|disk: 0 reads, 136 writes
>> 2015-05-18T20:29:36.092Z|00195|timeval|WARN|context switches: 3519924
>> voluntary, 544 involuntary
>> 2015-05-18T20:29:36.092Z|00196|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=9e13ffc8
>> 2015-05-18T23:21:51.729Z|00197|timeval|WARN|Unreasonably long 2021ms poll
>> interval (83029ms user, 96728ms system)
>> 2015-05-18T23:21:51.729Z|00198|timeval|WARN|faults: 841 minor, 0 major
>> 2015-05-18T23:21:51.729Z|00199|timeval|WARN|disk: 0 reads, 144 writes
>> 2015-05-18T23:21:51.729Z|00200|timeval|WARN|context switches: 4224452
>> voluntary, 553 involuntary
>> 2015-05-18T23:21:51.729Z|00201|coverage|INFO|Skipping details of duplicate
>> event coverage for hash=9e13ffc8
>>
>> ________________________________
>>
>> WanLi Yang
>>
>> JD.COM
>>
>> *****************************************************************
>>
>>
>> From: Joe Stringer
>> Date: 2015-05-23 05:36
>> To: yangwanli
>> CC: bugs
>> Subject: Re: [ovs-discuss] |timeval|WARN|Unreasonably long 2020ms poll
>> interval (365882ms user, 464906ms system)
>> On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
>>> Hi,
>>> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all
>>> virtual
>>> machines and containers communicate with OVS.
>>> I use OVS  VLAN.
>>> OpenvSwitch Version 2.3.1  (nothing change)
>>> CentOS 6.6
>>> In the process of I use, encounter the flowing problems.
>>> Need your help!
>>>
>>> 1、ovs-vswitchd.log always report warnings:
>>>
>>> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
>>> interval (365882ms user, 464906ms system)
>>> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
>>> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
>>> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
>>> voluntary, 2080 involuntary
>>> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of
>>> duplicate
>>> event coverage for hash=35d02982
>>> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
>>> interval (380306ms user, 483259ms system)
>>> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
>>> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
>>> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
>>> voluntary, 2174 involuntary
>>> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of
>>> duplicate
>>> event coverage for hash=35d02982
>>
>> The main loop of ovs-vswitchd usually expects to cycle at least once
>> per second. This message appears when this takes longer than usual,
>> which may indicate that ovs-vswitchd is under heavy load, or some sort
>> of bug.
>>
>>>
>>> 2、I also encounter this problem:
>>>     when I execute
>>>     ovs-ofctl dump-flows br-int
>>>    not always reponse,  but ovs-vsctl show is OK!
>>
>> The main thread of ovs-vswitchd assembles responses to OpenFlow
>> requests, and given the above messages it sounds like it's busy doing
>> other things. Ovs-vsctl on the other hand talks to ovsdb-server, which
>> looks like it is OK in this scenario.
>>
>> These both seem like symptoms, but it's not obvious to me what the
>> underlying cause is. Is there anything else in the logs? Is
>> ovs-vswitchd using a lot of CPU?
>>
>> Are you using the OVS kernel module from CentOS or one distributed
>> with the openvswitch package? ('modinfo openvswitch' should give a
>> hint here)
>>
>> On 19 May 2015 at 03:32, yangwanli <yangwanli at jd.com> wrote:
>>> Hi,
>>> I'm a cloud computing R&D engineer. Use OVS as virtual switch, all
>>> virtual
>>> machines and containers communicate with OVS.
>>> I use OVS  VLAN.
>>> OpenvSwitch Version 2.3.1  (nothing change)
>>> CentOS 6.6
>>> In the process of I use, encounter the flowing problems.
>>> Need your help!
>>>
>>> 1、ovs-vswitchd.log always report warnings:
>>>
>>> 2015-05-17T00:52:50.463Z|00575|timeval|WARN|Unreasonably long 2020ms poll
>>> interval (365882ms user, 464906ms system)
>>> 2015-05-17T00:52:50.463Z|00576|timeval|WARN|faults: 708 minor, 0 major
>>> 2015-05-17T00:52:50.463Z|00577|timeval|WARN|disk: 0 reads, 392 writes
>>> 2015-05-17T00:52:50.463Z|00578|timeval|WARN|context switches: 19571142
>>> voluntary, 2080 involuntary
>>> 2015-05-17T00:52:50.463Z|00579|coverage|INFO|Skipping details of
>>> duplicate
>>> event coverage for hash=35d02982
>>> 2015-05-17T03:26:36.336Z|00580|timeval|WARN|Unreasonably long 2020ms poll
>>> interval (380306ms user, 483259ms system)
>>> 2015-05-17T03:26:36.336Z|00581|timeval|WARN|faults: 708 minor, 0 major
>>> 2015-05-17T03:26:36.336Z|00582|timeval|WARN|disk: 0 reads, 400 writes
>>> 2015-05-17T03:26:36.336Z|00583|timeval|WARN|context switches: 20299734
>>> voluntary, 2174 involuntary
>>> 2015-05-17T03:26:36.336Z|00584|coverage|INFO|Skipping details of
>>> duplicate
>>> event coverage for hash=35d02982
>>>
>>> 2、I also encounter this problem:
>>>     when I execute
>>>     ovs-ofctl dump-flows br-int
>>>    not always reponse,  but ovs-vsctl show is OK!
>>>
>>> Thanks!
>>> WanLi Yang
>>>
>>>
>>> ________________________________
>>>
>>> WanLi Yang
>>>
>>> JD.COM
>>>
>>> *****************************************************************
>>>
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150528/51feaca5/attachment-0001.html>

From nazhu at cn.ibm.com  Thu May 28 01:48:04 2015
From: nazhu at cn.ibm.com (Na Zhu)
Date: Thu, 28 May 2015 16:48:04 +0800
Subject: [ovs-discuss] qemu failed when configure vm
Message-ID: <OFCA8CA4A6.5A16B72C-ON48257E53.002FA643-48257E53.00305994@cn.ibm.com>



Hi,

I am trying to install an vm and connect the vm to dpdk port. I am using
ovs dpdk version.
I follow the instructions in the link
https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md

I create vm to connect to dpdk0, it failed, anyone knows the reason?

root at juno:~#
root at juno:~# /usr/bin/qemu-system-x86_64 -cpu host -name dpdk
-hda /root/os/ubuntu.qcow2 -object
memory-backend-file,id=mem,size=4096M,mem-path=/mnt/huge, share=on -numa
node,memdev=mem -mem-prealloc -smp 4 --enable-kvm -nographic -vnc :1 -net
none -netdev tap,id=net1,script=no,downscript=no,ifname=dpdk0,vhost=on
-device virtio-net-pci,netdev=net1,mac=00:00:00:00:00:01
**
ERROR:/build/buildd/qemu-2.0.0+dfsg/qom/object.c:437:object_new_with_type:
assertion failed: (type != NULL)
Aborted
root at juno:~#


I have created a br0 and add 3 dpdk ports to br0.
root at juno:~# ovs-vsctl show
948294fb-d455-4bcf-8086-bae49feede58
    Bridge "br0"
        Port "dpdk0"
            Interface "dpdk0"
                type: dpdk
        Port "dpdk1"
            Interface "dpdk1"
                type: dpdk
        Port "br0"
            Interface "br0"
                type: internal
        Port "dpdkvhost0"
            Interface "dpdkvhost0"
                type: dpdkvhost
        Port "dpdk2"
            Interface "dpdk2"
                type: dpdk
root at juno:~#

The dpdk port is VF port.
root at juno:~/dpdk-2.0.0# ./tools/dpdk_nic_bind.py --status

Network devices using DPDK-compatible driver
============================================
0000:07:10.2 'I350 Ethernet Controller Virtual Function' drv=igb_uio
unused=
0000:07:10.6 'I350 Ethernet Controller Virtual Function' drv=igb_uio
unused=
0000:07:11.2 'I350 Ethernet Controller Virtual Function' drv=igb_uio
unused=

Network devices using kernel driver
===================================
0000:06:00.0 'I350 Gigabit Network Connection' if=eth0 drv=igb
unused=igb_uio *Active*
0000:06:00.1 'I350 Gigabit Network Connection' if=eth1 drv=igb
unused=igb_uio
0000:06:00.2 'I350 Gigabit Network Connection' if=eth2 drv=igb
unused=igb_uio
0000:06:00.3 'I350 Gigabit Network Connection' if=eth3 drv=igb
unused=igb_uio

Other network devices
=====================
<none>
root at juno:~/dpdk-2.0.0#





Regards,
Juno Zhu
Staff Software Engineer, System Networking
China Systems and Technology Lab (CSTL), IBM Wuxi
Email: nazhu at cn.ibm.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150528/98ec190b/attachment-0001.html>

From wangan1213 at gmail.com  Thu May 28 07:01:50 2015
From: wangan1213 at gmail.com (an wang)
Date: Thu, 28 May 2015 10:01:50 -0400
Subject: [ovs-discuss] Datapath megaflow issues
In-Reply-To: <20150527212913.GB8927@nicira.com>
References: <CAAcQFL=1ejXw80T+efu8Az-i38B+75nfXGeGchbA79tcgpHmyQ@mail.gmail.com>
 <20150527010944.GS18978@nicira.com>
 <CAAcQFLnT1m7mZB11neumDcLf+LkevA2GPoJ=zY1aTQFw+e6tFQ@mail.gmail.com>
 <20150527212913.GB8927@nicira.com>
Message-ID: <CAAcQFL=k3e+G6q49vBToFeKkmUm8im_VWitRsefunmvWZbj--A@mail.gmail.com>

Thanks again, Ben! I appreciate it.

Best,
An

On Wed, May 27, 2015 at 5:29 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, May 27, 2015 at 05:23:11PM -0400, an wang wrote:
> > Thank you for the clarification. Just one more question, are there any
> > documentations that I could refer to for datapath flow mask generation?
>
> The OVS NSDI paper is a good reference:
>         http://openvswitch.org/support/papers/nsdi2015.pdf
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150528/77d22deb/attachment-0001.html>

From dcaixinha at gmail.com  Thu May 28 11:50:40 2015
From: dcaixinha at gmail.com (Daniel Caixinha)
Date: Thu, 28 May 2015 19:50:40 +0100
Subject: [ovs-discuss] Maximum Number of Queues per Port
In-Reply-To: <20150528151705.GG8426@nicira.com>
References: <CAP_KJebrz=ka8p=MoCvOgpEsUfD+BzdJd3rNPe1Ny618c5Xb0g@mail.gmail.com>
 <20150528151705.GG8426@nicira.com>
Message-ID: <CAP_KJebfZsEkA=B98J92uGw-8NFS=zLwur66Xh3fp2_DnufrHA@mail.gmail.com>

Hello Ben. Thank you for your help. Can you tell me what is the bottleneck
in the Linux QoS configuration made by OVS? It is always about 65000
queues? Or depends on RAM capacity (or disk)?

Thank you and my best regards,

Daniel



2015-05-28 16:17 GMT+01:00 Ben Pfaff <blp at nicira.com>:

> On Wed, May 27, 2015 at 04:10:45PM +0100, Daniel Caixinha wrote:
> > I am using OVS in my research work and I plan to run a simulation where I
> > create a high number of queues in each port (to support BW slicing) of
> each
> > OVS instance. Can somebody please tell me what is the maximum number of
> > queues per port in OVS? And what is the reason for that maximum?
>
> OVS uses Linux's QoS, so the main limitation is Linux.  I think that the
> way that OVS configures Linux QoS limits it to about 65000 queues.
>
> OpenFlow is limited to about 4 billion queues.  That's mainly Justin
> Pettit's fault, as the guy who said, "Four billion queues ought to be
> enough for anyone":
>
> https://mailman.stanford.edu/pipermail/openflow-spec/2009-August/000394.html
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150528/ec4fca7e/attachment-0001.html>

From sandhiya.mani at wipro.com  Fri May 29 01:48:57 2015
From: sandhiya.mani at wipro.com (sandhiya.mani at wipro.com)
Date: Fri, 29 May 2015 08:48:57 +0000
Subject: [ovs-discuss] Regd the bug in open flow v switch
Message-ID: <SG2PR03MB0668A820119ED0BF16CF6684E2C90@SG2PR03MB0668.apcprd03.prod.outlook.com>

Hi

    This is to inform the bug about Destination MAC Address command in open flow v switch. The syntax of the command is
                Ovs-ofctl add-flow s1 dl_dst=00:00:00:00:00:01,actions=normal
Doesnot execute for the first time when the above command is given. The above will work only when a flow is already added and deleted.

Thanks & Regards,
Sandhiya Mani , Dhivya Rekha R

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150529/b9934afb/attachment-0001.html>

From fichera.sil at gmail.com  Fri May 29 04:14:10 2015
From: fichera.sil at gmail.com (Silvia Fichera)
Date: Fri, 29 May 2015 13:14:10 +0200
Subject: [ovs-discuss] Connect OVS to a VM
In-Reply-To: <CE3CFAEB-5CF2-4A6A-AD9A-3489E278DA27@nicira.com>
References: <CAEFdjR092jKVWKqUj8oo18hyWNgmEvWRWH6LgjhSbhW2Wvu1Yw@mail.gmail.com>
 <CE3CFAEB-5CF2-4A6A-AD9A-3489E278DA27@nicira.com>
Message-ID: <CAEFdjR1gApw9cmF5dW0=f2Wx9DGSJ7zBQzAx+owxTfsY8PUy_Q@mail.gmail.com>

Hi Justin,
unfortunately I can't install the switch in the hypervisor, I can just use
the VMs.

I'm starting from scratch before the installation of Openstack. First of
all I want to setup the SDN network.
The connection between the switch and the ODL Controller works, I can see
OF packeIn and packetOut with tcpdump on the controller interface.
Now the problem is to connect the OVS inside vm5 to the other VMs.

In vm3 and vm4 I have assigned an IP address to the interface eth1.
(respectively 10.0.0.3 and 10.0.0.4)
Than I have done:
ovs-vsctl add-br br-eth1
ovs-vsctl add-port br-eth1 eth1

In vm5 , so where I've installed OVS, I've done:
ovs-vsctl add-br br
ovs-vsctl add-port br eth1 -- set interface eth1 type=gre
options:remote_ip=10.0.0.3
ovs-vsctl add-port br eth2 -- set interface eth2 type=gre
options:remote_ip=10.0.0.4

But I think I still missing something because the traffic does not go
through the switch.
Any suggestion to go forward? Ho to create the "physical" link?

Thanks.

Silvia

P.S.
If could be usefull:
I'm considering eth0 as management network.
In vm3 and vm4 there are also eth1 and eth2 for both VMs.
In vm5 there are also eth1 eth2 eth3 and the openflow bridge/interface that
I've created to set the Controller.




2015-05-26 22:17 GMT+02:00 Justin Pettit <jpettit at nicira.com>:

>
> > On May 26, 2015, at 3:11 AM, Silvia Fichera <fichera.sil at gmail.com>
> wrote:
> >
> > Hi all,
> > maybe mine is a silly question but it's getting me crazy!
> > My university gave me five VMs in a server to make some experiments with
> OpenStack+OpendayLight.
> > So I have:
> > vm1 -> ODL Controller
> > vm2 -> OpenStack Controller
> > vm3 / vm4 -> Compute nodes
> > vm5 -> OVS
> >
> > TO configure my environment I've followed the ODL's wiki about VTN, but
> I still do not understand how to attach the VMs that represent the compute
> nodes  to the switch.
> >  I have already set the Controller ODL (in fact with 'sudo ovs-vsctl
> get-controller bridge' I can see the IP address and the port of my
> controller). My problem remains how to connect my hosts  that are VM to the
> OVS.
> >
> > If you need more clarification about the environment, please ask.
>
> You'll need to get interfaces from v3 and v4 into vm5.  Once you have
> that, you just need to use "ovs-vsctl add-port" to make them work with
> OVS.  I don't know enough about your environment to know how you'll plumb
> those compute nodes' interfaces into the VM, since it is going to be
> platform-dependent.  Normally, the OVS would be running in the hypervisor,
> which would then have access to the VMs' VIFs directly.
>
> --Justin
>
>
>


-- 
Silvia Fichera
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150529/6e767614/attachment.html>

From joestringer at nicira.com  Fri May 29 10:04:18 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Fri, 29 May 2015 10:04:18 -0700
Subject: [ovs-discuss] Regd the bug in open flow v switch
In-Reply-To: <SG2PR03MB0668A820119ED0BF16CF6684E2C90@SG2PR03MB0668.apcprd03.prod.outlook.com>
References: <SG2PR03MB0668A820119ED0BF16CF6684E2C90@SG2PR03MB0668.apcprd03.prod.outlook.com>
Message-ID: <CANr6G5yE6+hPOiWzNyPzAqVenokOyRiauF13KCZMXbxj32Zwcg@mail.gmail.com>

This works fine for me. Can you provide more specific reproduction
instructions, including expected result, actual result?

On 29 May 2015 at 01:48,  <sandhiya.mani at wipro.com> wrote:
> Hi
>
>
>
>     This is to inform the bug about Destination MAC Address command in open
> flow v switch. The syntax of the command is
>
>                 Ovs-ofctl add-flow s1
> dl_dst=00:00:00:00:00:01,actions=normal
>
> Doesnot execute for the first time when the above command is given. The
> above will work only when a flow is already added and deleted.
>
>
>
> Thanks & Regards,
>
> Sandhiya Mani , Dhivya Rekha R
>
>
>
> The information contained in this electronic message and any attachments to
> this message are intended for the exclusive use of the addressee(s) and may
> contain proprietary, confidential or privileged information. If you are not
> the intended recipient, you should not disseminate, distribute or copy this
> e-mail. Please notify the sender immediately and destroy all copies of this
> message and any attachments. WARNING: Computer viruses can be transmitted
> via email. The recipient should check this email and any attachments for the
> presence of viruses. The company accepts no liability for any damage caused
> by any virus transmitted by this email. www.wipro.com
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From blp at nicira.com  Fri May 29 10:22:01 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 29 May 2015 10:22:01 -0700
Subject: [ovs-discuss] Adding bond with one nic
In-Reply-To: <481791919.9175943.1432901948005.JavaMail.zimbra@redhat.com>
References: <78218819.9173372.1432901646802.JavaMail.zimbra@redhat.com>
 <481791919.9175943.1432901948005.JavaMail.zimbra@redhat.com>
Message-ID: <20150529172201.GB22762@nicira.com>

On Fri, May 29, 2015 at 08:19:08AM -0400, Petr Horacek wrote:
> how could I create a bond with just one nic?
> It's not possible via `ovs-vsctl add-bond`,
> but I guess we can do it with some database
> commands (?).

It's not possible, because in OVS the definition of a bond is a Port
with more than one Interface.

From hollemanietf at gmail.com  Sat May 30 10:16:50 2015
From: hollemanietf at gmail.com (Keith Holleman)
Date: Sat, 30 May 2015 10:16:50 -0700
Subject: [ovs-discuss] Tunnels with duplicate configuration
In-Reply-To: <20150527014856.GX18978@nicira.com>
References: <CAEpyMTDrTSKwZPEGzBECczDcH7agkS9Tbm82KwsfFs7er6TPbg@mail.gmail.com>
 <20150527014856.GX18978@nicira.com>
Message-ID: <5569F082.5020603@gmail.com>



Ben,

Thanks for the quick feedback and patch.  I was going to be able to test 
it in a few days but I see on the dev alias that Alex has already done 
so and you guys are working through the failed unit-test.

Dang, so I take it from the nature of the patch that what you are doing 
is failing the second add of the duplicate tunnel.  This requires the 
user of OVS to manage any duplicate tunnel usage in some other layer and 
handle tracking the reference/users.   Is that correct?  Perfectly 
reasonable solution but I love when someone else solves my problems :-)

-K

On 5/26/15 6:48 PM, Ben Pfaff wrote:
> On Tue, May 19, 2015 at 01:48:24PM -0700, Keith Holleman wrote:
>> Running OVS 2.3.0 on Ubuntu from a debian package.
>>
>> I am creating two interfaces that are tunnels with duplicate configuration
>> as shown below and noticed that this causes some interesting behavior.
>> Everything appears to work but in reality, only one of the of-ports is able
>> to send traffic.
> I agree that that's surprising and undesirable.
>
> I sent out a patch that I believe should fix the problem, although I
> have not yet fully tested it.  Would you try it?  It is against master,
> though I could backport it to branch-2.3 if necessary.
>
> The patch is at:
>          http://openvswitch.org/pipermail/dev/2015-May/055573.html


From blp at nicira.com  Sat May 30 10:19:18 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 30 May 2015 10:19:18 -0700
Subject: [ovs-discuss] Tunnels with duplicate configuration
In-Reply-To: <5569F082.5020603@gmail.com>
References: <CAEpyMTDrTSKwZPEGzBECczDcH7agkS9Tbm82KwsfFs7er6TPbg@mail.gmail.com>
 <20150527014856.GX18978@nicira.com> <5569F082.5020603@gmail.com>
Message-ID: <20150530171918.GA30418@nicira.com>

On Sat, May 30, 2015 at 10:16:50AM -0700, Keith Holleman wrote:
> Dang, so I take it from the nature of the patch that what you are doing is
> failing the second add of the duplicate tunnel.  This requires the user of
> OVS to manage any duplicate tunnel usage in some other layer and handle
> tracking the reference/users.   Is that correct?  Perfectly reasonable
> solution but I love when someone else solves my problems :-)

Suppose we decided to support duplicate tunnels.  Then, which one of the
set of duplicates is the ingress port for a packet received on the
tunnel?  I don't know a reasonable answer.

From hollemanietf at gmail.com  Sat May 30 10:58:45 2015
From: hollemanietf at gmail.com (Keith Holleman)
Date: Sat, 30 May 2015 10:58:45 -0700
Subject: [ovs-discuss] Tunnels with duplicate configuration
In-Reply-To: <20150530171918.GA30418@nicira.com>
References: <CAEpyMTDrTSKwZPEGzBECczDcH7agkS9Tbm82KwsfFs7er6TPbg@mail.gmail.com>
 <20150527014856.GX18978@nicira.com> <5569F082.5020603@gmail.com>
 <20150530171918.GA30418@nicira.com>
Message-ID: <5569FA55.9020505@gmail.com>



On 5/30/15 10:19 AM, Ben Pfaff wrote:
> Suppose we decided to support duplicate tunnels.  Then, which one of the
> set of duplicates is the ingress port for a packet received on the
> tunnel?  I don't know a reasonable answer.

I definitely see the potential complexity of that.  I was thinking that 
maybe two vsctl interfaces could share the same ofport.  Those two vsctl 
interfaces are effectively the same port, one is more or less an alias 
for the other.  Eh, it works for some specific use cases but most of the 
generic cases as I think through I realize how messy that gets.  I'm 
convinced.

-K

From schokshi at us.ibm.com  Sat May 30 22:44:46 2015
From: schokshi at us.ibm.com (Shaival J Chokshi)
Date: Sun, 31 May 2015 00:44:46 -0500
Subject: [ovs-discuss] ovs-vsctl output question
Message-ID: <OF3BC8B953.E2735002-ON86257E56.001EBF27-86257E56.001F905E@us.ibm.com>

Hi All,

I have a question about ovs-vsctl output on br-int bridge. We are using 
OVS-vxlan in open stack. My question is why do I see tag (VLAN tag?) in 
ovs-vsctl output when I am using vxlan for my overlay networks.
Also, what concerns me is the tag 4095? This tag shouldn't be used unless 
it is used for some local / management traffic.

We are experiencing periodical packet loss for significant time so trying 
to identify root cause.

Any help is greatly appreciated.

Thanks,
Shaival
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150531/f815e802/attachment.html>

From blp at nicira.com  Sat May 30 23:11:09 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 30 May 2015 23:11:09 -0700
Subject: [ovs-discuss] ovs-vsctl output question
In-Reply-To: <OF3BC8B953.E2735002-ON86257E56.001EBF27-86257E56.001F905E@us.ibm.com>
References: <OF3BC8B953.E2735002-ON86257E56.001EBF27-86257E56.001F905E@us.ibm.com>
Message-ID: <20150531061109.GD30418@nicira.com>

On Sun, May 31, 2015 at 12:44:46AM -0500, Shaival J Chokshi wrote:
> I have a question about ovs-vsctl output on br-int bridge. We are using 
> OVS-vxlan in open stack. My question is why do I see tag (VLAN tag?) in 
> ovs-vsctl output when I am using vxlan for my overlay networks.
> Also, what concerns me is the tag 4095? This tag shouldn't be used unless 
> it is used for some local / management traffic.

Because this has more to do with how OpenStack configures OVS than it
does with OVS itself, you may have better luck asking about this on an
OpenStack mailing list.

From harshjain32 at gmail.com  Sun May 31 19:55:34 2015
From: harshjain32 at gmail.com (harshjain32 at gmail.com)
Date: Mon, 01 Jun 2015 08:25:34 +0530
Subject: [ovs-discuss] ovs-vsctl output question
In-Reply-To: <20150531061109.GD30418@nicira.com>
References: <OF3BC8B953.E2735002-ON86257E56.001EBF27-86257E56.001F905E@us.ibm.com>
 <20150531061109.GD30418@nicira.com>
Message-ID: <19061423-B5EF-481F-8C27-B7312721E33D@gmail.com>

Hi,

Br-int is used for separate flows between VM running on same compute node.Gre,vxlan comes into picture ehen we needs to forward the packet to VM running on onother machine.. There is 1 more bridge br-tun who should have vxlan flows. For more info. Check below link.

https://ask.openstack.org/en/question/58638/does-neutron-br-int-accepts-nova-instances-sending-vlan-tagged-traffic/


Regards
Harsh Jain

On 31 May 2015 11:41:09 GMT+05:30, Ben Pfaff <blp at nicira.com> wrote:
>On Sun, May 31, 2015 at 12:44:46AM -0500, Shaival J Chokshi wrote:
>> I have a question about ovs-vsctl output on br-int bridge. We are
>using 
>> OVS-vxlan in open stack. My question is why do I see tag (VLAN tag?)
>in 
>> ovs-vsctl output when I am using vxlan for my overlay networks.
>> Also, what concerns me is the tag 4095? This tag shouldn't be used
>unless 
>> it is used for some local / management traffic.
>
>Because this has more to do with how OpenStack configures OVS than it
>does with OVS itself, you may have better luck asking about this on an
>OpenStack mailing list.
>_______________________________________________
>discuss mailing list
>discuss at openvswitch.org
>http://openvswitch.org/mailman/listinfo/discuss

-- 
Sent from my Android device with K-9 Mail. Please excuse my brevity.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150601/7f5ba1d0/attachment.html>

From schokshi at us.ibm.com  Sun May 31 20:08:47 2015
From: schokshi at us.ibm.com (Shaival J Chokshi)
Date: Sun, 31 May 2015 22:08:47 -0500
Subject: [ovs-discuss] ovs-vsctl output question
In-Reply-To: <19061423-B5EF-481F-8C27-B7312721E33D@gmail.com>
References: <OF3BC8B953.E2735002-ON86257E56.001EBF27-86257E56.001F905E@us.ibm.com>
 <20150531061109.GD30418@nicira.com>
 <19061423-B5EF-481F-8C27-B7312721E33D@gmail.com>
Message-ID: <OF8CC9DD7D.1C33CDC7-ON86257E57.0010A49A-86257E57.001148A0@us.ibm.com>

Thanks Harsh!

This solves the mystery for me. I am now also less concerned about VLAN 
tag 4095 as it is used for internal communication only.

Now to my real problem. we are experiencing periodical packet drops for 
signification time. Nothing stand out in ovsdb-server.log or ovs-agent.log 
or neutron l3-agent.log
ovs-vswitchd.log shows lots of warning with system at ovs-system: lost packet 
on channel xxx messages.

This condition is causing loss of connectivity. So any help or insight in 
to this problem is greatly appreciated.

Thanks,
Shaival Chokshi



From:   harshjain32 at gmail.com
To:     Ben Pfaff <blp at nicira.com>, Shaival J Chokshi/Austin/IBM at IBMUS
Cc:     discuss at openvswitch.org
Date:   05/31/2015 09:55 PM
Subject:        Re: [ovs-discuss] ovs-vsctl output question



Hi,

Br-int is used for separate flows between VM running on same compute 
node.Gre,vxlan comes into picture ehen we needs to forward the packet to 
VM running on onother machine.. There is 1 more bridge br-tun who should 
have vxlan flows. For more info. Check below link.

https://ask.openstack.org/en/question/58638/does-neutron-br-int-accepts-nova-instances-sending-vlan-tagged-traffic
/


Regards
Harsh Jain

On 31 May 2015 11:41:09 GMT+05:30, Ben Pfaff <blp at nicira.com> wrote:
On Sun, May 31, 2015 at 12:44:46AM -0500, Shaival J Chokshi wrote:
 I have a question about ovs-vsctl output on br-int bridge. We are using 
 OVS-vxlan in open stack. My question is why do I see tag (VLAN tag?) in 
 ovs-vsctl output when I am using vxlan for my overlay networks.
 Also, what concerns me is the tag 4095? This tag shouldn't be used unless 

 it is used for some local / management traffic.

Because this has more to do with how OpenStack configures OVS than it
does with OVS itself, you may have better luck asking about this on an
OpenStack mailing list.

discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

-- 
Sent from my Android device with K-9 Mail. Please excuse my brevity.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150531/56e02c86/attachment.html>

From ovs_na at yahoo.com  Sun May 31 21:24:55 2015
From: ovs_na at yahoo.com (OVS)
Date: Mon, 1 Jun 2015 09:54:55 +0530
Subject: [ovs-discuss] Question on userspace ovs
Message-ID: <2C4BE3F8-36F8-4E33-BABA-7141777ADAF3@yahoo.com>

Hi,

I am new to OVS and was going through code to understand the flow.
I was looking at userspace ovs handling where no kernel module specific to OVS is needed.
I understand that Bridge functionality is handled using TAP interface in this scenario.
1. First question, will other interfaces like eth0, eth1 etc will have corresponding link through TAP devices? Ideally i think it should be TAP as we want to process the packet in userspace.
2. Second question, if everything is handled in user space, what would netlink used for?

Thanks…



From harshjain32 at gmail.com  Sun May 31 22:04:48 2015
From: harshjain32 at gmail.com (harsh jain)
Date: Mon, 1 Jun 2015 10:34:48 +0530
Subject: [ovs-discuss] ovs-vsctl output question
In-Reply-To: <OF8CC9DD7D.1C33CDC7-ON86257E57.0010A49A-86257E57.001148A0@us.ibm.com>
References: <OF3BC8B953.E2735002-ON86257E56.001EBF27-86257E56.001F905E@us.ibm.com>
 <20150531061109.GD30418@nicira.com>
 <19061423-B5EF-481F-8C27-B7312721E33D@gmail.com>
 <OF8CC9DD7D.1C33CDC7-ON86257E57.0010A49A-86257E57.001148A0@us.ibm.com>
Message-ID: <CAKuL1XTEoJZBt7ePc-JPQrzAyVfm83ELZtHXBE2gDtxZ8X-q9w@mail.gmail.com>

Hi,

I have not tried Vxlan option. :(. Anyhow what is the use case. How you
identified packets are getting lost.
As suggested by Ben. better to post your question to ask.openstack.org for
suggestion.

Regards
Harsh Jain

On Mon, Jun 1, 2015 at 8:38 AM, Shaival J Chokshi <schokshi at us.ibm.com>
wrote:

> Thanks Harsh!
>
> This solves the mystery for me. I am now also less concerned about VLAN
> tag 4095 as it is used for internal communication only.
>
> Now to my real problem. we are experiencing periodical packet drops for
> signification time. Nothing stand out in ovsdb-server.log or ovs-agent.log
> or neutron l3-agent.log
> ovs-vswitchd.log shows lots of warning with system at ovs-system: lost
> packet on channel xxx messages.
>
> This condition is causing loss of connectivity. So any help or insight in
> to this problem is greatly appreciated.
>
> Thanks,
> Shaival Chokshi
>
>
>
> From:        harshjain32 at gmail.com
> To:        Ben Pfaff <blp at nicira.com>, Shaival J Chokshi/Austin/IBM at IBMUS
> Cc:        discuss at openvswitch.org
> Date:        05/31/2015 09:55 PM
> Subject:        Re: [ovs-discuss] ovs-vsctl output question
> ------------------------------
>
>
>
> Hi,
>
> Br-int is used for separate flows between VM running on same compute
> node.Gre,vxlan comes into picture ehen we needs to forward the packet to VM
> running on onother machine.. There is 1 more bridge br-tun who should have
> vxlan flows. For more info. Check below link.
>
>
> *https://ask.openstack.org/en/question/58638/does-neutron-br-int-accepts-nova-instances-sending-vlan-tagged-traffic*
> <https://ask.openstack.org/en/question/58638/does-neutron-br-int-accepts-nova-instances-sending-vlan-tagged-traffic>
> /
>
>
> Regards
> Harsh Jain
>
> On 31 May 2015 11:41:09 GMT+05:30, Ben Pfaff <blp at nicira.com> wrote:
> On Sun, May 31, 2015 at 12:44:46AM -0500, Shaival J Chokshi wrote:
>  I have a question about ovs-vsctl output on br-int bridge. We are using
> OVS-vxlan in open stack. My question is why do I see tag (VLAN tag?) in
> ovs-vsctl output when I am using vxlan for my overlay networks.
> Also, what concerns me is the tag 4095? This tag shouldn't be used unless
> it is used for some local / management traffic.
>
> Because this has more to do with how OpenStack configures OVS than it
> does with OVS itself, you may have better luck asking about this on an
> OpenStack mailing list.
>  ------------------------------
>
> discuss mailing list
> discuss at openvswitch.org
> *http://openvswitch.org/mailman/listinfo/discuss*
> <http://openvswitch.org/mailman/listinfo/discuss>
>
> --
> Sent from my Android device with K-9 Mail. Please excuse my brevity.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150601/1b9569e9/attachment-0001.html>

From blp at nicira.com  Sun May 31 22:33:01 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 31 May 2015 22:33:01 -0700
Subject: [ovs-discuss] Question on userspace ovs
In-Reply-To: <2C4BE3F8-36F8-4E33-BABA-7141777ADAF3@yahoo.com>
References: <2C4BE3F8-36F8-4E33-BABA-7141777ADAF3@yahoo.com>
Message-ID: <20150601053301.GB4188@nicira.com>

Wow, what a coincidence, someone named OVS using OVS.  Who would have
thought!!1!

On Mon, Jun 01, 2015 at 09:54:55AM +0530, OVS wrote:
> I am new to OVS and was going through code to understand the flow.  I
> was looking at userspace ovs handling where no kernel module specific
> to OVS is needed.  I understand that Bridge functionality is handled
> using TAP interface in this scenario.

TAP interfaces are used to implement "internal" devices.

> 1. First question, will other interfaces like eth0, eth1 etc will have
> corresponding link through TAP devices?

No.

> Ideally i think it should be TAP as we want to process the packet in
> userspace.

I don't follow.

> 2. Second question, if everything is handled in user space, what would
> netlink used for?

It's only used internally within the OVS process.  Also a lot of Linux
networking (not just OVS) works through Netlink in any case, so Netlink
is used to talk to the network stack in those cases.

You might find some enlightenment in this FAQ entry, especially in the
last few paragraphs.

### Q: I created a tap device tap0, configured an IP address on it, and
    added it to a bridge, like this:

        tunctl -t tap0
	ifconfig tap0 192.168.0.123
	ovs-vsctl add-br br0
	ovs-vsctl add-port br0 tap0

    I expected that I could then use this IP address to contact other
    hosts on the network, but it doesn't work.  Why not?

A: The short answer is that this is a misuse of a "tap" device.  Use
   an "internal" device implemented by Open vSwitch, which works
   differently and is designed for this use.  To solve this problem
   with an internal device, instead run:

       ovs-vsctl add-br br0
       ovs-vsctl add-port br0 int0 -- set Interface int0 type=internal
       ifconfig int0 192.168.0.123

   Even more simply, you can take advantage of the internal port that
   every bridge has under the name of the bridge:

       ovs-vsctl add-br br0
       ifconfig br0 192.168.0.123

   In more detail, a "tap" device is an interface between the Linux
   (or *BSD) network stack and a user program that opens it as a
   socket.  When the "tap" device transmits a packet, it appears in
   the socket opened by the userspace program.  Conversely, when the
   userspace program writes to the "tap" socket, the kernel TCP/IP
   stack processes the packet as if it had been received by the "tap"
   device.

   Consider the configuration above.  Given this configuration, if you
   "ping" an IP address in the 192.168.0.x subnet, the Linux kernel
   routing stack will transmit an ARP on the tap0 device.  Open
   vSwitch userspace treats "tap" devices just like any other network
   device; that is, it doesn't open them as "tap" sockets.  That means
   that the ARP packet will simply get dropped.

   You might wonder why the Open vSwitch kernel module doesn't
   intercept the ARP packet and bridge it.  After all, Open vSwitch
   intercepts packets on other devices.  The answer is that Open
   vSwitch only intercepts *received* packets, but this is a packet
   being transmitted.  The same thing happens for all other types of
   network devices, except for Open vSwitch "internal" ports.  If you,
   for example, add a physical Ethernet port to an OVS bridge,
   configure an IP address on a physical Ethernet port, and then issue
   a "ping" to an address in that subnet, the same thing happens: an
   ARP gets transmitted on the physical Ethernet port and Open vSwitch
   never sees it.  (You should not do that, as documented at the
   beginning of this section.)

   It can make sense to add a "tap" device to an Open vSwitch bridge,
   if some userspace program (other than Open vSwitch) has opened the
   tap socket.  This is the case, for example, if the "tap" device was
   created by KVM (or QEMU) to simulate a virtual NIC.  In such a
   case, when OVS bridges a packet to the "tap" device, the kernel
   forwards that packet to KVM in userspace, which passes it along to
   the VM, and in the other direction, when the VM sends a packet, KVM
   writes it to the "tap" socket, which causes OVS to receive it and
   bridge it to the other OVS ports.  Please note that in such a case
   no IP address is configured on the "tap" device (there is normally
   an IP address configured in the virtual NIC inside the VM, but this
   is not visible to the host Linux kernel or to Open vSwitch).

   There is one special case in which Open vSwitch does directly read
   and write "tap" sockets.  This is an implementation detail of the
   Open vSwitch userspace switch, which implements its "internal"
   ports as Linux (or *BSD) "tap" sockets.  In such a userspace
   switch, OVS receives packets sent on the "tap" device used to
   implement an "internal" port by reading the associated "tap"
   socket, and bridges them to the rest of the switch.  In the other
   direction, OVS transmits packets bridged to the "internal" port by
   writing them to the "tap" socket, causing them to be processed by
   the kernel TCP/IP stack as if they had been received on the "tap"
   device.  Users should not need to be concerned with this
   implementation detail.

   Open vSwitch has a network device type called "tap".  This is
   intended only for implementing "internal" ports in the OVS
   userspace switch and should not be used otherwise.  In particular,
   users should not configure KVM "tap" devices as type "tap" (use
   type "system", the default, instead).

From f.pakzad at uq.edu.au  Sun May 31 23:48:10 2015
From: f.pakzad at uq.edu.au (Farzaneh Pakzad)
Date: Mon, 1 Jun 2015 06:48:10 +0000
Subject: [ovs-discuss] OpenVSwitch priority queue
Message-ID: <03FD020EDE58794898A22B1BED24FD83985E57@uqexmdb7.soe.uq.edu.au>

Hi all,

I used Mininet to make a topology with two hosts and two switches.
By now I  added two queues to a port of one of the switches.
But what I want is to make one of the queue has a priority over the other one.
Would you please let me know if it is possible to make a priority queue in OpenVSwitch?

Thanks,
Farzaneh
I
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150601/cb1309d2/attachment.html>


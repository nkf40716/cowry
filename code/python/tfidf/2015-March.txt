From djhon9813 at gmail.com  Sun Mar  1 04:59:24 2015
From: djhon9813 at gmail.com (david jhon)
Date: Sun, 1 Mar 2015 17:59:24 +0500
Subject: [ovs-discuss] update checksum for vswitch.ovsschema file after
	adding a new table
Message-ID: <CANPUzQ10EoR3+shzGq_d71Ga5Uz6F5kfuiDgsPdmwE7UCwGimw@mail.gmail.com>

Hello,

I have added a new test table in vswitch.schema file, building source with
new schema file successfully generates lib/vswitch-idl.h/c files which
contains the source for newly added table in vswitch.ovsschema, but after
building a few files it quits with the following error:

../vswitchd/vswitch.ovsschema:3: checksum "1496888822 21925" does not match
(you should probably update the version number and fix the checksum)
make[3]: *** [vswitchd/vswitch.ovsschema.stamp] Error 1
make[3]: *** Waiting for unfinished jobs....
  CC       lib/bfd.lo
make[2]: *** [all-recursive] Error 1
make[1]: *** [all] Error 2
make: *** [all] Error 2

How do I update the checksum for modified vswitch.ovsschema file so that I
may be able to build it successfully. Thanks in advance for your time, help
or suggestions. Thanks!

David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150301/77212e8e/attachment.html>

From amuller at redhat.com  Sun Mar  1 07:15:49 2015
From: amuller at redhat.com (Assaf Muller)
Date: Sun, 1 Mar 2015 10:15:49 -0500 (EST)
Subject: [ovs-discuss] OVN NAT with and without Neutron floating IPs
In-Reply-To: <1748725311.27473847.1425222284303.JavaMail.zimbra@redhat.com>
Message-ID: <1854278680.27501915.1425222949077.JavaMail.zimbra@redhat.com>

Hello everyone,

I've been reading the published articles about OVN and as I was comparing it to
Neutron DVR a question popped up regarding NAT.

In Neutron, when using DVR, VMs that have floating IPs assigned have their
traffic forwarded by and to the hosting chassis. VMs that don't have a floating
IP assigned have their outgoing traffic forwarded from the hosting chassis
to an edge node (Network node in Neutron speak) that runs the L3 agent,
which performs NAT/PAT with the router's address on the external network.
This means that you only need one external address (For NAT).
Distributing PAT for VMs that have no floating IP would require an external / routable
address for every chassis, or if optimized for every chassis that is hosting VMs
that do not have a floating IP address.

As I understand it, OVN will run the ovn-controller daemon on every chassis.
Will it distinguish between 'compute' nodes and 'edge' nodes?
If not, how are you going to perform NAT for VMs with no floating IP?


Assaf Muller, Cloud Networking Engineer
Red Hat

From blp at nicira.com  Sun Mar  1 08:27:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 1 Mar 2015 08:27:52 -0800
Subject: [ovs-discuss] update checksum for vswitch.ovsschema file after
 adding a new table
In-Reply-To: <CANPUzQ10EoR3+shzGq_d71Ga5Uz6F5kfuiDgsPdmwE7UCwGimw@mail.gmail.com>
References: <CANPUzQ10EoR3+shzGq_d71Ga5Uz6F5kfuiDgsPdmwE7UCwGimw@mail.gmail.com>
Message-ID: <20150301162752.GA30918@nicira.com>

On Sun, Mar 01, 2015 at 05:59:24PM +0500, david jhon wrote:
> Hello,
> 
> I have added a new test table in vswitch.schema file, building source with
> new schema file successfully generates lib/vswitch-idl.h/c files which
> contains the source for newly added table in vswitch.ovsschema, but after
> building a few files it quits with the following error:
> 
> ../vswitchd/vswitch.ovsschema:3: checksum "1496888822 21925" does not match
> (you should probably update the version number and fix the checksum)
> make[3]: *** [vswitchd/vswitch.ovsschema.stamp] Error 1
> make[3]: *** Waiting for unfinished jobs....
>   CC       lib/bfd.lo
> make[2]: *** [all-recursive] Error 1
> make[1]: *** [all] Error 2
> make: *** [all] Error 2
> 
> How do I update the checksum for modified vswitch.ovsschema file so that I
> may be able to build it successfully. Thanks in advance for your time, help
> or suggestions. Thanks!

Just put the new checksum (indicated in the message) in the place of the
existing checksum.

From djhon9813 at gmail.com  Sun Mar  1 10:11:32 2015
From: djhon9813 at gmail.com (david jhon)
Date: Sun, 1 Mar 2015 23:11:32 +0500
Subject: [ovs-discuss] update checksum for vswitch.ovsschema file after
 adding a new table
In-Reply-To: <20150301162752.GA30918@nicira.com>
References: <CANPUzQ10EoR3+shzGq_d71Ga5Uz6F5kfuiDgsPdmwE7UCwGimw@mail.gmail.com>
 <20150301162752.GA30918@nicira.com>
Message-ID: <CANPUzQ3tA3dLQ2esVV1s1xUUphsi50uXC_wn5Dvv=Hw8G-TaCQ@mail.gmail.com>

got it fixed, thanks a lot Ben!

On Sun, Mar 1, 2015 at 9:27 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Sun, Mar 01, 2015 at 05:59:24PM +0500, david jhon wrote:
> > Hello,
> >
> > I have added a new test table in vswitch.schema file, building source
> with
> > new schema file successfully generates lib/vswitch-idl.h/c files which
> > contains the source for newly added table in vswitch.ovsschema, but after
> > building a few files it quits with the following error:
> >
> > ../vswitchd/vswitch.ovsschema:3: checksum "1496888822 21925" does not
> match
> > (you should probably update the version number and fix the checksum)
> > make[3]: *** [vswitchd/vswitch.ovsschema.stamp] Error 1
> > make[3]: *** Waiting for unfinished jobs....
> >   CC       lib/bfd.lo
> > make[2]: *** [all-recursive] Error 1
> > make[1]: *** [all] Error 2
> > make: *** [all] Error 2
> >
> > How do I update the checksum for modified vswitch.ovsschema file so that
> I
> > may be able to build it successfully. Thanks in advance for your time,
> help
> > or suggestions. Thanks!
>
> Just put the new checksum (indicated in the message) in the place of the
> existing checksum.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150301/2b940b16/attachment.html>

From chris at onthe.net.au  Sun Mar  1 17:16:52 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Mon, 2 Mar 2015 12:16:52 +1100
Subject: [ovs-discuss] pskb_expand_head: skb_shared BUG
In-Reply-To: <20150302004511.GA1500@onthe.net.au>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <20150302004511.GA1500@onthe.net.au>
Message-ID: <20150302011652.GA4580@onthe.net.au>

On Mon, Mar 02, 2015 at 11:45:11AM +1100, Chris Dunlop wrote:
> Heads up...
> 
> We've hit this BUG() in v3.10.70, v3.14.27 and v3.18.7:
> 
> net/core/skbuff.c:
> 1027 int pskb_expand_head(struct sk_buff *skb, int nhead, int ntail,
> 1028                      gfp_t gfp_mask)
> 1029 {
> 1030         int i;
> 1031         u8 *data;
> 1032         int size = nhead + skb_end_offset(skb) + ntail;
> 1033         long off;
> 1034 
> 1035         BUG_ON(nhead < 0);
> 1036 
> 1037         if (skb_shared(skb))
> 1038                 BUG();             <<< BOOM!!!
> 
> This appears to be a regression in the 3.10.x stable series:
> we've been running for 11 months on v3.10.33 without problem, we
> upgraded to v3.14.27 and hit the BUG(), than again on upgrading
> to v3.18.7, then again after downgrading to v3.10.70. 

I'm guessing this is the cause:

commit 522ad79b7fd042f7f735bf1826f2e5b564d8f015
Author: Jiri Benc <jbenc at redhat.com>
Date:   Thu Aug 21 21:33:44 2014 +0200

    openvswitch: fix panic with multiple vlan headers

 static int make_writable(struct sk_buff *skb, int write_len)
 {
+       if (!pskb_may_pull(skb, write_len))
+               return -ENOMEM;
+
        if (!skb_cloned(skb) || skb_clone_writable(skb, write_len))
                return 0;

...which takes us through:

static inline int pskb_may_pull(struct sk_buff *skb, unsigned int len)
{
        if (likely(len <= skb_headlen(skb)))
                return 1;
        if (unlikely(len > skb->len))
                return 0;
        return __pskb_pull_tail(skb, len - skb_headlen(skb)) != NULL;
}

unsigned char *__pskb_pull_tail(struct sk_buff *skb, int delta)
{
        int eat = (skb->tail + delta) - skb->end;
        ...
        if (eat > 0 || skb_cloned(skb)) {
                if (pskb_expand_head(skb, 0, eat > 0 ? eat + 128 : 0,
                                GFP_ATOMIC))
                        return NULL;
        }
        ...
}

pskb_expand_head(skb, 0, eat > 0 ? eat + 128 : 0, GFP_ATOMIC)
{
        ...
        if (skb_shared(skb))
                BUG();                          <<< BOOM!!!
        ...
}


Cheers,

Chris

From djhon9813 at gmail.com  Mon Mar  2 03:08:52 2015
From: djhon9813 at gmail.com (david jhon)
Date: Mon, 2 Mar 2015 16:08:52 +0500
Subject: [ovs-discuss] update checksum for vswitch.ovsschema file after
 adding a new table
In-Reply-To: <CANPUzQ3tA3dLQ2esVV1s1xUUphsi50uXC_wn5Dvv=Hw8G-TaCQ@mail.gmail.com>
References: <CANPUzQ10EoR3+shzGq_d71Ga5Uz6F5kfuiDgsPdmwE7UCwGimw@mail.gmail.com>
 <20150301162752.GA30918@nicira.com>
 <CANPUzQ3tA3dLQ2esVV1s1xUUphsi50uXC_wn5Dvv=Hw8G-TaCQ@mail.gmail.com>
Message-ID: <CANPUzQ33QwtKOSOkNvHby+s62Bs5aSmDszkCKrjJ-r9rXV25kQ@mail.gmail.com>

I am really sorry for this absurd question but I am not getting exactly why
my code for setting a column in database fails on this assertion in
ovsdb-idl.c:
ovs_assert(row->old == NULL ||
                row->table->modes[column_idx] & OVSDB_IDL_MONITOR);

ovs-vsctl: ../lib/ovsdb-idl.c:1905: assertion row->old == NULL ||
row->table->modes[column_idx] & OVSDB_IDL_MONITOR failed in
ovsdb_idl_txn_write__()

Thanking you in anticipation for letting me know any possibility.

Regards,

On Sun, Mar 1, 2015 at 11:11 PM, david jhon <djhon9813 at gmail.com> wrote:

> got it fixed, thanks a lot Ben!
>
> On Sun, Mar 1, 2015 at 9:27 PM, Ben Pfaff <blp at nicira.com> wrote:
>
>> On Sun, Mar 01, 2015 at 05:59:24PM +0500, david jhon wrote:
>> > Hello,
>> >
>> > I have added a new test table in vswitch.schema file, building source
>> with
>> > new schema file successfully generates lib/vswitch-idl.h/c files which
>> > contains the source for newly added table in vswitch.ovsschema, but
>> after
>> > building a few files it quits with the following error:
>> >
>> > ../vswitchd/vswitch.ovsschema:3: checksum "1496888822 21925" does not
>> match
>> > (you should probably update the version number and fix the checksum)
>> > make[3]: *** [vswitchd/vswitch.ovsschema.stamp] Error 1
>> > make[3]: *** Waiting for unfinished jobs....
>> >   CC       lib/bfd.lo
>> > make[2]: *** [all-recursive] Error 1
>> > make[1]: *** [all] Error 2
>> > make: *** [all] Error 2
>> >
>> > How do I update the checksum for modified vswitch.ovsschema file so
>> that I
>> > may be able to build it successfully. Thanks in advance for your time,
>> help
>> > or suggestions. Thanks!
>>
>> Just put the new checksum (indicated in the message) in the place of the
>> existing checksum.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150302/6599989c/attachment.html>

From ppnaik at cse.iitb.ac.in  Mon Mar  2 03:23:12 2015
From: ppnaik at cse.iitb.ac.in (Priyanka Naik)
Date: Mon, 02 Mar 2015 16:53:12 +0530
Subject: [ovs-discuss] Port mirroring patch only sees egress traffic
In-Reply-To: <54F12DAD.70505@huawei.com>
References: <548B7F22.5090303@pnnl.gov> <54F12DAD.70505@huawei.com>
Message-ID: <54F44820.1060301@cse.iitb.ac.in>

Hi James,

I am too facing the same issue of egress traffic getting captured. I am 
using openstack juno. Actually only egress is getting captured on 
mirrored port on br-int and only ingress traffic is captured on mirrored 
port on br-tun. Can you please help me solve the issue?

  link to my problem:
https://ask.openstack.org/en/question/61305/issue-regarding-port-mirroring/

Thanks,

Priyanka

On 02/28/2015 08:23 AM, Wuyunfei wrote:
> Hi Tom，
>
> I'm doing some tests on OVS port mirroring and find the same issue you met with.
> I wonder if you have already solved this issue, if so, would you please tell me how to fix it.
>
> By the way, you've metioned in your last mail that using Open Flow rule to duplicate the traffic, does it work as fine as the port mirroring method?
>
> ~ James
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From pg201372016 at iitj.ac.in  Mon Mar  2 05:38:00 2015
From: pg201372016 at iitj.ac.in (Sumit Paliwal)
Date: Mon, 2 Mar 2015 19:08:00 +0530
Subject: [ovs-discuss] Link Bandwidth not effective with UserSwitch
Message-ID: <CAEhKQH+DLt_UOZ4TU-2rirVDze9hRfXFhYpDV5fKiu0YfrDjYw@mail.gmail.com>

Hi,

I've created a topology including three UserSwitch (Reference Switches) and
assigned a bandwidth of 500 Mb/s, but when i'm using iperf to check the
bandwidth, it shows 385 kb/s only.

So can anyone help me out here with this.

And when i'm using the OVSSwitch, with iperf it shows the bandwidth of 392
Mb/s.

My n/w topology is as given below:-


#!/usr/bin/env python

from mininet.net  import Mininet
from mininet.node import RemoteController,UserSwitch
from mininet.link import TCLink
from mininet.cli  import CLI
from mininet.util import quietRun
from mininet.log import setLogLevel, info

net = Mininet(link=TCLink,listenPort=6634);

# Add hosts and switches
Host1  = net.addHost('h1')
Host2  = net.addHost('h2')
Host3  = net.addHost('h3')
Switch1 = net.addSwitch('s1',cls=UserSwitch)
Switch2 = net.addSwitch('s2',cls=UserSwitch)
Switch3 = net.addSwitch('s3',cls=UserSwitch)

linkopts = dict(bw=500)
net.addLink(Host1,   Switch1,    **linkopts )
net.addLink(Switch1,  Switch2,    **linkopts )
net.addLink(Switch2,  Switch3,    **linkopts )
net.addLink(Host2,   Switch2,    **linkopts )
net.addLink(Host3,   Switch3,    **linkopts )

net.addController('c1')
net.build()
net.start()

# CLI
CLI( net )

# Clean up
net.stop()


The results of command iperf h1 h3 is 385 kb/s
where the expected result should have been around 490 Mb/s

Kindly let me know, is there anything wrong with the code or it's just that
the bandwidth parameter doesn't work with UserSwitch.

Thanks & Regards,

-- 
Sumit Paliwal
M.Tech. ICT,
IIT Jodhpur


*"Have a great Day... "*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150302/8fb509bb/attachment-0001.html>

From blp at nicira.com  Mon Mar  2 08:45:56 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 2 Mar 2015 08:45:56 -0800
Subject: [ovs-discuss] Link Bandwidth not effective with UserSwitch
In-Reply-To: <CAEhKQH+DLt_UOZ4TU-2rirVDze9hRfXFhYpDV5fKiu0YfrDjYw@mail.gmail.com>
References: <CAEhKQH+DLt_UOZ4TU-2rirVDze9hRfXFhYpDV5fKiu0YfrDjYw@mail.gmail.com>
Message-ID: <20150302164556.GB12710@nicira.com>

On Mon, Mar 02, 2015 at 07:08:00PM +0530, Sumit Paliwal wrote:
> I've created a topology including three UserSwitch (Reference Switches) and
> assigned a bandwidth of 500 Mb/s, but when i'm using iperf to check the
> bandwidth, it shows 385 kb/s only.
> 
> So can anyone help me out here with this.
> 
> And when i'm using the OVSSwitch, with iperf it shows the bandwidth of 392
> Mb/s.

It sounds like Open vSwitch is operating correctly.  I don't know what a
"UserSwitch (Reference Switches)" is; if it's not some configuration of
Open vSwitch, then you might want to ask about it on a mailing list that
focuses on that switch.  If it is a configuration of Open vSwitch, then
maybe you should explain further.

Not everyone on this mailing list knows much about Mininet; I don't.

From raminhafezi at gmail.com  Sun Mar  1 17:22:03 2015
From: raminhafezi at gmail.com (ramin hafezi)
Date: Mon, 2 Mar 2015 12:22:03 +1100
Subject: [ovs-discuss] How to post a msg in the list
Message-ID: <CAN2qnYGkKV5SXuQvfvZJgO4mjBGGDApB477AbiNDL0pPRQSphQ@mail.gmail.com>

Dear all admin,

I am new in the openvswitch and I face a problem in installing it in debian
wheezy.

I think new version on ovs does not install "vxlan" module after checking
the linux version.

The problem is that I have to install it in linux "voyage" and it does not
include the vxlan module.

*Where and How can I post my problem!*?

Many thanks and regards,
Ramin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150302/7c390859/attachment.html>

From amer7777 at hotmail.com  Sun Mar  1 19:48:33 2015
From: amer7777 at hotmail.com (Amer)
Date: Mon, 2 Mar 2015 06:48:33 +0300
Subject: [ovs-discuss] The action "dec_ttl" doesn't work
Message-ID: <BLU436-SMTP18656B213D09825E557F22D4100@phx.gbl>

Hello,

Dear All,

I am using mininet v 2.0 and OVS 1,10 
I run wireshatk in the background to check the IP-TTL value, however it doesn't decremented
I have used the following commands in riplpox to decrement the IP_TTL in reactive and proactive modes

  def install(self, port, packet, buf = None, idle_timeout = 0, hard_timeout = 0,
              priority = of.OFP_DEFAULT_PRIORITY):
#    msg = of.ofp_flow_mod()
    msg = nx.nx_flow_mod()
 #   msg.match = match
    msg.match.eth_src = packet.src
    msg.match.eth_dst = packet.dst
    msg.idle_timeout = idle_timeout
    msg.hard_timeout = hard_timeout
    msg.priority = priority
   msg.actions.append(nx.nx_action_dec_ttl())
    msg.actions.append(of.ofp_action_output(port = port))
    msg.buffer_id = buf
    self.connection.send(msg)

Best regards,
Amer 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150302/6d793275/attachment.html>

From federico.iezzi at hp.com  Mon Mar  2 06:09:14 2015
From: federico.iezzi at hp.com (Iezzi, Federico)
Date: Mon, 2 Mar 2015 14:09:14 +0000
Subject: [ovs-discuss] Info next OVS with Intel DPDK
Message-ID: <6B8573EBEA47DA438B0DA2226C90B432020145A0@G2W2433.americas.hpqcorp.net>

Hi guys,



I'm so sorry if you already spoken a lot of this topic.



In my opinion this is the most clear topic on the OVS mailing list but it is a bit old (6 months ago) -> http://openvswitch.org/pipermail/discuss/2014-September/015019.html



If I'm not wrong the next OVS version will be released when two important features will be available: vHost (for QEMU integration) and Tunning "under" DPDK code.



>From the changelog the current master OVS code supports Tunnel acceleration but it doesn't support the vHost functionality.

>From the DPDK 2.0-RC1 changelog (released last week) Intel added the Tunneling acceleration at the DPDK level.



So can someone explain me the current integration status?

I know that the next OVS version will be available when all the features will be available but these features in what development state are.



Thanks a lot!

Federico Iezzi

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150302/64b6dbe5/attachment.html>

From federico.iezzi at hp.com  Mon Mar  2 06:09:14 2015
From: federico.iezzi at hp.com (Iezzi, Federico)
Date: Mon, 2 Mar 2015 14:09:14 +0000
Subject: [ovs-discuss] Info next OVS with Intel DPDK
Message-ID: <6B8573EBEA47DA438B0DA2226C90B432020145A0@G2W2433.americas.hpqcorp.net>

Hi guys,



I'm so sorry if you already spoken a lot of this topic.



In my opinion this is the most clear topic on the OVS mailing list but it is a bit old (6 months ago) -> http://openvswitch.org/pipermail/discuss/2014-September/015019.html



If I'm not wrong the next OVS version will be released when two important features will be available: vHost (for QEMU integration) and Tunning "under" DPDK code.



>From the changelog the current master OVS code supports Tunnel acceleration but it doesn't support the vHost functionality.

>From the DPDK 2.0-RC1 changelog (released last week) Intel added the Tunneling acceleration at the DPDK level.



So can someone explain me the current integration status?

I know that the next OVS version will be available when all the features will be available but these features in what development state are.



Thanks a lot!

Federico Iezzi

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150302/64b6dbe5/attachment-0003.html>

From blp at nicira.com  Mon Mar  2 10:29:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 2 Mar 2015 10:29:06 -0800
Subject: [ovs-discuss] update checksum for vswitch.ovsschema file after
 adding a new table
In-Reply-To: <CANPUzQ33QwtKOSOkNvHby+s62Bs5aSmDszkCKrjJ-r9rXV25kQ@mail.gmail.com>
References: <CANPUzQ10EoR3+shzGq_d71Ga5Uz6F5kfuiDgsPdmwE7UCwGimw@mail.gmail.com>
 <20150301162752.GA30918@nicira.com>
 <CANPUzQ3tA3dLQ2esVV1s1xUUphsi50uXC_wn5Dvv=Hw8G-TaCQ@mail.gmail.com>
 <CANPUzQ33QwtKOSOkNvHby+s62Bs5aSmDszkCKrjJ-r9rXV25kQ@mail.gmail.com>
Message-ID: <20150302182906.GA13154@nicira.com>

On Mon, Mar 02, 2015 at 04:08:52PM +0500, david jhon wrote:
> I am really sorry for this absurd question but I am not getting exactly why
> my code for setting a column in database fails on this assertion in
> ovsdb-idl.c:
> ovs_assert(row->old == NULL ||
>                 row->table->modes[column_idx] & OVSDB_IDL_MONITOR);
> 
> ovs-vsctl: ../lib/ovsdb-idl.c:1905: assertion row->old == NULL ||
> row->table->modes[column_idx] & OVSDB_IDL_MONITOR failed in
> ovsdb_idl_txn_write__()

You're trying to write to a column that you haven't configured the
client library to read from the database server, which doesn't make
sense.

From pshelar at nicira.com  Mon Mar  2 13:56:52 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Mon, 2 Mar 2015 13:56:52 -0800
Subject: [ovs-discuss] Info next OVS with Intel DPDK
In-Reply-To: <6B8573EBEA47DA438B0DA2226C90B432020145A0@G2W2433.americas.hpqcorp.net>
References: <6B8573EBEA47DA438B0DA2226C90B432020145A0@G2W2433.americas.hpqcorp.net>
Message-ID: <CALnjE+q+2zy6R33D32VR61sE4t-J1LBwfBoaV3dKX+kuKF54ew@mail.gmail.com>

On Mon, Mar 2, 2015 at 6:09 AM, Iezzi, Federico <federico.iezzi at hp.com> wrote:
> Hi guys,
>
>
>
> I'm so sorry if you already spoken a lot of this topic.
>
>
>
> In my opinion this is the most clear topic on the OVS mailing list but it is
> a bit old (6 months ago) ->
> http://openvswitch.org/pipermail/discuss/2014-September/015019.html
>
>
>
> If I'm not wrong the next OVS version will be released when two important
> features will be available: vHost (for QEMU integration) and Tunning "under"
> DPDK code.
>
>
>
> From the changelog the current master OVS code supports Tunnel acceleration
> but it doesn't support the vHost functionality.
>
> From the DPDK 2.0-RC1 changelog (released last week) Intel added the
> Tunneling acceleration at the DPDK level.
>
>
>
> So can someone explain me the current integration status?
>
> I know that the next OVS version will be available when all the features
> will be available but these features in what development state are.
>
>
Tunnel support is already in OVS master branch. vhost patches are
under review but it is blocked on dpdk 1.8 support. I hope vhost
support will be merge in 2-3 weeks.

From federico.iezzi at hp.com  Tue Mar  3 00:37:57 2015
From: federico.iezzi at hp.com (Iezzi, Federico)
Date: Tue, 3 Mar 2015 08:37:57 +0000
Subject: [ovs-discuss] Info next OVS with Intel DPDK
In-Reply-To: <CALnjE+q+2zy6R33D32VR61sE4t-J1LBwfBoaV3dKX+kuKF54ew@mail.gmail.com>
References: <6B8573EBEA47DA438B0DA2226C90B432020145A0@G2W2433.americas.hpqcorp.net>
 <CALnjE+q+2zy6R33D32VR61sE4t-J1LBwfBoaV3dKX+kuKF54ew@mail.gmail.com>
Message-ID: <6B8573EBEA47DA438B0DA2226C90B43202015889@G2W2433.americas.hpqcorp.net>

Hi Pravin,

Thanks a lot for your answer.

Regards,
Federico

-----Original Message-----
From: Pravin Shelar [mailto:pshelar at nicira.com] 
Sent: lunedì 2 marzo 2015 22:57
To: Iezzi, Federico
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Info next OVS with Intel DPDK

On Mon, Mar 2, 2015 at 6:09 AM, Iezzi, Federico <federico.iezzi at hp.com> wrote:
> Hi guys,
>
>
>
> I'm so sorry if you already spoken a lot of this topic.
>
>
>
> In my opinion this is the most clear topic on the OVS mailing list but 
> it is a bit old (6 months ago) -> 
> http://openvswitch.org/pipermail/discuss/2014-September/015019.html
>
>
>
> If I'm not wrong the next OVS version will be released when two 
> important features will be available: vHost (for QEMU integration) and Tunning "under"
> DPDK code.
>
>
>
> From the changelog the current master OVS code supports Tunnel 
> acceleration but it doesn't support the vHost functionality.
>
> From the DPDK 2.0-RC1 changelog (released last week) Intel added the 
> Tunneling acceleration at the DPDK level.
>
>
>
> So can someone explain me the current integration status?
>
> I know that the next OVS version will be available when all the 
> features will be available but these features in what development state are.
>
>
Tunnel support is already in OVS master branch. vhost patches are under review but it is blocked on dpdk 1.8 support. I hope vhost support will be merge in 2-3 weeks.

From djhon9813 at gmail.com  Tue Mar  3 00:58:40 2015
From: djhon9813 at gmail.com (david jhon)
Date: Tue, 3 Mar 2015 13:58:40 +0500
Subject: [ovs-discuss] update checksum for vswitch.ovsschema file after
 adding a new table
In-Reply-To: <20150302182906.GA13154@nicira.com>
References: <CANPUzQ10EoR3+shzGq_d71Ga5Uz6F5kfuiDgsPdmwE7UCwGimw@mail.gmail.com>
 <20150301162752.GA30918@nicira.com>
 <CANPUzQ3tA3dLQ2esVV1s1xUUphsi50uXC_wn5Dvv=Hw8G-TaCQ@mail.gmail.com>
 <CANPUzQ33QwtKOSOkNvHby+s62Bs5aSmDszkCKrjJ-r9rXV25kQ@mail.gmail.com>
 <20150302182906.GA13154@nicira.com>
Message-ID: <CANPUzQ2tokrto39V-FVtsxqv0zPtjNgU5ThVTn0F=puyuzQZdA@mail.gmail.com>

oh yep, got it, thanks a lot Ben!

On Mon, Mar 2, 2015 at 11:29 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Mon, Mar 02, 2015 at 04:08:52PM +0500, david jhon wrote:
> > I am really sorry for this absurd question but I am not getting exactly
> why
> > my code for setting a column in database fails on this assertion in
> > ovsdb-idl.c:
> > ovs_assert(row->old == NULL ||
> >                 row->table->modes[column_idx] & OVSDB_IDL_MONITOR);
> >
> > ovs-vsctl: ../lib/ovsdb-idl.c:1905: assertion row->old == NULL ||
> > row->table->modes[column_idx] & OVSDB_IDL_MONITOR failed in
> > ovsdb_idl_txn_write__()
>
> You're trying to write to a column that you haven't configured the
> client library to read from the database server, which doesn't make
> sense.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150303/6adea325/attachment.html>

From raorn at raorn.name  Tue Mar  3 05:58:47 2015
From: raorn at raorn.name (Alexey I. Froloff)
Date: Tue, 3 Mar 2015 16:58:47 +0300
Subject: [ovs-discuss] force-reload-kmod breaks IPv6 in a bad way
Message-ID: <20150303135847.GA13946@raorn.name>

Hi,

When saving/restoring bridge state during force-reload-kmod
dynamic and 'scope link' addresses are not restored.  This breaks
IPv6 in a very bad way, because restored interface no longer have
link-local (fe80::) address.  Because of that it is unable to
receive RAs and assign global dynamic address.

I have made a quick fix [1] that restores 'scope link' inet6
addresses, please take a look.

1. https://github.com/openvswitch/ovs/pull/33

-- 
Regards,    --
Sir Raorn.   --- https://plus.google.com/+AlexeyFroloff
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 473 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150303/9e3ccf7e/attachment.sig>

From kevin.traynor at intel.com  Tue Mar  3 06:43:56 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 3 Mar 2015 14:43:56 +0000
Subject: [ovs-discuss] Info next OVS with Intel DPDK
In-Reply-To: <CALnjE+q+2zy6R33D32VR61sE4t-J1LBwfBoaV3dKX+kuKF54ew@mail.gmail.com>
References: <6B8573EBEA47DA438B0DA2226C90B432020145A0@G2W2433.americas.hpqcorp.net>
 <CALnjE+q+2zy6R33D32VR61sE4t-J1LBwfBoaV3dKX+kuKF54ew@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7306BC290@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Pravin
> Shelar
> Sent: Monday, March 2, 2015 9:57 PM
> To: Iezzi, Federico
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Info next OVS with Intel DPDK
> 
> On Mon, Mar 2, 2015 at 6:09 AM, Iezzi, Federico <federico.iezzi at hp.com>
> wrote:
> > Hi guys,
> >
> >
> >
> > I'm so sorry if you already spoken a lot of this topic.
> >
> >
> >
> > In my opinion this is the most clear topic on the OVS mailing list but it
> is
> > a bit old (6 months ago) ->
> > http://openvswitch.org/pipermail/discuss/2014-September/015019.html

If you are looking for more info, there are a few newer threads on ML than 
the one you've linked. e.g.
http://openvswitch.org/pipermail/discuss/2015-January/016383.html

> >
> >
> >
> > If I'm not wrong the next OVS version will be released when two important
> > features will be available: vHost (for QEMU integration) and Tunning
> "under"
> > DPDK code.
> >
> >
> >
> > From the changelog the current master OVS code supports Tunnel acceleration
> > but it doesn't support the vHost functionality.
> >
> > From the DPDK 2.0-RC1 changelog (released last week) Intel added the
> > Tunneling acceleration at the DPDK level.
> >
> >
> >
> > So can someone explain me the current integration status?
> >
> > I know that the next OVS version will be available when all the features
> > will be available but these features in what development state are.
> >
> >
> Tunnel support is already in OVS master branch. vhost patches are
> under review but it is blocked on dpdk 1.8 support. I hope vhost
> support will be merge in 2-3 weeks.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Tue Mar  3 08:08:39 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Mar 2015 08:08:39 -0800
Subject: [ovs-discuss] force-reload-kmod breaks IPv6 in a bad way
In-Reply-To: <20150303135847.GA13946@raorn.name>
References: <20150303135847.GA13946@raorn.name>
Message-ID: <20150303160839.GB19398@nicira.com>

On Tue, Mar 03, 2015 at 04:58:47PM +0300, Alexey I. Froloff wrote:
> When saving/restoring bridge state during force-reload-kmod
> dynamic and 'scope link' addresses are not restored.  This breaks
> IPv6 in a very bad way, because restored interface no longer have
> link-local (fe80::) address.  Because of that it is unable to
> receive RAs and assign global dynamic address.
> 
> I have made a quick fix [1] that restores 'scope link' inet6
> addresses, please take a look.
> 
> 1. https://github.com/openvswitch/ovs/pull/33

Thanks for the patch, I applied this to master and branch-2.3.

From blp at nicira.com  Tue Mar  3 08:10:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Mar 2015 08:10:06 -0800
Subject: [ovs-discuss] force-reload-kmod breaks IPv6 in a bad way
In-Reply-To: <20150303160839.GB19398@nicira.com>
References: <20150303135847.GA13946@raorn.name>
 <20150303160839.GB19398@nicira.com>
Message-ID: <20150303161006.GC19398@nicira.com>

On Tue, Mar 03, 2015 at 08:08:39AM -0800, Ben Pfaff wrote:
> On Tue, Mar 03, 2015 at 04:58:47PM +0300, Alexey I. Froloff wrote:
> > When saving/restoring bridge state during force-reload-kmod
> > dynamic and 'scope link' addresses are not restored.  This breaks
> > IPv6 in a very bad way, because restored interface no longer have
> > link-local (fe80::) address.  Because of that it is unable to
> > receive RAs and assign global dynamic address.
> > 
> > I have made a quick fix [1] that restores 'scope link' inet6
> > addresses, please take a look.
> > 
> > 1. https://github.com/openvswitch/ovs/pull/33
> 
> Thanks for the patch, I applied this to master and branch-2.3.

The AUTHORS file currently lists your email address as
raorn at altlinux.org.  Do you want me to update it to raorn at raorn.name?

From singh.pratapkrishna at gmail.com  Tue Mar  3 08:28:27 2015
From: singh.pratapkrishna at gmail.com (Krishna Pratap)
Date: Tue, 3 Mar 2015 11:28:27 -0500
Subject: [ovs-discuss] How to set the MAC address of bridge local port
Message-ID: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>

Hi,

Is it possible to set the MAC address of the local port of bridge( not the
address of bridge itself) with a fixed address?

I tried couple of ways to do it. one of them mentioned here in this old
thread
http://openvswitch.org/pipermail/discuss/2011-June/005297.html

i tested this one out but it doesn't change the mac address of port br0.
here is what I did.

root at ccpu:~# ovs-vsctl add-br br0 -- set bridge br0
other-config:hwaddr=\"00:15:17:a0:29:80\"
root at ccpu5:~# ovs-ofctl dump-ports-desc br0
OFPST_PORT_DESC reply (xid=0x2):
 LOCAL(br0): addr:ce:09:03:00:00:00
     config:     PORT_DOWN
     state:      LINK_DOWN
     speed: 0 Mbps now, 0 Mbps max


As we can see the Mac address doesn't change. it does update the bridge
table's other-config column .


The second way I tried changing was with Interface command.

root at ccpu:~# ovs-vsctl  set interface br0  mac=\"00:15:17:a0:29:80\"
root at ccpu5:~# ovs-ofctl dump-ports-desc br0
OFPST_PORT_DESC reply (xid=0x2):
 LOCAL(br0): addr:ce:09:03:00:00:00
     config:     PORT_DOWN
     state:      LINK_DOWN
     speed: 0 Mbps now, 0 Mbps max


Still I do not see any change in the Mac address with dump-ports-desc
command.
Even though the Interface table does change with Mac address entry which i
try to set it with.

Is there a limitation that the Mac address of  local port or interface of a
bridge can not be changed?

Any help would be great.Thanks
KP
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150303/b761378f/attachment.html>

From blp at nicira.com  Tue Mar  3 09:46:22 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Mar 2015 09:46:22 -0800
Subject: [ovs-discuss] How to set the MAC address of bridge local port
In-Reply-To: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>
References: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>
Message-ID: <20150303174622.GK19398@nicira.com>

On Tue, Mar 03, 2015 at 11:28:27AM -0500, Krishna Pratap wrote:
> Is it possible to set the MAC address of the local port of bridge( not the
> address of bridge itself) with a fixed address?
> 
> I tried couple of ways to do it. one of them mentioned here in this old
> thread
> http://openvswitch.org/pipermail/discuss/2011-June/005297.html
> 
> i tested this one out but it doesn't change the mac address of port br0.
> here is what I did.
> 
> root at ccpu:~# ovs-vsctl add-br br0 -- set bridge br0
> other-config:hwaddr=\"00:15:17:a0:29:80\"
> root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> OFPST_PORT_DESC reply (xid=0x2):
>  LOCAL(br0): addr:ce:09:03:00:00:00
>      config:     PORT_DOWN
>      state:      LINK_DOWN
>      speed: 0 Mbps now, 0 Mbps max
> 
> 
> As we can see the Mac address doesn't change. it does update the bridge
> table's other-config column .

I think that should work.

I notice that the port is down.  Does it make any difference to bring it
up?

From singh.pratapkrishna at gmail.com  Tue Mar  3 09:51:18 2015
From: singh.pratapkrishna at gmail.com (Krishna Pratap)
Date: Tue, 3 Mar 2015 12:51:18 -0500
Subject: [ovs-discuss] How to set the MAC address of bridge local port
In-Reply-To: <20150303174622.GK19398@nicira.com>
References: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>
 <20150303174622.GK19398@nicira.com>
Message-ID: <CAOTV=VwhH7YkY5x-WNftBR7GL2NWSsH=ccWjN+5-+X_p-QgXrw@mail.gmail.com>

I tried bringing the port up. it doesn't change any thing. here is the
output.


root at ccpu5:~# ovs-vsctl  set bridge br0
other-config:hwaddr=\"00:15:17:a0:29:80\"
root at ccpu5:~#
root at ccpu5:~#
root at ccpu5:~# ovs-ofctl dump-ports-desc br0
OFPST_PORT_DESC reply (xid=0x2):
 LOCAL(br0): addr:16:0a:05:2e:20:bc
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
root at ccpu5:~#
root at ccpu5:~#
root at ccpu5:~#
root at ccpu5:~# ifconfig br0
br0       Link encap:Ethernet  HWaddr 16:0a:05:2e:20:bc
          inet6 addr: fe80::140a:5ff:fe2e:20bc/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:468 (468.0 B)


On Tue, Mar 3, 2015 at 12:46 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Mar 03, 2015 at 11:28:27AM -0500, Krishna Pratap wrote:
> > Is it possible to set the MAC address of the local port of bridge( not
> the
> > address of bridge itself) with a fixed address?
> >
> > I tried couple of ways to do it. one of them mentioned here in this old
> > thread
> > http://openvswitch.org/pipermail/discuss/2011-June/005297.html
> >
> > i tested this one out but it doesn't change the mac address of port br0.
> > here is what I did.
> >
> > root at ccpu:~# ovs-vsctl add-br br0 -- set bridge br0
> > other-config:hwaddr=\"00:15:17:a0:29:80\"
> > root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> > OFPST_PORT_DESC reply (xid=0x2):
> >  LOCAL(br0): addr:ce:09:03:00:00:00
> >      config:     PORT_DOWN
> >      state:      LINK_DOWN
> >      speed: 0 Mbps now, 0 Mbps max
> >
> >
> > As we can see the Mac address doesn't change. it does update the bridge
> > table's other-config column .
>
> I think that should work.
>
> I notice that the port is down.  Does it make any difference to bring it
> up?
>



-- 
Best Regards,
Krishna Pratap Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150303/b9d3a9f4/attachment-0001.html>

From blp at nicira.com  Tue Mar  3 09:54:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Mar 2015 09:54:10 -0800
Subject: [ovs-discuss] How to set the MAC address of bridge local port
In-Reply-To: <CAOTV=VwhH7YkY5x-WNftBR7GL2NWSsH=ccWjN+5-+X_p-QgXrw@mail.gmail.com>
References: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>
 <20150303174622.GK19398@nicira.com>
 <CAOTV=VwhH7YkY5x-WNftBR7GL2NWSsH=ccWjN+5-+X_p-QgXrw@mail.gmail.com>
Message-ID: <20150303175410.GL19398@nicira.com>

What's in the ovs-vswitchd log?

On Tue, Mar 03, 2015 at 12:51:18PM -0500, Krishna Pratap wrote:
> I tried bringing the port up. it doesn't change any thing. here is the
> output.
> 
> 
> root at ccpu5:~# ovs-vsctl  set bridge br0
> other-config:hwaddr=\"00:15:17:a0:29:80\"
> root at ccpu5:~#
> root at ccpu5:~#
> root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> OFPST_PORT_DESC reply (xid=0x2):
>  LOCAL(br0): addr:16:0a:05:2e:20:bc
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
> root at ccpu5:~#
> root at ccpu5:~#
> root at ccpu5:~#
> root at ccpu5:~# ifconfig br0
> br0       Link encap:Ethernet  HWaddr 16:0a:05:2e:20:bc
>           inet6 addr: fe80::140a:5ff:fe2e:20bc/64 Scope:Link
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:0 (0.0 B)  TX bytes:468 (468.0 B)
> 
> 
> On Tue, Mar 3, 2015 at 12:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Tue, Mar 03, 2015 at 11:28:27AM -0500, Krishna Pratap wrote:
> > > Is it possible to set the MAC address of the local port of bridge( not
> > the
> > > address of bridge itself) with a fixed address?
> > >
> > > I tried couple of ways to do it. one of them mentioned here in this old
> > > thread
> > > http://openvswitch.org/pipermail/discuss/2011-June/005297.html
> > >
> > > i tested this one out but it doesn't change the mac address of port br0.
> > > here is what I did.
> > >
> > > root at ccpu:~# ovs-vsctl add-br br0 -- set bridge br0
> > > other-config:hwaddr=\"00:15:17:a0:29:80\"
> > > root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> > > OFPST_PORT_DESC reply (xid=0x2):
> > >  LOCAL(br0): addr:ce:09:03:00:00:00
> > >      config:     PORT_DOWN
> > >      state:      LINK_DOWN
> > >      speed: 0 Mbps now, 0 Mbps max
> > >
> > >
> > > As we can see the Mac address doesn't change. it does update the bridge
> > > table's other-config column .
> >
> > I think that should work.
> >
> > I notice that the port is down.  Does it make any difference to bring it
> > up?
> >
> 
> 
> 
> -- 
> Best Regards,
> Krishna Pratap Singh

From singh.pratapkrishna at gmail.com  Tue Mar  3 10:07:05 2015
From: singh.pratapkrishna at gmail.com (Krishna Pratap)
Date: Tue, 3 Mar 2015 13:07:05 -0500
Subject: [ovs-discuss] How to set the MAC address of bridge local port
In-Reply-To: <20150303175410.GL19398@nicira.com>
References: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>
 <20150303174622.GK19398@nicira.com>
 <CAOTV=VwhH7YkY5x-WNftBR7GL2NWSsH=ccWjN+5-+X_p-QgXrw@mail.gmail.com>
 <20150303175410.GL19398@nicira.com>
Message-ID: <CAOTV=VyA5V0NRLXxdstnciuEp=hPczUu18iSnoQ9n1aqQHAXXg@mail.gmail.com>

I did put some log statements inside bridge_pick_local_hw_addr function of
bridge.c . it doesnt appear to set the address it picks from the bridge
table column other-config. here are some snippet of log statements. when i
add bridge and when i update the other-config column . anything that looks
weird?

2015-03-03T18:12:17.389Z|00001|vlog|INFO|opened log file
/usr/local/var/log/openvswitch/ovs-vswitchd.log
2015-03-03T18:12:17.389Z|00002|vswitchd|INFO|Successfully installed crash
handlers for ovs-vswitchd
2015-03-03T18:12:17.395Z|00003|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
connecting...
2015-03-03T18:12:17.395Z|00004|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
connected
2015-03-03T18:12:17.395Z|00005|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.1.0
2015-03-03T18:12:53.786Z|00006|memory|INFO|20200 kB peak resident set size
after 36.4 seconds
2015-03-03T18:12:53.817Z|00007|netdev_linux|ERR|ioctl(SIOCGIFHWADDR) on br0
device failed: No such device or address
2015-03-03T18:12:53.817Z|00008|bridge|INFO|bridge br0: added interface br0
on port 65534
2015-03-03T18:12:53.817Z|00009|netdev|WARN|failed to set flags for network
device br0: No such device or address
2015-03-03T18:12:53.817Z|00010|netdev_linux|WARN|ioctl(SIOCGIFINDEX) on br0
device failed: No such device or address
2015-03-03T18:12:53.817Z|00011|bridge|ERR|bridge br0: failed to set bridge
Ethernet address: No such device or address
2015-03-03T18:12:53.817Z|00012|bridge|INFO|bridge br0: using datapath ID
0000f2e03636694e
2015-03-03T18:12:53.817Z|00013|netdev_linux|WARN|br0: removing policing
failed: No such device
2015-03-03T18:12:53.817Z|00014|connmgr|INFO|br0: added service controller
"punix:/usr/local/var/run/openvswitch/br0.mgmt"
2015-03-03T18:13:03.818Z|00015|memory|INFO|peak resident set size grew 162%
in last 10.0 seconds, from 20200 kB to 52932 kB
2015-03-03T18:13:03.818Z|00016|memory|INFO|dispatchers:1 flow_dumpers:1
handlers:1 ports:1 revalidator keys:1 revalidators:1 rules:4
2015-03-03T18:13:12.655Z|00017|netdev_linux|ERR|ioctl(SIOCSIFHWADDR) on br0
device failed: Operation not supported
2015-03-03T18:13:12.655Z|00018|bridge|ERR|bridge br0: failed to set bridge
Ethernet address: Operation not supported
2015-03-03T18:13:12.655Z|00019|bridge|INFO|bridge br0: using datapath ID
0000001517a02980
2015-03-03T18:13:13.818Z|00020|netdev_linux|ERR|ioctl(SIOCGIFHWADDR) on br0
device failed: No such device or address


On Tue, Mar 3, 2015 at 12:54 PM, Ben Pfaff <blp at nicira.com> wrote:

> What's in the ovs-vswitchd log?
>
> On Tue, Mar 03, 2015 at 12:51:18PM -0500, Krishna Pratap wrote:
> > I tried bringing the port up. it doesn't change any thing. here is the
> > output.
> >
> >
> > root at ccpu5:~# ovs-vsctl  set bridge br0
> > other-config:hwaddr=\"00:15:17:a0:29:80\"
> > root at ccpu5:~#
> > root at ccpu5:~#
> > root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> > OFPST_PORT_DESC reply (xid=0x2):
> >  LOCAL(br0): addr:16:0a:05:2e:20:bc
> >      config:     0
> >      state:      0
> >      speed: 0 Mbps now, 0 Mbps max
> > root at ccpu5:~#
> > root at ccpu5:~#
> > root at ccpu5:~#
> > root at ccpu5:~# ifconfig br0
> > br0       Link encap:Ethernet  HWaddr 16:0a:05:2e:20:bc
> >           inet6 addr: fe80::140a:5ff:fe2e:20bc/64 Scope:Link
> >           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
> >           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
> >           TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
> >           collisions:0 txqueuelen:0
> >           RX bytes:0 (0.0 B)  TX bytes:468 (468.0 B)
> >
> >
> > On Tue, Mar 3, 2015 at 12:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Tue, Mar 03, 2015 at 11:28:27AM -0500, Krishna Pratap wrote:
> > > > Is it possible to set the MAC address of the local port of bridge(
> not
> > > the
> > > > address of bridge itself) with a fixed address?
> > > >
> > > > I tried couple of ways to do it. one of them mentioned here in this
> old
> > > > thread
> > > > http://openvswitch.org/pipermail/discuss/2011-June/005297.html
> > > >
> > > > i tested this one out but it doesn't change the mac address of port
> br0.
> > > > here is what I did.
> > > >
> > > > root at ccpu:~# ovs-vsctl add-br br0 -- set bridge br0
> > > > other-config:hwaddr=\"00:15:17:a0:29:80\"
> > > > root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> > > > OFPST_PORT_DESC reply (xid=0x2):
> > > >  LOCAL(br0): addr:ce:09:03:00:00:00
> > > >      config:     PORT_DOWN
> > > >      state:      LINK_DOWN
> > > >      speed: 0 Mbps now, 0 Mbps max
> > > >
> > > >
> > > > As we can see the Mac address doesn't change. it does update the
> bridge
> > > > table's other-config column .
> > >
> > > I think that should work.
> > >
> > > I notice that the port is down.  Does it make any difference to bring
> it
> > > up?
> > >
> >
> >
> >
> > --
> > Best Regards,
> > Krishna Pratap Singh
>



-- 
Best Regards,
Krishna Pratap Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150303/4baa5c3c/attachment.html>

From cheng at cs.umn.edu  Tue Mar  3 10:25:20 2015
From: cheng at cs.umn.edu (Cheng Jin)
Date: Tue, 3 Mar 2015 12:25:20 -0600
Subject: [ovs-discuss] MAC learning table does not always update
Message-ID: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>

Hi all,

I have a problem with updating OVS' MAC learning table, when it is in the
'standalone' mode running like a legacy Ethernet bridge.

The switch has an entry to a destination, including the destination MAC
(say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and Age. However,
the switch sometimes does not update the entry, when it receives a packet
from the same destination (still 00:00:00:00:00:01) but from a new incoming
port (say, 2). Does someone know what may cause this issue?

The MAC learning table is supposed to be updated once receiving a packet.
Does OVS do some optimization to process the packets so that the learning
table may not get updated when the packet rate is high?

Thanks!
Cheng
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150303/59cd036a/attachment-0001.html>

From blp at nicira.com  Tue Mar  3 13:03:49 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Mar 2015 13:03:49 -0800
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
Message-ID: <20150303210349.GA19646@nicira.com>

On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
> I have a problem with updating OVS' MAC learning table, when it is in the
> 'standalone' mode running like a legacy Ethernet bridge.
> 
> The switch has an entry to a destination, including the destination MAC
> (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and Age. However,
> the switch sometimes does not update the entry, when it receives a packet
> from the same destination (still 00:00:00:00:00:01) but from a new incoming
> port (say, 2). Does someone know what may cause this issue?
> 
> The MAC learning table is supposed to be updated once receiving a packet.
> Does OVS do some optimization to process the packets so that the learning
> table may not get updated when the packet rate is high?

The optimization that OVS does should only affect cases where a MAC
would otherwise quickly bounce back and forth between a number of
learned ports.

Is there anything unusual in your setup?  Can you reproduce this with
a simple setup?

From cheng at cs.umn.edu  Tue Mar  3 17:38:53 2015
From: cheng at cs.umn.edu (Cheng Jin)
Date: Tue, 3 Mar 2015 19:38:53 -0600
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <20150303210349.GA19646@nicira.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
 <20150303210349.GA19646@nicira.com>
Message-ID: <CAMg13edT0RNz6Y4WLvKUEOAv18m2XhL9YLpxyR9+65mAL=XLAg@mail.gmail.com>

Thank, Ben. Can you please elaborate more about the optimization "should
only affect cases where a MAC
would otherwise quickly bounce back and forth between a number of learned
ports." I reproduced it with a simple setup which has only three switches
forming a triangle (VLAN set up to avoid loop), but the problem still
exists.

Is it possible for me to disable this optimization temporarily? If so, will
the bouncing issue be solved?

Thanks!
Cheng


On Tue, Mar 3, 2015 at 3:03 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
> > I have a problem with updating OVS' MAC learning table, when it is in the
> > 'standalone' mode running like a legacy Ethernet bridge.
> >
> > The switch has an entry to a destination, including the destination MAC
> > (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and Age.
> However,
> > the switch sometimes does not update the entry, when it receives a packet
> > from the same destination (still 00:00:00:00:00:01) but from a new
> incoming
> > port (say, 2). Does someone know what may cause this issue?
> >
> > The MAC learning table is supposed to be updated once receiving a packet.
> > Does OVS do some optimization to process the packets so that the learning
> > table may not get updated when the packet rate is high?
>
> The optimization that OVS does should only affect cases where a MAC
> would otherwise quickly bounce back and forth between a number of
> learned ports.
>
> Is there anything unusual in your setup?  Can you reproduce this with
> a simple setup?
>



-- 
Cheng Jin

Ph.D Candidate
Department of Computer Science and Engineering
University of Minnesota
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150303/79794d80/attachment.html>

From mctiew at yahoo.com  Tue Mar  3 17:45:44 2015
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Wed, 4 Mar 2015 01:45:44 +0000 (UTC)
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
Message-ID: <966504235.2270557.1425433544957.JavaMail.yahoo@mail.yahoo.com>

I posted this to virtualbox forum which I got no response and now I am posting it here as it might be a openvswitch problem instead of virtualbox :-
I have used virtualbox with open vswitch without any problem when I am not using VLAN.

However, when I am using VLAN tagging in one of the open vswitch port, I cannot get it working.

Here is the host ( debian 14.04 64 bit ) :-

for i in 0 1
do
  ovs-vsctl add-br br$i
  ip tuntap add mode tap vnet$i
  ip link set vnet$i up
  ovs-vsctl add-port br$i vnet$i
done

ifconfig br0 192.168.2.2 up
ifconfig br1 192.168.3.1 up

# add a port to switch br0 to have vlan tagging
ip tuntap add mode tap vlan100
ip link set vlan100 up
ovs-vsctl add-port br0 vlan100 tag=100

# optional settings
# set other ports to trunk and untagged
ovs-vsctl set port vnet0 trunks=100
ovs-vsctl set port vnet0 vlan_mode=native-untagged
ovs-vsctl set port br0 trunks=100
ovs-vsctl set port br0 vlan_mode=native-untagged

Then I run two guess OSes ( Guest1 and Guest 2 ) in virtualbox, one I bridged it to the vnet0, another I bridged it to the vlan100 interface. 

On the guest1 which is bridged to vbet0, I configured a vlan 100 using this :-
vconfig add eth0 100
ifconfig eth0.100 192.168.100.1 up

On the guest2 which is bridged to vlan100, I configure the interface using this :-
ifconfig eth0 192.168.100.2 up

I cannot ping from one guest to another. Basically the traffic ping from guest2 is not tagged with VLAN 100. Also tried with and without those optional settings above. It's not making any difference.

I did the same setup using qemu, it's working in qemu.

Other observations:-
I added also a vlan interface on the host, ie On the Host, ie :-
# vconfig add br0 100
# ifconfig br0.100 192.168.100.3 up

The host can ping to both guest OSes, guest 1 and guest 2 and vice versa.
Only guest 1 cannot ping to guest 2 and vice versa.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/54d56891/attachment-0001.html>

From blp at nicira.com  Tue Mar  3 21:55:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Mar 2015 21:55:26 -0800
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <966504235.2270557.1425433544957.JavaMail.yahoo@mail.yahoo.com>
References: <966504235.2270557.1425433544957.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150304055526.GC3625@nicira.com>

On Wed, Mar 04, 2015 at 01:45:44AM +0000, Ming-Ching Tiew wrote:
> I posted this to virtualbox forum which I got no response and now I am posting it here as it might be a openvswitch problem instead of virtualbox :-
> I have used virtualbox with open vswitch without any problem when I am not using VLAN.
> 
> However, when I am using VLAN tagging in one of the open vswitch port, I cannot get it working.
> 
> Here is the host ( debian 14.04 64 bit ) :-
> 
> for i in 0 1
> do
>   ovs-vsctl add-br br$i
>   ip tuntap add mode tap vnet$i
>   ip link set vnet$i up
>   ovs-vsctl add-port br$i vnet$i
> done
> 
> ifconfig br0 192.168.2.2 up
> ifconfig br1 192.168.3.1 up
> 
> # add a port to switch br0 to have vlan tagging
> ip tuntap add mode tap vlan100
> ip link set vlan100 up
> ovs-vsctl add-port br0 vlan100 tag=100
> 
> # optional settings
> # set other ports to trunk and untagged
> ovs-vsctl set port vnet0 trunks=100
> ovs-vsctl set port vnet0 vlan_mode=native-untagged
> ovs-vsctl set port br0 trunks=100
> ovs-vsctl set port br0 vlan_mode=native-untagged

It does not make sense to specify native-untagged mode without
specifying a tag, e.g. I guess you want to add tag=100 in each case.

From blp at nicira.com  Tue Mar  3 21:56:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Mar 2015 21:56:24 -0800
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <20150304055526.GC3625@nicira.com>
References: <966504235.2270557.1425433544957.JavaMail.yahoo@mail.yahoo.com>
 <20150304055526.GC3625@nicira.com>
Message-ID: <20150304055624.GD3625@nicira.com>

On Tue, Mar 03, 2015 at 09:55:26PM -0800, Ben Pfaff wrote:
> On Wed, Mar 04, 2015 at 01:45:44AM +0000, Ming-Ching Tiew wrote:
> > I posted this to virtualbox forum which I got no response and now I am posting it here as it might be a openvswitch problem instead of virtualbox :-
> > I have used virtualbox with open vswitch without any problem when I am not using VLAN.
> > 
> > However, when I am using VLAN tagging in one of the open vswitch port, I cannot get it working.
> > 
> > Here is the host ( debian 14.04 64 bit ) :-
> > 
> > for i in 0 1
> > do
> >   ovs-vsctl add-br br$i
> >   ip tuntap add mode tap vnet$i
> >   ip link set vnet$i up
> >   ovs-vsctl add-port br$i vnet$i
> > done
> > 
> > ifconfig br0 192.168.2.2 up
> > ifconfig br1 192.168.3.1 up
> > 
> > # add a port to switch br0 to have vlan tagging
> > ip tuntap add mode tap vlan100
> > ip link set vlan100 up
> > ovs-vsctl add-port br0 vlan100 tag=100
> > 
> > # optional settings
> > # set other ports to trunk and untagged
> > ovs-vsctl set port vnet0 trunks=100
> > ovs-vsctl set port vnet0 vlan_mode=native-untagged
> > ovs-vsctl set port br0 trunks=100
> > ovs-vsctl set port br0 vlan_mode=native-untagged
> 
> It does not make sense to specify native-untagged mode without
> specifying a tag, e.g. I guess you want to add tag=100 in each case.

Also it looks like later you actually want packets going to port vnet0
at least in the native VLAN to be tagged.  That's native-tagged mode,
not native-untagged mode.

From blp at nicira.com  Tue Mar  3 22:10:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Mar 2015 22:10:41 -0800
Subject: [ovs-discuss] toit (Open vSwitch Integration Testsuite) pushed
 to OPNFV
In-Reply-To: <6A74A01C3512C646A9ED99AFA28AEB9818249344@IRSMSX108.ger.corp.intel.com>
References: <6A74A01C3512C646A9ED99AFA28AEB9818249344@IRSMSX108.ger.corp.intel.com>
Message-ID: <20150304061041.GI3625@nicira.com>

On Wed, Feb 25, 2015 at 03:31:23PM +0000, Finucane, Stephen wrote:
> We've pushed a good chunk of our integration test framework, known as 'toit' (The Open vSwitch Integration Testsuite), to the OPNFV community. You can find the mail with links to the reviews here:
> 
> 	http://lists.opnfv.org/pipermail/opnfv-tech-discuss/2015-February/001244.html

It's pretty fantastic to see work on testing.  Testing tends to be
really thankless work, and therefore it often gets neglected.  I really
appreciate that you're working on it. 

From mctiew at yahoo.com  Tue Mar  3 22:14:39 2015
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Wed, 4 Mar 2015 06:14:39 +0000 (UTC)
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <20150304055624.GD3625@nicira.com>
References: <20150304055624.GD3625@nicira.com>
Message-ID: <13520440.2366798.1425449679683.JavaMail.yahoo@mail.yahoo.com>

Please bear with me as I don't quite  understand the significance of the vlan_mode setting.
In any case, I changed the br0 port and vnet0 port to vlan_mode=native-tagged, still guest 1 is not able to ping guest 2. The ping result is the same as before.

      From: Ben Pfaff <blp at nicira.com>
 To: Ming-Ching Tiew <mctiew at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Wednesday, March 4, 2015 1:56 PM
 Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
   
On Tue, Mar 03, 2015 at 09:55:26PM -0800, Ben Pfaff wrote:


> On Wed, Mar 04, 2015 at 01:45:44AM +0000, Ming-Ching Tiew wrote:
> > I posted this to virtualbox forum which I got no response and now I am posting it here as it might be a openvswitch problem instead of virtualbox :-
> > I have used virtualbox with open vswitch without any problem when I am not using VLAN.
> > 
> > However, when I am using VLAN tagging in one of the open vswitch port, I cannot get it working.
> > 
> > Here is the host ( debian 14.04 64 bit ) :-
> > 
> > for i in 0 1
> > do
> >   ovs-vsctl add-br br$i
> >   ip tuntap add mode tap vnet$i
> >   ip link set vnet$i up
> >   ovs-vsctl add-port br$i vnet$i
> > done
> > 
> > ifconfig br0 192.168.2.2 up
> > ifconfig br1 192.168.3.1 up
> > 
> > # add a port to switch br0 to have vlan tagging
> > ip tuntap add mode tap vlan100
> > ip link set vlan100 up
> > ovs-vsctl add-port br0 vlan100 tag=100
> > 
> > # optional settings
> > # set other ports to trunk and untagged
> > ovs-vsctl set port vnet0 trunks=100
> > ovs-vsctl set port vnet0 vlan_mode=native-untagged
> > ovs-vsctl set port br0 trunks=100
> > ovs-vsctl set port br0 vlan_mode=native-untagged
> 
> It does not make sense to specify native-untagged mode without
> specifying a tag, e.g. I guess you want to add tag=100 in each case.

Also it looks like later you actually want packets going to port vnet0
at least in the native VLAN to be tagged.  That's native-tagged mode,
not native-untagged mode.


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/5a27b95a/attachment.html>

From raorn at raorn.name  Wed Mar  4 02:18:45 2015
From: raorn at raorn.name (Alexey I. Froloff)
Date: Wed, 4 Mar 2015 13:18:45 +0300
Subject: [ovs-discuss] force-reload-kmod breaks IPv6 in a bad way
In-Reply-To: <20150303161006.GC19398@nicira.com>
References: <20150303135847.GA13946@raorn.name>
 <20150303160839.GB19398@nicira.com>
 <20150303161006.GC19398@nicira.com>
Message-ID: <20150304101845.GA30388@raorn.name>

On Tue, Mar 03, 2015 at 08:10:06AM -0800, Ben Pfaff wrote:
> > Thanks for the patch, I applied this to master and branch-2.3.
Thank you!

> The AUTHORS file currently lists your email address as
> raorn at altlinux.org.  Do you want me to update it to raorn at raorn.name?
Yes, please.

-- 
Regards,    --
Sir Raorn.   --- https://plus.google.com/+AlexeyFroloff
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 473 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/63eef8c5/attachment-0001.sig>

From chris at onthe.net.au  Wed Mar  4 06:16:00 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Thu, 5 Mar 2015 01:16:00 +1100
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <20150228014931.GA11906@onthe.net.au>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
 <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
 <CALnjE+pe+0qqzq0citR=KfdrW90yh7wKEuxrq6vzeeoNaR_gdw@mail.gmail.com>
 <CAGNyuhXSSjnUrcqQ46xtSQz0k6NP4cSpReq074=vkZG5LtddAg@mail.gmail.com>
 <20150228014931.GA11906@onthe.net.au>
Message-ID: <20150304141600.GA1048@onthe.net.au>

On Sat, Feb 28, 2015 at 12:49:31PM +1100, Chris Dunlop wrote:
> On Fri, Feb 27, 2015 at 08:30:42PM -0500, Xu (Simon) Chen wrote:
> > On Fri, Feb 27, 2015 at 6:14 PM, Pravin Shelar <pshelar at nicira.com> wrote:
> > > So it looks like vhost is generating shared skb. Can you try same test
> > > on latest upstream kernel?
> > 
> > I don't know whether it's vhost, as for me the VM receiving high volume
> > consistently crashes.
> > 
> > I previously had trouble building OVS datapath module on newer kernels.
> > What is the latest kernel that I should try?
> 
> According to:
> 
> https://github.com/openvswitch/ovs/blob/master/FAQ.md
> 
> ...v3.14 *is* the latest kernel supported by the out-of-tree OVS
> kernel module, given that ovs 2.4.x isn't tagged yet and "git
> log v2.3..master" doesn't reveal anything obviously aimed at
> providing >v3.14 compatibility.
> 
> Can you try with the in-tree OVS module?

Simon, I think your crash will be fixed if you cherry-pick this
openvswitch commit (from master) on top of v2.3.1:

----------------------------------------------------------------------
commit d7ff93d7532717ea9d610a7181f24c773170be80
Author: Andy Zhou <azhou at nicira.com>
Date:   Fri Aug 29 13:20:23 2014 -0700

    datapath: simplify sample action implementation

    The current sample() function implementation is more complicated
    than necessary in handling single user space action optimization
    and skb reference counting. There is no functional changes.

    Signed-off-by: Andy Zhou <azhou at nicira.com>
    Acked-by: Pravin B Shelar <pshelar at nicira.com>
----------------------------------------------------------------------

The commit isn't actually designed to address the problem directly,
however in simplifying sample() it removes a call to skb_get(). The
skb_get() makes the skb shared, which later causes us to hit the BUG().
E.g. your v2.3.1 stack trace shows this call path:

  netdev_frame_hook
  + netdev_port_receive
    | skb is guaranteed not-shared, via:
    |   skb = skb_share_check(skb, GFP_ATOMIC);
    + ovs_vport_receive
      + ovs_dp_process_received_packet
        + ovs_dp_process_packet_with_key
          + ovs_execute_actions
            + do_execute_actions
              | nla_type(a) == OVS_ACTION_ATTR_SAMPLE
              + sample
                | skb is made shared here, via:
                |   sample_skb = skb;
                |   skb_get(skb);
                + do_execute_actions
                  | nla_type(a) == OVS_ACTION_ATTR_USERSPACE
                  + output_userspace
                    + ovs_dp_upcall
                      + queue_userspace_packet
                        + skb_checksum_help
                          + pskb_expand_head
                            | if (skb_shared(skb))
                            |         BUG();        BOOM!!!


I think commit d7ff93d should be added to v2.3.2 (if indeed that's ever produced).

Cheers,

Chris

From blp at nicira.com  Wed Mar  4 08:24:11 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 08:24:11 -0800
Subject: [ovs-discuss] force-reload-kmod breaks IPv6 in a bad way
In-Reply-To: <20150304101845.GA30388@raorn.name>
References: <20150303135847.GA13946@raorn.name>
 <20150303160839.GB19398@nicira.com>
 <20150303161006.GC19398@nicira.com>
 <20150304101845.GA30388@raorn.name>
Message-ID: <20150304162411.GE18294@nicira.com>

On Wed, Mar 04, 2015 at 01:18:45PM +0300, Alexey I. Froloff wrote:
> On Tue, Mar 03, 2015 at 08:10:06AM -0800, Ben Pfaff wrote:
> > > Thanks for the patch, I applied this to master and branch-2.3.
> Thank you!
> 
> > The AUTHORS file currently lists your email address as
> > raorn at altlinux.org.  Do you want me to update it to raorn at raorn.name?
> Yes, please.

Done.

From blp at nicira.com  Wed Mar  4 08:36:14 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 08:36:14 -0800
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <13520440.2366798.1425449679683.JavaMail.yahoo@mail.yahoo.com>
References: <20150304055624.GD3625@nicira.com>
 <13520440.2366798.1425449679683.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150304163614.GH18294@nicira.com>

Did you add a tag?

On Wed, Mar 04, 2015 at 06:14:39AM +0000, Ming-Ching Tiew wrote:
> Please bear with me as I don't quite  understand the significance of the vlan_mode setting.
> In any case, I changed the br0 port and vnet0 port to vlan_mode=native-tagged, still guest 1 is not able to ping guest 2. The ping result is the same as before.
> 
>       From: Ben Pfaff <blp at nicira.com>
>  To: Ming-Ching Tiew <mctiew at yahoo.com> 
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
>  Sent: Wednesday, March 4, 2015 1:56 PM
>  Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
>    
> On Tue, Mar 03, 2015 at 09:55:26PM -0800, Ben Pfaff wrote:
> 
> 
> > On Wed, Mar 04, 2015 at 01:45:44AM +0000, Ming-Ching Tiew wrote:
> > > I posted this to virtualbox forum which I got no response and now I am posting it here as it might be a openvswitch problem instead of virtualbox :-
> > > I have used virtualbox with open vswitch without any problem when I am not using VLAN.
> > > 
> > > However, when I am using VLAN tagging in one of the open vswitch port, I cannot get it working.
> > > 
> > > Here is the host ( debian 14.04 64 bit ) :-
> > > 
> > > for i in 0 1
> > > do
> > >   ovs-vsctl add-br br$i
> > >   ip tuntap add mode tap vnet$i
> > >   ip link set vnet$i up
> > >   ovs-vsctl add-port br$i vnet$i
> > > done
> > > 
> > > ifconfig br0 192.168.2.2 up
> > > ifconfig br1 192.168.3.1 up
> > > 
> > > # add a port to switch br0 to have vlan tagging
> > > ip tuntap add mode tap vlan100
> > > ip link set vlan100 up
> > > ovs-vsctl add-port br0 vlan100 tag=100
> > > 
> > > # optional settings
> > > # set other ports to trunk and untagged
> > > ovs-vsctl set port vnet0 trunks=100
> > > ovs-vsctl set port vnet0 vlan_mode=native-untagged
> > > ovs-vsctl set port br0 trunks=100
> > > ovs-vsctl set port br0 vlan_mode=native-untagged
> > 
> > It does not make sense to specify native-untagged mode without
> > specifying a tag, e.g. I guess you want to add tag=100 in each case.
> 
> Also it looks like later you actually want packets going to port vnet0
> at least in the native VLAN to be tagged.  That's native-tagged mode,
> not native-untagged mode.
> 
> 
>   

From mark.d.gray at intel.com  Wed Mar  4 08:42:36 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Wed, 4 Mar 2015 16:42:36 +0000
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <20150227002121.GC30714@nicira.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>

> 
> On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> > When packets which does not match any rule in ovs, are buffered at the
> > ingress switch, say first n packets are buffered. Switch sends a
> > flow_mod and message and packet_out for the buffered packets,
> > meanwhile if some more packets of the same flow arrive (say n+1 to m),
> > they'll also get buffered (as flow_mod) hasn't arrived yet.
> >
> > Once flow_mod message arrives at the switch then subsequent packets of
> > the flow will be forwarded but packets (n+1 to m) will still be
> > buffered waiting for their packet_outs. This results in reordering of
> packets.
> >
> > Is there a way around this, besides from proactively setting up a flow?
> >
> > Is there a way to match flow_mod to existing buffered packets?
> 
> Reordering can happen.  There isn't a way to avoid it entirely (besides
> proactive flow setup).  It isn't usually a problem, though, because most
> protocols only send one packet before they receive a reply from the
> opposite end.

The only way that I can think to nail up a flow is via dpctl. Is this how you
suggest to do this?

From blp at nicira.com  Wed Mar  4 08:51:05 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 08:51:05 -0800
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
Message-ID: <20150304165105.GK18294@nicira.com>

On Wed, Mar 04, 2015 at 04:42:36PM +0000, Gray, Mark D wrote:
> > 
> > On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> > > When packets which does not match any rule in ovs, are buffered at the
> > > ingress switch, say first n packets are buffered. Switch sends a
> > > flow_mod and message and packet_out for the buffered packets,
> > > meanwhile if some more packets of the same flow arrive (say n+1 to m),
> > > they'll also get buffered (as flow_mod) hasn't arrived yet.
> > >
> > > Once flow_mod message arrives at the switch then subsequent packets of
> > > the flow will be forwarded but packets (n+1 to m) will still be
> > > buffered waiting for their packet_outs. This results in reordering of
> > packets.
> > >
> > > Is there a way around this, besides from proactively setting up a flow?
> > >
> > > Is there a way to match flow_mod to existing buffered packets?
> > 
> > Reordering can happen.  There isn't a way to avoid it entirely (besides
> > proactive flow setup).  It isn't usually a problem, though, because most
> > protocols only send one packet before they receive a reply from the
> > opposite end.
> 
> The only way that I can think to nail up a flow is via dpctl. Is this how you
> suggest to do this?

Can you be more specific about what you want to do?  I can think of a
few possibilities.

From blp at nicira.com  Wed Mar  4 08:53:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 08:53:26 -0800
Subject: [ovs-discuss] How to set the MAC address of bridge local port
In-Reply-To: <CAOTV=VyA5V0NRLXxdstnciuEp=hPczUu18iSnoQ9n1aqQHAXXg@mail.gmail.com>
References: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>
 <20150303174622.GK19398@nicira.com>
 <CAOTV=VwhH7YkY5x-WNftBR7GL2NWSsH=ccWjN+5-+X_p-QgXrw@mail.gmail.com>
 <20150303175410.GL19398@nicira.com>
 <CAOTV=VyA5V0NRLXxdstnciuEp=hPczUu18iSnoQ9n1aqQHAXXg@mail.gmail.com>
Message-ID: <20150304165326.GL18294@nicira.com>

Almost everything there looks weird ;-)  ovs-vswitchd is obviously
trying to set the Ethernet address but initially device br0 doesn't
exist ("No such device or address") and later it can't be changed
("Operation not supported").  Something is wrong on your system but it's
not obvious what.

What does "ifconfig br0" report?

On Tue, Mar 03, 2015 at 01:07:05PM -0500, Krishna Pratap wrote:
> I did put some log statements inside bridge_pick_local_hw_addr function of
> bridge.c . it doesnt appear to set the address it picks from the bridge
> table column other-config. here are some snippet of log statements. when i
> add bridge and when i update the other-config column . anything that looks
> weird?
> 
> 2015-03-03T18:12:17.389Z|00001|vlog|INFO|opened log file
> /usr/local/var/log/openvswitch/ovs-vswitchd.log
> 2015-03-03T18:12:17.389Z|00002|vswitchd|INFO|Successfully installed crash
> handlers for ovs-vswitchd
> 2015-03-03T18:12:17.395Z|00003|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
> connecting...
> 2015-03-03T18:12:17.395Z|00004|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
> connected
> 2015-03-03T18:12:17.395Z|00005|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.1.0
> 2015-03-03T18:12:53.786Z|00006|memory|INFO|20200 kB peak resident set size
> after 36.4 seconds
> 2015-03-03T18:12:53.817Z|00007|netdev_linux|ERR|ioctl(SIOCGIFHWADDR) on br0
> device failed: No such device or address
> 2015-03-03T18:12:53.817Z|00008|bridge|INFO|bridge br0: added interface br0
> on port 65534
> 2015-03-03T18:12:53.817Z|00009|netdev|WARN|failed to set flags for network
> device br0: No such device or address
> 2015-03-03T18:12:53.817Z|00010|netdev_linux|WARN|ioctl(SIOCGIFINDEX) on br0
> device failed: No such device or address
> 2015-03-03T18:12:53.817Z|00011|bridge|ERR|bridge br0: failed to set bridge
> Ethernet address: No such device or address
> 2015-03-03T18:12:53.817Z|00012|bridge|INFO|bridge br0: using datapath ID
> 0000f2e03636694e
> 2015-03-03T18:12:53.817Z|00013|netdev_linux|WARN|br0: removing policing
> failed: No such device
> 2015-03-03T18:12:53.817Z|00014|connmgr|INFO|br0: added service controller
> "punix:/usr/local/var/run/openvswitch/br0.mgmt"
> 2015-03-03T18:13:03.818Z|00015|memory|INFO|peak resident set size grew 162%
> in last 10.0 seconds, from 20200 kB to 52932 kB
> 2015-03-03T18:13:03.818Z|00016|memory|INFO|dispatchers:1 flow_dumpers:1
> handlers:1 ports:1 revalidator keys:1 revalidators:1 rules:4
> 2015-03-03T18:13:12.655Z|00017|netdev_linux|ERR|ioctl(SIOCSIFHWADDR) on br0
> device failed: Operation not supported
> 2015-03-03T18:13:12.655Z|00018|bridge|ERR|bridge br0: failed to set bridge
> Ethernet address: Operation not supported
> 2015-03-03T18:13:12.655Z|00019|bridge|INFO|bridge br0: using datapath ID
> 0000001517a02980
> 2015-03-03T18:13:13.818Z|00020|netdev_linux|ERR|ioctl(SIOCGIFHWADDR) on br0
> device failed: No such device or address
> 
> 
> On Tue, Mar 3, 2015 at 12:54 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > What's in the ovs-vswitchd log?
> >
> > On Tue, Mar 03, 2015 at 12:51:18PM -0500, Krishna Pratap wrote:
> > > I tried bringing the port up. it doesn't change any thing. here is the
> > > output.
> > >
> > >
> > > root at ccpu5:~# ovs-vsctl  set bridge br0
> > > other-config:hwaddr=\"00:15:17:a0:29:80\"
> > > root at ccpu5:~#
> > > root at ccpu5:~#
> > > root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> > > OFPST_PORT_DESC reply (xid=0x2):
> > >  LOCAL(br0): addr:16:0a:05:2e:20:bc
> > >      config:     0
> > >      state:      0
> > >      speed: 0 Mbps now, 0 Mbps max
> > > root at ccpu5:~#
> > > root at ccpu5:~#
> > > root at ccpu5:~#
> > > root at ccpu5:~# ifconfig br0
> > > br0       Link encap:Ethernet  HWaddr 16:0a:05:2e:20:bc
> > >           inet6 addr: fe80::140a:5ff:fe2e:20bc/64 Scope:Link
> > >           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
> > >           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
> > >           TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
> > >           collisions:0 txqueuelen:0
> > >           RX bytes:0 (0.0 B)  TX bytes:468 (468.0 B)
> > >
> > >
> > > On Tue, Mar 3, 2015 at 12:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Tue, Mar 03, 2015 at 11:28:27AM -0500, Krishna Pratap wrote:
> > > > > Is it possible to set the MAC address of the local port of bridge(
> > not
> > > > the
> > > > > address of bridge itself) with a fixed address?
> > > > >
> > > > > I tried couple of ways to do it. one of them mentioned here in this
> > old
> > > > > thread
> > > > > http://openvswitch.org/pipermail/discuss/2011-June/005297.html
> > > > >
> > > > > i tested this one out but it doesn't change the mac address of port
> > br0.
> > > > > here is what I did.
> > > > >
> > > > > root at ccpu:~# ovs-vsctl add-br br0 -- set bridge br0
> > > > > other-config:hwaddr=\"00:15:17:a0:29:80\"
> > > > > root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> > > > > OFPST_PORT_DESC reply (xid=0x2):
> > > > >  LOCAL(br0): addr:ce:09:03:00:00:00
> > > > >      config:     PORT_DOWN
> > > > >      state:      LINK_DOWN
> > > > >      speed: 0 Mbps now, 0 Mbps max
> > > > >
> > > > >
> > > > > As we can see the Mac address doesn't change. it does update the
> > bridge
> > > > > table's other-config column .
> > > >
> > > > I think that should work.
> > > >
> > > > I notice that the port is down.  Does it make any difference to bring
> > it
> > > > up?
> > > >
> > >
> > >
> > >
> > > --
> > > Best Regards,
> > > Krishna Pratap Singh
> >
> 
> 
> 
> -- 
> Best Regards,
> Krishna Pratap Singh

From mark.d.gray at intel.com  Wed Mar  4 08:53:45 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Wed, 4 Mar 2015 16:53:45 +0000
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <20150304165105.GK18294@nicira.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
 <20150304165105.GK18294@nicira.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>

> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Wednesday, March 4, 2015 4:51 PM
> On Wed, Mar 04, 2015 at 04:42:36PM +0000, Gray, Mark D wrote:
> > >
> > > On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> > > > When packets which does not match any rule in ovs, are buffered at
> > > > the ingress switch, say first n packets are buffered. Switch sends
> > > > a flow_mod and message and packet_out for the buffered packets,
> > > > meanwhile if some more packets of the same flow arrive (say n+1 to
> > > > m), they'll also get buffered (as flow_mod) hasn't arrived yet.
> > > >
> > > > Once flow_mod message arrives at the switch then subsequent
> > > > packets of the flow will be forwarded but packets (n+1 to m) will
> > > > still be buffered waiting for their packet_outs. This results in
> > > > reordering of
> > > packets.
> > > >
> > > > Is there a way around this, besides from proactively setting up a flow?
> > > >
> > > > Is there a way to match flow_mod to existing buffered packets?
> > >
> > > Reordering can happen.  There isn't a way to avoid it entirely
> > > (besides proactive flow setup).  It isn't usually a problem, though,
> > > because most protocols only send one packet before they receive a
> > > reply from the opposite end.
> >
> > The only way that I can think to nail up a flow is via dpctl. Is this
> > how you suggest to do this?
> 
> Can you be more specific about what you want to do?  I can think of a few
> possibilities.

I don't know what Swair wants but I would like to be certain to avoid
reordering of packets traversing the vswitch. I suspect the way to do this
is to add a flow into the datapath and make it persistent so that upcalls
are never triggered.

From blp at nicira.com  Wed Mar  4 08:59:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 08:59:20 -0800
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
 <20150304165105.GK18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>
Message-ID: <20150304165920.GM18294@nicira.com>

On Wed, Mar 04, 2015 at 04:53:45PM +0000, Gray, Mark D wrote:
> > From: Ben Pfaff [mailto:blp at nicira.com]
> > Sent: Wednesday, March 4, 2015 4:51 PM
> > On Wed, Mar 04, 2015 at 04:42:36PM +0000, Gray, Mark D wrote:
> > > >
> > > > On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> > > > > When packets which does not match any rule in ovs, are buffered at
> > > > > the ingress switch, say first n packets are buffered. Switch sends
> > > > > a flow_mod and message and packet_out for the buffered packets,
> > > > > meanwhile if some more packets of the same flow arrive (say n+1 to
> > > > > m), they'll also get buffered (as flow_mod) hasn't arrived yet.
> > > > >
> > > > > Once flow_mod message arrives at the switch then subsequent
> > > > > packets of the flow will be forwarded but packets (n+1 to m) will
> > > > > still be buffered waiting for their packet_outs. This results in
> > > > > reordering of
> > > > packets.
> > > > >
> > > > > Is there a way around this, besides from proactively setting up a flow?
> > > > >
> > > > > Is there a way to match flow_mod to existing buffered packets?
> > > >
> > > > Reordering can happen.  There isn't a way to avoid it entirely
> > > > (besides proactive flow setup).  It isn't usually a problem, though,
> > > > because most protocols only send one packet before they receive a
> > > > reply from the opposite end.
> > >
> > > The only way that I can think to nail up a flow is via dpctl. Is this
> > > how you suggest to do this?
> > 
> > Can you be more specific about what you want to do?  I can think of a few
> > possibilities.
> 
> I don't know what Swair wants but I would like to be certain to avoid
> reordering of packets traversing the vswitch. I suspect the way to do this
> is to add a flow into the datapath and make it persistent so that upcalls
> are never triggered.

I don't see how that can solve the problem that he is reporting.  Did
you read his whole scenario?  If we knew how to handle the packet in the
datapath at the beginning of the scenario then we would not be sending
it to the controller.

I doubt that this is a real problem that needs to be solved, because
it's been in the back of my mind since about 2008 as a possible concern
but this is the first time I remember anyone actually voicing it.  Swair
hasn't explained how it actually shows up as a problem in practice.
Swair?

(Also, this particular manifestation of the issue can only occur with
reactive controllers, which don't scale.)

From mark.d.gray at intel.com  Wed Mar  4 09:05:33 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Wed, 4 Mar 2015 17:05:33 +0000
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <20150304165920.GM18294@nicira.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
 <20150304165105.GK18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>
 <20150304165920.GM18294@nicira.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E1CF648@IRSMSX108.ger.corp.intel.com>

> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Wednesday, March 4, 2015 4:59 PM
> 
> On Wed, Mar 04, 2015 at 04:53:45PM +0000, Gray, Mark D wrote:
> > > From: Ben Pfaff [mailto:blp at nicira.com]
> > > Sent: Wednesday, March 4, 2015 4:51 PM On Wed, Mar 04, 2015 at
> > > 04:42:36PM +0000, Gray, Mark D wrote:
> > > > >
> > > > > On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> > > > > > When packets which does not match any rule in ovs, are
> > > > > > buffered at the ingress switch, say first n packets are
> > > > > > buffered. Switch sends a flow_mod and message and packet_out
> > > > > > for the buffered packets, meanwhile if some more packets of
> > > > > > the same flow arrive (say n+1 to m), they'll also get buffered (as
> flow_mod) hasn't arrived yet.
> > > > > >
> > > > > > Once flow_mod message arrives at the switch then subsequent
> > > > > > packets of the flow will be forwarded but packets (n+1 to m)
> > > > > > will still be buffered waiting for their packet_outs. This
> > > > > > results in reordering of
> > > > > packets.
> > > > > >
> > > > > > Is there a way around this, besides from proactively setting up a
> flow?
> > > > > >
> > > > > > Is there a way to match flow_mod to existing buffered packets?
> > > > >
> > > > > Reordering can happen.  There isn't a way to avoid it entirely
> > > > > (besides proactive flow setup).  It isn't usually a problem,
> > > > > though, because most protocols only send one packet before they
> > > > > receive a reply from the opposite end.
> > > >
> > > > The only way that I can think to nail up a flow is via dpctl. Is
> > > > this how you suggest to do this?
> > >
> > > Can you be more specific about what you want to do?  I can think of
> > > a few possibilities.
> >
> > I don't know what Swair wants but I would like to be certain to avoid
> > reordering of packets traversing the vswitch. I suspect the way to do
> > this is to add a flow into the datapath and make it persistent so that
> > upcalls are never triggered.
> 
> I don't see how that can solve the problem that he is reporting.  Did you read
> his whole scenario?  If we knew how to handle the packet in the datapath at
> the beginning of the scenario then we would not be sending it to the
> controller.

I see the confusion, he is referring to using a controller and it not matching the
switch, I am thinking of missing the datapath. My bad ..
> 
> I doubt that this is a real problem that needs to be solved, because it's been
> in the back of my mind since about 2008 as a possible concern but this is the

It has been a concern of mine for a while and I also expected it to come
up at some stage but it never did. I don't think it is an issue in most cloud
deployments but could see it be an issue in NFV deployments as usually
there would be an expectation that a router or another network
element wouldn't reorder.

However, hypothetically, how would you resolve this?

> first time I remember anyone actually voicing it.  Swair hasn't explained how
> it actually shows up as a problem in practice.
> Swair?
> 
> (Also, this particular manifestation of the issue can only occur with reactive
> controllers, which don't scale.)

From cheng at cs.umn.edu  Wed Mar  4 09:10:49 2015
From: cheng at cs.umn.edu (Cheng Jin)
Date: Wed, 4 Mar 2015 11:10:49 -0600
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <20150303210349.GA19646@nicira.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
 <20150303210349.GA19646@nicira.com>
Message-ID: <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>

On Tue, Mar 3, 2015 at 3:03 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
> > I have a problem with updating OVS' MAC learning table, when it is in the
> > 'standalone' mode running like a legacy Ethernet bridge.
> >
> > The switch has an entry to a destination, including the destination MAC
> > (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and Age.
> However,
> > the switch sometimes does not update the entry, when it receives a packet
> > from the same destination (still 00:00:00:00:00:01) but from a new
> incoming
> > port (say, 2). Does someone know what may cause this issue?
> >
> > The MAC learning table is supposed to be updated once receiving a packet.
> > Does OVS do some optimization to process the packets so that the learning
> > table may not get updated when the packet rate is high?
>
> The optimization that OVS does should only affect cases where a MAC
> would otherwise quickly bounce back and forth between a number of
> learned ports.
>
> Is there anything unusual in your setup?  Can you reproduce this with
> a simple setup?
>

We tried a simple setup which has only three switches forming a triangle
(VLAN set up to avoid loop), and two hosts connect with two "standalone"
switches.

The MAC learning table is allowed to stabilize (we send no traffic) and
then we send a packet from a source MAC that already exists in the MAC
table but which comes on another port than the one registered in the table.
We are checking how soon does the switch adapt. We don't do back and forth
changes often so the optimization should not happen.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/362cbcc6/attachment.html>

From blp at nicira.com  Wed Mar  4 10:12:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 10:12:13 -0800
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA92E1CF648@IRSMSX108.ger.corp.intel.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
 <20150304165105.GK18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>
 <20150304165920.GM18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF648@IRSMSX108.ger.corp.intel.com>
Message-ID: <20150304181213.GN18294@nicira.com>

On Wed, Mar 04, 2015 at 05:05:33PM +0000, Gray, Mark D wrote:
> > From: Ben Pfaff [mailto:blp at nicira.com]
> > Sent: Wednesday, March 4, 2015 4:59 PM
> > 
> > On Wed, Mar 04, 2015 at 04:53:45PM +0000, Gray, Mark D wrote:
> > > > From: Ben Pfaff [mailto:blp at nicira.com]
> > > > Sent: Wednesday, March 4, 2015 4:51 PM On Wed, Mar 04, 2015 at
> > > > 04:42:36PM +0000, Gray, Mark D wrote:
> > > > > >
> > > > > > On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> > > > > > > When packets which does not match any rule in ovs, are
> > > > > > > buffered at the ingress switch, say first n packets are
> > > > > > > buffered. Switch sends a flow_mod and message and packet_out
> > > > > > > for the buffered packets, meanwhile if some more packets of
> > > > > > > the same flow arrive (say n+1 to m), they'll also get buffered (as
> > flow_mod) hasn't arrived yet.
> > > > > > >
> > > > > > > Once flow_mod message arrives at the switch then subsequent
> > > > > > > packets of the flow will be forwarded but packets (n+1 to m)
> > > > > > > will still be buffered waiting for their packet_outs. This
> > > > > > > results in reordering of
> > > > > > packets.
> > > > > > >
> > > > > > > Is there a way around this, besides from proactively setting up a
> > flow?
> > > > > > >
> > > > > > > Is there a way to match flow_mod to existing buffered packets?
> > > > > >
> > > > > > Reordering can happen.  There isn't a way to avoid it entirely
> > > > > > (besides proactive flow setup).  It isn't usually a problem,
> > > > > > though, because most protocols only send one packet before they
> > > > > > receive a reply from the opposite end.
> > > > >
> > > > > The only way that I can think to nail up a flow is via dpctl. Is
> > > > > this how you suggest to do this?
> > > >
> > > > Can you be more specific about what you want to do?  I can think of
> > > > a few possibilities.
> > >
> > > I don't know what Swair wants but I would like to be certain to avoid
> > > reordering of packets traversing the vswitch. I suspect the way to do
> > > this is to add a flow into the datapath and make it persistent so that
> > > upcalls are never triggered.
> > 
> > I don't see how that can solve the problem that he is reporting.  Did you read
> > his whole scenario?  If we knew how to handle the packet in the datapath at
> > the beginning of the scenario then we would not be sending it to the
> > controller.
> 
> I see the confusion, he is referring to using a controller and it not matching the
> switch, I am thinking of missing the datapath. My bad ..
> > 
> > I doubt that this is a real problem that needs to be solved, because it's been
> > in the back of my mind since about 2008 as a possible concern but this is the
> 
> It has been a concern of mine for a while and I also expected it to come
> up at some stage but it never did. I don't think it is an issue in most cloud
> deployments but could see it be an issue in NFV deployments as usually
> there would be an expectation that a router or another network
> element wouldn't reorder.
> 
> However, hypothetically, how would you resolve this?

One way would be to send only the first packet in a given microflow to
the controller and buffer the rest.  OpenFlow provides three ways for
controllers to handle packet-ins:

        * The controller can send a flow_mod that says how to handle it
          and all similar packets.  In this case, the switch would treat
          the packet and then all the buffered packets in order in the
          way the controller requested, then set up a datapath flow.

        * The controller can send a packet_out that says how to handle
          just that single packet.  In this case, the switch would
          handle the packet in the specified way, then send the next
          buffered packet to the controller.  (This is not ideal, I
          guess, because it inserts at least a RTT delay between each
          packet to the controller.)

        * The controller never says what to do with the packet and the
          switch expires it from its buffers a few seconds later.  I
          guess at that point the switch might as well just drop the
          other buffered packets since they're seconds old at that point
          and may even have already been retransmitted.

From singh.pratapkrishna at gmail.com  Wed Mar  4 10:34:07 2015
From: singh.pratapkrishna at gmail.com (Krishna Pratap)
Date: Wed, 4 Mar 2015 13:34:07 -0500
Subject: [ovs-discuss] How to set the MAC address of bridge local port
In-Reply-To: <20150304165326.GL18294@nicira.com>
References: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>
 <20150303174622.GK19398@nicira.com>
 <CAOTV=VwhH7YkY5x-WNftBR7GL2NWSsH=ccWjN+5-+X_p-QgXrw@mail.gmail.com>
 <20150303175410.GL19398@nicira.com>
 <CAOTV=VyA5V0NRLXxdstnciuEp=hPczUu18iSnoQ9n1aqQHAXXg@mail.gmail.com>
 <20150304165326.GL18294@nicira.com>
Message-ID: <CAOTV=VzsNtjqjoQYXXWNFm10y8dj7=QNLuQDArTqsD+ZN++M+g@mail.gmail.com>

Im not sure what is wrong with ovs installed with my system yet. its weird
it would complain of non existence of bridge when we try to set its MAC
address because I explicitly create the bridge first. what about the "set
interface br0  mac=\"00:15:17:a0:29:80\"" command. isnt br0 local interface
treated as interface?


 here are the steps that I do and its output. any suggestions?


root at ccpu3:~# ovs-vsctl add-br br0
root at ccpu3:~#
root at ccpu3:~# ifconfig br0
br0       Link encap:Ethernet  HWaddr 8e:26:a8:b9:ab:4b
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

root at ccpu3:~#
root at ccpu3:~#
root at ccpu3:~# ifconfig br0 up
root at ccpu3:~#
root at ccpu3:~#
root at ccpu3:~# ifconfig br0
br0       Link encap:Ethernet  HWaddr 8e:26:a8:b9:ab:4b
          inet6 addr: fe80::8c26:a8ff:feb9:ab4b/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:328 (328.0 B)

root at ccpu3:~#
root at ccpu3:~#
root at ccpu3:~# ovs-vsctl set bridge br0
other-config:hwaddr=\"00:15:17:a0:29:80\"
root at ccpu3:~#
root at ccpu3:~# ifconfig br0
br0       Link encap:Ethernet  HWaddr 8e:26:a8:b9:ab:4b
          inet6 addr: fe80::8c26:a8ff:feb9:ab4b/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:468 (468.0 B)

root at ccpu3:~#
root at ccpu3:~# ovs-ofctl dump-ports-desc br0
OFPST_PORT_DESC reply (xid=0x2):
 LOCAL(br0): addr:8e:26:a8:b9:ab:4b
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max


On Wed, Mar 4, 2015 at 11:53 AM, Ben Pfaff <blp at nicira.com> wrote:

> Almost everything there looks weird ;-)  ovs-vswitchd is obviously
> trying to set the Ethernet address but initially device br0 doesn't
> exist ("No such device or address") and later it can't be changed
> ("Operation not supported").  Something is wrong on your system but it's
> not obvious what.
>
> What does "ifconfig br0" report?
>
> On Tue, Mar 03, 2015 at 01:07:05PM -0500, Krishna Pratap wrote:
> > I did put some log statements inside bridge_pick_local_hw_addr function
> of
> > bridge.c . it doesnt appear to set the address it picks from the bridge
> > table column other-config. here are some snippet of log statements. when
> i
> > add bridge and when i update the other-config column . anything that
> looks
> > weird?
> >
> > 2015-03-03T18:12:17.389Z|00001|vlog|INFO|opened log file
> > /usr/local/var/log/openvswitch/ovs-vswitchd.log
> > 2015-03-03T18:12:17.389Z|00002|vswitchd|INFO|Successfully installed crash
> > handlers for ovs-vswitchd
> >
> 2015-03-03T18:12:17.395Z|00003|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
> > connecting...
> >
> 2015-03-03T18:12:17.395Z|00004|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock:
> > connected
> > 2015-03-03T18:12:17.395Z|00005|bridge|INFO|ovs-vswitchd (Open vSwitch)
> 2.1.0
> > 2015-03-03T18:12:53.786Z|00006|memory|INFO|20200 kB peak resident set
> size
> > after 36.4 seconds
> > 2015-03-03T18:12:53.817Z|00007|netdev_linux|ERR|ioctl(SIOCGIFHWADDR) on
> br0
> > device failed: No such device or address
> > 2015-03-03T18:12:53.817Z|00008|bridge|INFO|bridge br0: added interface
> br0
> > on port 65534
> > 2015-03-03T18:12:53.817Z|00009|netdev|WARN|failed to set flags for
> network
> > device br0: No such device or address
> > 2015-03-03T18:12:53.817Z|00010|netdev_linux|WARN|ioctl(SIOCGIFINDEX) on
> br0
> > device failed: No such device or address
> > 2015-03-03T18:12:53.817Z|00011|bridge|ERR|bridge br0: failed to set
> bridge
> > Ethernet address: No such device or address
> > 2015-03-03T18:12:53.817Z|00012|bridge|INFO|bridge br0: using datapath ID
> > 0000f2e03636694e
> > 2015-03-03T18:12:53.817Z|00013|netdev_linux|WARN|br0: removing policing
> > failed: No such device
> > 2015-03-03T18:12:53.817Z|00014|connmgr|INFO|br0: added service controller
> > "punix:/usr/local/var/run/openvswitch/br0.mgmt"
> > 2015-03-03T18:13:03.818Z|00015|memory|INFO|peak resident set size grew
> 162%
> > in last 10.0 seconds, from 20200 kB to 52932 kB
> > 2015-03-03T18:13:03.818Z|00016|memory|INFO|dispatchers:1 flow_dumpers:1
> > handlers:1 ports:1 revalidator keys:1 revalidators:1 rules:4
> > 2015-03-03T18:13:12.655Z|00017|netdev_linux|ERR|ioctl(SIOCSIFHWADDR) on
> br0
> > device failed: Operation not supported
> > 2015-03-03T18:13:12.655Z|00018|bridge|ERR|bridge br0: failed to set
> bridge
> > Ethernet address: Operation not supported
> > 2015-03-03T18:13:12.655Z|00019|bridge|INFO|bridge br0: using datapath ID
> > 0000001517a02980
> > 2015-03-03T18:13:13.818Z|00020|netdev_linux|ERR|ioctl(SIOCGIFHWADDR) on
> br0
> > device failed: No such device or address
> >
> >
> > On Tue, Mar 3, 2015 at 12:54 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > What's in the ovs-vswitchd log?
> > >
> > > On Tue, Mar 03, 2015 at 12:51:18PM -0500, Krishna Pratap wrote:
> > > > I tried bringing the port up. it doesn't change any thing. here is
> the
> > > > output.
> > > >
> > > >
> > > > root at ccpu5:~# ovs-vsctl  set bridge br0
> > > > other-config:hwaddr=\"00:15:17:a0:29:80\"
> > > > root at ccpu5:~#
> > > > root at ccpu5:~#
> > > > root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> > > > OFPST_PORT_DESC reply (xid=0x2):
> > > >  LOCAL(br0): addr:16:0a:05:2e:20:bc
> > > >      config:     0
> > > >      state:      0
> > > >      speed: 0 Mbps now, 0 Mbps max
> > > > root at ccpu5:~#
> > > > root at ccpu5:~#
> > > > root at ccpu5:~#
> > > > root at ccpu5:~# ifconfig br0
> > > > br0       Link encap:Ethernet  HWaddr 16:0a:05:2e:20:bc
> > > >           inet6 addr: fe80::140a:5ff:fe2e:20bc/64 Scope:Link
> > > >           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
> > > >           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
> > > >           TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
> > > >           collisions:0 txqueuelen:0
> > > >           RX bytes:0 (0.0 B)  TX bytes:468 (468.0 B)
> > > >
> > > >
> > > > On Tue, Mar 3, 2015 at 12:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > On Tue, Mar 03, 2015 at 11:28:27AM -0500, Krishna Pratap wrote:
> > > > > > Is it possible to set the MAC address of the local port of
> bridge(
> > > not
> > > > > the
> > > > > > address of bridge itself) with a fixed address?
> > > > > >
> > > > > > I tried couple of ways to do it. one of them mentioned here in
> this
> > > old
> > > > > > thread
> > > > > > http://openvswitch.org/pipermail/discuss/2011-June/005297.html
> > > > > >
> > > > > > i tested this one out but it doesn't change the mac address of
> port
> > > br0.
> > > > > > here is what I did.
> > > > > >
> > > > > > root at ccpu:~# ovs-vsctl add-br br0 -- set bridge br0
> > > > > > other-config:hwaddr=\"00:15:17:a0:29:80\"
> > > > > > root at ccpu5:~# ovs-ofctl dump-ports-desc br0
> > > > > > OFPST_PORT_DESC reply (xid=0x2):
> > > > > >  LOCAL(br0): addr:ce:09:03:00:00:00
> > > > > >      config:     PORT_DOWN
> > > > > >      state:      LINK_DOWN
> > > > > >      speed: 0 Mbps now, 0 Mbps max
> > > > > >
> > > > > >
> > > > > > As we can see the Mac address doesn't change. it does update the
> > > bridge
> > > > > > table's other-config column .
> > > > >
> > > > > I think that should work.
> > > > >
> > > > > I notice that the port is down.  Does it make any difference to
> bring
> > > it
> > > > > up?
> > > > >
> > > >
> > > >
> > > >
> > > > --
> > > > Best Regards,
> > > > Krishna Pratap Singh
> > >
> >
> >
> >
> > --
> > Best Regards,
> > Krishna Pratap Singh
>



-- 
Best Regards,
Krishna Pratap Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/3d328cdc/attachment-0001.html>

From mark.d.gray at intel.com  Wed Mar  4 11:08:03 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Wed, 4 Mar 2015 19:08:03 +0000
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <20150304181213.GN18294@nicira.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
 <20150304165105.GK18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>
 <20150304165920.GM18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF648@IRSMSX108.ger.corp.intel.com>
 <20150304181213.GN18294@nicira.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E1CF8F5@IRSMSX108.ger.corp.intel.com>

> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Wednesday, March 4, 2015 6:12 PM
> On Wed, Mar 04, 2015 at 05:05:33PM +0000, Gray, Mark D wrote:
> > > From: Ben Pfaff [mailto:blp at nicira.com]
> > > Sent: Wednesday, March 4, 2015 4:59 PM
> > >
> > > On Wed, Mar 04, 2015 at 04:53:45PM +0000, Gray, Mark D wrote:
> > > > > From: Ben Pfaff [mailto:blp at nicira.com]
> > > > > Sent: Wednesday, March 4, 2015 4:51 PM On Wed, Mar 04, 2015 at
> > > > > 04:42:36PM +0000, Gray, Mark D wrote:
> > > > > > >
> > > > > > > On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> > > > > > > > When packets which does not match any rule in ovs, are
> > > > > > > > buffered at the ingress switch, say first n packets are
> > > > > > > > buffered. Switch sends a flow_mod and message and
> > > > > > > > packet_out for the buffered packets, meanwhile if some
> > > > > > > > more packets of the same flow arrive (say n+1 to m),
> > > > > > > > they'll also get buffered (as
> > > flow_mod) hasn't arrived yet.
> > > > > > > >
> > > > > > > > Once flow_mod message arrives at the switch then
> > > > > > > > subsequent packets of the flow will be forwarded but
> > > > > > > > packets (n+1 to m) will still be buffered waiting for
> > > > > > > > their packet_outs. This results in reordering of
> > > > > > > packets.
> > > > > > > >
> > > > > > > > Is there a way around this, besides from proactively
> > > > > > > > setting up a
> > > flow?
> > > > > > > >
> > > > > > > > Is there a way to match flow_mod to existing buffered packets?
> > > > > > >
> > > > > > > Reordering can happen.  There isn't a way to avoid it
> > > > > > > entirely (besides proactive flow setup).  It isn't usually a
> > > > > > > problem, though, because most protocols only send one packet
> > > > > > > before they receive a reply from the opposite end.
> > > > > >
> > > > > > The only way that I can think to nail up a flow is via dpctl.
> > > > > > Is this how you suggest to do this?
> > > > >
> > > > > Can you be more specific about what you want to do?  I can think
> > > > > of a few possibilities.
> > > >
> > > > I don't know what Swair wants but I would like to be certain to
> > > > avoid reordering of packets traversing the vswitch. I suspect the
> > > > way to do this is to add a flow into the datapath and make it
> > > > persistent so that upcalls are never triggered.
> > >
> > > I don't see how that can solve the problem that he is reporting.
> > > Did you read his whole scenario?  If we knew how to handle the
> > > packet in the datapath at the beginning of the scenario then we
> > > would not be sending it to the controller.
> >
> > I see the confusion, he is referring to using a controller and it not
> > matching the switch, I am thinking of missing the datapath. My bad ..
> > >
> > > I doubt that this is a real problem that needs to be solved, because
> > > it's been in the back of my mind since about 2008 as a possible
> > > concern but this is the
> >
> > It has been a concern of mine for a while and I also expected it to
> > come up at some stage but it never did. I don't think it is an issue
> > in most cloud deployments but could see it be an issue in NFV
> > deployments as usually there would be an expectation that a router or
> > another network element wouldn't reorder.
> >
> > However, hypothetically, how would you resolve this?
> 
> One way would be to send only the first packet in a given microflow to the
> controller and buffer the rest.  OpenFlow provides three ways for controllers
> to handle packet-ins:

I was talking about the similar problem across the dpif interface. 

* Packet group A arrives at NIC and get sent to ofproto as an upcall. 

* Upcall processes some packets from A and calls operate() from dpif.
operate() will execute ops, a FLOW_PUT followed by EXECUTEs.
However, some packets may not have been executed are still
buffered in the vswitchd.
* At this point, packet group B arrives at the NIC but matches on the fast path
as the flow has already been "put" and are sent directly without having an 
upcall. 

The remaining packets from group A that are buffered in the
vswitchd will arrive out of order. How could we resolve this?

> 
>         * The controller can send a flow_mod that says how to handle it
>           and all similar packets.  In this case, the switch would treat
>           the packet and then all the buffered packets in order in the
>           way the controller requested, then set up a datapath flow.
> 
>         * The controller can send a packet_out that says how to handle
>           just that single packet.  In this case, the switch would
>           handle the packet in the specified way, then send the next
>           buffered packet to the controller.  (This is not ideal, I
>           guess, because it inserts at least a RTT delay between each
>           packet to the controller.)
> 
>         * The controller never says what to do with the packet and the
>           switch expires it from its buffers a few seconds later.  I
>           guess at that point the switch might as well just drop the
>           other buffered packets since they're seconds old at that point
>           and may even have already been retransmitted.

From pshelar at nicira.com  Wed Mar  4 12:46:40 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Wed, 4 Mar 2015 12:46:40 -0800
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <20150304141600.GA1048@onthe.net.au>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
 <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
 <CALnjE+pe+0qqzq0citR=KfdrW90yh7wKEuxrq6vzeeoNaR_gdw@mail.gmail.com>
 <CAGNyuhXSSjnUrcqQ46xtSQz0k6NP4cSpReq074=vkZG5LtddAg@mail.gmail.com>
 <20150228014931.GA11906@onthe.net.au>
 <20150304141600.GA1048@onthe.net.au>
Message-ID: <CALnjE+r138brE7givxbtyi0REP7PV=YpiqZ_+Bfr=RNvNj=HNg@mail.gmail.com>

On Wed, Mar 4, 2015 at 6:16 AM, Chris Dunlop <chris at onthe.net.au> wrote:
> On Sat, Feb 28, 2015 at 12:49:31PM +1100, Chris Dunlop wrote:
>> On Fri, Feb 27, 2015 at 08:30:42PM -0500, Xu (Simon) Chen wrote:
>> > On Fri, Feb 27, 2015 at 6:14 PM, Pravin Shelar <pshelar at nicira.com> wrote:
>> > > So it looks like vhost is generating shared skb. Can you try same test
>> > > on latest upstream kernel?
>> >
>> > I don't know whether it's vhost, as for me the VM receiving high volume
>> > consistently crashes.
>> >
>> > I previously had trouble building OVS datapath module on newer kernels.
>> > What is the latest kernel that I should try?
>>
>> According to:
>>
>> https://github.com/openvswitch/ovs/blob/master/FAQ.md
>>
>> ...v3.14 *is* the latest kernel supported by the out-of-tree OVS
>> kernel module, given that ovs 2.4.x isn't tagged yet and "git
>> log v2.3..master" doesn't reveal anything obviously aimed at
>> providing >v3.14 compatibility.
>>
>> Can you try with the in-tree OVS module?
>
> Simon, I think your crash will be fixed if you cherry-pick this
> openvswitch commit (from master) on top of v2.3.1:
>
> ----------------------------------------------------------------------
> commit d7ff93d7532717ea9d610a7181f24c773170be80
> Author: Andy Zhou <azhou at nicira.com>
> Date:   Fri Aug 29 13:20:23 2014 -0700
>
>     datapath: simplify sample action implementation
>
>     The current sample() function implementation is more complicated
>     than necessary in handling single user space action optimization
>     and skb reference counting. There is no functional changes.
>
>     Signed-off-by: Andy Zhou <azhou at nicira.com>
>     Acked-by: Pravin B Shelar <pshelar at nicira.com>
> ----------------------------------------------------------------------
>
> The commit isn't actually designed to address the problem directly,
> however in simplifying sample() it removes a call to skb_get(). The
> skb_get() makes the skb shared, which later causes us to hit the BUG().
> E.g. your v2.3.1 stack trace shows this call path:
>
>   netdev_frame_hook
>   + netdev_port_receive
>     | skb is guaranteed not-shared, via:
>     |   skb = skb_share_check(skb, GFP_ATOMIC);
>     + ovs_vport_receive
>       + ovs_dp_process_received_packet
>         + ovs_dp_process_packet_with_key
>           + ovs_execute_actions
>             + do_execute_actions
>               | nla_type(a) == OVS_ACTION_ATTR_SAMPLE
>               + sample
>                 | skb is made shared here, via:
>                 |   sample_skb = skb;
>                 |   skb_get(skb);
>                 + do_execute_actions
>                   | nla_type(a) == OVS_ACTION_ATTR_USERSPACE
>                   + output_userspace
>                     + ovs_dp_upcall
>                       + queue_userspace_packet
>                         + skb_checksum_help
>                           + pskb_expand_head
>                             | if (skb_shared(skb))
>                             |         BUG();        BOOM!!!
>
>
> I think commit d7ff93d should be added to v2.3.2 (if indeed that's ever produced).
>

Thanks for investigating the issue. I have backported the patch for branch-2.3.

From blp at nicira.com  Wed Mar  4 14:02:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 14:02:06 -0800
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
 <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
Message-ID: <20150304220206.GE15164@nicira.com>

On Wed, Mar 04, 2015 at 11:10:49AM -0600, Cheng Jin wrote:
> On Tue, Mar 3, 2015 at 3:03 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
> > > I have a problem with updating OVS' MAC learning table, when it is in the
> > > 'standalone' mode running like a legacy Ethernet bridge.
> > >
> > > The switch has an entry to a destination, including the destination MAC
> > > (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and Age.
> > However,
> > > the switch sometimes does not update the entry, when it receives a packet
> > > from the same destination (still 00:00:00:00:00:01) but from a new
> > incoming
> > > port (say, 2). Does someone know what may cause this issue?
> > >
> > > The MAC learning table is supposed to be updated once receiving a packet.
> > > Does OVS do some optimization to process the packets so that the learning
> > > table may not get updated when the packet rate is high?
> >
> > The optimization that OVS does should only affect cases where a MAC
> > would otherwise quickly bounce back and forth between a number of
> > learned ports.
> >
> > Is there anything unusual in your setup?  Can you reproduce this with
> > a simple setup?
> >
> 
> We tried a simple setup which has only three switches forming a triangle
> (VLAN set up to avoid loop), and two hosts connect with two "standalone"
> switches.
> 
> The MAC learning table is allowed to stabilize (we send no traffic) and
> then we send a packet from a source MAC that already exists in the MAC
> table but which comes on another port than the one registered in the table.
> We are checking how soon does the switch adapt. We don't do back and forth
> changes often so the optimization should not happen.

I ran a test just now and could not reproduce the problem.

I connected two VMs, A and B, through OVS running in a third VM C.  In
C, I ran "watch -n.1 ovs-appctl fdb/show br0" to observe changes in
the MAC learning table.  I ran a "ping" for a few seconds and saw that
the MAC learning table was initialized as expected.  Then I killed the
ping and ran "ifconfig eth0 hw ether <address>" in each of the VMs, in
each case using the other VM's MAC address, effectively swapping MAC
addresses.  Then I reran the ping.  The displayed ports for those
MACs immediately flipped.  I ran the experiment a few times.

Then I tried turning up the log level for ofproto_dpif_xlate and
observed the kinds of messages I expected, e.g.:

2015-03-04T22:00:43Z|00002|ofproto_dpif_xlate(handler5)|DBG|bridge br0: learned that 50:54:00:00:00:05 is on port eth0 in VLAN 0
2015-03-04T22:00:43Z|00004|ofproto_dpif_xlate(handler5)|DBG|bridge br0: learned that 50:54:00:01:00:05 is on port eth1 in VLAN 0
2015-03-04T22:00:55Z|00005|ofproto_dpif_xlate(handler5)|DBG|bridge br0: learned that 50:54:00:01:00:05 is on port eth0 in VLAN 0
2015-03-04T22:00:55Z|00006|ofproto_dpif_xlate(handler5)|DBG|bridge br0: learned that 50:54:00:00:00:05 is on port eth1 in VLAN 0

From mctiew at yahoo.com  Wed Mar  4 14:57:22 2015
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Wed, 4 Mar 2015 22:57:22 +0000 (UTC)
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <20150304163614.GH18294@nicira.com>
References: <20150304163614.GH18294@nicira.com>
Message-ID: <288984079.2906985.1425509842900.JavaMail.yahoo@mail.yahoo.com>

Is there a doc for the vlan_mode ?
Actually I am pretty confused with the vlan_mode setting.
In any case, I think what I want to accomplish is to make port br0, vnet0 to perform 'trunking' and port vlan100 to perform tagging for vlan 100.
My benchmark is qemu. I got it working with qemu with either vlan_mode 'native-untagged' or 'native-tagged', while setting vlan_mode=access for vlan100. Setting br0 and vnet0 to vlan_mode=trunk will make the result worse. 
The same working open vswitch configuration is not working with virtualbox. I did some sniffing or tcpdump, I think it's looks like stucked at arp reply. That's why I posted it to virtualbox forum initially.      From: Ben Pfaff <blp at nicira.com>
 To: Ming-Ching Tiew <mctiew at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Thursday, March 5, 2015 12:36 AM
 Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
   
Did you add a tag?



On Wed, Mar 04, 2015 at 06:14:39AM +0000, Ming-Ching Tiew wrote:
> Please bear with me as I don't quite  understand the significance of the vlan_mode setting.
> In any case, I changed the br0 port and vnet0 port to vlan_mode=native-tagged, still guest 1 is not able to ping guest 2. The ping result is the same as before.
> 
>      From: Ben Pfaff <blp at nicira.com>
>  To: Ming-Ching Tiew <mctiew at yahoo.com> 
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
>  Sent: Wednesday, March 4, 2015 1:56 PM
>  Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
>    
> On Tue, Mar 03, 2015 at 09:55:26PM -0800, Ben Pfaff wrote:
> 
> 
> > On Wed, Mar 04, 2015 at 01:45:44AM +0000, Ming-Ching Tiew wrote:
> > > I posted this to virtualbox forum which I got no response and now I am posting it here as it might be a openvswitch problem instead of virtualbox :-
> > > I have used virtualbox with open vswitch without any problem when I am not using VLAN.
> > > 
> > > However, when I am using VLAN tagging in one of the open vswitch port, I cannot get it working.
> > > 
> > > Here is the host ( debian 14.04 64 bit ) :-
> > > 
> > > for i in 0 1
> > > do
> > >   ovs-vsctl add-br br$i
> > >   ip tuntap add mode tap vnet$i
> > >   ip link set vnet$i up
> > >   ovs-vsctl add-port br$i vnet$i
> > > done
> > > 
> > > ifconfig br0 192.168.2.2 up
> > > ifconfig br1 192.168.3.1 up
> > > 
> > > # add a port to switch br0 to have vlan tagging
> > > ip tuntap add mode tap vlan100
> > > ip link set vlan100 up
> > > ovs-vsctl add-port br0 vlan100 tag=100
> > > 
> > > # optional settings
> > > # set other ports to trunk and untagged
> > > ovs-vsctl set port vnet0 trunks=100
> > > ovs-vsctl set port vnet0 vlan_mode=native-untagged
> > > ovs-vsctl set port br0 trunks=100
> > > ovs-vsctl set port br0 vlan_mode=native-untagged
> > 
> > It does not make sense to specify native-untagged mode without
> > specifying a tag, e.g. I guess you want to add tag=100 in each case.
> 
> Also it looks like later you actually want packets going to port vnet0
> at least in the native VLAN to be tagged.  That's native-tagged mode,
> not native-untagged mode.
> 
> 
>  


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/9ac83237/attachment-0001.html>

From blp at nicira.com  Wed Mar  4 16:31:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 16:31:13 -0800
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <288984079.2906985.1425509842900.JavaMail.yahoo@mail.yahoo.com>
References: <20150304163614.GH18294@nicira.com>
 <288984079.2906985.1425509842900.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150305003113.GE12423@nicira.com>

vlan_mode is documented in ovs-vswitchd.conf.db(5).

On Wed, Mar 04, 2015 at 10:57:22PM +0000, Ming-Ching Tiew wrote:
> Is there a doc for the vlan_mode ?
> Actually I am pretty confused with the vlan_mode setting.
> In any case, I think what I want to accomplish is to make port br0, vnet0 to perform 'trunking' and port vlan100 to perform tagging for vlan 100.
> My benchmark is qemu. I got it working with qemu with either vlan_mode 'native-untagged' or 'native-tagged', while setting vlan_mode=access for vlan100. Setting br0 and vnet0 to vlan_mode=trunk will make the result worse.??
> The same working open vswitch configuration is not working with virtualbox. I did some sniffing or tcpdump, I think it's looks like stucked at arp reply. That's why I posted it to virtualbox forum initially.      From: Ben Pfaff <blp at nicira.com>
>  To: Ming-Ching Tiew <mctiew at yahoo.com> 
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
>  Sent: Thursday, March 5, 2015 12:36 AM
>  Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
>    
> Did you add a tag?
> 
> 
> 
> On Wed, Mar 04, 2015 at 06:14:39AM +0000, Ming-Ching Tiew wrote:
> > Please bear with me as I don't quite ??understand the significance of the vlan_mode setting.
> > In any case, I changed the br0 port and vnet0 port to vlan_mode=native-tagged, still guest 1 is not able to ping guest 2. The ping result is the same as before.
> > 
> >?? ?? ?? From: Ben Pfaff <blp at nicira.com>
> >?? To: Ming-Ching Tiew <mctiew at yahoo.com> 
> > Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
> >?? Sent: Wednesday, March 4, 2015 1:56 PM
> >?? Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
> >?? ?? 
> > On Tue, Mar 03, 2015 at 09:55:26PM -0800, Ben Pfaff wrote:
> > 
> > 
> > > On Wed, Mar 04, 2015 at 01:45:44AM +0000, Ming-Ching Tiew wrote:
> > > > I posted this to virtualbox forum which I got no response and now I am posting it here as it might be a openvswitch problem instead of virtualbox :-
> > > > I have used virtualbox with open vswitch without any problem when I am not using VLAN.
> > > > 
> > > > However, when I am using VLAN tagging in one of the open vswitch port, I cannot get it working.
> > > > 
> > > > Here is the host ( debian 14.04 64 bit ) :-
> > > > 
> > > > for i in 0 1
> > > > do
> > > > ?? ovs-vsctl add-br br$i
> > > > ?? ip tuntap add mode tap vnet$i
> > > > ?? ip link set vnet$i up
> > > > ?? ovs-vsctl add-port br$i vnet$i
> > > > done
> > > > 
> > > > ifconfig br0 192.168.2.2 up
> > > > ifconfig br1 192.168.3.1 up
> > > > 
> > > > # add a port to switch br0 to have vlan tagging
> > > > ip tuntap add mode tap vlan100
> > > > ip link set vlan100 up
> > > > ovs-vsctl add-port br0 vlan100 tag=100
> > > > 
> > > > # optional settings
> > > > # set other ports to trunk and untagged
> > > > ovs-vsctl set port vnet0 trunks=100
> > > > ovs-vsctl set port vnet0 vlan_mode=native-untagged
> > > > ovs-vsctl set port br0 trunks=100
> > > > ovs-vsctl set port br0 vlan_mode=native-untagged
> > > 
> > > It does not make sense to specify native-untagged mode without
> > > specifying a tag, e.g. I guess you want to add tag=100 in each case.
> > 
> > Also it looks like later you actually want packets going to port vnet0
> > at least in the native VLAN to be tagged.?? That's native-tagged mode,
> > not native-untagged mode.
> > 
> > 
> >?? 
> 
> 
>   

From mctiew at yahoo.com  Wed Mar  4 17:23:58 2015
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Thu, 5 Mar 2015 01:23:58 +0000 (UTC)
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <20150305003113.GE12423@nicira.com>
References: <20150305003113.GE12423@nicira.com>
Message-ID: <1687908505.3019256.1425518638694.JavaMail.yahoo@mail.yahoo.com>

Thanks for the info !
After reading the doc, I believe my settings should be like this :-
port vnet0: vlan_mode=trunk, and trunk setting should be either empty or a list including vlan id's including 0 and 100 ( I want both the eth0 and eth0.100 to work ).
port br0: same as port vnet0.
port vlan10: vlan_mode should be access, and tag is 100. Trunk should not be set.
So it is still not working in virtualbox but it's working in qemu.
Do you think it's a bug with virtualbox ?
Btw, I could not find a command which list the configured vlan_mode. 'ovs-vsctl show' does not list the vlan_mode.      From: Ben Pfaff <blp at nicira.com>
 To: Ming-Ching Tiew <mctiew at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Thursday, March 5, 2015 8:31 AM
 Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
   
vlan_mode is documented in ovs-vswitchd.conf.db(5).



On Wed, Mar 04, 2015 at 10:57:22PM +0000, Ming-Ching Tiew wrote:
> Is there a doc for the vlan_mode ?
> Actually I am pretty confused with the vlan_mode setting.
> In any case, I think what I want to accomplish is to make port br0, vnet0 to perform 'trunking' and port vlan100 to perform tagging for vlan 100.
> My benchmark is qemu. I got it working with qemu with either vlan_mode 'native-untagged' or 'native-tagged', while setting vlan_mode=access for vlan100. Setting br0 and vnet0 to vlan_mode=trunk will make the result worse.??
> The same working open vswitch configuration is not working with virtualbox. I did some sniffing or tcpdump, I think it's looks like stucked at arp reply. That's why I posted it to virtualbox forum initially.      From: Ben Pfaff <blp at nicira.com>
>  To: Ming-Ching Tiew <mctiew at yahoo.com> 
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
>  Sent: Thursday, March 5, 2015 12:36 AM
>  Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
>    
> Did you add a tag?
> 
> 
> 
> On Wed, Mar 04, 2015 at 06:14:39AM +0000, Ming-Ching Tiew wrote:
> > Please bear with me as I don't quite ??understand the significance of the vlan_mode setting.
> > In any case, I changed the br0 port and vnet0 port to vlan_mode=native-tagged, still guest 1 is not able to ping guest 2. The ping result is the same as before.
> > 
> >?? ?? ?? From: Ben Pfaff <blp at nicira.com>
> >?? To: Ming-Ching Tiew <mctiew at yahoo.com> 
> > Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
> >?? Sent: Wednesday, March 4, 2015 1:56 PM
> >?? Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
> >?? ?? 
> > On Tue, Mar 03, 2015 at 09:55:26PM -0800, Ben Pfaff wrote:
> > 
> > 
> > > On Wed, Mar 04, 2015 at 01:45:44AM +0000, Ming-Ching Tiew wrote:
> > > > I posted this to virtualbox forum which I got no response and now I am posting it here as it might be a openvswitch problem instead of virtualbox :-
> > > > I have used virtualbox with open vswitch without any problem when I am not using VLAN.
> > > > 
> > > > However, when I am using VLAN tagging in one of the open vswitch port, I cannot get it working.
> > > > 
> > > > Here is the host ( debian 14.04 64 bit ) :-
> > > > 
> > > > for i in 0 1
> > > > do
> > > > ?? ovs-vsctl add-br br$i
> > > > ?? ip tuntap add mode tap vnet$i
> > > > ?? ip link set vnet$i up
> > > > ?? ovs-vsctl add-port br$i vnet$i
> > > > done
> > > > 
> > > > ifconfig br0 192.168.2.2 up
> > > > ifconfig br1 192.168.3.1 up
> > > > 
> > > > # add a port to switch br0 to have vlan tagging
> > > > ip tuntap add mode tap vlan100
> > > > ip link set vlan100 up
> > > > ovs-vsctl add-port br0 vlan100 tag=100
> > > > 
> > > > # optional settings
> > > > # set other ports to trunk and untagged
> > > > ovs-vsctl set port vnet0 trunks=100
> > > > ovs-vsctl set port vnet0 vlan_mode=native-untagged
> > > > ovs-vsctl set port br0 trunks=100
> > > > ovs-vsctl set port br0 vlan_mode=native-untagged
> > > 
> > > It does not make sense to specify native-untagged mode without
> > > specifying a tag, e.g. I guess you want to add tag=100 in each case.
> > 
> > Also it looks like later you actually want packets going to port vnet0
> > at least in the native VLAN to be tagged.?? That's native-tagged mode,
> > not native-untagged mode.
> > 
> > 
> >?? 
> 
> 
>  


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/fef1e943/attachment.html>

From jhsiao at redhat.com  Wed Mar  4 19:08:49 2015
From: jhsiao at redhat.com (jhsiao at redhat.com)
Date: Wed, 04 Mar 2015 22:08:49 -0500
Subject: [ovs-discuss] Would like to import Intel's toit test suite
Message-ID: <54F7C8C1.1060203@redhat.com>

Hi Stephen,

Is there a link to your *toit* test suite?

We would like to import it as part of kernel-QE test suite for our OVS 
testing, in particular the kernel data path testing.

Thanks!

Jean
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/a92183e6/attachment-0001.html>

From cheng at cs.umn.edu  Wed Mar  4 21:45:15 2015
From: cheng at cs.umn.edu (Cheng Jin)
Date: Wed, 4 Mar 2015 23:45:15 -0600
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <20150304220206.GE15164@nicira.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
 <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
 <20150304220206.GE15164@nicira.com>
Message-ID: <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>

On Wed, Mar 4, 2015 at 4:02 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Mar 04, 2015 at 11:10:49AM -0600, Cheng Jin wrote:
> > On Tue, Mar 3, 2015 at 3:03 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
> > > > I have a problem with updating OVS' MAC learning table, when it is
> in the
> > > > 'standalone' mode running like a legacy Ethernet bridge.
> > > >
> > > > The switch has an entry to a destination, including the destination
> MAC
> > > > (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and Age.
> > > However,
> > > > the switch sometimes does not update the entry, when it receives a
> packet
> > > > from the same destination (still 00:00:00:00:00:01) but from a new
> > > incoming
> > > > port (say, 2). Does someone know what may cause this issue?
> > > >
> > > > The MAC learning table is supposed to be updated once receiving a
> packet.
> > > > Does OVS do some optimization to process the packets so that the
> learning
> > > > table may not get updated when the packet rate is high?
> > >
> > > The optimization that OVS does should only affect cases where a MAC
> > > would otherwise quickly bounce back and forth between a number of
> > > learned ports.
> > >
> > > Is there anything unusual in your setup?  Can you reproduce this with
> > > a simple setup?
> > >
> >
> > We tried a simple setup which has only three switches forming a triangle
> > (VLAN set up to avoid loop), and two hosts connect with two "standalone"
> > switches.
> >
> > The MAC learning table is allowed to stabilize (we send no traffic) and
> > then we send a packet from a source MAC that already exists in the MAC
> > table but which comes on another port than the one registered in the
> table.
> > We are checking how soon does the switch adapt. We don't do back and
> forth
> > changes often so the optimization should not happen.
>
> I ran a test just now and could not reproduce the problem.
>
> I connected two VMs, A and B, through OVS running in a third VM C.  In
> C, I ran "watch -n.1 ovs-appctl fdb/show br0" to observe changes in
> the MAC learning table.  I ran a "ping" for a few seconds and saw that
> the MAC learning table was initialized as expected.  Then I killed the
> ping and ran "ifconfig eth0 hw ether <address>" in each of the VMs, in
> each case using the other VM's MAC address, effectively swapping MAC
> addresses.  Then I reran the ping.  The displayed ports for those
> MACs immediately flipped.  I ran the experiment a few times.
>
> Then I tried turning up the log level for ofproto_dpif_xlate and
> observed the kinds of messages I expected, e.g.:
>

How to turn up the log level for ofproto_dpif_xlate to observe these
messages?


>
> 2015-03-04T22:00:43Z|00002|ofproto_dpif_xlate(handler5)|DBG|bridge br0:
> learned that 50:54:00:00:00:05 is on port eth0 in VLAN 0
> 2015-03-04T22:00:43Z|00004|ofproto_dpif_xlate(handler5)|DBG|bridge br0:
> learned that 50:54:00:01:00:05 is on port eth1 in VLAN 0
> 2015-03-04T22:00:55Z|00005|ofproto_dpif_xlate(handler5)|DBG|bridge br0:
> learned that 50:54:00:01:00:05 is on port eth0 in VLAN 0
> 2015-03-04T22:00:55Z|00006|ofproto_dpif_xlate(handler5)|DBG|bridge br0:
> learned that 50:54:00:00:00:05 is on port eth1 in VLAN 0
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/e6035cd8/attachment.html>

From blp at nicira.com  Wed Mar  4 21:50:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 21:50:42 -0800
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
 <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
 <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
Message-ID: <20150305055042.GA25472@nicira.com>

On Wed, Mar 04, 2015 at 11:45:15PM -0600, Cheng Jin wrote:
> On Wed, Mar 4, 2015 at 4:02 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Mar 04, 2015 at 11:10:49AM -0600, Cheng Jin wrote:
> > > On Tue, Mar 3, 2015 at 3:03 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
> > > > > I have a problem with updating OVS' MAC learning table, when it is
> > in the
> > > > > 'standalone' mode running like a legacy Ethernet bridge.
> > > > >
> > > > > The switch has an entry to a destination, including the destination
> > MAC
> > > > > (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and Age.
> > > > However,
> > > > > the switch sometimes does not update the entry, when it receives a
> > packet
> > > > > from the same destination (still 00:00:00:00:00:01) but from a new
> > > > incoming
> > > > > port (say, 2). Does someone know what may cause this issue?
> > > > >
> > > > > The MAC learning table is supposed to be updated once receiving a
> > packet.
> > > > > Does OVS do some optimization to process the packets so that the
> > learning
> > > > > table may not get updated when the packet rate is high?
> > > >
> > > > The optimization that OVS does should only affect cases where a MAC
> > > > would otherwise quickly bounce back and forth between a number of
> > > > learned ports.
> > > >
> > > > Is there anything unusual in your setup?  Can you reproduce this with
> > > > a simple setup?
> > > >
> > >
> > > We tried a simple setup which has only three switches forming a triangle
> > > (VLAN set up to avoid loop), and two hosts connect with two "standalone"
> > > switches.
> > >
> > > The MAC learning table is allowed to stabilize (we send no traffic) and
> > > then we send a packet from a source MAC that already exists in the MAC
> > > table but which comes on another port than the one registered in the
> > table.
> > > We are checking how soon does the switch adapt. We don't do back and
> > forth
> > > changes often so the optimization should not happen.
> >
> > I ran a test just now and could not reproduce the problem.
> >
> > I connected two VMs, A and B, through OVS running in a third VM C.  In
> > C, I ran "watch -n.1 ovs-appctl fdb/show br0" to observe changes in
> > the MAC learning table.  I ran a "ping" for a few seconds and saw that
> > the MAC learning table was initialized as expected.  Then I killed the
> > ping and ran "ifconfig eth0 hw ether <address>" in each of the VMs, in
> > each case using the other VM's MAC address, effectively swapping MAC
> > addresses.  Then I reran the ping.  The displayed ports for those
> > MACs immediately flipped.  I ran the experiment a few times.
> >
> > Then I tried turning up the log level for ofproto_dpif_xlate and
> > observed the kinds of messages I expected, e.g.:
> >
> 
> How to turn up the log level for ofproto_dpif_xlate to observe these
> messages?

"ovs-appctl vlog/set ofproto_dpif_xlate" or start vswitchd with
"-vofproto_dpif_xlate".

From blp at nicira.com  Wed Mar  4 22:03:35 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Mar 2015 22:03:35 -0800
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <1687908505.3019256.1425518638694.JavaMail.yahoo@mail.yahoo.com>
References: <20150305003113.GE12423@nicira.com>
 <1687908505.3019256.1425518638694.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150305060335.GC25472@nicira.com>

On Thu, Mar 05, 2015 at 01:23:58AM +0000, Ming-Ching Tiew wrote:
> Thanks for the info !
> After reading the doc, I believe my settings should be like this :-
> port vnet0: vlan_mode=trunk, and trunk setting should be either empty or a list including vlan id's including 0 and 100 ( I want both the eth0 and eth0.100 to work ).
> port br0: same as port vnet0.
> port vlan10: vlan_mode should be access, and tag is 100. Trunk should not be set.
> So it is still not working in virtualbox but it's working in qemu.
> Do you think it's a bug with virtualbox ?

I don't know.  I don't feel confident that we're communicating well, so
I hesitate to blame some other program.

> Btw, I could not find a command which list the configured
> vlan_mode. 'ovs-vsctl show' does not list the vlan_mode.      

"ovs-vsctl list port" will do it.

From jpettit at nicira.com  Wed Mar  4 22:35:06 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 4 Mar 2015 22:35:06 -0800
Subject: [ovs-discuss] Would like to import Intel's toit test suite
In-Reply-To: <54F7C8C1.1060203@redhat.com>
References: <54F7C8C1.1060203@redhat.com>
Message-ID: <D3A883A8-E457-4D2B-A243-E9EE67F3272B@nicira.com>

Is this something that you'd be interested in working on jointly?  We want to start being able to do more public QA of OVS to enable faster release cycles.  Some work has been done to start writing kernel unit tests through vagrant.  Joe is using it, for example, to test conntrack.  We plan to do more of this, and expand it to cover performance and scaling testing for both OVS and OVN.  It would be great if we could avoid duplicating work.

--Justin


> On Mar 4, 2015, at 7:08 PM, jhsiao at redhat.com wrote:
> 
> Hi Stephen,
> 
> Is there a link to your toit test suite?
> 
> We would like to import it as part of kernel-QE test suite for our OVS testing, in particular the kernel data path testing.
> 
> Thanks!
> 
> Jean
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From mctiew at yahoo.com  Thu Mar  5 00:53:43 2015
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Thu, 5 Mar 2015 08:53:43 +0000 (UTC)
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <20150305060335.GC25472@nicira.com>
References: <20150305060335.GC25472@nicira.com>
Message-ID: <756941082.3197708.1425545623162.JavaMail.yahoo@mail.yahoo.com>

I got additional info now.
It's seems there is a corruption of data when packets are read on the guest 1 when reading the vlan-tagged data. I did a tcpdump on guest 1 when guest2 tries to ping to guest 1, one can see that mac address of guest2 ( the initiator of arp request ) is wrong, and it also goes to the wrong destination mac address :-
08:19:28.469448 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3, length 4608:19:29.464121 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3, length 4608:19:30.463983 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3, length 4608:19:31.470218 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3, length 4608:19:32.463634 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3, length 4608:19:33.463215 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3, length 46
The arp requestor's mac address ( guest 2 ) which is supposed to be (08:00:27:cc:3f:33 ) has become 2f:33:81:00:00:64, and the arp requests have sent to ff:ff:08:00:27:cc which is supposed to be ( ff:ff:ff:ff:ff:ff ). 
Furthermore it's supposed to be a ethertype 8021q traffic, but the tcpdump is not seeing it as such ! 
Total corruption !!! No wonder cannot ping.
Earlier I said the the host was able to ping to guest1 via the VLAN 100 but that's about all that it can do. Only ping is successful, other communications failed. When I try to do a ssh session over it from guest 1 to the host, it could not be established. Communication over the untagged data is still successful. 
Looks like I am stepping into a can of worms with regards to the support of VLAN tagged traffic with the use of open vswitch with virtualbox ! ;)


 

     From: Ben Pfaff <blp at nicira.com>
 To: Ming-Ching Tiew <mctiew at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Thursday, March 5, 2015 2:03 PM
 Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
   
On Thu, Mar 05, 2015 at 01:23:58AM +0000, Ming-Ching Tiew wrote:
> Thanks for the info !
> After reading the doc, I believe my settings should be like this :-
> port vnet0: vlan_mode=trunk, and trunk setting should be either empty or a list including vlan id's including 0 and 100 ( I want both the eth0 and eth0.100 to work ).
> port br0: same as port vnet0.
> port vlan10: vlan_mode should be access, and tag is 100. Trunk should not be set.
> So it is still not working in virtualbox but it's working in qemu.
> Do you think it's a bug with virtualbox ?

I don't know.  I don't feel confident that we're communicating well, so
I hesitate to blame some other program.



> Btw, I could not find a command which list the configured
> vlan_mode. 'ovs-vsctl show' does not list the vlan_mode.      

"ovs-vsctl list port" will do it.


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/526adc20/attachment.html>

From nuno.carrulo at ua.pt  Thu Mar  5 04:22:12 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Thu, 5 Mar 2015 12:22:12 +0000
Subject: [ovs-discuss] Queue added but not shown using ovs-ofctl
Message-ID: <1425558128155.62351@ua.pt>

Hello. I'm trying to implement some kind of qos by limiting the rate of a port using queues.


The topology is the following:

h1-eth0<->s1-eth1
s1-eth2<->s2-eth1
s2-eth2<->h2-eth0


s1-eth1 is ofport=1

s1-eth2 is ofport=2

s2-eth1 is ofport=1

s2-eth2 is ofport=2


The links speed is 100mb, I'm using openflow1.0 (also tried 1.3 version) and openvswitch 2.3 (also tried 2.0.2 version).


So far I've created the 2 qos rows, one on port s1-eth2 and other on s2-eth1. On both those ports I've created a queue with id=1 with max rate=20000 and min rate=5000. This was done using this commands :

sudo ovs-vsctl -- set port s1-eth2 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:1=@newQ -- --id=@newQ create queue other-config:min-rate=5000 other-config:max-rate=20000


sudo ovs-vsctl -- set port s2-eth1 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:1=@newQ -- --id=@newQ create queue other-config:min-rate=5000 other-config:max-rate=20000


After that I added 4 flows in order to H1 and H2 communicate through that queues:


sudo ovs-ofctl add-flow s2 priority=50,dl_type=0x0800,nw_src=10.0.0.2,nw_dst=10.0.0.1,actions=enqueue:1:1
sudo ovs-ofctl add-flow s2 priority=50,dl_type=0x0800,nw_src=10.0.0.1,nw_dst=10.0.0.2,actions=output:2
sudo ovs-ofctl add-flow s1 priority=50,dl_type=0x0800,nw_src=10.0.0.1,nw_dst=10.0.0.2,actions=enqueue:2:1
sudo ovs-ofctl add-flow s1 priority=50,dl_type=0x0800,nw_src=10.0.0.2,nw_dst=10.0.0.1,actions=output:1

The hosts can now communicate however by doing iperf the result is around 90mb instead of being around 20mb
Also if after that I run the command ovs-ofctl queue-stats s1 the result is:
OFPST_QUEUE reply (xid=0x2): 0 queues

What is the problem that causes this kind of behaviour? I've added the queues and I can see them on the table Queue as well as I can see the Qos rows on the table Qos.

Help would be much apreciated.

Regards,
Nuno B.







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/dcf33a47/attachment.html>

From djhon9813 at gmail.com  Thu Mar  5 05:18:56 2015
From: djhon9813 at gmail.com (david jhon)
Date: Thu, 5 Mar 2015 18:18:56 +0500
Subject: [ovs-discuss] building openvswitch with user-mode-linux
Message-ID: <CANPUzQ3jdAPmgzg-GUBU=oq9ZijZxSxv8oDjSTtNwEoB-W9C6w@mail.gmail.com>

Hi,

I am using this
<https://www.kernel.org/doc/Documentation/virtual/uml/UserModeLinux-HOWTO.txt>
article to understand debugging a module with user-mode-linux. I am using
ovs-dev.py to setup openvswitch on my machine but it does not seem to work
with ARCH=um as it displays the help message when appending ARCH=um with
conf make command.

Moreover, In UML, I can see openvswitch.ko file in
/lib/modules/3.13.0-24-generic/kernel/net/openvswitch/openvswitch.ko,
/sys/module/openvswitch/sections there but still I can't modprobe any
module as it fails with the following error:

modprobe: ERROR: ../libkmod/libkmod.c:556 kmod_search_moddep() could not
open moddep file '/lib/modules/3.13.0-rc7/modules.dep.bin'

After going through a few more articles, I came to know that I'll have to
write a makefile to load module inside user-mode-linux this way:

obj-m    := hello.o

KDIR    := /lib/modules/$(shell uname -r)/build
PWD    := $(shell pwd)

default:
    $(MAKE) -C $(KDIR) SUBDIRS=$(PWD) modules

After going through many articles and trying different ways I am still
not able to get it work.

Sorry for posting a noob question on the list, I'll be really thankful for any

guideline/recommendation or help in this regard. Thank you!

Kind Regards,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/a57c5239/attachment-0001.html>

From batmanustc at gmail.com  Thu Mar  5 05:23:43 2015
From: batmanustc at gmail.com (yewgang)
Date: Thu, 5 Mar 2015 21:23:43 +0800
Subject: [ovs-discuss] what's wrong with these codes ?
Message-ID: <CAOE=1Z1ok8-9rR-rJyOvMAv1+dXhWMBrxp4G3_mFVdpFoPQd9A@mail.gmail.com>

Dear all,

what's wrong with these codes ?  I really don't know...
my codes is like this :

static void
test_print_tables(struct ovsdb_idl *idl)
{
    /* add for test */
    struct shash_node *node;

    SHASH_FOR_EACH(node, &idl->table_by_name) { // Report warning here
        ......
    }

}

but the compiler report warning :

vswitchd/inventory.c: In function 'test_print_tables':
vswitchd/inventory.c:219:5: error: dereferencing pointer to incomplete type
vswitchd/inventory.c:219:5: error: left-hand operand of comma expression
has no effect [-Werror=unused-value]
vswitchd/inventory.c:219:5: error: dereferencing pointer to incomplete type
vswitchd/inventory.c:219:5: error: left-hand operand of comma expression
has no effect [-Werror=unused-value]
cc1: all warnings being treated as errors
make[2]: *** [vswitchd/inventory.o] Error 1
make[1]: *** [all-recursive] Error 1
make: *** [all] Error 2
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/e907811c/attachment.html>

From blp at nicira.com  Thu Mar  5 08:08:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 08:08:02 -0800
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
	VLAN
In-Reply-To: <756941082.3197708.1425545623162.JavaMail.yahoo@mail.yahoo.com>
References: <20150305060335.GC25472@nicira.com>
 <756941082.3197708.1425545623162.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CACjuMbzq9SaYiS9iDgatF-WOk5nZn04TeYRf9wi1yLR_k6KcTA@mail.gmail.com>

It looks like there's an off-by-four (!) error in the Ethernet packet,
with the Ethernet
addresses being shifted four bytes.  It seems unlikely that this would
be an Open
vSwitch bug, since Open vSwitch works correctly with VLANs on tons of drivers
and environments.  I don't know whether it would be a virtualbox problem or a
problem with the driver on the host or guest kernel side, or even
somewhere else.

On Thu, Mar 5, 2015 at 12:53 AM, Ming-Ching Tiew <mctiew at yahoo.com> wrote:
> I got additional info now.
>
> It's seems there is a corruption of data when packets are read on the guest
> 1 when reading the vlan-tagged data. I did a tcpdump on guest 1 when guest2
> tries to ping to guest 1, one can see that mac address of guest2 ( the
> initiator of arp request ) is wrong, and it also goes to the wrong
> destination mac address :-
>
> 08:19:28.469448 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
> length 46
> 08:19:29.464121 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
> length 46
> 08:19:30.463983 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
> length 46
> 08:19:31.470218 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
> length 46
> 08:19:32.463634 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
> length 46
> 08:19:33.463215 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
> length 46
>
> The arp requestor's mac address ( guest 2 ) which is supposed to be
> (08:00:27:cc:3f:33 ) has become 2f:33:81:00:00:64, and the arp requests have
> sent to ff:ff:08:00:27:cc which is supposed to be ( ff:ff:ff:ff:ff:ff ).
>
> Furthermore it's supposed to be a ethertype 8021q traffic, but the tcpdump
> is not seeing it as such !
>
> Total corruption !!! No wonder cannot ping.
>
> Earlier I said the the host was able to ping to guest1 via the VLAN 100 but
> that's about all that it can do. Only ping is successful, other
> communications failed. When I try to do a ssh session over it from guest 1
> to the host, it could not be established. Communication over the untagged
> data is still successful.
>
> Looks like I am stepping into a can of worms with regards to the support of
> VLAN tagged traffic with the use of open vswitch with virtualbox ! ;)
>
>
>
>
>
> ________________________________
> From: Ben Pfaff <blp at nicira.com>
> To: Ming-Ching Tiew <mctiew at yahoo.com>
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
> Sent: Thursday, March 5, 2015 2:03 PM
> Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with
> VLAN
>
> On Thu, Mar 05, 2015 at 01:23:58AM +0000, Ming-Ching Tiew wrote:
>> Thanks for the info !
>> After reading the doc, I believe my settings should be like this :-
>> port vnet0: vlan_mode=trunk, and trunk setting should be either empty or a
>> list including vlan id's including 0 and 100 ( I want both the eth0 and
>> eth0.100 to work ).
>> port br0: same as port vnet0.
>> port vlan10: vlan_mode should be access, and tag is 100. Trunk should not
>> be set.
>> So it is still not working in virtualbox but it's working in qemu.
>> Do you think it's a bug with virtualbox ?
>
> I don't know.  I don't feel confident that we're communicating well, so
> I hesitate to blame some other program.
>
>
>
>
>> Btw, I could not find a command which list the configured
>> vlan_mode. 'ovs-vsctl show' does not list the vlan_mode.
>
>
> "ovs-vsctl list port" will do it.
>
>
>



-- 
"I don't normally do acked-by's.  I think it's my way of avoiding
getting blamed when it all blows up."               Andrew Morton

From blp at nicira.com  Thu Mar  5 08:32:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 08:32:45 -0800
Subject: [ovs-discuss] Queue added but not shown using ovs-ofctl
In-Reply-To: <1425558128155.62351@ua.pt>
References: <1425558128155.62351@ua.pt>
Message-ID: <20150305163245.GH25472@nicira.com>

On Thu, Mar 05, 2015 at 12:22:12PM +0000, Rui Braz wrote:
> Hello. I'm trying to implement some kind of qos by limiting the rate of a port using queues.
> 
> 
> The topology is the following:
> 
> h1-eth0<->s1-eth1
> s1-eth2<->s2-eth1
> s2-eth2<->h2-eth0
> 
> 
> s1-eth1 is ofport=1
> 
> s1-eth2 is ofport=2
> 
> s2-eth1 is ofport=1
> 
> s2-eth2 is ofport=2
> 
> 
> The links speed is 100mb, I'm using openflow1.0 (also tried 1.3 version) and openvswitch 2.3 (also tried 2.0.2 version).
> 
> 
> So far I've created the 2 qos rows, one on port s1-eth2 and other on s2-eth1. On both those ports I've created a queue with id=1 with max rate=20000 and min rate=5000. This was done using this commands :
> 
> sudo ovs-vsctl -- set port s1-eth2 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:1=@newQ -- --id=@newQ create queue other-config:min-rate=5000 other-config:max-rate=20000
> 
> 
> sudo ovs-vsctl -- set port s2-eth1 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:1=@newQ -- --id=@newQ create queue other-config:min-rate=5000 other-config:max-rate=20000
> 
> 
> After that I added 4 flows in order to H1 and H2 communicate through that queues:
> 
> 
> sudo ovs-ofctl add-flow s2 priority=50,dl_type=0x0800,nw_src=10.0.0.2,nw_dst=10.0.0.1,actions=enqueue:1:1
> sudo ovs-ofctl add-flow s2 priority=50,dl_type=0x0800,nw_src=10.0.0.1,nw_dst=10.0.0.2,actions=output:2
> sudo ovs-ofctl add-flow s1 priority=50,dl_type=0x0800,nw_src=10.0.0.1,nw_dst=10.0.0.2,actions=enqueue:2:1
> sudo ovs-ofctl add-flow s1 priority=50,dl_type=0x0800,nw_src=10.0.0.2,nw_dst=10.0.0.1,actions=output:1
> 
> The hosts can now communicate however by doing iperf the result is around 90mb instead of being around 20mb
> Also if after that I run the command ovs-ofctl queue-stats s1 the result is:
> OFPST_QUEUE reply (xid=0x2): 0 queues
> 
> What is the problem that causes this kind of behaviour? I've added the queues and I can see them on the table Queue as well as I can see the Qos rows on the table Qos.

The first thing to do is to check the ovs-vswitchd log.  Likely, there
was a problem configuring the queues.

From thomasfherbert at gmail.com  Thu Mar  5 08:37:08 2015
From: thomasfherbert at gmail.com (Thomas F Herbert)
Date: Thu, 05 Mar 2015 11:37:08 -0500
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <CACjuMbzq9SaYiS9iDgatF-WOk5nZn04TeYRf9wi1yLR_k6KcTA@mail.gmail.com>
References: <20150305060335.GC25472@nicira.com>
 <756941082.3197708.1425545623162.JavaMail.yahoo@mail.yahoo.com>
 <CACjuMbzq9SaYiS9iDgatF-WOk5nZn04TeYRf9wi1yLR_k6KcTA@mail.gmail.com>
Message-ID: <54F88634.8000407@gmail.com>

On 3/5/15 11:08 AM, Ben Pfaff wrote:
> It looks like there's an off-by-four (!) error in the Ethernet packet,
> with the Ethernet
> addresses being shifted four bytes.  It seems unlikely that this would
> be an Open
> vSwitch bug, since Open vSwitch works correctly with VLANs on tons of drivers
> and environments.  I don't know whether it would be a virtualbox problem or a
> problem with the driver on the host or guest kernel side, or even
> somewhere else.
This probably has nothing to do with Open vSwitch. You may also want to 
check your versions of tcpdump and libpcap. Some older versions don't 
report vlan tags properly on certain kernel versions and certain 
Ethernet IF's. Googling will show quite a bit of discussion about this.
>
> On Thu, Mar 5, 2015 at 12:53 AM, Ming-Ching Tiew <mctiew at yahoo.com> wrote:
>> I got additional info now.
>>
>> It's seems there is a corruption of data when packets are read on the guest
>> 1 when reading the vlan-tagged data. I did a tcpdump on guest 1 when guest2
>> tries to ping to guest 1, one can see that mac address of guest2 ( the
>> initiator of arp request ) is wrong, and it also goes to the wrong
>> destination mac address :-
>>
>> 08:19:28.469448 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:29.464121 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:30.463983 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:31.470218 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:32.463634 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:33.463215 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>>
>> The arp requestor's mac address ( guest 2 ) which is supposed to be
>> (08:00:27:cc:3f:33 ) has become 2f:33:81:00:00:64, and the arp requests have
>> sent to ff:ff:08:00:27:cc which is supposed to be ( ff:ff:ff:ff:ff:ff ).
>>
>> Furthermore it's supposed to be a ethertype 8021q traffic, but the tcpdump
>> is not seeing it as such !
>>
>> Total corruption !!! No wonder cannot ping.
>>
>> Earlier I said the the host was able to ping to guest1 via the VLAN 100 but
>> that's about all that it can do. Only ping is successful, other
>> communications failed. When I try to do a ssh session over it from guest 1
>> to the host, it could not be established. Communication over the untagged
>> data is still successful.
>>
>> Looks like I am stepping into a can of worms with regards to the support of
>> VLAN tagged traffic with the use of open vswitch with virtualbox ! ;)
>>
>>
>>
>>
>>
>> ________________________________
>> From: Ben Pfaff <blp at nicira.com>
>> To: Ming-Ching Tiew <mctiew at yahoo.com>
>> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
>> Sent: Thursday, March 5, 2015 2:03 PM
>> Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with
>> VLAN
>>
>> On Thu, Mar 05, 2015 at 01:23:58AM +0000, Ming-Ching Tiew wrote:
>>> Thanks for the info !
>>> After reading the doc, I believe my settings should be like this :-
>>> port vnet0: vlan_mode=trunk, and trunk setting should be either empty or a
>>> list including vlan id's including 0 and 100 ( I want both the eth0 and
>>> eth0.100 to work ).
>>> port br0: same as port vnet0.
>>> port vlan10: vlan_mode should be access, and tag is 100. Trunk should not
>>> be set.
>>> So it is still not working in virtualbox but it's working in qemu.
>>> Do you think it's a bug with virtualbox ?
>> I don't know.  I don't feel confident that we're communicating well, so
>> I hesitate to blame some other program.
>>
>>
>>
>>
>>> Btw, I could not find a command which list the configured
>>> vlan_mode. 'ovs-vsctl show' does not list the vlan_mode.
>>
>> "ovs-vsctl list port" will do it.
>>
>>
>>
>
>


-- 
Thomas F. Herbert


From blp at nicira.com  Thu Mar  5 08:51:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 08:51:03 -0800
Subject: [ovs-discuss] what's wrong with these codes ?
In-Reply-To: <CAOE=1Z1ok8-9rR-rJyOvMAv1+dXhWMBrxp4G3_mFVdpFoPQd9A@mail.gmail.com>
References: <CAOE=1Z1ok8-9rR-rJyOvMAv1+dXhWMBrxp4G3_mFVdpFoPQd9A@mail.gmail.com>
Message-ID: <20150305165103.GI25472@nicira.com>

Missing #include "shash.h"

On Thu, Mar 05, 2015 at 09:23:43PM +0800, yewgang wrote:
> Dear all,
> 
> what's wrong with these codes ?  I really don't know...
> my codes is like this :
> 
> static void
> test_print_tables(struct ovsdb_idl *idl)
> {
>     /* add for test */
>     struct shash_node *node;
> 
>     SHASH_FOR_EACH(node, &idl->table_by_name) { // Report warning here
>         ......
>     }
> 
> }
> 
> but the compiler report warning :
> 
> vswitchd/inventory.c: In function 'test_print_tables':
> vswitchd/inventory.c:219:5: error: dereferencing pointer to incomplete type
> vswitchd/inventory.c:219:5: error: left-hand operand of comma expression
> has no effect [-Werror=unused-value]
> vswitchd/inventory.c:219:5: error: dereferencing pointer to incomplete type
> vswitchd/inventory.c:219:5: error: left-hand operand of comma expression
> has no effect [-Werror=unused-value]
> cc1: all warnings being treated as errors
> make[2]: *** [vswitchd/inventory.o] Error 1
> make[1]: *** [all-recursive] Error 1
> make: *** [all] Error 2

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Thu Mar  5 08:56:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 08:56:42 -0800
Subject: [ovs-discuss] building openvswitch with user-mode-linux
In-Reply-To: <CANPUzQ3jdAPmgzg-GUBU=oq9ZijZxSxv8oDjSTtNwEoB-W9C6w@mail.gmail.com>
References: <CANPUzQ3jdAPmgzg-GUBU=oq9ZijZxSxv8oDjSTtNwEoB-W9C6w@mail.gmail.com>
Message-ID: <20150305165642.GL25472@nicira.com>

On Thu, Mar 05, 2015 at 06:18:56PM +0500, david jhon wrote:
> I am using this
> <https://www.kernel.org/doc/Documentation/virtual/uml/UserModeLinux-HOWTO.txt>
> article to understand debugging a module with user-mode-linux. I am using
> ovs-dev.py to setup openvswitch on my machine but it does not seem to work
> with ARCH=um as it displays the help message when appending ARCH=um with
> conf make command.

It seems like it would be simpler to just enable building the
openvswitch module in your user mode linux kernel configuration, unless
you know for sure you need some feature only in the out-of-tree module.

From blp at nicira.com  Thu Mar  5 09:10:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 09:10:03 -0800
Subject: [ovs-discuss] How to set the MAC address of bridge local port
In-Reply-To: <CAOTV=VzsNtjqjoQYXXWNFm10y8dj7=QNLuQDArTqsD+ZN++M+g@mail.gmail.com>
References: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>
 <20150303174622.GK19398@nicira.com>
 <CAOTV=VwhH7YkY5x-WNftBR7GL2NWSsH=ccWjN+5-+X_p-QgXrw@mail.gmail.com>
 <20150303175410.GL19398@nicira.com>
 <CAOTV=VyA5V0NRLXxdstnciuEp=hPczUu18iSnoQ9n1aqQHAXXg@mail.gmail.com>
 <20150304165326.GL18294@nicira.com>
 <CAOTV=VzsNtjqjoQYXXWNFm10y8dj7=QNLuQDArTqsD+ZN++M+g@mail.gmail.com>
Message-ID: <20150305171003.GQ25472@nicira.com>

On Wed, Mar 04, 2015 at 01:34:07PM -0500, Krishna Pratap wrote:
> Im not sure what is wrong with ovs installed with my system yet. its weird
> it would complain of non existence of bridge when we try to set its MAC
> address because I explicitly create the bridge first. what about the "set
> interface br0  mac=\"00:15:17:a0:29:80\"" command. isnt br0 local interface
> treated as interface?
> 
> 
>  here are the steps that I do and its output. any suggestions?

I don't know.  I can't reproduce the problem here; similar steps work
for me:

    root at debian:~# ovs-vsctl set bridge br1 other-config:hwaddr=\"00:15:17:a0:29:80\"
    root at debian:~# ifconfig br1
    br1       Link encap:Ethernet  HWaddr 00:15:17:a0:29:80  
              BROADCAST MULTICAST  MTU:1500  Metric:1
              RX packets:0 errors:0 dropped:0 overruns:0 frame:0
              TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
              collisions:0 txqueuelen:0 
              RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

    root at debian:~# ifconfig br1 up
    root at debian:~# ovs-vsctl set bridge br1 other-config:hwaddr=\"00:15:17:a0:29:81\"
    root at debian:~# ifconfig br1
    br1       Link encap:Ethernet  HWaddr 00:15:17:a0:29:81  
              inet6 addr: fe80::215:17ff:fea0:2980/64 Scope:Link
              UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
              RX packets:0 errors:0 dropped:0 overruns:0 frame:0
              TX packets:4 errors:0 dropped:0 overruns:0 carrier:0
              collisions:0 txqueuelen:0 
              RX bytes:0 (0.0 B)  TX bytes:308 (308.0 B)

    root at debian:~# ovs-ofctl dump-ports-desc br1
    OFPST_PORT_DESC reply (xid=0x2):
     LOCAL(br1): addr:00:15:17:a0:29:81
         config:     0
         state:      0
         speed: 0 Mbps now, 0 Mbps max
    root at debian:~# 

From singh.pratapkrishna at gmail.com  Thu Mar  5 11:19:40 2015
From: singh.pratapkrishna at gmail.com (Krishna Pratap)
Date: Thu, 5 Mar 2015 14:19:40 -0500
Subject: [ovs-discuss] How to set the MAC address of bridge local port
In-Reply-To: <20150305171003.GQ25472@nicira.com>
References: <CAOTV=Vw=VbJiqywyN6e3TWzgsi78-OzeOhYj1q-XasnwOKpahg@mail.gmail.com>
 <20150303174622.GK19398@nicira.com>
 <CAOTV=VwhH7YkY5x-WNftBR7GL2NWSsH=ccWjN+5-+X_p-QgXrw@mail.gmail.com>
 <20150303175410.GL19398@nicira.com>
 <CAOTV=VyA5V0NRLXxdstnciuEp=hPczUu18iSnoQ9n1aqQHAXXg@mail.gmail.com>
 <20150304165326.GL18294@nicira.com>
 <CAOTV=VzsNtjqjoQYXXWNFm10y8dj7=QNLuQDArTqsD+ZN++M+g@mail.gmail.com>
 <20150305171003.GQ25472@nicira.com>
Message-ID: <CAOTV=VxGcofhjSicVcKWqwnvBk4YReGRHE_jTFsnsN7d4wa_Jw@mail.gmail.com>

Thanks for checking. I will try to find out more about the ovs installed on
my system.

KP

On Thu, Mar 5, 2015 at 12:10 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Mar 04, 2015 at 01:34:07PM -0500, Krishna Pratap wrote:
> > Im not sure what is wrong with ovs installed with my system yet. its
> weird
> > it would complain of non existence of bridge when we try to set its MAC
> > address because I explicitly create the bridge first. what about the "set
> > interface br0  mac=\"00:15:17:a0:29:80\"" command. isnt br0 local
> interface
> > treated as interface?
> >
> >
> >  here are the steps that I do and its output. any suggestions?
>
> I don't know.  I can't reproduce the problem here; similar steps work
> for me:
>
>     root at debian:~# ovs-vsctl set bridge br1
> other-config:hwaddr=\"00:15:17:a0:29:80\"
>     root at debian:~# ifconfig br1
>     br1       Link encap:Ethernet  HWaddr 00:15:17:a0:29:80
>               BROADCAST MULTICAST  MTU:1500  Metric:1
>               RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>               TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>               collisions:0 txqueuelen:0
>               RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
>
>     root at debian:~# ifconfig br1 up
>     root at debian:~# ovs-vsctl set bridge br1
> other-config:hwaddr=\"00:15:17:a0:29:81\"
>     root at debian:~# ifconfig br1
>     br1       Link encap:Ethernet  HWaddr 00:15:17:a0:29:81
>               inet6 addr: fe80::215:17ff:fea0:2980/64 Scope:Link
>               UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>               RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>               TX packets:4 errors:0 dropped:0 overruns:0 carrier:0
>               collisions:0 txqueuelen:0
>               RX bytes:0 (0.0 B)  TX bytes:308 (308.0 B)
>
>     root at debian:~# ovs-ofctl dump-ports-desc br1
>     OFPST_PORT_DESC reply (xid=0x2):
>      LOCAL(br1): addr:00:15:17:a0:29:81
>          config:     0
>          state:      0
>          speed: 0 Mbps now, 0 Mbps max
>     root at debian:~#
>



-- 
Best Regards,
Krishna Pratap Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/a4edc6c3/attachment.html>

From blp at nicira.com  Thu Mar  5 11:37:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 11:37:43 -0800
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA92E1CF8F5@IRSMSX108.ger.corp.intel.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
 <20150304165105.GK18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>
 <20150304165920.GM18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF648@IRSMSX108.ger.corp.intel.com>
 <20150304181213.GN18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF8F5@IRSMSX108.ger.corp.intel.com>
Message-ID: <20150305193743.GE20780@nicira.com>

On Wed, Mar 04, 2015 at 07:08:03PM +0000, Gray, Mark D wrote:
> > From: Ben Pfaff [mailto:blp at nicira.com]
> > Sent: Wednesday, March 4, 2015 6:12 PM
> > On Wed, Mar 04, 2015 at 05:05:33PM +0000, Gray, Mark D wrote:
> > > > From: Ben Pfaff [mailto:blp at nicira.com]
> > > > Sent: Wednesday, March 4, 2015 4:59 PM
> > > >
> > > > On Wed, Mar 04, 2015 at 04:53:45PM +0000, Gray, Mark D wrote:
> > > > > > From: Ben Pfaff [mailto:blp at nicira.com]
> > > > > > Sent: Wednesday, March 4, 2015 4:51 PM On Wed, Mar 04, 2015 at
> > > > > > 04:42:36PM +0000, Gray, Mark D wrote:
> > > > > > > >
> > > > > > > > On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> > > > > > > > > When packets which does not match any rule in ovs, are
> > > > > > > > > buffered at the ingress switch, say first n packets are
> > > > > > > > > buffered. Switch sends a flow_mod and message and
> > > > > > > > > packet_out for the buffered packets, meanwhile if some
> > > > > > > > > more packets of the same flow arrive (say n+1 to m),
> > > > > > > > > they'll also get buffered (as
> > > > flow_mod) hasn't arrived yet.
> > > > > > > > >
> > > > > > > > > Once flow_mod message arrives at the switch then
> > > > > > > > > subsequent packets of the flow will be forwarded but
> > > > > > > > > packets (n+1 to m) will still be buffered waiting for
> > > > > > > > > their packet_outs. This results in reordering of
> > > > > > > > packets.
> > > > > > > > >
> > > > > > > > > Is there a way around this, besides from proactively
> > > > > > > > > setting up a
> > > > flow?
> > > > > > > > >
> > > > > > > > > Is there a way to match flow_mod to existing buffered packets?
> > > > > > > >
> > > > > > > > Reordering can happen.  There isn't a way to avoid it
> > > > > > > > entirely (besides proactive flow setup).  It isn't usually a
> > > > > > > > problem, though, because most protocols only send one packet
> > > > > > > > before they receive a reply from the opposite end.
> > > > > > >
> > > > > > > The only way that I can think to nail up a flow is via dpctl.
> > > > > > > Is this how you suggest to do this?
> > > > > >
> > > > > > Can you be more specific about what you want to do?  I can think
> > > > > > of a few possibilities.
> > > > >
> > > > > I don't know what Swair wants but I would like to be certain to
> > > > > avoid reordering of packets traversing the vswitch. I suspect the
> > > > > way to do this is to add a flow into the datapath and make it
> > > > > persistent so that upcalls are never triggered.
> > > >
> > > > I don't see how that can solve the problem that he is reporting.
> > > > Did you read his whole scenario?  If we knew how to handle the
> > > > packet in the datapath at the beginning of the scenario then we
> > > > would not be sending it to the controller.
> > >
> > > I see the confusion, he is referring to using a controller and it not
> > > matching the switch, I am thinking of missing the datapath. My bad ..
> > > >
> > > > I doubt that this is a real problem that needs to be solved, because
> > > > it's been in the back of my mind since about 2008 as a possible
> > > > concern but this is the
> > >
> > > It has been a concern of mine for a while and I also expected it to
> > > come up at some stage but it never did. I don't think it is an issue
> > > in most cloud deployments but could see it be an issue in NFV
> > > deployments as usually there would be an expectation that a router or
> > > another network element wouldn't reorder.
> > >
> > > However, hypothetically, how would you resolve this?
> > 
> > One way would be to send only the first packet in a given microflow to the
> > controller and buffer the rest.  OpenFlow provides three ways for controllers
> > to handle packet-ins:
> 
> I was talking about the similar problem across the dpif interface. 
> 
> * Packet group A arrives at NIC and get sent to ofproto as an upcall. 
> 
> * Upcall processes some packets from A and calls operate() from dpif.
> operate() will execute ops, a FLOW_PUT followed by EXECUTEs.
> However, some packets may not have been executed are still
> buffered in the vswitchd.
> * At this point, packet group B arrives at the NIC but matches on the fast path
> as the flow has already been "put" and are sent directly without having an 
> upcall. 
> 
> The remaining packets from group A that are buffered in the
> vswitchd will arrive out of order. How could we resolve this?

I don't have a solution I really like.  The solutions I've thought of
have significant downsides.  I'd love to hear of a good solution.  In
the absence of both a good solution and a situation where there's a
real problem to solve, I don't intend to worry about it.

From sea11167 at mail.ustc.edu.cn  Tue Mar  3 22:54:43 2015
From: sea11167 at mail.ustc.edu.cn (sea11167 at mail.ustc.edu.cn)
Date: Wed, 4 Mar 2015 14:54:43 +0800 (GMT+08:00)
Subject: [ovs-discuss] ovs kernel bug: soft lockup
Message-ID: <2ded7edf.1dcd2.14be390a881.Coremail.sea11167@mail.ustc.edu.cn>

Hi,
In an arp flooding network environment, One server running ovs crushed with soft lockup bug.
Attached is the system log.
ovs version: 2.1.3
Linux kernel version:3.10.0-123.el7.x86_64, Centos7


Thanks,
-Fan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/3d7e34ad/attachment.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: log.txt
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/3d7e34ad/attachment.txt>

From jhsiao at redhat.com  Wed Mar  4 12:03:52 2015
From: jhsiao at redhat.com (jhsiao at redhat.com)
Date: Wed, 04 Mar 2015 15:03:52 -0500
Subject: [ovs-discuss] toit (Open vSwitch Integration Testsuite) pushed
 to OPNFV
In-Reply-To: <6A74A01C3512C646A9ED99AFA28AEB9818249344@IRSMSX108.ger.corp.intel.com>
References: <6A74A01C3512C646A9ED99AFA28AEB9818249344@IRSMSX108.ger.corp.intel.com>
Message-ID: <54F76528.7040601@redhat.com>

Hi All,

Is there a link to the test suite?

We would like to import the test suite for our kernel-QE testing  on OVS 
kernel data path.

Thanks!

Jean

From stacym at sphereonetech.com  Wed Mar  4 13:41:29 2015
From: stacym at sphereonetech.com (Stacy Meszaros)
Date: Wed, 4 Mar 2015 16:41:29 -0500
Subject: [ovs-discuss] How to add support for propietary switch
Message-ID: <001a01d056c3$f9b95ab0$ed2c1010$@sphereonetech.com>

Hello,

 

I have built openvswitch 2.1.2 and can run it on my target Linux platform
(kernel version 2.6.29.6)  My target is a proprietary switch.  I have read
the porting documentation and have several new modules linked into the
source

-          lib/dpif-prop.c  - based on dpif-netdev.c

-          lib/netdev-prop.c   -based on netdev.c

-          lib/netdev-prop.h  -based on netdev.h

Modified makefiles and source files to include new properitary classes

-          lib/dpif.c

-          lib/dpif-provider.h

-          lib/netdev.c

 

The modified code builds and runs on my target switch, I am able to create a
bridge and add ports to it using ovs-vsctl and the new proprietary functions
seem to be called (log messages used to confirm) , I can also add a flow,
using ovs-ofctl.  My problem cones in that I cannot figure out where to add
my 'hooks' into the openvswitch code so that my APIs can be called.  Once I
can figure out where to add calls to my dynamic library, I will be in good
shape.  Can anyone point me in the right direction?

 

Thanks,

Stacy

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150304/d2ecbc0a/attachment-0001.html>

From tobias.brunner at vshn.ch  Thu Mar  5 14:35:55 2015
From: tobias.brunner at vshn.ch (Tobias Brunner)
Date: Thu, 05 Mar 2015 23:35:55 +0100
Subject: [ovs-discuss] IPv6 dadfailed
In-Reply-To: <CAHbON5ryJYHCM0iZ+OmWv_cbj94RT8taZRvTr6P7tQt2yaR=gQ@mail.gmail.com>
References: <2391029.WkG2ybOBvo@waiotapu>
 <CAHbON5ryJYHCM0iZ+OmWv_cbj94RT8taZRvTr6P7tQt2yaR=gQ@mail.gmail.com>
Message-ID: <6497334.rkPPGxo8Mm@krabappel>

Hi,

> I don't use IPv6, so I don't know the specifics, but here are some
> details on how you can debug it.
> 
> * Assuming you have just one VM, on your hypervisor, a 'ovs-vsctl
> show' will show you the name of the virtual interface name (vif). So
> the first thing to do is put a tcpump on that interface to see if any
> traffic is coming through. (If there are many VMs, you will have to
> look at libvirt's xml file to get hints on vif name.)
> 
> * Assuming, you see some traffic on vif, next thing to do is, run
> 'ovs-dpctl -m dump-flows'. This will show all the flows in the kernel.
> If it is a lot of flows, it may be a better idea, to limit OVS use to
> just that one VM, so that you know that all the flows being shown is
> just that VM. If there is no bug, you may see that there is some flow
> which shows as 'drop'. Then you know that there is some problem there.
> 
> * If there is a bug, it is also likely that there is some log message
> in '/var/log/openvswitch/ovs-vswitchd.log' which shows an entry for
> every packet loss.

Thanks a lot for this suggestions. We did some deeper investigation and this 
is what we found out:

After configuring an IPv6 address on the VM guest, the neighbor solicitation 
message is sent out and immediately bounced back to the VM, leading to the 
situation that the kernel thinks there is a duplicate address. This produces 
the log entry "Mar  5 22:54:16 ubuntuutopic kernel: [ 1602.276491] IPv6: eth0: 
IPv6 duplicate address ADDRESS detected!"

The VM host is connected to the network using LACP with two uplinks. The link 
aggregation is configured on the OVS:

---- bond0 ----
bond_mode: balance-tcp
bond may use recirculation: yes, Recirc-ID : 300
bond-hash-basis: 0
updelay: 0 ms
downdelay: 0 ms
next rebalance: 1705 ms
lacp_status: negotiated
active slave mac: 90:e2:ba:7d:99:3d(p258p2)

Running tcpdump on the two physical uplinks shows that the neighbor 
solicitation is sent out on both interfaces (Or maybe sent out on one and 
received on the other, I'm not quite sure...).
Tcpdumping on another VM running on a different VM host shows that it receives 
the neighbor solicitation message two times.

I have a feeling that there *could* be something wrong with how the bonding in 
OVS handles this neighbor solicitation messages.

Are there any ideas from the community on this topic? We're not yet sure if it 
has something to do with OVS, but at the moment we're searching in this 
direction...
Another info: We already checked if maybe "hairpinning" could be the problem 
(f.e. https://bugs.launchpad.net/nova/+bug/1011134), but this seems to be 
specifically a problem of the linux bridge. And we're not using OpenStack at 
all.

Thanks for any input in advance.

Cheers,
Tobias

PS: OVS is now running with version 2.3.1.

-- 
Tobias Brunner
Linux and Network Engineer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 819 bytes
Desc: This is a digitally signed message part.
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/a21aee84/attachment.sig>

From shettyg at nicira.com  Thu Mar  5 15:09:56 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 5 Mar 2015 15:09:56 -0800
Subject: [ovs-discuss] IPv6 dadfailed
In-Reply-To: <6497334.rkPPGxo8Mm@krabappel>
References: <2391029.WkG2ybOBvo@waiotapu>
 <CAHbON5ryJYHCM0iZ+OmWv_cbj94RT8taZRvTr6P7tQt2yaR=gQ@mail.gmail.com>
 <6497334.rkPPGxo8Mm@krabappel>
Message-ID: <CAHbON5o38eT-1amAcXXDh7rK=NaFaktiTe8HV9rtN_wezD3HTw@mail.gmail.com>

> Thanks a lot for this suggestions. We did some deeper investigation and this
> is what we found out:
>
> After configuring an IPv6 address on the VM guest, the neighbor solicitation
> message is sent out and immediately bounced back to the VM, leading to the
> situation that the kernel thinks there is a duplicate address. This produces
> the log entry "Mar  5 22:54:16 ubuntuutopic kernel: [ 1602.276491] IPv6: eth0:
> IPv6 duplicate address ADDRESS detected!"
>
> The VM host is connected to the network using LACP with two uplinks. The link
> aggregation is configured on the OVS:
>
> ---- bond0 ----
> bond_mode: balance-tcp
> bond may use recirculation: yes, Recirc-ID : 300
> bond-hash-basis: 0
> updelay: 0 ms
> downdelay: 0 ms
> next rebalance: 1705 ms
> lacp_status: negotiated
> active slave mac: 90:e2:ba:7d:99:3d(p258p2)
>
> Running tcpdump on the two physical uplinks shows that the neighbor
> solicitation is sent out on both interfaces (Or maybe sent out on one and
> received on the other, I'm not quite sure...).
If it is the later, it makes sense that the sending VM receives it
again. Which means that there is some sort of loop in the upstream
switch.
If it is the former, it looks to be a OVS bug (or some sort of LACP
negotiation issue?)


> Tcpdumping on another VM running on a different VM host shows that it receives
> the neighbor solicitation message two times.
I cannot yet reconcile this with the previous message of the sending
VM receiving the traffic with a hairpin.



>
> I have a feeling that there *could* be something wrong with how the bonding in
> OVS handles this neighbor solicitation messages.
>
> Are there any ideas from the community on this topic? We're not yet sure if it
> has something to do with OVS, but at the moment we're searching in this
> direction...

Are you using OVS tunnels? If so, one idea could be to connect  VM
vifs to a OVS bridge. But use Linux bonding to carry the tunneled
traffic out of the machine. Another option to try out is not to use
LACP bonds but rather something like active-backup (man
ovs-vswitchd.conf.db -> Bonding Configuration)

I have added 2 people familiar with OVS bonding code. They should be
able to discern better.

From pshelar at nicira.com  Thu Mar  5 15:46:34 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Thu, 5 Mar 2015 15:46:34 -0800
Subject: [ovs-discuss] ovs kernel bug: soft lockup
In-Reply-To: <2ded7edf.1dcd2.14be390a881.Coremail.sea11167@mail.ustc.edu.cn>
References: <2ded7edf.1dcd2.14be390a881.Coremail.sea11167@mail.ustc.edu.cn>
Message-ID: <CALnjE+ovK7x1m2QE=7ZXnmp1bGbKzkaAOJu0nNTR8R=CBVQ_OQ@mail.gmail.com>

On Tue, Mar 3, 2015 at 10:54 PM,  <sea11167 at mail.ustc.edu.cn> wrote:
> Hi,
> In an arp flooding network environment, One server running ovs crushed with
> soft lockup bug.
> Attached is the system log.
> ovs version: 2.1.3
> Linux kernel version:3.10.0-123.el7.x86_64, Centos7

Which kernel datapath module are you using? have you compiled from OVS
2.1.3 or using that comes with the kernel?

>
> Thanks,
> -Fan
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From mctiew at yahoo.com  Thu Mar  5 16:01:26 2015
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Fri, 6 Mar 2015 00:01:26 +0000 (UTC)
Subject: [ovs-discuss] Problem using virtualbox with open vswitch with
 VLAN
In-Reply-To: <54F88634.8000407@gmail.com>
References: <54F88634.8000407@gmail.com>
Message-ID: <584646699.3658351.1425600086148.JavaMail.yahoo@mail.yahoo.com>

;)
This is not a tcpdump problem as the same image is used to test open vswitch with qemu vs virtualbox ( with qemu working and virtualbox not working ) and furthermore I recorded the tcpdump file and play it back on host. I am using ubuntu 14.04 it can't be the host is using so old a version of tcpdump.
Most likely interaction is the virtualbox bridging code has not dealt with bridging VLAN tagged traffic correctly. Or even bridging is not the right way to interface open vswitch with virtualbox. Btw, VDE is working properly virtualbox but it is not using bridging method to interface with virtualbox. 
I saw a few post on the net of using openvswitch with virtualbox, but none of them is using it to trunking both tag and untagged VLAN traffic. So I think this is a no man land at this moment. 
      From: Thomas F Herbert <thomasfherbert at gmail.com>
 To: Ben Pfaff <blp at nicira.com>; Ming-Ching Tiew <mctiew at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Friday, March 6, 2015 12:37 AM
 Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with VLAN
   
On 3/5/15 11:08 AM, Ben Pfaff wrote:
> It looks like there's an off-by-four (!) error in the Ethernet packet,
> with the Ethernet
> addresses being shifted four bytes.  It seems unlikely that this would
> be an Open
> vSwitch bug, since Open vSwitch works correctly with VLANs on tons of drivers
> and environments.  I don't know whether it would be a virtualbox problem or a
> problem with the driver on the host or guest kernel side, or even
> somewhere else.
This probably has nothing to do with Open vSwitch. You may also want to 
check your versions of tcpdump and libpcap. Some older versions don't 
report vlan tags properly on certain kernel versions and certain 
Ethernet IF's. Googling will show quite a bit of discussion about this.


>
> On Thu, Mar 5, 2015 at 12:53 AM, Ming-Ching Tiew <mctiew at yahoo.com> wrote:
>> I got additional info now.
>>
>> It's seems there is a corruption of data when packets are read on the guest
>> 1 when reading the vlan-tagged data. I did a tcpdump on guest 1 when guest2
>> tries to ping to guest 1, one can see that mac address of guest2 ( the
>> initiator of arp request ) is wrong, and it also goes to the wrong
>> destination mac address :-
>>
>> 08:19:28.469448 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:29.464121 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:30.463983 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:31.470218 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:32.463634 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>> 08:19:33.463215 2f:33:81:00:00:64 > ff:ff:08:00:27:cc, ethertype ARP
>> (0x0806), length 60: Request who-has 192.168.100.2 tell 192.168.100.3,
>> length 46
>>
>> The arp requestor's mac address ( guest 2 ) which is supposed to be
>> (08:00:27:cc:3f:33 ) has become 2f:33:81:00:00:64, and the arp requests have
>> sent to ff:ff:08:00:27:cc which is supposed to be ( ff:ff:ff:ff:ff:ff ).
>>
>> Furthermore it's supposed to be a ethertype 8021q traffic, but the tcpdump
>> is not seeing it as such !
>>
>> Total corruption !!! No wonder cannot ping.
>>
>> Earlier I said the the host was able to ping to guest1 via the VLAN 100 but
>> that's about all that it can do. Only ping is successful, other
>> communications failed. When I try to do a ssh session over it from guest 1
>> to the host, it could not be established. Communication over the untagged
>> data is still successful.
>>
>> Looks like I am stepping into a can of worms with regards to the support of
>> VLAN tagged traffic with the use of open vswitch with virtualbox ! ;)
>>
>>
>>
>>
>>
>> ________________________________
>> From: Ben Pfaff <blp at nicira.com>
>> To: Ming-Ching Tiew <mctiew at yahoo.com>
>> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
>> Sent: Thursday, March 5, 2015 2:03 PM
>> Subject: Re: [ovs-discuss] Problem using virtualbox with open vswitch with
>> VLAN
>>
>> On Thu, Mar 05, 2015 at 01:23:58AM +0000, Ming-Ching Tiew wrote:
>>> Thanks for the info !
>>> After reading the doc, I believe my settings should be like this :-
>>> port vnet0: vlan_mode=trunk, and trunk setting should be either empty or a
>>> list including vlan id's including 0 and 100 ( I want both the eth0 and
>>> eth0.100 to work ).
>>> port br0: same as port vnet0.
>>> port vlan10: vlan_mode should be access, and tag is 100. Trunk should not
>>> be set.
>>> So it is still not working in virtualbox but it's working in qemu.
>>> Do you think it's a bug with virtualbox ?
>> I don't know.  I don't feel confident that we're communicating well, so
>> I hesitate to blame some other program.
>>
>>
>>
>>
>>> Btw, I could not find a command which list the configured
>>> vlan_mode. 'ovs-vsctl show' does not list the vlan_mode.
>>
>> "ovs-vsctl list port" will do it.
>>
>>
>>
>
>


-- 
Thomas F. Herbert



  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150306/a9f8e36d/attachment-0001.html>

From blp at nicira.com  Thu Mar  5 16:07:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 16:07:17 -0800
Subject: [ovs-discuss] How to add support for propietary switch
In-Reply-To: <001a01d056c3$f9b95ab0$ed2c1010$@sphereonetech.com>
References: <001a01d056c3$f9b95ab0$ed2c1010$@sphereonetech.com>
Message-ID: <20150306000717.GD6499@nicira.com>

On Wed, Mar 04, 2015 at 04:41:29PM -0500, Stacy Meszaros wrote:
> I have built openvswitch 2.1.2 and can run it on my target Linux platform
> (kernel version 2.6.29.6)  My target is a proprietary switch.  I have read
> the porting documentation and have several new modules linked into the
> source
> 
> -          lib/dpif-prop.c  - based on dpif-netdev.c
> 
> -          lib/netdev-prop.c   -based on netdev.c
> 
> -          lib/netdev-prop.h  -based on netdev.h
> 
> Modified makefiles and source files to include new properitary classes
> 
> -          lib/dpif.c
> 
> -          lib/dpif-provider.h
> 
> -          lib/netdev.c
> 
>  
> 
> The modified code builds and runs on my target switch, I am able to create a
> bridge and add ports to it using ovs-vsctl and the new proprietary functions
> seem to be called (log messages used to confirm) , I can also add a flow,
> using ovs-ofctl.  My problem cones in that I cannot figure out where to add
> my 'hooks' into the openvswitch code so that my APIs can be called.  Once I
> can figure out where to add calls to my dynamic library, I will be in good
> shape.  Can anyone point me in the right direction?

The dpif-provider and netdev-provider classes contain all the hooks
you should need.

From batmanustc at gmail.com  Thu Mar  5 17:01:24 2015
From: batmanustc at gmail.com (yewgang)
Date: Fri, 6 Mar 2015 09:01:24 +0800
Subject: [ovs-discuss] what's wrong with these codes ?
In-Reply-To: <20150305165103.GI25472@nicira.com>
References: <CAOE=1Z1ok8-9rR-rJyOvMAv1+dXhWMBrxp4G3_mFVdpFoPQd9A@mail.gmail.com>
 <20150305165103.GI25472@nicira.com>
Message-ID: <CAOE=1Z3ZNiZPf+iDhCs2m8hKHx7fhFWy-NjYtdcWFrjUf0C1MA@mail.gmail.com>

It does not work after adding #include "shash.h" in the .c file. It warns
again.
And if missing #include "shash.h", will the "struct shash_node *node;"
report warning ?

2015-03-06 0:51 GMT+08:00 Ben Pfaff <blp at nicira.com>:

> Missing #include "shash.h"
>
> On Thu, Mar 05, 2015 at 09:23:43PM +0800, yewgang wrote:
> > Dear all,
> >
> > what's wrong with these codes ?  I really don't know...
> > my codes is like this :
> >
> > static void
> > test_print_tables(struct ovsdb_idl *idl)
> > {
> >     /* add for test */
> >     struct shash_node *node;
> >
> >     SHASH_FOR_EACH(node, &idl->table_by_name) { // Report warning here
> >         ......
> >     }
> >
> > }
> >
> > but the compiler report warning :
> >
> > vswitchd/inventory.c: In function 'test_print_tables':
> > vswitchd/inventory.c:219:5: error: dereferencing pointer to incomplete
> type
> > vswitchd/inventory.c:219:5: error: left-hand operand of comma expression
> > has no effect [-Werror=unused-value]
> > vswitchd/inventory.c:219:5: error: dereferencing pointer to incomplete
> type
> > vswitchd/inventory.c:219:5: error: left-hand operand of comma expression
> > has no effect [-Werror=unused-value]
> > cc1: all warnings being treated as errors
> > make[2]: *** [vswitchd/inventory.o] Error 1
> > make[1]: *** [all-recursive] Error 1
> > make: *** [all] Error 2
>
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150306/c4278e48/attachment.html>

From batmanustc at gmail.com  Thu Mar  5 18:18:51 2015
From: batmanustc at gmail.com (yewgang)
Date: Fri, 6 Mar 2015 10:18:51 +0800
Subject: [ovs-discuss] what's wrong with these codes ?
In-Reply-To: <CAOE=1Z3ZNiZPf+iDhCs2m8hKHx7fhFWy-NjYtdcWFrjUf0C1MA@mail.gmail.com>
References: <CAOE=1Z1ok8-9rR-rJyOvMAv1+dXhWMBrxp4G3_mFVdpFoPQd9A@mail.gmail.com>
 <20150305165103.GI25472@nicira.com>
 <CAOE=1Z3ZNiZPf+iDhCs2m8hKHx7fhFWy-NjYtdcWFrjUf0C1MA@mail.gmail.com>
Message-ID: <CAOE=1Z1gRXBHec+JBLxLqdSKeBpGq1_kQb1r4eJVOf-z_h5Yvg@mail.gmail.com>

Thank you for all, I have found root cause:

the "struct ovsdb_idl" is defined in ovsdb-idl.c file, so "idl->table_by_name"
will report warning.
The function I want is to quarry tables in idl at the outside of
ovsdb-idl.c.
I don't know "ovsdb-idl.h" supply this function in API.

2015-03-06 9:01 GMT+08:00 yewgang <batmanustc at gmail.com>:

> It does not work after adding #include "shash.h" in the .c file. It warns
> again.
> And if missing #include "shash.h", will the "struct shash_node *node;"
> report warning ?
>
> 2015-03-06 0:51 GMT+08:00 Ben Pfaff <blp at nicira.com>:
>
>> Missing #include "shash.h"
>>
>> On Thu, Mar 05, 2015 at 09:23:43PM +0800, yewgang wrote:
>> > Dear all,
>> >
>> > what's wrong with these codes ?  I really don't know...
>> > my codes is like this :
>> >
>> > static void
>> > test_print_tables(struct ovsdb_idl *idl)
>> > {
>> >     /* add for test */
>> >     struct shash_node *node;
>> >
>> >     SHASH_FOR_EACH(node, &idl->table_by_name) { // Report warning here
>> >         ......
>> >     }
>> >
>> > }
>> >
>> > but the compiler report warning :
>> >
>> > vswitchd/inventory.c: In function 'test_print_tables':
>> > vswitchd/inventory.c:219:5: error: dereferencing pointer to incomplete
>> type
>> > vswitchd/inventory.c:219:5: error: left-hand operand of comma expression
>> > has no effect [-Werror=unused-value]
>> > vswitchd/inventory.c:219:5: error: dereferencing pointer to incomplete
>> type
>> > vswitchd/inventory.c:219:5: error: left-hand operand of comma expression
>> > has no effect [-Werror=unused-value]
>> > cc1: all warnings being treated as errors
>> > make[2]: *** [vswitchd/inventory.o] Error 1
>> > make[1]: *** [all-recursive] Error 1
>> > make: *** [all] Error 2
>>
>> > _______________________________________________
>> > discuss mailing list
>> > discuss at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150306/b376281f/attachment.html>

From cheng at cs.umn.edu  Thu Mar  5 18:22:58 2015
From: cheng at cs.umn.edu (Cheng Jin)
Date: Thu, 5 Mar 2015 20:22:58 -0600
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <20150305055042.GA25472@nicira.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
 <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
 <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
 <20150305055042.GA25472@nicira.com>
Message-ID: <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>

On Wed, Mar 4, 2015 at 11:50 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Mar 04, 2015 at 11:45:15PM -0600, Cheng Jin wrote:
> > On Wed, Mar 4, 2015 at 4:02 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Wed, Mar 04, 2015 at 11:10:49AM -0600, Cheng Jin wrote:
> > > > On Tue, Mar 3, 2015 at 3:03 PM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
> > > > > > I have a problem with updating OVS' MAC learning table, when it
> is
> > > in the
> > > > > > 'standalone' mode running like a legacy Ethernet bridge.
> > > > > >
> > > > > > The switch has an entry to a destination, including the
> destination
> > > MAC
> > > > > > (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and Age.
> > > > > However,
> > > > > > the switch sometimes does not update the entry, when it receives
> a
> > > packet
> > > > > > from the same destination (still 00:00:00:00:00:01) but from a
> new
> > > > > incoming
> > > > > > port (say, 2). Does someone know what may cause this issue?
> > > > > >
> > > > > > The MAC learning table is supposed to be updated once receiving a
> > > packet.
> > > > > > Does OVS do some optimization to process the packets so that the
> > > learning
> > > > > > table may not get updated when the packet rate is high?
> > > > >
> > > > > The optimization that OVS does should only affect cases where a MAC
> > > > > would otherwise quickly bounce back and forth between a number of
> > > > > learned ports.
> > > > >
> > > > > Is there anything unusual in your setup?  Can you reproduce this
> with
> > > > > a simple setup?
> > > > >
> > > >
> > > > We tried a simple setup which has only three switches forming a
> triangle
> > > > (VLAN set up to avoid loop), and two hosts connect with two
> "standalone"
> > > > switches.
> > > >
> > > > The MAC learning table is allowed to stabilize (we send no traffic)
> and
> > > > then we send a packet from a source MAC that already exists in the
> MAC
> > > > table but which comes on another port than the one registered in the
> > > table.
> > > > We are checking how soon does the switch adapt. We don't do back and
> > > forth
> > > > changes often so the optimization should not happen.
> > >
> > > I ran a test just now and could not reproduce the problem.
> > >
> > > I connected two VMs, A and B, through OVS running in a third VM C.  In
> > > C, I ran "watch -n.1 ovs-appctl fdb/show br0" to observe changes in
> > > the MAC learning table.  I ran a "ping" for a few seconds and saw that
> > > the MAC learning table was initialized as expected.  Then I killed the
> > > ping and ran "ifconfig eth0 hw ether <address>" in each of the VMs, in
> > > each case using the other VM's MAC address, effectively swapping MAC
> > > addresses.  Then I reran the ping.  The displayed ports for those
> > > MACs immediately flipped.  I ran the experiment a few times.
> > >
> > > Then I tried turning up the log level for ofproto_dpif_xlate and
> > > observed the kinds of messages I expected, e.g.:
> > >
> >
> > How to turn up the log level for ofproto_dpif_xlate to observe these
> > messages?
>
> "ovs-appctl vlog/set ofproto_dpif_xlate" or start vswitchd with
> "-vofproto_dpif_xlate".
>

In my setting, three switches (s1, s2, and s3) forms a triangle. h1
connects with s1 and h2 connects with s2. h1 keeps ping h2 for seconds.

During the first few seconds, the MAC learning table of s1 and s2 were
initialized as the log shows.
2015-03-06T00:27:35.099Z|00001|ofproto_dpif_xlate(handler627)|DBG|bridge
s1: learned that 00:00:00:00:00:01 is on port s1-eth3 in VLAN 100
2015-03-06T00:27:35.099Z|00002|ofproto_dpif_xlate(handler627)|DBG|bridge
s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
2015-03-06T00:27:35.099Z|00003|ofproto_dpif_xlate(handler627)|DBG|bridge
s2: learned that 00:00:00:00:00:02 is on port s2-eth3 in VLAN 100
2015-03-06T00:27:35.100Z|00004|ofproto_dpif_xlate(handler627)|DBG|bridge
s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100


Then we send packets from s3 to s1 and s2. The packets are from the source
MAC that already exists in the MAC table (h1 and h2's MAC), but they come
on another port (s1-eth2, s2-eth2) than the one registered in the table
(s1-eth1, s2-eth1). s1 and s2 do not adapt to the new ports immediately, as
the log shows. What is the issue here? Is the revalidator here doing some
optimization?

2015-03-06T00:27:39.567Z|00005|ofproto_dpif_xlate(handler627)|DBG|bridge
s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
2015-03-06T00:27:39.568Z|00006|ofproto_dpif_xlate(handler627)|DBG|bridge
s2: learned that 00:00:00:00:00:01 is on port s2-eth2 in VLAN 100
2015-03-06T00:27:39.569Z|00001|ofproto_dpif_xlate(revalidator626)|DBG|bridge
s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
2015-03-06T00:27:40.072Z|00002|ofproto_dpif_xlate(revalidator626)|DBG|bridge
s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
2015-03-06T00:27:40.574Z|00003|ofproto_dpif_xlate(revalidator626)|DBG|bridge
s2: learned that 00:00:00:00:00:01 is on port s2-eth2 in VLAN 100
2015-03-06T00:27:40.574Z|00004|ofproto_dpif_xlate(revalidator626)|DBG|bridge
s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
2015-03-06T00:27:40.574Z|00005|ofproto_dpif_xlate(revalidator626)|DBG|bridge
s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
2015-03-06T00:27:41.076Z|00006|ofproto_dpif_xlate(revalidator626)|DBG|bridge
s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/89df4750/attachment-0001.html>

From alexw at nicira.com  Thu Mar  5 18:31:39 2015
From: alexw at nicira.com (Alex Wang)
Date: Thu, 5 Mar 2015 18:31:39 -0800
Subject: [ovs-discuss] IPv6 dadfailed
In-Reply-To: <CAHbON5o38eT-1amAcXXDh7rK=NaFaktiTe8HV9rtN_wezD3HTw@mail.gmail.com>
References: <2391029.WkG2ybOBvo@waiotapu>
 <CAHbON5ryJYHCM0iZ+OmWv_cbj94RT8taZRvTr6P7tQt2yaR=gQ@mail.gmail.com>
 <6497334.rkPPGxo8Mm@krabappel>
 <CAHbON5o38eT-1amAcXXDh7rK=NaFaktiTe8HV9rtN_wezD3HTw@mail.gmail.com>
Message-ID: <CAArS4XWtYcX3OFLSgExeRoMfC3+5Z2eZi1YQkUjUQFOCtWTGfw@mail.gmail.com>

Hey,


> >
> > Running tcpdump on the two physical uplinks shows that the neighbor
> > solicitation is sent out on both interfaces (Or maybe sent out on one and
> > received on the other, I'm not quite sure...).
> If it is the later, it makes sense that the sending VM receives it
> again. Which means that there is some sort of loop in the upstream
> switch.
> If it is the former, it looks to be a OVS bug (or some sort of LACP
> negotiation issue?)



This is a good point.  I suspect there is a loop in the setup causing the
bounch-back.



>
>
> > Tcpdumping on another VM running on a different VM host shows that it
> receives
> > the neighbor solicitation message two times.
> I cannot yet reconcile this with the previous message of the sending
> VM receiving the traffic with a hairpin.
>


Besides checking the VM, I'd suggest you check on the HV and run
'ovs-dpctl dump-flows -m' (this will show you how the packets are forwarded
in kernel), right after you configure IPv6 on VM.  'ovs-dpctl show' will
give
you the mapping between port number and port name.  So, we can see
how other HV process the IPv6 message and check if there is a loop.



>
>
>
> >
> > I have a feeling that there *could* be something wrong with how the
> bonding in
> > OVS handles this neighbor solicitation messages.
> >
> > Are there any ideas from the community on this topic? We're not yet sure
> if it
> > has something to do with OVS, but at the moment we're searching in this
> > direction...
>
> Are you using OVS tunnels? If so, one idea could be to connect  VM
> vifs to a OVS bridge. But use Linux bonding to carry the tunneled
> traffic out of the machine. Another option to try out is not to use
> LACP bonds but rather something like active-backup (man
> ovs-vswitchd.conf.db -> Bonding Configuration)
>


This is a good suggestion.



> I have added 2 people familiar with OVS bonding code. They should be
> able to discern better.
>


Thanks,
Alex Wang,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/ac0a8f63/attachment.html>

From chris at onthe.net.au  Thu Mar  5 19:13:38 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Fri, 6 Mar 2015 14:13:38 +1100
Subject: [ovs-discuss] kernel panic under heavy receive load
In-Reply-To: <CAGNyuhXmfAoSKt=nd2RmETkuD9QZTJr1anx5p3_N57ueHrMAMg@mail.gmail.com>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <CALnjE+rPF-jEpPrnWZWf3h5A8epwB36awR_r0E-iwJCHKoQwAQ@mail.gmail.com>
 <20150227225258.GA6530@onthe.net.au>
 <CAGNyuhUjgegdozJV2+-T3yCO9jW9jdrVoH_cMOoDp9OWugShdw@mail.gmail.com>
 <CALnjE+pe+0qqzq0citR=KfdrW90yh7wKEuxrq6vzeeoNaR_gdw@mail.gmail.com>
 <CAGNyuhXSSjnUrcqQ46xtSQz0k6NP4cSpReq074=vkZG5LtddAg@mail.gmail.com>
 <20150228014931.GA11906@onthe.net.au>
 <20150304141600.GA1048@onthe.net.au>
 <CAGNyuhXmfAoSKt=nd2RmETkuD9QZTJr1anx5p3_N57ueHrMAMg@mail.gmail.com>
Message-ID: <20150306031338.GA5800@onthe.net.au>

On Wed, Mar 04, 2015 at 03:56:41PM -0500, Xu (Simon) Chen wrote:
> Now I think about it... Maybe I run into this problem because I turned on
> Sflow collection on my OVS nodes...

Yes, I was also running sflow collection. I think the bug will only bite
when doing sflow collection because it's the sflow sampling that
produces the "nla_type(a) == OVS_ACTION_ATTR_SAMPLE" in
do_execute_actions() which then drops us into the problematical sample()
function that shares the skb.

So, for anyone coming across BUG() looking for answers... the quick
solution is to turn off sflow collection, the permanent solution is to
install v2.3.2 once it's out, and in the meantime you can cherry-pick
commit d7ff93d75 on top of v2.3.1 to get your sflow collection working
again.

Cheers!

Chris

> On Wednesday, March 4, 2015, Chris Dunlop <chris at onthe.net.au> wrote:
> 
> > On Sat, Feb 28, 2015 at 12:49:31PM +1100, Chris Dunlop wrote:
> > > On Fri, Feb 27, 2015 at 08:30:42PM -0500, Xu (Simon) Chen wrote:
> > > > On Fri, Feb 27, 2015 at 6:14 PM, Pravin Shelar <pshelar at nicira.com
> > <javascript:;>> wrote:
> > > > > So it looks like vhost is generating shared skb. Can you try same
> > test
> > > > > on latest upstream kernel?
> > > >
> > > > I don't know whether it's vhost, as for me the VM receiving high volume
> > > > consistently crashes.
> > > >
> > > > I previously had trouble building OVS datapath module on newer kernels.
> > > > What is the latest kernel that I should try?
> > >
> > > According to:
> > >
> > > https://github.com/openvswitch/ovs/blob/master/FAQ.md
> > >
> > > ...v3.14 *is* the latest kernel supported by the out-of-tree OVS
> > > kernel module, given that ovs 2.4.x isn't tagged yet and "git
> > > log v2.3..master" doesn't reveal anything obviously aimed at
> > > providing >v3.14 compatibility.
> > >
> > > Can you try with the in-tree OVS module?
> >
> > Simon, I think your crash will be fixed if you cherry-pick this
> > openvswitch commit (from master) on top of v2.3.1:
> >
> > ----------------------------------------------------------------------
> > commit d7ff93d7532717ea9d610a7181f24c773170be80
> > Author: Andy Zhou <azhou at nicira.com <javascript:;>>
> > Date:   Fri Aug 29 13:20:23 2014 -0700
> >
> >     datapath: simplify sample action implementation
> >
> >     The current sample() function implementation is more complicated
> >     than necessary in handling single user space action optimization
> >     and skb reference counting. There is no functional changes.
> >
> >     Signed-off-by: Andy Zhou <azhou at nicira.com <javascript:;>>
> >     Acked-by: Pravin B Shelar <pshelar at nicira.com <javascript:;>>
> > ----------------------------------------------------------------------
> >
> > The commit isn't actually designed to address the problem directly,
> > however in simplifying sample() it removes a call to skb_get(). The
> > skb_get() makes the skb shared, which later causes us to hit the BUG().
> > E.g. your v2.3.1 stack trace shows this call path:
> >
> >   netdev_frame_hook
> >   + netdev_port_receive
> >     | skb is guaranteed not-shared, via:
> >     |   skb = skb_share_check(skb, GFP_ATOMIC);
> >     + ovs_vport_receive
> >       + ovs_dp_process_received_packet
> >         + ovs_dp_process_packet_with_key
> >           + ovs_execute_actions
> >             + do_execute_actions
> >               | nla_type(a) == OVS_ACTION_ATTR_SAMPLE
> >               + sample
> >                 | skb is made shared here, via:
> >                 |   sample_skb = skb;
> >                 |   skb_get(skb);
> >                 + do_execute_actions
> >                   | nla_type(a) == OVS_ACTION_ATTR_USERSPACE
> >                   + output_userspace
> >                     + ovs_dp_upcall
> >                       + queue_userspace_packet
> >                         + skb_checksum_help
> >                           + pskb_expand_head
> >                             | if (skb_shared(skb))
> >                             |         BUG();        BOOM!!!
> >
> >
> > I think commit d7ff93d should be added to v2.3.2 (if indeed that's ever
> > produced).
> >
> > Cheers,
> >
> > Chris
> >

From chris at onthe.net.au  Thu Mar  5 19:27:44 2015
From: chris at onthe.net.au (Chris Dunlop)
Date: Fri, 6 Mar 2015 14:27:44 +1100
Subject: [ovs-discuss] pskb_expand_head: skb_shared BUG
In-Reply-To: <20150302004511.GA1500@onthe.net.au>
References: <CAGNyuhWRNgYt=D2rEW_yPh50g-Qu2njH0zLwc4MLzNxG-OYbEw@mail.gmail.com>
 <20150227051330.GA7198@onthe.net.au>
 <20150302004511.GA1500@onthe.net.au>
Message-ID: <20150306032744.GB5800@onthe.net.au>

On Mon, Mar 02, 2015 at 11:45:11AM +1100, Chris Dunlop wrote:
> Heads up...
> 
> We've hit this BUG() in v3.10.70, v3.14.27 and v3.18.7:
> 
> net/core/skbuff.c:
> 1027 int pskb_expand_head(struct sk_buff *skb, int nhead, int ntail,
> 1028                      gfp_t gfp_mask)
> 1029 {
> 1030         int i;
> 1031         u8 *data;
> 1032         int size = nhead + skb_end_offset(skb) + ntail;
> 1033         long off;
> 1034 
> 1035         BUG_ON(nhead < 0);
> 1036 
> 1037         if (skb_shared(skb))
> 1038                 BUG();             <<< BOOM!!!
> 
> This appears to be a regression in the 3.10.x stable series:
> we've been running for 11 months on v3.10.33 without problem, we
> upgraded to v3.14.27 and hit the BUG(), than again on upgrading
> to v3.18.7, then again after downgrading to v3.10.70. 

Apologies, this was a false alarm.

There was indeed a regression, but it's in the upstream openvswitch code
rather than linux core. (Further details: a sharing of an
otherwise-unshared skb, causing us to hit the BUG() above, introduced in
v2.3, will be fixed in upcoming v2.3.2)

Cheers,

Chris

From blp at nicira.com  Thu Mar  5 20:11:47 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 20:11:47 -0800
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
 <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
 <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
 <20150305055042.GA25472@nicira.com>
 <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>
Message-ID: <CACjuMbzi4CtNa=t3=HDmtU4Rcbm58GTZXQq2S3j4MxBYThs1-g@mail.gmail.com>

On Thu, Mar 5, 2015 at 6:22 PM, Cheng Jin <cheng at cs.umn.edu> wrote:
> On Wed, Mar 4, 2015 at 11:50 PM, Ben Pfaff <blp at nicira.com> wrote:
>>
>> On Wed, Mar 04, 2015 at 11:45:15PM -0600, Cheng Jin wrote:
>> > On Wed, Mar 4, 2015 at 4:02 PM, Ben Pfaff <blp at nicira.com> wrote:
>> >
>> > > On Wed, Mar 04, 2015 at 11:10:49AM -0600, Cheng Jin wrote:
>> > > > On Tue, Mar 3, 2015 at 3:03 PM, Ben Pfaff <blp at nicira.com> wrote:
>> > > >
>> > > > > On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
>> > > > > > I have a problem with updating OVS' MAC learning table, when it
>> > > > > > is
>> > > in the
>> > > > > > 'standalone' mode running like a legacy Ethernet bridge.
>> > > > > >
>> > > > > > The switch has an entry to a destination, including the
>> > > > > > destination
>> > > MAC
>> > > > > > (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and
>> > > > > > Age.
>> > > > > However,
>> > > > > > the switch sometimes does not update the entry, when it receives
>> > > > > > a
>> > > packet
>> > > > > > from the same destination (still 00:00:00:00:00:01) but from a
>> > > > > > new
>> > > > > incoming
>> > > > > > port (say, 2). Does someone know what may cause this issue?
>> > > > > >
>> > > > > > The MAC learning table is supposed to be updated once receiving
>> > > > > > a
>> > > packet.
>> > > > > > Does OVS do some optimization to process the packets so that the
>> > > learning
>> > > > > > table may not get updated when the packet rate is high?
>> > > > >
>> > > > > The optimization that OVS does should only affect cases where a
>> > > > > MAC
>> > > > > would otherwise quickly bounce back and forth between a number of
>> > > > > learned ports.
>> > > > >
>> > > > > Is there anything unusual in your setup?  Can you reproduce this
>> > > > > with
>> > > > > a simple setup?
>> > > > >
>> > > >
>> > > > We tried a simple setup which has only three switches forming a
>> > > > triangle
>> > > > (VLAN set up to avoid loop), and two hosts connect with two
>> > > > "standalone"
>> > > > switches.
>> > > >
>> > > > The MAC learning table is allowed to stabilize (we send no traffic)
>> > > > and
>> > > > then we send a packet from a source MAC that already exists in the
>> > > > MAC
>> > > > table but which comes on another port than the one registered in the
>> > > table.
>> > > > We are checking how soon does the switch adapt. We don't do back and
>> > > forth
>> > > > changes often so the optimization should not happen.
>> > >
>> > > I ran a test just now and could not reproduce the problem.
>> > >
>> > > I connected two VMs, A and B, through OVS running in a third VM C.  In
>> > > C, I ran "watch -n.1 ovs-appctl fdb/show br0" to observe changes in
>> > > the MAC learning table.  I ran a "ping" for a few seconds and saw that
>> > > the MAC learning table was initialized as expected.  Then I killed the
>> > > ping and ran "ifconfig eth0 hw ether <address>" in each of the VMs, in
>> > > each case using the other VM's MAC address, effectively swapping MAC
>> > > addresses.  Then I reran the ping.  The displayed ports for those
>> > > MACs immediately flipped.  I ran the experiment a few times.
>> > >
>> > > Then I tried turning up the log level for ofproto_dpif_xlate and
>> > > observed the kinds of messages I expected, e.g.:
>> > >
>> >
>> > How to turn up the log level for ofproto_dpif_xlate to observe these
>> > messages?
>>
>> "ovs-appctl vlog/set ofproto_dpif_xlate" or start vswitchd with
>> "-vofproto_dpif_xlate".
>
>
> In my setting, three switches (s1, s2, and s3) forms a triangle. h1 connects
> with s1 and h2 connects with s2. h1 keeps ping h2 for seconds.
>
> During the first few seconds, the MAC learning table of s1 and s2 were
> initialized as the log shows.
> 2015-03-06T00:27:35.099Z|00001|ofproto_dpif_xlate(handler627)|DBG|bridge s1:
> learned that 00:00:00:00:00:01 is on port s1-eth3 in VLAN 100
> 2015-03-06T00:27:35.099Z|00002|ofproto_dpif_xlate(handler627)|DBG|bridge s2:
> learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
> 2015-03-06T00:27:35.099Z|00003|ofproto_dpif_xlate(handler627)|DBG|bridge s2:
> learned that 00:00:00:00:00:02 is on port s2-eth3 in VLAN 100
> 2015-03-06T00:27:35.100Z|00004|ofproto_dpif_xlate(handler627)|DBG|bridge s1:
> learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
>
>
> Then we send packets from s3 to s1 and s2. The packets are from the source
> MAC that already exists in the MAC table (h1 and h2's MAC), but they come on
> another port (s1-eth2, s2-eth2) than the one registered in the table
> (s1-eth1, s2-eth1). s1 and s2 do not adapt to the new ports immediately, as
> the log shows. What is the issue here? Is the revalidator here doing some
> optimization?
>
> 2015-03-06T00:27:39.567Z|00005|ofproto_dpif_xlate(handler627)|DBG|bridge s1:
> learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
> 2015-03-06T00:27:39.568Z|00006|ofproto_dpif_xlate(handler627)|DBG|bridge s2:
> learned that 00:00:00:00:00:01 is on port s2-eth2 in VLAN 100
> 2015-03-06T00:27:39.569Z|00001|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
> 2015-03-06T00:27:40.072Z|00002|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
> 2015-03-06T00:27:40.574Z|00003|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> s2: learned that 00:00:00:00:00:01 is on port s2-eth2 in VLAN 100
> 2015-03-06T00:27:40.574Z|00004|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
> 2015-03-06T00:27:40.574Z|00005|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
> 2015-03-06T00:27:41.076Z|00006|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100

Would you mind turning on full logging with plain -v (or "ovs-vsctl
vlog/set any") and
posting the results with this experiment?  It will produce a lot of
logs, and so I recommend
keeping the amount of traffic through the switch to a minimum during
the experiment
(ideally just the "ping"s in question) to make the log easily comprehensible.

What version of Open vSwitch is this?
-- 
"I don't normally do acked-by's.  I think it's my way of avoiding
getting blamed when it all blows up."               Andrew Morton

From cheng at cs.umn.edu  Thu Mar  5 20:34:11 2015
From: cheng at cs.umn.edu (Cheng Jin)
Date: Thu, 5 Mar 2015 22:34:11 -0600
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <CACjuMbzi4CtNa=t3=HDmtU4Rcbm58GTZXQq2S3j4MxBYThs1-g@mail.gmail.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
 <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
 <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
 <20150305055042.GA25472@nicira.com>
 <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>
 <CACjuMbzi4CtNa=t3=HDmtU4Rcbm58GTZXQq2S3j4MxBYThs1-g@mail.gmail.com>
Message-ID: <CAMg13efcjPeYdvdPTi3n93zSvCrQ2O-sYRz7SSxuGkFLWy0RyA@mail.gmail.com>

On Thu, Mar 5, 2015 at 10:11 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Mar 5, 2015 at 6:22 PM, Cheng Jin <cheng at cs.umn.edu> wrote:
> > On Wed, Mar 4, 2015 at 11:50 PM, Ben Pfaff <blp at nicira.com> wrote:
> >>
> >> On Wed, Mar 04, 2015 at 11:45:15PM -0600, Cheng Jin wrote:
> >> > On Wed, Mar 4, 2015 at 4:02 PM, Ben Pfaff <blp at nicira.com> wrote:
> >> >
> >> > > On Wed, Mar 04, 2015 at 11:10:49AM -0600, Cheng Jin wrote:
> >> > > > On Tue, Mar 3, 2015 at 3:03 PM, Ben Pfaff <blp at nicira.com> wrote:
> >> > > >
> >> > > > > On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
> >> > > > > > I have a problem with updating OVS' MAC learning table, when
> it
> >> > > > > > is
> >> > > in the
> >> > > > > > 'standalone' mode running like a legacy Ethernet bridge.
> >> > > > > >
> >> > > > > > The switch has an entry to a destination, including the
> >> > > > > > destination
> >> > > MAC
> >> > > > > > (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and
> >> > > > > > Age.
> >> > > > > However,
> >> > > > > > the switch sometimes does not update the entry, when it
> receives
> >> > > > > > a
> >> > > packet
> >> > > > > > from the same destination (still 00:00:00:00:00:01) but from a
> >> > > > > > new
> >> > > > > incoming
> >> > > > > > port (say, 2). Does someone know what may cause this issue?
> >> > > > > >
> >> > > > > > The MAC learning table is supposed to be updated once
> receiving
> >> > > > > > a
> >> > > packet.
> >> > > > > > Does OVS do some optimization to process the packets so that
> the
> >> > > learning
> >> > > > > > table may not get updated when the packet rate is high?
> >> > > > >
> >> > > > > The optimization that OVS does should only affect cases where a
> >> > > > > MAC
> >> > > > > would otherwise quickly bounce back and forth between a number
> of
> >> > > > > learned ports.
> >> > > > >
> >> > > > > Is there anything unusual in your setup?  Can you reproduce this
> >> > > > > with
> >> > > > > a simple setup?
> >> > > > >
> >> > > >
> >> > > > We tried a simple setup which has only three switches forming a
> >> > > > triangle
> >> > > > (VLAN set up to avoid loop), and two hosts connect with two
> >> > > > "standalone"
> >> > > > switches.
> >> > > >
> >> > > > The MAC learning table is allowed to stabilize (we send no
> traffic)
> >> > > > and
> >> > > > then we send a packet from a source MAC that already exists in the
> >> > > > MAC
> >> > > > table but which comes on another port than the one registered in
> the
> >> > > table.
> >> > > > We are checking how soon does the switch adapt. We don't do back
> and
> >> > > forth
> >> > > > changes often so the optimization should not happen.
> >> > >
> >> > > I ran a test just now and could not reproduce the problem.
> >> > >
> >> > > I connected two VMs, A and B, through OVS running in a third VM C.
> In
> >> > > C, I ran "watch -n.1 ovs-appctl fdb/show br0" to observe changes in
> >> > > the MAC learning table.  I ran a "ping" for a few seconds and saw
> that
> >> > > the MAC learning table was initialized as expected.  Then I killed
> the
> >> > > ping and ran "ifconfig eth0 hw ether <address>" in each of the VMs,
> in
> >> > > each case using the other VM's MAC address, effectively swapping MAC
> >> > > addresses.  Then I reran the ping.  The displayed ports for those
> >> > > MACs immediately flipped.  I ran the experiment a few times.
> >> > >
> >> > > Then I tried turning up the log level for ofproto_dpif_xlate and
> >> > > observed the kinds of messages I expected, e.g.:
> >> > >
> >> >
> >> > How to turn up the log level for ofproto_dpif_xlate to observe these
> >> > messages?
> >>
> >> "ovs-appctl vlog/set ofproto_dpif_xlate" or start vswitchd with
> >> "-vofproto_dpif_xlate".
> >
> >
> > In my setting, three switches (s1, s2, and s3) forms a triangle. h1
> connects
> > with s1 and h2 connects with s2. h1 keeps ping h2 for seconds.
> >
> > During the first few seconds, the MAC learning table of s1 and s2 were
> > initialized as the log shows.
> > 2015-03-06T00:27:35.099Z|00001|ofproto_dpif_xlate(handler627)|DBG|bridge
> s1:
> > learned that 00:00:00:00:00:01 is on port s1-eth3 in VLAN 100
> > 2015-03-06T00:27:35.099Z|00002|ofproto_dpif_xlate(handler627)|DBG|bridge
> s2:
> > learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
> > 2015-03-06T00:27:35.099Z|00003|ofproto_dpif_xlate(handler627)|DBG|bridge
> s2:
> > learned that 00:00:00:00:00:02 is on port s2-eth3 in VLAN 100
> > 2015-03-06T00:27:35.100Z|00004|ofproto_dpif_xlate(handler627)|DBG|bridge
> s1:
> > learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
> >
> >
> > Then we send packets from s3 to s1 and s2. The packets are from the
> source
> > MAC that already exists in the MAC table (h1 and h2's MAC), but they
> come on
> > another port (s1-eth2, s2-eth2) than the one registered in the table
> > (s1-eth1, s2-eth1). s1 and s2 do not adapt to the new ports immediately,
> as
> > the log shows. What is the issue here? Is the revalidator here doing some
> > optimization?
> >
> > 2015-03-06T00:27:39.567Z|00005|ofproto_dpif_xlate(handler627)|DBG|bridge
> s1:
> > learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
> > 2015-03-06T00:27:39.568Z|00006|ofproto_dpif_xlate(handler627)|DBG|bridge
> s2:
> > learned that 00:00:00:00:00:01 is on port s2-eth2 in VLAN 100
> >
> 2015-03-06T00:27:39.569Z|00001|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
> >
> 2015-03-06T00:27:40.072Z|00002|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
> >
> 2015-03-06T00:27:40.574Z|00003|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > s2: learned that 00:00:00:00:00:01 is on port s2-eth2 in VLAN 100
> >
> 2015-03-06T00:27:40.574Z|00004|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
> >
> 2015-03-06T00:27:40.574Z|00005|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
> >
> 2015-03-06T00:27:41.076Z|00006|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
>
> Would you mind turning on full logging with plain -v (or "ovs-vsctl
> vlog/set any") and
> posting the results with this experiment?  It will produce a lot of
> logs, and so I recommend
> keeping the amount of traffic through the switch to a minimum during
> the experiment
> (ideally just the "ping"s in question) to make the log easily
> comprehensible.
>
> That's a lot of logs. Do you need the entire log, or some specific part?


> What version of Open vSwitch is this?
>

ovs 2.3.0


> --
> "I don't normally do acked-by's.  I think it's my way of avoiding
> getting blamed when it all blows up."               Andrew Morton
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150305/7c4033f0/attachment.html>

From blp at nicira.com  Thu Mar  5 20:36:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 20:36:41 -0800
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <CAMg13efcjPeYdvdPTi3n93zSvCrQ2O-sYRz7SSxuGkFLWy0RyA@mail.gmail.com>
References: <CAMg13edDPM4cjPKuD=XUc1aOtuqjgw=uhpwBCLMbbDV+z3e9Ow@mail.gmail.com>
 <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
 <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
 <20150305055042.GA25472@nicira.com>
 <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>
 <CACjuMbzi4CtNa=t3=HDmtU4Rcbm58GTZXQq2S3j4MxBYThs1-g@mail.gmail.com>
 <CAMg13efcjPeYdvdPTi3n93zSvCrQ2O-sYRz7SSxuGkFLWy0RyA@mail.gmail.com>
Message-ID: <20150306043641.GA24732@nicira.com>

On Thu, Mar 05, 2015 at 10:34:11PM -0600, Cheng Jin wrote:
> On Thu, Mar 5, 2015 at 10:11 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Thu, Mar 5, 2015 at 6:22 PM, Cheng Jin <cheng at cs.umn.edu> wrote:
> > > On Wed, Mar 4, 2015 at 11:50 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >>
> > >> On Wed, Mar 04, 2015 at 11:45:15PM -0600, Cheng Jin wrote:
> > >> > On Wed, Mar 4, 2015 at 4:02 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >> >
> > >> > > On Wed, Mar 04, 2015 at 11:10:49AM -0600, Cheng Jin wrote:
> > >> > > > On Tue, Mar 3, 2015 at 3:03 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >> > > >
> > >> > > > > On Tue, Mar 03, 2015 at 12:25:20PM -0600, Cheng Jin wrote:
> > >> > > > > > I have a problem with updating OVS' MAC learning table, when
> > it
> > >> > > > > > is
> > >> > > in the
> > >> > > > > > 'standalone' mode running like a legacy Ethernet bridge.
> > >> > > > > >
> > >> > > > > > The switch has an entry to a destination, including the
> > >> > > > > > destination
> > >> > > MAC
> > >> > > > > > (say, 00:00:00:00:00:01), an output port (say, 1), VLAN, and
> > >> > > > > > Age.
> > >> > > > > However,
> > >> > > > > > the switch sometimes does not update the entry, when it
> > receives
> > >> > > > > > a
> > >> > > packet
> > >> > > > > > from the same destination (still 00:00:00:00:00:01) but from a
> > >> > > > > > new
> > >> > > > > incoming
> > >> > > > > > port (say, 2). Does someone know what may cause this issue?
> > >> > > > > >
> > >> > > > > > The MAC learning table is supposed to be updated once
> > receiving
> > >> > > > > > a
> > >> > > packet.
> > >> > > > > > Does OVS do some optimization to process the packets so that
> > the
> > >> > > learning
> > >> > > > > > table may not get updated when the packet rate is high?
> > >> > > > >
> > >> > > > > The optimization that OVS does should only affect cases where a
> > >> > > > > MAC
> > >> > > > > would otherwise quickly bounce back and forth between a number
> > of
> > >> > > > > learned ports.
> > >> > > > >
> > >> > > > > Is there anything unusual in your setup?  Can you reproduce this
> > >> > > > > with
> > >> > > > > a simple setup?
> > >> > > > >
> > >> > > >
> > >> > > > We tried a simple setup which has only three switches forming a
> > >> > > > triangle
> > >> > > > (VLAN set up to avoid loop), and two hosts connect with two
> > >> > > > "standalone"
> > >> > > > switches.
> > >> > > >
> > >> > > > The MAC learning table is allowed to stabilize (we send no
> > traffic)
> > >> > > > and
> > >> > > > then we send a packet from a source MAC that already exists in the
> > >> > > > MAC
> > >> > > > table but which comes on another port than the one registered in
> > the
> > >> > > table.
> > >> > > > We are checking how soon does the switch adapt. We don't do back
> > and
> > >> > > forth
> > >> > > > changes often so the optimization should not happen.
> > >> > >
> > >> > > I ran a test just now and could not reproduce the problem.
> > >> > >
> > >> > > I connected two VMs, A and B, through OVS running in a third VM C.
> > In
> > >> > > C, I ran "watch -n.1 ovs-appctl fdb/show br0" to observe changes in
> > >> > > the MAC learning table.  I ran a "ping" for a few seconds and saw
> > that
> > >> > > the MAC learning table was initialized as expected.  Then I killed
> > the
> > >> > > ping and ran "ifconfig eth0 hw ether <address>" in each of the VMs,
> > in
> > >> > > each case using the other VM's MAC address, effectively swapping MAC
> > >> > > addresses.  Then I reran the ping.  The displayed ports for those
> > >> > > MACs immediately flipped.  I ran the experiment a few times.
> > >> > >
> > >> > > Then I tried turning up the log level for ofproto_dpif_xlate and
> > >> > > observed the kinds of messages I expected, e.g.:
> > >> > >
> > >> >
> > >> > How to turn up the log level for ofproto_dpif_xlate to observe these
> > >> > messages?
> > >>
> > >> "ovs-appctl vlog/set ofproto_dpif_xlate" or start vswitchd with
> > >> "-vofproto_dpif_xlate".
> > >
> > >
> > > In my setting, three switches (s1, s2, and s3) forms a triangle. h1
> > connects
> > > with s1 and h2 connects with s2. h1 keeps ping h2 for seconds.
> > >
> > > During the first few seconds, the MAC learning table of s1 and s2 were
> > > initialized as the log shows.
> > > 2015-03-06T00:27:35.099Z|00001|ofproto_dpif_xlate(handler627)|DBG|bridge
> > s1:
> > > learned that 00:00:00:00:00:01 is on port s1-eth3 in VLAN 100
> > > 2015-03-06T00:27:35.099Z|00002|ofproto_dpif_xlate(handler627)|DBG|bridge
> > s2:
> > > learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
> > > 2015-03-06T00:27:35.099Z|00003|ofproto_dpif_xlate(handler627)|DBG|bridge
> > s2:
> > > learned that 00:00:00:00:00:02 is on port s2-eth3 in VLAN 100
> > > 2015-03-06T00:27:35.100Z|00004|ofproto_dpif_xlate(handler627)|DBG|bridge
> > s1:
> > > learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
> > >
> > >
> > > Then we send packets from s3 to s1 and s2. The packets are from the
> > source
> > > MAC that already exists in the MAC table (h1 and h2's MAC), but they
> > come on
> > > another port (s1-eth2, s2-eth2) than the one registered in the table
> > > (s1-eth1, s2-eth1). s1 and s2 do not adapt to the new ports immediately,
> > as
> > > the log shows. What is the issue here? Is the revalidator here doing some
> > > optimization?
> > >
> > > 2015-03-06T00:27:39.567Z|00005|ofproto_dpif_xlate(handler627)|DBG|bridge
> > s1:
> > > learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
> > > 2015-03-06T00:27:39.568Z|00006|ofproto_dpif_xlate(handler627)|DBG|bridge
> > s2:
> > > learned that 00:00:00:00:00:01 is on port s2-eth2 in VLAN 100
> > >
> > 2015-03-06T00:27:39.569Z|00001|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > > s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
> > >
> > 2015-03-06T00:27:40.072Z|00002|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > > s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
> > >
> > 2015-03-06T00:27:40.574Z|00003|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > > s2: learned that 00:00:00:00:00:01 is on port s2-eth2 in VLAN 100
> > >
> > 2015-03-06T00:27:40.574Z|00004|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > > s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
> > >
> > 2015-03-06T00:27:40.574Z|00005|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > > s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
> > >
> > 2015-03-06T00:27:41.076Z|00006|ofproto_dpif_xlate(revalidator626)|DBG|bridge
> > > s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
> >
> > Would you mind turning on full logging with plain -v (or "ovs-vsctl
> > vlog/set any") and
> > posting the results with this experiment?  It will produce a lot of
> > logs, and so I recommend
> > keeping the amount of traffic through the switch to a minimum during
> > the experiment
> > (ideally just the "ping"s in question) to make the log easily
> > comprehensible.
> >
> > That's a lot of logs. Do you need the entire log, or some specific part?

Unless it's more than a megabyte or two, I'd like to look at the whole
thing.

> > What version of Open vSwitch is this?
> >
> 
> ovs 2.3.0

OK.

From blp at nicira.com  Thu Mar  5 21:53:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 5 Mar 2015 21:53:55 -0800
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <CAMg13eds7ixdSuvOjvS0vS+-dACAaSG3f9W566m16HJ7YSmYZA@mail.gmail.com>
References: <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
 <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
 <20150305055042.GA25472@nicira.com>
 <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>
 <CACjuMbzi4CtNa=t3=HDmtU4Rcbm58GTZXQq2S3j4MxBYThs1-g@mail.gmail.com>
 <CAMg13efcjPeYdvdPTi3n93zSvCrQ2O-sYRz7SSxuGkFLWy0RyA@mail.gmail.com>
 <20150306043641.GA24732@nicira.com>
 <CAMg13eds7ixdSuvOjvS0vS+-dACAaSG3f9W566m16HJ7YSmYZA@mail.gmail.com>
Message-ID: <20150306055355.GB24732@nicira.com>

On Thu, Mar 05, 2015 at 10:42:12PM -0600, Cheng Jin wrote:
> Attached please find the log file. Thanks for your time and help.

Thanks.  I'm adding back the mailing list to continue the discussion.

Consider 00:00:00:00:00:02 in bridge s1 (it would be a lot easier to
read the log if there were only one bridge, by the way).  We initially
see this getting learned on port s1-eth1 (in_port(2)) when a packet
arrives for it.  OVS forwards the packet and sets up a kernel cache
entry:

    2015-03-06T03:01:06.923Z|00019|dpif(handler671)|DBG|system at ovs-system: miss upcall:
    dp_hash(0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0806),arp(sip=10.0.0.2,tip=10.0.0.1,op=2,sha=00:00:00:00:00:02,tha=00:00:00:00:00:01))
    arp,metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,arp_spa=10.0.0.2,arp_tpa=10.0.0.1,arp_op=2,arp_sha=00:00:00:00:00:02,arp_tha=00:00:00:00:00:01
    2015-03-06T03:01:06.923Z|00020|ofproto_dpif_xlate(handler671)|DBG|bridge s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
    2015-03-06T03:01:06.923Z|00021|dpif(handler671)|DBG|system at ovs-system: put[create] dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0806),arp(sip=10.0.0.2/0.0.0.0,tip=10.0.0.1/0.0.0.0,op=2/0,sha=00:00:00:00:00:02/00:00:00:00:00:00,tha=00:00:00:00:00:01/00:00:00:00:00:00)), actions:pop_vlan,4
    2015-03-06T03:01:06.923Z|00022|dpif(handler671)|DBG|system at ovs-system: execute pop_vlan,4 on packet arp,metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,arp_spa=10.0.0.2,arp_tpa=10.0.0.1,arp_op=2,arp_sha=00:00:00:00:00:02,arp_tha=00:00:00:00:00:01

A few seconds later, a packet with the same source arrives on s1-eth2
(in_port(3)).  OVS learns the new port for the MAC and again forwards
the packet and sets up a kernel cache entry:

    2015-03-06T03:01:11.367Z|00036|dpif(handler671)|DBG|system at ovs-system: miss upcall:
    dp_hash(0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap()
    metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,dl_type=0x05ff
    2015-03-06T03:01:11.367Z|00037|dpif(handler671)|DBG|system at ovs-system: get_stats success
    2015-03-06T03:01:11.367Z|00038|ofproto_dpif_xlate(handler671)|DBG|bridge s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
    2015-03-06T03:01:11.368Z|00039|dpif(handler671)|DBG|system at ovs-system: put[create] dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(), actions:pop_vlan,4
    2015-03-06T03:01:11.368Z|00040|dpif(handler671)|DBG|system at ovs-system: execute pop_vlan,4 on packet metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,dl_type=0x05ff
    2015-03-06T03:01:11.368Z|04443|dpif|DBG|system at ovs-system: execute 10 on packet metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,dl_type=0x05ff

This is when things get murky.  About 79 ms later, another 5 packets
arrive with the same MAC arrives on the original port, s1-eth1 (you can
tell the time and the count from "idle" and packets" below).  The kernel
cache entry for that flow is still there, so userspace only notices the
next time it checks the kernel cache statistics.  At that point, it
re-learns the old address:

    2015-03-06T03:01:11.871Z|00201|dpif(revalidator670)|DBG|system at ovs-system: flow_dump dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(), packets:0, bytes:0, used:never, actions:pop_vlan,4
    2015-03-06T03:01:11.872Z|00202|dpif(revalidator670)|DBG|system at ovs-system: flow_dump dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0800),ipv4(src=10.0.0.2/0.0.0.0,dst=10.0.0.1/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0/0,code=0/0)), packets:5, bytes:490, used:0.421s, actions:pop_vlan,4
    2015-03-06T03:01:11.872Z|00203|ofproto_dpif_xlate(revalidator670)|DBG|bridge s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100

Similarly, there's another packet on s1-eth2 a bit later and that port
is relearned:

    2015-03-06T03:01:12.377Z|00222|dpif(revalidator670)|DBG|system at ovs-system: flow_dump dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(), packets:1, bytes:42, used:0.005s, actions:pop_vlan,4
    2015-03-06T03:01:12.377Z|00223|ofproto_dpif_xlate(revalidator670)|DBG|bridge s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100

and so on

In other words, I see that MAC bouncing back and forth because there's
continuing traffic for it arriving on both ports.  There is some
hysteresis to the bouncing because it only gets processed when OVS looks
at kernel statistics.

If this isn't the MAC that you're having trouble with (in that log) then
can you be specific about which MAC and bridge you're looking at?

From neelugaddam at gmail.com  Thu Mar  5 22:39:02 2015
From: neelugaddam at gmail.com (Neelakantam Gaddam)
Date: Fri, 6 Mar 2015 12:09:02 +0530
Subject: [ovs-discuss] Geneve Support
Message-ID: <CAOv37=B278MZWx39hX+496XVf7x9m4ShYUGqhLe28VjhZUOM-g@mail.gmail.com>

Hi All,

Which OVS version supports Geneve protocol? I did not see Geneve support in
2.3.1.  Currently, Geneve is part of master branch. When can I expect
Geneve part of  OVS official release?



-- 
Thanks & Regards
Neelakantam Gaddam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150306/15ac0149/attachment.html>

From jpettit at nicira.com  Thu Mar  5 23:22:58 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 5 Mar 2015 23:22:58 -0800
Subject: [ovs-discuss] [ovs-dev] Geneve Support
In-Reply-To: <CAOv37=B278MZWx39hX+496XVf7x9m4ShYUGqhLe28VjhZUOM-g@mail.gmail.com>
References: <CAOv37=B278MZWx39hX+496XVf7x9m4ShYUGqhLe28VjhZUOM-g@mail.gmail.com>
Message-ID: <4518FDBD-19BE-4F07-9901-2EA298108C25@nicira.com>

Please don't cross-post on multiple mailing lists.

It will be part of OVS 2.4.  We haven't branched for it yet, but we hope to do that in the next few weeks.  The release will be some weeks after that.

--Justin


> On Mar 5, 2015, at 10:39 PM, Neelakantam Gaddam <neelugaddam at gmail.com> wrote:
> 
> Hi All,
> 
> Which OVS version supports Geneve protocol? I did not see Geneve support in
> 2.3.1.  Currently, Geneve is part of master branch. When can I expect
> Geneve part of  OVS official release?
> 
> 
> 
> -- 
> Thanks & Regards
> Neelakantam Gaddam
> _______________________________________________
> dev mailing list
> dev at openvswitch.org
> http://openvswitch.org/mailman/listinfo/dev


From mark.d.gray at intel.com  Fri Mar  6 00:56:23 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Fri, 6 Mar 2015 08:56:23 +0000
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <20150305193743.GE20780@nicira.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
 <20150304165105.GK18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>
 <20150304165920.GM18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF648@IRSMSX108.ger.corp.intel.com>
 <20150304181213.GN18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF8F5@IRSMSX108.ger.corp.intel.com>
 <20150305193743.GE20780@nicira.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E1D2F8C@IRSMSX108.ger.corp.intel.com>



> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Thursday, March 5, 2015 7:38 PM
> To: Gray, Mark D
> Cc: swair shah; discuss at openvswitch.org
> Subject: Re: [ovs-discuss] packet reorderoing
> 
> On Wed, Mar 04, 2015 at 07:08:03PM +0000, Gray, Mark D wrote:
> > > From: Ben Pfaff [mailto:blp at nicira.com]
> > > Sent: Wednesday, March 4, 2015 6:12 PM On Wed, Mar 04, 2015 at
> > > 05:05:33PM +0000, Gray, Mark D wrote:
> > > > > From: Ben Pfaff [mailto:blp at nicira.com]
> > > > > Sent: Wednesday, March 4, 2015 4:59 PM
> > > > >
> > > > > On Wed, Mar 04, 2015 at 04:53:45PM +0000, Gray, Mark D wrote:
> > > > > > > From: Ben Pfaff [mailto:blp at nicira.com]
> > > > > > > Sent: Wednesday, March 4, 2015 4:51 PM On Wed, Mar 04, 2015
> > > > > > > at 04:42:36PM +0000, Gray, Mark D wrote:
> > > > > > > > >
> > > > > > > > > On Wed, Feb 25, 2015 at 11:28:56AM -0600, swair shah wrote:
> > > > > > > > > > When packets which does not match any rule in ovs, are
> > > > > > > > > > buffered at the ingress switch, say first n packets
> > > > > > > > > > are buffered. Switch sends a flow_mod and message and
> > > > > > > > > > packet_out for the buffered packets, meanwhile if some
> > > > > > > > > > more packets of the same flow arrive (say n+1 to m),
> > > > > > > > > > they'll also get buffered (as
> > > > > flow_mod) hasn't arrived yet.
> > > > > > > > > >
> > > > > > > > > > Once flow_mod message arrives at the switch then
> > > > > > > > > > subsequent packets of the flow will be forwarded but
> > > > > > > > > > packets (n+1 to m) will still be buffered waiting for
> > > > > > > > > > their packet_outs. This results in reordering of
> > > > > > > > > packets.
> > > > > > > > > >
> > > > > > > > > > Is there a way around this, besides from proactively
> > > > > > > > > > setting up a
> > > > > flow?
> > > > > > > > > >
> > > > > > > > > > Is there a way to match flow_mod to existing buffered
> packets?
> > > > > > > > >
> > > > > > > > > Reordering can happen.  There isn't a way to avoid it
> > > > > > > > > entirely (besides proactive flow setup).  It isn't
> > > > > > > > > usually a problem, though, because most protocols only
> > > > > > > > > send one packet before they receive a reply from the
> opposite end.
> > > > > > > >
> > > > > > > > The only way that I can think to nail up a flow is via dpctl.
> > > > > > > > Is this how you suggest to do this?
> > > > > > >
> > > > > > > Can you be more specific about what you want to do?  I can
> > > > > > > think of a few possibilities.
> > > > > >
> > > > > > I don't know what Swair wants but I would like to be certain
> > > > > > to avoid reordering of packets traversing the vswitch. I
> > > > > > suspect the way to do this is to add a flow into the datapath
> > > > > > and make it persistent so that upcalls are never triggered.
> > > > >
> > > > > I don't see how that can solve the problem that he is reporting.
> > > > > Did you read his whole scenario?  If we knew how to handle the
> > > > > packet in the datapath at the beginning of the scenario then we
> > > > > would not be sending it to the controller.
> > > >
> > > > I see the confusion, he is referring to using a controller and it
> > > > not matching the switch, I am thinking of missing the datapath. My bad
> ..
> > > > >
> > > > > I doubt that this is a real problem that needs to be solved,
> > > > > because it's been in the back of my mind since about 2008 as a
> > > > > possible concern but this is the
> > > >
> > > > It has been a concern of mine for a while and I also expected it
> > > > to come up at some stage but it never did. I don't think it is an
> > > > issue in most cloud deployments but could see it be an issue in
> > > > NFV deployments as usually there would be an expectation that a
> > > > router or another network element wouldn't reorder.
> > > >
> > > > However, hypothetically, how would you resolve this?
> > >
> > > One way would be to send only the first packet in a given microflow
> > > to the controller and buffer the rest.  OpenFlow provides three ways
> > > for controllers to handle packet-ins:
> >
> > I was talking about the similar problem across the dpif interface.
> >
> > * Packet group A arrives at NIC and get sent to ofproto as an upcall.
> >
> > * Upcall processes some packets from A and calls operate() from dpif.
> > operate() will execute ops, a FLOW_PUT followed by EXECUTEs.
> > However, some packets may not have been executed are still buffered in
> > the vswitchd.
> > * At this point, packet group B arrives at the NIC but matches on the
> > fast path as the flow has already been "put" and are sent directly
> > without having an upcall.
> >
> > The remaining packets from group A that are buffered in the vswitchd
> > will arrive out of order. How could we resolve this?
> 
> I don't have a solution I really like.  The solutions I've thought of have
> significant downsides.  I'd love to hear of a good solution.  In the absence of
> both a good solution and a situation where there's a real problem to solve, I
> don't intend to worry about it.

Thanks for the input Ben.

From tobias.brunner at vshn.ch  Fri Mar  6 02:08:42 2015
From: tobias.brunner at vshn.ch (Tobias Brunner)
Date: Fri, 06 Mar 2015 11:08:42 +0100
Subject: [ovs-discuss] IPv6 dadfailed
In-Reply-To: <CAArS4XWtYcX3OFLSgExeRoMfC3+5Z2eZi1YQkUjUQFOCtWTGfw@mail.gmail.com>
References: <2391029.WkG2ybOBvo@waiotapu>
 <CAHbON5o38eT-1amAcXXDh7rK=NaFaktiTe8HV9rtN_wezD3HTw@mail.gmail.com>
 <CAArS4XWtYcX3OFLSgExeRoMfC3+5Z2eZi1YQkUjUQFOCtWTGfw@mail.gmail.com>
Message-ID: <2611640.21aUqXHEkD@wiggum>

Hi everyone,

Thanks a lot for taking care of this issue!

> This is a good point.  I suspect there is a loop in the setup causing the
> bounch-back.

Yes, this really looks like that there is a loop somewhere.
 
> > I cannot yet reconcile this with the previous message of the sending
> > VM receiving the traffic with a hairpin.
> 
> Besides checking the VM, I'd suggest you check on the HV and run
> 'ovs-dpctl dump-flows -m' (this will show you how the packets are forwarded
> in kernel), right after you configure IPv6 on VM.  'ovs-dpctl show' will
> give
> you the mapping between port number and port name.  So, we can see
> how other HV process the IPv6 message and check if there is a loop.

I did that, but can't find any usable information on the "dump-flows" output. 
I've attached the file.

> > Are you using OVS tunnels? If so, one idea could be to connect  VM
> > vifs to a OVS bridge. But use Linux bonding to carry the tunneled
> > traffic out of the machine. Another option to try out is not to use
> > LACP bonds but rather something like active-backup (man
> > ovs-vswitchd.conf.db -> Bonding Configuration)
> 
> This is a good suggestion.

No, we are not using any tunnels. And I'm not able to change from LACP to 
active-backup on the affected systems because they're running in production. We 
also don't have any lab devices available to experiment with, this is too bad, 
I know =(

Some more information about the setup: The hosts are connected with two 
network interfaces, each to one Brocade ICX6650 switch which form a MCT 
cluster. Therefore we are able to use LACP to form a bonding with this two 
network connections.
We have some other servers connected exactly identically to the same switches 
which are not running any VMs on it and also don't have OVS on it. They're 
using linux bonding to form the LACP channel and don't suffer from this DAD 
trouble.

Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)

Bonding Mode: IEEE 802.3ad Dynamic link aggregation
Transmit Hash Policy: layer2 (0)
MII Status: up
MII Polling Interval (ms): 100
Up Delay (ms): 0
Down Delay (ms): 0

802.3ad info
LACP rate: fast
Min links: 0
Aggregator selection policy (ad_select): stable
Active Aggregator Info:
	Aggregator ID: 1
	Number of ports: 2
	Actor Key: 33
	Partner Key: 30203
	Partner Mac Address: 01:80:c2:xx:xx:xx

Slave Interface: p262p1
MII Status: up
Speed: 10000 Mbps
Duplex: full
Link Failure Count: 0
Permanent HW addr: 90:e2:ba:xx:xx:xx
Aggregator ID: 1
Slave queue ID: 0

Slave Interface: p262p2
MII Status: up
Speed: 10000 Mbps
Duplex: full
Link Failure Count: 0
Permanent HW addr: 90:e2:ba:xx:xx:xx
Aggregator ID: 1
Slave queue ID: 0

Cheers,
Tobias

-- 
Tobias Brunner
Linux and Network Engineer
-------------- next part --------------
skb_priority(0),in_port(vnet4),skb_mark(0/0),eth(src=52:54:00:35:b6:49,dst=52:54:00:1a:5d:83),eth_type(0x0800),ipv4(src=10.144.32.11/255.255.255.255,dst=10.144.32.2/255.255.255.255,proto=1/0xff,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0,code=0), packets:3, bytes:294, used:0.328s, actions:push_vlan(vid=700,pcp=0),3
skb_priority(0),in_port(vnet10),skb_mark(0/0),eth(src=52:54:00:10:cd:9f,dst=52:54:00:db:8f:23),eth_type(0x0800),ipv4(src=10.144.34.7/255.255.255.255,dst=10.144.34.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=33381,dst=5432),tcp_flags(0x002/0x000), packets:24, bytes:4380, used:1.008s, flags:FPR., actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(vnet5),skb_mark(0/0),eth(src=52:54:00:c9:f1:39,dst=52:54:00:1a:5d:83),eth_type(0x0800),ipv4(src=10.144.32.7/255.255.255.255,dst=10.144.32.2/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5666,dst=60646),tcp_flags(0x012/0x000), packets:6, bytes:1934, used:0.248s, flags:FP., actions:push_vlan(vid=700,pcp=0),2
skb_priority(0),in_port(vnet10),skb_mark(0/0),eth(src=52:54:00:10:cd:9f,dst=52:54:00:c3:95:40),eth_type(0x0800),ipv4(src=10.144.34.7/255.255.255.255,dst=185.72.20.93/255.255.255.255,proto=17/0xff,tos=0/0,ttl=64/0,frag=no/0xff),udp(src=46089,dst=53), packets:0, bytes:0, used:never, actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:7d:d7:a4),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=10.144.37.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432,dst=33492),tcp_flags(0x012/0x000), packets:65, bytes:70093, used:0.332s, flags:P., actions:push_vlan(vid=708,pcp=0),2
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:7d:d7:a4,dst=52:54:00:43:5d:db),eth_type(0x8100),vlan(vid=708,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.37.4/0.0.0.0,dst=10.144.37.6/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=59423/0,dst=5432/0),tcp_flags(0x002/0x000)), packets:284105, bytes:111984639, used:0.000s, actions:pop_vlan,31
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=74:8e:f8:e8:26:06/00:00:00:00:00:00,dst=01:80:c2:00:00:02/00:00:00:00:00:00),eth_type(0x8809), packets:196651, bytes:24384724, used:0.780s, actions:userspace(pid=4294962602,slow_path(lacp))
skb_priority(0),in_port(vnet8),skb_mark(0/0),eth(src=52:54:00:63:df:3d,dst=52:54:00:c3:95:40),eth_type(0x0800),ipv4(src=10.144.34.11/255.255.255.255,dst=10.144.34.2/255.255.255.255,proto=1/0xff,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0,code=0), packets:3, bytes:294, used:0.328s, actions:push_vlan(vid=703,pcp=0),3
skb_priority(0),in_port(vnet5),skb_mark(0/0),eth(src=52:54:00:c9:f1:39,dst=52:54:00:a8:fe:27),eth_type(0x0800),ipv4(src=10.144.32.7/255.255.255.255,dst=10.144.32.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=54777,dst=5432),tcp_flags(0x002/0x000), packets:21, bytes:3544, used:0.140s, flags:FPR., actions:push_vlan(vid=700,pcp=0),3
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:02:06,dst=52:54:00:c1:43:d8),eth_type(0x8100),vlan(vid=701,pcp=0),encap(eth_type(0x86dd),ipv6(src=2a02:418:200f::89/::,dst=2a05:3784:0:701::13/::,label=0/0,proto=58/0,tclass=0/0,hlimit=60/0,frag=no/0xff),icmpv6(type=128/0,code=0/0)), packets:2, bytes:236, used:0.372s, actions:pop_vlan,27
skb_priority(0),in_port(vnet11),skb_mark(0/0),eth(src=52:54:00:37:44:e4,dst=52:54:00:16:63:4d),eth_type(0x0800),ipv4(src=10.144.34.5/255.255.255.255,dst=10.144.34.12/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=33056,dst=443),tcp_flags(0x002/0x000), packets:8, bytes:1197, used:1.008s, flags:PR., actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:db:8f:23,dst=52:54:00:23:63:f5),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.34.8/0.0.0.0,dst=10.144.34.9/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432/0,dst=43269/0),tcp_flags(0x012/0x000)), packets:8, bytes:2895, used:1.484s, actions:pop_vlan,15
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=00:00:5e:00:02:05,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=303,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)), packets:217320, bytes:20428080, used:0.548s, actions:pop_vlan,24,29,push_vlan(vid=303,pcp=0),1
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:7d:d7:a4),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=10.144.37.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5672,dst=50252),tcp_flags(0x018/0x000), packets:227, bytes:134201, used:0.304s, flags:P., actions:push_vlan(vid=708,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=00:00:5e:00:01:07,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=308,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.106/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0/0,ttl=255/0,frag=no/0xff)), packets:1095, bytes:65700, used:0.548s, actions:1,pop_vlan,33
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:16:63:4d,dst=52:54:00:37:44:e4),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.34.12/0.0.0.0,dst=10.144.34.5/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443/0,dst=33056/0),tcp_flags(0x012/0x000)), packets:5, bytes:16974, used:1.008s, actions:pop_vlan,17
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=90:e2:ba:80:f1:20,dst=66:a9:bf:ad:12:10),eth_type(0x8100),vlan(vid=305,pcp=0),encap(eth_type(0x0800),ipv4(src=10.132.193.26/0.0.0.0,dst=10.132.32.6/0.0.0.0,proto=6/0,tos=0x10/0,ttl=63/0,frag=no/0xff),tcp(src=34290/0,dst=22/0),tcp_flags(0x018/0x000)), packets:70, bytes:6588, used:0.012s, actions:pop_vlan,5
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:c0:4d:ef,dst=52:54:00:28:c5:3f),eth_type(0x8100),vlan(vid=704,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.35.4/0.0.0.0,dst=10.144.35.13/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=33969/0,dst=443/0),tcp_flags(0x002/0x000)), packets:8, bytes:1197, used:0.796s, actions:pop_vlan,26
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:44:d3:d3,dst=52:54:00:72:01:c5),eth_type(0x8100),vlan(vid=700,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.32.4/0.0.0.0,dst=10.144.32.13/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=53987/0,dst=443/0),tcp_flags(0x011/0x000)), packets:39, bytes:23893, used:0.036s, actions:pop_vlan,12
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:61:d1:e3,dst=52:54:00:29:ea:d9),eth_type(0x8100),vlan(vid=708,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.37.2/0.0.0.0,dst=10.144.37.5/0.0.0.0,proto=6/0,tos=0x10/0,ttl=63/0,frag=no/0xff),tcp(src=49554/0,dst=22/0),tcp_flags(0x010/0x000)), packets:1628, bytes:211092, used:0.504s, actions:pop_vlan,32
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:8e:38:d5,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=701,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.137/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0xc0/0,ttl=255/0,frag=no/0xff)), packets:5063, bytes:303780, used:0.536s, actions:pop_vlan,27,13,18,push_vlan(vid=701,pcp=0),1
skb_priority(0),in_port(vnet6),skb_mark(0/0),eth(src=52:54:00:72:01:c5,dst=52:54:00:84:e8:b0),eth_type(0x0800),ipv4(src=10.144.32.5/255.255.255.255,dst=10.144.32.6/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=48732,dst=443),tcp_flags(0x010/0x000), packets:2, bytes:132, used:0.992s, flags:., actions:push_vlan(vid=700,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:a8:fe:27,dst=52:54:00:39:45:f9),eth_type(0x8100),vlan(vid=700,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.32.8/0.0.0.0,dst=10.144.32.9/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432/0,dst=58241/0),tcp_flags(0x018/0x000)), packets:6175, bytes:11942688, used:0.140s, actions:pop_vlan,9
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:1a:5d:83,dst=52:54:00:35:b6:49),eth_type(0x8100),vlan(vid=700,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.32.2/0.0.0.0,dst=10.144.32.11/0.0.0.0,proto=1/0,tos=0/0,ttl=63/0,frag=no/0xff),icmp(type=8/0,code=0/0)), packets:3, bytes:294, used:0.328s, actions:pop_vlan,10
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:01:02,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=701,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.130/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0/0,ttl=255/0,frag=no/0xff)), packets:217320, bytes:13039200, used:0.548s, actions:pop_vlan,27,13,18,push_vlan(vid=701,pcp=0),1
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:7d:d7:a4),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=10.144.37.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432,dst=33497),tcp_flags(0x012/0x000), packets:27, bytes:12197, used:0.192s, flags:P., actions:push_vlan(vid=708,pcp=0),2
skb_priority(0),in_port(vnet6),skb_mark(0/0),eth(src=52:54:00:72:01:c5,dst=52:54:00:44:d3:d3),eth_type(0x0800),ipv4(src=10.144.32.13/255.255.255.255,dst=10.144.32.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443,dst=54127),tcp_flags(0x012/0x000), packets:6, bytes:8097, used:0.992s, flags:P., actions:push_vlan(vid=700,pcp=0),3
skb_priority(0),in_port(vnet5),skb_mark(0/0),eth(src=52:54:00:c9:f1:39,dst=52:54:00:44:d3:d3),eth_type(0x0800),ipv4(src=10.144.32.7/255.255.255.255,dst=10.144.32.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443,dst=36218),tcp_flags(0x010/0x000), packets:2, bytes:2805, used:1.396s, flags:P., actions:push_vlan(vid=700,pcp=0),3
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:02:06,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=701,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)), packets:217320, bytes:20428080, used:0.548s, actions:pop_vlan,27,13,18,push_vlan(vid=701,pcp=0),1
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:db:8f:23,dst=52:54:00:10:cd:9f),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.34.8/0.0.0.0,dst=10.144.34.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5672/0,dst=39750/0),tcp_flags(0x010/0x000)), packets:61725, bytes:86765509, used:0.000s, actions:pop_vlan,16
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:61:d1:e3),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=10.144.37.2/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5666,dst=53857),tcp_flags(0x012/0x000), packets:7, bytes:2000, used:1.432s, flags:FP., actions:push_vlan(vid=708,pcp=0),3
skb_priority(0),in_port(vnet10),skb_mark(0/0),eth(src=52:54:00:10:cd:9f,dst=52:54:00:db:8f:23),eth_type(0x0800),ipv4(src=10.144.34.7/255.255.255.255,dst=10.144.34.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=39750,dst=5672),tcp_flags(0x018/0x000), packets:0, bytes:0, used:never, actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(vnet19),skb_mark(0/0),eth(src=52:54:00:17:1b:2d,dst=52:54:00:2b:ec:0a),eth_type(0x0800),ipv4(src=10.144.35.7/255.255.255.255,dst=10.144.35.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=58421,dst=5432),tcp_flags(0x002/0x000), packets:438, bytes:327730, used:1.192s, flags:FPR., actions:push_vlan(vid=704,pcp=0),2
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:a8:fe:27,dst=52:54:00:c9:f1:39),eth_type(0x8100),vlan(vid=700,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.32.8/0.0.0.0,dst=10.144.32.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5672/0,dst=52137/0),tcp_flags(0x010/0x000)), packets:370, bytes:103785, used:0.012s, actions:pop_vlan,11
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:01:07,dst=ff:ff:ff:ff:ff:ff),eth_type(0x8100),vlan(vid=308,pcp=0),encap(eth_type(0x0806),arp(sip=185.72.20.105/255.255.255.255,tip=185.72.20.110/255.255.255.255,op=1/0xff,sha=00:00:5e:00:01:07/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00)), packets:2, bytes:120, used:0.904s, actions:1,pop_vlan,33
skb_priority(0x6),in_port(vlan305),skb_mark(0/0),eth(src=66:a9:bf:ad:12:10,dst=90:e2:ba:80:f1:20),eth_type(0x0800),ipv4(src=10.132.32.6/255.255.255.255,dst=10.132.193.26/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=64/0,frag=no/0xff),tcp(src=22,dst=34290),tcp_flags(0x018/0x000), packets:41, bytes:5398, used:0.012s, flags:P., actions:push_vlan(vid=305,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=90:e2:ba:80:f1:20,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=307/0xfff,pcp=0/0x0,cfi=1/1),encap(eth_type(0x0800),ipv4(src=10.132.16.2/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0xc0/0,ttl=255/0,frag=no/0xff)), packets:217320, bytes:13039200, used:0.548s, actions:1
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:f7:90:10,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=701,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.140/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0xc0/0,ttl=255/0,frag=no/0xff)), packets:4032, bytes:241920, used:0.544s, actions:pop_vlan,27,13,18,push_vlan(vid=701,pcp=0),1
skb_priority(0),in_port(vnet17),skb_mark(0/0),eth(src=52:54:00:3a:b6:ca,dst=52:54:00:4a:85:33),eth_type(0x0800),ipv4(src=10.144.33.5/255.255.255.255,dst=10.144.33.2/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5666,dst=44140),tcp_flags(0x012/0x000), packets:6, bytes:1934, used:1.004s, flags:FP., actions:push_vlan(vid=702,pcp=0),3
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:61:d1:e3),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=192.33.214.47/255.255.255.255,proto=17/0xff,tos=0xc0/0,ttl=64/0,frag=no/0xff),udp(src=123,dst=123), packets:0, bytes:0, used:never, actions:push_vlan(vid=708,pcp=0),3
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:02:04,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=304,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)), packets:217320, bytes:20428080, used:0.548s, actions:pop_vlan,6,push_vlan(vid=304,pcp=0),1
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:c3:95:40,dst=52:54:00:63:df:3d),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.34.2/0.0.0.0,dst=10.144.34.11/0.0.0.0,proto=1/0,tos=0/0,ttl=63/0,frag=no/0xff),icmp(type=8/0,code=0/0)), packets:12, bytes:2243, used:0.044s, actions:pop_vlan,14
skb_priority(0),in_port(vnet23),skb_mark(0/0),eth(src=52:54:00:ea:82:e7,dst=00:00:5e:00:01:01),eth_type(0x0800),ipv4(src=185.72.20.94/255.255.255.255,dst=5.148.182.89/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5666,dst=46305),tcp_flags(0x012/0x000), packets:6, bytes:1934, used:0.548s, flags:FP., actions:push_vlan(vid=303,pcp=0),2
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:02:05,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=303,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)), packets:217320, bytes:20428080, used:0.548s, actions:pop_vlan,24,29,push_vlan(vid=303,pcp=0),1
skb_priority(0x2),in_port(vlan305),skb_mark(0/0),eth(src=66:a9:bf:ad:12:10,dst=52:54:00:bf:66:6b),eth_type(0x0800),ipv4(src=10.132.32.6/255.255.255.255,dst=10.132.32.7/255.255.255.255,proto=6/0xff,tos=0x8/0,ttl=64/0,frag=no/0xff),tcp(src=22,dst=53010),tcp_flags(0x010/0x000), packets:2, bytes:232, used:0.412s, flags:P., actions:push_vlan(vid=305,pcp=0),2
skb_priority(0),in_port(vnet10),skb_mark(0/0),eth(src=52:54:00:10:cd:9f,dst=52:54:00:db:8f:23),eth_type(0x0800),ipv4(src=10.144.34.7/255.255.255.255,dst=10.144.34.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=33305,dst=5432),tcp_flags(0x018/0x000), packets:1267, bytes:1387526, used:0.000s, flags:P., actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(vnet6),skb_mark(0/0),eth(src=52:54:00:72:01:c5,dst=52:54:00:c9:f1:39),eth_type(0x0800),ipv4(src=10.144.32.5/0.0.0.0,dst=10.144.32.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=47732/0,dst=443/0),tcp_flags(0x018/0x000), packets:43, bytes:7645, used:0.140s, actions:11
skb_priority(0),in_port(vnet5),skb_mark(0/0),eth(src=52:54:00:c9:f1:39,dst=52:54:00:a8:fe:27),eth_type(0x0800),ipv4(src=10.144.32.7/255.255.255.255,dst=10.144.32.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=54778,dst=5432),tcp_flags(0x002/0x000), packets:13, bytes:2365, used:0.016s, flags:P., actions:push_vlan(vid=700,pcp=0),2
skb_priority(0),in_port(vnet0),skb_mark(0/0),eth(src=52:54:00:15:e5:23,dst=00:00:5e:00:01:03),eth_type(0x0800),ipv4(src=185.72.20.44/255.255.255.255,dst=5.148.182.89/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5666,dst=59452),tcp_flags(0x012/0x000), packets:7, bytes:2000, used:0.196s, flags:FP., actions:push_vlan(vid=304,pcp=0),2
skb_priority(0),in_port(vnet10),skb_mark(0/0),eth(src=52:54:00:10:cd:9f,dst=52:54:00:db:8f:23),eth_type(0x0800),ipv4(src=10.144.34.7/255.255.255.255,dst=10.144.34.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=39749,dst=5672),tcp_flags(0x010/0x000), packets:1, bytes:66, used:0.004s, flags:., actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(vnet5),skb_mark(0/0),eth(src=52:54:00:c9:f1:39,dst=52:54:00:a8:fe:27),eth_type(0x0800),ipv4(src=10.144.32.7/255.255.255.255,dst=10.144.32.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=52136,dst=5672),tcp_flags(0x010/0x000), packets:2, bytes:132, used:1.356s, flags:., actions:push_vlan(vid=700,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:1a:5d:83,dst=52:54:00:39:45:f9),eth_type(0x8100),vlan(vid=700,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.32.2/0.0.0.0,dst=10.144.32.9/0.0.0.0,proto=1/0,tos=0/0,ttl=63/0,frag=no/0xff),icmp(type=8/0,code=0/0)), packets:25, bytes:4584, used:0.864s, actions:pop_vlan,9
skb_priority(0),in_port(vnet3),skb_mark(0/0),eth(src=52:54:00:39:45:f9,dst=52:54:00:1a:5d:83),eth_type(0x0800),ipv4(src=10.144.32.9/255.255.255.255,dst=10.144.32.2/255.255.255.255,proto=1/0xff,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0,code=0), packets:2, bytes:196, used:0.864s, actions:push_vlan(vid=700,pcp=0),3
skb_priority(0x2),in_port(vlan305),skb_mark(0/0),eth(src=66:a9:bf:ad:12:10,dst=52:54:00:bf:66:6b),eth_type(0x0800),ipv4(src=10.132.32.6/255.255.255.255,dst=10.132.32.7/255.255.255.255,proto=6/0xff,tos=0x8/0,ttl=64/0,frag=no/0xff),tcp(src=22,dst=53012),tcp_flags(0x018/0x000), packets:3, bytes:266, used:0.412s, flags:P., actions:push_vlan(vid=305,pcp=0),2
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:c3:95:40,dst=52:54:00:63:df:3d),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.34.2/0.0.0.0,dst=10.144.34.11/0.0.0.0,proto=6/0,tos=0/0,ttl=63/0,frag=no/0xff),tcp(src=60019/0,dst=5666/0),tcp_flags(0x002/0x000)), packets:5, bytes:1646, used:0.060s, actions:pop_vlan,14
skb_priority(0),in_port(vnet26),skb_mark(0/0),eth(src=52:54:00:29:ea:d9,dst=52:54:00:61:d1:e3),eth_type(0x0800),ipv4(src=10.144.37.5/255.255.255.255,dst=10.144.37.2/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5666,dst=40630),tcp_flags(0x012/0x000), packets:6, bytes:1934, used:1.492s, flags:FP., actions:push_vlan(vid=708,pcp=0),2
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:c0:4d:ef,dst=52:54:00:17:1b:2d),eth_type(0x8100),vlan(vid=704,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.35.4/0.0.0.0,dst=10.144.35.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=57595/0,dst=443/0),tcp_flags(0x002/0x000)), packets:9, bytes:1366, used:1.192s, actions:pop_vlan,25
skb_priority(0),in_port(vnet3),skb_mark(0/0),eth(src=52:54:00:39:45:f9,dst=52:54:00:a8:fe:27),eth_type(0x0800),ipv4(src=10.144.32.9/255.255.255.255,dst=10.144.32.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=58241,dst=5432),tcp_flags(0x010/0x000), packets:2463, bytes:362050, used:0.140s, flags:P., actions:push_vlan(vid=700,pcp=0),3
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:2d:4e:b8,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=701,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.134/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0xc0/0,ttl=255/0,frag=no/0xff)), packets:44, bytes:2640, used:0.544s, actions:pop_vlan,27,13,18,push_vlan(vid=701,pcp=0),1
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:e6:19:c3,dst=52:54:00:17:1b:2d),eth_type(0x8100),vlan(vid=704,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.93/0.0.0.0,dst=10.144.35.7/0.0.0.0,proto=17/0,tos=0/0,ttl=62/0,frag=no/0xff),udp(src=53/0,dst=35352/0)), packets:2, bytes:464, used:1.088s, actions:pop_vlan,25
skb_priority(0),in_port(vnet6),skb_mark(0/0),eth(src=52:54:00:72:01:c5,dst=52:54:00:44:d3:d3),eth_type(0x0800),ipv4(src=10.144.32.13/255.255.255.255,dst=10.144.32.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443,dst=54130),tcp_flags(0x012/0x000), packets:5, bytes:3151, used:0.140s, flags:P., actions:push_vlan(vid=700,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:61:d1:e3,dst=52:54:00:43:5d:db),eth_type(0x8100),vlan(vid=708,pcp=0),encap(eth_type(0x0800),ipv4(src=192.33.214.47/0.0.0.0,dst=10.144.37.6/0.0.0.0,proto=17/0,tos=0xc0/0,ttl=53/0,frag=no/0xff),udp(src=123/0,dst=123/0)), packets:0, bytes:0, used:never, actions:pop_vlan,31
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:61:d1:e3),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=10.144.37.2/255.255.255.255,proto=1/0xff,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0,code=0), packets:2, bytes:196, used:0.864s, actions:push_vlan(vid=708,pcp=0),3
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:7d:d7:a4),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=10.144.37.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432,dst=33921),tcp_flags(0x018/0x000), packets:167, bytes:50964, used:0.000s, flags:P., actions:push_vlan(vid=708,pcp=0),3
skb_priority(0),in_port(vnet9),skb_mark(0/0),eth(src=52:54:00:23:63:f5,dst=52:54:00:c3:95:40),eth_type(0x0800),ipv4(src=10.144.34.9/255.255.255.255,dst=10.144.34.2/255.255.255.255,proto=1/0xff,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0,code=0), packets:2, bytes:196, used:0.864s, actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(vnet10),skb_mark(0/0),eth(src=52:54:00:10:cd:9f,dst=52:54:00:c3:95:40),eth_type(0x0800),ipv4(src=10.144.34.7/255.255.255.255,dst=185.72.20.93/255.255.255.255,proto=17/0xff,tos=0/0,ttl=64/0,frag=no/0xff),udp(src=43359,dst=53), packets:0, bytes:0, used:never, actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(vnet10),skb_mark(0/0),eth(src=52:54:00:10:cd:9f,dst=52:54:00:16:63:4d),eth_type(0x0800),ipv4(src=10.144.34.7/255.255.255.255,dst=10.144.34.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443,dst=48457),tcp_flags(0x012/0x000), packets:11, bytes:31606, used:1.008s, flags:FP., actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(vnet19),skb_mark(0/0),eth(src=52:54:00:17:1b:2d,dst=52:54:00:e6:19:c3),eth_type(0x0800),ipv4(src=10.144.35.7/255.255.255.255,dst=185.72.20.93/255.255.255.255,proto=17/0xff,tos=0/0,ttl=64/0,frag=no/0xff),udp(src=57686,dst=53), packets:0, bytes:0, used:never, actions:push_vlan(vid=704,pcp=0),3
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:01:03,dst=ff:ff:ff:ff:ff:ff),eth_type(0x8100),vlan(vid=304,pcp=0),encap(eth_type(0x0806),arp(sip=185.72.20.33/255.255.255.255,tip=185.72.20.59/255.255.255.255,op=1/0xff,sha=00:00:5e:00:01:03/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00)), packets:5, bytes:300, used:1.437s, actions:pop_vlan,6,push_vlan(vid=304,pcp=0),1
skb_priority(0),in_port(vnet9),skb_mark(0/0),eth(src=52:54:00:23:63:f5,dst=52:54:00:c3:95:40),eth_type(0x0800),ipv4(src=10.144.34.9/255.255.255.255,dst=185.72.20.93/255.255.255.255,proto=17/0xff,tos=0/0,ttl=64/0,frag=no/0xff),udp(src=49899,dst=53), packets:0, bytes:0, used:never, actions:push_vlan(vid=703,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:a8:fe:27,dst=52:54:00:c9:f1:39),eth_type(0x8100),vlan(vid=700,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.32.8/0.0.0.0,dst=10.144.32.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432/0,dst=54777/0),tcp_flags(0x012/0x000)), packets:17, bytes:4293, used:0.141s, actions:pop_vlan,11
skb_priority(0),in_port(vnet20),skb_mark(0/0),eth(src=52:54:00:28:c5:3f,dst=52:54:00:c0:4d:ef),eth_type(0x0800),ipv4(src=10.144.35.5/255.255.255.255,dst=10.144.35.12/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=55084,dst=443),tcp_flags(0x002/0x000), packets:5, bytes:999, used:0.253s, flags:P., actions:push_vlan(vid=704,pcp=0),2
skb_priority(0),in_port(vnet9),skb_mark(0/0),eth(src=52:54:00:23:63:f5,dst=52:54:00:db:8f:23),eth_type(0x0800),ipv4(src=10.144.34.9/255.255.255.255,dst=10.144.34.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=43269,dst=5432),tcp_flags(0x002/0x000), packets:12, bytes:1676, used:1.485s, flags:FPR., actions:push_vlan(vid=703,pcp=0),3
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:7d:d7:a4,dst=52:54:00:43:5d:db),eth_type(0x8100),vlan(vid=708,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.37.4/0.0.0.0,dst=10.144.37.6/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=33491/0,dst=5432/0),tcp_flags(0x002/0x000)), packets:200, bytes:86289, used:0.013s, actions:pop_vlan,31
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:4a:85:33,dst=52:54:00:3a:b6:ca),eth_type(0x8100),vlan(vid=702,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.33.2/0.0.0.0,dst=10.144.33.5/0.0.0.0,proto=6/0,tos=0/0,ttl=63/0,frag=no/0xff),tcp(src=44140/0,dst=5666/0),tcp_flags(0x002/0x000)), packets:8, bytes:1875, used:1.005s, actions:pop_vlan,23
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:7d:d7:a4),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=10.144.37.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432,dst=33499),tcp_flags(0x012/0x000), packets:39, bytes:27414, used:0.013s, flags:P., actions:push_vlan(vid=708,pcp=0),3
skb_priority(0),in_port(vnet5),skb_mark(0/0),eth(src=52:54:00:c9:f1:39,dst=52:54:00:a8:fe:27),eth_type(0x0800),ipv4(src=10.144.32.7/255.255.255.255,dst=10.144.32.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=54774,dst=5432),tcp_flags(0x002/0x000), packets:48, bytes:11052, used:1.397s, flags:FPR., actions:push_vlan(vid=700,pcp=0),2
skb_priority(0),in_port(vnet5),skb_mark(0/0),eth(src=52:54:00:c9:f1:39,dst=52:54:00:72:01:c5),eth_type(0x0800),ipv4(src=10.144.32.7/0.0.0.0,dst=10.144.32.5/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443/0,dst=47732/0),tcp_flags(0x010/0x000), packets:37, bytes:64050, used:0.141s, actions:12
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=00:00:5e:00:02:04,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=304,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)), packets:217320, bytes:20428080, used:0.549s, actions:pop_vlan,6,push_vlan(vid=304,pcp=0),1
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=74:8e:f8:ce:81:4c/00:00:00:00:00:00,dst=01:80:c2:00:00:02/00:00:00:00:00:00),eth_type(0x8809), packets:196651, bytes:24384724, used:0.609s, actions:userspace(pid=4294962602,slow_path(lacp))
skb_priority(0),in_port(vnet26),skb_mark(0/0),eth(src=52:54:00:29:ea:d9,dst=52:54:00:61:d1:e3),eth_type(0x0800),ipv4(src=10.144.37.5/255.255.255.255,dst=10.144.37.2/255.255.255.255,proto=6/0xff,tos=0x10/0,ttl=64/0,frag=no/0xff),tcp(src=22,dst=49554),tcp_flags(0x018/0x000), packets:1121, bytes:399566, used:0.569s, flags:P., actions:push_vlan(vid=708,pcp=0),2
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:84:e8:b0,dst=52:54:00:72:01:c5),eth_type(0x8100),vlan(vid=700,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.32.6/0.0.0.0,dst=10.144.32.5/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443/0,dst=48727/0),tcp_flags(0x010/0x000)), packets:6, bytes:55296, used:0.993s, actions:pop_vlan,12
skb_priority(0),in_port(vnet23),skb_mark(0/0),eth(src=52:54:00:ea:82:e7,dst=00:00:5e:00:01:01),eth_type(0x0800),ipv4(src=185.72.20.94/255.255.255.255,dst=5.148.182.89/255.255.255.255,proto=1/0xff,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0,code=0), packets:0, bytes:0, used:never, actions:push_vlan(vid=303,pcp=0),3
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=d4:ca:6d:01:ba:81,dst=52:54:00:15:e5:23),eth_type(0x8100),vlan(vid=304,pcp=0),encap(eth_type(0x0800),ipv4(src=5.148.182.89/0.0.0.0,dst=185.72.20.44/0.0.0.0,proto=6/0,tos=0/0,ttl=60/0,frag=no/0xff),tcp(src=59452/0,dst=5666/0),tcp_flags(0x002/0x000)), packets:8, bytes:1875, used:0.197s, actions:pop_vlan,6
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:44:d3:d3,dst=52:54:00:c9:f1:39),eth_type(0x8100),vlan(vid=700,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.32.4/0.0.0.0,dst=10.144.32.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=36163/0,dst=443/0),tcp_flags(0x018/0x000)), packets:11, bytes:3219, used:0.033s, actions:pop_vlan,11
skb_priority(0),in_port(vnet5),skb_mark(0/0),eth(src=52:54:00:c9:f1:39,dst=52:54:00:a8:fe:27),eth_type(0x0800),ipv4(src=10.144.32.7/255.255.255.255,dst=10.144.32.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=52137,dst=5672),tcp_flags(0x018/0x000), packets:1, bytes:347, used:1.357s, flags:P., actions:push_vlan(vid=700,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=00:00:5e:00:02:08,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=308,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)), packets:1095, bytes:102930, used:0.549s, actions:1,pop_vlan,33
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:6c:de:98,dst=52:54:00:28:c5:3f),eth_type(0x8100),vlan(vid=704,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.35.6/0.0.0.0,dst=10.144.35.5/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443/0,dst=39088/0),tcp_flags(0x012/0x000)), packets:8, bytes:31327, used:0.793s, actions:pop_vlan,26
skb_priority(0),in_port(vnet19),skb_mark(0/0),eth(src=52:54:00:17:1b:2d,dst=52:54:00:c0:4d:ef),eth_type(0x0800),ipv4(src=10.144.35.7/255.255.255.255,dst=10.144.35.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443,dst=57595),tcp_flags(0x012/0x000), packets:10, bytes:31459, used:1.193s, flags:P., actions:push_vlan(vid=704,pcp=0),2
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:c0:4d:ef,dst=52:54:00:28:c5:3f),eth_type(0x8100),vlan(vid=704,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.35.12/0.0.0.0,dst=10.144.35.5/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443/0,dst=55084/0),tcp_flags(0x012/0x000)), packets:3, bytes:340, used:0.253s, actions:pop_vlan,26
skb_priority(0),in_port(vnet19),skb_mark(0/0),eth(src=52:54:00:17:1b:2d,dst=52:54:00:2b:ec:0a),eth_type(0x0800),ipv4(src=10.144.35.7/255.255.255.255,dst=10.144.35.8/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=58423,dst=5432),tcp_flags(0x002/0x000), packets:438, bytes:327730, used:0.721s, flags:FPR., actions:push_vlan(vid=704,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=90:e2:ba:80:f1:20,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=305,pcp=0),encap(eth_type(0x0800),ipv4(src=10.132.32.2/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0xc0/0,ttl=255/0,frag=no/0xff)), packets:217320, bytes:13039200, used:0.549s, actions:pop_vlan,5,push_vlan(vid=305,pcp=0),1
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:bf:66:6b,dst=66:a9:bf:ad:12:10),eth_type(0x8100),vlan(vid=305,pcp=0),encap(eth_type(0x0800),ipv4(src=10.132.32.7/0.0.0.0,dst=10.132.32.6/0.0.0.0,proto=6/0,tos=0x8/0,ttl=64/0,frag=no/0xff),tcp(src=53010/0,dst=22/0),tcp_flags(0x018/0x000)), packets:3, bytes:402, used:0.453s, actions:pop_vlan,5
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:c3:95:40,dst=52:54:00:10:cd:9f),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.93/0.0.0.0,dst=10.144.34.7/0.0.0.0,proto=17/0,tos=0/0,ttl=62/0,frag=no/0xff),udp(src=53/0,dst=43359/0)), packets:2, bytes:329, used:0.572s, actions:pop_vlan,16
skb_priority(0),in_port(vnet19),skb_mark(0/0),eth(src=52:54:00:17:1b:2d,dst=52:54:00:28:c5:3f),eth_type(0x0800),ipv4(src=10.144.35.7/0.0.0.0,dst=10.144.35.5/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443/0,dst=43265/0),tcp_flags(0x012/0x000), packets:10, bytes:31459, used:0.720s, actions:26
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:c3:95:40,dst=52:54:00:23:63:f5),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.34.2/0.0.0.0,dst=10.144.34.9/0.0.0.0,proto=1/0,tos=0/0,ttl=63/0,frag=no/0xff),icmp(type=8/0,code=0/0)), packets:4, bytes:660, used:0.864s, actions:pop_vlan,15
skb_priority(0),in_port(vnet8),skb_mark(0/0),eth(src=52:54:00:63:df:3d,dst=52:54:00:c3:95:40),eth_type(0x0800),ipv4(src=10.144.34.11/255.255.255.255,dst=10.144.34.2/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5666,dst=60019),tcp_flags(0x012/0x000), packets:4, bytes:706, used:0.020s, flags:P., actions:push_vlan(vid=703,pcp=0),3
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:2b:ec:0a,dst=52:54:00:17:1b:2d),eth_type(0x8100),vlan(vid=704,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.35.8/0.0.0.0,dst=10.144.35.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432/0,dst=58421/0),tcp_flags(0x012/0x000)), packets:602, bytes:830766, used:0.720s, actions:pop_vlan,25
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=90:e2:ba:80:f1:20,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=304,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.37/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0xc0/0,ttl=255/0,frag=no/0xff)), packets:217320, bytes:13473840, used:0.544s, actions:pop_vlan,6,push_vlan(vid=304,pcp=0),1
skb_priority(0),in_port(vnet20),skb_mark(0/0),eth(src=52:54:00:28:c5:3f,dst=52:54:00:17:1b:2d),eth_type(0x0800),ipv4(src=10.144.35.5/0.0.0.0,dst=10.144.35.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=43265/0,dst=443/0),tcp_flags(0x002/0x000), packets:10, bytes:1432, used:0.720s, actions:25
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:1a:5d:83,dst=52:54:00:c9:f1:39),eth_type(0x8100),vlan(vid=700,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.32.2/0.0.0.0,dst=10.144.32.7/0.0.0.0,proto=6/0,tos=0/0,ttl=63/0,frag=no/0xff),tcp(src=60646/0,dst=5666/0),tcp_flags(0x002/0x000)), packets:8, bytes:1875, used:0.244s, actions:pop_vlan,11
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:e0:2d:d3,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=304,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.43/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0xc0/0,ttl=255/0,frag=no/0xff)), packets:1968, bytes:224352, used:0.544s, actions:pop_vlan,6,push_vlan(vid=304,pcp=0),1
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:61:d1:e3,dst=52:54:00:43:5d:db),eth_type(0x8100),vlan(vid=708,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.37.2/0.0.0.0,dst=10.144.37.6/0.0.0.0,proto=6/0,tos=0/0,ttl=63/0,frag=no/0xff),tcp(src=49509/0,dst=15672/0),tcp_flags(0x018/0x000)), packets:40, bytes:4091, used:0.864s, actions:pop_vlan,31
skb_priority(0),in_port(vnet5),skb_mark(0/0),eth(src=52:54:00:c9:f1:39,dst=52:54:00:44:d3:d3),eth_type(0x0800),ipv4(src=10.144.32.7/255.255.255.255,dst=10.144.32.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443,dst=36416),tcp_flags(0x012/0x000), packets:4, bytes:4191, used:0.032s, flags:P., actions:push_vlan(vid=700,pcp=0),2
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=52:54:00:c3:95:40,dst=52:54:00:10:cd:9f),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=195.134.137.236/0.0.0.0,dst=10.144.34.7/0.0.0.0,proto=6/0,tos=0/0,ttl=115/0,frag=no/0xff),tcp(src=80/0,dst=56213/0),tcp_flags(0x012/0x000)), packets:18, bytes:57944, used:0.552s, actions:pop_vlan,16
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:16:63:4d,dst=52:54:00:10:cd:9f),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.34.4/0.0.0.0,dst=10.144.34.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=48457/0,dst=443/0),tcp_flags(0x002/0x000)), packets:10, bytes:1432, used:1.008s, actions:pop_vlan,16
skb_priority(0),in_port(vnet20),skb_mark(0/0),eth(src=52:54:00:28:c5:3f,dst=52:54:00:c0:4d:ef),eth_type(0x0800),ipv4(src=10.144.35.13/255.255.255.255,dst=10.144.35.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=443,dst=33969),tcp_flags(0x012/0x000), packets:7, bytes:17106, used:0.796s, flags:P., actions:push_vlan(vid=704,pcp=0),3
skb_priority(0),in_port(vnet21),skb_mark(0/0),eth(src=52:54:00:c1:43:d8,dst=00:00:5e:00:02:06),eth_type(0x86dd),ipv6(src=2a05:3784:0:701::13/ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff,dst=2a02:418:200f::89/ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff,label=0/0,proto=58/0xff,tclass=0/0,hlimit=64/0,frag=no/0xff),icmpv6(type=129,code=0), packets:2, bytes:236, used:0.372s, actions:push_vlan(vid=701,pcp=0),3
skb_priority(0),in_port(vnet10),skb_mark(0/0),eth(src=52:54:00:10:cd:9f,dst=52:54:00:c3:95:40),eth_type(0x0800),ipv4(src=10.144.34.7/255.255.255.255,dst=195.134.137.236/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=56213,dst=80),tcp_flags(0x002/0x000), packets:19, bytes:1437, used:0.552s, flags:FP., actions:push_vlan(vid=703,pcp=0),2
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=52:54:00:db:8f:23,dst=52:54:00:10:cd:9f),eth_type(0x8100),vlan(vid=703,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.34.8/0.0.0.0,dst=10.144.34.7/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432/0,dst=33381/0),tcp_flags(0x012/0x000)), packets:20, bytes:5247, used:1.008s, actions:pop_vlan,16
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=d4:ca:6d:01:ba:81,dst=52:54:00:ea:82:e7),eth_type(0x8100),vlan(vid=303,pcp=0),encap(eth_type(0x0800),ipv4(src=5.148.182.89/0.0.0.0,dst=185.72.20.94/0.0.0.0,proto=6/0,tos=0/0,ttl=61/0,frag=no/0xff),tcp(src=46305/0,dst=5666/0),tcp_flags(0x002/0x000)), packets:9, bytes:1973, used:0.408s, actions:pop_vlan,29
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=00:00:5e:00:01:03,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=304,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.34/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0/0,ttl=255/0,frag=no/0xff)), packets:217320, bytes:13039200, used:0.548s, actions:pop_vlan,6,push_vlan(vid=304,pcp=0),1
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:7d:d7:a4),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=10.144.37.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432,dst=33491),tcp_flags(0x012/0x000), packets:155, bytes:80113, used:0.416s, flags:P., actions:push_vlan(vid=708,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=90:e2:ba:80:f1:20,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=707,pcp=0),encap(eth_type(0x0800),ipv4(src=10.144.8.2/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0xc0/0,ttl=255/0,frag=no/0xff)), packets:217320, bytes:13039200, used:0.548s, actions:pop_vlan,28,push_vlan(vid=707,pcp=0),1
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:7d:d7:a4),eth_type(0x0800),ipv4(src=10.144.37.6/255.255.255.255,dst=10.144.37.4/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5432,dst=33495),tcp_flags(0x012/0x000), packets:22, bytes:9353, used:0.272s, flags:P., actions:push_vlan(vid=708,pcp=0),2
skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:02:08,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=308,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)), packets:1095, bytes:102930, used:0.548s, actions:1,pop_vlan,33
skb_priority(0),in_port(vnet25),skb_mark(0/0),eth(src=52:54:00:43:5d:db,dst=52:54:00:29:ea:d9),eth_type(0x0800),ipv4(src=10.144.37.6/0.0.0.0,dst=10.144.37.5/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5672/0,dst=40296/0),tcp_flags(0x012/0x000), packets:45318602, bytes:28548714449, used:0.000s, actions:32
skb_priority(0),in_port(vnet8),skb_mark(0/0),eth(src=52:54:00:63:df:3d,dst=52:54:00:c3:95:40),eth_type(0x0800),ipv4(src=10.144.34.11/255.255.255.255,dst=10.144.34.2/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=5666,dst=60020),tcp_flags(0x012/0x000), packets:6, bytes:1934, used:0.044s, flags:FP., actions:push_vlan(vid=703,pcp=0),3
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=00:00:5e:00:01:01,dst=01:00:5e:00:00:12),eth_type(0x8100),vlan(vid=303,pcp=0),encap(eth_type(0x0800),ipv4(src=185.72.20.66/0.0.0.0,dst=224.0.0.18/0.0.0.0,proto=112/0,tos=0/0,ttl=255/0,frag=no/0xff)), packets:217320, bytes:13039200, used:0.548s, actions:pop_vlan,24,29,push_vlan(vid=303,pcp=0),1
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=00:00:5e:00:02:06,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=701,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)), packets:217320, bytes:20428080, used:0.548s, actions:pop_vlan,27,13,18,push_vlan(vid=701,pcp=0),1
skb_priority(0),in_port(vnet26),skb_mark(0/0),eth(src=52:54:00:29:ea:d9,dst=52:54:00:43:5d:db),eth_type(0x0800),ipv4(src=10.144.37.5/0.0.0.0,dst=10.144.37.6/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=40296/0,dst=5672/0),tcp_flags(0x002/0x000), packets:44286324, bytes:22273958925, used:0.000s, actions:31
skb_priority(0),in_port(vnet20),skb_mark(0/0),eth(src=52:54:00:28:c5:3f,dst=52:54:00:6c:de:98),eth_type(0x0800),ipv4(src=10.144.35.5/255.255.255.255,dst=10.144.35.6/255.255.255.255,proto=6/0xff,tos=0/0,ttl=64/0,frag=no/0xff),tcp(src=39088,dst=443),tcp_flags(0x002/0x000), packets:10, bytes:1432, used:0.792s, flags:FP., actions:push_vlan(vid=704,pcp=0),3
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 819 bytes
Desc: This is a digitally signed message part.
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150306/a857f520/attachment-0001.sig>

From cheng at cs.umn.edu  Fri Mar  6 09:10:00 2015
From: cheng at cs.umn.edu (Cheng Jin)
Date: Fri, 6 Mar 2015 11:10:00 -0600
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <20150306055355.GB24732@nicira.com>
References: <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
 <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
 <20150305055042.GA25472@nicira.com>
 <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>
 <CACjuMbzi4CtNa=t3=HDmtU4Rcbm58GTZXQq2S3j4MxBYThs1-g@mail.gmail.com>
 <CAMg13efcjPeYdvdPTi3n93zSvCrQ2O-sYRz7SSxuGkFLWy0RyA@mail.gmail.com>
 <20150306043641.GA24732@nicira.com>
 <CAMg13eds7ixdSuvOjvS0vS+-dACAaSG3f9W566m16HJ7YSmYZA@mail.gmail.com>
 <20150306055355.GB24732@nicira.com>
Message-ID: <CAMg13edmF=3Q87CnGp4iJ7pPCb8XdnJt6N-abPoC-Fr4hP99wg@mail.gmail.com>

On Thu, Mar 5, 2015 at 11:53 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Mar 05, 2015 at 10:42:12PM -0600, Cheng Jin wrote:
> > Attached please find the log file. Thanks for your time and help.
>
> Thanks.  I'm adding back the mailing list to continue the discussion.
>
> Consider 00:00:00:00:00:02 in bridge s1 (it would be a lot easier to
> read the log if there were only one bridge, by the way).  We initially
> see this getting learned on port s1-eth1 (in_port(2)) when a packet
> arrives for it.  OVS forwards the packet and sets up a kernel cache
> entry:
>
>     2015-03-06T03:01:06.923Z|00019|dpif(handler671)|DBG|system at ovs-system:
> miss upcall:
>
> dp_hash(0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0806),arp(sip=10.0.0.2,tip=10.0.0.1,op=2,sha=00:00:00:00:00:02,tha=00:00:00:00:00:01))
>
> arp,metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,arp_spa=10.0.0.2,arp_tpa=10.0.0.1,arp_op=2,arp_sha=00:00:00:00:00:02,arp_tha=00:00:00:00:00:01
>
> 2015-03-06T03:01:06.923Z|00020|ofproto_dpif_xlate(handler671)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
>     2015-03-06T03:01:06.923Z|00021|dpif(handler671)|DBG|system at ovs-system:
> put[create]
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0806),arp(sip=
> 10.0.0.2/0.0.0.0,tip=10.0.0.1/0.0.0.0,op=2/0,sha=00:00:00:00:00:02/00:00:00:00:00:00,tha=00:00:00:00:00:01/00:00:00:00:00:00)),
> actions:pop_vlan,4
>     2015-03-06T03:01:06.923Z|00022|dpif(handler671)|DBG|system at ovs-system:
> execute pop_vlan,4 on packet
> arp,metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,arp_spa=10.0.0.2,arp_tpa=10.0.0.1,arp_op=2,arp_sha=00:00:00:00:00:02,arp_tha=00:00:00:00:00:01
>
> A few seconds later, a packet with the same source arrives on s1-eth2
> (in_port(3)).  OVS learns the new port for the MAC and again forwards
> the packet and sets up a kernel cache entry:
>
>     2015-03-06T03:01:11.367Z|00036|dpif(handler671)|DBG|system at ovs-system:
> miss upcall:
>
> dp_hash(0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap()
>
> metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,dl_type=0x05ff
>     2015-03-06T03:01:11.367Z|00037|dpif(handler671)|DBG|system at ovs-system:
> get_stats success
>
> 2015-03-06T03:01:11.367Z|00038|ofproto_dpif_xlate(handler671)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
>     2015-03-06T03:01:11.368Z|00039|dpif(handler671)|DBG|system at ovs-system:
> put[create]
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(),
> actions:pop_vlan,4
>     2015-03-06T03:01:11.368Z|00040|dpif(handler671)|DBG|system at ovs-system:
> execute pop_vlan,4 on packet
> metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,dl_type=0x05ff
>     2015-03-06T03:01:11.368Z|04443|dpif|DBG|system at ovs-system: execute 10
> on packet
> metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,dl_type=0x05ff
>
> This is when things get murky.  About 79 ms later, another 5 packets
> arrive with the same MAC arrives on the original port, s1-eth1 (you can
> tell the time and the count from "idle" and packets" below).


Actually the ping packets periodically come (one ping per second), so all
the counters reach "packets:4" before OVS learns the new port (s1-eth2,
namely in_port(3)).

2015-03-06T03:01:10.896Z|00166|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump_start success
2015-03-06T03:01:10.897Z|00167|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(8),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x0800),ipv4(src=
10.0.0.2/0.0.0.0,dst=10.0.0.1/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0/0,code=0/0),
packets:4, bytes:392, used:0.449s, actions:push_vlan(vid=100,pcp=0),6
2015-03-06T03:01:10.897Z|00168|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0800),ipv4(src=
10.0.0.2/0.0.0.0,dst=10.0.0.1/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0/0,code=0/0)),
packets:4, bytes:392, used:0.449s, actions:pop_vlan,4
2015-03-06T03:01:10.897Z|00169|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(4),skb_mark(0/0),eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),eth_type(0x0800),ipv4(src=
10.0.0.1/0.0.0.0,dst=10.0.0.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=8/0,code=0/0),
packets:4, bytes:392, used:0.949s, actions:push_vlan(vid=100,pcp=0),2
2015-03-06T03:01:10.897Z|00170|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(6),skb_mark(0/0),eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0800),ipv4(src=
10.0.0.1/0.0.0.0,dst=10.0.0.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=8/0,code=0/0)),
packets:4, bytes:392, used:0.949s, actions:pop_vlan,8
2015-03-06T03:01:10.897Z|00171|dpif(revalidator670)|DBG|system at ovs-system:
dumped all flows
2015-03-06T03:01:10.898Z|00172|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump_done success

What confusing me is that: after the switch learns the new port
(in_port(3)) to the same MAC (00:00:00:00:00:02), why it does not forward
the packet received from h1 (in_port(4)) to the new port? Instead, it still
forwards the packet to the old port (in_port(2)) even before it relearns
the old port.

2015-03-06T03:01:11.369Z|00177|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(),
packets:0, bytes:0, used:never, actions:pop_vlan,4
2015-03-06T03:01:11.369Z|00178|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0800),ipv4(src=
10.0.0.2/0.0.0.0,dst=10.0.0.1/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0/0,code=0/0)),
packets:4, bytes:392, used:0.920s, actions:pop_vlan,4
2015-03-06T03:01:11.369Z|00179|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(4),skb_mark(0/0),eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),eth_type(0x0800),ipv4(src=
10.0.0.1/0.0.0.0,dst=10.0.0.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=8/0,code=0/0),
packets:5, bytes:490, used:0.420s, actions:push_vlan(vid=100,pcp=0),2

The first two rules have the same source and destination MAC but different
in_ports, and the third rule has one of the two in_ports as output port.
Seems to me these rules did not properly reflect the symmetric property of
standard Ethernet forwarding. When a packet with source MAC
00:00:00:00:00:02 reaches the switch from a port, the packet with
destination MAC 00:00:00:00:00:02 should also leaves at the same port, but
it leaves at another port.


The kernel
> cache entry for that flow is still there, so userspace only notices the
> next time it checks the kernel cache statistics.  At that point, it
> re-learns the old address:
>
>
> 2015-03-06T03:01:11.871Z|00201|dpif(revalidator670)|DBG|system at ovs-system:
> flow_dump
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(),
> packets:0, bytes:0, used:never, actions:pop_vlan,4
>
> 2015-03-06T03:01:11.872Z|00202|dpif(revalidator670)|DBG|system at ovs-system:
> flow_dump
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0800),ipv4(src=
> 10.0.0.2/0.0.0.0,dst=10.0.0.1/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0/0,code=0/0)),
> packets:5, bytes:490, used:0.421s, actions:pop_vlan,4
>
> 2015-03-06T03:01:11.872Z|00203|ofproto_dpif_xlate(revalidator670)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
>
> Similarly, there's another packet on s1-eth2 a bit later and that port
> is relearned:
>
>
> 2015-03-06T03:01:12.377Z|00222|dpif(revalidator670)|DBG|system at ovs-system:
> flow_dump
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(),
> packets:1, bytes:42, used:0.005s, actions:pop_vlan,4
>
> 2015-03-06T03:01:12.377Z|00223|ofproto_dpif_xlate(revalidator670)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
>
> and so on
>
> In other words, I see that MAC bouncing back and forth because there's
> continuing traffic for it arriving on both ports.  There is some
> hysteresis to the bouncing because it only gets processed when OVS looks
> at kernel statistics.
>
> If this isn't the MAC that you're having trouble with (in that log) then
> can you be specific about which MAC and bridge you're looking at?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150306/abb69f9a/attachment.html>

From nuno.carrulo at ua.pt  Fri Mar  6 12:47:02 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Fri, 6 Mar 2015 20:47:02 +0000
Subject: [ovs-discuss] Queue added but not shown using ovs-ofctl
In-Reply-To: <20150305191504.GC20780@nicira.com>
References: <1425558128155.62351@ua.pt> <20150305163245.GH25472@nicira.com>
 <1425576047545.7989@ua.pt>,<20150305191504.GC20780@nicira.com>
Message-ID: <1425674817204.52599@ua.pt>

I don't need to start it, I just launch the topology. I think mininet vm already has scripts to launch it at boot. However after I start the VM i checked the processes that are running and i got this: http://pastebin.com/13bYMN3K

Logs seem to be being saved in the same place according to this excert of the process ovs-vswitchd '--log-file=/usr/var/log/openvswitch/ovs-vswitchd.log'.

However as i mentioned in previous emails, the last info I have on that is about openvswitch 2.0.2 and I have no problem in running mininet with openvswitch 2.3.

Regards, 
Nuno B.
________________________________________
De: Ben Pfaff <blp at nicira.com>
Enviado: 5 de março de 2015 19:15
Para: Rui Braz
Cc: mininet-discuss at lists.stanford.edu
Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl

On Thu, Mar 05, 2015 at 05:20:51PM +0000, Rui Braz wrote:
> I've upgraded the OVS from 2.0.2 to 2.3 using this script: http://pastebin.com/3ViQxg7D. Script was on github from mininet if I'm not mistaken.
>
> After doing that the logs generated from OVS are not sent to /var/log/openvswitch because when I go there and print the log only appears to me the log from last version which is 2.0.2 as you may see here: http://pastebin.com/Tf4VtAtz
>
> Are the logs being generated elsewhere ?

When you start ovs-vswitchd, where you do tell it to put the log?

> Also I'm able to see the queues I've created if I do "sudo ovs-vsctl list queue".

Not relevant.

From blp at nicira.com  Fri Mar  6 13:05:39 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Mar 2015 13:05:39 -0800
Subject: [ovs-discuss] Queue added but not shown using ovs-ofctl
In-Reply-To: <1425674817204.52599@ua.pt>
References: <1425558128155.62351@ua.pt> <20150305163245.GH25472@nicira.com>
 <1425576047545.7989@ua.pt> <20150305191504.GC20780@nicira.com>
 <1425674817204.52599@ua.pt>
Message-ID: <20150306210539.GC22286@nicira.com>

OK.

I don't know how to help without the log.  I guess you'll have to
figure out what's going on there first.

On Fri, Mar 06, 2015 at 08:47:02PM +0000, Rui Braz wrote:
> I don't need to start it, I just launch the topology. I think mininet vm already has scripts to launch it at boot. However after I start the VM i checked the processes that are running and i got this: http://pastebin.com/13bYMN3K
> 
> Logs seem to be being saved in the same place according to this excert of the process ovs-vswitchd '--log-file=/usr/var/log/openvswitch/ovs-vswitchd.log'.
> 
> However as i mentioned in previous emails, the last info I have on that is about openvswitch 2.0.2 and I have no problem in running mininet with openvswitch 2.3.
> 
> Regards, 
> Nuno B.
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 5 de mar?o de 2015 19:15
> Para: Rui Braz
> Cc: mininet-discuss at lists.stanford.edu
> Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> 
> On Thu, Mar 05, 2015 at 05:20:51PM +0000, Rui Braz wrote:
> > I've upgraded the OVS from 2.0.2 to 2.3 using this script: http://pastebin.com/3ViQxg7D. Script was on github from mininet if I'm not mistaken.
> >
> > After doing that the logs generated from OVS are not sent to /var/log/openvswitch because when I go there and print the log only appears to me the log from last version which is 2.0.2 as you may see here: http://pastebin.com/Tf4VtAtz
> >
> > Are the logs being generated elsewhere ?
> 
> When you start ovs-vswitchd, where you do tell it to put the log?
> 
> > Also I'm able to see the queues I've created if I do "sudo ovs-vsctl list queue".
> 
> Not relevant.

From blp at nicira.com  Fri Mar  6 13:13:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Mar 2015 13:13:45 -0800
Subject: [ovs-discuss] OFPMT_TABLE_FEATURES is supported in OVS or not
In-Reply-To: <CAHWErLcFDMZKUMuRNE=OmHcG6p4EAXNBRoqzGY236NFg2=vLVA@mail.gmail.com>
References: <CAHWErLdteurXa9CFvgXB8wy4ax_qAD1PhNd6CkWEJJs+cWWszg@mail.gmail.com>
 <20150304162013.GC18294@nicira.com>
 <CAHWErLdqWn+taQxqJCpOYYLRdiHeh5h90YbZVkndXsN+68O=ZA@mail.gmail.com>
 <20150305002216.GD12423@nicira.com>
 <CAHWErLcFDMZKUMuRNE=OmHcG6p4EAXNBRoqzGY236NFg2=vLVA@mail.gmail.com>
Message-ID: <20150306211345.GD22286@nicira.com>

On Fri, Mar 06, 2015 at 10:18:29PM +0530, tech_kals Kals wrote:
> Thanks for your reply. I am planning to use OVS to inform the controller
> about multiple flow support. Since any of the OVS versions are not
> supporting Multiple flow tables support, could you please clarify my
> doubts. Also, want to know if you share the details how OVS is going to
> support multiple flow tables then it would be great for me to do my
> design/coding.

This question is bizarre.  Open vSwitch has supported multiple flow
tables since 2011, in OVS version 1.3.

From nuno.carrulo at ua.pt  Fri Mar  6 14:11:39 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Fri, 6 Mar 2015 22:11:39 +0000
Subject: [ovs-discuss] Queue added to ports but not being used
In-Reply-To: <20150306210539.GC22286@nicira.com>
References: <1425558128155.62351@ua.pt> <20150305163245.GH25472@nicira.com>
 <1425576047545.7989@ua.pt> <20150305191504.GC20780@nicira.com>
 <1425674817204.52599@ua.pt>,<20150306210539.GC22286@nicira.com>
Message-ID: <1425679894141.68534@ua.pt>

I've restarted the daemon. I saw the logs being stored elsewhere, with the correct version. The queue is inserted and how many packets passed through it.

However the command 'sudo ovs-ofctl queue-get-config s1 s1-eth2
' gives me the output 
'queue 0:
However as you may see the actions I did in mininet since i started the topology: http://pastebin.com/RwvV3K10
After I've defined the rates I created an enqueue action when flows went from s1->s2 and s2->s1. After that I did iperf and bandwidth was too low (around 500kb) and iperf took like 1 minute. After that I just used the action output:<port> in order to have connectivity and then I had around 10mb. Note that when link is not specified in mininet links are around 10Gpbs.

FYI I added the queues in another tab, but essencially the command was this one: "sudo ovs-vsctl -- set port s1-eth2 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:0=@newQ -- --id=@newQ create queue other-config:min-rate=150000 other-config:max-rate=250000". I added the same configuration to s1 and s2 switches on port the ports that connect those switches.

Is that normal behaviour ?

Regards, 
Nuno B.

________________________________________
De: Ben Pfaff <blp at nicira.com>
Enviado: 6 de março de 2015 21:05
Para: Rui Braz
Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl

OK.

I don't know how to help without the log.  I guess you'll have to
figure out what's going on there first.

On Fri, Mar 06, 2015 at 08:47:02PM +0000, Rui Braz wrote:
> I don't need to start it, I just launch the topology. I think mininet vm already has scripts to launch it at boot. However after I start the VM i checked the processes that are running and i got this: http://pastebin.com/13bYMN3K
>
> Logs seem to be being saved in the same place according to this excert of the process ovs-vswitchd '--log-file=/usr/var/log/openvswitch/ovs-vswitchd.log'.
>
> However as i mentioned in previous emails, the last info I have on that is about openvswitch 2.0.2 and I have no problem in running mininet with openvswitch 2.3.
>
> Regards,
> Nuno B.
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 5 de mar?o de 2015 19:15
> Para: Rui Braz
> Cc: mininet-discuss at lists.stanford.edu
> Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
>
> On Thu, Mar 05, 2015 at 05:20:51PM +0000, Rui Braz wrote:
> > I've upgraded the OVS from 2.0.2 to 2.3 using this script: http://pastebin.com/3ViQxg7D. Script was on github from mininet if I'm not mistaken.
> >
> > After doing that the logs generated from OVS are not sent to /var/log/openvswitch because when I go there and print the log only appears to me the log from last version which is 2.0.2 as you may see here: http://pastebin.com/Tf4VtAtz
> >
> > Are the logs being generated elsewhere ?
>
> When you start ovs-vswitchd, where you do tell it to put the log?
>
> > Also I'm able to see the queues I've created if I do "sudo ovs-vsctl list queue".
>
> Not relevant.

From blp at nicira.com  Fri Mar  6 14:15:01 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Mar 2015 14:15:01 -0800
Subject: [ovs-discuss] Queue added to ports but not being used
In-Reply-To: <1425679894141.68534@ua.pt>
References: <1425558128155.62351@ua.pt> <20150305163245.GH25472@nicira.com>
 <1425576047545.7989@ua.pt> <20150305191504.GC20780@nicira.com>
 <1425674817204.52599@ua.pt> <20150306210539.GC22286@nicira.com>
 <1425679894141.68534@ua.pt>
Message-ID: <20150306221501.GI22286@nicira.com>

We're having a communication problem.  I keep asking for logs and you
keep not giving me logs.  When you give me logs, I can start helping
again.

On Fri, Mar 06, 2015 at 10:11:39PM +0000, Rui Braz wrote:
> I've restarted the daemon. I saw the logs being stored elsewhere, with the correct version. The queue is inserted and how many packets passed through it.
> 
> However the command 'sudo ovs-ofctl queue-get-config s1 s1-eth2
> ' gives me the output 
> 'queue 0:
> However as you may see the actions I did in mininet since i started the topology: http://pastebin.com/RwvV3K10
> After I've defined the rates I created an enqueue action when flows went from s1->s2 and s2->s1. After that I did iperf and bandwidth was too low (around 500kb) and iperf took like 1 minute. After that I just used the action output:<port> in order to have connectivity and then I had around 10mb. Note that when link is not specified in mininet links are around 10Gpbs.
> 
> FYI I added the queues in another tab, but essencially the command was this one: "sudo ovs-vsctl -- set port s1-eth2 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:0=@newQ -- --id=@newQ create queue other-config:min-rate=150000 other-config:max-rate=250000". I added the same configuration to s1 and s2 switches on port the ports that connect those switches.
> 
> Is that normal behaviour ?
> 
> Regards, 
> Nuno B.
> 
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 6 de mar?o de 2015 21:05
> Para: Rui Braz
> Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> 
> OK.
> 
> I don't know how to help without the log.  I guess you'll have to
> figure out what's going on there first.
> 
> On Fri, Mar 06, 2015 at 08:47:02PM +0000, Rui Braz wrote:
> > I don't need to start it, I just launch the topology. I think mininet vm already has scripts to launch it at boot. However after I start the VM i checked the processes that are running and i got this: http://pastebin.com/13bYMN3K
> >
> > Logs seem to be being saved in the same place according to this excert of the process ovs-vswitchd '--log-file=/usr/var/log/openvswitch/ovs-vswitchd.log'.
> >
> > However as i mentioned in previous emails, the last info I have on that is about openvswitch 2.0.2 and I have no problem in running mininet with openvswitch 2.3.
> >
> > Regards,
> > Nuno B.
> > ________________________________________
> > De: Ben Pfaff <blp at nicira.com>
> > Enviado: 5 de mar?o de 2015 19:15
> > Para: Rui Braz
> > Cc: mininet-discuss at lists.stanford.edu
> > Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> >
> > On Thu, Mar 05, 2015 at 05:20:51PM +0000, Rui Braz wrote:
> > > I've upgraded the OVS from 2.0.2 to 2.3 using this script: http://pastebin.com/3ViQxg7D. Script was on github from mininet if I'm not mistaken.
> > >
> > > After doing that the logs generated from OVS are not sent to /var/log/openvswitch because when I go there and print the log only appears to me the log from last version which is 2.0.2 as you may see here: http://pastebin.com/Tf4VtAtz
> > >
> > > Are the logs being generated elsewhere ?
> >
> > When you start ovs-vswitchd, where you do tell it to put the log?
> >
> > > Also I'm able to see the queues I've created if I do "sudo ovs-vsctl list queue".
> >
> > Not relevant.

From nuno.carrulo at ua.pt  Fri Mar  6 14:19:58 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Fri, 6 Mar 2015 22:19:58 +0000
Subject: [ovs-discuss] Queue added to ports but not being used
In-Reply-To: <20150306221501.GI22286@nicira.com>
References: <1425558128155.62351@ua.pt> <20150305163245.GH25472@nicira.com>
 <1425576047545.7989@ua.pt> <20150305191504.GC20780@nicira.com>
 <1425674817204.52599@ua.pt> <20150306210539.GC22286@nicira.com>
 <1425679894141.68534@ua.pt>,<20150306221501.GI22286@nicira.com>
Message-ID: <1425680393437.38425@ua.pt>

You're right, i forgot to add it, sorry.
Logs: http://pastebin.com/Sk2EQSNy

Regards, 
Nuno B.
________________________________________
De: Ben Pfaff <blp at nicira.com>
Enviado: 6 de março de 2015 22:15
Para: Rui Braz
Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
Assunto: Re: [ovs-discuss] Queue added to ports but not being used

We're having a communication problem.  I keep asking for logs and you
keep not giving me logs.  When you give me logs, I can start helping
again.

On Fri, Mar 06, 2015 at 10:11:39PM +0000, Rui Braz wrote:
> I've restarted the daemon. I saw the logs being stored elsewhere, with the correct version. The queue is inserted and how many packets passed through it.
>
> However the command 'sudo ovs-ofctl queue-get-config s1 s1-eth2
> ' gives me the output
> 'queue 0:
> However as you may see the actions I did in mininet since i started the topology: http://pastebin.com/RwvV3K10
> After I've defined the rates I created an enqueue action when flows went from s1->s2 and s2->s1. After that I did iperf and bandwidth was too low (around 500kb) and iperf took like 1 minute. After that I just used the action output:<port> in order to have connectivity and then I had around 10mb. Note that when link is not specified in mininet links are around 10Gpbs.
>
> FYI I added the queues in another tab, but essencially the command was this one: "sudo ovs-vsctl -- set port s1-eth2 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:0=@newQ -- --id=@newQ create queue other-config:min-rate=150000 other-config:max-rate=250000". I added the same configuration to s1 and s2 switches on port the ports that connect those switches.
>
> Is that normal behaviour ?
>
> Regards,
> Nuno B.
>
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 6 de mar?o de 2015 21:05
> Para: Rui Braz
> Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
>
> OK.
>
> I don't know how to help without the log.  I guess you'll have to
> figure out what's going on there first.
>
> On Fri, Mar 06, 2015 at 08:47:02PM +0000, Rui Braz wrote:
> > I don't need to start it, I just launch the topology. I think mininet vm already has scripts to launch it at boot. However after I start the VM i checked the processes that are running and i got this: http://pastebin.com/13bYMN3K
> >
> > Logs seem to be being saved in the same place according to this excert of the process ovs-vswitchd '--log-file=/usr/var/log/openvswitch/ovs-vswitchd.log'.
> >
> > However as i mentioned in previous emails, the last info I have on that is about openvswitch 2.0.2 and I have no problem in running mininet with openvswitch 2.3.
> >
> > Regards,
> > Nuno B.
> > ________________________________________
> > De: Ben Pfaff <blp at nicira.com>
> > Enviado: 5 de mar?o de 2015 19:15
> > Para: Rui Braz
> > Cc: mininet-discuss at lists.stanford.edu
> > Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> >
> > On Thu, Mar 05, 2015 at 05:20:51PM +0000, Rui Braz wrote:
> > > I've upgraded the OVS from 2.0.2 to 2.3 using this script: http://pastebin.com/3ViQxg7D. Script was on github from mininet if I'm not mistaken.
> > >
> > > After doing that the logs generated from OVS are not sent to /var/log/openvswitch because when I go there and print the log only appears to me the log from last version which is 2.0.2 as you may see here: http://pastebin.com/Tf4VtAtz
> > >
> > > Are the logs being generated elsewhere ?
> >
> > When you start ovs-vswitchd, where you do tell it to put the log?
> >
> > > Also I'm able to see the queues I've created if I do "sudo ovs-vsctl list queue".
> >
> > Not relevant.

From blp at nicira.com  Fri Mar  6 14:24:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Mar 2015 14:24:59 -0800
Subject: [ovs-discuss] Queue added to ports but not being used
In-Reply-To: <1425680393437.38425@ua.pt>
References: <1425558128155.62351@ua.pt> <20150305163245.GH25472@nicira.com>
 <1425576047545.7989@ua.pt> <20150305191504.GC20780@nicira.com>
 <1425674817204.52599@ua.pt> <20150306210539.GC22286@nicira.com>
 <1425679894141.68534@ua.pt> <20150306221501.GI22286@nicira.com>
 <1425680393437.38425@ua.pt>
Message-ID: <20150306222459.GJ22286@nicira.com>

Thanks.

What configuration does "tc" report for queues?  What is in your OVS
database?

On Fri, Mar 06, 2015 at 10:19:58PM +0000, Rui Braz wrote:
> You're right, i forgot to add it, sorry.
> Logs: http://pastebin.com/Sk2EQSNy
> 
> Regards, 
> Nuno B.
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 6 de mar?o de 2015 22:15
> Para: Rui Braz
> Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> Assunto: Re: [ovs-discuss] Queue added to ports but not being used
> 
> We're having a communication problem.  I keep asking for logs and you
> keep not giving me logs.  When you give me logs, I can start helping
> again.
> 
> On Fri, Mar 06, 2015 at 10:11:39PM +0000, Rui Braz wrote:
> > I've restarted the daemon. I saw the logs being stored elsewhere, with the correct version. The queue is inserted and how many packets passed through it.
> >
> > However the command 'sudo ovs-ofctl queue-get-config s1 s1-eth2
> > ' gives me the output
> > 'queue 0:
> > However as you may see the actions I did in mininet since i started the topology: http://pastebin.com/RwvV3K10
> > After I've defined the rates I created an enqueue action when flows went from s1->s2 and s2->s1. After that I did iperf and bandwidth was too low (around 500kb) and iperf took like 1 minute. After that I just used the action output:<port> in order to have connectivity and then I had around 10mb. Note that when link is not specified in mininet links are around 10Gpbs.
> >
> > FYI I added the queues in another tab, but essencially the command was this one: "sudo ovs-vsctl -- set port s1-eth2 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:0=@newQ -- --id=@newQ create queue other-config:min-rate=150000 other-config:max-rate=250000". I added the same configuration to s1 and s2 switches on port the ports that connect those switches.
> >
> > Is that normal behaviour ?
> >
> > Regards,
> > Nuno B.
> >
> > ________________________________________
> > De: Ben Pfaff <blp at nicira.com>
> > Enviado: 6 de mar?o de 2015 21:05
> > Para: Rui Braz
> > Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> > Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> >
> > OK.
> >
> > I don't know how to help without the log.  I guess you'll have to
> > figure out what's going on there first.
> >
> > On Fri, Mar 06, 2015 at 08:47:02PM +0000, Rui Braz wrote:
> > > I don't need to start it, I just launch the topology. I think mininet vm already has scripts to launch it at boot. However after I start the VM i checked the processes that are running and i got this: http://pastebin.com/13bYMN3K
> > >
> > > Logs seem to be being saved in the same place according to this excert of the process ovs-vswitchd '--log-file=/usr/var/log/openvswitch/ovs-vswitchd.log'.
> > >
> > > However as i mentioned in previous emails, the last info I have on that is about openvswitch 2.0.2 and I have no problem in running mininet with openvswitch 2.3.
> > >
> > > Regards,
> > > Nuno B.
> > > ________________________________________
> > > De: Ben Pfaff <blp at nicira.com>
> > > Enviado: 5 de mar?o de 2015 19:15
> > > Para: Rui Braz
> > > Cc: mininet-discuss at lists.stanford.edu
> > > Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> > >
> > > On Thu, Mar 05, 2015 at 05:20:51PM +0000, Rui Braz wrote:
> > > > I've upgraded the OVS from 2.0.2 to 2.3 using this script: http://pastebin.com/3ViQxg7D. Script was on github from mininet if I'm not mistaken.
> > > >
> > > > After doing that the logs generated from OVS are not sent to /var/log/openvswitch because when I go there and print the log only appears to me the log from last version which is 2.0.2 as you may see here: http://pastebin.com/Tf4VtAtz
> > > >
> > > > Are the logs being generated elsewhere ?
> > >
> > > When you start ovs-vswitchd, where you do tell it to put the log?
> > >
> > > > Also I'm able to see the queues I've created if I do "sudo ovs-vsctl list queue".
> > >
> > > Not relevant.

From nuno.carrulo at ua.pt  Fri Mar  6 15:00:00 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Fri, 6 Mar 2015 23:00:00 +0000
Subject: [ovs-discuss] Fw:  Queue added to ports but not being used
In-Reply-To: <1425681307596.27995@ua.pt>
References: <1425558128155.62351@ua.pt> <20150305163245.GH25472@nicira.com>
 <1425576047545.7989@ua.pt> <20150305191504.GC20780@nicira.com>
 <1425674817204.52599@ua.pt> <20150306210539.GC22286@nicira.com>
 <1425679894141.68534@ua.pt> <20150306221501.GI22286@nicira.com>
 <1425680393437.38425@ua.pt>, <20150306222459.GJ22286@nicira.com>,
 <1425681307596.27995@ua.pt>
Message-ID: <1425682794646.92310@ua.pt>


"tc" configuration ? How do I check that ?
By OVS database I think qos and queue table is enough right ?
queue and qos tables: http://pastebin.com/2kwSAeig

[Forgot to cc mailings lists]

Regards,
Nuno B.
________________________________________
De: Ben Pfaff <blp at nicira.com>
Enviado: 6 de março de 2015 22:24
Para: Rui Braz
Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
Assunto: Re: [ovs-discuss] Queue added to ports but not being used

Thanks.

What configuration does "tc" report for queues?  What is in your OVS
database?

On Fri, Mar 06, 2015 at 10:19:58PM +0000, Rui Braz wrote:
> You're right, i forgot to add it, sorry.
> Logs: http://pastebin.com/Sk2EQSNy
>
> Regards,
> Nuno B.
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 6 de mar?o de 2015 22:15
> Para: Rui Braz
> Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> Assunto: Re: [ovs-discuss] Queue added to ports but not being used
>
> We're having a communication problem.  I keep asking for logs and you
> keep not giving me logs.  When you give me logs, I can start helping
> again.
>
> On Fri, Mar 06, 2015 at 10:11:39PM +0000, Rui Braz wrote:
> > I've restarted the daemon. I saw the logs being stored elsewhere, with the correct version. The queue is inserted and how many packets passed through it.
> >
> > However the command 'sudo ovs-ofctl queue-get-config s1 s1-eth2
> > ' gives me the output
> > 'queue 0:
> > However as you may see the actions I did in mininet since i started the topology: http://pastebin.com/RwvV3K10
> > After I've defined the rates I created an enqueue action when flows went from s1->s2 and s2->s1. After that I did iperf and bandwidth was too low (around 500kb) and iperf took like 1 minute. After that I just used the action output:<port> in order to have connectivity and then I had around 10mb. Note that when link is not specified in mininet links are around 10Gpbs.
> >
> > FYI I added the queues in another tab, but essencially the command was this one: "sudo ovs-vsctl -- set port s1-eth2 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:0=@newQ -- --id=@newQ create queue other-config:min-rate=150000 other-config:max-rate=250000". I added the same configuration to s1 and s2 switches on port the ports that connect those switches.
> >
> > Is that normal behaviour ?
> >
> > Regards,
> > Nuno B.
> >
> > ________________________________________
> > De: Ben Pfaff <blp at nicira.com>
> > Enviado: 6 de mar?o de 2015 21:05
> > Para: Rui Braz
> > Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> > Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> >
> > OK.
> >
> > I don't know how to help without the log.  I guess you'll have to
> > figure out what's going on there first.
> >
> > On Fri, Mar 06, 2015 at 08:47:02PM +0000, Rui Braz wrote:
> > > I don't need to start it, I just launch the topology. I think mininet vm already has scripts to launch it at boot. However after I start the VM i checked the processes that are running and i got this: http://pastebin.com/13bYMN3K
> > >
> > > Logs seem to be being saved in the same place according to this excert of the process ovs-vswitchd '--log-file=/usr/var/log/openvswitch/ovs-vswitchd.log'.
> > >
> > > However as i mentioned in previous emails, the last info I have on that is about openvswitch 2.0.2 and I have no problem in running mininet with openvswitch 2.3.
> > >
> > > Regards,
> > > Nuno B.
> > > ________________________________________
> > > De: Ben Pfaff <blp at nicira.com>
> > > Enviado: 5 de mar?o de 2015 19:15
> > > Para: Rui Braz
> > > Cc: mininet-discuss at lists.stanford.edu
> > > Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> > >
> > > On Thu, Mar 05, 2015 at 05:20:51PM +0000, Rui Braz wrote:
> > > > I've upgraded the OVS from 2.0.2 to 2.3 using this script: http://pastebin.com/3ViQxg7D. Script was on github from mininet if I'm not mistaken.
> > > >
> > > > After doing that the logs generated from OVS are not sent to /var/log/openvswitch because when I go there and print the log only appears to me the log from last version which is 2.0.2 as you may see here: http://pastebin.com/Tf4VtAtz
> > > >
> > > > Are the logs being generated elsewhere ?
> > >
> > > When you start ovs-vswitchd, where you do tell it to put the log?
> > >
> > > > Also I'm able to see the queues I've created if I do "sudo ovs-vsctl list queue".
> > >
> > > Not relevant.

From sea11167 at mail.ustc.edu.cn  Thu Mar  5 19:19:09 2015
From: sea11167 at mail.ustc.edu.cn (sea11167 at mail.ustc.edu.cn)
Date: Fri, 6 Mar 2015 11:19:09 +0800 (GMT+08:00)
Subject: [ovs-discuss] ovs kernel bug: soft lockup
In-Reply-To: <CALnjE+ovK7x1m2QE=7ZXnmp1bGbKzkaAOJu0nNTR8R=CBVQ_OQ@mail.gmail.com>
References: <2ded7edf.1dcd2.14be390a881.Coremail.sea11167@mail.ustc.edu.cn>
 <CALnjE+ovK7x1m2QE=7ZXnmp1bGbKzkaAOJu0nNTR8R=CBVQ_OQ@mail.gmail.com>
Message-ID: <74805ae5.25851.14bed180518.Coremail.sea11167@mail.ustc.edu.cn>

my ovs module was installed from
https://repos.fedorapeople.org/repos/openstack/openstack-juno/epel-7/openvswitch-2.1.2-2.el7.centos.1.x86_64.rpm
along with public Openstack package release.

Thanks,
-Fan

> -----原始邮件-----
> 发件人: "Pravin Shelar" <pshelar at nicira.com>
> 发送时间: 2015-03-06 07:46:34 (星期五)
> 收件人: sea11167 at mail.ustc.edu.cn
> 抄送: bugs at openvswitch.org
> 主题: Re: [ovs-discuss] ovs kernel bug: soft lockup
> 
> On Tue, Mar 3, 2015 at 10:54 PM,  <sea11167 at mail.ustc.edu.cn> wrote:
> > Hi,
> > In an arp flooding network environment, One server running ovs crushed with
> > soft lockup bug.
> > Attached is the system log.
> > ovs version: 2.1.3
> > Linux kernel version:3.10.0-123.el7.x86_64, Centos7
> 
> Which kernel datapath module are you using? have you compiled from OVS
> 2.1.3 or using that comes with the kernel?
> 
> >
> > Thanks,
> > -Fan
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >

From tech.kals at gmail.com  Fri Mar  6 08:48:29 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Fri, 6 Mar 2015 22:18:29 +0530
Subject: [ovs-discuss] OFPMT_TABLE_FEATURES is supported in OVS or not
In-Reply-To: <20150305002216.GD12423@nicira.com>
References: <CAHWErLdteurXa9CFvgXB8wy4ax_qAD1PhNd6CkWEJJs+cWWszg@mail.gmail.com>
 <20150304162013.GC18294@nicira.com>
 <CAHWErLdqWn+taQxqJCpOYYLRdiHeh5h90YbZVkndXsN+68O=ZA@mail.gmail.com>
 <20150305002216.GD12423@nicira.com>
Message-ID: <CAHWErLcFDMZKUMuRNE=OmHcG6p4EAXNBRoqzGY236NFg2=vLVA@mail.gmail.com>

Hi Ben,

Thanks for your reply. I am planning to use OVS to inform the controller
about multiple flow support. Since any of the OVS versions are not
supporting Multiple flow tables support, could you please clarify my
doubts. Also, want to know if you share the details how OVS is going to
support multiple flow tables then it would be great for me to do my
design/coding.


1] Want to know the brief details of how OVS would support Multiple Flow
table ?



2] What are the API’s provided by OVS which can be used to inform OVS about
switch capabilities ?



3] Does currently OVS supports open-flow FEATURE_REQUEST/REPLY messages and
with what parameters ?



4] OVS 2.4 early documentation for multiple flow table support ?


Thanks,

Kals.

On Thu, Mar 5, 2015 at 5:52 AM, Ben Pfaff <blp at nicira.com> wrote:

> We're just waiting on support for the "conntrack" action in the
> kernel.  A few weeks to a month, I guess.
>
> On Thu, Mar 05, 2015 at 05:50:09AM +0530, tech_kals Kals wrote:
> > Hi Ben,
> >
> > Thanks a lot for your response. May I know when OVS 2.4 will be released
> ?
> >
> > On Wed, Mar 4, 2015 at 9:50 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Wed, Mar 04, 2015 at 05:18:55PM +0530, tech_kals Kals wrote:
> > > >  am planning to use Broadcom OFDPA which will support multiple flow
> > > tables
> > > > in the hardware. So, I would like to use OVS to send flow tables
> > > > capabilities to the controller. When I digged into OVS 2.1.0 code, I
> see,
> > > > OFPMT_TABLE_FEATURES is not supported in OVS. Could you please
> experts
> > > > clarify me whether this would be supported in 2.1.0 or in any other
> > > release?
> > >
> > > It's supported in master, which will become OVS 2.4.
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150306/034c2ad7/attachment.html>

From arequipeno at gmail.com  Fri Mar  6 17:17:04 2015
From: arequipeno at gmail.com (Ian Pilcher)
Date: Fri, 06 Mar 2015 19:17:04 -0600
Subject: [ovs-discuss] Static active/active bonding (mode 2)
Message-ID: <mddjig$c6j$1@ger.gmane.org>

Am I correct that Open vSwitch does not directly support static active/
active bonding (what the Linux bonding driver calls mode 2)?

Thanks!

-- 
========================================================================
Ian Pilcher                                         arequipeno at gmail.com
-------- "I grew up before Mark Zuckerberg invented friendship" --------
========================================================================


From blp at nicira.com  Fri Mar  6 23:36:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Mar 2015 23:36:41 -0800
Subject: [ovs-discuss] OFPMT_TABLE_FEATURES is supported in OVS or not
In-Reply-To: <CAHWErLcVepxq7Whab9NTa8ENFR=4Uha=wFSdwhtvxxfEZqf=RA@mail.gmail.com>
References: <CAHWErLdteurXa9CFvgXB8wy4ax_qAD1PhNd6CkWEJJs+cWWszg@mail.gmail.com>
 <20150304162013.GC18294@nicira.com>
 <CAHWErLdqWn+taQxqJCpOYYLRdiHeh5h90YbZVkndXsN+68O=ZA@mail.gmail.com>
 <20150305002216.GD12423@nicira.com>
 <CAHWErLcFDMZKUMuRNE=OmHcG6p4EAXNBRoqzGY236NFg2=vLVA@mail.gmail.com>
 <20150306211345.GD22286@nicira.com>
 <CAHWErLcVepxq7Whab9NTa8ENFR=4Uha=wFSdwhtvxxfEZqf=RA@mail.gmail.com>
Message-ID: <20150307073641.GA20134@nicira.com>

Only OVS 2.4 supports OFPMT_TABLE_FEATURES.

OVS 1.3 and later support multiple flow tables.

On Sat, Mar 07, 2015 at 08:00:44AM +0530, tech_kals Kals wrote:
>  In your previous reply to this thread, you had mentioned that OVS 2.4 only
> will support multiple flow tables. Now, you mention that it is supported in
> OVS1.3 onwards.  I see, OFPMT_TABLE_FEATURES is not supported in OVS 2.1.0.
> Do you mean, it is supported in 1.3? If it is supported in 1.3 release,
> then obviously it should be supported in 2.1.0 as well... but, not sure how
> it is missed ?
> 
> I am little bit confused. Could you please clarify me regarding this.?
> 
> On Sat, Mar 7, 2015 at 2:43 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Fri, Mar 06, 2015 at 10:18:29PM +0530, tech_kals Kals wrote:
> > > Thanks for your reply. I am planning to use OVS to inform the controller
> > > about multiple flow support. Since any of the OVS versions are not
> > > supporting Multiple flow tables support, could you please clarify my
> > > doubts. Also, want to know if you share the details how OVS is going to
> > > support multiple flow tables then it would be great for me to do my
> > > design/coding.
> >
> > This question is bizarre.  Open vSwitch has supported multiple flow
> > tables since 2011, in OVS version 1.3.
> >

From blp at nicira.com  Fri Mar  6 23:37:16 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 6 Mar 2015 23:37:16 -0800
Subject: [ovs-discuss] Static active/active bonding (mode 2)
In-Reply-To: <mddjig$c6j$1@ger.gmane.org>
References: <mddjig$c6j$1@ger.gmane.org>
Message-ID: <20150307073716.GB20134@nicira.com>

On Fri, Mar 06, 2015 at 07:17:04PM -0600, Ian Pilcher wrote:
> Am I correct that Open vSwitch does not directly support static active/
> active bonding (what the Linux bonding driver calls mode 2)?

Not directly.  You can implement something similar with OpenFlow flows.

From arequipeno at gmail.com  Sat Mar  7 14:56:04 2015
From: arequipeno at gmail.com (Ian Pilcher)
Date: Sat, 07 Mar 2015 16:56:04 -0600
Subject: [ovs-discuss] Static active/active bonding (mode 2)
In-Reply-To: <20150307073716.GB20134@nicira.com>
References: <mddjig$c6j$1@ger.gmane.org> <20150307073716.GB20134@nicira.com>
Message-ID: <mdfvm4$o21$1@ger.gmane.org>

On 03/07/2015 01:37 AM, Ben Pfaff wrote:
> On Fri, Mar 06, 2015 at 07:17:04PM -0600, Ian Pilcher wrote:
>> Am I correct that Open vSwitch does not directly support static active/
>> active bonding (what the Linux bonding driver calls mode 2)?
>
> Not directly.  You can implement something similar with OpenFlow flows.

Or just create a Linux bond and add it to the bridge.

Thanks!

-- 
========================================================================
Ian Pilcher                                         arequipeno at gmail.com
-------- "I grew up before Mark Zuckerberg invented friendship" --------
========================================================================


From cheng at cs.umn.edu  Sat Mar  7 19:24:08 2015
From: cheng at cs.umn.edu (Cheng Jin)
Date: Sat, 7 Mar 2015 21:24:08 -0600
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <20150306055355.GB24732@nicira.com>
References: <20150303210349.GA19646@nicira.com>
 <CAMg13ecAC3V+C_zuFxzt_+W33JGLkxfqAAoA5456b8uHdvO6xw@mail.gmail.com>
 <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
 <20150305055042.GA25472@nicira.com>
 <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>
 <CACjuMbzi4CtNa=t3=HDmtU4Rcbm58GTZXQq2S3j4MxBYThs1-g@mail.gmail.com>
 <CAMg13efcjPeYdvdPTi3n93zSvCrQ2O-sYRz7SSxuGkFLWy0RyA@mail.gmail.com>
 <20150306043641.GA24732@nicira.com>
 <CAMg13eds7ixdSuvOjvS0vS+-dACAaSG3f9W566m16HJ7YSmYZA@mail.gmail.com>
 <20150306055355.GB24732@nicira.com>
Message-ID: <CAMg13eccJgrFORti_10-O8cM5a0fuoBKfExz2eAphmVu8aB6bw@mail.gmail.com>

On Thu, Mar 5, 2015 at 11:53 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Mar 05, 2015 at 10:42:12PM -0600, Cheng Jin wrote:
> > Attached please find the log file. Thanks for your time and help.
>
> Thanks.  I'm adding back the mailing list to continue the discussion.
>
> Consider 00:00:00:00:00:02 in bridge s1 (it would be a lot easier to
> read the log if there were only one bridge, by the way).  We initially
> see this getting learned on port s1-eth1 (in_port(2)) when a packet
> arrives for it.  OVS forwards the packet and sets up a kernel cache
> entry:
>
>     2015-03-06T03:01:06.923Z|00019|dpif(handler671)|DBG|system at ovs-system:
> miss upcall:
>
> dp_hash(0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0806),arp(sip=10.0.0.2,tip=10.0.0.1,op=2,sha=00:00:00:00:00:02,tha=00:00:00:00:00:01))
>
> arp,metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,arp_spa=10.0.0.2,arp_tpa=10.0.0.1,arp_op=2,arp_sha=00:00:00:00:00:02,arp_tha=00:00:00:00:00:01
>
> 2015-03-06T03:01:06.923Z|00020|ofproto_dpif_xlate(handler671)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
>     2015-03-06T03:01:06.923Z|00021|dpif(handler671)|DBG|system at ovs-system:
> put[create]
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0806),arp(sip=
> 10.0.0.2/0.0.0.0,tip=10.0.0.1/0.0.0.0,op=2/0,sha=00:00:00:00:00:02/00:00:00:00:00:00,tha=00:00:00:00:00:01/00:00:00:00:00:00)),
> actions:pop_vlan,4
>     2015-03-06T03:01:06.923Z|00022|dpif(handler671)|DBG|system at ovs-system:
> execute pop_vlan,4 on packet
> arp,metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,arp_spa=10.0.0.2,arp_tpa=10.0.0.1,arp_op=2,arp_sha=00:00:00:00:00:02,arp_tha=00:00:00:00:00:01
>
> A few seconds later, a packet with the same source arrives on s1-eth2
> (in_port(3)).  OVS learns the new port for the MAC and again forwards
> the packet and sets up a kernel cache entry:
>
>     2015-03-06T03:01:11.367Z|00036|dpif(handler671)|DBG|system at ovs-system:
> miss upcall:
>
> dp_hash(0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap()
>
> metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,dl_type=0x05ff
>     2015-03-06T03:01:11.367Z|00037|dpif(handler671)|DBG|system at ovs-system:
> get_stats success
>
> 2015-03-06T03:01:11.367Z|00038|ofproto_dpif_xlate(handler671)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
>     2015-03-06T03:01:11.368Z|00039|dpif(handler671)|DBG|system at ovs-system:
> put[create]
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(),
> actions:pop_vlan,4
>     2015-03-06T03:01:11.368Z|00040|dpif(handler671)|DBG|system at ovs-system:
> execute pop_vlan,4 on packet
> metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,dl_type=0x05ff
>     2015-03-06T03:01:11.368Z|04443|dpif|DBG|system at ovs-system: execute 10
> on packet
> metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,dl_type=0x05ff
>
> This is when things get murky.  About 79 ms later, another 5 packets
> arrive with the same MAC arrives on the original port, s1-eth1 (you can
> tell the time and the count from "idle" and packets" below).  The kernel
> cache entry for that flow is still there, so userspace only notices the
> next time it checks the kernel cache statistics.  At that point, it
> re-learns the old address:
>
>
> 2015-03-06T03:01:11.871Z|00201|dpif(revalidator670)|DBG|system at ovs-system:
> flow_dump
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(),
> packets:0, bytes:0, used:never, actions:pop_vlan,4
>
> 2015-03-06T03:01:11.872Z|00202|dpif(revalidator670)|DBG|system at ovs-system:
> flow_dump
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(2),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0800),ipv4(src=
> 10.0.0.2/0.0.0.0,dst=10.0.0.1/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0/0,code=0/0)),
> packets:5, bytes:490, used:0.421s, actions:pop_vlan,4
>
> 2015-03-06T03:01:11.872Z|00203|ofproto_dpif_xlate(revalidator670)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth1 in VLAN 100
>
> Similarly, there's another packet on s1-eth2 a bit later and that port
> is relearned:
>
>
> 2015-03-06T03:01:12.377Z|00222|dpif(revalidator670)|DBG|system at ovs-system:
> flow_dump
> dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(3),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x8100),vlan(vid=100,pcp=0),encap(),
> packets:1, bytes:42, used:0.005s, actions:pop_vlan,4
>
> 2015-03-06T03:01:12.377Z|00223|ofproto_dpif_xlate(revalidator670)|DBG|bridge
> s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 100
>
> and so on
>
> In other words, I see that MAC bouncing back and forth because there's
> continuing traffic for it arriving on both ports.  There is some
> hysteresis to the bouncing because it only gets processed when OVS looks
> at kernel statistics.
>
> If this isn't the MAC that you're having trouble with (in that log) then
> can you be specific about which MAC and bridge you're looking at?
>

One thing in the log about 00:00:00:00:00:01 in bridge s2 looks very weird
to me. s2 "learns" a port without any incoming packet.

Initially s2 learns that 00:00:00:00:00:01 is on port s2-eth1 (in_port(6))
when a packet arrives for it. Everything looks fine.

2015-03-06T03:01:06.921Z|00007|dpif(handler671)|DBG|system at ovs-system: miss
upcall:
dp_hash(0),recirc_id(0),skb_priority(0),in_port(6),skb_mark(0),eth(src=00:00:00:00:00:01,dst=ff:ff:ff:ff:ff:ff),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0806),arp(sip=10.0.0.1,tip=10.0.0.2,op=1,sha=00:00:00:00:00:01,tha=00:00:00:00:00:00))
arp,metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:01,dl_dst=ff:ff:ff:ff:ff:ff,arp_spa=10.0.0.1,arp_tpa=10.0.0.2,arp_op=1,arp_sha=00:00:00:00:00:01,arp_tha=00:00:00:00:00:00
2015-03-06T03:01:06.922Z|00009|ofproto_dpif_xlate(handler671)|DBG|bridge
s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100
2015-03-06T03:01:06.922Z|00010|dpif(handler671)|DBG|system at ovs-system:
put[create]
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(6),skb_mark(0/0),eth(src=00:00:00:00:00:01,dst=ff:ff:ff:ff:ff:ff),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0806),arp(sip=
10.0.0.1/255.255.255.255,tip=10.0.0.2/255.255.255.255,op=1/0xff,sha=00:00:00:00:00:01/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00)),
actions:5,7,pop_vlan,8

A few seconds later, a packet with the same source arrives on s2-eth2
(in_port(7)). We expect s2 can adapt immediately and all the future packets
destining to 00:00:00:00:00:01 should be output to s2-eth2.
OVS learns the new port for the MAC and again forwards the packet and sets
up a kernel cache entry:

2015-03-06T03:01:11.368Z|00042|dpif(handler671)|DBG|system at ovs-system: miss
upcall:
dp_hash(0),recirc_id(0),skb_priority(0),in_port(7),skb_mark(0),eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),eth_type(0x8100),vlan(vid=100,pcp=0),encap()
metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,dl_type=0x05ff
2015-03-06T03:01:11.368Z|00043|ofproto_dpif_xlate(handler671)|DBG|bridge
s2: learned that 00:00:00:00:00:01 is on port s2-eth2 in VLAN 100
2015-03-06T03:01:11.368Z|00044|dpif(handler671)|DBG|system at ovs-system:
put[create]
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(7),skb_mark(0/0),eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),eth_type(0x8100),vlan(vid=100,pcp=0),encap(),
actions:pop_vlan,8
2015-03-06T03:01:11.368Z|00045|dpif(handler671)|DBG|system at ovs-system:
execute pop_vlan,8 on packet
metadata=0,in_port=0,dl_vlan=100,dl_vlan_pcp=0,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,dl_type=0x05ff


Everything looks fine so far, but the confusing part comes now. Since the
last time that s2 learnt the new port s2-eth2 for the MAC, no new packets
arrive at s2 but s2 learns the old port for the MAC again.
At the same time, the kernel cache entry for the reverse flow from
in_port(8) to port(6) gets deleted because it should adapt to the change of
s2's learned port:

2015-03-06T03:01:11.369Z|00175|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(7),skb_mark(0/0),eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),eth_type(0x8100),vlan(vid=100,pcp=0),encap(),
packets:0, bytes:0, used:never, actions:pop_vlan,8
2015-03-06T03:01:11.369Z|00176|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(8),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x0800),ipv4(src=
10.0.0.2/0.0.0.0,dst=10.0.0.1/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0/0,code=0/0),
packets:4, bytes:392, used:0.920s, actions:push_vlan(vid=100,pcp=0),6
2015-03-06T03:01:11.369Z|00180|dpif(revalidator670)|DBG|system at ovs-system:
flow_dump
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(6),skb_mark(0/0),eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),eth_type(0x8100),vlan(vid=100,pcp=0),encap(eth_type(0x0800),ipv4(src=
10.0.0.1/0.0.0.0,dst=10.0.0.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=8/0,code=0/0)),
packets:5, bytes:490, used:0.420s, actions:pop_vlan,8
***2015-03-06T03:01:11.369Z|00181|ofproto_dpif_xlate(revalidator670)|DBG|bridge
s2: learned that 00:00:00:00:00:01 is on port s2-eth1 in VLAN 100***
2015-03-06T03:01:11.369Z|00182|dpif(revalidator670)|DBG|system at ovs-system:
flow_del
dp_hash(0),recirc_id(0),skb_priority(0),in_port(8),skb_mark(0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x0800),ipv4(src=10.0.0.2,dst=10.0.0.1,proto=1,tos=0,ttl=64,frag=no),icmp(type=0,code=0),
packets:4, bytes:392, used:0.920s

About 82 ms later, a packet destining to 00:00:00:00:00:01 arrives at s2
and gets forwarded to the old port s2-eth1 (port(6)). The weird behavior
that s2 relearned the old port without any incoming packet violates our
expectation that s2 can adapt to the new port immediately.

2015-03-06T03:01:11.451Z|00047|dpif(handler671)|DBG|system at ovs-system: miss
upcall:
dp_hash(0),recirc_id(0),skb_priority(0),in_port(8),skb_mark(0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x0800),ipv4(src=10.0.0.2,dst=10.0.0.1,proto=1,tos=0,ttl=64,frag=no),icmp(type=0,code=0)
icmp,metadata=0,in_port=0,vlan_tci=0x0000,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,nw_src=10.0.0.2,nw_dst=10.0.0.1,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=0,icmp_code=0
2015-03-06T03:01:11.452Z|00048|dpif(handler671)|DBG|system at ovs-system:
put[create]
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(8),skb_mark(0/0),eth(src=00:00:00:00:00:02,dst=00:00:00:00:00:01),eth_type(0x0800),ipv4(src=
10.0.0.2/0.0.0.0,dst=10.0.0.1/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=0/0,code=0/0),
actions:push_vlan(vid=100,pcp=0),6
2015-03-06T03:01:11.452Z|00049|dpif(handler671)|DBG|system at ovs-system:
execute push_vlan(vid=100,pcp=0),6 on packet
icmp,metadata=0,in_port=0,vlan_tci=0x0000,dl_src=00:00:00:00:00:02,dl_dst=00:00:00:00:00:01,nw_src=10.0.0.2,nw_dst=10.0.0.1,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=0,icmp_code=0

Could you please explain why the relearn behavior happened? Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150307/707af853/attachment-0001.html>

From uri.elzur at intel.com  Sat Mar  7 19:37:54 2015
From: uri.elzur at intel.com (Elzur, Uri)
Date: Sun, 8 Mar 2015 03:37:54 +0000
Subject: [ovs-discuss] [ovs-dev] Geneve Support
In-Reply-To: <4518FDBD-19BE-4F07-9901-2EA298108C25@nicira.com>
References: <CAOv37=B278MZWx39hX+496XVf7x9m4ShYUGqhLe28VjhZUOM-g@mail.gmail.com>
 <4518FDBD-19BE-4F07-9901-2EA298108C25@nicira.com>
Message-ID: <7E05C330D7FD6D4FAD0728C46B89958581BA02B9@ORSMSX114.amr.corp.intel.com>

Hi

What TLV's are you expecting to have supported in that release?

Thx

Uri (“Oo-Ree”)
C: 949-378-7568

-----Original Message-----
From: dev [mailto:dev-bounces at openvswitch.org] On Behalf Of Justin Pettit
Sent: Thursday, March 5, 2015 11:23 PM
To: Neelakantam Gaddam
Cc: dev at openvswitch.com; discuss at openvswitch.org
Subject: Re: [ovs-dev] Geneve Support

Please don't cross-post on multiple mailing lists.

It will be part of OVS 2.4.  We haven't branched for it yet, but we hope to do that in the next few weeks.  The release will be some weeks after that.

--Justin


> On Mar 5, 2015, at 10:39 PM, Neelakantam Gaddam <neelugaddam at gmail.com> wrote:
> 
> Hi All,
> 
> Which OVS version supports Geneve protocol? I did not see Geneve 
> support in 2.3.1.  Currently, Geneve is part of master branch. When 
> can I expect Geneve part of  OVS official release?
> 
> 
> 
> --
> Thanks & Regards
> Neelakantam Gaddam
> _______________________________________________
> dev mailing list
> dev at openvswitch.org
> http://openvswitch.org/mailman/listinfo/dev

_______________________________________________
dev mailing list
dev at openvswitch.org
http://openvswitch.org/mailman/listinfo/dev

From tech.kals at gmail.com  Fri Mar  6 18:30:44 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Sat, 7 Mar 2015 08:00:44 +0530
Subject: [ovs-discuss] OFPMT_TABLE_FEATURES is supported in OVS or not
In-Reply-To: <20150306211345.GD22286@nicira.com>
References: <CAHWErLdteurXa9CFvgXB8wy4ax_qAD1PhNd6CkWEJJs+cWWszg@mail.gmail.com>
 <20150304162013.GC18294@nicira.com>
 <CAHWErLdqWn+taQxqJCpOYYLRdiHeh5h90YbZVkndXsN+68O=ZA@mail.gmail.com>
 <20150305002216.GD12423@nicira.com>
 <CAHWErLcFDMZKUMuRNE=OmHcG6p4EAXNBRoqzGY236NFg2=vLVA@mail.gmail.com>
 <20150306211345.GD22286@nicira.com>
Message-ID: <CAHWErLcVepxq7Whab9NTa8ENFR=4Uha=wFSdwhtvxxfEZqf=RA@mail.gmail.com>

Hi Ben,

 In your previous reply to this thread, you had mentioned that OVS 2.4 only
will support multiple flow tables. Now, you mention that it is supported in
OVS1.3 onwards.  I see, OFPMT_TABLE_FEATURES is not supported in OVS 2.1.0.
Do you mean, it is supported in 1.3? If it is supported in 1.3 release,
then obviously it should be supported in 2.1.0 as well... but, not sure how
it is missed ?

I am little bit confused. Could you please clarify me regarding this.?

On Sat, Mar 7, 2015 at 2:43 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Mar 06, 2015 at 10:18:29PM +0530, tech_kals Kals wrote:
> > Thanks for your reply. I am planning to use OVS to inform the controller
> > about multiple flow support. Since any of the OVS versions are not
> > supporting Multiple flow tables support, could you please clarify my
> > doubts. Also, want to know if you share the details how OVS is going to
> > support multiple flow tables then it would be great for me to do my
> > design/coding.
>
> This question is bizarre.  Open vSwitch has supported multiple flow
> tables since 2011, in OVS version 1.3.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150307/51b97085/attachment-0001.html>

From apocalipse89 at gmail.com  Sun Mar  8 03:37:25 2015
From: apocalipse89 at gmail.com (Salvatore Mazzarino)
Date: Sun, 8 Mar 2015 11:37:25 +0100
Subject: [ovs-discuss] iptables issue in the domU
Message-ID: <064035FD-B541-42B5-8188-C76CD8E5FFE9@gmail.com>

Hello

this is my testbed.
I’m running a virtual machine created in VirtualBox in which I have installed CentOS 6.5 and Xen. In the dom0 I have created two Openvswitches and connected them to domU that is a virtual machine running CentOS6.6
The user to the left ping google.it <http://google.it/> and the packets in order to reach the destination it has to pass through the domU before passing from OVS0. then the domU has to do NAT and forwarding. Here are the rules that I set in the domU

net.ipv4.ip_forward = 1
iptables -t nat -A POSTROUTING -i eth0 -j MASQUERADE
iptables -A FORWARD -i eth0 -o eth1 -m state —state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT

NB. eth0 := vif1.0 and eth1:= vif1.1

the packets arrive to the domU through the eth1 and ovs0. I execute tcpdump on vif1.1 (eth0) and sees packet arrive but there is no forward from eth1 (domU) and eth0 (domU)
All the route in domU are set correctly. Everything is set correctly in domU.

I have tried even to use linux container (docker) by replacing domU with a docker container and using ovs and still doesn’t work. I have even implemented this testbed physically installing dom) cents and xen directly on a physical machine.

I’m running ovs 2.3.1 with kernel support

Now I think that this could be a problem related to openvswitch. you could try to reproduce this configuration 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150308/d5c3e301/attachment-0002.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Untitled.pdf
Type: application/pdf
Size: 78286 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150308/d5c3e301/attachment-0001.pdf>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150308/d5c3e301/attachment-0003.html>

From amer7777 at hotmail.com  Sun Mar  8 08:43:16 2015
From: amer7777 at hotmail.com (AMER)
Date: Sun, 8 Mar 2015 15:43:16 +0000
Subject: [ovs-discuss] basic network topology
Message-ID: <DUB113-W8B433AF6CF4BD6C5DC939D41A0@phx.gbl>

Hello,

I am using 4 VMs in each vm I have installed OVS 1.10 and openflow
I want to make a linear topology between these VMs

host----VM1-------VM2------VM3-----VM4----host

However, I read many of the tutorial in the internet most of them are showing how to use mininet or tunnel/gre or creating virtual machines inside my virtual machine or using ovs-sandbox. 

I would like to get some basic things.

Thank you
Best regards, 

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150308/af87e970/attachment.html>

From a.alghadhban at gmail.com  Sun Mar  8 10:17:02 2015
From: a.alghadhban at gmail.com (Amer)
Date: Sun, 8 Mar 2015 20:17:02 +0300
Subject: [ovs-discuss] Linear topology in openveswitch
Message-ID: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>

Hello,

Dear folks

I read most of the examples on the internet, however, I faced some errors

I want to build and configure a linear topology using openveswitch installed in 4 VirtualBoxs and 2 hosts.
Like the following:
H1----VM1----VM2----VM3----VM4----H2

Best regards,
Amer

From a.alghadhban at gmail.com  Sun Mar  8 13:55:11 2015
From: a.alghadhban at gmail.com (Amer)
Date: Sun, 8 Mar 2015 23:55:11 +0300
Subject: [ovs-discuss] Build linear topology using OVS
Message-ID: <D1B995A3-1FC8-468B-A7CA-9A8C94ED6565@gmail.com>

Hello,

Dear folks,
   I would like to build and configure a linear topology using openveswitch and 4 VMs, I have installed in each VM an openveswitch and I want to build the following topology
h1---VM1---VM2----VM3----VM4---h2
To do this I did the following
In each VMs
ovs-vsctl add-br br0
ovs-vsctl add-port br0 eth0
ovs-vsctl add-br br1
ovs-vsctl add-port br1 eth1
Ifconfig eth0 0
Ifconfig br0 192.168.x.z
Ifconfig eth1 0
Ifconfig br0 192.168.x.y

I am going to do this in each VM
Is this correct? Did I need to add something other than the flow-rules?

Best regards,
Amer




Sent from my iPhone

From tech.kals at gmail.com  Sun Mar  8 21:11:08 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Mon, 9 Mar 2015 09:41:08 +0530
Subject: [ovs-discuss] OFPMT_TABLE_FEATURES is supported in OVS or not
In-Reply-To: <20150307073641.GA20134@nicira.com>
References: <CAHWErLdteurXa9CFvgXB8wy4ax_qAD1PhNd6CkWEJJs+cWWszg@mail.gmail.com>
 <20150304162013.GC18294@nicira.com>
 <CAHWErLdqWn+taQxqJCpOYYLRdiHeh5h90YbZVkndXsN+68O=ZA@mail.gmail.com>
 <20150305002216.GD12423@nicira.com>
 <CAHWErLcFDMZKUMuRNE=OmHcG6p4EAXNBRoqzGY236NFg2=vLVA@mail.gmail.com>
 <20150306211345.GD22286@nicira.com>
 <CAHWErLcVepxq7Whab9NTa8ENFR=4Uha=wFSdwhtvxxfEZqf=RA@mail.gmail.com>
 <20150307073641.GA20134@nicira.com>
Message-ID: <CAHWErLdBJVqhU2vpnwyr=LKDAJ0GnwO=337KXKz4J++xmpvbJw@mail.gmail.com>

Hi Ben,

Thanks for your response. Even though OVS 1.3 or later is supporting
multiple flow tables. May I know what is the use of them if controller is
not informed about multiple flow tables through OFPMT_TABLE_FEATURES. Or do
you use some other mechanism to inform the controller about supporting
multiple flow tables on the switch?


Thanks,
Kaliyaperumal K


On Sat, Mar 7, 2015 at 1:06 PM, Ben Pfaff <blp at nicira.com> wrote:

> Only OVS 2.4 supports OFPMT_TABLE_FEATURES.
>
> OVS 1.3 and later support multiple flow tables.
>
> On Sat, Mar 07, 2015 at 08:00:44AM +0530, tech_kals Kals wrote:
> >  In your previous reply to this thread, you had mentioned that OVS 2.4
> only
> > will support multiple flow tables. Now, you mention that it is supported
> in
> > OVS1.3 onwards.  I see, OFPMT_TABLE_FEATURES is not supported in OVS
> 2.1.0.
> > Do you mean, it is supported in 1.3? If it is supported in 1.3 release,
> > then obviously it should be supported in 2.1.0 as well... but, not sure
> how
> > it is missed ?
> >
> > I am little bit confused. Could you please clarify me regarding this.?
> >
> > On Sat, Mar 7, 2015 at 2:43 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Fri, Mar 06, 2015 at 10:18:29PM +0530, tech_kals Kals wrote:
> > > > Thanks for your reply. I am planning to use OVS to inform the
> controller
> > > > about multiple flow support. Since any of the OVS versions are not
> > > > supporting Multiple flow tables support, could you please clarify my
> > > > doubts. Also, want to know if you share the details how OVS is going
> to
> > > > support multiple flow tables then it would be great for me to do my
> > > > design/coding.
> > >
> > > This question is bizarre.  Open vSwitch has supported multiple flow
> > > tables since 2011, in OVS version 1.3.
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150309/1053c1ee/attachment.html>

From neelugaddam at gmail.com  Mon Mar  9 01:12:23 2015
From: neelugaddam at gmail.com (Neelakantam Gaddam)
Date: Mon, 9 Mar 2015 13:42:23 +0530
Subject: [ovs-discuss] [ovs-dev] Geneve Support
In-Reply-To: <7E05C330D7FD6D4FAD0728C46B89958581BA02B9@ORSMSX114.amr.corp.intel.com>
References: <CAOv37=B278MZWx39hX+496XVf7x9m4ShYUGqhLe28VjhZUOM-g@mail.gmail.com>
 <4518FDBD-19BE-4F07-9901-2EA298108C25@nicira.com>
 <7E05C330D7FD6D4FAD0728C46B89958581BA02B9@ORSMSX114.amr.corp.intel.com>
Message-ID: <CAOv37=Dqqr3EzCpOoJ7r74SAQ_GuHyrHFX=G81YKq8KACGj4jg@mail.gmail.com>

Hi,

I am not expecting any TLVs specifically in the release. I just need the
basic functionality of Geneve in openvswitch.



On Sun, Mar 8, 2015 at 9:07 AM, Elzur, Uri <uri.elzur at intel.com> wrote:

> Hi
>
> What TLV's are you expecting to have supported in that release?
>
> Thx
>
> Uri (“Oo-Ree”)
> C: 949-378-7568
>
> -----Original Message-----
> From: dev [mailto:dev-bounces at openvswitch.org] On Behalf Of Justin Pettit
> Sent: Thursday, March 5, 2015 11:23 PM
> To: Neelakantam Gaddam
> Cc: dev at openvswitch.com; discuss at openvswitch.org
> Subject: Re: [ovs-dev] Geneve Support
>
> Please don't cross-post on multiple mailing lists.
>
> It will be part of OVS 2.4.  We haven't branched for it yet, but we hope
> to do that in the next few weeks.  The release will be some weeks after
> that.
>
> --Justin
>
>
> > On Mar 5, 2015, at 10:39 PM, Neelakantam Gaddam <neelugaddam at gmail.com>
> wrote:
> >
> > Hi All,
> >
> > Which OVS version supports Geneve protocol? I did not see Geneve
> > support in 2.3.1.  Currently, Geneve is part of master branch. When
> > can I expect Geneve part of  OVS official release?
> >
> >
> >
> > --
> > Thanks & Regards
> > Neelakantam Gaddam
> > _______________________________________________
> > dev mailing list
> > dev at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/dev
>
> _______________________________________________
> dev mailing list
> dev at openvswitch.org
> http://openvswitch.org/mailman/listinfo/dev
>



-- 
Thanks & Regards
Neelakantam Gaddam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150309/01bf6f7e/attachment-0001.html>

From neelugaddam at gmail.com  Mon Mar  9 01:53:47 2015
From: neelugaddam at gmail.com (Neelakantam Gaddam)
Date: Mon, 9 Mar 2015 14:23:47 +0530
Subject: [ovs-discuss] [ovs-dev] Geneve Support
In-Reply-To: <CAOv37=Dqqr3EzCpOoJ7r74SAQ_GuHyrHFX=G81YKq8KACGj4jg@mail.gmail.com>
References: <CAOv37=B278MZWx39hX+496XVf7x9m4ShYUGqhLe28VjhZUOM-g@mail.gmail.com>
 <4518FDBD-19BE-4F07-9901-2EA298108C25@nicira.com>
 <7E05C330D7FD6D4FAD0728C46B89958581BA02B9@ORSMSX114.amr.corp.intel.com>
 <CAOv37=Dqqr3EzCpOoJ7r74SAQ_GuHyrHFX=G81YKq8KACGj4jg@mail.gmail.com>
Message-ID: <CAOv37=CtNcBYQO=24TvexW0U9KKQdemBnUctCbeiGbrr2ODc9Q@mail.gmail.com>

Hi All,

Can I get the Geneve support patch for OVS 2.3.0 release from anybody?



On Mon, Mar 9, 2015 at 1:42 PM, Neelakantam Gaddam <neelugaddam at gmail.com>
wrote:

> Hi,
>
> I am not expecting any TLVs specifically in the release. I just need the
> basic functionality of Geneve in openvswitch.
>
>
>
> On Sun, Mar 8, 2015 at 9:07 AM, Elzur, Uri <uri.elzur at intel.com> wrote:
>
>> Hi
>>
>> What TLV's are you expecting to have supported in that release?
>>
>> Thx
>>
>> Uri (“Oo-Ree”)
>> C: 949-378-7568
>>
>> -----Original Message-----
>> From: dev [mailto:dev-bounces at openvswitch.org] On Behalf Of Justin Pettit
>> Sent: Thursday, March 5, 2015 11:23 PM
>> To: Neelakantam Gaddam
>> Cc: dev at openvswitch.com; discuss at openvswitch.org
>> Subject: Re: [ovs-dev] Geneve Support
>>
>> Please don't cross-post on multiple mailing lists.
>>
>> It will be part of OVS 2.4.  We haven't branched for it yet, but we hope
>> to do that in the next few weeks.  The release will be some weeks after
>> that.
>>
>> --Justin
>>
>>
>> > On Mar 5, 2015, at 10:39 PM, Neelakantam Gaddam <neelugaddam at gmail.com>
>> wrote:
>> >
>> > Hi All,
>> >
>> > Which OVS version supports Geneve protocol? I did not see Geneve
>> > support in 2.3.1.  Currently, Geneve is part of master branch. When
>> > can I expect Geneve part of  OVS official release?
>> >
>> >
>> >
>> > --
>> > Thanks & Regards
>> > Neelakantam Gaddam
>> > _______________________________________________
>> > dev mailing list
>> > dev at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/dev
>>
>> _______________________________________________
>> dev mailing list
>> dev at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/dev
>>
>
>
>
> --
> Thanks & Regards
> Neelakantam Gaddam
>



-- 
Thanks & Regards
Neelakantam Gaddam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150309/2d25bc5c/attachment.html>

From amer7777 at hotmail.com  Mon Mar  9 04:06:06 2015
From: amer7777 at hotmail.com (AMER)
Date: Mon, 9 Mar 2015 11:06:06 +0000
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>
Message-ID: <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>

Hello,

I apologize for mule emails

This is what i did and I do not know whether it is correct or not I want your comments
Hello,

Dear folks,

   I would like to build and configure a linear topology using 
openveswitch and 4 VMs, I have installed in each VM an openveswitch and I
 want to build the following topology
h1---VM1---VM2----VM3----VM4---h2
To do this I did the following
In each VMs
ovs-vsctl add-br br0
ovs-vsctl add-port br0 eth0
ovs-vsctl add-br br1
ovs-vsctl add-port br1 eth1
Ifconfig eth0 0
Ifconfig br0 192.168.x.z
Ifconfig eth1 0
Ifconfig br0 192.168.x.y

I am going to do this in each VM
Is this correct? Did I need to add something other than the flow-rules?

Best regards,
Amer

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA


> From: a.alghadhban at gmail.com
> Date: Sun, 8 Mar 2015 20:17:02 +0300
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] Linear topology in openveswitch
> 
> Hello,
> 
> Dear folks
> 
> I read most of the examples on the internet, however, I faced some errors
> 
> I want to build and configure a linear topology using openveswitch installed in 4 VirtualBoxs and 2 hosts.
> Like the following:
> H1----VM1----VM2----VM3----VM4----H2
> 
> Best regards,
> Amer
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150309/5cc71d62/attachment.html>

From stephen.finucane at intel.com  Mon Mar  9 07:11:03 2015
From: stephen.finucane at intel.com (Finucane, Stephen)
Date: Mon, 9 Mar 2015 14:11:03 +0000
Subject: [ovs-discuss] Would like to import Intel's toit test suite
In-Reply-To: <D3A883A8-E457-4D2B-A243-E9EE67F3272B@nicira.com>
References: <54F7C8C1.1060203@redhat.com>
 <D3A883A8-E457-4D2B-A243-E9EE67F3272B@nicira.com>
Message-ID: <6A74A01C3512C646A9ED99AFA28AEB981824FA47@IRSMSX108.ger.corp.intel.com>

> > On Mar 4, 2015, at 7:08 PM, jhsiao at redhat.com wrote:
> >
> > Hi Stephen,
> >
> > Is there a link to your toit test suite?
> >
> > We would like to import it as part of kernel-QE test suite for our OVS
> testing, in particular the kernel data path testing.
> >
> > Thanks!
> >
> > Jean
>
> Is this something that you'd be interested in working on jointly?  We want
> to start being able to do more public QA of OVS to enable faster release
> cycles.  Some work has been done to start writing kernel unit tests through
> vagrant.  Joe is using it, for example, to test conntrack.  We plan to do
> more of this, and expand it to cover performance and scaling testing for
> both OVS and OVN.  It would be great if we could avoid duplicating work.
> 
> --Justin

Hi,

We agree that there should be more public QA of OVS and this is one of the reasons why we are open sourcing this. We would be interested in working on this jointly (particularly on the OVS with DPDK element of it).

'toit' is functionally complete for our current needs; namely, basic performance and validation testing of the 'netdev-dpdk' datapath. However, while it was designed with this specific datapath in mind, it would be quite easy to extend for other datapaths/features of OVS. We'd also need to add support for another hw/sw traffic generator as we currently support only IXIA IxExplorer and IXIA IxNetwork.

We do think that, going forward, there could be more value if it was a generic performance testing framework for virtual switches as it should increase community support. e.g. the OPNFV community. We are open to suggestions here.

We have pushed much of the current code base to OPNFV Gerrit for review but we'd be happy to share this somewhere more public if it would be useful (perhaps GitHub?). Do be aware that the current codebase will likely change substantially to fit the needs of the OPNFV generic "vSwitch Performance Characterization" story.

I have uploaded the slides on 'toit' to Google Docs. You can find this at the below link. Commenting is enabled so make use of it as you see fit.

    https://drive.google.com/file/d/0B08Jfzym0pisUHVWYzNESGZrSU0/view?usp=sharing

Should you have any further questions, do not hesitate to contact either one of my colleagues, Meghan Halton and Maryam Tahhan (cc'd), or myself.

Cheers,
Stephen

From shettyg at nicira.com  Mon Mar  9 07:47:27 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 9 Mar 2015 07:47:27 -0700
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>
 <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>
Message-ID: <CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>

On Mon, Mar 9, 2015 at 4:06 AM, AMER <amer7777 at hotmail.com> wrote:
> Hello,
>
> I apologize for mule emails
>
> This is what i did and I do not know whether it is correct or not I want
> your comments
> Hello,
>
> Dear folks,
>   I would like to build and configure a linear topology using openveswitch
> and 4 VMs, I have installed in each VM an openveswitch and I want to build
> the following topology
> h1---VM1---VM2----VM3----VM4---h2
> To do this I did the following
> In each VMs
> ovs-vsctl add-br br0
> ovs-vsctl add-port br0 eth0
> ovs-vsctl add-br br1
> ovs-vsctl add-port br1 eth1
> Ifconfig eth0 0
> Ifconfig br0 192.168.x.z
> Ifconfig eth1 0
> Ifconfig br0 192.168.x.y
>
> I am going to do this in each VM
How do you plan to connect traffic between "br0" and "br1"?
"openvswitch patch ports" is one option.

From blp at nicira.com  Mon Mar  9 09:09:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 9 Mar 2015 09:09:04 -0700
Subject: [ovs-discuss] OFPMT_TABLE_FEATURES is supported in OVS or not
In-Reply-To: <CAHWErLdBJVqhU2vpnwyr=LKDAJ0GnwO=337KXKz4J++xmpvbJw@mail.gmail.com>
References: <CAHWErLdteurXa9CFvgXB8wy4ax_qAD1PhNd6CkWEJJs+cWWszg@mail.gmail.com>
 <20150304162013.GC18294@nicira.com>
 <CAHWErLdqWn+taQxqJCpOYYLRdiHeh5h90YbZVkndXsN+68O=ZA@mail.gmail.com>
 <20150305002216.GD12423@nicira.com>
 <CAHWErLcFDMZKUMuRNE=OmHcG6p4EAXNBRoqzGY236NFg2=vLVA@mail.gmail.com>
 <20150306211345.GD22286@nicira.com>
 <CAHWErLcVepxq7Whab9NTa8ENFR=4Uha=wFSdwhtvxxfEZqf=RA@mail.gmail.com>
 <20150307073641.GA20134@nicira.com>
 <CAHWErLdBJVqhU2vpnwyr=LKDAJ0GnwO=337KXKz4J++xmpvbJw@mail.gmail.com>
Message-ID: <20150309160904.GD2961@nicira.com>

OpenFlow 1.1 and later support the kind of multiple tables you care
about.  Only OpenFlow 1.3 added OFPMP_TABLE_FEATURES.  You can consult
the OpenFlow specifications to learn about how OpenFlow works.

On Mon, Mar 09, 2015 at 09:41:08AM +0530, tech_kals Kals wrote:
> Hi Ben,
> 
> Thanks for your response. Even though OVS 1.3 or later is supporting
> multiple flow tables. May I know what is the use of them if controller is
> not informed about multiple flow tables through OFPMT_TABLE_FEATURES. Or do
> you use some other mechanism to inform the controller about supporting
> multiple flow tables on the switch?
> 
> 
> Thanks,
> Kaliyaperumal K
> 
> 
> On Sat, Mar 7, 2015 at 1:06 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Only OVS 2.4 supports OFPMT_TABLE_FEATURES.
> >
> > OVS 1.3 and later support multiple flow tables.
> >
> > On Sat, Mar 07, 2015 at 08:00:44AM +0530, tech_kals Kals wrote:
> > >  In your previous reply to this thread, you had mentioned that OVS 2.4
> > only
> > > will support multiple flow tables. Now, you mention that it is supported
> > in
> > > OVS1.3 onwards.  I see, OFPMT_TABLE_FEATURES is not supported in OVS
> > 2.1.0.
> > > Do you mean, it is supported in 1.3? If it is supported in 1.3 release,
> > > then obviously it should be supported in 2.1.0 as well... but, not sure
> > how
> > > it is missed ?
> > >
> > > I am little bit confused. Could you please clarify me regarding this.?
> > >
> > > On Sat, Mar 7, 2015 at 2:43 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Fri, Mar 06, 2015 at 10:18:29PM +0530, tech_kals Kals wrote:
> > > > > Thanks for your reply. I am planning to use OVS to inform the
> > controller
> > > > > about multiple flow support. Since any of the OVS versions are not
> > > > > supporting Multiple flow tables support, could you please clarify my
> > > > > doubts. Also, want to know if you share the details how OVS is going
> > to
> > > > > support multiple flow tables then it would be great for me to do my
> > > > > design/coding.
> > > >
> > > > This question is bizarre.  Open vSwitch has supported multiple flow
> > > > tables since 2011, in OVS version 1.3.
> > > >
> >

From blp at nicira.com  Mon Mar  9 09:10:58 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 9 Mar 2015 09:10:58 -0700
Subject: [ovs-discuss] Build linear topology using OVS
In-Reply-To: <D1B995A3-1FC8-468B-A7CA-9A8C94ED6565@gmail.com>
References: <D1B995A3-1FC8-468B-A7CA-9A8C94ED6565@gmail.com>
Message-ID: <20150309161058.GF2961@nicira.com>

On Sun, Mar 08, 2015 at 11:55:11PM +0300, Amer wrote:
>    I would like to build and configure a linear topology using
>    openveswitch and 4 VMs, I have installed in each VM an openveswitch
>    and I want to build the following topology

Would you please post your question just once?  So far I see three copies.

From blp at nicira.com  Mon Mar  9 09:12:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 9 Mar 2015 09:12:24 -0700
Subject: [ovs-discuss] iptables issue in the domU
In-Reply-To: <064035FD-B541-42B5-8188-C76CD8E5FFE9@gmail.com>
References: <064035FD-B541-42B5-8188-C76CD8E5FFE9@gmail.com>
Message-ID: <20150309161224.GG2961@nicira.com>

On Sun, Mar 08, 2015 at 11:37:25AM +0100, Salvatore Mazzarino wrote:
> the packets arrive to the domU through the eth1 and ovs0. I execute tcpdump on vif1.1 (eth0) and sees packet arrive but there is no forward from eth1 (domU) and eth0 (domU)
> All the route in domU are set correctly. Everything is set correctly in domU.
> 
> I have tried even to use linux container (docker) by replacing domU with a docker container and using ovs and still doesn’t work. I have even implemented this testbed physically installing dom) cents and xen directly on a physical machine.
> 
> I’m running ovs 2.3.1 with kernel support
> 
> Now I think that this could be a problem related to openvswitch. you could try to reproduce this configuration 

Open vSwitch has no power to influence behavior in virtual machines
where it is not running.

From challa at noironetworks.com  Mon Mar  9 09:57:56 2015
From: challa at noironetworks.com (Madhu Challa)
Date: Mon, 9 Mar 2015 09:57:56 -0700
Subject: [ovs-discuss] [ovs-dev] Geneve Support
In-Reply-To: <CAOv37=CtNcBYQO=24TvexW0U9KKQdemBnUctCbeiGbrr2ODc9Q@mail.gmail.com>
References: <CAOv37=B278MZWx39hX+496XVf7x9m4ShYUGqhLe28VjhZUOM-g@mail.gmail.com>
 <4518FDBD-19BE-4F07-9901-2EA298108C25@nicira.com>
 <7E05C330D7FD6D4FAD0728C46B89958581BA02B9@ORSMSX114.amr.corp.intel.com>
 <CAOv37=Dqqr3EzCpOoJ7r74SAQ_GuHyrHFX=G81YKq8KACGj4jg@mail.gmail.com>
 <CAOv37=CtNcBYQO=24TvexW0U9KKQdemBnUctCbeiGbrr2ODc9Q@mail.gmail.com>
Message-ID: <CAN_zqfO3nGkHZR0p4oaeoZR2=EHqbsdiMvKhCRzfLwRiDsC+1Q@mail.gmail.com>

The kernel support for Geneve is already there.

https://github.com/mchalla/ovs/tree/geneve

It was posted as an RFC a while back. I have not gotten a chance to
work on it since. I will be sending out v2 in couple of weeks.

Thanks.

On Mon, Mar 9, 2015 at 1:53 AM, Neelakantam Gaddam
<neelugaddam at gmail.com> wrote:
> Hi All,
>
> Can I get the Geneve support patch for OVS 2.3.0 release from anybody?
>
>
>
> On Mon, Mar 9, 2015 at 1:42 PM, Neelakantam Gaddam <neelugaddam at gmail.com>
> wrote:
>>
>> Hi,
>>
>> I am not expecting any TLVs specifically in the release. I just need the
>> basic functionality of Geneve in openvswitch.
>>
>>
>>
>> On Sun, Mar 8, 2015 at 9:07 AM, Elzur, Uri <uri.elzur at intel.com> wrote:
>>>
>>> Hi
>>>
>>> What TLV's are you expecting to have supported in that release?
>>>
>>> Thx
>>>
>>> Uri (“Oo-Ree”)
>>> C: 949-378-7568
>>>
>>> -----Original Message-----
>>> From: dev [mailto:dev-bounces at openvswitch.org] On Behalf Of Justin Pettit
>>> Sent: Thursday, March 5, 2015 11:23 PM
>>> To: Neelakantam Gaddam
>>> Cc: dev at openvswitch.com; discuss at openvswitch.org
>>> Subject: Re: [ovs-dev] Geneve Support
>>>
>>> Please don't cross-post on multiple mailing lists.
>>>
>>> It will be part of OVS 2.4.  We haven't branched for it yet, but we hope
>>> to do that in the next few weeks.  The release will be some weeks after
>>> that.
>>>
>>> --Justin
>>>
>>>
>>> > On Mar 5, 2015, at 10:39 PM, Neelakantam Gaddam <neelugaddam at gmail.com>
>>> > wrote:
>>> >
>>> > Hi All,
>>> >
>>> > Which OVS version supports Geneve protocol? I did not see Geneve
>>> > support in 2.3.1.  Currently, Geneve is part of master branch. When
>>> > can I expect Geneve part of  OVS official release?
>>> >
>>> >
>>> >
>>> > --
>>> > Thanks & Regards
>>> > Neelakantam Gaddam
>>> > _______________________________________________
>>> > dev mailing list
>>> > dev at openvswitch.org
>>> > http://openvswitch.org/mailman/listinfo/dev
>>>
>>> _______________________________________________
>>> dev mailing list
>>> dev at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/dev
>>
>>
>>
>>
>> --
>> Thanks & Regards
>> Neelakantam Gaddam
>
>
>
>
> --
> Thanks & Regards
> Neelakantam Gaddam
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From swairshah at gmail.com  Mon Mar  9 12:41:52 2015
From: swairshah at gmail.com (swair shah)
Date: Mon, 9 Mar 2015 14:41:52 -0500
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <20150304165920.GM18294@nicira.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
 <20150304165105.GK18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>
 <20150304165920.GM18294@nicira.com>
Message-ID: <CAKRDMx8C32OHJUZMHff-Me0cqPz=JKgefuM=0SxdosGO6PotcA@mail.gmail.com>

>
> I don't see how that can solve the problem that he is reporting.  Did
> you read his whole scenario?  If we knew how to handle the packet in the
> datapath at the beginning of the scenario then we would not be sending
> it to the controller.
>
> I doubt that this is a real problem that needs to be solved, because
> it's been in the back of my mind since about 2008 as a possible concern
> but this is the first time I remember anyone actually voicing it.  Swair
> hasn't explained how it actually shows up as a problem in practice.
> Swair?
>

I ran into this case when running some tests with streams of UDP datagrams.
Clearly in case of TCP, the flow would gradually build up and this case
would not occur as only the first 'ack' would not be followed by any
packets before the handshake is done. I am not sure how significant this
problem would be in real world scenarios.

Can this be done:
If we define flow as the set of packets with 'similar' header (I am not
sure on the granularity with which one would define 'similar' in this
case), then after the first packet buffer each subsequent packet in a
ordered list (and probably don't send Packet_In, for subsequent packets;
but this can be a configuration). In response to packet_out for first
packet forward all the packets from that list.

Again, the issue is how would you decide if two packets are 'similar', i.e.
are to be queued in the same list.

Another probably highly inefficient way to do is to check all the buffered
packets in response to every packet_in.

thanks,
swair.


>
> (Also, this particular manifestation of the issue can only occur with
> reactive controllers, which don't scale.)
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150309/ba92926f/attachment.html>

From alexw at nicira.com  Mon Mar  9 14:04:13 2015
From: alexw at nicira.com (Alex Wang)
Date: Mon, 9 Mar 2015 14:04:13 -0700
Subject: [ovs-discuss] IPv6 dadfailed
In-Reply-To: <2611640.21aUqXHEkD@wiggum>
References: <2391029.WkG2ybOBvo@waiotapu>
 <CAHbON5o38eT-1amAcXXDh7rK=NaFaktiTe8HV9rtN_wezD3HTw@mail.gmail.com>
 <CAArS4XWtYcX3OFLSgExeRoMfC3+5Z2eZi1YQkUjUQFOCtWTGfw@mail.gmail.com>
 <2611640.21aUqXHEkD@wiggum>
Message-ID: <CAArS4XUZHEzDqq_xRwYyN2K30yWky7-JOjmRQnX4mEr9JjXzCA@mail.gmail.com>

Hey Tobias,

Thx for providing more info,  I'm only about to comment on the 'dump-flows'
output.  Here are what I found 'loop-like':

"""
skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=00:00:5e:00:02:05,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=303,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)),
packets:217320, bytes:20428080, used:0.548s,
actions:pop_vlan,24,29,push_vlan(vid=303,pcp=0),1

skb_priority(0),in_port(p258p2),skb_mark(0/0),eth(src=00:00:5e:00:02:06,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=701,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)),
packets:217320, bytes:20428080, used:0.548s,
actions:pop_vlan,27,13,18,push_vlan(vid=701,pcp=0),1

skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:02:06,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=701,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)),
packets:217320, bytes:20428080, used:0.548s,
actions:pop_vlan,27,13,18,push_vlan(vid=701,pcp=0),1

skb_priority(0),in_port(p258p1),skb_mark(0/0),eth(src=00:00:5e:00:02:05,dst=33:33:00:00:00:12),eth_type(0x8100),vlan(vid=303,pcp=0),encap(eth_type(0x86dd),ipv6(src=fe80::d6ca:6dff:fe01:ab2b/::,dst=ff02::12/::,label=0/0,proto=112/0,tclass=0/0,hlimit=255/0,frag=no/0xff)),
packets:217320, bytes:20428080, used:0.548s,
actions:pop_vlan,24,29,push_vlan(vid=303,pcp=0),1

"""
Could you verify the output ports using 'ovs-dpctl show'?

Thanks,
Alex Wang,

On Fri, Mar 6, 2015 at 2:08 AM, Tobias Brunner <tobias.brunner at vshn.ch>
wrote:

> Hi everyone,
>
> Thanks a lot for taking care of this issue!
>
> > This is a good point.  I suspect there is a loop in the setup causing the
> > bounch-back.
>
> Yes, this really looks like that there is a loop somewhere.
>
> > > I cannot yet reconcile this with the previous message of the sending
> > > VM receiving the traffic with a hairpin.
> >
> > Besides checking the VM, I'd suggest you check on the HV and run
> > 'ovs-dpctl dump-flows -m' (this will show you how the packets are
> forwarded
> > in kernel), right after you configure IPv6 on VM.  'ovs-dpctl show' will
> > give
> > you the mapping between port number and port name.  So, we can see
> > how other HV process the IPv6 message and check if there is a loop.
>
> I did that, but can't find any usable information on the "dump-flows"
> output.
> I've attached the file.
>
> > > Are you using OVS tunnels? If so, one idea could be to connect  VM
> > > vifs to a OVS bridge. But use Linux bonding to carry the tunneled
> > > traffic out of the machine. Another option to try out is not to use
> > > LACP bonds but rather something like active-backup (man
> > > ovs-vswitchd.conf.db -> Bonding Configuration)
> >
> > This is a good suggestion.
>
> No, we are not using any tunnels. And I'm not able to change from LACP to
> active-backup on the affected systems because they're running in
> production. We
> also don't have any lab devices available to experiment with, this is too
> bad,
> I know =(
>
> Some more information about the setup: The hosts are connected with two
> network interfaces, each to one Brocade ICX6650 switch which form a MCT
> cluster. Therefore we are able to use LACP to form a bonding with this two
> network connections.
> We have some other servers connected exactly identically to the same
> switches
> which are not running any VMs on it and also don't have OVS on it. They're
> using linux bonding to form the LACP channel and don't suffer from this DAD
> trouble.
>
> Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)
>
> Bonding Mode: IEEE 802.3ad Dynamic link aggregation
> Transmit Hash Policy: layer2 (0)
> MII Status: up
> MII Polling Interval (ms): 100
> Up Delay (ms): 0
> Down Delay (ms): 0
>
> 802.3ad info
> LACP rate: fast
> Min links: 0
> Aggregator selection policy (ad_select): stable
> Active Aggregator Info:
>         Aggregator ID: 1
>         Number of ports: 2
>         Actor Key: 33
>         Partner Key: 30203
>         Partner Mac Address: 01:80:c2:xx:xx:xx
>
> Slave Interface: p262p1
> MII Status: up
> Speed: 10000 Mbps
> Duplex: full
> Link Failure Count: 0
> Permanent HW addr: 90:e2:ba:xx:xx:xx
> Aggregator ID: 1
> Slave queue ID: 0
>
> Slave Interface: p262p2
> MII Status: up
> Speed: 10000 Mbps
> Duplex: full
> Link Failure Count: 0
> Permanent HW addr: 90:e2:ba:xx:xx:xx
> Aggregator ID: 1
> Slave queue ID: 0
>
> Cheers,
> Tobias
>
> --
> Tobias Brunner
> Linux and Network Engineer
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150309/168f891c/attachment.html>

From blp at nicira.com  Mon Mar  9 15:20:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 9 Mar 2015 15:20:26 -0700
Subject: [ovs-discuss] packet reorderoing
In-Reply-To: <CAKRDMx8C32OHJUZMHff-Me0cqPz=JKgefuM=0SxdosGO6PotcA@mail.gmail.com>
References: <CAKRDMx_EmP1y8AkhxCw7WvrWTTVxs1g6ii-MYWHbkccf5fpFAA@mail.gmail.com>
 <20150227002121.GC30714@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF4C7@IRSMSX108.ger.corp.intel.com>
 <20150304165105.GK18294@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA92E1CF5BF@IRSMSX108.ger.corp.intel.com>
 <20150304165920.GM18294@nicira.com>
 <CAKRDMx8C32OHJUZMHff-Me0cqPz=JKgefuM=0SxdosGO6PotcA@mail.gmail.com>
Message-ID: <20150309222026.GA20111@nicira.com>

On Mon, Mar 09, 2015 at 02:41:52PM -0500, swair shah wrote:
> >
> > I don't see how that can solve the problem that he is reporting.  Did
> > you read his whole scenario?  If we knew how to handle the packet in the
> > datapath at the beginning of the scenario then we would not be sending
> > it to the controller.
> >
> > I doubt that this is a real problem that needs to be solved, because
> > it's been in the back of my mind since about 2008 as a possible concern
> > but this is the first time I remember anyone actually voicing it.  Swair
> > hasn't explained how it actually shows up as a problem in practice.
> > Swair?
> 
> I ran into this case when running some tests with streams of UDP datagrams.
> Clearly in case of TCP, the flow would gradually build up and this case
> would not occur as only the first 'ack' would not be followed by any
> packets before the handshake is done. I am not sure how significant this
> problem would be in real world scenarios.

I guess I don't count this as a real problem then.

> Can this be done:
> If we define flow as the set of packets with 'similar' header (I am not
> sure on the granularity with which one would define 'similar' in this
> case), then after the first packet buffer each subsequent packet in a
> ordered list (and probably don't send Packet_In, for subsequent packets;
> but this can be a configuration). In response to packet_out for first
> packet forward all the packets from that list.
> 
> Again, the issue is how would you decide if two packets are 'similar', i.e.
> are to be queued in the same list.
> 
> Another probably highly inefficient way to do is to check all the buffered
> packets in response to every packet_in.

I think that's the same as what I proposed.

From thomasfherbert at gmail.com  Mon Mar  9 17:02:57 2015
From: thomasfherbert at gmail.com (Thomas F Herbert)
Date: Mon, 09 Mar 2015 20:02:57 -0400
Subject: [ovs-discuss] Vlan handling problem in Linux datapath
Message-ID: <54FE34B1.5090202@gmail.com>

All,

First apologies in advance for a lengthy message:

I have seen some strange vlan behavior where there is a miss-match on 
vlan tci. It can be reproduced on every commit I tried since version 2.3 
but cannot be reproduced in version 2.2.

The example below is from commit 
7cc398cb8561a16ae3be5ffc687be5620981d619 in the current master branch.

To reproduce set a specific rule to match on a particular tci. Every 
incoming packet with a miss-matched vlan tag will get the following 
error from the Linux datapath function ovs_nla_get_match():

[449232.750362] openvswitch: netlink: VLAN tag present bit must have an 
exact match (tci_mask=100).
[449233.767975] openvswitch: netlink: VLAN tag present bit must have an 
exact match (tci_mask=100).
[449234.765656] openvswitch: netlink: VLAN tag present bit must have an 
exact match (tci_mask=100).

This is the flow rule to reproduce the problem:

ovs-ofctl --protocols=OpenFlow13 add-flow br0 
in_port=2,vlan_tci=0x1e36,priority=20000,actions=pop_vlan,output:1

I believe that the miss matched packet is getting up-called but when the 
flow comes back to the kernel it doesn't have the mask set correctly in 
the netlink attributes so the kernel has trouble parsing it, the flow is 
never set in the kernel so every subsequent packet also misses.

=====Work Around=============
The problem can be made to disappear by setting a lower priority flow to 
explicitly drop all other incoming packets whose vlan tci's don't match 
as follows:

ovs-ofctl --protocols=OpenFlow13 add-flow br0 
in_port=2,vlan_tci=0x1000/0x1000,priority=20,actions=drop

I am pretty sure this is a bug but I am looking for feedback before I 
fix it because some may argue that the above is correct behavior but I 
have my doubts. Also, having every incoming miss-matched packet get 
bounced to user space and back causes the performance to drop by two 
orders of magnitude.

=============log with debug set===============

Mar  9 19:43:47 lubuntu1310 ovs-vswitchd: ovs|07894|poll_loop|DBG|wakeup 
due to [POLLIN] on fd 14 (FIFO pipe:[3806013]) at 
ofproto/ofproto-dpif.c:1633 (0% CPU usage)
Mar  9 19:43:47 lubuntu1310 ovs-vswitchd: 
ovs|09287|poll_loop(handler7)|DBG|wakeup due to [POLLIN] on fd 19 
(unknown anon_inode:[eventpoll]) at lib/dpif-netlink.c:2201 (0% CPU usage)
Mar  9 19:43:47 lubuntu1310 ovs-vswitchd: 
ovs|09288|dpif(handler7)|DBG|system at ovs-system: miss upcall:
Mar  9 19:43:47 lubuntu1310 ovs-vswitchd: 
recirc_id(0),dp_hash(0),skb_priority(0),in_port(3),skb_mark(0),eth(src=26:58:26:16:3c:38,dst=ff:ff:ff:ff:ff:ff),eth_type(0x8100),vlan(vid=999,pcp=0),encap(eth_type(0x0806),arp(sip=192.168.1.3,tip=192.168.1.2,op=1,sha=26:58:26:16:3c:38,tha=00:00:00:00:00:00))
Mar  9 19:43:47 lubuntu1310 ovs-vswitchd: 
arp,in_port=0,dl_vlan=999,dl_vlan_pcp=0,dl_src=26:58:26:16:3c:38,dl_dst=ff:ff:ff:ff:ff:ff,arp_spa=192.168.1.3,arp_tpa=192.168.1.2,arp_op=1,arp_sha=26:58:26:16:3c:38,arp_tha=00:00:00:00:00:00
Mar  9 19:43:47 lubuntu1310 ovs-vswitchd: 
ovs|09289|dpif(handler7)|WARN|system at ovs-system: failed to put[create] 
(Invalid argument) ufid:09fbc634c913835be0aed9d5f728f5a1 
recirc_id(0),dp_hash(0/0),skb_priority(0/0),in_port(3),skb_mark(0/0),eth(src=26:58:26:16:3c:38/00:00:00:00:00:00,dst=ff:ff:ff:ff:ff:ff/00:00:00:00:00:00),eth_type(0x8100),vlan(vid=999/0x100,pcp=0/0x0),encap(eth_type(0x0806),arp(sip=192.168.1.3/0.0.0.0,tip=192.168.1.2/0.0.0.0,op=1/0,sha=26:58:26:16:3c:38/00:00:00:00:00:00,tha=00:00:00:00:00:00/00:00:00:00:00:00))
Mar  9 19:43:47 lubuntu1310 ovs-vswitchd: 
ovs|09290|poll_loop(handler7)|DBG|wakeup due to 0-ms timeout at 
ofproto/ofproto-dpif-upcall.c:622 (0% CPU usage)
Mar  9 19:43:47 lubuntu1310 kernel: [450932.727558] openvswitch: 
netlink: VLAN tag present bit must have an exact match (tci_mask=100).
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: 
ovs|15966|poll_loop(revalidator6)|DBG|wakeup due to 499-ms timeout at 
ofproto/ofproto-dpif-upcall.c:802 (0% CPU usage)
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: 
ovs|15967|netlink_socket(revalidator6)|DBG|Dropped 21 log messages in 
last 1 seconds (most recently, 1 seconds ago) due to excessive rate
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: 
ovs|15968|netlink_socket(revalidator6)|DBG|nl_sock_transact_multiple__ 
(Success): nl(len:24, type=128(ovs_datapath), flags=9[REQUEST][ECHO], 
seq=2a4e, pid=4294962693,genl(cmd=3,version=2)
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: 
ovs|15969|dpif(revalidator6)|DBG|system at ovs-system: get_stats success
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: 
ovs|15970|dpif(revalidator6)|DBG|system at ovs-system: dumped all flows
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: 
ovs|05115|poll_loop(urcu3)|DBG|wakeup due to [POLLIN] on fd 25 (FIFO 
pipe:[3806112]) at lib/ovs-rcu.c:273 (0% CPU usage)
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: 
ovs|05116|poll_loop(urcu3)|DBG|wakeup due to [POLLIN] on fd 25 (FIFO 
pipe:[3806112]) at lib/ovs-rcu.c:205 (0% CPU usage)
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: 
ovs|05117|poll_loop(urcu3)|DBG|wakeup due to [POLLIN] on fd 25 (FIFO 
pipe:[3806112]) at lib/ovs-rcu.c:205 (0% CPU usage)
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: 
ovs|15971|dpif(revalidator6)|DBG|system at ovs-system: flow_dump_destroy 
success
Mar  9 19:43:48 lubuntu1310 ovs-vswitchd: ovs|07895|poll_loop|DBG|wakeup 
due to [POLLIN] on fd 14 (FIFO pipe:[3806013]) at 
ofproto/ofproto-dpif.c:1633 (0% CPU usage)

Thanks in advance,

--Tom



-- 
Thomas F. Herbert


From navneet.singh2012 at gmail.com  Mon Mar  9 22:28:53 2015
From: navneet.singh2012 at gmail.com (Navneet Singh)
Date: Tue, 10 Mar 2015 10:58:53 +0530
Subject: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
Message-ID: <CAOCzzU+MT+fa8Kd=+_Fk8+ut2ho-3zySSESunCMGbYcWKTQsuQ@mail.gmail.com>

I am trying to control upload speed using openvswitch on eth1 port using
commands like


> =>ovs-vsctl set port eth1 qos=@newqos -- --id=@newqos create qos
> type=linux-htb queues=0=@q0,1=@q1 -- --id=@q0 create queue
> other-config:min-rate=2000000 other-config:max-rate=2000000 -- --id=@q1
> create queue other-config:min-rate=3000000 other-config:max-rate=3000000


Topology used in attached.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/1ddaf277/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: new2
Type: application/octet-stream
Size: 11233 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/1ddaf277/attachment-0001.obj>

From navneet.singh2012 at gmail.com  Mon Mar  9 22:35:12 2015
From: navneet.singh2012 at gmail.com (Navneet Singh)
Date: Tue, 10 Mar 2015 11:05:12 +0530
Subject: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
Message-ID: <CAOCzzUJ9x+s8m_bzb3rwm1hy1oOST9__z1NmCDAOr07-UydCwQ@mail.gmail.com>

I am trying to control upload speed using openvswitch on eth1 port using
commands like


> =>ovs-vsctl set port eth1 qos=@newqos -- --id=@newqos create qos
> type=linux-htb queues=0=@q0,1=@q1 -- --id=@q0 create queue
> other-config:min-rate=2000000 other-config:max-rate=2000000 -- --id=@q1
> create queue other-config:min-rate=3000000 other-config:max-rate=3000000


WAN is provided to eth0 port and forwarded to br0 through iptables and NAT.
I am able to achieve rate limiting on downloading but not on uploading.
Please help me in solving this.

Topology used in attached.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/08fcceff/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: topo
Type: application/octet-stream
Size: 30551 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/08fcceff/attachment-0001.obj>

From blp at nicira.com  Mon Mar  9 22:37:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 9 Mar 2015 22:37:52 -0700
Subject: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
In-Reply-To: <CAOCzzUJ9x+s8m_bzb3rwm1hy1oOST9__z1NmCDAOr07-UydCwQ@mail.gmail.com>
References: <CAOCzzUJ9x+s8m_bzb3rwm1hy1oOST9__z1NmCDAOr07-UydCwQ@mail.gmail.com>
Message-ID: <20150310053752.GC11688@nicira.com>

On Tue, Mar 10, 2015 at 11:05:12AM +0530, Navneet Singh wrote:
> I am trying to control upload speed using openvswitch on eth1 port using
> commands like
> 
> 
> > =>ovs-vsctl set port eth1 qos=@newqos -- --id=@newqos create qos
> > type=linux-htb queues=0=@q0,1=@q1 -- --id=@q0 create queue
> > other-config:min-rate=2000000 other-config:max-rate=2000000 -- --id=@q1
> > create queue other-config:min-rate=3000000 other-config:max-rate=3000000
> 
> 
> WAN is provided to eth0 port and forwarded to br0 through iptables and NAT.
> I am able to achieve rate limiting on downloading but not on uploading.

qdiscs only control the rate of data transmission, not reception.  You
might want to use policing, please see ovs-vswitchd.conf.db(5) for
configuration details.

From zhang.guanghui at h3c.com  Mon Mar  9 22:52:02 2015
From: zhang.guanghui at h3c.com (Zhangguanghui)
Date: Tue, 10 Mar 2015 05:52:02 +0000
Subject: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
References: <CAOCzzUJ9x+s8m_bzb3rwm1hy1oOST9__z1NmCDAOr07-UydCwQ@mail.gmail.com>, 
 <20150310053752.GC11688@nicira.com>
Message-ID: <2015031013514867745449@h3c.com>

There is a bug in the rate limiting, for the type of int has a max limit 2147483648,(lt 2000000*1000)
if you can change type 'int' to 'uint' in the function context, as follow,
static int tc_add_policer(struct netdev *netdev, int kbits_rate, int kbits_burst)

From: discuss<mailto:discuss-bounces at openvswitch.org>
Date: 2015-03-10 13:37
To: Navneet Singh<mailto:navneet.singh2012 at gmail.com>
CC: discuss at openvswitch.org<mailto:discuss at openvswitch.org>
Subject: Re: [ovs-discuss] How to apply rate limiting or QoS on upload speed?

On Tue, Mar 10, 2015 at 11:05:12AM +0530, Navneet Singh wrote:
> I am trying to control upload speed using openvswitch on eth1 port using
> commands like
>
>
> > =>ovs-vsctl set port eth1 qos=@newqos -- --id=@newqos create qos
> > type=linux-htb queues=0=@q0,1=@q1 -- --id=@q0 create queue
> > other-config:min-rate=2000000 other-config:max-rate=2000000 -- --id=@q1
> > create queue other-config:min-rate=3000000 other-config:max-rate=3000000
>
>
> WAN is provided to eth0 port and forwarded to br0 through iptables and NAT.
> I am able to achieve rate limiting on downloading but not on uploading.

qdiscs only control the rate of data transmission, not reception.  You
might want to use policing, please see ovs-vswitchd.conf.db(5) for
configuration details.
_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

-------------------------------------------------------------------------------------------------------------------------------------
本邮件及其附件含有杭州华三通信技术有限公司的保密信息，仅限于发送给上面地址中列出
的个人或群组。禁止任何其他人以任何形式使用（包括但不限于全部或部分地泄露、复制、
或散发）本邮件中的信息。如果您错收了本邮件，请您立即电话或邮件通知发件人并删除本
邮件！
This e-mail and its attachments contain confidential information from H3C, which is
intended only for the person or entity whose address is listed above. Any use of the
information contained herein in any way (including, but not limited to, total or partial
disclosure, reproduction, or dissemination) by persons other than the intended
recipient(s) is prohibited. If you receive this e-mail in error, please notify the sender
by phone or email immediately and delete it!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/9709e380/attachment.html>

From vguvva at caviumnetworks.com  Mon Mar  9 23:56:00 2015
From: vguvva at caviumnetworks.com (Vijaya Mohan Guvva)
Date: Tue, 10 Mar 2015 12:26:00 +0530
Subject: [ovs-discuss] vswitchd crash with flow table 254 deletion
Message-ID: <54FE9580.4050106@caviumnetworks.com>

Hi all,
I get vswitchd crash (segfault) consistently with flow table 254 
deletion and with traffic. This special table has internal flows/rules 
(miss_rule, no_packet_in_rule etc) added during bridge creation and are 
getting deleting with ovs-ofctl del-flows <br_name> "table=254". These 
deleted stale rules are referred (xbridge->miss_rule and 
xbridge->no_packet_in_rule) when there is no flow match and resulting in 
segfault. I guess, these default flows shouldn't be deleted, but if they 
are part of flow tables, can be deleted. so we should move them a place 
where they never get deleted and always available.

Please suggest.

-- 
Regards, Vijay,
Cavium networks.

From amer7777 at hotmail.com  Tue Mar 10 01:02:12 2015
From: amer7777 at hotmail.com (Amer)
Date: Tue, 10 Mar 2015 11:02:12 +0300
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>
 <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>
 <CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>
Message-ID: <BLU436-SMTP8583FEBF0EE9805CFF7614D4180@phx.gbl>

Hello,

Thank you for your message,
I think I can use only one bridge and the configuration will be:
>> ovs-vsctl add-br br0
>> ovs-vsctl add-port br0 eth0
>> ovs-vsctl add-port br0 eth1


Then, eth0 and 1 are in the same bridge and communicate with each other directly, without path ports,
is this correct?

Best regards,
Amer

> On ٠٩‏/٠٣‏/٢٠١٥, at ٥:٤٧ م, Gurucharan Shetty <shettyg at nicira.com> wrote:
> 
>> On Mon, Mar 9, 2015 at 4:06 AM, AMER <amer7777 at hotmail.com> wrote:
>> Hello,
>> 
>> I apologize for mule emails
>> 
>> This is what i did and I do not know whether it is correct or not I want
>> your comments
>> Hello,
>> 
>> Dear folks,
>>  I would like to build and configure a linear topology using openveswitch
>> and 4 VMs, I have installed in each VM an openveswitch and I want to build
>> the following topology
>> h1---VM1---VM2----VM3----VM4---h2
>> To do this I did the following
>> In each VMs
>> ovs-vsctl add-br br0
>> ovs-vsctl add-port br0 eth0
>> ovs-vsctl add-br br1
>> ovs-vsctl add-port br1 eth1
>> Ifconfig eth0 0
>> Ifconfig br0 192.168.x.z
>> Ifconfig eth1 0
>> Ifconfig br0 192.168.x.y
>> 
>> I am going to do this in each VM
> How do you plan to connect traffic between "br0" and "br1"?
> "openvswitch patch ports" is one option.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/b711477f/attachment-0001.html>

From sanshrestha08 at gmail.com  Tue Mar 10 01:05:04 2015
From: sanshrestha08 at gmail.com (sandesh shrestha)
Date: Tue, 10 Mar 2015 02:05:04 -0600
Subject: [ovs-discuss] Confirm connections in open vswitch
Message-ID: <CAEnp_HD4RH5nRm0U9b5UnGMm1bfmx2ex2ABzLSW1336N_qzz=Q@mail.gmail.com>

Dear All,

I have open vswitch with three connections to the same mininet host.

How can we confirm which port on open vswitch is connected to which
interface on the host.
Is there any commnd to check connections like that.


-- 
Sandesh Shrestha
Internetworking Student at U of Alberta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/1efe9cb2/attachment.html>

From amer7777 at hotmail.com  Tue Mar 10 01:08:09 2015
From: amer7777 at hotmail.com (Amer)
Date: Tue, 10 Mar 2015 11:08:09 +0300
Subject: [ovs-discuss] Build linear topology using OVS
In-Reply-To: <20150309161058.GF2961@nicira.com>
References: <D1B995A3-1FC8-468B-A7CA-9A8C94ED6565@gmail.com>
 <20150309161058.GF2961@nicira.com>
Message-ID: <BLU436-SMTP78A3CB541B166A6F25C37AD4180@phx.gbl>

I apologize,

I sent the message using my first email, then I received unregistered user notification.
I sent the same message from my second email, also, the unregistration notification sent to me again. After that, I registered with one of my email and send the message again, surprisingly I found all of my messages broadcasted at the same time. 
I apologize again

Thank you

Sent from my iPhone

> On ٠٩‏/٠٣‏/٢٠١٥, at ٧:١٠ م, Ben Pfaff <blp at nicira.com> wrote:
> 
>> On Sun, Mar 08, 2015 at 11:55:11PM +0300, Amer wrote:
>>   I would like to build and configure a linear topology using
>>   openveswitch and 4 VMs, I have installed in each VM an openveswitch
>>   and I want to build the following topology
> 
> Would you please post your question just once?  So far I see three copies.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From shettyg at nicira.com  Tue Mar 10 07:19:28 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 10 Mar 2015 07:19:28 -0700
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <BLU436-SMTP8583FEBF0EE9805CFF7614D4180@phx.gbl>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>
 <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>
 <CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>
 <BLU436-SMTP8583FEBF0EE9805CFF7614D4180@phx.gbl>
Message-ID: <CAHbON5rhwQy2EJT+oe6PPStjvCv97wGoQvQ1hES1=KO705Za_g@mail.gmail.com>

On Tue, Mar 10, 2015 at 1:02 AM, Amer <amer7777 at hotmail.com> wrote:
> Hello,
>
> Thank you for your message,
> I think I can use only one bridge and the configuration will be:
>
> ovs-vsctl add-br br0
>
> ovs-vsctl add-port br0 eth0
>
> ovs-vsctl add-port br0 eth1
That should work too. But in this case, you will only have one IP
address per VM.  Eitherway (one bridge or patch ports), be careful
about loops.

From zhangchen9211 at 126.com  Tue Mar 10 02:57:18 2015
From: zhangchen9211 at 126.com (=?GBK?B?1cWzvw==?=)
Date: Tue, 10 Mar 2015 17:57:18 +0800 (CST)
Subject: [ovs-discuss] how to configure the group select althogrim?
Message-ID: <26532c76.21a05.14c031dfbdb.Coremail.zhangchen9211@126.com>

Hi,dear all
I wish to implement a L3 load balancing project using ovs, but it is a pity to find that ovs simply supports hash on the dl_dst field, may i change the hash field for nw_dst? Or the switch could just be L2 forwarding sensible?
Best wishes!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/514d6fe9/attachment.html>

From blp at nicira.com  Tue Mar 10 10:37:30 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 10:37:30 -0700
Subject: [ovs-discuss] OFPMT_TABLE_FEATURES is supported in OVS or not
In-Reply-To: <CAHWErLeKsXwgV2Bkq1Jp7h5tr+M6PSKSKGkk4OMNiuOMf-V5wg@mail.gmail.com>
References: <20150304162013.GC18294@nicira.com>
 <CAHWErLdqWn+taQxqJCpOYYLRdiHeh5h90YbZVkndXsN+68O=ZA@mail.gmail.com>
 <20150305002216.GD12423@nicira.com>
 <CAHWErLcFDMZKUMuRNE=OmHcG6p4EAXNBRoqzGY236NFg2=vLVA@mail.gmail.com>
 <20150306211345.GD22286@nicira.com>
 <CAHWErLcVepxq7Whab9NTa8ENFR=4Uha=wFSdwhtvxxfEZqf=RA@mail.gmail.com>
 <20150307073641.GA20134@nicira.com>
 <CAHWErLdBJVqhU2vpnwyr=LKDAJ0GnwO=337KXKz4J++xmpvbJw@mail.gmail.com>
 <20150309160904.GD2961@nicira.com>
 <CAHWErLeKsXwgV2Bkq1Jp7h5tr+M6PSKSKGkk4OMNiuOMf-V5wg@mail.gmail.com>
Message-ID: <20150310173730.GA11735@nicira.com>

Your question makes no sense, because OpenFlow 1.1 and 1.2 had
multiple tables (in the sense that you mean) but did not have
OFPMP_TABLE_FEATURES.  Are you saying that these two versions of
OpenFlow were useless?  If you are, please explain.  If you are not,
then please consult their specifications for information on how to
figure out the number of tables and their properties.

On Tue, Mar 10, 2015 at 10:52:42PM +0530, tech_kals Kals wrote:
> Hi Ben,
> 
>   Thanks for your support.
> 
>  I was asking about how OVS uses multiple flow table when it is not capable
> of informing controller about it has support for multiple flow tables
> through OFPMP_TABLE_FEATURES?
> 
> Since OVS doesnt support OFPMP_TABLE_FEATURES then obviously controller may
> not be knowing the switch has multiple flow tables. So, switch would assume
> OVS has a single table. In this case, how OVS uses multiple flow tables to
> map a flow entry which has been received from controller?
> 
> 
> Meanwhile, *Is there an anticipated date on when OVS 2.4 will be available?
> *
> 
> 
> Thanks,
> Kals.
> 
> On Mon, Mar 9, 2015 at 9:39 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > OpenFlow 1.1 and later support the kind of multiple tables you care
> > about.  Only OpenFlow 1.3 added OFPMP_TABLE_FEATURES.  You can consult
> > the OpenFlow specifications to learn about how OpenFlow works.
> >
> > On Mon, Mar 09, 2015 at 09:41:08AM +0530, tech_kals Kals wrote:
> > > Hi Ben,
> > >
> > > Thanks for your response. Even though OVS 1.3 or later is supporting
> > > multiple flow tables. May I know what is the use of them if controller is
> > > not informed about multiple flow tables through OFPMT_TABLE_FEATURES. Or
> > do
> > > you use some other mechanism to inform the controller about supporting
> > > multiple flow tables on the switch?
> > >
> > >
> > > Thanks,
> > > Kaliyaperumal K
> > >
> > >
> > > On Sat, Mar 7, 2015 at 1:06 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > Only OVS 2.4 supports OFPMT_TABLE_FEATURES.
> > > >
> > > > OVS 1.3 and later support multiple flow tables.
> > > >
> > > > On Sat, Mar 07, 2015 at 08:00:44AM +0530, tech_kals Kals wrote:
> > > > >  In your previous reply to this thread, you had mentioned that OVS
> > 2.4
> > > > only
> > > > > will support multiple flow tables. Now, you mention that it is
> > supported
> > > > in
> > > > > OVS1.3 onwards.  I see, OFPMT_TABLE_FEATURES is not supported in OVS
> > > > 2.1.0.
> > > > > Do you mean, it is supported in 1.3? If it is supported in 1.3
> > release,
> > > > > then obviously it should be supported in 2.1.0 as well... but, not
> > sure
> > > > how
> > > > > it is missed ?
> > > > >
> > > > > I am little bit confused. Could you please clarify me regarding
> > this.?
> > > > >
> > > > > On Sat, Mar 7, 2015 at 2:43 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > > >
> > > > > > On Fri, Mar 06, 2015 at 10:18:29PM +0530, tech_kals Kals wrote:
> > > > > > > Thanks for your reply. I am planning to use OVS to inform the
> > > > controller
> > > > > > > about multiple flow support. Since any of the OVS versions are
> > not
> > > > > > > supporting Multiple flow tables support, could you please
> > clarify my
> > > > > > > doubts. Also, want to know if you share the details how OVS is
> > going
> > > > to
> > > > > > > support multiple flow tables then it would be great for me to do
> > my
> > > > > > > design/coding.
> > > > > >
> > > > > > This question is bizarre.  Open vSwitch has supported multiple flow
> > > > > > tables since 2011, in OVS version 1.3.
> > > > > >
> > > >
> >

From sbiswas7 at linux.vnet.ibm.com  Tue Mar 10 10:38:15 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Tue, 10 Mar 2015 23:08:15 +0530
Subject: [ovs-discuss]  VxLAN kernel module.
Message-ID: <54FF2C07.6060508@linux.vnet.ibm.com>

Hi,

I have a very small query. I am using OVS 2.3.1 and i have built the 
kernel module etc following the instructions in the INSTALL file.

I was also, able to create vxlan ports and communicate across two VMs on 
two different machines using VxLAN tunnels.

However, if i do a lsmod on my machine, it doesn't list the vxlan kernel 
module.

lsmod | grep openvswitch
openvswitch           123112  0
gre                     5383  1 openvswitch
libcrc32c               1922  1 openvswitch

Now i am beginning to think, if i should see the vxlan module there as well?
If yes, then i wonder how my setup is working? :-)

Appreciate your help!

Thanks.
Sudipto


From blp at nicira.com  Tue Mar 10 10:55:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 10:55:55 -0700
Subject: [ovs-discuss] how to configure the group select althogrim?
In-Reply-To: <26532c76.21a05.14c031dfbdb.Coremail.zhangchen9211@126.com>
References: <26532c76.21a05.14c031dfbdb.Coremail.zhangchen9211@126.com>
Message-ID: <20150310175555.GC11735@nicira.com>

On Tue, Mar 10, 2015 at 05:57:18PM +0800, ???? wrote:
> I wish to implement a L3 load balancing project using ovs, but it is
> a pity to find that ovs simply supports hash on the dl_dst field,
> may i change the hash field for nw_dst? Or the switch could just be
> L2 forwarding sensible?

Simon Horman has a patch set out that allows this to be configured.
It seems likely that this will be part of OVS 2.4.

From blp at nicira.com  Tue Mar 10 10:56:39 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 10:56:39 -0700
Subject: [ovs-discuss] Confirm connections in open vswitch
In-Reply-To: <CAEnp_HD4RH5nRm0U9b5UnGMm1bfmx2ex2ABzLSW1336N_qzz=Q@mail.gmail.com>
References: <CAEnp_HD4RH5nRm0U9b5UnGMm1bfmx2ex2ABzLSW1336N_qzz=Q@mail.gmail.com>
Message-ID: <20150310175639.GD11735@nicira.com>

On Tue, Mar 10, 2015 at 02:05:04AM -0600, sandesh shrestha wrote:
> I have open vswitch with three connections to the same mininet host.

What does that mean?

> How can we confirm which port on open vswitch is connected to which
> interface on the host.
> Is there any commnd to check connections like that.

From blp at nicira.com  Tue Mar 10 10:58:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 10:58:59 -0700
Subject: [ovs-discuss] vswitchd crash with flow table 254 deletion
In-Reply-To: <54FE9580.4050106@caviumnetworks.com>
References: <54FE9580.4050106@caviumnetworks.com>
Message-ID: <20150310175859.GE11735@nicira.com>

On Tue, Mar 10, 2015 at 12:26:00PM +0530, Vijaya Mohan Guvva wrote:
> I get vswitchd crash (segfault) consistently with flow table 254
> deletion and with traffic. This special table has internal
> flows/rules (miss_rule, no_packet_in_rule etc) added during bridge
> creation and are getting deleting with ovs-ofctl del-flows <br_name>
> "table=254". These deleted stale rules are referred
> (xbridge->miss_rule and xbridge->no_packet_in_rule) when there is no
> flow match and resulting in segfault. I guess, these default flows
> shouldn't be deleted, but if they are part of flow tables, can be
> deleted. so we should move them a place where they never get deleted
> and always available.

What version of Open vSwitch is this?

From sanshrestha08 at gmail.com  Tue Mar 10 11:06:44 2015
From: sanshrestha08 at gmail.com (sandesh shrestha)
Date: Tue, 10 Mar 2015 12:06:44 -0600
Subject: [ovs-discuss] Confirm connections in open vswitch
In-Reply-To: <20150310175639.GD11735@nicira.com>
References: <CAEnp_HD4RH5nRm0U9b5UnGMm1bfmx2ex2ABzLSW1336N_qzz=Q@mail.gmail.com>
 <20150310175639.GD11735@nicira.com>
Message-ID: <CAEnp_HCsqOERK4vPSAUU9u=avM97Yo-N_0NLcptSW+D0qAj-=A@mail.gmail.com>

This means there are three interfaces in mininet hosts (multiple NICs in
same machine)which connects to three virtual ports in open vSwitch.
On Mar 10, 2015 11:56 AM, "Ben Pfaff" <blp at nicira.com> wrote:

> On Tue, Mar 10, 2015 at 02:05:04AM -0600, sandesh shrestha wrote:
> > I have open vswitch with three connections to the same mininet host.
>
> What does that mean?
>
> > How can we confirm which port on open vswitch is connected to which
> > interface on the host.
> > Is there any commnd to check connections like that.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/8af71b00/attachment.html>

From vguvva at caviumnetworks.com  Tue Mar 10 11:07:51 2015
From: vguvva at caviumnetworks.com (Vijaya Mohan Guvva)
Date: Tue, 10 Mar 2015 23:37:51 +0530
Subject: [ovs-discuss] vswitchd crash with flow table 254 deletion
In-Reply-To: <20150310175859.GE11735@nicira.com>
References: <54FE9580.4050106@caviumnetworks.com>
 <20150310175859.GE11735@nicira.com>
Message-ID: <54FF32F7.8060708@caviumnetworks.com>

On 03/10/2015 11:28 PM, Ben Pfaff wrote:
> On Tue, Mar 10, 2015 at 12:26:00PM +0530, Vijaya Mohan Guvva wrote:
>> I get vswitchd crash (segfault) consistently with flow table 254
>> deletion and with traffic. This special table has internal
>> flows/rules (miss_rule, no_packet_in_rule etc) added during bridge
>> creation and are getting deleting with ovs-ofctl del-flows <br_name>
>> "table=254". These deleted stale rules are referred
>> (xbridge->miss_rule and xbridge->no_packet_in_rule) when there is no
>> flow match and resulting in segfault. I guess, these default flows
>> shouldn't be deleted, but if they are part of flow tables, can be
>> deleted. so we should move them a place where they never get deleted
>> and always available.
> What version of Open vSwitch is this?

Hi Ben,
Its v2.3.0 and v2.3.1.

-- 
Thanks, Vijay

From blp at nicira.com  Tue Mar 10 11:10:54 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 11:10:54 -0700
Subject: [ovs-discuss] Confirm connections in open vswitch
In-Reply-To: <CAEnp_HCsqOERK4vPSAUU9u=avM97Yo-N_0NLcptSW+D0qAj-=A@mail.gmail.com>
References: <CAEnp_HD4RH5nRm0U9b5UnGMm1bfmx2ex2ABzLSW1336N_qzz=Q@mail.gmail.com>
 <20150310175639.GD11735@nicira.com>
 <CAEnp_HCsqOERK4vPSAUU9u=avM97Yo-N_0NLcptSW+D0qAj-=A@mail.gmail.com>
Message-ID: <20150310181054.GF11735@nicira.com>

You can use "ovs-vsctl show" or "ovs-ofctl show <bridge>" to list
ports.

On Tue, Mar 10, 2015 at 12:06:44PM -0600, sandesh shrestha wrote:
> This means there are three interfaces in mininet hosts (multiple NICs in
> same machine)which connects to three virtual ports in open vSwitch.
> On Mar 10, 2015 11:56 AM, "Ben Pfaff" <blp at nicira.com> wrote:
> 
> > On Tue, Mar 10, 2015 at 02:05:04AM -0600, sandesh shrestha wrote:
> > > I have open vswitch with three connections to the same mininet host.
> >
> > What does that mean?
> >
> > > How can we confirm which port on open vswitch is connected to which
> > > interface on the host.
> > > Is there any commnd to check connections like that.
> >

From blp at nicira.com  Tue Mar 10 12:11:38 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 12:11:38 -0700
Subject: [ovs-discuss] Confirm connections in open vswitch
In-Reply-To: <CAEnp_HCAZcqAc7_tLTV+8jWvb0nKEcc2bpZd85k5n1sMEMJyEg@mail.gmail.com>
References: <CAEnp_HD4RH5nRm0U9b5UnGMm1bfmx2ex2ABzLSW1336N_qzz=Q@mail.gmail.com>
 <20150310175639.GD11735@nicira.com>
 <CAEnp_HCsqOERK4vPSAUU9u=avM97Yo-N_0NLcptSW+D0qAj-=A@mail.gmail.com>
 <20150310181054.GF11735@nicira.com>
 <CAEnp_HCAZcqAc7_tLTV+8jWvb0nKEcc2bpZd85k5n1sMEMJyEg@mail.gmail.com>
Message-ID: <20150310191138.GG11735@nicira.com>

I guess that you'll have to ask about that on a mininet list.

On Tue, Mar 10, 2015 at 12:17:54PM -0600, sandesh shrestha wrote:
> Yeah , but how can we confirm which port in open switch is connected to
> which interface in mininet host.
> 
> In physical networks we can see the physical wire connections. How can we
> check that in virtual environment as there are no physical wire connections.
> 
> Thanks,
> Sandesh Shrestha
> You can use "ovs-vsctl show" or "ovs-ofctl show <bridge>" to list
> ports.
> 
> On Tue, Mar 10, 2015 at 12:06:44PM -0600, sandesh shrestha wrote:
> > This means there are three interfaces in mininet hosts (multiple NICs in
> > same machine)which connects to three virtual ports in open vSwitch.
> > On Mar 10, 2015 11:56 AM, "Ben Pfaff" <blp at nicira.com> wrote:
> >
> > > On Tue, Mar 10, 2015 at 02:05:04AM -0600, sandesh shrestha wrote:
> > > > I have open vswitch with three connections to the same mininet host.
> > >
> > > What does that mean?
> > >
> > > > How can we confirm which port on open vswitch is connected to which
> > > > interface on the host.
> > > > Is there any commnd to check connections like that.
> > >

From pshelar at nicira.com  Tue Mar 10 13:19:06 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Tue, 10 Mar 2015 13:19:06 -0700
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <54FF2C07.6060508@linux.vnet.ibm.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com>
Message-ID: <CALnjE+r6eger3jvrqT39NAxEOzX+TQYu1GJuo-YZ2ZgMSbMgcA@mail.gmail.com>

On Tue, Mar 10, 2015 at 10:38 AM, Sudipto Biswas
<sbiswas7 at linux.vnet.ibm.com> wrote:
> Hi,
>
> I have a very small query. I am using OVS 2.3.1 and i have built the kernel
> module etc following the instructions in the INSTALL file.
>
> I was also, able to create vxlan ports and communicate across two VMs on two
> different machines using VxLAN tunnels.
>
> However, if i do a lsmod on my machine, it doesn't list the vxlan kernel
> module.
>
> lsmod | grep openvswitch
> openvswitch           123112  0
> gre                     5383  1 openvswitch
> libcrc32c               1922  1 openvswitch
>
> Now i am beginning to think, if i should see the vxlan module there as well?
> If yes, then i wonder how my setup is working? :-)
>
You might be using older kernel in that  case OVS uses its own VXLAN
code. Can you tell us kernel version?

> Appreciate your help!
>
> Thanks.
> Sudipto
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Tue Mar 10 13:37:47 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 13:37:47 -0700
Subject: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
In-Reply-To: <2015031013514867745449@h3c.com>
References: <CAOCzzUJ9x+s8m_bzb3rwm1hy1oOST9__z1NmCDAOr07-UydCwQ@mail.gmail.com>
 <20150310053752.GC11688@nicira.com>
 <2015031013514867745449@h3c.com>
Message-ID: <20150310203747.GH11735@nicira.com>

Thanks for the report.  I posted a patch:
        http://openvswitch.org/pipermail/dev/2015-March/052260.html
Will you try it out?

Thanks,

Ben.

On Tue, Mar 10, 2015 at 05:52:02AM +0000, Zhangguanghui wrote:
> There is a bug in the rate limiting, for the type of int has a max limit 2147483648,(lt 2000000*1000)
> if you can change type 'int' to 'uint' in the function context, as follow,
> static int tc_add_policer(struct netdev *netdev, int kbits_rate, int kbits_burst)
> 
> From: discuss<mailto:discuss-bounces at openvswitch.org>
> Date: 2015-03-10 13:37
> To: Navneet Singh<mailto:navneet.singh2012 at gmail.com>
> CC: discuss at openvswitch.org<mailto:discuss at openvswitch.org>
> Subject: Re: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
> 
> On Tue, Mar 10, 2015 at 11:05:12AM +0530, Navneet Singh wrote:
> > I am trying to control upload speed using openvswitch on eth1 port using
> > commands like
> >
> >
> > > =>ovs-vsctl set port eth1 qos=@newqos -- --id=@newqos create qos
> > > type=linux-htb queues=0=@q0,1=@q1 -- --id=@q0 create queue
> > > other-config:min-rate=2000000 other-config:max-rate=2000000 -- --id=@q1
> > > create queue other-config:min-rate=3000000 other-config:max-rate=3000000
> >
> >
> > WAN is provided to eth0 port and forwarded to br0 through iptables and NAT.
> > I am able to achieve rate limiting on downloading but not on uploading.
> 
> qdiscs only control the rate of data transmission, not reception.  You
> might want to use policing, please see ovs-vswitchd.conf.db(5) for
> configuration details.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> 
> -------------------------------------------------------------------------------------------------------------------------------------
> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> ?????????
> This e-mail and its attachments contain confidential information from H3C, which is
> intended only for the person or entity whose address is listed above. Any use of the
> information contained herein in any way (including, but not limited to, total or partial
> disclosure, reproduction, or dissemination) by persons other than the intended
> recipient(s) is prohibited. If you receive this e-mail in error, please notify the sender
> by phone or email immediately and delete it!

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From sascha.bleidner at stud.tu-darmstadt.de  Tue Mar 10 13:38:51 2015
From: sascha.bleidner at stud.tu-darmstadt.de (Sascha Bleidner)
Date: Tue, 10 Mar 2015 21:38:51 +0100
Subject: [ovs-discuss] Install Flow Rule directly into the kernel module
Message-ID: <ADDFCFF7-CEB7-480B-B717-F0194E7BD08F@stud.tu-darmstadt.de>

Hi,

I am using OVS 2.0.1 inside a mininet emulation testbed. Since I am focusing on performance related questions, I was wondering if there is a way to force the OVS to directly install a flow rule send along with a flow mod message from the controller directly into the kernel instead of just storing it into the user space until a matching packet arrives at the switch. I am using the Ryu Framework (https://github.com/osrg/ryu) as a controller. 

Some background:
I want to investigate on the possible performance in terms of flow modifications per second achievable, in a scenario where the switch is under a certain load, therefore I assume that each flow rule will be needed in the kernel shortly after installing the flow rule into the switch. 

I appreciate your comments on this! 

-- 
Kind regards,
Sascha


From blp at nicira.com  Tue Mar 10 14:17:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 14:17:25 -0700
Subject: [ovs-discuss] Vlan handling problem in Linux datapath
In-Reply-To: <54FE34B1.5090202@gmail.com>
References: <54FE34B1.5090202@gmail.com>
Message-ID: <20150310211725.GJ11735@nicira.com>

On Mon, Mar 09, 2015 at 08:02:57PM -0400, Thomas F Herbert wrote:
> First apologies in advance for a lengthy message:
> 
> I have seen some strange vlan behavior where there is a miss-match
> on vlan tci. It can be reproduced on every commit I tried since
> version 2.3 but cannot be reproduced in version 2.2.
> 
> The example below is from commit
> 7cc398cb8561a16ae3be5ffc687be5620981d619 in the current master
> branch.
> 
> To reproduce set a specific rule to match on a particular tci. Every
> incoming packet with a miss-matched vlan tag will get the following
> error from the Linux datapath function ovs_nla_get_match():
> 
> [449232.750362] openvswitch: netlink: VLAN tag present bit must have
> an exact match (tci_mask=100).
> [449233.767975] openvswitch: netlink: VLAN tag present bit must have
> an exact match (tci_mask=100).
> [449234.765656] openvswitch: netlink: VLAN tag present bit must have
> an exact match (tci_mask=100).
> 
> This is the flow rule to reproduce the problem:
> 
> ovs-ofctl --protocols=OpenFlow13 add-flow br0
> in_port=2,vlan_tci=0x1e36,priority=20000,actions=pop_vlan,output:1
> 
> I believe that the miss matched packet is getting up-called but when
> the flow comes back to the kernel it doesn't have the mask set
> correctly in the netlink attributes so the kernel has trouble
> parsing it, the flow is never set in the kernel so every subsequent
> packet also misses.

Hmm.  It sounds like a bug, and it sounds like the solution would be
to make sure that if any bits in the VLAN tag are masked, then the
VLAN tag present bit is also masked, but I wasn't able to reproduce
the problem with either branch-2.3 or master with a few minutes'
experimentation.

From blp at nicira.com  Tue Mar 10 15:07:00 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 15:07:00 -0700
Subject: [ovs-discuss] Install Flow Rule directly into the kernel module
In-Reply-To: <ADDFCFF7-CEB7-480B-B717-F0194E7BD08F@stud.tu-darmstadt.de>
References: <ADDFCFF7-CEB7-480B-B717-F0194E7BD08F@stud.tu-darmstadt.de>
Message-ID: <20150310220700.GL11735@nicira.com>

On Tue, Mar 10, 2015 at 09:38:51PM +0100, Sascha Bleidner wrote:
> I am using OVS 2.0.1 inside a mininet emulation testbed. Since I am
> focusing on performance related questions, I was wondering if there
> is a way to force the OVS to directly install a flow rule send along
> with a flow mod message from the controller directly into the kernel
> instead of just storing it into the user space until a matching
> packet arrives at the switch. I am using the Ryu Framework
> (https://github.com/osrg/ryu) as a controller.

You probably shouldn't do that.  If you still want to, you can use
"ovs-dpctl add-flow".

Since you're focusing on performance, you should probably upgrade to
OVS 2.3 or, better yet, a recent snapshot of "master".

From blp at nicira.com  Tue Mar 10 18:58:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 18:58:13 -0700
Subject: [ovs-discuss] OFPMT_TABLE_FEATURES is supported in OVS or not
In-Reply-To: <CAHWErLeMgZwcn5urqV0K3OLBEUdgTeR65GR4Whoh87+oCrkokQ@mail.gmail.com>
References: <20150305002216.GD12423@nicira.com>
 <CAHWErLcFDMZKUMuRNE=OmHcG6p4EAXNBRoqzGY236NFg2=vLVA@mail.gmail.com>
 <20150306211345.GD22286@nicira.com>
 <CAHWErLcVepxq7Whab9NTa8ENFR=4Uha=wFSdwhtvxxfEZqf=RA@mail.gmail.com>
 <20150307073641.GA20134@nicira.com>
 <CAHWErLdBJVqhU2vpnwyr=LKDAJ0GnwO=337KXKz4J++xmpvbJw@mail.gmail.com>
 <20150309160904.GD2961@nicira.com>
 <CAHWErLeKsXwgV2Bkq1Jp7h5tr+M6PSKSKGkk4OMNiuOMf-V5wg@mail.gmail.com>
 <20150310173730.GA11735@nicira.com>
 <CAHWErLeMgZwcn5urqV0K3OLBEUdgTeR65GR4Whoh87+oCrkokQ@mail.gmail.com>
Message-ID: <20150311015813.GA2571@nicira.com>

Exactly the same way as every other OpenFlow switch.  There is nothing
Open vSwitch specific here.

On Wed, Mar 11, 2015 at 06:54:00AM +0530, tech_kals Kals wrote:
> Hi Ben,
> 
>   am just asking when OVS uses multiple flow tables without
> "OFPMP_TABLE_FEATURES".
> How it informs the controller? how they have been used ? Just wanted to get
> it clarified...
> 
> On Tue, Mar 10, 2015 at 11:07 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Your question makes no sense, because OpenFlow 1.1 and 1.2 had
> > multiple tables (in the sense that you mean) but did not have
> > OFPMP_TABLE_FEATURES.  Are you saying that these two versions of
> > OpenFlow were useless?  If you are, please explain.  If you are not,
> > then please consult their specifications for information on how to
> > figure out the number of tables and their properties.
> >
> > On Tue, Mar 10, 2015 at 10:52:42PM +0530, tech_kals Kals wrote:
> > > Hi Ben,
> > >
> > >   Thanks for your support.
> > >
> > >  I was asking about how OVS uses multiple flow table when it is not
> > capable
> > > of informing controller about it has support for multiple flow tables
> > > through OFPMP_TABLE_FEATURES?
> > >
> > > Since OVS doesnt support OFPMP_TABLE_FEATURES then obviously controller
> > may
> > > not be knowing the switch has multiple flow tables. So, switch would
> > assume
> > > OVS has a single table. In this case, how OVS uses multiple flow tables
> > to
> > > map a flow entry which has been received from controller?
> > >
> > >
> > > Meanwhile, *Is there an anticipated date on when OVS 2.4 will be
> > available?
> > > *
> > >
> > >
> > > Thanks,
> > > Kals.
> > >
> > > On Mon, Mar 9, 2015 at 9:39 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > OpenFlow 1.1 and later support the kind of multiple tables you care
> > > > about.  Only OpenFlow 1.3 added OFPMP_TABLE_FEATURES.  You can consult
> > > > the OpenFlow specifications to learn about how OpenFlow works.
> > > >
> > > > On Mon, Mar 09, 2015 at 09:41:08AM +0530, tech_kals Kals wrote:
> > > > > Hi Ben,
> > > > >
> > > > > Thanks for your response. Even though OVS 1.3 or later is supporting
> > > > > multiple flow tables. May I know what is the use of them if
> > controller is
> > > > > not informed about multiple flow tables through
> > OFPMT_TABLE_FEATURES. Or
> > > > do
> > > > > you use some other mechanism to inform the controller about
> > supporting
> > > > > multiple flow tables on the switch?
> > > > >
> > > > >
> > > > > Thanks,
> > > > > Kaliyaperumal K
> > > > >
> > > > >
> > > > > On Sat, Mar 7, 2015 at 1:06 PM, Ben Pfaff <blp at nicira.com> wrote:
> > > > >
> > > > > > Only OVS 2.4 supports OFPMT_TABLE_FEATURES.
> > > > > >
> > > > > > OVS 1.3 and later support multiple flow tables.
> > > > > >
> > > > > > On Sat, Mar 07, 2015 at 08:00:44AM +0530, tech_kals Kals wrote:
> > > > > > >  In your previous reply to this thread, you had mentioned that
> > OVS
> > > > 2.4
> > > > > > only
> > > > > > > will support multiple flow tables. Now, you mention that it is
> > > > supported
> > > > > > in
> > > > > > > OVS1.3 onwards.  I see, OFPMT_TABLE_FEATURES is not supported in
> > OVS
> > > > > > 2.1.0.
> > > > > > > Do you mean, it is supported in 1.3? If it is supported in 1.3
> > > > release,
> > > > > > > then obviously it should be supported in 2.1.0 as well... but,
> > not
> > > > sure
> > > > > > how
> > > > > > > it is missed ?
> > > > > > >
> > > > > > > I am little bit confused. Could you please clarify me regarding
> > > > this.?
> > > > > > >
> > > > > > > On Sat, Mar 7, 2015 at 2:43 AM, Ben Pfaff <blp at nicira.com>
> > wrote:
> > > > > > >
> > > > > > > > On Fri, Mar 06, 2015 at 10:18:29PM +0530, tech_kals Kals wrote:
> > > > > > > > > Thanks for your reply. I am planning to use OVS to inform the
> > > > > > controller
> > > > > > > > > about multiple flow support. Since any of the OVS versions
> > are
> > > > not
> > > > > > > > > supporting Multiple flow tables support, could you please
> > > > clarify my
> > > > > > > > > doubts. Also, want to know if you share the details how OVS
> > is
> > > > going
> > > > > > to
> > > > > > > > > support multiple flow tables then it would be great for me
> > to do
> > > > my
> > > > > > > > > design/coding.
> > > > > > > >
> > > > > > > > This question is bizarre.  Open vSwitch has supported multiple
> > flow
> > > > > > > > tables since 2011, in OVS version 1.3.
> > > > > > > >
> > > > > >
> > > >
> >

From blp at nicira.com  Tue Mar 10 18:59:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 18:59:41 -0700
Subject: [ovs-discuss] how to configure the group select althogrim?
In-Reply-To: <1426032476703.21dm3zhqctwnw0bx2prj4ayj@android.mail.163.com>
References: <26532c76.21a05.14c031dfbdb.Coremail.zhangchen9211@126.com>
 <20150310175555.GC11735@nicira.com>
 <1426032476703.21dm3zhqctwnw0bx2prj4ayj@android.mail.163.com>
Message-ID: <20150311015941.GB2571@nicira.com>

Please don't drop the mailing list.

Simon's patch set would make it possible to add support for round robin.
The patch set does not add such support.

On Wed, Mar 11, 2015 at 08:08:00AM +0800, 张晨 wrote:
> thx for the encouraging answer, and moreover, should round robin also be supported ? 发自网易邮箱 On 2015-03-11 01:55 , Ben Pfaff Wrote: On Tue, Mar 10, 2015 at 05:57:18PM +0800, ???? wrote: > I wish to implement a L3 load balancing project using ovs, but it is > a pity to find that ovs simply supports hash on the dl_dst field, > may i change the hash field for nw_dst? Or the switch could just be > L2 forwarding sensible? Simon Horman has a patch set out that allows this to be configured. It seems likely that this will be part of OVS 2.4.

From zhang.guanghui at h3c.com  Tue Mar 10 19:18:10 2015
From: zhang.guanghui at h3c.com (Zhangguanghui)
Date: Wed, 11 Mar 2015 02:18:10 +0000
Subject: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
References: <CAOCzzUJ9x+s8m_bzb3rwm1hy1oOST9__z1NmCDAOr07-UydCwQ@mail.gmail.com>, 
 <20150310053752.GC11688@nicira.com>, <2015031013514867745449@h3c.com>,
 <20150310203747.GH11735@nicira.com>
Message-ID: <2015031110175725563010@h3c.com>

I'd like to make an addition in the patch.
- tc_fill_rate(&tc_police.rate, (kbits_rate * 1000)/8, mtu);
+ tc_fill_rate(&tc_police.rate, ((uint64_t)kbits_rate * 1000)/8, mtu);

From: Ben Pfaff<mailto:blp at nicira.com>
Date: 2015-03-11 04:37
To: zhangguanghui 10102 (RD)<mailto:zhang.guanghui at h3c.com>
CC: discuss<mailto:discuss-bounces at openvswitch.org>; Navneet Singh<mailto:navneet.singh2012 at gmail.com>; discuss at openvswitch.org<mailto:discuss at openvswitch.org>
Subject: Re: [ovs-discuss] How to apply rate limiting or QoS on upload speed?

Thanks for the report.  I posted a patch:
        http://openvswitch.org/pipermail/dev/2015-March/052260.html
Will you try it out?

Thanks,

Ben.

On Tue, Mar 10, 2015 at 05:52:02AM +0000, Zhangguanghui wrote:
> There is a bug in the rate limiting, for the type of int has a max limit 2147483648,(lt 2000000*1000)
> if you can change type 'int' to 'uint' in the function context, as follow,
> static int tc_add_policer(struct netdev *netdev, int kbits_rate, int kbits_burst)
>
> From: discuss<mailto:discuss-bounces at openvswitch.org>
> Date: 2015-03-10 13:37
> To: Navneet Singh<mailto:navneet.singh2012 at gmail.com>
> CC: discuss at openvswitch.org<mailto:discuss at openvswitch.org>
> Subject: Re: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
>
> On Tue, Mar 10, 2015 at 11:05:12AM +0530, Navneet Singh wrote:
> > I am trying to control upload speed using openvswitch on eth1 port using
> > commands like
> >
> >
> > > =>ovs-vsctl set port eth1 qos=@newqos -- --id=@newqos create qos
> > > type=linux-htb queues=0=@q0,1=@q1 -- --id=@q0 create queue
> > > other-config:min-rate=2000000 other-config:max-rate=2000000 -- --id=@q1
> > > create queue other-config:min-rate=3000000 other-config:max-rate=3000000
> >
> >
> > WAN is provided to eth0 port and forwarded to br0 through iptables and NAT.
> > I am able to achieve rate limiting on downloading but not on uploading.
>
> qdiscs only control the rate of data transmission, not reception.  You
> might want to use policing, please see ovs-vswitchd.conf.db(5) for
> configuration details.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
> -------------------------------------------------------------------------------------------------------------------------------------
> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> ?????????
> This e-mail and its attachments contain confidential information from H3C, which is
> intended only for the person or entity whose address is listed above. Any use of the
> information contained herein in any way (including, but not limited to, total or partial
> disclosure, reproduction, or dissemination) by persons other than the intended
> recipient(s) is prohibited. If you receive this e-mail in error, please notify the sender
> by phone or email immediately and delete it!

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


-------------------------------------------------------------------------------------------------------------------------------------
??????????????????????????,?????????????
?????????????????????(??????????????????
???)?????????????????,??????????????????
??!
This e-mail and its attachments contain confidential information from H3C, which is
intended only for the person or entity whose address is listed above. Any use of the
information contained herein in any way (including, but not limited to, total or partial
disclosure, reproduction, or dissemination) by persons other than the intended
recipient(s) is prohibited. If you receive this e-mail in error, please notify the sender
by phone or email immediately and delete it!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/bd7f1966/attachment-0001.html>

From blp at nicira.com  Tue Mar 10 19:21:37 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 19:21:37 -0700
Subject: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
In-Reply-To: <2015031110175725563010@h3c.com>
References: <CAOCzzUJ9x+s8m_bzb3rwm1hy1oOST9__z1NmCDAOr07-UydCwQ@mail.gmail.com>
 <20150310053752.GC11688@nicira.com>
 <2015031013514867745449@h3c.com>
 <20150310203747.GH11735@nicira.com>
 <2015031110175725563010@h3c.com>
Message-ID: <20150311022137.GC2571@nicira.com>

The latter is what's already there.

On Wed, Mar 11, 2015 at 02:18:10AM +0000, Zhangguanghui wrote:
> I'd like to make an addition in the patch.
> - tc_fill_rate(&tc_police.rate, (kbits_rate * 1000)/8, mtu);
> + tc_fill_rate(&tc_police.rate, ((uint64_t)kbits_rate * 1000)/8, mtu);
> 
> From: Ben Pfaff<mailto:blp at nicira.com>
> Date: 2015-03-11 04:37
> To: zhangguanghui 10102 (RD)<mailto:zhang.guanghui at h3c.com>
> CC: discuss<mailto:discuss-bounces at openvswitch.org>; Navneet Singh<mailto:navneet.singh2012 at gmail.com>; discuss at openvswitch.org<mailto:discuss at openvswitch.org>
> Subject: Re: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
> 
> Thanks for the report.  I posted a patch:
>         http://openvswitch.org/pipermail/dev/2015-March/052260.html
> Will you try it out?
> 
> Thanks,
> 
> Ben.
> 
> On Tue, Mar 10, 2015 at 05:52:02AM +0000, Zhangguanghui wrote:
> > There is a bug in the rate limiting, for the type of int has a max limit 2147483648,(lt 2000000*1000)
> > if you can change type 'int' to 'uint' in the function context, as follow,
> > static int tc_add_policer(struct netdev *netdev, int kbits_rate, int kbits_burst)
> >
> > From: discuss<mailto:discuss-bounces at openvswitch.org>
> > Date: 2015-03-10 13:37
> > To: Navneet Singh<mailto:navneet.singh2012 at gmail.com>
> > CC: discuss at openvswitch.org<mailto:discuss at openvswitch.org>
> > Subject: Re: [ovs-discuss] How to apply rate limiting or QoS on upload speed?
> >
> > On Tue, Mar 10, 2015 at 11:05:12AM +0530, Navneet Singh wrote:
> > > I am trying to control upload speed using openvswitch on eth1 port using
> > > commands like
> > >
> > >
> > > > =>ovs-vsctl set port eth1 qos=@newqos -- --id=@newqos create qos
> > > > type=linux-htb queues=0=@q0,1=@q1 -- --id=@q0 create queue
> > > > other-config:min-rate=2000000 other-config:max-rate=2000000 -- --id=@q1
> > > > create queue other-config:min-rate=3000000 other-config:max-rate=3000000
> > >
> > >
> > > WAN is provided to eth0 port and forwarded to br0 through iptables and NAT.
> > > I am able to achieve rate limiting on downloading but not on uploading.
> >
> > qdiscs only control the rate of data transmission, not reception.  You
> > might want to use policing, please see ovs-vswitchd.conf.db(5) for
> > configuration details.
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
> > -------------------------------------------------------------------------------------------------------------------------------------
> > ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> > ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> > ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
> > ?????????
> > This e-mail and its attachments contain confidential information from H3C, which is
> > intended only for the person or entity whose address is listed above. Any use of the
> > information contained herein in any way (including, but not limited to, total or partial
> > disclosure, reproduction, or dissemination) by persons other than the intended
> > recipient(s) is prohibited. If you receive this e-mail in error, please notify the sender
> > by phone or email immediately and delete it!
> 
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> 
> 
> -------------------------------------------------------------------------------------------------------------------------------------
> ??????????????????????????,?????????????
> ?????????????????????(??????????????????
> ???)?????????????????,??????????????????
> ??!
> This e-mail and its attachments contain confidential information from H3C, which is
> intended only for the person or entity whose address is listed above. Any use of the
> information contained herein in any way (including, but not limited to, total or partial
> disclosure, reproduction, or dissemination) by persons other than the intended
> recipient(s) is prohibited. If you receive this e-mail in error, please notify the sender
> by phone or email immediately and delete it!

From sanshrestha08 at gmail.com  Tue Mar 10 19:28:07 2015
From: sanshrestha08 at gmail.com (sandesh shrestha)
Date: Tue, 10 Mar 2015 20:28:07 -0600
Subject: [ovs-discuss] Problem while creating bond in open vswitch
Message-ID: <CAEnp_HBkOCE6qNiwHuLKCixabJtQS8iwtXOo6jE0ULOxokHK9Q@mail.gmail.com>

Dear All,

My open vswitch configuration is pasted below. I want to create bond with
s1-eth2,s1-eth3 and s1-eth4 but whenever I issue the command:

ovs-vsctl add-bond s1 bond0 s1-eth2 s1-eth3 s1-eth4, I am getting an error.

The error says: "ovs-vsctl: cannot create an interface named s1-eth2
because a port named s1-eth2 already exists on bridge s1"

Could you please tell me what's wrong with what I am doing ? I am trying to
create a bond so the interfaces should already be there. Why is it trying
to create the interfaces ?


root at mininet-vm:~# sudo ovs-vsctl show
aad071f2-ee72-47c0-a963-8cb5c033ad1b
    Bridge "s1"
        Controller "ptcp:6634"
        Controller "tcp:127.0.0.1:6633"
            is_connected: true
        fail_mode: secure
        Port "s1-eth1"
            Interface "s1-eth1"
        Port "s1-eth4"
            Interface "s1-eth4"
        Port "s1"
            Interface "s1"
                type: internal
        Port "s1-eth3"
            Interface "s1-eth3"
        Port "s1-eth2"
            Interface "s1-eth2"
    ovs_version: "2.0.2"


-- 
Sandesh Shrestha
Internetworking Student at U of Alberta
www.sandeshshrestha.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150310/91ba8887/attachment.html>

From blp at nicira.com  Tue Mar 10 19:42:23 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 19:42:23 -0700
Subject: [ovs-discuss] Problem while creating bond in open vswitch
In-Reply-To: <CAEnp_HBkOCE6qNiwHuLKCixabJtQS8iwtXOo6jE0ULOxokHK9Q@mail.gmail.com>
References: <CAEnp_HBkOCE6qNiwHuLKCixabJtQS8iwtXOo6jE0ULOxokHK9Q@mail.gmail.com>
Message-ID: <20150311024223.GE2571@nicira.com>

On Tue, Mar 10, 2015 at 08:28:07PM -0600, sandesh shrestha wrote:
> Dear All,
> 
> My open vswitch configuration is pasted below. I want to create bond with
> s1-eth2,s1-eth3 and s1-eth4 but whenever I issue the command:
> 
> ovs-vsctl add-bond s1 bond0 s1-eth2 s1-eth3 s1-eth4, I am getting an error.
> 
> The error says: "ovs-vsctl: cannot create an interface named s1-eth2
> because a port named s1-eth2 already exists on bridge s1"
> 
> Could you please tell me what's wrong with what I am doing ? I am trying to
> create a bond so the interfaces should already be there. Why is it trying
> to create the interfaces ?

Because that's how it works.  If you want a bond, don't create the
interfaces first.

From blp at nicira.com  Tue Mar 10 19:49:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 19:49:41 -0700
Subject: [ovs-discuss] Fw:  Queue added to ports but not being used
In-Reply-To: <1425682794646.92310@ua.pt>
References: <1425576047545.7989@ua.pt> <20150305191504.GC20780@nicira.com>
 <1425674817204.52599@ua.pt> <20150306210539.GC22286@nicira.com>
 <1425679894141.68534@ua.pt> <20150306221501.GI22286@nicira.com>
 <1425680393437.38425@ua.pt> <20150306222459.GJ22286@nicira.com>
 <1425681307596.27995@ua.pt> <1425682794646.92310@ua.pt>
Message-ID: <20150311024941.GF2571@nicira.com>

"tc qdisc show dev eth0" is a good start.

I was looking for more of an overview.  "ovs-vsctl show" is a good place
to start but a full copy of the database file would be even better.

On Fri, Mar 06, 2015 at 11:00:00PM +0000, Rui Braz wrote:
> 
> "tc" configuration ? How do I check that ?
> By OVS database I think qos and queue table is enough right ?
> queue and qos tables: http://pastebin.com/2kwSAeig
> 
> [Forgot to cc mailings lists]
> 
> Regards,
> Nuno B.
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 6 de março de 2015 22:24
> Para: Rui Braz
> Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> Assunto: Re: [ovs-discuss] Queue added to ports but not being used
> 
> Thanks.
> 
> What configuration does "tc" report for queues?  What is in your OVS
> database?
> 
> On Fri, Mar 06, 2015 at 10:19:58PM +0000, Rui Braz wrote:
> > You're right, i forgot to add it, sorry.
> > Logs: http://pastebin.com/Sk2EQSNy
> >
> > Regards,
> > Nuno B.
> > ________________________________________
> > De: Ben Pfaff <blp at nicira.com>
> > Enviado: 6 de mar?o de 2015 22:15
> > Para: Rui Braz
> > Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> > Assunto: Re: [ovs-discuss] Queue added to ports but not being used
> >
> > We're having a communication problem.  I keep asking for logs and you
> > keep not giving me logs.  When you give me logs, I can start helping
> > again.
> >
> > On Fri, Mar 06, 2015 at 10:11:39PM +0000, Rui Braz wrote:
> > > I've restarted the daemon. I saw the logs being stored elsewhere, with the correct version. The queue is inserted and how many packets passed through it.
> > >
> > > However the command 'sudo ovs-ofctl queue-get-config s1 s1-eth2
> > > ' gives me the output
> > > 'queue 0:
> > > However as you may see the actions I did in mininet since i started the topology: http://pastebin.com/RwvV3K10
> > > After I've defined the rates I created an enqueue action when flows went from s1->s2 and s2->s1. After that I did iperf and bandwidth was too low (around 500kb) and iperf took like 1 minute. After that I just used the action output:<port> in order to have connectivity and then I had around 10mb. Note that when link is not specified in mininet links are around 10Gpbs.
> > >
> > > FYI I added the queues in another tab, but essencially the command was this one: "sudo ovs-vsctl -- set port s1-eth2 qos=@newqos -- --id=@newqos create qos type=linux-htb other-config:max-rate=10000000 queues:0=@newQ -- --id=@newQ create queue other-config:min-rate=150000 other-config:max-rate=250000". I added the same configuration to s1 and s2 switches on port the ports that connect those switches.
> > >
> > > Is that normal behaviour ?
> > >
> > > Regards,
> > > Nuno B.
> > >
> > > ________________________________________
> > > De: Ben Pfaff <blp at nicira.com>
> > > Enviado: 6 de mar?o de 2015 21:05
> > > Para: Rui Braz
> > > Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> > > Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> > >
> > > OK.
> > >
> > > I don't know how to help without the log.  I guess you'll have to
> > > figure out what's going on there first.
> > >
> > > On Fri, Mar 06, 2015 at 08:47:02PM +0000, Rui Braz wrote:
> > > > I don't need to start it, I just launch the topology. I think mininet vm already has scripts to launch it at boot. However after I start the VM i checked the processes that are running and i got this: http://pastebin.com/13bYMN3K
> > > >
> > > > Logs seem to be being saved in the same place according to this excert of the process ovs-vswitchd '--log-file=/usr/var/log/openvswitch/ovs-vswitchd.log'.
> > > >
> > > > However as i mentioned in previous emails, the last info I have on that is about openvswitch 2.0.2 and I have no problem in running mininet with openvswitch 2.3.
> > > >
> > > > Regards,
> > > > Nuno B.
> > > > ________________________________________
> > > > De: Ben Pfaff <blp at nicira.com>
> > > > Enviado: 5 de mar?o de 2015 19:15
> > > > Para: Rui Braz
> > > > Cc: mininet-discuss at lists.stanford.edu
> > > > Assunto: Re: [ovs-discuss] Queue added but not shown using ovs-ofctl
> > > >
> > > > On Thu, Mar 05, 2015 at 05:20:51PM +0000, Rui Braz wrote:
> > > > > I've upgraded the OVS from 2.0.2 to 2.3 using this script: http://pastebin.com/3ViQxg7D. Script was on github from mininet if I'm not mistaken.
> > > > >
> > > > > After doing that the logs generated from OVS are not sent to /var/log/openvswitch because when I go there and print the log only appears to me the log from last version which is 2.0.2 as you may see here: http://pastebin.com/Tf4VtAtz
> > > > >
> > > > > Are the logs being generated elsewhere ?
> > > >
> > > > When you start ovs-vswitchd, where you do tell it to put the log?
> > > >
> > > > > Also I'm able to see the queues I've created if I do "sudo ovs-vsctl list queue".
> > > >
> > > > Not relevant.

From blp at nicira.com  Tue Mar 10 19:57:18 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 19:57:18 -0700
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <CAMg13eccJgrFORti_10-O8cM5a0fuoBKfExz2eAphmVu8aB6bw@mail.gmail.com>
References: <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
 <20150305055042.GA25472@nicira.com>
 <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>
 <CACjuMbzi4CtNa=t3=HDmtU4Rcbm58GTZXQq2S3j4MxBYThs1-g@mail.gmail.com>
 <CAMg13efcjPeYdvdPTi3n93zSvCrQ2O-sYRz7SSxuGkFLWy0RyA@mail.gmail.com>
 <20150306043641.GA24732@nicira.com>
 <CAMg13eds7ixdSuvOjvS0vS+-dACAaSG3f9W566m16HJ7YSmYZA@mail.gmail.com>
 <20150306055355.GB24732@nicira.com>
 <CAMg13eccJgrFORti_10-O8cM5a0fuoBKfExz2eAphmVu8aB6bw@mail.gmail.com>
Message-ID: <20150311025718.GH2571@nicira.com>

Could we try to reduce this to a simpler problem?  So far, you've been
talking about a 2-bridge case.  MAC learning applies just as much to a
single bridge.  Can you try to reproduce the problem with just one
bridge?

From null.pointer.boom at gmail.com  Tue Mar 10 17:53:07 2015
From: null.pointer.boom at gmail.com (null pointer)
Date: Wed, 11 Mar 2015 01:53:07 +0100
Subject: [ovs-discuss] input port == output port
Message-ID: <CAKq4ph_1pz4y5-DEUSoUoTERmw-5DJRHqsSVNT=e7rv8m5QwCg@mail.gmail.com>

Hi,

For a special case I need to add a flow to open vswitch that would allow me
to set the input port as the output port for the switch.
Currently even if I add such a flow, the packet is by default dropped,
which is expected, in order to avoid a loop.
Which module should I alter/change to allow that.

Thanks & Regards,
Maiti
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/7a12a1b1/attachment.html>

From blp at nicira.com  Tue Mar 10 21:16:39 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 10 Mar 2015 21:16:39 -0700
Subject: [ovs-discuss] input port == output port
In-Reply-To: <CAKq4ph_1pz4y5-DEUSoUoTERmw-5DJRHqsSVNT=e7rv8m5QwCg@mail.gmail.com>
References: <CAKq4ph_1pz4y5-DEUSoUoTERmw-5DJRHqsSVNT=e7rv8m5QwCg@mail.gmail.com>
Message-ID: <20150311041639.GI2571@nicira.com>

On Wed, Mar 11, 2015 at 01:53:07AM +0100, null pointer wrote:
> For a special case I need to add a flow to open vswitch that would allow me
> to set the input port as the output port for the switch.
> Currently even if I add such a flow, the packet is by default dropped,
> which is expected, in order to avoid a loop.
> Which module should I alter/change to allow that.

The FAQ says:

### Q: I added a flow to send packets out the ingress port, like this:

       ovs-ofctl add-flow br0 in_port=2,actions=2

   but OVS drops the packets instead.

A: Yes, OpenFlow requires a switch to ignore attempts to send a packet
   out its ingress port.  The rationale is that dropping these packets
   makes it harder to loop the network.  Sometimes this behavior can
   even be convenient, e.g. it is often the desired behavior in a flow
   that forwards a packet to several ports ("floods" the packet).

   Sometimes one really needs to send a packet out its ingress port
   ("hairpin"). In this case, output to OFPP_IN_PORT, which in
   ovs-ofctl syntax is expressed as just "in_port", e.g.:

       ovs-ofctl add-flow br0 in_port=2,actions=in_port

   This also works in some circumstances where the flow doesn't match
   on the input port.  For example, if you know that your switch has
   five ports numbered 2 through 6, then the following will send every
   received packet out every port, even its ingress port:

       ovs-ofctl add-flow br0 actions=2,3,4,5,6,in_port

   or, equivalently:

       ovs-ofctl add-flow br0 actions=all,in_port

   Sometimes, in complicated flow tables with multiple levels of
   "resubmit" actions, a flow needs to output to a particular port
   that may or may not be the ingress port.  It's difficult to take
   advantage of OFPP_IN_PORT in this situation.  To help, Open vSwitch
   provides, as an OpenFlow extension, the ability to modify the
   in_port field.  Whatever value is currently in the in_port field is
   the port to which outputs will be dropped, as well as the
   destination for OFPP_IN_PORT.  This means that the following will
   reliably output to port 2 or to ports 2 through 6, respectively:

       ovs-ofctl add-flow br0 in_port=2,actions=load:0->NXM_OF_IN_PORT[],2
       ovs-ofctl add-flow br0 actions=load:0->NXM_OF_IN_PORT[],2,3,4,5,6

   If the input port is important, then one may save and restore it on
   the stack:

        ovs-ofctl add-flow br0 actions=push:NXM_OF_IN_PORT[],\
                                       load:0->NXM_OF_IN_PORT[],\
                                       2,3,4,5,6,\
                                       pop:NXM_OF_IN_PORT[]

From chaitanya.tanwar at gmail.com  Tue Mar 10 21:37:50 2015
From: chaitanya.tanwar at gmail.com (chaitanya tanwar)
Date: Wed, 11 Mar 2015 10:07:50 +0530
Subject: [ovs-discuss] input port == output port
In-Reply-To: <CAKq4ph_1pz4y5-DEUSoUoTERmw-5DJRHqsSVNT=e7rv8m5QwCg@mail.gmail.com>
References: <CAKq4ph_1pz4y5-DEUSoUoTERmw-5DJRHqsSVNT=e7rv8m5QwCg@mail.gmail.com>
Message-ID: <CAEm0QqC0F4P-6R4yOBB0aj6hzpJiBo-RTaQFjaU+bNCAc_wvEw@mail.gmail.com>

Hi,

If you are using pox controller then you need to set the output port as
OFPP_IN_PORT.

On Wed, Mar 11, 2015 at 6:23 AM, null pointer <null.pointer.boom at gmail.com>
wrote:

>  Hi,
>
> For a special case I need to add a flow to open vswitch that would allow
> me to set the input port as the output port for the switch.
> Currently even if I add such a flow, the packet is by default dropped,
> which is expected, in order to avoid a loop.
> Which module should I alter/change to allow that.
>
> Thanks & Regards,
> Maiti
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/70e22e70/attachment.html>

From sbiswas7 at linux.vnet.ibm.com  Tue Mar 10 22:51:39 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Wed, 11 Mar 2015 11:21:39 +0530
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <CALnjE+r6eger3jvrqT39NAxEOzX+TQYu1GJuo-YZ2ZgMSbMgcA@mail.gmail.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com>
 <CALnjE+r6eger3jvrqT39NAxEOzX+TQYu1GJuo-YZ2ZgMSbMgcA@mail.gmail.com>
Message-ID: <54FFD7EB.7040601@linux.vnet.ibm.com>


On Wednesday 11 March 2015 01:49 AM, Pravin Shelar wrote:
> On Tue, Mar 10, 2015 at 10:38 AM, Sudipto Biswas
> <sbiswas7 at linux.vnet.ibm.com> wrote:
>> Hi,
>>
>> I have a very small query. I am using OVS 2.3.1 and i have built the kernel
>> module etc following the instructions in the INSTALL file.
>>
>> I was also, able to create vxlan ports and communicate across two VMs on two
>> different machines using VxLAN tunnels.
>>
>> However, if i do a lsmod on my machine, it doesn't list the vxlan kernel
>> module.
>>
>> lsmod | grep openvswitch
>> openvswitch           123112  0
>> gre                     5383  1 openvswitch
>> libcrc32c               1922  1 openvswitch
>>
>> Now i am beginning to think, if i should see the vxlan module there as well?
>> If yes, then i wonder how my setup is working? :-)
>>
> You might be using older kernel in that  case OVS uses its own VXLAN
> code. Can you tell us kernel version?
>
  I am using Kernel ver. 3.10. There's a bit of a history though. I 
tried 2.3.1 on this machine and then vxlan didn't work.
  Then i installed OVS 2.0.0, in that VxLAN worked. Then i uninstalled 
2.0.0 and installed 2.3.1 and that worked with VxLAN too.
  So I was thinking if 2.0.0 got the vxlan module installed?
  In kernel ver 3.10 - isn't it supposed to list the vxlan kernel module 
if i don't go through this upgrade path?

>> Appreciate your help!
>>
>> Thanks.
>> Sudipto
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>


From fengyuleidian0615 at gmail.com  Tue Mar 10 23:05:44 2015
From: fengyuleidian0615 at gmail.com (Fan Du)
Date: Wed, 11 Mar 2015 14:05:44 +0800
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <54FF2C07.6060508@linux.vnet.ibm.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com>
Message-ID: <54FFDB38.1020007@gmail.com>

于 2015年03月11日 01:38, Sudipto Biswas 写道:
> Hi,
>
> I have a very small query. I am using OVS 2.3.1 and i have built the kernel module etc following the instructions in the INSTALL file.
>
> I was also, able to create vxlan ports and communicate across two VMs on two different machines using VxLAN tunnels.
>
> However, if i do a lsmod on my machine, it doesn't list the vxlan kernel module.

CONFIG_VXLAN is set as 'y' or 'm' ?

> lsmod | grep openvswitch
> openvswitch           123112  0
> gre                     5383  1 openvswitch
> libcrc32c               1922  1 openvswitch
>
> Now i am beginning to think, if i should see the vxlan module there as well?
> If yes, then i wonder how my setup is working? :-)
>
> Appreciate your help!
>
> Thanks.
> Sudipto
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From sbiswas7 at linux.vnet.ibm.com  Tue Mar 10 23:42:12 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Wed, 11 Mar 2015 12:12:12 +0530
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <54FFDB38.1020007@gmail.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com> <54FFDB38.1020007@gmail.com>
Message-ID: <54FFE3C4.3090309@linux.vnet.ibm.com>


On Wednesday 11 March 2015 11:35 AM, Fan Du wrote:
> 于 2015年03月11日 01:38, Sudipto Biswas 写道:
>> Hi,
>>
>> I have a very small query. I am using OVS 2.3.1 and i have built the 
>> kernel module etc following the instructions in the INSTALL file.
>>
>> I was also, able to create vxlan ports and communicate across two VMs 
>> on two different machines using VxLAN tunnels.
>>
>> However, if i do a lsmod on my machine, it doesn't list the vxlan 
>> kernel module.
>
> CONFIG_VXLAN is set as 'y' or 'm' ?
   Where would you want me to set this option? As in some file?
>> lsmod | grep openvswitch
>> openvswitch           123112  0
>> gre                     5383  1 openvswitch
>> libcrc32c               1922  1 openvswitch
>>
>> Now i am beginning to think, if i should see the vxlan module there 
>> as well?
>> If yes, then i wonder how my setup is working? :-)
>>
>> Appreciate your help!
>>
>> Thanks.
>> Sudipto
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>
>
>


From fengyuleidian0615 at gmail.com  Tue Mar 10 23:42:36 2015
From: fengyuleidian0615 at gmail.com (Fan Du)
Date: Wed, 11 Mar 2015 14:42:36 +0800
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <54FFE3C4.3090309@linux.vnet.ibm.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com> <54FFDB38.1020007@gmail.com>
 <54FFE3C4.3090309@linux.vnet.ibm.com>
Message-ID: <54FFE3DC.5010307@gmail.com>

于 2015年03月11日 14:42, Sudipto Biswas 写道:
>
> On Wednesday 11 March 2015 11:35 AM, Fan Du wrote:
>> 于 2015年03月11日 01:38, Sudipto Biswas 写道:
>>> Hi,
>>>
>>> I have a very small query. I am using OVS 2.3.1 and i have built the kernel module etc following the instructions in the INSTALL file.
>>>
>>> I was also, able to create vxlan ports and communicate across two VMs on two different machines using VxLAN tunnels.
>>>
>>> However, if i do a lsmod on my machine, it doesn't list the vxlan kernel module.
>>
>> CONFIG_VXLAN is set as 'y' or 'm' ?
>    Where would you want me to set this option? As in some file?
oh...

If you are using your host default config, then kernel config file is at /boot/config-2.6.32-358.el6.x86_64,
the suffix may varies depending on your kernel version.

cat /boot/config-2.6.32-358.el6.x86_64 | grep CONFIG_VXLAN

>>> lsmod | grep openvswitch
>>> openvswitch           123112  0
>>> gre                     5383  1 openvswitch
>>> libcrc32c               1922  1 openvswitch
>>>
>>> Now i am beginning to think, if i should see the vxlan module there as well?
>>> If yes, then i wonder how my setup is working? :-)
>>>
>>> Appreciate your help!
>>>
>>> Thanks.
>>> Sudipto
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>>
>


From sbiswas7 at linux.vnet.ibm.com  Wed Mar 11 00:06:43 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Wed, 11 Mar 2015 12:36:43 +0530
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <54FFE3DC.5010307@gmail.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com> <54FFDB38.1020007@gmail.com>
 <54FFE3C4.3090309@linux.vnet.ibm.com> <54FFE3DC.5010307@gmail.com>
Message-ID: <54FFE983.2070207@linux.vnet.ibm.com>


On Wednesday 11 March 2015 12:12 PM, Fan Du wrote:
> 于 2015年03月11日 14:42, Sudipto Biswas 写道:
>>
>> On Wednesday 11 March 2015 11:35 AM, Fan Du wrote:
>>> 于 2015年03月11日 01:38, Sudipto Biswas 写道:
>>>> Hi,
>>>>
>>>> I have a very small query. I am using OVS 2.3.1 and i have built 
>>>> the kernel module etc following the instructions in the INSTALL file.
>>>>
>>>> I was also, able to create vxlan ports and communicate across two 
>>>> VMs on two different machines using VxLAN tunnels.
>>>>
>>>> However, if i do a lsmod on my machine, it doesn't list the vxlan 
>>>> kernel module.
>>>
>>> CONFIG_VXLAN is set as 'y' or 'm' ?
>>    Where would you want me to set this option? As in some file?
> oh...
>
> If you are using your host default config, then kernel config file is 
> at /boot/config-2.6.32-358.el6.x86_64,
> the suffix may varies depending on your kernel version.
>
> cat /boot/config-2.6.32-358.el6.x86_64 | grep CONFIG_VXLAN
>
   Thanks, I found that the vxlan module was built. Then did a modprobe 
of the vxlan module and now lsmod lists vxlan.
   However, like the gre module is being used/referenced by openvswitch 
- vxlan doesn't have a reference count:

   lsmod | grep vxlan
     vxlan                  29379  0
     ip_tunnel              20094  1 vxlan

   lsmod | grep gre
    gre                     5383  1 openvswitch

   Shouldn't we have the vxlan being referenced by OVS as well? (since i 
have some vxlan ports created)
   I have a very basic knowledge of the kernel , so please bear with me :-)
>>>> lsmod | grep openvswitch
>>>> openvswitch           123112  0
>>>> gre                     5383  1 openvswitch
>>>> libcrc32c               1922  1 openvswitch
>>>>
>>>> Now i am beginning to think, if i should see the vxlan module there 
>>>> as well?
>>>> If yes, then i wonder how my setup is working? :-)
>>>>
>>>> Appreciate your help!
>>>>
>>>> Thanks.
>>>> Sudipto
>>>>
>>>> _______________________________________________
>>>> discuss mailing list
>>>> discuss at openvswitch.org
>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>
>>>
>>>
>>
>
>
>


From sbiswas7 at linux.vnet.ibm.com  Wed Mar 11 00:19:09 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Wed, 11 Mar 2015 12:49:09 +0530
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <54FFE983.2070207@linux.vnet.ibm.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com> <54FFDB38.1020007@gmail.com>
 <54FFE3C4.3090309@linux.vnet.ibm.com> <54FFE3DC.5010307@gmail.com>
 <54FFE983.2070207@linux.vnet.ibm.com>
Message-ID: <54FFEC6D.60908@linux.vnet.ibm.com>


On Wednesday 11 March 2015 12:36 PM, Sudipto Biswas wrote:
>
> On Wednesday 11 March 2015 12:12 PM, Fan Du wrote:
>> 于 2015年03月11日 14:42, Sudipto Biswas 写道:
>>>
>>> On Wednesday 11 March 2015 11:35 AM, Fan Du wrote:
>>>> 于 2015年03月11日 01:38, Sudipto Biswas 写道:
>>>>> Hi,
>>>>>
>>>>> I have a very small query. I am using OVS 2.3.1 and i have built 
>>>>> the kernel module etc following the instructions in the INSTALL file.
>>>>>
>>>>> I was also, able to create vxlan ports and communicate across two 
>>>>> VMs on two different machines using VxLAN tunnels.
>>>>>
>>>>> However, if i do a lsmod on my machine, it doesn't list the vxlan 
>>>>> kernel module.
>>>>
>>>> CONFIG_VXLAN is set as 'y' or 'm' ?
>>>    Where would you want me to set this option? As in some file?
>> oh...
>>
>> If you are using your host default config, then kernel config file is 
>> at /boot/config-2.6.32-358.el6.x86_64,
>> the suffix may varies depending on your kernel version.
>>
>> cat /boot/config-2.6.32-358.el6.x86_64 | grep CONFIG_VXLAN
>>
>   Thanks, I found that the vxlan module was built. Then did a modprobe 
> of the vxlan module and now lsmod lists vxlan.
>   However, like the gre module is being used/referenced by openvswitch 
> - vxlan doesn't have a reference count:
>
>   lsmod | grep vxlan
>     vxlan                  29379  0
>     ip_tunnel              20094  1 vxlan
>
>   lsmod | grep gre
>    gre                     5383  1 openvswitch
>
>   Shouldn't we have the vxlan being referenced by OVS as well? (since 
> i have some vxlan ports created)
>   I have a very basic knowledge of the kernel , so please bear with me 
> :-)
   To answer your first question though:

   CONFIG_VXLAN=m - this is the setting in the kernel config.
   I am guessing that the kernel module should be loaded by openvswitch 
when we build it for the kernel?

>>>>> lsmod | grep openvswitch
>>>>> openvswitch           123112  0
>>>>> gre                     5383  1 openvswitch
>>>>> libcrc32c               1922  1 openvswitch
>>>>>
>>>>> Now i am beginning to think, if i should see the vxlan module 
>>>>> there as well?
>>>>> If yes, then i wonder how my setup is working? :-)
>>>>>
>>>>> Appreciate your help!
>>>>>
>>>>> Thanks.
>>>>> Sudipto
>>>>>
>>>>> _______________________________________________
>>>>> discuss mailing list
>>>>> discuss at openvswitch.org
>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>
>>>>
>>>>
>>>
>>
>>
>>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From sascha.bleidner at stud.tu-darmstadt.de  Wed Mar 11 01:30:22 2015
From: sascha.bleidner at stud.tu-darmstadt.de (Sascha Bleidner)
Date: Wed, 11 Mar 2015 09:30:22 +0100
Subject: [ovs-discuss] Install Flow Rule directly into the kernel module
In-Reply-To: <20150310220700.GL11735@nicira.com>
References: <ADDFCFF7-CEB7-480B-B717-F0194E7BD08F@stud.tu-darmstadt.de>
 <20150310220700.GL11735@nicira.com>
Message-ID: <F345B665-B39D-4B6C-8AB6-0A81C9E88F0A@stud.tu-darmstadt.de>

Thanks, I will also look into the newer version. 
So there is no option to force the switch to install flow mods coming from a controller to be installed in the kernel, since my test program runs on the controller. 

Otherwise I would need to write a bash script instead. 

-- 
Kind Regards,
Sascha

> Am 10.03.2015 um 23:07 schrieb Ben Pfaff <blp at nicira.com>:
> 
> On Tue, Mar 10, 2015 at 09:38:51PM +0100, Sascha Bleidner wrote:
>> I am using OVS 2.0.1 inside a mininet emulation testbed. Since I am
>> focusing on performance related questions, I was wondering if there
>> is a way to force the OVS to directly install a flow rule send along
>> with a flow mod message from the controller directly into the kernel
>> instead of just storing it into the user space until a matching
>> packet arrives at the switch. I am using the Ryu Framework
>> (https://github.com/osrg/ryu) as a controller.
> 
> You probably shouldn't do that.  If you still want to, you can use
> "ovs-dpctl add-flow".
> 
> Since you're focusing on performance, you should probably upgrade to
> OVS 2.3 or, better yet, a recent snapshot of "master".


From amer7777 at hotmail.com  Wed Mar 11 02:06:17 2015
From: amer7777 at hotmail.com (AMER)
Date: Wed, 11 Mar 2015 09:06:17 +0000
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <CAHbON5rhwQy2EJT+oe6PPStjvCv97wGoQvQ1hES1=KO705Za_g@mail.gmail.com>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>,
 <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>,
 <CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>,
 <BLU436-SMTP8583FEBF0EE9805CFF7614D4180@phx.gbl>,
 <CAHbON5rhwQy2EJT+oe6PPStjvCv97wGoQvQ1hES1=KO705Za_g@mail.gmail.com>
Message-ID: <DUB113-W5197E09AFC4D6AC0AFD3DAD4190@phx.gbl>

Hello,

I did the following configurations in my VBox, however, I can't ping the host machine "192.168.5.2"



	
	
	
	


ovs-vsctl add-br
br0
ovs-vsctl add-port br0 eth0
ovs-vsctl add-port br0 eth1
Ifconfig eth0 0
Ifconfig br0 192.168.5.1 netmask 255.255.255.0

Best regards,

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA


> Date: Tue, 10 Mar 2015 07:19:28 -0700
> Subject: Re: [ovs-discuss] Linear topology in openveswitch
> From: shettyg at nicira.com
> To: amer7777 at hotmail.com
> CC: discuss at openvswitch.org
> 
> On Tue, Mar 10, 2015 at 1:02 AM, Amer <amer7777 at hotmail.com> wrote:
> > Hello,
> >
> > Thank you for your message,
> > I think I can use only one bridge and the configuration will be:
> >
> > ovs-vsctl add-br br0
> >
> > ovs-vsctl add-port br0 eth0
> >
> > ovs-vsctl add-port br0 eth1
> That should work too. But in this case, you will only have one IP
> address per VM.  Eitherway (one bridge or patch ports), be careful
> about loops.
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/ceb50570/attachment.html>

From cvinllen at gmail.com  Wed Mar 11 04:14:05 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Wed, 11 Mar 2015 19:14:05 +0800
Subject: [ovs-discuss] How does the kernel space and usespace receive
	netlink message
Message-ID: <CAN2QyzZceSd2oYXtj1fbN=cMsF6F4mMLS1NOg_QFx766XLFOFA@mail.gmail.com>

Hi, all:
    When i read the source code of ovs, i found the userspace receives
netlink message by epoll. But in the explanition of dpif.h, datapath starts
many threads to receiving netlink.
    Could anybody give me a definite answer that how does the userspace and
kernel space receive netlink messages.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/261d0859/attachment.html>

From stefano.salsano at uniroma2.it  Wed Mar 11 05:01:16 2015
From: stefano.salsano at uniroma2.it (Stefano Salsano)
Date: Wed, 11 Mar 2015 13:01:16 +0100
Subject: [ovs-discuss] match/push/pop more than 3 MPLS labels
In-Reply-To: <CALnjE+o8m-yyww_4K5zkf3-hF23R_KxgjiLFAdOfN5f0rpq-RQ@mail.gmail.com>
References: <54EF1CCD.4010705@uniroma2.it>
 <CALnjE+o8m-yyww_4K5zkf3-hF23R_KxgjiLFAdOfN5f0rpq-RQ@mail.gmail.com>
Message-ID: <55002E8C.9060301@uniroma2.it>

Il 27/02/2015 00:52, Pravin Shelar ha scritto:
> On Thu, Feb 26, 2015 at 5:17 AM, Stefano Salsano wrote:
>>
>> there is a limit of 3 MPLS labels that are supported by Open vSwitch
>> we need to raise it at 5 labels, to implement a segment routing scenario
>>
> You can start with changing FLOW_MAX_MPLS_LABELS to 5.

Dear Pravin,

thanks for your hint, we have tried and we realized that we also need to 
change an assert in lib/flow.h

current code is
BUILD_ASSERT_DECL(offsetof(struct flow, igmp_group_ip4) + 
sizeof(uint32_t) == sizeof(struct flow_tnl) + 192 && FLOW_WC_SEQ == 31);

we need to change it into:
BUILD_ASSERT_DECL(offsetof(struct flow, igmp_group_ip4) + 
sizeof(uint32_t) == sizeof(struct flow_tnl) + 176 + (4 * 
ROUND_UP(FLOW_MAX_MPLS_LABELS, 2)) && FLOW_WC_SEQ == 31);

basically, we need to split the 192 bytes in a fixed part of 176 bytes 
and in a part that depends on the number of supported MPLS labels

we tried it, and it compiles and runs well :-)

do you think it is OK ? do you want us to provide a patch ?

thank you

ciao
Stefano & Pier Luigi

>
>
>> any help or suggestion is welcome!
>>
>> I am trying on ovs-discuss list... may be the ovs-dev list is more
>> appropriate for this type of questions?
>>
>> thank you
>>
>> ciao
>> Stefano
>> --
>> *******************************************************************
>> Stefano Salsano
>> Professore Associato
>> Dipartimento Ingegneria Elettronica
>> Universita' di Roma Tor Vergata
>> Via del Politecnico, 1 - 00133 Roma - ITALY
>>
>> http://netgroup.uniroma2.it/Stefano_Salsano/
>>
>> E-mail  : stefano.salsano at uniroma2.it
>> Cell.   : +39 320 4307310
>> Office  : (Tel.) +39 06 72597770  (Fax.) +39 06 72597435
>> *******************************************************************
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>


-- 
*******************************************************************
Stefano Salsano
Professore Associato
Dipartimento Ingegneria Elettronica
Universita' di Roma Tor Vergata
Via del Politecnico, 1 - 00133 Roma - ITALY

http://netgroup.uniroma2.it/Stefano_Salsano/

E-mail  : stefano.salsano at uniroma2.it
Cell.   : +39 320 4307310
Office  : (Tel.) +39 06 72597770  (Fax.) +39 06 72597435
*******************************************************************

From amer7777 at hotmail.com  Wed Mar 11 05:08:24 2015
From: amer7777 at hotmail.com (AMER)
Date: Wed, 11 Mar 2015 12:08:24 +0000
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <DUB113-W5197E09AFC4D6AC0AFD3DAD4190@phx.gbl>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>, ,
 <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>, ,
 <CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>, ,
 <BLU436-SMTP8583FEBF0EE9805CFF7614D4180@phx.gbl>, ,
 <CAHbON5rhwQy2EJT+oe6PPStjvCv97wGoQvQ1hES1=KO705Za_g@mail.gmail.com>,
 <DUB113-W5197E09AFC4D6AC0AFD3DAD4190@phx.gbl>
Message-ID: <DUB113-W29E6B1A6068038336C3FC1D4190@phx.gbl>

Hello,

I have solved this issue, Thank, however, I would like to ask you about the following command:

ovs-ofctl add-flows br0 table=1, priority=99, dl_type=0x800, nw_src=192.168.5.2, actions=mod_nw_src=10.10.10.10, resubmit(,2)

I received the following error
bash syntax error near unexpected token '('


Best regards,

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA


From: amer7777 at hotmail.com
To: shettyg at nicira.com
Date: Wed, 11 Mar 2015 09:06:17 +0000
CC: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Linear topology in openveswitch




Hello,

I did the following configurations in my VBox, however, I can't ping the host machine "192.168.5.2"



	
	
	
	


ovs-vsctl add-br
br0
ovs-vsctl add-port br0 eth0
ovs-vsctl add-port br0 eth1
Ifconfig eth0 0
Ifconfig br0 192.168.5.1 netmask 255.255.255.0

Best regards,

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA


> Date: Tue, 10 Mar 2015 07:19:28 -0700
> Subject: Re: [ovs-discuss] Linear topology in openveswitch
> From: shettyg at nicira.com
> To: amer7777 at hotmail.com
> CC: discuss at openvswitch.org
> 
> On Tue, Mar 10, 2015 at 1:02 AM, Amer <amer7777 at hotmail.com> wrote:
> > Hello,
> >
> > Thank you for your message,
> > I think I can use only one bridge and the configuration will be:
> >
> > ovs-vsctl add-br br0
> >
> > ovs-vsctl add-port br0 eth0
> >
> > ovs-vsctl add-port br0 eth1
> That should work too. But in this case, you will only have one IP
> address per VM.  Eitherway (one bridge or patch ports), be careful
> about loops.
 		 	   		  

_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/25cd10e5/attachment-0001.html>

From vguvva at caviumnetworks.com  Wed Mar 11 05:16:05 2015
From: vguvva at caviumnetworks.com (Vijaya Mohan Guvva)
Date: Wed, 11 Mar 2015 17:46:05 +0530
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <DUB113-W29E6B1A6068038336C3FC1D4190@phx.gbl>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>, ,
 <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>, ,
 <CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>, ,
 <BLU436-SMTP8583FEBF0EE9805CFF7614D4180@phx.gbl>, ,
 <CAHbON5rhwQy2EJT+oe6PPStjvCv97wGoQvQ1hES1=KO705Za_g@mail.gmail.com>,
 <DUB113-W5197E09AFC4D6AC0AFD3DAD4190@phx.gbl>
 <DUB113-W29E6B1A6068038336C3FC1D4190@phx.gbl>
Message-ID: <55003205.3010906@caviumnetworks.com>

On 03/11/2015 05:38 PM, AMER wrote:
> ovs-ofctl add-flows br0 table=1, priority=99, dl_type=0x800, 
> nw_src=192.168.5.2, actions=mod_nw_src=10.10.10.10, resubmit(,2)

resubmit\(,2\) should work.

-- 
Thanks, Vijay

From sbiswas7 at linux.vnet.ibm.com  Wed Mar 11 06:39:59 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Wed, 11 Mar 2015 19:09:59 +0530
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <55003205.3010906@caviumnetworks.com>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>, ,
 <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>, ,
 <CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>, ,
 <BLU436-SMTP8583FEBF0EE9805CFF7614D4180@phx.gbl>, ,
 <CAHbON5rhwQy2EJT+oe6PPStjvCv97wGoQvQ1hES1=KO705Za_g@mail.gmail.com>,
 <DUB113-W5197E09AFC4D6AC0AFD3DAD4190@phx.gbl>
 <DUB113-W29E6B1A6068038336C3FC1D4190@phx.gbl>
 <55003205.3010906@caviumnetworks.com>
Message-ID: <550045AF.6030203@linux.vnet.ibm.com>


On Wednesday 11 March 2015 05:46 PM, Vijaya Mohan Guvva wrote:
> On 03/11/2015 05:38 PM, AMER wrote:
>> ovs-ofctl add-flows br0 table=1, priority=99, dl_type=0x800, 
>> nw_src=192.168.5.2, actions=mod_nw_src=10.10.10.10, resubmit(,2)
>
> resubmit\(,2\) should work.
>
Or you can also include the whole thing inside a string:

  ovs-ofctl add-flows br0 "table=1, priority=99, dl_type=0x800, 
nw_src=192.168.5.2, actions=mod_nw_src=10.10.10.10, resubmit(,2)"

You could also create a flow.txt file with your flow details and then 
add that as a part of the ofctl command like:

   ovs-ofctl add-flows br0 flows.txt.

Hope this helps!

Cheers,
Sudipto


From cheng at cs.umn.edu  Wed Mar 11 07:13:10 2015
From: cheng at cs.umn.edu (Cheng Jin)
Date: Wed, 11 Mar 2015 09:13:10 -0500
Subject: [ovs-discuss] MAC learning table does not always update
In-Reply-To: <20150311025718.GH2571@nicira.com>
References: <20150304220206.GE15164@nicira.com>
 <CAMg13ed8OpFaDcpV4X0_7aLx25XF0YwDAbZA3qJ7vFpgj7oCRg@mail.gmail.com>
 <20150305055042.GA25472@nicira.com>
 <CAMg13ef4tGfaq68qJDQbzq8mFb+CG4-n=Q6xZ1qAVEKVQOf-rQ@mail.gmail.com>
 <CACjuMbzi4CtNa=t3=HDmtU4Rcbm58GTZXQq2S3j4MxBYThs1-g@mail.gmail.com>
 <CAMg13efcjPeYdvdPTi3n93zSvCrQ2O-sYRz7SSxuGkFLWy0RyA@mail.gmail.com>
 <20150306043641.GA24732@nicira.com>
 <CAMg13eds7ixdSuvOjvS0vS+-dACAaSG3f9W566m16HJ7YSmYZA@mail.gmail.com>
 <20150306055355.GB24732@nicira.com>
 <CAMg13eccJgrFORti_10-O8cM5a0fuoBKfExz2eAphmVu8aB6bw@mail.gmail.com>
 <20150311025718.GH2571@nicira.com>
Message-ID: <CAMg13ed8WovxkP6eiTBmaJvRCRxMEqNv1uTD1c2t7OFtvydqDg@mail.gmail.com>

I reproduced this problem with a simpler topology. I connected three hosts,
A, B, and C with one switch set into "standalone" and disconnected with the
controller. A started ping B every 400ms for three times (I delayed B's
reply for 200ms intentionally), and the MAC learning table was initialized
as expected.

2015-03-11T05:54:36.192Z|00004|ofproto_dpif_xlate(handler229)|DBG|bridge
s1: learned that 00:00:00:00:00:01 is on port s1-eth1 in VLAN 0
2015-03-11T05:54:36.193Z|00008|ofproto_dpif_xlate(handler229)|DBG|bridge
s1: learned that 00:00:00:00:00:02 is on port s1-eth2 in VLAN 0

Then I swapped the MAC addresses of A (00:00:00:00:00:01) and C
immediately, and C started ping B (these two steps finished in 230ms).
Surprisingly, the first reply for C's first ICMP request goes to A.

The switch actually learned 00:00:00:00:00:01 comes from a new port s1-eth3
(in_port(4)) when it received C's first ICMP request.

2015-03-11T05:54:37.238Z|00018|dpif(handler229)|DBG|system at ovs-system: miss
upcall:
dp_hash(0),recirc_id(0),skb_priority(0),in_port(4),skb_mark(0),eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),eth_type(0x0800),ipv4(src=10.0.0.1,dst=10.0.0.2,proto=1,tos=0,ttl=64,frag=no),icmp(type=8,code=0)
icmp,metadata=0,in_port=0,vlan_tci=0x0000,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=8,icmp_code=0
2015-03-11T05:54:37.238Z|00019|dpif(handler229)|DBG|system at ovs-system:
get_stats success
2015-03-11T05:54:37.239Z|00020|ofproto_dpif_xlate(handler229)|DBG|bridge
s1: learned that 00:00:00:00:00:01 is on port s1-eth3 in VLAN 0
2015-03-11T05:54:37.239Z|00021|dpif(handler229)|DBG|system at ovs-system:
put[create]
dp_hash(0/0),recirc_id(0),skb_priority(0),in_port(4),skb_mark(0/0),eth(src=00:00:00:00:00:01,dst=00:00:00:00:00:02),eth_type(0x0800),ipv4(src=
10.0.0.1/0.0.0.0,dst=10.0.0.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),icmp(type=8/0,code=0/0),
actions:3
2015-03-11T05:54:37.239Z|00022|dpif(handler229)|DBG|system at ovs-system:
execute 3 on packet
icmp,metadata=0,in_port=0,vlan_tci=0x0000,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=8,icmp_code=0

However, it then relearned the old port s1-eth1 without any packet coming
from s1-eth1, which looks weird to me.

2015-03-11T05:54:37.274Z|00058|ofproto_dpif_xlate(revalidator228)|DBG|bridge
s1: learned that 00:00:00:00:00:01 is on port s1-eth1 in VLAN 0

What causes this issue?


On Tue, Mar 10, 2015 at 9:57 PM, Ben Pfaff <blp at nicira.com> wrote:

> Could we try to reduce this to a simpler problem?  So far, you've been
> talking about a 2-bridge case.  MAC learning applies just as much to a
> single bridge.  Can you try to reproduce the problem with just one
> bridge?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/865f042c/attachment.html>

From nilesh.gavaskar at gmail.com  Wed Mar 11 11:23:59 2015
From: nilesh.gavaskar at gmail.com (Nilesh G)
Date: Wed, 11 Mar 2015 14:23:59 -0400
Subject: [ovs-discuss] Fwd: How to modify the in_port field inside a flow in
	OF13 ?
In-Reply-To: <CAAuZhM=5qRCqr328yGn8qeCD0=4ZxEtYT=a7uRYqW3gecM1xVA@mail.gmail.com>
References: <CAAuZhM=5qRCqr328yGn8qeCD0=4ZxEtYT=a7uRYqW3gecM1xVA@mail.gmail.com>
Message-ID: <CAAuZhMkMYd5nZMsZhboMLF2TMzohei8qE2-Hfqyqe+8H5s1QkA@mail.gmail.com>

Hi,

Does anyone know of a way to modify the input port field (in_port) for a
packet via a flow parameter in OF 1.3 ?

Thanks,
Nilesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/eb60ae7f/attachment.html>

From amer7777 at hotmail.com  Wed Mar 11 11:35:28 2015
From: amer7777 at hotmail.com (AMER)
Date: Wed, 11 Mar 2015 18:35:28 +0000
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <55003205.3010906@caviumnetworks.com>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>,
 ,,<DUB113-W987B61335241E076E15B48D41B0@phx.gbl>,
 ,,<CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>,
 ,,<BLU436-SMTP8583FEBF0EE9805CFF7614D4180@phx.gbl>,
 , , <CAHbON5rhwQy2EJT+oe6PPStjvCv97wGoQvQ1hES1=KO705Za_g@mail.gmail.com>, ,
 <DUB113-W5197E09AFC4D6AC0AFD3DAD4190@phx.gbl>,
 <DUB113-W29E6B1A6068038336C3FC1D4190@phx.gbl>,
 <55003205.3010906@caviumnetworks.com>
Message-ID: <DUB113-W137906CEBF6050C3DE0B289D4190@phx.gbl>




Unfortunately, it doesn't work

I got this error, when I add/modify this command "resubmit\(,2\)"
ovs-ofctl add-flows command takes at most 2 argument

Also, I got the fllowing error when I put the quotation marks ""

   ovs-ofctl must specify an action

Best regards,

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA


> Date: Wed, 11 Mar 2015 17:46:05 +0530
> From: vguvva at caviumnetworks.com
> To: amer7777 at hotmail.com; shettyg at nicira.com
> CC: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Linear topology in openveswitch
> 
> On 03/11/2015 05:38 PM, AMER wrote:
> > ovs-ofctl add-flows br0 table=1, priority=99, dl_type=0x800, 
> > nw_src=192.168.5.2, actions=mod_nw_src=10.10.10.10, resubmit(,2)
> 
> resubmit\(,2\) should work.
> 
> -- 
> Thanks, Vijay

 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/32c83efd/attachment-0001.html>

From blp at nicira.com  Wed Mar 11 11:33:14 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 11 Mar 2015 11:33:14 -0700
Subject: [ovs-discuss] Fwd: How to modify the in_port field inside a
 flow in OF13 ?
In-Reply-To: <CAAuZhMkMYd5nZMsZhboMLF2TMzohei8qE2-Hfqyqe+8H5s1QkA@mail.gmail.com>
References: <CAAuZhM=5qRCqr328yGn8qeCD0=4ZxEtYT=a7uRYqW3gecM1xVA@mail.gmail.com>
 <CAAuZhMkMYd5nZMsZhboMLF2TMzohei8qE2-Hfqyqe+8H5s1QkA@mail.gmail.com>
Message-ID: <20150311183314.GC8538@nicira.com>

On Wed, Mar 11, 2015 at 02:23:59PM -0400, Nilesh G wrote:
> Does anyone know of a way to modify the input port field (in_port) for a
> packet via a flow parameter in OF 1.3 ?

What's a flow parameter?

The FAQ has a possibly relevant Q&A:

### Q: I added a flow to send packets out the ingress port, like this:

       ovs-ofctl add-flow br0 in_port=2,actions=2

   but OVS drops the packets instead.

A: Yes, OpenFlow requires a switch to ignore attempts to send a packet
   out its ingress port.  The rationale is that dropping these packets
   makes it harder to loop the network.  Sometimes this behavior can
   even be convenient, e.g. it is often the desired behavior in a flow
   that forwards a packet to several ports ("floods" the packet).

   Sometimes one really needs to send a packet out its ingress port
   ("hairpin"). In this case, output to OFPP_IN_PORT, which in
   ovs-ofctl syntax is expressed as just "in_port", e.g.:

       ovs-ofctl add-flow br0 in_port=2,actions=in_port

   This also works in some circumstances where the flow doesn't match
   on the input port.  For example, if you know that your switch has
   five ports numbered 2 through 6, then the following will send every
   received packet out every port, even its ingress port:

       ovs-ofctl add-flow br0 actions=2,3,4,5,6,in_port

   or, equivalently:

       ovs-ofctl add-flow br0 actions=all,in_port

   Sometimes, in complicated flow tables with multiple levels of
   "resubmit" actions, a flow needs to output to a particular port
   that may or may not be the ingress port.  It's difficult to take
   advantage of OFPP_IN_PORT in this situation.  To help, Open vSwitch
   provides, as an OpenFlow extension, the ability to modify the
   in_port field.  Whatever value is currently in the in_port field is
   the port to which outputs will be dropped, as well as the
   destination for OFPP_IN_PORT.  This means that the following will
   reliably output to port 2 or to ports 2 through 6, respectively:

       ovs-ofctl add-flow br0 in_port=2,actions=load:0->NXM_OF_IN_PORT[],2
       ovs-ofctl add-flow br0 actions=load:0->NXM_OF_IN_PORT[],2,3,4,5,6

   If the input port is important, then one may save and restore it on
   the stack:

        ovs-ofctl add-flow br0 actions=push:NXM_OF_IN_PORT[],\
                                       load:0->NXM_OF_IN_PORT[],\
                                       2,3,4,5,6,\
                                       pop:NXM_OF_IN_PORT[]

From blp at nicira.com  Wed Mar 11 11:39:40 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 11 Mar 2015 11:39:40 -0700
Subject: [ovs-discuss] Install Flow Rule directly into the kernel module
In-Reply-To: <F345B665-B39D-4B6C-8AB6-0A81C9E88F0A@stud.tu-darmstadt.de>
References: <ADDFCFF7-CEB7-480B-B717-F0194E7BD08F@stud.tu-darmstadt.de>
 <20150310220700.GL11735@nicira.com>
 <F345B665-B39D-4B6C-8AB6-0A81C9E88F0A@stud.tu-darmstadt.de>
Message-ID: <20150311183940.GD8538@nicira.com>

On Wed, Mar 11, 2015 at 09:30:22AM +0100, Sascha Bleidner wrote:
> Thanks, I will also look into the newer version. 
> So there is no option to force the switch to install flow mods coming from a controller to be installed in the kernel, since my test program runs on the controller. 

No, there isn't.  OpenFlow and OVS datapath flows aren't even similar
enough to do this, in general.

From nilesh.gavaskar at gmail.com  Wed Mar 11 12:07:36 2015
From: nilesh.gavaskar at gmail.com (Nilesh G)
Date: Wed, 11 Mar 2015 15:07:36 -0400
Subject: [ovs-discuss] Fwd: How to modify the in_port field inside a
 flow in OF13 ?
In-Reply-To: <20150311183314.GC8538@nicira.com>
References: <CAAuZhM=5qRCqr328yGn8qeCD0=4ZxEtYT=a7uRYqW3gecM1xVA@mail.gmail.com>
 <CAAuZhMkMYd5nZMsZhboMLF2TMzohei8qE2-Hfqyqe+8H5s1QkA@mail.gmail.com>
 <20150311183314.GC8538@nicira.com>
Message-ID: <CAAuZhMnW2SE+ngAYyFxzYzqQQJMCtSq0Te-W4oNvRkAiaWRywA@mail.gmail.com>

Hi Ben,

That fixed my problem. Thanks !
Sorry for the repost. I should have read the FAQs first.

By a flow parameter, I meant something like mod_dl_src or mod_dl_dst. I
couldn't find a similar action parameter that I could use.
I tried using the resubmit() action but I was going around in circles.
I had also looked at the OFPACT_SET_FIELD inside ofp-actions.c but I
couldn't figure out how to use it.

For others:
Here is what I used to change the input port num: ( '0' is the new port
number )
ovs-ofctl add-flow br0 in_port=2,actions=load:0->NXM_OF_IN_PORT[],controller

Thanks,
Nilesh


On Wed, Mar 11, 2015 at 2:33 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Mar 11, 2015 at 02:23:59PM -0400, Nilesh G wrote:
> > Does anyone know of a way to modify the input port field (in_port) for a
> > packet via a flow parameter in OF 1.3 ?
>
> What's a flow parameter?
>
> The FAQ has a possibly relevant Q&A:
>
> ### Q: I added a flow to send packets out the ingress port, like this:
>
>        ovs-ofctl add-flow br0 in_port=2,actions=2
>
>    but OVS drops the packets instead.
>
> A: Yes, OpenFlow requires a switch to ignore attempts to send a packet
>    out its ingress port.  The rationale is that dropping these packets
>    makes it harder to loop the network.  Sometimes this behavior can
>    even be convenient, e.g. it is often the desired behavior in a flow
>    that forwards a packet to several ports ("floods" the packet).
>
>    Sometimes one really needs to send a packet out its ingress port
>    ("hairpin"). In this case, output to OFPP_IN_PORT, which in
>    ovs-ofctl syntax is expressed as just "in_port", e.g.:
>
>        ovs-ofctl add-flow br0 in_port=2,actions=in_port
>
>    This also works in some circumstances where the flow doesn't match
>    on the input port.  For example, if you know that your switch has
>    five ports numbered 2 through 6, then the following will send every
>    received packet out every port, even its ingress port:
>
>        ovs-ofctl add-flow br0 actions=2,3,4,5,6,in_port
>
>    or, equivalently:
>
>        ovs-ofctl add-flow br0 actions=all,in_port
>
>    Sometimes, in complicated flow tables with multiple levels of
>    "resubmit" actions, a flow needs to output to a particular port
>    that may or may not be the ingress port.  It's difficult to take
>    advantage of OFPP_IN_PORT in this situation.  To help, Open vSwitch
>    provides, as an OpenFlow extension, the ability to modify the
>    in_port field.  Whatever value is currently in the in_port field is
>    the port to which outputs will be dropped, as well as the
>    destination for OFPP_IN_PORT.  This means that the following will
>    reliably output to port 2 or to ports 2 through 6, respectively:
>
>        ovs-ofctl add-flow br0 in_port=2,actions=load:0->NXM_OF_IN_PORT[],2
>        ovs-ofctl add-flow br0 actions=load:0->NXM_OF_IN_PORT[],2,3,4,5,6
>
>    If the input port is important, then one may save and restore it on
>    the stack:
>
>         ovs-ofctl add-flow br0 actions=push:NXM_OF_IN_PORT[],\
>                                        load:0->NXM_OF_IN_PORT[],\
>                                        2,3,4,5,6,\
>                                        pop:NXM_OF_IN_PORT[]
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/a8d047eb/attachment.html>

From blp at nicira.com  Wed Mar 11 12:11:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 11 Mar 2015 12:11:25 -0700
Subject: [ovs-discuss] Fwd: How to modify the in_port field inside a
 flow in OF13 ?
In-Reply-To: <CAAuZhMnW2SE+ngAYyFxzYzqQQJMCtSq0Te-W4oNvRkAiaWRywA@mail.gmail.com>
References: <CAAuZhM=5qRCqr328yGn8qeCD0=4ZxEtYT=a7uRYqW3gecM1xVA@mail.gmail.com>
 <CAAuZhMkMYd5nZMsZhboMLF2TMzohei8qE2-Hfqyqe+8H5s1QkA@mail.gmail.com>
 <20150311183314.GC8538@nicira.com>
 <CAAuZhMnW2SE+ngAYyFxzYzqQQJMCtSq0Te-W4oNvRkAiaWRywA@mail.gmail.com>
Message-ID: <20150311191125.GA9944@nicira.com>

On Wed, Mar 11, 2015 at 03:07:36PM -0400, Nilesh G wrote:
> By a flow parameter, I meant something like mod_dl_src or mod_dl_dst. I
> couldn't find a similar action parameter that I could use.

OK.  mod_dl_src and mod_dl_dst are "actions", not "flow parameters" or
"action parameters".

From nilesh.gavaskar at gmail.com  Wed Mar 11 12:14:24 2015
From: nilesh.gavaskar at gmail.com (Nilesh G)
Date: Wed, 11 Mar 2015 15:14:24 -0400
Subject: [ovs-discuss] Fwd: How to modify the in_port field inside a
 flow in OF13 ?
In-Reply-To: <20150311191125.GA9944@nicira.com>
References: <CAAuZhM=5qRCqr328yGn8qeCD0=4ZxEtYT=a7uRYqW3gecM1xVA@mail.gmail.com>
 <CAAuZhMkMYd5nZMsZhboMLF2TMzohei8qE2-Hfqyqe+8H5s1QkA@mail.gmail.com>
 <20150311183314.GC8538@nicira.com>
 <CAAuZhMnW2SE+ngAYyFxzYzqQQJMCtSq0Te-W4oNvRkAiaWRywA@mail.gmail.com>
 <20150311191125.GA9944@nicira.com>
Message-ID: <CAAuZhMmZPJ+Sx2cikvXukryGa0CVR15Bm+wvrc2VFOQEVNgcog@mail.gmail.com>

ok.

On Wed, Mar 11, 2015 at 3:11 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Mar 11, 2015 at 03:07:36PM -0400, Nilesh G wrote:
> > By a flow parameter, I meant something like mod_dl_src or mod_dl_dst. I
> > couldn't find a similar action parameter that I could use.
>
> OK.  mod_dl_src and mod_dl_dst are "actions", not "flow parameters" or
> "action parameters".
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150311/89ce508f/attachment.html>

From navneet.singh2012 at gmail.com  Wed Mar 11 23:36:58 2015
From: navneet.singh2012 at gmail.com (Navneet Singh)
Date: Thu, 12 Mar 2015 12:06:58 +0530
Subject: [ovs-discuss] UDP packets not dropping
Message-ID: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>

Hi all,

I need to drop udp packets from the client usinf iperf. I am using this
command

ovs-ofctl add-flow br0 dl_type=0x0800,nw_proto=17,udp_src=5001,actions=drop
>

Dump flows shows

ovs-ofctl dump-flows br0
>
NXST_FLOW reply (xid=0x4):

 cookie=0x0, duration=31.648s, table=0, n_packets=0, n_bytes=0,
> idle_age=31, udp,tp_src=5001 actions=drop

 cookie=0x0, duration=59.685s, table=0, n_packets=2592, n_bytes=751977,
> idle_age=0, actions=NORMAL


I tried to change udp_src to tp_src, but there is no change in the issue.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/322cdc33/attachment-0001.html>

From jpettit at nicira.com  Wed Mar 11 23:44:25 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 11 Mar 2015 23:44:25 -0700
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
Message-ID: <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>


> On Mar 11, 2015, at 11:36 PM, Navneet Singh <navneet.singh2012 at gmail.com> wrote:
> 
> Hi all,
> 
> I need to drop udp packets from the client usinf iperf. I am using this command
> 
> ovs-ofctl add-flow br0 dl_type=0x0800,nw_proto=17,udp_src=5001,actions=drop
> 
> Dump flows shows 
> 
> ovs-ofctl dump-flows br0
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=31.648s, table=0, n_packets=0, n_bytes=0, idle_age=31, udp,tp_src=5001 actions=drop
>  cookie=0x0, duration=59.685s, table=0, n_packets=2592, n_bytes=751977, idle_age=0, actions=NORMAL
> 
> I tried to change udp_src to tp_src, but there is no change in the issue.

The flow looks fine other than you didn't set a priority.  I think those two flows will conflict, so it's arbitrary which one will be chosen.

--Justin



From navneet.singh2012 at gmail.com  Wed Mar 11 23:54:41 2015
From: navneet.singh2012 at gmail.com (Navneet Singh)
Date: Thu, 12 Mar 2015 12:24:41 +0530
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
Message-ID: <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>

Hi Justin,

I changed the command as per your recommendation to

> ovs-ofctl add-flow br0
> dl_type=0x0800,nw_proto=17,priority=15,udp_src=5001,actions=drop
>

The flows are not matching when I'm sending traffic through iperf udp.



On Thu, Mar 12, 2015 at 12:14 PM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Mar 11, 2015, at 11:36 PM, Navneet Singh <navneet.singh2012 at gmail.com>
> wrote:
> >
> > Hi all,
> >
> > I need to drop udp packets from the client usinf iperf. I am using this
> command
> >
> > ovs-ofctl add-flow br0
> dl_type=0x0800,nw_proto=17,udp_src=5001,actions=drop
> >
> > Dump flows shows
> >
> > ovs-ofctl dump-flows br0
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=31.648s, table=0, n_packets=0, n_bytes=0,
> idle_age=31, udp,tp_src=5001 actions=drop
> >  cookie=0x0, duration=59.685s, table=0, n_packets=2592, n_bytes=751977,
> idle_age=0, actions=NORMAL
> >
> > I tried to change udp_src to tp_src, but there is no change in the issue.
>
> The flow looks fine other than you didn't set a priority.  I think those
> two flows will conflict, so it's arbitrary which one will be chosen.
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/e003c59f/attachment.html>

From jpettit at nicira.com  Wed Mar 11 23:59:19 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 11 Mar 2015 23:59:19 -0700
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
Message-ID: <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>


> On Mar 11, 2015, at 11:54 PM, Navneet Singh <navneet.singh2012 at gmail.com> wrote:
> 
> Hi Justin, 
> 
> I changed the command as per your recommendation to
> ovs-ofctl add-flow br0 dl_type=0x0800,nw_proto=17,priority=15,udp_src=5001,actions=drop
> 
> The flows are not matching when I'm sending traffic through iperf udp.

Did you change the priority of the other flow?  If not, then its priority is quite a bit higher (32768) than the one you just set (15).

--Justin



From ashujain9727 at gmail.com  Thu Mar 12 00:09:13 2015
From: ashujain9727 at gmail.com (abhishek jain)
Date: Thu, 12 Mar 2015 12:39:13 +0530
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
Message-ID: <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>

Hi Justin

We have changed the priority of other flows also.

 ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=73.296s, table=0, n_packets=0, n_bytes=0,
idle_age=73, priority=15,udp,tp_src=5001 actions=drop
 cookie=0x0, duration=162.284s, table=0, n_packets=2386, n_bytes=815262,
idle_age=0, priority=15,in_port=LOCAL actions=output:1
 cookie=0x0, duration=167.892s, table=0, n_packets=5983, n_bytes=4743020,
idle_age=0, priority=15,in_port=1 actions=LOCAL

On Thu, Mar 12, 2015 at 12:29 PM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Mar 11, 2015, at 11:54 PM, Navneet Singh <navneet.singh2012 at gmail.com>
> wrote:
> >
> > Hi Justin,
> >
> > I changed the command as per your recommendation to
> > ovs-ofctl add-flow br0
> dl_type=0x0800,nw_proto=17,priority=15,udp_src=5001,actions=drop
> >
> > The flows are not matching when I'm sending traffic through iperf udp.
>
> Did you change the priority of the other flow?  If not, then its priority
> is quite a bit higher (32768) than the one you just set (15).
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/0fe9ab1c/attachment.html>

From jpettit at nicira.com  Thu Mar 12 00:19:30 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 12 Mar 2015 00:19:30 -0700
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
 <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
Message-ID: <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>


> On Mar 12, 2015, at 12:09 AM, abhishek jain <ashujain9727 at gmail.com> wrote:
> 
> Hi Justin
> 
> We have changed the priority of other flows also.
> 
>  ovs-ofctl dump-flows br0              
> NXST_FLOW reply (xid=0x4): 
>  cookie=0x0, duration=73.296s, table=0, n_packets=0, n_bytes=0, idle_age=73, priority=15,udp,tp_src=5001 actions=drop 
>  cookie=0x0, duration=162.284s, table=0, n_packets=2386, n_bytes=815262, idle_age=0, priority=15,in_port=LOCAL actions=output:1 
>  cookie=0x0, duration=167.892s, table=0, n_packets=5983, n_bytes=4743020, idle_age=0, priority=15,in_port=1 actions=LOCAL

You've made them all the same priority again.

--Justin



From jpettit at nicira.com  Thu Mar 12 00:33:35 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 12 Mar 2015 00:33:35 -0700
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <CA+9-Lvv4vZKxNky0isdiN=H0ZQit7p87_FC=eMLLdCM1eavBYg@mail.gmail.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
 <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
 <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>
 <CA+9-Lvv4vZKxNky0isdiN=H0ZQit7p87_FC=eMLLdCM1eavBYg@mail.gmail.com>
Message-ID: <C0694C88-A44F-410F-9549-2996B1A175C2@nicira.com>


> On Mar 12, 2015, at 12:29 AM, abhishek jain <ashujain9727 at gmail.com> wrote:
> 
> Hi Justin..
> 
> Sorry for the typo error.I'm settig the priority of the UDP higher than the other rules.The rule to drop UDP packet is matching but I'm not able to drop the Iperf UDP traffic. Below is the command I'm using..
> 
>  ovs-ofctl add-flow br0 dl_type=0x0800,nw_proto=17,priority=18,actions=drop   
> 
> ovs-ofctl dump-flows br0       
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=12.840s, table=0, n_packets=226, n_bytes=333249, idle_age=0, priority=18,udp actions=drop
>  cookie=0x0, duration=26.100s, table=0, n_packets=17, n_bytes=2456, idle_age=6, priority=15,in_port=LOCAL actions=output:1
>  cookie=0x0, duration=21.296s, table=0, n_packets=22, n_bytes=3588, idle_age=6, priority=15,in_port=1 actions=LOCAL

It looks like you're now dropping all UDP traffic because you're no longer specifying the UDP port number.

--Justin



From ashujain9727 at gmail.com  Thu Mar 12 00:29:20 2015
From: ashujain9727 at gmail.com (abhishek jain)
Date: Thu, 12 Mar 2015 12:59:20 +0530
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
 <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
 <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>
Message-ID: <CA+9-Lvv4vZKxNky0isdiN=H0ZQit7p87_FC=eMLLdCM1eavBYg@mail.gmail.com>

Hi Justin..

Sorry for the typo error.I'm settig the priority of the UDP higher than the
other rules.The rule to drop UDP packet is matching but I'm not able to
drop the Iperf UDP traffic. Below is the command I'm using..

 ovs-ofctl add-flow br0
dl_type=0x0800,nw_proto=17,priority=18,actions=drop

ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=12.840s, table=0, n_packets=226, n_bytes=333249,
idle_age=0, priority=18,udp actions=drop
 cookie=0x0, duration=26.100s, table=0, n_packets=17, n_bytes=2456,
idle_age=6, priority=15,in_port=LOCAL actions=output:1
 cookie=0x0, duration=21.296s, table=0, n_packets=22, n_bytes=3588,
idle_age=6, priority=15,in_port=1 actions=LOCAL



Please help regarding this.

On Thu, Mar 12, 2015 at 12:49 PM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Mar 12, 2015, at 12:09 AM, abhishek jain <ashujain9727 at gmail.com>
> wrote:
> >
> > Hi Justin
> >
> > We have changed the priority of other flows also.
> >
> >  ovs-ofctl dump-flows br0
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=73.296s, table=0, n_packets=0, n_bytes=0,
> idle_age=73, priority=15,udp,tp_src=5001 actions=drop
> >  cookie=0x0, duration=162.284s, table=0, n_packets=2386, n_bytes=815262,
> idle_age=0, priority=15,in_port=LOCAL actions=output:1
> >  cookie=0x0, duration=167.892s, table=0, n_packets=5983,
> n_bytes=4743020, idle_age=0, priority=15,in_port=1 actions=LOCAL
>
> You've made them all the same priority again.
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/ab07cef4/attachment.html>

From ashujain9727 at gmail.com  Thu Mar 12 00:35:00 2015
From: ashujain9727 at gmail.com (abhishek jain)
Date: Thu, 12 Mar 2015 13:05:00 +0530
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <C0694C88-A44F-410F-9549-2996B1A175C2@nicira.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
 <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
 <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>
 <CA+9-Lvv4vZKxNky0isdiN=H0ZQit7p87_FC=eMLLdCM1eavBYg@mail.gmail.com>
 <C0694C88-A44F-410F-9549-2996B1A175C2@nicira.com>
Message-ID: <CA+9-Lvs0sB-2dewrSJW=7bDr=ibYaVEVGxqzp9+FiUhT3mhmYA@mail.gmail.com>

Yes I want to drop the whole UDP traffic.How Is it possible with OVS?

On Thu, Mar 12, 2015 at 1:03 PM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Mar 12, 2015, at 12:29 AM, abhishek jain <ashujain9727 at gmail.com>
> wrote:
> >
> > Hi Justin..
> >
> > Sorry for the typo error.I'm settig the priority of the UDP higher than
> the other rules.The rule to drop UDP packet is matching but I'm not able to
> drop the Iperf UDP traffic. Below is the command I'm using..
> >
> >  ovs-ofctl add-flow br0
> dl_type=0x0800,nw_proto=17,priority=18,actions=drop
> >
> > ovs-ofctl dump-flows br0
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=12.840s, table=0, n_packets=226, n_bytes=333249,
> idle_age=0, priority=18,udp actions=drop
> >  cookie=0x0, duration=26.100s, table=0, n_packets=17, n_bytes=2456,
> idle_age=6, priority=15,in_port=LOCAL actions=output:1
> >  cookie=0x0, duration=21.296s, table=0, n_packets=22, n_bytes=3588,
> idle_age=6, priority=15,in_port=1 actions=LOCAL
>
> It looks like you're now dropping all UDP traffic because you're no longer
> specifying the UDP port number.
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/46508448/attachment.html>

From jpettit at nicira.com  Thu Mar 12 00:42:15 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 12 Mar 2015 00:42:15 -0700
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <CA+9-Lvs0sB-2dewrSJW=7bDr=ibYaVEVGxqzp9+FiUhT3mhmYA@mail.gmail.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
 <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
 <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>
 <CA+9-Lvv4vZKxNky0isdiN=H0ZQit7p87_FC=eMLLdCM1eavBYg@mail.gmail.com>
 <C0694C88-A44F-410F-9549-2996B1A175C2@nicira.com>
 <CA+9-Lvs0sB-2dewrSJW=7bDr=ibYaVEVGxqzp9+FiUhT3mhmYA@mail.gmail.com>
Message-ID: <6322283B-69F3-43BA-B976-00214EC8A094@nicira.com>


> On Mar 12, 2015, at 12:35 AM, abhishek jain <ashujain9727 at gmail.com> wrote:
> 
> Yes I want to drop the whole UDP traffic.How Is it possible with OVS?

Isn't that what's happening, since the packet counts are going up for that flow?

> > ovs-ofctl dump-flows br0
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=12.840s, table=0, n_packets=226, n_bytes=333249, idle_age=0, priority=18,udp actions=drop
> >  cookie=0x0, duration=26.100s, table=0, n_packets=17, n_bytes=2456, idle_age=6, priority=15,in_port=LOCAL actions=output:1
> >  cookie=0x0, duration=21.296s, table=0, n_packets=22, n_bytes=3588, idle_age=6, priority=15,in_port=1 actions=LOCAL


If this isn't the behavior you expect, you need to be more specific about what you're trying to do and what you're seeing.  You started off saying that you wanted to drop just iperf traffic, but now you're saying you want to drop all UDP traffic.  It looks like you're accomplishing the latter, so I don't know what to tell you.

--Justin



From ashujain9727 at gmail.com  Thu Mar 12 00:52:10 2015
From: ashujain9727 at gmail.com (abhishek jain)
Date: Thu, 12 Mar 2015 13:22:10 +0530
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <6322283B-69F3-43BA-B976-00214EC8A094@nicira.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
 <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
 <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>
 <CA+9-Lvv4vZKxNky0isdiN=H0ZQit7p87_FC=eMLLdCM1eavBYg@mail.gmail.com>
 <C0694C88-A44F-410F-9549-2996B1A175C2@nicira.com>
 <CA+9-Lvs0sB-2dewrSJW=7bDr=ibYaVEVGxqzp9+FiUhT3mhmYA@mail.gmail.com>
 <6322283B-69F3-43BA-B976-00214EC8A094@nicira.com>
Message-ID: <CA+9-Lvv=0+eSXfVW7Qc8SsqV_K6rF_As4pbqwvm4aDXwAgjrQg@mail.gmail.com>

Hi justin

I need to drop the whole udp traffic including udp iperf.Although the udp
drop rules are matching but still I'm not able to drop udp iperf.
On Mar 12, 2015 1:12 PM, "Justin Pettit" <jpettit at nicira.com> wrote:

>
> > On Mar 12, 2015, at 12:35 AM, abhishek jain <ashujain9727 at gmail.com>
> wrote:
> >
> > Yes I want to drop the whole UDP traffic.How Is it possible with OVS?
>
> Isn't that what's happening, since the packet counts are going up for that
> flow?
>
> > > ovs-ofctl dump-flows br0
> > > NXST_FLOW reply (xid=0x4):
> > >  cookie=0x0, duration=12.840s, table=0, n_packets=226, n_bytes=333249,
> idle_age=0, priority=18,udp actions=drop
> > >  cookie=0x0, duration=26.100s, table=0, n_packets=17, n_bytes=2456,
> idle_age=6, priority=15,in_port=LOCAL actions=output:1
> > >  cookie=0x0, duration=21.296s, table=0, n_packets=22, n_bytes=3588,
> idle_age=6, priority=15,in_port=1 actions=LOCAL
>
>
> If this isn't the behavior you expect, you need to be more specific about
> what you're trying to do and what you're seeing.  You started off saying
> that you wanted to drop just iperf traffic, but now you're saying you want
> to drop all UDP traffic.  It looks like you're accomplishing the latter, so
> I don't know what to tell you.
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/1691760e/attachment-0001.html>

From jpettit at nicira.com  Thu Mar 12 00:58:24 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 12 Mar 2015 00:58:24 -0700
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <CA+9-Lvv=0+eSXfVW7Qc8SsqV_K6rF_As4pbqwvm4aDXwAgjrQg@mail.gmail.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
 <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
 <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>
 <CA+9-Lvv4vZKxNky0isdiN=H0ZQit7p87_FC=eMLLdCM1eavBYg@mail.gmail.com>
 <C0694C88-A44F-410F-9549-2996B1A175C2@nicira.com>
 <CA+9-Lvs0sB-2dewrSJW=7bDr=ibYaVEVGxqzp9+FiUhT3mhmYA@mail.gmail.com>
 <6322283B-69F3-43BA-B976-00214EC8A094@nicira.com>
 <CA+9-Lvv=0+eSXfVW7Qc8SsqV_K6rF_As4pbqwvm4aDXwAgjrQg@mail.gmail.com>
Message-ID: <3A19B38E-3F11-4BBC-9257-5F22FC4FA795@nicira.com>


> On Mar 12, 2015, at 12:52 AM, abhishek jain <ashujain9727 at gmail.com> wrote:
> 
> Hi justin
> 
> I need to drop the whole udp traffic including udp iperf.Although the udp drop rules are matching but still I'm not able to drop udp iperf.

I don't know what to tell you.  It looks like it's matching UDP packets like you configured.  You'll need to look more closely at your configuration and maybe run tcpdump on the interfaces.  Obviously, make sure your iperf traffic is actually flowing through OVS.

--Justin



From sbiswas7 at linux.vnet.ibm.com  Thu Mar 12 02:29:35 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Thu, 12 Mar 2015 14:59:35 +0530
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <54FFEC6D.60908@linux.vnet.ibm.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com> <54FFDB38.1020007@gmail.com>
 <54FFE3C4.3090309@linux.vnet.ibm.com> <54FFE3DC.5010307@gmail.com>
 <54FFE983.2070207@linux.vnet.ibm.com> <54FFEC6D.60908@linux.vnet.ibm.com>
Message-ID: <55015C7F.3030005@linux.vnet.ibm.com>

Hi Pravin, Fan Du,

Appreciate your help.

To conclude, for VxLAN to work on Kernel 3.10 - do I need to explicitly 
load the vxlan.ko and then re-build OVS to make use of it?

I can see that CONFIG_VXLAN is set to 'm'

Do I need to re-build OVS to use this module? (after i have used 
modprobe to load it?) Shouldn't the OVS install process take care of 
loading the VxLAN kernel module by itself?

Thanks,
Sudipto

On Wednesday 11 March 2015 12:49 PM, Sudipto Biswas wrote:
>
> On Wednesday 11 March 2015 12:36 PM, Sudipto Biswas wrote:
>>
>> On Wednesday 11 March 2015 12:12 PM, Fan Du wrote:
>>> 于 2015年03月11日 14:42, Sudipto Biswas 写道:
>>>>
>>>> On Wednesday 11 March 2015 11:35 AM, Fan Du wrote:
>>>>> 于 2015年03月11日 01:38, Sudipto Biswas 写道:
>>>>>> Hi,
>>>>>>
>>>>>> I have a very small query. I am using OVS 2.3.1 and i have built 
>>>>>> the kernel module etc following the instructions in the INSTALL 
>>>>>> file.
>>>>>>
>>>>>> I was also, able to create vxlan ports and communicate across two 
>>>>>> VMs on two different machines using VxLAN tunnels.
>>>>>>
>>>>>> However, if i do a lsmod on my machine, it doesn't list the vxlan 
>>>>>> kernel module.
>>>>>
>>>>> CONFIG_VXLAN is set as 'y' or 'm' ?
>>>>    Where would you want me to set this option? As in some file?
>>> oh...
>>>
>>> If you are using your host default config, then kernel config file 
>>> is at /boot/config-2.6.32-358.el6.x86_64,
>>> the suffix may varies depending on your kernel version.
>>>
>>> cat /boot/config-2.6.32-358.el6.x86_64 | grep CONFIG_VXLAN
>>>
>>   Thanks, I found that the vxlan module was built. Then did a 
>> modprobe of the vxlan module and now lsmod lists vxlan.
>>   However, like the gre module is being used/referenced by 
>> openvswitch - vxlan doesn't have a reference count:
>>
>>   lsmod | grep vxlan
>>     vxlan                  29379  0
>>     ip_tunnel              20094  1 vxlan
>>
>>   lsmod | grep gre
>>    gre                     5383  1 openvswitch
>>
>>   Shouldn't we have the vxlan being referenced by OVS as well? (since 
>> i have some vxlan ports created)
>>   I have a very basic knowledge of the kernel , so please bear with 
>> me :-)
>   To answer your first question though:
>
>   CONFIG_VXLAN=m - this is the setting in the kernel config.
>   I am guessing that the kernel module should be loaded by openvswitch 
> when we build it for the kernel?
>
>>>>>> lsmod | grep openvswitch
>>>>>> openvswitch           123112  0
>>>>>> gre                     5383  1 openvswitch
>>>>>> libcrc32c               1922  1 openvswitch
>>>>>>
>>>>>> Now i am beginning to think, if i should see the vxlan module 
>>>>>> there as well?
>>>>>> If yes, then i wonder how my setup is working? :-)
>>>>>>
>>>>>> Appreciate your help!
>>>>>>
>>>>>> Thanks.
>>>>>> Sudipto
>>>>>>
>>>>>> _______________________________________________
>>>>>> discuss mailing list
>>>>>> discuss at openvswitch.org
>>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>
>>>>>
>>>>>
>>>>
>>>
>>>
>>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From sbiswas7 at linux.vnet.ibm.com  Thu Mar 12 02:57:37 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Thu, 12 Mar 2015 15:27:37 +0530
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <55015C7F.3030005@linux.vnet.ibm.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com> <54FFDB38.1020007@gmail.com>
 <54FFE3C4.3090309@linux.vnet.ibm.com> <54FFE3DC.5010307@gmail.com>
 <54FFE983.2070207@linux.vnet.ibm.com> <54FFEC6D.60908@linux.vnet.ibm.com>
 <55015C7F.3030005@linux.vnet.ibm.com>
Message-ID: <55016311.6090900@linux.vnet.ibm.com>

To correct myself, will unloading and re-loading the openvswitch module 
reference the vxlan.ko module automatically, if it's loaded?

Thanks,
Sudipto
On Thursday 12 March 2015 02:59 PM, Sudipto Biswas wrote:
> Hi Pravin, Fan Du,
>
> Appreciate your help.
>
> To conclude, for VxLAN to work on Kernel 3.10 - do I need to 
> explicitly load the vxlan.ko and then re-build OVS to make use of it?
>
> I can see that CONFIG_VXLAN is set to 'm'
>
> Do I need to re-build OVS to use this module? (after i have used 
> modprobe to load it?) Shouldn't the OVS install process take care of 
> loading the VxLAN kernel module by itself?
>
> Thanks,
> Sudipto
>
> On Wednesday 11 March 2015 12:49 PM, Sudipto Biswas wrote:
>>
>> On Wednesday 11 March 2015 12:36 PM, Sudipto Biswas wrote:
>>>
>>> On Wednesday 11 March 2015 12:12 PM, Fan Du wrote:
>>>> 于 2015年03月11日 14:42, Sudipto Biswas 写道:
>>>>>
>>>>> On Wednesday 11 March 2015 11:35 AM, Fan Du wrote:
>>>>>> 于 2015年03月11日 01:38, Sudipto Biswas 写道:
>>>>>>> Hi,
>>>>>>>
>>>>>>> I have a very small query. I am using OVS 2.3.1 and i have built 
>>>>>>> the kernel module etc following the instructions in the INSTALL 
>>>>>>> file.
>>>>>>>
>>>>>>> I was also, able to create vxlan ports and communicate across 
>>>>>>> two VMs on two different machines using VxLAN tunnels.
>>>>>>>
>>>>>>> However, if i do a lsmod on my machine, it doesn't list the 
>>>>>>> vxlan kernel module.
>>>>>>
>>>>>> CONFIG_VXLAN is set as 'y' or 'm' ?
>>>>>    Where would you want me to set this option? As in some file?
>>>> oh...
>>>>
>>>> If you are using your host default config, then kernel config file 
>>>> is at /boot/config-2.6.32-358.el6.x86_64,
>>>> the suffix may varies depending on your kernel version.
>>>>
>>>> cat /boot/config-2.6.32-358.el6.x86_64 | grep CONFIG_VXLAN
>>>>
>>>   Thanks, I found that the vxlan module was built. Then did a 
>>> modprobe of the vxlan module and now lsmod lists vxlan.
>>>   However, like the gre module is being used/referenced by 
>>> openvswitch - vxlan doesn't have a reference count:
>>>
>>>   lsmod | grep vxlan
>>>     vxlan                  29379  0
>>>     ip_tunnel              20094  1 vxlan
>>>
>>>   lsmod | grep gre
>>>    gre                     5383  1 openvswitch
>>>
>>>   Shouldn't we have the vxlan being referenced by OVS as well? 
>>> (since i have some vxlan ports created)
>>>   I have a very basic knowledge of the kernel , so please bear with 
>>> me :-)
>>   To answer your first question though:
>>
>>   CONFIG_VXLAN=m - this is the setting in the kernel config.
>>   I am guessing that the kernel module should be loaded by 
>> openvswitch when we build it for the kernel?
>>
>>>>>>> lsmod | grep openvswitch
>>>>>>> openvswitch           123112  0
>>>>>>> gre                     5383  1 openvswitch
>>>>>>> libcrc32c               1922  1 openvswitch
>>>>>>>
>>>>>>> Now i am beginning to think, if i should see the vxlan module 
>>>>>>> there as well?
>>>>>>> If yes, then i wonder how my setup is working? :-)
>>>>>>>
>>>>>>> Appreciate your help!
>>>>>>>
>>>>>>> Thanks.
>>>>>>> Sudipto
>>>>>>>
>>>>>>> _______________________________________________
>>>>>>> discuss mailing list
>>>>>>> discuss at openvswitch.org
>>>>>>> http://openvswitch.org/mailman/listinfo/discuss
>>>>>>
>>>>>>
>>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From amer7777 at hotmail.com  Thu Mar 12 03:18:17 2015
From: amer7777 at hotmail.com (AMER)
Date: Thu, 12 Mar 2015 10:18:17 +0000
Subject: [ovs-discuss] Linear topology in openveswitch
In-Reply-To: <DUB113-W137906CEBF6050C3DE0B289D4190@phx.gbl>
References: <D382FF93-EC81-46DA-A889-D0FC19C8A494@gmail.com>, , , ,
 <DUB113-W987B61335241E076E15B48D41B0@phx.gbl>, , , ,
 <CAHbON5rZu8-Q-o=sxG5mjFRvKMZnZMBbxYVPu-35FFVxKmkOow@mail.gmail.com>, , , ,
 <BLU436-SMTP8583FEBF0EE9805CFF7614D4180@phx.gbl>, , , 
 , <CAHbON5rhwQy2EJT+oe6PPStjvCv97wGoQvQ1hES1=KO705Za_g@mail.gmail.com>,
 , , <DUB113-W5197E09AFC4D6AC0AFD3DAD4190@phx.gbl>, ,
 <DUB113-W29E6B1A6068038336C3FC1D4190@phx.gbl>, ,
 <55003205.3010906@caviumnetworks.com>,
 <DUB113-W137906CEBF6050C3DE0B289D4190@phx.gbl>
Message-ID: <DUB113-W511E90DEA95711203560DCD4060@phx.gbl>

Thank you

I have fixed it

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA


From: amer7777 at hotmail.com
To: discuss at openvswitch.org
Date: Wed, 11 Mar 2015 18:35:28 +0000
Subject: Re: [ovs-discuss] Linear topology in openveswitch







Unfortunately, it doesn't work

I got this error, when I add/modify this command "resubmit\(,2\)"
ovs-ofctl add-flows command takes at most 2 argument

Also, I got the fllowing error when I put the quotation marks ""

   ovs-ofctl must specify an action

Best regards,

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA


> Date: Wed, 11 Mar 2015 17:46:05 +0530
> From: vguvva at caviumnetworks.com
> To: amer7777 at hotmail.com; shettyg at nicira.com
> CC: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Linear topology in openveswitch
> 
> On 03/11/2015 05:38 PM, AMER wrote:
> > ovs-ofctl add-flows br0 table=1, priority=99, dl_type=0x800, 
> > nw_src=192.168.5.2, actions=mod_nw_src=10.10.10.10, resubmit(,2)
> 
> resubmit\(,2\) should work.
> 
> -- 
> Thanks, Vijay

 		 	   		  

_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/4f517032/attachment-0001.html>

From em.anderson88 at yahoo.com  Thu Mar 12 04:59:34 2015
From: em.anderson88 at yahoo.com (Emma Anderson)
Date: Thu, 12 Mar 2015 11:59:34 +0000 (UTC)
Subject: [ovs-discuss] Proxying using openvswitch
Message-ID: <1980257518.585533.1426161574599.JavaMail.yahoo@mail.yahoo.com>

Hi all,
Can open vswitch acts like: receive a packet from eth0, substitute IP/mac, and sends it back again on eth0?

I found that when a packet is received from eth0, although the flow is triggered, it looks that packet is dropped silently and there is no trace in logs (if I am looking at the right place). 

Flow works well when I redirect the packet to another vm on the "same" host.

Thanks.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/ca51128f/attachment.html>

From scott.lowe at scottlowe.org  Thu Mar 12 05:21:45 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Thu, 12 Mar 2015 06:21:45 -0600
Subject: [ovs-discuss] Proxying using openvswitch
In-Reply-To: <1980257518.585533.1426161574599.JavaMail.yahoo@mail.yahoo.com>
References: <1980257518.585533.1426161574599.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <F347F417-3C6E-4373-952A-64A59D0A1A6A@scottlowe.org>

The issue here—if I understand correctly—is that OpenFlow doesn't allow traffic to be forwarded out the same port in which it was received. To make this work, you'd have to receive traffic on eth0 and send it out eth1 (for example).

Happy to be corrected if I am mistaken.

-- 
Scott

Sent from my mobile device

> On Mar 12, 2015, at 5:59 AM, Emma Anderson <em.anderson88 at yahoo.com> wrote:
> 
> Hi all,
> 
> Can open vswitch acts like: receive a packet from eth0, substitute IP/mac, and sends it back again on eth0?
> 
> I found that when a packet is received from eth0, although the flow is triggered, it looks that packet is dropped silently and there is no trace in logs (if I am looking at the right place). 
> 
> Flow works well when I redirect the packet to another vm on the "same" host.
> 
> Thanks.
> 
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/d7d48760/attachment.html>

From davidjoshuaevans at gmail.com  Thu Mar 12 06:50:36 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Thu, 12 Mar 2015 08:50:36 -0500
Subject: [ovs-discuss] upstream Extending netdev-* port config options
Message-ID: <D12703DC.24638%davidjoshuaevans@gmail.com>

Hi OVS wizards!

I have some fun extensions to things like netdev-dpdk and netdev-vport.
I can control them using ovs-vsctl by adding  ³options:foo=on ³ type of
fields.

Question: What else upstream do I need to touch to be able to do likewise
from say an ovsdb client?

Do I need to make the config known to ovsdb tables?
 

Regards and many thanks for your wonderful work,

Dave.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/3e622b32/attachment.html>

From jason at koelker.net  Thu Mar 12 08:00:46 2015
From: jason at koelker.net (=?UTF-8?Q?Jason_K=C3=B6lker?=)
Date: Thu, 12 Mar 2015 15:00:46 +0000
Subject: [ovs-discuss] Proxying using openvswitch
In-Reply-To: <1980257518.585533.1426161574599.JavaMail.yahoo@mail.yahoo.com>
References: <1980257518.585533.1426161574599.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CAB=yZ1Mxs7+FCOYr4sHcP+ezmZ_vze3--kgDwxiC5PicWfL+6g@mail.gmail.com>

On Thu, Mar 12, 2015 at 11:59 AM, Emma Anderson <em.anderson88 at yahoo.com> wrote:
> Hi all,
>
> Can open vswitch acts like: receive a packet from eth0, substitute IP/mac,
> and sends it back again on eth0?
>
> I found that when a packet is received from eth0, although the flow is
> triggered, it looks that packet is dropped silently and there is no trace in
> logs (if I am looking at the right place).
>
> Flow works well when I redirect the packet to another vm on the "same" host.

You can use `action=in_port` to send it back from the same port it
came in as. However I think that this always uses the userspace path,
and not a datapath flow.

Happy Hacking!

7-11

From blp at nicira.com  Thu Mar 12 08:01:48 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 12 Mar 2015 08:01:48 -0700
Subject: [ovs-discuss] upstream Extending netdev-* port config options
In-Reply-To: <D12703DC.24638%davidjoshuaevans@gmail.com>
References: <D12703DC.24638%davidjoshuaevans@gmail.com>
Message-ID: <20150312150148.GA5106@nicira.com>

On Thu, Mar 12, 2015 at 08:50:36AM -0500, David Evans wrote:
> I have some fun extensions to things like netdev-dpdk and netdev-vport.
> I can control them using ovs-vsctl by adding  ³options:foo=on ³ type of
> fields.
> 
> Question: What else upstream do I need to touch to be able to do likewise
> from say an ovsdb client?

You shouldn't need to do anything special, since "options" is a freeform
key-value field.

From blp at nicira.com  Thu Mar 12 08:03:53 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 12 Mar 2015 08:03:53 -0700
Subject: [ovs-discuss] Proxying using openvswitch
In-Reply-To: <F347F417-3C6E-4373-952A-64A59D0A1A6A@scottlowe.org>
References: <1980257518.585533.1426161574599.JavaMail.yahoo@mail.yahoo.com>
 <F347F417-3C6E-4373-952A-64A59D0A1A6A@scottlowe.org>
Message-ID: <20150312150353.GB5106@nicira.com>

The FAQ says:

### Q: I added a flow to send packets out the ingress port, like this:

       ovs-ofctl add-flow br0 in_port=2,actions=2

   but OVS drops the packets instead.

A: Yes, OpenFlow requires a switch to ignore attempts to send a packet
   out its ingress port.  The rationale is that dropping these packets
   makes it harder to loop the network.  Sometimes this behavior can
   even be convenient, e.g. it is often the desired behavior in a flow
   that forwards a packet to several ports ("floods" the packet).

   Sometimes one really needs to send a packet out its ingress port
   ("hairpin"). In this case, output to OFPP_IN_PORT, which in
   ovs-ofctl syntax is expressed as just "in_port", e.g.:

       ovs-ofctl add-flow br0 in_port=2,actions=in_port

   This also works in some circumstances where the flow doesn't match
   on the input port.  For example, if you know that your switch has
   five ports numbered 2 through 6, then the following will send every
   received packet out every port, even its ingress port:

       ovs-ofctl add-flow br0 actions=2,3,4,5,6,in_port

   or, equivalently:

       ovs-ofctl add-flow br0 actions=all,in_port

   Sometimes, in complicated flow tables with multiple levels of
   "resubmit" actions, a flow needs to output to a particular port
   that may or may not be the ingress port.  It's difficult to take
   advantage of OFPP_IN_PORT in this situation.  To help, Open vSwitch
   provides, as an OpenFlow extension, the ability to modify the
   in_port field.  Whatever value is currently in the in_port field is
   the port to which outputs will be dropped, as well as the
   destination for OFPP_IN_PORT.  This means that the following will
   reliably output to port 2 or to ports 2 through 6, respectively:

       ovs-ofctl add-flow br0 in_port=2,actions=load:0->NXM_OF_IN_PORT[],2
       ovs-ofctl add-flow br0 actions=load:0->NXM_OF_IN_PORT[],2,3,4,5,6

   If the input port is important, then one may save and restore it on
   the stack:

        ovs-ofctl add-flow br0 actions=push:NXM_OF_IN_PORT[],\
                                       load:0->NXM_OF_IN_PORT[],\
                                       2,3,4,5,6,\
                                       pop:NXM_OF_IN_PORT[]

On Thu, Mar 12, 2015 at 06:21:45AM -0600, Scott Lowe wrote:
> The issue here—if I understand correctly—is that OpenFlow doesn't allow traffic to be forwarded out the same port in which it was received. To make this work, you'd have to receive traffic on eth0 and send it out eth1 (for example).
> 
> Happy to be corrected if I am mistaken.
> 
> -- 
> Scott
> 
> Sent from my mobile device
> 
> > On Mar 12, 2015, at 5:59 AM, Emma Anderson <em.anderson88 at yahoo.com> wrote:
> > 
> > Hi all,
> > 
> > Can open vswitch acts like: receive a packet from eth0, substitute IP/mac, and sends it back again on eth0?
> > 
> > I found that when a packet is received from eth0, although the flow is triggered, it looks that packet is dropped silently and there is no trace in logs (if I am looking at the right place). 
> > 
> > Flow works well when I redirect the packet to another vm on the "same" host.
> > 
> > Thanks.
> > 
> > 
> > 
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Thu Mar 12 08:04:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 12 Mar 2015 08:04:32 -0700
Subject: [ovs-discuss] Proxying using openvswitch
In-Reply-To: <CAB=yZ1Mxs7+FCOYr4sHcP+ezmZ_vze3--kgDwxiC5PicWfL+6g@mail.gmail.com>
References: <1980257518.585533.1426161574599.JavaMail.yahoo@mail.yahoo.com>
 <CAB=yZ1Mxs7+FCOYr4sHcP+ezmZ_vze3--kgDwxiC5PicWfL+6g@mail.gmail.com>
Message-ID: <20150312150432.GC5106@nicira.com>

On Thu, Mar 12, 2015 at 03:00:46PM +0000, Jason Kölker wrote:
> You can use `action=in_port` to send it back from the same port it
> came in as. However I think that this always uses the userspace path,
> and not a datapath flow.

No, there's no special case here.

From davidjoshuaevans at gmail.com  Thu Mar 12 08:20:25 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Thu, 12 Mar 2015 10:20:25 -0500
Subject: [ovs-discuss] upstream Extending netdev-* port config options
In-Reply-To: <20150312150148.GA5106@nicira.com>
References: <D12703DC.24638%davidjoshuaevans@gmail.com>
 <20150312150148.GA5106@nicira.com>
Message-ID: <D127185E.2465D%davidjoshuaevans@gmail.com>

Thank you Ben!
I have discovered this in Ryu vsctl.py just now too :)


On 3/12/15, 10:01 AM, "Ben Pfaff" <blp at nicira.com> wrote:

>On Thu, Mar 12, 2015 at 08:50:36AM -0500, David Evans wrote:
>> I have some fun extensions to things like netdev-dpdk and netdev-vport.
>> I can control them using ovs-vsctl by adding  ³options:foo=on ³ type of
>> fields.
>> 
>> Question: What else upstream do I need to touch to be able to do
>>likewise
>> from say an ovsdb client?
>
>You shouldn't need to do anything special, since "options" is a freeform
>key-value field.



From blp at nicira.com  Thu Mar 12 08:38:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 12 Mar 2015 08:38:44 -0700
Subject: [ovs-discuss] How does the kernel space and usespace receive
 netlink message
In-Reply-To: <CAN2QyzZceSd2oYXtj1fbN=cMsF6F4mMLS1NOg_QFx766XLFOFA@mail.gmail.com>
References: <CAN2QyzZceSd2oYXtj1fbN=cMsF6F4mMLS1NOg_QFx766XLFOFA@mail.gmail.com>
Message-ID: <20150312153844.GE5106@nicira.com>

On Wed, Mar 11, 2015 at 07:14:05PM +0800, Vinllen Chen wrote:
>     When i read the source code of ovs, i found the userspace receives
> netlink message by epoll. But in the explanition of dpif.h, datapath starts
> many threads to receiving netlink.
>     Could anybody give me a definite answer that how does the userspace and
> kernel space receive netlink messages.

epoll doesn't receive anything; it doesn't have any functionality for
receiving anything.

Userspace uses netlink sockets to receive netlink messages from the
kernel.  It does use multiple threads for that.

From ashujain9727 at gmail.com  Thu Mar 12 01:33:27 2015
From: ashujain9727 at gmail.com (abhishek jain)
Date: Thu, 12 Mar 2015 14:03:27 +0530
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <3A19B38E-3F11-4BBC-9257-5F22FC4FA795@nicira.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
 <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
 <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>
 <CA+9-Lvv4vZKxNky0isdiN=H0ZQit7p87_FC=eMLLdCM1eavBYg@mail.gmail.com>
 <C0694C88-A44F-410F-9549-2996B1A175C2@nicira.com>
 <CA+9-Lvs0sB-2dewrSJW=7bDr=ibYaVEVGxqzp9+FiUhT3mhmYA@mail.gmail.com>
 <6322283B-69F3-43BA-B976-00214EC8A094@nicira.com>
 <CA+9-Lvv=0+eSXfVW7Qc8SsqV_K6rF_As4pbqwvm4aDXwAgjrQg@mail.gmail.com>
 <3A19B38E-3F11-4BBC-9257-5F22FC4FA795@nicira.com>
Message-ID: <CA+9-LvvLMzsNZvsqd-qAmWu8kzNfDo=sM-VBZO-0eui-DYWe2g@mail.gmail.com>

Hi justin

Yes the iperf traffic is surely flowing through OVS.Also the configured
flows for dropping udp traffic are matching but still the udp traffic is
not dropping.
On Mar 12, 2015 1:28 PM, "Justin Pettit" <jpettit at nicira.com> wrote:

>
> > On Mar 12, 2015, at 12:52 AM, abhishek jain <ashujain9727 at gmail.com>
> wrote:
> >
> > Hi justin
> >
> > I need to drop the whole udp traffic including udp iperf.Although the
> udp drop rules are matching but still I'm not able to drop udp iperf.
>
> I don't know what to tell you.  It looks like it's matching UDP packets
> like you configured.  You'll need to look more closely at your
> configuration and maybe run tcpdump on the interfaces.  Obviously, make
> sure your iperf traffic is actually flowing through OVS.
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/e3271030/attachment-0001.html>

From ashujain9727 at gmail.com  Thu Mar 12 02:03:51 2015
From: ashujain9727 at gmail.com (abhishek jain)
Date: Thu, 12 Mar 2015 14:33:51 +0530
Subject: [ovs-discuss] UDP packets not dropping
In-Reply-To: <CA+9-LvvLMzsNZvsqd-qAmWu8kzNfDo=sM-VBZO-0eui-DYWe2g@mail.gmail.com>
References: <CAOCzzULJq27KMBDZ1EY2i+QL0iMmsUGLWELMXBx8uMVzHDjgjA@mail.gmail.com>
 <39FA7744-16F0-44FE-9DEC-60BF5A43F168@nicira.com>
 <CAOCzzULSHDog9+=xWqdBnx53BJYip5MwvVNA8+sdEMB8b2+E_g@mail.gmail.com>
 <98B0A6AD-BE0A-4852-A055-EDB87B7EE604@nicira.com>
 <CA+9-LvvJm4t=orWWp+-V=EEM=D+eE8aLjjSs69D9Q_e=S9TF3A@mail.gmail.com>
 <988F0232-E86A-42A8-8EE5-A1D22B76A73F@nicira.com>
 <CA+9-Lvv4vZKxNky0isdiN=H0ZQit7p87_FC=eMLLdCM1eavBYg@mail.gmail.com>
 <C0694C88-A44F-410F-9549-2996B1A175C2@nicira.com>
 <CA+9-Lvs0sB-2dewrSJW=7bDr=ibYaVEVGxqzp9+FiUhT3mhmYA@mail.gmail.com>
 <6322283B-69F3-43BA-B976-00214EC8A094@nicira.com>
 <CA+9-Lvv=0+eSXfVW7Qc8SsqV_K6rF_As4pbqwvm4aDXwAgjrQg@mail.gmail.com>
 <3A19B38E-3F11-4BBC-9257-5F22FC4FA795@nicira.com>
 <CA+9-LvvLMzsNZvsqd-qAmWu8kzNfDo=sM-VBZO-0eui-DYWe2g@mail.gmail.com>
Message-ID: <CA+9-LvtFtUg21OzrgfnFVqWiDm-ZGP6Za1u5rpC7BNBapR1iLg@mail.gmail.com>

Hi Justin

I captured packets on wireshark with udp as filter and I was not able to
obtain UDP packets with UDP traffic rule matching in OVS.

Thanks

On Thu, Mar 12, 2015 at 2:03 PM, abhishek jain <ashujain9727 at gmail.com>
wrote:

> Hi justin
>
> Yes the iperf traffic is surely flowing through OVS.Also the configured
> flows for dropping udp traffic are matching but still the udp traffic is
> not dropping.
> On Mar 12, 2015 1:28 PM, "Justin Pettit" <jpettit at nicira.com> wrote:
>
>>
>> > On Mar 12, 2015, at 12:52 AM, abhishek jain <ashujain9727 at gmail.com>
>> wrote:
>> >
>> > Hi justin
>> >
>> > I need to drop the whole udp traffic including udp iperf.Although the
>> udp drop rules are matching but still I'm not able to drop udp iperf.
>>
>> I don't know what to tell you.  It looks like it's matching UDP packets
>> like you configured.  You'll need to look more closely at your
>> configuration and maybe run tcpdump on the interfaces.  Obviously, make
>> sure your iperf traffic is actually flowing through OVS.
>>
>> --Justin
>>
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/0c21b3c3/attachment.html>

From blp at nicira.com  Thu Mar 12 10:16:47 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 12 Mar 2015 10:16:47 -0700
Subject: [ovs-discuss] How does the kernel space and usespace receive
 netlink message
In-Reply-To: <CAN2QyzaLQ7ccaKxDg357akL-EdfiJjnfXOKyn+REUHxn4-o6Rw@mail.gmail.com>
References: <CAN2QyzZceSd2oYXtj1fbN=cMsF6F4mMLS1NOg_QFx766XLFOFA@mail.gmail.com>
 <20150312153844.GE5106@nicira.com>
 <CAN2QyzaLQ7ccaKxDg357akL-EdfiJjnfXOKyn+REUHxn4-o6Rw@mail.gmail.com>
Message-ID: <20150312171647.GA29140@nicira.com>

Please don't drop the mailing list.

On Fri, Mar 13, 2015 at 12:04:45AM +0800, Vinllen Chen wrote:
> Thankyou for your reply, Ben! There are two derivative question:
> 1.Does the datapath also use multiple threads for receving netlink message ?

The kernel always processes Netlink messages in the same thread that
sent it.

> 2.So I can understand the receive process: Once receive a netlink message,
> the main thread will create a new thread to handle it???that means one thread
> for one connection?

No, that would be much too expensive.  Userspace maintains a fixed
thread pool.

> On Thu, Mar 12, 2015 at 11:38 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Mar 11, 2015 at 07:14:05PM +0800, Vinllen Chen wrote:
> > >     When i read the source code of ovs, i found the userspace receives
> > > netlink message by epoll. But in the explanition of dpif.h, datapath
> > starts
> > > many threads to receiving netlink.
> > >     Could anybody give me a definite answer that how does the userspace
> > and
> > > kernel space receive netlink messages.
> >
> > epoll doesn't receive anything; it doesn't have any functionality for
> > receiving anything.
> >
> > Userspace uses netlink sockets to receive netlink messages from the
> > kernel.  It does use multiple threads for that.
> >

From christophe.fontaine at qosmos.com  Thu Mar 12 12:53:38 2015
From: christophe.fontaine at qosmos.com (christophe.fontaine at qosmos.com)
Date: Thu, 12 Mar 2015 20:53:38 +0100
Subject: [ovs-discuss] OVS+NSH
Message-ID: <5501eec2.unG3I26NumTHkmvR%christophe.fontaine@qosmos.com>

Hello,

On March 21-22, I will participate to a hackathon hold before IETF 92.
Within the featured technologies, OVS is used by OpenDayLight :
- SFC-OVS Integration
- SFC/NSH
    --> A test implementation is written in Python
- SFC Classifier
    --> May involve OVS

I saw that Priteshk's NSH patch [1] is not yet merged.
Do you plan to merge it for OVS 2.4 ?
By the way, is the release of OVS 2.4 still planned for 2015 H1 ?

Thanks,
Christophe

[1] https://github.com/priteshk/ovs/tree/nsh-v8


From amer7777 at hotmail.com  Thu Mar 12 13:32:01 2015
From: amer7777 at hotmail.com (Amer)
Date: Thu, 12 Mar 2015 23:32:01 +0300
Subject: [ovs-discuss] Connect VM and OVS
Message-ID: <BLU436-SMTP1718C167894CF5B0CC89C82D4060@phx.gbl>

Hello,

I have one VM1 as host and another has VM2 openvswitch installed in it.

I have created a bridge br0 in the OVS and assigned to it eth0,1,2 as ports. I attached eth0 in VM2 and VM1, both of them are virtualbox, internal-network
Eth0 in VM1 has IP 192.168.1.2
the br0 has IP 192.168.1.1
No one of its interfaces are having an IP.
However, when I tried to ping from VM1 to OVS(VM2) I got no replies.
What the mistake I did on this simple configuration.

Best regards,
Amer


From blp at nicira.com  Thu Mar 12 13:38:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 12 Mar 2015 13:38:41 -0700
Subject: [ovs-discuss] OVS+NSH
In-Reply-To: <5501eec2.unG3I26NumTHkmvR%christophe.fontaine@qosmos.com>
References: <5501eec2.unG3I26NumTHkmvR%christophe.fontaine@qosmos.com>
Message-ID: <20150312203841.GC6518@nicira.com>

[adding pritesh]

On Thu, Mar 12, 2015 at 08:53:38PM +0100, christophe.fontaine at qosmos.com wrote:
> On March 21-22, I will participate to a hackathon hold before IETF 92.
> Within the featured technologies, OVS is used by OpenDayLight :
> - SFC-OVS Integration
> - SFC/NSH
>     --> A test implementation is written in Python
> - SFC Classifier
>     --> May involve OVS
> 
> I saw that Priteshk's NSH patch [1] is not yet merged.
> Do you plan to merge it for OVS 2.4 ?

I think we're waiting for pritesh to post it, because the last time
someone from qosmos asked the same question, pritesh said that he was
going to post it "soon":
        http://openvswitch.org/pipermail/discuss/2014-October/015416.html

> By the way, is the release of OVS 2.4 still planned for 2015 H1 ?

We're still waiting on conntrack support to be finalized, then we'll
release 2.4.

From pritkoth at cisco.com  Thu Mar 12 14:00:40 2015
From: pritkoth at cisco.com (Pritesh Kothari (pritkoth))
Date: Thu, 12 Mar 2015 21:00:40 +0000
Subject: [ovs-discuss] OVS+NSH
In-Reply-To: <20150312203841.GC6518@nicira.com>
References: <5501eec2.unG3I26NumTHkmvR%christophe.fontaine@qosmos.com>
 <20150312203841.GC6518@nicira.com>
Message-ID: <3DDD317E-B15D-461F-A2FC-3C3A61872940@cisco.com>


On Mar 12, 2015, at 1:38 PM, Ben Pfaff <blp at nicira.com<mailto:blp at nicira.com>> wrote:

[adding pritesh]

On Thu, Mar 12, 2015 at 08:53:38PM +0100, christophe.fontaine at qosmos.com<mailto:christophe.fontaine at qosmos.com> wrote:
On March 21-22, I will participate to a hackathon hold before IETF 92.
Within the featured technologies, OVS is used by OpenDayLight :
- SFC-OVS Integration
- SFC/NSH
   --> A test implementation is written in Python
- SFC Classifier
   --> May involve OVS

I saw that Priteshk's NSH patch [1] is not yet merged.
Do you plan to merge it for OVS 2.4 ?

I think we're waiting for pritesh to post it, because the last time
someone from qosmos asked the same question, pritesh said that he was
going to post it "soon":
       http://openvswitch.org/pipermail/discuss/2014-October/015416.html

Yep I got pulled into something else, but I have been maintaining them here [1],
I am few days away from sending latest series out for review.

Regards,
Pritesh

[1]: https://github.com/priteshk/ovs/branches
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150312/288e74d0/attachment.html>

From pshelar at nicira.com  Thu Mar 12 14:19:37 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Thu, 12 Mar 2015 14:19:37 -0700
Subject: [ovs-discuss] match/push/pop more than 3 MPLS labels
In-Reply-To: <55002E8C.9060301@uniroma2.it>
References: <54EF1CCD.4010705@uniroma2.it>
 <CALnjE+o8m-yyww_4K5zkf3-hF23R_KxgjiLFAdOfN5f0rpq-RQ@mail.gmail.com>
 <55002E8C.9060301@uniroma2.it>
Message-ID: <CALnjE+oMoGE7WKaBY64V8tJdS-BmyLrGdO24wCHz_go2nQTpjQ@mail.gmail.com>

On Wed, Mar 11, 2015 at 5:01 AM, Stefano Salsano
<stefano.salsano at uniroma2.it> wrote:
> Il 27/02/2015 00:52, Pravin Shelar ha scritto:
>>
>> On Thu, Feb 26, 2015 at 5:17 AM, Stefano Salsano wrote:
>>>
>>>
>>> there is a limit of 3 MPLS labels that are supported by Open vSwitch
>>> we need to raise it at 5 labels, to implement a segment routing scenario
>>>
>> You can start with changing FLOW_MAX_MPLS_LABELS to 5.
>
>
> Dear Pravin,
>
> thanks for your hint, we have tried and we realized that we also need to
> change an assert in lib/flow.h
>
> current code is
> BUILD_ASSERT_DECL(offsetof(struct flow, igmp_group_ip4) + sizeof(uint32_t)
> == sizeof(struct flow_tnl) + 192 && FLOW_WC_SEQ == 31);
>
> we need to change it into:
> BUILD_ASSERT_DECL(offsetof(struct flow, igmp_group_ip4) + sizeof(uint32_t)
> == sizeof(struct flow_tnl) + 176 + (4 * ROUND_UP(FLOW_MAX_MPLS_LABELS, 2))
> && FLOW_WC_SEQ == 31);
>
> basically, we need to split the 192 bytes in a fixed part of 176 bytes and
> in a part that depends on the number of supported MPLS labels
>
> we tried it, and it compiles and runs well :-)
>
> do you think it is OK ? do you want us to provide a patch ?
>
I think we need to handle any number of MPLS labels and not limit to
specific number. I discussed it offline with Jarno and it is doable
using single mpls label (in struct flow) and recirculation context. I
will work on it next week.

Thanks,
Pravin.

From pshelar at nicira.com  Thu Mar 12 16:04:26 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Thu, 12 Mar 2015 16:04:26 -0700
Subject: [ovs-discuss] VxLAN kernel module.
In-Reply-To: <55015C7F.3030005@linux.vnet.ibm.com>
References: <54FF2C07.6060508@linux.vnet.ibm.com> <54FFDB38.1020007@gmail.com>
 <54FFE3C4.3090309@linux.vnet.ibm.com> <54FFE3DC.5010307@gmail.com>
 <54FFE983.2070207@linux.vnet.ibm.com>
 <54FFEC6D.60908@linux.vnet.ibm.com>
 <55015C7F.3030005@linux.vnet.ibm.com>
Message-ID: <CALnjE+odJTz0_s9+LtHhq9A4X9r96SfUVC5jSgsboyjK3eynpg@mail.gmail.com>

On Thu, Mar 12, 2015 at 2:29 AM, Sudipto Biswas
<sbiswas7 at linux.vnet.ibm.com> wrote:
> Hi Pravin, Fan Du,
>
> Appreciate your help.
>
> To conclude, for VxLAN to work on Kernel 3.10 - do I need to explicitly load
> the vxlan.ko and then re-build OVS to make use of it?
>
> I can see that CONFIG_VXLAN is set to 'm'
>
> Do I need to re-build OVS to use this module? (after i have used modprobe to
> load it?) Shouldn't the OVS install process take care of loading the VxLAN
> kernel module by itself?
>

No need to re-build. on 3.10 kernel, OVS vxlan should work without
vxlan module. OVS has checks to determine if the vxlan module has
required features available. If all required feature are in the module
then only OVS uses it.

From blp at nicira.com  Thu Mar 12 20:17:46 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 12 Mar 2015 20:17:46 -0700
Subject: [ovs-discuss] How does the kernel space and usespace receive
 netlink message
In-Reply-To: <CAN2QyzZriEqicWHFxtB6PF5vHQidufx1sRwo2NC3cmgLzwe5Zg@mail.gmail.com>
References: <CAN2QyzZceSd2oYXtj1fbN=cMsF6F4mMLS1NOg_QFx766XLFOFA@mail.gmail.com>
 <20150312153844.GE5106@nicira.com>
 <CAN2QyzaLQ7ccaKxDg357akL-EdfiJjnfXOKyn+REUHxn4-o6Rw@mail.gmail.com>
 <20150312171647.GA29140@nicira.com>
 <CAN2Qyza2Uxp0DqyJE0CShRrn5jF8C6kd2=iZRh5EBV2QL3O1SQ@mail.gmail.com>
 <CAN2QyzZriEqicWHFxtB6PF5vHQidufx1sRwo2NC3cmgLzwe5Zg@mail.gmail.com>
Message-ID: <20150313031746.GA6797@nicira.com>

Please don't drop the mailing list.

A couple of people have built prototypes that combine the two messages,
but the performance difference was insignificant, so we did not commit
it.

On Fri, Mar 13, 2015 at 10:19:21AM +0800, Vinllen Chen wrote:
> Hi, Ben, i have one more question:
> Once the userspace handle the upcall message and then find a facet match,
> the dpif_operate function call "dpif_flow_put__" and "dpif_execute__"
> function to send the "add flow" netlink message and "execute action". But
> why do not combine the two netlink messages to improving performance,
> because i think the netlink message will waste time.
> 
> On Fri, Mar 13, 2015 at 9:18 AM, Vinllen Chen <cvinllen at gmail.com> wrote:
> 
> > Thankyou very much~
> >
> > On Fri, Mar 13, 2015 at 1:16 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> >> Please don't drop the mailing list.
> >>
> >> On Fri, Mar 13, 2015 at 12:04:45AM +0800, Vinllen Chen wrote:
> >> > Thankyou for your reply, Ben! There are two derivative question:
> >> > 1.Does the datapath also use multiple threads for receving netlink
> >> message ?
> >>
> >> The kernel always processes Netlink messages in the same thread that
> >> sent it.
> >>
> >> > 2.So I can understand the receive process: Once receive a netlink
> >> message,
> >> > the main thread will create a new thread to handle it???that means one
> >> thread
> >> > for one connection?
> >>
> >> No, that would be much too expensive.  Userspace maintains a fixed
> >> thread pool.
> >>
> >> > On Thu, Mar 12, 2015 at 11:38 PM, Ben Pfaff <blp at nicira.com> wrote:
> >> >
> >> > > On Wed, Mar 11, 2015 at 07:14:05PM +0800, Vinllen Chen wrote:
> >> > > >     When i read the source code of ovs, i found the userspace
> >> receives
> >> > > > netlink message by epoll. But in the explanition of dpif.h, datapath
> >> > > starts
> >> > > > many threads to receiving netlink.
> >> > > >     Could anybody give me a definite answer that how does the
> >> userspace
> >> > > and
> >> > > > kernel space receive netlink messages.
> >> > >
> >> > > epoll doesn't receive anything; it doesn't have any functionality for
> >> > > receiving anything.
> >> > >
> >> > > Userspace uses netlink sockets to receive netlink messages from the
> >> > > kernel.  It does use multiple threads for that.
> >> > >
> >>
> >
> >

From amer7777 at hotmail.com  Thu Mar 12 20:43:29 2015
From: amer7777 at hotmail.com (Amer)
Date: Fri, 13 Mar 2015 06:43:29 +0300
Subject: [ovs-discuss] Connect VM and OVS more explanation
In-Reply-To: <BLU436-SMTP1718C167894CF5B0CC89C82D4060@phx.gbl>
References: <BLU436-SMTP1718C167894CF5B0CC89C82D4060@phx.gbl>
Message-ID: <BLU436-SMTP384CE99B3B702576B3193BD4070@phx.gbl>

Hello,

I think my previous message needs some clarification

I have one VM1 as a host and another (VM2) has openvswitch installed in it.

I have created a bridge br0 in the OVS(VM2) and assigned to it eth0,1,2 . I attached eth0 in VM2 and VM1, both of them are virtualbox, to internal-network
Eth0 in VM1 has IP 192.168.1.2
the br0 has IP 192.168.1.1
No one of VM2 interfaces are having an IP except br0.
However, when I tried to ping from VM1 to OVS(VM2) I got no replies.

What the mistake I did on this simple configuration.

Best regards,
Amer

_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

Sent from my iPhone

> On ٢١ جما١، ١٤٣٦ هـ, at ١١:٣٢ م, Amer <amer7777 at hotmail.com> wrote:
> 
> Hello,
> 
> I have one VM1 as host and another has VM2 openvswitch installed in it.
> 
> I have created a bridge br0 in the OVS and assigned to it eth0,1,2 as ports. I attached eth0 in VM2 and VM1, both of them are virtualbox, internal-network
> Eth0 in VM1 has IP 192.168.1.2
> the br0 has IP 192.168.1.1
> No one of its interfaces are having an IP.
> However, when I tried to ping from VM1 to OVS(VM2) I got no replies.
> What the mistake I did on this simple configuration.
> 
> Best regards,
> Amer
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150313/dea2be5d/attachment.html>

From blp at nicira.com  Thu Mar 12 21:27:30 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 12 Mar 2015 21:27:30 -0700
Subject: [ovs-discuss] Connect VM and OVS more explanation
In-Reply-To: <BLU436-SMTP384CE99B3B702576B3193BD4070@phx.gbl>
References: <BLU436-SMTP1718C167894CF5B0CC89C82D4060@phx.gbl>
 <BLU436-SMTP384CE99B3B702576B3193BD4070@phx.gbl>
Message-ID: <20150313042730.GB6797@nicira.com>

On Fri, Mar 13, 2015 at 06:43:29AM +0300, Amer wrote:
> I have one VM1 as a host and another (VM2) has openvswitch installed in it.
> 
> I have created a bridge br0 in the OVS(VM2) and assigned to it eth0,1,2 . I attached eth0 in VM2 and VM1, both of them are virtualbox, to internal-network
> Eth0 in VM1 has IP 192.168.1.2
> the br0 has IP 192.168.1.1
> No one of VM2 interfaces are having an IP except br0.
> However, when I tried to ping from VM1 to OVS(VM2) I got no replies.
> 
> What the mistake I did on this simple configuration.

This configuration sounds OK to me.

You can follow the troubleshooting procedure described in the FAQ.

### Q: I have a sophisticated network setup involving Open vSwitch, VMs or
   multiple hosts, and other components.  The behavior isn't what I
   expect.  Help!

A: To debug network behavior problems, trace the path of a packet,
   hop-by-hop, from its origin in one host to a remote host.  If
   that's correct, then trace the path of the response packet back to
   the origin.

   Usually a simple ICMP echo request and reply ("ping") packet is
   good enough.  Start by initiating an ongoing "ping" from the origin
   host to a remote host.  If you are tracking down a connectivity
   problem, the "ping" will not display any successful output, but
   packets are still being sent.  (In this case the packets being sent
   are likely ARP rather than ICMP.)

   Tools available for tracing include the following:

   - "tcpdump" and "wireshark" for observing hops across network
     devices, such as Open vSwitch internal devices and physical
     wires.

   - "ovs-appctl dpif/dump-flows <br>" in Open vSwitch 1.10 and
     later or "ovs-dpctl dump-flows <br>" in earlier versions.
     These tools allow one to observe the actions being taken on
     packets in ongoing flows.

     See ovs-vswitchd(8) for "ovs-appctl dpif/dump-flows"
     documentation, ovs-dpctl(8) for "ovs-dpctl dump-flows"
     documentation, and "Why are there so many different ways to
     dump flows?" above for some background.

   - "ovs-appctl ofproto/trace" to observe the logic behind how
     ovs-vswitchd treats packets.  See ovs-vswitchd(8) for
     documentation.  You can out more details about a given flow
     that "ovs-dpctl dump-flows" displays, by cutting and pasting
     a flow from the output into an "ovs-appctl ofproto/trace"
     command.

   - SPAN, RSPAN, and ERSPAN features of physical switches, to
     observe what goes on at these physical hops.

   Starting at the origin of a given packet, observe the packet at
   each hop in turn.  For example, in one plausible scenario, you
   might:

   1. "tcpdump" the "eth" interface through which an ARP egresses
      a VM, from inside the VM.

   2. "tcpdump" the "vif" or "tap" interface through which the ARP
      ingresses the host machine.

   3. Use "ovs-dpctl dump-flows" to spot the ARP flow and observe
      the host interface through which the ARP egresses the
      physical machine.  You may need to use "ovs-dpctl show" to
      interpret the port numbers.  If the output seems surprising,
      you can use "ovs-appctl ofproto/trace" to observe details of
      how ovs-vswitchd determined the actions in the "ovs-dpctl
      dump-flows" output.

   4. "tcpdump" the "eth" interface through which the ARP egresses
      the physical machine.

   5. "tcpdump" the "eth" interface through which the ARP
      ingresses the physical machine, at the remote host that
      receives the ARP.

   6. Use "ovs-dpctl dump-flows" to spot the ARP flow on the
      remote host that receives the ARP and observe the VM "vif"
      or "tap" interface to which the flow is directed.  Again,
      "ovs-dpctl show" and "ovs-appctl ofproto/trace" might help.

   7. "tcpdump" the "vif" or "tap" interface to which the ARP is
      directed.

   8. "tcpdump" the "eth" interface through which the ARP
      ingresses a VM, from inside the VM.

   It is likely that during one of these steps you will figure out the
   problem.  If not, then follow the ARP reply back to the origin, in
   reverse.

From fontaine at qosmos.com  Fri Mar 13 02:03:00 2015
From: fontaine at qosmos.com (Christophe Fontaine)
Date: Fri, 13 Mar 2015 10:03:00 +0100
Subject: [ovs-discuss] OVS+NSH
In-Reply-To: <3DDD317E-B15D-461F-A2FC-3C3A61872940@cisco.com>
References: <5501eec2.unG3I26NumTHkmvR%christophe.fontaine@qosmos.com>
 <20150312203841.GC6518@nicira.com>
 <3DDD317E-B15D-461F-A2FC-3C3A61872940@cisco.com>
Message-ID: <5502A7C4.7020900@qosmos.com>



On 03/12/2015 10:00 PM, Pritesh Kothari (pritkoth) wrote:
>
>> On Mar 12, 2015, at 1:38 PM, Ben Pfaff <blp at nicira.com 
>> <mailto:blp at nicira.com>> wrote:
>>
>> [adding pritesh]
>>
>> On Thu, Mar 12, 2015 at 08:53:38PM +0100, 
>> christophe.fontaine at qosmos.com 
>> <mailto:christophe.fontaine at qosmos.com> wrote:
>>> On March 21-22, I will participate to a hackathon hold before IETF 92.
>>> Within the featured technologies, OVS is used by OpenDayLight :
>>> - SFC-OVS Integration
>>> - SFC/NSH
>>>    --> A test implementation is written in Python
>>> - SFC Classifier
>>>    --> May involve OVS
>>>
>>> I saw that Priteshk's NSH patch [1] is not yet merged.
>>> Do you plan to merge it for OVS 2.4 ?
>>
>> I think we're waiting for pritesh to post it, because the last time
>> someone from qosmos asked the same question, pritesh said that he was
>> going to post it "soon":
>> http://openvswitch.org/pipermail/discuss/2014-October/015416.html
>
> Yep I got pulled into something else, but I have been maintaining them 
> here [1],
> I am few days away from sending latest series out for review.
>
> Regards,
> Pritesh
>
> [1]: https://github.com/priteshk/ovs/branches

Ben,
Thank you for your response.

Pritesh,

Great news !
I'll be glad to help you if you need a tester.

Regards,
Christophe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150313/dfbc7729/attachment-0001.html>

From johnson.dantis at hp.com  Thu Mar 12 22:21:36 2015
From: johnson.dantis at hp.com (Dantis, Johnson)
Date: Fri, 13 Mar 2015 05:21:36 +0000
Subject: [ovs-discuss] Looking for OVS  image for Windows
Message-ID: <3779987BBCA98E469FBB73FAC572E1687C73C8BA@G9W0755.americas.hpqcorp.net>

Hi,

Is there a OVS image for windows with the latest stable update ?  I am looking for a installer for deployment.  Please point me to the link from where I can download it.

Thanks,
Johnson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150313/19087c27/attachment.html>

From shettyg at nicira.com  Fri Mar 13 09:44:47 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 13 Mar 2015 09:44:47 -0700
Subject: [ovs-discuss] Looking for OVS image for Windows
In-Reply-To: <3779987BBCA98E469FBB73FAC572E1687C73C8BA@G9W0755.americas.hpqcorp.net>
References: <3779987BBCA98E469FBB73FAC572E1687C73C8BA@G9W0755.americas.hpqcorp.net>
Message-ID: <CAHbON5qdySDXqCBEdP8gyBEEEd400Hg9E-FC0NO3HudAGPszrA@mail.gmail.com>

On Thu, Mar 12, 2015 at 10:21 PM, Dantis, Johnson <johnson.dantis at hp.com> wrote:
> Hi,
>
>
>
> Is there a OVS image for windows with the latest stable update ?  I am
> looking for a installer for deployment.  Please point me to the link from
> where I can download it.
Unfortunately, there is no official installer. It is a little
embarrassing (I plan to do something about it. Any help is
appreciated).
Having said that, we currently have all the components needed to run
OVS on Hyper-V (if you read the INSTALL.WIndows.md) only on OVS
master. But OVS 2.4 (likely to be released in a month or so) will be a
beta release of OVS for Hyper-V.

>
>
>
> Thanks,
>
> Johnson
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From pritkoth at cisco.com  Fri Mar 13 10:15:54 2015
From: pritkoth at cisco.com (Pritesh Kothari (pritkoth))
Date: Fri, 13 Mar 2015 17:15:54 +0000
Subject: [ovs-discuss] OVS+NSH
In-Reply-To: <5502A7C4.7020900@qosmos.com>
References: <5501eec2.unG3I26NumTHkmvR%christophe.fontaine@qosmos.com>
 <20150312203841.GC6518@nicira.com>
 <3DDD317E-B15D-461F-A2FC-3C3A61872940@cisco.com>
 <5502A7C4.7020900@qosmos.com>
Message-ID: <ED60E3A0-258F-4C29-8334-B327BF72F3EA@cisco.com>



Yep I got pulled into something else, but I have been maintaining them here [1],
I am few days away from sending latest series out for review.

Regards,
Pritesh

[1]: https://github.com/priteshk/ovs/branches

Ben,
Thank you for your response.

Pritesh,

Great news !
I'll be glad to help you if you need a tester.

Thanks Christophe, will send then your way when they are ready.

Regards,
Pritesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150313/fe5bce13/attachment.html>

From blp at nicira.com  Fri Mar 13 10:47:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 13 Mar 2015 10:47:29 -0700
Subject: [ovs-discuss] Open vSwitch Conference 2015--conflicts?
Message-ID: <20150313174729.GC3884@nicira.com>

I'm working on figuring out the scheduling for this year's OVS
conference.  I'm aiming for a pair of days in November and a location
near Palo Alto.

So far, I've heard about the following conflicts:

        Nov. 12: p4.org conference (tentative date)
        Nov. 18-21: IEEE SDN-NFV conference in San Francisco

I'd like to hear about other conflicts that we should aim to work
around, as well as any suggested dates.

From romain.lenglet at oracle.com  Fri Mar 13 11:53:01 2015
From: romain.lenglet at oracle.com (Romain Lenglet)
Date: Fri, 13 Mar 2015 11:53:01 -0700
Subject: [ovs-discuss] Open vSwitch Conference 2015--conflicts?
In-Reply-To: <20150313174729.GC3884@nicira.com>
References: <20150313174729.GC3884@nicira.com>
Message-ID: <etPan.5503320d.19495cff.99f0@rlenglet-mac>

On March 13, 2015 at 10:48:48 AM, Ben Pfaff (blp at nicira.com) wrote:
I'm working on figuring out the scheduling for this year's OVS
conference. I'm aiming for a pair of days in November and a location
near Palo Alto.

So far, I've heard about the following conflicts:

Nov. 12: p4.org conference (tentative date)
Nov. 18-21: IEEE SDN-NFV conference in San Francisco

I'd like to hear about other conflicts that we should aim to work
around, as well as any suggested dates.

LISA15 will be on Nov 8-13.
-- 
Romain Lenglet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150313/51339c88/attachment-0001.html>

From blp at nicira.com  Fri Mar 13 12:26:19 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 13 Mar 2015 12:26:19 -0700
Subject: [ovs-discuss] Open vSwitch Conference 2015--conflicts?
In-Reply-To: <etPan.5503320d.19495cff.99f0@rlenglet-mac>
References: <20150313174729.GC3884@nicira.com>
 <etPan.5503320d.19495cff.99f0@rlenglet-mac>
Message-ID: <CACjuMbytHZzpuinU_stT_H1omKaE3N4BacNHh3iut_JMXjoekg@mail.gmail.com>

On Fri, Mar 13, 2015 at 11:53 AM, Romain Lenglet
<romain.lenglet at oracle.com> wrote:
> On March 13, 2015 at 10:48:48 AM, Ben Pfaff (blp at nicira.com) wrote:
>
> I'm working on figuring out the scheduling for this year's OVS
> conference. I'm aiming for a pair of days in November and a location
> near Palo Alto.
>
> So far, I've heard about the following conflicts:
>
> Nov. 12: p4.org conference (tentative date)
> Nov. 18-21: IEEE SDN-NFV conference in San Francisco
>
> I'd like to hear about other conflicts that we should aim to work
> around, as well as any suggested dates.
>
>
> LISA15 will be on Nov 8-13.

Thanks, added that to my list.
-- 
"I don't normally do acked-by's.  I think it's my way of avoiding
getting blamed when it all blows up."               Andrew Morton

From blp at nicira.com  Fri Mar 13 12:55:39 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 13 Mar 2015 12:55:39 -0700
Subject: [ovs-discuss] vswitchd crash with flow table 254 deletion
In-Reply-To: <54FF32F7.8060708@caviumnetworks.com>
References: <54FE9580.4050106@caviumnetworks.com>
 <20150310175859.GE11735@nicira.com>
 <54FF32F7.8060708@caviumnetworks.com>
Message-ID: <20150313195539.GF3884@nicira.com>

On Tue, Mar 10, 2015 at 11:37:51PM +0530, Vijaya Mohan Guvva wrote:
> On 03/10/2015 11:28 PM, Ben Pfaff wrote:
> >On Tue, Mar 10, 2015 at 12:26:00PM +0530, Vijaya Mohan Guvva wrote:
> >>I get vswitchd crash (segfault) consistently with flow table 254
> >>deletion and with traffic. This special table has internal
> >>flows/rules (miss_rule, no_packet_in_rule etc) added during bridge
> >>creation and are getting deleting with ovs-ofctl del-flows <br_name>
> >>"table=254". These deleted stale rules are referred
> >>(xbridge->miss_rule and xbridge->no_packet_in_rule) when there is no
> >>flow match and resulting in segfault. I guess, these default flows
> >>shouldn't be deleted, but if they are part of flow tables, can be
> >>deleted. so we should move them a place where they never get deleted
> >>and always available.
> >What version of Open vSwitch is this?
> 
> Hi Ben,
> Its v2.3.0 and v2.3.1.

Thanks, I sent out a fix for the problem, which only affects
branch-2.3.  Will you please test it out and review it?

The patch is here:
        http://openvswitch.org/pipermail/dev/2015-March/052391.html

Thanks,

Ben.

From amer7777 at hotmail.com  Sat Mar 14 04:29:07 2015
From: amer7777 at hotmail.com (Amer)
Date: Sat, 14 Mar 2015 14:29:07 +0300
Subject: [ovs-discuss] Bridge pinging rules
Message-ID: <BLU436-SMTP460D24C8AA7226B6478327D4040@phx.gbl>


Hello,

I have 4 VMs, 2 bridges and each one has a host.
My question is:
I need to configure a default gateway for the hosts, however when I added flow rules to the bridges, suddenly, I can't ping them from the hosts. I know this is due to the rules.
When the host can't ping the bridge, how I configure it to be the gateway.
I need to add a flow-rule to make the bridge respond to ping requests? What is the rule to do so?

Best regards,
Amer
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150314/2739b655/attachment.html>

From blp at nicira.com  Sat Mar 14 08:05:21 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 14 Mar 2015 08:05:21 -0700
Subject: [ovs-discuss] Bridge pinging rules
In-Reply-To: <BLU436-SMTP460D24C8AA7226B6478327D4040@phx.gbl>
References: <BLU436-SMTP460D24C8AA7226B6478327D4040@phx.gbl>
Message-ID: <20150314150521.GB8414@nicira.com>

On Sat, Mar 14, 2015 at 02:29:07PM +0300, Amer wrote:
> I have 4 VMs, 2 bridges and each one has a host.
> My question is:
> I need to configure a default gateway for the hosts, however when I added flow rules to the bridges, suddenly, I can't ping them from the hosts. I know this is due to the rules.
> When the host can't ping the bridge, how I configure it to be the gateway.
> I need to add a flow-rule to make the bridge respond to ping requests? What is the rule to do so?

I don't think you can do that through flows.  It is probably better to
configure the flows so that anything that needs an ICMP response is
passed through to the IP stack.

From amer7777 at hotmail.com  Sat Mar 14 08:40:10 2015
From: amer7777 at hotmail.com (Amer)
Date: Sat, 14 Mar 2015 18:40:10 +0300
Subject: [ovs-discuss] Bridge pinging rules
In-Reply-To: <20150314150521.GB8414@nicira.com>
References: <BLU436-SMTP460D24C8AA7226B6478327D4040@phx.gbl>
 <20150314150521.GB8414@nicira.com>
Message-ID: <BLU436-SMTP154A11F76F7A1C41CB6DB25D4040@phx.gbl>

Thank you Ben
The problem is the host need to have a gateway, however, if he can't ping the gateway, nothing will be forwarded.
However, how can I pass the ICMP packets to the IP stack?

Best regards,
Amer

‏:‬

>> On Sat, Mar 14, 2015 at 02:29:07PM +0300, Amer wrote:
>> I have 4 VMs, 2 bridges and each one has a host.
>> My question is:
>> I need to configure a default gateway for the hosts, however when I added flow rules to the bridges, suddenly, I can't ping them from the hosts. I know this is due to the rules.
>> When the host can't ping the bridge, how I configure it to be the gateway.
>> I need to add a flow-rule to make the bridge respond to ping requests? What is the rule to do so?
> 
> I don't think you can do that through flows.  It is probably better to
> configure the flows so that anything that needs an ICMP response is
> passed through to the IP stack.
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150314/73f9e365/attachment.html>

From blp at nicira.com  Sat Mar 14 08:43:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 14 Mar 2015 08:43:26 -0700
Subject: [ovs-discuss] Bridge pinging rules
In-Reply-To: <BLU436-SMTP154A11F76F7A1C41CB6DB25D4040@phx.gbl>
References: <BLU436-SMTP460D24C8AA7226B6478327D4040@phx.gbl>
 <20150314150521.GB8414@nicira.com>
 <BLU436-SMTP154A11F76F7A1C41CB6DB25D4040@phx.gbl>
Message-ID: <20150314154326.GC8414@nicira.com>

Well, like you said, without flows, ping works.  So pass through the
ICMP traffic to the gateway to the IP stack (presumably the bridge's
local port) and let it do the ICMP responses.

On Sat, Mar 14, 2015 at 06:40:10PM +0300, Amer wrote:
> Thank you Ben
> The problem is the host need to have a gateway, however, if he can't ping the gateway, nothing will be forwarded.
> However, how can I pass the ICMP packets to the IP stack?
> 
> Best regards,
> Amer
> 
> ‏:‬
> 
> >> On Sat, Mar 14, 2015 at 02:29:07PM +0300, Amer wrote:
> >> I have 4 VMs, 2 bridges and each one has a host.
> >> My question is:
> >> I need to configure a default gateway for the hosts, however when I added flow rules to the bridges, suddenly, I can't ping them from the hosts. I know this is due to the rules.
> >> When the host can't ping the bridge, how I configure it to be the gateway.
> >> I need to add a flow-rule to make the bridge respond to ping requests? What is the rule to do so?
> > 
> > I don't think you can do that through flows.  It is probably better to
> > configure the flows so that anything that needs an ICMP response is
> > passed through to the IP stack.
> > 

From amer7777 at hotmail.com  Sat Mar 14 09:11:42 2015
From: amer7777 at hotmail.com (Amer)
Date: Sat, 14 Mar 2015 19:11:42 +0300
Subject: [ovs-discuss] Bridge pinging rules
In-Reply-To: <20150314154326.GC8414@nicira.com>
References: <BLU436-SMTP460D24C8AA7226B6478327D4040@phx.gbl>
 <20150314150521.GB8414@nicira.com>
 <BLU436-SMTP154A11F76F7A1C41CB6DB25D4040@phx.gbl>
 <20150314154326.GC8414@nicira.com>
Message-ID: <BLU436-SMTP7528C202B4CCD8D57A8B5DD4040@phx.gbl>

Do you want me to give one of the Ethernet interfaces an IP address= the bridge IP, without assigning this interface to the bridge.

Best regards,
Amer

 م، كتب ‏Ben Pfaff ‏<blp at nicira.com>:‬
Well, like you said, without flows, ping works.  So pass through the
> ICMP traffic to the gateway to the IP stack (presumably the bridge's
> local port) and let it do the ICMP responses.
> 
>> On Sat, Mar 14, 2015 at 06:40:10PM +0300, Amer wrote:
>> Thank you Ben
>> The problem is the host need to have a gateway, however, if he can't ping the gateway, nothing will be forwarded.
>> However, how can I pass the ICMP packets to the IP stack?
>> 
>> Best regards,
>> Amer
>> 
>> ‏:‬
>> 
>>>> On Sat, Mar 14, 2015 at 02:29:07PM +0300, Amer wrote:
>>>> I have 4 VMs, 2 bridges and each one has a host.
>>>> My question is:
>>>> I need to configure a default gateway for the hosts, however when I added flow rules to the bridges, suddenly, I can't ping them from the hosts. I know this is due to the rules.
>>>> When the host can't ping the bridge, how I configure it to be the gateway.
>>>> I need to add a flow-rule to make the bridge respond to ping requests? What is the rule to do so?
>>> 
>>> I don't think you can do that through flows.  It is probably better to
>>> configure the flows so that anything that needs an ICMP response is
>>> passed through to the IP stack.
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150314/81749aca/attachment.html>

From blp at nicira.com  Sat Mar 14 09:46:34 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 14 Mar 2015 09:46:34 -0700
Subject: [ovs-discuss] Bridge pinging rules
In-Reply-To: <BLU436-SMTP7528C202B4CCD8D57A8B5DD4040@phx.gbl>
References: <BLU436-SMTP460D24C8AA7226B6478327D4040@phx.gbl>
 <20150314150521.GB8414@nicira.com>
 <BLU436-SMTP154A11F76F7A1C41CB6DB25D4040@phx.gbl>
 <20150314154326.GC8414@nicira.com>
 <BLU436-SMTP7528C202B4CCD8D57A8B5DD4040@phx.gbl>
Message-ID: <20150314164634.GD8414@nicira.com>

No.

The local port is the port with the same name as the bridge itself.

On Sat, Mar 14, 2015 at 07:11:42PM +0300, Amer wrote:
> Do you want me to give one of the Ethernet interfaces an IP address= the bridge IP, without assigning this interface to the bridge.
> 
> Best regards,
> Amer
> 
>  م، كتب ‏Ben Pfaff ‏<blp at nicira.com>:‬
> Well, like you said, without flows, ping works.  So pass through the
> > ICMP traffic to the gateway to the IP stack (presumably the bridge's
> > local port) and let it do the ICMP responses.
> > 
> >> On Sat, Mar 14, 2015 at 06:40:10PM +0300, Amer wrote:
> >> Thank you Ben
> >> The problem is the host need to have a gateway, however, if he can't ping the gateway, nothing will be forwarded.
> >> However, how can I pass the ICMP packets to the IP stack?
> >> 
> >> Best regards,
> >> Amer
> >> 
> >> ‏:‬
> >> 
> >>>> On Sat, Mar 14, 2015 at 02:29:07PM +0300, Amer wrote:
> >>>> I have 4 VMs, 2 bridges and each one has a host.
> >>>> My question is:
> >>>> I need to configure a default gateway for the hosts, however when I added flow rules to the bridges, suddenly, I can't ping them from the hosts. I know this is due to the rules.
> >>>> When the host can't ping the bridge, how I configure it to be the gateway.
> >>>> I need to add a flow-rule to make the bridge respond to ping requests? What is the rule to do so?
> >>> 
> >>> I don't think you can do that through flows.  It is probably better to
> >>> configure the flows so that anything that needs an ICMP response is
> >>> passed through to the IP stack.
> > 

From amer7777 at hotmail.com  Sat Mar 14 10:09:33 2015
From: amer7777 at hotmail.com (Amer)
Date: Sat, 14 Mar 2015 20:09:33 +0300
Subject: [ovs-discuss] Bridge pinging rules
In-Reply-To: <20150314164634.GD8414@nicira.com>
References: <BLU436-SMTP460D24C8AA7226B6478327D4040@phx.gbl>
 <20150314150521.GB8414@nicira.com>
 <BLU436-SMTP154A11F76F7A1C41CB6DB25D4040@phx.gbl>
 <20150314154326.GC8414@nicira.com>
 <BLU436-SMTP7528C202B4CCD8D57A8B5DD4040@phx.gbl>
 <20150314164634.GD8414@nicira.com>
Message-ID: <BLU436-SMTP169C7E0FE0F9473BDD942F2D4040@phx.gbl>

nano /etc/network/interfaces
auto br0
Inface br0 inet static
address 192.168.56.4
netmask 255.255.255.0
.....

then in the host
gateway 192.168.56.4

Thank you

‏‫‏Ben Pfaff ‏<blp at nicira.com>:‬

> No.
> 
> The local port is the port with the same name as the bridge itself.
> 
>> On Sat, Mar 14, 2015 at 07:11:42PM +0300, Amer wrote:
>> Do you want me to give one of the Ethernet interfaces an IP address= the bridge IP, without assigning this interface to the bridge.
>> 
>> Best regards,
>> Amer
>> 
>> م، كتب ‏Ben Pfaff ‏<blp at nicira.com>:‬
>> Well, like you said, without flows, ping works.  So pass through the
>>> ICMP traffic to the gateway to the IP stack (presumably the bridge's
>>> local port) and let it do the ICMP responses.
>>> 
>>>> On Sat, Mar 14, 2015 at 06:40:10PM +0300, Amer wrote:
>>>> Thank you Ben
>>>> The problem is the host need to have a gateway, however, if he can't ping the gateway, nothing will be forwarded.
>>>> However, how can I pass the ICMP packets to the IP stack?
>>>> 
>>>> Best regards,
>>>> Amer
>>>> 
>>>> ‏:‬
>>>> 
>>>>>> On Sat, Mar 14, 2015 at 02:29:07PM +0300, Amer wrote:
>>>>>> I have 4 VMs, 2 bridges and each one has a host.
>>>>>> My question is:
>>>>>> I need to configure a default gateway for the hosts, however when I added flow rules to the bridges, suddenly, I can't ping them from the hosts. I know this is due to the rules.
>>>>>> When the host can't ping the bridge, how I configure it to be the gateway.
>>>>>> I need to add a flow-rule to make the bridge respond to ping requests? What is the rule to do so?
>>>>> 
>>>>> I don't think you can do that through flows.  It is probably better to
>>>>> configure the flows so that anything that needs an ICMP response is
>>>>> passed through to the IP stack.
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150314/b870d428/attachment.html>

From amer7777 at hotmail.com  Sat Mar 14 11:31:05 2015
From: amer7777 at hotmail.com (Amer)
Date: Sat, 14 Mar 2015 21:31:05 +0300
Subject: [ovs-discuss] Bridge pinging rules
In-Reply-To: <BLU436-SMTP169C7E0FE0F9473BDD942F2D4040@phx.gbl>
References: <BLU436-SMTP460D24C8AA7226B6478327D4040@phx.gbl>
 <20150314150521.GB8414@nicira.com>
 <BLU436-SMTP154A11F76F7A1C41CB6DB25D4040@phx.gbl>
 <20150314154326.GC8414@nicira.com>
 <BLU436-SMTP7528C202B4CCD8D57A8B5DD4040@phx.gbl>
 <20150314164634.GD8414@nicira.com>
 <BLU436-SMTP169C7E0FE0F9473BDD942F2D4040@phx.gbl>
Message-ID: <BLU436-SMTP187408FA0CC94221A1E5C7CD4040@phx.gbl>

The br0 interface is labeled with LOCAL in bridge show table,
How can I use it in the flow-rules.
When wrote LOCAL I got an error saying LOCAL is not numerical value.

Best regards,
Amer

‏‫من جهاز الـ iPhone الخاص بي‬

‫في ٢٣ جما١، ١٤٣٦ هـ، الساعة ٨:٠٩ م، كتب ‏Amer ‏<amer7777 at hotmail.com>:‬

> nano /etc/network/interfaces
> auto br0
> Inface br0 inet static
> address 192.168.56.4
> netmask 255.255.255.0
> .....
> 
> then in the host
> gateway 192.168.56.4
> 
> Thank you
> 
> ‏‫‏Ben Pfaff ‏<blp at nicira.com>:‬
> 
>> No.
>> 
>> The local port is the port with the same name as the bridge itself.
>> 
>>> On Sat, Mar 14, 2015 at 07:11:42PM +0300, Amer wrote:
>>> Do you want me to give one of the Ethernet interfaces an IP address= the bridge IP, without assigning this interface to the bridge.
>>> 
>>> Best regards,
>>> Amer
>>> 
>>> م، كتب ‏Ben Pfaff ‏<blp at nicira.com>:‬
>>> Well, like you said, without flows, ping works.  So pass through the
>>>> ICMP traffic to the gateway to the IP stack (presumably the bridge's
>>>> local port) and let it do the ICMP responses.
>>>> 
>>>>> On Sat, Mar 14, 2015 at 06:40:10PM +0300, Amer wrote:
>>>>> Thank you Ben
>>>>> The problem is the host need to have a gateway, however, if he can't ping the gateway, nothing will be forwarded.
>>>>> However, how can I pass the ICMP packets to the IP stack?
>>>>> 
>>>>> Best regards,
>>>>> Amer
>>>>> 
>>>>> ‏:‬
>>>>> 
>>>>>>> On Sat, Mar 14, 2015 at 02:29:07PM +0300, Amer wrote:
>>>>>>> I have 4 VMs, 2 bridges and each one has a host.
>>>>>>> My question is:
>>>>>>> I need to configure a default gateway for the hosts, however when I added flow rules to the bridges, suddenly, I can't ping them from the hosts. I know this is due to the rules.
>>>>>>> When the host can't ping the bridge, how I configure it to be the gateway.
>>>>>>> I need to add a flow-rule to make the bridge respond to ping requests? What is the rule to do so?
>>>>>> 
>>>>>> I don't think you can do that through flows.  It is probably better to
>>>>>> configure the flows so that anything that needs an ICMP response is
>>>>>> passed through to the IP stack.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150314/43f47542/attachment-0001.html>

From mk.lavanya at gmail.com  Sat Mar 14 23:42:27 2015
From: mk.lavanya at gmail.com (Lavanya M.K)
Date: Sat, 14 Mar 2015 23:42:27 -0700
Subject: [ovs-discuss] ECMP configuration on openvswitch
Message-ID: <CAH01gJ7ypw3r7=Qgqq0YnyAWt9mqKFRe3nr6ntHQh9oW9mfGTA@mail.gmail.com>

Hi All,

I want to have static ECMP configuration in openvswitches used in a fat
tree topology DCN(simulated in Mininet). The first packet should not be
sent to the controller. Can i do this by ovs commands to install flow rules
into group table?
The controller version i am using is OpenDayLight Hydrogen, which does not
support writing into group table.

Thanks,
Lavanya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150314/2ea7e7bf/attachment.html>

From amer7777 at hotmail.com  Sun Mar 15 03:38:46 2015
From: amer7777 at hotmail.com (AMER)
Date: Sun, 15 Mar 2015 10:38:46 +0000
Subject: [ovs-discuss] OVS and VM linear topology
Message-ID: <DUB113-W8859C2C83B99F4EA1B66CED4050@phx.gbl>

Hi Lucas

I saw your comments in this email:
http://openvswitch.org/pipermail/discuss/2013-October/011742.html


However, I have the following topology
h1 --->vm1---->vm2---> h2

all of the nodes and switches are Virtualbox and I tested the connectivity before implementing the OVS, it was OK.

h1 ip 192.168.56.3
h2 ip 192.168.57.7
br0 192.168.56.4
br1 192.168.57.4

I have added the following rules to br0(vm1)
ovs-ofctl add-flows br0 table=0, priority=99, dl_type=0x800, nw_dst=192.168.56.3, actions=output:1
ovs-ofctl add-flows br0 table=0, priority=99, dl_type=0x800, nw_dst=192.168.57.7, actions=output:2
ovs-ofctl add-flows br0 table=0, priority=99, dl_type=0x800, nw_dst=192.168.54.4, actions=LOCAL # to make the ping pass through to local port

note the following:
h1 needs a gateway to communicate with 192.168.57.7, because they are in different subnets
when i add the above rules to the bridge h1 can not ping br0(192.168.56.4)

I do not know how to solve this issue?

I do not add the bridges to /etc/network/interfaces, I do not know what is the appropriate config i did not enable ip forwarding, should i enable it in hosts and bridges 
best regards,
amer


Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150315/ac6d9eff/attachment.html>

From peter.phaal at inmon.com  Sun Mar 15 09:17:06 2015
From: peter.phaal at inmon.com (Peter Phaal)
Date: Sun, 15 Mar 2015 09:17:06 -0700
Subject: [ovs-discuss] ECMP configuration on openvswitch
In-Reply-To: <CAH01gJ7ypw3r7=Qgqq0YnyAWt9mqKFRe3nr6ntHQh9oW9mfGTA@mail.gmail.com>
References: <CAH01gJ7ypw3r7=Qgqq0YnyAWt9mqKFRe3nr6ntHQh9oW9mfGTA@mail.gmail.com>
Message-ID: <091C3AC0-3675-4752-A2DC-3F3137197A82@inmon.com>

The leafandspine.py script described in the following article provides an example that you could modify for your OpenDaylight setup.

http://blog.sflow.com/2014/04/mininet-integrated-hybrid-openflow.htm

You need to find a way to prevent the controller from flushing openflow rules on startup for this approach to work. There are efforts to support hybrid openflow in OpenDaylight 

http://blog.sflow.com/2014/09/hp-proposes-hybrid-openflow-discussion.html

Peter Phaal
InMon Corp.

> On Mar 14, 2015, at 11:42 PM, Lavanya M.K <mk.lavanya at gmail.com> wrote:
> 
> Hi All,
> 
> I want to have static ECMP configuration in openvswitches used in a fat tree topology DCN(simulated in Mininet). The first packet should not be sent to the controller. Can i do this by ovs commands to install flow rules into group table? 
> The controller version i am using is OpenDayLight Hydrogen, which does not support writing into group table.
> 
> Thanks,
> Lavanya
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From johnson.dantis at hp.com  Sun Mar 15 23:23:54 2015
From: johnson.dantis at hp.com (Dantis, Johnson)
Date: Mon, 16 Mar 2015 06:23:54 +0000
Subject: [ovs-discuss] Looking for OVS image for Windows
In-Reply-To: <CAHbON5qdySDXqCBEdP8gyBEEEd400Hg9E-FC0NO3HudAGPszrA@mail.gmail.com>
References: <3779987BBCA98E469FBB73FAC572E1687C73C8BA@G9W0755.americas.hpqcorp.net>
 <CAHbON5qdySDXqCBEdP8gyBEEEd400Hg9E-FC0NO3HudAGPszrA@mail.gmail.com>
Message-ID: <3779987BBCA98E469FBB73FAC572E1687C73CAF5@G9W0755.americas.hpqcorp.net>

Hi Gurucharan,

Thanks for this update.

Can you let me know the steps which we can use to generate the OVS build using AppVeyor. Especially the environment settings and other settings for build to be used.

Thanks,
Johnson

-----Original Message-----
From: Gurucharan Shetty [mailto:shettyg at nicira.com] 
Sent: Friday, March 13, 2015 10:15 PM
To: Dantis, Johnson
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Looking for OVS image for Windows

On Thu, Mar 12, 2015 at 10:21 PM, Dantis, Johnson <johnson.dantis at hp.com> wrote:
> Hi,
>
>
>
> Is there a OVS image for windows with the latest stable update ?  I am 
> looking for a installer for deployment.  Please point me to the link 
> from where I can download it.
Unfortunately, there is no official installer. It is a little embarrassing (I plan to do something about it. Any help is appreciated).
Having said that, we currently have all the components needed to run OVS on Hyper-V (if you read the INSTALL.WIndows.md) only on OVS master. But OVS 2.4 (likely to be released in a month or so) will be a beta release of OVS for Hyper-V.

>
>
>
> Thanks,
>
> Johnson
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From vguvva at caviumnetworks.com  Mon Mar 16 00:24:14 2015
From: vguvva at caviumnetworks.com (Vijaya Mohan Guvva)
Date: Mon, 16 Mar 2015 12:54:14 +0530
Subject: [ovs-discuss] vswitchd crash with flow table 254 deletion
In-Reply-To: <20150313195539.GF3884@nicira.com>
References: <54FE9580.4050106@caviumnetworks.com>
 <20150310175859.GE11735@nicira.com> <54FF32F7.8060708@caviumnetworks.com>
 <20150313195539.GF3884@nicira.com>
Message-ID: <5506851E.5020205@caviumnetworks.com>

On 03/14/2015 01:25 AM, Ben Pfaff wrote:
> Hi Ben,
> Its v2.3.0 and v2.3.1.
> Thanks, I sent out a fix for the problem, which only affects
> branch-2.3.  Will you please test it out and review it?
>
> The patch is here:
>          http://openvswitch.org/pipermail/dev/2015-March/052391.html
>
> Thanks,
>
> Ben.
Hi Ben,
With this fix, flow add/mod/del are not allowed on table=254. Is this 
the intended behaviour?
We may want to just avoid deleting following internal flows instead of 
reserving the table itself.

Please correct if my understanding is wrong.

# ovs-ofctl dump-flows br0 table=254
  cookie=0x0, duration=606.191s, table=254, n_packets=0, n_bytes=0, 
idle_age=606, priority=1 actions=drop
  cookie=0x0, duration=606.191s, table=254, n_packets=0, n_bytes=0, 
idle_age=606, priority=0,reg0=0x3 actions=drop
  cookie=0x0, duration=606.191s, table=254, n_packets=0, n_bytes=0, 
idle_age=606, priority=0,reg0=0x1 actions=controller(reason=no_match)
  cookie=0x0, duration=606.191s, table=254, n_packets=0, n_bytes=0, 
idle_age=606, priority=0,reg0=0x2 actions=drop
  cookie=0x0, duration=606.191s, table=254, n_packets=0, n_bytes=0, 
idle_age=606, priority=2,recirc_id=0 actions=resubmit(,0)

-- 
Thanks, Vijay

From cvinllen at gmail.com  Mon Mar 16 01:37:55 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Mon, 16 Mar 2015 16:37:55 +0800
Subject: [ovs-discuss] new version about ovs wildcard match
Message-ID: <CAN2QyzYOHRYD3WqBS7ydmbOLcnwXk3Ld+8sFDHQsOo9WL1s7VQ@mail.gmail.com>

Hi, all:
    I heard that the new version ovs put the wildcard match into the
kernel. Is there exist any documents  which i can follow to understanding
the key matching process and how much the performance has been improved.
    Thanks for replay.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150316/7ea776da/attachment.html>

From amal.kammoun at supcom.tn  Mon Mar 16 01:59:40 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Mon, 16 Mar 2015 08:59:40 +0000
Subject: [ovs-discuss] CPU use for switches.
Message-ID: <1426496344068.60143@supcom.tn>

Hi all,

The general issue for me is how much CPU does one switch in Mininet utilize to handle
the maximum number of flows?


Is there any study or reference that presents, for an example of characteristics (CPU, RAM ...),
how much switches they could have and how much flow can one switch handle?


Thank you!

Amal.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150316/07a0490f/attachment.html>

From shettyg at nicira.com  Mon Mar 16 07:57:05 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 16 Mar 2015 07:57:05 -0700
Subject: [ovs-discuss] Looking for OVS image for Windows
In-Reply-To: <3779987BBCA98E469FBB73FAC572E1687C73CAF5@G9W0755.americas.hpqcorp.net>
References: <3779987BBCA98E469FBB73FAC572E1687C73C8BA@G9W0755.americas.hpqcorp.net>
 <CAHbON5qdySDXqCBEdP8gyBEEEd400Hg9E-FC0NO3HudAGPszrA@mail.gmail.com>
 <3779987BBCA98E469FBB73FAC572E1687C73CAF5@G9W0755.americas.hpqcorp.net>
Message-ID: <CAHbON5oiH3wgSNfrWn2JVORfYVe5UvQ34Dx8Zdc3XjB4rH4qDQ@mail.gmail.com>

On Sun, Mar 15, 2015 at 11:23 PM, Dantis, Johnson <johnson.dantis at hp.com> wrote:
> Hi Gurucharan,
>
> Thanks for this update.
>
> Can you let me know the steps which we can use to generate the OVS build using AppVeyor. Especially the environment settings and other settings for build to be used.

I don't know how familiar you are with Appveyor. To import all the
settings automatically, we have added a file called appveyor.yml in
the OVS repository. It has all the settings for a build to take place.

To trigger a build.
* Create a GitHub account
* Login into appveyor using your github account.
* Create a new project and point to either the official OVS github
repo for a one time build or to a forked OVS repo.

Since Appveyor looks for the appveyor.yml in the base directory of the
git repo of OVS and finds it, it automatically uses the settings from
there.
>From there, you can create a new build.

Having said that, OVS integration with appveyor right now is limited
to just building OVS. We do not have settings to export the created
executables so that they can be used. I have read that it is possible
to do that by making modifications to Appveyor settings, but I haven't
done that yet.

If you want to do manual builds, with a lot more control, you will have to read:
https://github.com/openvswitch/ovs/blob/master/INSTALL.Windows.md

Yesterday, Alessandro Pilotti started a discussion about Cloudbase
contributing their installer to OVS. So you can try that out too. But
I haven't tested it yet.
http://openvswitch.org/pipermail/dev/2015-March/052423.html


>
> Thanks,
> Johnson
>
> -----Original Message-----
> From: Gurucharan Shetty [mailto:shettyg at nicira.com]
> Sent: Friday, March 13, 2015 10:15 PM
> To: Dantis, Johnson
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Looking for OVS image for Windows
>
> On Thu, Mar 12, 2015 at 10:21 PM, Dantis, Johnson <johnson.dantis at hp.com> wrote:
>> Hi,
>>
>>
>>
>> Is there a OVS image for windows with the latest stable update ?  I am
>> looking for a installer for deployment.  Please point me to the link
>> from where I can download it.
> Unfortunately, there is no official installer. It is a little embarrassing (I plan to do something about it. Any help is appreciated).
> Having said that, we currently have all the components needed to run OVS on Hyper-V (if you read the INSTALL.WIndows.md) only on OVS master. But OVS 2.4 (likely to be released in a month or so) will be a beta release of OVS for Hyper-V.
>
>>
>>
>>
>> Thanks,
>>
>> Johnson
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>

From blp at nicira.com  Mon Mar 16 08:42:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 16 Mar 2015 08:42:44 -0700
Subject: [ovs-discuss] vswitchd crash with flow table 254 deletion
In-Reply-To: <5506851E.5020205@caviumnetworks.com>
References: <54FE9580.4050106@caviumnetworks.com>
 <20150310175859.GE11735@nicira.com>
 <54FF32F7.8060708@caviumnetworks.com>
 <20150313195539.GF3884@nicira.com>
 <5506851E.5020205@caviumnetworks.com>
Message-ID: <20150316154244.GE12403@nicira.com>

On Mon, Mar 16, 2015 at 12:54:14PM +0530, Vijaya Mohan Guvva wrote:
> On 03/14/2015 01:25 AM, Ben Pfaff wrote:
> >Hi Ben,
> >Its v2.3.0 and v2.3.1.
> >Thanks, I sent out a fix for the problem, which only affects
> >branch-2.3.  Will you please test it out and review it?
> >
> >The patch is here:
> >         http://openvswitch.org/pipermail/dev/2015-March/052391.html
> >
> >Thanks,
> >
> >Ben.
> Hi Ben,
> With this fix, flow add/mod/del are not allowed on table=254. Is this the
> intended behaviour?

Yes.

As DESIGN.md has said as long as OVS has supported multiple tables,
"Tables 128 and above are reserved for use by the switch itself.
Controllers should use only tables 0 through 127."

May I assume that the bug appears fixed to you?

Thanks,

Ben.

From blp at nicira.com  Mon Mar 16 08:50:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 16 Mar 2015 08:50:43 -0700
Subject: [ovs-discuss] CPU use for switches.
In-Reply-To: <1426496344068.60143@supcom.tn>
References: <1426496344068.60143@supcom.tn>
Message-ID: <20150316155043.GG12403@nicira.com>

On Mon, Mar 16, 2015 at 08:59:40AM +0000, Amal KAMMOUN wrote:
> The general issue for me is how much CPU does one switch in Mininet
> utilize to handle the maximum number of flows?

The amount of CPU that OVS uses depends on the forms of the flows in use
in the flow tables and the amount of traffic and its patterns.  The raw
number of flows is not that interesting.  Tell us about your use case
and perhaps we can give some hints.

From zhangchen9211 at 126.com  Mon Mar 16 00:32:27 2015
From: zhangchen9211 at 126.com (=?GBK?B?1cWzvw==?=)
Date: Mon, 16 Mar 2015 15:32:27 +0800 (CST)
Subject: [ovs-discuss] what indirects the flow entry with the same priority
 and match fields to be selected in ovs?
Message-ID: <64e6a66a.9562.14c217f8527.Coremail.zhangchen9211@126.com>

hello, dear all!


Openflow spec doesn't specify how to direct flow entry with the same priority and match fields to be selected. For example, i have an entry for 1.0.0.0/24, and another for 1.0.0.1/32 with all the other fields the same(priority same, too), how should these two entry be selected in ovs? Apparently, i hope the second to be matched. Or only the priority field could save me?


i'd be much thx for the ans! 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150316/402ca60f/attachment.html>

From jpettit at nicira.com  Mon Mar 16 09:07:03 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 16 Mar 2015 09:07:03 -0700
Subject: [ovs-discuss] what indirects the flow entry with the same
	priority and match fields to be selected in ovs?
In-Reply-To: <64e6a66a.9562.14c217f8527.Coremail.zhangchen9211@126.com>
References: <64e6a66a.9562.14c217f8527.Coremail.zhangchen9211@126.com>
Message-ID: <A96EDB3F-F28A-4247-8707-7D4C6590042A@nicira.com>


> On Mar 16, 2015, at 12:32 AM, 张晨 <zhangchen9211 at 126.com> wrote:
> 
> hello, dear all!
> 
> Openflow spec doesn't specify how to direct flow entry with the same priority and match fields to be selected. For example, i have an entry for 1.0.0.0/24, and another for 1.0.0.1/32 with all the other fields the same(priority same, too), how should these two entry be selected in ovs? Apparently, i hope the second to be matched. Or only the priority field could save me?

The OpenFlow spec explicitly states that it's undefined:

    If there are multiple matching flow entries with the same highest priority, the selected flow entry is explicitly undefined.

I wouldn't make assumption about how OVS chooses one, so just make it explicit by setting priorities.

--Justin



From amal.kammoun at supcom.tn  Mon Mar 16 09:18:56 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Mon, 16 Mar 2015 16:18:56 +0000
Subject: [ovs-discuss] CPU use for switches.
In-Reply-To: <20150316155043.GG12403@nicira.com>
References: <1426496344068.60143@supcom.tn>,
 <20150316155043.GG12403@nicira.com>
Message-ID: <1426522736653.2107@supcom.tn>

Hello Ben! 

Thank you for your response.

So, in my use case, I want to create with mininet a virtual network that will transport a VoIP traffic.  

I'm really newbie in all of this :)

Thank you for your time.

Amal

________________________________________
From: Ben Pfaff <blp at nicira.com>
Sent: Monday, March 16, 2015 3:50 PM
To: Amal KAMMOUN
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] CPU use for switches.

On Mon, Mar 16, 2015 at 08:59:40AM +0000, Amal KAMMOUN wrote:
> The general issue for me is how much CPU does one switch in Mininet
> utilize to handle the maximum number of flows?

The amount of CPU that OVS uses depends on the forms of the flows in use
in the flow tables and the amount of traffic and its patterns.  The raw
number of flows is not that interesting.  Tell us about your use case
and perhaps we can give some hints.

From vguvva at caviumnetworks.com  Mon Mar 16 10:33:32 2015
From: vguvva at caviumnetworks.com (Vijaya Mohan Guvva)
Date: Mon, 16 Mar 2015 23:03:32 +0530
Subject: [ovs-discuss] vswitchd crash with flow table 254 deletion
In-Reply-To: <20150316154244.GE12403@nicira.com>
References: <54FE9580.4050106@caviumnetworks.com>
 <20150310175859.GE11735@nicira.com> <54FF32F7.8060708@caviumnetworks.com>
 <20150313195539.GF3884@nicira.com> <5506851E.5020205@caviumnetworks.com>
 <20150316154244.GE12403@nicira.com>
Message-ID: <550713EC.8010208@caviumnetworks.com>


On 03/16/2015 09:12 PM, Ben Pfaff wrote:
> On Mon, Mar 16, 2015 at 12:54:14PM +0530, Vijaya Mohan Guvva wrote:
>> On 03/14/2015 01:25 AM, Ben Pfaff wrote:
>>> Hi Ben,
>>> Its v2.3.0 and v2.3.1.
>>> Thanks, I sent out a fix for the problem, which only affects
>>> branch-2.3.  Will you please test it out and review it?
>>>
>>> The patch is here:
>>>          http://openvswitch.org/pipermail/dev/2015-March/052391.html
>>>
>>> Thanks,
>>>
>>> Ben.
>> Hi Ben,
>> With this fix, flow add/mod/del are not allowed on table=254. Is this the
>> intended behaviour?
> Yes.
>
> As DESIGN.md has said as long as OVS has supported multiple tables,
> "Tables 128 and above are reserved for use by the switch itself.
> Controllers should use only tables 0 through 127."
>
> May I assume that the bug appears fixed to you?
>
> Thanks,
>
> Ben.

Yes Ben, its fixes the issue.
Thanks for the patch.

-- 
Thanks, Vijay

From blp at nicira.com  Mon Mar 16 10:55:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 16 Mar 2015 10:55:45 -0700
Subject: [ovs-discuss] CPU use for switches.
In-Reply-To: <1426522736653.2107@supcom.tn>
References: <1426496344068.60143@supcom.tn> <20150316155043.GG12403@nicira.com>
 <1426522736653.2107@supcom.tn>
Message-ID: <20150316175545.GL12403@nicira.com>

On Mon, Mar 16, 2015 at 04:18:56PM +0000, Amal KAMMOUN wrote:
> So, in my use case, I want to create with mininet a virtual network
> that will transport a VoIP traffic.

What flows do you expect to use and what traffic and traffic patterns do
you expect?

> I'm really newbie in all of this :)
> 
> Thank you for your time.
> 
> Amal
> 
> ________________________________________
> From: Ben Pfaff <blp at nicira.com>
> Sent: Monday, March 16, 2015 3:50 PM
> To: Amal KAMMOUN
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] CPU use for switches.
> 
> On Mon, Mar 16, 2015 at 08:59:40AM +0000, Amal KAMMOUN wrote:
> > The general issue for me is how much CPU does one switch in Mininet
> > utilize to handle the maximum number of flows?
> 
> The amount of CPU that OVS uses depends on the forms of the flows in use
> in the flow tables and the amount of traffic and its patterns.  The raw
> number of flows is not that interesting.  Tell us about your use case
> and perhaps we can give some hints.

From jesse at nicira.com  Mon Mar 16 15:16:39 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 16 Mar 2015 15:16:39 -0700
Subject: [ovs-discuss] Open vSwitch Conference 2015--conflicts?
In-Reply-To: <20150313174729.GC3884@nicira.com>
References: <20150313174729.GC3884@nicira.com>
Message-ID: <CAEP_g=8Vuv88AGqaLQqcGxAmpMXj0UitiCD3EwcX9iiLfui_zw@mail.gmail.com>

On Fri, Mar 13, 2015 at 10:47 AM, Ben Pfaff <blp at nicira.com> wrote:
> I'm working on figuring out the scheduling for this year's OVS
> conference.  I'm aiming for a pair of days in November and a location
> near Palo Alto.
>
> So far, I've heard about the following conflicts:
>
>         Nov. 12: p4.org conference (tentative date)
>         Nov. 18-21: IEEE SDN-NFV conference in San Francisco
>
> I'd like to hear about other conflicts that we should aim to work
> around, as well as any suggested dates.

IETF is November 1-6th although I don't know how big the overlap in
attendees is.

From bensons at queuefull.net  Mon Mar 16 15:20:46 2015
From: bensons at queuefull.net (Benson Schliesser)
Date: Mon, 16 Mar 2015 18:20:46 -0400
Subject: [ovs-discuss] Open vSwitch Conference 2015--conflicts?
In-Reply-To: <CAEP_g=8Vuv88AGqaLQqcGxAmpMXj0UitiCD3EwcX9iiLfui_zw@mail.gmail.com>
References: <20150313174729.GC3884@nicira.com>
 <CAEP_g=8Vuv88AGqaLQqcGxAmpMXj0UitiCD3EwcX9iiLfui_zw@mail.gmail.com>
Message-ID: <5507573E.8000406@queuefull.net>

Here are a couple I have in my notes:
Nov 1 - Nov 6 — IETF 94 in Yokohama
Nov 9 - Nov 12 — OPNFV in Bay Area

> Jesse Gross <mailto:jesse at nicira.com>
> March 16, 2015 at 6:16 PM
>
> IETF is November 1-6th although I don't know how big the overlap in
> attendees is.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> Ben Pfaff <mailto:blp at nicira.com>
> March 13, 2015 at 1:47 PM
> I'm working on figuring out the scheduling for this year's OVS
> conference. I'm aiming for a pair of days in November and a location
> near Palo Alto.
>
> So far, I've heard about the following conflicts:
>
> Nov. 12: p4.org conference (tentative date)
> Nov. 18-21: IEEE SDN-NFV conference in San Francisco
>
> I'd like to hear about other conflicts that we should aim to work
> around, as well as any suggested dates.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Mon Mar 16 15:58:12 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 16 Mar 2015 15:58:12 -0700
Subject: [ovs-discuss] Open vSwitch Conference 2015--conflicts?
In-Reply-To: <CAEP_g=8Vuv88AGqaLQqcGxAmpMXj0UitiCD3EwcX9iiLfui_zw@mail.gmail.com>
References: <20150313174729.GC3884@nicira.com>
 <CAEP_g=8Vuv88AGqaLQqcGxAmpMXj0UitiCD3EwcX9iiLfui_zw@mail.gmail.com>
Message-ID: <20150316225812.GD11929@nicira.com>

On Mon, Mar 16, 2015 at 03:16:39PM -0700, Jesse Gross wrote:
> On Fri, Mar 13, 2015 at 10:47 AM, Ben Pfaff <blp at nicira.com> wrote:
> > I'm working on figuring out the scheduling for this year's OVS
> > conference.  I'm aiming for a pair of days in November and a location
> > near Palo Alto.
> >
> > So far, I've heard about the following conflicts:
> >
> >         Nov. 12: p4.org conference (tentative date)
> >         Nov. 18-21: IEEE SDN-NFV conference in San Francisco
> >
> > I'd like to hear about other conflicts that we should aim to work
> > around, as well as any suggested dates.
> 
> IETF is November 1-6th although I don't know how big the overlap in
> attendees is.

Thanks!  I've added that to my list.

From cvinllen at gmail.com  Mon Mar 16 20:45:46 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Tue, 17 Mar 2015 11:45:46 +0800
Subject: [ovs-discuss] userspace handle upcalls
Message-ID: <CAN2QyzYTx7tNdJBwCZmsmGeBi98vttQqFuUXjFGeFSKfWSVERA@mail.gmail.com>

Hi, all:
    When i following the ovs source code, i found that after version 2.0,
wildcard matching has been put into the kernel space. But the code shows
that the kernel space also send upcalls message when miss match lookup in
the flow table.
    My question is what's the difference about wildcard matching between
the userspace and kernel space.
    Thanks very much for anyone's reply!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150317/a592fe65/attachment.html>

From sharmila.radhakrishnan at intel.com  Tue Mar 17 05:28:12 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Tue, 17 Mar 2015 12:28:12 +0000
Subject: [ovs-discuss] Issue in added bridge in OVS-DPDK build
Message-ID: <1BA01C3192A665469272B2597052DDFF56EB1F2D@BGSMSX104.gar.corp.intel.com>

Hi All,
   I have built OVS with DPDK(v1.7.1) as mentioned in the Install instructions.

Iam able to add the bridge using command:

ovs-vsctl add-br br2 -- set bridge br2 datapath_type=netdev

However, when I ry to add the bridge like it is done in plain OVS, I get the following error.

[root at localhost ~]# ovs-vsctl add-br br5
ovs-vsctl: Error detected while setting up 'br5'.  See ovs-vswitchd log for details.


This is the log:

Mar 17 05:29:08 localhost ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl add-br br5
Mar 17 05:29:08 localhost ovs-vswitchd: ovs|00077|dpif|WARN|failed to enumerate system datapaths: No such file or directory
Mar 17 05:29:08 localhost ovs-vswitchd: ovs|00078|dpif|WARN|failed to create datapath ovs-system: No such file or directory
Mar 17 05:29:08 localhost ovs-vswitchd: ovs|00079|ofproto_dpif|ERR|failed to open datapath of type system: No such file or directory


Is this not allowed or is this an issue?


Thanks,
Sharmila
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150317/d6d62454/attachment-0001.html>

From diproiettod at vmware.com  Tue Mar 17 05:51:21 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 17 Mar 2015 12:51:21 +0000
Subject: [ovs-discuss] Issue in added bridge in OVS-DPDK build
In-Reply-To: <1BA01C3192A665469272B2597052DDFF56EB1F2D@BGSMSX104.gar.corp.intel.com>
References: <1BA01C3192A665469272B2597052DDFF56EB1F2D@BGSMSX104.gar.corp.intel.com>
Message-ID: <37FB3C56-4761-4AF9-A66C-C25ACA9F083C@vmware.com>


Hi Sharmila,

``ovs-vsctl add-br br5'' tells OVS to create a bridge that uses
a “system” dpif, i.e. a datapath created by the OVS linux kernel
module (not a userspace datapath, usable with DPDK devices).

The error in the log suggests that the OVS kernel module is not
loaded.

Daniele

> On 17 Mar 2015, at 12:28, Radhakrishnan, Sharmila <sharmila.radhakrishnan at intel.com> wrote:
> 
> Hi All,
>    I have built OVS with DPDK(v1.7.1) as mentioned in the Install instructions.
>  
> Iam able to add the bridge using command:
>  
> ovs-vsctl add-br br2 -- set bridge br2 datapath_type=netdev
>  
> However, when I ry to add the bridge like it is done in plain OVS, I get the following error.
>  
> [root at localhost ~]# ovs-vsctl add-br br5
> ovs-vsctl: Error detected while setting up 'br5'.  See ovs-vswitchd log for details.
>  
>  
> This is the log:
>  
> Mar 17 05:29:08 localhost ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl add-br br5
> Mar 17 05:29:08 localhost ovs-vswitchd: ovs|00077|dpif|WARN|failed to enumerate system datapaths: No such file or directory
> Mar 17 05:29:08 localhost ovs-vswitchd: ovs|00078|dpif|WARN|failed to create datapath ovs-system: No such file or directory
> Mar 17 05:29:08 localhost ovs-vswitchd: ovs|00079|ofproto_dpif|ERR|failed to open datapath of type system: No such file or directory
>  
>  
> Is this not allowed or is this an issue?
>  
>  
> Thanks,
> Sharmila
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_mailman_listinfo_discuss&d=AwIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=4bY0xO_WeuVIcFPyodHDLjJeHAgFjRKZV-t4Qkm-ie8&s=Lum_JZ5i7q1XF-tpNfwIctasKbyHds4nEFPoYirArXg&e=


From sharmila.radhakrishnan at intel.com  Tue Mar 17 05:53:50 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Tue, 17 Mar 2015 12:53:50 +0000
Subject: [ovs-discuss] Issue in added bridge in OVS-DPDK build
In-Reply-To: <37FB3C56-4761-4AF9-A66C-C25ACA9F083C@vmware.com>
References: <1BA01C3192A665469272B2597052DDFF56EB1F2D@BGSMSX104.gar.corp.intel.com>
 <37FB3C56-4761-4AF9-A66C-C25ACA9F083C@vmware.com>
Message-ID: <1BA01C3192A665469272B2597052DDFF56EB1F6C@BGSMSX104.gar.corp.intel.com>

Thanks Daniele!

-----Original Message-----
From: Daniele Di Proietto [mailto:diproiettod at vmware.com] 
Sent: Tuesday, March 17, 2015 6:21 PM
To: Radhakrishnan, Sharmila
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Issue in added bridge in OVS-DPDK build


Hi Sharmila,

``ovs-vsctl add-br br5'' tells OVS to create a bridge that uses a “system” dpif, i.e. a datapath created by the OVS linux kernel module (not a userspace datapath, usable with DPDK devices).

The error in the log suggests that the OVS kernel module is not loaded.

Daniele

> On 17 Mar 2015, at 12:28, Radhakrishnan, Sharmila <sharmila.radhakrishnan at intel.com> wrote:
> 
> Hi All,
>    I have built OVS with DPDK(v1.7.1) as mentioned in the Install instructions.
>  
> Iam able to add the bridge using command:
>  
> ovs-vsctl add-br br2 -- set bridge br2 datapath_type=netdev
>  
> However, when I ry to add the bridge like it is done in plain OVS, I get the following error.
>  
> [root at localhost ~]# ovs-vsctl add-br br5
> ovs-vsctl: Error detected while setting up 'br5'.  See ovs-vswitchd log for details.
>  
>  
> This is the log:
>  
> Mar 17 05:29:08 localhost ovs-vsctl: ovs|00001|vsctl|INFO|Called as 
> ovs-vsctl add-br br5 Mar 17 05:29:08 localhost ovs-vswitchd: 
> ovs|00077|dpif|WARN|failed to enumerate system datapaths: No such file 
> or directory Mar 17 05:29:08 localhost ovs-vswitchd: 
> ovs|00078|dpif|WARN|failed to create datapath ovs-system: No such file 
> or directory Mar 17 05:29:08 localhost ovs-vswitchd: 
> ovs|00079|ofproto_dpif|ERR|failed to open datapath of type system: No 
> such file or directory
>  
>  
> Is this not allowed or is this an issue?
>  
>  
> Thanks,
> Sharmila
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_ma
> ilman_listinfo_discuss&d=AwIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMN
> tXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=4bY0xO_WeuVIcF
> PyodHDLjJeHAgFjRKZV-t4Qkm-ie8&s=Lum_JZ5i7q1XF-tpNfwIctasKbyHds4nEFPoYi
> rArXg&e=


From yogesh.pandey1 at tcs.com  Tue Mar 17 06:06:49 2015
From: yogesh.pandey1 at tcs.com (Yogesh Pandey1/HYD/TCS)
Date: Tue, 17 Mar 2015 18:36:49 +0530 (IST)
Subject: [ovs-discuss] Query on ovs Vxlan setup
In-Reply-To: <b904a141-6513-4804-ba0a-b25266e855ee@inmumzm01.tcsin.com>
Message-ID: <0f6cdf1f-74ed-4783-b953-a9a128dcbe9e@inmumzm01.tcsin.com>

Hi All, 

To test NSH feature in ovs (using custom ovs), I am trying to configure VxLan Tunnel between two hypervisors each running one VM using these commands. But whenever I provide an ip to br1 the internet connectivity to my host is lost. Also Vxlan with nsh shows up in the ovs-vsctl show command but VMs are not able to ping each other on different hosts. 

On Host 1 
#ovs Setup 
ovs-vsctl add-br br0 
ovs-vsctl add-br br1 
ovs-vsctl add-port br0 eth0 
ifconfig eth0 0 && ifconfig br0 192.168.1.3 netmask 255.255.255.0 
route add default gw 192.168.1.1 br0 
ifconfig br1 10.1.2.10 netmask 255.255.255.0 

#configuring VxLan 
sudo ovs-vsctl add-port br1 vxlan1 -- set interface vxlan1 type=vxlan options:remote_ip=192.168.1.4 options:key=0x5000 options:nsp=0x123456 options:nsi=44 options:npc=0x22000000 options:nsc=0x33000000 options:spc=0x44000000 options:ssc=0x5500000 


-- 
Thanks and regards, 
Yogesh Pandey 
Mailto:yogesh.pandey1 at tcs.com 
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150317/156fc183/attachment.html>

From openvswitch at status.e4ward.com  Tue Mar 17 06:10:08 2015
From: openvswitch at status.e4ward.com (Kyle Fazzari)
Date: Tue, 17 Mar 2015 09:10:08 -0400
Subject: [ovs-discuss] Persistent Address on OVS Bridge
Message-ID: <CAMvhsDadzxMbYPfPCh1O6XRreLgV2wpcu3_UKSfpFBP7jv5XhA@mail.gmail.com>

Hello all.

This may be a bit of a newbie question, for which I apologize. When I
originally created my bridge with ovs-vsctl, I lost network
connectivity. I quickly found this:
http://openvswitch.org/pipermail/discuss/2014-April/013598.html , and
simply setting the address on br0 worked fine.

However, I want this to happen at boot time. I'm on Ubuntu 14.04. From
what I've read, it sounds like OVS maintains its own database, which
explains why after running

    ovs-vsctl add-br br0
    ovs-vsctl add-port br0 eth0

when I reboot, br0 still exists. However, I'd like br0 to have an
address when it comes back up. If it was a regular interface obviously
I'd put this information in /etc/network/interfaces, but it's not.
However, I've seen articles like this
(http://www.opencloudblog.com/?p=240) that imply that I could
configure this all via /etc/network/interfaces, but I didn't do it
that way initially and now my database already has the bridge defined.

What do I do? I just want to specify a static IP address for br0 when
it comes up at boot, whether it's in my /etc/network/interfaces or
not.

Thank you!

Kyle

From sharmila.radhakrishnan at intel.com  Tue Mar 17 06:49:12 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Tue, 17 Mar 2015 13:49:12 +0000
Subject: [ovs-discuss] Issue in added bridge in OVS-DPDK build
References: <1BA01C3192A665469272B2597052DDFF56EB1F2D@BGSMSX104.gar.corp.intel.com>
 <37FB3C56-4761-4AF9-A66C-C25ACA9F083C@vmware.com> 
Message-ID: <1BA01C3192A665469272B2597052DDFF56EB1FA5@BGSMSX104.gar.corp.intel.com>

Hi Daniele,

I went through e OVS installation in userspace. In the Userspace install it is given, we install everything except the kernel modules and the add the bridges using the below commands:

ovs-vsctl add-br br0
ovs-vsctl set bridge br0 datapath_type=netdev
ovs-vsctl add-port br0 eth0
ovs-vsctl add-port br0 eth1
ovs-vsctl add-port br0 eth2



In the above commands, the first command fails for me again(you have pointed out about the kernel module not being there). Does that mean we need to install the kernel module too in the Userspace mode?

Also, in the installation of the plain OVS document, it is mentioned that installing kernel modules is optional. Shouldn’t this be mandatory?

Also, I would like to understand the architecture of OVS in kernel space vs the one in userspace. Is there any links/document to understand what goes behind the hood.


Thanks,
Sharmila

-----Original Message-----
From: Radhakrishnan, Sharmila 
Sent: Tuesday, March 17, 2015 6:24 PM
To: 'Daniele Di Proietto'
Cc: discuss at openvswitch.org
Subject: RE: [ovs-discuss] Issue in added bridge in OVS-DPDK build

Thanks Daniele!

-----Original Message-----
From: Daniele Di Proietto [mailto:diproiettod at vmware.com] 
Sent: Tuesday, March 17, 2015 6:21 PM
To: Radhakrishnan, Sharmila
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Issue in added bridge in OVS-DPDK build


Hi Sharmila,

``ovs-vsctl add-br br5'' tells OVS to create a bridge that uses a “system” dpif, i.e. a datapath created by the OVS linux kernel module (not a userspace datapath, usable with DPDK devices).

The error in the log suggests that the OVS kernel module is not loaded.

Daniele

> On 17 Mar 2015, at 12:28, Radhakrishnan, Sharmila <sharmila.radhakrishnan at intel.com> wrote:
> 
> Hi All,
>    I have built OVS with DPDK(v1.7.1) as mentioned in the Install instructions.
>  
> Iam able to add the bridge using command:
>  
> ovs-vsctl add-br br2 -- set bridge br2 datapath_type=netdev
>  
> However, when I ry to add the bridge like it is done in plain OVS, I get the following error.
>  
> [root at localhost ~]# ovs-vsctl add-br br5
> ovs-vsctl: Error detected while setting up 'br5'.  See ovs-vswitchd log for details.
>  
>  
> This is the log:
>  
> Mar 17 05:29:08 localhost ovs-vsctl: ovs|00001|vsctl|INFO|Called as 
> ovs-vsctl add-br br5 Mar 17 05:29:08 localhost ovs-vswitchd: 
> ovs|00077|dpif|WARN|failed to enumerate system datapaths: No such file 
> or directory Mar 17 05:29:08 localhost ovs-vswitchd: 
> ovs|00078|dpif|WARN|failed to create datapath ovs-system: No such file 
> or directory Mar 17 05:29:08 localhost ovs-vswitchd: 
> ovs|00079|ofproto_dpif|ERR|failed to open datapath of type system: No 
> such file or directory
>  
>  
> Is this not allowed or is this an issue?
>  
>  
> Thanks,
> Sharmila
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_ma
> ilman_listinfo_discuss&d=AwIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMN
> tXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=4bY0xO_WeuVIcF
> PyodHDLjJeHAgFjRKZV-t4Qkm-ie8&s=Lum_JZ5i7q1XF-tpNfwIctasKbyHds4nEFPoYi
> rArXg&e=


From shettyg at nicira.com  Tue Mar 17 07:35:31 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 17 Mar 2015 07:35:31 -0700
Subject: [ovs-discuss] Persistent Address on OVS Bridge
In-Reply-To: <CAMvhsDadzxMbYPfPCh1O6XRreLgV2wpcu3_UKSfpFBP7jv5XhA@mail.gmail.com>
References: <CAMvhsDadzxMbYPfPCh1O6XRreLgV2wpcu3_UKSfpFBP7jv5XhA@mail.gmail.com>
Message-ID: <CAHbON5p3=atKUb8zTgjbdmHGqDVbzfAt1c1=JR-dJS_WzCpa2w@mail.gmail.com>

On Tue, Mar 17, 2015 at 6:10 AM, Kyle Fazzari
<openvswitch at status.e4ward.com> wrote:
> Hello all.
>
> This may be a bit of a newbie question, for which I apologize. When I
> originally created my bridge with ovs-vsctl, I lost network
> connectivity. I quickly found this:
> http://openvswitch.org/pipermail/discuss/2014-April/013598.html , and
> simply setting the address on br0 worked fine.
>
> However, I want this to happen at boot time. I'm on Ubuntu 14.04. From
> what I've read, it sounds like OVS maintains its own database, which
> explains why after running
>
>     ovs-vsctl add-br br0
>     ovs-vsctl add-port br0 eth0
>
> when I reboot, br0 still exists.
correct.

>However, I'd like br0 to have an
> address when it comes back up. If it was a regular interface obviously
> I'd put this information in /etc/network/interfaces, but it's not.
> However, I've seen articles like this
> (http://www.opencloudblog.com/?p=240) that imply that I could
> configure this all via /etc/network/interfaces, but I didn't do it
> that way initially and now my database already has the bridge defined.
Official information about using 'interfaces' in section "Debian
network scripts integration":
https://github.com/openvswitch/ovs/blob/master/debian/openvswitch-switch.README.Debian


If I remember correctly, rebooting after 'interfaces' populated
properly with the bridge already created may not be a problem. If it
is a problem, delete your bridge. If you worry about loosing network
connectivity, change the ip address back to eth0 in the same line as
the del-br command.

You can also test your changes to interfaces with
(ifup --allow=ovs $list_of_bridges, ifdown --allow=ovs $list_of_bridges)


>
> What do I do? I just want to specify a static IP address for br0 when
> it comes up at boot, whether it's in my /etc/network/interfaces or
> not.
>
> Thank you!
>
> Kyle
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From diproiettod at vmware.com  Tue Mar 17 08:09:03 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 17 Mar 2015 15:09:03 +0000
Subject: [ovs-discuss] Issue in added bridge in OVS-DPDK build
In-Reply-To: <1BA01C3192A665469272B2597052DDFF56EB1FA5@BGSMSX104.gar.corp.intel.com>
References: <1BA01C3192A665469272B2597052DDFF56EB1F2D@BGSMSX104.gar.corp.intel.com>
 <37FB3C56-4761-4AF9-A66C-C25ACA9F083C@vmware.com>
 <1BA01C3192A665469272B2597052DDFF56EB1FA5@BGSMSX104.gar.corp.intel.com>
Message-ID: <AA6F0E16-A6B0-4FC4-8325-92D02F83ADC6@vmware.com>


> On 17 Mar 2015, at 13:49, Radhakrishnan, Sharmila <sharmila.radhakrishnan at intel.com> wrote:
> 
> Hi Daniele,
> 
> I went through e OVS installation in userspace. In the Userspace install it is given, we install everything except the kernel modules and the add the bridges using the below commands:
> 
> ovs-vsctl add-br br0
> ovs-vsctl set bridge br0 datapath_type=netdev
> ovs-vsctl add-port br0 eth0
> ovs-vsctl add-port br0 eth1
> ovs-vsctl add-port br0 eth2
> 
> 
> 
> In the above commands, the first command fails for me again(you have pointed out about the kernel module not being there). Does that mean we need to install the kernel module too in the Userspace mode?
> 
> Also, in the installation of the plain OVS document, it is mentioned that installing kernel modules is optional. Shouldn’t this be mandatory?
> 

Short answer:
    No, the kernel module is not needed in this case.  To make OVS work with
    DPDK (in particular to add bridges and ports), please follow
    INSTALL.DPDK.md (in particular section “Using the DPDK with ovs-vswitchd”
    point “6. Add bridge & ports”).
    https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md

Long answer:
    ``ovs-vsctl add-br br0’’ adds to the _database_ a bridge backed by a
    “system” datapath.  As soon as the ovs-vswitchd daemon notices the
    change, it tries to create the bridge and the datapath.  It fails
    because the kernel module it’s not loaded but it doesn’t delete
    anything from the database.
    ``ovs-vsctl set bridge br0 datapath_type=netdev'’ sets the
    appropriate datapath_type in the _database_.  As soon as the ovs-vswitchd
    daemon notices the change, it destroys the old datapath (which wasn’t
    fully created anyway) and it creates the new one.

    A simpler way of accomplishing the same goal is to use
    ``ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev’'
    which updates the database in a single transaction.    

> Also, I would like to understand the architecture of OVS in kernel space vs the one in userspace. Is there any links/document to understand what goes behind the hood.
> 

The PORTING.md document in the source tree should provide a good
introduction to the OVS architecture
(https://github.com/openvswitch/ovs/blob/master/PORTING.md).

Hope this helps,

Daniele

From sharmila.radhakrishnan at intel.com  Tue Mar 17 08:27:04 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Tue, 17 Mar 2015 15:27:04 +0000
Subject: [ovs-discuss] Issue in added bridge in OVS-DPDK build
In-Reply-To: <AA6F0E16-A6B0-4FC4-8325-92D02F83ADC6@vmware.com>
References: <1BA01C3192A665469272B2597052DDFF56EB1F2D@BGSMSX104.gar.corp.intel.com>
 <37FB3C56-4761-4AF9-A66C-C25ACA9F083C@vmware.com>
 <1BA01C3192A665469272B2597052DDFF56EB1FA5@BGSMSX104.gar.corp.intel.com>
 <AA6F0E16-A6B0-4FC4-8325-92D02F83ADC6@vmware.com>
Message-ID: <1BA01C3192A665469272B2597052DDFF56EB3027@BGSMSX104.gar.corp.intel.com>

Hi Daniele,
Thanks! That was really informative.

Thanks,
Sharmila

-----Original Message-----
From: Daniele Di Proietto [mailto:diproiettod at vmware.com] 
Sent: Tuesday, March 17, 2015 8:39 PM
To: Radhakrishnan, Sharmila
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Issue in added bridge in OVS-DPDK build


> On 17 Mar 2015, at 13:49, Radhakrishnan, Sharmila <sharmila.radhakrishnan at intel.com> wrote:
> 
> Hi Daniele,
> 
> I went through e OVS installation in userspace. In the Userspace install it is given, we install everything except the kernel modules and the add the bridges using the below commands:
> 
> ovs-vsctl add-br br0
> ovs-vsctl set bridge br0 datapath_type=netdev ovs-vsctl add-port br0 
> eth0 ovs-vsctl add-port br0 eth1 ovs-vsctl add-port br0 eth2
> 
> 
> 
> In the above commands, the first command fails for me again(you have pointed out about the kernel module not being there). Does that mean we need to install the kernel module too in the Userspace mode?
> 
> Also, in the installation of the plain OVS document, it is mentioned that installing kernel modules is optional. Shouldn’t this be mandatory?
> 

Short answer:
    No, the kernel module is not needed in this case.  To make OVS work with
    DPDK (in particular to add bridges and ports), please follow
    INSTALL.DPDK.md (in particular section “Using the DPDK with ovs-vswitchd”
    point “6. Add bridge & ports”).
    https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md

Long answer:
    ``ovs-vsctl add-br br0’’ adds to the _database_ a bridge backed by a
    “system” datapath.  As soon as the ovs-vswitchd daemon notices the
    change, it tries to create the bridge and the datapath.  It fails
    because the kernel module it’s not loaded but it doesn’t delete
    anything from the database.
    ``ovs-vsctl set bridge br0 datapath_type=netdev'’ sets the
    appropriate datapath_type in the _database_.  As soon as the ovs-vswitchd
    daemon notices the change, it destroys the old datapath (which wasn’t
    fully created anyway) and it creates the new one.

    A simpler way of accomplishing the same goal is to use
    ``ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev’'
    which updates the database in a single transaction.    

> Also, I would like to understand the architecture of OVS in kernel space vs the one in userspace. Is there any links/document to understand what goes behind the hood.
> 

The PORTING.md document in the source tree should provide a good
introduction to the OVS architecture
(https://github.com/openvswitch/ovs/blob/master/PORTING.md).

Hope this helps,

Daniele

From zhangchen9211 at 126.com  Mon Mar 16 18:34:31 2015
From: zhangchen9211 at 126.com (=?utf-8?B?5byg5pmo?=)
Date: Tue, 17 Mar 2015 09:34:31 +0800 (CST)
Subject: [ovs-discuss] what indirects the flow entry with the same
 priority and match fields to be selected in ovs?
In-Reply-To: <A96EDB3F-F28A-4247-8707-7D4C6590042A@nicira.com>
References: <64e6a66a.9562.14c217f8527.Coremail.zhangchen9211@126.com>
 <A96EDB3F-F28A-4247-8707-7D4C6590042A@nicira.com>
Message-ID: <5eee5427.1cd7.14c255e2f0d.Coremail.zhangchen9211@126.com>

thx for your kind reply!<br/>While, i know that the openflow spec states it undefined, but how does ovs implement it?<br/>And using the priority explicitly seems like a dumb way in CIDR, isn't it?
At 2015-03-17 00:07:03, "Justin Pettit" <jpettit at nicira.com> wrote:
>
>> On Mar 16, 2015, at 12:32 AM, 张晨 <zhangchen9211 at 126.com> wrote:
>> 
>> hello, dear all!
>> 
>> Openflow spec doesn't specify how to direct flow entry with the same priority and match fields to be selected. For example, i have an entry for 1.0.0.0/24, and another for 1.0.0.1/32 with all the other fields the same(priority same, too), how should these two entry be selected in ovs? Apparently, i hope the second to be matched. Or only the priority field could save me?
>
>The OpenFlow spec explicitly states that it's undefined:
>
>    If there are multiple matching flow entries with the same highest priority, the selected flow entry is explicitly undefined.
>
>I wouldn't make assumption about how OVS chooses one, so just make it explicit by setting priorities.
>
>--Justin
>
>

From dsingh at merunetworks.com  Mon Mar 16 23:55:33 2015
From: dsingh at merunetworks.com (Deepak Singh)
Date: Tue, 17 Mar 2015 06:55:33 +0000
Subject: [ovs-discuss] we have output action ,
	why are we usnig actions as IN_PORT ?
Message-ID: <D68445AEE938844D8378F38C93C02D170F1A2B86@STAR.merunetworks.com>

Hi,

In xlate_output_action we have one special case OFPP_IN_PORT . Why are we using this case ?
What will be the problem if we will use output as actions on the same port from which packets come in?

Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150317/714ea398/attachment-0001.html>

From amer7777 at hotmail.com  Tue Mar 17 11:09:31 2015
From: amer7777 at hotmail.com (Amer)
Date: Tue, 17 Mar 2015 21:09:31 +0300
Subject: [ovs-discuss] Persistent Address on OVS Bridge
In-Reply-To: <CAHbON5p3=atKUb8zTgjbdmHGqDVbzfAt1c1=JR-dJS_WzCpa2w@mail.gmail.com>
References: <CAMvhsDadzxMbYPfPCh1O6XRreLgV2wpcu3_UKSfpFBP7jv5XhA@mail.gmail.com>
 <CAHbON5p3=atKUb8zTgjbdmHGqDVbzfAt1c1=JR-dJS_WzCpa2w@mail.gmail.com>
Message-ID: <BLU436-SMTP184549F93975E9D0A77DCCAD4030@phx.gbl>

Thank you
I am facing same problems and I thing the next question will be:
How to make the OVS-bridge br0
a gateway for hosts that are connected to it. For example if we have 4 hosts connected to the OVS-bridge br0 and the bridge connect to a network, as usual, 
is the following configuration correct
1
iface br1 inet static
    address 192.168.1.1
    netmask 255.255.255.0
    ovs_type OVSBridge
    ovs_ports eth0 eth1 eth2 eth4

allow-br0 eth0
iface eth0 inet manual
    ovs_bridge br0
    ovs_type OVSPort

allow-br0 eth1
iface eth1 inet manual
    ovs_bridge br0
    ovs_type OVSPort

allow-br0 eth2
iface eth0 inet manual
    ovs_bridge br0
    ovs_type OVSPort

allow-br0 eth3
iface eth1 inet manual
    ovs_bridge br0
    ovs_type OVSPort

> And the br0 IP as a gateway to the hosts.

Best regards,
Amer


‏‫من جهاز الـ iPhone الخاص بي‬

‫في ٢٦ جما١، ١٤٣٦ هـ، الساعة ٥:٣٥ م، كتب ‏Gurucharan Shetty ‏<shettyg at nicira.com>:‬

> On Tue, Mar 17, 2015 at 6:10 AM, Kyle Fazzari
> <openvswitch at status.e4ward.com> wrote:
>> Hello all.
>> 
>> This may be a bit of a newbie question, for which I apologize. When I
>> originally created my bridge with ovs-vsctl, I lost network
>> connectivity. I quickly found this:
>> http://openvswitch.org/pipermail/discuss/2014-April/013598.html , and
>> simply setting the address on br0 worked fine.
>> 
>> However, I want this to happen at boot time. I'm on Ubuntu 14.04. From
>> what I've read, it sounds like OVS maintains its own database, which
>> explains why after running
>> 
>>    ovs-vsctl add-br br0
>>    ovs-vsctl add-port br0 eth0
>> 
>> when I reboot, br0 still exists.
> correct.
> 
>> However, I'd like br0 to have an
>> address when it comes back up. If it was a regular interface obviously
>> I'd put this information in /etc/network/interfaces, but it's not.
>> However, I've seen articles like this
>> (http://www.opencloudblog.com/?p=240) that imply that I could
>> configure this all via /etc/network/interfaces, but I didn't do it
>> that way initially and now my database already has the bridge defined.
> Official information about using 'interfaces' in section "Debian
> network scripts integration":
> https://github.com/openvswitch/ovs/blob/master/debian/openvswitch-switch.README.Debian
> 
> 
> If I remember correctly, rebooting after 'interfaces' populated
> properly with the bridge already created may not be a problem. If it
> is a problem, delete your bridge. If you worry about loosing network
> connectivity, change the ip address back to eth0 in the same line as
> the del-br command.
> 
> You can also test your changes to interfaces with
> (ifup --allow=ovs $list_of_bridges, ifdown --allow=ovs $list_of_bridges)
> 
> 
>> 
>> What do I do? I just want to specify a static IP address for br0 when
>> it comes up at boot, whether it's in my /etc/network/interfaces or
>> not.
>> 
>> Thank you!
>> 
>> Kyle
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150317/554dea1d/attachment.html>

From pg201372016 at iitj.ac.in  Tue Mar 17 11:25:13 2015
From: pg201372016 at iitj.ac.in (Sumit Paliwal)
Date: Tue, 17 Mar 2015 23:55:13 +0530
Subject: [ovs-discuss] Priority of flows in openvswitch code
Message-ID: <CAEhKQHJ0uKFQyLPt4Prsj2y2UhbiJno+QGdbHF75O1Q1YCmYow@mail.gmail.com>

Hello everyone,

I'm trying to access the priorities of flows while inserting into flow
table in openvswitch. I'm using the linux implementation of datapath.
If anyone knows from where in code it is accessible, let me know.

Right now, In datapath/flow_table.c , in ovs_flow_tbl_insert function, I've
written these printk statements,
printk("The flow priorities accessible from struct sw_flow is : - %x , %x ,
%x, %x \n",mask->key.phy.priority, flow->unmasked_key.phy.priority,
flow->key.phy.priority, flow->mask->key.phy.priority);


The output that I got is :-
The flow priorities accessible from struct sw_flow is : -
ffffffff,0,0,4294967295


I'm passing the priority value 55555 from pox controller and the flows
shows the same 55555 priority with ovs-ofctl command. It's just that how is
it stored in data structure and from where i can access it.

It would be of really great help, if anyone could tell me about this.

Thanks & Regards,
-- 
Sumit Paliwal
M.Tech. ICT,
IIT Jodhpur


*"Have a great Day... "*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150317/e7f0bea9/attachment.html>

From blp at nicira.com  Tue Mar 17 11:33:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Mar 2015 11:33:20 -0700
Subject: [ovs-discuss] Priority of flows in openvswitch code
In-Reply-To: <CAEhKQHJ0uKFQyLPt4Prsj2y2UhbiJno+QGdbHF75O1Q1YCmYow@mail.gmail.com>
References: <CAEhKQHJ0uKFQyLPt4Prsj2y2UhbiJno+QGdbHF75O1Q1YCmYow@mail.gmail.com>
Message-ID: <20150317183320.GJ11929@nicira.com>

On Tue, Mar 17, 2015 at 11:55:13PM +0530, Sumit Paliwal wrote:
> I'm trying to access the priorities of flows while inserting into flow
> table in openvswitch. I'm using the linux implementation of datapath.
> If anyone knows from where in code it is accessible, let me know.

Kernel flows don't have a priority.

From blp at nicira.com  Tue Mar 17 11:37:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Mar 2015 11:37:03 -0700
Subject: [ovs-discuss] new version about ovs wildcard match
In-Reply-To: <CAN2QyzYOHRYD3WqBS7ydmbOLcnwXk3Ld+8sFDHQsOo9WL1s7VQ@mail.gmail.com>
References: <CAN2QyzYOHRYD3WqBS7ydmbOLcnwXk3Ld+8sFDHQsOo9WL1s7VQ@mail.gmail.com>
Message-ID: <20150317183703.GL11929@nicira.com>

On Mon, Mar 16, 2015 at 04:37:55PM +0800, Vinllen Chen wrote:
>     I heard that the new version ovs put the wildcard match into the
> kernel. Is there exist any documents  which i can follow to understanding
> the key matching process and how much the performance has been improved.

We will publish a paper in NSDI in May with this information.  If you
want to read it, contact me off-list for a preprint.

From pg201372016 at iitj.ac.in  Tue Mar 17 11:41:36 2015
From: pg201372016 at iitj.ac.in (Sumit Paliwal)
Date: Wed, 18 Mar 2015 00:11:36 +0530
Subject: [ovs-discuss] Priority of flows in openvswitch code
In-Reply-To: <20150317183320.GJ11929@nicira.com>
References: <CAEhKQHJ0uKFQyLPt4Prsj2y2UhbiJno+QGdbHF75O1Q1YCmYow@mail.gmail.com>
 <20150317183320.GJ11929@nicira.com>
Message-ID: <CAEhKQHLdT8a6jyYtnYmvC9WEbL1O9y5kS7LxpfB=rWUDEPtV5w@mail.gmail.com>

Thanks for the reply, and
(1) if I have to differentiate two flows having same source and destination
but different next hop, on which value I can?
(2) when i'm using the ovs-ofctl dump-flows s1 command, it shows the
priority of flows as 55555, which I've sent from the controller. So it
means, it have stored it somewhere, right!!. While compiling I'm using the
"./configure --with-linux=/lib/modules/`uname -r`/build " , so i've taken
care that it is a kernel implementation in the system. Then Why is the
priority reflected overthere.
(3) In sw_flow_key structure, it has a "u32 priority" variable declared,
what is that used for?

Kindly explain these, I'm really stuck at this problem and want to have a
clear idea about it.

Thanks & Regards,

On Wed, Mar 18, 2015 at 12:03 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Mar 17, 2015 at 11:55:13PM +0530, Sumit Paliwal wrote:
> > I'm trying to access the priorities of flows while inserting into flow
> > table in openvswitch. I'm using the linux implementation of datapath.
> > If anyone knows from where in code it is accessible, let me know.
>
> Kernel flows don't have a priority.
>



-- 
Sumit Paliwal
M.Tech. ICT,
IIT Jodhpur


*"Have a great Day... "*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/66286590/attachment.html>

From blp at nicira.com  Tue Mar 17 11:43:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Mar 2015 11:43:04 -0700
Subject: [ovs-discuss] Priority of flows in openvswitch code
In-Reply-To: <CAEhKQHLdT8a6jyYtnYmvC9WEbL1O9y5kS7LxpfB=rWUDEPtV5w@mail.gmail.com>
References: <CAEhKQHJ0uKFQyLPt4Prsj2y2UhbiJno+QGdbHF75O1Q1YCmYow@mail.gmail.com>
 <20150317183320.GJ11929@nicira.com>
 <CAEhKQHLdT8a6jyYtnYmvC9WEbL1O9y5kS7LxpfB=rWUDEPtV5w@mail.gmail.com>
Message-ID: <20150317184304.GO11929@nicira.com>

On Wed, Mar 18, 2015 at 12:11:36AM +0530, Sumit Paliwal wrote:
> (1) if I have to differentiate two flows having same source and destination
> but different next hop, on which value I can?

What?

> (2) when i'm using the ovs-ofctl dump-flows s1 command, it shows the
> priority of flows as 55555, which I've sent from the controller. So it
> means, it have stored it somewhere, right!!. While compiling I'm using the
> "./configure --with-linux=/lib/modules/`uname -r`/build " , so i've taken
> care that it is a kernel implementation in the system. Then Why is the
> priority reflected overthere.

The priority is not stored in the kernel, so you will not have any
luck looking for it there.

> (3) In sw_flow_key structure, it has a "u32 priority" variable declared,
> what is that used for?

As the comment says, it is a QoS priority.

From pg201372016 at iitj.ac.in  Tue Mar 17 11:55:42 2015
From: pg201372016 at iitj.ac.in (Sumit Paliwal)
Date: Wed, 18 Mar 2015 00:25:42 +0530
Subject: [ovs-discuss] Priority of flows in openvswitch code
In-Reply-To: <20150317184304.GO11929@nicira.com>
References: <CAEhKQHJ0uKFQyLPt4Prsj2y2UhbiJno+QGdbHF75O1Q1YCmYow@mail.gmail.com>
 <20150317183320.GJ11929@nicira.com>
 <CAEhKQHLdT8a6jyYtnYmvC9WEbL1O9y5kS7LxpfB=rWUDEPtV5w@mail.gmail.com>
 <20150317184304.GO11929@nicira.com>
Message-ID: <CAEhKQHL1NA=wOX4Vb7nkR1cGNymiSP=KZ1GLzW0MHwxRgfFeOw@mail.gmail.com>

(1) I want to know that, I'm sending two different paths for one
destination from controller to switch, I've set different priorities for
both of them, and I could see those flows properly inserted in the flow
table with ofctl command. But now if it is not possible to access the
priority from kernel, from where can i access that.
or
Is there any else parameter that i can use to differentiate these 2 flows
from kernel.

On Wed, Mar 18, 2015 at 12:13 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Mar 18, 2015 at 12:11:36AM +0530, Sumit Paliwal wrote:
> > (1) if I have to differentiate two flows having same source and
> destination
> > but different next hop, on which value I can?
>
> What?
>
> > (2) when i'm using the ovs-ofctl dump-flows s1 command, it shows the
> > priority of flows as 55555, which I've sent from the controller. So it
> > means, it have stored it somewhere, right!!. While compiling I'm using
> the
> > "./configure --with-linux=/lib/modules/`uname -r`/build " , so i've taken
> > care that it is a kernel implementation in the system. Then Why is the
> > priority reflected overthere.
>
> The priority is not stored in the kernel, so you will not have any
> luck looking for it there.
>
> > (3) In sw_flow_key structure, it has a "u32 priority" variable declared,
> > what is that used for?
>
> As the comment says, it is a QoS priority.
>



-- 
Sumit Paliwal
M.Tech. ICT,
IIT Jodhpur


*"Have a great Day... "*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/d02a6c7e/attachment.html>

From blp at nicira.com  Tue Mar 17 12:38:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Mar 2015 12:38:32 -0700
Subject: [ovs-discuss] Priority of flows in openvswitch code
In-Reply-To: <CAEhKQHL1NA=wOX4Vb7nkR1cGNymiSP=KZ1GLzW0MHwxRgfFeOw@mail.gmail.com>
References: <CAEhKQHJ0uKFQyLPt4Prsj2y2UhbiJno+QGdbHF75O1Q1YCmYow@mail.gmail.com>
 <20150317183320.GJ11929@nicira.com>
 <CAEhKQHLdT8a6jyYtnYmvC9WEbL1O9y5kS7LxpfB=rWUDEPtV5w@mail.gmail.com>
 <20150317184304.GO11929@nicira.com>
 <CAEhKQHL1NA=wOX4Vb7nkR1cGNymiSP=KZ1GLzW0MHwxRgfFeOw@mail.gmail.com>
Message-ID: <20150317193832.GQ11929@nicira.com>

On Wed, Mar 18, 2015 at 12:25:42AM +0530, Sumit Paliwal wrote:
> (1) I want to know that, I'm sending two different paths for one
> destination from controller to switch, I've set different priorities for
> both of them, and I could see those flows properly inserted in the flow
> table with ofctl command. But now if it is not possible to access the
> priority from kernel, from where can i access that.

ovs-ofctl or another OpenFlow controller can see the priorities.

> Is there any else parameter that i can use to differentiate these 2 flows
> from kernel.

If the flows have the same flow match, then only the higher-priority
one will ever get installed in the kernel, so you can always know
that's the one.

From mauriciovasquezbernal at gmail.com  Tue Mar 17 12:46:54 2015
From: mauriciovasquezbernal at gmail.com (=?UTF-8?Q?Mauricio_V=C3=A1squez?=)
Date: Tue, 17 Mar 2015 20:46:54 +0100
Subject: [ovs-discuss] kernel data-path CPU usage
Message-ID: <CAPwdgqh+++jQZSq929hW6eM1SDa1YJPV5RbugkZ6S1CJfaA=bw@mail.gmail.com>

Hi everybody,

I'm running some experiments to try to understand the CPU consumption of
OVS, specifically I want to understand how much CPU does the kernel module
consumes. In order to test it I created two virtual machines using KVM as
hypervisor and connected them through openvswitch, then I executed a
network throughput test using iperf (client in one VM and server in the
another one).

After it, I ran a tool like top or htop to look how much cpu was using each
process/thread, surprisingly for me the only threads that were consuming
cpu where the vcpus (almost 100% of a core each one) of the vms and the
vhost worker threads (60 - 70% of a core), there not were any threads
related to OVS.

To confirm the results I decided to run a test without virtual machines, so
I created a bridge and added two internal ports, I assigned each of them
to  a different network namespace and run a test with iperf, in this case
the only threads that were consuming CPU were the threads related to iperf,
once again I did not see anything related to OVS.

Finally, We ran a test with two pcs, each of them with two 10G NICs, one PC
was used as traffic generator meanwhile the another one was using OVS to
make a bridge between the two NICs, in the pc with OVS we found that there
was a process called ksoftirqd what was using 100% of a core, once again
there were not anything related to ovs.

So, the question is, where is the dapa-path module executed? I mean, In
which thread?

Thank you very much for your help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150317/31604de6/attachment.html>

From tim at aliens.wtf  Tue Mar 17 12:50:43 2015
From: tim at aliens.wtf (Tim)
Date: Tue, 17 Mar 2015 14:50:43 -0500
Subject: [ovs-discuss] Additional arguments when starting ovsdb-server
Message-ID: <1426621843.4121807.241688293.4D791973@webmail.messagingengine.com>

I'm currently playing with OVS 2.3.1 LTS on Cent7 and I'm trying to pass
additional arguments to ovsdb-server at runtime, and I currently don't
see any way to do that. I can kill -15 the process after start up, and
re-run it with the options I want, but that seems barbaric.

The only option related to ovsdb-server that I see is in
/etc/sysconfig/openvswitch but it seems to only relate to the nice
priority, and the /etc/rc.d/init.d/openvswitch script seems to only care
about setting that value when ran.

Is there a way to go about this sanely?

From shettyg at nicira.com  Tue Mar 17 13:08:50 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 17 Mar 2015 13:08:50 -0700
Subject: [ovs-discuss] Persistent Address on OVS Bridge
In-Reply-To: <BLU436-SMTP184549F93975E9D0A77DCCAD4030@phx.gbl>
References: <CAMvhsDadzxMbYPfPCh1O6XRreLgV2wpcu3_UKSfpFBP7jv5XhA@mail.gmail.com>
 <CAHbON5p3=atKUb8zTgjbdmHGqDVbzfAt1c1=JR-dJS_WzCpa2w@mail.gmail.com>
 <BLU436-SMTP184549F93975E9D0A77DCCAD4030@phx.gbl>
Message-ID: <CAHbON5pu5f7XujBcXH+47VsGtiDyM6yt-H9AcpdBOQQobXew=Q@mail.gmail.com>

On Tue, Mar 17, 2015 at 11:09 AM, Amer <amer7777 at hotmail.com> wrote:
> Thank you
> I am facing same problems and I thing the next question will be:
> How to make the OVS-bridge br0
> a gateway for hosts that are connected to it. For example if we have 4 hosts
> connected to the OVS-bridge br0 and the bridge connect to a network, as
> usual,
> is the following configuration correct
The below configuration looks correct and should create br1 and add
the ethX ports to it.
I do not understand all the requirements of your 'make the OVS-bridge
br0  a gateway for hosts that are connected to it' use case to comment
on how well it will work.


>
> 1
> iface br1 inet static
>     address 192.168.1.1
>     netmask 255.255.255.0
>     ovs_type OVSBridge
>     ovs_ports eth0 eth1 eth2 eth4
>
> allow-br0 eth0
> iface eth0 inet manual
>     ovs_bridge br0
>     ovs_type OVSPort
>
> allow-br0 eth1
> iface eth1 inet manual
>     ovs_bridge br0
>     ovs_type OVSPort
>
> allow-br0 eth2
> iface eth0 inet manual
>     ovs_bridge br0
>     ovs_type OVSPort
>
> allow-br0 eth3
> iface eth1 inet manual
>     ovs_bridge br0
>     ovs_type OVSPort
>
> And the br0 IP as a gateway to the hosts.
>
>
> Best regards,
> Amer
>
>
>
> ‏‫من جهاز الـ iPhone الخاص بي‬
>
> ‫في ٢٦ جما١، ١٤٣٦ هـ، الساعة ٥:٣٥ م، كتب ‏Gurucharan Shetty
> ‏<shettyg at nicira.com>:‬
>
> On Tue, Mar 17, 2015 at 6:10 AM, Kyle Fazzari
> <openvswitch at status.e4ward.com> wrote:
>
> Hello all.
>
>
> This may be a bit of a newbie question, for which I apologize. When I
>
> originally created my bridge with ovs-vsctl, I lost network
>
> connectivity. I quickly found this:
>
> http://openvswitch.org/pipermail/discuss/2014-April/013598.html , and
>
> simply setting the address on br0 worked fine.
>
>
> However, I want this to happen at boot time. I'm on Ubuntu 14.04. From
>
> what I've read, it sounds like OVS maintains its own database, which
>
> explains why after running
>
>
>    ovs-vsctl add-br br0
>
>    ovs-vsctl add-port br0 eth0
>
>
> when I reboot, br0 still exists.
>
> correct.
>
> However, I'd like br0 to have an
>
> address when it comes back up. If it was a regular interface obviously
>
> I'd put this information in /etc/network/interfaces, but it's not.
>
> However, I've seen articles like this
>
> (http://www.opencloudblog.com/?p=240) that imply that I could
>
> configure this all via /etc/network/interfaces, but I didn't do it
>
> that way initially and now my database already has the bridge defined.
>
> Official information about using 'interfaces' in section "Debian
> network scripts integration":
> https://github.com/openvswitch/ovs/blob/master/debian/openvswitch-switch.README.Debian
>
>
> If I remember correctly, rebooting after 'interfaces' populated
> properly with the bridge already created may not be a problem. If it
> is a problem, delete your bridge. If you worry about loosing network
> connectivity, change the ip address back to eth0 in the same line as
> the del-br command.
>
> You can also test your changes to interfaces with
> (ifup --allow=ovs $list_of_bridges, ifdown --allow=ovs $list_of_bridges)
>
>
>
> What do I do? I just want to specify a static IP address for br0 when
>
> it comes up at boot, whether it's in my /etc/network/interfaces or
>
> not.
>
>
> Thank you!
>
>
> Kyle
>
> _______________________________________________
>
> discuss mailing list
>
> discuss at openvswitch.org
>
> http://openvswitch.org/mailman/listinfo/discuss
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Tue Mar 17 13:13:23 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Mar 2015 13:13:23 -0700
Subject: [ovs-discuss] kernel data-path CPU usage
In-Reply-To: <CAPwdgqh+++jQZSq929hW6eM1SDa1YJPV5RbugkZ6S1CJfaA=bw@mail.gmail.com>
References: <CAPwdgqh+++jQZSq929hW6eM1SDa1YJPV5RbugkZ6S1CJfaA=bw@mail.gmail.com>
Message-ID: <20150317201323.GW11929@nicira.com>

On Tue, Mar 17, 2015 at 08:46:54PM +0100, Mauricio V??squez wrote:
> Finally, We ran a test with two pcs, each of them with two 10G NICs, one PC
> was used as traffic generator meanwhile the another one was using OVS to
> make a bridge between the two NICs, in the pc with OVS we found that there
> was a process called ksoftirqd what was using 100% of a core, once again
> there were not anything related to ovs.
> 
> So, the question is, where is the dapa-path module executed? I mean, In
> which thread?

The datapath doesn't have any threads, it runs in softirqs to process
packets as they arrive.

From blp at nicira.com  Tue Mar 17 13:16:33 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Mar 2015 13:16:33 -0700
Subject: [ovs-discuss] Additional arguments when starting ovsdb-server
In-Reply-To: <1426621843.4121807.241688293.4D791973@webmail.messagingengine.com>
References: <1426621843.4121807.241688293.4D791973@webmail.messagingengine.com>
Message-ID: <20150317201633.GX11929@nicira.com>

On Tue, Mar 17, 2015 at 02:50:43PM -0500, Tim wrote:
> I'm currently playing with OVS 2.3.1 LTS on Cent7 and I'm trying to pass
> additional arguments to ovsdb-server at runtime, and I currently don't
> see any way to do that. I can kill -15 the process after start up, and
> re-run it with the options I want, but that seems barbaric.
> 
> The only option related to ovsdb-server that I see is in
> /etc/sysconfig/openvswitch but it seems to only relate to the nice
> priority, and the /etc/rc.d/init.d/openvswitch script seems to only care
> about setting that value when ran.
> 
> Is there a way to go about this sanely?

It doesn't normally make sense to "pass additional arguments to
ovsdb-server at runtime".  What are you trying to accomplish?

From chris at picton.nom.za  Tue Mar 17 13:17:03 2015
From: chris at picton.nom.za (Chris Picton)
Date: Tue, 17 Mar 2015 22:17:03 +0200
Subject: [ovs-discuss] OVS not forwarding packets to port
Message-ID: <55088BBF.6080001@picton.nom.za>

Hi list

I have been using openvswitch very basically for a while, and am 
experiencing a problem (which surfaced after an upgrade from version 
1.2.2.10448 to 2.3.0) which only happens intermittently, often after 
migrating VMs or restarting VMS.

I have a KVM server running centos6, openvswitch 2.3.0  I have an issue 
where two VMs, both with interfaces tagged with vlan 3 are behaving 
differently.  OVS forwards packets to vm2, but not vm1.

When I ping from the guests to an external host (to initiate ARP 
packets), I see the following traffic flows.  Below, I am tcpdumping on 
the tap interface, the bond (bondV) connecting to a physical switch, and 
the destination physical server.

Non-working guest vm1 (host tap interface vnet0, attached to ovs with tag=3)
ovs vnet0: 21:40:06.853187 52:54:00:14:54:c6 > ff:ff:ff:ff:ff:ff, 
ethertype ARP (0x0806), length 42: Request who-has 10.202.3.250 tell 
10.202.3.201, length 28
ovs bondV: 21:40:06.853200 52:54:00:14:54:c6 > ff:ff:ff:ff:ff:ff, 
ethertype 802.1Q (0x8100), length 46: vlan 3, p 0, ethertype ARP, 
Request who-has 10.202.3.250 tell 10.202.3.201, length 28
phys vlan3: 21:40:06.859649 52:54:00:14:54:c6 > ff:ff:ff:ff:ff:ff, 
ethertype ARP (0x0806), length 56: arp who-has 10.202.3.250 tell 
10.202.3.201
phys vlan3: 21:40:06.859656 00:15:17:91:05:4c > 52:54:00:14:54:c6, 
ethertype ARP (0x0806), length 42: arp reply 10.202.3.250 is-at 
00:15:17:91:05:4c
ovs bondV: 21:40:06.853285 00:15:17:91:05:4c > 52:54:00:14:54:c6, 
ethertype 802.1Q (0x8100), length 60: vlan 3, p 0, ethertype ARP, Reply 
10.202.3.250 is-at 00:15:17:91:05:4c, length 42
ovs vnet0: NOTHING

Working guest vm2 (host tap interface veth-carbon1-3, attached to ovs 
with tag=3)
ovs veth-carbon1-3:  21:54:12.611041 52:54:00:60:29:8c > 
ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 42: Request who-has 
10.202.3.250 tell 10.202.3.91, length 28
ovs bondV: 21:54:12.611100 52:54:00:60:29:8c > ff:ff:ff:ff:ff:ff, 
ethertype 802.1Q (0x8100), length 46: vlan 3, p 0, ethertype ARP, 
Request who-has 10.202.3.250 tell 10.202.3.91, length 28
phys vlan3: 21:54:12.606258 52:54:00:60:29:8c > ff:ff:ff:ff:ff:ff, 
ethertype ARP (0x0806), length 56: arp who-has 10.202.3.250 tell 10.202.3.91
phys vlan3: 21:54:12.606264 00:15:17:91:05:4c > 52:54:00:60:29:8c, 
ethertype ARP (0x0806), length 42: arp reply 10.202.3.250 is-at 
00:15:17:91:05:4c
ovs bondV: 21:54:12.611189 00:15:17:91:05:4c > 52:54:00:60:29:8c, 
ethertype 802.1Q (0x8100), length 60: vlan 3, p 0, ethertype ARP, Reply 
10.202.3.250 is-at 00:15:17:91:05:4c, length 42
ovs veth-carbon1-3: 21:54:12.611242 00:15:17:91:05:4c > 
52:54:00:60:29:8c, ethertype ARP (0x0806), length 56: Reply 10.202.3.250 
is-at 00:15:17:91:05:4c, length 42

At layer3, I can use the 'ip route get *' commands to determine how the 
kernel will route a packet.  Is there any equivalent command to inspect 
the ovs behaviour.  I would like to ask ovs: 'If I send a packet with 
src mac 00:15:17:91:05:4c which came in on interface bondV tagged with 
vlan 3, destined to mac 52:54:00:60:29:8c, what port would it be 
forwarded to?'

I can see from the outputs below that the mac table is correct, and the 
mac address of vm1 is on ovs port 6, which is vnet0, which is the 
correct interface.  What else can I use to troubleshoot why the arp 
replies are actually not forwarding to vnet0?

Many Thanks

Chris


  # ovs-appctl fdb/show vbr0 | egrep 
'port|00:15:17:91:05:4c|52:54:00:14:54:c6|52:54:00:60:29:8c'
  port  VLAN  MAC                Age
     1     3  00:15:17:91:05:4c    1
     1     4  00:15:17:91:05:4c    1
     6     3  52:54:00:14:54:c6    1
     5     3  52:54:00:60:29:8c    1
     1     1  00:15:17:91:05:4c    0

# ovs-ofctl show vbr0 | sed -n '/^[^ ]/p; 
/\(vbr0\|vnet0\|veth-car\|bondV\)/,/speed/p'
OFPT_FEATURES_REPLY (xid=0x2): dpid:0000782bcb5ab160
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC 
SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
  1(bondV): addr:78:2b:cb:5a:b1:60
      config:     0
      state:      0
      current:    1GB-FD
      speed: 1000 Mbps now, 0 Mbps max
  5(veth-carbon1-3): addr:fe:54:00:60:29:8c
      config:     0
      state:      0
      current:    10MB-FD COPPER
      speed: 10 Mbps now, 0 Mbps max
  6(vnet0): addr:fe:54:00:14:54:c6
      config:     0
      state:      0
      current:    10MB-FD COPPER
      speed: 10 Mbps now, 0 Mbps max
  LOCAL(vbr0): addr:78:2b:cb:5a:b1:60
      config:     0
      state:      0
      speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0

# I have removed many ports below which are not relevant to this problem
  # ovs-vsctl show
435fb9ac-5b13-4204-ad4a-e726aa5cd06b
     Bridge "vbr0"
         Port "vbr0"
             Interface "vbr0"
                 type: internal
         Port "vnet0"
             tag: 3
             Interface "vnet0"
         Port bondV
             Interface bondV
         Port "vlan1"
             tag: 1
             Interface "vlan1"
                 type: internal
         Port "veth-carbon1-3"
             tag: 3
             Interface "veth-carbon1-3"
     ovs_version: "2.3.0"



From blp at nicira.com  Tue Mar 17 13:21:56 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Mar 2015 13:21:56 -0700
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <55088BBF.6080001@picton.nom.za>
References: <55088BBF.6080001@picton.nom.za>
Message-ID: <20150317202156.GZ11929@nicira.com>

On Tue, Mar 17, 2015 at 10:17:03PM +0200, Chris Picton wrote:
> At layer3, I can use the 'ip route get *' commands to determine how
> the kernel will route a packet.  Is there any equivalent command to
> inspect the ovs behaviour.  I would like to ask ovs: 'If I send a
> packet with src mac 00:15:17:91:05:4c which came in on interface
> bondV tagged with vlan 3, destined to mac 52:54:00:60:29:8c, what
> port would it be forwarded to?'

Yes, you can use "ovs-appctl ofproto/trace", please see
ovs-vswitchd(8) for more details.

From tim at aliens.wtf  Tue Mar 17 13:23:01 2015
From: tim at aliens.wtf (Tim)
Date: Tue, 17 Mar 2015 15:23:01 -0500
Subject: [ovs-discuss] Additional arguments when starting ovsdb-server
In-Reply-To: <20150317201633.GX11929@nicira.com>
References: <1426621843.4121807.241688293.4D791973@webmail.messagingengine.com>
 <20150317201633.GX11929@nicira.com>
Message-ID: <1426623781.4128064.241702557.2749CE67@webmail.messagingengine.com>

I'm attempting to add an additional --remote argument to the
ovsdb-server on runtime, so that it not only opens a local unix socket,
but a tcp socket for remote administration. 

----- Original message -----
From: Ben Pfaff <blp at nicira.com>
To: Tim <tim at aliens.wtf>
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Additional arguments when starting
ovsdb-server
Date: Tue, 17 Mar 2015 13:16:33 -0700

On Tue, Mar 17, 2015 at 02:50:43PM -0500, Tim wrote:
> I'm currently playing with OVS 2.3.1 LTS on Cent7 and I'm trying to pass
> additional arguments to ovsdb-server at runtime, and I currently don't
> see any way to do that. I can kill -15 the process after start up, and
> re-run it with the options I want, but that seems barbaric.
> 
> The only option related to ovsdb-server that I see is in
> /etc/sysconfig/openvswitch but it seems to only relate to the nice
> priority, and the /etc/rc.d/init.d/openvswitch script seems to only care
> about setting that value when ran.
> 
> Is there a way to go about this sanely?

It doesn't normally make sense to "pass additional arguments to
ovsdb-server at runtime".  What are you trying to accomplish?

From blp at nicira.com  Tue Mar 17 13:26:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Mar 2015 13:26:02 -0700
Subject: [ovs-discuss] Additional arguments when starting ovsdb-server
In-Reply-To: <1426623781.4128064.241702557.2749CE67@webmail.messagingengine.com>
References: <1426621843.4121807.241688293.4D791973@webmail.messagingengine.com>
 <20150317201633.GX11929@nicira.com>
 <1426623781.4128064.241702557.2749CE67@webmail.messagingengine.com>
Message-ID: <20150317202602.GA11929@nicira.com>

On Tue, Mar 17, 2015 at 03:23:01PM -0500, Tim wrote:
> I'm attempting to add an additional --remote argument to the
> ovsdb-server on runtime, so that it not only opens a local unix socket,
> but a tcp socket for remote administration. 

Use "ovs-appctl -t ovsdb-server ovsdb-server/add-remote <remote>".
See ovsdb-server(1).

From chris at picton.nom.za  Tue Mar 17 14:05:54 2015
From: chris at picton.nom.za (Chris Picton)
Date: Tue, 17 Mar 2015 23:05:54 +0200
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <20150317202156.GZ11929@nicira.com>
References: <55088BBF.6080001@picton.nom.za>
 <20150317202156.GZ11929@nicira.com>
Message-ID: <55089732.9080905@picton.nom.za>

On 2015/03/17 10:21 PM, Ben Pfaff wrote:
> On Tue, Mar 17, 2015 at 10:17:03PM +0200, Chris Picton wrote:
>> At layer3, I can use the 'ip route get *' commands to determine how
>> the kernel will route a packet.  Is there any equivalent command to
>> inspect the ovs behaviour.  I would like to ask ovs: 'If I send a
>> packet with src mac 00:15:17:91:05:4c which came in on interface
>> bondV tagged with vlan 3, destined to mac 52:54:00:60:29:8c, what
>> port would it be forwarded to?'
> Yes, you can use "ovs-appctl ofproto/trace", please see
> ovs-vswitchd(8) for more details.
Thanks for the speedy reply - I get the results as below:

What I can see is that on both cases, OVS says it should be forwarding 
via a datapath and popping the vlan tag.  The datapath for ports 
veth-carbon1-3 (working) and vnet0 (not working) appear to be similar.

Working ofproto/trace action:
Datapath actions: pop_vlan,6

Non-working ofproto/trace action:
Datapath actions: pop_vlan,7

If I run ovs-dpctl dump-flows | grep 0x0806 | egrep 
'52:54:00:60:29:8c|52:54:00:14:54:c6', I get (immediately after dropping 
the arp entry from the working guest):

recirc_id(0),skb_priority(0),in_port(2),eth(src=00:15:17:91:05:4c,dst=52:54:00:14:54:c6),eth_type(0x8100),vlan(vid=3,pcp=0),encap(eth_type(0x0806)), 
packets:2, bytes:120, used:1.669s, actions:pop_vlan,7
recirc_id(0),skb_priority(0),in_port(2),eth(src=00:15:17:91:05:4c,dst=52:54:00:60:29:8c),eth_type(0x8100),vlan(vid=3,pcp=0),encap(eth_type(0x0806)), 
packets:0, bytes:0, used:never, actions:pop_vlan,6

The non-working port's output above entry has "used:never"

My request for help now becomes:

How can I determine why the packets are not appearing on vnet0, when the 
output of the commands below appear to indicate that they should?


The full ofproto/trace commands are below:

Working guest:
  # ovs-appctl ofproto/trace vbr0 "in_port=1" 
52540060298c00151791054c810000030806000108000604000200151791054c0aca03fa52540060298c0aca035b0000000000000000000000000000
Bridge: vbr0
Flow: 
arp,metadata=0,in_port=1,dl_vlan=3,dl_vlan_pcp=0,dl_src=00:15:17:91:05:4c,dl_dst=52:54:00:60:29:8c,arp_spa=10.202.3.250,arp_tpa=10.202.3.91,arp_op=2,arp_sha=00:15:17:91:05:4c,arp_tha=52:54:00:60:29:8c
Rule: table=0 cookie=0 priority=0
OpenFlow actions=NORMAL
forwarding to learned port

Final flow: unchanged
Megaflow: 
recirc_id=0,skb_priority=0,arp,in_port=1,dl_vlan=3,dl_vlan_pcp=0,dl_src=00:15:17:91:05:4c,dl_dst=52:54:00:60:29:8c
Datapath actions: pop_vlan,6




Non-working guest:
ovs-appctl ofproto/trace vbr0 "in_port=1" 
5254001454c600151791054c810000030806000108000604000200151791054c0aca03fa5254001454c60aca03c90000000000000000000000000000
Bridge: vbr0
Flow: 
arp,metadata=0,in_port=1,dl_vlan=3,dl_vlan_pcp=0,dl_src=00:15:17:91:05:4c,dl_dst=52:54:00:14:54:c6,arp_spa=10.202.3.250,arp_tpa=10.202.3.201,arp_op=2,arp_sha=00:15:17:91:05:4c,arp_tha=52:54:00:14:54:c6
Rule: table=0 cookie=0 priority=0
OpenFlow actions=NORMAL
forwarding to learned port

Final flow: unchanged
Megaflow: 
recirc_id=0,skb_priority=0,arp,in_port=1,dl_vlan=3,dl_vlan_pcp=0,dl_src=00:15:17:91:05:4c,dl_dst=52:54:00:14:54:c6
Datapath actions: pop_vlan,7

  # ovs-ofctl dump-flows vbr0
NXST_FLOW reply (xid=0x4):
  cookie=0x0, duration=486871.278s, table=0, n_packets=283716961, 
n_bytes=345708309931, idle_age=0, hard_age=65534, priority=0 actions=NORMAL


  # ovs-appctl dpif/show
system at ovs-system: hit:275109913 missed:8254378
         vbr0:
                 bondV 1/2: (system)
                 vbr0 65534/1: (internal)
                 veth-carbon1-3 5/6: (system)
                 vlan1 2/3: (internal)
                 vlan108 3/4: (internal)
                 vlan109 4/5: (internal)
                 vnet0 6/7: (system)
                 vnet1 7/8: (system)
                 vnet10 16/17: (system)
                 vnet11 17/18: (system)
                 vnet12 18/19: (system)
                 vnet13 19/20: (system)
                 vnet14 20/21: (system)
                 vnet15 21/22: (system)
                 vnet16 22/23: (system)
                 vnet17 23/24: (system)
                 vnet18 24/25: (system)
                 vnet19 25/26: (system)
                 vnet2 8/9: (system)
                 vnet20 26/27: (system)
                 vnet21 27/28: (system)
                 vnet3 9/10: (system)
                 vnet4 10/11: (system)
                 vnet5 11/12: (system)
                 vnet6 12/13: (system)



From blp at nicira.com  Tue Mar 17 16:05:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 17 Mar 2015 16:05:29 -0700
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <55089732.9080905@picton.nom.za>
References: <55088BBF.6080001@picton.nom.za>
 <20150317202156.GZ11929@nicira.com>
 <55089732.9080905@picton.nom.za>
Message-ID: <20150317230529.GR32489@nicira.com>

On Tue, Mar 17, 2015 at 11:05:54PM +0200, Chris Picton wrote:
> On 2015/03/17 10:21 PM, Ben Pfaff wrote:
> >On Tue, Mar 17, 2015 at 10:17:03PM +0200, Chris Picton wrote:
> >>At layer3, I can use the 'ip route get *' commands to determine how
> >>the kernel will route a packet.  Is there any equivalent command to
> >>inspect the ovs behaviour.  I would like to ask ovs: 'If I send a
> >>packet with src mac 00:15:17:91:05:4c which came in on interface
> >>bondV tagged with vlan 3, destined to mac 52:54:00:60:29:8c, what
> >>port would it be forwarded to?'
> >Yes, you can use "ovs-appctl ofproto/trace", please see
> >ovs-vswitchd(8) for more details.
> Thanks for the speedy reply - I get the results as below:
> 
> What I can see is that on both cases, OVS says it should be
> forwarding via a datapath and popping the vlan tag.  The datapath
> for ports veth-carbon1-3 (working) and vnet0 (not working) appear to
> be similar.

Huh.

Check what the kernel actually says it's doing for installed flows,
with "ovs-dpctl dump-flows".

From sbiswas7 at linux.vnet.ibm.com  Tue Mar 17 20:34:38 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Wed, 18 Mar 2015 09:04:38 +0530
Subject: [ovs-discuss] Query on ovs Vxlan setup
In-Reply-To: <0f6cdf1f-74ed-4783-b953-a9a128dcbe9e@inmumzm01.tcsin.com>
References: <0f6cdf1f-74ed-4783-b953-a9a128dcbe9e@inmumzm01.tcsin.com>
Message-ID: <5508F24E.9020905@linux.vnet.ibm.com>


On Tuesday 17 March 2015 06:36 PM, Yogesh Pandey1/HYD/TCS wrote:
> Hi All,
>
> To test NSH feature in ovs (using custom ovs), I am trying to 
> configure VxLan Tunnel between two hypervisors each running one VM 
> using these commands. But whenever I provide an ip to br1 the internet 
> connectivity to my host is lost. Also  Vxlan with nsh shows up in the 
> ovs-vsctl show command but VMs are not able to ping each other on 
> different hosts.
> *
> On Host 1*
> #ovs Setup
> ovs-vsctl add-br br0
> ovs-vsctl add-br br1
> ovs-vsctl add-port br0 eth0
> ifconfig eth0 0 && ifconfig br0 192.168.1.3 netmask 255.255.255.0
> route add default gw 192.168.1.1 br0
> ifconfig br1 10.1.2.10 netmask 255.255.255.0
You haven't added the eth device to br1.
> #configuring VxLan
> sudo ovs-vsctl add-port br1 vxlan1 -- set interface vxlan1 type=vxlan 
> options:remote_ip=192.168.1.4 options:key=0x5000 options:nsp=0x123456 
> options:nsi=44 options:npc=0x22000000 options:nsc=0x33000000 
> options:spc=0x44000000 options:ssc=0x5500000
>
>
ovs-vsctl dump-flows br1 and check if the packet value gets incremented 
when you try pinging the VMs.
> -- 
> Thanks and regards,
> Yogesh Pandey
> Mailto:yogesh.pandey1 at tcs.com
>
> =====-----=====-----=====
> Notice: The information contained in this e-mail
> message and/or attachments to it may contain
> confidential or privileged information. If you are
> not the intended recipient, any dissemination, use,
> review, distribution, printing or copying of the
> information contained in this e-mail message
> and/or attachments to it are strictly prohibited. If
> you have received this communication in error,
> please notify us by reply e-mail or telephone and
> immediately and permanently delete the message
> and any attachments. Thank you
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From yuanfeng1 at huawei.com  Tue Mar 17 23:18:14 2015
From: yuanfeng1 at huawei.com (yuanfeng (A))
Date: Wed, 18 Mar 2015 06:18:14 +0000
Subject: [ovs-discuss] =?gb2312?b?W2hlbHBdU29tZSBxdWVzdGlvbiBhYm91dCBPVlMg?=
 =?gb2312?b?Y29uZmlndXJlKG11bHRpcGF0aKGiYXBwbHkgbm93oaJwcm9yaXR5KaO/?=
Message-ID: <2C54893E2A0C484DA1249B509D857C394DFF937E@SZXEML506-MBS.china.huawei.com>

Hi All,

1.I have a requirement to use OVS multipath function, but i only found the group table with select function can do this, but I don’t want to use group table, is there any other function in flow table can do this too?

Like

ovs-ofctl add-flow br0 dl_vlan=100,actions=multipath…

         2.also, I’ve read the guide and can’t find a flow cmd about apply_now and prority, does the ovs support this OpenFlow1.3 feature now?

Thank you very much~~

PS: My openvswitch version is 2.3.1 as below

[root at localhost openflow]# ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.3.1
Compiled Mar 13 2015 11:09:39
DB Schema 7.6.2


[root at localhost openflow]# ovs-ofctl --version
ovs-ofctl (Open vSwitch) 2.3.1
Compiled Mar 13 2015 11:09:39
OpenFlow versions 0x1:0x4
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/186b3009/attachment-0001.html>

From chris at picton.nom.za  Tue Mar 17 23:47:19 2015
From: chris at picton.nom.za (Chris Picton)
Date: Wed, 18 Mar 2015 08:47:19 +0200
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <20150317230529.GR32489@nicira.com>
References: <55088BBF.6080001@picton.nom.za>
 <20150317202156.GZ11929@nicira.com> <55089732.9080905@picton.nom.za>
 <20150317230529.GR32489@nicira.com>
Message-ID: <55091F77.8060208@picton.nom.za>

On 03/18/15 01:05, Ben Pfaff wrote:
> On Tue, Mar 17, 2015 at 11:05:54PM +0200, Chris Picton wrote:
>> On 2015/03/17 10:21 PM, Ben Pfaff wrote:
>>> On Tue, Mar 17, 2015 at 10:17:03PM +0200, Chris Picton wrote:
>>>> At layer3, I can use the 'ip route get *' commands to determine how
>>>> the kernel will route a packet.  Is there any equivalent command to
>>>> inspect the ovs behaviour.  I would like to ask ovs: 'If I send a
>>>> packet with src mac 00:15:17:91:05:4c which came in on interface
>>>> bondV tagged with vlan 3, destined to mac 52:54:00:60:29:8c, what
>>>> port would it be forwarded to?'
>>> Yes, you can use "ovs-appctl ofproto/trace", please see
>>> ovs-vswitchd(8) for more details.
>> Thanks for the speedy reply - I get the results as below:
>>
>> What I can see is that on both cases, OVS says it should be
>> forwarding via a datapath and popping the vlan tag.  The datapath
>> for ports veth-carbon1-3 (working) and vnet0 (not working) appear to
>> be similar.
> Huh.
>
> Check what the kernel actually says it's doing for installed flows,
> with "ovs-dpctl dump-flows".
Hi Ben

My terminology may not be 100% correct - I am new at this  :)

I has included the output from ovs-dpctl in my previous mail.  The 
relevant flow is:
recirc_id(0),skb_priority(0),in_port(2),eth(src=00:15:17:91:05:4c,dst=52:54:00:14:54:c6),eth_type(0x8100),vlan(vid=3,pcp=0),encap(eth_type(0x0806)), 
packets:2, bytes:120, used:0.014s, actions:pop_vlan,7

I can't find any definitive documentation for an action element 
consisting purely of a number - in this case "7".  If I assume it means 
to forward to a numbered port, then that port does match the correct one 
from "ovs-dpctl show": port 7: vnet0

So the action appears to be correct, but my original problem still 
remains: the packet does not appear on the vnet0 when I run a tcpdump.

Where else should I be looking to try find the culprit here?

# ovs-dpctl show
system at ovs-system:
     lookups: hit:295139464 missed:8880738 lost:0
     flows: 76
     masks: hit:356499657 total:6 hit/pkt:1.17
     port 0: ovs-system (internal)
     port 1: vbr0 (internal)
     port 2: bondV
     port 3: vlan1 (internal)
     port 4: vlan108 (internal)
     port 5: vlan109 (internal)
     port 6: veth-carbon1-3
     port 7: vnet0
     port 8: vnet1
     port 9: vnet2
     port 10: vnet3
     port 11: vnet4
     port 12: vnet5
     port 13: vnet6
     port 17: vnet10
     port 18: vnet11
     port 19: vnet12
     port 20: vnet13
     port 21: vnet14
     port 22: vnet15
     port 23: vnet16
     port 24: vnet17
     port 25: vnet18
     port 26: vnet19
     port 27: vnet20
     port 28: vnet21



From chris at picton.nom.za  Wed Mar 18 03:44:08 2015
From: chris at picton.nom.za (Chris Picton)
Date: Wed, 18 Mar 2015 12:44:08 +0200
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <55091F77.8060208@picton.nom.za>
References: <55088BBF.6080001@picton.nom.za>
 <20150317202156.GZ11929@nicira.com> <55089732.9080905@picton.nom.za>
 <20150317230529.GR32489@nicira.com> <55091F77.8060208@picton.nom.za>
Message-ID: <550956F8.3040001@picton.nom.za>

On 03/18/15 08:47, Chris Picton wrote:
> The relevant flow is:
> recirc_id(0),skb_priority(0),in_port(2),eth(src=00:15:17:91:05:4c,dst=52:54:00:14:54:c6),eth_type(0x8100),vlan(vid=3,pcp=0),encap(eth_type(0x0806)), 
> packets:2, bytes:120, used:0.014s, actions:pop_vlan,7
>
> I can't find any definitive documentation for an action element 
> consisting purely of a number - in this case "7".
I have just re-read the man page, and found the following:
"The  target  may  be  a  decimal  port  number  designating the 
physical port on which to  output the packet."

so the packet should, according to the above, be forwarded to port 7, 
which is vnet0.

However, the packet is not arriving on vnet0.  Any ideas where I can 
look to find out why not?

Thanks
Chris


From stefan at bit.nl  Wed Mar 18 07:35:53 2015
From: stefan at bit.nl (Stefan Kooman)
Date: Wed, 18 Mar 2015 15:35:53 +0100
Subject: [ovs-discuss] gratuitous arp replies on behalf of virtual machine
Message-ID: <20150318143553.GA16479@shell.dmz.bit.nl>

Hi All,

I'm trying to achieve the following: I would like to send gratuitous arp
replies on a OpenvSwitch (tagged) virtual machine (VM) interface (vnet5) from
the host itself (Ubuntu 14.04, OVS 2.0.2) (to update upstream switch(es) their
mac-address-tables after a live-migration of the VM). Therefore I made a little
python script that utilizes Scapy, relevant part:

sendp(Ether(src=args.macaddress,dst="ff:ff:ff:ff:ff:ff") / ARP(op=2,
hwsrc=args.macaddress, psrc=args.ipaddress, hwdst="ff:ff:ff:ff:ff:ff",
pdst="255.255.255.255"), iface=args.vnet, count=4, inter=0.2)

The gratuitous arp replies do come in one the Virtual Machine itself, but never
make it out of the bridge (uplink), bond (bond1) and physical interface(s)
(eth2, eth5): 

Bridge uplink
        Port uplink
            Interface uplink
                type: internal
        Port "bond1"
            trunks: [998, 999]
            Interface "eth5"
            Interface "eth2"
        Port "vnet5"
            tag: 999
            Interface "vnet5"

There are no specific flows active on the "in_port" of vnet5. I have tried an
openflow rule to allow a packet out if its ingress port (ovs-ofctl add-flow
uplink in_port=10,actions=in_port) but to no avail. So basically I can inject
packets into the vnet, but they will not make it out of the vnet. Does
OpenvSwitch filter this somewhere, or is it the linux kernel discarding these
packets?

Thanks for any hints on how to debug this issue.

Kind regards,

Stefan Kooman

P.s. Sending the gratuitous arp replies from the virtual machine itself works
like expected.



-- 
| BIT BV  http://www.bit.nl/        Kamer van Koophandel 09090351
| GPG: 0xD14839C6                   +31 318 648 688 / info at bit.nl
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 230 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/5c6a49a2/attachment.sig>

From mauriciovasquezbernal at gmail.com  Wed Mar 18 07:44:47 2015
From: mauriciovasquezbernal at gmail.com (=?UTF-8?Q?Mauricio_V=C3=A1squez?=)
Date: Wed, 18 Mar 2015 15:44:47 +0100
Subject: [ovs-discuss] kernel data-path CPU usage
In-Reply-To: <20150317201323.GW11929@nicira.com>
References: <CAPwdgqh+++jQZSq929hW6eM1SDa1YJPV5RbugkZ6S1CJfaA=bw@mail.gmail.com>
 <20150317201323.GW11929@nicira.com>
Message-ID: <CAPwdgqj4KVJ1fYwxLSdObnQsAQm0bnHcZxqC4YTpHm1XM6ZPAg@mail.gmail.com>

Thank you very much for your answer,

Just an extra question, in the case where I had the two virtual machines,
where is ovs executed?.

On Tue, Mar 17, 2015 at 9:13 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Mar 17, 2015 at 08:46:54PM +0100, Mauricio V??squez wrote:
> > Finally, We ran a test with two pcs, each of them with two 10G NICs, one
> PC
> > was used as traffic generator meanwhile the another one was using OVS to
> > make a bridge between the two NICs, in the pc with OVS we found that
> there
> > was a process called ksoftirqd what was using 100% of a core, once again
> > there were not anything related to ovs.
> >
> > So, the question is, where is the dapa-path module executed? I mean, In
> > which thread?
>
> The datapath doesn't have any threads, it runs in softirqs to process
> packets as they arrive.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/72684a3a/attachment.html>

From blp at nicira.com  Wed Mar 18 07:52:37 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Mar 2015 07:52:37 -0700
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <550956F8.3040001@picton.nom.za>
References: <55088BBF.6080001@picton.nom.za>
 <20150317202156.GZ11929@nicira.com>
 <55089732.9080905@picton.nom.za>
 <20150317230529.GR32489@nicira.com>
 <55091F77.8060208@picton.nom.za> <550956F8.3040001@picton.nom.za>
Message-ID: <20150318145237.GA18524@nicira.com>

On Wed, Mar 18, 2015 at 12:44:08PM +0200, Chris Picton wrote:
> On 03/18/15 08:47, Chris Picton wrote:
> >The relevant flow is:
> >recirc_id(0),skb_priority(0),in_port(2),eth(src=00:15:17:91:05:4c,dst=52:54:00:14:54:c6),eth_type(0x8100),vlan(vid=3,pcp=0),encap(eth_type(0x0806)),
> >packets:2, bytes:120, used:0.014s, actions:pop_vlan,7
> >
> >I can't find any definitive documentation for an action element consisting
> >purely of a number - in this case "7".
> I have just re-read the man page, and found the following:
> "The  target  may  be  a  decimal  port  number  designating the physical
> port on which to  output the packet."
> 
> so the packet should, according to the above, be forwarded to port 7, which
> is vnet0.
> 
> However, the packet is not arriving on vnet0.  Any ideas where I can look to
> find out why not?

I'd start by checking the kernel log (with "dmesg").

From blp at nicira.com  Wed Mar 18 07:56:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Mar 2015 07:56:20 -0700
Subject: [ovs-discuss] kernel data-path CPU usage
In-Reply-To: <CAPwdgqj4KVJ1fYwxLSdObnQsAQm0bnHcZxqC4YTpHm1XM6ZPAg@mail.gmail.com>
References: <CAPwdgqh+++jQZSq929hW6eM1SDa1YJPV5RbugkZ6S1CJfaA=bw@mail.gmail.com>
 <20150317201323.GW11929@nicira.com>
 <CAPwdgqj4KVJ1fYwxLSdObnQsAQm0bnHcZxqC4YTpHm1XM6ZPAg@mail.gmail.com>
Message-ID: <20150318145620.GB18524@nicira.com>

I don't know how vhost works.  My guess is that the OVS datapath was
executing as softirqs in the context of the vhost threads and therefore
being attributed to the vhost threads.  Or I could be wrong.

On Wed, Mar 18, 2015 at 03:44:47PM +0100, Mauricio Vásquez wrote:
> Thank you very much for your answer,
> 
> Just an extra question, in the case where I had the two virtual machines,
> where is ovs executed?.
> 
> On Tue, Mar 17, 2015 at 9:13 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Tue, Mar 17, 2015 at 08:46:54PM +0100, Mauricio V??squez wrote:
> > > Finally, We ran a test with two pcs, each of them with two 10G NICs, one
> > PC
> > > was used as traffic generator meanwhile the another one was using OVS to
> > > make a bridge between the two NICs, in the pc with OVS we found that
> > there
> > > was a process called ksoftirqd what was using 100% of a core, once again
> > > there were not anything related to ovs.
> > >
> > > So, the question is, where is the dapa-path module executed? I mean, In
> > > which thread?
> >
> > The datapath doesn't have any threads, it runs in softirqs to process
> > packets as they arrive.
> >

From blp at nicira.com  Wed Mar 18 07:59:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Mar 2015 07:59:06 -0700
Subject: [ovs-discuss] gratuitous arp replies on behalf of virtual
	machine
In-Reply-To: <20150318143553.GA16479@shell.dmz.bit.nl>
References: <20150318143553.GA16479@shell.dmz.bit.nl>
Message-ID: <20150318145906.GC18524@nicira.com>

On Wed, Mar 18, 2015 at 03:35:53PM +0100, Stefan Kooman wrote:
> Hi All,
> 
> I'm trying to achieve the following: I would like to send gratuitous arp
> replies on a OpenvSwitch (tagged) virtual machine (VM) interface (vnet5) from
> the host itself (Ubuntu 14.04, OVS 2.0.2) (to update upstream switch(es) their
> mac-address-tables after a live-migration of the VM). Therefore I made a little
> python script that utilizes Scapy, relevant part:
> 
> sendp(Ether(src=args.macaddress,dst="ff:ff:ff:ff:ff:ff") / ARP(op=2,
> hwsrc=args.macaddress, psrc=args.ipaddress, hwdst="ff:ff:ff:ff:ff:ff",
> pdst="255.255.255.255"), iface=args.vnet, count=4, inter=0.2)
> 
> The gratuitous arp replies do come in one the Virtual Machine itself, but never
> make it out of the bridge (uplink), bond (bond1) and physical interface(s)
> (eth2, eth5): 

I think that this sends the packet in the wrong direction (toward the
VM).  I don't know how to inject a packet in the direction that you
want.

From blp at nicira.com  Wed Mar 18 08:00:54 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Mar 2015 08:00:54 -0700
Subject: [ovs-discuss]
 =?utf-8?q?=5Bhelp=5DSome_question_about_OVS_configu?=
 =?utf-8?b?cmUobXVsdGlwYXRo44CBYXBwbHkgbm9344CBcHJvcml0eSnvvJ8=?=
In-Reply-To: <2C54893E2A0C484DA1249B509D857C394DFF937E@SZXEML506-MBS.china.huawei.com>
References: <2C54893E2A0C484DA1249B509D857C394DFF937E@SZXEML506-MBS.china.huawei.com>
Message-ID: <20150318150054.GD18524@nicira.com>

On Wed, Mar 18, 2015 at 06:18:14AM +0000, yuanfeng (A) wrote:
> 1.I have a requirement to use OVS multipath function, but i only found
> the group table with select function can do this, but I don’t want to
> use group table, is there any other function in flow table can do this
> too?

The multipath action can be used in any flow.  There is no restriction
to the group table.

>          2.also, I’ve read the guide and can’t find a flow cmd about
> apply_now and prority, does the ovs support this OpenFlow1.3 feature
> now?

Do you mean "apply_actions"?  That's the "default" instruction; you
don't have to specify anything special.  (It was introduced in OpenFlow
1.1, not 1.3.)

From chris at picton.nom.za  Wed Mar 18 08:14:30 2015
From: chris at picton.nom.za (Chris Picton)
Date: Wed, 18 Mar 2015 17:14:30 +0200
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <20150318145237.GA18524@nicira.com>
References: <55088BBF.6080001@picton.nom.za>
 <20150317202156.GZ11929@nicira.com> <55089732.9080905@picton.nom.za>
 <20150317230529.GR32489@nicira.com> <55091F77.8060208@picton.nom.za>
 <550956F8.3040001@picton.nom.za> <20150318145237.GA18524@nicira.com>
Message-ID: <55099656.1070907@picton.nom.za>

On 03/18/15 16:52, Ben Pfaff wrote:
> On Wed, Mar 18, 2015 at 12:44:08PM +0200, Chris Picton wrote:
>> On 03/18/15 08:47, Chris Picton wrote:
>>> The relevant flow is:
>>> recirc_id(0),skb_priority(0),in_port(2),eth(src=00:15:17:91:05:4c,dst=52:54:00:14:54:c6),eth_type(0x8100),vlan(vid=3,pcp=0),encap(eth_type(0x0806)),
>>> packets:2, bytes:120, used:0.014s, actions:pop_vlan,7
>>>
>>> I can't find any definitive documentation for an action element consisting
>>> purely of a number - in this case "7".
>> I have just re-read the man page, and found the following:
>> "The  target  may  be  a  decimal  port  number  designating the physical
>> port on which to  output the packet."
>>
>> so the packet should, according to the above, be forwarded to port 7, which
>> is vnet0.
>>
>> However, the packet is not arriving on vnet0.  Any ideas where I can look to
>> find out why not?
> I'd start by checking the kernel log (with "dmesg").

Hi Ben

I had already done system level debugging to try find out where issues 
may lie.  There are no kernel logs indicating dropped packets or 
transmit failures.

A diff between the contents of /sys/class/net/vnet0 (which is the port 
that gets no traffic) and /sys/class/net/veth-carbon1-3/ (which is the 
port that gets traffic) shows very few differences at the kernel level 
(rx/tx counts/address/etc differ, but type/features/carrier/flags/etc 
are the same)

What I know so far is that while openvswitch should be forwarding 
packets onto vnet0 (which is what the flow indicates), vnet0 does not 
receive those packets (as indicated with tcpdump).  Also the tx_packets 
counter for vnet0 does not increment (as it should when packets get sent 
to the interface and transmitted on)

Is this a kernel/openvswitch bug?  I can probably get the interface 
working by migrating the VM to a different host and migrating it back, 
but I would rather leave it in a non working state to try and pinpoint 
the issue.

Regards
Chris



From blp at nicira.com  Wed Mar 18 08:25:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Mar 2015 08:25:59 -0700
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <55099656.1070907@picton.nom.za>
References: <55088BBF.6080001@picton.nom.za>
 <20150317202156.GZ11929@nicira.com>
 <55089732.9080905@picton.nom.za>
 <20150317230529.GR32489@nicira.com>
 <55091F77.8060208@picton.nom.za> <550956F8.3040001@picton.nom.za>
 <20150318145237.GA18524@nicira.com>
 <55099656.1070907@picton.nom.za>
Message-ID: <20150318152559.GE18524@nicira.com>

On Wed, Mar 18, 2015 at 05:14:30PM +0200, Chris Picton wrote:
> On 03/18/15 16:52, Ben Pfaff wrote:
> >On Wed, Mar 18, 2015 at 12:44:08PM +0200, Chris Picton wrote:
> >>On 03/18/15 08:47, Chris Picton wrote:
> >>>The relevant flow is:
> >>>recirc_id(0),skb_priority(0),in_port(2),eth(src=00:15:17:91:05:4c,dst=52:54:00:14:54:c6),eth_type(0x8100),vlan(vid=3,pcp=0),encap(eth_type(0x0806)),
> >>>packets:2, bytes:120, used:0.014s, actions:pop_vlan,7
> >>>
> >>>I can't find any definitive documentation for an action element consisting
> >>>purely of a number - in this case "7".
> >>I have just re-read the man page, and found the following:
> >>"The  target  may  be  a  decimal  port  number  designating the physical
> >>port on which to  output the packet."
> >>
> >>so the packet should, according to the above, be forwarded to port 7, which
> >>is vnet0.
> >>
> >>However, the packet is not arriving on vnet0.  Any ideas where I can look to
> >>find out why not?
> >I'd start by checking the kernel log (with "dmesg").
> 
> Hi Ben
> 
> I had already done system level debugging to try find out where issues may
> lie.  There are no kernel logs indicating dropped packets or transmit
> failures.
> 
> A diff between the contents of /sys/class/net/vnet0 (which is the port that
> gets no traffic) and /sys/class/net/veth-carbon1-3/ (which is the port that
> gets traffic) shows very few differences at the kernel level (rx/tx
> counts/address/etc differ, but type/features/carrier/flags/etc are the same)
> 
> What I know so far is that while openvswitch should be forwarding packets
> onto vnet0 (which is what the flow indicates), vnet0 does not receive those
> packets (as indicated with tcpdump).  Also the tx_packets counter for vnet0
> does not increment (as it should when packets get sent to the interface and
> transmitted on)
> 
> Is this a kernel/openvswitch bug?  I can probably get the interface working
> by migrating the VM to a different host and migrating it back, but I would
> rather leave it in a non working state to try and pinpoint the issue.

I don't know.  It's unlikely to be a bug in the Open vSwitch kernel
module, though.

From shettyg at nicira.com  Wed Mar 18 08:27:03 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Wed, 18 Mar 2015 08:27:03 -0700
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <55099656.1070907@picton.nom.za>
References: <55088BBF.6080001@picton.nom.za>
 <20150317202156.GZ11929@nicira.com>
 <55089732.9080905@picton.nom.za>
 <20150317230529.GR32489@nicira.com>
 <55091F77.8060208@picton.nom.za> <550956F8.3040001@picton.nom.za>
 <20150318145237.GA18524@nicira.com>
 <55099656.1070907@picton.nom.za>
Message-ID: <CAHbON5p5RzskJ3WQmnq99uQJ4UgmR4uzuYxY7YxxwKoN0XWq3w@mail.gmail.com>

Fwiw, I had seen a similar issue a couple of years ago. It turned out
to be a system bug. I debugged (with help from Ben) like this:
ps -ef | grep kvm : Choose the process id of the kvm
ls -ltr /proc/$pid/fd

This will show you the fd of /dev/net/tun
So the KVM process will be listening on that fd for all the packets
that comes from host and is headed to VM.

"strace -o logfile -p $Pid" for a few seconds.

If you open the logfile, you will see a select system call on that fd
and then read system calls on that fd.

In my case, there was nothing being read. I don't remember very well
what exactly was the problem. The fix was to use a different network
device .

On Wed, Mar 18, 2015 at 8:14 AM, Chris Picton <chris at picton.nom.za> wrote:
> On 03/18/15 16:52, Ben Pfaff wrote:
>>
>> On Wed, Mar 18, 2015 at 12:44:08PM +0200, Chris Picton wrote:
>>>
>>> On 03/18/15 08:47, Chris Picton wrote:
>>>>
>>>> The relevant flow is:
>>>>
>>>> recirc_id(0),skb_priority(0),in_port(2),eth(src=00:15:17:91:05:4c,dst=52:54:00:14:54:c6),eth_type(0x8100),vlan(vid=3,pcp=0),encap(eth_type(0x0806)),
>>>> packets:2, bytes:120, used:0.014s, actions:pop_vlan,7
>>>>
>>>> I can't find any definitive documentation for an action element
>>>> consisting
>>>> purely of a number - in this case "7".
>>>
>>> I have just re-read the man page, and found the following:
>>> "The  target  may  be  a  decimal  port  number  designating the physical
>>> port on which to  output the packet."
>>>
>>> so the packet should, according to the above, be forwarded to port 7,
>>> which
>>> is vnet0.
>>>
>>> However, the packet is not arriving on vnet0.  Any ideas where I can look
>>> to
>>> find out why not?
>>
>> I'd start by checking the kernel log (with "dmesg").
>
>
> Hi Ben
>
> I had already done system level debugging to try find out where issues may
> lie.  There are no kernel logs indicating dropped packets or transmit
> failures.
>
> A diff between the contents of /sys/class/net/vnet0 (which is the port that
> gets no traffic) and /sys/class/net/veth-carbon1-3/ (which is the port that
> gets traffic) shows very few differences at the kernel level (rx/tx
> counts/address/etc differ, but type/features/carrier/flags/etc are the same)
>
> What I know so far is that while openvswitch should be forwarding packets
> onto vnet0 (which is what the flow indicates), vnet0 does not receive those
> packets (as indicated with tcpdump).  Also the tx_packets counter for vnet0
> does not increment (as it should when packets get sent to the interface and
> transmitted on)
>
> Is this a kernel/openvswitch bug?  I can probably get the interface working
> by migrating the VM to a different host and migrating it back, but I would
> rather leave it in a non working state to try and pinpoint the issue.
>
> Regards
> Chris
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From d037918 at polito.it  Tue Mar 17 10:57:58 2015
From: d037918 at polito.it (MIGNINI FABIO)
Date: Tue, 17 Mar 2015 18:57:58 +0100
Subject: [ovs-discuss] Traffic loop problem, when a controller is setted
Message-ID: <web-8123081@backmail1.polito.it>

Hello,

I have noticed an unexpected generation of traffic loop 
using a very simple configuration of KVM and OVS.
In particular the configuration that trigger the problem 
is the one listed below:

    +-----------------+
    | Virtual machine |
    +----+-------+----+
         |       |
  +------+-------+------+
  |                     |
  |     OVS Bridge      |
  +---------------------+

The OVS Bridge has two ports that are connected to the 
virtual machine. Within the virtual machine there is a 
linux bridge that bridges both the vm's interfaces.
I found the problem with two different configuration of 
the bridge:
	- setting an existing OF controller (OpenDaylight)
         - setting a fake address for the OF controller (a 
not reachable IP address)

This is the output of the 'ovs-vsctl show' command (I 
provide here only the second configuration, as you can see 
the controller is not connected):

root at controller:~# ovs-vsctl show
82f530a0-269e-4eb4-b71a-dedc9f26ccd9
     Bridge br-int
         Controller "tcp:192.168.5.3:6633"
         Port br-int
             Interface br-int
                 type: internal
         Port "vnet1"
             Interface "vnet1"
         Port "vnet0"
             Interface "vnet0"
     ovs_version: "2.3.1"

The only flow in the OVS bridge "br-int" is a DROP flow, 
without any match (inserted manually before the starting 
of the virtual machine).
This is the output of the 'ovs-ofctl dump-flows br-int' 
command:

root at controller:~# ovs-ofctl dump-flows br-int
NXST_FLOW reply (xid=0x4):
  cookie=0x0, duration=232.952s, table=0, n_packets=0, 
n_bytes=0, idle_age=232, priority=1 actions=drop

With this configuration I was expecting that all the 
traffic will be dropped by the OVS Bridge (as happens when 
no controller is setted).
Instead a traffic loop is generated between the two ports 
in the bridge.
It seems that the DROP flow rule is not working as 
expected.

Any suggestion?

From timbgr at gmail.com  Tue Mar 17 15:31:31 2015
From: timbgr at gmail.com (Tim Bagr)
Date: Wed, 18 Mar 2015 02:31:31 +0400
Subject: [ovs-discuss] Cannot limit the bandwidth for particular OVS port
Message-ID: <CABJqVcyM8HLF2P5QjeSGsUYeOvNt1qLOtPUXdVoEgcTPz+9gHw@mail.gmail.com>

Hello all,

I'm trying to limit the bandwidth for particular VM attached to OpenVSwitch
port.

In my environment, there are VMs attached to virtual switch br3. I want to
limit bandwidth for one VM, which is attached to br3 and in_port 2. Doing
as follows:

# ovs-vsctl set port br3 qos=@newqos1 -- --id=@newqos1 create qos
type=linux-htb other-config:max-rate=10 queues:123=@vn2queue --
--id=@vn2queue create queue other-config:max-rate=10
# ovs-ofctl add-flow br3
"priority=50,in_port=2,actions=set_queue:123,normal"

After that, the bandwidth is limited as expected for all traffic going
through LOCAL port of br3, limit is very tight so even icmp echo is hardly
passed. All VMs are affected by this. Now I am going to limit the bandwidth
for only one VM, and give almost unlimited bandwidth for the others:

# ovs-vsctl set port br3 qos=@newqos1 -- --id=@newqos1 create qos
type=linux-htb other-config:max-rate=100000000
queues:123=4d65ddec-5c5d-4c87-8165-dd51431c7ab3

Here the ID 4d65ddec-5c5d-4c87-8165-dd51431c7ab3 is that queue which was
created in previous steps with max-rate=10
OpenFlow rule for redirecting traffic from the in_port=2 to that queue
remains the same.

After that I got all VMs (including attached to in_port 2) has got that big
bandwidth (100000000). But I was expecting that VM from port 2 cannot send
even pings (as its traffic should be limited by max-rate=10). Am I doing
something wrong or maybe have incorrect understanding how QoS works?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/4362d5a7/attachment-0001.html>

From simon.jouet at gmail.com  Wed Mar 18 04:51:24 2015
From: simon.jouet at gmail.com (Simon Jouet)
Date: Wed, 18 Mar 2015 11:51:24 +0000
Subject: [ovs-discuss] GRE tunnel in OVS
Message-ID: <CAJWKWvDF0=o4PuWSscF4_wh_w+kOgMq=ux+WdQ1-S7SruYgn+w@mail.gmail.com>

Hi everyone,

So a colleague and I are trying to setup an experiment with GRE tunnels and
unfortunately we are unable to get everything working the way we want ...

We have three machines with two NICs each (we keep one for SSH) we have
installed OpenvSwitch 2.3.2 in the three of them, attached one of the two
NIC to OVS and ifconfig the ovs interface to have the IP of NIC. At this
point we have three hosts each with an *ovsbr0 *bridge and the IPs
192.168.0.1, 192.168.0.2, 192.168.0.3.

What we want to is to redirect all the traffic from 192.168.0.1 to
192.168.0.3 through 192.168.0.2, we have established a GRE tunnel between
1->2 and 2->3. On 192.168.0.1 I can quite easily send all the traffic over
the GRE tunnel and can see it on 192.168.0.2, however this is where I run
into problems.

I'm trying to decapsulate it (remove the GRE header) to send it on the gre
tunnel from 192.168.0.2 to 192.168.0.3. If I send it directly I get a GRE
packet within a GRE packet which doesn't work ... I also have tried on
192.168.0.2 to match incomming packet with a tunnel id of 0xa (this is the
options:key of the gre tunnel) but no packet is matched. Would anybody have
some suggestions on how to solve the problem if possible ?

Let me know if something is unclear and I will try to go into bit more
details.

Best regards,
Simon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/1f7c281e/attachment-0001.html>

From jpavlico at cisco.com  Wed Mar 18 06:23:10 2015
From: jpavlico at cisco.com (Julia Pavlicova -X (jpavlico - Pantheon Technologies SRO at Cisco))
Date: Wed, 18 Mar 2015 13:23:10 +0000
Subject: [ovs-discuss] Open vSwitch bug report
Message-ID: <7420D16EDDFC8E45B1449C136ACD5E9A0BD01376@xmb-aln-x03.cisco.com>

Hello,
we identified a potential bug on Open vSwitch. The problem occurred during OpenFlow testing for add, update and delete flows. We also used Opendayligt controller.

Description:
We have 2  different scenarious:
1) add, update, delete  flow for flow ,which priority=31  Expected results (ER): OK
After add:
OFPST_FLOW reply (OF1.3) (xid=0x2):
cookie=0xa, duration=10.166s, table=2, n_packets=0, n_bytes=0, idle_timeout=300, hard_timeout=600, priority=31,ip,nw_dst=10.0.0.0/24 actions=drop  --> OK
After update
OFPST_FLOW reply (OF1.3) (xid=0x2):
cookie=0xa, duration=12.810s, table=2, n_packets=0, n_bytes=0, idle_timeout=300, hard_timeout=600, priority=31,ip,nw_dst=10.0.0.0/24 actions=TABLE   --> OK


2) add, update, delete  for 2 different flows: priority=31 and priority=38  Expected results: NOK
After add:
OFPST_FLOW reply (OF1.3) (xid=0x2):
cookie=0xa, duration=10.023s, table=2, n_packets=0, n_bytes=0, idle_timeout=300, hard_timeout=600, priority=38,ip,nw_dst=10.0.0.0/24 actions=set_queue:1  --> OK
cookie=0xa, duration=10.166s, table=2, n_packets=0, n_bytes=0, idle_timeout=300, hard_timeout=600, priority=31,ip,nw_dst=10.0.0.0/24 actions=drop  --> OK

After update flow with p=31     We expected a change on 31 and no change in 38. Actions in 38 should be == set_queue:1
OFPST_FLOW reply (OF1.3) (xid=0x2):
cookie=0xa, duration=12.667s, table=2, n_packets=0, n_bytes=0, idle_timeout=300, hard_timeout=600, priority=38,ip,nw_dst=10.0.0.0/24 actions=TABLE  --> NOK
cookie=0xa, duration=12.810s, table=2, n_packets=0, n_bytes=0, idle_timeout=300, hard_timeout=600, priority=31,ip,nw_dst=10.0.0.0/24 actions=TABLE  -->OK

After update flow with p=38   We expected a change in 38 and no change in 31. Actions in 31 should be ==TABLE.
OFPST_FLOW reply (OF1.3) (xid=0x2):
cookie=0xa, duration=14.769s, table=2, n_packets=0, n_bytes=0, idle_timeout=300, hard_timeout=600, priority=38,ip,nw_dst=10.0.0.0/24 actions=drop  --> OK
cookie=0xa, duration=14.912s, table=2, n_packets=0, n_bytes=0, idle_timeout=300, hard_timeout=600, priority=31,ip,nw_dst=10.0.0.0/24 actions=drop  --> NOK

Please see the attached files with tcp dump for both scenarious, html.log from robot framework and contents of the vswitchd configuration database:   /etc/openvswitch/conf.db

The Open vSwitch version number:
ovs-vswitchd (Open vSwitch) 2.3.0
Compiled Oct 29 2014 14:19:02
OpenFlow versions 0x1:0x1

OpenFlow Version: 1.3 (from tcp dump)

The distribution + version of OS and the kernel version:
Linux version 3.11.10-100.fc18.x86_64 (mockbuild at bkernel02) (gcc version 4.7.2 20121109 (Red Hat 4.7.2-8) (GCC) ) #1 SMP Mon Dec 2 20:28:38 UTC 2013

ovs-dpctl show:
system at ovs-system:
                lookups: hit:67 missed:1002 lost:0
                flows: 0
                port 0: ovs-system (internal)



Regards,
Julia Pavlicova


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/31edca31/attachment-0001.html>

From blp at nicira.com  Wed Mar 18 08:41:19 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Mar 2015 08:41:19 -0700
Subject: [ovs-discuss] Traffic loop problem, when a controller is setted
In-Reply-To: <web-8123081@backmail1.polito.it>
References: <web-8123081@backmail1.polito.it>
Message-ID: <20150318154119.GA29009@nicira.com>

On Tue, Mar 17, 2015 at 06:57:58PM +0100, MIGNINI FABIO wrote:
> I have noticed an unexpected generation of traffic loop using a very simple
> configuration of KVM and OVS.
> In particular the configuration that trigger the problem is the one listed
> below:
> 
>    +-----------------+
>    | Virtual machine |
>    +----+-------+----+
>         |       |
>  +------+-------+------+
>  |                     |
>  |     OVS Bridge      |
>  +---------------------+
> 
> The OVS Bridge has two ports that are connected to the virtual machine.
> Within the virtual machine there is a linux bridge that bridges both the
> vm's interfaces.
> I found the problem with two different configuration of the bridge:
> 	- setting an existing OF controller (OpenDaylight)
>         - setting a fake address for the OF controller (a not reachable IP
> address)
> 
> This is the output of the 'ovs-vsctl show' command (I provide here only the
> second configuration, as you can see the controller is not connected):
> 
> root at controller:~# ovs-vsctl show
> 82f530a0-269e-4eb4-b71a-dedc9f26ccd9
>     Bridge br-int
>         Controller "tcp:192.168.5.3:6633"
>         Port br-int
>             Interface br-int
>                 type: internal
>         Port "vnet1"
>             Interface "vnet1"
>         Port "vnet0"
>             Interface "vnet0"
>     ovs_version: "2.3.1"
> 
> The only flow in the OVS bridge "br-int" is a DROP flow, without any match
> (inserted manually before the starting of the virtual machine).
> This is the output of the 'ovs-ofctl dump-flows br-int' command:
> 
> root at controller:~# ovs-ofctl dump-flows br-int
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=232.952s, table=0, n_packets=0, n_bytes=0,
> idle_age=232, priority=1 actions=drop
> 
> With this configuration I was expecting that all the traffic will be dropped
> by the OVS Bridge (as happens when no controller is setted).
> Instead a traffic loop is generated between the two ports in the bridge.
> It seems that the DROP flow rule is not working as expected.

One possibility is that you've got hidden flows due to the in-band
controller configuration.  Try "ovs-appctl bridge/dump-flows br-int" to
check for thtat.

From chris at picton.nom.za  Wed Mar 18 10:29:16 2015
From: chris at picton.nom.za (Chris Picton)
Date: Wed, 18 Mar 2015 19:29:16 +0200
Subject: [ovs-discuss] OVS not forwarding packets to port
In-Reply-To: <CAHbON5p5RzskJ3WQmnq99uQJ4UgmR4uzuYxY7YxxwKoN0XWq3w@mail.gmail.com>
References: <55088BBF.6080001@picton.nom.za>	<20150317202156.GZ11929@nicira.com>	<55089732.9080905@picton.nom.za>	<20150317230529.GR32489@nicira.com>	<55091F77.8060208@picton.nom.za>	<550956F8.3040001@picton.nom.za>	<20150318145237.GA18524@nicira.com>	<55099656.1070907@picton.nom.za>
 <CAHbON5p5RzskJ3WQmnq99uQJ4UgmR4uzuYxY7YxxwKoN0XWq3w@mail.gmail.com>
Message-ID: <5509B5EC.1050104@picton.nom.za>

Hi Gurusharan

Thanks for the extremely helpful tip

I did as you suggested, and ran a strace on the kvm pid:
  # strace  -e trace=select -p 3740
Process 3740 attached - interrupt to quit
select(44, [7 11 14 15 17 19 20 40 41 42 43], [], [], {0, 584192}) = 0 
(Timeout)
select(44, [7 11 14 15 17 19 20 40 41 42 43], [], [], {0, 999000}) = 1 
(in [19], left {0, 665094})
select(44, [7 11 14 15 17 19 20 40 41 42 43], [], [], {0, 665000}) = 2 
(in [7 17], left {0, 664997})
...

The FD of the vnet0 interface is not in the readfds fd_set (it should 
include 39)  This indicates why the network device is not pulling any 
traffic.

Also, even though the network interface is not registering any drops or 
errors, the tc queue attached to it does show drops (not sure the 
reasons for that)
  # tc -s qdisc show dev vnet0
qdisc pfifo_fast 0: root refcnt 2 bands 3 priomap  1 2 2 2 1 2 0 0 1 1 1 
1 1 1 1 1
  Sent 359863 bytes 1983 pkt (dropped 2804865, overlimits 0 requeues 2)
  rate 0bit 0pps backlog 82148b 500p requeues 2

Commits like this:
http://git.qemu.org/?p=qemu.git;a=commitdiff;h=68e5ec64009812dbaa03ed9cfded9344986f5304 

possibly fix the problem at the qemu side.

So even though the fault is not in openvswitch, in this process, I have 
learned a lot more about how ovs and flows work - thanks :)

Regards
Chris

On 2015/03/18 05:27 PM, Gurucharan Shetty wrote:
> Fwiw, I had seen a similar issue a couple of years ago. It turned out
> to be a system bug. I debugged (with help from Ben) like this:
> ps -ef | grep kvm : Choose the process id of the kvm
> ls -ltr /proc/$pid/fd
>
> This will show you the fd of /dev/net/tun
> So the KVM process will be listening on that fd for all the packets
> that comes from host and is headed to VM.
>
> "strace -o logfile -p $Pid" for a few seconds.
>
> If you open the logfile, you will see a select system call on that fd
> and then read system calls on that fd.
>
> In my case, there was nothing being read. I don't remember very well
> what exactly was the problem. The fix was to use a different network
> device .
>
> On Wed, Mar 18, 2015 at 8:14 AM, Chris Picton <chris at picton.nom.za> wrote:
>> On 03/18/15 16:52, Ben Pfaff wrote:
>>> On Wed, Mar 18, 2015 at 12:44:08PM +0200, Chris Picton wrote:
>>>> On 03/18/15 08:47, Chris Picton wrote:
>>>>> The relevant flow is:
>>>>>
>>>>> recirc_id(0),skb_priority(0),in_port(2),eth(src=00:15:17:91:05:4c,dst=52:54:00:14:54:c6),eth_type(0x8100),vlan(vid=3,pcp=0),encap(eth_type(0x0806)),
>>>>> packets:2, bytes:120, used:0.014s, actions:pop_vlan,7
>>>>>
>>>>> I can't find any definitive documentation for an action element
>>>>> consisting
>>>>> purely of a number - in this case "7".
>>>> I have just re-read the man page, and found the following:
>>>> "The  target  may  be  a  decimal  port  number  designating the physical
>>>> port on which to  output the packet."
>>>>
>>>> so the packet should, according to the above, be forwarded to port 7,
>>>> which
>>>> is vnet0.
>>>>
>>>> However, the packet is not arriving on vnet0.  Any ideas where I can look
>>>> to
>>>> find out why not?
>>> I'd start by checking the kernel log (with "dmesg").
>>
>> Hi Ben
>>
>> I had already done system level debugging to try find out where issues may
>> lie.  There are no kernel logs indicating dropped packets or transmit
>> failures.
>>
>> A diff between the contents of /sys/class/net/vnet0 (which is the port that
>> gets no traffic) and /sys/class/net/veth-carbon1-3/ (which is the port that
>> gets traffic) shows very few differences at the kernel level (rx/tx
>> counts/address/etc differ, but type/features/carrier/flags/etc are the same)
>>
>> What I know so far is that while openvswitch should be forwarding packets
>> onto vnet0 (which is what the flow indicates), vnet0 does not receive those
>> packets (as indicated with tcpdump).  Also the tx_packets counter for vnet0
>> does not increment (as it should when packets get sent to the interface and
>> transmitted on)
>>
>> Is this a kernel/openvswitch bug?  I can probably get the interface working
>> by migrating the VM to a different host and migrating it back, but I would
>> rather leave it in a non working state to try and pinpoint the issue.
>>
>> Regards
>> Chris
>>
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Wed Mar 18 12:25:31 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Mar 2015 12:25:31 -0700
Subject: [ovs-discuss] vswitchd crash with flow table 254 deletion
In-Reply-To: <550713EC.8010208@caviumnetworks.com>
References: <54FE9580.4050106@caviumnetworks.com>
 <20150310175859.GE11735@nicira.com>
 <54FF32F7.8060708@caviumnetworks.com>
 <20150313195539.GF3884@nicira.com>
 <5506851E.5020205@caviumnetworks.com>
 <20150316154244.GE12403@nicira.com>
 <550713EC.8010208@caviumnetworks.com>
Message-ID: <20150318192531.GE16202@nicira.com>

On Mon, Mar 16, 2015 at 11:03:32PM +0530, Vijaya Mohan Guvva wrote:
> 
> On 03/16/2015 09:12 PM, Ben Pfaff wrote:
> >On Mon, Mar 16, 2015 at 12:54:14PM +0530, Vijaya Mohan Guvva wrote:
> >>On 03/14/2015 01:25 AM, Ben Pfaff wrote:
> >>>Hi Ben,
> >>>Its v2.3.0 and v2.3.1.
> >>>Thanks, I sent out a fix for the problem, which only affects
> >>>branch-2.3.  Will you please test it out and review it?
> >>>
> >>>The patch is here:
> >>>         http://openvswitch.org/pipermail/dev/2015-March/052391.html
> >>>
> >>>Thanks,
> >>>
> >>>Ben.
> >>Hi Ben,
> >>With this fix, flow add/mod/del are not allowed on table=254. Is this the
> >>intended behaviour?
> >Yes.
> >
> >As DESIGN.md has said as long as OVS has supported multiple tables,
> >"Tables 128 and above are reserved for use by the switch itself.
> >Controllers should use only tables 0 through 127."
> >
> >May I assume that the bug appears fixed to you?
> >
> >Thanks,
> >
> >Ben.
> 
> Yes Ben, its fixes the issue.
> Thanks for the patch.

Thanks for confirming.  I applied the patch to branch-2.3.

From mitsarker at gmail.com  Wed Mar 18 14:44:10 2015
From: mitsarker at gmail.com (Mitalee Sarker)
Date: Wed, 18 Mar 2015 22:44:10 +0100
Subject: [ovs-discuss] Can not see GRE/VXLAN encapsulation
Message-ID: <CAL_cxzxqngPsd6yxZH1+9+wdt0-MUwsMXhD+o0swDQaBt0if4g@mail.gmail.com>

Hello,

I am working with openvswitch to analyze the performance of GRE and VXLAN
tunnel. I have two host machines with Ubuntu 14.04 installed. Each host
machine has 1 Virutal Machine. The host machines are connected via one 1GbE
switch.
I installed openvswitch version 2.0.2 from the repository of Ubuntu 14.04.
I created one virtual machine via KVM.

I followed this document to implement GRE and VXALN.
http://networkstatic.net/configuring-vxlan-and-gre-tunnels-on-openvswitch/

I kept my bridge in NORMAL mode. And I did not enable any flow.
I created one port in openvswitch and tried to connect the Virtual Machine
to that port. But I was not successful. The port did not show up in the NIC
options in the Virtual Machine. So I created one virtual network by using
virtual machine manager and configured it such a way that it can forward
the packets to the bridge br1. I then connected the Virtual Machine NIC to
that virtual network.

The virtual machines have private IP addresses and the hosts have public IP
addresses.

For better understanding I gave my implementation below:

ovs-vsctl add-br br1
ovs-vsctl add-port br1 gre1 -- set interface gre1 type=gre options:remote_ip
=(ip address of other host machine)

I was able to ping the host from the virtual machine.Unfortunately, I was
not able to ping the virtual machine in the other host. Also, if I ping the
host from the other host, I did not see any GRE/VXLAN encapsulaiton in the
packet. So, the traffic is not forwarded to the tunnel I guess.

Could you please suggest any solution to this problem so that the traffic
can go via the tunnel? And also the Virtual Machines can ping each other
via the tunnel?

Thanking you
Mitalee Sarker
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/39de0159/attachment.html>

From mk.lavanya at gmail.com  Wed Mar 18 15:41:54 2015
From: mk.lavanya at gmail.com (Lavanya M.K)
Date: Wed, 18 Mar 2015 15:41:54 -0700
Subject: [ovs-discuss] ECMP configuration on openvswitch
In-Reply-To: <091C3AC0-3675-4752-A2DC-3F3137197A82@inmon.com>
References: <CAH01gJ7ypw3r7=Qgqq0YnyAWt9mqKFRe3nr6ntHQh9oW9mfGTA@mail.gmail.com>
 <091C3AC0-3675-4752-A2DC-3F3137197A82@inmon.com>
Message-ID: <CAH01gJ7+v0EwJCoBeoj2SXOCFWLx-rWrB=_FB8=kBt6majyBNQ@mail.gmail.com>

Thanks Peter for the suggestion.
I tried the script, but what i am noticing is that the flow rules that the
script adds gets deleted very quickly. I tried adding idle_timeout=0
hard_timeout=0 to the flowrules to ensure that it never gets deleted. But
its not of use. How do i make a permanent flow entry in the flow table?

This is an example of flow rule additions from the leafandspine.py script:

 call(['ovs-vsctl', 'set', 'bridge', switch,
'protocols=OpenFlow10,OpenFlow13'])
        call(['ovs-ofctl', '-O', 'OpenFlow13', 'add-flow', switch, 'table=0
priority=100 idle_timeout=0 hard_timeout=0 actions=goto_table:1 '])

Thanks,
Lavanya


On Sun, Mar 15, 2015 at 9:17 AM, Peter Phaal <peter.phaal at inmon.com> wrote:

> The leafandspine.py script described in the following article provides an
> example that you could modify for your OpenDaylight setup.
>
> http://blog.sflow.com/2014/04/mininet-integrated-hybrid-openflow.htm
>
> You need to find a way to prevent the controller from flushing openflow
> rules on startup for this approach to work. There are efforts to support
> hybrid openflow in OpenDaylight
>
> http://blog.sflow.com/2014/09/hp-proposes-hybrid-openflow-discussion.html
>
> Peter Phaal
> InMon Corp.
>
> > On Mar 14, 2015, at 11:42 PM, Lavanya M.K <mk.lavanya at gmail.com> wrote:
> >
> > Hi All,
> >
> > I want to have static ECMP configuration in openvswitches used in a fat
> tree topology DCN(simulated in Mininet). The first packet should not be
> sent to the controller. Can i do this by ovs commands to install flow rules
> into group table?
> > The controller version i am using is OpenDayLight Hydrogen, which does
> not support writing into group table.
> >
> > Thanks,
> > Lavanya
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/2df12969/attachment.html>

From peter.phaal at inmon.com  Wed Mar 18 16:12:03 2015
From: peter.phaal at inmon.com (Peter Phaal)
Date: Wed, 18 Mar 2015 16:12:03 -0700
Subject: [ovs-discuss] ECMP configuration on openvswitch
In-Reply-To: <CAH01gJ7+v0EwJCoBeoj2SXOCFWLx-rWrB=_FB8=kBt6majyBNQ@mail.gmail.com>
References: <CAH01gJ7ypw3r7=Qgqq0YnyAWt9mqKFRe3nr6ntHQh9oW9mfGTA@mail.gmail.com>
 <091C3AC0-3675-4752-A2DC-3F3137197A82@inmon.com>
 <CAH01gJ7+v0EwJCoBeoj2SXOCFWLx-rWrB=_FB8=kBt6majyBNQ@mail.gmail.com>
Message-ID: <E9AB7308-9026-4DC6-8C29-B01AD443E9D4@inmon.com>

OpenDaylight deletes all the rules when OVS connects. You have to find a way to prevent OpenDaylight from deleting rules.


> On Mar 18, 2015, at 3:41 PM, Lavanya M.K <mk.lavanya at gmail.com> wrote:
> 
> Thanks Peter for the suggestion.
> I tried the script, but what i am noticing is that the flow rules that the script adds gets deleted very quickly. I tried adding idle_timeout=0 hard_timeout=0 to the flowrules to ensure that it never gets deleted. But its not of use. How do i make a permanent flow entry in the flow table?
> 
> This is an example of flow rule additions from the leafandspine.py script:
> 
>  call(['ovs-vsctl', 'set', 'bridge', switch, 'protocols=OpenFlow10,OpenFlow13'])
>         call(['ovs-ofctl', '-O', 'OpenFlow13', 'add-flow', switch, 'table=0 priority=100 idle_timeout=0 hard_timeout=0 actions=goto_table:1 '])  
> 
> Thanks,
> Lavanya
> 
> 
> On Sun, Mar 15, 2015 at 9:17 AM, Peter Phaal <peter.phaal at inmon.com <mailto:peter.phaal at inmon.com>> wrote:
> The leafandspine.py script described in the following article provides an example that you could modify for your OpenDaylight setup.
> 
> http://blog.sflow.com/2014/04/mininet-integrated-hybrid-openflow.htm <http://blog.sflow.com/2014/04/mininet-integrated-hybrid-openflow.htm>
> 
> You need to find a way to prevent the controller from flushing openflow rules on startup for this approach to work. There are efforts to support hybrid openflow in OpenDaylight
> 
> http://blog.sflow.com/2014/09/hp-proposes-hybrid-openflow-discussion.html <http://blog.sflow.com/2014/09/hp-proposes-hybrid-openflow-discussion.html>
> 
> Peter Phaal
> InMon Corp.
> 
> > On Mar 14, 2015, at 11:42 PM, Lavanya M.K <mk.lavanya at gmail.com <mailto:mk.lavanya at gmail.com>> wrote:
> >
> > Hi All,
> >
> > I want to have static ECMP configuration in openvswitches used in a fat tree topology DCN(simulated in Mininet). The first packet should not be sent to the controller. Can i do this by ovs commands to install flow rules into group table?
> > The controller version i am using is OpenDayLight Hydrogen, which does not support writing into group table.
> >
> > Thanks,
> > Lavanya
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org <mailto:discuss at openvswitch.org>
> > http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150318/c5868f0e/attachment-0001.html>

From yuanfeng1 at huawei.com  Wed Mar 18 18:24:37 2015
From: yuanfeng1 at huawei.com (yuanfeng (A))
Date: Thu, 19 Mar 2015 01:24:37 +0000
Subject: [ovs-discuss] =?utf-8?b?562U5aSNOiAgW2hlbHBdU29tZSBxdWVzdGlvbiBh?=
 =?utf-8?q?bout_OVS_configure=28multipath=E3=80=81apply_now=E3=80=81prorit?=
 =?utf-8?b?eSnvvJ8=?=
In-Reply-To: <20150318150054.GD18524@nicira.com>
References: <2C54893E2A0C484DA1249B509D857C394DFF937E@SZXEML506-MBS.china.huawei.com>
 <20150318150054.GD18524@nicira.com>
Message-ID: <2C54893E2A0C484DA1249B509D857C394DFFA661@SZXEML506-MBS.china.huawei.com>


-----邮件原件-----
发件人: Ben Pfaff [mailto:blp at nicira.com] 
发送时间: 2015年3月18日 23:01
收件人: yuanfeng (A)
抄送: discuss at openvswitch.org
主题: Re: [ovs-discuss] [help]Some question about OVS configure(multipath、apply now、prority)？

>On Wed, Mar 18, 2015 at 06:18:14AM +0000, yuanfeng (A) wrote:
>> 1.I have a requirement to use OVS multipath function, but i only found 
>> the group table with select function can do this, but I don’t want to 
>> use group table, is there any other function in flow table can do this 
>> too?
>
>The multipath action can be used in any flow.  There is no restriction to the group table.

[YUAN]: Maybe I havn't explain clearly, I have tried the group select multipath function, and now I want to find a another way to implement multipath, just use to flow table action, does the action of flow support multipath directly?

>
>>          2.also, I’ve read the guide and can’t find a flow cmd about 
>> apply_now and prority, does the ovs support this OpenFlow1.3 feature 
>> now?
>
>Do you mean "apply_actions"?  That's the "default" instruction; you don't have to specify anything special.  (It was introduced in OpenFlow 1.1, not 1.3.)

[YUAN]:I've tried the configure with my ovs, it works like you said~

Thank you very much~

From changzhi1990 at gmail.com  Wed Mar 18 19:09:49 2015
From: changzhi1990 at gmail.com (=?UTF-8?B?6IuM5pm6?=)
Date: Thu, 19 Mar 2015 10:09:49 +0800
Subject: [ovs-discuss] How delete a high priority flow ?
Message-ID: <CAENZyq73X=rF+ocjZDzDiNrqG4GMLE1adiE6DCzPDLK5CRcD4Q@mail.gmail.com>

I add a flow like this: ovs-ofctl add br-int priority=10,actions=NORMAL
How could I delete it except delete all flows by " ovs-ofctl del-flows
br-int "?


Regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150319/b7b16eba/attachment.html>

From prashant.ietedelhi at gmail.com  Wed Mar 18 21:23:25 2015
From: prashant.ietedelhi at gmail.com (Prashant Singh)
Date: Thu, 19 Mar 2015 09:53:25 +0530
Subject: [ovs-discuss]  OpenVswitch controller configuration not needed
Message-ID: <CABpZToX0Nn3P11UB+v6PkGqsxhmz7bNuDydTzjWmmHBo7YpvVw@mail.gmail.com>

Hi All

I am beginner. I am trying to create virtual switch. After creating the
virtual switch
I think we need to set the controller and start it, but I am able to ping
the nodes without setting the controller and starting it. Can any tell me
what is the default behavior of the OpenV Switch.

Details:
OpenV switch version: ovs-vsctl (Open vSwitch) 1.4.6
org.opendaylight.controller.version = 0.1
Linux Version:ubuntu, 64 bit, i686 architecture,

Thanks & Regards,
Prashant
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150319/6059a992/attachment.html>

From blp at nicira.com  Wed Mar 18 21:55:16 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Mar 2015 21:55:16 -0700
Subject: [ovs-discuss] How delete a high priority flow ?
In-Reply-To: <CAENZyq73X=rF+ocjZDzDiNrqG4GMLE1adiE6DCzPDLK5CRcD4Q@mail.gmail.com>
References: <CAENZyq73X=rF+ocjZDzDiNrqG4GMLE1adiE6DCzPDLK5CRcD4Q@mail.gmail.com>
Message-ID: <20150319045516.GC23411@nicira.com>

On Thu, Mar 19, 2015 at 10:09:49AM +0800, 苌智 wrote:
> I add a flow like this: ovs-ofctl add br-int priority=10,actions=NORMAL
> How could I delete it except delete all flows by " ovs-ofctl del-flows
> br-int "?

ovs-ofctl --strict del-flows br-int priority=10

From blp at nicira.com  Wed Mar 18 21:56:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 18 Mar 2015 21:56:03 -0700
Subject: [ovs-discuss]
 =?utf-8?b?562U5aSNOiAgW2hlbHBdU29tZSBxdWVzdGlvbiBh?=
 =?utf-8?q?bout_OVS_configure=28multipath=E3=80=81apply_now=E3=80=81prorit?=
 =?utf-8?b?eSnvvJ8=?=
In-Reply-To: <2C54893E2A0C484DA1249B509D857C394DFFA661@SZXEML506-MBS.china.huawei.com>
References: <2C54893E2A0C484DA1249B509D857C394DFF937E@SZXEML506-MBS.china.huawei.com>
 <20150318150054.GD18524@nicira.com>
 <2C54893E2A0C484DA1249B509D857C394DFFA661@SZXEML506-MBS.china.huawei.com>
Message-ID: <20150319045603.GD23411@nicira.com>

On Thu, Mar 19, 2015 at 01:24:37AM +0000, yuanfeng (A) wrote:
> >On Wed, Mar 18, 2015 at 06:18:14AM +0000, yuanfeng (A) wrote:
> >> 1.I have a requirement to use OVS multipath function, but i only found 
> >> the group table with select function can do this, but I don’t want to 
> >> use group table, is there any other function in flow table can do this 
> >> too?
> >
> >The multipath action can be used in any flow.  There is no restriction to the group table.
> 
> [YUAN]: Maybe I havn't explain clearly, I have tried the group select multipath function, and now I want to find a another way to implement multipath, just use to flow table action, does the action of flow support multipath directly?

There is an action named "multipath".  Please read ovs-ofctl(8) for more
information.

From yuanfeng1 at huawei.com  Wed Mar 18 23:01:17 2015
From: yuanfeng1 at huawei.com (yuanfeng (A))
Date: Thu, 19 Mar 2015 06:01:17 +0000
Subject: [ovs-discuss] =?utf-8?b?562U5aSNOiDnrZTlpI06ICBbaGVscF1Tb21lIHF1?=
 =?utf-8?q?estion_about_OVS_configure=28multipath=E3=80=81apply_now?=
 =?utf-8?b?44CBcHJvcml0eSnvvJ8=?=
In-Reply-To: <20150319045603.GD23411@nicira.com>
References: <2C54893E2A0C484DA1249B509D857C394DFF937E@SZXEML506-MBS.china.huawei.com>
 <20150318150054.GD18524@nicira.com>
 <2C54893E2A0C484DA1249B509D857C394DFFA661@SZXEML506-MBS.china.huawei.com>
 <20150319045603.GD23411@nicira.com>
Message-ID: <2C54893E2A0C484DA1249B509D857C394DFFAECF@SZXEML506-MBS.china.huawei.com>

OK, I've found it, Thanks~

-----邮件原件-----
发件人: Ben Pfaff [mailto:blp at nicira.com] 
发送时间: 2015年3月19日 12:56
收件人: yuanfeng (A)
抄送: discuss at openvswitch.org
主题: Re: 答复: [ovs-discuss] [help]Some question about OVS configure(multipath、apply now、prority)？

On Thu, Mar 19, 2015 at 01:24:37AM +0000, yuanfeng (A) wrote:
> >On Wed, Mar 18, 2015 at 06:18:14AM +0000, yuanfeng (A) wrote:
> >> 1.I have a requirement to use OVS multipath function, but i only 
> >> found the group table with select function can do this, but I don’t 
> >> want to use group table, is there any other function in flow table 
> >> can do this too?
> >
> >The multipath action can be used in any flow.  There is no restriction to the group table.
> 
> [YUAN]: Maybe I havn't explain clearly, I have tried the group select multipath function, and now I want to find a another way to implement multipath, just use to flow table action, does the action of flow support multipath directly?

There is an action named "multipath".  Please read ovs-ofctl(8) for more information.

From sharmila.radhakrishnan at intel.com  Thu Mar 19 04:10:13 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Thu, 19 Mar 2015 11:10:13 +0000
Subject: [ovs-discuss]  Different types of ports that can be attached
Message-ID: <1BA01C3192A665469272B2597052DDFF56EB3F9D@BGSMSX104.gar.corp.intel.com>

Hi All,

I wanted to understand, what are the different types of OVS ports that can be attached to a OVS bridge and what is the significance of each? This type is mentioned as part of the add-port command in the type parameter:

ovs-vsctl add-port testsw1 ns2iface1 -- set Interface ns2iface1 type=internal

I have seen tap,vxlan,gre,internal,patch amount the type of ports specified. I want to understand the difference between them and if there are any more ports available.

Thanks in advance.

Regards,
Sharmila


From blp at nicira.com  Thu Mar 19 06:27:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 19 Mar 2015 06:27:32 -0700
Subject: [ovs-discuss] Different types of ports that can be attached
In-Reply-To: <1BA01C3192A665469272B2597052DDFF56EB3F9D@BGSMSX104.gar.corp.intel.com>
References: <1BA01C3192A665469272B2597052DDFF56EB3F9D@BGSMSX104.gar.corp.intel.com>
Message-ID: <20150319132732.GF23411@nicira.com>

On Thu, Mar 19, 2015 at 11:10:13AM +0000, Radhakrishnan, Sharmila wrote:
> I wanted to understand, what are the different types of OVS ports that can be attached to a OVS bridge and what is the significance of each? This type is mentioned as part of the add-port command in the type parameter:
> 
> ovs-vsctl add-port testsw1 ns2iface1 -- set Interface ns2iface1 type=internal
> 
> I have seen tap,vxlan,gre,internal,patch amount the type of ports specified. I want to understand the difference between them and if there are any more ports available.

See ovs-vswitchd.conf.db(5).

From fbl at sysclose.org  Thu Mar 19 07:12:57 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Thu, 19 Mar 2015 11:12:57 -0300
Subject: [ovs-discuss] OpenVswitch controller configuration not needed
In-Reply-To: <CABpZToX0Nn3P11UB+v6PkGqsxhmz7bNuDydTzjWmmHBo7YpvVw@mail.gmail.com>
References: <CABpZToX0Nn3P11UB+v6PkGqsxhmz7bNuDydTzjWmmHBo7YpvVw@mail.gmail.com>
Message-ID: <20150319111257.1aa919a2@x240.home>

On Thu, 19 Mar 2015 09:53:25 +0530
Prashant Singh <prashant.ietedelhi at gmail.com> wrote:

> Hi All
> 
> I am beginner. I am trying to create virtual switch. After creating
> the virtual switch
> I think we need to set the controller and start it, but I am able to
> ping the nodes without setting the controller and starting it. Can
> any tell me what is the default behavior of the OpenV Switch.

No, you don't need a controller.  By default OVS comes with a
flow that uses NORMAL action which means subjects the packet to
the device's normal L2/L3 processing.

fbl


From blp at nicira.com  Thu Mar 19 07:24:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 19 Mar 2015 07:24:52 -0700
Subject: [ovs-discuss] OpenVswitch controller configuration not needed
In-Reply-To: <20150319111257.1aa919a2@x240.home>
References: <CABpZToX0Nn3P11UB+v6PkGqsxhmz7bNuDydTzjWmmHBo7YpvVw@mail.gmail.com>
 <20150319111257.1aa919a2@x240.home>
Message-ID: <20150319142452.GK23411@nicira.com>

On Thu, Mar 19, 2015 at 11:12:57AM -0300, Flavio Leitner wrote:
> On Thu, 19 Mar 2015 09:53:25 +0530
> Prashant Singh <prashant.ietedelhi at gmail.com> wrote:
> > I am beginner. I am trying to create virtual switch. After creating
> > the virtual switch
> > I think we need to set the controller and start it, but I am able to
> > ping the nodes without setting the controller and starting it. Can
> > any tell me what is the default behavior of the OpenV Switch.
> 
> No, you don't need a controller.  By default OVS comes with a
> flow that uses NORMAL action which means subjects the packet to
> the device's normal L2/L3 processing.

It's too bad we don't have good documentation on exactly how that works,
though.  I've been meaning for years to write up a sort of block diagram
of NORMAL processing.

From sharmila.radhakrishnan at intel.com  Thu Mar 19 07:26:10 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Thu, 19 Mar 2015 14:26:10 +0000
Subject: [ovs-discuss] Different types of ports that can be attached
In-Reply-To: <20150319132732.GF23411@nicira.com>
References: <1BA01C3192A665469272B2597052DDFF56EB3F9D@BGSMSX104.gar.corp.intel.com>
 <20150319132732.GF23411@nicira.com>
Message-ID: <1BA01C3192A665469272B2597052DDFF56EB40C1@BGSMSX104.gar.corp.intel.com>

Thanks a lot!

Regards,
Sharmila

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com] 
Sent: Thursday, March 19, 2015 6:58 PM
To: Radhakrishnan, Sharmila
Cc: 'discuss at openvswitch.org'
Subject: Re: [ovs-discuss] Different types of ports that can be attached

On Thu, Mar 19, 2015 at 11:10:13AM +0000, Radhakrishnan, Sharmila wrote:
> I wanted to understand, what are the different types of OVS ports that can be attached to a OVS bridge and what is the significance of each? This type is mentioned as part of the add-port command in the type parameter:
> 
> ovs-vsctl add-port testsw1 ns2iface1 -- set Interface ns2iface1 type=internal
> 
> I have seen tap,vxlan,gre,internal,patch amount the type of ports specified. I want to understand the difference between them and if there are any more ports available.

See ovs-vswitchd.conf.db(5).

From fbl at sysclose.org  Thu Mar 19 07:40:08 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Thu, 19 Mar 2015 11:40:08 -0300
Subject: [ovs-discuss] OpenVswitch controller configuration not needed
In-Reply-To: <CABpZToXZJ9Tt=-P7YqeXJQQZCdsC8FwtrAWE0xhwRQeoJfK5tA@mail.gmail.com>
References: <CABpZToX0Nn3P11UB+v6PkGqsxhmz7bNuDydTzjWmmHBo7YpvVw@mail.gmail.com>
 <20150319111257.1aa919a2@x240.home>
 <CABpZToXZJ9Tt=-P7YqeXJQQZCdsC8FwtrAWE0xhwRQeoJfK5tA@mail.gmail.com>
Message-ID: <20150319114008.4bf12328@x240.home>


Please don't drop the list.


On Thu, 19 Mar 2015 19:56:57 +0530
Prashant Singh <prashant.ietedelhi at gmail.com> wrote:

> Then how can I disable the default behavior of ovs?

Either configure a controller or control the flows
yourself using "ovs-ofctl" command.

fbl



> On 19-Mar-2015 7:44 pm, "Flavio Leitner" <fbl at sysclose.org> wrote:
> 
> > On Thu, 19 Mar 2015 09:53:25 +0530
> > Prashant Singh <prashant.ietedelhi at gmail.com> wrote:
> >
> > > Hi All
> > >
> > > I am beginner. I am trying to create virtual switch. After
> > > creating the virtual switch
> > > I think we need to set the controller and start it, but I am able
> > > to ping the nodes without setting the controller and starting it.
> > > Can any tell me what is the default behavior of the OpenV Switch.
> >
> > No, you don't need a controller.  By default OVS comes with a
> > flow that uses NORMAL action which means subjects the packet to
> > the device's normal L2/L3 processing.
> >
> > fbl
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >



From shettyg at nicira.com  Thu Mar 19 07:48:24 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 19 Mar 2015 07:48:24 -0700
Subject: [ovs-discuss] OpenVswitch controller configuration not needed
In-Reply-To: <20150319114008.4bf12328@x240.home>
References: <CABpZToX0Nn3P11UB+v6PkGqsxhmz7bNuDydTzjWmmHBo7YpvVw@mail.gmail.com>
 <20150319111257.1aa919a2@x240.home>
 <CABpZToXZJ9Tt=-P7YqeXJQQZCdsC8FwtrAWE0xhwRQeoJfK5tA@mail.gmail.com>
 <20150319114008.4bf12328@x240.home>
Message-ID: <CAHbON5qzZF0Y+-domnLKuVP2bD42p0U_an0wNpq73D-a-=ykhg@mail.gmail.com>

>> Then how can I disable the default behavior of ovs?
When you create your bridge, you can set it to secure mode. This
automatically disables NORMAL/default behavior.

An example is:
ovs-vsctl -- --may-exist add-br br-int\
            -- set bridge br-int other-config:disable-in-band=true\
            -- set bridge br-int fail-mode=secure

From shyam.pujar at nokia.com  Thu Mar 19 06:09:41 2015
From: shyam.pujar at nokia.com (Pujar, Shyam (Nokia - IN/Bangalore))
Date: Thu, 19 Mar 2015 13:09:41 +0000
Subject: [ovs-discuss] isolation between 2 tap devices
Message-ID: <54F3CC316BCACF48A126BE3ED38CD1F319AAEBA0@SGSIMBX005.nsn-intra.net>

Hi,
        I am trying to communicate between 2 tap devices over ovs bridge. Irrespective of tap devices connection to bridge, packet transfer is possible.
Kernel is not submitting the packets to bridge. Internally packets are transferred between tap devices.
Could you please help me in getting the Tx through OVS bridge?

Steps performed:
1>      Ovs-vsctl add-br ovsbr0
2>      Ovs-vsctl add-port ovsbr0 tap0
3>      Ovs-vsctl add-port ovsbr0 tap1
4>      Ip l s tap0 up
5>      Ip l s tap1 up
6>      Ip l s ovsbr0 up
7>      run receiver on tap0
8>      run sender on tap1
9>      expect traffic from tap1 -> ovsbr0 -> tap0
10>      observed is tap1->tap0



Regards,
Shyam

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150319/baeb3f4b/attachment.html>

From fbl at sysclose.org  Thu Mar 19 09:37:08 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Thu, 19 Mar 2015 13:37:08 -0300
Subject: [ovs-discuss] isolation between 2 tap devices
In-Reply-To: <54F3CC316BCACF48A126BE3ED38CD1F319AAEBA0@SGSIMBX005.nsn-intra.net>
References: <54F3CC316BCACF48A126BE3ED38CD1F319AAEBA0@SGSIMBX005.nsn-intra.net>
Message-ID: <20150319133708.3731800a@x240.home>

On Thu, 19 Mar 2015 13:09:41 +0000
"Pujar, Shyam (Nokia - IN/Bangalore)" <shyam.pujar at nokia.com> wrote:

> Hi,
>         I am trying to communicate between 2 tap devices over ovs
> bridge. Irrespective of tap devices connection to bridge, packet
> transfer is possible. Kernel is not submitting the packets to bridge.
> Internally packets are transferred between tap devices. Could you
> please help me in getting the Tx through OVS bridge?
> 
> Steps performed:
> 1>      Ovs-vsctl add-br ovsbr0
> 2>      Ovs-vsctl add-port ovsbr0 tap0
> 3>      Ovs-vsctl add-port ovsbr0 tap1
> 4>      Ip l s tap0 up
> 5>      Ip l s tap1 up
> 6>      Ip l s ovsbr0 up
> 7>      run receiver on tap0
> 8>      run sender on tap1
> 9>      expect traffic from tap1 -> ovsbr0 -> tap0
> 10>      observed is tap1->tap0

What do you mean by -> ovsbr0 -> ?  Are you running tcpdump on
ovsbr0?  If so, OVS works differently than Linux bridge and the
traffic doesn't go to the bridge's internal port.

The bridge's port works as any other port attached to the bridge.

fbl


From Sivasothy.Shanmugalingam at b-com.com  Thu Mar 19 09:42:02 2015
From: Sivasothy.Shanmugalingam at b-com.com (Sivasothy SHANMUGALINGAM)
Date: Thu, 19 Mar 2015 16:42:02 +0000
Subject: [ovs-discuss] user speace gre tunneling -with netdev-dpdk
Message-ID: <1426783288394.88698@b-com.com>

Hi!

I show the post about user space tunneling. Pls see here: http://openvswitch.org/pipermail/dev/2014-November/048267.html



However, I have questions. First, it is integrated into OVS or not.

If so, how to configure also?



Second, I am using OVDK 1.2 that uses OVS v2.1.2. In this case, I wish to create gre port in OVDK. Then preferred to bind gre port into user space tunneling module above one dpdk port (sometimes).



I guess this feature is not avaialble. If I need to develop or integrate from existing module, what could be right direction?



Thank you very much.





Best regards

Sothy




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150319/edbefddd/attachment.html>

From fbl at sysclose.org  Thu Mar 19 10:08:07 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Thu, 19 Mar 2015 14:08:07 -0300
Subject: [ovs-discuss] user speace gre tunneling -with netdev-dpdk
In-Reply-To: <1426783288394.88698@b-com.com>
References: <1426783288394.88698@b-com.com>
Message-ID: <20150319140807.09f992ed@x240.home>

On Thu, 19 Mar 2015 16:42:02 +0000
Sivasothy SHANMUGALINGAM <Sivasothy.Shanmugalingam at b-com.com> wrote:

> Second, I am using OVDK 1.2 that uses OVS v2.1.2. In this case, I

OVDK is a fork from OVS (another independent project), so I'd say
to ask in OVDK forums instead:
https://lists.01.org/mailman/listinfo/dpdk-ovs

Thanks,
fbl


From nuno.carrulo at ua.pt  Thu Mar 19 10:31:01 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Thu, 19 Mar 2015 17:31:01 +0000
Subject: [ovs-discuss] Update Queue in QoS row using NB Rest API
Message-ID: <1426786257847.92316@ua.pt>

Hello.

I'm trying to update a given qos row from QoS table. I have already created a QoS row and a Queue as well. What I want now is to update that QoS row so I can include that Queue on the "queues" field of that QoS row.

I'm using the v2 NB rest API from ovsdb to do it, I've tried several format types (see here: http://pastebin.com/RnmgQBaw) that result in 200 OK with "Success" message. However when I executed the command 'sudo ovs-vsctl list qos', the "queues" field was still empty. The url with the proper values for controller ip, ovs and qos row uuid. (URL:http://192.168.57.1:8080/ovsdb/nb/v2/node/OVS/192.168.57.102:54959/tables/qos/rows/877b75c5-a2ef-4b5e-9f7d-174562eba6c2 ).

[http://pastebin.com/i/fb2.jpg]<http://pastebin.com/RnmgQBaw>

Success requests but not working - Pastebin.com
Leia mais...<http://pastebin.com/RnmgQBaw>


I'm guessing that the problem is the json request but I can't find it.

Can you tell me how should I format the json on the queues field in order to be accepted on the switch ?

Regards,

Nuno B.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150319/bd479a94/attachment-0001.html>

From d037918 at polito.it  Thu Mar 19 11:20:01 2015
From: d037918 at polito.it (MIGNINI FABIO)
Date: Thu, 19 Mar 2015 19:20:01 +0100
Subject: [ovs-discuss] Traffic loop problem, when a controller is setted
In-Reply-To: <20150318154119.GA29009@nicira.com>
References: <web-8123081@backmail1.polito.it>
 <20150318154119.GA29009@nicira.com>
Message-ID: <web-8144268@backmail1.polito.it>

Thank you very much for your answer.
By setting the controller connection out of band I solved 
the problem.

Best regards,
Fabio Mignini

On Wed, 18 Mar 2015 08:41:19 -0700
  Ben Pfaff <blp at nicira.com> wrote:
> On Tue, Mar 17, 2015 at 06:57:58PM +0100, MIGNINI FABIO 
>wrote:
>> I have noticed an unexpected generation of traffic loop 
>>using a very simple
>> configuration of KVM and OVS.
>> In particular the configuration that trigger the problem 
>>is the one listed
>> below:
>> 
>>    +-----------------+
>>    | Virtual machine |
>>    +----+-------+----+
>>         |       |
>>  +------+-------+------+
>>  |                     |
>>  |     OVS Bridge      |
>>  +---------------------+
>> 
>> The OVS Bridge has two ports that are connected to the 
>>virtual machine.
>> Within the virtual machine there is a linux bridge that 
>>bridges both the
>> vm's interfaces.
>> I found the problem with two different configuration of 
>>the bridge:
>> 	- setting an existing OF controller (OpenDaylight)
>>         - setting a fake address for the OF controller 
>>(a not reachable IP
>> address)
>> 
>> This is the output of the 'ovs-vsctl show' command (I 
>>provide here only the
>> second configuration, as you can see the controller is 
>>not connected):
>> 
>> root at controller:~# ovs-vsctl show
>> 82f530a0-269e-4eb4-b71a-dedc9f26ccd9
>>     Bridge br-int
>>         Controller "tcp:192.168.5.3:6633"
>>         Port br-int
>>             Interface br-int
>>                 type: internal
>>         Port "vnet1"
>>             Interface "vnet1"
>>         Port "vnet0"
>>             Interface "vnet0"
>>     ovs_version: "2.3.1"
>> 
>> The only flow in the OVS bridge "br-int" is a DROP flow, 
>>without any match
>> (inserted manually before the starting of the virtual 
>>machine).
>> This is the output of the 'ovs-ofctl dump-flows br-int' 
>>command:
>> 
>> root at controller:~# ovs-ofctl dump-flows br-int
>> NXST_FLOW reply (xid=0x4):
>>  cookie=0x0, duration=232.952s, table=0, n_packets=0, 
>>n_bytes=0,
>> idle_age=232, priority=1 actions=drop
>> 
>> With this configuration I was expecting that all the 
>>traffic will be dropped
>> by the OVS Bridge (as happens when no controller is 
>>setted).
>> Instead a traffic loop is generated between the two 
>>ports in the bridge.
>> It seems that the DROP flow rule is not working as 
>>expected.
> 
> One possibility is that you've got hidden flows due to 
>the in-band
> controller configuration.  Try "ovs-appctl 
>bridge/dump-flows br-int" to
> check for thtat.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From stuartaryan+ovs at gmail.com  Fri Mar 20 05:45:01 2015
From: stuartaryan+ovs at gmail.com (Stuart Ryan)
Date: Fri, 20 Mar 2015 12:45:01 +0000
Subject: [ovs-discuss] Building a physical switch with OVS
Message-ID: <CALQZsHmKk5rNpvWjc_3TsyUaYW-YrORzY2KHzNycbOvEprYmSA@mail.gmail.com>

Hi all,
  I am a newcomer to open vSwith, and am having some configuration
difficulties. In my experiment I'm trying to build an OpenFlow Ethernet
switch box from a PC running open vSwitch.

I am in the following situation:

- OVS and controller can see each other
- controller can see directly connected hosts (e.g. LLDP messages are being
flooded)

However when I try to ping from one host to another the following happens
(as observed on wireshark at the controller and each of the hosts:
- ARP request from host1 is sent to controller
- controller tells OVS to flood ARP request back
- host2 receives ARP request
- host2 replies to ARP request
-....

The ARP response from host2 is not being sent back to the controller.

The connection between the controller and OVS is via an interface which is
not part of the OVS bridge. As such I tried setting the connection mode to
out-of-band, but this did not make any noticeable difference.

# ovs-vsctl show
2df4df24-9de6-4978-9242-6ab64be12bd8
    Bridge "br0"
        Controller "tcp:10.0.10.10:6633"
            is_connected: true
        Port "br0"
            Interface "br0"
                type: internal
        Port "eth2"
            Interface "eth2"
        Port "eth3"
            Interface "eth3"
    ovs_version: "2.3.1"

# ovs-vsctl list controller
_uuid                               : 0a995a47-c227-4300-b3b2-13e4bc4c46a9
connection_mode:            : out-of-band
controller_burst_limit        : []
controller_rate_limit          : []
enable_async_messages : []
external_ids                    : {}
inactivity_probe               : []
is_connected                   : true
local_gateway                 : []
local_ip                          : []
local_netmask                :[]
max_backoff                  : []
other_config                   : {}
role                                : other
status                            : {sec_since_connect="311", state=ACTIVE}
target                            : "tcp:10.0.10.10:6633"

# ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=649.065s, table=0, n_packets=43, n_bytes=9761,
idle_age=17, priority=0, actions=CONTROLLER:65535



Any advise on how to correctly configure this set-up appreciated.

Thanks for your time,
Stuart.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150320/a08396c7/attachment.html>

From sharmila.radhakrishnan at intel.com  Fri Mar 20 06:02:48 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Fri, 20 Mar 2015 13:02:48 +0000
Subject: [ovs-discuss]  Performance of OVS switch
Message-ID: <1BA01C3192A665469272B2597052DDFF56EB4990@BGSMSX104.gar.corp.intel.com>

Hi All,

I wanted to understand, what is the maximum performance you can get with OVS switch.

I have connected 2 VMs to an OVS switch using Tap interface which are on the same network. When I sent packets(using PcktGen application) from 1 VM to another, I get very low performance. 

For 64byte packet size, the throughput is ~5Mbps, 128B packet size it is 9Mbps and 254b packet size it is 16Mbps. 

What is the maximum throughput that can be achieved with an OVS switch.

Thanks in advance.

Regards,
Sharmila


From jpettit at nicira.com  Fri Mar 20 08:25:27 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Fri, 20 Mar 2015 08:25:27 -0700
Subject: [ovs-discuss] Performance of OVS switch
In-Reply-To: <1BA01C3192A665469272B2597052DDFF56EB4990@BGSMSX104.gar.corp.intel.com>
References: <1BA01C3192A665469272B2597052DDFF56EB4990@BGSMSX104.gar.corp.intel.com>
Message-ID: <3726A100-54F7-4E79-AAD7-5D2449293CA2@nicira.com>

It's obviously dependent on many factors, but on reasonable hardware, I'd expect gigabits per second. 

--Justin


> On Mar 20, 2015, at 6:02 AM, Radhakrishnan, Sharmila <sharmila.radhakrishnan at intel.com> wrote:
> 
> Hi All,
> 
> I wanted to understand, what is the maximum performance you can get with OVS switch.
> 
> I have connected 2 VMs to an OVS switch using Tap interface which are on the same network. When I sent packets(using PcktGen application) from 1 VM to another, I get very low performance. 
> 
> For 64byte packet size, the throughput is ~5Mbps, 128B packet size it is 9Mbps and 254b packet size it is 16Mbps. 
> 
> What is the maximum throughput that can be achieved with an OVS switch.
> 
> Thanks in advance.
> 
> Regards,
> Sharmila
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From hengc39 at gmail.com  Fri Mar 20 12:07:12 2015
From: hengc39 at gmail.com (Luca)
Date: Fri, 20 Mar 2015 20:07:12 +0100
Subject: [ovs-discuss] OVS buffer packet
Message-ID: <CAKmE+0jRKg8c=K3QsHAoz8xcap=5V4e=TNU7_at0F=90GS4yFA@mail.gmail.com>

Hello

I am using OVS to simulate a virtual OpenFlow, I see that by default, OVS
does not buffer the incoming packet, therefore, the controller software
needs to sends a PacketOut after FLOW_MOD..

I am wondering is there a kind of configuration(e.g. by command line) that
enable OVS to buffer the packet so that we don't need to send a PacketOut
to the virtual switch?


Thank you so much

Luca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150320/d474e0c3/attachment.html>

From stuartaryan+ovs at gmail.com  Fri Mar 20 12:59:46 2015
From: stuartaryan+ovs at gmail.com (Stuart Ryan)
Date: Fri, 20 Mar 2015 19:59:46 +0000
Subject: [ovs-discuss] Building a physical switch with OVS
In-Reply-To: <CALQZsHmKk5rNpvWjc_3TsyUaYW-YrORzY2KHzNycbOvEprYmSA@mail.gmail.com>
References: <CALQZsHmKk5rNpvWjc_3TsyUaYW-YrORzY2KHzNycbOvEprYmSA@mail.gmail.com>
Message-ID: <CALQZsHmYT5GnnHagSEZRPhkhjRCvuJWj_NSOQAiMgZd8NhKkSg@mail.gmail.com>

Hi all,
  Please ignore this - a low user IQ error. I hadn't set the interfaces to
be in promiscuous mode.
Regards,
Stuart.

On Fri, Mar 20, 2015 at 12:45 PM, Stuart Ryan <stuartaryan+ovs at gmail.com>
wrote:

> Hi all,
>   I am a newcomer to open vSwith, and am having some configuration
> difficulties. In my experiment I'm trying to build an OpenFlow Ethernet
> switch box from a PC running open vSwitch.
>
> I am in the following situation:
>
> - OVS and controller can see each other
> - controller can see directly connected hosts (e.g. LLDP messages are
> being flooded)
>
> However when I try to ping from one host to another the following happens
> (as observed on wireshark at the controller and each of the hosts:
> - ARP request from host1 is sent to controller
> - controller tells OVS to flood ARP request back
> - host2 receives ARP request
> - host2 replies to ARP request
> -....
>
> The ARP response from host2 is not being sent back to the controller.
>
> The connection between the controller and OVS is via an interface which is
> not part of the OVS bridge. As such I tried setting the connection mode to
> out-of-band, but this did not make any noticeable difference.
>
> # ovs-vsctl show
> 2df4df24-9de6-4978-9242-6ab64be12bd8
>     Bridge "br0"
>         Controller "tcp:10.0.10.10:6633"
>             is_connected: true
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "eth2"
>             Interface "eth2"
>         Port "eth3"
>             Interface "eth3"
>     ovs_version: "2.3.1"
>
> # ovs-vsctl list controller
> _uuid                               : 0a995a47-c227-4300-b3b2-13e4bc4c46a9
> connection_mode:            : out-of-band
> controller_burst_limit        : []
> controller_rate_limit          : []
> enable_async_messages : []
> external_ids                    : {}
> inactivity_probe               : []
> is_connected                   : true
> local_gateway                 : []
> local_ip                          : []
> local_netmask                :[]
> max_backoff                  : []
> other_config                   : {}
> role                                : other
> status                            : {sec_since_connect="311", state=ACTIVE}
> target                            : "tcp:10.0.10.10:6633"
>
> # ovs-ofctl dump-flows br0
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=649.065s, table=0, n_packets=43, n_bytes=9761,
> idle_age=17, priority=0, actions=CONTROLLER:65535
>
>
>
> Any advise on how to correctly configure this set-up appreciated.
>
> Thanks for your time,
> Stuart.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150320/f5b502ac/attachment.html>

From blp at nicira.com  Fri Mar 20 14:35:09 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 20 Mar 2015 14:35:09 -0700
Subject: [ovs-discuss] OVS buffer packet
In-Reply-To: <CAKmE+0jRKg8c=K3QsHAoz8xcap=5V4e=TNU7_at0F=90GS4yFA@mail.gmail.com>
References: <CAKmE+0jRKg8c=K3QsHAoz8xcap=5V4e=TNU7_at0F=90GS4yFA@mail.gmail.com>
Message-ID: <20150320213509.GB6038@nicira.com>

On Fri, Mar 20, 2015 at 08:07:12PM +0100, Luca wrote:
> I am using OVS to simulate a virtual OpenFlow, I see that by default, OVS
> does not buffer the incoming packet, therefore, the controller software
> needs to sends a PacketOut after FLOW_MOD..
> 
> I am wondering is there a kind of configuration(e.g. by command line) that
> enable OVS to buffer the packet so that we don't need to send a PacketOut
> to the virtual switch?

OVS does use buffers by default.  I don't know why you would see
different behavior.

From djhon9813 at gmail.com  Sat Mar 21 00:46:25 2015
From: djhon9813 at gmail.com (david jhon)
Date: Sat, 21 Mar 2015 12:46:25 +0500
Subject: [ovs-discuss] Identify outgoing packets belonging to VXLAN or GRE
	tunnels in kernel
Message-ID: <CANPUzQ2oYiJs44DAMfXwueibT9jckodDAKKUCKTn7e-WOEvYkw@mail.gmail.com>

Hi All,

I am working on OVS datapath, adding my code based on flow stats. I want to
identify outgoing packets belonging to VXLAN or GRE tunnels. I can see
gre_send() and __send() methods in datapath/vport-gre.c but I am not
getting how does ovs_execute_actions() method identify tunnel ports.
Any help regarding this would be highly appreciated. Thanks a lot!

Regards,
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150321/0d8c3d02/attachment.html>

From stefano.salsano at uniroma2.it  Sat Mar 21 01:03:16 2015
From: stefano.salsano at uniroma2.it (Stefano Salsano)
Date: Sat, 21 Mar 2015 09:03:16 +0100
Subject: [ovs-discuss] Performance of OVS switch
In-Reply-To: <3726A100-54F7-4E79-AAD7-5D2449293CA2@nicira.com>
References: <1BA01C3192A665469272B2597052DDFF56EB4990@BGSMSX104.gar.corp.intel.com>
 <3726A100-54F7-4E79-AAD7-5D2449293CA2@nicira.com>
Message-ID: <550D25C4.2020704@uniroma2.it>

 >> On Mar 20, 2015, at 6:02 AM, Radhakrishnan, Sharmila 
<sharmila.radhakrishnan at intel.com> wrote:
 >>
 >> Hi All,
 >>
 >> I wanted to understand, what is the maximum performance you can get 
with OVS switch.

Il 20/03/2015 16:25, Justin Pettit ha scritto:
> It's obviously dependent on many factors, but on reasonable hardware, I'd expect gigabits per second.
>

yes, hardware is the first factor, but note also that without further 
details on your test setup it is difficult to understand what are you 
actually measuring: the bottleneck could be external to open vswitch

for example if you are using tap (with tunneling in user space) you are 
typically spending lots of your CPU cycles in tunneling rather than 
switching

see some results in the following paper

http://netgroup.uniroma2.it/Stefano_Salsano/papers/salsano-oshi-ewsdn-2014.pdf
S. Salsano, P. L. Ventre, L. Prete, G. Siracusano, M. Gerola, E. 
Salvadori, “Open Source Hybrid IP/SDN networking (and its emulation on 
Mininet and on distributed SDN testbeds)”, 3rd European Workshop on 
Software Defined Networks, EWSDN 2014, 1-3 September 2014, Budapest, Hungary

>> I have connected 2 VMs to an OVS switch using Tap interface which are on the same network. When I sent packets(using PcktGen application) from 1 VM to another, I get very low performance.
>>
>> For 64byte packet size, the throughput is ~5Mbps, 128B packet size it is 9Mbps and 254b packet size it is 16Mbps.
>>
>> What is the maximum throughput that can be achieved with an OVS switch.
>>
>> Thanks in advance.
>>
>> Regards,
>> Sharmila
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>


-- 
*******************************************************************
Stefano Salsano
Professore Associato
Dipartimento Ingegneria Elettronica
Universita' di Roma Tor Vergata
Via del Politecnico, 1 - 00133 Roma - ITALY

http://netgroup.uniroma2.it/Stefano_Salsano/

E-mail  : stefano.salsano at uniroma2.it
Cell.   : +39 320 4307310
Office  : (Tel.) +39 06 72597770  (Fax.) +39 06 72597435
*******************************************************************

From nick.bastin at gmail.com  Sat Mar 21 01:33:03 2015
From: nick.bastin at gmail.com (Nicholas Bastin)
Date: Sat, 21 Mar 2015 04:33:03 -0400
Subject: [ovs-discuss] Performance of OVS switch
In-Reply-To: <3726A100-54F7-4E79-AAD7-5D2449293CA2@nicira.com>
References: <1BA01C3192A665469272B2597052DDFF56EB4990@BGSMSX104.gar.corp.intel.com>
 <3726A100-54F7-4E79-AAD7-5D2449293CA2@nicira.com>
Message-ID: <CADmMkWcPhUkFyvArfu2pyk+si=4Vv5qFuERY_MZ7BeJnDNVTKw@mail.gmail.com>

>
> > On Mar 20, 2015, at 6:02 AM, Radhakrishnan, Sharmila <
> sharmila.radhakrishnan at intel.com> wrote:
> > I wanted to understand, what is the maximum performance you can get with
> OVS switch.
>

In a high performance environment this is generally directly correlated to
the memory bandwidth available on your system.  The CPU cycles consumed for
forwarding pale in comparison to the limitations incurred by memory copies.
 (This does not apply directly to DPDK, which has slightly different
scaling factors, although memory bandwidth still applies)


> > I have connected 2 VMs to an OVS switch using Tap interface which are on
> the same network. When I sent packets(using PcktGen application) from 1 VM
> to another, I get very low performance.
>
> > For 64byte packet size, the throughput is ~5Mbps, 128B packet size it is
> 9Mbps and 254b packet size it is 16Mbps.
>

This is awful - you should be able to get at least an order of magnitude
better pps performance on even a moderately sized system.  I suspect that
something is wrong with your VM environment.  What hypervisor are you using
(Xen, KVM, etc.) and what do your guests report as their ethernet drivers?
Also what are the specs of your test system?  (What CPU, what motherboard,
how many DIMMs, etc.)

> What is the maximum throughput that can be achieved with an OVS switch.
>

At large packet sizes on quad-channel systems we've been able to run
hundreds of gigabits, although that was pretty specialized (paying
particular attention to memory and CPU architectures, etc.).  Certainly
600k-800k packets per second is not unreasonable without trying too hard to
optimize, so you've got some other problem.

--
Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150321/84d9aae8/attachment.html>

From djhon9813 at gmail.com  Sat Mar 21 03:38:32 2015
From: djhon9813 at gmail.com (david jhon)
Date: Sat, 21 Mar 2015 15:38:32 +0500
Subject: [ovs-discuss] Identify outgoing packets belonging to VXLAN or
	GRE tunnels in kernel
In-Reply-To: <CANPUzQ2oYiJs44DAMfXwueibT9jckodDAKKUCKTn7e-WOEvYkw@mail.gmail.com>
References: <CANPUzQ2oYiJs44DAMfXwueibT9jckodDAKKUCKTn7e-WOEvYkw@mail.gmail.com>
Message-ID: <CANPUzQ3kv4=VeQ6-XU82ZZrkZrO7YJjqu4pcLaEL3cv_P7L9zg@mail.gmail.com>

I have one more query:
After debugging ovs kernel module with printk, I have concluded that
following methods are involved in flow processing for outgoing packets:

1. internal_device_xmit()
2. ovs_vport_receive()
3. ovs_flow_key_extract()
4. ovs_dp_process_packet()
5. if(!ovs_flow_table_lookup_stats())
           ovs_dp_upcall()

6. execute_actions

In case of VXLAN or GRE tunnels, incoming packets are processed by
vxlan_recv() and gre_recv() respectively. similarly, outgoing packets are
handled by vxlan_tnl_send() and gre_send(). These methods are responsible
to push gre or vxlan headers to outgoing packets.

In order to process incoming packets, an rx_handler is used to register a
netdev_frame_hook() in vport-netdev.c file which calls
netdev_port_receive() and which in turn calls ovs_vport_receive(). Rest is
same as in case of outgoing packets.

Please let me know to what extent am I right in understanding the sequence
of method calls for processing of incoming and outgoing packets on ovs.
I'll be really grateful for your guideline and help. Thanks a lot!

On Sat, Mar 21, 2015 at 12:46 PM, david jhon <djhon9813 at gmail.com> wrote:

> Hi All,
>
> I am working on OVS datapath, adding my code based on flow stats. I want
> to identify outgoing packets belonging to VXLAN or GRE tunnels. I can see
> gre_send() and __send() methods in datapath/vport-gre.c but I am not
> getting how does ovs_execute_actions() method identify tunnel ports.
> Any help regarding this would be highly appreciated. Thanks a lot!
>
> Regards,
> David
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150321/b78e9112/attachment.html>

From deena_m_in at yahoo.com  Fri Mar 20 09:40:32 2015
From: deena_m_in at yahoo.com (deena mukundan)
Date: Fri, 20 Mar 2015 16:40:32 +0000 (UTC)
Subject: [ovs-discuss] OVS not forwarding the first packet
Message-ID: <836117712.898550.1426869632567.JavaMail.yahoo@mail.yahoo.com>

Hi all, We are having a setup where we've attached a OVS to ODL controller and OVS is connected. The OVS is in turn connected to Open stack and we have servers running in the VM.  We've configured the load balancer application in ODL, so that load balancing of Clients connections against Server can be achieved by flow rules.  When the first Client Packet is received by OVS, OVS forwards the packet to ODL controller. ODL controller creates rules and sends flow add request to OVS. Flow rules are created for both forward and reverse path to replace destination VIP address to chosen server IP address & Mac-address of the qrouter(of the next hop) . In the reverse path to replace the source as VIP address.   From ODL controller, we generated a packet_out for the initial packet with action to put on o/p port. It was observed that this packet was received by the OVS, but not forwarded further. We could enable snooping and verify that this packet was received by OVS. Also, we verified the counters it didn't display any drop packets.  But all subsequent packets sent from Client to Server are traversing through this rule and are correctly getting forwarded.  We also tried to modify the packet_out to go through the flow table rule instead of putting to the output port . Here also , we see that the packet was received by the OVS but was not forwarded further. Has anyone faced this kind of issue ? Any help is appreciated.  Regards,
Deena
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150320/191b9003/attachment.html>

From pg201372016 at iitj.ac.in  Sat Mar 21 10:32:28 2015
From: pg201372016 at iitj.ac.in (Sumit Paliwal)
Date: Sat, 21 Mar 2015 23:02:28 +0530
Subject: [ovs-discuss] Priority of flows in openvswitch code
In-Reply-To: <20150318180705.GA16202@nicira.com>
References: <CAEhKQHJ0uKFQyLPt4Prsj2y2UhbiJno+QGdbHF75O1Q1YCmYow@mail.gmail.com>
 <20150317183320.GJ11929@nicira.com>
 <CAEhKQHLdT8a6jyYtnYmvC9WEbL1O9y5kS7LxpfB=rWUDEPtV5w@mail.gmail.com>
 <20150317184304.GO11929@nicira.com>
 <CAEhKQHL1NA=wOX4Vb7nkR1cGNymiSP=KZ1GLzW0MHwxRgfFeOw@mail.gmail.com>
 <20150317193832.GQ11929@nicira.com>
 <CAEhKQHKkr7s0Ug9wqanC+Lu4kpCMVVhZuayFTYAN0YbJ5V96Cg@mail.gmail.com>
 <20150318180705.GA16202@nicira.com>
Message-ID: <CAEhKQHJ7pzw5u=F-EA8qKPguC3okR=HeN-NoRMx7-_6NTJZOZg@mail.gmail.com>

I've a question about the possibility of implementing a particular method
in the openvswitch.

I'm sending 2 different flows for same source-destination pair with
different priority values from controller to switch. Now I want to switch
between these flows( Sending packets through higher priority flow for first
few packets and than through lower priority flow ).

So as I've come to know by our discussion, that it is not even possible to
store 2 flows in the kernel implementation, so there is no possibility of
the above scenario in that case.

Now, My question is, Can that be done in openvswitch? If yes, kindly guide
me in this regard.

Thanks,

On Wed, Mar 18, 2015 at 11:37 PM, Ben Pfaff <blp at nicira.com> wrote:

> Please don't drop the list.
>
> "ovs-dpctl dump-flows"
>
> On Wed, Mar 18, 2015 at 11:03:36PM +0530, Sumit Paliwal wrote:
> > So as you have said that ovs-ofctl command can see all the flow.
> > Is there any command, by which I can see all the flows installed in flow
> > table in kernel level.
> >
> > On Wed, Mar 18, 2015 at 1:08 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Wed, Mar 18, 2015 at 12:25:42AM +0530, Sumit Paliwal wrote:
> > > > (1) I want to know that, I'm sending two different paths for one
> > > > destination from controller to switch, I've set different priorities
> for
> > > > both of them, and I could see those flows properly inserted in the
> flow
> > > > table with ofctl command. But now if it is not possible to access the
> > > > priority from kernel, from where can i access that.
> > >
> > > ovs-ofctl or another OpenFlow controller can see the priorities.
> > >
> > > > Is there any else parameter that i can use to differentiate these 2
> flows
> > > > from kernel.
> > >
> > > If the flows have the same flow match, then only the higher-priority
> > > one will ever get installed in the kernel, so you can always know
> > > that's the one.
> > >
> >
> >
> >
> > --
> > Sumit Paliwal
> > M.Tech. ICT,
> > IIT Jodhpur
> >
> >
> > *"Have a great Day... "*
>



-- 
Sumit Paliwal
M.Tech. ICT,
IIT Jodhpur


*"Have a great Day... "*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150321/65e9a4d2/attachment-0001.html>

From blp at nicira.com  Sat Mar 21 19:08:38 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 21 Mar 2015 19:08:38 -0700
Subject: [ovs-discuss] Priority of flows in openvswitch code
In-Reply-To: <CAEhKQHJ7pzw5u=F-EA8qKPguC3okR=HeN-NoRMx7-_6NTJZOZg@mail.gmail.com>
References: <CAEhKQHJ0uKFQyLPt4Prsj2y2UhbiJno+QGdbHF75O1Q1YCmYow@mail.gmail.com>
 <20150317183320.GJ11929@nicira.com>
 <CAEhKQHLdT8a6jyYtnYmvC9WEbL1O9y5kS7LxpfB=rWUDEPtV5w@mail.gmail.com>
 <20150317184304.GO11929@nicira.com>
 <CAEhKQHL1NA=wOX4Vb7nkR1cGNymiSP=KZ1GLzW0MHwxRgfFeOw@mail.gmail.com>
 <20150317193832.GQ11929@nicira.com>
 <CAEhKQHKkr7s0Ug9wqanC+Lu4kpCMVVhZuayFTYAN0YbJ5V96Cg@mail.gmail.com>
 <20150318180705.GA16202@nicira.com>
 <CAEhKQHJ7pzw5u=F-EA8qKPguC3okR=HeN-NoRMx7-_6NTJZOZg@mail.gmail.com>
Message-ID: <20150322020838.GB20079@nicira.com>

On Sat, Mar 21, 2015 at 11:02:28PM +0530, Sumit Paliwal wrote:
> I've a question about the possibility of implementing a particular method
> in the openvswitch.
> 
> I'm sending 2 different flows for same source-destination pair with
> different priority values from controller to switch. Now I want to switch
> between these flows( Sending packets through higher priority flow for first
> few packets and than through lower priority flow ).
> 
> So as I've come to know by our discussion, that it is not even possible to
> store 2 flows in the kernel implementation, so there is no possibility of
> the above scenario in that case.
> 
> Now, My question is, Can that be done in openvswitch? If yes, kindly guide
> me in this regard.

You can change the OpenFlow flow table at any time, using OpenFlow.  OVS
will then update the kernel flow table.

From tomhillfor at gmail.com  Sat Mar 21 11:05:02 2015
From: tomhillfor at gmail.com (Tommy Hilfiger)
Date: Sat, 21 Mar 2015 23:35:02 +0530
Subject: [ovs-discuss] Fwd: Problem with vxlan configuration
In-Reply-To: <CANKQohYhTWet0OUphojDJcsDshQtL+J0bYBBj+VgQqeCUk0+yg@mail.gmail.com>
References: <CANKQohZw0+=hZ3m-mUxNTngyUydqOJ6S92rkRSdi7UZoffK0=g@mail.gmail.com>
 <CANKQohYhTWet0OUphojDJcsDshQtL+J0bYBBj+VgQqeCUk0+yg@mail.gmail.com>
Message-ID: <CANKQohatf+vm4o05t_73M7Ac8y6G2hZD4KdjVO_pVY+Q9mfjQg@mail.gmail.com>

Hello everyone. I am trying to configure a vxlan tunnel. Here is the setup
I have.
I have two individual linux machines ( L1 with ip 192.168.0.100 & L2 with
ip 192.168.0.101 ) in the network each reachable from one another. I have
simulated one virtual switch s1 and a host h1 in both the machines using
mininet.

    ​​[image: Inline image 1]

I created a vxlan port on switches on both the machines using following
commands

1. On L1 =  ovs-vsctl add-port s1 vtep -- set interface vtep type=vxlan
option:remote_ip=192.168.0.101 option:key=flow ofport_request=10
2. On L2 = ovs-vsctl add-port s1 vtep -- set interface vtep type=vxlan
option:remote_ip=192.168.0.100 option:key=flow ofport_request=10

I used the following video for reference
https://www.youtube.com/watch?v=tnSkHhsLqpM&noredirect=1

I installed flows in the switches as shown in the video. Now when I try to
ping from 10.0.0.1 to 10.0.0.2, the ping fails. I did a packet capture on
the physical interface of machines L1 and L2 and I was able to see the
VXLAN packets when I ping. But I do not know what happens to these packets
as I do not get any response from the ping. Could someone tell me what I am
missing? or what am I doing wrong?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150321/10704f1e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 28547 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150321/10704f1e/attachment-0001.png>

From hengc39 at gmail.com  Sun Mar 22 14:04:20 2015
From: hengc39 at gmail.com (Luca)
Date: Sun, 22 Mar 2015 22:04:20 +0100
Subject: [ovs-discuss] OVS buffer packet
In-Reply-To: <20150320213509.GB6038@nicira.com>
References: <CAKmE+0jRKg8c=K3QsHAoz8xcap=5V4e=TNU7_at0F=90GS4yFA@mail.gmail.com>
 <20150320213509.GB6038@nicira.com>
Message-ID: <CAKmE+0hYvC1=vc7g9DDSt5BFMo6550ZWtsyHX-Hy3ORsV2ekmA@mail.gmail.com>

Hi

Thanks a lot for your info..What I did is as following:

0. I set up different VMs(Ubuntu 14.04, kernel 3.13.0-46) in virtualbox
which is to run OVS and an SDN controller (e.g. I tried both floodlight and
ONOS)

1. Download ovs files (I tried 2 versions 2.3.90 and 2.3.1), followed the
instruction in INSTALL.Debian.md file,  and 'fakeroot debian/rules binary'
to generate list of *.deb files.

2. install packages: openvswitch-datapath-dkms,
openvswitch-datapath-source, openvswitch-common, openvswitch-switch.

3. follow these command to setup OVS:

*        ovs-vsctl add-br br0*
*        ovs-vsctl add-port br0 eth1*
*        ovs-vsctl set Bridge br0 protocols=OpenFlow10   #Note that I tried
both OpenFlow v1.0 and v1.3*
*        ifconfig eth1 0*
*        ifconfig br0 192.168.56.103 netmask 255.255.255.0*
*        route add default gw 192.168.56.103 br0**        ovs-vsctl
set-controller br0 tcp:192.168.56.101:6633 <http://192.168.56.101:6633>*

4. then, I make a ping test, while using wireshark to capture the traffic
at controller..As seen from the snapshot (as attached), the BufferId in the
PacketIn is 0xffffffff which indicates packet was not buffered in the OVS.

I searched around by google and haven't found other information.

I will very appreciate if you can help me to figure it out.


Thank you so much.
Best
Luca

On Fri, Mar 20, 2015 at 10:35 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Mar 20, 2015 at 08:07:12PM +0100, Luca wrote:
> > I am using OVS to simulate a virtual OpenFlow, I see that by default, OVS
> > does not buffer the incoming packet, therefore, the controller software
> > needs to sends a PacketOut after FLOW_MOD..
> >
> > I am wondering is there a kind of configuration(e.g. by command line)
> that
> > enable OVS to buffer the packet so that we don't need to send a PacketOut
> > to the virtual switch?
>
> OVS does use buffers by default.  I don't know why you would see
> different behavior.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150322/d80c8729/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Capture.PNG
Type: image/png
Size: 63400 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150322/d80c8729/attachment-0001.png>

From focus.lilin at huawei.com  Sun Mar 22 20:54:48 2015
From: focus.lilin at huawei.com (Lilin (pineorange, IT))
Date: Mon, 23 Mar 2015 03:54:48 +0000
Subject: [ovs-discuss] icmp packet
Message-ID: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>

Hi,

Recently I had a problem when I tried to set NXM_OF_ICMP_TYPE and NXM_OF_ICMP_CODE items in ip packet by adding flow-entries on ovs bridge. As Follows:

root at it_207:~# ovs-ofctl add-flow br-int -O OpenFlow10 "table=0,priority=44,icmp,ip_dst=192.168.1.16, actions=move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],mod_dl_src:fa:16:3e:6b:1e:60, load:0x08->NXM_OF_ICMP_TYPE[],load:0x00->NXM_OF_ICMP_CODE[], move:NXM_OF_IP_SRC[]->NXM_OF_IP_DST[], load:0xc0a80110->NXM_OF_IP_SRC[],IN_PORT"
2015-03-19T11:01:22Z|00001|meta_flow|WARN|destination field icmp_type is not writable
ovs-ofctl: actions are invalid with specified match (OFPBAC_BAD_SET_ARGUMENT)


My OVS version is 2.3.90:

root at it_207:~# ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.3.90
Compiled Mar  5 2015 10:31:02
DB Schema 7.7.0


I want to know that, does OVS support modifing TYPE and CODE items in icmp packet? If not, is there any other methods that I can achieve my destination?


Thanks!

Li Lin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150323/3729a96d/attachment.html>

From focus.lilin at huawei.com  Sun Mar 22 21:01:06 2015
From: focus.lilin at huawei.com (Lilin (pineorange, IT))
Date: Mon, 23 Mar 2015 04:01:06 +0000
Subject: [ovs-discuss] Consultation : Does OVS(OpenFlow1.3+nicira) support
 modifing TYPE and CODE items in icmp packet?
Message-ID: <9F432A351CF9E14D99A6DF69B4557FBF72F79160@nkgeml506-mbx.china.huawei.com>

Hi,

Recently I had a problem when I tried to set NXM_OF_ICMP_TYPE and NXM_OF_ICMP_CODE items in ip packet by adding flow-entries on ovs bridge. I used OpenFlow 1.3 as the OpenFlow version. The add flow command and returned errors are as Follows:

root at it_207:~# ovs-ofctl add-flow br-int -O OpenFlow10 "table=0,priority=44,icmp,ip_dst=192.168.1.16, actions=move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],mod_dl_src:fa:16:3e:6b:1e:60, load:0x08->NXM_OF_ICMP_TYPE[],load:0x00->NXM_OF_ICMP_CODE[], move:NXM_OF_IP_SRC[]->NXM_OF_IP_DST[], load:0xc0a80110->NXM_OF_IP_SRC[],IN_PORT"
2015-03-19T11:01:22Z|00001|meta_flow|WARN|destination field icmp_type is not writable
ovs-ofctl: actions are invalid with specified match (OFPBAC_BAD_SET_ARGUMENT)


My OVS version is 2.3.90:

root at it_207:~# ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.3.90
Compiled Mar  5 2015 10:31:02
DB Schema 7.7.0


I want to know that, does OVS support modifing TYPE and CODE items in icmp packet? If not, is there any other methods that I can achieve my destination?


Thanks!

Li Lin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150323/f45862b0/attachment.html>

From ildarkarimov22 at gmail.com  Mon Mar 23 01:38:20 2015
From: ildarkarimov22 at gmail.com (Ildar Karimov)
Date: Mon, 23 Mar 2015 13:38:20 +0500
Subject: [ovs-discuss] Question about Open vSwitch routing
Message-ID: <CABq-Kp4Tyh2gnmsX=LXPU=J6xRSevY_Srvj9QLW4o5bsR79k=A@mail.gmail.com>

Hi. I have a question about Open vSwitch.
I'm sorry if i write to wrong email, but this email was in FAQ part.

Question: Is it possible to use the Open vSwitch for routing?  I mean,
 can this software provide me with forwarding and route table in user
space?

I'm looking for software which from one side will interact with
routing daemon (quagga for example), and from another side interact
with hardware (I will adapt  soft for my hardware, so it's ok, if it's
not support my hardware).  So, i want software which can support
quagga in user space like kernel does. Can Open vSwitch help me with
this?

I'm sorry for my english :)

Sincerely,

Ildar Karimov

From blp at nicira.com  Mon Mar 23 08:59:30 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 08:59:30 -0700
Subject: [ovs-discuss] icmp packet
In-Reply-To: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
References: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
Message-ID: <20150323155930.GB31376@nicira.com>

On Mon, Mar 23, 2015 at 03:54:48AM +0000, Lilin (pineorange, IT) wrote:
> Recently I had a problem when I tried to set NXM_OF_ICMP_TYPE and NXM_OF_ICMP_CODE items in ip packet by adding flow-entries on ovs bridge. As Follows:
> 
> root at it_207:~# ovs-ofctl add-flow br-int -O OpenFlow10 "table=0,priority=44,icmp,ip_dst=192.168.1.16, actions=move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],mod_dl_src:fa:16:3e:6b:1e:60, load:0x08->NXM_OF_ICMP_TYPE[],load:0x00->NXM_OF_ICMP_CODE[], move:NXM_OF_IP_SRC[]->NXM_OF_IP_DST[], load:0xc0a80110->NXM_OF_IP_SRC[],IN_PORT"
> 2015-03-19T11:01:22Z|00001|meta_flow|WARN|destination field icmp_type is not writable
> ovs-ofctl: actions are invalid with specified match (OFPBAC_BAD_SET_ARGUMENT)
> 
> 
> My OVS version is 2.3.90:
> 
> root at it_207:~# ovs-vsctl --version
> ovs-vsctl (Open vSwitch) 2.3.90
> Compiled Mar  5 2015 10:31:02
> DB Schema 7.7.0
> 
> 
> I want to know that, does OVS support modifing TYPE and CODE items in icmp packet? If not, is there any other methods that I can achieve my destination?

OVS doesn't yet support modifying the type or code in ICMP.

You could do this with an OpenFlow controller.

From davidjoshuaevans at gmail.com  Mon Mar 23 09:47:41 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Mon, 23 Mar 2015 11:47:41 -0500
Subject: [ovs-discuss] Pop Multiple MPLS tag performance.
Message-ID: <D135ADDD.25469%davidjoshuaevans@gmail.com>

Hi OVS wizards!

I have found that I can pop 1 mpls tag at line rate on DPDK interfaces which
is excellent!

But I find performance drops a good 30% or more when popping 2 mpls tags.
Why would this be and where do I look to tinker with it?



Regards,
Dave


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150323/d66b2bff/attachment.html>

From john.hurley at netronome.com  Mon Mar 23 09:49:17 2015
From: john.hurley at netronome.com (John Hurley)
Date: Mon, 23 Mar 2015 16:49:17 +0000
Subject: [ovs-discuss] ovs-conntrack kernel panic
Message-ID: <CAK+XE=k9Oq8Pii+DEva2ZJ_YcCAz3Nxys=ojOHraTAdWKE4iCg@mail.gmail.com>

*Hi,*


*I am interested in using Conntrack within OVS and have installed the
latest version from the banch
(https://github.com/justinpettit/ovs/tree/conntrack).
<https://github.com/justinpettit/ovs/tree/conntrack>*

*When I run an example mentioned in the tests:*



*ovs-ofctl del-flows br0
ovs-ofctl add-flow br0 \
    "in_port=1,conn_state=-trk,tcp,action=ct(commit,zone=9),2"
ovs-ofctl add-flow br0 \
    "in_port=2,conn_state=-trk,tcp,action=ct(recirc,zone=9)"
ovs-ofctl add-flow br0 "in_port=2,conn_state=+trk+est-new,tcp,action=1"
ovs-ofctl add-flow br0 "in_port=2,conn_state=+trk-est+new,tcp,action=drop"
ovs-ofctl add-flow br0 priority=10,action=normal*




*I am seeing a kernel panic for the 'commit' action.I have traced this
to the nf_ct_is_confirmed(ct) call on the nf_conntrack module.If I
edit the code to avoid this check I avoid the panic but am getting an
error response from calls such as 'nf_ct_get(skb, &ctinfo)'.*





*It appears that ovs-conntrack is not populating the nf_conntrack
tables for me.Is there any information on installing/running the
ovs-conntrack branch specifically or is there anything else that
should be done on top of the standard OVS installation.Doing an lsmod
I can see both openvswitch and nf_conntrack modules running.*


*Thanks,*


*John*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150323/084e19f3/attachment.html>

From joestringer at nicira.com  Mon Mar 23 11:27:43 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Mon, 23 Mar 2015 11:27:43 -0700
Subject: [ovs-discuss] ovs-conntrack kernel panic
In-Reply-To: <CAK+XE=k9Oq8Pii+DEva2ZJ_YcCAz3Nxys=ojOHraTAdWKE4iCg@mail.gmail.com>
References: <CAK+XE=k9Oq8Pii+DEva2ZJ_YcCAz3Nxys=ojOHraTAdWKE4iCg@mail.gmail.com>
Message-ID: <CANr6G5x=4MOhTEmZLV_UkK0Xj77E19KNtnoq94RxNL9DBvTmeg@mail.gmail.com>

Hi John,

I strongly suspect in this case, conntrack has been unable to identify
the connection. There's two parts to this: Perhaps you need to load
nf_conntrack_ipv4? if that module is not loaded, then conntrack cannot
identify any IP traffic. Separately, to address the crash, the line
with the nf_ct_is_confirmed() call likely needs to check if ct is
non-NULL first.

One useful datapoint is what kernel version/distro are you running?
I've been testing on the latest net-next, although I should expect it
work on anything back to linux-3.10. Perhaps earlier depending on the
particular features required, YMMV.

Apologies, there's a few bugs like this which I have found in local
testing but I have not pushed the changes yet. This is in part because
the ongoing development is against the linux tree, so I haven't
backported the current development code to build inside the OVS tree.

Without the commit, the nf_conntrack tables will not be populated.

On 23 March 2015 at 09:49, John Hurley <john.hurley at netronome.com> wrote:
> Hi,
> I am interested in using Conntrack within OVS and have installed the latest
> version from the banch (https://github.com/justinpettit/ovs/tree/conntrack).
>
> When I run an example mentioned in the tests:
>
> ovs-ofctl del-flows br0
> ovs-ofctl add-flow br0 \
>     "in_port=1,conn_state=-trk,tcp,action=ct(commit,zone=9),2"
> ovs-ofctl add-flow br0 \
>     "in_port=2,conn_state=-trk,tcp,action=ct(recirc,zone=9)"
> ovs-ofctl add-flow br0 "in_port=2,conn_state=+trk+est-new,tcp,action=1"
> ovs-ofctl add-flow br0 "in_port=2,conn_state=+trk-est+new,tcp,action=drop"
> ovs-ofctl add-flow br0 priority=10,action=normal
>
> I am seeing a kernel panic for the 'commit' action.
> I have traced this to the nf_ct_is_confirmed(ct) call on the nf_conntrack
> module.
> If I edit the code to avoid this check I avoid the panic but am getting an
> error response from calls such as 'nf_ct_get(skb, &ctinfo)'.
>
> It appears that ovs-conntrack is not populating the nf_conntrack tables for
> me.
> Is there any information on installing/running the ovs-conntrack branch
> specifically or is there anything else that should be done on top of the
> standard OVS installation.
> Doing an lsmod I can see both openvswitch and nf_conntrack modules running.
>
> Thanks,
>
> John
>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From nuno.carrulo at ua.pt  Mon Mar 23 12:23:02 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Mon, 23 Mar 2015 19:23:02 +0000
Subject: [ovs-discuss] Current and max speed values static and not changing
 according to link load
Message-ID: <1427138573765.25030@ua.pt>

Hello.
I'm currently checking the apidoc explorer for documentation on rest requests to the controller. I'm trying to obtain the node connector statistics (namely the current transmit speed). In the documentation the model on node connector is like this<http://pastebin.com/biTsRzei> and on this link (https://wiki.opendaylight.org/view/L2Switch:Address_Tracker ) they teach you to send a request that gives you that information.
However when I try the same ( http://localhost:8080/restconf/operational/opendaylight-inventory:nodes/node/openflow:1/node-connector/openflow:1:1 ) I only receive this informationhttp://pastebin.com/tg6H91Tj which is has wrong values like the link speed.
It is giving me always 10mb no matter what ("flow-node-inventory:current-speed": 10000000) and ("flow-node-inventory:maximum-speed": 0). The current speed according to documentation is the "Current port bit rate in kbps". However is always 10000000, even though I'm not sending packets on the link.

Also when I do " s2 ovs-ofctl -Oopenflow13 show "s2" "I received the following response: http://pastebin.com/HUwvJ1SR. Can someone explain to me why the 'current' and 'speed' fields are not changing according to the link load ?
I want to obtain both current speed and max speed parameters in order to it for load balancing in my network. Any help would be apreciated.
Details: I'm using Helium SR2 with mininet 2.2 and I'm using of13  on both controller and mininet.
Regards, Nuno B.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150323/f05756d6/attachment.html>

From blp at nicira.com  Mon Mar 23 13:22:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 13:22:25 -0700
Subject: [ovs-discuss] Current and max speed values static and not
 changing according to link load
In-Reply-To: <1427138573765.25030@ua.pt>
References: <1427138573765.25030@ua.pt>
Message-ID: <20150323202225.GC22444@nicira.com>

On Mon, Mar 23, 2015 at 07:23:02PM +0000, Rui Braz wrote:
> It is giving me always 10mb no matter what
> ("flow-node-inventory:current-speed": 10000000) and
> ("flow-node-inventory:maximum-speed": 0). The current speed
> according to documentation is the "Current port bit rate in
> kbps". However is always 10000000, even though I'm not sending
> packets on the link.

These are probably derived from OVS reports of the link rate (e.g. 10
Mbps or some order of magnitude higher), not the number of bits
actually flowing at any given time.

> Also when I do " s2 ovs-ofctl -Oopenflow13 show "s2" "I received the
> following response: http://pastebin.com/HUwvJ1SR. Can someone
> explain to me why the 'current' and 'speed' fields are not changing
> according to the link load ?

OpenFlow reports the link rate not the number of bits flowing at any
given time.

From nuno.carrulo at ua.pt  Mon Mar 23 13:53:12 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Mon, 23 Mar 2015 20:53:12 +0000
Subject: [ovs-discuss] Current and max speed values static and not
 changing according to link load
In-Reply-To: <20150323202225.GC22444@nicira.com>
References: <1427138573765.25030@ua.pt>,<20150323202225.GC22444@nicira.com>
Message-ID: <1427143983965.16387@ua.pt>

But in my command on mininet I specify the link speed to 50mbps and it still gives me the same value 10000000 which corresponds to 10gbps because that value is in kbps.

I saw a mail in mailing list from openflow that people could get the current transmit rate, however I don't know if they usede mininet and ovs. So I kinda think that this value is not "working properly" because I'm using ovs with mininet, however I'm not sure because there is no information on that matter. According to openflow spec the request I make should return the link max speed and current link speed.

So I just want to know if there's a way to obtain the current link speed or current transmit rate ? Or given what I'm using why it is not possible to know that.

Regards, 
Nuno B.

________________________________________
De: Ben Pfaff <blp at nicira.com>
Enviado: 23 de março de 2015 20:22
Para: Rui Braz
Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
Assunto: Re: [ovs-discuss] Current and max speed values static and not changing according to link load

On Mon, Mar 23, 2015 at 07:23:02PM +0000, Rui Braz wrote:
> It is giving me always 10mb no matter what
> ("flow-node-inventory:current-speed": 10000000) and
> ("flow-node-inventory:maximum-speed": 0). The current speed
> according to documentation is the "Current port bit rate in
> kbps". However is always 10000000, even though I'm not sending
> packets on the link.

These are probably derived from OVS reports of the link rate (e.g. 10
Mbps or some order of magnitude higher), not the number of bits
actually flowing at any given time.

> Also when I do " s2 ovs-ofctl -Oopenflow13 show "s2" "I received the
> following response: http://pastebin.com/HUwvJ1SR. Can someone
> explain to me why the 'current' and 'speed' fields are not changing
> according to the link load ?

OpenFlow reports the link rate not the number of bits flowing at any
given time.

From blp at nicira.com  Mon Mar 23 14:01:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 14:01:10 -0700
Subject: [ovs-discuss] Current and max speed values static and not
 changing according to link load
In-Reply-To: <1427143983965.16387@ua.pt>
References: <1427138573765.25030@ua.pt> <20150323202225.GC22444@nicira.com>
 <1427143983965.16387@ua.pt>
Message-ID: <20150323210110.GG22444@nicira.com>

I don't think OpenFlow has any way to directly report the current
bitrate.  It could be calculated, however, by requesting flow
statistics periodically, then subtracting subsequent byte counts and
dividing by the time interval.

On Mon, Mar 23, 2015 at 08:53:12PM +0000, Rui Braz wrote:
> But in my command on mininet I specify the link speed to 50mbps and it still gives me the same value 10000000 which corresponds to 10gbps because that value is in kbps.
> 
> I saw a mail in mailing list from openflow that people could get the current transmit rate, however I don't know if they usede mininet and ovs. So I kinda think that this value is not "working properly" because I'm using ovs with mininet, however I'm not sure because there is no information on that matter. According to openflow spec the request I make should return the link max speed and current link speed.
> 
> So I just want to know if there's a way to obtain the current link speed or current transmit rate ? Or given what I'm using why it is not possible to know that.
> 
> Regards, 
> Nuno B.
> 
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 23 de mar?o de 2015 20:22
> Para: Rui Braz
> Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> Assunto: Re: [ovs-discuss] Current and max speed values static and not changing according to link load
> 
> On Mon, Mar 23, 2015 at 07:23:02PM +0000, Rui Braz wrote:
> > It is giving me always 10mb no matter what
> > ("flow-node-inventory:current-speed": 10000000) and
> > ("flow-node-inventory:maximum-speed": 0). The current speed
> > according to documentation is the "Current port bit rate in
> > kbps". However is always 10000000, even though I'm not sending
> > packets on the link.
> 
> These are probably derived from OVS reports of the link rate (e.g. 10
> Mbps or some order of magnitude higher), not the number of bits
> actually flowing at any given time.
> 
> > Also when I do " s2 ovs-ofctl -Oopenflow13 show "s2" "I received the
> > following response: http://pastebin.com/HUwvJ1SR. Can someone
> > explain to me why the 'current' and 'speed' fields are not changing
> > according to the link load ?
> 
> OpenFlow reports the link rate not the number of bits flowing at any
> given time.

From nuno.carrulo at ua.pt  Mon Mar 23 14:40:39 2015
From: nuno.carrulo at ua.pt (Rui Braz)
Date: Mon, 23 Mar 2015 21:40:39 +0000
Subject: [ovs-discuss] Current and max speed values static and not
 changing according to link load
In-Reply-To: <20150323210110.GG22444@nicira.com>
References: <1427138573765.25030@ua.pt> <20150323202225.GC22444@nicira.com>
 <1427143983965.16387@ua.pt>,<20150323210110.GG22444@nicira.com>
Message-ID: <1427146831404.99408@ua.pt>

Yes, that's what I thought to do given this situation.
They do have this on their specification
    uint32_t curr_speed; /* Current port bitrate in kbps. */
    uint32_t max_speed; /* Max port bitrate in kbps */
What makes me search for a solution is because I saw an email from the openflowplugin mailing list that someone was having trouble with this and was able to get the current link speed ( https://lists.opendaylight.org/pipermail/openflowplugin-dev/2014-June/001291.html ). That's why I'm still trying to learn why this is not working.

Regards, 
Nuno B.

________________________________________
De: Ben Pfaff <blp at nicira.com>
Enviado: 23 de março de 2015 21:01
Para: Rui Braz
Cc: discuss at openvswitch.org
Assunto: Re: [ovs-discuss] Current and max speed values static and not changing according to link load

I don't think OpenFlow has any way to directly report the current
bitrate.  It could be calculated, however, by requesting flow
statistics periodically, then subtracting subsequent byte counts and
dividing by the time interval.

On Mon, Mar 23, 2015 at 08:53:12PM +0000, Rui Braz wrote:
> But in my command on mininet I specify the link speed to 50mbps and it still gives me the same value 10000000 which corresponds to 10gbps because that value is in kbps.
>
> I saw a mail in mailing list from openflow that people could get the current transmit rate, however I don't know if they usede mininet and ovs. So I kinda think that this value is not "working properly" because I'm using ovs with mininet, however I'm not sure because there is no information on that matter. According to openflow spec the request I make should return the link max speed and current link speed.
>
> So I just want to know if there's a way to obtain the current link speed or current transmit rate ? Or given what I'm using why it is not possible to know that.
>
> Regards,
> Nuno B.
>
> ________________________________________
> De: Ben Pfaff <blp at nicira.com>
> Enviado: 23 de mar?o de 2015 20:22
> Para: Rui Braz
> Cc: mininet-discuss at lists.stanford.edu; discuss at openvswitch.org
> Assunto: Re: [ovs-discuss] Current and max speed values static and not changing according to link load
>
> On Mon, Mar 23, 2015 at 07:23:02PM +0000, Rui Braz wrote:
> > It is giving me always 10mb no matter what
> > ("flow-node-inventory:current-speed": 10000000) and
> > ("flow-node-inventory:maximum-speed": 0). The current speed
> > according to documentation is the "Current port bit rate in
> > kbps". However is always 10000000, even though I'm not sending
> > packets on the link.
>
> These are probably derived from OVS reports of the link rate (e.g. 10
> Mbps or some order of magnitude higher), not the number of bits
> actually flowing at any given time.
>
> > Also when I do " s2 ovs-ofctl -Oopenflow13 show "s2" "I received the
> > following response: http://pastebin.com/HUwvJ1SR. Can someone
> > explain to me why the 'current' and 'speed' fields are not changing
> > according to the link load ?
>
> OpenFlow reports the link rate not the number of bits flowing at any
> given time.

From badveli_vishnuus at yahoo.com  Mon Mar 23 16:27:01 2015
From: badveli_vishnuus at yahoo.com (vis reddy)
Date: Mon, 23 Mar 2015 23:27:01 +0000 (UTC)
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <20150225200633.GC10186@nicira.com>
References: <20150225200633.GC10186@nicira.com>
Message-ID: <2090895874.21895.1427153221693.JavaMail.yahoo@mail.yahoo.com>

Thanks Sir,I have another question, was there any scalability numbers that are available?
I had created 2000 ovsdb-client monitoring on a database and 
when i do a transact (insert operation) from another client i get following error,
error: Connection reset by peerovsdb-client: transaction failed (Connection reset by peer)
Was there any profiling done on  ovsdb in terms of how many clients can be supported and also does it depend on  data in tables?I am using a very large tables (potentially running into couple of mb's)
ThanksVishnu
      From: Ben Pfaff <blp at nicira.com>
 To: vis reddy <badveli_vishnuus at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Wednesday, 25 February 2015 12:06 PM
 Subject: Re: [ovs-discuss] ovsdb update operation
   
Please see the OVS makefiles, specifically the idlc related stuff in
ovsdb/automake.mk, also the manpage for ovsdb-idlc.



On Wed, Feb 25, 2015 at 07:53:05PM +0000, vis reddy wrote:
> Thanks Sir,I have another question i have my own schema vis.schemahow do i use??ovsdb-idlc to generate my own idl header filei see that vtep-idl.h generated from??vtep.ovsschema, vtep.xmlnot able to figure out how,??could you please explain???ThanksVishnu
>      From: Ben Pfaff <blp at nicira.com>
>  To: vis reddy <badveli_vishnuus at yahoo.com> 
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
>  Sent: Wednesday, 4 February 2015 2:17 PM
>  Subject: Re: [ovs-discuss] ovsdb update operation
>    
> On Wed, Feb 04, 2015 at 08:09:41PM +0000, vis reddy wrote:
> 
> 
> > 
> > Hello All,Going through rfc 7047
> > The operation updates rows in a table.?? It searches "table" for rows
> >?? ?? that match all the conditions specified in "where".?? For each
> >?? ?? matching row, it changes the value of each column specified in "row"
> >?? ?? to the value for that column specified in "row". 
> > I am not able to find out if there is an operation??which tries to find a row that match conditions and if does not exist, it can insert,??how do we achieve some thing like this?
> > this is useful as I do not have a idea if the row is existing??i would want to update itor insert it if it does not exist. Should i always use select followed by insert or update operations.
> 
> I think you'll have to select then insert or update in that case.
> 
> 
>  


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150323/be5f0335/attachment-0001.html>

From badveli_vishnuus at yahoo.com  Mon Mar 23 16:46:29 2015
From: badveli_vishnuus at yahoo.com (vis reddy)
Date: Mon, 23 Mar 2015 23:46:29 +0000 (UTC)
Subject: [ovs-discuss] ovsdb scalability
In-Reply-To: <2090895874.21895.1427153221693.JavaMail.yahoo@mail.yahoo.com>
References: <20150225200633.GC10186@nicira.com>
 <2090895874.21895.1427153221693.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <494638869.7969.1427154389436.JavaMail.yahoo@mail.yahoo.com>


Thanks Sir,I have another question, was there any scalability numbers that are available?
I had created 2000 ovsdb-client monitoring on a database and 
when i do a transact (insert operation) from another client i get following error,
error: Connection reset by peerovsdb-client: transaction failed (Connection reset by peer)
Was there any profiling done on  ovsdb in terms of how many clients can be supported and also does it depend on  data in tables?I am using a very large tables (potentially running into couple of mb's)
ThanksVishnu
 

   

  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150323/d7751646/attachment-0001.html>

From blp at nicira.com  Mon Mar 23 17:17:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 17:17:20 -0700
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <2090895874.21895.1427153221693.JavaMail.yahoo@mail.yahoo.com>
References: <20150225200633.GC10186@nicira.com>
 <2090895874.21895.1427153221693.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150324001720.GH22444@nicira.com>

On Mon, Mar 23, 2015 at 11:27:01PM +0000, vis reddy wrote:
> Thanks Sir,I have another question, was there any scalability numbers that are available?
> I had created 2000 ovsdb-client monitoring on a database and??
> when i do a transact (insert operation) from another client i get following error,
> error: Connection reset by peerovsdb-client: transaction failed (Connection reset by peer)
> Was there any profiling done on ??ovsdb in terms of how many clients??can be supported and also does it depend on ??data in tables?I am using a very large tables (potentially running into couple of mb's)

We don't have a use case for that, so we didn't test for it.

In Open vSwitch environments there are normally only a single-digit
number of clients.

What is your use case?

From blp at nicira.com  Mon Mar 23 20:46:16 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 20:46:16 -0700
Subject: [ovs-discuss] =?utf-8?b?562U5aSNOiAgaWNtcCBwYWNrZXQ=?=
In-Reply-To: <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>
References: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
 <20150323155930.GB31376@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>
Message-ID: <20150324034616.GA21543@nicira.com>

On Tue, Mar 24, 2015 at 02:06:04AM +0000, Duankebo (Frank) wrote:
> Thank you Ben.
> 
> Yes, we can packetIn the ping request packet to Openflow controller, which packet out a response then.
> 
> But for every ping request packet, the controller have to packetIn/packetOut the packet, imaging large scale datacenter where there are many hosts 
> 
> which may send ping request to virtual address(means address don't exist physically and need Controller/switch to process the icmp request), 
> 
> the controller will become a choke point.
> 
> So we are looking for better ways that the ping request can be responsed by the vSwitch.

It's a reasonable request, and this feature will be useful to other
software too (including the upcoming OVN), so we'd take a patch to
implement this.

From blp at nicira.com  Mon Mar 23 20:49:50 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 20:49:50 -0700
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <2093455754.54682.1427160246438.JavaMail.yahoo@mail.yahoo.com>
References: <20150324001720.GH22444@nicira.com>
 <2093455754.54682.1427160246438.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150324034950.GB21543@nicira.com>

The current OVSDB implementation isn't designed for a large number of
clients.  Since OVSDB in OVN will need to handle a larger number of
clients, we (specifically Andy Zhou) are working on increasing its
scalability along that dimension.  He has already posted some patches,
although they have not yet been applied.

On Tue, Mar 24, 2015 at 01:24:06AM +0000, vis reddy wrote:
> i would like to extend this to my own configurations(which are not
> Open vSwitch environments) to be pushed to remote clients by a
> centralized entity,I have several clients monitoring on this
> configuration changes, the configurations could be anything which is
> not restricted to only Open vSwitch could you please let me know if it
> is not designed/ cannot use . I am going through your OVN architecture
> but my immediate requirement is i want to  use ovsdb and design a
> system that contains a centralized entity and thousands of entity
> listening to it for the configuration, could you please let me know if
> ovsdb is not designed for this.ThanksVishnu
>
>       From: Ben Pfaff <blp at nicira.com>
>  To: vis reddy <badveli_vishnuus at yahoo.com> 
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
>  Sent: Monday, 23 March 2015 5:17 PM
>  Subject: Re: [ovs-discuss] ovsdb update operation
>    
> On Mon, Mar 23, 2015 at 11:27:01PM +0000, vis reddy wrote:
> 
> 
> > Thanks Sir,I have another question, was there any scalability numbers that are available?
> > I had created 2000 ovsdb-client monitoring on a database and??
> > when i do a transact (insert operation) from another client i get following error,
> > error: Connection reset by peerovsdb-client: transaction failed (Connection reset by peer)
> > Was there any profiling done on ??ovsdb in terms of how many clients??can be supported and also does it depend on ??data in tables?I am using a very large tables (potentially running into couple of mb's)
> 
> We don't have a use case for that, so we didn't test for it.
> 
> In Open vSwitch environments there are normally only a single-digit
> number of clients.
> 
> What is your use case?
> 
> 
>   

From cvinllen at gmail.com  Mon Mar 23 21:03:25 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Tue, 24 Mar 2015 12:03:25 +0800
Subject: [ovs-discuss] ovs flow duration
Message-ID: <CAN2QyzaG1Ypbjj9=L+ad1N156mxw8Co0V5EVquqxMSvNc+rxTQ@mail.gmail.com>

Hi all:
    I build a small network to test the ping, the topology is showd below:

host1 ---- switch1----switch2 ----host2
host1 ip: 10.0.0.1
host2 ip: 10.0.0.2
    When i use host1 ping host2, and then use host2 ping host1, it works
ok. Then i use "ovs-ofctl dump-flows switch2" command to show the flows:
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=1873.140s, table=0, n_packets=1843, n_bytes=180614,
idle_age=0, priority=1,ip,nw_dst=10.0.0.1 actions=output:1
 cookie=0x0, duration=118.427s, table=0, n_packets=118, n_bytes=11564,
idle_age=0, priority=1,ip,nw_dst=10.0.0.2
actions=mod_dl_dst:d3:97:e5:22:ea:ed,output:2
    The second flow will disappear when time duration arrival 120s. My
question is why doesn't the first flow disappear when time arrival 120s ?
    Thankyou for anyone's relay
Best wishes.
Vinllen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150324/19990d98/attachment.html>

From blp at nicira.com  Mon Mar 23 21:09:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 21:09:17 -0700
Subject: [ovs-discuss] ovs flow duration
In-Reply-To: <CAN2QyzaG1Ypbjj9=L+ad1N156mxw8Co0V5EVquqxMSvNc+rxTQ@mail.gmail.com>
References: <CAN2QyzaG1Ypbjj9=L+ad1N156mxw8Co0V5EVquqxMSvNc+rxTQ@mail.gmail.com>
Message-ID: <20150324040917.GC21543@nicira.com>

On Tue, Mar 24, 2015 at 12:03:25PM +0800, Vinllen Chen wrote:
> Hi all:
>     I build a small network to test the ping, the topology is showd below:
> 
> host1 ---- switch1----switch2 ----host2
> host1 ip: 10.0.0.1
> host2 ip: 10.0.0.2
>     When i use host1 ping host2, and then use host2 ping host1, it works
> ok. Then i use "ovs-ofctl dump-flows switch2" command to show the flows:
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=1873.140s, table=0, n_packets=1843, n_bytes=180614,
> idle_age=0, priority=1,ip,nw_dst=10.0.0.1 actions=output:1
>  cookie=0x0, duration=118.427s, table=0, n_packets=118, n_bytes=11564,
> idle_age=0, priority=1,ip,nw_dst=10.0.0.2
> actions=mod_dl_dst:d3:97:e5:22:ea:ed,output:2
>     The second flow will disappear when time duration arrival 120s. My
> question is why doesn't the first flow disappear when time arrival 120s ?

I imagine that a controller is deleting it, since neither has a timeout.

From jpettit at nicira.com  Mon Mar 23 23:28:03 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 23 Mar 2015 23:28:03 -0700
Subject: [ovs-discuss] Question about Open vSwitch routing
In-Reply-To: <CABq-Kp4Tyh2gnmsX=LXPU=J6xRSevY_Srvj9QLW4o5bsR79k=A@mail.gmail.com>
References: <CABq-Kp4Tyh2gnmsX=LXPU=J6xRSevY_Srvj9QLW4o5bsR79k=A@mail.gmail.com>
Message-ID: <9450C003-C067-4A2C-9E07-55253F14102C@nicira.com>


> On Mar 23, 2015, at 1:38 AM, Ildar Karimov <ildarkarimov22 at gmail.com> wrote:
> 
> Question: Is it possible to use the Open vSwitch for routing?  I mean,
> can this software provide me with forwarding and route table in user
> space?

OVS can do all the steps necessary for routing on the datapath (lookup address, rewrite MAC address, decrement TTL, and forward), but it doesn't do them in a way that you are probably wanting.  OpenFlow rules must be written to do these things.  This is usually done with a controller, since OVS doesn't do ARP processing or support longest prefix match.

> I'm looking for software which from one side will interact with
> routing daemon (quagga for example), and from another side interact
> with hardware (I will adapt  soft for my hardware, so it's ok, if it's
> not support my hardware).  So, i want software which can support
> quagga in user space like kernel does. Can Open vSwitch help me with
> this?

I don't think OVS is what you want--unless you want to glue an OpenFlow controller to your routing stack, which seems pretty ugly.  There is some work being done in the upstream Linux kernel that will likely eventually do what you want, but it's probably a ways off.

--Justin



From blp at nicira.com  Mon Mar 23 23:32:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 23:32:28 -0700
Subject: [ovs-discuss] icmp packet
In-Reply-To: <D7E5E3A5A61527479B3F85C3FB29614D89174C48@SZXEMA504-MBX.china.huawei.com>
References: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
 <20150323155930.GB31376@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>
 <20150324034616.GA21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C48@SZXEMA504-MBX.china.huawei.com>
Message-ID: <20150324063228.GD21543@nicira.com>

It'll be ready when you send it.

On Tue, Mar 24, 2015 at 06:22:56AM +0000, Duankebo (Frank) wrote:
> Great! Thank you!
> 
> BTW: When the patch will be ready? Will you please send me a copy for test?
> 
> 
> 发件人: Ben Pfaff [mailto:blp at nicira.com] 
> 发送时间: 2015年3月24日 11:46
> 收件人: Duankebo (Frank)
> 抄送: Lilin (pineorange, IT); discuss at openvswitch.org; Liyi (David, ITPL)
> 主题: Re: 答复: [ovs-discuss] icmp packet
> 
> On Tue, Mar 24, 2015 at 02:06:04AM +0000, Duankebo (Frank) wrote:
> > Thank you Ben.
> > 
> > Yes, we can packetIn the ping request packet to Openflow controller, which packet out a response then.
> > 
> > But for every ping request packet, the controller have to 
> > packetIn/packetOut the packet, imaging large scale datacenter where 
> > there are many hosts
> > 
> > which may send ping request to virtual address(means address don't 
> > exist physically and need Controller/switch to process the icmp 
> > request),
> > 
> > the controller will become a choke point.
> > 
> > So we are looking for better ways that the ping request can be responsed by the vSwitch.
> 
> It's a reasonable request, and this feature will be useful to other software too (including the upcoming OVN), so we'd take a patch to implement this.

From blp at nicira.com  Mon Mar 23 23:44:07 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 23:44:07 -0700
Subject: [ovs-discuss] icmp packet
In-Reply-To: <D7E5E3A5A61527479B3F85C3FB29614D89174C65@SZXEMA504-MBX.china.huawei.com>
References: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
 <20150323155930.GB31376@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>
 <20150324034616.GA21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C48@SZXEMA504-MBX.china.huawei.com>
 <20150324063228.GD21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C65@SZXEMA504-MBX.china.huawei.com>
Message-ID: <20150324064407.GE21543@nicira.com>

I never said that we would develop such a patch.  I said that we would
take a patch to implement this.

On Tue, Mar 24, 2015 at 06:39:57AM +0000, Duankebo (Frank) wrote:
> Oh, I mean when you will develop the patch contains this feature?
> 
> -----邮件原件-----
> 发件人: Ben Pfaff [mailto:blp at nicira.com] 
> 发送时间: 2015年3月24日 14:32
> 收件人: Duankebo (Frank)
> 抄送: discuss at openvswitch.org; Lilin (pineorange, IT); Liyi (David, ITPL)
> 主题: Re: [ovs-discuss] icmp packet
> 
> It'll be ready when you send it.
> 
> On Tue, Mar 24, 2015 at 06:22:56AM +0000, Duankebo (Frank) wrote:
> > Great! Thank you!
> > 
> > BTW: When the patch will be ready? Will you please send me a copy for test?
> > 
> > 
> > 发件人: Ben Pfaff [mailto:blp at nicira.com]
> > 发送时间: 2015年3月24日 11:46
> > 收件人: Duankebo (Frank)
> > 抄送: Lilin (pineorange, IT); discuss at openvswitch.org; Liyi (David, 
> > ITPL)
> > 主题: Re: 答复: [ovs-discuss] icmp packet
> > 
> > On Tue, Mar 24, 2015 at 02:06:04AM +0000, Duankebo (Frank) wrote:
> > > Thank you Ben.
> > > 
> > > Yes, we can packetIn the ping request packet to Openflow controller, which packet out a response then.
> > > 
> > > But for every ping request packet, the controller have to 
> > > packetIn/packetOut the packet, imaging large scale datacenter where 
> > > there are many hosts
> > > 
> > > which may send ping request to virtual address(means address don't 
> > > exist physically and need Controller/switch to process the icmp 
> > > request),
> > > 
> > > the controller will become a choke point.
> > > 
> > > So we are looking for better ways that the ping request can be responsed by the vSwitch.
> > 
> > It's a reasonable request, and this feature will be useful to other software too (including the upcoming OVN), so we'd take a patch to implement this.

From blp at nicira.com  Mon Mar 23 23:55:11 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 23 Mar 2015 23:55:11 -0700
Subject: [ovs-discuss] icmp packet
In-Reply-To: <D7E5E3A5A61527479B3F85C3FB29614D89174C7C@SZXEMA504-MBX.china.huawei.com>
References: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
 <20150323155930.GB31376@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>
 <20150324034616.GA21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C48@SZXEMA504-MBX.china.huawei.com>
 <20150324063228.GD21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C65@SZXEMA504-MBX.china.huawei.com>
 <20150324064407.GE21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C7C@SZXEMA504-MBX.china.huawei.com>
Message-ID: <20150324065511.GF21543@nicira.com>

We will review and apply a patch from someone who develops and posts
such a patch.

On Tue, Mar 24, 2015 at 06:49:59AM +0000, Duankebo (Frank) wrote:
> Hi Ben, Sorry for the misunderstanding. But will you please tell me how to "take a patch" implement the feature, what's the difference between "develop a patch" and "take a patch"?
> 
> Thank you!
> 
> -----邮件原件-----
> 发件人: Ben Pfaff [mailto:blp at nicira.com] 
> 发送时间: 2015年3月24日 14:44
> 收件人: Duankebo (Frank)
> 抄送: discuss at openvswitch.org; Lilin (pineorange, IT); Liyi (David, ITPL)
> 主题: Re: [ovs-discuss] icmp packet
> 
> I never said that we would develop such a patch.  I said that we would take a patch to implement this.
> 
> On Tue, Mar 24, 2015 at 06:39:57AM +0000, Duankebo (Frank) wrote:
> > Oh, I mean when you will develop the patch contains this feature?
> > 
> > -----邮件原件-----
> > 发件人: Ben Pfaff [mailto:blp at nicira.com]
> > 发送时间: 2015年3月24日 14:32
> > 收件人: Duankebo (Frank)
> > 抄送: discuss at openvswitch.org; Lilin (pineorange, IT); Liyi (David, 
> > ITPL)
> > 主题: Re: [ovs-discuss] icmp packet
> > 
> > It'll be ready when you send it.
> > 
> > On Tue, Mar 24, 2015 at 06:22:56AM +0000, Duankebo (Frank) wrote:
> > > Great! Thank you!
> > > 
> > > BTW: When the patch will be ready? Will you please send me a copy for test?
> > > 
> > > 
> > > 发件人: Ben Pfaff [mailto:blp at nicira.com]
> > > 发送时间: 2015年3月24日 11:46
> > > 收件人: Duankebo (Frank)
> > > 抄送: Lilin (pineorange, IT); discuss at openvswitch.org; Liyi (David,
> > > ITPL)
> > > 主题: Re: 答复: [ovs-discuss] icmp packet
> > > 
> > > On Tue, Mar 24, 2015 at 02:06:04AM +0000, Duankebo (Frank) wrote:
> > > > Thank you Ben.
> > > > 
> > > > Yes, we can packetIn the ping request packet to Openflow controller, which packet out a response then.
> > > > 
> > > > But for every ping request packet, the controller have to 
> > > > packetIn/packetOut the packet, imaging large scale datacenter 
> > > > where there are many hosts
> > > > 
> > > > which may send ping request to virtual address(means address don't 
> > > > exist physically and need Controller/switch to process the icmp 
> > > > request),
> > > > 
> > > > the controller will become a choke point.
> > > > 
> > > > So we are looking for better ways that the ping request can be responsed by the vSwitch.
> > > 
> > > It's a reasonable request, and this feature will be useful to other software too (including the upcoming OVN), so we'd take a patch to implement this.

From badveli_vishnuus at yahoo.com  Mon Mar 23 18:24:06 2015
From: badveli_vishnuus at yahoo.com (vis reddy)
Date: Tue, 24 Mar 2015 01:24:06 +0000 (UTC)
Subject: [ovs-discuss] ovsdb update operation
In-Reply-To: <20150324001720.GH22444@nicira.com>
References: <20150324001720.GH22444@nicira.com>
Message-ID: <2093455754.54682.1427160246438.JavaMail.yahoo@mail.yahoo.com>

Thanks Sir,Since i understand the usability of ovsdb and the standard interfaces that you have defined, thanks for it
i would like to extend this to my own configurations(which are not Open vSwitch environments) to be pushed to remote clients by a centralized entity,I have several clients monitoring on this configuration changes, the configurations could be anything which is not restricted to only Open vSwitch could you please let me know if it is not designed/ cannot use . I am going through your OVN architecture but my immediate requirement is i want to  use ovsdb and design a system that contains a centralized entity and thousands of entity listening to it for the configuration, could you please let me know if ovsdb is not designed for this.ThanksVishnu
      From: Ben Pfaff <blp at nicira.com>
 To: vis reddy <badveli_vishnuus at yahoo.com> 
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Monday, 23 March 2015 5:17 PM
 Subject: Re: [ovs-discuss] ovsdb update operation
   
On Mon, Mar 23, 2015 at 11:27:01PM +0000, vis reddy wrote:


> Thanks Sir,I have another question, was there any scalability numbers that are available?
> I had created 2000 ovsdb-client monitoring on a database and??
> when i do a transact (insert operation) from another client i get following error,
> error: Connection reset by peerovsdb-client: transaction failed (Connection reset by peer)
> Was there any profiling done on ??ovsdb in terms of how many clients??can be supported and also does it depend on ??data in tables?I am using a very large tables (potentially running into couple of mb's)

We don't have a use case for that, so we didn't test for it.

In Open vSwitch environments there are normally only a single-digit
number of clients.

What is your use case?


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150324/20476f28/attachment-0001.html>

From duankebo at huawei.com  Mon Mar 23 19:06:04 2015
From: duankebo at huawei.com (Duankebo (Frank))
Date: Tue, 24 Mar 2015 02:06:04 +0000
Subject: [ovs-discuss] =?gb2312?b?tPC4tDogIGljbXAgcGFja2V0?=
In-Reply-To: <20150323155930.GB31376@nicira.com>
References: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
 <20150323155930.GB31376@nicira.com>
Message-ID: <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>

Thank you Ben.

Yes, we can packetIn the ping request packet to Openflow controller, which packet out a response then.

But for every ping request packet, the controller have to packetIn/packetOut the packet, imaging large scale datacenter where there are many hosts 

which may send ping request to virtual address(means address don't exist physically and need Controller/switch to process the icmp request), 

the controller will become a choke point.

So we are looking for better ways that the ping request can be responsed by the vSwitch.

Thank you!

Frank Duan

-----邮件原件-----
发件人: Ben Pfaff [mailto:blp at nicira.com] 
发送时间: 2015年3月24日 0:00
收件人: Lilin (pineorange, IT)
抄送: discuss at openvswitch.org; Duankebo (Frank); Liyi (David, ITPL)
主题: Re: [ovs-discuss] icmp packet

On Mon, Mar 23, 2015 at 03:54:48AM +0000, Lilin (pineorange, IT) wrote:
> Recently I had a problem when I tried to set NXM_OF_ICMP_TYPE and NXM_OF_ICMP_CODE items in ip packet by adding flow-entries on ovs bridge. As Follows:
> 
> root at it_207:~# ovs-ofctl add-flow br-int -O OpenFlow10 "table=0,priority=44,icmp,ip_dst=192.168.1.16, actions=move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],mod_dl_src:fa:16:3e:6b:1e:60, load:0x08->NXM_OF_ICMP_TYPE[],load:0x00->NXM_OF_ICMP_CODE[], move:NXM_OF_IP_SRC[]->NXM_OF_IP_DST[], load:0xc0a80110->NXM_OF_IP_SRC[],IN_PORT"
> 2015-03-19T11:01:22Z|00001|meta_flow|WARN|destination field icmp_type is not writable
> ovs-ofctl: actions are invalid with specified match (OFPBAC_BAD_SET_ARGUMENT)
> 
> 
> My OVS version is 2.3.90:
> 
> root at it_207:~# ovs-vsctl --version
> ovs-vsctl (Open vSwitch) 2.3.90
> Compiled Mar  5 2015 10:31:02
> DB Schema 7.7.0
> 
> 
> I want to know that, does OVS support modifing TYPE and CODE items in icmp packet? If not, is there any other methods that I can achieve my destination?

OVS doesn't yet support modifying the type or code in ICMP.

You could do this with an OpenFlow controller.

From timbgr at gmail.com  Mon Mar 23 20:01:02 2015
From: timbgr at gmail.com (Tim Bagr)
Date: Tue, 24 Mar 2015 07:01:02 +0400
Subject: [ovs-discuss] Is it possible to limit bandwidth for particular OVS
	port?
Message-ID: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>

Hello all,

I tried to limit bandwidth for particular VM attached to OpenVSwitch port.

There are VMs attached to virtual switch br3. I want to limit bandwidth for
one VM, which is attached to br3 and in_port 2. Doing as follows:
1)
# ovs-vsctl set port br3 qos=@newqos1 -- --id=@newqos1 create qos
type=linux-htb other-config:max-rate=10 queues:123=@vn2queue --
--id=@vn2queue create queue other-config:max-rate=10
# ovs-ofctl add-flow br3
"priority=50,in_port=2,actions=set_queue:123,normal"

Command worked! The bandwidth is limited as expected for all traffic going
through LOCAL port of br3, limit is very tight so even icmp echo is hardly
passed. All VMs are affected by this.

After that I tried to limit the bandwidth for only one VM, and give almost
unlimited bandwidth for the others:
2)
# ovs-vsctl set port br3 qos=@newqos1 -- --id=@newqos1 create qos
type=linux-htb other-config:max-rate=100000000
queues:123=4d65ddec-5c5d-4c87-8165-dd51431c7ab3

Here the ID 4d65ddec-5c5d-4c87-8165-dd51431c7ab3 is that queue which was
created in previous steps with max-rate=10
OpenFlow rule for redirecting traffic from the in_port=2 to that queue
remains the same.

After that I got all VMs (including attached to in_port 2) has got that big
bandwidth (100000000).
But it was supposed that VM from port 2 cannot send even pings (as its
traffic should be limited by max-rate=10).


Am I doing something wrong or maybe have incorrect understanding how QoS
works?
Or it is a known issue within OVS?
Please help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150324/979f9d63/attachment.html>

From duankebo at huawei.com  Mon Mar 23 23:22:56 2015
From: duankebo at huawei.com (Duankebo (Frank))
Date: Tue, 24 Mar 2015 06:22:56 +0000
Subject: [ovs-discuss] icmp packet
In-Reply-To: <20150324034616.GA21543@nicira.com>
References: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
 <20150323155930.GB31376@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>
 <20150324034616.GA21543@nicira.com>
Message-ID: <D7E5E3A5A61527479B3F85C3FB29614D89174C48@SZXEMA504-MBX.china.huawei.com>

Great! Thank you!

BTW: When the patch will be ready? Will you please send me a copy for test?


发件人: Ben Pfaff [mailto:blp at nicira.com] 
发送时间: 2015年3月24日 11:46
收件人: Duankebo (Frank)
抄送: Lilin (pineorange, IT); discuss at openvswitch.org; Liyi (David, ITPL)
主题: Re: 答复: [ovs-discuss] icmp packet

On Tue, Mar 24, 2015 at 02:06:04AM +0000, Duankebo (Frank) wrote:
> Thank you Ben.
> 
> Yes, we can packetIn the ping request packet to Openflow controller, which packet out a response then.
> 
> But for every ping request packet, the controller have to 
> packetIn/packetOut the packet, imaging large scale datacenter where 
> there are many hosts
> 
> which may send ping request to virtual address(means address don't 
> exist physically and need Controller/switch to process the icmp 
> request),
> 
> the controller will become a choke point.
> 
> So we are looking for better ways that the ping request can be responsed by the vSwitch.

It's a reasonable request, and this feature will be useful to other software too (including the upcoming OVN), so we'd take a patch to implement this.

From duankebo at huawei.com  Mon Mar 23 23:39:57 2015
From: duankebo at huawei.com (Duankebo (Frank))
Date: Tue, 24 Mar 2015 06:39:57 +0000
Subject: [ovs-discuss] icmp packet
In-Reply-To: <20150324063228.GD21543@nicira.com>
References: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
 <20150323155930.GB31376@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>
 <20150324034616.GA21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C48@SZXEMA504-MBX.china.huawei.com>
 <20150324063228.GD21543@nicira.com>
Message-ID: <D7E5E3A5A61527479B3F85C3FB29614D89174C65@SZXEMA504-MBX.china.huawei.com>

Oh, I mean when you will develop the patch contains this feature?

-----邮件原件-----
发件人: Ben Pfaff [mailto:blp at nicira.com] 
发送时间: 2015年3月24日 14:32
收件人: Duankebo (Frank)
抄送: discuss at openvswitch.org; Lilin (pineorange, IT); Liyi (David, ITPL)
主题: Re: [ovs-discuss] icmp packet

It'll be ready when you send it.

On Tue, Mar 24, 2015 at 06:22:56AM +0000, Duankebo (Frank) wrote:
> Great! Thank you!
> 
> BTW: When the patch will be ready? Will you please send me a copy for test?
> 
> 
> 发件人: Ben Pfaff [mailto:blp at nicira.com]
> 发送时间: 2015年3月24日 11:46
> 收件人: Duankebo (Frank)
> 抄送: Lilin (pineorange, IT); discuss at openvswitch.org; Liyi (David, 
> ITPL)
> 主题: Re: 答复: [ovs-discuss] icmp packet
> 
> On Tue, Mar 24, 2015 at 02:06:04AM +0000, Duankebo (Frank) wrote:
> > Thank you Ben.
> > 
> > Yes, we can packetIn the ping request packet to Openflow controller, which packet out a response then.
> > 
> > But for every ping request packet, the controller have to 
> > packetIn/packetOut the packet, imaging large scale datacenter where 
> > there are many hosts
> > 
> > which may send ping request to virtual address(means address don't 
> > exist physically and need Controller/switch to process the icmp 
> > request),
> > 
> > the controller will become a choke point.
> > 
> > So we are looking for better ways that the ping request can be responsed by the vSwitch.
> 
> It's a reasonable request, and this feature will be useful to other software too (including the upcoming OVN), so we'd take a patch to implement this.

From blp at nicira.com  Tue Mar 24 00:07:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 24 Mar 2015 00:07:20 -0700
Subject: [ovs-discuss] icmp packet
In-Reply-To: <D7E5E3A5A61527479B3F85C3FB29614D89174C9A@SZXEMA504-MBX.china.huawei.com>
References: <20150323155930.GB31376@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>
 <20150324034616.GA21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C48@SZXEMA504-MBX.china.huawei.com>
 <20150324063228.GD21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C65@SZXEMA504-MBX.china.huawei.com>
 <20150324064407.GE21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C7C@SZXEMA504-MBX.china.huawei.com>
 <20150324065511.GF21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C9A@SZXEMA504-MBX.china.huawei.com>
Message-ID: <20150324070720.GG21543@nicira.com>

It wasn't intentionally humorous, just a difficulty in communication.

On Tue, Mar 24, 2015 at 07:04:25AM +0000, Duankebo (Frank) wrote:
> OK, I see. You are very humorous!
> 
> Though our team members aren't familiar with OVS, I will try to find some who can help developing this feature.
> 
> Thank you!
> 
> -----邮件原件-----
> 发件人: Ben Pfaff [mailto:blp at nicira.com] 
> 发送时间: 2015年3月24日 14:55
> 收件人: Duankebo (Frank)
> 抄送: discuss at openvswitch.org
> 主题: Re: [ovs-discuss] icmp packet
> 
> We will review and apply a patch from someone who develops and posts such a patch.
> 
> On Tue, Mar 24, 2015 at 06:49:59AM +0000, Duankebo (Frank) wrote:
> > Hi Ben, Sorry for the misunderstanding. But will you please tell me how to "take a patch" implement the feature, what's the difference between "develop a patch" and "take a patch"?
> > 
> > Thank you!
> > 
> > -----邮件原件-----
> > 发件人: Ben Pfaff [mailto:blp at nicira.com]
> > 发送时间: 2015年3月24日 14:44
> > 收件人: Duankebo (Frank)
> > 抄送: discuss at openvswitch.org; Lilin (pineorange, IT); Liyi (David, 
> > ITPL)
> > 主题: Re: [ovs-discuss] icmp packet
> > 
> > I never said that we would develop such a patch.  I said that we would take a patch to implement this.
> > 
> > On Tue, Mar 24, 2015 at 06:39:57AM +0000, Duankebo (Frank) wrote:
> > > Oh, I mean when you will develop the patch contains this feature?
> > > 
> > > -----邮件原件-----
> > > 发件人: Ben Pfaff [mailto:blp at nicira.com]
> > > 发送时间: 2015年3月24日 14:32
> > > 收件人: Duankebo (Frank)
> > > 抄送: discuss at openvswitch.org; Lilin (pineorange, IT); Liyi (David,
> > > ITPL)
> > > 主题: Re: [ovs-discuss] icmp packet
> > > 
> > > It'll be ready when you send it.
> > > 
> > > On Tue, Mar 24, 2015 at 06:22:56AM +0000, Duankebo (Frank) wrote:
> > > > Great! Thank you!
> > > > 
> > > > BTW: When the patch will be ready? Will you please send me a copy for test?
> > > > 
> > > > 
> > > > 发件人: Ben Pfaff [mailto:blp at nicira.com]
> > > > 发送时间: 2015年3月24日 11:46
> > > > 收件人: Duankebo (Frank)
> > > > 抄送: Lilin (pineorange, IT); discuss at openvswitch.org; Liyi (David,
> > > > ITPL)
> > > > 主题: Re: 答复: [ovs-discuss] icmp packet
> > > > 
> > > > On Tue, Mar 24, 2015 at 02:06:04AM +0000, Duankebo (Frank) wrote:
> > > > > Thank you Ben.
> > > > > 
> > > > > Yes, we can packetIn the ping request packet to Openflow controller, which packet out a response then.
> > > > > 
> > > > > But for every ping request packet, the controller have to 
> > > > > packetIn/packetOut the packet, imaging large scale datacenter 
> > > > > where there are many hosts
> > > > > 
> > > > > which may send ping request to virtual address(means address 
> > > > > don't exist physically and need Controller/switch to process the 
> > > > > icmp request),
> > > > > 
> > > > > the controller will become a choke point.
> > > > > 
> > > > > So we are looking for better ways that the ping request can be responsed by the vSwitch.
> > > > 
> > > > It's a reasonable request, and this feature will be useful to other software too (including the upcoming OVN), so we'd take a patch to implement this.

From duankebo at huawei.com  Tue Mar 24 00:04:25 2015
From: duankebo at huawei.com (Duankebo (Frank))
Date: Tue, 24 Mar 2015 07:04:25 +0000
Subject: [ovs-discuss] icmp packet
In-Reply-To: <20150324065511.GF21543@nicira.com>
References: <9F432A351CF9E14D99A6DF69B4557FBF72F79100@nkgeml506-mbx.china.huawei.com>
 <20150323155930.GB31376@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174BC5@SZXEMA504-MBX.china.huawei.com>
 <20150324034616.GA21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C48@SZXEMA504-MBX.china.huawei.com>
 <20150324063228.GD21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C65@SZXEMA504-MBX.china.huawei.com>
 <20150324064407.GE21543@nicira.com>
 <D7E5E3A5A61527479B3F85C3FB29614D89174C7C@SZXEMA504-MBX.china.huawei.com>
 <20150324065511.GF21543@nicira.com>
Message-ID: <D7E5E3A5A61527479B3F85C3FB29614D89174C9A@SZXEMA504-MBX.china.huawei.com>

OK, I see. You are very humorous!

Though our team members aren't familiar with OVS, I will try to find some who can help developing this feature.

Thank you!

-----邮件原件-----
发件人: Ben Pfaff [mailto:blp at nicira.com] 
发送时间: 2015年3月24日 14:55
收件人: Duankebo (Frank)
抄送: discuss at openvswitch.org
主题: Re: [ovs-discuss] icmp packet

We will review and apply a patch from someone who develops and posts such a patch.

On Tue, Mar 24, 2015 at 06:49:59AM +0000, Duankebo (Frank) wrote:
> Hi Ben, Sorry for the misunderstanding. But will you please tell me how to "take a patch" implement the feature, what's the difference between "develop a patch" and "take a patch"?
> 
> Thank you!
> 
> -----邮件原件-----
> 发件人: Ben Pfaff [mailto:blp at nicira.com]
> 发送时间: 2015年3月24日 14:44
> 收件人: Duankebo (Frank)
> 抄送: discuss at openvswitch.org; Lilin (pineorange, IT); Liyi (David, 
> ITPL)
> 主题: Re: [ovs-discuss] icmp packet
> 
> I never said that we would develop such a patch.  I said that we would take a patch to implement this.
> 
> On Tue, Mar 24, 2015 at 06:39:57AM +0000, Duankebo (Frank) wrote:
> > Oh, I mean when you will develop the patch contains this feature?
> > 
> > -----邮件原件-----
> > 发件人: Ben Pfaff [mailto:blp at nicira.com]
> > 发送时间: 2015年3月24日 14:32
> > 收件人: Duankebo (Frank)
> > 抄送: discuss at openvswitch.org; Lilin (pineorange, IT); Liyi (David,
> > ITPL)
> > 主题: Re: [ovs-discuss] icmp packet
> > 
> > It'll be ready when you send it.
> > 
> > On Tue, Mar 24, 2015 at 06:22:56AM +0000, Duankebo (Frank) wrote:
> > > Great! Thank you!
> > > 
> > > BTW: When the patch will be ready? Will you please send me a copy for test?
> > > 
> > > 
> > > 发件人: Ben Pfaff [mailto:blp at nicira.com]
> > > 发送时间: 2015年3月24日 11:46
> > > 收件人: Duankebo (Frank)
> > > 抄送: Lilin (pineorange, IT); discuss at openvswitch.org; Liyi (David,
> > > ITPL)
> > > 主题: Re: 答复: [ovs-discuss] icmp packet
> > > 
> > > On Tue, Mar 24, 2015 at 02:06:04AM +0000, Duankebo (Frank) wrote:
> > > > Thank you Ben.
> > > > 
> > > > Yes, we can packetIn the ping request packet to Openflow controller, which packet out a response then.
> > > > 
> > > > But for every ping request packet, the controller have to 
> > > > packetIn/packetOut the packet, imaging large scale datacenter 
> > > > where there are many hosts
> > > > 
> > > > which may send ping request to virtual address(means address 
> > > > don't exist physically and need Controller/switch to process the 
> > > > icmp request),
> > > > 
> > > > the controller will become a choke point.
> > > > 
> > > > So we are looking for better ways that the ping request can be responsed by the vSwitch.
> > > 
> > > It's a reasonable request, and this feature will be useful to other software too (including the upcoming OVN), so we'd take a patch to implement this.

From zhuzhuaiqiqi1314 at gmail.com  Tue Mar 24 02:52:46 2015
From: zhuzhuaiqiqi1314 at gmail.com (Zhang Tianzhu)
Date: Tue, 24 Mar 2015 10:52:46 +0100
Subject: [ovs-discuss] OVS requirements on Hardware
Message-ID: <CAKbhD0zLns5xLwHsT15cBv2Lf-LSSkQP==iwjyf5pLUwjd7ZGQ@mail.gmail.com>

Hi, everyone. I'm new to OVS and get a question to ask:  I want to explore
OVS integrated on a board named Arduino Yun,  the list of hardware
components are shown below:

ProcessorAtheros AR9331ArchitectureMIPS @400MHzOperating
Voltage3.3VEthernetIEEE
802.3 10/100Mbit/sWiFiIEEE 802.11b/g/nUSB Type-A2.0 HostCard ReaderMicro-SD
onlyRAM64 MB DDR2Flash Memory16 MBPoE compatible 802.3af card support (see
the note below) Length73 mmWidth53 mmWeight32 g


Will this board work very well with OVS? Will this board provide some
difficulties or performance limitations on OVS?
  Thanks in advance and waiting for your reply

  Best Regards
  Tianzhu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150324/c55dbabf/attachment.html>

From john.hurley at netronome.com  Tue Mar 24 02:56:38 2015
From: john.hurley at netronome.com (John Hurley)
Date: Tue, 24 Mar 2015 09:56:38 +0000
Subject: [ovs-discuss] ovs-conntrack kernel panic
In-Reply-To: <CANr6G5x=4MOhTEmZLV_UkK0Xj77E19KNtnoq94RxNL9DBvTmeg@mail.gmail.com>
References: <CAK+XE=k9Oq8Pii+DEva2ZJ_YcCAz3Nxys=ojOHraTAdWKE4iCg@mail.gmail.com>
 <CANr6G5x=4MOhTEmZLV_UkK0Xj77E19KNtnoq94RxNL9DBvTmeg@mail.gmail.com>
Message-ID: <CAK+XE==0fQVizdqMxPU=C2W7d3+zfnPWukrR69wTrsX_hSY7wQ@mail.gmail.com>

Hi Joe,

Thanks for the response.
I have ensured the nf_conntrack_ipv4 module is loaded but still cannot get
the commit to work.

I am running Ubuntu 14.04
Kernel version: 3.16.0-30-generic

John

On Mon, Mar 23, 2015 at 6:27 PM, Joe Stringer <joestringer at nicira.com>
wrote:

> Hi John,
>
> I strongly suspect in this case, conntrack has been unable to identify
> the connection. There's two parts to this: Perhaps you need to load
> nf_conntrack_ipv4? if that module is not loaded, then conntrack cannot
> identify any IP traffic. Separately, to address the crash, the line
> with the nf_ct_is_confirmed() call likely needs to check if ct is
> non-NULL first.
>
> One useful datapoint is what kernel version/distro are you running?
> I've been testing on the latest net-next, although I should expect it
> work on anything back to linux-3.10. Perhaps earlier depending on the
> particular features required, YMMV.
>
> Apologies, there's a few bugs like this which I have found in local
> testing but I have not pushed the changes yet. This is in part because
> the ongoing development is against the linux tree, so I haven't
> backported the current development code to build inside the OVS tree.
>
> Without the commit, the nf_conntrack tables will not be populated.
>
> On 23 March 2015 at 09:49, John Hurley <john.hurley at netronome.com> wrote:
> > Hi,
> > I am interested in using Conntrack within OVS and have installed the
> latest
> > version from the banch (
> https://github.com/justinpettit/ovs/tree/conntrack).
> >
> > When I run an example mentioned in the tests:
> >
> > ovs-ofctl del-flows br0
> > ovs-ofctl add-flow br0 \
> >     "in_port=1,conn_state=-trk,tcp,action=ct(commit,zone=9),2"
> > ovs-ofctl add-flow br0 \
> >     "in_port=2,conn_state=-trk,tcp,action=ct(recirc,zone=9)"
> > ovs-ofctl add-flow br0 "in_port=2,conn_state=+trk+est-new,tcp,action=1"
> > ovs-ofctl add-flow br0
> "in_port=2,conn_state=+trk-est+new,tcp,action=drop"
> > ovs-ofctl add-flow br0 priority=10,action=normal
> >
> > I am seeing a kernel panic for the 'commit' action.
> > I have traced this to the nf_ct_is_confirmed(ct) call on the nf_conntrack
> > module.
> > If I edit the code to avoid this check I avoid the panic but am getting
> an
> > error response from calls such as 'nf_ct_get(skb, &ctinfo)'.
> >
> > It appears that ovs-conntrack is not populating the nf_conntrack tables
> for
> > me.
> > Is there any information on installing/running the ovs-conntrack branch
> > specifically or is there anything else that should be done on top of the
> > standard OVS installation.
> > Doing an lsmod I can see both openvswitch and nf_conntrack modules
> running.
> >
> > Thanks,
> >
> > John
> >
> >
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150324/1a443580/attachment.html>

From john.hurley at netronome.com  Tue Mar 24 09:03:27 2015
From: john.hurley at netronome.com (John Hurley)
Date: Tue, 24 Mar 2015 16:03:27 +0000
Subject: [ovs-discuss] ovs-conntrack kernel panic
In-Reply-To: <CAK+XE==0fQVizdqMxPU=C2W7d3+zfnPWukrR69wTrsX_hSY7wQ@mail.gmail.com>
References: <CAK+XE=k9Oq8Pii+DEva2ZJ_YcCAz3Nxys=ojOHraTAdWKE4iCg@mail.gmail.com>
 <CANr6G5x=4MOhTEmZLV_UkK0Xj77E19KNtnoq94RxNL9DBvTmeg@mail.gmail.com>
 <CAK+XE==0fQVizdqMxPU=C2W7d3+zfnPWukrR69wTrsX_hSY7wQ@mail.gmail.com>
Message-ID: <CAK+XE=mVW-aVGdipWKg1A1JCAjM-riJkJ4NPdNRa_VrmvD=rSg@mail.gmail.com>

Hi Joe,


Following on from my earlier message, I have tested a few more scenarios.
It seems that Conntrack works fine for UDP and ICMP packet flows.
Earlier I had been testing with TCP traffic.
This is still not working.
Any ideas on why TCP would be failing on the conntrack commit?

I have also noticed that if I replay UDP packets shorter than 64 bytes into
OVS they are rejected by conntract and can cause the kernel panic issue.
The NULL check on the nf_ct_is_confirmed() you mentioned earlier is
required to prevent this from happening.

John


On Tue, Mar 24, 2015 at 9:56 AM, John Hurley <john.hurley at netronome.com>
wrote:

> Hi Joe,
>
> Thanks for the response.
> I have ensured the nf_conntrack_ipv4 module is loaded but still cannot get
> the commit to work.
>
> I am running Ubuntu 14.04
> Kernel version: 3.16.0-30-generic
>
> John
>
> On Mon, Mar 23, 2015 at 6:27 PM, Joe Stringer <joestringer at nicira.com>
> wrote:
>
>> Hi John,
>>
>> I strongly suspect in this case, conntrack has been unable to identify
>> the connection. There's two parts to this: Perhaps you need to load
>> nf_conntrack_ipv4? if that module is not loaded, then conntrack cannot
>> identify any IP traffic. Separately, to address the crash, the line
>> with the nf_ct_is_confirmed() call likely needs to check if ct is
>> non-NULL first.
>>
>> One useful datapoint is what kernel version/distro are you running?
>> I've been testing on the latest net-next, although I should expect it
>> work on anything back to linux-3.10. Perhaps earlier depending on the
>> particular features required, YMMV.
>>
>> Apologies, there's a few bugs like this which I have found in local
>> testing but I have not pushed the changes yet. This is in part because
>> the ongoing development is against the linux tree, so I haven't
>> backported the current development code to build inside the OVS tree.
>>
>> Without the commit, the nf_conntrack tables will not be populated.
>>
>> On 23 March 2015 at 09:49, John Hurley <john.hurley at netronome.com> wrote:
>> > Hi,
>> > I am interested in using Conntrack within OVS and have installed the
>> latest
>> > version from the banch (
>> https://github.com/justinpettit/ovs/tree/conntrack).
>> >
>> > When I run an example mentioned in the tests:
>> >
>> > ovs-ofctl del-flows br0
>> > ovs-ofctl add-flow br0 \
>> >     "in_port=1,conn_state=-trk,tcp,action=ct(commit,zone=9),2"
>> > ovs-ofctl add-flow br0 \
>> >     "in_port=2,conn_state=-trk,tcp,action=ct(recirc,zone=9)"
>> > ovs-ofctl add-flow br0 "in_port=2,conn_state=+trk+est-new,tcp,action=1"
>> > ovs-ofctl add-flow br0
>> "in_port=2,conn_state=+trk-est+new,tcp,action=drop"
>> > ovs-ofctl add-flow br0 priority=10,action=normal
>> >
>> > I am seeing a kernel panic for the 'commit' action.
>> > I have traced this to the nf_ct_is_confirmed(ct) call on the
>> nf_conntrack
>> > module.
>> > If I edit the code to avoid this check I avoid the panic but am getting
>> an
>> > error response from calls such as 'nf_ct_get(skb, &ctinfo)'.
>> >
>> > It appears that ovs-conntrack is not populating the nf_conntrack tables
>> for
>> > me.
>> > Is there any information on installing/running the ovs-conntrack branch
>> > specifically or is there anything else that should be done on top of the
>> > standard OVS installation.
>> > Doing an lsmod I can see both openvswitch and nf_conntrack modules
>> running.
>> >
>> > Thanks,
>> >
>> > John
>> >
>> >
>> >
>> >
>> > _______________________________________________
>> > discuss mailing list
>> > discuss at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/discuss
>> >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150324/d1bebd28/attachment-0001.html>

From shettyg at nicira.com  Tue Mar 24 09:05:17 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 24 Mar 2015 09:05:17 -0700
Subject: [ovs-discuss] Is it possible to limit bandwidth for particular
 OVS port?
In-Reply-To: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>
References: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>
Message-ID: <CAHbON5rPDLZSxv0VD411kAPbNuJcT=_so+D6go3vRnu9mk8tEA@mail.gmail.com>

On Mon, Mar 23, 2015 at 8:01 PM, Tim Bagr <timbgr at gmail.com> wrote:
> Hello all,
>
> I tried to limit bandwidth for particular VM attached to OpenVSwitch port.
>
> There are VMs attached to virtual switch br3. I want to limit bandwidth for
> one VM, which is attached to br3 and in_port 2. Doing as follows:
> 1)
> # ovs-vsctl set port br3 qos=@newqos1 -- --id=@newqos1 create qos
> type=linux-htb other-config:max-rate=10 queues:123=@vn2queue --
> --id=@vn2queue create queue other-config:max-rate=10
> # ovs-ofctl add-flow br3
> "priority=50,in_port=2,actions=set_queue:123,normal"
>
> Command worked! The bandwidth is limited as expected for all traffic going
> through LOCAL port of br3, limit is very tight so even icmp echo is hardly
> passed. All VMs are affected by this.
>
> After that I tried to limit the bandwidth for only one VM, and give almost
> unlimited bandwidth for the others:
> 2)
> # ovs-vsctl set port br3 qos=@newqos1 -- --id=@newqos1 create qos
> type=linux-htb other-config:max-rate=100000000
> queues:123=4d65ddec-5c5d-4c87-8165-dd51431c7ab3
>
> Here the ID 4d65ddec-5c5d-4c87-8165-dd51431c7ab3 is that queue which was
> created in previous steps with max-rate=10
> OpenFlow rule for redirecting traffic from the in_port=2 to that queue
> remains the same.
>
> After that I got all VMs (including attached to in_port 2) has got that big
> bandwidth (100000000).
> But it was supposed that VM from port 2 cannot send even pings (as its
> traffic should be limited by max-rate=10).
>
>
> Am I doing something wrong or maybe have incorrect understanding how QoS
> works?

I believe that your understanding is a little flawed (or I did not
follow your description correctly).
For your case, I think you should be applying QoS on the outgoing
physical port (e.g ethX) which has been added as a port of OVS bridge
and not on the bridge itself (br3 in your case).

You usually create multiple queues with different configured min rate
and max rates.

e.g:
if eth1 is a port of br1:

sudo ovs-vsctl -- set port eth1 qos=@newqos \
-- --id=@newqos create qos type=linux-htb
other-config:max-rate=900000000 queues=10=@q0,20=@q1,30=@q2 \
-- --id=@q0 create queue other-config:min-rate=720000000
other-config:max-rate=900000000 \
-- --id=@q1 create queue other-config:min-rate=0
other-config:max-rate=80000000 \
-- --id=@q2 create queue other-config:min-rate=0 other-config:max-rate=70000000

The above creates 3 queues with queue-numbers 10, 20 and 30

The next step is to get the ofport value of 'eth1' using 'ovs-ofctl show br1'

Then you can add your flows for bridge br1 and direct particular set
of traffic to particular queues.
e.g:
sudo ovs-ofctl add-flow br1 priority=65500,in_port=3,actions=enqueue:2:10
sudo ovs-ofctl add-flow br1 priority=65500,in_port=4,actions=enqueue:2:20
sudo ovs-ofctl add-flow br1 priority=65500,in_port=5,actions=enqueue:2:30

Above in_port values 3, 4 and 5 can be vifs of your VMs if they have
been attached to br1.

The above example is not typically used in a typical OVS deployment
that involves overlay tunnels. In those cases, you will attach vifs to
a separate OVS bridge. Your flows on that bridge will enqueue to a
tunnel port's ofport value instead (But your queue is still on
physical port).





> Or it is a known issue within OVS?
> Please help.
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From alexw at nicira.com  Tue Mar 24 14:21:23 2015
From: alexw at nicira.com (Alex Wang)
Date: Tue, 24 Mar 2015 14:21:23 -0700
Subject: [ovs-discuss] ovs flow duration
In-Reply-To: <CAN2QyzaG1Ypbjj9=L+ad1N156mxw8Co0V5EVquqxMSvNc+rxTQ@mail.gmail.com>
References: <CAN2QyzaG1Ypbjj9=L+ad1N156mxw8Co0V5EVquqxMSvNc+rxTQ@mail.gmail.com>
Message-ID: <CAArS4XX-Wc-vH250HVCVBJb-P5Nyv_jTP1oPf5BQDaJjt2k6Hg@mail.gmail.com>

Hey,

I did not see any reason for the second flow to be deleted after 120s.
And you did not config the 'idle_timeout' which could cause the deletion.
So, both flow should be there forever.

Which version of ovs are you using?

Thanks,
Alex Wang,


On Mon, Mar 23, 2015 at 9:03 PM, Vinllen Chen <cvinllen at gmail.com> wrote:

> Hi all:
>     I build a small network to test the ping, the topology is showd below:
>
> host1 ---- switch1----switch2 ----host2
> host1 ip: 10.0.0.1
> host2 ip: 10.0.0.2
>     When i use host1 ping host2, and then use host2 ping host1, it works
> ok. Then i use "ovs-ofctl dump-flows switch2" command to show the flows:
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=1873.140s, table=0, n_packets=1843, n_bytes=180614,
> idle_age=0, priority=1,ip,nw_dst=10.0.0.1 actions=output:1
>  cookie=0x0, duration=118.427s, table=0, n_packets=118, n_bytes=11564,
> idle_age=0, priority=1,ip,nw_dst=10.0.0.2
> actions=mod_dl_dst:d3:97:e5:22:ea:ed,output:2
>     The second flow will disappear when time duration arrival 120s. My
> question is why doesn't the first flow disappear when time arrival 120s ?
>     Thankyou for anyone's relay
> Best wishes.
> Vinllen
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150324/908757a0/attachment.html>

From ricky.li at intel.com  Tue Mar 24 19:23:52 2015
From: ricky.li at intel.com (Li, Ricky)
Date: Wed, 25 Mar 2015 02:23:52 +0000
Subject: [ovs-discuss] User space tunneling doesn't support setting tunnel
 key (e.g. tunnel id for VxLAN) by flow
Message-ID: <75853E0D9A06FA47B4C2FE025ABEF6E001A76878@SHSMSX103.ccr.corp.intel.com>

Hi,

I tried to test user space tunneling according to this guide:
README-native-tunneling.md

Everything works in this guide, but when I tried to specify the tunnel ID with flow as below, there is a problem:
ovs-vsctl add-port int-br vxlan0 -- set interface vxlan0 type=vxlan  options:remote_ip=172.168.1.2 options:out_key=flow

I try to add an option: out_key=flow to make OVS specify the tunnel ID by flow as below:
ovs-ofctl add-flow int-br "in_port=LOCAL, icmp, actions=set_tunnel:3, output:1"     (1 is the port# of vxlan0)

But this setup doesn't work, because the output tunnel ID is still 0 (the default tunnel ID) but not 3.
I also tried the same flow with kernel space Datapath and it works, the tunnel ID will be changed by flow.

Then I looked up the source code related to user space tunneling and I can find when OVS tries to encapsulate the tunnel header, it will firstly try to build the tunnel header:

In ofproto-dpif-xlate.c: compose_output_action__()
                ...
            if (tnl_push_pop_send) {
                build_tunnel_send(ctx, xport, flow, odp_port);
                flow->tunnel = flow_tnl; /* Restore tunnel metadata */
            }
                ...
tnl_push_pop_send is the flag for user space tunneling, and it will try to build tunnel header in lib/tunnel.c:


In tunnel.c: tnl_port_build_header()

int
tnl_port_build_header(const struct ofport_dpif *ofport,
                      const struct flow *tnl_flow,
                      uint8_t dmac[ETH_ADDR_LEN],
                      uint8_t smac[ETH_ADDR_LEN],
                      ovs_be32 ip_src, struct ovs_action_push_tnl *data)
{
                ...
res = netdev_build_header(tnl_port->netdev, data);
                ...
}

We can find it calls the Netdev API "netdev_build_header" to build the tunnel header. If the tunnel ID is set by flow, it should be saved in the object "tnl_flow" (tnl_flow->tunnel->tun_id), but it's not passed into the Netdev API.

In netdev-vport.c: netdev_vxlan_build_header()
...
put_16aligned_be32(&vxh->vx_vni, htonl(ntohll(tnl_cfg->out_key) << 8));
...

The tunnel id (VNI) is directly set by tunnel port configuration (tnl_cfg), then I think the "options:out_key=flow" will never works because of this? The tunnel ID will always set with the tunnel configuration when we initiate it.

One suggestion is to add one more input for the Netdev API:
Int netdev_build_header(const struct netdev *netdev, struct ovs_action_push_tnl *data, const struct flow *tnl_flow)

The new input "const struct flow *tnl_flow" can be passed to the callback for building tunnel header, e.g. for VxLAN:
...
put_16aligned_be32(&vxh->vx_vni, htonl(ntohll(tnl_flow->tunnel.tun_id) << 8));
...

Similar changes can be made for other tunnel ports like GRE. This patch can work on my side with some simple experiments. I want to check if my understanding is right, and hope for any advices and inputs.

Regards,
Ricky

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150325/ae5b7f77/attachment.html>

From joestringer at nicira.com  Tue Mar 24 20:29:22 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Tue, 24 Mar 2015 20:29:22 -0700
Subject: [ovs-discuss] ovs-conntrack kernel panic
In-Reply-To: <CAK+XE=mVW-aVGdipWKg1A1JCAjM-riJkJ4NPdNRa_VrmvD=rSg@mail.gmail.com>
References: <CAK+XE=k9Oq8Pii+DEva2ZJ_YcCAz3Nxys=ojOHraTAdWKE4iCg@mail.gmail.com>
 <CANr6G5x=4MOhTEmZLV_UkK0Xj77E19KNtnoq94RxNL9DBvTmeg@mail.gmail.com>
 <CAK+XE==0fQVizdqMxPU=C2W7d3+zfnPWukrR69wTrsX_hSY7wQ@mail.gmail.com>
 <CAK+XE=mVW-aVGdipWKg1A1JCAjM-riJkJ4NPdNRa_VrmvD=rSg@mail.gmail.com>
Message-ID: <CANr6G5zoHsgp2XED_ASqW6RFT+Aqqn+06JR69JHtd=OjeW49TA@mail.gmail.com>

Hmm. You might be able to get more information about how the
datapath(incl. conntrack) is identifying the flow by turning up debug
logging in vswitchd (look for upcall and flow_put):

ovs-appctl vlog/set dpif:dbg

The conntrack tools can also be useful, although you'll need to filter
the output to only the relevant traffic:

conntrack -L

I see you're also using zones; removing those would reduce the problem space.

If it's still not clear, there's always the option to log some
messages in ovs_ct_execute() and trace the execution.

On 24 March 2015 at 09:03, John Hurley <john.hurley at netronome.com> wrote:
> Hi Joe,
>
>
> Following on from my earlier message, I have tested a few more scenarios.
> It seems that Conntrack works fine for UDP and ICMP packet flows.
> Earlier I had been testing with TCP traffic.
> This is still not working.
> Any ideas on why TCP would be failing on the conntrack commit?
>
> I have also noticed that if I replay UDP packets shorter than 64 bytes into
> OVS they are rejected by conntract and can cause the kernel panic issue.
> The NULL check on the nf_ct_is_confirmed() you mentioned earlier is required
> to prevent this from happening.
>
> John
>
>
> On Tue, Mar 24, 2015 at 9:56 AM, John Hurley <john.hurley at netronome.com>
> wrote:
>>
>> Hi Joe,
>>
>> Thanks for the response.
>> I have ensured the nf_conntrack_ipv4 module is loaded but still cannot get
>> the commit to work.
>>
>> I am running Ubuntu 14.04
>> Kernel version: 3.16.0-30-generic
>>
>> John
>>
>> On Mon, Mar 23, 2015 at 6:27 PM, Joe Stringer <joestringer at nicira.com>
>> wrote:
>>>
>>> Hi John,
>>>
>>> I strongly suspect in this case, conntrack has been unable to identify
>>> the connection. There's two parts to this: Perhaps you need to load
>>> nf_conntrack_ipv4? if that module is not loaded, then conntrack cannot
>>> identify any IP traffic. Separately, to address the crash, the line
>>> with the nf_ct_is_confirmed() call likely needs to check if ct is
>>> non-NULL first.
>>>
>>> One useful datapoint is what kernel version/distro are you running?
>>> I've been testing on the latest net-next, although I should expect it
>>> work on anything back to linux-3.10. Perhaps earlier depending on the
>>> particular features required, YMMV.
>>>
>>> Apologies, there's a few bugs like this which I have found in local
>>> testing but I have not pushed the changes yet. This is in part because
>>> the ongoing development is against the linux tree, so I haven't
>>> backported the current development code to build inside the OVS tree.
>>>
>>> Without the commit, the nf_conntrack tables will not be populated.
>>>
>>> On 23 March 2015 at 09:49, John Hurley <john.hurley at netronome.com> wrote:
>>> > Hi,
>>> > I am interested in using Conntrack within OVS and have installed the
>>> > latest
>>> > version from the banch
>>> > (https://github.com/justinpettit/ovs/tree/conntrack).
>>> >
>>> > When I run an example mentioned in the tests:
>>> >
>>> > ovs-ofctl del-flows br0
>>> > ovs-ofctl add-flow br0 \
>>> >     "in_port=1,conn_state=-trk,tcp,action=ct(commit,zone=9),2"
>>> > ovs-ofctl add-flow br0 \
>>> >     "in_port=2,conn_state=-trk,tcp,action=ct(recirc,zone=9)"
>>> > ovs-ofctl add-flow br0 "in_port=2,conn_state=+trk+est-new,tcp,action=1"
>>> > ovs-ofctl add-flow br0
>>> > "in_port=2,conn_state=+trk-est+new,tcp,action=drop"
>>> > ovs-ofctl add-flow br0 priority=10,action=normal
>>> >
>>> > I am seeing a kernel panic for the 'commit' action.
>>> > I have traced this to the nf_ct_is_confirmed(ct) call on the
>>> > nf_conntrack
>>> > module.
>>> > If I edit the code to avoid this check I avoid the panic but am getting
>>> > an
>>> > error response from calls such as 'nf_ct_get(skb, &ctinfo)'.
>>> >
>>> > It appears that ovs-conntrack is not populating the nf_conntrack tables
>>> > for
>>> > me.
>>> > Is there any information on installing/running the ovs-conntrack branch
>>> > specifically or is there anything else that should be done on top of
>>> > the
>>> > standard OVS installation.
>>> > Doing an lsmod I can see both openvswitch and nf_conntrack modules
>>> > running.
>>> >
>>> > Thanks,
>>> >
>>> > John
>>> >
>>> >
>>> >
>>> >
>>> > _______________________________________________
>>> > discuss mailing list
>>> > discuss at openvswitch.org
>>> > http://openvswitch.org/mailman/listinfo/discuss
>>> >
>>
>>
>

From joestringer at nicira.com  Tue Mar 24 23:04:22 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Tue, 24 Mar 2015 23:04:22 -0700
Subject: [ovs-discuss] ovs-conntrack kernel panic
In-Reply-To: <CANr6G5zoHsgp2XED_ASqW6RFT+Aqqn+06JR69JHtd=OjeW49TA@mail.gmail.com>
References: <CAK+XE=k9Oq8Pii+DEva2ZJ_YcCAz3Nxys=ojOHraTAdWKE4iCg@mail.gmail.com>
 <CANr6G5x=4MOhTEmZLV_UkK0Xj77E19KNtnoq94RxNL9DBvTmeg@mail.gmail.com>
 <CAK+XE==0fQVizdqMxPU=C2W7d3+zfnPWukrR69wTrsX_hSY7wQ@mail.gmail.com>
 <CAK+XE=mVW-aVGdipWKg1A1JCAjM-riJkJ4NPdNRa_VrmvD=rSg@mail.gmail.com>
 <CANr6G5zoHsgp2XED_ASqW6RFT+Aqqn+06JR69JHtd=OjeW49TA@mail.gmail.com>
Message-ID: <CANr6G5wztpRsRP1axww4SG6JuDZAfwyxDcACMkBgZ4k34H-tzA@mail.gmail.com>

FYI I'm planning to update this branch this week - hopefully tomorrow,
so you might have better luck with that version.

Cheers,
Joe

On 24 March 2015 at 20:29, Joe Stringer <joestringer at nicira.com> wrote:
> Hmm. You might be able to get more information about how the
> datapath(incl. conntrack) is identifying the flow by turning up debug
> logging in vswitchd (look for upcall and flow_put):
>
> ovs-appctl vlog/set dpif:dbg
>
> The conntrack tools can also be useful, although you'll need to filter
> the output to only the relevant traffic:
>
> conntrack -L
>
> I see you're also using zones; removing those would reduce the problem space.
>
> If it's still not clear, there's always the option to log some
> messages in ovs_ct_execute() and trace the execution.
>
> On 24 March 2015 at 09:03, John Hurley <john.hurley at netronome.com> wrote:
>> Hi Joe,
>>
>>
>> Following on from my earlier message, I have tested a few more scenarios.
>> It seems that Conntrack works fine for UDP and ICMP packet flows.
>> Earlier I had been testing with TCP traffic.
>> This is still not working.
>> Any ideas on why TCP would be failing on the conntrack commit?
>>
>> I have also noticed that if I replay UDP packets shorter than 64 bytes into
>> OVS they are rejected by conntract and can cause the kernel panic issue.
>> The NULL check on the nf_ct_is_confirmed() you mentioned earlier is required
>> to prevent this from happening.
>>
>> John
>>
>>
>> On Tue, Mar 24, 2015 at 9:56 AM, John Hurley <john.hurley at netronome.com>
>> wrote:
>>>
>>> Hi Joe,
>>>
>>> Thanks for the response.
>>> I have ensured the nf_conntrack_ipv4 module is loaded but still cannot get
>>> the commit to work.
>>>
>>> I am running Ubuntu 14.04
>>> Kernel version: 3.16.0-30-generic
>>>
>>> John
>>>
>>> On Mon, Mar 23, 2015 at 6:27 PM, Joe Stringer <joestringer at nicira.com>
>>> wrote:
>>>>
>>>> Hi John,
>>>>
>>>> I strongly suspect in this case, conntrack has been unable to identify
>>>> the connection. There's two parts to this: Perhaps you need to load
>>>> nf_conntrack_ipv4? if that module is not loaded, then conntrack cannot
>>>> identify any IP traffic. Separately, to address the crash, the line
>>>> with the nf_ct_is_confirmed() call likely needs to check if ct is
>>>> non-NULL first.
>>>>
>>>> One useful datapoint is what kernel version/distro are you running?
>>>> I've been testing on the latest net-next, although I should expect it
>>>> work on anything back to linux-3.10. Perhaps earlier depending on the
>>>> particular features required, YMMV.
>>>>
>>>> Apologies, there's a few bugs like this which I have found in local
>>>> testing but I have not pushed the changes yet. This is in part because
>>>> the ongoing development is against the linux tree, so I haven't
>>>> backported the current development code to build inside the OVS tree.
>>>>
>>>> Without the commit, the nf_conntrack tables will not be populated.
>>>>
>>>> On 23 March 2015 at 09:49, John Hurley <john.hurley at netronome.com> wrote:
>>>> > Hi,
>>>> > I am interested in using Conntrack within OVS and have installed the
>>>> > latest
>>>> > version from the banch
>>>> > (https://github.com/justinpettit/ovs/tree/conntrack).
>>>> >
>>>> > When I run an example mentioned in the tests:
>>>> >
>>>> > ovs-ofctl del-flows br0
>>>> > ovs-ofctl add-flow br0 \
>>>> >     "in_port=1,conn_state=-trk,tcp,action=ct(commit,zone=9),2"
>>>> > ovs-ofctl add-flow br0 \
>>>> >     "in_port=2,conn_state=-trk,tcp,action=ct(recirc,zone=9)"
>>>> > ovs-ofctl add-flow br0 "in_port=2,conn_state=+trk+est-new,tcp,action=1"
>>>> > ovs-ofctl add-flow br0
>>>> > "in_port=2,conn_state=+trk-est+new,tcp,action=drop"
>>>> > ovs-ofctl add-flow br0 priority=10,action=normal
>>>> >
>>>> > I am seeing a kernel panic for the 'commit' action.
>>>> > I have traced this to the nf_ct_is_confirmed(ct) call on the
>>>> > nf_conntrack
>>>> > module.
>>>> > If I edit the code to avoid this check I avoid the panic but am getting
>>>> > an
>>>> > error response from calls such as 'nf_ct_get(skb, &ctinfo)'.
>>>> >
>>>> > It appears that ovs-conntrack is not populating the nf_conntrack tables
>>>> > for
>>>> > me.
>>>> > Is there any information on installing/running the ovs-conntrack branch
>>>> > specifically or is there anything else that should be done on top of
>>>> > the
>>>> > standard OVS installation.
>>>> > Doing an lsmod I can see both openvswitch and nf_conntrack modules
>>>> > running.
>>>> >
>>>> > Thanks,
>>>> >
>>>> > John
>>>> >
>>>> >
>>>> >
>>>> >
>>>> > _______________________________________________
>>>> > discuss mailing list
>>>> > discuss at openvswitch.org
>>>> > http://openvswitch.org/mailman/listinfo/discuss
>>>> >
>>>
>>>
>>

From jacywang at mail.ustc.edu.cn  Wed Mar 25 01:38:23 2015
From: jacywang at mail.ustc.edu.cn (jacywang at mail.ustc.edu.cn)
Date: Wed, 25 Mar 2015 16:38:23 +0800 (GMT+08:00)
Subject: [ovs-discuss] OVS configure problem| ovs-vsctl database connection
 failed (No such file or directory)
Message-ID: <3b556e29.17c7f.14c50151c3b.Coremail.jacywang@mail.ustc.edu.cn>

Hello, everyone.

I'm new to OVS, and I installed OVS2.3.1 in my ubuntu12.04LTS system. I followed all the instructions in https://github.com/openvswitch/ovs/blob/master/INSTALL.Debian.md. But the problem is the server is working with var/run/openvswitch/db.sock
by default(as following)


root at mininet:/home/mininet# ps -ef | grep ovs                                                    
root      2867     1  0 16:07 ?        00:00:00 ovsdb-server: monitoring pid 2868     (healthy)                                                                                                               
root      2868  2867  0 16:07 ?        00:00:00 ovsdb-server /etc/openvswitch/conf.db -vconsole:emer -vsyslog:err -vfile:info --remote=punix:/var/run/openvswitch/db.sock --private-key=db:Open_vSwitch,SSL,private_key --certificate=db:Open_vSwitch,SSL,certificate --bootstrap-ca-cert=db:Open_vSwitch,SSL,ca_cert --no-chdir --log-file=/var/log/openvswitch/ovsdb-server.log --pidfile=/var/run/openvswitch/ovsdb-server.pid --detach --monitor
root      2872     1  0 16:07 ?        00:00:00 ovs-vswitchd: monitoring pid 2873 (healthy)                                                                                                                                                                                    
root      2873  2872  0 16:07 ?        00:00:00 ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfile:info --mlockall --no-chdir --log-file=/var/log/openvswitch/ovs-vswitchd.log --pidfile=/var/run/openvswitch/ovs-vswitchd.pid --detach --monitor

while ovs-vsctl command is always trying to connect with /usr/local/var/run/openvswitch/db.sock, thus raising the following error:
root at mininet:/home/mininet# ovs-vsctl show
ovs-vsctl: unix:/usr/local/var/run/openvswitch/db.sock: database connection failed (No such file or directory)

Does anyone know how to configure this?

Thanks.

Jacy
2015.3.25

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150325/ef3cfa82/attachment.html>

From shettyg at nicira.com  Wed Mar 25 10:49:05 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Wed, 25 Mar 2015 10:49:05 -0700
Subject: [ovs-discuss] OVS configure problem| ovs-vsctl database
 connection failed (No such file or directory)
In-Reply-To: <3b556e29.17c7f.14c50151c3b.Coremail.jacywang@mail.ustc.edu.cn>
References: <3b556e29.17c7f.14c50151c3b.Coremail.jacywang@mail.ustc.edu.cn>
Message-ID: <CAHbON5r=JYxY6Ge0Aa3RDGWm_5L08sbd+wYYMTzmLa26vLeYMw@mail.gmail.com>

Run 'find / -name ovs-vsctl'. Do you see two of them?

On Wed, Mar 25, 2015 at 1:38 AM,  <jacywang at mail.ustc.edu.cn> wrote:
> Hello, everyone.
>
> I'm new to OVS, and I installed OVS2.3.1 in my ubuntu12.04LTS system. I
> followed all the instructions in
> https://github.com/openvswitch/ovs/blob/master/INSTALL.Debian.md. But the
> problem is the server is working with var/run/openvswitch/db.sock
> by default(as following)
>
> root at mininet:/home/mininet# ps -ef | grep ovs
> root      2867     1  0 16:07 ?        00:00:00 ovsdb-server: monitoring pid
> 2868     (healthy)
> root      2868  2867  0 16:07 ?        00:00:00 ovsdb-server
> /etc/openvswitch/conf.db -vconsole:emer -vsyslog:err -vfile:info
> --remote=punix:/var/run/openvswitch/db.sock
> --private-key=db:Open_vSwitch,SSL,private_key
> --certificate=db:Open_vSwitch,SSL,certificate
> --bootstrap-ca-cert=db:Open_vSwitch,SSL,ca_cert --no-chdir
> --log-file=/var/log/openvswitch/ovsdb-server.log
> --pidfile=/var/run/openvswitch/ovsdb-server.pid --detach --monitor
> root      2872     1  0 16:07 ?        00:00:00 ovs-vswitchd: monitoring pid
> 2873 (healthy)
> root      2873  2872  0 16:07 ?        00:00:00 ovs-vswitchd
> unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfile:info
> --mlockall --no-chdir --log-file=/var/log/openvswitch/ovs-vswitchd.log
> --pidfile=/var/run/openvswitch/ovs-vswitchd.pid --detach --monitor
>
> while ovs-vsctl command is always trying to connect with
> /usr/local/var/run/openvswitch/db.sock, thus raising the following error:
> root at mininet:/home/mininet# ovs-vsctl show
> ovs-vsctl: unix:/usr/local/var/run/openvswitch/db.sock: database connection
> failed (No such file or directory)
>
> Does anyone know how to configure this?
>
> Thanks.
>
> Jacy
> 2015.3.25
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From pshelar at nicira.com  Wed Mar 25 14:52:34 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Wed, 25 Mar 2015 14:52:34 -0700
Subject: [ovs-discuss] User space tunneling doesn't support setting
 tunnel key (e.g. tunnel id for VxLAN) by flow
In-Reply-To: <75853E0D9A06FA47B4C2FE025ABEF6E001A76878@SHSMSX103.ccr.corp.intel.com>
References: <75853E0D9A06FA47B4C2FE025ABEF6E001A76878@SHSMSX103.ccr.corp.intel.com>
Message-ID: <CALnjE+o+O9okOLjhL2orH2+Lzi6YOF2oGx78tk0m6f6BHHoAug@mail.gmail.com>

On Tue, Mar 24, 2015 at 7:23 PM, Li, Ricky <ricky.li at intel.com> wrote:
> Hi,
>
>
>
> I tried to test user space tunneling according to this guide:
>
> README-native-tunneling.md
>
>
>
> Everything works in this guide, but when I tried to specify the tunnel ID
> with flow as below, there is a problem:
>
> ovs-vsctl add-port int-br vxlan0 -- set interface vxlan0 type=vxlan
> options:remote_ip=172.168.1.2 options:out_key=flow
>
>
>
> I try to add an option: out_key=flow to make OVS specify the tunnel ID by
> flow as below:
>
> ovs-ofctl add-flow int-br “in_port=LOCAL, icmp, actions=set_tunnel:3,
> output:1”     (1 is the port# of vxlan0)
>
>
>
> But this setup doesn’t work, because the output tunnel ID is still 0 (the
> default tunnel ID) but not 3.
>
> I also tried the same flow with kernel space Datapath and it works, the
> tunnel ID will be changed by flow.
>
>
>
> Then I looked up the source code related to user space tunneling and I can
> find when OVS tries to encapsulate the tunnel header, it will firstly try to
> build the tunnel header:
>
>
>
> In ofproto-dpif-xlate.c: compose_output_action__()
>
>                 …
>
>             if (tnl_push_pop_send) {
>
>                 build_tunnel_send(ctx, xport, flow, odp_port);
>
>                 flow->tunnel = flow_tnl; /* Restore tunnel metadata */
>
>             }
>
>                 …
>
> tnl_push_pop_send is the flag for user space tunneling, and it will try to
> build tunnel header in lib/tunnel.c:
>
>
>
>
>
> In tunnel.c: tnl_port_build_header()
>
>
>
> int
>
> tnl_port_build_header(const struct ofport_dpif *ofport,
>
>                       const struct flow *tnl_flow,
>
>                       uint8_t dmac[ETH_ADDR_LEN],
>
>                       uint8_t smac[ETH_ADDR_LEN],
>
>                       ovs_be32 ip_src, struct ovs_action_push_tnl *data)
>
> {
>
>                 …
>
> res = netdev_build_header(tnl_port->netdev, data);
>
>                 …
>
> }
>
>
>
> We can find it calls the Netdev API “netdev_build_header” to build the
> tunnel header. If the tunnel ID is set by flow, it should be saved in the
> object “tnl_flow” (tnl_flow->tunnel->tun_id), but it’s not passed into the
> Netdev API.
>
>
>
> In netdev-vport.c: netdev_vxlan_build_header()
>
> …
>
> put_16aligned_be32(&vxh->vx_vni, htonl(ntohll(tnl_cfg->out_key) << 8));
>
> …
>
>
>
> The tunnel id (VNI) is directly set by tunnel port configuration (tnl_cfg),
> then I think the “options:out_key=flow” will never works because of this?
> The tunnel ID will always set with the tunnel configuration when we initiate
> it.
>
>
>
> One suggestion is to add one more input for the Netdev API:
>
> Int netdev_build_header(const struct netdev *netdev, struct
> ovs_action_push_tnl *data, const struct flow *tnl_flow)
>
>
>
> The new input “const struct flow *tnl_flow” can be passed to the callback
> for building tunnel header, e.g. for VxLAN:
>
> …
>
> put_16aligned_be32(&vxh->vx_vni, htonl(ntohll(tnl_flow->tunnel.tun_id) <<
> 8));
>
> …
>
>
>
> Similar changes can be made for other tunnel ports like GRE. This patch can
> work on my side with some simple experiments. I want to check if my
> understanding is right, and hope for any advices and inputs.
>
>
>
Your analysis looks correct. Can you send patch and test case
(tests/tunnel-push-pop.at). So that it does not break in future.

Thanks.

From joestringer at nicira.com  Wed Mar 25 16:56:07 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Wed, 25 Mar 2015 16:56:07 -0700
Subject: [ovs-discuss] ovs-conntrack kernel panic
In-Reply-To: <CANr6G5wztpRsRP1axww4SG6JuDZAfwyxDcACMkBgZ4k34H-tzA@mail.gmail.com>
References: <CAK+XE=k9Oq8Pii+DEva2ZJ_YcCAz3Nxys=ojOHraTAdWKE4iCg@mail.gmail.com>
 <CANr6G5x=4MOhTEmZLV_UkK0Xj77E19KNtnoq94RxNL9DBvTmeg@mail.gmail.com>
 <CAK+XE==0fQVizdqMxPU=C2W7d3+zfnPWukrR69wTrsX_hSY7wQ@mail.gmail.com>
 <CAK+XE=mVW-aVGdipWKg1A1JCAjM-riJkJ4NPdNRa_VrmvD=rSg@mail.gmail.com>
 <CANr6G5zoHsgp2XED_ASqW6RFT+Aqqn+06JR69JHtd=OjeW49TA@mail.gmail.com>
 <CANr6G5wztpRsRP1axww4SG6JuDZAfwyxDcACMkBgZ4k34H-tzA@mail.gmail.com>
Message-ID: <CANr6G5yo9P2hvqV260xyVRfU5r1Wpy=aX7W8e+-q_evU9qBAag@mail.gmail.com>

I updated the branch at https://github.com/justinpettit/ovs/commits/conntrack.

This includes various bugfixes, IPv6, connlabel, initial work on
IP(v4) fragments and ALGs - mostly in userspace. It also makes use of
Jarno's recent xlate context work to save the OF pipeline when
recirculating.

There are several new tests in tests/kmod-traffic.at; The python
script for running those tests requires pyftpdlib.

On 24 March 2015 at 23:04, Joe Stringer <joestringer at nicira.com> wrote:
> FYI I'm planning to update this branch this week - hopefully tomorrow,
> so you might have better luck with that version.
>
> Cheers,
> Joe
>
> On 24 March 2015 at 20:29, Joe Stringer <joestringer at nicira.com> wrote:
>> Hmm. You might be able to get more information about how the
>> datapath(incl. conntrack) is identifying the flow by turning up debug
>> logging in vswitchd (look for upcall and flow_put):
>>
>> ovs-appctl vlog/set dpif:dbg
>>
>> The conntrack tools can also be useful, although you'll need to filter
>> the output to only the relevant traffic:
>>
>> conntrack -L
>>
>> I see you're also using zones; removing those would reduce the problem space.
>>
>> If it's still not clear, there's always the option to log some
>> messages in ovs_ct_execute() and trace the execution.
>>
>> On 24 March 2015 at 09:03, John Hurley <john.hurley at netronome.com> wrote:
>>> Hi Joe,
>>>
>>>
>>> Following on from my earlier message, I have tested a few more scenarios.
>>> It seems that Conntrack works fine for UDP and ICMP packet flows.
>>> Earlier I had been testing with TCP traffic.
>>> This is still not working.
>>> Any ideas on why TCP would be failing on the conntrack commit?
>>>
>>> I have also noticed that if I replay UDP packets shorter than 64 bytes into
>>> OVS they are rejected by conntract and can cause the kernel panic issue.
>>> The NULL check on the nf_ct_is_confirmed() you mentioned earlier is required
>>> to prevent this from happening.
>>>
>>> John
>>>
>>>
>>> On Tue, Mar 24, 2015 at 9:56 AM, John Hurley <john.hurley at netronome.com>
>>> wrote:
>>>>
>>>> Hi Joe,
>>>>
>>>> Thanks for the response.
>>>> I have ensured the nf_conntrack_ipv4 module is loaded but still cannot get
>>>> the commit to work.
>>>>
>>>> I am running Ubuntu 14.04
>>>> Kernel version: 3.16.0-30-generic
>>>>
>>>> John
>>>>
>>>> On Mon, Mar 23, 2015 at 6:27 PM, Joe Stringer <joestringer at nicira.com>
>>>> wrote:
>>>>>
>>>>> Hi John,
>>>>>
>>>>> I strongly suspect in this case, conntrack has been unable to identify
>>>>> the connection. There's two parts to this: Perhaps you need to load
>>>>> nf_conntrack_ipv4? if that module is not loaded, then conntrack cannot
>>>>> identify any IP traffic. Separately, to address the crash, the line
>>>>> with the nf_ct_is_confirmed() call likely needs to check if ct is
>>>>> non-NULL first.
>>>>>
>>>>> One useful datapoint is what kernel version/distro are you running?
>>>>> I've been testing on the latest net-next, although I should expect it
>>>>> work on anything back to linux-3.10. Perhaps earlier depending on the
>>>>> particular features required, YMMV.
>>>>>
>>>>> Apologies, there's a few bugs like this which I have found in local
>>>>> testing but I have not pushed the changes yet. This is in part because
>>>>> the ongoing development is against the linux tree, so I haven't
>>>>> backported the current development code to build inside the OVS tree.
>>>>>
>>>>> Without the commit, the nf_conntrack tables will not be populated.
>>>>>
>>>>> On 23 March 2015 at 09:49, John Hurley <john.hurley at netronome.com> wrote:
>>>>> > Hi,
>>>>> > I am interested in using Conntrack within OVS and have installed the
>>>>> > latest
>>>>> > version from the banch
>>>>> > (https://github.com/justinpettit/ovs/tree/conntrack).
>>>>> >
>>>>> > When I run an example mentioned in the tests:
>>>>> >
>>>>> > ovs-ofctl del-flows br0
>>>>> > ovs-ofctl add-flow br0 \
>>>>> >     "in_port=1,conn_state=-trk,tcp,action=ct(commit,zone=9),2"
>>>>> > ovs-ofctl add-flow br0 \
>>>>> >     "in_port=2,conn_state=-trk,tcp,action=ct(recirc,zone=9)"
>>>>> > ovs-ofctl add-flow br0 "in_port=2,conn_state=+trk+est-new,tcp,action=1"
>>>>> > ovs-ofctl add-flow br0
>>>>> > "in_port=2,conn_state=+trk-est+new,tcp,action=drop"
>>>>> > ovs-ofctl add-flow br0 priority=10,action=normal
>>>>> >
>>>>> > I am seeing a kernel panic for the 'commit' action.
>>>>> > I have traced this to the nf_ct_is_confirmed(ct) call on the
>>>>> > nf_conntrack
>>>>> > module.
>>>>> > If I edit the code to avoid this check I avoid the panic but am getting
>>>>> > an
>>>>> > error response from calls such as 'nf_ct_get(skb, &ctinfo)'.
>>>>> >
>>>>> > It appears that ovs-conntrack is not populating the nf_conntrack tables
>>>>> > for
>>>>> > me.
>>>>> > Is there any information on installing/running the ovs-conntrack branch
>>>>> > specifically or is there anything else that should be done on top of
>>>>> > the
>>>>> > standard OVS installation.
>>>>> > Doing an lsmod I can see both openvswitch and nf_conntrack modules
>>>>> > running.
>>>>> >
>>>>> > Thanks,
>>>>> >
>>>>> > John
>>>>> >
>>>>> >
>>>>> >
>>>>> >
>>>>> > _______________________________________________
>>>>> > discuss mailing list
>>>>> > discuss at openvswitch.org
>>>>> > http://openvswitch.org/mailman/listinfo/discuss
>>>>> >
>>>>
>>>>
>>>

From sharmila.radhakrishnan at intel.com  Thu Mar 26 04:44:41 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Thu, 26 Mar 2015 11:44:41 +0000
Subject: [ovs-discuss]  Command to list the type of port attached to OVS
Message-ID: <1BA01C3192A665469272B2597052DDFF56EB6F65@BGSMSX104.gar.corp.intel.com>


Hi All,

I wanted to understand, what is the command to list the type of the Port attached to the OVS switch. 

'The ovs-vsctl show' lists only if the port's type is internal, or one of the dpdk ports. I tried adding Physical ports and tap interfaces to the Vswitch. The type is not getting reflected in the command output. Is this a bug?

root at ubuntu:~# ovs-vsctl show
8cc535d2-1ef3-4ba2-ab68-c08cd1cd7893
    Bridge "br1"
        Port "br1"
            Interface "br1"
                type: internal
    Bridge "br0"
        Port "tap3"
            Interface "tap3"
                error: "could not open network device tap3 (No such device)"
        Port "eth5"
            Interface "eth5"
        Port "tap2"
            Interface "tap2"
                error: "could not open network device tap2 (No such device)"
        Port "br0"
            Interface "br0"
                type: internal
        Port "tap8"
            Interface "tap8"
        Port "tap4"
            Interface "tap4"
        Port "tap1"





Thanks in advance.

Regards,
Sharmila


From ricky.li at intel.com  Thu Mar 26 06:27:14 2015
From: ricky.li at intel.com (Li, Ricky)
Date: Thu, 26 Mar 2015 13:27:14 +0000
Subject: [ovs-discuss] User space tunneling doesn't support setting
 tunnel key (e.g. tunnel id for VxLAN) by flow
In-Reply-To: <CALnjE+o+O9okOLjhL2orH2+Lzi6YOF2oGx78tk0m6f6BHHoAug@mail.gmail.com>
References: <75853E0D9A06FA47B4C2FE025ABEF6E001A76878@SHSMSX103.ccr.corp.intel.com>
 <CALnjE+o+O9okOLjhL2orH2+Lzi6YOF2oGx78tk0m6f6BHHoAug@mail.gmail.com>
Message-ID: <75853E0D9A06FA47B4C2FE025ABEF6E001A76D47@SHSMSX103.ccr.corp.intel.com>

Hi,

I have sent the patch to dev at openvswitch.org, the title of the mail:
[PATCH] Bug fixed: User space tunneling doesn't support setting tunnel key by flow

Regards,
Ricky

-----Original Message-----
From: Pravin Shelar [mailto:pshelar at nicira.com] 
Sent: Thursday, March 26, 2015 5:53 AM
To: Li, Ricky
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] User space tunneling doesn't support setting tunnel key (e.g. tunnel id for VxLAN) by flow

On Tue, Mar 24, 2015 at 7:23 PM, Li, Ricky <ricky.li at intel.com> wrote:
> Hi,
>
>
>
> I tried to test user space tunneling according to this guide:
>
> README-native-tunneling.md
>
>
>
> Everything works in this guide, but when I tried to specify the tunnel 
> ID with flow as below, there is a problem:
>
> ovs-vsctl add-port int-br vxlan0 -- set interface vxlan0 type=vxlan
> options:remote_ip=172.168.1.2 options:out_key=flow
>
>
>
> I try to add an option: out_key=flow to make OVS specify the tunnel ID 
> by flow as below:
>
> ovs-ofctl add-flow int-br “in_port=LOCAL, icmp, actions=set_tunnel:3,
> output:1”     (1 is the port# of vxlan0)
>
>
>
> But this setup doesn’t work, because the output tunnel ID is still 0 
> (the default tunnel ID) but not 3.
>
> I also tried the same flow with kernel space Datapath and it works, 
> the tunnel ID will be changed by flow.
>
>
>
> Then I looked up the source code related to user space tunneling and I 
> can find when OVS tries to encapsulate the tunnel header, it will 
> firstly try to build the tunnel header:
>
>
>
> In ofproto-dpif-xlate.c: compose_output_action__()
>
>                 …
>
>             if (tnl_push_pop_send) {
>
>                 build_tunnel_send(ctx, xport, flow, odp_port);
>
>                 flow->tunnel = flow_tnl; /* Restore tunnel metadata */
>
>             }
>
>                 …
>
> tnl_push_pop_send is the flag for user space tunneling, and it will 
> try to build tunnel header in lib/tunnel.c:
>
>
>
>
>
> In tunnel.c: tnl_port_build_header()
>
>
>
> int
>
> tnl_port_build_header(const struct ofport_dpif *ofport,
>
>                       const struct flow *tnl_flow,
>
>                       uint8_t dmac[ETH_ADDR_LEN],
>
>                       uint8_t smac[ETH_ADDR_LEN],
>
>                       ovs_be32 ip_src, struct ovs_action_push_tnl 
> *data)
>
> {
>
>                 …
>
> res = netdev_build_header(tnl_port->netdev, data);
>
>                 …
>
> }
>
>
>
> We can find it calls the Netdev API “netdev_build_header” to build the 
> tunnel header. If the tunnel ID is set by flow, it should be saved in 
> the object “tnl_flow” (tnl_flow->tunnel->tun_id), but it’s not passed 
> into the Netdev API.
>
>
>
> In netdev-vport.c: netdev_vxlan_build_header()
>
> …
>
> put_16aligned_be32(&vxh->vx_vni, htonl(ntohll(tnl_cfg->out_key) << 
> 8));
>
> …
>
>
>
> The tunnel id (VNI) is directly set by tunnel port configuration 
> (tnl_cfg), then I think the “options:out_key=flow” will never works because of this?
> The tunnel ID will always set with the tunnel configuration when we 
> initiate it.
>
>
>
> One suggestion is to add one more input for the Netdev API:
>
> Int netdev_build_header(const struct netdev *netdev, struct 
> ovs_action_push_tnl *data, const struct flow *tnl_flow)
>
>
>
> The new input “const struct flow *tnl_flow” can be passed to the 
> callback for building tunnel header, e.g. for VxLAN:
>
> …
>
> put_16aligned_be32(&vxh->vx_vni, htonl(ntohll(tnl_flow->tunnel.tun_id) 
> << 8));
>
> …
>
>
>
> Similar changes can be made for other tunnel ports like GRE. This 
> patch can work on my side with some simple experiments. I want to 
> check if my understanding is right, and hope for any advices and inputs.
>
>
>
Your analysis looks correct. Can you send patch and test case (tests/tunnel-push-pop.at). So that it does not break in future.

Thanks.

From ricky.li at intel.com  Thu Mar 26 08:18:12 2015
From: ricky.li at intel.com (Li, Ricky)
Date: Thu, 26 Mar 2015 15:18:12 +0000
Subject: [ovs-discuss] User space tunneling doesn't support setting
 tunnel key (e.g. tunnel id for VxLAN) by flow
References: <75853E0D9A06FA47B4C2FE025ABEF6E001A76878@SHSMSX103.ccr.corp.intel.com>
 <CALnjE+o+O9okOLjhL2orH2+Lzi6YOF2oGx78tk0m6f6BHHoAug@mail.gmail.com> 
Message-ID: <75853E0D9A06FA47B4C2FE025ABEF6E001A76D9D@SHSMSX103.ccr.corp.intel.com>

Hi,

Sorry I forgot to add the test case in previous patch, so I sent another patch for the test case, the mail is:
[PATCH] Add test case for setting tunnel id in userspace DP

I add this case to test the tunnel ID set by flow:

tests/tunnel-push-pop.at:
...
                    -- add-port int-br t3 -- set Interface t3 type=vxlan \
                       options:remote_ip=1.1.2.93 options:out_key=flow ofport_request=4\
...
dnl Check VXLAN tunnel push set tunnel id by flow
AT_CHECK([ovs-ofctl add-flow int-br "actions=set_tunnel:124,4"])
AT_CHECK([ovs-appctl ofproto/trace ovs-dummy 'in_port(2),eth_type(0x0800),ipv4(src=1.1.3.88,dst=1.1.3.112,proto=47,tos=0,ttl=64,frag=no)'], [0], [stdout])
AT_CHECK([tail -1 stdout], [0],
  [Datapath actions: tnl_push(tnl_port(4789),header(size=50,type=4,eth(dst=f8:bc:12:44:34:b7,src=aa:55:aa:55:00:00,dl_type=0x0800),ipv4(src=1.1.2.88,dst=1.1.2.93,proto=17,tos=0,ttl=64,frag=0x40),udp(src=0,dst=4789),vxlan(flags=0x8000000,vni=0x7c00)),out_port(100))
])

The tunnel ID in VNI (0x7c00), 0x7c=124, should be the tunnel ID set by flow "actions=set_tunnel:124,4"

Regards,
Ricky


-----Original Message-----
From: Li, Ricky 
Sent: Thursday, March 26, 2015 9:27 PM
To: 'Pravin Shelar'
Cc: discuss at openvswitch.org
Subject: RE: [ovs-discuss] User space tunneling doesn't support setting tunnel key (e.g. tunnel id for VxLAN) by flow

Hi,

I have sent the patch to dev at openvswitch.org, the title of the mail:
[PATCH] Bug fixed: User space tunneling doesn't support setting tunnel key by flow

Regards,
Ricky

-----Original Message-----
From: Pravin Shelar [mailto:pshelar at nicira.com]
Sent: Thursday, March 26, 2015 5:53 AM
To: Li, Ricky
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] User space tunneling doesn't support setting tunnel key (e.g. tunnel id for VxLAN) by flow

On Tue, Mar 24, 2015 at 7:23 PM, Li, Ricky <ricky.li at intel.com> wrote:
> Hi,
>
>
>
> I tried to test user space tunneling according to this guide:
>
> README-native-tunneling.md
>
>
>
> Everything works in this guide, but when I tried to specify the tunnel 
> ID with flow as below, there is a problem:
>
> ovs-vsctl add-port int-br vxlan0 -- set interface vxlan0 type=vxlan
> options:remote_ip=172.168.1.2 options:out_key=flow
>
>
>
> I try to add an option: out_key=flow to make OVS specify the tunnel ID 
> by flow as below:
>
> ovs-ofctl add-flow int-br “in_port=LOCAL, icmp, actions=set_tunnel:3,
> output:1”     (1 is the port# of vxlan0)
>
>
>
> But this setup doesn’t work, because the output tunnel ID is still 0 
> (the default tunnel ID) but not 3.
>
> I also tried the same flow with kernel space Datapath and it works, 
> the tunnel ID will be changed by flow.
>
>
>
> Then I looked up the source code related to user space tunneling and I 
> can find when OVS tries to encapsulate the tunnel header, it will 
> firstly try to build the tunnel header:
>
>
>
> In ofproto-dpif-xlate.c: compose_output_action__()
>
>                 …
>
>             if (tnl_push_pop_send) {
>
>                 build_tunnel_send(ctx, xport, flow, odp_port);
>
>                 flow->tunnel = flow_tnl; /* Restore tunnel metadata */
>
>             }
>
>                 …
>
> tnl_push_pop_send is the flag for user space tunneling, and it will 
> try to build tunnel header in lib/tunnel.c:
>
>
>
>
>
> In tunnel.c: tnl_port_build_header()
>
>
>
> int
>
> tnl_port_build_header(const struct ofport_dpif *ofport,
>
>                       const struct flow *tnl_flow,
>
>                       uint8_t dmac[ETH_ADDR_LEN],
>
>                       uint8_t smac[ETH_ADDR_LEN],
>
>                       ovs_be32 ip_src, struct ovs_action_push_tnl
> *data)
>
> {
>
>                 …
>
> res = netdev_build_header(tnl_port->netdev, data);
>
>                 …
>
> }
>
>
>
> We can find it calls the Netdev API “netdev_build_header” to build the 
> tunnel header. If the tunnel ID is set by flow, it should be saved in 
> the object “tnl_flow” (tnl_flow->tunnel->tun_id), but it’s not passed 
> into the Netdev API.
>
>
>
> In netdev-vport.c: netdev_vxlan_build_header()
>
> …
>
> put_16aligned_be32(&vxh->vx_vni, htonl(ntohll(tnl_cfg->out_key) << 
> 8));
>
> …
>
>
>
> The tunnel id (VNI) is directly set by tunnel port configuration 
> (tnl_cfg), then I think the “options:out_key=flow” will never works because of this?
> The tunnel ID will always set with the tunnel configuration when we 
> initiate it.
>
>
>
> One suggestion is to add one more input for the Netdev API:
>
> Int netdev_build_header(const struct netdev *netdev, struct 
> ovs_action_push_tnl *data, const struct flow *tnl_flow)
>
>
>
> The new input “const struct flow *tnl_flow” can be passed to the 
> callback for building tunnel header, e.g. for VxLAN:
>
> …
>
> put_16aligned_be32(&vxh->vx_vni, htonl(ntohll(tnl_flow->tunnel.tun_id)
> << 8));
>
> …
>
>
>
> Similar changes can be made for other tunnel ports like GRE. This 
> patch can work on my side with some simple experiments. I want to 
> check if my understanding is right, and hope for any advices and inputs.
>
>
>
Your analysis looks correct. Can you send patch and test case (tests/tunnel-push-pop.at

). So that it does not break in future.

Thanks.

From john.hurley at netronome.com  Thu Mar 26 08:26:40 2015
From: john.hurley at netronome.com (John Hurley)
Date: Thu, 26 Mar 2015 15:26:40 +0000
Subject: [ovs-discuss] ovs-conntrack kernel panic
In-Reply-To: <CANr6G5yo9P2hvqV260xyVRfU5r1Wpy=aX7W8e+-q_evU9qBAag@mail.gmail.com>
References: <CAK+XE=k9Oq8Pii+DEva2ZJ_YcCAz3Nxys=ojOHraTAdWKE4iCg@mail.gmail.com>
 <CANr6G5x=4MOhTEmZLV_UkK0Xj77E19KNtnoq94RxNL9DBvTmeg@mail.gmail.com>
 <CAK+XE==0fQVizdqMxPU=C2W7d3+zfnPWukrR69wTrsX_hSY7wQ@mail.gmail.com>
 <CAK+XE=mVW-aVGdipWKg1A1JCAjM-riJkJ4NPdNRa_VrmvD=rSg@mail.gmail.com>
 <CANr6G5zoHsgp2XED_ASqW6RFT+Aqqn+06JR69JHtd=OjeW49TA@mail.gmail.com>
 <CANr6G5wztpRsRP1axww4SG6JuDZAfwyxDcACMkBgZ4k34H-tzA@mail.gmail.com>
 <CANr6G5yo9P2hvqV260xyVRfU5r1Wpy=aX7W8e+-q_evU9qBAag@mail.gmail.com>
Message-ID: <CAK+XE=mz-ug+jQZvG0-KODcDReHkzUM=-LkdY2bbMd2oU6DPyw@mail.gmail.com>

Hi Joe,

I have tried your latest commit and it seems to work well.
The original kernel panic reported has been fixed.

I managed to get to the bottom of the TCP issue.
Tracing it though I found that some packets were being rejected in the
nf_conntrack_ipv4 module due to bad checksums in the transport layer.
This, in turn, meant that no nf_conn entry was created and there was
potentially a null pointer exception in ovs-conntrack.
I noticed that this error occurred even when replayed traffic checksums
were validated in wireshark.

Removing checksum validation from nf_conntrack did the trick .....
'echo  0 > /proc/sys/net/netfilter/nf_conntrack_checksum'

Thanks for your time,
John




On Wed, Mar 25, 2015 at 11:56 PM, Joe Stringer <joestringer at nicira.com>
wrote:

> I updated the branch at
> https://github.com/justinpettit/ovs/commits/conntrack.
>
> This includes various bugfixes, IPv6, connlabel, initial work on
> IP(v4) fragments and ALGs - mostly in userspace. It also makes use of
> Jarno's recent xlate context work to save the OF pipeline when
> recirculating.
>
> There are several new tests in tests/kmod-traffic.at; The python
> script for running those tests requires pyftpdlib.
>
> On 24 March 2015 at 23:04, Joe Stringer <joestringer at nicira.com> wrote:
> > FYI I'm planning to update this branch this week - hopefully tomorrow,
> > so you might have better luck with that version.
> >
> > Cheers,
> > Joe
> >
> > On 24 March 2015 at 20:29, Joe Stringer <joestringer at nicira.com> wrote:
> >> Hmm. You might be able to get more information about how the
> >> datapath(incl. conntrack) is identifying the flow by turning up debug
> >> logging in vswitchd (look for upcall and flow_put):
> >>
> >> ovs-appctl vlog/set dpif:dbg
> >>
> >> The conntrack tools can also be useful, although you'll need to filter
> >> the output to only the relevant traffic:
> >>
> >> conntrack -L
> >>
> >> I see you're also using zones; removing those would reduce the problem
> space.
> >>
> >> If it's still not clear, there's always the option to log some
> >> messages in ovs_ct_execute() and trace the execution.
> >>
> >> On 24 March 2015 at 09:03, John Hurley <john.hurley at netronome.com>
> wrote:
> >>> Hi Joe,
> >>>
> >>>
> >>> Following on from my earlier message, I have tested a few more
> scenarios.
> >>> It seems that Conntrack works fine for UDP and ICMP packet flows.
> >>> Earlier I had been testing with TCP traffic.
> >>> This is still not working.
> >>> Any ideas on why TCP would be failing on the conntrack commit?
> >>>
> >>> I have also noticed that if I replay UDP packets shorter than 64 bytes
> into
> >>> OVS they are rejected by conntract and can cause the kernel panic
> issue.
> >>> The NULL check on the nf_ct_is_confirmed() you mentioned earlier is
> required
> >>> to prevent this from happening.
> >>>
> >>> John
> >>>
> >>>
> >>> On Tue, Mar 24, 2015 at 9:56 AM, John Hurley <
> john.hurley at netronome.com>
> >>> wrote:
> >>>>
> >>>> Hi Joe,
> >>>>
> >>>> Thanks for the response.
> >>>> I have ensured the nf_conntrack_ipv4 module is loaded but still
> cannot get
> >>>> the commit to work.
> >>>>
> >>>> I am running Ubuntu 14.04
> >>>> Kernel version: 3.16.0-30-generic
> >>>>
> >>>> John
> >>>>
> >>>> On Mon, Mar 23, 2015 at 6:27 PM, Joe Stringer <joestringer at nicira.com
> >
> >>>> wrote:
> >>>>>
> >>>>> Hi John,
> >>>>>
> >>>>> I strongly suspect in this case, conntrack has been unable to
> identify
> >>>>> the connection. There's two parts to this: Perhaps you need to load
> >>>>> nf_conntrack_ipv4? if that module is not loaded, then conntrack
> cannot
> >>>>> identify any IP traffic. Separately, to address the crash, the line
> >>>>> with the nf_ct_is_confirmed() call likely needs to check if ct is
> >>>>> non-NULL first.
> >>>>>
> >>>>> One useful datapoint is what kernel version/distro are you running?
> >>>>> I've been testing on the latest net-next, although I should expect it
> >>>>> work on anything back to linux-3.10. Perhaps earlier depending on the
> >>>>> particular features required, YMMV.
> >>>>>
> >>>>> Apologies, there's a few bugs like this which I have found in local
> >>>>> testing but I have not pushed the changes yet. This is in part
> because
> >>>>> the ongoing development is against the linux tree, so I haven't
> >>>>> backported the current development code to build inside the OVS tree.
> >>>>>
> >>>>> Without the commit, the nf_conntrack tables will not be populated.
> >>>>>
> >>>>> On 23 March 2015 at 09:49, John Hurley <john.hurley at netronome.com>
> wrote:
> >>>>> > Hi,
> >>>>> > I am interested in using Conntrack within OVS and have installed
> the
> >>>>> > latest
> >>>>> > version from the banch
> >>>>> > (https://github.com/justinpettit/ovs/tree/conntrack).
> >>>>> >
> >>>>> > When I run an example mentioned in the tests:
> >>>>> >
> >>>>> > ovs-ofctl del-flows br0
> >>>>> > ovs-ofctl add-flow br0 \
> >>>>> >     "in_port=1,conn_state=-trk,tcp,action=ct(commit,zone=9),2"
> >>>>> > ovs-ofctl add-flow br0 \
> >>>>> >     "in_port=2,conn_state=-trk,tcp,action=ct(recirc,zone=9)"
> >>>>> > ovs-ofctl add-flow br0
> "in_port=2,conn_state=+trk+est-new,tcp,action=1"
> >>>>> > ovs-ofctl add-flow br0
> >>>>> > "in_port=2,conn_state=+trk-est+new,tcp,action=drop"
> >>>>> > ovs-ofctl add-flow br0 priority=10,action=normal
> >>>>> >
> >>>>> > I am seeing a kernel panic for the 'commit' action.
> >>>>> > I have traced this to the nf_ct_is_confirmed(ct) call on the
> >>>>> > nf_conntrack
> >>>>> > module.
> >>>>> > If I edit the code to avoid this check I avoid the panic but am
> getting
> >>>>> > an
> >>>>> > error response from calls such as 'nf_ct_get(skb, &ctinfo)'.
> >>>>> >
> >>>>> > It appears that ovs-conntrack is not populating the nf_conntrack
> tables
> >>>>> > for
> >>>>> > me.
> >>>>> > Is there any information on installing/running the ovs-conntrack
> branch
> >>>>> > specifically or is there anything else that should be done on top
> of
> >>>>> > the
> >>>>> > standard OVS installation.
> >>>>> > Doing an lsmod I can see both openvswitch and nf_conntrack modules
> >>>>> > running.
> >>>>> >
> >>>>> > Thanks,
> >>>>> >
> >>>>> > John
> >>>>> >
> >>>>> >
> >>>>> >
> >>>>> >
> >>>>> > _______________________________________________
> >>>>> > discuss mailing list
> >>>>> > discuss at openvswitch.org
> >>>>> > http://openvswitch.org/mailman/listinfo/discuss
> >>>>> >
> >>>>
> >>>>
> >>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150326/7fcef5bd/attachment-0001.html>

From shettyg at nicira.com  Thu Mar 26 08:44:07 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 26 Mar 2015 08:44:07 -0700
Subject: [ovs-discuss] Is it possible to limit bandwidth for particular
 OVS port?
In-Reply-To: <CABJqVcz_J5D8cJsFJ=zcw21dMQXCrETosYofE6VYhE3i4+7aUw@mail.gmail.com>
References: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>
 <CAHbON5rPDLZSxv0VD411kAPbNuJcT=_so+D6go3vRnu9mk8tEA@mail.gmail.com>
 <CABJqVcz_J5D8cJsFJ=zcw21dMQXCrETosYofE6VYhE3i4+7aUw@mail.gmail.com>
Message-ID: <CAHbON5oTeRsW1km25ip5bTuBCQGvpWdU5-6tzSUe0bn06BXp9Q@mail.gmail.com>

On Wed, Mar 25, 2015 at 7:03 PM, Tim Bagr <timbgr at gmail.com> wrote:
> Hello Gurucharan,
>
> Thanks for the reply.
>
> I have no physical ports attached to that OVS bridge. My intention was
> exactly to limit bandwidth for br3 port (i.e. openflow keyword LOCAL), and
> another try was to limit bandwidth for internal patch-port, which connects
> br3 bridge with br2 bridge. In both bridges there are VMs attached and they
> may communicate with each other through the patch-port.
>
> # ovs-vsctl show
> b11e83cb-d741-4a59-90f7-ea9693d508cf
>     Bridge "br2"
>         Port "b3p"
>             Interface "b3p"
>                 type: patch
>                 options: {peer="b2p"}
>         Port "vnet1"
>             Interface "vnet1"
>         Port "br2"
>             Interface "br2"
>                 type: internal
>     Bridge "br3"
>         Port "br3"
>             Interface "br3"
>                 type: internal
>         Port "vnet0"
>             Interface "vnet0"
>         Port "b2p"
>             Interface "b2p"
>                 type: patch
>                 options: {peer="b3p"}
>
> Here vnet1 is port of 1st VM and vnet0 is port of 2nd VM. Now I just want to
> limit bandwidth from VM2 to VM1.
> So I run:
> # ovs-vsctl set Port b2p qos=@newq -- --id=@newq create qos type=linux-htb
> other-config:max-rate=100000000 queues=111=@q1 -- --id=@q1 create queue
> other-config:min-rate=0 other-config:max-rate=10
> 65c5488d-2066-4d97-b21f-ba369a8b2920
> 1e3726b4-12e2-4184-b8e4-13f9c692095f
I _think_(not 100% sure) that you cannot apply QoS on a patch port.
Patch port has no netdevice backing it. OVS uses Linux tc to apply
QoS. Since tc cannot see the OVS patch port, I don't think anything
will come out of it.

The way to verify that QoS is really working is to look at tc stats
for that queue. e.g: If you had applied QoS on eth1 with 3 queues: 1,
2, 3, you will get:

sudo tc class show dev eth1
class htb 1:fffe root rate 900000Kbit ceil 900000Kbit burst 1462b cburst 1462b
class htb 1:1 parent 1:fffe prio 0 rate 720000Kbit ceil 900000Kbit
burst 1530b cburst 1462b
class htb 1:2 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
1563b cburst 1563b
class htb 1:3 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
1563b cburst 1563b

For statistics: (to see how many packets went through etc)
tc -s class show dev eth1



>
> # ovs-ofctl show br3
> OFPT_FEATURES_REPLY (xid=0x2): dpid:00007a42d1ca7e05
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
> SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>  3(b2p): addr:ae:a4:9d:8b:9f:a9
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
>  6(vnet0): addr:fe:54:00:ac:e1:a6
>      config:     0
>      state:      0
>      current:    10MB-FD COPPER
>      speed: 10 Mbps now, 0 Mbps max
>  LOCAL(br3): addr:7a:42:d1:ca:7e:05
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>
> # ovs-ofctl add-flow br3 priority=5,in_port=6,actions=enqueue:3:111
> # ovs-ofctl dump-flows br3
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=3.285s, table=0, n_packets=0, n_bytes=0, idle_age=3,
> priority=5,in_port=6 actions=enqueue:3:111
>  cookie=0x0, duration=79191.532s, table=0, n_packets=744, n_bytes=431875,
> idle_age=7, hard_age=65534, priority=0 actions=NORMAL
>
> Then I start to ping6 from VM2 to VM1 and pings will go through that
> patch-ports b3p and b2p. As I expected, the QoS queue will be in effect. And
> limit the bandwidth to very small amount of max-rate=10
How do you know that QOS is in effect above? I guess based on the
n_packets of openflow flow? That only tells that OVS marked the packet
to go to a QoS queue. But if QoS queue has not been created in Linux
kernel, there is really nothing that will happen.

I imagine that OVS should show some error in the logs, but I did not
see any (during my small test). That is the reason I am not 100% sure
what will actually  happen.

From timbgr at gmail.com  Wed Mar 25 19:03:01 2015
From: timbgr at gmail.com (Tim Bagr)
Date: Thu, 26 Mar 2015 06:03:01 +0400
Subject: [ovs-discuss] Is it possible to limit bandwidth for particular
 OVS port?
In-Reply-To: <CAHbON5rPDLZSxv0VD411kAPbNuJcT=_so+D6go3vRnu9mk8tEA@mail.gmail.com>
References: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>
 <CAHbON5rPDLZSxv0VD411kAPbNuJcT=_so+D6go3vRnu9mk8tEA@mail.gmail.com>
Message-ID: <CABJqVcz_J5D8cJsFJ=zcw21dMQXCrETosYofE6VYhE3i4+7aUw@mail.gmail.com>

Hello Gurucharan,

Thanks for the reply.

I have no physical ports attached to that OVS bridge. My intention was
exactly to limit bandwidth for br3 port (i.e. openflow keyword LOCAL), and
another try was to limit bandwidth for internal patch-port, which connects
br3 bridge with br2 bridge. In both bridges there are VMs attached and they
may communicate with each other through the patch-port.

# ovs-vsctl show
b11e83cb-d741-4a59-90f7-ea9693d508cf
    Bridge "br2"
        Port "b3p"
            Interface "b3p"
                type: patch
                options: {peer="b2p"}
        Port "vnet1"
            Interface "vnet1"
        Port "br2"
            Interface "br2"
                type: internal
    Bridge "br3"
        Port "br3"
            Interface "br3"
                type: internal
        Port "vnet0"
            Interface "vnet0"
        Port "b2p"
            Interface "b2p"
                type: patch
                options: {peer="b3p"}

Here vnet1 is port of 1st VM and vnet0 is port of 2nd VM. Now I just want
to limit bandwidth from VM2 to VM1.
So I run:
# ovs-vsctl set Port b2p qos=@newq -- --id=@newq create qos type=linux-htb
other-config:max-rate=100000000 queues=111=@q1 -- --id=@q1 create queue
other-config:min-rate=0 other-config:max-rate=10
65c5488d-2066-4d97-b21f-ba369a8b2920
1e3726b4-12e2-4184-b8e4-13f9c692095f

# ovs-ofctl show br3
OFPT_FEATURES_REPLY (xid=0x2): dpid:00007a42d1ca7e05
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
 3(b2p): addr:ae:a4:9d:8b:9f:a9
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 6(vnet0): addr:fe:54:00:ac:e1:a6
     config:     0
     state:      0
     current:    10MB-FD COPPER
     speed: 10 Mbps now, 0 Mbps max
 LOCAL(br3): addr:7a:42:d1:ca:7e:05
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0

# ovs-ofctl add-flow br3 priority=5,in_port=6,actions=enqueue:3:111
# ovs-ofctl dump-flows br3
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=3.285s, table=0, n_packets=0, n_bytes=0, idle_age=3,
priority=5,in_port=6 actions=enqueue:3:111
 cookie=0x0, duration=79191.532s, table=0, n_packets=744, n_bytes=431875,
idle_age=7, hard_age=65534, priority=0 actions=NORMAL

Then I start to ping6 from VM2 to VM1 and pings will go through that
patch-ports b3p and b2p. As I expected, the QoS queue will be in effect.
And limit the bandwidth to very small amount of max-rate=10

[root at VM2 ~]# ping6 fe80::5054:ff:fe72:b2bc%eth0 -i 0.1 -s 1000
PING fe80::5054:ff:fe72:b2bc%eth0(fe80::5054:ff:fe72:b2bc) 1000 data bytes
1008 bytes from fe80::5054:ff:fe72:b2bc: icmp_seq=1 ttl=64 time=0.536 ms
1008 bytes from fe80::5054:ff:fe72:b2bc: icmp_seq=2 ttl=64 time=0.153 ms
1008 bytes from fe80::5054:ff:fe72:b2bc: icmp_seq=3 ttl=64 time=0.150 ms
1008 bytes from fe80::5054:ff:fe72:b2bc: icmp_seq=4 ttl=64 time=0.163 ms
1008 bytes from fe80::5054:ff:fe72:b2bc: icmp_seq=5 ttl=64 time=0.142 ms
1008 bytes from fe80::5054:ff:fe72:b2bc: icmp_seq=6 ttl=64 time=0.142 ms
1008 bytes from fe80::5054:ff:fe72:b2bc: icmp_seq=7 ttl=64 time=0.255 ms
^C
--- fe80::5054:ff:fe72:b2bc%eth0 ping statistics ---
7 packets transmitted, 7 received, 0% packet loss, time 599ms
rtt min/avg/max/mdev = 0.142/0.220/0.536/0.134 ms



# ovs-ofctl dump-flows br3
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=12.228s, table=0, n_packets=36, n_bytes=38232,
idle_age=6, priority=5,in_port=6 actions=enqueue:3:111
 cookie=0x0, duration=79236.643s, table=0, n_packets=814, n_bytes=505239,
idle_age=6, hard_age=65534, priority=0 actions=NORMAL

So the n_packets=36 tells that openflow rule is actually matching but queue
limit of max-rate=10 is not working :(



On Tue, Mar 24, 2015 at 8:05 PM, Gurucharan Shetty <shettyg at nicira.com>
wrote:

> On Mon, Mar 23, 2015 at 8:01 PM, Tim Bagr <timbgr at gmail.com> wrote:
> > Hello all,
> >
> > I tried to limit bandwidth for particular VM attached to OpenVSwitch
> port.
> >
> > There are VMs attached to virtual switch br3. I want to limit bandwidth
> for
> > one VM, which is attached to br3 and in_port 2. Doing as follows:
> > 1)
> > # ovs-vsctl set port br3 qos=@newqos1 -- --id=@newqos1 create qos
> > type=linux-htb other-config:max-rate=10 queues:123=@vn2queue --
> > --id=@vn2queue create queue other-config:max-rate=10
> > # ovs-ofctl add-flow br3
> > "priority=50,in_port=2,actions=set_queue:123,normal"
> >
> > Command worked! The bandwidth is limited as expected for all traffic
> going
> > through LOCAL port of br3, limit is very tight so even icmp echo is
> hardly
> > passed. All VMs are affected by this.
> >
> > After that I tried to limit the bandwidth for only one VM, and give
> almost
> > unlimited bandwidth for the others:
> > 2)
> > # ovs-vsctl set port br3 qos=@newqos1 -- --id=@newqos1 create qos
> > type=linux-htb other-config:max-rate=100000000
> > queues:123=4d65ddec-5c5d-4c87-8165-dd51431c7ab3
> >
> > Here the ID 4d65ddec-5c5d-4c87-8165-dd51431c7ab3 is that queue which was
> > created in previous steps with max-rate=10
> > OpenFlow rule for redirecting traffic from the in_port=2 to that queue
> > remains the same.
> >
> > After that I got all VMs (including attached to in_port 2) has got that
> big
> > bandwidth (100000000).
> > But it was supposed that VM from port 2 cannot send even pings (as its
> > traffic should be limited by max-rate=10).
> >
> >
> > Am I doing something wrong or maybe have incorrect understanding how QoS
> > works?
>
> I believe that your understanding is a little flawed (or I did not
> follow your description correctly).
> For your case, I think you should be applying QoS on the outgoing
> physical port (e.g ethX) which has been added as a port of OVS bridge
> and not on the bridge itself (br3 in your case).

You usually create multiple queues with different configured min rate
> and max rates.
>
> e.g:
> if eth1 is a port of br1:
>
> sudo ovs-vsctl -- set port eth1 qos=@newqos \
> -- --id=@newqos create qos type=linux-htb
> other-config:max-rate=900000000 queues=10=@q0,20=@q1,30=@q2 \
> -- --id=@q0 create queue other-config:min-rate=720000000
> other-config:max-rate=900000000 \
> -- --id=@q1 create queue other-config:min-rate=0
> other-config:max-rate=80000000 \
> -- --id=@q2 create queue other-config:min-rate=0
> other-config:max-rate=70000000
>
> The above creates 3 queues with queue-numbers 10, 20 and 30
>
> The next step is to get the ofport value of 'eth1' using 'ovs-ofctl show
> br1'
>
> Then you can add your flows for bridge br1 and direct particular set
> of traffic to particular queues.
> e.g:
> sudo ovs-ofctl add-flow br1 priority=65500,in_port=3,actions=enqueue:2:10
> sudo ovs-ofctl add-flow br1 priority=65500,in_port=4,actions=enqueue:2:20
> sudo ovs-ofctl add-flow br1 priority=65500,in_port=5,actions=enqueue:2:30
>
> Above in_port values 3, 4 and 5 can be vifs of your VMs if they have
> been attached to br1.
>
> The above example is not typically used in a typical OVS deployment
> that involves overlay tunnels. In those cases, you will attach vifs to
> a separate OVS bridge. Your flows on that bridge will enqueue to a
> tunnel port's ofport value instead (But your queue is still on
> physical port).
>
>
>
>
>
> > Or it is a known issue within OVS?
> > Please help.
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150326/950bf6d7/attachment-0001.html>

From a.n.chippa at gmail.com  Thu Mar 26 12:37:04 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Thu, 26 Mar 2015 12:37:04 -0700
Subject: [ovs-discuss] set-controller per table?
Message-ID: <CABFtFwmSuPUbDPpy13iVhDHRO4n_yscHVhwnY1tPeJfR=jkLcQ@mail.gmail.com>

Hi,

As I understand, today openvswitch supports multiple controllers, but not
on a per table basis.
For features that require multiple local controllers, e.g. I may want to
punt data packets for DPI, and ARP packets for an other purpose, up to the
local controllers. The local DPI userspace module may not be implemented in
the same process as the agent that handles punted ARP packets. The
flexibility to keep them separate is nice from a modularity and performance
perspective.

So the short question is:

1. Is this a good idea?, i.e. the ability to set-controller on a per table
basis instead of the whole switch (as today).
2. If so, how do I go about requesting for this feature from the
openvswitch experts?

Looking forward to your response.

Thanks,
Ashok
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150326/dc56c514/attachment.html>

From blp at nicira.com  Thu Mar 26 13:56:40 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 26 Mar 2015 13:56:40 -0700
Subject: [ovs-discuss] set-controller per table?
In-Reply-To: <CABFtFwmSuPUbDPpy13iVhDHRO4n_yscHVhwnY1tPeJfR=jkLcQ@mail.gmail.com>
References: <CABFtFwmSuPUbDPpy13iVhDHRO4n_yscHVhwnY1tPeJfR=jkLcQ@mail.gmail.com>
Message-ID: <20150326205640.GA16976@nicira.com>

On Thu, Mar 26, 2015 at 12:37:04PM -0700, Ashok Chippa wrote:
> As I understand, today openvswitch supports multiple controllers, but not
> on a per table basis.

What's a per-table controller and how is it different from an OpenFlow
controller?

From a.n.chippa at gmail.com  Thu Mar 26 23:34:40 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Thu, 26 Mar 2015 23:34:40 -0700
Subject: [ovs-discuss] set-controller per table?
In-Reply-To: <20150326205640.GA16976@nicira.com>
References: <CABFtFwmSuPUbDPpy13iVhDHRO4n_yscHVhwnY1tPeJfR=jkLcQ@mail.gmail.com>
 <20150326205640.GA16976@nicira.com>
Message-ID: <CABFtFw=A41V+Laov5DHDfWbtKNwv8-K5m1LjfbOXLggqPyyZaA@mail.gmail.com>

Can I have TableX punt packets to controller 1, and TableY punt packets to
controller 2? In a table flow, if the action is "controller" which
controller does it send the packets to, in case there are multiple
controllers?

Thanks

On Thu, Mar 26, 2015 at 1:56 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Mar 26, 2015 at 12:37:04PM -0700, Ashok Chippa wrote:
> > As I understand, today openvswitch supports multiple controllers, but not
> > on a per table basis.
>
> What's a per-table controller and how is it different from an OpenFlow
> controller?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150326/d7d601c7/attachment.html>

From sharmila.radhakrishnan at intel.com  Fri Mar 27 02:46:55 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Fri, 27 Mar 2015 09:46:55 +0000
Subject: [ovs-discuss]  Error in building Latest OVS in Fedora
Message-ID: <1BA01C3192A665469272B2597052DDFF56EB75FE@BGSMSX104.gar.corp.intel.com>

Hi All,
I did a fresh clone for OVS today on  Fedora21 machine(kernel - 3.17.8-300.fc21.x86_64).

I configured it to
./configure --with-linux=/lib/modules/3.17.8-300.fc21.x86_64/build

And when I ran ‘make’ I get the below error:

make[4]: Entering directory '/usr/src/kernels/3.17.8-300.fc21.x86_64'
  CC [M]  /usr/src/ovs/datapath/linux/actions.o
  CC [M]  /usr/src/ovs/datapath/linux/datapath.o
/usr/src/ovs/datapath/linux/datapath.c: In function â€˜dp_initâ€™:
/usr/src/ovs/datapath/linux/datapath.c:2268:10: error: macro "__DATE__" might prevent reproducible builds [-Werror=date-time]
   VERSION);
          ^
/usr/src/ovs/datapath/linux/datapath.c:2268:1: error: macro "__TIME__" might prevent reproducible builds [-Werror=date-time]
   VERSION);
^
cc1: some warnings being treated as errors
scripts/Makefile.build:257: recipe for target '/usr/src/ovs/datapath/linux/datapath.o' failed
make[5]: *** [/usr/src/ovs/datapath/linux/datapath.o] Error 1
Makefile:1377: recipe for target '_module_/usr/src/ovs/datapath/linux' failed
make[4]: *** [_module_/usr/src/ovs/datapath/linux] Error 2
make[4]: Leaving directory '/usr/src/kernels/3.17.8-300.fc21.x86_64'
Makefile.main:71: recipe for target 'default' failed
make[3]: *** [default] Error 2
make[3]: Leaving directory '/usr/src/ovs/datapath/linux'
Makefile:480: recipe for target 'all-recursive' failed
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory '/usr/src/ovs/datapath'
Makefile:4086: recipe for target 'all-recursive' failed
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory '/usr/src/ovs'
Makefile:2241: recipe for target 'all' failed
make: *** [all] Error 2

How do I fix this error?

Thanks in Advance!

Regards,
Sharmila
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/89921bbb/attachment-0001.html>

From prashant.ietedelhi at gmail.com  Fri Mar 27 04:58:16 2015
From: prashant.ietedelhi at gmail.com (Prashant Singh)
Date: Fri, 27 Mar 2015 17:28:16 +0530
Subject: [ovs-discuss] droping http or udp packets
Message-ID: <CABpZToUUAwiobmDyBUxw70WgsV6JprzYb75ZUTRrKUbaiD6wDA@mail.gmail.com>

Hi
I wants to restrict the http or ftp packet on the switch i.e the scenario
is, the client is connected to the http and ftp server through openvswitch.
He can access the http but not ftp and so on. I didnt find any useful
parameters to set, so that I can restrict the client based on the
application layer protocols.
 Please help me related to it.
Prashant
Project Associate,
IIT DELHI
phone- 08447720406,
08010476362
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/a4e9ec6c/attachment.html>

From shettyg at nicira.com  Fri Mar 27 07:46:29 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 27 Mar 2015 07:46:29 -0700
Subject: [ovs-discuss] Is it possible to limit bandwidth for particular
 OVS port?
In-Reply-To: <CABJqVcwoTddoqSbLuOO4Uxzob3phK9pU=q-UPkW=91st9yB6oQ@mail.gmail.com>
References: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>
 <CAHbON5rPDLZSxv0VD411kAPbNuJcT=_so+D6go3vRnu9mk8tEA@mail.gmail.com>
 <CABJqVcz_J5D8cJsFJ=zcw21dMQXCrETosYofE6VYhE3i4+7aUw@mail.gmail.com>
 <CAHbON5oTeRsW1km25ip5bTuBCQGvpWdU5-6tzSUe0bn06BXp9Q@mail.gmail.com>
 <CABJqVcwoTddoqSbLuOO4Uxzob3phK9pU=q-UPkW=91st9yB6oQ@mail.gmail.com>
Message-ID: <CAHbON5oe=bTVLOULo8pWMM=dEhrDZQkfYVxtuOU7Wm5feo91ig@mail.gmail.com>

On Thu, Mar 26, 2015 at 6:35 PM, Tim Bagr <timbgr at gmail.com> wrote:
> Thanks for your reply! It helps a lot. I didn't use tc before. I just
> watched at large ping packets and if they are delayed progressively - then I
> concluded QoS is actually working.
>
> I tried again with patch-port and you're right.
> # tc class show dev b2p
> had shown nothing.
>
> So I tried to do the trick with LOCAL interface again, which is the same
> name as name of bridge, in my case "br3".
>
> # ovs-vsctl set port br3 qos=@nqos -- --id=@nqos create qos type=linux-htb
> other-config:max-rate=100000 queues=111=@nq -- --id=@nq create queue
> other-config:max-rate=13000
>
> And then, tried to alter max-rate for QoS object:
> # ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
> other-config:max-rate=100000
> # ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
> other-config:max-rate=10000
> # ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
> other-config:max-rate=1000000
>
> And after each command I've sent pings from VM to outside network, and see
> if they are limited. The values actually worked - when I set rate 10000, for
> example, then pings from VM looked like:
> [root at VM ~]# ping -i 0.1 outside.host -s 500
> PING outside.host (10.1.1.168) 500(528) bytes of data.
> 508 bytes from outside.host (10.1.1.168): icmp_seq=1 ttl=63 time=0.242 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=2 ttl=63 time=0.270 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=3 ttl=63 time=0.224 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=4 ttl=63 time=67.7 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=5 ttl=63 time=85.7 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=6 ttl=63 time=75.3 ms
> ^C508 bytes from 10.1.1.168: icmp_seq=7 ttl=63 time=84.8 ms
>
> And when I set rate about max-rate=100000000 then pings went flawlessly:
>
> [root at localhost ~]# ping -i 0.1 outside.host -s 500
> PING outside.host (10.1.1.168) 500(528) bytes of data.
> 508 bytes from outside.host (10.1.1.168): icmp_seq=1 ttl=63 time=0.270 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=2 ttl=63 time=0.201 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=3 ttl=63 time=0.256 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=4 ttl=63 time=0.249 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=5 ttl=63 time=0.203 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=6 ttl=63 time=0.224 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=7 ttl=63 time=0.216 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=8 ttl=63 time=0.217 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=9 ttl=63 time=0.226 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=10 ttl=63 time=0.204 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=11 ttl=63 time=0.227 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=12 ttl=63 time=0.220 ms
> 508 bytes from outside.host (10.1.1.168): icmp_seq=13 ttl=63 time=0.260 ms
>
>
>
> Then I set openflow rules to assign queue number to specific traffic (with
> src and dst address equal to that otside.host, which I send ping requests
> to):
>
> The rules are matched and n_packets grown when I sent pings:
> # ovs-ofctl dump-flows br3 --sort=priority
>  cookie=0x0, duration=155295.034s, table=0, n_packets=12692,
> n_bytes=6188205, priority=0 actions=NORMAL
>  cookie=0x0, duration=482.039s, table=0, n_packets=112, n_bytes=116704,
> priority=15,ip,nw_src=10.1.1.168 actions=set_queue:111,NORMAL
>  cookie=0x0, duration=531.879s, table=0, n_packets=259, n_bytes=269878,
> priority=15,ip,nw_dst=10.1.1.168 actions=set_queue:111,NORMAL
>  cookie=0x0, duration=420.512s, table=0, n_packets=640, n_bytes=751480,
> priority=20,ip,nw_src=10.1.1.168 actions=enqueue:6:111
>  cookie=0x0, duration=347.242s, table=0, n_packets=573, n_bytes=681666,
> priority=20,ip,nw_dst=10.1.1.168 actions=enqueue:LOCAL:111
>
> But tc command shown that queue (as I suppose it's 1:70, is not active
> against that traffic):
> # tc -s class show dev br3
> class htb 1:1 parent 1:fffe prio 0 rate 12000bit ceil 1000Kbit burst 1563b
> cburst 1564b
>  Sent 92820 bytes 128 pkt (dropped 0, overlimits 0 requeues 0)
>  rate 0bit 0pps backlog 0b 0p requeues 0
>  lended: 8 borrowed: 120 giants: 0
>  tokens: 15854166 ctokens: 190250
When you do the above, ping, you can look at the actual kernel
datapath flows with a 'ovs-dpctl dump-flows'. You will see a flow of
the following form (my ip addresses are different):

recirc_id(0),skb_priority(0),in_port(1),eth(src=00:0c:29:d6:c0:2e,dst=00:0c:29:23:ee:7f),eth_type(0x0800),ipv4(src=192.168.1.1/255.255.255.255,dst=192.168.1.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
packets:5, bytes:490, used:0.212s,
actions:set(skb_priority(0x10070)),2

The set(skb_priority(0x10070)),2 is the actual marking of packets to
go to queue 70 (decimal 111, I think).
So my take is that the packet has been marked and sent to output port
2 (in my case eth1). But since the queue is only in br3, I think it
never gets hit.

This is unchartered territory for me. My reading is that QoS can only
be applied on the egress port.





>
> class htb 1:fffe root rate 1000Kbit ceil 1000Kbit burst 1500b cburst 1500b
>  Sent 92820 bytes 128 pkt (dropped 0, overlimits 0 requeues 0)
>  rate 0bit 0pps backlog 0b 0p requeues 0
>  lended: 120 borrowed: 0 giants: 0
>  tokens: 182250 ctokens: 182250
>
> class htb 1:70 parent 1:fffe prio 0 rate 12000bit ceil 13000bit burst 1563b
> cburst 1563b
>  Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0)
>  rate 0bit 0pps backlog 0b 0p requeues 0
>  lended: 0 borrowed: 0 giants: 0
>  tokens: 16291666 ctokens: 15038461
>
>
> Maybe it's some undiscovered bug? Or it works so just by design?
>
>
>
>
>
>
>
> On Thu, Mar 26, 2015 at 7:44 PM, Gurucharan Shetty <shettyg at nicira.com>
> wrote:
>>
>> On Wed, Mar 25, 2015 at 7:03 PM, Tim Bagr <timbgr at gmail.com> wrote:
>> > Hello Gurucharan,
>> >
>> > Thanks for the reply.
>> >
>> > I have no physical ports attached to that OVS bridge. My intention was
>> > exactly to limit bandwidth for br3 port (i.e. openflow keyword LOCAL),
>> > and
>> > another try was to limit bandwidth for internal patch-port, which
>> > connects
>> > br3 bridge with br2 bridge. In both bridges there are VMs attached and
>> > they
>> > may communicate with each other through the patch-port.
>> >
>> > # ovs-vsctl show
>> > b11e83cb-d741-4a59-90f7-ea9693d508cf
>> >     Bridge "br2"
>> >         Port "b3p"
>> >             Interface "b3p"
>> >                 type: patch
>> >                 options: {peer="b2p"}
>> >         Port "vnet1"
>> >             Interface "vnet1"
>> >         Port "br2"
>> >             Interface "br2"
>> >                 type: internal
>> >     Bridge "br3"
>> >         Port "br3"
>> >             Interface "br3"
>> >                 type: internal
>> >         Port "vnet0"
>> >             Interface "vnet0"
>> >         Port "b2p"
>> >             Interface "b2p"
>> >                 type: patch
>> >                 options: {peer="b3p"}
>> >
>> > Here vnet1 is port of 1st VM and vnet0 is port of 2nd VM. Now I just
>> > want to
>> > limit bandwidth from VM2 to VM1.
>> > So I run:
>> > # ovs-vsctl set Port b2p qos=@newq -- --id=@newq create qos
>> > type=linux-htb
>> > other-config:max-rate=100000000 queues=111=@q1 -- --id=@q1 create queue
>> > other-config:min-rate=0 other-config:max-rate=10
>> > 65c5488d-2066-4d97-b21f-ba369a8b2920
>> > 1e3726b4-12e2-4184-b8e4-13f9c692095f
>> I _think_(not 100% sure) that you cannot apply QoS on a patch port.
>> Patch port has no netdevice backing it. OVS uses Linux tc to apply
>> QoS. Since tc cannot see the OVS patch port, I don't think anything
>> will come out of it.
>>
>> The way to verify that QoS is really working is to look at tc stats
>> for that queue. e.g: If you had applied QoS on eth1 with 3 queues: 1,
>> 2, 3, you will get:
>>
>> sudo tc class show dev eth1
>> class htb 1:fffe root rate 900000Kbit ceil 900000Kbit burst 1462b cburst
>> 1462b
>> class htb 1:1 parent 1:fffe prio 0 rate 720000Kbit ceil 900000Kbit
>> burst 1530b cburst 1462b
>> class htb 1:2 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
>> 1563b cburst 1563b
>> class htb 1:3 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
>> 1563b cburst 1563b
>>
>> For statistics: (to see how many packets went through etc)
>> tc -s class show dev eth1
>>
>>
>>
>> >
>> > # ovs-ofctl show br3
>> > OFPT_FEATURES_REPLY (xid=0x2): dpid:00007a42d1ca7e05
>> > n_tables:254, n_buffers:256
>> > capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
>> > actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC
>> > SET_DL_DST
>> > SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>> >  3(b2p): addr:ae:a4:9d:8b:9f:a9
>> >      config:     0
>> >      state:      0
>> >      speed: 0 Mbps now, 0 Mbps max
>> >  6(vnet0): addr:fe:54:00:ac:e1:a6
>> >      config:     0
>> >      state:      0
>> >      current:    10MB-FD COPPER
>> >      speed: 10 Mbps now, 0 Mbps max
>> >  LOCAL(br3): addr:7a:42:d1:ca:7e:05
>> >      config:     0
>> >      state:      0
>> >      speed: 0 Mbps now, 0 Mbps max
>> > OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>> >
>> > # ovs-ofctl add-flow br3 priority=5,in_port=6,actions=enqueue:3:111
>> > # ovs-ofctl dump-flows br3
>> > NXST_FLOW reply (xid=0x4):
>> >  cookie=0x0, duration=3.285s, table=0, n_packets=0, n_bytes=0,
>> > idle_age=3,
>> > priority=5,in_port=6 actions=enqueue:3:111
>> >  cookie=0x0, duration=79191.532s, table=0, n_packets=744,
>> > n_bytes=431875,
>> > idle_age=7, hard_age=65534, priority=0 actions=NORMAL
>> >
>> > Then I start to ping6 from VM2 to VM1 and pings will go through that
>> > patch-ports b3p and b2p. As I expected, the QoS queue will be in effect.
>> > And
>> > limit the bandwidth to very small amount of max-rate=10
>> How do you know that QOS is in effect above? I guess based on the
>> n_packets of openflow flow? That only tells that OVS marked the packet
>> to go to a QoS queue. But if QoS queue has not been created in Linux
>> kernel, there is really nothing that will happen.
>>
>> I imagine that OVS should show some error in the logs, but I did not
>> see any (during my small test). That is the reason I am not 100% sure
>> what will actually  happen.
>
>

From shettyg at nicira.com  Fri Mar 27 08:04:18 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 27 Mar 2015 08:04:18 -0700
Subject: [ovs-discuss] Is it possible to limit bandwidth for particular
 OVS port?
In-Reply-To: <CAHbON5oe=bTVLOULo8pWMM=dEhrDZQkfYVxtuOU7Wm5feo91ig@mail.gmail.com>
References: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>
 <CAHbON5rPDLZSxv0VD411kAPbNuJcT=_so+D6go3vRnu9mk8tEA@mail.gmail.com>
 <CABJqVcz_J5D8cJsFJ=zcw21dMQXCrETosYofE6VYhE3i4+7aUw@mail.gmail.com>
 <CAHbON5oTeRsW1km25ip5bTuBCQGvpWdU5-6tzSUe0bn06BXp9Q@mail.gmail.com>
 <CABJqVcwoTddoqSbLuOO4Uxzob3phK9pU=q-UPkW=91st9yB6oQ@mail.gmail.com>
 <CAHbON5oe=bTVLOULo8pWMM=dEhrDZQkfYVxtuOU7Wm5feo91ig@mail.gmail.com>
Message-ID: <CAHbON5rxbEt_cgD_wSqqBPo86bgcuP=eMbR48MMPDagECGHdYw@mail.gmail.com>

And it likely works with the default queue because, OVS does not do
any marking of packets and Linux kernel by default uses up that queue
for that netdevice.

On Fri, Mar 27, 2015 at 7:46 AM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> On Thu, Mar 26, 2015 at 6:35 PM, Tim Bagr <timbgr at gmail.com> wrote:
>> Thanks for your reply! It helps a lot. I didn't use tc before. I just
>> watched at large ping packets and if they are delayed progressively - then I
>> concluded QoS is actually working.
>>
>> I tried again with patch-port and you're right.
>> # tc class show dev b2p
>> had shown nothing.
>>
>> So I tried to do the trick with LOCAL interface again, which is the same
>> name as name of bridge, in my case "br3".
>>
>> # ovs-vsctl set port br3 qos=@nqos -- --id=@nqos create qos type=linux-htb
>> other-config:max-rate=100000 queues=111=@nq -- --id=@nq create queue
>> other-config:max-rate=13000
>>
>> And then, tried to alter max-rate for QoS object:
>> # ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
>> other-config:max-rate=100000
>> # ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
>> other-config:max-rate=10000
>> # ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
>> other-config:max-rate=1000000
>>
>> And after each command I've sent pings from VM to outside network, and see
>> if they are limited. The values actually worked - when I set rate 10000, for
>> example, then pings from VM looked like:
>> [root at VM ~]# ping -i 0.1 outside.host -s 500
>> PING outside.host (10.1.1.168) 500(528) bytes of data.
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=1 ttl=63 time=0.242 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=2 ttl=63 time=0.270 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=3 ttl=63 time=0.224 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=4 ttl=63 time=67.7 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=5 ttl=63 time=85.7 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=6 ttl=63 time=75.3 ms
>> ^C508 bytes from 10.1.1.168: icmp_seq=7 ttl=63 time=84.8 ms
>>
>> And when I set rate about max-rate=100000000 then pings went flawlessly:
>>
>> [root at localhost ~]# ping -i 0.1 outside.host -s 500
>> PING outside.host (10.1.1.168) 500(528) bytes of data.
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=1 ttl=63 time=0.270 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=2 ttl=63 time=0.201 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=3 ttl=63 time=0.256 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=4 ttl=63 time=0.249 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=5 ttl=63 time=0.203 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=6 ttl=63 time=0.224 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=7 ttl=63 time=0.216 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=8 ttl=63 time=0.217 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=9 ttl=63 time=0.226 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=10 ttl=63 time=0.204 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=11 ttl=63 time=0.227 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=12 ttl=63 time=0.220 ms
>> 508 bytes from outside.host (10.1.1.168): icmp_seq=13 ttl=63 time=0.260 ms
>>
>>
>>
>> Then I set openflow rules to assign queue number to specific traffic (with
>> src and dst address equal to that otside.host, which I send ping requests
>> to):
>>
>> The rules are matched and n_packets grown when I sent pings:
>> # ovs-ofctl dump-flows br3 --sort=priority
>>  cookie=0x0, duration=155295.034s, table=0, n_packets=12692,
>> n_bytes=6188205, priority=0 actions=NORMAL
>>  cookie=0x0, duration=482.039s, table=0, n_packets=112, n_bytes=116704,
>> priority=15,ip,nw_src=10.1.1.168 actions=set_queue:111,NORMAL
>>  cookie=0x0, duration=531.879s, table=0, n_packets=259, n_bytes=269878,
>> priority=15,ip,nw_dst=10.1.1.168 actions=set_queue:111,NORMAL
>>  cookie=0x0, duration=420.512s, table=0, n_packets=640, n_bytes=751480,
>> priority=20,ip,nw_src=10.1.1.168 actions=enqueue:6:111
>>  cookie=0x0, duration=347.242s, table=0, n_packets=573, n_bytes=681666,
>> priority=20,ip,nw_dst=10.1.1.168 actions=enqueue:LOCAL:111
>>
>> But tc command shown that queue (as I suppose it's 1:70, is not active
>> against that traffic):
>> # tc -s class show dev br3
>> class htb 1:1 parent 1:fffe prio 0 rate 12000bit ceil 1000Kbit burst 1563b
>> cburst 1564b
>>  Sent 92820 bytes 128 pkt (dropped 0, overlimits 0 requeues 0)
>>  rate 0bit 0pps backlog 0b 0p requeues 0
>>  lended: 8 borrowed: 120 giants: 0
>>  tokens: 15854166 ctokens: 190250
> When you do the above, ping, you can look at the actual kernel
> datapath flows with a 'ovs-dpctl dump-flows'. You will see a flow of
> the following form (my ip addresses are different):
>
> recirc_id(0),skb_priority(0),in_port(1),eth(src=00:0c:29:d6:c0:2e,dst=00:0c:29:23:ee:7f),eth_type(0x0800),ipv4(src=192.168.1.1/255.255.255.255,dst=192.168.1.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
> packets:5, bytes:490, used:0.212s,
> actions:set(skb_priority(0x10070)),2
>
> The set(skb_priority(0x10070)),2 is the actual marking of packets to
> go to queue 70 (decimal 111, I think).
> So my take is that the packet has been marked and sent to output port
> 2 (in my case eth1). But since the queue is only in br3, I think it
> never gets hit.
>
> This is unchartered territory for me. My reading is that QoS can only
> be applied on the egress port.
>
>
>
>
>
>>
>> class htb 1:fffe root rate 1000Kbit ceil 1000Kbit burst 1500b cburst 1500b
>>  Sent 92820 bytes 128 pkt (dropped 0, overlimits 0 requeues 0)
>>  rate 0bit 0pps backlog 0b 0p requeues 0
>>  lended: 120 borrowed: 0 giants: 0
>>  tokens: 182250 ctokens: 182250
>>
>> class htb 1:70 parent 1:fffe prio 0 rate 12000bit ceil 13000bit burst 1563b
>> cburst 1563b
>>  Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0)
>>  rate 0bit 0pps backlog 0b 0p requeues 0
>>  lended: 0 borrowed: 0 giants: 0
>>  tokens: 16291666 ctokens: 15038461
>>
>>
>> Maybe it's some undiscovered bug? Or it works so just by design?
>>
>>
>>
>>
>>
>>
>>
>> On Thu, Mar 26, 2015 at 7:44 PM, Gurucharan Shetty <shettyg at nicira.com>
>> wrote:
>>>
>>> On Wed, Mar 25, 2015 at 7:03 PM, Tim Bagr <timbgr at gmail.com> wrote:
>>> > Hello Gurucharan,
>>> >
>>> > Thanks for the reply.
>>> >
>>> > I have no physical ports attached to that OVS bridge. My intention was
>>> > exactly to limit bandwidth for br3 port (i.e. openflow keyword LOCAL),
>>> > and
>>> > another try was to limit bandwidth for internal patch-port, which
>>> > connects
>>> > br3 bridge with br2 bridge. In both bridges there are VMs attached and
>>> > they
>>> > may communicate with each other through the patch-port.
>>> >
>>> > # ovs-vsctl show
>>> > b11e83cb-d741-4a59-90f7-ea9693d508cf
>>> >     Bridge "br2"
>>> >         Port "b3p"
>>> >             Interface "b3p"
>>> >                 type: patch
>>> >                 options: {peer="b2p"}
>>> >         Port "vnet1"
>>> >             Interface "vnet1"
>>> >         Port "br2"
>>> >             Interface "br2"
>>> >                 type: internal
>>> >     Bridge "br3"
>>> >         Port "br3"
>>> >             Interface "br3"
>>> >                 type: internal
>>> >         Port "vnet0"
>>> >             Interface "vnet0"
>>> >         Port "b2p"
>>> >             Interface "b2p"
>>> >                 type: patch
>>> >                 options: {peer="b3p"}
>>> >
>>> > Here vnet1 is port of 1st VM and vnet0 is port of 2nd VM. Now I just
>>> > want to
>>> > limit bandwidth from VM2 to VM1.
>>> > So I run:
>>> > # ovs-vsctl set Port b2p qos=@newq -- --id=@newq create qos
>>> > type=linux-htb
>>> > other-config:max-rate=100000000 queues=111=@q1 -- --id=@q1 create queue
>>> > other-config:min-rate=0 other-config:max-rate=10
>>> > 65c5488d-2066-4d97-b21f-ba369a8b2920
>>> > 1e3726b4-12e2-4184-b8e4-13f9c692095f
>>> I _think_(not 100% sure) that you cannot apply QoS on a patch port.
>>> Patch port has no netdevice backing it. OVS uses Linux tc to apply
>>> QoS. Since tc cannot see the OVS patch port, I don't think anything
>>> will come out of it.
>>>
>>> The way to verify that QoS is really working is to look at tc stats
>>> for that queue. e.g: If you had applied QoS on eth1 with 3 queues: 1,
>>> 2, 3, you will get:
>>>
>>> sudo tc class show dev eth1
>>> class htb 1:fffe root rate 900000Kbit ceil 900000Kbit burst 1462b cburst
>>> 1462b
>>> class htb 1:1 parent 1:fffe prio 0 rate 720000Kbit ceil 900000Kbit
>>> burst 1530b cburst 1462b
>>> class htb 1:2 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
>>> 1563b cburst 1563b
>>> class htb 1:3 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
>>> 1563b cburst 1563b
>>>
>>> For statistics: (to see how many packets went through etc)
>>> tc -s class show dev eth1
>>>
>>>
>>>
>>> >
>>> > # ovs-ofctl show br3
>>> > OFPT_FEATURES_REPLY (xid=0x2): dpid:00007a42d1ca7e05
>>> > n_tables:254, n_buffers:256
>>> > capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
>>> > actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC
>>> > SET_DL_DST
>>> > SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>>> >  3(b2p): addr:ae:a4:9d:8b:9f:a9
>>> >      config:     0
>>> >      state:      0
>>> >      speed: 0 Mbps now, 0 Mbps max
>>> >  6(vnet0): addr:fe:54:00:ac:e1:a6
>>> >      config:     0
>>> >      state:      0
>>> >      current:    10MB-FD COPPER
>>> >      speed: 10 Mbps now, 0 Mbps max
>>> >  LOCAL(br3): addr:7a:42:d1:ca:7e:05
>>> >      config:     0
>>> >      state:      0
>>> >      speed: 0 Mbps now, 0 Mbps max
>>> > OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>>> >
>>> > # ovs-ofctl add-flow br3 priority=5,in_port=6,actions=enqueue:3:111
>>> > # ovs-ofctl dump-flows br3
>>> > NXST_FLOW reply (xid=0x4):
>>> >  cookie=0x0, duration=3.285s, table=0, n_packets=0, n_bytes=0,
>>> > idle_age=3,
>>> > priority=5,in_port=6 actions=enqueue:3:111
>>> >  cookie=0x0, duration=79191.532s, table=0, n_packets=744,
>>> > n_bytes=431875,
>>> > idle_age=7, hard_age=65534, priority=0 actions=NORMAL
>>> >
>>> > Then I start to ping6 from VM2 to VM1 and pings will go through that
>>> > patch-ports b3p and b2p. As I expected, the QoS queue will be in effect.
>>> > And
>>> > limit the bandwidth to very small amount of max-rate=10
>>> How do you know that QOS is in effect above? I guess based on the
>>> n_packets of openflow flow? That only tells that OVS marked the packet
>>> to go to a QoS queue. But if QoS queue has not been created in Linux
>>> kernel, there is really nothing that will happen.
>>>
>>> I imagine that OVS should show some error in the logs, but I did not
>>> see any (during my small test). That is the reason I am not 100% sure
>>> what will actually  happen.
>>
>>

From blp at nicira.com  Fri Mar 27 08:17:54 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 27 Mar 2015 08:17:54 -0700
Subject: [ovs-discuss] set-controller per table?
In-Reply-To: <CABFtFw=A41V+Laov5DHDfWbtKNwv8-K5m1LjfbOXLggqPyyZaA@mail.gmail.com>
References: <CABFtFwmSuPUbDPpy13iVhDHRO4n_yscHVhwnY1tPeJfR=jkLcQ@mail.gmail.com>
 <20150326205640.GA16976@nicira.com>
 <CABFtFw=A41V+Laov5DHDfWbtKNwv8-K5m1LjfbOXLggqPyyZaA@mail.gmail.com>
Message-ID: <20150327151754.GA3905@nicira.com>

You can do that by using the Open vSwitch extension that allows packets
to be directed to a particular controller.  With ovs-ofctl, the syntax
is "controller(id=<controller-id>)".  The controller must let the switch
know its controller number through a separate extension.

On Thu, Mar 26, 2015 at 11:34:40PM -0700, Ashok Chippa wrote:
> Can I have TableX punt packets to controller 1, and TableY punt packets to
> controller 2? In a table flow, if the action is "controller" which
> controller does it send the packets to, in case there are multiple
> controllers?
> 
> Thanks
> 
> On Thu, Mar 26, 2015 at 1:56 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Thu, Mar 26, 2015 at 12:37:04PM -0700, Ashok Chippa wrote:
> > > As I understand, today openvswitch supports multiple controllers, but not
> > > on a per table basis.
> >
> > What's a per-table controller and how is it different from an OpenFlow
> > controller?
> >

From timbgr at gmail.com  Thu Mar 26 18:35:47 2015
From: timbgr at gmail.com (Tim Bagr)
Date: Fri, 27 Mar 2015 05:35:47 +0400
Subject: [ovs-discuss] Is it possible to limit bandwidth for particular
 OVS port?
In-Reply-To: <CAHbON5oTeRsW1km25ip5bTuBCQGvpWdU5-6tzSUe0bn06BXp9Q@mail.gmail.com>
References: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>
 <CAHbON5rPDLZSxv0VD411kAPbNuJcT=_so+D6go3vRnu9mk8tEA@mail.gmail.com>
 <CABJqVcz_J5D8cJsFJ=zcw21dMQXCrETosYofE6VYhE3i4+7aUw@mail.gmail.com>
 <CAHbON5oTeRsW1km25ip5bTuBCQGvpWdU5-6tzSUe0bn06BXp9Q@mail.gmail.com>
Message-ID: <CABJqVcwoTddoqSbLuOO4Uxzob3phK9pU=q-UPkW=91st9yB6oQ@mail.gmail.com>

Thanks for your reply! It helps a lot. I didn't use tc before. I just
watched at large ping packets and if they are delayed progressively - then
I concluded QoS is actually working.

I tried again with patch-port and you're right.
*# tc class show dev b2p *
had shown nothing.

So I tried to do the trick with LOCAL interface again, which is the same
name as name of bridge, in my case "br3".

*# ovs-vsctl set port br3 qos=@nqos -- --id=@nqos create qos
type=linux-htb other-config:max-rate=100000 queues=111=@nq -- --id=@nq
create queue other-config:max-rate=13000*

And then, tried to alter max-rate for QoS object:

*# ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
other-config:max-rate=100000
# ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
other-config:max-rate=10000
# ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
other-config:max-rate=1000000*

And after each command I've sent pings from VM to outside network, and
see if they are limited. The values actually worked - when I set rate
10000, for example, then pings from VM looked like:
[root at VM ~]*# ping -i 0.1 outside.host -s 500*
PING outside.host (10.1.1.168) 500(528) bytes of data.
508 bytes from outside.host (10.1.1.168): icmp_seq=1 ttl=63 time=0.242 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=2 ttl=63 time=0.270 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=3 ttl=63 time=0.224 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=4 ttl=63 time=67.7 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=5 ttl=63 time=85.7 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=6 ttl=63 time=75.3 ms
^C508 bytes from 10.1.1.168: icmp_seq=7 ttl=63 time=84.8 ms

And when I set rate about max-rate=100000000 then pings went flawlessly:

[root at localhost ~]*# ping -i 0.1 outside.host -s 500*
PING outside.host (10.1.1.168) 500(528) bytes of data.
508 bytes from outside.host (10.1.1.168): icmp_seq=1 ttl=63 time=0.270 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=2 ttl=63 time=0.201 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=3 ttl=63 time=0.256 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=4 ttl=63 time=0.249 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=5 ttl=63 time=0.203 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=6 ttl=63 time=0.224 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=7 ttl=63 time=0.216 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=8 ttl=63 time=0.217 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=9 ttl=63 time=0.226 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=10 ttl=63 time=0.204 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=11 ttl=63 time=0.227 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=12 ttl=63 time=0.220 ms
508 bytes from outside.host (10.1.1.168): icmp_seq=13 ttl=63 time=0.260 ms



Then I set openflow rules to assign queue number to specific traffic (with
src and dst address equal to that otside.host, which I send ping requests
to):

The rules are matched and n_packets grown when I sent pings:
*# ovs-ofctl dump-flows br3 --sort=priority*
 cookie=0x0, duration=155295.034s, table=0, n_packets=12692,
n_bytes=6188205, priority=0 actions=NORMAL
 cookie=0x0, duration=482.039s, table=0, n_packets=112, n_bytes=116704,
priority=15,ip,nw_src=10.1.1.168 actions=set_queue:111,NORMAL
 cookie=0x0, duration=531.879s, table=0, n_packets=259, n_bytes=269878,
priority=15,ip,nw_dst=10.1.1.168 actions=set_queue:111,NORMAL
 cookie=0x0, duration=420.512s, table=0, n_packets=640, n_bytes=751480,
priority=20,ip,nw_src=10.1.1.168 actions=enqueue:6:111
 cookie=0x0, duration=347.242s, table=0, n_packets=573, n_bytes=681666,
priority=20,ip,nw_dst=10.1.1.168 actions=enqueue:LOCAL:111

But tc command shown that queue (as I suppose it's 1:70, is not active
against that traffic):
*# tc -s class show dev br3*
class htb 1:1 parent 1:fffe prio 0 rate 12000bit ceil 1000Kbit burst 1563b
cburst 1564b
 Sent 92820 bytes 128 pkt (dropped 0, overlimits 0 requeues 0)
 rate 0bit 0pps backlog 0b 0p requeues 0
 lended: 8 borrowed: 120 giants: 0
 tokens: 15854166 ctokens: 190250

class htb 1:fffe root rate 1000Kbit ceil 1000Kbit burst 1500b cburst 1500b
 Sent 92820 bytes 128 pkt (dropped 0, overlimits 0 requeues 0)
 rate 0bit 0pps backlog 0b 0p requeues 0
 lended: 120 borrowed: 0 giants: 0
 tokens: 182250 ctokens: 182250

class htb 1:70 parent 1:fffe prio 0 rate 12000bit ceil 13000bit burst 1563b
cburst 1563b
* Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0)*
 rate 0bit 0pps backlog 0b 0p requeues 0
 lended: 0 borrowed: 0 giants: 0
 tokens: 16291666 ctokens: 15038461


Maybe it's some undiscovered bug? Or it works so just by design?







On Thu, Mar 26, 2015 at 7:44 PM, Gurucharan Shetty <shettyg at nicira.com>
wrote:

> On Wed, Mar 25, 2015 at 7:03 PM, Tim Bagr <timbgr at gmail.com> wrote:
> > Hello Gurucharan,
> >
> > Thanks for the reply.
> >
> > I have no physical ports attached to that OVS bridge. My intention was
> > exactly to limit bandwidth for br3 port (i.e. openflow keyword LOCAL),
> and
> > another try was to limit bandwidth for internal patch-port, which
> connects
> > br3 bridge with br2 bridge. In both bridges there are VMs attached and
> they
> > may communicate with each other through the patch-port.
> >
> > # ovs-vsctl show
> > b11e83cb-d741-4a59-90f7-ea9693d508cf
> >     Bridge "br2"
> >         Port "b3p"
> >             Interface "b3p"
> >                 type: patch
> >                 options: {peer="b2p"}
> >         Port "vnet1"
> >             Interface "vnet1"
> >         Port "br2"
> >             Interface "br2"
> >                 type: internal
> >     Bridge "br3"
> >         Port "br3"
> >             Interface "br3"
> >                 type: internal
> >         Port "vnet0"
> >             Interface "vnet0"
> >         Port "b2p"
> >             Interface "b2p"
> >                 type: patch
> >                 options: {peer="b3p"}
> >
> > Here vnet1 is port of 1st VM and vnet0 is port of 2nd VM. Now I just
> want to
> > limit bandwidth from VM2 to VM1.
> > So I run:
> > # ovs-vsctl set Port b2p qos=@newq -- --id=@newq create qos
> type=linux-htb
> > other-config:max-rate=100000000 queues=111=@q1 -- --id=@q1 create queue
> > other-config:min-rate=0 other-config:max-rate=10
> > 65c5488d-2066-4d97-b21f-ba369a8b2920
> > 1e3726b4-12e2-4184-b8e4-13f9c692095f
> I _think_(not 100% sure) that you cannot apply QoS on a patch port.
> Patch port has no netdevice backing it. OVS uses Linux tc to apply
> QoS. Since tc cannot see the OVS patch port, I don't think anything
> will come out of it.
>
> The way to verify that QoS is really working is to look at tc stats
> for that queue. e.g: If you had applied QoS on eth1 with 3 queues: 1,
> 2, 3, you will get:
>
> sudo tc class show dev eth1
> class htb 1:fffe root rate 900000Kbit ceil 900000Kbit burst 1462b cburst
> 1462b
> class htb 1:1 parent 1:fffe prio 0 rate 720000Kbit ceil 900000Kbit
> burst 1530b cburst 1462b
> class htb 1:2 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
> 1563b cburst 1563b
> class htb 1:3 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
> 1563b cburst 1563b
>
> For statistics: (to see how many packets went through etc)
> tc -s class show dev eth1
>
>
>
> >
> > # ovs-ofctl show br3
> > OFPT_FEATURES_REPLY (xid=0x2): dpid:00007a42d1ca7e05
> > n_tables:254, n_buffers:256
> > capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> > actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC
> SET_DL_DST
> > SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
> >  3(b2p): addr:ae:a4:9d:8b:9f:a9
> >      config:     0
> >      state:      0
> >      speed: 0 Mbps now, 0 Mbps max
> >  6(vnet0): addr:fe:54:00:ac:e1:a6
> >      config:     0
> >      state:      0
> >      current:    10MB-FD COPPER
> >      speed: 10 Mbps now, 0 Mbps max
> >  LOCAL(br3): addr:7a:42:d1:ca:7e:05
> >      config:     0
> >      state:      0
> >      speed: 0 Mbps now, 0 Mbps max
> > OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> >
> > # ovs-ofctl add-flow br3 priority=5,in_port=6,actions=enqueue:3:111
> > # ovs-ofctl dump-flows br3
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=3.285s, table=0, n_packets=0, n_bytes=0,
> idle_age=3,
> > priority=5,in_port=6 actions=enqueue:3:111
> >  cookie=0x0, duration=79191.532s, table=0, n_packets=744, n_bytes=431875,
> > idle_age=7, hard_age=65534, priority=0 actions=NORMAL
> >
> > Then I start to ping6 from VM2 to VM1 and pings will go through that
> > patch-ports b3p and b2p. As I expected, the QoS queue will be in effect.
> And
> > limit the bandwidth to very small amount of max-rate=10
> How do you know that QOS is in effect above? I guess based on the
> n_packets of openflow flow? That only tells that OVS marked the packet
> to go to a QoS queue. But if QoS queue has not been created in Linux
> kernel, there is really nothing that will happen.
>
> I imagine that OVS should show some error in the logs, but I did not
> see any (during my small test). That is the reason I am not 100% sure
> what will actually  happen.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/6567f0fa/attachment-0001.html>

From leek2006 at 163.com  Thu Mar 26 19:27:56 2015
From: leek2006 at 163.com (=?GBK?B?wO7OsA==?=)
Date: Fri, 27 Mar 2015 10:27:56 +0800 (CST)
Subject: [ovs-discuss] ovs2.3.1 kernel  crash
Message-ID: <da546bc.4abc.14c590eaece.Coremail.leek2006@163.com>



The OVS add  of 100 port :
ovs-vsctl  show|grep Port|wc -l
101
then  host connect lost  .


TTY show kernel info :

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/044c74c0/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图2.png
Type: image/png
Size: 4660 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/044c74c0/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图3.png
Type: image/png
Size: 2464 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/044c74c0/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图1.png
Type: image/png
Size: 201471 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/044c74c0/attachment-0005.png>

From leek2006 at 163.com  Thu Mar 26 19:49:18 2015
From: leek2006 at 163.com (=?GBK?B?wO7OsA==?=)
Date: Fri, 27 Mar 2015 10:49:18 +0800 (CST)
Subject: [ovs-discuss] ovs2.3.1 kernel  crash
In-Reply-To: <da546bc.4abc.14c590eaece.Coremail.leek2006@163.com>
References: <da546bc.4abc.14c590eaece.Coremail.leek2006@163.com>
Message-ID: <305b9a0f.55e8.14c59223d4f.Coremail.leek2006@163.com>

kernel bug ?
https://bugzilla.redhat.com/show_bug.cgi?id=902012





在 2015-03-27 10:27:56，"李伟" <leek2006 at 163.com> 写道：



The OVS add  of 100 port :
ovs-vsctl  show|grep Port|wc -l
101
then  host connect lost  .


TTY show kernel info :




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/cb013978/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图2.png
Type: image/png
Size: 4660 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/cb013978/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图3.png
Type: image/png
Size: 2464 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/cb013978/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图1.png
Type: image/png
Size: 201471 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/cb013978/attachment-0005.png>

From eltonyli at yahoo.com  Fri Mar 27 02:17:21 2015
From: eltonyli at yahoo.com (Hongjun Li)
Date: Fri, 27 Mar 2015 09:17:21 +0000 (UTC)
Subject: [ovs-discuss] How to make vxlan flow for this scenario
Message-ID: <2018827279.1273132.1427447841060.JavaMail.yahoo@mail.yahoo.com>


        OVS_IFACES="eth0 p1p1'
        ovs-vsctl add-br br0
        for iface in $OVS_IFACES
        do
                exist=`grep "$iface" /proc/net/dev`
                if  [ -n "$exist" ] ; then
                        ovs-vsctl add-port br0 $iface
                        ifconfig $iface promisc up
                fi
        done
        
         ovs-vsctl add-port br0 vxlan0 -- set Interface vxlan0 type=vxlan options:key=flow options:local_ip=192.168.1.180 options:remote_ip=192.168.1.181 ofport_request=10
        ###### ovs-ofctl add-flow br0 in_port=1,actions=output:10
        ###### ovs-ofctl add-flow br0 in_port=10,actions=output:1
        ifconfig br0 up
The packets from eth0 will be encapsulated by vxlan then sent on p1p1. Would you please tell me how to make flows? Thank you

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/e02d73c4/attachment.html>

From sanghamitra.de at gmail.com  Thu Mar 26 23:30:19 2015
From: sanghamitra.de at gmail.com (Sanghamitra De)
Date: Fri, 27 Mar 2015 12:00:19 +0530
Subject: [ovs-discuss] seeking help
Message-ID: <CAG=b5B1ABsOKErQAw+d3FCmcmm3EW7hm8uoD_yK=jJ6A+9A6SA@mail.gmail.com>

Hi,

the log file screenshot is attached.

the following errors continue on trying the following lines:


#ovs-vsctl add-br br-int
ovs-vsctl: Error detected while setting up 'br-int'. See ovs-vswitchd log
for details

# ovs-vsctl add-br br0
ovs-vsctl: Error detected while setting up 'br0'. See ovs-vswitchd log for
details

# ovs-vsctl add-br br1
ovs-vsctl: Error detected while setting up 'br1'. See ovs-vswitchd log for
details

why is there problem while trying to create br-int or br0, br1 for that
matter?


Thanks & Regards
Sanghamitra De
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/1161c9f0/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: log2.jpg
Type: image/jpeg
Size: 319636 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/1161c9f0/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: log1.jpg
Type: image/jpeg
Size: 310309 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/1161c9f0/attachment-0003.jpg>

From shettyg at nicira.com  Fri Mar 27 10:06:58 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 27 Mar 2015 10:06:58 -0700
Subject: [ovs-discuss] seeking help
In-Reply-To: <CAG=b5B1ABsOKErQAw+d3FCmcmm3EW7hm8uoD_yK=jJ6A+9A6SA@mail.gmail.com>
References: <CAG=b5B1ABsOKErQAw+d3FCmcmm3EW7hm8uoD_yK=jJ6A+9A6SA@mail.gmail.com>
Message-ID: <CAHbON5raxJMDnu3sOja_3XSMzm1dybejQk0herDXFR02ta9uTg@mail.gmail.com>

The log says "Open vSwitch kernel module is probably not loaded". You
will need to load the kernel module, if your intention is to use that
as the datapath.

On Thu, Mar 26, 2015 at 11:30 PM, Sanghamitra De
<sanghamitra.de at gmail.com> wrote:
> Hi,
>
> the log file screenshot is attached.
>
> the following errors continue on trying the following lines:
>
>
> #ovs-vsctl add-br br-int
> ovs-vsctl: Error detected while setting up 'br-int'. See ovs-vswitchd log
> for details
>
> # ovs-vsctl add-br br0
> ovs-vsctl: Error detected while setting up 'br0'. See ovs-vswitchd log for
> details
>
> # ovs-vsctl add-br br1
> ovs-vsctl: Error detected while setting up 'br1'. See ovs-vswitchd log for
> details
>
> why is there problem while trying to create br-int or br0, br1 for that
> matter?
>
>
> Thanks & Regards
>
> Sanghamitra De
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From 13520814722 at 126.com  Fri Mar 27 10:28:24 2015
From: 13520814722 at 126.com (Kris)
Date: Sat, 28 Mar 2015 01:28:24 +0800 (GMT+08:00)
Subject: [ovs-discuss] seeking help
In-Reply-To: <CAG=b5B1ABsOKErQAw+d3FCmcmm3EW7hm8uoD_yK=jJ6A+9A6SA@mail.gmail.com>
References: <CAG=b5B1ABsOKErQAw+d3FCmcmm3EW7hm8uoD_yK=jJ6A+9A6SA@mail.gmail.com>
Message-ID: <7b6fb01.11fa4.14c5c47133e.Coremail.13520814722@126.com>

How did you install the ovs? It seems your installation is not correct.


KRIS



On 2015-03-28 01:02 , Sanghamitra De Wrote:


Hi,
 
the log file screenshot is attached.

the following errors continue on trying the following lines:


#ovs-vsctl add-br br-int
ovs-vsctl: Error detected while setting up 'br-int'. See ovs-vswitchd log for details

# ovs-vsctl add-br br0
ovs-vsctl: Error detected while setting up 'br0'. See ovs-vswitchd log for details

# ovs-vsctl add-br br1
ovs-vsctl: Error detected while setting up 'br1'. See ovs-vswitchd log for details

why is there problem while trying to create br-int or br0, br1 for that matter?

 
Thanks & Regards

Sanghamitra De
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150328/0272cff6/attachment.html>

From jpettit at nicira.com  Fri Mar 27 10:37:28 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Fri, 27 Mar 2015 10:37:28 -0700
Subject: [ovs-discuss] droping http or udp packets
In-Reply-To: <CABpZToUUAwiobmDyBUxw70WgsV6JprzYb75ZUTRrKUbaiD6wDA@mail.gmail.com>
References: <CABpZToUUAwiobmDyBUxw70WgsV6JprzYb75ZUTRrKUbaiD6wDA@mail.gmail.com>
Message-ID: <73831AFB-0B50-4978-9D08-DDCEE35C26CC@nicira.com>

There's currently no way to identify protocols on non-standard ports.  However, those services typically run on well-known ports, and you can filter based on those.

--Justin


> On Mar 27, 2015, at 4:58 AM, Prashant Singh <prashant.ietedelhi at gmail.com> wrote:
> 
> Hi 
> I wants to restrict the http or ftp packet on the switch i.e the scenario is, the client is connected to the http and ftp server through openvswitch. He can access the http but not ftp and so on. I didnt find any useful parameters to set, so that I can restrict the client based on the application layer protocols. 
>  Please help me related to it.
> Prashant
> Project Associate,
> IIT DELHI
> phone- 08447720406, 
> 08010476362
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From pshelar at nicira.com  Fri Mar 27 10:55:42 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Fri, 27 Mar 2015 10:55:42 -0700
Subject: [ovs-discuss] ovs2.3.1 kernel crash
In-Reply-To: <305b9a0f.55e8.14c59223d4f.Coremail.leek2006@163.com>
References: <da546bc.4abc.14c590eaece.Coremail.leek2006@163.com>
 <305b9a0f.55e8.14c59223d4f.Coremail.leek2006@163.com>
Message-ID: <CALnjE+qgkE-Ngrkc2av4svB-jNgwDA6dezO42CqmA_NNbTDb6g@mail.gmail.com>

On Thu, Mar 26, 2015 at 7:49 PM, 李伟 <leek2006 at 163.com> wrote:

> kernel bug ?
> https://bugzilla.redhat.com/show_bug.cgi?id=902012
>
>

> 在 2015-03-27 10:27:56，"李伟" <leek2006 at 163.com> 写道：
>
>
> The OVS add  of 100 port :
> ovs-vsctl  show|grep Port|wc -l
> 101
> then  host connect lost  .
>
> TTY show kernel info :
>
>
>
>
This is partial kernel stack which not helpful. Can you send us full kernel
log to analyze it.

Thanks,
Pravin.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/a11ddbcc/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图1.png
Type: image/png
Size: 201471 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/a11ddbcc/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图3.png
Type: image/png
Size: 2464 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/a11ddbcc/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图2.png
Type: image/png
Size: 4660 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/a11ddbcc/attachment-0005.png>

From alexw at nicira.com  Fri Mar 27 14:51:48 2015
From: alexw at nicira.com (Alex Wang)
Date: Fri, 27 Mar 2015 14:51:48 -0700
Subject: [ovs-discuss] ovs2.3.1 kernel crash
In-Reply-To: <CALnjE+qgkE-Ngrkc2av4svB-jNgwDA6dezO42CqmA_NNbTDb6g@mail.gmail.com>
References: <da546bc.4abc.14c590eaece.Coremail.leek2006@163.com>
 <305b9a0f.55e8.14c59223d4f.Coremail.leek2006@163.com>
 <CALnjE+qgkE-Ngrkc2av4svB-jNgwDA6dezO42CqmA_NNbTDb6g@mail.gmail.com>
Message-ID: <CAArS4XW7jeQ0gKXU+o-cYw17U-cXh33F+7Hbi5O3x++MVAqbSw@mail.gmail.com>

This is the default rhel7, centos7 kernel, which is buggy,

please upgrade to 3.10.0-123.8.1.el7.x86_64 or 3.10.0-123.9.2.el7.x86_64...

I tested those two.~

Thanks,
Alex Wang,

On Fri, Mar 27, 2015 at 10:55 AM, Pravin Shelar <pshelar at nicira.com> wrote:

>
>
> On Thu, Mar 26, 2015 at 7:49 PM, 李伟 <leek2006 at 163.com> wrote:
>
>> kernel bug ?
>> https://bugzilla.redhat.com/show_bug.cgi?id=902012
>>
>>
>
>> 在 2015-03-27 10:27:56，"李伟" <leek2006 at 163.com> 写道：
>>
>>
>> The OVS add  of 100 port :
>> ovs-vsctl  show|grep Port|wc -l
>> 101
>> then  host connect lost  .
>>
>> TTY show kernel info :
>>
>>
>>
>>
> This is partial kernel stack which not helpful. Can you send us full
> kernel log to analyze it.
>
> Thanks,
> Pravin.
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/a2d2b089/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图2.png
Type: image/png
Size: 4660 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/a2d2b089/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图1.png
Type: image/png
Size: 201471 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/a2d2b089/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图3.png
Type: image/png
Size: 2464 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/a2d2b089/attachment-0005.png>

From a.n.chippa at gmail.com  Fri Mar 27 22:42:31 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Fri, 27 Mar 2015 22:42:31 -0700
Subject: [ovs-discuss] set-controller per table?
In-Reply-To: <20150327151754.GA3905@nicira.com>
References: <CABFtFwmSuPUbDPpy13iVhDHRO4n_yscHVhwnY1tPeJfR=jkLcQ@mail.gmail.com>
 <20150326205640.GA16976@nicira.com>
 <CABFtFw=A41V+Laov5DHDfWbtKNwv8-K5m1LjfbOXLggqPyyZaA@mail.gmail.com>
 <20150327151754.GA3905@nicira.com>
Message-ID: <CABFtFw=a-axUM79t4LDs6v18LRd=VHw2d8MxWk1kYubbncgURQ@mail.gmail.com>

Thanks, appreciate your help.

On Fri, Mar 27, 2015 at 8:17 AM, Ben Pfaff <blp at nicira.com> wrote:

> You can do that by using the Open vSwitch extension that allows packets
> to be directed to a particular controller.  With ovs-ofctl, the syntax
> is "controller(id=<controller-id>)".  The controller must let the switch
> know its controller number through a separate extension.
>
> On Thu, Mar 26, 2015 at 11:34:40PM -0700, Ashok Chippa wrote:
> > Can I have TableX punt packets to controller 1, and TableY punt packets
> to
> > controller 2? In a table flow, if the action is "controller" which
> > controller does it send the packets to, in case there are multiple
> > controllers?
> >
> > Thanks
> >
> > On Thu, Mar 26, 2015 at 1:56 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Thu, Mar 26, 2015 at 12:37:04PM -0700, Ashok Chippa wrote:
> > > > As I understand, today openvswitch supports multiple controllers,
> but not
> > > > on a per table basis.
> > >
> > > What's a per-table controller and how is it different from an OpenFlow
> > > controller?
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150327/fe83f06f/attachment.html>

From sanghamitra.de at gmail.com  Sat Mar 28 00:31:32 2015
From: sanghamitra.de at gmail.com (Sanghamitra De)
Date: Sat, 28 Mar 2015 13:01:32 +0530
Subject: [ovs-discuss] seeking help
In-Reply-To: <7b6fb01.11fa4.14c5c47133e.Coremail.13520814722@126.com>
References: <CAG=b5B1ABsOKErQAw+d3FCmcmm3EW7hm8uoD_yK=jJ6A+9A6SA@mail.gmail.com>
 <7b6fb01.11fa4.14c5c47133e.Coremail.13520814722@126.com>
Message-ID: <CAG=b5B3Q51k-htgjpddMDOE9+MvRN_K=he_FEZT1GLB4Ug5jwA@mail.gmail.com>

Hi,
Thanks for the reply.


I made the installation by the following commands:

sudo mkdir /work
sudo chown `whoami` /work
cd /work

## Download, configure, compile, and install Open vSwitch.
wget http://openvswitch.org/releases/openvswitch-2.3.0.tar.gz
tar zxf openvswitch-2.3.0.tar.gz
cd openvswitch-2.3.0
./configure
make
sudo make install

sudo /sbin/modprobe openvswitch





/sbin/lsmod



## Clean up.
cd /
sudo rm -rf /work

## Logout, used Emulab web interface to make a disk *image*. Then loaded
that image to the nodes where i wanted OVS to be loaded.

Then the following commands were given:


#ovsdb-tool create /usr/local/etc/openvswitch/conf.db
/users/peertest/openvswitch-2.3.0/vswitchd/vswitch.ovsschema

# ovsdb-server --remote=punix:/usr/local/var/run/openvswitch/db.sock \

                 --remote=db:Open_vSwitch,Open_vSwitch,manager_options \

                 --pidfile --detach



 # ovs-vsctl --no-wait init

sudo ovs-vswitchd --pidfile --detach --log-file


Then logged into a node which has OVS installed in the above way and gave:

sudo ifconfig eth1 0

sudo ifconfig eth2 0


#ovs-vsctl add-br br-int

sudo ovs-vsctl add-br OVSbr1

sudo ovs-vsctl add-br OVSbr2


Last 3 lines give error so to see the log file:

cat /var/log/openvswitch/ovs-vswitchd.log



Am I missing out something vital in the command? If so then Please let
me know what will be the correct sequence of commands.

I'm trying to do a couple of experiments by using a few nodes in
Emulab. Of these 3 nodes will act as switches- so i am using the
*image *(mentioned earlier) to install OVS in them. The nodes will
talk to each other and switches will do the routing.  And here i am
stuck with the OVS install. Next i got to write the controller.. Can
you help me get the installation right?



Thanks & Regards

Sanghamitra De




On Fri, Mar 27, 2015 at 10:58 PM, Kris <13520814722 at 126.com> wrote:

> How did you install the ovs? It seems your installation is not correct.
>
>
> KRIS
>
>
> On 2015-03-28 01:02 , Sanghamitra De <sanghamitra.de at gmail.com> Wrote:
>
> Hi,
>
> the log file screenshot is attached.
>
> the following errors continue on trying the following lines:
>
>
> #ovs-vsctl add-br br-int
> ovs-vsctl: Error detected while setting up 'br-int'. See ovs-vswitchd log
> for details
>
> # ovs-vsctl add-br br0
> ovs-vsctl: Error detected while setting up 'br0'. See ovs-vswitchd log for
> details
>
> # ovs-vsctl add-br br1
> ovs-vsctl: Error detected while setting up 'br1'. See ovs-vswitchd log for
> details
>
> why is there problem while trying to create br-int or br0, br1 for that
> matter?
>
>
> Thanks & Regards
> Sanghamitra De
>
>
>
> 来自网易手机号码邮箱了解更多 <http://shouji.163.com>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150328/e9610dbf/attachment.html>

From pichuang at cs.nctu.edu.tw  Sat Mar 28 09:56:16 2015
From: pichuang at cs.nctu.edu.tw (Ping Chun Huang)
Date: Sun, 29 Mar 2015 00:56:16 +0800
Subject: [ovs-discuss] seeking help
In-Reply-To: <CAG=b5B3Q51k-htgjpddMDOE9+MvRN_K=he_FEZT1GLB4Ug5jwA@mail.gmail.com>
References: <CAG=b5B1ABsOKErQAw+d3FCmcmm3EW7hm8uoD_yK=jJ6A+9A6SA@mail.gmail.com>
 <7b6fb01.11fa4.14c5c47133e.Coremail.13520814722@126.com>
 <CAG=b5B3Q51k-htgjpddMDOE9+MvRN_K=he_FEZT1GLB4Ug5jwA@mail.gmail.com>
Message-ID: <CAJoNDx1m2aYW311k4Qk2xXhhkD=TuMdHdh3qD97mX2i=a4mxzw@mail.gmail.com>

hi,

Does any ovsdb schema in
"/users/peertest/openvswitch-2.3.0/vswitchd/vswitch.ovsschema"? I think you
loss that.

if you want to find that, try to "locate vswitch.ovsschema"


pichuang, Ping-Chun Huang �S���x


Wireless Internet Laboratory
Computer Center, Department of Computer Science
National Chiao Tung University

2015-03-28 15:31 GMT+08:00 Sanghamitra De <sanghamitra.de at gmail.com>:

> Hi,
> Thanks for the reply.
>
>
> I made the installation by the following commands:
>
> sudo mkdir /work
> sudo chown `whoami` /work
> cd /work
>
> ## Download, configure, compile, and install Open vSwitch.
> wget http://openvswitch.org/releases/openvswitch-2.3.0.tar.gz
> tar zxf openvswitch-2.3.0.tar.gz
> cd openvswitch-2.3.0
> ./configure
> make
> sudo make install
>
> sudo /sbin/modprobe openvswitch
>
>
>
>
>
> /sbin/lsmod
>
>
>
> ## Clean up.
> cd /
> sudo rm -rf /work
>
> ## Logout, used Emulab web interface to make a disk *image*. Then loaded
> that image to the nodes where i wanted OVS to be loaded.
>
> Then the following commands were given:
>
>
> #ovsdb-tool create /usr/local/etc/openvswitch/conf.db
> /users/peertest/openvswitch-2.3.0/vswitchd/vswitch.ovsschema
>
> # ovsdb-server --remote=punix:/usr/local/var/run/openvswitch/db.sock \
>
>                  --remote=db:Open_vSwitch,Open_vSwitch,manager_options \
>
>                  --pidfile --detach
>
>
>
>  # ovs-vsctl --no-wait init
>
> sudo ovs-vswitchd --pidfile --detach --log-file
>
>
> Then logged into a node which has OVS installed in the above way and gave:
>
> sudo ifconfig eth1 0
>
> sudo ifconfig eth2 0
>
>
> #ovs-vsctl add-br br-int
>
> sudo ovs-vsctl add-br OVSbr1
>
> sudo ovs-vsctl add-br OVSbr2
>
>
> Last 3 lines give error so to see the log file:
>
> cat /var/log/openvswitch/ovs-vswitchd.log
>
>
>
> Am I missing out something vital in the command? If so then Please let me know what will be the correct sequence of commands.
>
> I'm trying to do a couple of experiments by using a few nodes in Emulab. Of these 3 nodes will act as switches- so i am using the *image *(mentioned earlier) to install OVS in them. The nodes will talk to each other and switches will do the routing.  And here i am stuck with the OVS install. Next i got to write the controller.. Can you help me get the installation right?
>
>
>
> Thanks & Regards
>
> Sanghamitra De
>
>
>
>
> On Fri, Mar 27, 2015 at 10:58 PM, Kris <13520814722 at 126.com> wrote:
>
>> How did you install the ovs? It seems your installation is not correct.
>>
>>
>> KRIS
>>
>>
>> On 2015-03-28 01:02 , Sanghamitra De <sanghamitra.de at gmail.com> Wrote:
>>
>> Hi,
>>
>> the log file screenshot is attached.
>>
>> the following errors continue on trying the following lines:
>>
>>
>> #ovs-vsctl add-br br-int
>> ovs-vsctl: Error detected while setting up 'br-int'. See ovs-vswitchd log
>> for details
>>
>> # ovs-vsctl add-br br0
>> ovs-vsctl: Error detected while setting up 'br0'. See ovs-vswitchd log
>> for details
>>
>> # ovs-vsctl add-br br1
>> ovs-vsctl: Error detected while setting up 'br1'. See ovs-vswitchd log
>> for details
>>
>> why is there problem while trying to create br-int or br0, br1 for that
>> matter?
>>
>>
>> Thanks & Regards
>> Sanghamitra De
>>
>>
>>
>> ���������ֻ����������˽���� <http://shouji.163.com>
>>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150329/10bb3add/attachment-0001.html>

From wuhao.thu at gmail.com  Sat Mar 28 14:06:54 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Sat, 28 Mar 2015 14:06:54 -0700
Subject: [ovs-discuss] Can I add parameters to NetFlow module bypassing the
	database?
Message-ID: <CAHmvmjEys5_ZJu0-rphHyi1N1r8X5iK9OGuPyUG9PC7gWWsafg@mail.gmail.com>

Hi, all.

   I add a bloom filter struct into the netflow module, /ofproto/netflow.c.
Now I insert items into the bloom filter through command ovs-vsctl, as the
same way to update the parameters in netflow module, like active_timeout or
targets, etc.. But I find the parameters are written into the ovs database
first, under ovs-vsctl command, then sent to the netflow module, in which
the update throughput is too slow. Is there any way that I can add items
into my bloom filter directly and bypass the database? like the way to add
flow item into flow table? Many thanks.


+++++++++++++++++
Best,
Hao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150328/d3267db3/attachment.html>

From cvinllen at gmail.com  Sat Mar 28 18:38:11 2015
From: cvinllen at gmail.com (Vinllen Chen)
Date: Sun, 29 Mar 2015 09:38:11 +0800
Subject: [ovs-discuss] ovs vlan problem
Message-ID: <CAN2Qyzbho4E1Uf-1N79eCHCGSnUTxv7y0jN2n8ToDtguZpG1Kg@mail.gmail.com>

Hello, Dear all:
    I use ovs and mininet to build my net like this:
h1--s1--s2--h3
       |      |
      h2   h4
    And then i set the vlan tag:
ovs-vsctl set port s1-h1 tag=10
ovs-vsctl set port s1-h2 tag=20
    As a result, i can ping successfully between every two hosts as not
expected. Why different vlan tag can ping successfully? Greate appreciation
for anyone's reply.
Thanks,
Vinllen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150329/0f6557c3/attachment.html>

From Brian_Field at cable.comcast.com  Sun Mar 29 06:44:58 2015
From: Brian_Field at cable.comcast.com (Field, Brian)
Date: Sun, 29 Mar 2015 13:44:58 +0000
Subject: [ovs-discuss] CDP (cisco discovery protocol) packets being dropped
	by OVS
Message-ID: <D13D5DF9.318D7B%brian_field@cable.comcast.com>


I’ve noticed the CDP frames are being dropped by OVS:


# ovs-dpctl dump-flows

skb_priority(0),in_port(2),eth(src=52:54:00:d7:50:8e,dst=01:00:0c:cc:cc:cc),eth_type(0/0xffff), packets:0, bytes:0, used:never, actions:drop



In http://benpfaff.org/~blp/ovs-fields.pdf, it mentions “OpenFlow and Open vSwitch only support LLC headers with DSAP and SSAP 0xaa and control byte 0x03, which indicate that a SNAP header follows the LLC header. In turn, OpenFlow and Open vSwitch only support a SNAP header with organization 0x000000."


CDP frames use LLC/SNAP encapsulation with an organization code of (0xc).  So it would appear this is why CDP frames are being dropped by OVS.


Is the limitation to only support LLC/SNAP with org values of 0x0 a limitation imposed on OVS because OpenFlow doesn’t support or… ?


Thanks

Brian



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150329/db224144/attachment.html>

From amer7777 at hotmail.com  Sun Mar 29 11:26:40 2015
From: amer7777 at hotmail.com (Amer)
Date: Sun, 29 Mar 2015 21:26:40 +0300
Subject: [ovs-discuss] Flow-rules execution time
Message-ID: <BLU437-SMTP933DF402E5476AF6EA2840D4F60@phx.gbl>

Dear all

How to measure the execution time of flow-rules in openvswitch.
I want to compare between to settings: Openvswitch has 100 flow-rules and another openvswitch has 500 flow-rules.

Best regards,
Amer

From blp at nicira.com  Sun Mar 29 17:48:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 29 Mar 2015 17:48:28 -0700
Subject: [ovs-discuss] Flow-rules execution time
In-Reply-To: <BLU437-SMTP933DF402E5476AF6EA2840D4F60@phx.gbl>
References: <BLU437-SMTP933DF402E5476AF6EA2840D4F60@phx.gbl>
Message-ID: <20150330004828.GA23426@nicira.com>

On Sun, Mar 29, 2015 at 09:26:40PM +0300, Amer wrote:
> How to measure the execution time of flow-rules in openvswitch.  I
> want to compare between to settings: Openvswitch has 100 flow-rules
> and another openvswitch has 500 flow-rules.

What's the execution time of a flow?

From nick.bastin at gmail.com  Sun Mar 29 20:42:54 2015
From: nick.bastin at gmail.com (Nicholas Bastin)
Date: Sun, 29 Mar 2015 17:42:54 -1000
Subject: [ovs-discuss] Flow-rules execution time
In-Reply-To: <BLU437-SMTP933DF402E5476AF6EA2840D4F60@phx.gbl>
References: <BLU437-SMTP933DF402E5476AF6EA2840D4F60@phx.gbl>
Message-ID: <CADmMkWeKMBsmkSEpRHA6MHV9t=rjkN7Lh6YukAt6q-zpwMjF_g@mail.gmail.com>

On Sun, Mar 29, 2015 at 8:26 AM, Amer <amer7777 at hotmail.com> wrote:

> How to measure the execution time of flow-rules in openvswitch.
> I want to compare between to settings: Openvswitch has 100 flow-rules and
> another openvswitch has 500 flow-rules.
>

While I have no idea what "execution time of flow-rules" actually would be,
you can simply craft this experiment and test it.  Is there some issue with
that?

--
Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150329/ed0ec6ad/attachment.html>

From prashant.ietedelhi at gmail.com  Mon Mar 30 01:41:37 2015
From: prashant.ietedelhi at gmail.com (Prashant Singh)
Date: Mon, 30 Mar 2015 14:11:37 +0530
Subject: [ovs-discuss] Restricting not more than x gb file on the network.
Message-ID: <CABpZToX0TF_xfHfrVTiNecUb4Pa9bQdpFLs4+_ovsMe8_PsDjA@mail.gmail.com>

Hi
I wants to restrict the file size no more x GB is allowed to download from
the FTP server.  I have a FTP server at 1.1 and wants to restrict the host
1.2 not to download the file size greater than x GB, if file size is
greater than that the drop the packet. The switch is at 1.3 and port 1 is
connected to FTP server and 2 to host. Please help me.

Thanks & Regards
Prashant
Project Associate,
IIT DELHI
phone- 08447720406,
08010476362
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/5d722d11/attachment.html>

From amal.kammoun at supcom.tn  Mon Mar 30 02:40:37 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Mon, 30 Mar 2015 09:40:37 +0000
Subject: [ovs-discuss] searching for an advice + how to start OVS.
Message-ID: <1427708490339.91570@supcom.tn>

Hello!


1- I was trying to install openvswitch in a virtual machine (ubuntu 14.04 in virtualbox).

(I followed this page: https://github.com/openvswitch/ovs/blob/master/INSTALL.md ).


My choice of virtual box and ubuntu 14.04, is it good?


2- When I restart my VM, I try to use the ovs-vsctl command. But I have " data base connection failed".


What I have to do?


Thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/ad0b3f40/attachment.html>

From pichuang at cs.nctu.edu.tw  Mon Mar 30 03:18:08 2015
From: pichuang at cs.nctu.edu.tw (Ping Chun Huang)
Date: Mon, 30 Mar 2015 18:18:08 +0800
Subject: [ovs-discuss] searching for an advice + how to start OVS.
In-Reply-To: <1427708490339.91570@supcom.tn>
References: <1427708490339.91570@supcom.tn>
Message-ID: <CAJoNDx1BzYjGVk9p31uDZuujisiVz609aadQRv_gguzpUSc0LA@mail.gmail.com>

HI,

1. That's fine

2. You forgot to start ovsdb-server, try "/etc/init.d/ovsdb-server start"

pichuang, Ping-Chun Huang 黃秉鈞


Wireless Internet Laboratory
Computer Center, Department of Computer Science
National Chiao Tung University

2015-03-30 17:40 GMT+08:00 Amal KAMMOUN <amal.kammoun at supcom.tn>:

>  Hello!
>
>
>  1- I was trying to install openvswitch in a virtual machine (ubuntu
> 14.04 in virtualbox).
>
> (I followed this page:
> https://github.com/openvswitch/ovs/blob/master/INSTALL.md ).
>
>
>  My choice of virtual box and ubuntu 14.04, is it good?
>
>
>  2- When I restart my VM, I try to use the ovs-vsctl command. But I have
> " data base connection failed".
>
>
>  What I have to do?
>
>
>  Thank you!
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/5ccbbb34/attachment-0001.html>

From amal.kammoun at supcom.tn  Mon Mar 30 03:23:00 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Mon, 30 Mar 2015 10:23:00 +0000
Subject: [ovs-discuss] searching for an advice + how to start OVS.
In-Reply-To: <CAJoNDx1BzYjGVk9p31uDZuujisiVz609aadQRv_gguzpUSc0LA@mail.gmail.com>
References: <1427708490339.91570@supcom.tn>,
 <CAJoNDx1BzYjGVk9p31uDZuujisiVz609aadQRv_gguzpUSc0LA@mail.gmail.com>
Message-ID: <1427711033269.33606@supcom.tn>

Thank you for your response.


But when I try " /etc/init.d/ovsdb-server start ", I get "No such file or directory"!

________________________________
From: Ping Chun Huang <pichuang at cs.nctu.edu.tw>
Sent: Monday, March 30, 2015 10:18 AM
To: Amal KAMMOUN
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] searching for an advice + how to start OVS.

HI,

1. That's fine

2. You forgot to start ovsdb-server, try "/etc/init.d/ovsdb-server start"

pichuang, Ping-Chun Huang ???


Wireless Internet Laboratory
Computer Center, Department of Computer Science
National Chiao Tung University

2015-03-30 17:40 GMT+08:00 Amal KAMMOUN <amal.kammoun at supcom.tn<mailto:amal.kammoun at supcom.tn>>:

Hello!


1- I was trying to install openvswitch in a virtual machine (ubuntu 14.04 in virtualbox).

(I followed this page: https://github.com/openvswitch/ovs/blob/master/INSTALL.md ).


My choice of virtual box and ubuntu 14.04, is it good?


2- When I restart my VM, I try to use the ovs-vsctl command. But I have " data base connection failed".


What I have to do?


Thank you!

_______________________________________________
discuss mailing list
discuss at openvswitch.org<mailto:discuss at openvswitch.org>
http://openvswitch.org/mailman/listinfo/discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/54cf6667/attachment.html>

From gowrishankar.m at linux.vnet.ibm.com  Mon Mar 30 04:37:31 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Mon, 30 Mar 2015 17:07:31 +0530
Subject: [ovs-discuss] searching for an advice + how to start OVS.
In-Reply-To: <1427711033269.33606@supcom.tn>
References: <1427708490339.91570@supcom.tn>,
 <CAJoNDx1BzYjGVk9p31uDZuujisiVz609aadQRv_gguzpUSc0LA@mail.gmail.com>
 <1427711033269.33606@supcom.tn>
Message-ID: <5519357B.4080502@linux.vnet.ibm.com>

You may try "service openvswitch-switch start" and "service 
openvswitch-controller start"

Regards,
Gowrishankar

On Monday 30 March 2015 03:53 PM, Amal KAMMOUN wrote:
>
> Thank you for your response.
>
>
> But when I try " /etc/init.d/ovsdb-server start ", I get "No such file 
> or directory"!
>
> ------------------------------------------------------------------------
> *From:* Ping Chun Huang <pichuang at cs.nctu.edu.tw>
> *Sent:* Monday, March 30, 2015 10:18 AM
> *To:* Amal KAMMOUN
> *Cc:* discuss at openvswitch.org
> *Subject:* Re: [ovs-discuss] searching for an advice + how to start OVS.
> HI,
>
> 1. That's fine
>
> 2. You forgot to start ovsdb-server, try "/etc/init.d/ovsdb-server start"
>
> pichuang, Ping-Chun Huang 黃秉鈞
>
>
> Wireless Internet Laboratory
> Computer Center, Department of Computer Science
> National Chiao Tung University
>
> 2015-03-30 17:40 GMT+08:00 Amal KAMMOUN <amal.kammoun at supcom.tn 
> <mailto:amal.kammoun at supcom.tn>>:
>
>     Hello!
>
>
>     1- I was trying to install openvswitch in a virtual machine
>     (ubuntu 14.04 in virtualbox).
>
>     (I followed this page:
>     https://github.com/openvswitch/ovs/blob/master/INSTALL.md ).
>
>
>     My choice of virtual box and ubuntu 14.04, is it good?
>
>
>     2- When I restart my VM, I try to use the ovs-vsctl command. But I
>     have " data base connection failed".
>
>
>     What I have to do?
>
>
>     Thank you!
>
>
>     _______________________________________________
>     discuss mailing list
>     discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>     http://openvswitch.org/mailman/listinfo/discuss
>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


-- 
Regards,
Gowrishankar M
Linux Networking

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/a0f1d772/attachment.html>

From amal.kammoun at supcom.tn  Mon Mar 30 04:55:24 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Mon, 30 Mar 2015 11:55:24 +0000
Subject: [ovs-discuss] searching for an advice + how to start OVS.
In-Reply-To: <5519357B.4080502@linux.vnet.ibm.com>
References: <1427708490339.91570@supcom.tn>,
 <CAJoNDx1BzYjGVk9p31uDZuujisiVz609aadQRv_gguzpUSc0LA@mail.gmail.com>
 <1427711033269.33606@supcom.tn>,<5519357B.4080502@linux.vnet.ibm.com>
Message-ID: <1427716577253.18050@supcom.tn>

Hello!


For both I got unrecognized service.



________________________________
From: gowrishankar <gowrishankar.m at linux.vnet.ibm.com>
Sent: Monday, March 30, 2015 11:37 AM
To: Amal KAMMOUN
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] searching for an advice + how to start OVS.

You may try "service openvswitch-switch start" and "service openvswitch-controller start"

Regards,
Gowrishankar

On Monday 30 March 2015 03:53 PM, Amal KAMMOUN wrote:

Thank you for your response.


But when I try " /etc/init.d/ovsdb-server start ", I get "No such file or directory"!

________________________________
From: Ping Chun Huang <pichuang at cs.nctu.edu.tw><mailto:pichuang at cs.nctu.edu.tw>
Sent: Monday, March 30, 2015 10:18 AM
To: Amal KAMMOUN
Cc: discuss at openvswitch.org<mailto:discuss at openvswitch.org>
Subject: Re: [ovs-discuss] searching for an advice + how to start OVS.

HI,

1. That's fine

2. You forgot to start ovsdb-server, try "/etc/init.d/ovsdb-server start"

pichuang, Ping-Chun Huang ???


Wireless Internet Laboratory
Computer Center, Department of Computer Science
National Chiao Tung University

2015-03-30 17:40 GMT+08:00 Amal KAMMOUN <amal.kammoun at supcom.tn<mailto:amal.kammoun at supcom.tn>>:

Hello!


1- I was trying to install openvswitch in a virtual machine (ubuntu 14.04 in virtualbox).

(I followed this page: https://github.com/openvswitch/ovs/blob/master/INSTALL.md ).


My choice of virtual box and ubuntu 14.04, is it good?


2- When I restart my VM, I try to use the ovs-vsctl command. But I have " data base connection failed".


What I have to do?


Thank you!

_______________________________________________
discuss mailing list
discuss at openvswitch.org<mailto:discuss at openvswitch.org>
http://openvswitch.org/mailman/listinfo/discuss





_______________________________________________
discuss mailing list
discuss at openvswitch.org<mailto:discuss at openvswitch.org>
http://openvswitch.org/mailman/listinfo/discuss




--
Regards,
Gowrishankar M
Linux Networking
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/bb79e53d/attachment-0001.html>

From amal.kammoun at supcom.tn  Mon Mar 30 06:58:11 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Mon, 30 Mar 2015 13:58:11 +0000
Subject: [ovs-discuss] How to install OVS!
Message-ID: <1427723944633.67437@supcom.tn>


Hello!

I tried to install openvswitch in a virtual machine but I failed!

I followed this tutorial https://github.com/openvswitch/ovs/blob/master/INSTALL.md . Everything is fine and I could create a bridge. But when I restart my VM, I try to use the ovs-vsctl command. But I have " data base connection failed".

I try to start OVS with this commands : service openvswitch-switch start and /etc/init.d/ovsdb-server start, but I failed.

How can I install correctly openvswitch. I have to install it from ubuntu packages? it is the same?

Thank you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/75f83543/attachment.html>

From amer7777 at hotmail.com  Mon Mar 30 07:32:10 2015
From: amer7777 at hotmail.com (Amer)
Date: Mon, 30 Mar 2015 17:32:10 +0300
Subject: [ovs-discuss] Flow-rules execution time
In-Reply-To: <CADmMkWeKMBsmkSEpRHA6MHV9t=rjkN7Lh6YukAt6q-zpwMjF_g@mail.gmail.com>
References: <BLU437-SMTP933DF402E5476AF6EA2840D4F60@phx.gbl>
 <CADmMkWeKMBsmkSEpRHA6MHV9t=rjkN7Lh6YukAt6q-zpwMjF_g@mail.gmail.com>
Message-ID: <BLU437-SMTP2290880BF4F4DD523B5A22D4F50@phx.gbl>

Thank you
Done.

Sent from my iPhone

> On Mar 30, 2015, at 6:42 AM, Nicholas Bastin <nick.bastin at gmail.com> wrote:
> 
>> On Sun, Mar 29, 2015 at 8:26 AM, Amer <amer7777 at hotmail.com> wrote:
>> How to measure the execution time of flow-rules in openvswitch.
>> I want to compare between to settings: Openvswitch has 100 flow-rules and another openvswitch has 500 flow-rules.
> 
> While I have no idea what "execution time of flow-rules" actually would be, you can simply craft this experiment and test it.  Is there some issue with that?
> 
> --
> Nick 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/eac2a243/attachment.html>

From blp at nicira.com  Mon Mar 30 07:42:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 30 Mar 2015 07:42:44 -0700
Subject: [ovs-discuss] searching for an advice + how to start OVS.
In-Reply-To: <1427716577253.18050@supcom.tn>
References: <1427708490339.91570@supcom.tn>
 <CAJoNDx1BzYjGVk9p31uDZuujisiVz609aadQRv_gguzpUSc0LA@mail.gmail.com>
 <1427711033269.33606@supcom.tn>
 <5519357B.4080502@linux.vnet.ibm.com>
 <1427716577253.18050@supcom.tn>
Message-ID: <CACjuMbz28rsN3Mt4gXNLP87vTb3eGcO2A_EvSXZBHk7DxP48-Q@mail.gmail.com>

I guess that you did not install a startup script.  OVS comes with
suitable ones for various OSes.

On Mon, Mar 30, 2015 at 4:55 AM, Amal KAMMOUN <amal.kammoun at supcom.tn> wrote:
> Hello!
>
>
> For both I got unrecognized service.
>
>
>
> ________________________________
> From: gowrishankar <gowrishankar.m at linux.vnet.ibm.com>
> Sent: Monday, March 30, 2015 11:37 AM
>
> To: Amal KAMMOUN
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] searching for an advice + how to start OVS.
>
> You may try "service openvswitch-switch start" and "service
> openvswitch-controller start"
>
> Regards,
> Gowrishankar
>
> On Monday 30 March 2015 03:53 PM, Amal KAMMOUN wrote:
>
> Thank you for your response.
>
>
> But when I try " /etc/init.d/ovsdb-server start ", I get "No such file or
> directory"!
>
> ________________________________
> From: Ping Chun Huang <pichuang at cs.nctu.edu.tw>
> Sent: Monday, March 30, 2015 10:18 AM
> To: Amal KAMMOUN
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] searching for an advice + how to start OVS.
>
> HI,
>
> 1. That's fine
>
> 2. You forgot to start ovsdb-server, try "/etc/init.d/ovsdb-server start"
>
> pichuang, Ping-Chun Huang 黃秉鈞
>
>
> Wireless Internet Laboratory
> Computer Center, Department of Computer Science
> National Chiao Tung University
>
> 2015-03-30 17:40 GMT+08:00 Amal KAMMOUN <amal.kammoun at supcom.tn>:
>>
>> Hello!
>>
>>
>> 1- I was trying to install openvswitch in a virtual machine (ubuntu 14.04
>> in virtualbox).
>>
>> (I followed this page:
>> https://github.com/openvswitch/ovs/blob/master/INSTALL.md ).
>>
>>
>> My choice of virtual box and ubuntu 14.04, is it good?
>>
>>
>> 2- When I restart my VM, I try to use the ovs-vsctl command. But I have "
>> data base connection failed".
>>
>>
>> What I have to do?
>>
>>
>> Thank you!
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>
> --
> Regards,
> Gowrishankar M
> Linux Networking
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>



-- 
"I don't normally do acked-by's.  I think it's my way of avoiding
getting blamed when it all blows up."               Andrew Morton

From liu923526 at gmail.com  Mon Mar 30 00:20:44 2015
From: liu923526 at gmail.com (=?UTF-8?B?5YqJ55GL5Yex?=)
Date: Mon, 30 Mar 2015 15:20:44 +0800
Subject: [ovs-discuss] Question about Openvswitch
Message-ID: <CAHC2dCD8PR_3iJL=Zx+aCL-ggLLqdNQN=4cHhRrJ+7an=awgKQ@mail.gmail.com>

Hi,all
I want to generate a packet and send it out every 1 second.
How can I do it ?
Regards,
Liu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/39339ee4/attachment-0001.html>

From sanghamitra.de at gmail.com  Mon Mar 30 08:10:21 2015
From: sanghamitra.de at gmail.com (Sanghamitra De)
Date: Mon, 30 Mar 2015 20:40:21 +0530
Subject: [ovs-discuss] seeking help
In-Reply-To: <CAJoNDx1m2aYW311k4Qk2xXhhkD=TuMdHdh3qD97mX2i=a4mxzw@mail.gmail.com>
References: <CAG=b5B1ABsOKErQAw+d3FCmcmm3EW7hm8uoD_yK=jJ6A+9A6SA@mail.gmail.com>
 <7b6fb01.11fa4.14c5c47133e.Coremail.13520814722@126.com>
 <CAG=b5B3Q51k-htgjpddMDOE9+MvRN_K=he_FEZT1GLB4Ug5jwA@mail.gmail.com>
 <CAJoNDx1m2aYW311k4Qk2xXhhkD=TuMdHdh3qD97mX2i=a4mxzw@mail.gmail.com>
Message-ID: <CAG=b5B0QMEtozRBBVwD3p1vTNJsffE1Kr9iU0HL336PORjLEFg@mail.gmail.com>

Hi. Thank You for the reply. I went through vswitch.ovsschema.
Do i need tp make any change in vswitch.ovsschema?

If YES then what change do i need to make?

its a lengthy file. Can You kindly let me know the exact changes i need to
make?

Thank You & Regards
Sanghamitra De



On Sat, Mar 28, 2015 at 10:26 PM, Ping Chun Huang <pichuang at cs.nctu.edu.tw>
wrote:

> hi,
>
> Does any ovsdb schema in
> "/users/peertest/openvswitch-2.3.0/vswitchd/vswitch.ovsschema"? I think you
> loss that.
>
> if you want to find that, try to "locate vswitch.ovsschema"
>
>
> pichuang, Ping-Chun Huang 黃秉鈞
>
>
> Wireless Internet Laboratory
> Computer Center, Department of Computer Science
> National Chiao Tung University
>
> 2015-03-28 15:31 GMT+08:00 Sanghamitra De <sanghamitra.de at gmail.com>:
>
>> Hi,
>> Thanks for the reply.
>>
>>
>> I made the installation by the following commands:
>>
>> sudo mkdir /work
>> sudo chown `whoami` /work
>> cd /work
>>
>> ## Download, configure, compile, and install Open vSwitch.
>> wget http://openvswitch.org/releases/openvswitch-2.3.0.tar.gz
>> tar zxf openvswitch-2.3.0.tar.gz
>> cd openvswitch-2.3.0
>> ./configure
>> make
>> sudo make install
>>
>> sudo /sbin/modprobe openvswitch
>>
>>
>>
>>
>>
>> /sbin/lsmod
>>
>>
>>
>> ## Clean up.
>> cd /
>> sudo rm -rf /work
>>
>> ## Logout, used Emulab web interface to make a disk *image*. Then loaded
>> that image to the nodes where i wanted OVS to be loaded.
>>
>> Then the following commands were given:
>>
>>
>> #ovsdb-tool create /usr/local/etc/openvswitch/conf.db
>> /users/peertest/openvswitch-2.3.0/vswitchd/vswitch.ovsschema
>>
>> # ovsdb-server --remote=punix:/usr/local/var/run/openvswitch/db.sock \
>>
>>                  --remote=db:Open_vSwitch,Open_vSwitch,manager_options \
>>
>>                  --pidfile --detach
>>
>>
>>
>>  # ovs-vsctl --no-wait init
>>
>> sudo ovs-vswitchd --pidfile --detach --log-file
>>
>>
>> Then logged into a node which has OVS installed in the above way and gave:
>>
>> sudo ifconfig eth1 0
>>
>> sudo ifconfig eth2 0
>>
>>
>> #ovs-vsctl add-br br-int
>>
>> sudo ovs-vsctl add-br OVSbr1
>>
>> sudo ovs-vsctl add-br OVSbr2
>>
>>
>> Last 3 lines give error so to see the log file:
>>
>> cat /var/log/openvswitch/ovs-vswitchd.log
>>
>>
>>
>> Am I missing out something vital in the command? If so then Please let me know what will be the correct sequence of commands.
>>
>> I'm trying to do a couple of experiments by using a few nodes in Emulab. Of these 3 nodes will act as switches- so i am using the *image *(mentioned earlier) to install OVS in them. The nodes will talk to each other and switches will do the routing.  And here i am stuck with the OVS install. Next i got to write the controller.. Can you help me get the installation right?
>>
>>
>>
>> Thanks & Regards
>>
>> Sanghamitra De
>>
>>
>>
>>
>> On Fri, Mar 27, 2015 at 10:58 PM, Kris <13520814722 at 126.com> wrote:
>>
>>> How did you install the ovs? It seems your installation is not correct.
>>>
>>>
>>> KRIS
>>>
>>>
>>> On 2015-03-28 01:02 , Sanghamitra De <sanghamitra.de at gmail.com> Wrote:
>>>
>>> Hi,
>>>
>>> the log file screenshot is attached.
>>>
>>> the following errors continue on trying the following lines:
>>>
>>>
>>> #ovs-vsctl add-br br-int
>>> ovs-vsctl: Error detected while setting up 'br-int'. See ovs-vswitchd
>>> log for details
>>>
>>> # ovs-vsctl add-br br0
>>> ovs-vsctl: Error detected while setting up 'br0'. See ovs-vswitchd log
>>> for details
>>>
>>> # ovs-vsctl add-br br1
>>> ovs-vsctl: Error detected while setting up 'br1'. See ovs-vswitchd log
>>> for details
>>>
>>> why is there problem while trying to create br-int or br0, br1 for that
>>> matter?
>>>
>>>
>>> Thanks & Regards
>>> Sanghamitra De
>>>
>>>
>>>
>>> 来自网易手机号码邮箱了解更多 <http://shouji.163.com>
>>>
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/1f4b3b07/attachment-0001.html>

From blp at nicira.com  Mon Mar 30 09:42:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 30 Mar 2015 09:42:55 -0700
Subject: [ovs-discuss] CDP (cisco discovery protocol) packets being
 dropped by OVS
In-Reply-To: <D13D5DF9.318D7B%brian_field@cable.comcast.com>
References: <D13D5DF9.318D7B%brian_field@cable.comcast.com>
Message-ID: <20150330164255.GD16645@nicira.com>

On Sun, Mar 29, 2015 at 01:44:58PM +0000, Field, Brian wrote:
> I’ve noticed the CDP frames are being dropped by OVS:
> 
> 
> # ovs-dpctl dump-flows
> 
> skb_priority(0),in_port(2),eth(src=52:54:00:d7:50:8e,dst=01:00:0c:cc:cc:cc),eth_type(0/0xffff), packets:0, bytes:0, used:never, actions:drop
> 
> 
> 
> In http://benpfaff.org/~blp/ovs-fields.pdf, it mentions “OpenFlow and Open vSwitch only support LLC headers with DSAP and SSAP 0xaa and control byte 0x03, which indicate that a SNAP header follows the LLC header. In turn, OpenFlow and Open vSwitch only support a SNAP header with organization 0x000000."
> 
> 
> CDP frames use LLC/SNAP encapsulation with an organization code of (0xc).  So it would appear this is why CDP frames are being dropped by OVS.

No.  I expect it's because forward-bpdu is disabled.  Please see
ovs-vswitchd.conf.db(5) for details.

> Is the limitation to only support LLC/SNAP with org values of 0x0 a limitation imposed on OVS because OpenFlow doesn’t support or… ?

It is true that OpenFlow does not support this, but the reason is
primarily that no one has found this important enough to implement.

For CDP, for example, you can alternatively match on the destination
Ethernet address, which is 01:00:0c:cc:cc:cc for CDP.

From blp at nicira.com  Mon Mar 30 09:59:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 30 Mar 2015 09:59:02 -0700
Subject: [ovs-discuss] Can I add parameters to NetFlow module bypassing
 the database?
In-Reply-To: <CAHmvmjEys5_ZJu0-rphHyi1N1r8X5iK9OGuPyUG9PC7gWWsafg@mail.gmail.com>
References: <CAHmvmjEys5_ZJu0-rphHyi1N1r8X5iK9OGuPyUG9PC7gWWsafg@mail.gmail.com>
Message-ID: <20150330165902.GF16645@nicira.com>

On Sat, Mar 28, 2015 at 02:06:54PM -0700, Hao Wu wrote:
>    I add a bloom filter struct into the netflow module, /ofproto/netflow.c.
> Now I insert items into the bloom filter through command ovs-vsctl, as the
> same way to update the parameters in netflow module, like active_timeout or
> targets, etc.. But I find the parameters are written into the ovs database
> first, under ovs-vsctl command, then sent to the netflow module, in which
> the update throughput is too slow. Is there any way that I can add items
> into my bloom filter directly and bypass the database? like the way to add
> flow item into flow table? Many thanks.

You can add support through OpenFlow messages.  See the FAQ for a
starting point:

### Q: How do I implement a new OpenFlow message?

A: Add your new message to "enum ofpraw" and "enum ofptype" in
   lib/ofp-msgs.h, following the existing pattern.  Then recompile and
   fix all of the new warnings, implementing new functionality for the
   new message as needed.  (If you configure with --enable-Werror, as
   described in [INSTALL.md], then it is impossible to miss any warnings.)

   If you need to add an OpenFlow vendor extension message for a
   vendor that doesn't yet have any extension messages, then you will
   also need to edit build-aux/extract-ofp-msgs.

From jpettit at nicira.com  Mon Mar 30 10:44:29 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 30 Mar 2015 10:44:29 -0700
Subject: [ovs-discuss] Question about Openvswitch
In-Reply-To: <CAHC2dCD8PR_3iJL=Zx+aCL-ggLLqdNQN=4cHhRrJ+7an=awgKQ@mail.gmail.com>
References: <CAHC2dCD8PR_3iJL=Zx+aCL-ggLLqdNQN=4cHhRrJ+7an=awgKQ@mail.gmail.com>
Message-ID: <DF3BED5B-6DD9-4195-836A-3821A0A9A405@nicira.com>


> On Mar 30, 2015, at 12:20 AM, 劉瑋凱 <liu923526 at gmail.com> wrote:
> 
> Hi,all
> I want to generate a packet and send it out every 1 second.
> How can I do it ?

It depends on what you're trying to do.  If it's baked-in switch functionality, you can find examples in the code of doing similar things (e.g., STP, CFM, BFD).  However, many applications would implement it through a controller that send packet-out OpenFlow messages.

--Justin



From a.n.chippa at gmail.com  Mon Mar 30 15:10:05 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Mon, 30 Mar 2015 15:10:05 -0700
Subject: [ovs-discuss] set-controller per table?
In-Reply-To: <20150327151754.GA3905@nicira.com>
References: <CABFtFwmSuPUbDPpy13iVhDHRO4n_yscHVhwnY1tPeJfR=jkLcQ@mail.gmail.com>
 <20150326205640.GA16976@nicira.com>
 <CABFtFw=A41V+Laov5DHDfWbtKNwv8-K5m1LjfbOXLggqPyyZaA@mail.gmail.com>
 <20150327151754.GA3905@nicira.com>
Message-ID: <CABFtFwmQqKkPiJJztO=pMJRywXYHJP8mL58BxgH48_Kytgvgnw@mail.gmail.com>

Hi Ben et al.,

Thank you for your answer.

Couple of quick ones: 1) Are there names for these extensions and how do I
get them?
                                    2) Could you tell me the ETA of ovs 2.4
(with conntrack support)?

Thanks.

On Fri, Mar 27, 2015 at 8:17 AM, Ben Pfaff <blp at nicira.com> wrote:

> You can do that by using the Open vSwitch extension that allows packets
> to be directed to a particular controller.  With ovs-ofctl, the syntax
> is "controller(id=<controller-id>)".  The controller must let the switch
> know its controller number through a separate extension.
>
> On Thu, Mar 26, 2015 at 11:34:40PM -0700, Ashok Chippa wrote:
> > Can I have TableX punt packets to controller 1, and TableY punt packets
> to
> > controller 2? In a table flow, if the action is "controller" which
> > controller does it send the packets to, in case there are multiple
> > controllers?
> >
> > Thanks
> >
> > On Thu, Mar 26, 2015 at 1:56 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Thu, Mar 26, 2015 at 12:37:04PM -0700, Ashok Chippa wrote:
> > > > As I understand, today openvswitch supports multiple controllers,
> but not
> > > > on a per table basis.
> > >
> > > What's a per-table controller and how is it different from an OpenFlow
> > > controller?
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/3af09b48/attachment.html>

From blp at nicira.com  Mon Mar 30 15:14:07 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 30 Mar 2015 15:14:07 -0700
Subject: [ovs-discuss] set-controller per table?
In-Reply-To: <CABFtFwmQqKkPiJJztO=pMJRywXYHJP8mL58BxgH48_Kytgvgnw@mail.gmail.com>
References: <CABFtFwmSuPUbDPpy13iVhDHRO4n_yscHVhwnY1tPeJfR=jkLcQ@mail.gmail.com>
 <20150326205640.GA16976@nicira.com>
 <CABFtFw=A41V+Laov5DHDfWbtKNwv8-K5m1LjfbOXLggqPyyZaA@mail.gmail.com>
 <20150327151754.GA3905@nicira.com>
 <CABFtFwmQqKkPiJJztO=pMJRywXYHJP8mL58BxgH48_Kytgvgnw@mail.gmail.com>
Message-ID: <20150330221407.GA15101@nicira.com>

On Mon, Mar 30, 2015 at 03:10:05PM -0700, Ashok Chippa wrote:
> Couple of quick ones: 1) Are there names for these extensions and how do I
> get them?

NXAST_CONTROLLER.  Read ovs-ofctl(8), see lib/ofp-actions.c

>                                     2) Could you tell me the ETA of ovs 2.4
> (with conntrack support)?

As soon as conntrack support gets into the kernel module.

From a.n.chippa at gmail.com  Mon Mar 30 15:57:36 2015
From: a.n.chippa at gmail.com (Ashok Chippa)
Date: Mon, 30 Mar 2015 15:57:36 -0700
Subject: [ovs-discuss] set-controller per table?
In-Reply-To: <20150330221407.GA15101@nicira.com>
References: <CABFtFwmSuPUbDPpy13iVhDHRO4n_yscHVhwnY1tPeJfR=jkLcQ@mail.gmail.com>
 <20150326205640.GA16976@nicira.com>
 <CABFtFw=A41V+Laov5DHDfWbtKNwv8-K5m1LjfbOXLggqPyyZaA@mail.gmail.com>
 <20150327151754.GA3905@nicira.com>
 <CABFtFwmQqKkPiJJztO=pMJRywXYHJP8mL58BxgH48_Kytgvgnw@mail.gmail.com>
 <20150330221407.GA15101@nicira.com>
Message-ID: <CABFtFw=kngN29pMUMPy7xCZPVPEs+TP2OznSevo7YgW44eU=pQ@mail.gmail.com>

Thanks :) Appreciate it.

On Mon, Mar 30, 2015 at 3:14 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Mon, Mar 30, 2015 at 03:10:05PM -0700, Ashok Chippa wrote:
> > Couple of quick ones: 1) Are there names for these extensions and how do
> I
> > get them?
>
> NXAST_CONTROLLER.  Read ovs-ofctl(8), see lib/ofp-actions.c
>
> >                                     2) Could you tell me the ETA of ovs
> 2.4
> > (with conntrack support)?
>
> As soon as conntrack support gets into the kernel module.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150330/45205ad0/attachment.html>

From shettyg at nicira.com  Mon Mar 30 19:32:34 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 30 Mar 2015 19:32:34 -0700
Subject: [ovs-discuss] Is it possible to limit bandwidth for particular
 OVS port?
In-Reply-To: <CABJqVczSa8_ApJpa8_1uiKgk+U+w6rbYbRsFq0Gutx2YRTax1A@mail.gmail.com>
References: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>
 <CAHbON5rPDLZSxv0VD411kAPbNuJcT=_so+D6go3vRnu9mk8tEA@mail.gmail.com>
 <CABJqVcz_J5D8cJsFJ=zcw21dMQXCrETosYofE6VYhE3i4+7aUw@mail.gmail.com>
 <CAHbON5oTeRsW1km25ip5bTuBCQGvpWdU5-6tzSUe0bn06BXp9Q@mail.gmail.com>
 <CABJqVcwoTddoqSbLuOO4Uxzob3phK9pU=q-UPkW=91st9yB6oQ@mail.gmail.com>
 <CAHbON5oe=bTVLOULo8pWMM=dEhrDZQkfYVxtuOU7Wm5feo91ig@mail.gmail.com>
 <CABJqVczSa8_ApJpa8_1uiKgk+U+w6rbYbRsFq0Gutx2YRTax1A@mail.gmail.com>
Message-ID: <CAHbON5piUo7SHeYG1RNAvt-NYP_TeqMsncZju+sFLnatQX3cYA@mail.gmail.com>

On Mon, Mar 30, 2015 at 7:19 PM, Tim Bagr <timbgr at gmail.com> wrote:
> Thanks for the reply!
>
> Good news for now. I've tried the same config with another (non-egress) port
> of my OVS switch br3 and now the queue is actually working.
I see  vnet0 as an egress port in this context.
>
>
> # ovs-vsctl set port vnet0 qos=@nqos -- --id=@nqos create qos type=linux-htb
> other-config:max-rate=10000000 queues=123=@q1 -- --id=@q1 create queue
> other-config:max-rate=1000
> 55bb4a0f-d818-4292-91cc-ba6a5c3e4d66
> 5858733e-d6a0-4324-89fb-af9526fe4768
>
> vnet0 here is port where guest VM is connected
>
> # ovs-ofctl show br3
> OFPT_FEATURES_REPLY (xid=0x2): dpid:00007a42d1ca7e05
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
> SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>  3(b2p): addr:ae:a4:9d:8b:9f:a9
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
>  7(vnet0): addr:fe:54:00:ac:e1:a6
>      config:     0
>      state:      0
>      current:    10MB-FD COPPER
>      speed: 10 Mbps now, 0 Mbps max
>  8(vnet1): addr:fe:54:00:9b:d9:a1
>      config:     0
>      state:      0
>      current:    10MB-FD COPPER
>      speed: 10 Mbps now, 0 Mbps max
>  LOCAL(br3): addr:7a:42:d1:ca:7e:05
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>
>
> # ovs-ofctl add-flow br3
> "priority=10,ip,ip_src=10.1.0.1,ip_dst=192.168.126.177,actions=enqueue:7:123"
You are outputting to a port which is not br3 above. So this is
different than the previous use case.

>
> Where 10.1.0.1 is the outer PC which the guest VM pings. And 192.168.126.177
> is the guest VM IP
>
> [root at VM ~]# ping 10.1.0.1 -i 0.1 -s 250
> PING 10.1.0.1 (10.1.0.1) 250(278) bytes of data.
> 258 bytes from 10.1.0.1: icmp_seq=1 ttl=63 time=0.350 ms
> 258 bytes from 10.1.0.1: icmp_seq=2 ttl=63 time=0.195 ms
> 258 bytes from 10.1.0.1: icmp_seq=3 ttl=63 time=0.205 ms
> 258 bytes from 10.1.0.1: icmp_seq=4 ttl=63 time=0.192 ms
> 258 bytes from 10.1.0.1: icmp_seq=5 ttl=63 time=0.202 ms
> 258 bytes from 10.1.0.1: icmp_seq=6 ttl=63 time=0.216 ms
> 258 bytes from 10.1.0.1: icmp_seq=7 ttl=63 time=0.215 ms
> 258 bytes from 10.1.0.1: icmp_seq=8 ttl=63 time=0.187 ms
> 258 bytes from 10.1.0.1: icmp_seq=9 ttl=63 time=0.178 ms
> 258 bytes from 10.1.0.1: icmp_seq=10 ttl=63 time=0.207 ms
> 258 bytes from 10.1.0.1: icmp_seq=11 ttl=63 time=0.229 ms
> 258 bytes from 10.1.0.1: icmp_seq=12 ttl=63 time=0.189 ms
> 258 bytes from 10.1.0.1: icmp_seq=13 ttl=63 time=93.4 ms
> 258 bytes from 10.1.0.1: icmp_seq=14 ttl=63 time=188 ms
> 258 bytes from 10.1.0.1: icmp_seq=15 ttl=63 time=274 ms
> 258 bytes from 10.1.0.1: icmp_seq=16 ttl=63 time=370 ms
> 258 bytes from 10.1.0.1: icmp_seq=17 ttl=63 time=454 ms
> 258 bytes from 10.1.0.1: icmp_seq=18 ttl=63 time=547 ms
> 258 bytes from 10.1.0.1: icmp_seq=19 ttl=63 time=633 ms
> 258 bytes from 10.1.0.1: icmp_seq=20 ttl=63 time=727 ms
> 258 bytes from 10.1.0.1: icmp_seq=21 ttl=63 time=812 ms
> 258 bytes from 10.1.0.1: icmp_seq=22 ttl=63 time=907 ms
> 258 bytes from 10.1.0.1: icmp_seq=23 ttl=63 time=992 ms
> 258 bytes from 10.1.0.1: icmp_seq=24 ttl=63 time=1085 ms
> 258 bytes from 10.1.0.1: icmp_seq=25 ttl=63 time=1170 ms
> 258 bytes from 10.1.0.1: icmp_seq=26 ttl=63 time=1265 ms
> 258 bytes from 10.1.0.1: icmp_seq=27 ttl=63 time=1352 ms
>
> As we can see - the flow is actually working!
>
> # ovs-ofctl dump-flows br3
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=598.125s, table=0, n_packets=438, n_bytes=119562,
> idle_age=9, priority=0 actions=NORMAL
>  cookie=0x0, duration=53.638s, table=0, n_packets=250, n_bytes=49850,
> idle_age=13, priority=10,ip,nw_src=10.1.0.1,nw_dst=192.168.126.177
> actions=enqueue:7:123
>
>
>
> But I still wonder why It was not working when set QoS for br3 port?

From timbgr at gmail.com  Mon Mar 30 19:19:07 2015
From: timbgr at gmail.com (Tim Bagr)
Date: Tue, 31 Mar 2015 06:19:07 +0400
Subject: [ovs-discuss] Is it possible to limit bandwidth for particular
 OVS port?
In-Reply-To: <CAHbON5oe=bTVLOULo8pWMM=dEhrDZQkfYVxtuOU7Wm5feo91ig@mail.gmail.com>
References: <CABJqVcw5RhrghH47S45oxshp5j1OnsBYou25ywcxsyCn9i=Y0g@mail.gmail.com>
 <CAHbON5rPDLZSxv0VD411kAPbNuJcT=_so+D6go3vRnu9mk8tEA@mail.gmail.com>
 <CABJqVcz_J5D8cJsFJ=zcw21dMQXCrETosYofE6VYhE3i4+7aUw@mail.gmail.com>
 <CAHbON5oTeRsW1km25ip5bTuBCQGvpWdU5-6tzSUe0bn06BXp9Q@mail.gmail.com>
 <CABJqVcwoTddoqSbLuOO4Uxzob3phK9pU=q-UPkW=91st9yB6oQ@mail.gmail.com>
 <CAHbON5oe=bTVLOULo8pWMM=dEhrDZQkfYVxtuOU7Wm5feo91ig@mail.gmail.com>
Message-ID: <CABJqVczSa8_ApJpa8_1uiKgk+U+w6rbYbRsFq0Gutx2YRTax1A@mail.gmail.com>

Thanks for the reply!

Good news for now. I've tried the same config with another (non-egress)
port of my OVS switch *br3* and now the queue is actually working.


*# ovs-vsctl set port vnet0 qos=@nqos -- --id=@nqos create qos
type=linux-htb other-config:max-rate=10000000 queues=123=@q1 --
--id=@q1 create queue other-config:max-rate=1000*
55bb4a0f-d818-4292-91cc-ba6a5c3e4d66
5858733e-d6a0-4324-89fb-af9526fe4768

vnet0 here is port where guest VM is connected

*# ovs-ofctl show br3*
OFPT_FEATURES_REPLY (xid=0x2): dpid:00007a42d1ca7e05
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC
SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST
ENQUEUE
 3(b2p): addr:ae:a4:9d:8b:9f:a9
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max* 7(vnet0): addr:fe:54:00:ac:e1:a6*
     config:     0
     state:      0
     current:    10MB-FD COPPER
     speed: 10 Mbps now, 0 Mbps max
 8(vnet1): addr:fe:54:00:9b:d9:a1
     config:     0
     state:      0
     current:    10MB-FD COPPER
     speed: 10 Mbps now, 0 Mbps max
 LOCAL(br3): addr:7a:42:d1:ca:7e:05
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0


*# ovs-ofctl add-flow br3
"priority=10,ip,ip_src=10.1.0.1,ip_dst=192.168.126.177,actions=enqueue:7:123"*

Where 10.1.0.1 is the outer PC which the guest VM pings. And
192.168.126.177 is the guest VM IP

*[root at VM ~]# ping 10.1.0.1 -i 0.1 -s 250*
PING 10.1.0.1 (10.1.0.1) 250(278) bytes of data.
258 bytes from 10.1.0.1: icmp_seq=1 ttl=63 time=0.350 ms
258 bytes from 10.1.0.1: icmp_seq=2 ttl=63 time=0.195 ms
258 bytes from 10.1.0.1: icmp_seq=3 ttl=63 time=0.205 ms
258 bytes from 10.1.0.1: icmp_seq=4 ttl=63 time=0.192 ms
258 bytes from 10.1.0.1: icmp_seq=5 ttl=63 time=0.202 ms
258 bytes from 10.1.0.1: icmp_seq=6 ttl=63 time=0.216 ms
258 bytes from 10.1.0.1: icmp_seq=7 ttl=63 time=0.215 ms
258 bytes from 10.1.0.1: icmp_seq=8 ttl=63 time=0.187 ms
258 bytes from 10.1.0.1: icmp_seq=9 ttl=63 time=0.178 ms
258 bytes from 10.1.0.1: icmp_seq=10 ttl=63 time=0.207 ms
258 bytes from 10.1.0.1: icmp_seq=11 ttl=63 time=0.229 ms
258 bytes from 10.1.0.1: icmp_seq=12 ttl=63 time=0.189 ms
258 bytes from 10.1.0.1: icmp_seq=13 ttl=63 time=93.4 ms
258 bytes from 10.1.0.1: icmp_seq=14 ttl=63 time=188 ms
258 bytes from 10.1.0.1: icmp_seq=15 ttl=63 time=274 ms
258 bytes from 10.1.0.1: icmp_seq=16 ttl=63 time=370 ms
258 bytes from 10.1.0.1: icmp_seq=17 ttl=63 time=454 ms
258 bytes from 10.1.0.1: icmp_seq=18 ttl=63 time=547 ms
258 bytes from 10.1.0.1: icmp_seq=19 ttl=63 time=633 ms
258 bytes from 10.1.0.1: icmp_seq=20 ttl=63 time=727 ms
258 bytes from 10.1.0.1: icmp_seq=21 ttl=63 time=812 ms
258 bytes from 10.1.0.1: icmp_seq=22 ttl=63 time=907 ms
258 bytes from 10.1.0.1: icmp_seq=23 ttl=63 time=992 ms
258 bytes from 10.1.0.1: icmp_seq=24 ttl=63 time=1085 ms
258 bytes from 10.1.0.1: icmp_seq=25 ttl=63 time=1170 ms
258 bytes from 10.1.0.1: icmp_seq=26 ttl=63 time=1265 ms
258 bytes from 10.1.0.1: icmp_seq=27 ttl=63 time=1352 ms

As we can see - the flow is actually working!

*# ovs-ofctl dump-flows br3*
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=598.125s, table=0, n_packets=438,
n_bytes=119562, idle_age=9, priority=0 actions=NORMAL
 cookie=0x0, duration=53.638s, table=0, n_packets=250, n_bytes=49850,
idle_age=13, priority=10,ip,nw_src=10.1.0.1,nw_dst=192.168.126.177
actions=enqueue:7:123



But I still wonder why It was not working when set QoS for *br3* port?

On Fri, Mar 27, 2015 at 6:46 PM, Gurucharan Shetty <shettyg at nicira.com>
wrote:

> On Thu, Mar 26, 2015 at 6:35 PM, Tim Bagr <timbgr at gmail.com> wrote:
> > Thanks for your reply! It helps a lot. I didn't use tc before. I just
> > watched at large ping packets and if they are delayed progressively -
> then I
> > concluded QoS is actually working.
> >
> > I tried again with patch-port and you're right.
> > # tc class show dev b2p
> > had shown nothing.
> >
> > So I tried to do the trick with LOCAL interface again, which is the same
> > name as name of bridge, in my case "br3".
> >
> > # ovs-vsctl set port br3 qos=@nqos -- --id=@nqos create qos
> type=linux-htb
> > other-config:max-rate=100000 queues=111=@nq -- --id=@nq create queue
> > other-config:max-rate=13000
> >
> > And then, tried to alter max-rate for QoS object:
> > # ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
> > other-config:max-rate=100000
> > # ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
> > other-config:max-rate=10000
> > # ovs-vsctl set qos cbba20c1-9afb-4092-ad37-628d70ce2139
> > other-config:max-rate=1000000
> >
> > And after each command I've sent pings from VM to outside network, and
> see
> > if they are limited. The values actually worked - when I set rate 10000,
> for
> > example, then pings from VM looked like:
> > [root at VM ~]# ping -i 0.1 outside.host -s 500
> > PING outside.host (10.1.1.168) 500(528) bytes of data.
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=1 ttl=63 time=0.242 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=2 ttl=63 time=0.270 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=3 ttl=63 time=0.224 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=4 ttl=63 time=67.7 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=5 ttl=63 time=85.7 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=6 ttl=63 time=75.3 ms
> > ^C508 bytes from 10.1.1.168: icmp_seq=7 ttl=63 time=84.8 ms
> >
> > And when I set rate about max-rate=100000000 then pings went flawlessly:
> >
> > [root at localhost ~]# ping -i 0.1 outside.host -s 500
> > PING outside.host (10.1.1.168) 500(528) bytes of data.
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=1 ttl=63 time=0.270 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=2 ttl=63 time=0.201 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=3 ttl=63 time=0.256 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=4 ttl=63 time=0.249 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=5 ttl=63 time=0.203 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=6 ttl=63 time=0.224 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=7 ttl=63 time=0.216 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=8 ttl=63 time=0.217 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=9 ttl=63 time=0.226 ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=10 ttl=63 time=0.204
> ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=11 ttl=63 time=0.227
> ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=12 ttl=63 time=0.220
> ms
> > 508 bytes from outside.host (10.1.1.168): icmp_seq=13 ttl=63 time=0.260
> ms
> >
> >
> >
> > Then I set openflow rules to assign queue number to specific traffic
> (with
> > src and dst address equal to that otside.host, which I send ping requests
> > to):
> >
> > The rules are matched and n_packets grown when I sent pings:
> > # ovs-ofctl dump-flows br3 --sort=priority
> >  cookie=0x0, duration=155295.034s, table=0, n_packets=12692,
> > n_bytes=6188205, priority=0 actions=NORMAL
> >  cookie=0x0, duration=482.039s, table=0, n_packets=112, n_bytes=116704,
> > priority=15,ip,nw_src=10.1.1.168 actions=set_queue:111,NORMAL
> >  cookie=0x0, duration=531.879s, table=0, n_packets=259, n_bytes=269878,
> > priority=15,ip,nw_dst=10.1.1.168 actions=set_queue:111,NORMAL
> >  cookie=0x0, duration=420.512s, table=0, n_packets=640, n_bytes=751480,
> > priority=20,ip,nw_src=10.1.1.168 actions=enqueue:6:111
> >  cookie=0x0, duration=347.242s, table=0, n_packets=573, n_bytes=681666,
> > priority=20,ip,nw_dst=10.1.1.168 actions=enqueue:LOCAL:111
> >
> > But tc command shown that queue (as I suppose it's 1:70, is not active
> > against that traffic):
> > # tc -s class show dev br3
> > class htb 1:1 parent 1:fffe prio 0 rate 12000bit ceil 1000Kbit burst
> 1563b
> > cburst 1564b
> >  Sent 92820 bytes 128 pkt (dropped 0, overlimits 0 requeues 0)
> >  rate 0bit 0pps backlog 0b 0p requeues 0
> >  lended: 8 borrowed: 120 giants: 0
> >  tokens: 15854166 ctokens: 190250
> When you do the above, ping, you can look at the actual kernel
> datapath flows with a 'ovs-dpctl dump-flows'. You will see a flow of
> the following form (my ip addresses are different):
>
>
> recirc_id(0),skb_priority(0),in_port(1),eth(src=00:0c:29:d6:c0:2e,dst=00:0c:29:23:ee:7f),eth_type(0x0800),ipv4(src=
> 192.168.1.1/255.255.255.255,dst=192.168.1.2/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff
> ),
> packets:5, bytes:490, used:0.212s,
> actions:set(skb_priority(0x10070)),2
>
> The set(skb_priority(0x10070)),2 is the actual marking of packets to
> go to queue 70 (decimal 111, I think).
> So my take is that the packet has been marked and sent to output port
> 2 (in my case eth1). But since the queue is only in br3, I think it
> never gets hit.
>
> This is unchartered territory for me. My reading is that QoS can only
> be applied on the egress port.
>
>
>
>
>
> >
> > class htb 1:fffe root rate 1000Kbit ceil 1000Kbit burst 1500b cburst
> 1500b
> >  Sent 92820 bytes 128 pkt (dropped 0, overlimits 0 requeues 0)
> >  rate 0bit 0pps backlog 0b 0p requeues 0
> >  lended: 120 borrowed: 0 giants: 0
> >  tokens: 182250 ctokens: 182250
> >
> > class htb 1:70 parent 1:fffe prio 0 rate 12000bit ceil 13000bit burst
> 1563b
> > cburst 1563b
> >  Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0)
> >  rate 0bit 0pps backlog 0b 0p requeues 0
> >  lended: 0 borrowed: 0 giants: 0
> >  tokens: 16291666 ctokens: 15038461
> >
> >
> > Maybe it's some undiscovered bug? Or it works so just by design?
> >
> >
> >
> >
> >
> >
> >
> > On Thu, Mar 26, 2015 at 7:44 PM, Gurucharan Shetty <shettyg at nicira.com>
> > wrote:
> >>
> >> On Wed, Mar 25, 2015 at 7:03 PM, Tim Bagr <timbgr at gmail.com> wrote:
> >> > Hello Gurucharan,
> >> >
> >> > Thanks for the reply.
> >> >
> >> > I have no physical ports attached to that OVS bridge. My intention was
> >> > exactly to limit bandwidth for br3 port (i.e. openflow keyword LOCAL),
> >> > and
> >> > another try was to limit bandwidth for internal patch-port, which
> >> > connects
> >> > br3 bridge with br2 bridge. In both bridges there are VMs attached and
> >> > they
> >> > may communicate with each other through the patch-port.
> >> >
> >> > # ovs-vsctl show
> >> > b11e83cb-d741-4a59-90f7-ea9693d508cf
> >> >     Bridge "br2"
> >> >         Port "b3p"
> >> >             Interface "b3p"
> >> >                 type: patch
> >> >                 options: {peer="b2p"}
> >> >         Port "vnet1"
> >> >             Interface "vnet1"
> >> >         Port "br2"
> >> >             Interface "br2"
> >> >                 type: internal
> >> >     Bridge "br3"
> >> >         Port "br3"
> >> >             Interface "br3"
> >> >                 type: internal
> >> >         Port "vnet0"
> >> >             Interface "vnet0"
> >> >         Port "b2p"
> >> >             Interface "b2p"
> >> >                 type: patch
> >> >                 options: {peer="b3p"}
> >> >
> >> > Here vnet1 is port of 1st VM and vnet0 is port of 2nd VM. Now I just
> >> > want to
> >> > limit bandwidth from VM2 to VM1.
> >> > So I run:
> >> > # ovs-vsctl set Port b2p qos=@newq -- --id=@newq create qos
> >> > type=linux-htb
> >> > other-config:max-rate=100000000 queues=111=@q1 -- --id=@q1 create
> queue
> >> > other-config:min-rate=0 other-config:max-rate=10
> >> > 65c5488d-2066-4d97-b21f-ba369a8b2920
> >> > 1e3726b4-12e2-4184-b8e4-13f9c692095f
> >> I _think_(not 100% sure) that you cannot apply QoS on a patch port.
> >> Patch port has no netdevice backing it. OVS uses Linux tc to apply
> >> QoS. Since tc cannot see the OVS patch port, I don't think anything
> >> will come out of it.
> >>
> >> The way to verify that QoS is really working is to look at tc stats
> >> for that queue. e.g: If you had applied QoS on eth1 with 3 queues: 1,
> >> 2, 3, you will get:
> >>
> >> sudo tc class show dev eth1
> >> class htb 1:fffe root rate 900000Kbit ceil 900000Kbit burst 1462b cburst
> >> 1462b
> >> class htb 1:1 parent 1:fffe prio 0 rate 720000Kbit ceil 900000Kbit
> >> burst 1530b cburst 1462b
> >> class htb 1:2 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
> >> 1563b cburst 1563b
> >> class htb 1:3 parent 1:fffe prio 0 rate 12000bit ceil 90000Kbit burst
> >> 1563b cburst 1563b
> >>
> >> For statistics: (to see how many packets went through etc)
> >> tc -s class show dev eth1
> >>
> >>
> >>
> >> >
> >> > # ovs-ofctl show br3
> >> > OFPT_FEATURES_REPLY (xid=0x2): dpid:00007a42d1ca7e05
> >> > n_tables:254, n_buffers:256
> >> > capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS
> ARP_MATCH_IP
> >> > actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC
> >> > SET_DL_DST
> >> > SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
> >> >  3(b2p): addr:ae:a4:9d:8b:9f:a9
> >> >      config:     0
> >> >      state:      0
> >> >      speed: 0 Mbps now, 0 Mbps max
> >> >  6(vnet0): addr:fe:54:00:ac:e1:a6
> >> >      config:     0
> >> >      state:      0
> >> >      current:    10MB-FD COPPER
> >> >      speed: 10 Mbps now, 0 Mbps max
> >> >  LOCAL(br3): addr:7a:42:d1:ca:7e:05
> >> >      config:     0
> >> >      state:      0
> >> >      speed: 0 Mbps now, 0 Mbps max
> >> > OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> >> >
> >> > # ovs-ofctl add-flow br3 priority=5,in_port=6,actions=enqueue:3:111
> >> > # ovs-ofctl dump-flows br3
> >> > NXST_FLOW reply (xid=0x4):
> >> >  cookie=0x0, duration=3.285s, table=0, n_packets=0, n_bytes=0,
> >> > idle_age=3,
> >> > priority=5,in_port=6 actions=enqueue:3:111
> >> >  cookie=0x0, duration=79191.532s, table=0, n_packets=744,
> >> > n_bytes=431875,
> >> > idle_age=7, hard_age=65534, priority=0 actions=NORMAL
> >> >
> >> > Then I start to ping6 from VM2 to VM1 and pings will go through that
> >> > patch-ports b3p and b2p. As I expected, the QoS queue will be in
> effect.
> >> > And
> >> > limit the bandwidth to very small amount of max-rate=10
> >> How do you know that QOS is in effect above? I guess based on the
> >> n_packets of openflow flow? That only tells that OVS marked the packet
> >> to go to a QoS queue. But if QoS queue has not been created in Linux
> >> kernel, there is really nothing that will happen.
> >>
> >> I imagine that OVS should show some error in the logs, but I did not
> >> see any (during my small test). That is the reason I am not 100% sure
> >> what will actually  happen.
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/dbf9cd7c/attachment-0001.html>

From leek2006 at 163.com  Mon Mar 30 19:38:13 2015
From: leek2006 at 163.com (=?GBK?B?wO7OsA==?=)
Date: Tue, 31 Mar 2015 10:38:13 +0800 (CST)
Subject: [ovs-discuss] ovs2.3.1 kernel crash
In-Reply-To: <CAArS4XW7jeQ0gKXU+o-cYw17U-cXh33F+7Hbi5O3x++MVAqbSw@mail.gmail.com>
References: <da546bc.4abc.14c590eaece.Coremail.leek2006@163.com>
 <305b9a0f.55e8.14c59223d4f.Coremail.leek2006@163.com>
 <CALnjE+qgkE-Ngrkc2av4svB-jNgwDA6dezO42CqmA_NNbTDb6g@mail.gmail.com>
 <CAArS4XW7jeQ0gKXU+o-cYw17U-cXh33F+7Hbi5O3x++MVAqbSw@mail.gmail.com>
Message-ID: <3386280e.5508.14c6db18815.Coremail.leek2006@163.com>



Cause has been found.
rhel7 have default openvswitch.ko at  /usr/lib/modules/3.10.0-123.el7.x86_64/kernel/net/openvswitch/openvswitch.ko
The operation is as follows：
rmmod openvswitch
insmod /opt/apps_install/openvswitch-2.3.1/module/openvswitch.ko


Thank you reply.





在 2015-03-28 05:51:48，"Alex Wang" <alexw at nicira.com> 写道：

This is the default rhel7, centos7 kernel, which is buggy,


please upgrade to 3.10.0-123.8.1.el7.x86_64 or 3.10.0-123.9.2.el7.x86_64...


I tested those two.~


Thanks,
Alex Wang,


On Fri, Mar 27, 2015 at 10:55 AM, Pravin Shelar <pshelar at nicira.com> wrote:





On Thu, Mar 26, 2015 at 7:49 PM, 李伟 <leek2006 at 163.com> wrote:

kernel bug ?
https://bugzilla.redhat.com/show_bug.cgi?id=902012
 


在 2015-03-27 10:27:56，"李伟" <leek2006 at 163.com> 写道：



The OVS add  of 100 port :
ovs-vsctl  show|grep Port|wc -l
101
then  host connect lost  .


TTY show kernel info :







This is partial kernel stack which not helpful. Can you send us full kernel log to analyze it.


Thanks,
Pravin.

_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/d0488f06/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图2.png
Type: image/png
Size: 4660 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/d0488f06/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图3.png
Type: image/png
Size: 2464 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/d0488f06/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 截图1.png
Type: image/png
Size: 201471 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/d0488f06/attachment-0005.png>

From mark.graham at anglia.ac.uk  Tue Mar 31 00:23:45 2015
From: mark.graham at anglia.ac.uk (Graham, Mark)
Date: Tue, 31 Mar 2015 07:23:45 +0000
Subject: [ovs-discuss] CDP (cisco discovery protocol) packets being
 dropped by OVS
In-Reply-To: <20150330164255.GD16645@nicira.com>
References: <D13D5DF9.318D7B%brian_field@cable.comcast.com>
 <20150330164255.GD16645@nicira.com>
Message-ID: <4A47C20C8573EE4986CFBB93CF1ECA092B05C612@CAM-I-MBX02.anglia.local>

Does disabling "forward-bpdu" also explain why ARP and DHCP request are not captured, or is this more to do with the dst MAC being 00:00:00:00:00:00 for ARP and source IP addressing being 0.0.0.0 for DHCP?

-----Original Message-----
From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Ben Pfaff
Sent: 30 March 2015 17:43
To: Field, Brian
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] CDP (cisco discovery protocol) packets being dropped by OVS

On Sun, Mar 29, 2015 at 01:44:58PM +0000, Field, Brian wrote:
> I’ve noticed the CDP frames are being dropped by OVS:
> 
> 
> # ovs-dpctl dump-flows
> 
> skb_priority(0),in_port(2),eth(src=52:54:00:d7:50:8e,dst=01:00:0c:cc:c
> c:cc),eth_type(0/0xffff), packets:0, bytes:0, used:never, actions:drop
> 
> 
> 
> In http://benpfaff.org/~blp/ovs-fields.pdf, it mentions “OpenFlow and Open vSwitch only support LLC headers with DSAP and SSAP 0xaa and control byte 0x03, which indicate that a SNAP header follows the LLC header. In turn, OpenFlow and Open vSwitch only support a SNAP header with organization 0x000000."
> 
> 
> CDP frames use LLC/SNAP encapsulation with an organization code of (0xc).  So it would appear this is why CDP frames are being dropped by OVS.

No.  I expect it's because forward-bpdu is disabled.  Please see
ovs-vswitchd.conf.db(5) for details.

> Is the limitation to only support LLC/SNAP with org values of 0x0 a limitation imposed on OVS because OpenFlow doesn’t support or… ?

It is true that OpenFlow does not support this, but the reason is primarily that no one has found this important enough to implement.

For CDP, for example, you can alternatively match on the destination Ethernet address, which is 01:00:0c:cc:cc:cc for CDP.
_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

-- 

In the official 2014 government assessment of our research the following 12 areas were found to have world-leading research: Allied Health Professions; Architecture & Built Environment; Art & Design; Business & Management Studies; Communication, Cultural & Media Studies; English Language & Literature; Geography & Environmental Studies; History; Law; Music, Drama & Dance; Psychology; and Social Work & Social Policy.

This e-mail and any attachments are intended for the above named 
recipient(s)only and may be privileged. If they have come to you in 
error you must take no action based on them, nor must you copy or show 
them to anyone please reply to this e-mail to highlight the error and 
then immediately delete the e-mail from your system. Any opinions 
expressed are solely those of the author and do not necessarily 
represent the views or opinions of Anglia Ruskin University.
Although measures have been taken to ensure that this e-mail and attachments are 
free from any virus we advise that, in keeping with good computing 
practice, the recipient should ensure they are actually virus free. 
Please note that this message has been sent over public networks which 
may not be a 100% secure communications

From djhon9813 at gmail.com  Tue Mar 31 00:50:04 2015
From: djhon9813 at gmail.com (david jhon)
Date: Tue, 31 Mar 2015 12:50:04 +0500
Subject: [ovs-discuss] Sending Kernel-space to userspace upcalls
Message-ID: <CANPUzQ073zQtoq4E32qY=DMfW+baQXm0Q+Z3tsvnxKHmCkrdZQ@mail.gmail.com>

Hi everyone,

I want to send kernel->userspace messages just as OVS_PACKET_CMD_MISS
upcall is sent from datapath to userspace to notify userspace about a
packet MISS.

I am just not understanding how to specify PID for this upcall. In case of
OVS_PACKET_CMD_MISS, this PID is specified by
ovs_vport_find_upcall_portid(p, skb) which implements the process as
described in Unicast Sunbcriptions(Open vSwitch specific) in
netlink-socket.h.

The documentation here describes that nl_sock_recv() is used to handle
these upcalls at userspace side but I am not getting exactly how userspace
assigns Netlink PIDs to a vport as "upcall PIDs". What piece of code
exactly deals with it? How can a new socket be subscribed to unicast
subscription.

One more query, can I use this ovs_vport_set_upcall_portids() method to
reset upcall.portid in any way? I tried a couple of solutions according to
my understanding of code but they caused kernel panic and the reason behind
this kernel panic is failling to find an appropriate PID for this new
upcall to be sent on.

I'll be really grateful for your guidance and help in this regard. Thanks a
lot!

Kind Regards,
David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/7d282b35/attachment.html>

From sbiswas7 at linux.vnet.ibm.com  Tue Mar 31 02:59:30 2015
From: sbiswas7 at linux.vnet.ibm.com (Sudipto Biswas)
Date: Tue, 31 Mar 2015 15:29:30 +0530
Subject: [ovs-discuss] How to install OVS!
In-Reply-To: <1427723944633.67437@supcom.tn>
References: <1427723944633.67437@supcom.tn>
Message-ID: <551A7002.80908@linux.vnet.ibm.com>


On Monday 30 March 2015 07:28 PM, Amal KAMMOUN wrote:
>
>
> Hello!
>
> I tried to install openvswitch in a virtual machine but I failed!
>
> I followed this tutorial 
> https://github.com/openvswitch/ovs/blob/master/INSTALL.md 
> <https://github.com/openvswitch/ovs/blob/master/INSTALL.md> . 
> Everything is fine and I could create a bridge. But when I restart my 
> VM, I try to use the ovs-vsctl command. But I have " data base 
> connection failed".
>
> I try to start OVS with this commands : service openvswitch-switch 
> start and /etc/init.d/ovsdb-server start, but I failed.
>
You would have to configure OVS as a service if you'd like the service 
command to use IMO.
You could alternately start it via 
/usr/share/openvswitch/scripts/ovs-ctl start/restart
Check that you have both the ovsdb-server running on your machine to get 
over the database connection failed error.
> How can I install correctly openvswitch. I have to install it from 
> ubuntu packages? it is the same?
>
> Thank you.
>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From Brian_Field at cable.comcast.com  Tue Mar 31 04:47:36 2015
From: Brian_Field at cable.comcast.com (Field, Brian)
Date: Tue, 31 Mar 2015 11:47:36 +0000
Subject: [ovs-discuss] CDP (cisco discovery protocol) packets being
 dropped by OVS
In-Reply-To: <20150330164255.GD16645@nicira.com>
References: <D13D5DF9.318D7B%brian_field@cable.comcast.com>
 <20150330164255.GD16645@nicira.com>
Message-ID: <D13FE2F9.31A7B4%brian_field@cable.comcast.com>

Thanks.  As you suggested, doing a "ovs-vsctl set bridge ovs-br0
other-config:forward-bpdu=true² resolved the issue.

One thing I¹m still grappling with is what¹s written in
ovs-vswitchd.conf.db(5) and the behavior I¹m seeing by setting this option
to true.  Namely, in http://openvswitch.org/ovs-vswitchd.conf.db.5.pdf
under "other_config : forward-bpdu: optional string, either true or
false², the last two sentences say "Default is disabled, set to true to
enable. The following destination MAC addresss will not be forwarded when
this option is enabled.²  And the CDP MAC is listed:

01:00:0c:cc:cc:cc Cisco Discovery Protocol (CDP), VLAN Trunking Protocol
(VTP), Dynamic Trunking
Protocol (DTP), Port Aggregation Protocol (PAgP), and others

So when I read this part of the doc, it seems to suggest that setting
forwarding-bpdu=true should cause CDP frames not to be forwarded‹ but in
reality setting this option to true enabled them to be forwarded.

What am I missing?

Thanks
Brian





On 3/30/15, 10:42 AM, "Ben Pfaff" <blp at nicira.com> wrote:

>On Sun, Mar 29, 2015 at 01:44:58PM +0000, Field, Brian wrote:
>> I¹ve noticed the CDP frames are being dropped by OVS:
>> 
>> 
>> # ovs-dpctl dump-flows
>> 
>> 
>>skb_priority(0),in_port(2),eth(src=52:54:00:d7:50:8e,dst=01:00:0c:cc:cc:c
>>c),eth_type(0/0xffff), packets:0, bytes:0, used:never, actions:drop
>> 
>> 
>> 
>> In http://benpfaff.org/~blp/ovs-fields.pdf, it mentions ³OpenFlow and
>>Open vSwitch only support LLC headers with DSAP and SSAP 0xaa and
>>control byte 0x03, which indicate that a SNAP header follows the LLC
>>header. In turn, OpenFlow and Open vSwitch only support a SNAP header
>>with organization 0x000000."
>> 
>> 
>> CDP frames use LLC/SNAP encapsulation with an organization code of
>>(0xc).  So it would appear this is why CDP frames are being dropped by
>>OVS.
>
>No.  I expect it's because forward-bpdu is disabled.  Please see
>ovs-vswitchd.conf.db(5) for details.
>
>> Is the limitation to only support LLC/SNAP with org values of 0x0 a
>>limitation imposed on OVS because OpenFlow doesn¹t support orŠ ?
>
>It is true that OpenFlow does not support this, but the reason is
>primarily that no one has found this important enough to implement.
>
>For CDP, for example, you can alternatively match on the destination
>Ethernet address, which is 01:00:0c:cc:cc:cc for CDP.
>


From amal.kammoun at supcom.tn  Tue Mar 31 07:05:46 2015
From: amal.kammoun at supcom.tn (Amal KAMMOUN)
Date: Tue, 31 Mar 2015 14:05:46 +0000
Subject: [ovs-discuss] SDN topology.
Message-ID: <1427810799214.94157@supcom.tn>

Hello all!


I'm trying to construct the following topology:



       VM1-  OpenFlowController1                            VM2- OpenflowController2

                            |                                                                     |
                            |                                                                     |

                            |                                                                     |
                            |                                                                     |

              VM3 ----------                                                  VM4 ----------

                      | OVS1|----------------------------------------------------------| OVS2|

                      -----------                                                           -----------

                            |                                                                     |

                            |                                                                     |

                            |                                                                     |

                       Host:VM-5                                                 Host:VM-6



All my virtual machines are made by VirtualBox.


It is possible to build such topology?


How can I connect 2 OVS running on 2 different VMs?


Thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/6725000e/attachment-0001.html>

From marco at nuvula.ch  Tue Mar 31 07:09:18 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 31 Mar 2015 16:09:18 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
Message-ID: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>

Folks,

any chance of having somebody look at these crash files ?

I have several servers that are loosing network connectivity because of this.

Downloads:

https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing <https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing>

Thanks for any hint or fix

marco




 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/4e9dca86/attachment.html>

From blp at nicira.com  Tue Mar 31 08:00:31 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 31 Mar 2015 08:00:31 -0700
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
Message-ID: <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>

Can you get a backtrace for these?

On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig <marco at nuvula.ch> wrote:

> Folks,
>
> any chance of having somebody look at these crash files ?
>
> I have several servers that are loosing network connectivity because of
> this.
>
> Downloads:
>
>
> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing
>
> Thanks for any hint or fix
>
> marco
>
>
>
>
> [image: Nuvula AG] <http://www.nuvula.ch/>
>
> Marco Kuendig / CEO / Founder
> marco at nuvula.ch / +41 78 751 99 71
>
> Marco's Google Hangout
> <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>
> Nuvula AG - Hybrid Clouds
> Weierbachstrasse 7b 8193 Eglisau Switzerland
> http://www.nuvula.ch
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>


-- 
"I don't normally do acked-by's.  I think it's my way of avoiding
getting blamed when it all blows up."               Andrew Morton
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/aafa20e2/attachment.html>

From marco at nuvula.ch  Tue Mar 31 08:16:51 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 31 Mar 2015 17:16:51 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
Message-ID: <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>

Have tried this:

http://openvswitch.org/pipermail/discuss/2015-February/016582.html <http://openvswitch.org/pipermail/discuss/2015-February/016582.html>

this is the output, so doesn't seem to be correct:

root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd /var/crash/_usr_sbin_ovs-vswitchd.0.crash
GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
Copyright (C) 2014 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging symbols found)...done.
"/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File format not recognized
(gdb) bt
No stack.
(gdb) quit

any more hints please ?

thanks
marco


 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
> On 31 Mar 2015, at 17:00, Ben Pfaff <blp at nicira.com> wrote:
> 
> Can you get a backtrace for these?
> 
> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
> Folks,
> 
> any chance of having somebody look at these crash files ?
> 
> I have several servers that are loosing network connectivity because of this.
> 
> Downloads:
> 
> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing <https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing>
> 
> Thanks for any hint or fix
> 
> marco
> 
> 
> 
> 
>  <http://www.nuvula.ch/>
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch <http://www.nuvula.ch/>
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
> 
> 
> 
> 
> -- 
> "I don't normally do acked-by's.  I think it's my way of avoiding
> getting blamed when it all blows up."               Andrew Morton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/10387065/attachment-0001.html>

From blp at nicira.com  Tue Mar 31 08:28:47 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 31 Mar 2015 08:28:47 -0700
Subject: [ovs-discuss] CDP (cisco discovery protocol) packets being
 dropped by OVS
In-Reply-To: <4A47C20C8573EE4986CFBB93CF1ECA092B05C612@CAM-I-MBX02.anglia.local>
References: <D13D5DF9.318D7B%brian_field@cable.comcast.com>
 <20150330164255.GD16645@nicira.com>
 <4A47C20C8573EE4986CFBB93CF1ECA092B05C612@CAM-I-MBX02.anglia.local>
Message-ID: <20150331152847.GF15101@nicira.com>

ARP and DHCP requests are not affected by forward-bpdu (they are not
considered BPDUs).  ARP and DHCP treatment would go through the normal
paths in the flow table.

ARPs should not have a destination MAC of 00:00:00:00:00:00; they are
normally broadcast or unicast.

On Tue, Mar 31, 2015 at 07:23:45AM +0000, Graham, Mark wrote:
> Does disabling "forward-bpdu" also explain why ARP and DHCP request are not captured, or is this more to do with the dst MAC being 00:00:00:00:00:00 for ARP and source IP addressing being 0.0.0.0 for DHCP?
> 
> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Ben Pfaff
> Sent: 30 March 2015 17:43
> To: Field, Brian
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] CDP (cisco discovery protocol) packets being dropped by OVS
> 
> On Sun, Mar 29, 2015 at 01:44:58PM +0000, Field, Brian wrote:
> > I’ve noticed the CDP frames are being dropped by OVS:
> > 
> > 
> > # ovs-dpctl dump-flows
> > 
> > skb_priority(0),in_port(2),eth(src=52:54:00:d7:50:8e,dst=01:00:0c:cc:c
> > c:cc),eth_type(0/0xffff), packets:0, bytes:0, used:never, actions:drop
> > 
> > 
> > 
> > In http://benpfaff.org/~blp/ovs-fields.pdf, it mentions “OpenFlow and Open vSwitch only support LLC headers with DSAP and SSAP 0xaa and control byte 0x03, which indicate that a SNAP header follows the LLC header. In turn, OpenFlow and Open vSwitch only support a SNAP header with organization 0x000000."
> > 
> > 
> > CDP frames use LLC/SNAP encapsulation with an organization code of (0xc).  So it would appear this is why CDP frames are being dropped by OVS.
> 
> No.  I expect it's because forward-bpdu is disabled.  Please see
> ovs-vswitchd.conf.db(5) for details.
> 
> > Is the limitation to only support LLC/SNAP with org values of 0x0 a limitation imposed on OVS because OpenFlow doesn’t support or… ?
> 
> It is true that OpenFlow does not support this, but the reason is primarily that no one has found this important enough to implement.
> 
> For CDP, for example, you can alternatively match on the destination Ethernet address, which is 01:00:0c:cc:cc:cc for CDP.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> 
> -- 
> 
> In the official 2014 government assessment of our research the following 12 areas were found to have world-leading research: Allied Health Professions; Architecture & Built Environment; Art & Design; Business & Management Studies; Communication, Cultural & Media Studies; English Language & Literature; Geography & Environmental Studies; History; Law; Music, Drama & Dance; Psychology; and Social Work & Social Policy.
> 
> This e-mail and any attachments are intended for the above named 
> recipient(s)only and may be privileged. If they have come to you in 
> error you must take no action based on them, nor must you copy or show 
> them to anyone please reply to this e-mail to highlight the error and 
> then immediately delete the e-mail from your system. Any opinions 
> expressed are solely those of the author and do not necessarily 
> represent the views or opinions of Anglia Ruskin University.
> Although measures have been taken to ensure that this e-mail and attachments are 
> free from any virus we advise that, in keeping with good computing 
> practice, the recipient should ensure they are actually virus free. 
> Please note that this message has been sent over public networks which 
> may not be a 100% secure communications

From blp at nicira.com  Tue Mar 31 08:32:23 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 31 Mar 2015 08:32:23 -0700
Subject: [ovs-discuss] CDP (cisco discovery protocol) packets being
 dropped by OVS
In-Reply-To: <D13FE2F9.31A7B4%brian_field@cable.comcast.com>
References: <D13D5DF9.318D7B%brian_field@cable.comcast.com>
 <20150330164255.GD16645@nicira.com>
 <D13FE2F9.31A7B4%brian_field@cable.comcast.com>
Message-ID: <20150331153223.GG15101@nicira.com>

On Tue, Mar 31, 2015 at 11:47:36AM +0000, Field, Brian wrote:
> One thing I¹m still grappling with is what¹s written in
> ovs-vswitchd.conf.db(5) and the behavior I¹m seeing by setting this option
> to true.  Namely, in http://openvswitch.org/ovs-vswitchd.conf.db.5.pdf
> under "other_config : forward-bpdu: optional string, either true or
> false², the last two sentences say "Default is disabled, set to true to
> enable. The following destination MAC addresss will not be forwarded when
> this option is enabled.²  And the CDP MAC is listed:
> 
> 01:00:0c:cc:cc:cc Cisco Discovery Protocol (CDP), VLAN Trunking Protocol
> (VTP), Dynamic Trunking
> Protocol (DTP), Port Aggregation Protocol (PAgP), and others
> 
> So when I read this part of the doc, it seems to suggest that setting
> forwarding-bpdu=true should cause CDP frames not to be forwarded‹ but in
> reality setting this option to true enabled them to be forwarded.

The description was badly written.  Oops.

Thanks for the bug report.  I sent out an improvement for the
documentation:
        http://openvswitch.org/pipermail/dev/2015-March/053058.html

From joestringer at nicira.com  Tue Mar 31 10:00:10 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Tue, 31 Mar 2015 10:00:10 -0700
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
Message-ID: <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>

For the 'File format not recognized' problem, you might have better luck
with the 'crash' utility.

$ crash <binary> <crashdump>

On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch> wrote:

> Have tried this:
>
> http://openvswitch.org/pipermail/discuss/2015-February/016582.html
>
> this is the output, so doesn't seem to be correct:
>
> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd
> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
> Copyright (C) 2014 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later <
> http://gnu.org/licenses/gpl.html>
> This is free software: you are free to change and redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-linux-gnu".
> Type "show configuration" for configuration details.
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/>.
> Find the GDB manual and other documentation resources online at:
> <http://www.gnu.org/software/gdb/documentation/>.
> For help, type "help".
> Type "apropos word" to search for commands related to "word"...
> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging symbols
> found)...done.
> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File
> format not recognized
> (gdb) bt
> No stack.
> (gdb) quit
>
> any more hints please ?
>
> thanks
> marco
>
>
> [image: Nuvula AG] <http://www.nuvula.ch/>
>
> Marco Kuendig / CEO / Founder
> marco at nuvula.ch / +41 78 751 99 71
>
> Marco's Google Hangout
> <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>
> Nuvula AG - Hybrid Clouds
> Weierbachstrasse 7b 8193 Eglisau Switzerland
> http://www.nuvula.ch
>
> On 31 Mar 2015, at 17:00, Ben Pfaff <blp at nicira.com> wrote:
>
> Can you get a backtrace for these?
>
> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig <marco at nuvula.ch> wrote:
>
>> Folks,
>>
>> any chance of having somebody look at these crash files ?
>>
>> I have several servers that are loosing network connectivity because of
>> this.
>>
>> Downloads:
>>
>>
>> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing
>>
>> Thanks for any hint or fix
>>
>> marco
>>
>>
>>
>>
>> [image: Nuvula AG] <http://www.nuvula.ch/>
>>
>> Marco Kuendig / CEO / Founder
>> marco at nuvula.ch / +41 78 751 99 71
>>
>> Marco's Google Hangout
>> <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>>
>> Nuvula AG - Hybrid Clouds
>> Weierbachstrasse 7b 8193 Eglisau Switzerland
>> http://www.nuvula.ch
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>
>
> --
> "I don't normally do acked-by's.  I think it's my way of avoiding
> getting blamed when it all blows up."               Andrew Morton
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/95fe3b8f/attachment-0001.html>

From marco at nuvula.ch  Tue Mar 31 12:34:33 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 31 Mar 2015 21:34:33 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
 <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
Message-ID: <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>

thanks Joe and Ben

have done:

1. installed dgb symbols for kernel....doesn't help
2. installed debug symbols for openvswitch

no change, gdb and crash still don't work for me. I'm not a dev, need more help to get that backtrace done.

here some output:

root at nuv-vir-kvm-server-1 ~ # crash  /usr/lib/debug/boot/vmlinux-3.13.0-48-generic /var/crash/_usr_sbin_ovs-vswitchd.0.crash

crash 7.0.3
Copyright (C) 2002-2013  Red Hat, Inc.
Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
Copyright (C) 1999-2006  Hewlett-Packard Co
Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
Copyright (C) 2005, 2011  NEC Corporation
Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
This program is free software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter "help copying" to see the conditions.
This program has absolutely no warranty.  Enter "help warranty" for details.

crash: /var/crash/_usr_sbin_ovs-vswitchd.0.crash: not a supported file format

Usage:

  crash [OPTION]... NAMELIST MEMORY-IMAGE  (dumpfile form)
  crash [OPTION]... [NAMELIST]             (live system form)

Enter "crash -h" for details.
root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd /var/crash/_usr_sbin_ovs-vswitchd.0.crash
GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
Copyright (C) 2014 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
done.
"/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File format not recognized
(gdb) q
root at nuv-vir-kvm-server-1 ~ #



 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
> On 31 Mar 2015, at 19:00, Joe Stringer <joestringer at nicira.com> wrote:
> 
> For the 'File format not recognized' problem, you might have better luck with the 'crash' utility.
> 
> $ crash <binary> <crashdump>
> 
> On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
> Have tried this:
> 
> http://openvswitch.org/pipermail/discuss/2015-February/016582.html <http://openvswitch.org/pipermail/discuss/2015-February/016582.html>
> 
> this is the output, so doesn't seem to be correct:
> 
> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd /var/crash/_usr_sbin_ovs-vswitchd.0.crash
> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
> Copyright (C) 2014 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
> This is free software: you are free to change and redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-linux-gnu".
> Type "show configuration" for configuration details.
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
> Find the GDB manual and other documentation resources online at:
> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
> For help, type "help".
> Type "apropos word" to search for commands related to "word"...
> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging symbols found)...done.
> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File format not recognized
> (gdb) bt
> No stack.
> (gdb) quit
> 
> any more hints please ?
> 
> thanks
> marco
> 
> 
>  <http://www.nuvula.ch/>
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch <http://www.nuvula.ch/>
>> On 31 Mar 2015, at 17:00, Ben Pfaff <blp at nicira.com <mailto:blp at nicira.com>> wrote:
>> 
>> Can you get a backtrace for these?
>> 
>> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>> Folks,
>> 
>> any chance of having somebody look at these crash files ?
>> 
>> I have several servers that are loosing network connectivity because of this.
>> 
>> Downloads:
>> 
>> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing <https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing>
>> 
>> Thanks for any hint or fix
>> 
>> marco
>> 
>> 
>> 
>> 
>>  <http://www.nuvula.ch/>
>> Marco Kuendig / CEO / Founder 
>> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>> Nuvula AG - Hybrid Clouds 
>> Weierbachstrasse 7b 8193 Eglisau Switzerland 
>> http://www.nuvula.ch <http://www.nuvula.ch/>
>> 
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
>> 
>> 
>> 
>> 
>> -- 
>> "I don't normally do acked-by's.  I think it's my way of avoiding
>> getting blamed when it all blows up."               Andrew Morton
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/cd70a259/attachment-0001.html>

From Sabyasachi.Sengupta at alcatel-lucent.com  Tue Mar 31 12:45:54 2015
From: Sabyasachi.Sengupta at alcatel-lucent.com (Sabyasachi Sengupta)
Date: Tue, 31 Mar 2015 12:45:54 -0700
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
 <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
 <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>
Message-ID: <alpine.OSX.1.10.1503311245160.389@sabyasg-mbp-02>


Typically Ubuntu does not unpack the crashes. Can you try apport-unpack?
# apport-unpack /var/crash/<name> <crash-dir>

On Tue, 31 Mar 2015, Marco Kuendig wrote:

> thanks Joe and Ben
> have done:
> 
> 1. installed dgb symbols for kernel....doesn't help
> 2. installed debug symbols for openvswitch
> 
> no change, gdb and crash still don't work for me. I'm not a dev, need
> more help to get that backtrace done.
> 
> here some output:
> 
> root at nuv-vir-kvm-server-1 ~ # crash
>  /usr/lib/debug/boot/vmlinux-3.13.0-48-generic
> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
> 
> crash 7.0.3
> Copyright (C) 2002-2013  Red Hat, Inc.
> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
> Copyright (C) 1999-2006  Hewlett-Packard Co
> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
> Copyright (C) 2005, 2011  NEC Corporation
> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
> This program is free software, covered by the GNU General Public License,
> and you are welcome to change it and/or distribute copies of it under
> certain conditions.  Enter "help copying" to see the conditions.
> This program has absolutely no warranty.  Enter "help warranty" for
> details.
> 
> crash: /var/crash/_usr_sbin_ovs-vswitchd.0.crash: not a supported file
> format
> 
> Usage:
>
>   crash [OPTION]... NAMELIST MEMORY-IMAGE  (dumpfile form)
>   crash [OPTION]... [NAMELIST]             (live system form)
> 
> Enter "crash -h" for details.
> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
> Copyright (C) 2014 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later
> <http://gnu.org/licenses/gpl.html>
> This is free software: you are free to change and redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type "show
> copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-linux-gnu".
> Type "show configuration" for configuration details.
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/>.
> Find the GDB manual and other documentation resources online at:
> <http://www.gnu.org/software/gdb/documentation/>.
> For help, type "help".
> Type "apropos word" to search for commands related to "word"...
> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
> done.
> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File
> format not recognized
> (gdb) q
> root at nuv-vir-kvm-server-1 ~ #
> 
> 
> 
> Nuvula AG
> 
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch / +41 78 751 99 71
> 
> Marco's Google Hangout
> 
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch
> 
>
>       On 31 Mar 2015, at 19:00, Joe Stringer
>       <joestringer at nicira.com> wrote:
> 
> For the 'File format not recognized' problem, you might have better
> luck with the 'crash' utility.
> $ crash <binary> <crashdump>
> 
> On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch> wrote:
>       Have tried this:
> http://openvswitch.org/pipermail/discuss/2015-February/016582.html
> 
> this is the output, so doesn't seem to be correct:
> 
> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd
> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
> Copyright (C) 2014 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later
> <http://gnu.org/licenses/gpl.html>
> This is free software: you are free to change and
> redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type
> "show copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-linux-gnu".
> Type "show configuration" for configuration details.
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/>.
> Find the GDB manual and other documentation resources online
> at:
> <http://www.gnu.org/software/gdb/documentation/>.
> For help, type "help".
> Type "apropos word" to search for commands related to
> "word"...
> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging
> symbols found)...done.
> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core
> dump: File format not recognized
> (gdb) bt
> No stack.
> (gdb) quit
> 
> any more hints please ?
> 
> thanks
> marco
> 
> 
> Nuvula AG
> 
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch / +41 78 751 99 71
> 
> Marco's Google Hangout
> 
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch
> 
>
>       On 31 Mar 2015, at 17:00, Ben Pfaff
>       <blp at nicira.com> wrote:
> 
> Can you get a backtrace for these?
> 
> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig
> <marco at nuvula.ch> wrote:
>       Folks,
> any chance of having somebody look at these crash
> files ?
> 
> I have several servers that are loosing network
> connectivity because of this.
> 
> Downloads:
> 
> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing
> 
> Thanks for any hint or fix
> 
> marco
> 
> 
> 
> 
> Nuvula AG
> 
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch / +41 78 751 99 71
> 
> Marco's Google Hangout
> 
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch
> 
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> 
> 
> 
> 
> --
> "I don't normally do acked-by's.  I think it's my way
> of avoiding
> getting blamed when it all blows up." 
> Andrew Morton
> 
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> 
> 
> 
> 
>

From marco at nuvula.ch  Tue Mar 31 12:52:00 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 31 Mar 2015 21:52:00 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <alpine.OSX.1.10.1503311245160.389@sabyasg-mbp-02>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
 <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
 <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>
 <alpine.OSX.1.10.1503311245160.389@sabyasg-mbp-02>
Message-ID: <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>

that brought us a step forward. thank Sab.

Important to know is:

I got 4 kvm servers, meshed with openvswitch. I use vxlan for tunnelling.

Sometimes when I restart a domain in kvm, 3 or 4 hosts crash at the same time.

I have STP enabled to avoid loops.


this is the output now:

root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
Copyright (C) 2014 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
done.
[New LWP 32725]
[New LWP 32732]
[New LWP 32726]
[New LWP 32730]
[New LWP 32727]
[New LWP 32728]
[New LWP 32729]
[New LWP 32731]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfi'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
506	../lib/netlink.c: No such file or directory.


root at nuv-vir-kvm-server-1 ~ # crash /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump

crash 7.0.3
Copyright (C) 2002-2013  Red Hat, Inc.
Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
Copyright (C) 1999-2006  Hewlett-Packard Co
Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
Copyright (C) 2005, 2011  NEC Corporation
Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
This program is free software, covered by the GNU General Public License,
and you are welcome to change it and/or distribute copies of it under
certain conditions.  Enter "help copying" to see the conditions.
This program has absolutely no warranty.  Enter "help warranty" for details.


crash: /usr/sbin/ovs-vswitchd: no debugging data available

root at nuv-vir-kvm-server-1 ~ # ll /var/crash/ovs/
Architecture         Date                 ExecutableTimestamp  ProcCwd              ProcStatus           UserGroups
CoreDump             DistroRelease        ProblemType          ProcEnviron          Signal
CrashCounter         ExecutablePath       ProcCmdline          ProcMaps             Uname

 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
> On 31 Mar 2015, at 21:45, Sabyasachi Sengupta <Sabyasachi.Sengupta at alcatel-lucent.com> wrote:
> 
> 
> Typically Ubuntu does not unpack the crashes. Can you try apport-unpack?
> # apport-unpack /var/crash/<name> <crash-dir>
> 
> On Tue, 31 Mar 2015, Marco Kuendig wrote:
> 
>> thanks Joe and Ben
>> have done:
>> 1. installed dgb symbols for kernel....doesn't help
>> 2. installed debug symbols for openvswitch
>> no change, gdb and crash still don't work for me. I'm not a dev, need
>> more help to get that backtrace done.
>> here some output:
>> root at nuv-vir-kvm-server-1 ~ # crash
>>  /usr/lib/debug/boot/vmlinux-3.13.0-48-generic
>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>> crash 7.0.3
>> Copyright (C) 2002-2013  Red Hat, Inc.
>> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
>> Copyright (C) 1999-2006  Hewlett-Packard Co
>> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
>> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
>> Copyright (C) 2005, 2011  NEC Corporation
>> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
>> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
>> This program is free software, covered by the GNU General Public License,
>> and you are welcome to change it and/or distribute copies of it under
>> certain conditions.  Enter "help copying" to see the conditions.
>> This program has absolutely no warranty.  Enter "help warranty" for
>> details.
>> crash: /var/crash/_usr_sbin_ovs-vswitchd.0.crash: not a supported file
>> format
>> Usage:
>> 
>>   crash [OPTION]... NAMELIST MEMORY-IMAGE  (dumpfile form)
>>   crash [OPTION]... [NAMELIST]             (live system form)
>> Enter "crash -h" for details.
>> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>> Copyright (C) 2014 Free Software Foundation, Inc.
>> License GPLv3+: GNU GPL version 3 or later
>> <http://gnu.org/licenses/gpl.html>
>> This is free software: you are free to change and redistribute it.
>> There is NO WARRANTY, to the extent permitted by law.  Type "show
>> copying"
>> and "show warranty" for details.
>> This GDB was configured as "x86_64-linux-gnu".
>> Type "show configuration" for configuration details.
>> For bug reporting instructions, please see:
>> <http://www.gnu.org/software/gdb/bugs/>.
>> Find the GDB manual and other documentation resources online at:
>> <http://www.gnu.org/software/gdb/documentation/>.
>> For help, type "help".
>> Type "apropos word" to search for commands related to "word"...
>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
>> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>> done.
>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File
>> format not recognized
>> (gdb) q
>> root at nuv-vir-kvm-server-1 ~ #
>> Nuvula AG
>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71
>> Marco's Google Hangout
>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch
>> 
>>      On 31 Mar 2015, at 19:00, Joe Stringer
>>      <joestringer at nicira.com> wrote:
>> For the 'File format not recognized' problem, you might have better
>> luck with the 'crash' utility.
>> $ crash <binary> <crashdump>
>> On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch> wrote:
>>      Have tried this:
>> http://openvswitch.org/pipermail/discuss/2015-February/016582.html
>> this is the output, so doesn't seem to be correct:
>> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd
>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>> Copyright (C) 2014 Free Software Foundation, Inc.
>> License GPLv3+: GNU GPL version 3 or later
>> <http://gnu.org/licenses/gpl.html>
>> This is free software: you are free to change and
>> redistribute it.
>> There is NO WARRANTY, to the extent permitted by law.  Type
>> "show copying"
>> and "show warranty" for details.
>> This GDB was configured as "x86_64-linux-gnu".
>> Type "show configuration" for configuration details.
>> For bug reporting instructions, please see:
>> <http://www.gnu.org/software/gdb/bugs/>.
>> Find the GDB manual and other documentation resources online
>> at:
>> <http://www.gnu.org/software/gdb/documentation/>.
>> For help, type "help".
>> Type "apropos word" to search for commands related to
>> "word"...
>> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging
>> symbols found)...done.
>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core
>> dump: File format not recognized
>> (gdb) bt
>> No stack.
>> (gdb) quit
>> any more hints please ?
>> thanks
>> marco
>> Nuvula AG
>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71
>> Marco's Google Hangout
>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch
>> 
>>      On 31 Mar 2015, at 17:00, Ben Pfaff
>>      <blp at nicira.com> wrote:
>> Can you get a backtrace for these?
>> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig
>> <marco at nuvula.ch> wrote:
>>      Folks,
>> any chance of having somebody look at these crash
>> files ?
>> I have several servers that are loosing network
>> connectivity because of this.
>> Downloads:
>> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing
>> Thanks for any hint or fix
>> marco
>> Nuvula AG
>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71
>> Marco's Google Hangout
>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>> --
>> "I don't normally do acked-by's.  I think it's my way
>> of avoiding
>> getting blamed when it all blows up." Andrew Morton
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/2027045b/attachment-0001.html>

From joestringer at nicira.com  Tue Mar 31 13:04:25 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Tue, 31 Mar 2015 13:04:25 -0700
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
 <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
 <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>
 <alpine.OSX.1.10.1503311245160.389@sabyasg-mbp-02>
 <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>
Message-ID: <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>

Great, we're moving. Looks like the gdb version of this is working below.
Do you get the gdb prompt from there? the command 'bt' should provide the
backtrace we're after.

On 31 March 2015 at 12:52, Marco Kuendig <marco at nuvula.ch> wrote:

> that brought us a step forward. thank Sab.
>
> Important to know is:
>
> I got 4 kvm servers, meshed with openvswitch. I use vxlan for tunnelling.
>
> Sometimes when I restart a domain in kvm, 3 or 4 hosts crash at the same
> time.
>
> I have STP enabled to avoid loops.
>
>
> this is the output now:
>
> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
> /var/crash/ovs/CoreDump
> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
> Copyright (C) 2014 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later <
> http://gnu.org/licenses/gpl.html>
> This is free software: you are free to change and redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-linux-gnu".
> Type "show configuration" for configuration details.
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/>.
> Find the GDB manual and other documentation resources online at:
> <http://www.gnu.org/software/gdb/documentation/>.
> For help, type "help".
> Type "apropos word" to search for commands related to "word"...
> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
> done.
> [New LWP 32725]
> [New LWP 32732]
> [New LWP 32726]
> [New LWP 32730]
> [New LWP 32727]
> [New LWP 32728]
> [New LWP 32729]
> [New LWP 32731]
> [Thread debugging using libthread_db enabled]
> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
> Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock
> -vconsole:emer -vsyslog:err -vfi'.
> Program terminated with signal SIGSEGV, Segmentation fault.
> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
> 506 ../lib/netlink.c: No such file or directory.
>
>
> root at nuv-vir-kvm-server-1 ~ # crash /usr/sbin/ovs-vswitchd
> /var/crash/ovs/CoreDump
>
> crash 7.0.3
> Copyright (C) 2002-2013  Red Hat, Inc.
> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
> Copyright (C) 1999-2006  Hewlett-Packard Co
> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
> Copyright (C) 2005, 2011  NEC Corporation
> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
> This program is free software, covered by the GNU General Public License,
> and you are welcome to change it and/or distribute copies of it under
> certain conditions.  Enter "help copying" to see the conditions.
> This program has absolutely no warranty.  Enter "help warranty" for
> details.
>
>
> crash: /usr/sbin/ovs-vswitchd: no debugging data available
>
> root at nuv-vir-kvm-server-1 ~ # ll /var/crash/ovs/
> Architecture         Date                 ExecutableTimestamp  ProcCwd
>          ProcStatus           UserGroups
> CoreDump             DistroRelease        ProblemType          ProcEnviron
>          Signal
> CrashCounter         ExecutablePath       ProcCmdline          ProcMaps
>           Uname
>
>
> [image: Nuvula AG] <http://www.nuvula.ch/>
>
> Marco Kuendig / CEO / Founder
> marco at nuvula.ch / +41 78 751 99 71
>
> Marco's Google Hangout
> <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>
> Nuvula AG - Hybrid Clouds
> Weierbachstrasse 7b 8193 Eglisau Switzerland
> http://www.nuvula.ch
>
> On 31 Mar 2015, at 21:45, Sabyasachi Sengupta <
> Sabyasachi.Sengupta at alcatel-lucent.com> wrote:
>
>
> Typically Ubuntu does not unpack the crashes. Can you try apport-unpack?
> # apport-unpack /var/crash/<name> <crash-dir>
>
> On Tue, 31 Mar 2015, Marco Kuendig wrote:
>
> thanks Joe and Ben
> have done:
> 1. installed dgb symbols for kernel....doesn't help
> 2. installed debug symbols for openvswitch
> no change, gdb and crash still don't work for me. I'm not a dev, need
> more help to get that backtrace done.
> here some output:
> root at nuv-vir-kvm-server-1 ~ # crash
>  /usr/lib/debug/boot/vmlinux-3.13.0-48-generic
> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
> crash 7.0.3
> Copyright (C) 2002-2013  Red Hat, Inc.
> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
> Copyright (C) 1999-2006  Hewlett-Packard Co
> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
> Copyright (C) 2005, 2011  NEC Corporation
> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
> This program is free software, covered by the GNU General Public License,
> and you are welcome to change it and/or distribute copies of it under
> certain conditions.  Enter "help copying" to see the conditions.
> This program has absolutely no warranty.  Enter "help warranty" for
> details.
> crash: /var/crash/_usr_sbin_ovs-vswitchd.0.crash: not a supported file
> format
> Usage:
>
>   crash [OPTION]... NAMELIST MEMORY-IMAGE  (dumpfile form)
>   crash [OPTION]... [NAMELIST]             (live system form)
> Enter "crash -h" for details.
> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
> Copyright (C) 2014 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later
> <http://gnu.org/licenses/gpl.html>
> This is free software: you are free to change and redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type "show
> copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-linux-gnu".
> Type "show configuration" for configuration details.
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/>.
> Find the GDB manual and other documentation resources online at:
> <http://www.gnu.org/software/gdb/documentation/>.
> For help, type "help".
> Type "apropos word" to search for commands related to "word"...
> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
> done.
> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File
> format not recognized
> (gdb) q
> root at nuv-vir-kvm-server-1 ~ #
> Nuvula AG
> Marco Kuendig / CEO / Founder marco at nuvula.ch / +41 78 751 99 71
> Marco's Google Hangout
> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland
> http://www.nuvula.ch
>
>      On 31 Mar 2015, at 19:00, Joe Stringer
>      <joestringer at nicira.com> wrote:
> For the 'File format not recognized' problem, you might have better
> luck with the 'crash' utility.
> $ crash <binary> <crashdump>
> On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch> wrote:
>      Have tried this:
> http://openvswitch.org/pipermail/discuss/2015-February/016582.html
> this is the output, so doesn't seem to be correct:
> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd
> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
> Copyright (C) 2014 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later
> <http://gnu.org/licenses/gpl.html>
> This is free software: you are free to change and
> redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type
> "show copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-linux-gnu".
> Type "show configuration" for configuration details.
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/>.
> Find the GDB manual and other documentation resources online
> at:
> <http://www.gnu.org/software/gdb/documentation/>.
> For help, type "help".
> Type "apropos word" to search for commands related to
> "word"...
> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging
> symbols found)...done.
> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core
> dump: File format not recognized
> (gdb) bt
> No stack.
> (gdb) quit
> any more hints please ?
> thanks
> marco
> Nuvula AG
> Marco Kuendig / CEO / Founder marco at nuvula.ch / +41 78 751 99 71
> Marco's Google Hangout
> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland
> http://www.nuvula.ch
>
>      On 31 Mar 2015, at 17:00, Ben Pfaff
>      <blp at nicira.com> wrote:
> Can you get a backtrace for these?
> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig
> <marco at nuvula.ch> wrote:
>      Folks,
> any chance of having somebody look at these crash
> files ?
> I have several servers that are loosing network
> connectivity because of this.
> Downloads:
>
> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing
> Thanks for any hint or fix
> marco
> Nuvula AG
> Marco Kuendig / CEO / Founder marco at nuvula.ch / +41 78 751 99 71
> Marco's Google Hangout
> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland
> http://www.nuvula.ch
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> --
> "I don't normally do acked-by's.  I think it's my way
> of avoiding
> getting blamed when it all blows up." Andrew Morton
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/1c4fddc0/attachment-0001.html>

From marco at nuvula.ch  Tue Mar 31 13:05:57 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 31 Mar 2015 22:05:57 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
 <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
 <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>
 <alpine.OSX.1.10.1503311245160.389@sabyasg-mbp-02>
 <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>
 <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>
Message-ID: <321030EF-0481-4FD2-B979-8B0A63C3D19D@nuvula.ch>

Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
done.
[New LWP 32725]
[New LWP 32732]
[New LWP 32726]
[New LWP 32730]
[New LWP 32727]
[New LWP 32728]
[New LWP 32729]
[New LWP 32731]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfi'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
506	../lib/netlink.c: No such file or directory.
(gdb) bt
#0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
#1  0x0000000000460473 in format_generic_odp_key (a=a at entry=0x0, ds=ds at entry=0x7fff0408f3b0) at ../lib/odp-util.c:767
#2  0x0000000000460cd2 in format_odp_key_attr (a=a at entry=0xc485a4, ma=ma at entry=0x0, ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true)
    at ../lib/odp-util.c:1332
#3  0x00000000004609d7 in odp_flow_format (key=<optimized out>, key_len=40, mask=0x0, mask_len=0, ds=0x7fff0408f3b0, verbose=true) at ../lib/odp-util.c:1402
#4  0x0000000000460fc4 in format_odp_key_attr (a=a at entry=0xc48580, ma=ma at entry=0x0, ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true) at ../lib/odp-util.c:987
#5  0x00000000004609d7 in odp_flow_format (key=key at entry=0xc48520, key_len=key_len at entry=140, mask=mask at entry=0x0, mask_len=mask_len at entry=0,
    ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true) at ../lib/odp-util.c:1402
#6  0x00000000004450f3 in log_flow_message (error=error at entry=2, operation=operation at entry=0x4d0e73 "flow_del", key=0xc48520, key_len=140, mask=mask at entry=0x0,
    mask_len=mask_len at entry=0, stats=0x0, actions=actions at entry=0x0, actions_len=actions_len at entry=0, dpif=<optimized out>) at ../lib/dpif.c:1354
#7  0x00000000004453c9 in log_flow_del_message (dpif=dpif at entry=0xc489c0, del=del at entry=0x7fff0408f460, error=error at entry=2) at ../lib/dpif.c:1397
#8  0x0000000000445433 in log_flow_del_message (error=2, del=0x7fff0408f460, dpif=0xc489c0) at ../lib/dpif.c:1396
#9  dpif_flow_del__ (dpif=0xc489c0, del=del at entry=0x7fff0408f460) at ../lib/dpif.c:945
#10 0x00000000004455ca in dpif_flow_del (dpif=<optimized out>, key=<optimized out>, key_len=<optimized out>, stats=stats at entry=0x7fff0408f490) at ../lib/dpif.c:965
#11 0x000000000041b423 in subfacet_uninstall (subfacet=0xbd76a0) at ../ofproto/ofproto-dpif.c:4686
#12 0x0000000000420f18 in facet_remove (facet=facet at entry=0xbd72a0) at ../ofproto/ofproto-dpif.c:4014
#13 0x0000000000422f52 in facet_revalidate (facet=facet at entry=0xbd72a0) at ../ofproto/ofproto-dpif.c:4321
#14 0x0000000000424b5a in facet_lookup_valid (flow=0x7f3e700020a8, ofproto=0xc52600) at ../ofproto/ofproto-dpif.c:4203
#15 handle_flow_miss (n_ops=<synthetic pointer>, ops=0x7fff0408fb60, miss=0x7f3e70002090) at ../ofproto/ofproto-dpif.c:3339
#16 handle_flow_misses (fmb=fmb at entry=0x7f3e700008e0, backer=<optimized out>) at ../ofproto/ofproto-dpif.c:3410
#17 0x0000000000425196 in handle_upcalls (backer=<optimized out>) at ../ofproto/ofproto-dpif.c:3565
#18 dpif_backer_run_fast (backer=<optimized out>) at ../ofproto/ofproto-dpif.c:1007
#19 type_run_fast (type=<optimized out>) at ../ofproto/ofproto-dpif.c:1024
#20 0x00000000004122cf in ofproto_type_run_fast (datapath_type=<optimized out>, datapath_type at entry=0xc4ef20 "system") at ../ofproto/ofproto.c:1326
#21 0x00000000004081a5 in bridge_run_fast () at ../vswitchd/bridge.c:2318
#22 0x00000000004059c5 in main (argc=<optimized out>, argv=<optimized out>) at ../vswitchd/ovs-vswitchd.c:119
(gdb)



 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
> On 31 Mar 2015, at 22:04, Joe Stringer <joestringer at nicira.com> wrote:
> 
> Great, we're moving. Looks like the gdb version of this is working below. Do you get the gdb prompt from there? the command 'bt' should provide the backtrace we're after.
> 
> On 31 March 2015 at 12:52, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
> that brought us a step forward. thank Sab.
> 
> Important to know is:
> 
> I got 4 kvm servers, meshed with openvswitch. I use vxlan for tunnelling.
> 
> Sometimes when I restart a domain in kvm, 3 or 4 hosts crash at the same time.
> 
> I have STP enabled to avoid loops.
> 
> 
> this is the output now:
> 
> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
> Copyright (C) 2014 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
> This is free software: you are free to change and redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-linux-gnu".
> Type "show configuration" for configuration details.
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
> Find the GDB manual and other documentation resources online at:
> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
> For help, type "help".
> Type "apropos word" to search for commands related to "word"...
> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
> done.
> [New LWP 32725]
> [New LWP 32732]
> [New LWP 32726]
> [New LWP 32730]
> [New LWP 32727]
> [New LWP 32728]
> [New LWP 32729]
> [New LWP 32731]
> [Thread debugging using libthread_db enabled]
> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
> Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfi'.
> Program terminated with signal SIGSEGV, Segmentation fault.
> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
> 506	../lib/netlink.c: No such file or directory.
> 
> 
> root at nuv-vir-kvm-server-1 ~ # crash /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
> 
> crash 7.0.3
> Copyright (C) 2002-2013  Red Hat, Inc.
> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
> Copyright (C) 1999-2006  Hewlett-Packard Co
> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
> Copyright (C) 2005, 2011  NEC Corporation
> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
> This program is free software, covered by the GNU General Public License,
> and you are welcome to change it and/or distribute copies of it under
> certain conditions.  Enter "help copying" to see the conditions.
> This program has absolutely no warranty.  Enter "help warranty" for details.
> 
> 
> crash: /usr/sbin/ovs-vswitchd: no debugging data available
> 
> root at nuv-vir-kvm-server-1 ~ # ll /var/crash/ovs/
> Architecture         Date                 ExecutableTimestamp  ProcCwd              ProcStatus           UserGroups
> CoreDump             DistroRelease        ProblemType          ProcEnviron          Signal
> CrashCounter         ExecutablePath       ProcCmdline          ProcMaps             Uname
> 
>  <http://www.nuvula.ch/>
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch <http://www.nuvula.ch/>
> 
>> On 31 Mar 2015, at 21:45, Sabyasachi Sengupta <Sabyasachi.Sengupta at alcatel-lucent.com <mailto:Sabyasachi.Sengupta at alcatel-lucent.com>> wrote:
>> 
>> 
>> Typically Ubuntu does not unpack the crashes. Can you try apport-unpack?
>> # apport-unpack /var/crash/<name> <crash-dir>
>> 
>> On Tue, 31 Mar 2015, Marco Kuendig wrote:
>> 
>>> thanks Joe and Ben
>>> have done:
>>> 1. installed dgb symbols for kernel....doesn't help
>>> 2. installed debug symbols for openvswitch
>>> no change, gdb and crash still don't work for me. I'm not a dev, need
>>> more help to get that backtrace done.
>>> here some output:
>>> root at nuv-vir-kvm-server-1 ~ # crash
>>>  /usr/lib/debug/boot/vmlinux-3.13.0-48-generic
>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>> crash 7.0.3
>>> Copyright (C) 2002-2013  Red Hat, Inc.
>>> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
>>> Copyright (C) 1999-2006  Hewlett-Packard Co
>>> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
>>> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
>>> Copyright (C) 2005, 2011  NEC Corporation
>>> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
>>> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
>>> This program is free software, covered by the GNU General Public License,
>>> and you are welcome to change it and/or distribute copies of it under
>>> certain conditions.  Enter "help copying" to see the conditions.
>>> This program has absolutely no warranty.  Enter "help warranty" for
>>> details.
>>> crash: /var/crash/_usr_sbin_ovs-vswitchd.0.crash: not a supported file
>>> format
>>> Usage:
>>> 
>>>   crash [OPTION]... NAMELIST MEMORY-IMAGE  (dumpfile form)
>>>   crash [OPTION]... [NAMELIST]             (live system form)
>>> Enter "crash -h" for details.
>>> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>>> Copyright (C) 2014 Free Software Foundation, Inc.
>>> License GPLv3+: GNU GPL version 3 or later
>>> <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>>> This is free software: you are free to change and redistribute it.
>>> There is NO WARRANTY, to the extent permitted by law.  Type "show
>>> copying"
>>> and "show warranty" for details.
>>> This GDB was configured as "x86_64-linux-gnu".
>>> Type "show configuration" for configuration details.
>>> For bug reporting instructions, please see:
>>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>>> Find the GDB manual and other documentation resources online at:
>>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>>> For help, type "help".
>>> Type "apropos word" to search for commands related to "word"...
>>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
>>> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>>> done.
>>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File
>>> format not recognized
>>> (gdb) q
>>> root at nuv-vir-kvm-server-1 ~ #
>>> Nuvula AG
>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>> Marco's Google Hangout
>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>> 
>>>      On 31 Mar 2015, at 19:00, Joe Stringer
>>>      <joestringer at nicira.com <mailto:joestringer at nicira.com>> wrote:
>>> For the 'File format not recognized' problem, you might have better
>>> luck with the 'crash' utility.
>>> $ crash <binary> <crashdump>
>>> On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>>>      Have tried this:
>>> http://openvswitch.org/pipermail/discuss/2015-February/016582.html <http://openvswitch.org/pipermail/discuss/2015-February/016582.html>
>>> this is the output, so doesn't seem to be correct:
>>> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd
>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>>> Copyright (C) 2014 Free Software Foundation, Inc.
>>> License GPLv3+: GNU GPL version 3 or later
>>> <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>>> This is free software: you are free to change and
>>> redistribute it.
>>> There is NO WARRANTY, to the extent permitted by law.  Type
>>> "show copying"
>>> and "show warranty" for details.
>>> This GDB was configured as "x86_64-linux-gnu".
>>> Type "show configuration" for configuration details.
>>> For bug reporting instructions, please see:
>>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>>> Find the GDB manual and other documentation resources online
>>> at:
>>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>>> For help, type "help".
>>> Type "apropos word" to search for commands related to
>>> "word"...
>>> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging
>>> symbols found)...done.
>>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core
>>> dump: File format not recognized
>>> (gdb) bt
>>> No stack.
>>> (gdb) quit
>>> any more hints please ?
>>> thanks
>>> marco
>>> Nuvula AG
>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>> Marco's Google Hangout
>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>> 
>>>      On 31 Mar 2015, at 17:00, Ben Pfaff
>>>      <blp at nicira.com <mailto:blp at nicira.com>> wrote:
>>> Can you get a backtrace for these?
>>> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig
>>> <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>>>      Folks,
>>> any chance of having somebody look at these crash
>>> files ?
>>> I have several servers that are loosing network
>>> connectivity because of this.
>>> Downloads:
>>> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing <https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing>
>>> Thanks for any hint or fix
>>> marco
>>> Nuvula AG
>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>> Marco's Google Hangout
>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
>>> --
>>> "I don't normally do acked-by's.  I think it's my way
>>> of avoiding
>>> getting blamed when it all blows up." Andrew Morton
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/1212a6a3/attachment-0001.html>

From joestringer at nicira.com  Tue Mar 31 14:12:43 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Tue, 31 Mar 2015 14:12:43 -0700
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <321030EF-0481-4FD2-B979-8B0A63C3D19D@nuvula.ch>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
 <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
 <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>
 <alpine.OSX.1.10.1503311245160.389@sabyasg-mbp-02>
 <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>
 <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>
 <321030EF-0481-4FD2-B979-8B0A63C3D19D@nuvula.ch>
Message-ID: <CANr6G5weMs1tLeLmDSfb_yL9Gk6Zz88dy0XpZ99UjQVi+_w_Sw@mail.gmail.com>

James, I believe you were involved last time this bug came up, I wonder if
you ever got to the bottom of this?

---

This looks the same as a bug reported in October:

http://openvswitch.org/pipermail/discuss/2014-October/015429.html

Ben's assessment was that there is no logical issue in the code, so perhaps
there was weird code generation caused by GCC.


On 31 March 2015 at 13:05, Marco Kuendig <marco at nuvula.ch> wrote:

> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
> done.
> [New LWP 32725]
> [New LWP 32732]
> [New LWP 32726]
> [New LWP 32730]
> [New LWP 32727]
> [New LWP 32728]
> [New LWP 32729]
> [New LWP 32731]
> [Thread debugging using libthread_db enabled]
> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
> Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock
> -vconsole:emer -vsyslog:err -vfi'.
> Program terminated with signal SIGSEGV, Segmentation fault.
> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
> 506 ../lib/netlink.c: No such file or directory.
> (gdb) bt
> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
> #1  0x0000000000460473 in format_generic_odp_key (a=a at entry=0x0,
> ds=ds at entry=0x7fff0408f3b0) at ../lib/odp-util.c:767
> #2  0x0000000000460cd2 in format_odp_key_attr (a=a at entry=0xc485a4,
> ma=ma at entry=0x0, ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true)
>     at ../lib/odp-util.c:1332
> #3  0x00000000004609d7 in odp_flow_format (key=<optimized out>,
> key_len=40, mask=0x0, mask_len=0, ds=0x7fff0408f3b0, verbose=true) at
> ../lib/odp-util.c:1402
> #4  0x0000000000460fc4 in format_odp_key_attr (a=a at entry=0xc48580,
> ma=ma at entry=0x0, ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true)
> at ../lib/odp-util.c:987
> #5  0x00000000004609d7 in odp_flow_format (key=key at entry=0xc48520,
> key_len=key_len at entry=140, mask=mask at entry=0x0, mask_len=mask_len at entry=0,
>     ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true) at
> ../lib/odp-util.c:1402
> #6  0x00000000004450f3 in log_flow_message (error=error at entry=2,
> operation=operation at entry=0x4d0e73 "flow_del", key=0xc48520, key_len=140,
> mask=mask at entry=0x0,
>     mask_len=mask_len at entry=0, stats=0x0, actions=actions at entry=0x0,
> actions_len=actions_len at entry=0, dpif=<optimized out>) at
> ../lib/dpif.c:1354
> #7  0x00000000004453c9 in log_flow_del_message (dpif=dpif at entry=0xc489c0,
> del=del at entry=0x7fff0408f460, error=error at entry=2) at ../lib/dpif.c:1397
> #8  0x0000000000445433 in log_flow_del_message (error=2,
> del=0x7fff0408f460, dpif=0xc489c0) at ../lib/dpif.c:1396
> #9  dpif_flow_del__ (dpif=0xc489c0, del=del at entry=0x7fff0408f460) at
> ../lib/dpif.c:945
> #10 0x00000000004455ca in dpif_flow_del (dpif=<optimized out>,
> key=<optimized out>, key_len=<optimized out>, stats=stats at entry=0x7fff0408f490)
> at ../lib/dpif.c:965
> #11 0x000000000041b423 in subfacet_uninstall (subfacet=0xbd76a0) at
> ../ofproto/ofproto-dpif.c:4686
> #12 0x0000000000420f18 in facet_remove (facet=facet at entry=0xbd72a0) at
> ../ofproto/ofproto-dpif.c:4014
> #13 0x0000000000422f52 in facet_revalidate (facet=facet at entry=0xbd72a0)
> at ../ofproto/ofproto-dpif.c:4321
> #14 0x0000000000424b5a in facet_lookup_valid (flow=0x7f3e700020a8,
> ofproto=0xc52600) at ../ofproto/ofproto-dpif.c:4203
> #15 handle_flow_miss (n_ops=<synthetic pointer>, ops=0x7fff0408fb60,
> miss=0x7f3e70002090) at ../ofproto/ofproto-dpif.c:3339
> #16 handle_flow_misses (fmb=fmb at entry=0x7f3e700008e0, backer=<optimized
> out>) at ../ofproto/ofproto-dpif.c:3410
> #17 0x0000000000425196 in handle_upcalls (backer=<optimized out>) at
> ../ofproto/ofproto-dpif.c:3565
> #18 dpif_backer_run_fast (backer=<optimized out>) at
> ../ofproto/ofproto-dpif.c:1007
> #19 type_run_fast (type=<optimized out>) at ../ofproto/ofproto-dpif.c:1024
> #20 0x00000000004122cf in ofproto_type_run_fast (datapath_type=<optimized
> out>, datapath_type at entry=0xc4ef20 "system") at ../ofproto/ofproto.c:1326
> #21 0x00000000004081a5 in bridge_run_fast () at ../vswitchd/bridge.c:2318
> #22 0x00000000004059c5 in main (argc=<optimized out>, argv=<optimized
> out>) at ../vswitchd/ovs-vswitchd.c:119
> (gdb)
>
>
>
> [image: Nuvula AG] <http://www.nuvula.ch/>
>
> Marco Kuendig / CEO / Founder
> marco at nuvula.ch / +41 78 751 99 71
>
> Marco's Google Hangout
> <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>
> Nuvula AG - Hybrid Clouds
> Weierbachstrasse 7b 8193 Eglisau Switzerland
> http://www.nuvula.ch
>
> On 31 Mar 2015, at 22:04, Joe Stringer <joestringer at nicira.com> wrote:
>
> Great, we're moving. Looks like the gdb version of this is working below.
> Do you get the gdb prompt from there? the command 'bt' should provide the
> backtrace we're after.
>
> On 31 March 2015 at 12:52, Marco Kuendig <marco at nuvula.ch> wrote:
>
>> that brought us a step forward. thank Sab.
>>
>> Important to know is:
>>
>> I got 4 kvm servers, meshed with openvswitch. I use vxlan for tunnelling.
>>
>> Sometimes when I restart a domain in kvm, 3 or 4 hosts crash at the same
>> time.
>>
>> I have STP enabled to avoid loops.
>>
>>
>> this is the output now:
>>
>> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
>> /var/crash/ovs/CoreDump
>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>> Copyright (C) 2014 Free Software Foundation, Inc.
>> License GPLv3+: GNU GPL version 3 or later <
>> http://gnu.org/licenses/gpl.html>
>> This is free software: you are free to change and redistribute it.
>> There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
>> and "show warranty" for details.
>> This GDB was configured as "x86_64-linux-gnu".
>> Type "show configuration" for configuration details.
>> For bug reporting instructions, please see:
>> <http://www.gnu.org/software/gdb/bugs/>.
>> Find the GDB manual and other documentation resources online at:
>> <http://www.gnu.org/software/gdb/documentation/>.
>> For help, type "help".
>> Type "apropos word" to search for commands related to "word"...
>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
>> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>> done.
>> [New LWP 32725]
>> [New LWP 32732]
>> [New LWP 32726]
>> [New LWP 32730]
>> [New LWP 32727]
>> [New LWP 32728]
>> [New LWP 32729]
>> [New LWP 32731]
>> [Thread debugging using libthread_db enabled]
>> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
>> Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock
>> -vconsole:emer -vsyslog:err -vfi'.
>> Program terminated with signal SIGSEGV, Segmentation fault.
>> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
>> 506 ../lib/netlink.c: No such file or directory.
>>
>>
>> root at nuv-vir-kvm-server-1 ~ # crash /usr/sbin/ovs-vswitchd
>> /var/crash/ovs/CoreDump
>>
>> crash 7.0.3
>> Copyright (C) 2002-2013  Red Hat, Inc.
>> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
>> Copyright (C) 1999-2006  Hewlett-Packard Co
>> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
>> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
>> Copyright (C) 2005, 2011  NEC Corporation
>> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
>> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
>> This program is free software, covered by the GNU General Public License,
>> and you are welcome to change it and/or distribute copies of it under
>> certain conditions.  Enter "help copying" to see the conditions.
>> This program has absolutely no warranty.  Enter "help warranty" for
>> details.
>>
>>
>> crash: /usr/sbin/ovs-vswitchd: no debugging data available
>>
>> root at nuv-vir-kvm-server-1 ~ # ll /var/crash/ovs/
>> Architecture         Date                 ExecutableTimestamp  ProcCwd
>>            ProcStatus           UserGroups
>> CoreDump             DistroRelease        ProblemType
>>  ProcEnviron          Signal
>> CrashCounter         ExecutablePath       ProcCmdline          ProcMaps
>>           Uname
>>
>>
>> [image: Nuvula AG] <http://www.nuvula.ch/>
>>
>> Marco Kuendig / CEO / Founder
>> marco at nuvula.ch / +41 78 751 99 71
>>
>> Marco's Google Hangout
>> <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>>
>> Nuvula AG - Hybrid Clouds
>> Weierbachstrasse 7b 8193 Eglisau Switzerland
>> http://www.nuvula.ch
>>
>> On 31 Mar 2015, at 21:45, Sabyasachi Sengupta <
>> Sabyasachi.Sengupta at alcatel-lucent.com> wrote:
>>
>>
>> Typically Ubuntu does not unpack the crashes. Can you try apport-unpack?
>> # apport-unpack /var/crash/<name> <crash-dir>
>>
>> On Tue, 31 Mar 2015, Marco Kuendig wrote:
>>
>> thanks Joe and Ben
>> have done:
>> 1. installed dgb symbols for kernel....doesn't help
>> 2. installed debug symbols for openvswitch
>> no change, gdb and crash still don't work for me. I'm not a dev, need
>> more help to get that backtrace done.
>> here some output:
>> root at nuv-vir-kvm-server-1 ~ # crash
>>  /usr/lib/debug/boot/vmlinux-3.13.0-48-generic
>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>> crash 7.0.3
>> Copyright (C) 2002-2013  Red Hat, Inc.
>> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
>> Copyright (C) 1999-2006  Hewlett-Packard Co
>> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
>> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
>> Copyright (C) 2005, 2011  NEC Corporation
>> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
>> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
>> This program is free software, covered by the GNU General Public License,
>> and you are welcome to change it and/or distribute copies of it under
>> certain conditions.  Enter "help copying" to see the conditions.
>> This program has absolutely no warranty.  Enter "help warranty" for
>> details.
>> crash: /var/crash/_usr_sbin_ovs-vswitchd.0.crash: not a supported file
>> format
>> Usage:
>>
>>   crash [OPTION]... NAMELIST MEMORY-IMAGE  (dumpfile form)
>>   crash [OPTION]... [NAMELIST]             (live system form)
>> Enter "crash -h" for details.
>> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>> Copyright (C) 2014 Free Software Foundation, Inc.
>> License GPLv3+: GNU GPL version 3 or later
>> <http://gnu.org/licenses/gpl.html>
>> This is free software: you are free to change and redistribute it.
>> There is NO WARRANTY, to the extent permitted by law.  Type "show
>> copying"
>> and "show warranty" for details.
>> This GDB was configured as "x86_64-linux-gnu".
>> Type "show configuration" for configuration details.
>> For bug reporting instructions, please see:
>> <http://www.gnu.org/software/gdb/bugs/>.
>> Find the GDB manual and other documentation resources online at:
>> <http://www.gnu.org/software/gdb/documentation/>.
>> For help, type "help".
>> Type "apropos word" to search for commands related to "word"...
>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
>> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>> done.
>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File
>> format not recognized
>> (gdb) q
>> root at nuv-vir-kvm-server-1 ~ #
>> Nuvula AG
>> Marco Kuendig / CEO / Founder marco at nuvula.ch / +41 78 751 99 71
>> Marco's Google Hangout
>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland
>> http://www.nuvula.ch
>>
>>      On 31 Mar 2015, at 19:00, Joe Stringer
>>      <joestringer at nicira.com> wrote:
>> For the 'File format not recognized' problem, you might have better
>> luck with the 'crash' utility.
>> $ crash <binary> <crashdump>
>> On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch> wrote:
>>      Have tried this:
>> http://openvswitch.org/pipermail/discuss/2015-February/016582.html
>> this is the output, so doesn't seem to be correct:
>> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd
>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>> Copyright (C) 2014 Free Software Foundation, Inc.
>> License GPLv3+: GNU GPL version 3 or later
>> <http://gnu.org/licenses/gpl.html>
>> This is free software: you are free to change and
>> redistribute it.
>> There is NO WARRANTY, to the extent permitted by law.  Type
>> "show copying"
>> and "show warranty" for details.
>> This GDB was configured as "x86_64-linux-gnu".
>> Type "show configuration" for configuration details.
>> For bug reporting instructions, please see:
>> <http://www.gnu.org/software/gdb/bugs/>.
>> Find the GDB manual and other documentation resources online
>> at:
>> <http://www.gnu.org/software/gdb/documentation/>.
>> For help, type "help".
>> Type "apropos word" to search for commands related to
>> "word"...
>> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging
>> symbols found)...done.
>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core
>> dump: File format not recognized
>> (gdb) bt
>> No stack.
>> (gdb) quit
>> any more hints please ?
>> thanks
>> marco
>> Nuvula AG
>> Marco Kuendig / CEO / Founder marco at nuvula.ch / +41 78 751 99 71
>> Marco's Google Hangout
>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland
>> http://www.nuvula.ch
>>
>>      On 31 Mar 2015, at 17:00, Ben Pfaff
>>      <blp at nicira.com> wrote:
>> Can you get a backtrace for these?
>> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig
>> <marco at nuvula.ch> wrote:
>>      Folks,
>> any chance of having somebody look at these crash
>> files ?
>> I have several servers that are loosing network
>> connectivity because of this.
>> Downloads:
>>
>> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing
>> Thanks for any hint or fix
>> marco
>> Nuvula AG
>> Marco Kuendig / CEO / Founder marco at nuvula.ch / +41 78 751 99 71
>> Marco's Google Hangout
>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland
>> http://www.nuvula.ch
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>> --
>> "I don't normally do acked-by's.  I think it's my way
>> of avoiding
>> getting blamed when it all blows up." Andrew Morton
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/45d2dc59/attachment-0001.html>

From marco at nuvula.ch  Tue Mar 31 14:13:15 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 31 Mar 2015 23:13:15 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
 <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
 <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>
 <alpine.OSX.1.10.1503311245160.389@sabyasg-mbp-02>
 <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>
 <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>
Message-ID: <4A082406-ECE1-4CE0-B5CF-3FF8581C6157@nuvula.ch>

As I could not find too much on Google......Just for the benefit of others.....here a summary how I got that backtrace on Ubuntu 14.04 (with lots of help from Joe, Sab, Ben)

apt-get install gdb -y
apt-get install openvswitch-switch-dbgsym -y
apport-unpack /var/crash/_usr_sbin_ovs-vswitchd.0.crash /var/crash/ovs
gdb /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
bt

cheers
marco


 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
> On 31 Mar 2015, at 22:04, Joe Stringer <joestringer at nicira.com> wrote:
> 
> Great, we're moving. Looks like the gdb version of this is working below. Do you get the gdb prompt from there? the command 'bt' should provide the backtrace we're after.
> 
> On 31 March 2015 at 12:52, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
> that brought us a step forward. thank Sab.
> 
> Important to know is:
> 
> I got 4 kvm servers, meshed with openvswitch. I use vxlan for tunnelling.
> 
> Sometimes when I restart a domain in kvm, 3 or 4 hosts crash at the same time.
> 
> I have STP enabled to avoid loops.
> 
> 
> this is the output now:
> 
> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
> Copyright (C) 2014 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
> This is free software: you are free to change and redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-linux-gnu".
> Type "show configuration" for configuration details.
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
> Find the GDB manual and other documentation resources online at:
> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
> For help, type "help".
> Type "apropos word" to search for commands related to "word"...
> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
> done.
> [New LWP 32725]
> [New LWP 32732]
> [New LWP 32726]
> [New LWP 32730]
> [New LWP 32727]
> [New LWP 32728]
> [New LWP 32729]
> [New LWP 32731]
> [Thread debugging using libthread_db enabled]
> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
> Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfi'.
> Program terminated with signal SIGSEGV, Segmentation fault.
> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
> 506	../lib/netlink.c: No such file or directory.
> 
> 
> root at nuv-vir-kvm-server-1 ~ # crash /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
> 
> crash 7.0.3
> Copyright (C) 2002-2013  Red Hat, Inc.
> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
> Copyright (C) 1999-2006  Hewlett-Packard Co
> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
> Copyright (C) 2005, 2011  NEC Corporation
> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
> This program is free software, covered by the GNU General Public License,
> and you are welcome to change it and/or distribute copies of it under
> certain conditions.  Enter "help copying" to see the conditions.
> This program has absolutely no warranty.  Enter "help warranty" for details.
> 
> 
> crash: /usr/sbin/ovs-vswitchd: no debugging data available
> 
> root at nuv-vir-kvm-server-1 ~ # ll /var/crash/ovs/
> Architecture         Date                 ExecutableTimestamp  ProcCwd              ProcStatus           UserGroups
> CoreDump             DistroRelease        ProblemType          ProcEnviron          Signal
> CrashCounter         ExecutablePath       ProcCmdline          ProcMaps             Uname
> 
>  <http://www.nuvula.ch/>
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch <http://www.nuvula.ch/>
> 
>> On 31 Mar 2015, at 21:45, Sabyasachi Sengupta <Sabyasachi.Sengupta at alcatel-lucent.com <mailto:Sabyasachi.Sengupta at alcatel-lucent.com>> wrote:
>> 
>> 
>> Typically Ubuntu does not unpack the crashes. Can you try apport-unpack?
>> # apport-unpack /var/crash/<name> <crash-dir>
>> 
>> On Tue, 31 Mar 2015, Marco Kuendig wrote:
>> 
>>> thanks Joe and Ben
>>> have done:
>>> 1. installed dgb symbols for kernel....doesn't help
>>> 2. installed debug symbols for openvswitch
>>> no change, gdb and crash still don't work for me. I'm not a dev, need
>>> more help to get that backtrace done.
>>> here some output:
>>> root at nuv-vir-kvm-server-1 ~ # crash
>>>  /usr/lib/debug/boot/vmlinux-3.13.0-48-generic
>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>> crash 7.0.3
>>> Copyright (C) 2002-2013  Red Hat, Inc.
>>> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
>>> Copyright (C) 1999-2006  Hewlett-Packard Co
>>> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
>>> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
>>> Copyright (C) 2005, 2011  NEC Corporation
>>> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
>>> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
>>> This program is free software, covered by the GNU General Public License,
>>> and you are welcome to change it and/or distribute copies of it under
>>> certain conditions.  Enter "help copying" to see the conditions.
>>> This program has absolutely no warranty.  Enter "help warranty" for
>>> details.
>>> crash: /var/crash/_usr_sbin_ovs-vswitchd.0.crash: not a supported file
>>> format
>>> Usage:
>>> 
>>>   crash [OPTION]... NAMELIST MEMORY-IMAGE  (dumpfile form)
>>>   crash [OPTION]... [NAMELIST]             (live system form)
>>> Enter "crash -h" for details.
>>> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>>> Copyright (C) 2014 Free Software Foundation, Inc.
>>> License GPLv3+: GNU GPL version 3 or later
>>> <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>>> This is free software: you are free to change and redistribute it.
>>> There is NO WARRANTY, to the extent permitted by law.  Type "show
>>> copying"
>>> and "show warranty" for details.
>>> This GDB was configured as "x86_64-linux-gnu".
>>> Type "show configuration" for configuration details.
>>> For bug reporting instructions, please see:
>>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>>> Find the GDB manual and other documentation resources online at:
>>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>>> For help, type "help".
>>> Type "apropos word" to search for commands related to "word"...
>>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
>>> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>>> done.
>>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File
>>> format not recognized
>>> (gdb) q
>>> root at nuv-vir-kvm-server-1 ~ #
>>> Nuvula AG
>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>> Marco's Google Hangout
>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>> 
>>>      On 31 Mar 2015, at 19:00, Joe Stringer
>>>      <joestringer at nicira.com <mailto:joestringer at nicira.com>> wrote:
>>> For the 'File format not recognized' problem, you might have better
>>> luck with the 'crash' utility.
>>> $ crash <binary> <crashdump>
>>> On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>>>      Have tried this:
>>> http://openvswitch.org/pipermail/discuss/2015-February/016582.html <http://openvswitch.org/pipermail/discuss/2015-February/016582.html>
>>> this is the output, so doesn't seem to be correct:
>>> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd
>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>>> Copyright (C) 2014 Free Software Foundation, Inc.
>>> License GPLv3+: GNU GPL version 3 or later
>>> <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>>> This is free software: you are free to change and
>>> redistribute it.
>>> There is NO WARRANTY, to the extent permitted by law.  Type
>>> "show copying"
>>> and "show warranty" for details.
>>> This GDB was configured as "x86_64-linux-gnu".
>>> Type "show configuration" for configuration details.
>>> For bug reporting instructions, please see:
>>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>>> Find the GDB manual and other documentation resources online
>>> at:
>>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>>> For help, type "help".
>>> Type "apropos word" to search for commands related to
>>> "word"...
>>> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging
>>> symbols found)...done.
>>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core
>>> dump: File format not recognized
>>> (gdb) bt
>>> No stack.
>>> (gdb) quit
>>> any more hints please ?
>>> thanks
>>> marco
>>> Nuvula AG
>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>> Marco's Google Hangout
>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>> 
>>>      On 31 Mar 2015, at 17:00, Ben Pfaff
>>>      <blp at nicira.com <mailto:blp at nicira.com>> wrote:
>>> Can you get a backtrace for these?
>>> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig
>>> <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>>>      Folks,
>>> any chance of having somebody look at these crash
>>> files ?
>>> I have several servers that are loosing network
>>> connectivity because of this.
>>> Downloads:
>>> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing <https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing>
>>> Thanks for any hint or fix
>>> marco
>>> Nuvula AG
>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>> Marco's Google Hangout
>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
>>> --
>>> "I don't normally do acked-by's.  I think it's my way
>>> of avoiding
>>> getting blamed when it all blows up." Andrew Morton
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/46d11a9a/attachment-0001.html>

From marco at nuvula.ch  Tue Mar 31 14:15:11 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 31 Mar 2015 23:15:11 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <CANr6G5weMs1tLeLmDSfb_yL9Gk6Zz88dy0XpZ99UjQVi+_w_Sw@mail.gmail.com>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
 <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
 <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>
 <alpine.OSX.1.10.1503311245160.389@sabyasg-mbp-02>
 <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>
 <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>
 <321030EF-0481-4FD2-B979-8B0A63C3D19D@nuvula.ch>
 <CANr6G5weMs1tLeLmDSfb_yL9Gk6Zz88dy0XpZ99UjQVi+_w_Sw@mail.gmail.com>
Message-ID: <3FE537F0-F4E3-48CE-B0F5-93B9C95F11F9@nuvula.ch>

I think I can reproduce that bug. Not 100% sure but today I think I had it several times.

Interesting is that it happens when a VM on kvm boots. Certainly strange is that several hosts crash simultaneously.

My setup is a lab setup and can be accessed if it helps in troubleshooting.

 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
> On 31 Mar 2015, at 23:12, Joe Stringer <joestringer at nicira.com> wrote:
> 
> James, I believe you were involved last time this bug came up, I wonder if you ever got to the bottom of this?
> 
> ---
> 
> This looks the same as a bug reported in October:
> 
> http://openvswitch.org/pipermail/discuss/2014-October/015429.html <http://openvswitch.org/pipermail/discuss/2014-October/015429.html>
> 
> Ben's assessment was that there is no logical issue in the code, so perhaps there was weird code generation caused by GCC.
> 
> 
> On 31 March 2015 at 13:05, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
> done.
> [New LWP 32725]
> [New LWP 32732]
> [New LWP 32726]
> [New LWP 32730]
> [New LWP 32727]
> [New LWP 32728]
> [New LWP 32729]
> [New LWP 32731]
> [Thread debugging using libthread_db enabled]
> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
> Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfi'.
> Program terminated with signal SIGSEGV, Segmentation fault.
> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
> 506	../lib/netlink.c: No such file or directory.
> (gdb) bt
> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
> #1  0x0000000000460473 in format_generic_odp_key (a=a at entry=0x0, ds=ds at entry=0x7fff0408f3b0) at ../lib/odp-util.c:767
> #2  0x0000000000460cd2 in format_odp_key_attr (a=a at entry=0xc485a4, ma=ma at entry=0x0, ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true)
>     at ../lib/odp-util.c:1332
> #3  0x00000000004609d7 in odp_flow_format (key=<optimized out>, key_len=40, mask=0x0, mask_len=0, ds=0x7fff0408f3b0, verbose=true) at ../lib/odp-util.c:1402
> #4  0x0000000000460fc4 in format_odp_key_attr (a=a at entry=0xc48580, ma=ma at entry=0x0, ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true) at ../lib/odp-util.c:987
> #5  0x00000000004609d7 in odp_flow_format (key=key at entry=0xc48520, key_len=key_len at entry=140, mask=mask at entry=0x0, mask_len=mask_len at entry=0,
>     ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true) at ../lib/odp-util.c:1402
> #6  0x00000000004450f3 in log_flow_message (error=error at entry=2, operation=operation at entry=0x4d0e73 "flow_del", key=0xc48520, key_len=140, mask=mask at entry=0x0,
>     mask_len=mask_len at entry=0, stats=0x0, actions=actions at entry=0x0, actions_len=actions_len at entry=0, dpif=<optimized out>) at ../lib/dpif.c:1354
> #7  0x00000000004453c9 in log_flow_del_message (dpif=dpif at entry=0xc489c0, del=del at entry=0x7fff0408f460, error=error at entry=2) at ../lib/dpif.c:1397
> #8  0x0000000000445433 in log_flow_del_message (error=2, del=0x7fff0408f460, dpif=0xc489c0) at ../lib/dpif.c:1396
> #9  dpif_flow_del__ (dpif=0xc489c0, del=del at entry=0x7fff0408f460) at ../lib/dpif.c:945
> #10 0x00000000004455ca in dpif_flow_del (dpif=<optimized out>, key=<optimized out>, key_len=<optimized out>, stats=stats at entry=0x7fff0408f490) at ../lib/dpif.c:965
> #11 0x000000000041b423 in subfacet_uninstall (subfacet=0xbd76a0) at ../ofproto/ofproto-dpif.c:4686
> #12 0x0000000000420f18 in facet_remove (facet=facet at entry=0xbd72a0) at ../ofproto/ofproto-dpif.c:4014
> #13 0x0000000000422f52 in facet_revalidate (facet=facet at entry=0xbd72a0) at ../ofproto/ofproto-dpif.c:4321
> #14 0x0000000000424b5a in facet_lookup_valid (flow=0x7f3e700020a8, ofproto=0xc52600) at ../ofproto/ofproto-dpif.c:4203
> #15 handle_flow_miss (n_ops=<synthetic pointer>, ops=0x7fff0408fb60, miss=0x7f3e70002090) at ../ofproto/ofproto-dpif.c:3339
> #16 handle_flow_misses (fmb=fmb at entry=0x7f3e700008e0, backer=<optimized out>) at ../ofproto/ofproto-dpif.c:3410
> #17 0x0000000000425196 in handle_upcalls (backer=<optimized out>) at ../ofproto/ofproto-dpif.c:3565
> #18 dpif_backer_run_fast (backer=<optimized out>) at ../ofproto/ofproto-dpif.c:1007
> #19 type_run_fast (type=<optimized out>) at ../ofproto/ofproto-dpif.c:1024
> #20 0x00000000004122cf in ofproto_type_run_fast (datapath_type=<optimized out>, datapath_type at entry=0xc4ef20 "system") at ../ofproto/ofproto.c:1326
> #21 0x00000000004081a5 in bridge_run_fast () at ../vswitchd/bridge.c:2318
> #22 0x00000000004059c5 in main (argc=<optimized out>, argv=<optimized out>) at ../vswitchd/ovs-vswitchd.c:119
> (gdb)
> 
> 
> 
>  <http://www.nuvula.ch/>
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch <http://www.nuvula.ch/>
>> On 31 Mar 2015, at 22:04, Joe Stringer <joestringer at nicira.com <mailto:joestringer at nicira.com>> wrote:
>> 
>> Great, we're moving. Looks like the gdb version of this is working below. Do you get the gdb prompt from there? the command 'bt' should provide the backtrace we're after.
>> 
>> On 31 March 2015 at 12:52, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>> that brought us a step forward. thank Sab.
>> 
>> Important to know is:
>> 
>> I got 4 kvm servers, meshed with openvswitch. I use vxlan for tunnelling.
>> 
>> Sometimes when I restart a domain in kvm, 3 or 4 hosts crash at the same time.
>> 
>> I have STP enabled to avoid loops.
>> 
>> 
>> this is the output now:
>> 
>> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>> Copyright (C) 2014 Free Software Foundation, Inc.
>> License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>> This is free software: you are free to change and redistribute it.
>> There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
>> and "show warranty" for details.
>> This GDB was configured as "x86_64-linux-gnu".
>> Type "show configuration" for configuration details.
>> For bug reporting instructions, please see:
>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>> Find the GDB manual and other documentation resources online at:
>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>> For help, type "help".
>> Type "apropos word" to search for commands related to "word"...
>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>> done.
>> [New LWP 32725]
>> [New LWP 32732]
>> [New LWP 32726]
>> [New LWP 32730]
>> [New LWP 32727]
>> [New LWP 32728]
>> [New LWP 32729]
>> [New LWP 32731]
>> [Thread debugging using libthread_db enabled]
>> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
>> Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfi'.
>> Program terminated with signal SIGSEGV, Segmentation fault.
>> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
>> 506	../lib/netlink.c: No such file or directory.
>> 
>> 
>> root at nuv-vir-kvm-server-1 ~ # crash /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
>> 
>> crash 7.0.3
>> Copyright (C) 2002-2013  Red Hat, Inc.
>> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
>> Copyright (C) 1999-2006  Hewlett-Packard Co
>> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
>> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
>> Copyright (C) 2005, 2011  NEC Corporation
>> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
>> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
>> This program is free software, covered by the GNU General Public License,
>> and you are welcome to change it and/or distribute copies of it under
>> certain conditions.  Enter "help copying" to see the conditions.
>> This program has absolutely no warranty.  Enter "help warranty" for details.
>> 
>> 
>> crash: /usr/sbin/ovs-vswitchd: no debugging data available
>> 
>> root at nuv-vir-kvm-server-1 ~ # ll /var/crash/ovs/
>> Architecture         Date                 ExecutableTimestamp  ProcCwd              ProcStatus           UserGroups
>> CoreDump             DistroRelease        ProblemType          ProcEnviron          Signal
>> CrashCounter         ExecutablePath       ProcCmdline          ProcMaps             Uname
>> 
>>  <http://www.nuvula.ch/>
>> Marco Kuendig / CEO / Founder 
>> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>> Nuvula AG - Hybrid Clouds 
>> Weierbachstrasse 7b 8193 Eglisau Switzerland 
>> http://www.nuvula.ch <http://www.nuvula.ch/>
>> 
>>> On 31 Mar 2015, at 21:45, Sabyasachi Sengupta <Sabyasachi.Sengupta at alcatel-lucent.com <mailto:Sabyasachi.Sengupta at alcatel-lucent.com>> wrote:
>>> 
>>> 
>>> Typically Ubuntu does not unpack the crashes. Can you try apport-unpack?
>>> # apport-unpack /var/crash/<name> <crash-dir>
>>> 
>>> On Tue, 31 Mar 2015, Marco Kuendig wrote:
>>> 
>>>> thanks Joe and Ben
>>>> have done:
>>>> 1. installed dgb symbols for kernel....doesn't help
>>>> 2. installed debug symbols for openvswitch
>>>> no change, gdb and crash still don't work for me. I'm not a dev, need
>>>> more help to get that backtrace done.
>>>> here some output:
>>>> root at nuv-vir-kvm-server-1 ~ # crash
>>>>  /usr/lib/debug/boot/vmlinux-3.13.0-48-generic
>>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>>> crash 7.0.3
>>>> Copyright (C) 2002-2013  Red Hat, Inc.
>>>> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
>>>> Copyright (C) 1999-2006  Hewlett-Packard Co
>>>> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
>>>> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
>>>> Copyright (C) 2005, 2011  NEC Corporation
>>>> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
>>>> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
>>>> This program is free software, covered by the GNU General Public License,
>>>> and you are welcome to change it and/or distribute copies of it under
>>>> certain conditions.  Enter "help copying" to see the conditions.
>>>> This program has absolutely no warranty.  Enter "help warranty" for
>>>> details.
>>>> crash: /var/crash/_usr_sbin_ovs-vswitchd.0.crash: not a supported file
>>>> format
>>>> Usage:
>>>> 
>>>>   crash [OPTION]... NAMELIST MEMORY-IMAGE  (dumpfile form)
>>>>   crash [OPTION]... [NAMELIST]             (live system form)
>>>> Enter "crash -h" for details.
>>>> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
>>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>>>> Copyright (C) 2014 Free Software Foundation, Inc.
>>>> License GPLv3+: GNU GPL version 3 or later
>>>> <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>>>> This is free software: you are free to change and redistribute it.
>>>> There is NO WARRANTY, to the extent permitted by law.  Type "show
>>>> copying"
>>>> and "show warranty" for details.
>>>> This GDB was configured as "x86_64-linux-gnu".
>>>> Type "show configuration" for configuration details.
>>>> For bug reporting instructions, please see:
>>>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>>>> Find the GDB manual and other documentation resources online at:
>>>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>>>> For help, type "help".
>>>> Type "apropos word" to search for commands related to "word"...
>>>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
>>>> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>>>> done.
>>>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File
>>>> format not recognized
>>>> (gdb) q
>>>> root at nuv-vir-kvm-server-1 ~ #
>>>> Nuvula AG
>>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>>> Marco's Google Hangout
>>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>>> 
>>>>      On 31 Mar 2015, at 19:00, Joe Stringer
>>>>      <joestringer at nicira.com <mailto:joestringer at nicira.com>> wrote:
>>>> For the 'File format not recognized' problem, you might have better
>>>> luck with the 'crash' utility.
>>>> $ crash <binary> <crashdump>
>>>> On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>>>>      Have tried this:
>>>> http://openvswitch.org/pipermail/discuss/2015-February/016582.html <http://openvswitch.org/pipermail/discuss/2015-February/016582.html>
>>>> this is the output, so doesn't seem to be correct:
>>>> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd
>>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>>>> Copyright (C) 2014 Free Software Foundation, Inc.
>>>> License GPLv3+: GNU GPL version 3 or later
>>>> <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>>>> This is free software: you are free to change and
>>>> redistribute it.
>>>> There is NO WARRANTY, to the extent permitted by law.  Type
>>>> "show copying"
>>>> and "show warranty" for details.
>>>> This GDB was configured as "x86_64-linux-gnu".
>>>> Type "show configuration" for configuration details.
>>>> For bug reporting instructions, please see:
>>>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>>>> Find the GDB manual and other documentation resources online
>>>> at:
>>>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>>>> For help, type "help".
>>>> Type "apropos word" to search for commands related to
>>>> "word"...
>>>> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging
>>>> symbols found)...done.
>>>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core
>>>> dump: File format not recognized
>>>> (gdb) bt
>>>> No stack.
>>>> (gdb) quit
>>>> any more hints please ?
>>>> thanks
>>>> marco
>>>> Nuvula AG
>>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>>> Marco's Google Hangout
>>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>>> 
>>>>      On 31 Mar 2015, at 17:00, Ben Pfaff
>>>>      <blp at nicira.com <mailto:blp at nicira.com>> wrote:
>>>> Can you get a backtrace for these?
>>>> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig
>>>> <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>>>>      Folks,
>>>> any chance of having somebody look at these crash
>>>> files ?
>>>> I have several servers that are loosing network
>>>> connectivity because of this.
>>>> Downloads:
>>>> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing <https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing>
>>>> Thanks for any hint or fix
>>>> marco
>>>> Nuvula AG
>>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>>> Marco's Google Hangout
>>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>>> _______________________________________________
>>>> discuss mailing list
>>>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>>>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
>>>> --
>>>> "I don't normally do acked-by's.  I think it's my way
>>>> of avoiding
>>>> getting blamed when it all blows up." Andrew Morton
>>>> _______________________________________________
>>>> discuss mailing list
>>>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>>>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
>> 
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/5e7ade4b/attachment-0001.html>

From marco at nuvula.ch  Tue Mar 31 14:43:24 2015
From: marco at nuvula.ch (Marco Kuendig)
Date: Tue, 31 Mar 2015 23:43:24 +0200
Subject: [ovs-discuss] Crash in openvswitch 2.0.2
In-Reply-To: <68DDEDA0-481E-49EF-BB94-7FD9AE7373EF@nuvula.ch>
References: <40952DEC-8655-4B97-9B71-1DBD65E11138@nuvula.ch>
 <CACjuMbx+-uhyvpX1tyPhsdyVtT3DFDd8Kq_LAH-7iKhaz-UmkA@mail.gmail.com>
 <8C992B4E-8AA6-46A2-863D-9C9FBC6D4D16@nuvula.ch>
 <CANr6G5yB6jiYD+fwYhtPDh3bxams3PNTZLqd25DVcyU1hxmquw@mail.gmail.com>
 <B32CB78D-2CF9-4F47-9515-C8A206C090A2@nuvula.ch>
 <alpine.OSX.1.10.1503311245160.389@sabyasg-mbp-02>
 <41FBC0F8-2336-444C-B08F-6736F73E6FA6@nuvula.ch>
 <CANr6G5zJFBDX1rWL6e2++ije4ucCMmViCv=0vrKn+zz62JDKsA@mail.gmail.com>
 <321030EF-0481-4FD2-B979-8B0A63C3D19D@nuvula.ch>
 <CANr6G5weMs1tLeLmDSfb_yL9Gk6Zz88dy0XpZ99UjQVi+_w_Sw@mail.gmail.com>
 <68DDEDA0-481E-49EF-BB94-7FD9AE7373EF@nuvula.ch>
Message-ID: <20DD9129-AEDD-4FC6-BFD5-A8F10545230B@nuvula.ch>

ok, I have tested it and I can reproduce it. 

For testing to reproduce that core: 

I have a very small VM on KVM, I start and shutdown that VM every 30 seconds. With that I get:

Mar 31 16:10:13 nuv-vir-kvm-server-1 ovs-vswitchd: ovs|00010|daemon(monitor)|ERR|9 crashes: pid 10918 died, killed (Segmentation fault), core dumped, restarting
Mar 31 16:29:20 nuv-vir-kvm-server-1 ovs-vswitchd: ovs|00011|daemon(monitor)|ERR|10 crashes: pid 22038 died, killed (Segmentation fault), core dumped, restarting
Mar 31 23:33:04 nuv-vir-kvm-server-1 ovs-vswitchd: ovs|00012|daemon(monitor)|ERR|11 crashes: pid 25067 died, killed (Segmentation fault), core dumped, restarting
Mar 31 23:34:43 nuv-vir-kvm-server-1 ovs-vswitchd: ovs|00013|daemon(monitor)|ERR|12 crashes: pid 30254 died, killed (Segmentation fault), core dumped, restarting
Mar 31 23:38:49 nuv-vir-kvm-server-1 ovs-vswitchd: ovs|00014|daemon(monitor)|ERR|13 crashes: pid 31612 died, killed (Segmentation fault), core dumped, restarting

The ovs-vswitchd does not restart every cycle but it cores quite often as you can see in the log above.



 <http://www.nuvula.ch/>
Marco Kuendig / CEO / Founder 
marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71

Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
Nuvula AG - Hybrid Clouds 
Weierbachstrasse 7b 8193 Eglisau Switzerland 
http://www.nuvula.ch <http://www.nuvula.ch/>
> On 31 Mar 2015, at 23:15, Marco Kuendig <marco at nuvula.ch> wrote:
> 
> I think I can reproduce that bug. Not 100% sure but today I think I had it several times.
> 
> Interesting is that it happens when a VM on kvm boots. Certainly strange is that several hosts crash simultaneously.
> 
> My setup is a lab setup and can be accessed if it helps in troubleshooting.
> 
>  <http://www.nuvula.ch/>
> Marco Kuendig / CEO / Founder 
> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71
> 
> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
> Nuvula AG - Hybrid Clouds 
> Weierbachstrasse 7b 8193 Eglisau Switzerland 
> http://www.nuvula.ch <http://www.nuvula.ch/>
>> On 31 Mar 2015, at 23:12, Joe Stringer <joestringer at nicira.com> wrote:
>> 
>> James, I believe you were involved last time this bug came up, I wonder if you ever got to the bottom of this?
>> 
>> ---
>> 
>> This looks the same as a bug reported in October:
>> 
>> http://openvswitch.org/pipermail/discuss/2014-October/015429.html <http://openvswitch.org/pipermail/discuss/2014-October/015429.html>
>> 
>> Ben's assessment was that there is no logical issue in the code, so perhaps there was weird code generation caused by GCC.
>> 
>> 
>> On 31 March 2015 at 13:05, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>> done.
>> [New LWP 32725]
>> [New LWP 32732]
>> [New LWP 32726]
>> [New LWP 32730]
>> [New LWP 32727]
>> [New LWP 32728]
>> [New LWP 32729]
>> [New LWP 32731]
>> [Thread debugging using libthread_db enabled]
>> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
>> Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfi'.
>> Program terminated with signal SIGSEGV, Segmentation fault.
>> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
>> 506	../lib/netlink.c: No such file or directory.
>> (gdb) bt
>> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
>> #1  0x0000000000460473 in format_generic_odp_key (a=a at entry=0x0, ds=ds at entry=0x7fff0408f3b0) at ../lib/odp-util.c:767
>> #2  0x0000000000460cd2 in format_odp_key_attr (a=a at entry=0xc485a4, ma=ma at entry=0x0, ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true)
>>     at ../lib/odp-util.c:1332
>> #3  0x00000000004609d7 in odp_flow_format (key=<optimized out>, key_len=40, mask=0x0, mask_len=0, ds=0x7fff0408f3b0, verbose=true) at ../lib/odp-util.c:1402
>> #4  0x0000000000460fc4 in format_odp_key_attr (a=a at entry=0xc48580, ma=ma at entry=0x0, ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true) at ../lib/odp-util.c:987
>> #5  0x00000000004609d7 in odp_flow_format (key=key at entry=0xc48520, key_len=key_len at entry=140, mask=mask at entry=0x0, mask_len=mask_len at entry=0,
>>     ds=ds at entry=0x7fff0408f3b0, verbose=verbose at entry=true) at ../lib/odp-util.c:1402
>> #6  0x00000000004450f3 in log_flow_message (error=error at entry=2, operation=operation at entry=0x4d0e73 "flow_del", key=0xc48520, key_len=140, mask=mask at entry=0x0,
>>     mask_len=mask_len at entry=0, stats=0x0, actions=actions at entry=0x0, actions_len=actions_len at entry=0, dpif=<optimized out>) at ../lib/dpif.c:1354
>> #7  0x00000000004453c9 in log_flow_del_message (dpif=dpif at entry=0xc489c0, del=del at entry=0x7fff0408f460, error=error at entry=2) at ../lib/dpif.c:1397
>> #8  0x0000000000445433 in log_flow_del_message (error=2, del=0x7fff0408f460, dpif=0xc489c0) at ../lib/dpif.c:1396
>> #9  dpif_flow_del__ (dpif=0xc489c0, del=del at entry=0x7fff0408f460) at ../lib/dpif.c:945
>> #10 0x00000000004455ca in dpif_flow_del (dpif=<optimized out>, key=<optimized out>, key_len=<optimized out>, stats=stats at entry=0x7fff0408f490) at ../lib/dpif.c:965
>> #11 0x000000000041b423 in subfacet_uninstall (subfacet=0xbd76a0) at ../ofproto/ofproto-dpif.c:4686
>> #12 0x0000000000420f18 in facet_remove (facet=facet at entry=0xbd72a0) at ../ofproto/ofproto-dpif.c:4014
>> #13 0x0000000000422f52 in facet_revalidate (facet=facet at entry=0xbd72a0) at ../ofproto/ofproto-dpif.c:4321
>> #14 0x0000000000424b5a in facet_lookup_valid (flow=0x7f3e700020a8, ofproto=0xc52600) at ../ofproto/ofproto-dpif.c:4203
>> #15 handle_flow_miss (n_ops=<synthetic pointer>, ops=0x7fff0408fb60, miss=0x7f3e70002090) at ../ofproto/ofproto-dpif.c:3339
>> #16 handle_flow_misses (fmb=fmb at entry=0x7f3e700008e0, backer=<optimized out>) at ../ofproto/ofproto-dpif.c:3410
>> #17 0x0000000000425196 in handle_upcalls (backer=<optimized out>) at ../ofproto/ofproto-dpif.c:3565
>> #18 dpif_backer_run_fast (backer=<optimized out>) at ../ofproto/ofproto-dpif.c:1007
>> #19 type_run_fast (type=<optimized out>) at ../ofproto/ofproto-dpif.c:1024
>> #20 0x00000000004122cf in ofproto_type_run_fast (datapath_type=<optimized out>, datapath_type at entry=0xc4ef20 "system") at ../ofproto/ofproto.c:1326
>> #21 0x00000000004081a5 in bridge_run_fast () at ../vswitchd/bridge.c:2318
>> #22 0x00000000004059c5 in main (argc=<optimized out>, argv=<optimized out>) at ../vswitchd/ovs-vswitchd.c:119
>> (gdb)
>> 
>> 
>> 
>>  <http://www.nuvula.ch/>
>> Marco Kuendig / CEO / Founder 
>> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>> Nuvula AG - Hybrid Clouds 
>> Weierbachstrasse 7b 8193 Eglisau Switzerland 
>> http://www.nuvula.ch <http://www.nuvula.ch/>
>>> On 31 Mar 2015, at 22:04, Joe Stringer <joestringer at nicira.com <mailto:joestringer at nicira.com>> wrote:
>>> 
>>> Great, we're moving. Looks like the gdb version of this is working below. Do you get the gdb prompt from there? the command 'bt' should provide the backtrace we're after.
>>> 
>>> On 31 March 2015 at 12:52, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>>> that brought us a step forward. thank Sab.
>>> 
>>> Important to know is:
>>> 
>>> I got 4 kvm servers, meshed with openvswitch. I use vxlan for tunnelling.
>>> 
>>> Sometimes when I restart a domain in kvm, 3 or 4 hosts crash at the same time.
>>> 
>>> I have STP enabled to avoid loops.
>>> 
>>> 
>>> this is the output now:
>>> 
>>> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
>>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>>> Copyright (C) 2014 Free Software Foundation, Inc.
>>> License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>>> This is free software: you are free to change and redistribute it.
>>> There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
>>> and "show warranty" for details.
>>> This GDB was configured as "x86_64-linux-gnu".
>>> Type "show configuration" for configuration details.
>>> For bug reporting instructions, please see:
>>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>>> Find the GDB manual and other documentation resources online at:
>>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>>> For help, type "help".
>>> Type "apropos word" to search for commands related to "word"...
>>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>>> done.
>>> [New LWP 32725]
>>> [New LWP 32732]
>>> [New LWP 32726]
>>> [New LWP 32730]
>>> [New LWP 32727]
>>> [New LWP 32728]
>>> [New LWP 32729]
>>> [New LWP 32731]
>>> [Thread debugging using libthread_db enabled]
>>> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
>>> Core was generated by `ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfi'.
>>> Program terminated with signal SIGSEGV, Segmentation fault.
>>> #0  nl_attr_get_size (nla=nla at entry=0x0) at ../lib/netlink.c:506
>>> 506	../lib/netlink.c: No such file or directory.
>>> 
>>> 
>>> root at nuv-vir-kvm-server-1 ~ # crash /usr/sbin/ovs-vswitchd /var/crash/ovs/CoreDump
>>> 
>>> crash 7.0.3
>>> Copyright (C) 2002-2013  Red Hat, Inc.
>>> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
>>> Copyright (C) 1999-2006  Hewlett-Packard Co
>>> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
>>> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
>>> Copyright (C) 2005, 2011  NEC Corporation
>>> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
>>> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
>>> This program is free software, covered by the GNU General Public License,
>>> and you are welcome to change it and/or distribute copies of it under
>>> certain conditions.  Enter "help copying" to see the conditions.
>>> This program has absolutely no warranty.  Enter "help warranty" for details.
>>> 
>>> 
>>> crash: /usr/sbin/ovs-vswitchd: no debugging data available
>>> 
>>> root at nuv-vir-kvm-server-1 ~ # ll /var/crash/ovs/
>>> Architecture         Date                 ExecutableTimestamp  ProcCwd              ProcStatus           UserGroups
>>> CoreDump             DistroRelease        ProblemType          ProcEnviron          Signal
>>> CrashCounter         ExecutablePath       ProcCmdline          ProcMaps             Uname
>>> 
>>>  <http://www.nuvula.ch/>
>>> Marco Kuendig / CEO / Founder 
>>> marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>> Marco's Google Hangout <https://plus.google.com/hangouts/_/nuvula.ch/marco>
>>> Nuvula AG - Hybrid Clouds 
>>> Weierbachstrasse 7b 8193 Eglisau Switzerland 
>>> http://www.nuvula.ch <http://www.nuvula.ch/>
>>> 
>>>> On 31 Mar 2015, at 21:45, Sabyasachi Sengupta <Sabyasachi.Sengupta at alcatel-lucent.com <mailto:Sabyasachi.Sengupta at alcatel-lucent.com>> wrote:
>>>> 
>>>> 
>>>> Typically Ubuntu does not unpack the crashes. Can you try apport-unpack?
>>>> # apport-unpack /var/crash/<name> <crash-dir>
>>>> 
>>>> On Tue, 31 Mar 2015, Marco Kuendig wrote:
>>>> 
>>>>> thanks Joe and Ben
>>>>> have done:
>>>>> 1. installed dgb symbols for kernel....doesn't help
>>>>> 2. installed debug symbols for openvswitch
>>>>> no change, gdb and crash still don't work for me. I'm not a dev, need
>>>>> more help to get that backtrace done.
>>>>> here some output:
>>>>> root at nuv-vir-kvm-server-1 ~ # crash
>>>>>  /usr/lib/debug/boot/vmlinux-3.13.0-48-generic
>>>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>>>> crash 7.0.3
>>>>> Copyright (C) 2002-2013  Red Hat, Inc.
>>>>> Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation
>>>>> Copyright (C) 1999-2006  Hewlett-Packard Co
>>>>> Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited
>>>>> Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.
>>>>> Copyright (C) 2005, 2011  NEC Corporation
>>>>> Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.
>>>>> Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.
>>>>> This program is free software, covered by the GNU General Public License,
>>>>> and you are welcome to change it and/or distribute copies of it under
>>>>> certain conditions.  Enter "help copying" to see the conditions.
>>>>> This program has absolutely no warranty.  Enter "help warranty" for
>>>>> details.
>>>>> crash: /var/crash/_usr_sbin_ovs-vswitchd.0.crash: not a supported file
>>>>> format
>>>>> Usage:
>>>>> 
>>>>>   crash [OPTION]... NAMELIST MEMORY-IMAGE  (dumpfile form)
>>>>>   crash [OPTION]... [NAMELIST]             (live system form)
>>>>> Enter "crash -h" for details.
>>>>> root at nuv-vir-kvm-server-1 ~ # gdb /usr/sbin/ovs-vswitchd
>>>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>>>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>>>>> Copyright (C) 2014 Free Software Foundation, Inc.
>>>>> License GPLv3+: GNU GPL version 3 or later
>>>>> <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>>>>> This is free software: you are free to change and redistribute it.
>>>>> There is NO WARRANTY, to the extent permitted by law.  Type "show
>>>>> copying"
>>>>> and "show warranty" for details.
>>>>> This GDB was configured as "x86_64-linux-gnu".
>>>>> Type "show configuration" for configuration details.
>>>>> For bug reporting instructions, please see:
>>>>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>>>>> Find the GDB manual and other documentation resources online at:
>>>>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>>>>> For help, type "help".
>>>>> Type "apropos word" to search for commands related to "word"...
>>>>> Reading symbols from /usr/sbin/ovs-vswitchd...Reading symbols from
>>>>> /usr/lib/debug//usr/sbin/ovs-vswitchd...done.
>>>>> done.
>>>>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core dump: File
>>>>> format not recognized
>>>>> (gdb) q
>>>>> root at nuv-vir-kvm-server-1 ~ #
>>>>> Nuvula AG
>>>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>>>> Marco's Google Hangout
>>>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>>>> 
>>>>>      On 31 Mar 2015, at 19:00, Joe Stringer
>>>>>      <joestringer at nicira.com <mailto:joestringer at nicira.com>> wrote:
>>>>> For the 'File format not recognized' problem, you might have better
>>>>> luck with the 'crash' utility.
>>>>> $ crash <binary> <crashdump>
>>>>> On 31 March 2015 at 08:16, Marco Kuendig <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>>>>>      Have tried this:
>>>>> http://openvswitch.org/pipermail/discuss/2015-February/016582.html <http://openvswitch.org/pipermail/discuss/2015-February/016582.html>
>>>>> this is the output, so doesn't seem to be correct:
>>>>> root at nuv-vir-kvm-server-2 ~ # gdb /usr/sbin/ovs-vswitchd
>>>>> /var/crash/_usr_sbin_ovs-vswitchd.0.crash
>>>>> GNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1
>>>>> Copyright (C) 2014 Free Software Foundation, Inc.
>>>>> License GPLv3+: GNU GPL version 3 or later
>>>>> <http://gnu.org/licenses/gpl.html <http://gnu.org/licenses/gpl.html>>
>>>>> This is free software: you are free to change and
>>>>> redistribute it.
>>>>> There is NO WARRANTY, to the extent permitted by law.  Type
>>>>> "show copying"
>>>>> and "show warranty" for details.
>>>>> This GDB was configured as "x86_64-linux-gnu".
>>>>> Type "show configuration" for configuration details.
>>>>> For bug reporting instructions, please see:
>>>>> <http://www.gnu.org/software/gdb/bugs/ <http://www.gnu.org/software/gdb/bugs/>>.
>>>>> Find the GDB manual and other documentation resources online
>>>>> at:
>>>>> <http://www.gnu.org/software/gdb/documentation/ <http://www.gnu.org/software/gdb/documentation/>>.
>>>>> For help, type "help".
>>>>> Type "apropos word" to search for commands related to
>>>>> "word"...
>>>>> Reading symbols from /usr/sbin/ovs-vswitchd...(no debugging
>>>>> symbols found)...done.
>>>>> "/var/crash/_usr_sbin_ovs-vswitchd.0.crash" is not a core
>>>>> dump: File format not recognized
>>>>> (gdb) bt
>>>>> No stack.
>>>>> (gdb) quit
>>>>> any more hints please ?
>>>>> thanks
>>>>> marco
>>>>> Nuvula AG
>>>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>>>> Marco's Google Hangout
>>>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>>>> 
>>>>>      On 31 Mar 2015, at 17:00, Ben Pfaff
>>>>>      <blp at nicira.com <mailto:blp at nicira.com>> wrote:
>>>>> Can you get a backtrace for these?
>>>>> On Tue, Mar 31, 2015 at 7:09 AM, Marco Kuendig
>>>>> <marco at nuvula.ch <mailto:marco at nuvula.ch>> wrote:
>>>>>      Folks,
>>>>> any chance of having somebody look at these crash
>>>>> files ?
>>>>> I have several servers that are loosing network
>>>>> connectivity because of this.
>>>>> Downloads:
>>>>> https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing <https://drive.google.com/file/d/0Bx_w1Tf2B5VSRU9yUmRpTDJLVEU/view?usp=sharing>
>>>>> Thanks for any hint or fix
>>>>> marco
>>>>> Nuvula AG
>>>>> Marco Kuendig / CEO / Founder marco at nuvula.ch <mailto:marco at nuvula.ch> / +41 78 751 99 71 <tel:%2B41%2078%20751%2099%2071>
>>>>> Marco's Google Hangout
>>>>> Nuvula AG - Hybrid Clouds Weierbachstrasse 7b 8193 Eglisau Switzerland http://www.nuvula.ch <http://www.nuvula.ch/>
>>>>> _______________________________________________
>>>>> discuss mailing list
>>>>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>>>>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
>>>>> --
>>>>> "I don't normally do acked-by's.  I think it's my way
>>>>> of avoiding
>>>>> getting blamed when it all blows up." Andrew Morton
>>>>> _______________________________________________
>>>>> discuss mailing list
>>>>> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
>>>>> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
>>> 
>> 
>> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150331/22a8eeef/attachment-0001.html>

From amer7777 at hotmail.com  Tue Mar 31 22:17:58 2015
From: amer7777 at hotmail.com (Amer)
Date: Wed, 1 Apr 2015 08:17:58 +0300
Subject: [ovs-discuss] SDN topology.
In-Reply-To: <1427810799214.94157@supcom.tn>
References: <1427810799214.94157@supcom.tn>
Message-ID: <BLU437-SMTP72C88B8D658C1D0BDE3B4FD4F30@phx.gbl>

Dear Amal

First, try with simple scenario

To connect between VMs you need to use internal-network and assign each VM to the same internal-network, then you need the IPs are in the same subnet for each two VMs.
Also, you need to crest a bridge in each OVS, like br0, then assign some interfaces to the bridge, like add-port br0 eth0, after that, give zero IP address to these interfaces, like ifconfig eth0 0, thereafter, give the bridge an IP address, like ifconfig eth0 192xxxxxxxxx netmask xxxxx.
The bridge IP needs to be written in the main interface configuration file.
To do this you need to search in this archive, I remember someone before few weeks discussed this issue and you will find my name there.
After this setup connecting each OVS to different controller will be easier.

Best regards,
Amer

> On Mar 31, 2015, at 5:05 PM, Amal KAMMOUN <amal.kammoun at supcom.tn> wrote:
> 
> Hello all!
> 
> 
> I'm trying to construct the following topology:
> 
> 
> 
>        VM1-  OpenFlowController1                            VM2- OpenflowController2
> 
>                             |                                                                     |
>                             |                                                                     |
> 
>                             |                                                                     |
>                             |                                                                     |
> 
>               VM3 ----------                                                  VM4 ----------
>                       | OVS1|----------------------------------------------------------| OVS2|
> 
>                       -----------                                                           -----------  
>                             |                                                                     |
> 
>                             |                                                                     |
> 
>                             |                                                                     |
> 
>                        Host:VM-5                                                 Host:VM-6
> 
> 
> 
> All my virtual machines are made by VirtualBox.
> 
> 
> It is possible to build such topology?
> 
> 
> How can I connect 2 OVS running on 2 different VMs?
> 
> 
> Thank you!
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150401/a0d09470/attachment.html>

From zhangchen9211 at 126.com  Tue Mar 31 18:27:36 2015
From: zhangchen9211 at 126.com (=?GBK?B?1cWzvw==?=)
Date: Wed, 1 Apr 2015 09:27:36 +0800 (CST)
Subject: [ovs-discuss] vlan setfield failed
Message-ID: <69b08695.3acd.14c72973b5d.Coremail.zhangchen9211@126.com>

hi, dear all!

i use ryu to deploy my vlan policy,
actions.append(ofp_parser.OFPActionPushVlan())
actions.append(ofp_parser.OFPActionSetField(vlan_vid=10))

but ovs gives me an set-filed error, as you can see in the attached picture, how does it happen?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150401/e05420c1/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2015-03-25 18_09_41的屏幕截图.png
Type: image/png
Size: 63044 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150401/e05420c1/attachment-0001.png>


From carlos.velasco at nimastelecom.com  Thu Oct  1 07:23:00 2015
From: carlos.velasco at nimastelecom.com (Carlos Velasco)
Date: Thu, 1 Oct 2015 16:23:00 +0200
Subject: [ovs-discuss] Continuous messages: engaging governor with XX kB
	hash table
Message-ID: <560D41C4.4050700@nimastelecom.com>

Hello,

I have created a simple bridge with 2 VMs ports and 1 ethernet physical port.

# ovs-vsctl show
40e43335-0f9e-49b3-9c25-2dcadebac952
    Bridge "br0"
        Port "eth0"
            Interface "eth0"
        Port kvmone
            Interface kvmone
        Port kvmtwo
            Interface kvmtwo
        Port "br0"
            Interface "br0"
                type: internal

When there is a lot of traffic (by ex. torrent) from a VM, I get a lot of these entries in the message log:

...
Oct  1 16:06:15 daemon:notice ovs-vswitchd: ovs-vswitchd: 230571|ofproto_dpif_governor|INFO|br0: engaging governor with 16 kB hash table
Oct  1 16:06:20 daemon:notice ovs-vswitchd: ovs-vswitchd: 230572|ofproto_dpif_governor|INFO|br0: disengaging
Oct  1 16:15:01 daemon:notice ovs-vswitchd: ovs-vswitchd: 230573|ofproto_dpif_governor|INFO|br0: engaging governor with 16 kB hash table
Oct  1 16:15:06 daemon:notice ovs-vswitchd: ovs-vswitchd: 230574|ofproto_dpif_governor|INFO|br0: disengaging
Oct  1 16:15:46 daemon:notice ovs-vswitchd: ovs-vswitchd: 230575|ofproto_dpif_governor|INFO|br0: engaging governor with 16 kB hash table
Oct  1 16:15:51 daemon:notice ovs-vswitchd: ovs-vswitchd: 230576|ofproto_dpif_governor|INFO|br0: disengaging
Oct  1 16:15:56 daemon:notice ovs-vswitchd: ovs-vswitchd: 230577|ofproto_dpif_governor|INFO|br0: engaging governor with 16 kB hash table
Oct  1 16:16:01 daemon:notice ovs-vswitchd: ovs-vswitchd: 230578|ofproto_dpif_governor|INFO|br0: disengaging
Oct  1 16:16:06 daemon:notice ovs-vswitchd: ovs-vswitchd: 230579|ofproto_dpif_governor|INFO|br0: engaging governor with 16 kB hash table
Oct  1 16:16:11 daemon:notice ovs-vswitchd: ovs-vswitchd: 230580|ofproto_dpif_governor|INFO|br0: disengaging

Is this normal?

Regards,
Carlos Velasco


From takahashi.minoru7 at gmail.com  Thu Oct  1 01:29:42 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Thu, 01 Oct 2015 17:29:42 +0900
Subject: [ovs-discuss] Problem when converts 'ofpacts_bitmap' to
	'openflow_bitmap'
Message-ID: <560CEEF6.8060802@gmail.com>

Hi,

I use following function of lib/ofp-actions.c

 /* Converts 'ofpacts_bitmap', a bitmap whose bits correspond to OFPACT_*
  * values, into a bitmap of actions suitable for OpenFlow 'version', and
  * returns the result. */
 ovs_be32
 ofpact_bitmap_to_openflow(uint64_t ofpacts_bitmap, enum ofp_version version)

I can get openflow_bitmap by using this function.
However, the bit that corresponds to the following values of openflow_bitmap is set always 'zero'.

 OFPACT_COPY_TTL_OUT = 11
 OFPACT_COPY_TTL_IN = 12
 OFPACT_PUSH_PBB = 26
 OFPACT_POP_PBB = 27

Is this a bug?

I know openvswitch does not support above actions.
So, Cause of this problem is the above actions is not defined as OFPACT_*?

thanks,

From daniel.swahn at clavister.com  Thu Oct  1 02:13:51 2015
From: daniel.swahn at clavister.com (Daniel Swahn)
Date: Thu, 1 Oct 2015 09:13:51 +0000
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <1D5B7C93-C82A-4159-9551-F818231F4D11@nicira.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
 <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
 <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
 <99B444A2AB04944290142382BC3FB25AAAFB4D91@hermes.clavister.com>
 <1D5B7C93-C82A-4159-9551-F818231F4D11@nicira.com>
Message-ID: <99B444A2AB04944290142382BC3FB25AAAFB562A@hermes.clavister.com>

> Did you try Daniele’s patch alone (i.e., without my patch). It seems to me that both patched should be necessary, but I’d like to know if you tried Daniele’s patch without mine to be sure.

I did not. Unfortunately we're running low on hardware so I had to lend away the machine I was testing on. Should I test with just "daniele’s patch" once I get it back?


-----Original Message-----
From: Jarno Rajahalme [mailto:jrajahalme at nicira.com] 
Sent: 2015-09-30 22:47
To: Daniel Swahn
Cc: Daniele Venturino; Ben Pfaff; bugs at openvswitch.org
Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch

Daniel,

Did you try Daniele’s patch alone (i.e., without my patch). It seems to me that both patched should be necessary, but I’d like to know if you tried Daniele’s patch without mine to be sure.

  Jarno

> On Sep 30, 2015, at 3:45 AM, Daniel Swahn <daniel.swahn at clavister.com> wrote:
> 
> The issue seems to have been solved! I'm using yours and Jarno's patch and now the system boots up without crashes. Thanks!
> 
> -----Original Message-----
> From: Daniele Venturino [mailto:venturino.daniele at gmail.com] On Behalf Of Daniele Venturino
> Sent: 2015-09-30 10:54
> To: Daniel Swahn
> Cc: Jarno Rajahalme; Ben Pfaff; bugs at openvswitch.org
> Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch
> 
> I tried the commands you listed but I was not able to reproduce this in a simpler setup only with RSTP enabled on the bridge.
> 
> I’m attaching a patch I’d like you to try. I’m not really expecting much from it, but can you give it a try since I can’t reproduce this?
> 
> Daniele
> 


From dsanvito90 at gmail.com  Thu Oct  1 04:40:02 2015
From: dsanvito90 at gmail.com (Davide Sanvito)
Date: Thu, 1 Oct 2015 13:40:02 +0200
Subject: [ovs-discuss] Learn action in group table
In-Reply-To: <20150930060817.GA14940@nicira.com>
References: <CAJ-RJ=UWp0rXFZfayNC692-MUOPFzE9GDfhm=qv_ESB6yoJGKg@mail.gmail.com>
 <20150930060817.GA14940@nicira.com>
Message-ID: <CAJ-RJ=VooLvaywj3B5RCj_4=BweMCoK2cT2KJ+OK9K4kFdPguA@mail.gmail.com>

Thank you for your reply. Does this mean that a learn action can only be
applied within a Apply-Actions instruction and so it cannot be added to the
action set via a Write-Actions instruction nor inside a bucket in a group
entry?
Thank you!
Davide

2015-09-30 8:08 GMT+02:00 Ben Pfaff <blp at nicira.com>:

> On Mon, Sep 21, 2015 at 04:11:28PM +0200, Davide Sanvito wrote:
> > I'm trying to execute a learn action to table 0 from a group entry. The
> > application is written with the Ryu framework and by using ovs-ofctl I
> can
> > confirm that buckets have the correct learn action associated and that
> > packets go through the group table.
> >
> > By the way no flow entry is added to table 0 by the execution of the
> learn
> > action.
> >
> > Is this a bug? Is the learn action supported as an action in a group
> entry?
>
> A learn action in an action set doesn't currently have any effect.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151001/11e1f428/attachment.html>

From rishi.raj2509 at gmail.com  Thu Oct  1 05:39:28 2015
From: rishi.raj2509 at gmail.com (RishiRaj Maulick)
Date: Thu, 1 Oct 2015 18:09:28 +0530
Subject: [ovs-discuss] JSON parsing fails on powerpc
Message-ID: <CAOLvpU4M2TB7+DtW8ARsSeZEynMXjynVQ_AV3bfRfNQWm-vQDw@mail.gmail.com>

Hi ,

We are trying to cross-compile and run the ovs-vswitchd on a machine that
runs on powerPC architecture. We have cross-compiled the code successfully
however we are hitting some issues :-

1) When we try to create the conf.db file from the schema - it fails to
decode the JSON objects.
2) Then we started to run the ovsdb-server on a x86 machine and ran
vswitchd on powerPC - used tcp to communicate between them .
3) tcpdump confirms that the vswitchd was able to connect to the
ovsdb-server , it sent a "list_schemas" json request and the server replied
to that , and then it sent a "lock" request which also was successfully
replied by the ovsdb-server.
4) At this stage we see that the vswitchd is sending a TCP reset towards
the server - the reason is because it thinks that the "lock" method has
failed - in bridge_run() the check for has_lock() fails.
5) Also we see that the logs of vswitchd are not coming properly - all we
see are 0's .

kindly let us know , if anybody has hit such kind of an issue before ,

Thanks in advance.

Best Regards,
Rishi Raj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151001/76f20f9c/attachment.html>

From blp at nicira.com  Thu Oct  1 08:57:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 1 Oct 2015 08:57:51 -0700
Subject: [ovs-discuss] Continuous messages: engaging governor with XX kB
 hash table
In-Reply-To: <560D41C4.4050700@nimastelecom.com>
References: <560D41C4.4050700@nimastelecom.com>
Message-ID: <20151001155751.GD30363@nicira.com>

On Thu, Oct 01, 2015 at 04:23:00PM +0200, Carlos Velasco wrote:
> When there is a lot of traffic (by ex. torrent) from a VM, I get a lot of these entries in the message log:
> 
> ...
> Oct  1 16:06:15 daemon:notice ovs-vswitchd: ovs-vswitchd: 230571|ofproto_dpif_governor|INFO|br0: engaging governor with 16 kB hash table

You should probably upgrade to a newer version of OVS, which don't have
the governor logic and are better in many other ways.

From blp at nicira.com  Thu Oct  1 08:58:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 1 Oct 2015 08:58:45 -0700
Subject: [ovs-discuss] Problem when converts 'ofpacts_bitmap' to
 'openflow_bitmap'
In-Reply-To: <560CEEF6.8060802@gmail.com>
References: <560CEEF6.8060802@gmail.com>
Message-ID: <20151001155845.GE30363@nicira.com>

On Thu, Oct 01, 2015 at 05:29:42PM +0900, Minoru TAKAHASHI wrote:
> Hi,
> 
> I use following function of lib/ofp-actions.c
> 
>  /* Converts 'ofpacts_bitmap', a bitmap whose bits correspond to OFPACT_*
>   * values, into a bitmap of actions suitable for OpenFlow 'version', and
>   * returns the result. */
>  ovs_be32
>  ofpact_bitmap_to_openflow(uint64_t ofpacts_bitmap, enum ofp_version version)
> 
> I can get openflow_bitmap by using this function.
> However, the bit that corresponds to the following values of openflow_bitmap is set always 'zero'.
> 
>  OFPACT_COPY_TTL_OUT = 11
>  OFPACT_COPY_TTL_IN = 12
>  OFPACT_PUSH_PBB = 26
>  OFPACT_POP_PBB = 27
> 
> Is this a bug?

It's not a bug.

> I know openvswitch does not support above actions.
> So, Cause of this problem is the above actions is not defined as OFPACT_*?

Yes.

From blp at nicira.com  Thu Oct  1 09:01:08 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 1 Oct 2015 09:01:08 -0700
Subject: [ovs-discuss] [ovs-dev] JSON parsing fails on powerpc
In-Reply-To: <CAOLvpU4M2TB7+DtW8ARsSeZEynMXjynVQ_AV3bfRfNQWm-vQDw@mail.gmail.com>
References: <CAOLvpU4M2TB7+DtW8ARsSeZEynMXjynVQ_AV3bfRfNQWm-vQDw@mail.gmail.com>
Message-ID: <20151001160108.GF30363@nicira.com>

On Thu, Oct 01, 2015 at 06:09:28PM +0530, RishiRaj Maulick wrote:
> We are trying to cross-compile and run the ovs-vswitchd on a machine that
> runs on powerPC architecture. We have cross-compiled the code successfully
> however we are hitting some issues :-
> 
> 1) When we try to create the conf.db file from the schema - it fails to
> decode the JSON objects.
> 2) Then we started to run the ovsdb-server on a x86 machine and ran
> vswitchd on powerPC - used tcp to communicate between them .
> 3) tcpdump confirms that the vswitchd was able to connect to the
> ovsdb-server , it sent a "list_schemas" json request and the server replied
> to that , and then it sent a "lock" request which also was successfully
> replied by the ovsdb-server.
> 4) At this stage we see that the vswitchd is sending a TCP reset towards
> the server - the reason is because it thinks that the "lock" method has
> failed - in bridge_run() the check for has_lock() fails.
> 5) Also we see that the logs of vswitchd are not coming properly - all we
> see are 0's .
> 

Open vSwitch 2.3.x should work OK on powerpc.  It passes the testsuite
there:
        https://buildd.debian.org/status/package.php?p=openvswitch

You didn't say what version you're using.

From blp at nicira.com  Thu Oct  1 09:07:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 1 Oct 2015 09:07:13 -0700
Subject: [ovs-discuss] Learn action in group table
In-Reply-To: <CAJ-RJ=VooLvaywj3B5RCj_4=BweMCoK2cT2KJ+OK9K4kFdPguA@mail.gmail.com>
References: <CAJ-RJ=UWp0rXFZfayNC692-MUOPFzE9GDfhm=qv_ESB6yoJGKg@mail.gmail.com>
 <20150930060817.GA14940@nicira.com>
 <CAJ-RJ=VooLvaywj3B5RCj_4=BweMCoK2cT2KJ+OK9K4kFdPguA@mail.gmail.com>
Message-ID: <20151001160713.GG30363@nicira.com>

I don't think OVS currently prohibits them from appearing within
Write-Actions, but they won't have any useful effect there.

On Thu, Oct 01, 2015 at 01:40:02PM +0200, Davide Sanvito wrote:
> Thank you for your reply. Does this mean that a learn action can only be
> applied within a Apply-Actions instruction and so it cannot be added to the
> action set via a Write-Actions instruction nor inside a bucket in a group
> entry?
> Thank you!
> Davide
> 
> 2015-09-30 8:08 GMT+02:00 Ben Pfaff <blp at nicira.com>:
> 
> > On Mon, Sep 21, 2015 at 04:11:28PM +0200, Davide Sanvito wrote:
> > > I'm trying to execute a learn action to table 0 from a group entry. The
> > > application is written with the Ryu framework and by using ovs-ofctl I
> > can
> > > confirm that buckets have the correct learn action associated and that
> > > packets go through the group table.
> > >
> > > By the way no flow entry is added to table 0 by the execution of the
> > learn
> > > action.
> > >
> > > Is this a bug? Is the learn action supported as an action in a group
> > entry?
> >
> > A learn action in an action set doesn't currently have any effect.
> >

From carlos.velasco at nimastelecom.com  Thu Oct  1 10:01:03 2015
From: carlos.velasco at nimastelecom.com (Carlos Velasco)
Date: Thu, 1 Oct 2015 19:01:03 +0200
Subject: [ovs-discuss] Continuous messages: engaging governor with XX kB
 hash table
In-Reply-To: <20151001155751.GD30363@nicira.com>
References: <560D41C4.4050700@nimastelecom.com>
 <20151001155751.GD30363@nicira.com>
Message-ID: <560D66CF.1090202@nimastelecom.com>

Date: 1/10/2015 17:57:51
> On Thu, Oct 01, 2015 at 04:23:00PM +0200, Carlos Velasco wrote:
>> When there is a lot of traffic (by ex. torrent) from a VM, I get a lot of these entries in the message log:
>>
>> ...
>> Oct  1 16:06:15 daemon:notice ovs-vswitchd: ovs-vswitchd: 230571|ofproto_dpif_governor|INFO|br0: engaging governor with 16 kB hash table
> You should probably upgrade to a newer version of OVS, which don't have
> the governor logic and are better in many other ways.

You were right. Updated from version 1.7.1 to 2.4.0 and no more governor messages.
Thank you very much.


From dwilder at us.ibm.com  Thu Oct  1 16:19:20 2015
From: dwilder at us.ibm.com (dwilder at us.ibm.com)
Date: Thu, 01 Oct 2015 19:19:20 -0400
Subject: [ovs-discuss] [PATCH-RFC 1/2] Improve ARP latency
In-Reply-To: <CAEP_g=9K69Muo2xBh8u_ypO2eriiKJvUL73PEXYNa7bKDenSKw@mail.gmail.com>
References: <20150930015039.Horde.By710uU5wzMPGcKhA46ZaA1@ltc.linux.ibm.com>
 <CAEP_g=9K69Muo2xBh8u_ypO2eriiKJvUL73PEXYNa7bKDenSKw@mail.gmail.com>
Message-ID: <20151001191920.Horde.6y_--Lj_RoGK0nK7EgUF_A1@ltc.linux.ibm.com>


Quoting Jesse Gross <jesse at nicira.com>:

> On Tue, Sep 29, 2015 at 10:50 PM,  <dwilder at us.ibm.com> wrote:
>> Hi-
>>
>> I have been conducting scaling tests with OVS and docker. My tests revealed
>> that the latency of ARP packets can become very large resulting in many ARP
>> re-transmissions and time-outs. I found the source of the poor latency to be
>> with the handling of arp packets in ovs_vport_find_upcall_portid().  Each
>> packet is hashed in ovs_vport_find_upcall_portid() by calling
>> skb_get_hash().  This hash is used to select a netlink socket in which to
>> send the packet to userspace.  However, skb_get_hash() is not supporting ARP
>> packets returning a 0 (invalid hash) for every ARP.  This results in a
>> single ovs-vswitchd handler thread processing every arp packet thus severely
>> impacting the average latency of ARPs. I am purposing a change to
>> ovs_vport_find_upcall_portid() that spreads the ARP packets evenly between
>> all the handler threads (patch to follow).  Please let me know if you have
>> suggestions/comments.
>
> This is definitely an interesting analysis but I'm a little surprised
> at the basic scenario. First, I guess it seems to me that the L2
> domain is too large if there are this many ARPs.

I can imagine running a couple of thousand docker containers, so I  
think this is a reasonable size test.

On a related issue, I am looking into the memory consumed by the  
netlink sockets, OVS on linux can create many of these sockets. Do you  
have any thought as to why the current model was picked?


> The speed also
> generally seems slower than I would expect but in any case I don't
> disagree that it is better to spread the load among all the cores.
>
> On the patch itself, can't we just make skb_get_hash() be able to
> decode ARP? It seems like that is cleaner and more generic.

My first thought was to make a change in skb_get_hash().  However, the  
comment in __skb_get_hash() state that the hash is generated from the  
4-tuple (address and ports).  ARPs have no ports so a return value of  
0 looked correct.

/*
   * __skb_get_hash: calculate a flow hash based on src/dst addresses
   * and src/dst port numbers.  Sets hash in skb to non-zero hash value
   * on success, zero indicates no valid hash.  Also, sets l4_hash in skb
   * if hash is a canonical 4-tuple hash over transport ports.
   */

What do you think?


From iwp.yash at gmail.com  Thu Oct  1 16:27:29 2015
From: iwp.yash at gmail.com (Yash Thadhani)
Date: Thu, 1 Oct 2015 16:27:29 -0700
Subject: [ovs-discuss] Error with DPDK options in ovs-vswitchd
Message-ID: <CAMKg0N=kOxzV=vG-yN8jpa1xfve4mbMxdO=_cSfBdYJ3oYRdrg@mail.gmail.com>

Hello everyone,
                        I was trying to build vhost-user for OVS using DPDK
2.0.0. I am using Open-vSwitch 2.4. I followed the steps mentioned in this
link:

https://software.intel.com/en-us/blogs/2015/06/09/building-vhost-user-for-ovs-today-using-dpdk-200

However, on executing this comand:

ovs-vswitchd --dpdk -c 0x0FF8 -n 4 --socket-mem 1024,0 -- \
unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfile:info \
--mlockall --no-chdir --log-file=/var/log/openvswitch/ovs-vswitchd.log \
--pidfile=/var/run/openvswitch/ovs-vswitchd.pid --detach –monitor

I get the message: invalid option -- 'n'. This is the configure
command I am using:    ./configure --prefix=/usr --sysconfdir=/etc
--localstatedir=/var
--with-dpdk=../dpdk-2.0.0/x86_64-native-linuxapp-gcc/ --enable-ssl

Also prior to rerunning ovs-vswitchd, I checked the ovs-version, it
was still 2.3.1 and not 2.4.

If anyone has faced a similar issue and was able to make some
progress, do let me know.

Thanks for your help,
Yash.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151001/5676238a/attachment.html>

From jeff.forbes at mail.nacon.com  Fri Oct  2 06:11:07 2015
From: jeff.forbes at mail.nacon.com (Jeff Forbes)
Date: Fri, 2 Oct 2015 13:11:07 +0000
Subject: [ovs-discuss] VLANs and DHCP
Message-ID: <1443791467.30733.40.camel@jeffforbes.nacon.com>


I have set up the openvswitch demo for isolating VM traffic using VLANs.
The setup works as expected. The difficulty I am having is with using
DHCP to assign the IPs. The two VLANs have IP ranges of 10.0.0.x and
10.0.1.x and the netmasks are 255.255.0.0. I have been able to get
dnsmasq to assigned IPs for one of the VLANs by  assigning an internal
openvswitch port on the DHCP server the ip of 10.0.0.1 and the tag of
one of the VLANs. 

The goal is to be able to have multiple vlans with IPs in the 10.0.x.y
range and have them assigned IPs based on the VMs MAC address.
What is the best way to have the DHCP daemon recognize the different
VLANs?

I tried to use the trunk directive, but dnamasq did not respond to the
broadcast DHCP request. 


The reason for using the 10.0.x.y address space is that we would like to
be able to have some of the VLANs be able to communicate between each
other without changing the VLAN tag. Is there a way of doing this?

Jeff Forbes




From michele.santuari at create-net.org  Fri Oct  2 06:48:57 2015
From: michele.santuari at create-net.org (Michele Santuari)
Date: Fri, 2 Oct 2015 15:48:57 +0200
Subject: [ovs-discuss] MPLS header on a VLAN packet
Message-ID: <CAAHkLF+d+oOF+2gD3pyk928tfjTywc7W3wZuKS1GfPXx99HprQ@mail.gmail.com>

Hi all,
we are trying to tag with MPLS a VLAN packet.

The rule installed into the ovs is:
cookie=0x240000465aa58e, duration=5.452s, table=0, n_packets=0, n_bytes=0,
idle_age=5, priority=100,in_port=1,dl_vlan=10,dl_type=0x8100
actions=push_mpls:0x8847,load:0x1b->OXM_OF_MPLS_LABEL[],output:2

The strange think is that packets with VLAN 10 coming from port 1 are not
matching this rule.
The ovs log shows this error:

2015-10-02T12:37:51.757Z|00002|dpif(handler22)|WARN|system at ovs-system:
execute push_mpls(label=25,tc=0,ttl=64,bos=1,eth_type=0x8847),2 failed
(Invalid argument) on packet
icmp,in_port=0,dl_vlan=10,dl_vlan_pcp=0,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=8,icmp_code=0
2015-10-02T12:37:52.636Z|00003|dpif(handler22)|WARN|system at ovs-system:
failed to put[create] (Invalid argument)
ufid:586b5f05798f165219b201bac96b56bb
recirc_id(0),dp_hash(0/0),skb_priority(0/0),in_port(1),skb_mark(0/0),eth(src=00:00:00:00:00:01/00:00:00:00:00:00,dst=00:00:00:00:00:02/00:00:00:00:00:00),eth_type(0x8100),vlan(vid=10,pcp=0/0x0),encap(eth_type(0x0800),ipv4(src=
10.0.0.1/0.0.0.0,dst=10.0.0.2/0.0.0.0,proto=1/0,tos=0/0xfc,ttl=64,frag=no),icmp(type=8/0,code=0/0)),
actions:push_mpls(label=25,tc=0,ttl=64,bos=1,eth_type=0x8847),2


We do not know if adding an MPLS tag on a VLAN frame is a permitted
operation.
Do you have any idea?

-- 
Michele Santuari
CREATE-NET
Junior Research Engineer
Via alla Cascata 56/D - 38123 Povo Trento (Italy)
e-mail: michele.santuari at create-net.org
Tel: (+39) 0461312443
Hangout: michele.santuari at create-net.org
Skype: s4nto.m
www.create-net.org
--------------------------------------------------------
The information transmitted is intended only for the person or entity to
which it is addressed and may contain confidential and/or privileged
material. Any review, retransmission, dissemination or other use of, or
taking of any action in reliance upon, this information by persons or
entities other than the intended recipient is prohibited according to the
Italian Law 196/2003 of the Legislature. If you received this in error,
please contact the sender and delete the material from any computer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151002/3e36bb8b/attachment-0001.html>

From scott.lowe at scottlowe.org  Fri Oct  2 07:51:07 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Fri, 2 Oct 2015 08:51:07 -0600
Subject: [ovs-discuss] VLANs and DHCP
In-Reply-To: <1443791467.30733.40.camel@jeffforbes.nacon.com>
References: <1443791467.30733.40.camel@jeffforbes.nacon.com>
Message-ID: <7588F81E-B1B5-42AD-AD31-3FFFEED64A97@scottlowe.org>

Hi Jeff, please see my responses inline, prefixed by [SL].


Jeff Forbes <jeff.forbes at mail.nacon.com> wrote:

> I have set up the openvswitch demo for isolating VM traffic using VLANs.
> The setup works as expected. The difficulty I am having is with using
> DHCP to assign the IPs. The two VLANs have IP ranges of 10.0.0.x and
> 10.0.1.x and the netmasks are 255.255.0.0. I have been able to get
> dnsmasq to assigned IPs for one of the VLANs by  assigning an internal
> openvswitch port on the DHCP server the ip of 10.0.0.1 and the tag of
> one of the VLANs.


[SL] Based on the network addresses and subnet mask provided, you have a
situation where you have two VLANs (which are Layer 2 broadcast domains)
inside a single IP network (which is a Layer 3 broadcast domain). This can
produce some unexpected (and typically undesired) results. Generally, you'll
align your VLANs with your IP subnets, since systems can't communicate
across VLANs without passing through a Layer 3 device anyway.


> The goal is to be able to have multiple vlans with IPs in the 10.0.x.y
> range and have them assigned IPs based on the VMs MAC address.
> What is the best way to have the DHCP daemon recognize the different
> VLANs?


[SL] DHCP itself is not VLAN-aware and operates within a Layer 2 broadcast
domain (a VLAN). Without assistance, a single DHCP server in one VLAN won't
be able to provide IP address leases to systems outside its own VLAN. That
assistance comes in the form of a DHCP relay, which takes DHCP requests on
one VLAN and forwards them across a router to the DHCP server in the other
VLAN.


> I tried to use the trunk directive, but dnamasq did not respond to the
> broadcast DHCP request. 
> 
> The reason for using the 10.0.x.y address space is that we would like to
> be able to have some of the VLANs be able to communicate between each
> other without changing the VLAN tag. Is there a way of doing this?


[SL] Systems in different VLANs can't communicate with systems in other
VLANs without passing through a Layer 3 device (a router).

Can you share a bit more on exactly *what* you're trying to achieve with
this particular environment, so that we can try to provide some guidance as
to how to achieve it?

-- 
Scott


From dev_raj82 at yahoo.com  Thu Oct  1 12:01:33 2015
From: dev_raj82 at yahoo.com (Nishanth Devarajan)
Date: Fri, 2 Oct 2015 00:31:33 +0530
Subject: [ovs-discuss] Interconnecting OVS on 2 different subnets
Message-ID: <A3C71DBF-DC93-4CA0-8E81-41BAD4A17A94@yahoo.com>

Hey guys,
		I have 2 OVS switches running on 2 different VMs which belong to 2 different subnets.

i.e 				     

		 VM1 / OVS 1 					AND  					  VM2  / OVS 2				  			
       		  (10.10.10.2)                       						                  (10.10.10.101)


10.10.10.2 and 10.10.10.101 are on different subnets (they are configured to be on different subnets).  Now, How do I ping VM2 from VM1, i.e how to establish a connection between the 2 switches. I’ve tried GRE tunnel between the switches but it doesn’t it seem to work. Any suggestions?

Thanks,
Nishanth 

From dsanvito90 at gmail.com  Fri Oct  2 02:19:56 2015
From: dsanvito90 at gmail.com (Davide Sanvito)
Date: Fri, 2 Oct 2015 11:19:56 +0200
Subject: [ovs-discuss] Learn action in group table
In-Reply-To: <20151001160713.GG30363@nicira.com>
References: <CAJ-RJ=UWp0rXFZfayNC692-MUOPFzE9GDfhm=qv_ESB6yoJGKg@mail.gmail.com>
 <20150930060817.GA14940@nicira.com>
 <CAJ-RJ=VooLvaywj3B5RCj_4=BweMCoK2cT2KJ+OK9K4kFdPguA@mail.gmail.com>
 <20151001160713.GG30363@nicira.com>
Message-ID: <CAJ-RJ=XOE9uS43=tNxf7GgpvpbDKZydJofRkd7_ET4RxQyG2Xg@mail.gmail.com>

Hi Ben,
if I try to add a learn action to the action set using write-action, the
switch returns an error OFPET_BAD_ACTION,OFPBAC_BAD_TYPE. From a comment
in lib/ofp-actions.c it seems that OVS does not allow adding non-OF actions
to an action-set.
One last question: if group buckets are like action-sets (a comment in
ofproto/ofproto-dpif-xlate.c says "Note that group buckets are action sets
[...]"), why does the switch not return any error?
By the way you perfectly solved my doubt, thank you!
Davide


2015-10-01 18:07 GMT+02:00 Ben Pfaff <blp at nicira.com>:

> I don't think OVS currently prohibits them from appearing within
> Write-Actions, but they won't have any useful effect there.
>
> On Thu, Oct 01, 2015 at 01:40:02PM +0200, Davide Sanvito wrote:
> > Thank you for your reply. Does this mean that a learn action can only be
> > applied within a Apply-Actions instruction and so it cannot be added to
> the
> > action set via a Write-Actions instruction nor inside a bucket in a group
> > entry?
> > Thank you!
> > Davide
> >
> > 2015-09-30 8:08 GMT+02:00 Ben Pfaff <blp at nicira.com>:
> >
> > > On Mon, Sep 21, 2015 at 04:11:28PM +0200, Davide Sanvito wrote:
> > > > I'm trying to execute a learn action to table 0 from a group entry.
> The
> > > > application is written with the Ryu framework and by using ovs-ofctl
> I
> > > can
> > > > confirm that buckets have the correct learn action associated and
> that
> > > > packets go through the group table.
> > > >
> > > > By the way no flow entry is added to table 0 by the execution of the
> > > learn
> > > > action.
> > > >
> > > > Is this a bug? Is the learn action supported as an action in a group
> > > entry?
> > >
> > > A learn action in an action set doesn't currently have any effect.
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151002/03b0e1da/attachment.html>

From shettyg at nicira.com  Fri Oct  2 08:35:57 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 2 Oct 2015 08:35:57 -0700
Subject: [ovs-discuss] Interconnecting OVS on 2 different subnets
In-Reply-To: <A3C71DBF-DC93-4CA0-8E81-41BAD4A17A94@yahoo.com>
References: <A3C71DBF-DC93-4CA0-8E81-41BAD4A17A94@yahoo.com>
Message-ID: <CAHbON5pFf50_mUG+o-OtfDxxdWjS85h9vV72woYwvEy1-pPdyA@mail.gmail.com>

When you try to ping an IP address in a different subnet, a ARP
request goes to your router interface IP address. In your case what is
your plan around providing the correct ARP response? If you do not
have a plan there, it is unlikely to work "correctly".

On Thu, Oct 1, 2015 at 12:01 PM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
> Hey guys,
>                 I have 2 OVS switches running on 2 different VMs which belong to 2 different subnets.
>
> i.e
>
>                  VM1 / OVS 1                                    AND                                       VM2  / OVS 2
>                   (10.10.10.2)                                                                                    (10.10.10.101)
>
>
> 10.10.10.2 and 10.10.10.101 are on different subnets (they are configured to be on different subnets).  Now, How do I ping VM2 from VM1, i.e how to establish a connection between the 2 switches. I’ve tried GRE tunnel between the switches but it doesn’t it seem to work. Any suggestions?
>
> Thanks,
> Nishanth
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From duanguyuan at 163.com  Fri Oct  2 10:21:34 2015
From: duanguyuan at 163.com (=?GBK?B?zfXTwg==?=)
Date: Sat, 3 Oct 2015 01:21:34 +0800 (CST)
Subject: [ovs-discuss] limiting bandwidth between openvswitches?
Message-ID: <6e1def.12c.1502992c024.Coremail.duanguyuan@163.com>

Hi all,
We can limit the bandwidth between vm and openvswitch with flow command and the "Qos" something :
$ ovs-vsctl set interface $v ingress_policing_rate=10000 #10MB
$ ovs-vsctl set interface $v ingress_policing_burst=1000
$ sudo ovs-vsctl set port $v qos=@newqos -- --id=@newqos create qos type=linux-htb queue...........
But is there is way to limit the bandwidth between OVS? I remember Mininet can do this:
$ sudo mn --link tc,bw=1,delay=10ms......
So how to limit the bandwidth from one OVS to another OVS?
vm1--------ovs1------(limit ??)-------ovs2--------vm3
Thanks!
----------------  
Yong Wang, Wuhan University 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151003/b1b7be0e/attachment-0001.html>

From gulam at gulam.in  Sat Oct  3 05:24:06 2015
From: gulam at gulam.in (Bakshi Gulam)
Date: Sat, 3 Oct 2015 17:54:06 +0530
Subject: [ovs-discuss] OVS - Change Interface Speed
In-Reply-To: <CA+P_w0y+kys2qgsuLf0N2gbc6fy=MDcT4VMkcPj1FV7a-idqMA@mail.gmail.com>
References: <CA+P_w0y+kys2qgsuLf0N2gbc6fy=MDcT4VMkcPj1FV7a-idqMA@mail.gmail.com>
Message-ID: <CA+P_w0wQi9v8Pv7M4coSkx3fe7ak48G9HYHjYiOYBQWnM+m-Cw@mail.gmail.com>

I managed to changed veth's speed by modifying the driver's code. Here it
is https://github.com/bakshi-gulam/veth-change-speed
Might help someone!

On Tue, May 5, 2015 at 3:16 PM, Bakshi Gulam <gulam at gulam.in> wrote:

> Hi All!
>
> I'm trying to change interface speed of OVS but I couldn't. When I
> searched OVS mailing list archives, I found a answer that OVS doesn't offer
> a way to set speed rather it just advertises what the kernel reports.
>
> Using ethtool, I got that my driver for virtual interfaces created by OVS
> is "veth". I tried changing the veth driver's speed using ethtool. But it
> says "operation not supported". Can anyone please tell me how to change the
> speed of veth driver so that OVS advertises new speed?
>
> P.S.: This may be beyond the scope of OVS. But suggestions will be of
> great help.
>
> --
> /////////////////////////
> // Bakshi Gulam        //
> // http://www.gulam.in //
> /////////////////////////
>



-- 
/////////////////////////
// Bakshi Gulam        //
// http://www.gulam.in //
/////////////////////////
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151003/665d525d/attachment.html>

From kesri1234 at rediffmail.com  Fri Oct  2 22:49:06 2015
From: kesri1234 at rediffmail.com (Richurov Kes)
Date: 3 Oct 2015 05:49:06 -0000
Subject: [ovs-discuss] =?utf-8?q?openvswitch-2=2E4_possible_bug_in_hmap=5F?=
	=?utf-8?q?remove?=
Message-ID: <20151003054906.26547.qmail@f4mail-235-154.rediffmail.com>


Hi,
I'm a student at Antwerp University D' Sciences and Technology and we are trying to bring up openvswitch-2.4 in our project environment. We are running into a crash that is affecting our research work. Here is some detail:
Stack trace:(gdb) bt
#0&nbsp; hmap_remove (xcfg=0x2289520, xport=0x23874a0) at lib/hmap.h:245
#1&nbsp; xlate_xport_remove (xcfg=0x2289520, xport=0x23874a0)
&nbsp; &nbsp; at ofproto/ofproto-dpif-xlate.c:1318
#2&nbsp; 0x000000000043b6fc in xlate_xbridge_remove (xcfg=0x2289520,
&nbsp; &nbsp; xbridge=0x2386c90) at ofproto/ofproto-dpif-xlate.c:1142
#3&nbsp; 0x000000000043ba0a in xlate_xcfg_free ()
&nbsp; &nbsp; at ofproto/ofproto-dpif-xlate.c:1091
#4&nbsp; xlate_txn_commit () at ofproto/ofproto-dpif-xlate.c:1050
#5&nbsp; 0x0000000000426dbb in type_run (type=&lt;value optimized out&gt;)
&nbsp; &nbsp; at ofproto/ofproto-dpif.c:731
#6&nbsp; 0x000000000041a322 in ofproto_type_run (datapath_type=0x2285f00 "system")
&nbsp; &nbsp; at ofproto/ofproto.c:1740
#7&nbsp; 0x000000000040812d in bridge_run__ () at vswitchd/bridge.c:2928
#8&nbsp; 0x00000000004113a5 in bridge_run () at vswitchd/bridge.c:3000
#9&nbsp; 0x00000000004121ad in main (argc=10, argv=0x7fff37462dc8)
&nbsp; &nbsp; at vswitchd/ovs-vswitchd.c:131
We inspected some frames:(gdb) frame 1
#1&nbsp; xlate_xport_remove (xcfg=0x2289520, xport=0x23874a0)
&nbsp; &nbsp; at ofproto/ofproto-dpif-xlate.c:1318
1318&nbsp; &nbsp; &nbsp; &nbsp; hmap_remove(&amp;xcfg-&gt;xports, &amp;xport-&gt;hmap_node);(gdb) list
1313&nbsp; &nbsp; &nbsp; &nbsp; }
1314
1315&nbsp; &nbsp; &nbsp; &nbsp; clear_skb_priorities(xport);
1316&nbsp; &nbsp; &nbsp; &nbsp; hmap_destroy(&amp;xport-&gt;skb_priorities);
1317
1318&nbsp; &nbsp; &nbsp; &nbsp; hmap_remove(&amp;xcfg-&gt;xports, &amp;xport-&gt;hmap_node);&nbsp; &nbsp; &nbsp; &lt;&lt;&lt;&lt;&lt;
1319&nbsp; &nbsp; &nbsp; &nbsp; hmap_remove(&amp;xport-&gt;xbridge-&gt;xports, &amp;xport-&gt;ofp_node);
1320
1321&nbsp; &nbsp; &nbsp; &nbsp; netdev_close(xport-&gt;netdev);
At line number 1318, we find xcfg-&gt;xports to be valid, and note the xport-&gt;hmap_node. All of the xport-&gt;ofport appear to be valid data.
(gdb) p &amp;xport-&gt;hmap_node
$5 = (struct hmap_node *) 0x23874a0
(gdb) p xport-&gt;hmap_node
$6 = {hash = 7, next = 0x0}
(gdb) p xcfg-&gt;xports
$11 = {buckets = 0x2387620, one = 0x0, mask = 31, n = 45}
(gdb) p xport-&gt;ofport
$12 = (struct ofport_dpif *) 0x2232160(gdb) p *xport-&gt;ofport
$13 = {odp_port_node = {hash = 0, next = 0x0}, up = {hmap_node = {
&nbsp; &nbsp; &nbsp; hash = 186588107, next = 0x0}, ofproto = 0x21b6f20, netdev = 0x2231f90,
&nbsp; &nbsp; pp = {port_no = 12, hw_addr = "\362\366\a\035\275D",
&nbsp; &nbsp; &nbsp; name = "taf2fe2592c\000\000\000\000", config = 0,
&nbsp; &nbsp; &nbsp; state = OFPUTIL_PS_STP_LISTEN, curr = 0, advertised = 0, supported = 0,
&nbsp; &nbsp; &nbsp; peer = 0, curr_speed = 0, max_speed = 0}, ofp_port = 12, change_seq = 3,
&nbsp; &nbsp; created = 1260028, mtu = 0, op_vendor_data = 0x22322a0, rte_node = {
&nbsp; &nbsp; &nbsp; hash = 186588107, next = 0x0}},&nbsp;
&nbsp; odp_port = 9, bundle = 0x0, bundle_node = {prev = 0x0, next = 0x0},
&nbsp; cfm = 0x0, bfd = 0x0, lldp = 0x0, may_enable = true, is_tunnel = true,
&nbsp; is_layer3 = false, carrier_seq = 0, peer = 0x0, stp_port = 0x0,
&nbsp; stp_state = STP_DISABLED, stp_state_entered = 0, rstp_port = 0x0,
&nbsp; rstp_state = RSTP_DISABLED, qdscp = 0x0, n_qdscp = 0, realdev_ofp_port = 0,
&nbsp; vlandev_vid = 0}
However, peculiarly, we find that xport-&gt;hmap_node to be in wrong hash map bucket in frame 0 and as a result we trip. See below:


(gdb) frame 0
#0&nbsp; hmap_remove (xcfg=0x2289520, xport=0x23874a0) at lib/hmap.h:245
245 &nbsp; &nbsp; &nbsp; &nbsp; while (*bucket != node) {(gdb) list240&nbsp; &nbsp; &nbsp; * hmap_shrink() directly if desired. */241 &nbsp; &nbsp; static inline void242 &nbsp; &nbsp; hmap_remove(struct hmap *hmap, struct hmap_node *node)243 &nbsp; &nbsp; {244 &nbsp; &nbsp; &nbsp; &nbsp; struct hmap_node **bucket = &amp;hmap-&gt;buckets[node-&gt;hash &amp; hmap-&gt;mask];245 &nbsp; &nbsp; &nbsp; &nbsp; while (*bucket != node) {246 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bucket = &amp;(*bucket)-&gt;next;247 &nbsp; &nbsp; &nbsp; &nbsp; }248 &nbsp; &nbsp; &nbsp; &nbsp; *bucket = node-&gt;next;









249 &nbsp; &nbsp; &nbsp; &nbsp; hmap-&gt;n--;
(gdb) p node-&gt;hash &amp; hmap-&gt;mask
$7 = 7
(gdb) p hmap-&gt;buckets[7]
$8 = (struct hmap_node *) 0x0


(gdb) p hmap-&gt;buckets[6]
$15 = (struct hmap_node *) 0x23874a0 &lt;&lt;&lt;&lt;&lt;
This makes us wonder if there is a bug in openvswitch-2.4 hash map library that computes wrong address during hashing. There is no particular sequence of events that reproduce this bug. But it often occurs during downloading flows from controller or even when adding some ports or deleting ports from ovs-vsctl.
Is this a known problem with openvswitch-2.4? If so, is there a patch available or is it fixed in new releases or master branch? Please help.
Regards,Richurov
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151003/6e5fe290/attachment-0001.html>

From kesri1234 at rediffmail.com  Fri Oct  2 23:04:04 2015
From: kesri1234 at rediffmail.com (Richurov Kes)
Date: 3 Oct 2015 06:04:04 -0000
Subject: [ovs-discuss] =?utf-8?q?openvswitch-2=2E4_possible_bug_in_hmap=5F?=
	=?utf-8?q?remove?=
Message-ID: <20151003060404.18385.qmail@f4mail-235-88.rediffmail.com>

Hi,
I'm a student at Antwerp University D' Sciences and Technology and we are trying to bring up openvswitch-2.4 in our project environment. We are running into a crash that is affecting our research work. Here is some detail:
Stack trace:(gdb) bt#0 &nbsp;hmap_remove (xcfg=0x2289520, xport=0x23874a0) at lib/hmap.h:245#1 &nbsp;xlate_xport_remove (xcfg=0x2289520, xport=0x23874a0)&nbsp; &nbsp; at ofproto/ofproto-dpif-xlate.c:1318#2 &nbsp;0x000000000043b6fc in xlate_xbridge_remove (xcfg=0x2289520,&nbsp; &nbsp; xbridge=0x2386c90) at ofproto/ofproto-dpif-xlate.c:1142#3 &nbsp;0x000000000043ba0a in xlate_xcfg_free ()&nbsp; &nbsp; at ofproto/ofproto-dpif-xlate.c:1091#4 &nbsp;xlate_txn_commit () at ofproto/ofproto-dpif-xlate.c:1050#5 &nbsp;0x0000000000426dbb in type_run (type=&lt;value optimized out&gt;)&nbsp; &nbsp; at ofproto/ofproto-dpif.c:731#6 &nbsp;0x000000000041a322 in ofproto_type_run (datapath_type=0x2285f00 "system")&nbsp; &nbsp; at ofproto/ofproto.c:1740#7 &nbsp;0x000000000040812d in bridge_run__ () at vswitchd/bridge.c:2928#8 &nbsp;0x00000000004113a5 in bridge_run () at vswitchd/bridge.c:3000#9 &nbsp;0x00000000004121ad in main (argc=10, argv=0x7fff37462dc8)&nbsp; &nbsp; at vswitchd/ovs-vswitchd.c
 :131
We inspected some frames. In Frame 1, at line number 1318, we find xcfg-&gt;xports to be valid, and note the xport-&gt;hmap_node. All of the xport-&gt;ofport appear to be valid data.
(gdb) frame 1#1 &nbsp;xlate_xport_remove (xcfg=0x2289520, xport=0x23874a0)&nbsp; &nbsp; at ofproto/ofproto-dpif-xlate.c:13181318 &nbsp; &nbsp; &nbsp; &nbsp;hmap_remove(&amp;xcfg-&gt;xports, &amp;xport-&gt;hmap_node);(gdb) list1313 &nbsp; &nbsp; &nbsp; &nbsp;}13141315 &nbsp; &nbsp; &nbsp; &nbsp;clear_skb_priorities(xport);1316 &nbsp; &nbsp; &nbsp; &nbsp;hmap_destroy(&amp;xport-&gt;skb_priorities);13171318 &nbsp; &nbsp; &nbsp; &nbsp;hmap_remove(&amp;xcfg-&gt;xports, &amp;xport-&gt;hmap_node); &nbsp; &nbsp; &nbsp;&lt;&lt;&lt;&lt;&lt;1319 &nbsp; &nbsp; &nbsp; &nbsp;hmap_remove(&amp;xport-&gt;xbridge-&gt;xports, &amp;xport-&gt;ofp_node);13201321 &nbsp; &nbsp; &nbsp; &nbsp;netdev_close(xport-&gt;netdev);(gdb) p &amp;xport-&gt;hmap_node$5 = (struct hmap_node *) 0x23874a0(gdb) p xport-&gt;hmap_node$6 = {hash = 7, next = 0x0}(gdb) p xcfg-&gt;xports$11 = {buckets = 0x2387620, one = 0x0, mask = 31, n = 45}(gdb) p xport-&gt;ofport$12 = (struct ofport_dpif *) 0x2232160(gdb) p *xport-&gt;o
 fport$13 = {odp_port_node = {hash = 0, next = 0x0}, up = {hmap_node = {&nbsp; &nbsp; &nbsp; hash = 186588107, next = 0x0}, ofproto = 0x21b6f20, netdev = 0x2231f90,&nbsp; &nbsp; pp = {port_no = 12, hw_addr = "\362\366\a\035\275D",&nbsp; &nbsp; &nbsp; name = "taf2fe2592c\000\000\000\000", config = 0,&nbsp; &nbsp; &nbsp; state = OFPUTIL_PS_STP_LISTEN, curr = 0, advertised = 0, supported = 0,&nbsp; &nbsp; &nbsp; peer = 0, curr_speed = 0, max_speed = 0}, ofp_port = 12, change_seq = 3,&nbsp; &nbsp; created = 1260028, mtu = 0, op_vendor_data = 0x22322a0, rte_node = {&nbsp; &nbsp; &nbsp; hash = 186588107, next = 0x0}}, ofpd_vendor_data = 0x21e03d0,&nbsp; odp_port = 9, bundle = 0x0, bundle_node = {prev = 0x0, next = 0x0},&nbsp; cfm = 0x0, bfd = 0x0, lldp = 0x0, may_enable = true, is_tunnel = true,&nbsp; is_layer3 = false, carrier_seq = 0, peer = 0x0, stp_port = 0x0,&nbsp; stp_state = STP_DISABLED, stp_state_entered = 0, rstp_port = 0x0,&nbsp; rstp_state = RSTP_DISABLED, qdscp = 0x0, 
 n
 _qdscp = 0, realdev_ofp_port = 0,&nbsp; vlandev_vid = 0}
However, peculiarly, we find that xport-&gt;hmap_node to be in wrong hash map bucket in frame 0 and as a result we trip. See below:
(gdb) frame 0#0 &nbsp;hmap_remove (xcfg=0x2289520, xport=0x23874a0) at lib/hmap.h:245245 &nbsp; &nbsp; &nbsp; &nbsp; while (*bucket != node) {(gdb) list240 &nbsp; &nbsp; &nbsp;* hmap_shrink() directly if desired. */241 &nbsp; &nbsp; static inline void242 &nbsp; &nbsp; hmap_remove(struct hmap *hmap, struct hmap_node *node)243 &nbsp; &nbsp; {244 &nbsp; &nbsp; &nbsp; &nbsp; struct hmap_node **bucket = &amp;hmap-&gt;buckets[node-&gt;hash &amp; hmap-&gt;mask];245 &nbsp; &nbsp; &nbsp; &nbsp; while (*bucket != node) {246 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bucket = &amp;(*bucket)-&gt;next;247 &nbsp; &nbsp; &nbsp; &nbsp; }248 &nbsp; &nbsp; &nbsp; &nbsp; *bucket = node-&gt;next;249 &nbsp; &nbsp; &nbsp; &nbsp; hmap-&gt;n--;(gdb) p node-&gt;hash &amp; hmap-&gt;mask$7 = 7(gdb) p hmap-&gt;buckets[7]$8 = (struct hmap_node *) 0x0
(gdb) p hmap-&gt;buckets[6]$15 = (struct hmap_node *) 0x23874a0
This makes us wonder if there is a bug in openvswitch-2.4 hash map library that computes wrong address during hashing. There is no particular sequence of events that reproduce this bug. But it often occurs during downloading flows from controller or even when adding some ports or deleting ports from ovs-vsctl.
Is this a known problem with openvswitch-2.4? If so, is there a patch available or is it fixed in new releases or master branch? Please help.
Regards,Richurov
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151003/946af544/attachment.html>

From a.alnajjar1 at uq.edu.au  Sat Oct  3 18:40:12 2015
From: a.alnajjar1 at uq.edu.au (Anees Mohsin Hadi Al-Najjar)
Date: Sun, 4 Oct 2015 01:40:12 +0000
Subject: [ovs-discuss] Assign IPs to switch ports
Message-ID: <a003599c5b1743dc85bef52b90e2092c@uq-exmbx1.soe.uq.edu.au>


Dear Colleagues,

Could I assign IPs to the OVS switch's ports?

I can do that with user switch , ofdatapath, and it works. However when I do that with OVS switch, I noticed when I write the "OVS-VSCTL show"  there is no port number for the assigned IP port.


Thanks,
Anees
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151004/6faa328c/attachment.html>

From a.alnajjar1 at uq.edu.au  Sat Oct  3 18:44:13 2015
From: a.alnajjar1 at uq.edu.au (Anees Mohsin Hadi Al-Najjar)
Date: Sun, 4 Oct 2015 01:44:13 +0000
Subject: [ovs-discuss] Assign IPs to switch ports
In-Reply-To: <a003599c5b1743dc85bef52b90e2092c@uq-exmbx1.soe.uq.edu.au>
References: <a003599c5b1743dc85bef52b90e2092c@uq-exmbx1.soe.uq.edu.au>
Message-ID: <fc43b3fe1b5943d3b08e0f573544d5d5@uq-exmbx1.soe.uq.edu.au>



Dear Colleagues,

Could I assign IP to the OVS switch's port and this port retain its port number at the same time?

I can do that with user switch , ofdatapath, and it works. However when I assign IP to a port in OVS switch, I noticed that there is no port number for that port when I write the "OVS-VSCTL show".



Thanks,
Anees
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151004/62f14788/attachment.html>

From voulalalou at yahoo.com  Sun Oct  4 08:20:36 2015
From: voulalalou at yahoo.com (VOULA LALOU)
Date: Sun, 4 Oct 2015 15:20:36 +0000 (UTC)
Subject: [ovs-discuss] info for open Vswitch
Message-ID: <494643662.199826.1443972036164.JavaMail.yahoo@mail.yahoo.com>

Hello, i am using Oracle Virtualbox on top of windows 7 32bit host. How can i install Open VSwitch in Windows host ? it will be helpful if you send me the installation document on windows. thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151004/b5d46e06/attachment.html>

From rishi.raj2509 at gmail.com  Sun Oct  4 22:17:50 2015
From: rishi.raj2509 at gmail.com (RishiRaj Maulick)
Date: Mon, 5 Oct 2015 10:47:50 +0530
Subject: [ovs-discuss] [ovs-dev] JSON parsing fails on powerpc
In-Reply-To: <20151001160108.GF30363@nicira.com>
References: <CAOLvpU4M2TB7+DtW8ARsSeZEynMXjynVQ_AV3bfRfNQWm-vQDw@mail.gmail.com>
 <20151001160108.GF30363@nicira.com>
Message-ID: <CAOLvpU5LUVphxZeUmDhaf5dcfotgaC2ia5V-YmQzAXkzFLT-GQ@mail.gmail.com>

Hi Ben,

We are using 2.4.0 , the problem is fixed now we had to do ./configure with
the –disable-ssl option .

Thanks and regards,
Rishi Raj

On Thu, Oct 1, 2015 at 9:31 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Oct 01, 2015 at 06:09:28PM +0530, RishiRaj Maulick wrote:
> > We are trying to cross-compile and run the ovs-vswitchd on a machine that
> > runs on powerPC architecture. We have cross-compiled the code
> successfully
> > however we are hitting some issues :-
> >
> > 1) When we try to create the conf.db file from the schema - it fails to
> > decode the JSON objects.
> > 2) Then we started to run the ovsdb-server on a x86 machine and ran
> > vswitchd on powerPC - used tcp to communicate between them .
> > 3) tcpdump confirms that the vswitchd was able to connect to the
> > ovsdb-server , it sent a "list_schemas" json request and the server
> replied
> > to that , and then it sent a "lock" request which also was successfully
> > replied by the ovsdb-server.
> > 4) At this stage we see that the vswitchd is sending a TCP reset towards
> > the server - the reason is because it thinks that the "lock" method has
> > failed - in bridge_run() the check for has_lock() fails.
> > 5) Also we see that the logs of vswitchd are not coming properly - all we
> > see are 0's .
> >
>
> Open vSwitch 2.3.x should work OK on powerpc.  It passes the testsuite
> there:
>         https://buildd.debian.org/status/package.php?p=openvswitch
>
> You didn't say what version you're using.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151005/2dcd35d9/attachment.html>

From gtvrreddy at gmail.com  Mon Oct  5 01:03:15 2015
From: gtvrreddy at gmail.com (Ramana Reddy)
Date: Mon, 5 Oct 2015 13:33:15 +0530
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04 with
	OVS bridge
Message-ID: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>

Hi all,

I installed a VM in NAT mode using virt-manager and edited the xml file as
per the
instructions  given in this link:

http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD

Basically It tells the following modofications:

And change it to something like this:

 ...
 <interface type='bridge'>
  <mac address='52:54:00:71:b1:b6'/>
  <source bridge='ovsbr'/>
  <virtualport type='openvswitch'/>
  <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
 </interface>
 ...

After modifications, I started VM. But its throwing the errors: Unable to
complete install: 'Unable to add bridge br0 port vnet0: Operation not
supported'

I started VM with both virsh start VM and virt-manager, but both are giving
the same error.

Does any one face the same problem. Please help me in this regards.

Thanks,
Ramana
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151005/86d15ec0/attachment.html>

From rishi.raj2509 at gmail.com  Mon Oct  5 08:39:56 2015
From: rishi.raj2509 at gmail.com (RishiRaj Maulick)
Date: Mon, 5 Oct 2015 21:09:56 +0530
Subject: [ovs-discuss] Openflow messages processing rate
Message-ID: <CAOLvpU7hitPdzkGnvBfRdhxKVk5knvhKS7wf_=nPE7hUYyotJg@mail.gmail.com>

Hi ,

The ofproto implementation at ovs-vswitchd process is single threaded. Are
there any plans of making this implementation multi-threaded such that the
open flow messages processing rate from a single controller increases.

We have a requirement to support > 50000 OF messages per second , so wanted
to check on the same.

Thanks and regards,
Rishi Raj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151005/4af193a3/attachment.html>

From shettyg at nicira.com  Mon Oct  5 09:08:29 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 5 Oct 2015 09:08:29 -0700
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
 with OVS bridge
In-Reply-To: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
Message-ID: <CAHbON5rY6B1=_X9G01rh2Kgohd90EvRBEs1EYWV8ateh2YubFQ@mail.gmail.com>

On Mon, Oct 5, 2015 at 1:03 AM, Ramana Reddy <gtvrreddy at gmail.com> wrote:
> Hi all,
>
> I installed a VM in NAT mode using virt-manager and edited the xml file as
> per the
> instructions  given in this link:
>
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
>
> Basically It tells the following modofications:
>
> And change it to something like this:
>
>  ...
>  <interface type='bridge'>
>   <mac address='52:54:00:71:b1:b6'/>
>   <source bridge='ovsbr'/>
>   <virtualport type='openvswitch'/>
>   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> function='0x0'/>
>  </interface>
>  ...
>
> After modifications, I started VM. But its throwing the errors: Unable to
> complete install: 'Unable to add bridge br0 port vnet0: Operation not
> supported'
>

I suppose 'dpkg -l | grep libvirt' shows version number greater than 0.9.11?
Also, have you already created your bridge "br0"? i.e. do you see it
in 'ovs-vsctl show' ?

Do you also have ovs-vswitchd seen in 'ps -ef | grep ovs'

From scott.lowe at scottlowe.org  Mon Oct  5 09:21:05 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Mon, 5 Oct 2015 10:21:05 -0600
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
	with OVS bridge
In-Reply-To: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
Message-ID: <F25B09B4-21AE-44C6-8FEE-CBCAD49BD72A@scottlowe.org>

Please see my response below.

Ramana Reddy <gtvrreddy at gmail.com> wrote:

> Hi all,
> 
> I installed a VM in NAT mode using virt-manager and edited the xml file as per the
> instructions  given in this link:
> 
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
> 
> Basically It tells the following modofications:
> And change it to something like this:
> 
>  ...
>  <interface type='bridge'>
>   <mac address='52:54:00:71:b1:b6'/>
>   <source bridge='ovsbr'/>
>   <virtualport type='openvswitch'/>
>   <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
>  </interface>
>  ...
> 
> After modifications, I started VM. But its throwing the errors: Unable to complete install: 'Unable to add bridge br0 port vnet0: Operation not supported'
> 
> I started VM with both virsh start VM and virt-manager, but both are giving the same error. 
> 
> Does any one face the same problem. Please help me in this regards. 



Can you share the actual XML you're using (just the network interface portion is needed), along with the output of "ovs-vsctl show"?

Also, I (personally) find the easiest way to work with libvirt+KVM+OVS is to use a libvirt network wrapped around OVS, as described here:

<http://blog.scottlowe.org/2012/11/07/using-vlans-with-ovs-and-libvirt/>

-- 
Scott


From rschroeder at inet.tu-berlin.de  Mon Oct  5 09:25:02 2015
From: rschroeder at inet.tu-berlin.de (=?utf-8?Q?Robert_Schr=C3=B6der?=)
Date: Mon, 5 Oct 2015 18:25:02 +0200
Subject: [ovs-discuss] Meter Implementation in Open vSwitch
Message-ID: <955F3B49-09AF-4341-A33F-B27306382A94@inet.tu-berlin.de>

Hi all,

I’d like to know why there is actually no meter implementation available in the Open vSwitch software switch. I’m working as a student in a project at TU Berlin and we want to experiment with meters. Currently we manage that issue with ofsoftswitch13 from CPqD but it has a poor performance and some other problems.

What is the reason why you haven’t implemented metering yet? And is there any solution to use metering with Open vSwitch software switch?

Thanks and best regards,
Robert
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 842 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151005/142ee00f/attachment.sig>

From shettyg at nicira.com  Mon Oct  5 10:11:45 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 5 Oct 2015 10:11:45 -0700
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
 with OVS bridge
In-Reply-To: <CAL2CrsNqqTzqP-oXu=MVw7M4u7uDTSuNyxW8Wg0UUV7B3c23Og@mail.gmail.com>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
 <CAHbON5rY6B1=_X9G01rh2Kgohd90EvRBEs1EYWV8ateh2YubFQ@mail.gmail.com>
 <CAL2CrsNqqTzqP-oXu=MVw7M4u7uDTSuNyxW8Wg0UUV7B3c23Og@mail.gmail.com>
Message-ID: <CAHbON5oDw_e14DdmypGmx+sXnhanGQiAhnMpM8gqrcievLQ3wA@mail.gmail.com>

All of your output looks correct. The next thing to do is to show your
entire vm xml file. Also, ovs runs as root. So your need to start your
vm as a root.

On Mon, Oct 5, 2015 at 9:56 AM, Ramana Reddy <gtvrreddy at gmail.com> wrote:
>
>
> On Mon, Oct 5, 2015 at 9:38 PM, Gurucharan Shetty <shettyg at nicira.com>
> wrote:
>>
>> On Mon, Oct 5, 2015 at 1:03 AM, Ramana Reddy <gtvrreddy at gmail.com> wrote:
>> > Hi all,
>> >
>> > I installed a VM in NAT mode using virt-manager and edited the xml file
>> > as
>> > per the
>> > instructions  given in this link:
>> >
>> >
>> > http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
>> >
>> > Basically It tells the following modofications:
>> >
>> > And change it to something like this:
>> >
>> >  ...
>> >  <interface type='bridge'>
>> >   <mac address='52:54:00:71:b1:b6'/>
>> >   <source bridge='ovsbr'/>
>> >   <virtualport type='openvswitch'/>
>> >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
>> > function='0x0'/>
>> >  </interface>
>> >  ...
>> >
>> > After modifications, I started VM. But its throwing the errors: Unable
>> > to
>> > complete install: 'Unable to add bridge br0 port vnet0: Operation not
>> > supported'
>> >
>>
>> I suppose 'dpkg -l | grep libvirt' shows version number greater than
>> 0.9.11?
>> Also, have you already created your bridge "br0"? i.e. do you see it
>> in 'ovs-vsctl show' ?
>>
>> Do you also have ovs-vswitchd seen in 'ps -ef | grep ovs'
>
>
> Hi Gurucharan,
>
> Thanks for your reply. Here is the output:
> $dpkg -l  | grep libvirt
> ii  libvirt-bin
> 1.2.2-0ubuntu13.1.14                               amd64        programs for
> the libvirt library
> ii  libvirt0
> 1.2.2-0ubuntu13.1.14                                amd64        library for
> interfacing with different virtualization systems
> ii  libvirtodbc0                                       6.1.6+repack-0ubuntu3
> amd64        high-performance database - ODBC libraries
> ii  python-libvirt                                     1.2.2-0ubuntu2
> amd64        libvirt Python bindings
>
> Yes, I created the br0 using ovs-vsctl command.
> $sudo ovs-vsctl show
> 92d0c0b6-bbbb-4f86-aebd-ec4cc33653a3
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "eth0"
>             Interface "eth0"
> $ps -ef | grep ovs
> root      2637  1849  0 22:11 ?        00:00:00 ovsdb-server
> --remote=punix:/usr/local/var/run/openvswitch/db.sock
> --remote=db:Open_vSwitch,Open_vSwitch,manager_options --pidfile --detach
> root      2642  1849  0 22:11 ?        00:00:01 ovs-vswitchd --pidfile
> --detach
> ramanar   5743  2469  0 22:26 pts/5    00:00:00 grep --color=auto ovs
>
>
>

From blp at nicira.com  Mon Oct  5 10:48:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 5 Oct 2015 10:48:45 -0700
Subject: [ovs-discuss] Meter Implementation in Open vSwitch
In-Reply-To: <955F3B49-09AF-4341-A33F-B27306382A94@inet.tu-berlin.de>
References: <955F3B49-09AF-4341-A33F-B27306382A94@inet.tu-berlin.de>
Message-ID: <20151005174845.GA23207@nicira.com>

On Mon, Oct 05, 2015 at 06:25:02PM +0200, Robert Schröder wrote:
> I’d like to know why there is actually no meter implementation
> available in the Open vSwitch software switch. I’m working as a
> student in a project at TU Berlin and we want to experiment with
> meters. Currently we manage that issue with ofsoftswitch13 from CPqD
> but it has a poor performance and some other problems.
> 
> What is the reason why you haven’t implemented metering yet? And is
> there any solution to use metering with Open vSwitch software switch?

I guess no one has needed it enough to implement it.

From blp at nicira.com  Mon Oct  5 10:49:37 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 5 Oct 2015 10:49:37 -0700
Subject: [ovs-discuss] [ovs-dev] Openflow messages processing rate
In-Reply-To: <CAOLvpU7hitPdzkGnvBfRdhxKVk5knvhKS7wf_=nPE7hUYyotJg@mail.gmail.com>
References: <CAOLvpU7hitPdzkGnvBfRdhxKVk5knvhKS7wf_=nPE7hUYyotJg@mail.gmail.com>
Message-ID: <20151005174937.GB23207@nicira.com>

On Mon, Oct 05, 2015 at 09:09:56PM +0530, RishiRaj Maulick wrote:
> The ofproto implementation at ovs-vswitchd process is single threaded. Are
> there any plans of making this implementation multi-threaded such that the
> open flow messages processing rate from a single controller increases.

I don't know of any such plans.

From scott.lowe at scottlowe.org  Mon Oct  5 12:04:58 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Mon, 5 Oct 2015 13:04:58 -0600
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
	with OVS bridge
In-Reply-To: <CAL2CrsMcvMq4SKRXjKrOuy3LWm_ruA2OEcy=S8Y++9DK9oam9w@mail.gmail.com>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
 <F25B09B4-21AE-44C6-8FEE-CBCAD49BD72A@scottlowe.org>
 <CAL2CrsMcvMq4SKRXjKrOuy3LWm_ruA2OEcy=S8Y++9DK9oam9w@mail.gmail.com>
Message-ID: <6F40562A-28DD-4B2F-B54C-60D8B30321B6@scottlowe.org>

Please see my responses inline, prefixed by [SL].

Ramana Reddy <gtvrreddy at gmail.com> wrote:

> Hi Scott,
> 
> I followed your blog mentioned in the url. I tried the following steps:
> 
> Create a br0.xml file:
> <network>
>   <name>br0</name>
>   <forward mode='bridge'/>
>   <bridge name='br0'/>
>   <virtualport type='openvswitch'/>
> </network>
> 
> $sudo virsh net-define br0.xml
> Network br0 defined from br0.xml
> 
> $sudo virsh net-start br0
> Network br0 started
> 
> $sudo virsh net-list --all
>  Name                 State      Autostart     Persistent
> ----------------------------------------------------------
>  br0                  active     no            yes
> 
> $sudo qemu-img create -f qcow2 /var/lib/libvirt/images/VM2.img 8G
> Formatting '/var/lib/libvirt/images/VM2.img', fmt=qcow2 size=8589934592 encryption=off cluster_size=65536 lazy_refcounts=off 
> 
> $sudo virt-install --connect qemu:///system --force --name VM2 --ram=1024 --vcpus=1 --disk path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2 --cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc --os-variant=ubuntutrusty --network=bridge:br0,model=virtio 
> 
> Starting install...
> ERROR    Unable to add bridge br0 port vnet0: Operation not supported
> Domain installation does not appear to have been successful.
> If it was, you can restart your domain by running:
>   virsh --connect qemu:///system start VM2
> 
> $sudo ovs-vsctl show
> 92d0c0b6-bbbb-4f86-aebd-ec4cc33653a3
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "eth0"
>             Interface "eth0"
> 
> 
> 
> Any idea why this approach is not working.


[SL] If you create a libvirt network to "front end" the OVS bridge, then you would no longer use "--network=bridge:br0,model=virtio" but "--network=br0,model=virtio" (specifying the name of the libvirt network that you created).

Hope this makes sense.


> Some how the second method is working fine. I created a VM using NAT, and then modified VM XML file as per instructions mentioned below:
> <interface type='bridge'>
>   <mac address='52:54:00:71:b1:b6'/>
>   <source bridge='br0'/>
>   <virtualport type='openvswitch'/>
>   <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
>  </interface>
> 
> This is working now. I tried this one previously, and not working. May be it messed up with some thing!!
> 
> Thanks for all your inputs. I thought that I can go with my old setup (ubuntu 12.04 with brcompat module with ovs 1.9.3: it was working well).
> 
>  
> 
>  
> 
> 
> On Mon, Oct 5, 2015 at 9:51 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> Please see my response below.
> 
> Ramana Reddy <gtvrreddy at gmail.com> wrote:
> 
> > Hi all,
> >
> > I installed a VM in NAT mode using virt-manager and edited the xml file as per the
> > instructions  given in this link:
> >
> > http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
> >
> > Basically It tells the following modofications:
> > And change it to something like this:
> >
> >  ...
> >  <interface type='bridge'>
> >   <mac address='52:54:00:71:b1:b6'/>
> >   <source bridge='ovsbr'/>
> >   <virtualport type='openvswitch'/>
> >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
> >  </interface>
> >  ...
> >
> > After modifications, I started VM. But its throwing the errors: Unable to complete install: 'Unable to add bridge br0 port vnet0: Operation not supported'
> >
> > I started VM with both virsh start VM and virt-manager, but both are giving the same error.
> >
> > Does any one face the same problem. Please help me in this regards.
> 
> 
> 
> Can you share the actual XML you're using (just the network interface portion is needed), along with the output of "ovs-vsctl show"?
> 
> Also, I (personally) find the easiest way to work with libvirt+KVM+OVS is to use a libvirt network wrapped around OVS, as described here:
> 
> <http://blog.scottlowe.org/2012/11/07/using-vlans-with-ovs-and-libvirt/>
> 
> --
> Scott



From scott.lowe at scottlowe.org  Mon Oct  5 12:26:05 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Mon, 5 Oct 2015 13:26:05 -0600
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
	with OVS bridge
In-Reply-To: <CAL2CrsOYRU2VbBRGhMi=Bw3zTeEqoqgT9SnWHV5vHNsjXJv57g@mail.gmail.com>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
 <F25B09B4-21AE-44C6-8FEE-CBCAD49BD72A@scottlowe.org>
 <CAL2CrsMcvMq4SKRXjKrOuy3LWm_ruA2OEcy=S8Y++9DK9oam9w@mail.gmail.com>
 <6F40562A-28DD-4B2F-B54C-60D8B30321B6@scottlowe.org>
 <CAL2CrsOYRU2VbBRGhMi=Bw3zTeEqoqgT9SnWHV5vHNsjXJv57g@mail.gmail.com>
Message-ID: <D5BAA2D9-9F9C-44FC-AD6F-CB9F985DA5A2@scottlowe.org>

Please see my responses inline, prefixed by [SL].


Ramana Reddy <gtvrreddy at gmail.com> wrote:

> I got the following error after trying this command:
> 
> $sudo virt-install --connect qemu:///system --force --name VM2 --ram=1024 --vcpus=1 --disk path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2 --cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc --os-variant=ubuntutrusty --network=br0,model=virtio 
> ERROR    Error in network device parameters: Unknown network type br0
> 
> br0.xml file:
>  <network>
>    <name>br0</name>
>    <forward mode='bridge'/>
>    <bridge name='br0'/>
>    <virtualport type='openvswitch'/>
>   </network>
> 
> Did I miss something. 


[SL] Try adding a portgroup, like this:


<network>
  <name>br0</name>
  <forward mode='bridge'/>
  <bridge name='br0'/>
  <virtualport type='openvswitch'/>
  <portgroup name='default' default='yes'>
  </portgroup>
</network>

Let me know how that works. I'm using this configuration actively right now on Ubuntu 14.04, KVM, libvirt 1.2.2, and OVS 2.3.2.


> On Tue, Oct 6, 2015 at 12:34 AM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> Please see my responses inline, prefixed by [SL].
> 
> Ramana Reddy <gtvrreddy at gmail.com> wrote:
> 
> > Hi Scott,
> >
> > I followed your blog mentioned in the url. I tried the following steps:
> >
> > Create a br0.xml file:
> > <network>
> >   <name>br0</name>
> >   <forward mode='bridge'/>
> >   <bridge name='br0'/>
> >   <virtualport type='openvswitch'/>
> > </network>
> >
> > $sudo virsh net-define br0.xml
> > Network br0 defined from br0.xml
> >
> > $sudo virsh net-start br0
> > Network br0 started
> >
> > $sudo virsh net-list --all
> >  Name                 State      Autostart     Persistent
> > ----------------------------------------------------------
> >  br0                  active     no            yes
> >
> > $sudo qemu-img create -f qcow2 /var/lib/libvirt/images/VM2.img 8G
> > Formatting '/var/lib/libvirt/images/VM2.img', fmt=qcow2 size=8589934592 encryption=off cluster_size=65536 lazy_refcounts=off
> >
> > $sudo virt-install --connect qemu:///system --force --name VM2 --ram=1024 --vcpus=1 --disk path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2 --cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc --os-variant=ubuntutrusty --network=bridge:br0,model=virtio
> >
> > Starting install...
> > ERROR    Unable to add bridge br0 port vnet0: Operation not supported
> > Domain installation does not appear to have been successful.
> > If it was, you can restart your domain by running:
> >   virsh --connect qemu:///system start VM2
> >
> > $sudo ovs-vsctl show
> > 92d0c0b6-bbbb-4f86-aebd-ec4cc33653a3
> >     Bridge "br0"
> >         Port "br0"
> >             Interface "br0"
> >                 type: internal
> >         Port "eth0"
> >             Interface "eth0"
> >
> >
> >
> > Any idea why this approach is not working.
> 
> 
> [SL] If you create a libvirt network to "front end" the OVS bridge, then you would no longer use "--network=bridge:br0,model=virtio" but "--network=br0,model=virtio" (specifying the name of the libvirt network that you created).
> 
> Hope this makes sense.
> 
> 
> > Some how the second method is working fine. I created a VM using NAT, and then modified VM XML file as per instructions mentioned below:
> > <interface type='bridge'>
> >   <mac address='52:54:00:71:b1:b6'/>
> >   <source bridge='br0'/>
> >   <virtualport type='openvswitch'/>
> >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
> >  </interface>
> >
> > This is working now. I tried this one previously, and not working. May be it messed up with some thing!!
> >
> > Thanks for all your inputs. I thought that I can go with my old setup (ubuntu 12.04 with brcompat module with ovs 1.9.3: it was working well).
> >
> >
> >
> >
> >
> >
> > On Mon, Oct 5, 2015 at 9:51 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> > Please see my response below.
> >
> > Ramana Reddy <gtvrreddy at gmail.com> wrote:
> >
> > > Hi all,
> > >
> > > I installed a VM in NAT mode using virt-manager and edited the xml file as per the
> > > instructions  given in this link:
> > >
> > > http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
> > >
> > > Basically It tells the following modofications:
> > > And change it to something like this:
> > >
> > >  ...
> > >  <interface type='bridge'>
> > >   <mac address='52:54:00:71:b1:b6'/>
> > >   <source bridge='ovsbr'/>
> > >   <virtualport type='openvswitch'/>
> > >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>
> > >  </interface>
> > >  ...
> > >
> > > After modifications, I started VM. But its throwing the errors: Unable to complete install: 'Unable to add bridge br0 port vnet0: Operation not supported'
> > >
> > > I started VM with both virsh start VM and virt-manager, but both are giving the same error.
> > >
> > > Does any one face the same problem. Please help me in this regards.
> >
> >
> >
> > Can you share the actual XML you're using (just the network interface portion is needed), along with the output of "ovs-vsctl show"?
> >
> > Also, I (personally) find the easiest way to work with libvirt+KVM+OVS is to use a libvirt network wrapped around OVS, as described here:
> >
> > <http://blog.scottlowe.org/2012/11/07/using-vlans-with-ovs-and-libvirt/>
> >
> > --
> > Scott



From gtvrreddy at gmail.com  Mon Oct  5 09:56:20 2015
From: gtvrreddy at gmail.com (Ramana Reddy)
Date: Mon, 5 Oct 2015 22:26:20 +0530
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
 with OVS bridge
In-Reply-To: <CAHbON5rY6B1=_X9G01rh2Kgohd90EvRBEs1EYWV8ateh2YubFQ@mail.gmail.com>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
 <CAHbON5rY6B1=_X9G01rh2Kgohd90EvRBEs1EYWV8ateh2YubFQ@mail.gmail.com>
Message-ID: <CAL2CrsNqqTzqP-oXu=MVw7M4u7uDTSuNyxW8Wg0UUV7B3c23Og@mail.gmail.com>

On Mon, Oct 5, 2015 at 9:38 PM, Gurucharan Shetty <shettyg at nicira.com>
wrote:

> On Mon, Oct 5, 2015 at 1:03 AM, Ramana Reddy <gtvrreddy at gmail.com> wrote:
> > Hi all,
> >
> > I installed a VM in NAT mode using virt-manager and edited the xml file
> as
> > per the
> > instructions  given in this link:
> >
> >
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
> >
> > Basically It tells the following modofications:
> >
> > And change it to something like this:
> >
> >  ...
> >  <interface type='bridge'>
> >   <mac address='52:54:00:71:b1:b6'/>
> >   <source bridge='ovsbr'/>
> >   <virtualport type='openvswitch'/>
> >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> > function='0x0'/>
> >  </interface>
> >  ...
> >
> > After modifications, I started VM. But its throwing the errors: Unable to
> > complete install: 'Unable to add bridge br0 port vnet0: Operation not
> > supported'
> >
>
> I suppose 'dpkg -l | grep libvirt' shows version number greater than
> 0.9.11?
> Also, have you already created your bridge "br0"? i.e. do you see it
> in 'ovs-vsctl show' ?
>
> Do you also have ovs-vswitchd seen in 'ps -ef | grep ovs'
>

Hi Gurucharan,

Thanks for your reply. Here is the output:
$dpkg -l  | grep libvirt
ii  libvirt-bin
1.2.2-0ubuntu13.1.14                               amd64        programs
for the libvirt library
ii  libvirt0
1.2.2-0ubuntu13.1.14                                amd64        library
for interfacing with different virtualization systems
ii  libvirtodbc0
6.1.6+repack-0ubuntu3                             amd64
high-performance database - ODBC libraries
ii  python-libvirt
1.2.2-0ubuntu2                                         amd64        libvirt
Python bindings

Yes, I created the br0 using ovs-vsctl command.
$sudo ovs-vsctl show
92d0c0b6-bbbb-4f86-aebd-ec4cc33653a3
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
        Port "eth0"
            Interface "eth0"
$ps -ef | grep ovs
root      2637  1849  0 22:11 ?        00:00:00 ovsdb-server
--remote=punix:/usr/local/var/run/openvswitch/db.sock
--remote=db:Open_vSwitch,Open_vSwitch,manager_options --pidfile --detach
root      2642  1849  0 22:11 ?        00:00:01 ovs-vswitchd --pidfile
--detach
ramanar   5743  2469  0 22:26 pts/5    00:00:00 grep --color=auto ovs
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151005/09cdaee7/attachment-0001.html>

From gtvrreddy at gmail.com  Mon Oct  5 11:55:27 2015
From: gtvrreddy at gmail.com (Ramana Reddy)
Date: Tue, 6 Oct 2015 00:25:27 +0530
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
 with OVS bridge
In-Reply-To: <F25B09B4-21AE-44C6-8FEE-CBCAD49BD72A@scottlowe.org>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
 <F25B09B4-21AE-44C6-8FEE-CBCAD49BD72A@scottlowe.org>
Message-ID: <CAL2CrsMcvMq4SKRXjKrOuy3LWm_ruA2OEcy=S8Y++9DK9oam9w@mail.gmail.com>

Hi Scott,

I followed your blog mentioned in the url. I tried the following steps:

Create a br0.xml file:
<network>
  <name>br0</name>
  <forward mode='bridge'/>
  <bridge name='br0'/>
  <virtualport type='openvswitch'/>
</network>

$sudo virsh net-define br0.xml
Network br0 defined from br0.xml

$sudo virsh net-start br0
Network br0 started

$sudo virsh net-list --all
 Name                 State      Autostart     Persistent
----------------------------------------------------------
 br0                  active     no            yes

$sudo qemu-img create -f qcow2 /var/lib/libvirt/images/VM2.img 8G
Formatting '/var/lib/libvirt/images/VM2.img', fmt=qcow2 size=8589934592
encryption=off cluster_size=65536 lazy_refcounts=off

$sudo virt-install --connect qemu:///system --force --name VM2 --ram=1024
--vcpus=1 --disk path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2
--cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc
--os-variant=ubuntutrusty --network=bridge:br0,model=virtio

Starting install...
ERROR    Unable to add bridge br0 port vnet0: Operation not supported
Domain installation does not appear to have been successful.
If it was, you can restart your domain by running:
  virsh --connect qemu:///system start VM2

$sudo ovs-vsctl show
92d0c0b6-bbbb-4f86-aebd-ec4cc33653a3
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
        Port "eth0"
            Interface "eth0"



Any idea why this approach is not working.
Some how the second method is working fine. I created a VM using NAT, and
then modified VM XML file as per instructions mentioned below:
<interface type='bridge'>
  <mac address='52:54:00:71:b1:b6'/>
  <source bridge='br0'/>
  <virtualport type='openvswitch'/>
  <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
function='0x0'/>
 </interface>

This is working now. I tried this one previously, and not working. May be
it messed up with some thing!!

Thanks for all your inputs. I thought that I can go with my old setup
(ubuntu 12.04 with brcompat module with ovs 1.9.3: it was working well).






On Mon, Oct 5, 2015 at 9:51 PM, Scott Lowe <scott.lowe at scottlowe.org> wrote:

> Please see my response below.
>
> Ramana Reddy <gtvrreddy at gmail.com> wrote:
>
> > Hi all,
> >
> > I installed a VM in NAT mode using virt-manager and edited the xml file
> as per the
> > instructions  given in this link:
> >
> >
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
> >
> > Basically It tells the following modofications:
> > And change it to something like this:
> >
> >  ...
> >  <interface type='bridge'>
> >   <mac address='52:54:00:71:b1:b6'/>
> >   <source bridge='ovsbr'/>
> >   <virtualport type='openvswitch'/>
> >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> function='0x0'/>
> >  </interface>
> >  ...
> >
> > After modifications, I started VM. But its throwing the errors: Unable
> to complete install: 'Unable to add bridge br0 port vnet0: Operation not
> supported'
> >
> > I started VM with both virsh start VM and virt-manager, but both are
> giving the same error.
> >
> > Does any one face the same problem. Please help me in this regards.
>
>
>
> Can you share the actual XML you're using (just the network interface
> portion is needed), along with the output of "ovs-vsctl show"?
>
> Also, I (personally) find the easiest way to work with libvirt+KVM+OVS is
> to use a libvirt network wrapped around OVS, as described here:
>
> <http://blog.scottlowe.org/2012/11/07/using-vlans-with-ovs-and-libvirt/>
>
> --
> Scott
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151006/ac67416b/attachment-0001.html>

From gtvrreddy at gmail.com  Mon Oct  5 12:21:04 2015
From: gtvrreddy at gmail.com (Ramana Reddy)
Date: Tue, 6 Oct 2015 00:51:04 +0530
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
 with OVS bridge
In-Reply-To: <6F40562A-28DD-4B2F-B54C-60D8B30321B6@scottlowe.org>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
 <F25B09B4-21AE-44C6-8FEE-CBCAD49BD72A@scottlowe.org>
 <CAL2CrsMcvMq4SKRXjKrOuy3LWm_ruA2OEcy=S8Y++9DK9oam9w@mail.gmail.com>
 <6F40562A-28DD-4B2F-B54C-60D8B30321B6@scottlowe.org>
Message-ID: <CAL2CrsOYRU2VbBRGhMi=Bw3zTeEqoqgT9SnWHV5vHNsjXJv57g@mail.gmail.com>

I got the following error after trying this command:

$sudo virt-install --connect qemu:///system --force --name VM2 --ram=1024
--vcpus=1 --disk path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2
--cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc
--os-variant=ubuntutrusty --network=br0,model=virtio
ERROR    Error in network device parameters: Unknown network type br0

*br0.xml file:*
 <network>
   <name>br0</name>
   <forward mode='bridge'/>
   <bridge name='br0'/>
   <virtualport type='openvswitch'/>
  </network>

Did I miss something.


On Tue, Oct 6, 2015 at 12:34 AM, Scott Lowe <scott.lowe at scottlowe.org>
wrote:

> Please see my responses inline, prefixed by [SL].
>
> Ramana Reddy <gtvrreddy at gmail.com> wrote:
>
> > Hi Scott,
> >
> > I followed your blog mentioned in the url. I tried the following steps:
> >
> > Create a br0.xml file:
> > <network>
> >   <name>br0</name>
> >   <forward mode='bridge'/>
> >   <bridge name='br0'/>
> >   <virtualport type='openvswitch'/>
> > </network>
> >
> > $sudo virsh net-define br0.xml
> > Network br0 defined from br0.xml
> >
> > $sudo virsh net-start br0
> > Network br0 started
> >
> > $sudo virsh net-list --all
> >  Name                 State      Autostart     Persistent
> > ----------------------------------------------------------
> >  br0                  active     no            yes
> >
> > $sudo qemu-img create -f qcow2 /var/lib/libvirt/images/VM2.img 8G
> > Formatting '/var/lib/libvirt/images/VM2.img', fmt=qcow2 size=8589934592
> encryption=off cluster_size=65536 lazy_refcounts=off
> >
> > $sudo virt-install --connect qemu:///system --force --name VM2
> --ram=1024 --vcpus=1 --disk
> path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2
> --cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc
> --os-variant=ubuntutrusty --network=bridge:br0,model=virtio
> >
> > Starting install...
> > ERROR    Unable to add bridge br0 port vnet0: Operation not supported
> > Domain installation does not appear to have been successful.
> > If it was, you can restart your domain by running:
> >   virsh --connect qemu:///system start VM2
> >
> > $sudo ovs-vsctl show
> > 92d0c0b6-bbbb-4f86-aebd-ec4cc33653a3
> >     Bridge "br0"
> >         Port "br0"
> >             Interface "br0"
> >                 type: internal
> >         Port "eth0"
> >             Interface "eth0"
> >
> >
> >
> > Any idea why this approach is not working.
>
>
> [SL] If you create a libvirt network to "front end" the OVS bridge, then
> you would no longer use "--network=bridge:br0,model=virtio" but
> "--network=br0,model=virtio" (specifying the name of the libvirt network
> that you created).
>
> Hope this makes sense.
>
>
> > Some how the second method is working fine. I created a VM using NAT,
> and then modified VM XML file as per instructions mentioned below:
> > <interface type='bridge'>
> >   <mac address='52:54:00:71:b1:b6'/>
> >   <source bridge='br0'/>
> >   <virtualport type='openvswitch'/>
> >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> function='0x0'/>
> >  </interface>
> >
> > This is working now. I tried this one previously, and not working. May
> be it messed up with some thing!!
> >
> > Thanks for all your inputs. I thought that I can go with my old setup
> (ubuntu 12.04 with brcompat module with ovs 1.9.3: it was working well).
> >
> >
> >
> >
> >
> >
> > On Mon, Oct 5, 2015 at 9:51 PM, Scott Lowe <scott.lowe at scottlowe.org>
> wrote:
> > Please see my response below.
> >
> > Ramana Reddy <gtvrreddy at gmail.com> wrote:
> >
> > > Hi all,
> > >
> > > I installed a VM in NAT mode using virt-manager and edited the xml
> file as per the
> > > instructions  given in this link:
> > >
> > >
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
> > >
> > > Basically It tells the following modofications:
> > > And change it to something like this:
> > >
> > >  ...
> > >  <interface type='bridge'>
> > >   <mac address='52:54:00:71:b1:b6'/>
> > >   <source bridge='ovsbr'/>
> > >   <virtualport type='openvswitch'/>
> > >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> function='0x0'/>
> > >  </interface>
> > >  ...
> > >
> > > After modifications, I started VM. But its throwing the errors: Unable
> to complete install: 'Unable to add bridge br0 port vnet0: Operation not
> supported'
> > >
> > > I started VM with both virsh start VM and virt-manager, but both are
> giving the same error.
> > >
> > > Does any one face the same problem. Please help me in this regards.
> >
> >
> >
> > Can you share the actual XML you're using (just the network interface
> portion is needed), along with the output of "ovs-vsctl show"?
> >
> > Also, I (personally) find the easiest way to work with libvirt+KVM+OVS
> is to use a libvirt network wrapped around OVS, as described here:
> >
> > <http://blog.scottlowe.org/2012/11/07/using-vlans-with-ovs-and-libvirt/>
> >
> > --
> > Scott
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151006/e2f9e43a/attachment-0001.html>

From a.alnajjar1 at uq.edu.au  Mon Oct  5 16:24:19 2015
From: a.alnajjar1 at uq.edu.au (Anees Mohsin Hadi Al-Najjar)
Date: Mon, 5 Oct 2015 23:24:19 +0000
Subject: [ovs-discuss] Controller with ovs-dpctl
Message-ID: <e2e1b0b888eb4fa49acf6c01031cb107@uq-exmbx1.soe.uq.edu.au>

Dear all,
Kindly, has anybody connected Ryu controller with ovs-dpctl add-dp?
I need to OVS user-space, and I have found that I can use ovs-dpctl.  I tried to connect the datapath with the controller, but I couldn't.

I need your help.


Thanks

Anees
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151005/1410c7dd/attachment.html>

From jpettit at nicira.com  Mon Oct  5 17:00:58 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 5 Oct 2015 17:00:58 -0700
Subject: [ovs-discuss] Controller with ovs-dpctl
In-Reply-To: <e2e1b0b888eb4fa49acf6c01031cb107@uq-exmbx1.soe.uq.edu.au>
References: <e2e1b0b888eb4fa49acf6c01031cb107@uq-exmbx1.soe.uq.edu.au>
Message-ID: <5262503F-EC07-4CE2-9561-34EA512379AC@nicira.com>

You wouldn't connect to a controller through the datapath.  You'll want to use "ovs-vsctl set-controller".  There are examples on the Web.

--Justin


> On Oct 5, 2015, at 4:24 PM, Anees Mohsin Hadi Al-Najjar <a.alnajjar1 at uq.edu.au> wrote:
> 
> Dear all,
> Kindly, has anybody connected Ryu controller with ovs-dpctl add-dp?
> I need to OVS user-space, and I have found that I can use ovs-dpctl.  I tried to connect the datapath with the controller, but I couldn’t.
>  
> I need your help.
>  
>  
> Thanks
>  
> Anees
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Tue Oct  6 08:29:33 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 6 Oct 2015 08:29:33 -0700
Subject: [ovs-discuss] Handling "Port Shutdown" message
In-Reply-To: <CAHWErLf_me2BtGwtdxxO55kXr=fX9VB6uH4ofpAFqNjekzbGFw@mail.gmail.com>
References: <CAHWErLf_me2BtGwtdxxO55kXr=fX9VB6uH4ofpAFqNjekzbGFw@mail.gmail.com>
Message-ID: <20151006152933.GD6253@nicira.com>

On Tue, Oct 06, 2015 at 12:14:21PM +0530, tech_kals Kals wrote:
>   Can someone clarify me whether OVS handles port shutdown message? I am
> not seeing it in "port_reconfigured" function.
> 
>   If this is the case then controller may not be aware that when port is
> configured to admin down.
> 
> *  Can someone tell me how port shut message is communicated to the
> controller if OVS is not processing port shut message ?*

What's a port shutdown message?  Who sends it?

From gtvrreddy at gmail.com  Mon Oct  5 12:39:04 2015
From: gtvrreddy at gmail.com (Ramana Reddy)
Date: Tue, 6 Oct 2015 01:09:04 +0530
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
 with OVS bridge
In-Reply-To: <D5BAA2D9-9F9C-44FC-AD6F-CB9F985DA5A2@scottlowe.org>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
 <F25B09B4-21AE-44C6-8FEE-CBCAD49BD72A@scottlowe.org>
 <CAL2CrsMcvMq4SKRXjKrOuy3LWm_ruA2OEcy=S8Y++9DK9oam9w@mail.gmail.com>
 <6F40562A-28DD-4B2F-B54C-60D8B30321B6@scottlowe.org>
 <CAL2CrsOYRU2VbBRGhMi=Bw3zTeEqoqgT9SnWHV5vHNsjXJv57g@mail.gmail.com>
 <D5BAA2D9-9F9C-44FC-AD6F-CB9F985DA5A2@scottlowe.org>
Message-ID: <CAL2CrsP2XS5qZLGCTCcxkAOWrqd8wXjT+yKcKYgLHfxcuvpK7g@mail.gmail.com>

After modifications also, I got the same error:
ERROR    Error in network device parameters: Unknown network type br0

I am using Ubuntu 14.04 (64-bit) and libvirt 1.2.2 and OVS 2.4.0

May be I will try from scratch and let you know.


On Tue, Oct 6, 2015 at 12:56 AM, Scott Lowe <scott.lowe at scottlowe.org>
wrote:

> Please see my responses inline, prefixed by [SL].
>
>
> Ramana Reddy <gtvrreddy at gmail.com> wrote:
>
> > I got the following error after trying this command:
> >
> > $sudo virt-install --connect qemu:///system --force --name VM2
> --ram=1024 --vcpus=1 --disk
> path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2
> --cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc
> --os-variant=ubuntutrusty --network=br0,model=virtio
> > ERROR    Error in network device parameters: Unknown network type br0
> >
> > br0.xml file:
> >  <network>
> >    <name>br0</name>
> >    <forward mode='bridge'/>
> >    <bridge name='br0'/>
> >    <virtualport type='openvswitch'/>
> >   </network>
> >
> > Did I miss something.
>
>
> [SL] Try adding a portgroup, like this:
>
>
> <network>
>   <name>br0</name>
>   <forward mode='bridge'/>
>   <bridge name='br0'/>
>   <virtualport type='openvswitch'/>
>   <portgroup name='default' default='yes'>
>   </portgroup>
> </network>
>
> Let me know how that works. I'm using this configuration actively right
> now on Ubuntu 14.04, KVM, libvirt 1.2.2, and OVS 2.3.2.
>
>
> > On Tue, Oct 6, 2015 at 12:34 AM, Scott Lowe <scott.lowe at scottlowe.org>
> wrote:
> > Please see my responses inline, prefixed by [SL].
> >
> > Ramana Reddy <gtvrreddy at gmail.com> wrote:
> >
> > > Hi Scott,
> > >
> > > I followed your blog mentioned in the url. I tried the following steps:
> > >
> > > Create a br0.xml file:
> > > <network>
> > >   <name>br0</name>
> > >   <forward mode='bridge'/>
> > >   <bridge name='br0'/>
> > >   <virtualport type='openvswitch'/>
> > > </network>
> > >
> > > $sudo virsh net-define br0.xml
> > > Network br0 defined from br0.xml
> > >
> > > $sudo virsh net-start br0
> > > Network br0 started
> > >
> > > $sudo virsh net-list --all
> > >  Name                 State      Autostart     Persistent
> > > ----------------------------------------------------------
> > >  br0                  active     no            yes
> > >
> > > $sudo qemu-img create -f qcow2 /var/lib/libvirt/images/VM2.img 8G
> > > Formatting '/var/lib/libvirt/images/VM2.img', fmt=qcow2
> size=8589934592 encryption=off cluster_size=65536 lazy_refcounts=off
> > >
> > > $sudo virt-install --connect qemu:///system --force --name VM2
> --ram=1024 --vcpus=1 --disk
> path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2
> --cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc
> --os-variant=ubuntutrusty --network=bridge:br0,model=virtio
> > >
> > > Starting install...
> > > ERROR    Unable to add bridge br0 port vnet0: Operation not supported
> > > Domain installation does not appear to have been successful.
> > > If it was, you can restart your domain by running:
> > >   virsh --connect qemu:///system start VM2
> > >
> > > $sudo ovs-vsctl show
> > > 92d0c0b6-bbbb-4f86-aebd-ec4cc33653a3
> > >     Bridge "br0"
> > >         Port "br0"
> > >             Interface "br0"
> > >                 type: internal
> > >         Port "eth0"
> > >             Interface "eth0"
> > >
> > >
> > >
> > > Any idea why this approach is not working.
> >
> >
> > [SL] If you create a libvirt network to "front end" the OVS bridge, then
> you would no longer use "--network=bridge:br0,model=virtio" but
> "--network=br0,model=virtio" (specifying the name of the libvirt network
> that you created).
> >
> > Hope this makes sense.
> >
> >
> > > Some how the second method is working fine. I created a VM using NAT,
> and then modified VM XML file as per instructions mentioned below:
> > > <interface type='bridge'>
> > >   <mac address='52:54:00:71:b1:b6'/>
> > >   <source bridge='br0'/>
> > >   <virtualport type='openvswitch'/>
> > >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> function='0x0'/>
> > >  </interface>
> > >
> > > This is working now. I tried this one previously, and not working. May
> be it messed up with some thing!!
> > >
> > > Thanks for all your inputs. I thought that I can go with my old setup
> (ubuntu 12.04 with brcompat module with ovs 1.9.3: it was working well).
> > >
> > >
> > >
> > >
> > >
> > >
> > > On Mon, Oct 5, 2015 at 9:51 PM, Scott Lowe <scott.lowe at scottlowe.org>
> wrote:
> > > Please see my response below.
> > >
> > > Ramana Reddy <gtvrreddy at gmail.com> wrote:
> > >
> > > > Hi all,
> > > >
> > > > I installed a VM in NAT mode using virt-manager and edited the xml
> file as per the
> > > > instructions  given in this link:
> > > >
> > > >
> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
> > > >
> > > > Basically It tells the following modofications:
> > > > And change it to something like this:
> > > >
> > > >  ...
> > > >  <interface type='bridge'>
> > > >   <mac address='52:54:00:71:b1:b6'/>
> > > >   <source bridge='ovsbr'/>
> > > >   <virtualport type='openvswitch'/>
> > > >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
> function='0x0'/>
> > > >  </interface>
> > > >  ...
> > > >
> > > > After modifications, I started VM. But its throwing the errors:
> Unable to complete install: 'Unable to add bridge br0 port vnet0: Operation
> not supported'
> > > >
> > > > I started VM with both virsh start VM and virt-manager, but both are
> giving the same error.
> > > >
> > > > Does any one face the same problem. Please help me in this regards.
> > >
> > >
> > >
> > > Can you share the actual XML you're using (just the network interface
> portion is needed), along with the output of "ovs-vsctl show"?
> > >
> > > Also, I (personally) find the easiest way to work with libvirt+KVM+OVS
> is to use a libvirt network wrapped around OVS, as described here:
> > >
> > > <
> http://blog.scottlowe.org/2012/11/07/using-vlans-with-ovs-and-libvirt/>
> > >
> > > --
> > > Scott
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151006/41afefc1/attachment-0001.html>

From kesri1234 at rediffmail.com  Mon Oct  5 15:38:27 2015
From: kesri1234 at rediffmail.com (Richukov Kes)
Date: 5 Oct 2015 22:38:27 -0000
Subject: [ovs-discuss] =?utf-8?q?new_crash_with_openvswitch-2=2E4_in_ovsdb?=
	=?utf-8?q?=5Fdatum=5Fequals?=
Message-ID: <20151005223827.9362.qmail@f4mail-235-236.rediffmail.com>


Dear Sir:

We upgrading to openvswitch-2.4 and ran ovs-vsctl set-controller command in a script to point to a controller and soon noticed a crash in ovs-
vswitchd with below back trace. Can anyone please check if this has a fix in newer release or point me to what I am doing wrong?

#0  0x00007f76793422b6 in __strcmp_sse42 () from /lib64/libc.so.6
#1  0x00000000004b7ae5 in atom_arrays_compare_3way (a=0x29d79f8,
    b=0x7fff554b4f40, type=0x894e20) at lib/ovsdb-data.c:1582
#2  ovsdb_datum_compare_3way (a=0x29d79f8, b=0x7fff554b4f40, type=0x894e20)
    at lib/ovsdb-data.c:1610
#3  0x00000000004b7b69 in ovsdb_datum_equals (a=,
    b=, type=)
    at lib/ovsdb-data.c:1596
#4  0x00000000004bb36e in ovsdb_idl_txn_write__ (row_=0x29d74a0,
    column=0x894e18, datum=0x7fff554b4f40, owns_datum=true)
    at lib/ovsdb-idl.c:2087
#5  0x00000000004f04b5 in ovsrec_interface_set_statistics (row=0x29d74a0,
    key_statistics=, value_statistics=0x7fff554b50b0,
    n_statistics=12) at lib/vswitch-idl.c:11535
#6  0x00000000004083e8 in iface_refresh_stats (iface=0x29c2c40)
    at vswitchd/bridge.c:2419
#7  0x0000000000411a6c in run_stats_update () at vswitchd/bridge.c:2793
#8  bridge_run () at vswitchd/bridge.c:3073
#9  0x00000000004121ad in main (argc=10, argv=0x7fff554b5338)
    at vswitchd/ovs-vswitchd.c:131

(gdb) frame 1
#1  0x00000000004b7ae5 in atom_arrays_compare_3way (a=0x29d79f8,
    b=0x7fff554b4f40, type=0x894e20) at lib/ovsdb-data.c:1582
1582            int cmp = ovsdb_atom_compare_3way(&a[i], &b[i], type);
(gdb) p *b
$11 = {integer = 44305824, real = 2.1889985549088601e-316, boolean = 160,
  string = 0x2a40da0 "collisions", uuid = {parts = {44305824, 0, 2035982264,
      32630}}}
(gdb) p *a
$12 = {integer = 10, real = 4.9406564584124654e-323, boolean = 10,   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151005/23fa6142/attachment.html>

From tech.kals at gmail.com  Mon Oct  5 23:44:21 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Tue, 6 Oct 2015 12:14:21 +0530
Subject: [ovs-discuss] Handling "Port Shutdown" message
Message-ID: <CAHWErLf_me2BtGwtdxxO55kXr=fX9VB6uH4ofpAFqNjekzbGFw@mail.gmail.com>

Hi experts,

  Can someone clarify me whether OVS handles port shutdown message? I am
not seeing it in "port_reconfigured" function.

  If this is the case then controller may not be aware that when port is
configured to admin down.

*  Can someone tell me how port shut message is communicated to the
controller if OVS is not processing port shut message ?*



*static void *
*port_reconfigured(struct ofport *port_, enum ofputil_port_config
old_config)*
*{*
*    struct ofport_dpif *port = ofport_dpif_cast(port_);*
*    struct ofproto_dpif *ofproto = ofproto_dpif_cast(port->up.ofproto);*
*    enum ofputil_port_config changed = old_config ^ port->up.pp.config;*

*    if (changed & (OFPUTIL_PC_NO_RECV | OFPUTIL_PC_NO_RECV_STP |*
*                   OFPUTIL_PC_NO_FWD | OFPUTIL_PC_NO_FLOOD |*
*                   OFPUTIL_PC_NO_PACKET_IN)) {*
*        ofproto->backer->need_revalidate = REV_RECONFIGURE;*

*        if (changed & OFPUTIL_PC_NO_FLOOD && port->bundle) {*
*            bundle_update(port->bundle);*
*        }*
*    }    *
*}*

Regards,
Kals
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151006/b51fc355/attachment.html>

From er.manpreet25 at gmail.com  Tue Oct  6 11:16:52 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Tue, 6 Oct 2015 23:46:52 +0530
Subject: [ovs-discuss] crash in service with invalid group type
Message-ID: <CALD=K8vGLR_N-e4wCi5uL7uFgSGT86c7oG=Cxpp1epBZj-gppw@mail.gmail.com>

Hello Team,

I am working on OVS-2.3.2. I got a strange behavior while sending group_mod
message for add group with invalid group type with RYU controller.

ofproto_v1_3_parser.OFPGroupMod(datapath, ofproto_v1_3 .OFPGC_ADD, 7,
group_id, buckets)

This operation should return error OFPGMFC_BAD_TYPE. But vswitchd service
got crashed and connection get lost with the controller.

Have anyone faced this issue?

Regards
Manpreet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151006/5253347a/attachment.html>

From jesse at nicira.com  Tue Oct  6 12:40:40 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 6 Oct 2015 12:40:40 -0700
Subject: [ovs-discuss] MPLS header on a VLAN packet
In-Reply-To: <CAAHkLF+d+oOF+2gD3pyk928tfjTywc7W3wZuKS1GfPXx99HprQ@mail.gmail.com>
References: <CAAHkLF+d+oOF+2gD3pyk928tfjTywc7W3wZuKS1GfPXx99HprQ@mail.gmail.com>
Message-ID: <CAEP_g=8c4C9ti27mH-g7ev0nQVaiK8pdJy=wZH70UaiJ0ymKNw@mail.gmail.com>

On Fri, Oct 2, 2015 at 6:48 AM, Michele Santuari
<michele.santuari at create-net.org> wrote:
> Hi all,
> we are trying to tag with MPLS a VLAN packet.
>
> The rule installed into the ovs is:
> cookie=0x240000465aa58e, duration=5.452s, table=0, n_packets=0, n_bytes=0,
> idle_age=5, priority=100,in_port=1,dl_vlan=10,dl_type=0x8100
> actions=push_mpls:0x8847,load:0x1b->OXM_OF_MPLS_LABEL[],output:2
>
> The strange think is that packets with VLAN 10 coming from port 1 are not
> matching this rule.
> The ovs log shows this error:
>
> 2015-10-02T12:37:51.757Z|00002|dpif(handler22)|WARN|system at ovs-system:
> execute push_mpls(label=25,tc=0,ttl=64,bos=1,eth_type=0x8847),2 failed
> (Invalid argument) on packet
> icmp,in_port=0,dl_vlan=10,dl_vlan_pcp=0,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=8,icmp_code=0
> 2015-10-02T12:37:52.636Z|00003|dpif(handler22)|WARN|system at ovs-system:
> failed to put[create] (Invalid argument)
> ufid:586b5f05798f165219b201bac96b56bb
> recirc_id(0),dp_hash(0/0),skb_priority(0/0),in_port(1),skb_mark(0/0),eth(src=00:00:00:00:00:01/00:00:00:00:00:00,dst=00:00:00:00:00:02/00:00:00:00:00:00),eth_type(0x8100),vlan(vid=10,pcp=0/0x0),encap(eth_type(0x0800),ipv4(src=10.0.0.1/0.0.0.0,dst=10.0.0.2/0.0.0.0,proto=1/0,tos=0/0xfc,ttl=64,frag=no),icmp(type=8/0,code=0/0)),
> actions:push_mpls(label=25,tc=0,ttl=64,bos=1,eth_type=0x8847),2
>
>
> We do not know if adding an MPLS tag on a VLAN frame is a permitted
> operation.
> Do you have any idea?

Yes, it's not supported. The nesting of various tags resulted in a
number of complications and so it was disallowed for the time being.

From dwilder at us.ibm.com  Tue Oct  6 14:42:46 2015
From: dwilder at us.ibm.com (dwilder at us.ibm.com)
Date: Tue, 06 Oct 2015 17:42:46 -0400
Subject: [ovs-discuss] [PATCH-RFC 1/2] Improve ARP latency
In-Reply-To: <20151001191920.Horde.6y_--Lj_RoGK0nK7EgUF_A1@ltc.linux.ibm.com>
References: <20150930015039.Horde.By710uU5wzMPGcKhA46ZaA1@ltc.linux.ibm.com>
 <CAEP_g=9K69Muo2xBh8u_ypO2eriiKJvUL73PEXYNa7bKDenSKw@mail.gmail.com>
 <20151001191920.Horde.6y_--Lj_RoGK0nK7EgUF_A1@ltc.linux.ibm.com>
Message-ID: <20151006174246.Horde.eLIHBhvyxxD-iqhuFWSKDQ1@ltc.linux.ibm.com>


Quoting dwilder at us.ibm.com:
>>
>> On the patch itself, can't we just make skb_get_hash() be able to
>> decode ARP? It seems like that is cleaner and more generic.
>
> My first thought was to make a change in skb_get_hash().  However,  
> the comment in __skb_get_hash() state that the hash is generated  
> from the 4-tuple (address and ports).  ARPs have no ports so a  
> return value of 0 looked correct.
>
> /*
>   * __skb_get_hash: calculate a flow hash based on src/dst addresses
>   * and src/dst port numbers.  Sets hash in skb to non-zero hash value
>   * on success, zero indicates no valid hash.  Also, sets l4_hash in skb
>   * if hash is a canonical 4-tuple hash over transport ports.
>   */
>
> What do you think?
>


Hi Jesse

I did not get a response so I was unsure how to proceed.

I am willing to pursue enhancing skb_get_hash() if you think that is  
the best approach.  However what would you think of something like this?

hash = skb_get_hash(skb);
if ( ! hash )
        return ids->ids[vport->port_no%ids->n_ids];

return ids->ids[hash - ids->n_ids * reciprocal_divide(hash, ids->rn_ids)];

This would solve my problem on kernels without the enhanced  
skb_get_hash() and no further change to ovs would be required once  
shb_get_hash() is updated.

PS:  Should I move this discussion to ovs-dev ?


From azhou at nicira.com  Tue Oct  6 16:56:42 2015
From: azhou at nicira.com (Andy Zhou)
Date: Tue, 6 Oct 2015 16:56:42 -0700
Subject: [ovs-discuss] new crash with openvswitch-2.4 in
	ovsdb_datum_equals
In-Reply-To: <20151005223827.9362.qmail@f4mail-235-236.rediffmail.com>
References: <20151005223827.9362.qmail@f4mail-235-236.rediffmail.com>
Message-ID: <CACzMAJ++V1WuJgDJ1c0OA1COwWCKYGdrvR_D0eVet7b2uyMV=w@mail.gmail.com>

On Mon, Oct 5, 2015 at 3:38 PM, Richukov Kes <kesri1234 at rediffmail.com>
wrote:

>
> Dear Sir:
>
> We upgrading to openvswitch-2.4 and ran ovs-vsctl set-controller command
> in a script to point to a controller and soon noticed a crash in ovs-
> vswitchd with below back trace. Can anyone please check if this has a fix
> in newer release or point me to what I am doing wrong?
>
> #0 0x00007f76793422b6 in __strcmp_sse42 () from /lib64/libc.so.6
> #1 0x00000000004b7ae5 in atom_arrays_compare_3way (a=0x29d79f8,
> b=0x7fff554b4f40, type=0x894e20) at lib/ovsdb-data.c:1582
> #2 ovsdb_datum_compare_3way (a=0x29d79f8, b=0x7fff554b4f40, type=0x894e20)
> at lib/ovsdb-data.c:1610
> #3 0x00000000004b7b69 in ovsdb_datum_equals (a=,
> b=, type=)
> at lib/ovsdb-data.c:1596
> #4 0x00000000004bb36e in ovsdb_idl_txn_write__ (row_=0x29d74a0,
> column=0x894e18, datum=0x7fff554b4f40, owns_datum=true)
> at lib/ovsdb-idl.c:2087
> #5 0x00000000004f04b5 in ovsrec_interface_set_statistics (row=0x29d74a0,
> key_statistics=, value_statistics=0x7fff554b50b0,
> n_statistics=12) at lib/vswitch-idl.c:11535
> #6 0x00000000004083e8 in iface_refresh_stats (iface=0x29c2c40)
> at vswitchd/bridge.c:2419
> #7 0x0000000000411a6c in run_stats_update () at vswitchd/bridge.c:2793
> #8 bridge_run () at vswitchd/bridge.c:3073
> #9 0x00000000004121ad in main (argc=10, argv=0x7fff554b5338)
> at vswitchd/ovs-vswitchd.c:131
>
> (gdb) frame 1
> #1 0x00000000004b7ae5 in atom_arrays_compare_3way (a=0x29d79f8,
> b=0x7fff554b4f40, type=0x894e20) at lib/ovsdb-data.c:1582
> 1582 int cmp = ovsdb_atom_compare_3way(&a[i], &b[i], type);
> (gdb) p *b
> $11 = {integer = 44305824, real = 2.1889985549088601e-316, boolean = 160,
> string = 0x2a40da0 "collisions", uuid = {parts = {44305824, 0, 2035982264,
> 32630}}}
> (gdb) p *a
> $12 = {integer = 10, real = 4.9406564584124654e-323, boolean = 10, <<<<<<<<
> string = 0xa , uuid = {parts = {10, 0,
> 2035982872, 32630}}}
>

It is not obvious what went wrong.  But this is what I can decode based on
the message:

The crash is in the part of the code that vswitchd updating interface
stats, not directly related
to setting of controller.  It seems the current (i.e. old) interface stats
stored in ovsdb is corrupted (object a).

I was not able reproduce this locally. Do you have steps on how to
reproduce this reliably?  If yes, I can help debug this further.

>
>
> Get your own *FREE* website, *FREE* domain & *FREE* mobile app with
> Company email.
> *Know More >*
> <http://track.rediff.com/click?url=___http://businessemail.rediff.com?sc_cid=sign-1-10-13___&cmp=host&lnk=sign-1-10-13&nsrv1=host>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151006/6d4ae4a9/attachment.html>

From jesse at nicira.com  Tue Oct  6 19:14:37 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 6 Oct 2015 19:14:37 -0700
Subject: [ovs-discuss] [PATCH-RFC 1/2] Improve ARP latency
In-Reply-To: <20151001191920.Horde.6y_--Lj_RoGK0nK7EgUF_A1@ltc.linux.ibm.com>
References: <20150930015039.Horde.By710uU5wzMPGcKhA46ZaA1@ltc.linux.ibm.com>
 <CAEP_g=9K69Muo2xBh8u_ypO2eriiKJvUL73PEXYNa7bKDenSKw@mail.gmail.com>
 <20151001191920.Horde.6y_--Lj_RoGK0nK7EgUF_A1@ltc.linux.ibm.com>
Message-ID: <CAEP_g=8zoJoah_xHsd7-WmPK1sa=Pvnxr2xEQaELP72CjiSGFA@mail.gmail.com>

On Thu, Oct 1, 2015 at 4:19 PM,  <dwilder at us.ibm.com> wrote:
>
> Quoting Jesse Gross <jesse at nicira.com>:
>
>> On Tue, Sep 29, 2015 at 10:50 PM,  <dwilder at us.ibm.com> wrote:
>>>
>>> Hi-
>>>
>>> I have been conducting scaling tests with OVS and docker. My tests
>>> revealed
>>> that the latency of ARP packets can become very large resulting in many
>>> ARP
>>> re-transmissions and time-outs. I found the source of the poor latency to
>>> be
>>> with the handling of arp packets in ovs_vport_find_upcall_portid().  Each
>>> packet is hashed in ovs_vport_find_upcall_portid() by calling
>>> skb_get_hash().  This hash is used to select a netlink socket in which to
>>> send the packet to userspace.  However, skb_get_hash() is not supporting
>>> ARP
>>> packets returning a 0 (invalid hash) for every ARP.  This results in a
>>> single ovs-vswitchd handler thread processing every arp packet thus
>>> severely
>>> impacting the average latency of ARPs. I am purposing a change to
>>> ovs_vport_find_upcall_portid() that spreads the ARP packets evenly
>>> between
>>> all the handler threads (patch to follow).  Please let me know if you
>>> have
>>> suggestions/comments.
>>
>>
>> This is definitely an interesting analysis but I'm a little surprised
>> at the basic scenario. First, I guess it seems to me that the L2
>> domain is too large if there are this many ARPs.
>
>
> I can imagine running a couple of thousand docker containers, so I think
> this is a reasonable size test.

Having thousands of nodes (regardless of whether they are containers
or VMs) on a single L2 segment is really not a good idea. I would
expect them to be segmented into smaller groups with L3 boundaries in
the middle.

> On a related issue, I am looking into the memory consumed by the netlink
> sockets, OVS on linux can create many of these sockets. Do you have any
> thought as to why the current model was picked?

Independent queues are the easiest way to provide lockless access to
incoming packets on different cores and, in some case, give higher
priority to certain types of packets.

>> The speed also
>> generally seems slower than I would expect but in any case I don't
>> disagree that it is better to spread the load among all the cores.
>>
>> On the patch itself, can't we just make skb_get_hash() be able to
>> decode ARP? It seems like that is cleaner and more generic.
>
>
> My first thought was to make a change in skb_get_hash().  However, the
> comment in __skb_get_hash() state that the hash is generated from the
> 4-tuple (address and ports).  ARPs have no ports so a return value of 0
> looked correct.
>
> /*
>   * __skb_get_hash: calculate a flow hash based on src/dst addresses
>   * and src/dst port numbers.  Sets hash in skb to non-zero hash value
>   * on success, zero indicates no valid hash.  Also, sets l4_hash in skb
>   * if hash is a canonical 4-tuple hash over transport ports.
>   */
>
> What do you think?

I don't think that this is really a strict definition. In particular,
IP packets that aren't TCP or UDP will still return a hash based on
the IP addresses.

However, I believe that you are looking at an old version of this
function. Any changes would need to be made to the upstream Linux
tree, not purely in OVS.

From jesse at nicira.com  Tue Oct  6 19:16:43 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 6 Oct 2015 19:16:43 -0700
Subject: [ovs-discuss] [PATCH-RFC 1/2] Improve ARP latency
In-Reply-To: <20151006174246.Horde.eLIHBhvyxxD-iqhuFWSKDQ1@ltc.linux.ibm.com>
References: <20150930015039.Horde.By710uU5wzMPGcKhA46ZaA1@ltc.linux.ibm.com>
 <CAEP_g=9K69Muo2xBh8u_ypO2eriiKJvUL73PEXYNa7bKDenSKw@mail.gmail.com>
 <20151001191920.Horde.6y_--Lj_RoGK0nK7EgUF_A1@ltc.linux.ibm.com>
 <20151006174246.Horde.eLIHBhvyxxD-iqhuFWSKDQ1@ltc.linux.ibm.com>
Message-ID: <CAEP_g=-J91nvKYBqeAHnWV6cxOAmuQMto5VHs7TZdADsPcnKPw@mail.gmail.com>

On Tue, Oct 6, 2015 at 2:42 PM,  <dwilder at us.ibm.com> wrote:
>
> Quoting dwilder at us.ibm.com:
>>>
>>>
>>> On the patch itself, can't we just make skb_get_hash() be able to
>>> decode ARP? It seems like that is cleaner and more generic.
>>
>>
>> My first thought was to make a change in skb_get_hash().  However, the
>> comment in __skb_get_hash() state that the hash is generated from the
>> 4-tuple (address and ports).  ARPs have no ports so a return value of 0
>> looked correct.
>>
>> /*
>>   * __skb_get_hash: calculate a flow hash based on src/dst addresses
>>   * and src/dst port numbers.  Sets hash in skb to non-zero hash value
>>   * on success, zero indicates no valid hash.  Also, sets l4_hash in skb
>>   * if hash is a canonical 4-tuple hash over transport ports.
>>   */
>>
>> What do you think?
>>
>
>
> Hi Jesse
>
> I did not get a response so I was unsure how to proceed.
>
> I am willing to pursue enhancing skb_get_hash() if you think that is the
> best approach.  However what would you think of something like this?
>
> hash = skb_get_hash(skb);
> if ( ! hash )
>        return ids->ids[vport->port_no%ids->n_ids];
>
> return ids->ids[hash - ids->n_ids * reciprocal_divide(hash, ids->rn_ids)];
>
> This would solve my problem on kernels without the enhanced skb_get_hash()
> and no further change to ovs would be required once shb_get_hash() is
> updated.

OVS has an extensive system of backports from newer kernels. You
should strive to get your changes accepted in the upstream Linux tree
and then they can be backported to the OVS out-of-tree kernel module
for existing kernels.

> PS:  Should I move this discussion to ovs-dev ?

It would have been a better place to start it but it doesn't really
matter at this point.

From bansaldheeraj001 at gmail.com  Wed Oct  7 04:03:03 2015
From: bansaldheeraj001 at gmail.com (Dheeraj Bansal)
Date: Wed, 7 Oct 2015 16:33:03 +0530
Subject: [ovs-discuss] Range of Group ID
Message-ID: <CAEYh443DtMSAshh4YYPTkh21rnbTmUsfVUcCHUA+ddU-cVx_og@mail.gmail.com>

Hi all,

I am trying to get the valid range of group id.
(lets say for the 'group_id' parameter of 'add-group' command)

All I can deduce till now is:
Valid range : (0) to (2^32 - 1)
from -(2^64 - 1) to (2^64 - 1), mod is taken of 2^32
other numbers are invalid.
Error : (2^32 - 2^8 + 1) to (2^32 - 1) are invalid
invalid means OFPGMFC_INVALID_GROUP

but I need confirmation.
Can anybody please tell me the correct valid range of group id?

Best regards
Dheeraj Bansal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/ba69247f/attachment.html>

From blp at nicira.com  Wed Oct  7 08:04:31 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 7 Oct 2015 08:04:31 -0700
Subject: [ovs-discuss] Range of Group ID
In-Reply-To: <CAEYh443DtMSAshh4YYPTkh21rnbTmUsfVUcCHUA+ddU-cVx_og@mail.gmail.com>
References: <CAEYh443DtMSAshh4YYPTkh21rnbTmUsfVUcCHUA+ddU-cVx_og@mail.gmail.com>
Message-ID: <20151007150431.GA25804@nicira.com>

On Wed, Oct 07, 2015 at 04:33:03PM +0530, Dheeraj Bansal wrote:
> I am trying to get the valid range of group id.
> (lets say for the 'group_id' parameter of 'add-group' command)
> 
> All I can deduce till now is:
> Valid range : (0) to (2^32 - 1)
> from -(2^64 - 1) to (2^64 - 1), mod is taken of 2^32
> other numbers are invalid.
> Error : (2^32 - 2^8 + 1) to (2^32 - 1) are invalid
> invalid means OFPGMFC_INVALID_GROUP
> 
> but I need confirmation.
> Can anybody please tell me the correct valid range of group id?

Group IDs are 32-bit.  The usable range is 0...OFPG_MAX, which is
0xffffff00.  This comes from OpenFlow, it's not OVS-specific.

From blp at nicira.com  Wed Oct  7 08:05:16 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 7 Oct 2015 08:05:16 -0700
Subject: [ovs-discuss] [ovs-dev] Openflow messages processing rate
In-Reply-To: <CAOLvpU7V+FSbdyjz6-0vKGRczp1C01k8BN8Z7yOoLhs2m30W4A@mail.gmail.com>
References: <CAOLvpU7hitPdzkGnvBfRdhxKVk5knvhKS7wf_=nPE7hUYyotJg@mail.gmail.com>
 <20151005174937.GB23207@nicira.com>
 <CAOLvpU7V+FSbdyjz6-0vKGRczp1C01k8BN8Z7yOoLhs2m30W4A@mail.gmail.com>
Message-ID: <20151007150516.GB25804@nicira.com>

On Wed, Oct 07, 2015 at 03:00:15PM +0530, RishiRaj Maulick wrote:
> Thanks for the reply. Do you have any data for the openflow messages per
> second that is supported by vswitchd. It will be helpful to us .

I don't.  Maybe someone else will speak up.

From blp at nicira.com  Wed Oct  7 08:07:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 7 Oct 2015 08:07:42 -0700
Subject: [ovs-discuss] Handling "Port Shutdown" message
In-Reply-To: <CAHWErLcbc9+bc8fRyFaQ4UQ=9m45zhWHMpSZ9M3j7Pv4pm12rA@mail.gmail.com>
References: <CAHWErLf_me2BtGwtdxxO55kXr=fX9VB6uH4ofpAFqNjekzbGFw@mail.gmail.com>
 <20151006152933.GD6253@nicira.com>
 <CAHWErLcbc9+bc8fRyFaQ4UQ=9m45zhWHMpSZ9M3j7Pv4pm12rA@mail.gmail.com>
Message-ID: <20151007150742.GC25804@nicira.com>

On Wed, Oct 07, 2015 at 11:21:05AM +0530, tech_kals Kals wrote:
>   Assume when any Openflow agent uses OVS openflow stack to interact with
> the controller. When port is configured admin down in the hardware.
> Openflow agent wants to inform the controller about the port shut hence it
> will send port shutdown message to OVS. It is the responsibility of OVS to
> send the same message to Controller.
> 
>   In OVS code, i dont see, port shutdown message is not being handled.
> 
>   In the code, Openflow agent would call any of the function pointer which
> is defined in ofproto_dpif_class.
> 
>   In ofproto_dpif_class, "port_reconfigured" is handling port shutdown
> event. The same function needs to inform the controller about port shutdown.
> 
>   But, the definition of it says that it will not handle, i have
> highlighted the same. Please note that "*OFPUTIL_PC_PORT_DOWN"* is being
> used to set/unset the flag when port is configured as admin down.

Why all this speculation?  Test it and see.

From tech.kals at gmail.com  Tue Oct  6 22:51:05 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Wed, 7 Oct 2015 11:21:05 +0530
Subject: [ovs-discuss] Handling "Port Shutdown" message
In-Reply-To: <20151006152933.GD6253@nicira.com>
References: <CAHWErLf_me2BtGwtdxxO55kXr=fX9VB6uH4ofpAFqNjekzbGFw@mail.gmail.com>
 <20151006152933.GD6253@nicira.com>
Message-ID: <CAHWErLcbc9+bc8fRyFaQ4UQ=9m45zhWHMpSZ9M3j7Pv4pm12rA@mail.gmail.com>

Hi Ben,

  Assume when any Openflow agent uses OVS openflow stack to interact with
the controller. When port is configured admin down in the hardware.
Openflow agent wants to inform the controller about the port shut hence it
will send port shutdown message to OVS. It is the responsibility of OVS to
send the same message to Controller.

  In OVS code, i dont see, port shutdown message is not being handled.

  In the code, Openflow agent would call any of the function pointer which
is defined in ofproto_dpif_class.

  In ofproto_dpif_class, "port_reconfigured" is handling port shutdown
event. The same function needs to inform the controller about port shutdown.

  But, the definition of it says that it will not handle, i have
highlighted the same. Please note that "*OFPUTIL_PC_PORT_DOWN"* is being
used to set/unset the flag when port is configured as admin down.


*     /* Called after an OpenFlow request changes a port's configuration.*
*     * 'ofport->pp.config' contains the new configuration.  'old_config'*
*     * contains the previous configuration.*
*     **
*     * The caller implements OFPUTIL_PC_PORT_DOWN using netdev functions
to*
*     * turn NETDEV_UP on and off, so this function doesn't have to do
anything*
*     * for that bit (and it won't be called if that is the only bit that*
*     * changes). */*
*    void (*port_reconfigured)(struct ofport *ofport,*
*                              enum ofputil_port_config old_config);*


Thanks,
kals.

On Tue, Oct 6, 2015 at 8:59 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Oct 06, 2015 at 12:14:21PM +0530, tech_kals Kals wrote:
> >   Can someone clarify me whether OVS handles port shutdown message? I am
> > not seeing it in "port_reconfigured" function.
> >
> >   If this is the case then controller may not be aware that when port is
> > configured to admin down.
> >
> > *  Can someone tell me how port shut message is communicated to the
> > controller if OVS is not processing port shut message ?*
>
> What's a port shutdown message?  Who sends it?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/d504bac6/attachment-0001.html>

From rishi.raj2509 at gmail.com  Wed Oct  7 02:30:15 2015
From: rishi.raj2509 at gmail.com (RishiRaj Maulick)
Date: Wed, 7 Oct 2015 15:00:15 +0530
Subject: [ovs-discuss] [ovs-dev] Openflow messages processing rate
In-Reply-To: <20151005174937.GB23207@nicira.com>
References: <CAOLvpU7hitPdzkGnvBfRdhxKVk5knvhKS7wf_=nPE7hUYyotJg@mail.gmail.com>
 <20151005174937.GB23207@nicira.com>
Message-ID: <CAOLvpU7V+FSbdyjz6-0vKGRczp1C01k8BN8Z7yOoLhs2m30W4A@mail.gmail.com>

Hi Ben,

Thanks for the reply. Do you have any data for the openflow messages per
second that is supported by vswitchd. It will be helpful to us .

Thanks in advance.

Best Regards,
Rishi Raj

On Mon, Oct 5, 2015 at 11:19 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Mon, Oct 05, 2015 at 09:09:56PM +0530, RishiRaj Maulick wrote:
> > The ofproto implementation at ovs-vswitchd process is single threaded.
> Are
> > there any plans of making this implementation multi-threaded such that
> the
> > open flow messages processing rate from a single controller increases.
>
> I don't know of any such plans.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/4c4cb6e6/attachment-0001.html>

From Tytus.Kurek at pega.com  Wed Oct  7 04:06:22 2015
From: Tytus.Kurek at pega.com (Kurek, Tytus)
Date: Wed, 7 Oct 2015 11:06:22 +0000
Subject: [ovs-discuss] [openvswitch 2.4.0] testsuite: 739 failed
In-Reply-To: <20150929172420.GA30384@nicira.com>
References: <dbd9e5de2d794ead9622e1ba9b0bb33b@EXCAMB01.rpega.com>
 <20150929172420.GA30384@nicira.com>
Message-ID: <d853de230b7b4b9db6f4e17c93611d77@EXCAMB01.rpega.com>

Hi Ben,

Thanks for the update. That worked!

Regards

Tytus Kurek | Lead Infrastructure Engineer / Special Projects | Pegasystems Inc. 
Mobile: 0048513106743 | E-Mail: tytus.kurek at pega.com | www.pega.com
    

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com] 
Sent: 29 września 2015 22:54
To: Kurek, Tytus
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] [openvswitch 2.4.0] testsuite: 739 failed

On Tue, Sep 29, 2015 at 02:15:18PM +0000, Kurek, Tytus wrote:
> Please send `tests/testsuite.log' and all information you think might help:
> 
>    To: <bugs at openvswitch.org>
>    Subject: [openvswitch 2.4.0] testsuite: 739 failed
> 
> You may investigate any problem if you feel able to do so, in which 
> case the test suite provides a good starting point.  Its output may be 
> found below `tests/testsuite.dir'
> 
> There is no "testsuite.log" file:
> 
> [root at cmp01 openvswitch-2.4.0]# find . -name testsuite.log
> 
> Attached is an output from the "rpmbuild -bb rhel/openvswitch.spec" command execution.

Thank you for the report.

You can safely ignore this failure.  It is a bug in the testsuite rather than in OVS.  You can run the rpmbuild "--without checK" to skip the tests.

I sent out a testsuite fix for review:
        http://openvswitch.org/pipermail/dev/2015-September/060550.html

From Tytus.Kurek at pega.com  Wed Oct  7 04:32:23 2015
From: Tytus.Kurek at pega.com (Kurek, Tytus)
Date: Wed, 7 Oct 2015 11:32:23 +0000
Subject: [ovs-discuss] error: Bad exit status from /var/tmp/rpm-tmp.rB5Drx
	(%build)
Message-ID: <b4bc3b92322a4243bda497f2a376b2ca@EXCAMB01.rpega.com>

Hi,

I'm experiencing some issues when executing the following command:

rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec

on CentOS 6.7 with OpenVSwitch 2.4.0 . Attached is an output from the above command execution.

Regards

Tytus Kurek | Lead Infrastructure Engineer / Special Projects | Pegasystems Inc.
Mobile: 0048513106743 | E-Mail: tytus.kurek at pega.com<mailto:tytus.kurek at pega.com> | www.pega.com<http://www.pega.com/>
[cid:image002.png at 01D03743.5E77F240]<http://www.facebook.com/pegasystems>  [cid:image003.png at 01D03743.5E77F240] <http://twitter.com/pegasystems>   [cid:image004.png at 01D03743.5E77F240] <http://www.linkedin.com/company/165426> [cid:image005.png at 01D03743.5E77F240] <http://www.youtube.com/pegasystems>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/33976a00/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 619 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/33976a00/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 883 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/33976a00/attachment-0005.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 759 bytes
Desc: image003.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/33976a00/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 911 bytes
Desc: image004.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/33976a00/attachment-0007.png>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: output.txt
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/33976a00/attachment-0001.txt>

From er.manpreet25 at gmail.com  Wed Oct  7 08:47:33 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Wed, 7 Oct 2015 21:17:33 +0530
Subject: [ovs-discuss] Fwd: crash in service with invalid group type
In-Reply-To: <CALD=K8vGLR_N-e4wCi5uL7uFgSGT86c7oG=Cxpp1epBZj-gppw@mail.gmail.com>
References: <CALD=K8vGLR_N-e4wCi5uL7uFgSGT86c7oG=Cxpp1epBZj-gppw@mail.gmail.com>
Message-ID: <CALD=K8vFmKzp9w+kbNYx2hTwhJF-0CKuZQJXpasDH7SUx3844w@mail.gmail.com>

Hello Team,

I am working on OVS-2.3.2. I got a strange behavior while sending group_mod
message for add group with invalid group type with RYU controller.

Syntax:
OFPGroupMod (datapath, command=0, type_=0, group_id=0, buckets=[])

ofproto_v1_3_parser.OFPGroupMod(datapath, ofproto_v1_3 .OFPGC_ADD, 7,
group_id, buckets)

This operation should return error OFPGMFC_BAD_TYPE. But vswitchd service
got crashed and connection get lost with the controller.

Have anyone faced this issue?

Regards
Manpreet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/95e6378b/attachment.html>

From er.manpreet25 at gmail.com  Wed Oct  7 08:48:24 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Wed, 7 Oct 2015 21:18:24 +0530
Subject: [ovs-discuss] Fwd: packet_out message
In-Reply-To: <CALD=K8tuNjwEBynJWCS7+kUJMTPrYU2rEOf4QjQthLGVkRAMig@mail.gmail.com>
References: <CALD=K8tuNjwEBynJWCS7+kUJMTPrYU2rEOf4QjQthLGVkRAMig@mail.gmail.com>
Message-ID: <CALD=K8vhvqFMWe8nZ0X=x5ttT-hKvV6he606yFVw0qJJvnsnwA@mail.gmail.com>

Hi All,

In packet_out message when we specify the OFPP_TABLE reserved port as an
output action, then actions are perform in flow tables on packet.

There are 254 tables, my question is that who's actions will be perform on
it out of 254.


Regards,
Manpreet Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/e5eda736/attachment.html>

From blp at nicira.com  Wed Oct  7 09:47:40 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 7 Oct 2015 09:47:40 -0700
Subject: [ovs-discuss] Fwd: packet_out message
In-Reply-To: <CALD=K8vhvqFMWe8nZ0X=x5ttT-hKvV6he606yFVw0qJJvnsnwA@mail.gmail.com>
References: <CALD=K8tuNjwEBynJWCS7+kUJMTPrYU2rEOf4QjQthLGVkRAMig@mail.gmail.com>
 <CALD=K8vhvqFMWe8nZ0X=x5ttT-hKvV6he606yFVw0qJJvnsnwA@mail.gmail.com>
Message-ID: <20151007164740.GB27229@nicira.com>

On Wed, Oct 07, 2015 at 09:18:24PM +0530, Manpreet Singh wrote:
> In packet_out message when we specify the OFPP_TABLE reserved port as an
> output action, then actions are perform in flow tables on packet.
> 
> There are 254 tables, my question is that who's actions will be perform on
> it out of 254.

Table 0.

From er.manpreet25 at gmail.com  Wed Oct  7 10:05:25 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Wed, 7 Oct 2015 22:35:25 +0530
Subject: [ovs-discuss] Fwd: packet_out message
In-Reply-To: <20151007164740.GB27229@nicira.com>
References: <CALD=K8tuNjwEBynJWCS7+kUJMTPrYU2rEOf4QjQthLGVkRAMig@mail.gmail.com>
 <CALD=K8vhvqFMWe8nZ0X=x5ttT-hKvV6he606yFVw0qJJvnsnwA@mail.gmail.com>
 <20151007164740.GB27229@nicira.com>
Message-ID: <CALD=K8ti+t1uTm7yewGfOdXKJDWi10C5KrEcDQxLiL31UcaKfg@mail.gmail.com>

Thanks Ben For Reply!!!

On Wed, Oct 7, 2015 at 10:17 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Oct 07, 2015 at 09:18:24PM +0530, Manpreet Singh wrote:
> > In packet_out message when we specify the OFPP_TABLE reserved port as an
> > output action, then actions are perform in flow tables on packet.
> >
> > There are 254 tables, my question is that who's actions will be perform
> on
> > it out of 254.
>
> Table 0.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/fcdef915/attachment.html>

From shad.ansari at hpe.com  Wed Oct  7 11:28:07 2015
From: shad.ansari at hpe.com (Ansari, Shad)
Date: Wed, 7 Oct 2015 18:28:07 +0000
Subject: [ovs-discuss] FW:  Scaling ovsdb-idl's update notification
References: <8CA204A851B7B14E86E75054661E41750F92FD87@G4W3217.americas.hpqcorp.net>
 <20150802190636.GF28085@nicira.com>
 <CAEgOKCwm3hKbVh7HSxH8ZzBVT1oM+vcKhmWu9Pokhf=MtZWffg@mail.gmail.com>
 <20150803165039.GD31662@nicira.com>
 <8CA204A851B7B14E86E75054661E41750F930D03@G4W3217.americas.hpqcorp.net>
 <20150804040828.GK1572@nicira.com> 
Message-ID: <8CA204A851B7B14E86E75054661E41750F97F51F@G9W0717.americas.hpqcorp.net>

Building on some of the suggestions in this thread, a patch/pull-request was submitted to add support for change tracking in ovsdb-idl:

https://github.com/openvswitch/ovs/pull/78

Another ovsdb-idl scaling use case of interest is update notifications for columns that change frequently. Classic case is columns that represent counters. If an ovsdb client is interested in fetching a value of a specific column of a specific row, it needs to turn on monitoring for that column. For a column representing a frequently changing value this would entail frequent update notification from the ovsdb server. Does it make send to implement ovsdb-idl api's to allow a client to fetch a column value on-demand, without having to monitor (replicate) that column? Any thoughts on this?



> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Monday, August 03, 2015 9:08 PM
> To: Ansari, Shad
> Cc: Saurabh Shrivastava (सौरभ श्रीवास्तव); discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Scaling ovsdb-idl's update notification
> 
> If that's useful for real applications, and more practical, then I'm all
> for it.  I haven't thought about the problem carefully; I'm just trying
> to point out a constraint.
> 
> On Mon, Aug 03, 2015 at 07:10:23PM +0000, Ansari, Shad wrote:
> > Would it help if, for the deleted record, all fields except uuid,
> > version, and indexes columns are reset to default (after regular
> > deferred processing - unreferenced rows are deleted and dangling weak
> > references are removed)? This ensures that the client does not access
> > invalid references. Typically, the uuid or indexes should be
> > sufficient information for the client to take action.
> >
> >
> > -----Original Message-----
> > From: Ben Pfaff [mailto:blp at nicira.com]
> > Sent: Monday, August 03, 2015 9:51 AM
> > To: Saurabh Shrivastava (सौरभ श्रीवास्तव)
> > Cc: Ansari, Shad; discuss at openvswitch.org
> > Subject: Re: [ovs-discuss] Scaling ovsdb-idl's update notification
> >
> > That kind of approach might work.
> >
> > It's important to keep in mind, though, that the IDL isn't just a collection of
> unrelated records.  It's a graph: any record can point to any number of other
> records, through columns whose types are UUIDs with refTable constraints.  The
> IDL maintains tracks these relationships carefully for memory safety, so that if a
> record is deleted then the pointers to it from other records can be dropped.  Any
> approach to handling changes may have to take this into account.
> >
> > On Sun, Aug 02, 2015 at 01:08:56PM -0700, Saurabh Shrivastava (सौरभ
> श्रीवास्तव) wrote:
> > > One approach can be to link all the struct ovsdb_idl_row in a linked
> > > list where nodes are ordered by their time of update ie a newly added
> > > node is put at the end of the linked list, an updated node is removed
> > > from its current position and put at the end of the linked list, a
> > > deleted node is kept in the linked list till it is notified to the idl
> > > user. The size of this linked list will be the number of rows in the
> > > table. A new ovsdb-idl API can be called to iterate over this linked
> > > list one at a time, the API can place a marker node in the linked list
> > > to remember till what point the notifications have been generated. The
> > > IDL user should not try to dereference the pointers in  a "delete"
> > > event because the pointers could be stale, so it should only look at the
> embedded UUID.
> > >
> > > The benefit of this approach is that IDL user gets notified only of
> > > the changes, and also updates get naturally dampened ie large number
> > > of modifications to a single row gets delivered as fewer number of events.
> > >
> > >
> > > --
> > > Saurabh (सौरभ)
> > >
> > > On Sun, Aug 2, 2015 at 12:06 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > On Fri, Jul 31, 2015 at 08:03:41PM +0000, Ansari, Shad wrote:
> > > > >
> > > > > Ovsdb-idl notifies a client that "something" changed; it does not
> > > > > track
> > > > "what" changed. The client then typically either reconfigures itself
> > > > by scanning the idl to determine what changed, or - simply reloads
> > > > the entire idl. This presumably works since the ovs schema tables
> > > > aren't typically large.
> > > > >
> > > > > In a use-case where ovsdb is used with a schema that can have very
> > > > > large
> > > > tables (imagine route table), the current ovsdb-idl notification
> > > > mechanism doesn't appear to scale - clients need to do a lot of
> > > > processing to determine the exact change delta.
> > > > >
> > > > > I would like to hear from others if they have any views/insights
> > > > > on how
> > > > to handle this scalability use-case. Obviously, this will require
> > > > changes in ovsdb-idl, possibly on the lines of:
> > > > >
> > > > > -        Supporting more granular sequence numbers (table, row, column)
> > > > >
> > > > > -        Giving client visibility to the update (so that the client can
> > > > view both the old, new data)
> > > >
> > > > I'm welcome to discussion and proposals in this area.  I've expected
> > > > for years that we'd eventually need something like this for
> > > > ovs-vswitchd (although so far it isn't a big deal), and the same
> > > > could be true for ovn-controller as OVN begins to scale.
> > > > _______________________________________________
> > > > discuss mailing list
> > > > discuss at openvswitch.org
> > > > http://openvswitch.org/mailman/listinfo/discuss
> > > >

From davidjoshuaevans at gmail.com  Wed Oct  7 12:24:12 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Wed, 7 Oct 2015 14:24:12 -0500
Subject: [ovs-discuss] openflow 'group' and dpdk packet refcnt?
Message-ID: <741787FC-5C62-4970-B9ED-8337F07D1731@gmail.com>

Hi All.

When using the openflow group feature with dpdk ports how are the packet refcnt handled so that packets are not deleted before all the ports have forwarded the packet?
i can’t see a reference to any refcnt anywhere to manage this. 

This becomes a little more exciting (segfaults attempting to free already freed buffer) if i mod the netdev dpdk to allow multi segment packets in & out.

Cheers
Dave.

From davidjoshuaevans at gmail.com  Wed Oct  7 15:36:18 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Wed, 7 Oct 2015 17:36:18 -0500
Subject: [ovs-discuss] set dpdk packet refcnt when flow output to group.
Message-ID: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>

Hi all,

While using netdev-dpdk - When i add a rule for which the action is to send to a group (type=all) containing (x) output buckets (ports) how can i increment the dp_packet->pkt_mbuf’s  refcnt to (x) so that the packet is not deleted before it has transmitted all ports(buckets) in the group.

Perhaps in ofproto-dpif-xlate.c  function  xlate_all_group find the packet and apply the ctx->xin->packet->mbuf->refcnt ?  
Will that work for all packets for a ctx?


Regards,

Dave.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/f7e8b66b/attachment.html>

From muralirdev at gmail.com  Wed Oct  7 16:10:31 2015
From: muralirdev at gmail.com (Murali R)
Date: Wed, 7 Oct 2015 16:10:31 -0700
Subject: [ovs-discuss] [ovn] lport name
Message-ID: <CAO=R8onC_5dDG9DFwpDZMVvtJnk9YFK5u=HaVCcVWHg6tvhOrQ@mail.gmail.com>

(sorry didn't realize & an earlier email on same topic went into dev@
Please ignore that email)

Ref: http://benpfaff.org/~blp/dist-docs/ovn-nbctl.8.pdf

I was not able to use same lport name across networks (lswitch). Is there a
reason we need to have unique constraint for lport name across networks? If
I am scripting to create containers, I may use same port names in a
different lswitch/network to show they are same service.

We could have lport-del take in lswitch name so it is not ambiguous.

Thanks
Murali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151007/c7fda72e/attachment.html>

From blp at nicira.com  Wed Oct  7 16:17:23 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 7 Oct 2015 16:17:23 -0700
Subject: [ovs-discuss] [ovn] lport name
In-Reply-To: <CAO=R8onC_5dDG9DFwpDZMVvtJnk9YFK5u=HaVCcVWHg6tvhOrQ@mail.gmail.com>
References: <CAO=R8onC_5dDG9DFwpDZMVvtJnk9YFK5u=HaVCcVWHg6tvhOrQ@mail.gmail.com>
Message-ID: <20151007231723.GI30120@nicira.com>

On Wed, Oct 07, 2015 at 04:10:31PM -0700, Murali R wrote:
> Ref: http://benpfaff.org/~blp/dist-docs/ovn-nbctl.8.pdf
> 
> I was not able to use same lport name across networks (lswitch). Is there a
> reason we need to have unique constraint for lport name across networks? If
> I am scripting to create containers, I may use same port names in a
> different lswitch/network to show they are same service.

The lport name has to be the same as the iface-id so that ovn-controller
can identify the lport that an interface that shows up on br-int
corresponds to.

From dwilder at us.ibm.com  Wed Oct  7 17:02:27 2015
From: dwilder at us.ibm.com (dwilder at us.ibm.com)
Date: Wed, 07 Oct 2015 20:02:27 -0400
Subject: [ovs-discuss] [PATCH-RFC 1/2] Improve ARP latency
In-Reply-To: <CAEP_g=8zoJoah_xHsd7-WmPK1sa=Pvnxr2xEQaELP72CjiSGFA@mail.gmail.com>
References: <20150930015039.Horde.By710uU5wzMPGcKhA46ZaA1@ltc.linux.ibm.com>
 <CAEP_g=9K69Muo2xBh8u_ypO2eriiKJvUL73PEXYNa7bKDenSKw@mail.gmail.com>
 <20151001191920.Horde.6y_--Lj_RoGK0nK7EgUF_A1@ltc.linux.ibm.com> 
 <CAEP_g=8zoJoah_xHsd7-WmPK1sa=Pvnxr2xEQaELP72CjiSGFA@mail.gmail.com>
Message-ID: <20151007200227.Horde.q0s1P_R6oNBEdYoEQ5v4Qg3@ltc.linux.ibm.com>


Quoting Jesse Gross <jesse at nicira.com>:

> On Thu, Oct 1, 2015 at 4:19 PM,  <dwilder at us.ibm.com> wrote:
>>
>> Quoting Jesse Gross <jesse at nicira.com>:
>>
>>> On Tue, Sep 29, 2015 at 10:50 PM,  <dwilder at us.ibm.com> wrote:
>>>>
>>>> Hi-
>>>>
>>>> I have been conducting scaling tests with OVS and docker. My tests
>>>> revealed
>>>> that the latency of ARP packets can become very large resulting in many
>>>> ARP
>>>> re-transmissions and time-outs. I found the source of the poor latency to
>>>> be
>>>> with the handling of arp packets in ovs_vport_find_upcall_portid().  Each
>>>> packet is hashed in ovs_vport_find_upcall_portid() by calling
>>>> skb_get_hash().  This hash is used to select a netlink socket in which to
>>>> send the packet to userspace.  However, skb_get_hash() is not supporting
>>>> ARP
>>>> packets returning a 0 (invalid hash) for every ARP.  This results in a
>>>> single ovs-vswitchd handler thread processing every arp packet thus
>>>> severely
>>>> impacting the average latency of ARPs. I am purposing a change to
>>>> ovs_vport_find_upcall_portid() that spreads the ARP packets evenly
>>>> between
>>>> all the handler threads (patch to follow).  Please let me know if you
>>>> have
>>>> suggestions/comments.
>>>
>>>
>>> This is definitely an interesting analysis but I'm a little surprised
>>> at the basic scenario. First, I guess it seems to me that the L2
>>> domain is too large if there are this many ARPs.
>>
>>
>> I can imagine running a couple of thousand docker containers, so I think
>> this is a reasonable size test.
>
> Having thousands of nodes (regardless of whether they are containers
> or VMs) on a single L2 segment is really not a good idea. I would
> expect them to be segmented into smaller groups with L3 boundaries in
> the middle.


Something I am not clear on. Creating smaller L2 segments would reduce  
the impact of a broadcast packet, fewer ports to flood the packet to.  
But would it affect the performance of the upcall datapath?  Comparing  
a single 512 port switch to two 256 port switches (on a single host).   
Wont they have the same number of ports, queues, threads and upcalls?



>
>> On a related issue, I am looking into the memory consumed by the netlink
>> sockets, OVS on linux can create many of these sockets. Do you have any
>> thought as to why the current model was picked?
>
> Independent queues are the easiest way to provide lockless access to
> incoming packets on different cores and, in some case, give higher
> priority to certain types of packets.
>
>>> The speed also
>>> generally seems slower than I would expect but in any case I don't
>>> disagree that it is better to spread the load among all the cores.
>>>
>>> On the patch itself, can't we just make skb_get_hash() be able to
>>> decode ARP? It seems like that is cleaner and more generic.
>>
>>
>> My first thought was to make a change in skb_get_hash().  However, the
>> comment in __skb_get_hash() state that the hash is generated from the
>> 4-tuple (address and ports).  ARPs have no ports so a return value of 0
>> looked correct.
>>
>> /*
>>   * __skb_get_hash: calculate a flow hash based on src/dst addresses
>>   * and src/dst port numbers.  Sets hash in skb to non-zero hash value
>>   * on success, zero indicates no valid hash.  Also, sets l4_hash in skb
>>   * if hash is a canonical 4-tuple hash over transport ports.
>>   */
>>
>> What do you think?
>
> I don't think that this is really a strict definition. In particular,
> IP packets that aren't TCP or UDP will still return a hash based on
> the IP addresses.
>
> However, I believe that you are looking at an old version of this
> function. Any changes would need to be made to the upstream Linux
> tree, not purely in OVS.



From blp at nicira.com  Wed Oct  7 19:45:57 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 7 Oct 2015 19:45:57 -0700
Subject: [ovs-discuss] [ovn] lport name
In-Reply-To: <CAO=R8omUf7LyFE+mrOYALqOR5r0-=ETEZd5vadLJxp9Z69FBFw@mail.gmail.com>
References: <CAO=R8onC_5dDG9DFwpDZMVvtJnk9YFK5u=HaVCcVWHg6tvhOrQ@mail.gmail.com>
 <20151007231723.GI30120@nicira.com>
 <CAO=R8omUf7LyFE+mrOYALqOR5r0-=ETEZd5vadLJxp9Z69FBFw@mail.gmail.com>
Message-ID: <20151008024557.GA5103@nicira.com>

[adding back the mailing list]

On Wed, Oct 07, 2015 at 05:03:02PM -0700, Murali R wrote:
> >The lport name has to be the same as the iface-id so that ovn-controller
> >can identify the lport that an interface that shows up on br-int
> >corresponds to.
> 
> Not sure how this will sit with usability/migrations. One could create veth
> pairs with same name across hypervisors. Maybe we need to document iface-id
> should be unique per ovn domain.

I think that IntegrationGuide.md is already pretty clear about this.

From muralirdev at gmail.com  Thu Oct  8 00:24:10 2015
From: muralirdev at gmail.com (Murali R)
Date: Thu, 8 Oct 2015 00:24:10 -0700
Subject: [ovs-discuss] OVN - CIF
Message-ID: <CAO=R8ok=35NNz=f_yHgf2USB-KF6Yso9MxquaW2EHcdqYvyCTQ@mail.gmail.com>

I see this statement in the the arch doc
http://benpfaff.org/~blp/dist-docs/ovn-architecture.7.html

"OVN uses this mechanism and uses VLAN as the tagging mechanism.",

after providing 2 methods of CIF handling - 1:1 vif mapped or parent
mapped. From other discussions it looked like one could have "overlay" or
"underlay" modes for ovn. So is this a new development in version 7 of the
arch?

The option of vlan tagged parent vif for cif is good but there are use
cases for nfv where the infra is agnostic. Meaning overlay method is
preferred. I am currently trying to map vif to the br-int directly but not
sure based on the statement above, that scenario would work. I will check
in weekly irc as well. The tenant isolation could be provided by container
orchestrator using different schemes, so if there is inherent security/acl
that prevents connectivity using 1:1, I would like to know.

Thanks
Murali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151008/2386f061/attachment.html>

From elr at open.ch  Thu Oct  8 05:31:12 2015
From: elr at open.ch (Elias Raftopoulos)
Date: Thu, 8 Oct 2015 14:31:12 +0200
Subject: [ovs-discuss] Setting MTU for internal and trunk ports
Message-ID: <20226A63-6EBB-4DF6-8D94-F89A0C9B5893@open.ch>

Hello all,

we are trying to understand how the MTU value can be configured for internal and trunk ports on OVS. The behavior we are seeing, is that internal ports get a maximum MTU equal to the lowest MTU considering all trunk ports on a given switch, i.e. changing the MTU of a trunk port can potentially affect MTU values for internal ports. On the other hand, the same dependency is not observed when we lower the MTU of an internal port, i.e. trunk port MTU values are not affected.

Below you can see a concrete example. My switch switch_c, has two internal (eth0, eth2) and two trunk (peth0, peth2) ports:

    Bridge switch_c
        Controller "tcp:127.0.1.12:6633"
            is_connected: true
        fail_mode: secure
        Port switch_c
            Interface switch_c
                type: internal
        Port "peth0"
            Interface "peth0"
        Port "peth2"
            Interface "peth2"
        Port "eth0"
            Interface "eth0"
                type: internal
        Port "eth2"
            Interface "eth2"
                type: internal
        Port "c2a"
            Interface "c2a"
                type: patch
                options: {peer="a2c"}

Using "ip list set INTERFACE mtu VALUE” I can increase the mtu to 1700 from the default 1500 value for all interfaces (including the switch_c internal interface):

> ovs-vsctl list-ports switch_c | xargs -n1 ip link show  | grep mtu | column -t
458:  eth0:      <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  noqueue     state   UNKNOWN     mode   DEFAULT  group  default
457:  eth2:      <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  noqueue     state   UNKNOWN     mode   DEFAULT  group  default
20:   peth0:     <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  pfifo_fast  master  ovs-system  state  UP       mode   DEFAULT  group  default  qlen  1000
22:   peth2:     <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  pfifo_fast  master  ovs-system  state  UP       mode   DEFAULT  group  default  qlen  1000
> ip link list switch_c | grep mtu
449: switch_c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1700 qdisc noqueue state UNKNOWN mode DEFAULT group default

Then consider that the MTU for a trunk port is set back to a lower value:

> ip link set peth2 mtu 1500

The corresponding trunk port and all internal ports have now an MTU of 1500

> ovs-vsctl list-ports switch_c | xargs -n1 ip link show  | grep mtu | column -t
458:  eth0:      <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1500  qdisc  noqueue     state   UNKNOWN     mode   DEFAULT  group  default
457:  eth2:      <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1500  qdisc  noqueue     state   UNKNOWN     mode   DEFAULT  group  default
20:   peth0:     <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  pfifo_fast  master  ovs-system  state  UP       mode   DEFAULT  group  default  qlen  1000
22:   peth2:     <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1500  qdisc  pfifo_fast  master  ovs-system  state  UP       mode   DEFAULT  group  default  qlen  1000

Increasing the MTU for peth2 trunk port to 1700:

> ip link set peth2 mtu 1700

The respective trunk port and all internal ports report the increased MTU:

> ovs-vsctl list-ports switch_c | xargs -n1 ip link show  | grep mtu | column -t
Device "c2a" does not exist.
458:  eth0:      <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  noqueue     state   UNKNOWN     mode   DEFAULT  group  default
457:  eth2:      <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  noqueue     state   UNKNOWN     mode   DEFAULT  group  default
20:   peth0:     <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  pfifo_fast  master  ovs-system  state  UP       mode   DEFAULT  group  default  qlen  1000
22:   peth2:     <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  pfifo_fast  master  ovs-system  state  UP       mode   DEFAULT  group  default  qlen  1000

Decreasing the MTU for an internal port to 1500:

> ip link set eth2 mtu 1500

Only internal port eth2 MTU is affected:

> ovs-vsctl list-ports switch_c | xargs -n1 ip link show  | grep mtu | column -t
Device "c2a" does not exist.
458:  eth0:      <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  noqueue     state   UNKNOWN     mode   DEFAULT  group  default
457:  eth2:      <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1500  qdisc  noqueue     state   UNKNOWN     mode   DEFAULT  group  default
20:   peth0:     <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  pfifo_fast  master  ovs-system  state  UP       mode   DEFAULT  group  default  qlen  1000
22:   peth2:     <BROADCAST,MULTICAST,UP,LOWER_UP>  mtu  1700  qdisc  pfifo_fast  master  ovs-system  state  UP       mode   DEFAULT  group  default  qlen  1000

I understand that ports on a switch within the same broadcast domain should have the same MTU, since there is no L2 fragmentation, but that would mean that lowering the MTU of an trunk port should only potentially affect the MTU of other trunk ports (and not that of internal ports).

Is the behavior we are observing expected? If that is the case is there a way we can “lock” the MTU of an internal port so that there is no dependency with the respective value on trunk ports?

Thank in advance,
 Elias





From shettyg at nicira.com  Thu Oct  8 08:11:46 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 8 Oct 2015 08:11:46 -0700
Subject: [ovs-discuss] OVN - CIF
In-Reply-To: <CAO=R8ok=35NNz=f_yHgf2USB-KF6Yso9MxquaW2EHcdqYvyCTQ@mail.gmail.com>
References: <CAO=R8ok=35NNz=f_yHgf2USB-KF6Yso9MxquaW2EHcdqYvyCTQ@mail.gmail.com>
Message-ID: <CAHbON5ogv+L8dk==STpjXxDyT+aPEgbGKY3GYVCfaZ22Foto2Q@mail.gmail.com>

On Thu, Oct 8, 2015 at 12:24 AM, Murali R <muralirdev at gmail.com> wrote:
> I see this statement in the the arch doc
> http://benpfaff.org/~blp/dist-docs/ovn-architecture.7.html
>
> "OVN uses this mechanism and uses VLAN as the tagging mechanism.",
>
> after providing 2 methods of CIF handling - 1:1 vif mapped or parent mapped.
> From other discussions it looked like one could have "overlay" or "underlay"
> modes for ovn. So is this a new development in version 7 of the arch?

The "underlay" is another name that I use for vlan tagged mechanism.
There has been no change in the architecture recently.

>
> The option of vlan tagged parent vif for cif is good but there are use cases
> for nfv where the infra is agnostic.

I think you misunderstand. The "vlan" is only used for context. The
"vlan" mentioned here has got nothing to do with the physical
infrastructure. The vlan tagged packets reach hypervisor, where they
get stripped of the vlan headers and then get onto a overlay tunnel to
travel to another hypervisor. In the destination hypervisor, depending
on the destination container, a different vlan is slapped onto the
packet and sent to the VM.

>Meaning overlay method is preferred. I
> am currently trying to map vif to the br-int directly but not sure based on
> the statement above, that scenario would work. I will check in weekly irc as
> well. The tenant isolation could be provided by container orchestrator using
> different schemes, so if there is inherent security/acl that prevents
> connectivity using 1:1, I would like to know.
>
> Thanks
> Murali
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From john.hurley at netronome.com  Thu Oct  8 08:25:36 2015
From: john.hurley at netronome.com (John Hurley)
Date: Thu, 8 Oct 2015 16:25:36 +0100
Subject: [ovs-discuss] Ovs-conntrack code query
Message-ID: <CAK+XE=mnt79L79KN2pHZpiAMtvypoW401a4FffVkqDF2YmERng@mail.gmail.com>

Hi,

Recently I have been looking at the ovs-conntrack branch.
I am interested in the use of netfilter conntrack templates within the
kernel for storing rule information that can then be linked to the packet
skb and in turn used when passed to the nf_conntrack kernel module.

I notice that a new template is created when a new rule is added to the
kernel with nf_conntrack_alloc and nf_conntrack_tmpl_insert
(conntrack.c/ovs_ct_copy_action).
However, I do not see anywhere in the code that removes template even when
the rule itself is expired.
Looking at the source code for the nf functions above it appears that they
set up a timeout to trigger deletion but do not start the timer
(nf_conntrack_confirm sets this).
Am I missing something in the code for handling the cleanup of this memory
or is there a possible memory leak here?

The ovs-conntrack version I am using was taken from the tip of the branch
in mid September.

Thanks,
John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151008/8464c9d1/attachment-0001.html>

From jpettit at nicira.com  Thu Oct  8 09:05:23 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 8 Oct 2015 09:05:23 -0700
Subject: [ovs-discuss] OVN - CIF
In-Reply-To: <CAO=R8ok=35NNz=f_yHgf2USB-KF6Yso9MxquaW2EHcdqYvyCTQ@mail.gmail.com>
References: <CAO=R8ok=35NNz=f_yHgf2USB-KF6Yso9MxquaW2EHcdqYvyCTQ@mail.gmail.com>
Message-ID: <D19C840E-801B-455D-93A3-9E2381965657@nicira.com>


> On Oct 8, 2015, at 12:24 AM, Murali R <muralirdev at gmail.com> wrote:
> 
> I see this statement in the the arch doc http://benpfaff.org/~blp/dist-docs/ovn-architecture.7.html
> 
> "OVN uses this mechanism and uses VLAN as the tagging mechanism.",
> 
> after providing 2 methods of CIF handling - 1:1 vif mapped or parent mapped. From other discussions it looked like one could have "overlay" or "underlay" modes for ovn. So is this a new development in version 7 of the arch?

Guru answered your actual questions, but I just wanted to point out that the "7" is not a version; it's the section of the man page.  Here's a wikipedia article describing the different sections:

	https://en.wikipedia.org/wiki/Man_page#Manual_sections

--Justin



From gtvrreddy at gmail.com  Thu Oct  8 02:39:20 2015
From: gtvrreddy at gmail.com (Ramana Reddy)
Date: Thu, 8 Oct 2015 15:09:20 +0530
Subject: [ovs-discuss] How to send the whole packet from OVS to the
	controller
Message-ID: <CAL2CrsMbM8PfXHJhp-p5mgJaDyhnvx9OkHkkg1bUVirN6m-PLQ@mail.gmail.com>

Hi all,

I would like to know how to send the whole packet from OVS to
openflow controller.

Thanks,
Ramana
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151008/54f2b697/attachment.html>

From shettyg at nicira.com  Thu Oct  8 09:16:54 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 8 Oct 2015 09:16:54 -0700
Subject: [ovs-discuss] OVN - CIF
In-Reply-To: <CAO=R8onky7g0TznffuTi2oKoeVVGhtgZ=xv1-+EtCcbhtGsL9w@mail.gmail.com>
References: <CAO=R8ok=35NNz=f_yHgf2USB-KF6Yso9MxquaW2EHcdqYvyCTQ@mail.gmail.com>
 <CAHbON5ogv+L8dk==STpjXxDyT+aPEgbGKY3GYVCfaZ22Foto2Q@mail.gmail.com>
 <CAO=R8onky7g0TznffuTi2oKoeVVGhtgZ=xv1-+EtCcbhtGsL9w@mail.gmail.com>
Message-ID: <CAHbON5pZPsioOfMuA5_3_==6066bDiFRPzswAh4DYBU8HpNd+A@mail.gmail.com>

On Thu, Oct 8, 2015 at 9:04 AM, Murali R <muralirdev at gmail.com> wrote:
>>I think you misunderstand. The "vlan" is only used for context.
>
> What I meant was I may not have control of underlay in my use case. So
> cannot use that approach. Example vpc.

You will have to elaborate the end to end use case.

>>
>>
>

From jesse at nicira.com  Thu Oct  8 09:36:41 2015
From: jesse at nicira.com (Jesse Gross)
Date: Thu, 8 Oct 2015 09:36:41 -0700
Subject: [ovs-discuss] [PATCH-RFC 1/2] Improve ARP latency
In-Reply-To: <20151007200227.Horde.q0s1P_R6oNBEdYoEQ5v4Qg3@ltc.linux.ibm.com>
References: <20150930015039.Horde.By710uU5wzMPGcKhA46ZaA1@ltc.linux.ibm.com>
 <CAEP_g=9K69Muo2xBh8u_ypO2eriiKJvUL73PEXYNa7bKDenSKw@mail.gmail.com>
 <20151001191920.Horde.6y_--Lj_RoGK0nK7EgUF_A1@ltc.linux.ibm.com>
 <CAEP_g=8zoJoah_xHsd7-WmPK1sa=Pvnxr2xEQaELP72CjiSGFA@mail.gmail.com>
 <20151007200227.Horde.q0s1P_R6oNBEdYoEQ5v4Qg3@ltc.linux.ibm.com>
Message-ID: <CAEP_g=-sUVL3hFomeMq4tWZOh077t8DK4HCXkSG4GwtN41LUfA@mail.gmail.com>

On Wed, Oct 7, 2015 at 5:02 PM,  <dwilder at us.ibm.com> wrote:
>
> Quoting Jesse Gross <jesse at nicira.com>:
>
>> On Thu, Oct 1, 2015 at 4:19 PM,  <dwilder at us.ibm.com> wrote:
>>>
>>>
>>> Quoting Jesse Gross <jesse at nicira.com>:
>>>
>>>> On Tue, Sep 29, 2015 at 10:50 PM,  <dwilder at us.ibm.com> wrote:
>>>>>
>>>>>
>>>>> Hi-
>>>>>
>>>>> I have been conducting scaling tests with OVS and docker. My tests
>>>>> revealed
>>>>> that the latency of ARP packets can become very large resulting in many
>>>>> ARP
>>>>> re-transmissions and time-outs. I found the source of the poor latency
>>>>> to
>>>>> be
>>>>> with the handling of arp packets in ovs_vport_find_upcall_portid().
>>>>> Each
>>>>> packet is hashed in ovs_vport_find_upcall_portid() by calling
>>>>> skb_get_hash().  This hash is used to select a netlink socket in which
>>>>> to
>>>>> send the packet to userspace.  However, skb_get_hash() is not
>>>>> supporting
>>>>> ARP
>>>>> packets returning a 0 (invalid hash) for every ARP.  This results in a
>>>>> single ovs-vswitchd handler thread processing every arp packet thus
>>>>> severely
>>>>> impacting the average latency of ARPs. I am purposing a change to
>>>>> ovs_vport_find_upcall_portid() that spreads the ARP packets evenly
>>>>> between
>>>>> all the handler threads (patch to follow).  Please let me know if you
>>>>> have
>>>>> suggestions/comments.
>>>>
>>>>
>>>>
>>>> This is definitely an interesting analysis but I'm a little surprised
>>>> at the basic scenario. First, I guess it seems to me that the L2
>>>> domain is too large if there are this many ARPs.
>>>
>>>
>>>
>>> I can imagine running a couple of thousand docker containers, so I think
>>> this is a reasonable size test.
>>
>>
>> Having thousands of nodes (regardless of whether they are containers
>> or VMs) on a single L2 segment is really not a good idea. I would
>> expect them to be segmented into smaller groups with L3 boundaries in
>> the middle.
>
>
>
> Something I am not clear on. Creating smaller L2 segments would reduce the
> impact of a broadcast packet, fewer ports to flood the packet to. But would
> it affect the performance of the upcall datapath?  Comparing a single 512
> port switch to two 256 port switches (on a single host).  Wont they have the
> same number of ports, queues, threads and upcalls?

If it's all on the same host then it would be roughly the same impact
on that OVS. However, OVS instances on other hosts wouldn't have to
see these packets and it's just generally better design to have
smaller L2.

From joestringer at nicira.com  Thu Oct  8 10:59:35 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 8 Oct 2015 10:59:35 -0700
Subject: [ovs-discuss] Ovs-conntrack code query
In-Reply-To: <CAK+XE=mnt79L79KN2pHZpiAMtvypoW401a4FffVkqDF2YmERng@mail.gmail.com>
References: <CAK+XE=mnt79L79KN2pHZpiAMtvypoW401a4FffVkqDF2YmERng@mail.gmail.com>
Message-ID: <CANr6G5zQTLuDBrHWRyiZ4jVfTgcXM6kVeZ3_whU02Go7to_Adg@mail.gmail.com>

On 8 October 2015 at 08:25, John Hurley <john.hurley at netronome.com> wrote:
> Hi,
>
> Recently I have been looking at the ovs-conntrack branch.
> I am interested in the use of netfilter conntrack templates within the
> kernel for storing rule information that can then be linked to the packet
> skb and in turn used when passed to the nf_conntrack kernel module.
>
> I notice that a new template is created when a new rule is added to the
> kernel with nf_conntrack_alloc and nf_conntrack_tmpl_insert
> (conntrack.c/ovs_ct_copy_action).
> However, I do not see anywhere in the code that removes template even when
> the rule itself is expired.
> Looking at the source code for the nf functions above it appears that they
> set up a timeout to trigger deletion but do not start the timer
> (nf_conntrack_confirm sets this).
> Am I missing something in the code for handling the cleanup of this memory
> or is there a possible memory leak here?
>
> The ovs-conntrack version I am using was taken from the tip of the branch in
> mid September.

Hi John, appreciate the report.

If you look at the latest net-next version of this code, the templates
are no longer being inserted. ovs_ct_free_action() should handle
freeing the template itself. This will be the behaviour that
eventually makes it back into the OVS tree kernel module backport.
Does that satisfy your concerns?

From ckannan at iix.net  Thu Oct  8 16:31:06 2015
From: ckannan at iix.net (Chandrasekar Kannan)
Date: Thu, 8 Oct 2015 16:31:06 -0700
Subject: [ovs-discuss] ovs-vswitchd SEGV when using vhost-user feature with
	dpdk
Message-ID: <CAF2CpC=89Yu3Lub2tsAO7s2pWxS3nhXobi+8c2t_rQVNRY4oDg@mail.gmail.com>

I have ran into a ovs-vswitchd SEGV while trying to use the vhost-user
feature with the latest dpdk. I have attempted to provide as much
detail as I can.

versions compiled from source on CentOS 7.1 x86_64:
 - openvswitch 2.4.0 - http://openvswitch.org/releases/openvswitch-2.4.0.tar.gz
 - dpdk 2.1.0 - http://dpdk.org/browse/dpdk/snapshot/dpdk-2.1.0.tar.gz
 - qemu - 2.4.0.1 - http://wiki.qemu-project.org/download/qemu-2.4.0.1.tar.bz2


Steps to reproduce:

- Build and Install following these instructions
http://wiki.qemu.org/Features/vhost-user-ovs-dpdk
- setup details:

hugepage config:
GRUB_CMDLINE_LINUX="rd.lvm.lv=centos/root rd.lvm.lv=centos/swap
crashkernel=auto rhgb quiet iommu=pt intel_iommu=on
default_hugepagesz=1G hugepagesz=1G hugepages=8
isolcpus=1,2,3,4,5,12,13,14,15,16,17,7,8,9,10,11,18,19,20,21,22,23
transparent_hugepage=never"

# export DPDK_DIR=/root/dpdk/dpdk-2.1.0
# export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
# export DB_SOCK=/usr/local/var/run/openvswitch/db.sock


# modprobe openvswitch
# modprobe uio
# insmod /root/dpdk/dpdk-2.1.0/x86_64-native-linuxapp-gcc/kmod/igb_uio.ko
# insmod /root/dpdk/dpdk-2.1.0/lib/librte_vhost/eventfd_link/eventfd_link.ko

# /root/dpdk/dpdk-2.1.0/tools/dpdk_nic_bind.py --bind=igb_uio ens1f0
# /root/dpdk/dpdk-2.1.0/tools/dpdk_nic_bind.py --bind=igb_uio ens1f1

# /root/openvswitch/openvswitch-2.4.0/ovsdb/ovsdb-server
--remote=punix:/usr/local/var/run/openvswitch/db.sock
--remote=db:Open_vSwitch,Open_vSwitch,manager_options     --pidfile
--detach

# rm -f /usr/local/var/run/openvswitch/vhost-user*

# /root/openvswitch/openvswitch-2.4.0/vswitchd/ovs-vswitchd --dpdk -c
0xffff -n 4 --socket-mem 1024 -- unix:$DB_SOCK --pidfile --detach
--log-file=/var/log/openvswitch/ovs-vswitchd.log

# lspci | grep Ethernet
01:00.0 Ethernet controller: Intel Corporation Ethernet Controller
10-Gigabit X540-AT2 (rev 01)
01:00.1 Ethernet controller: Intel Corporation Ethernet Controller
10-Gigabit X540-AT2 (rev 01)

# /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-br br0
-- set bridge br0 datapath_type=netdev
# /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
dpdk0 -- set Interface dpdk0 type=dpdk
# /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
dpdk1 -- set Interface dpdk1 type=dpdk
# /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
vhost-user2 -- set Interface vhost-user2 type=dpdkvhostuser
# /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
vhost-user1 -- set Interface vhost-user1 type=dpdkvhostuser

- Start the first VM like this:
./qemu-system-x86_64 -enable-kvm -m 1024 -smp 2 \
 -display sdl \
 -sdl \
 -chardev socket,id=char0,path=/usr/local/var/run/openvswitch/vhost-user1 \
 -netdev type=vhost-user,id=mynet1,chardev=char0,vhostforce  \
 -device virtio-net-pci,netdev=mynet1,mac=52:54:00:02:d9:01 \
 -object memory-backend-file,id=mem,size=1024M,mem-path=/dev/hugepages,share=on
\
 -numa node,memdev=mem -mem-prealloc \
 -net user,hostfwd=tcp::10021-:22 \
 -net nic  \
 /var/lib/libvirt/images/centos-vm1.qcow2  &

- From another machine send iperf traffic to this VM.
  iperf -s (in the VM)
  iperf -c <ipaddr> -t 60 -P 12 (from another machine)

- After about a few seconds, iperf stalls. network connectivity
breaks. Can't ping the VM anymore.
- Saw these in the ovs-vswitchd log files.

Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
Failed to allocate memory for mbuf.
Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
Failed to allocate memory for mbuf.
Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
Failed to allocate memory for mbuf.
Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
Failed to allocate memory for mbuf.
Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
Failed to allocate memory for mbuf.

- shutdown iperf ... then shutdown the VM.
- at this point ovs-vswitchd crashes with the following SEGV.

[root at localhost vswitchd]# gdb ./ovs-vswitchd
/var/spool/abrt/ccpp-2015-09-29-18\:47\:37-22012/coredump
GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-64.el7
Copyright (C) 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-redhat-linux-gnu".
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>...
Reading symbols from
/root/openvswitch/openvswitch-2.4.0/vswitchd/ovs-vswitchd...done.
[New LWP 22051]
[New LWP 22012]
[New LWP 22013]
[New LWP 22015]
[New LWP 22039]
[New LWP 22040]
[New LWP 22041]
[New LWP 22042]
[New LWP 22043]
[New LWP 22044]
[New LWP 22045]
[New LWP 22046]
[New LWP 22047]
[New LWP 22048]
[New LWP 22049]
[New LWP 22050]
[New LWP 22014]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib64/libthread_db.so.1".
Core was generated by
`/root/openvswitch/openvswitch-2.4.0/vswitchd/ovs-vswitchd --dpdk -c
0xffff -n 4'.
Program terminated with signal 11, Segmentation fault.
#0  0x00007eff4d71df1f in rte_vhost_dequeue_burst () from /lib64/libdpdk.so
Missing separate debuginfos, use: debuginfo-install glibc-2.17-78.el7.x86_64
(gdb) where
#0  0x00007eff4d71df1f in rte_vhost_dequeue_burst () from /lib64/libdpdk.so
#1  0x000000000056d103 in netdev_dpdk_vhost_rxq_recv
(rxq_=0x7efe5a537600, packets=0x7eff4c9a2930, c=0x7eff4c9a292c)
    at lib/netdev-dpdk.c:952
#2  0x00000000004a2dec in netdev_rxq_recv (rx=0x7efe5a537600,
buffers=0x7eff4c9a2930, cnt=0x7eff4c9a292c)
    at lib/netdev.c:652
#3  0x0000000000478f33 in dp_netdev_process_rxq_port (pmd=0x231c310,
port=0x2166990, rxq=0x7efe5a537600)
    at lib/dpif-netdev.c:2520
#4  0x0000000000479648 in pmd_thread_main (f_=0x231c310) at
lib/dpif-netdev.c:2680
#5  0x00000000004f60f3 in ovsthread_wrapper (aux_=0x231c150) at
lib/ovs-thread.c:340
#6  0x00007eff4d276df5 in start_thread () from /lib64/libpthread.so.0
#7  0x00007eff4ca9a1ad in clone () from /lib64/libc.so.6
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151008/0e74912c/attachment.html>

From ciara.loftus at intel.com  Fri Oct  9 00:07:17 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Fri, 9 Oct 2015 07:07:17 +0000
Subject: [ovs-discuss] ovs-vswitchd SEGV when using vhost-user feature
 with	dpdk
In-Reply-To: <CAF2CpC=89Yu3Lub2tsAO7s2pWxS3nhXobi+8c2t_rQVNRY4oDg@mail.gmail.com>
References: <CAF2CpC=89Yu3Lub2tsAO7s2pWxS3nhXobi+8c2t_rQVNRY4oDg@mail.gmail.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC24CBAFF76@IRSMSX106.ger.corp.intel.com>

> 
> I have ran into a ovs-vswitchd SEGV while trying to use the vhost-user
> feature with the latest dpdk. I have attempted to provide as much detail as I
> can.
> 
> versions compiled from source on CentOS 7.1 x86_64:
>  - openvswitch 2.4.0 - http://openvswitch.org/releases/openvswitch-
> 2.4.0.tar.gz
>  - dpdk 2.1.0 - http://dpdk.org/browse/dpdk/snapshot/dpdk-2.1.0.tar.gz
>  - qemu - 2.4.0.1 - http://wiki.qemu-project.org/download/qemu-
> 2.4.0.1.tar.bz2
> 
> 
> Steps to reproduce:
> 
> - Build and Install following these instructions
> http://wiki.qemu.org/Features/vhost-user-ovs-dpdk
> - setup details:
> 
> hugepage config:
> GRUB_CMDLINE_LINUX="rd.lvm.lv=centos/root rd.lvm.lv=centos/swap
> crashkernel=auto rhgb quiet iommu=pt intel_iommu=on
> default_hugepagesz=1G hugepagesz=1G hugepages=8
> isolcpus=1,2,3,4,5,12,13,14,15,16,17,7,8,9,10,11,18,19,20,21,22,23
> transparent_hugepage=never"
> 
> # export DPDK_DIR=/root/dpdk/dpdk-2.1.0
> # export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
> # export DB_SOCK=/usr/local/var/run/openvswitch/db.sock
> 
> 
> # modprobe openvswitch
> # modprobe uio
> # insmod /root/dpdk/dpdk-2.1.0/x86_64-native-linuxapp-
> gcc/kmod/igb_uio.ko
> # insmod /root/dpdk/dpdk-
> 2.1.0/lib/librte_vhost/eventfd_link/eventfd_link.ko
> 
> # /root/dpdk/dpdk-2.1.0/tools/dpdk_nic_bind.py --bind=igb_uio ens1f0
> # /root/dpdk/dpdk-2.1.0/tools/dpdk_nic_bind.py --bind=igb_uio ens1f1
> 
> # /root/openvswitch/openvswitch-2.4.0/ovsdb/ovsdb-server --
> remote=punix:/usr/local/var/run/openvswitch/db.sock     --
> remote=db:Open_vSwitch,Open_vSwitch,manager_options     --pidfile --
> detach
> 
> # rm -f /usr/local/var/run/openvswitch/vhost-user*
> 
> # /root/openvswitch/openvswitch-2.4.0/vswitchd/ovs-vswitchd --dpdk -c
> 0xffff -n 4 --socket-mem 1024 -- unix:$DB_SOCK --pidfile --detach --log-
> file=/var/log/openvswitch/ovs-vswitchd.log
> 
> # lspci | grep Ethernet
> 01:00.0 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit
> X540-AT2 (rev 01)
> 01:00.1 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit
> X540-AT2 (rev 01)
> 
> # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-br br0 -- set
> bridge br0 datapath_type=netdev
> # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> dpdk0 -- set Interface dpdk0 type=dpdk
> # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> dpdk1 -- set Interface dpdk1 type=dpdk
> # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> vhost-user2 -- set Interface vhost-user2 type=dpdkvhostuser
> # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> vhost-user1 -- set Interface vhost-user1 type=dpdkvhostuser
> 
> - Start the first VM like this:
> ./qemu-system-x86_64 -enable-kvm -m 1024 -smp 2 \

My first suggestion would be to try supplying your VM with more memory. ie. instead of "-m 1024", try "-m 4096"

Thanks,
Ciara

>  -display sdl \
>  -sdl \
>  -chardev socket,id=char0,path=/usr/local/var/run/openvswitch/vhost-user1
> \
>  -netdev type=vhost-user,id=mynet1,chardev=char0,vhostforce  \
>  -device virtio-net-pci,netdev=mynet1,mac=52:54:00:02:d9:01 \
>  -object memory-backend-file,id=mem,size=1024M,mem-
> path=/dev/hugepages,share=on \
>  -numa node,memdev=mem -mem-prealloc \
>  -net user,hostfwd=tcp::10021-:22 \
>  -net nic  \
>  /var/lib/libvirt/images/centos-vm1.qcow2  &
> 
> - From another machine send iperf traffic to this VM.
>   iperf -s (in the VM)
>   iperf -c <ipaddr> -t 60 -P 12 (from another machine)
> 
> - After about a few seconds, iperf stalls. network connectivity breaks. Can't
> ping the VM anymore.
> - Saw these in the ovs-vswitchd log files.
> 
> Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> 
> - shutdown iperf ... then shutdown the VM.
> - at this point ovs-vswitchd crashes with the following SEGV.
> 
> [root at localhost vswitchd]# gdb ./ovs-vswitchd /var/spool/abrt/ccpp-2015-
> 09-29-18\:47\:37-22012/coredump
> GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-64.el7
> Copyright (C) 2013 Free Software Foundation, Inc.
> License GPLv3+: GNU GPL version 3 or later
> <http://gnu.org/licenses/gpl.html>
> This is free software: you are free to change and redistribute it.
> There is NO WARRANTY, to the extent permitted by law.  Type "show
> copying"
> and "show warranty" for details.
> This GDB was configured as "x86_64-redhat-linux-gnu".
> For bug reporting instructions, please see:
> <http://www.gnu.org/software/gdb/bugs/>...
> Reading symbols from /root/openvswitch/openvswitch-2.4.0/vswitchd/ovs-
> vswitchd...done.
> [New LWP 22051]
> [New LWP 22012]
> [New LWP 22013]
> [New LWP 22015]
> [New LWP 22039]
> [New LWP 22040]
> [New LWP 22041]
> [New LWP 22042]
> [New LWP 22043]
> [New LWP 22044]
> [New LWP 22045]
> [New LWP 22046]
> [New LWP 22047]
> [New LWP 22048]
> [New LWP 22049]
> [New LWP 22050]
> [New LWP 22014]
> [Thread debugging using libthread_db enabled]
> Using host libthread_db library "/lib64/libthread_db.so.1".
> Core was generated by `/root/openvswitch/openvswitch-
> 2.4.0/vswitchd/ovs-vswitchd --dpdk -c 0xffff -n 4'.
> Program terminated with signal 11, Segmentation fault.
> #0  0x00007eff4d71df1f in rte_vhost_dequeue_burst () from
> /lib64/libdpdk.so
> Missing separate debuginfos, use: debuginfo-install glibc-2.17-78.el7.x86_64
> (gdb) where
> #0  0x00007eff4d71df1f in rte_vhost_dequeue_burst () from
> /lib64/libdpdk.so
> #1  0x000000000056d103 in netdev_dpdk_vhost_rxq_recv
> (rxq_=0x7efe5a537600, packets=0x7eff4c9a2930, c=0x7eff4c9a292c)
>     at lib/netdev-dpdk.c:952
> #2  0x00000000004a2dec in netdev_rxq_recv (rx=0x7efe5a537600,
> buffers=0x7eff4c9a2930, cnt=0x7eff4c9a292c)
>     at lib/netdev.c:652
> #3  0x0000000000478f33 in dp_netdev_process_rxq_port (pmd=0x231c310,
> port=0x2166990, rxq=0x7efe5a537600)
>     at lib/dpif-netdev.c:2520
> #4  0x0000000000479648 in pmd_thread_main (f_=0x231c310) at lib/dpif-
> netdev.c:2680
> #5  0x00000000004f60f3 in ovsthread_wrapper (aux_=0x231c150) at lib/ovs-
> thread.c:340
> #6  0x00007eff4d276df5 in start_thread () from /lib64/libpthread.so.0
> #7  0x00007eff4ca9a1ad in clone () from /lib64/libc.so.6

From john.hurley at netronome.com  Fri Oct  9 06:36:16 2015
From: john.hurley at netronome.com (John Hurley)
Date: Fri, 9 Oct 2015 14:36:16 +0100
Subject: [ovs-discuss] Ovs-conntrack code query
In-Reply-To: <CANr6G5zQTLuDBrHWRyiZ4jVfTgcXM6kVeZ3_whU02Go7to_Adg@mail.gmail.com>
References: <CAK+XE=mnt79L79KN2pHZpiAMtvypoW401a4FffVkqDF2YmERng@mail.gmail.com>
 <CANr6G5zQTLuDBrHWRyiZ4jVfTgcXM6kVeZ3_whU02Go7to_Adg@mail.gmail.com>
Message-ID: <CAK+XE=mbtHDNsoYvgh_=aRScPBU8QiTtHK+aL=VuvhUJcLP=RQ@mail.gmail.com>

Hi Joe,

Thanks for the reply.
I have found the updated code and can now see that template insertion no
longer occurs and that there is a clear delete.
This makes much more sense to me now!

On a side note, is there any update on when conntrack will be merged into
the main branch and/or kernel distributions?

Thank,
John

On Thu, Oct 8, 2015 at 6:59 PM, Joe Stringer <joestringer at nicira.com> wrote:

> On 8 October 2015 at 08:25, John Hurley <john.hurley at netronome.com> wrote:
> > Hi,
> >
> > Recently I have been looking at the ovs-conntrack branch.
> > I am interested in the use of netfilter conntrack templates within the
> > kernel for storing rule information that can then be linked to the packet
> > skb and in turn used when passed to the nf_conntrack kernel module.
> >
> > I notice that a new template is created when a new rule is added to the
> > kernel with nf_conntrack_alloc and nf_conntrack_tmpl_insert
> > (conntrack.c/ovs_ct_copy_action).
> > However, I do not see anywhere in the code that removes template even
> when
> > the rule itself is expired.
> > Looking at the source code for the nf functions above it appears that
> they
> > set up a timeout to trigger deletion but do not start the timer
> > (nf_conntrack_confirm sets this).
> > Am I missing something in the code for handling the cleanup of this
> memory
> > or is there a possible memory leak here?
> >
> > The ovs-conntrack version I am using was taken from the tip of the
> branch in
> > mid September.
>
> Hi John, appreciate the report.
>
> If you look at the latest net-next version of this code, the templates
> are no longer being inserted. ovs_ct_free_action() should handle
> freeing the template itself. This will be the behaviour that
> eventually makes it back into the OVS tree kernel module backport.
> Does that satisfy your concerns?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151009/e073d9f4/attachment.html>

From s.hesam.ghasemi at gmail.com  Fri Oct  9 09:16:46 2015
From: s.hesam.ghasemi at gmail.com (Seyyed Hesamoddin Ghasemi)
Date: Fri, 9 Oct 2015 19:46:46 +0330
Subject: [ovs-discuss] Help me on calculating queue size
Message-ID: <CAOsSsa7ksLsN6QKPW5Hnq4go9t-9j-JwpdDw-C5+XOECnpbkCA@mail.gmail.com>

Hi,
Can somebody explain me how can calculate queue size in my switch port?
what command I can use in OVS?

-- 
Seyyed Hesamoddin Ghasemi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151009/768bbad2/attachment.html>

From fbl at sysclose.org  Fri Oct  9 10:47:26 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Fri, 9 Oct 2015 14:47:26 -0300
Subject: [ovs-discuss] selinux and openvswitch
In-Reply-To: <CAHbON5remKmXfUf5OP2zN4N5ag2=2UnU44467efKQCtp7NN6mA@mail.gmail.com>
References: <CAHbON5remKmXfUf5OP2zN4N5ag2=2UnU44467efKQCtp7NN6mA@mail.gmail.com>
Message-ID: <20151009174726.GA2224@x240.home>

On Wed, Sep 30, 2015 at 01:56:05PM -0700, Gurucharan Shetty wrote:
> When I install openvswitch on RHEL-7 via RPM packages created from OVS
> sources in github, the OVS service fails to start because it looks
> like selinux prevents one from creating /etc/openvswitch.
> 
> Are there people that install OVS with SELINUX? How do you make it work?

Which spec did you use?
I saw recently a patch in dev@ fixing the dire issue.

fbl


From fbl at sysclose.org  Fri Oct  9 10:51:18 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Fri, 9 Oct 2015 14:51:18 -0300
Subject: [ovs-discuss] Error with DPDK options in ovs-vswitchd
In-Reply-To: <CAMKg0N=kOxzV=vG-yN8jpa1xfve4mbMxdO=_cSfBdYJ3oYRdrg@mail.gmail.com>
References: <CAMKg0N=kOxzV=vG-yN8jpa1xfve4mbMxdO=_cSfBdYJ3oYRdrg@mail.gmail.com>
Message-ID: <20151009175118.GB2224@x240.home>

On Thu, Oct 01, 2015 at 04:27:29PM -0700, Yash Thadhani wrote:
> Hello everyone,
>                         I was trying to build vhost-user for OVS using DPDK
> 2.0.0. I am using Open-vSwitch 2.4. I followed the steps mentioned in this
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
> link:

[...]
> Also prior to rerunning ovs-vswitchd, I checked the ovs-version, it
> was still 2.3.1 and not 2.4.
 
Looks like you are running another ovs-vswitchd version.
Have you installed the binaries?
Are they in the $PATH? Is in correct order?

You might want to specify the full path to the correct OVS daemons.

fbl



From aatteka at nicira.com  Fri Oct  9 12:13:28 2015
From: aatteka at nicira.com (Ansis Atteka)
Date: Fri, 9 Oct 2015 12:13:28 -0700
Subject: [ovs-discuss] selinux and openvswitch
In-Reply-To: <20151009174726.GA2224@x240.home>
References: <CAHbON5remKmXfUf5OP2zN4N5ag2=2UnU44467efKQCtp7NN6mA@mail.gmail.com>
 <20151009174726.GA2224@x240.home>
Message-ID: <CAA=3OqnkrQ50Yz70k99EncnwGdkepY8XNVEsHaFdH=s91rrixg@mail.gmail.com>

On Fri, Oct 9, 2015 at 10:47 AM, Flavio Leitner <fbl at sysclose.org> wrote:
> On Wed, Sep 30, 2015 at 01:56:05PM -0700, Gurucharan Shetty wrote:
>> When I install openvswitch on RHEL-7 via RPM packages created from OVS
>> sources in github, the OVS service fails to start because it looks
>> like selinux prevents one from creating /etc/openvswitch.
>>
>> Are there people that install OVS with SELINUX? How do you make it work?
>
> Which spec did you use?
> I saw recently a patch in dev@ fixing the dire issue.


Guru, this patch
https://github.com/openvswitch/ovs/commit/f0dc83b762bd2645aef975ab01e33b8d69c68840
should address OVS installation issue when SElinux is in enforcing
mode.

From shettyg at nicira.com  Fri Oct  9 12:32:44 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 9 Oct 2015 12:32:44 -0700
Subject: [ovs-discuss] selinux and openvswitch
In-Reply-To: <20151009174726.GA2224@x240.home>
References: <CAHbON5remKmXfUf5OP2zN4N5ag2=2UnU44467efKQCtp7NN6mA@mail.gmail.com>
 <20151009174726.GA2224@x240.home>
Message-ID: <CAHbON5o10cJSmD4TJ_PdeFzpNfYM8KsTp+e8KQHhMxK-fSDrJg@mail.gmail.com>

> Which spec did you use?
> I saw recently a patch in dev@ fixing the dire issue.
>

Yup. Yeah, I sent the query before Ansis fixed it.

> fbl
>

From zhouhan at gmail.com  Fri Oct  9 14:18:44 2015
From: zhouhan at gmail.com (Han Zhou)
Date: Fri, 9 Oct 2015 14:18:44 -0700
Subject: [ovs-discuss] How to send the whole packet from OVS to the
	controller
In-Reply-To: <CAL2CrsMbM8PfXHJhp-p5mgJaDyhnvx9OkHkkg1bUVirN6m-PLQ@mail.gmail.com>
References: <CAL2CrsMbM8PfXHJhp-p5mgJaDyhnvx9OkHkkg1bUVirN6m-PLQ@mail.gmail.com>
Message-ID: <CADtzDCmWdFXJnCSSj1s3TARGj86=Jk6Xq9e9L1LkpOcTJFEPdg@mail.gmail.com>

Hi,

On Thu, Oct 8, 2015 at 2:39 AM, Ramana Reddy <gtvrreddy at gmail.com> wrote:
> Hi all,
>
> I would like to know how to send the whole packet from OVS to
> openflow controller.
>

Try the openflow action: controller.

Han

From joestringer at nicira.com  Fri Oct  9 16:14:40 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Fri, 9 Oct 2015 16:14:40 -0700
Subject: [ovs-discuss] Ovs-conntrack code query
In-Reply-To: <CAK+XE=mbtHDNsoYvgh_=aRScPBU8QiTtHK+aL=VuvhUJcLP=RQ@mail.gmail.com>
References: <CAK+XE=mnt79L79KN2pHZpiAMtvypoW401a4FffVkqDF2YmERng@mail.gmail.com>
 <CANr6G5zQTLuDBrHWRyiZ4jVfTgcXM6kVeZ3_whU02Go7to_Adg@mail.gmail.com>
 <CAK+XE=mbtHDNsoYvgh_=aRScPBU8QiTtHK+aL=VuvhUJcLP=RQ@mail.gmail.com>
Message-ID: <CANr6G5zaGQKM5HFDcx2j=iNez3b_kLDAKZEaTULWX65MWfevAg@mail.gmail.com>

I'm hoping to merge the userspace changes into OVS repo very soon, and
I'm working on a kernel backport for the OVS out-of-tree module in the
background. In terms of kernel releases, linux-4.3 will introduce the
code.

On 9 October 2015 at 06:36, John Hurley <john.hurley at netronome.com> wrote:
> Hi Joe,
>
> Thanks for the reply.
> I have found the updated code and can now see that template insertion no
> longer occurs and that there is a clear delete.
> This makes much more sense to me now!
>
> On a side note, is there any update on when conntrack will be merged into
> the main branch and/or kernel distributions?
>
> Thank,
> John
>
> On Thu, Oct 8, 2015 at 6:59 PM, Joe Stringer <joestringer at nicira.com> wrote:
>>
>> On 8 October 2015 at 08:25, John Hurley <john.hurley at netronome.com> wrote:
>> > Hi,
>> >
>> > Recently I have been looking at the ovs-conntrack branch.
>> > I am interested in the use of netfilter conntrack templates within the
>> > kernel for storing rule information that can then be linked to the
>> > packet
>> > skb and in turn used when passed to the nf_conntrack kernel module.
>> >
>> > I notice that a new template is created when a new rule is added to the
>> > kernel with nf_conntrack_alloc and nf_conntrack_tmpl_insert
>> > (conntrack.c/ovs_ct_copy_action).
>> > However, I do not see anywhere in the code that removes template even
>> > when
>> > the rule itself is expired.
>> > Looking at the source code for the nf functions above it appears that
>> > they
>> > set up a timeout to trigger deletion but do not start the timer
>> > (nf_conntrack_confirm sets this).
>> > Am I missing something in the code for handling the cleanup of this
>> > memory
>> > or is there a possible memory leak here?
>> >
>> > The ovs-conntrack version I am using was taken from the tip of the
>> > branch in
>> > mid September.
>>
>> Hi John, appreciate the report.
>>
>> If you look at the latest net-next version of this code, the templates
>> are no longer being inserted. ovs_ct_free_action() should handle
>> freeing the template itself. This will be the behaviour that
>> eventually makes it back into the OVS tree kernel module backport.
>> Does that satisfy your concerns?
>
>

From liu.liuyongqiang at huawei.com  Fri Oct  9 18:28:21 2015
From: liu.liuyongqiang at huawei.com (Liuyongqiang (A))
Date: Sat, 10 Oct 2015 01:28:21 +0000
Subject: [ovs-discuss] ovsdb-client connected error when i update the
 ovsdb-server ca_cert.pem file
Message-ID: <621FAA8B3DA4E14193D6933FB72489BA58265E06@nkgeml511-mbx.china.huawei.com>

Thanks ben, I have tried your method, but the problem persists.

This is my script:

Server:

#!/bin/bash

SRC_CA_CRT_FILE=/home/pem/oam-network-agent_ca_crt.pem

DST_CA_CRT_FILE=/home/oam-network-agent_ca_crt.pem

for((i=0; i<50000; i++));do

rm -f $DST_CA_CRT_FILE
sleep 0.5
openssl x509 -inform PEM -in $SRC_CA_CRT_FILE > /home/ca_crt.pem.tmp
mv /home/ca_crt.pem.tmp $DST_CA_CRT_FILE

echo "update-----result $?-------------------------------------$i"

done

client:

for((i=0; i<50000; i++));do

    ovsdb-client -v -p /home/oam-network-agent_private_key.pem -c oam-network-agent_crt.pem -C /home/oam-network-agent_ca_crt.pem get-schema ssl:9.42.3.9:6632 Open_vSwitch
    sleep 0.5
    echo $i

done
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151010/d119f637/attachment.html>

From daniel.herrmann at zv.fraunhofer.de  Sat Oct 10 03:21:30 2015
From: daniel.herrmann at zv.fraunhofer.de (daniel.herrmann at zv.fraunhofer.de)
Date: Sat, 10 Oct 2015 12:21:30 +0200
Subject: [ovs-discuss] OVS not re-adding OpenFlow rules to kernel datapath
Message-ID: <5618E6AA.5000503@zv.fraunhofer.de>

Hi all,

we are currently experiencing a rather strange behaviour of the OVS in
an OpenFlow environment, RYU being used as controller. This behaviour
occurs both in the current 2.4 release and in the latest code from
master branch compiled yesterday. OS is Debian 8 running in an ESXi
virtualized environment.

While the traffic generation is already running, Ryu installs a set of
rules using OpenFlow13, which also can be seen using "ovs-ofctl -O
OpenFlow13 dump-flows br0". The following snipped shows an example to
explain the nature of the installed flow entries.

---
cookie=0x0, duration=65322.938s, table=0, n_packets=253215,
n_bytes=133444585, ip,in_port=1,nw_dst=10.10.0.0/16
actions=write_metadata:0xa/0xff,goto_table:10
cookie=0x0, duration=65322.938s, table=0, n_packets=0, n_bytes=0,
ip,in_port=1,nw_dst=10.0.0.0/29
actions=write_metadata:0xa/0xff,goto_table:10
cookie=0x0, duration=65322.938s, table=10, n_packets=253215,
n_bytes=133444585, ip,metadata=0xa
actions=set_field:(...)->eth_dst,set_field:(...)->eth_src,push_mpls:0x8847,set_field:(...)>mpls_label,output:2
---

For the sake of completeness, this paste shows the full output of the
command above: http://pastebin.com/Wnq5CYtV

Those flows are also shown using ovs-dpctl dump-flows, so they are
installed in the kernel (there are plenty of them, however, so we posted
the command output externally): http://pastebin.com/jncDptCV

One example flow is shown below. The only thing we note here is the "bad
key length" warning when setting the Ethernet addresses. It is however
working in the first place. Putting 150Mbps of traffic works perfectly,
it is forwarded and sent through the network.

---
recirc_id(0),in_port(2),eth(src=00:50:56:82:59:b2,dst=00:50:56:82:dc:83),eth_type(0x0800),ipv4(src=8.0.0.0/8.0.0.0,dst=10.19.0.0/255.255.0.0,tos=0/0xfc,ttl=126,frag=no),
packets:1864, bytes:1236339, used:0.118s, flags:FP., actions:set(eth(bad
key length 24, expected 12)(00 50 56 82 29 cb 00 50 56 82 7c ac 0c 00 09
00 03 e9 31 7e 88 47 00
00)),push_mpls(label=16019,tc=0,ttl=126,bos=1,eth_type=0x8847),3
---

Next we remove the traffic load, such that there is no traffic at all
going through the OVS instance. After a few seconds, the kernel cache
seems to be cleared, as "ovs-dpctl dump-flows" produces no output at
all. Then we start the same traffic again, which actually does arrive at
the OVS instance (TX packets on ingress interface seen with bwm-ng), but
it is not forwarded. In the first few seconds, the flow rules are
installed again (but much less than before): http://pastebin.com/uAhqAaMQ

After a few more seconds, there is only one rule left which actually
drops all the packets:

---
recirc_id(0),in_port(2),eth(src=00:50:56:82:59:b2,dst=00:50:56:82:dc:83),eth_type(0x0800),ipv4(src=2.0.0.0/2.0.0.0,dst=10.0.0.0/250.0.0.0,frag=no),
packets:2882140, bytes:1198579242, used:0.000s, flags:SFPR.C, actions:drop
---

In the OpenFlow rules installed by RYU there is not a single rule which
drops packets. The OpenFlow rules are however still present, "ovs-ofctl
-O OpenFlow13 dump-flows br0" still shows the same flows than before.
Further, the switch is still connected to the controller, and we can see
no error output in the log files. Restarting RYU and hence re-installing
the OpenFlow rules solves the issue for the moment, but as soon the
flows are removed from the kernel datapath and are re-inserted again,
this problem appears again. It is reproducible on our nodes.

This problem seems to be related by the communication between the
userspace and kernel module. When the datapath is set to be a netdev
device, this issue does not occur at all, but throughput is limited.

Could this be a bug of some kind?

And another question: Do you think using DPDK as datapath could solve
the issue?

Thanks in advance and best regards
Daniel

From dotslash.lu at gmail.com  Sat Oct 10 03:32:20 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Sat, 10 Oct 2015 18:32:20 +0800
Subject: [ovs-discuss] 2.3.2 kernel module build error on rhel7
Message-ID: <CALrtOxoYw2AXz1j6pUzUjHFjL9V93J0Rzh=7YkEs2du3XCNy-w@mail.gmail.com>

Hi all,

When building LTS version of ovs kernel module from tarball on CentOS 7,
kernel version 3.10.0-229.el7.x86_64, I encountered following errors. What
I did wrong here?

...
/usr/bin/make -C /usr/src/kernels/3.10.0-229.14.1.el7.x86_64
M=/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux modules
make[1]: Entering directory `/usr/src/kernels/3.10.0-229.14.1.el7.x86_64'
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_netlink.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_table.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-gre.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-internal_dev.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-lisp.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-netdev.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-vxlan.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dev-openvswitch.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/exthdrs_core.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flex_array.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_dissector.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gre.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gso.o
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.c:42:0:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.c:42:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.c:42:0:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.c:42:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:31:0:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:31:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:31:0:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:31:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-lisp.c:31:0:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-lisp.c:31:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-lisp.c:31:0:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-lisp.c:31:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.c:24:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.c:24:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.c:24:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.c:24:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-internal_dev.c:30:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-internal_dev.c:30:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-internal_dev.c:30:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-internal_dev.c:30:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:57:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:57:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:57:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:57:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/ip_tunnels.h:12:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.h:36,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_table.c:19:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/ip_tunnels.h:12,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.h:36,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_table.c:19:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/ip_tunnels.h:12:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.h:36,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_table.c:19:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/ip_tunnels.h:12,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.h:36,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_table.c:19:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.o]
Error 1
make[2]: *** Waiting for unfinished jobs....
In file included from include/net/ip_tunnels.h:12:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/gre.h:5,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gre.c:37:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/ip_tunnels.h:12,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/gre.h:5,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gre.c:37:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/ip_tunnels.h:12:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/gre.h:5,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gre.c:37:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/ip_tunnels.h:12,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/gre.h:5,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gre.c:37:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-internal_dev.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-lisp.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gre.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_table.o]
Error 1
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport.c:34:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport.c:34:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport.c:34:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport.c:34:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/ip_tunnels.h:12:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.h:36,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_netlink.c:21:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/ip_tunnels.h:12,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.h:36,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_netlink.c:21:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/ip_tunnels.h:12:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.h:36,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_netlink.c:21:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/ip_tunnels.h:12,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.h:36,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_netlink.c:21:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-vxlan.c:31:0:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-vxlan.c:31:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-vxlan.c:31:0:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-vxlan.c:31:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-gre.c:39:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-gre.c:39:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-gre.c:39:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-gre.c:39:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-netdev.c:32:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-netdev.c:32:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/xfrm.h:19:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-netdev.c:32:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/xfrm.h:19,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-netdev.c:32:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport.o]
Error 1
In file included from include/net/ip_tunnels.h:12:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/gre.h:5,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gso.c:34:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:
In function 'rpl_inet_get_local_port_range':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
warning: passing argument 1 of 'inet_get_local_port_range' from
incompatible pointer type [enabled by default]
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/ip_tunnels.h:12,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/gre.h:5,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gso.c:34:
include/net/ip.h:223:13: note: expected 'struct net *' but argument is of
type 'int *'
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
In file included from include/net/ip_tunnels.h:12:0,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/gre.h:5,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gso.c:34:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:19:2:
error: too few arguments to function 'inet_get_local_port_range'
  inet_get_local_port_range(low, high);
  ^
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:4:0,
                 from include/net/ip_tunnels.h:12,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip_tunnels.h:15,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/gre.h:5,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gso.c:34:
include/net/ip.h:223:13: note: declared here
 extern void inet_get_local_port_range(struct net *net, int *low, int
*high);
             ^
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-gre.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-netdev.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow_netlink.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/gso.o]
Error 1
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/vport-vxlan.o]
Error 1
make[1]: ***
[_module_/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux]
Error 2
make[1]: Leaving directory `/usr/src/kernels/3.10.0-229.14.1.el7.x86_64'
make: *** [default] Error 2
make: Leaving directory
`/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux'
error: Bad exit status from /var/tmp/rpm-tmp.91upLK (%build)


RPM build errors:
    Bad exit status from /var/tmp/rpm-tmp.91upLK (%build)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151010/f4ab7e98/attachment-0001.html>

From a.alnajjar1 at uq.edu.au  Sat Oct 10 17:05:46 2015
From: a.alnajjar1 at uq.edu.au (Anees Mohsin Hadi Al-Najjar)
Date: Sun, 11 Oct 2015 00:05:46 +0000
Subject: [ovs-discuss] Create OVS without mininet
Message-ID: <9092c8eaf3994816bb04cd4cfb1bb0e1@uq-exmbx1.soe.uq.edu.au>

Dear all,
How can I create an OVS switch (NOT OVS bridge on real machine, or OVS switch in  mininet) on my Linux machine and assign  eth0 interface to the created switch?

Thanks for helping

Anees
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151011/8f05d0cc/attachment.html>

From s.hesam.ghasemi at gmail.com  Sat Oct 10 17:51:10 2015
From: s.hesam.ghasemi at gmail.com (Seyyed Hesamoddin Ghasemi)
Date: Sun, 11 Oct 2015 04:21:10 +0330
Subject: [ovs-discuss] Problem with OVS QoS
Message-ID: <CAOsSsa546_NGLpVH+kEhCGQ+ucRPoSBcbRX0WAwCvca5-SJVhQ@mail.gmail.com>

Hi,
I used script below to add three queues with different QoS requirements.
First I en-queue packets to queue 0. In this case the max rate is 128Mbps
as I expected. but unfortunately when I en-queue packets in queue 1 or
queue 2, yet the max rate is 128Mbps! It seems that only queue 0 is working!
 Also when I want get queue stats for queue 0, the result is not zero. but
for queue 1 and queue 2, txBytes and rxBytes are equal
to 0x0000000000000000! What could be the problem?


s-vsctl set port s1-eth1 qos=@newqos -- --id=@newqos \
create qos type=linux-htb other-config:max-rate=1000000000 \
queues:0=@newqueue0  queues:1=@newqueue1 queues:2=@newqueue2 \
-- --id=@newqueue0 create queue other-config:min-rate=128000000 \
other-config:max-rate=128000 \
-- --id=@newqueue1 create queue other-config:min-rate=256000000 \
other-config:max-rate=256000 \
-- --id=@newqueue2 create queue other-config:min-rate=1024000000 \
other-config:max-rate=1024000


sudo ovs-vsctl set port s1-eth2 qos=@newqos -- --id=@newqos \
create qos type=linux-htb other-config:max-rate=1000000000 \
queues:0=@newqueue0  queues:1=@newqueue1 queues:2=@newqueue2 \
-- --id=@newqueue0 create queue other-config:min-rate=128000000 \
other-config:max-rate=128000 \
-- --id=@newqueue1 create queue other-config:min-rate=256000000 \
other-config:max-rate=256000 \
-- --id=@newqueue2 create queue other-config:min-rate=1024000000 \
other-config:max-rate=1024000



-- 
Seyyed Hesamoddin Ghasemi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151011/9e554e21/attachment.html>

From duanguyuan at 163.com  Sun Oct 11 04:04:58 2015
From: duanguyuan at 163.com (=?GBK?B?zfXTwg==?=)
Date: Sun, 11 Oct 2015 19:04:58 +0800 (CST)
Subject: [ovs-discuss] OVS - Change Interface Speed
In-Reply-To: <CA+P_w0wQi9v8Pv7M4coSkx3fe7ak48G9HYHjYiOYBQWnM+m-Cw@mail.gmail.com>
References: <CA+P_w0y+kys2qgsuLf0N2gbc6fy=MDcT4VMkcPj1FV7a-idqMA@mail.gmail.com>
 <CA+P_w0wQi9v8Pv7M4coSkx3fe7ak48G9HYHjYiOYBQWnM+m-Cw@mail.gmail.com>
Message-ID: <315bef59.7599.150569330a2.Coremail.duanguyuan@163.com>

I got your code, could you tell me how to use this?
I'm so sorry to say that but I really need your help.
I'd be most grateful for your help.


At 2015-10-03 20:24:06, "Bakshi Gulam" <gulam at gulam.in> wrote:

I managed to changed veth's speed by modifying the driver's code. Here it is https://github.com/bakshi-gulam/veth-change-speed
Might help someone!



On Tue, May 5, 2015 at 3:16 PM, Bakshi Gulam <gulam at gulam.in> wrote:

Hi All!


I'm trying to change interface speed of OVS but I couldn't. When I searched OVS mailing list archives, I found a answer that OVS doesn't offer a way to set speed rather it just advertises what the kernel reports.


Using ethtool, I got that my driver for virtual interfaces created by OVS is "veth". I tried changing the veth driver's speed using ethtool. But it says "operation not supported". Can anyone please tell me how to change the speed of veth driver so that OVS advertises new speed?


P.S.: This may be beyond the scope of OVS. But suggestions will be of great help.


--

/////////////////////////
// Bakshi Gulam        //
// http://www.gulam.in //
/////////////////////////



--

/////////////////////////
// Bakshi Gulam        //
// http://www.gulam.in //
/////////////////////////
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151011/b08a74f5/attachment.html>

From muralirdev at gmail.com  Sun Oct 11 22:46:31 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 12 Oct 2015 00:46:31 -0500
Subject: [ovs-discuss] [ovn] API related questions
Message-ID: <CAO=R8omxaETTM=787msMso_aA70sZQ-mdjEeuhv+Dw3FM2Caog@mail.gmail.com>

Please clarify on the following:

- There are external_ids associated with lport in ovn-nbctl. Is there any
requirement that this must be NULL right now? Does it matter if there is a
name (for instance port name in neutron).

- Is there any relationship between external_ids defined in lport in nb-db
and the Interface based external_ids such as iface_id ? Meaning can I have
a name defined in nb-db for neutron port-name that may not be in any way
related to iface_id or any name parameter in ovsdb port / Interface?

- Is there any requirement for mac_id to be same between iface in ovsdb and
lport? I see just second nibble differs fa vs fe in openstack based
deployment, not sure if that is a neutron/nova quirk or an ovn requirement.

- I don't see dedicated api for modifying logical flows? Do we need to use
ovn-sbctl set Pipeline <field>=<value>.... ?


Thanks
Murali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/0164c481/attachment.html>

From liu.liuyongqiang at huawei.com  Mon Oct 12 01:14:04 2015
From: liu.liuyongqiang at huawei.com (Liuyongqiang (A))
Date: Mon, 12 Oct 2015 08:14:04 +0000
Subject: [ovs-discuss] ovsdb-client connected error when i update the
 ovsdb-server ca_cert.pem file
Message-ID: <621FAA8B3DA4E14193D6933FB72489BA58265FCF@nkgeml511-mbx.china.huawei.com>

Does anybody know why ovsdb-server only use the openssl api SSL_CTX_add_client_CA to add certificate, but have no delete api to delete certificate.

I found that if I update ca_crt.pem  many times(SSL_CTX_add_client_CA add 649 certificates), the error of ovsdb-client connecting ovsdb-server will occur,  I found that there are 649 certificates in stack  list ctx->client_CA when the error occurred.

Are there any limits on stack list ctx->client_CA?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/ca1b45cd/attachment.html>

From ciara.loftus at intel.com  Mon Oct 12 03:49:31 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Mon, 12 Oct 2015 10:49:31 +0000
Subject: [ovs-discuss] ovs-vswitchd SEGV when using vhost-user feature
 with dpdk
In-Reply-To: <CAF2CpCn_nGxyDj-xU3QwJvajWu5-_1+0DFF1G+SbTMHw8Kti7A@mail.gmail.com>
References: <CAF2CpC=89Yu3Lub2tsAO7s2pWxS3nhXobi+8c2t_rQVNRY4oDg@mail.gmail.com>
 <74F120C019F4A64C9B78E802F6AD4CC24CBAFF76@IRSMSX106.ger.corp.intel.com>
 <CAF2CpCn_nGxyDj-xU3QwJvajWu5-_1+0DFF1G+SbTMHw8Kti7A@mail.gmail.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC24F7949A9@IRSMSX102.ger.corp.intel.com>

> 
> Increasing qemu to -m 4096, causes an immediate ovs-vswitchd SEGV
> 
> [Thread debugging using libthread_db enabled]
> Using host libthread_db library "/lib64/libthread_db.so.1".
> Core was generated by `/root/openvswitch/openvswitch-
> 2.4.0/vswitchd/ovs-vswitchd --dpdk -c 0xffff -n 4'.
> Program terminated with signal 11, Segmentation fault.
> #0  0x00007fca43ed6f2c in set_vring_addr () from /lib64/libdpdk.so
> (gdb) where
> #0  0x00007fca43ed6f2c in set_vring_addr () from /lib64/libdpdk.so
> #1  0x00007fca43f90d2e in vserver_message_handler () from
> /lib64/libdpdk.so
> #2  0x00007fca43f3ad7d in fdset_event_dispatch () from /lib64/libdpdk.so
> #3  0x00007fca43f91330 in rte_vhost_driver_session_start () from
> /lib64/libdpdk.so
> #4  0x000000000056efbf in start_vhost_loop (dummy=0x0) at lib/netdev-
> dpdk.c:1789
> #5  0x00000000004f60f3 in ovsthread_wrapper (aux_=0x25248a0) at lib/ovs-
> thread.c:340
> #6  0x00007fca43a1edf5 in start_thread (arg=0x7fca3c13d700) at
> pthread_create.c:308
> #7  0x00007fca432421ad in clone () at
> ../sysdeps/unix/sysv/linux/x86_64/clone.S:113
> (gdb)
> 
> 

I can reproduce a segfault when using QEMU v2.4.0+ like you mentioned you are. It looks like something has gone in between v2.3.0 and v2.4.0 in QEMU that is causing this issue.
Can you please try your test with the QEMU version we recommend to use in INSTALL.DPDK which is v2.2.0.

Thanks,
Ciara

> 
> 
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00021|dpdk|INFO|Port 0: a0:36:9f:5a:cb:1c
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00007|dpif_netdev(pmd16)|INFO|Core 0 processing port 'vhost-user1'
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00008|dpif_netdev(pmd16)|INFO|Core 0 processing port 'dpdk0'
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00009|dpif_netdev(pmd16)|INFO|Core 0 processing port 'dpdk1'
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00010|dpif_netdev(pmd16)|INFO|Core 0 processing port 'vhost-user2'
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00022|bridge|INFO|bridge br0: added interface dpdk0 on port 2
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00023|bridge|INFO|bridge br0: using datapath ID 0000a0369f5acb1c
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00024|connmgr|INFO|br0: added service controller
> "punix:/usr/local/var/run/openvswitch/br0.mgmt"
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00025|dpif_netdev|INFO|Created 1 pmd threads on numa node 0
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00026|timeval|WARN|Unreasonably long 2481ms poll interval (1726ms
> user, 2ms system)
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00027|timeval|WARN|faults: 2032 minor, 0 major
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00028|timeval|WARN|disk: 0 reads, 8 writes
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00029|timeval|WARN|context switches: 143 voluntary, 426 involuntary
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00030|coverage|INFO|Event coverage, avg rate over last: 5 seconds,
> last minute, last hour,  hash=66963b7f:
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00031|coverage|INFO|bridge_reconfigure         0.0/sec     0.000/sec        0.
> 0000/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00032|coverage|INFO|ofproto_flush              0.0/sec     0.000/sec        0.00
> 00/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00033|coverage|INFO|ofproto_update_port        0.0/sec     0.000/sec
> 0.0000/sec   total: 5
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00034|coverage|INFO|rev_flow_table             0.0/sec     0.000/sec        0.00
> 00/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00035|coverage|INFO|cmap_expand                0.0/sec     0.000/sec        0.0
> 000/sec   total: 3
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00036|coverage|INFO|cmap_shrink                0.0/sec     0.000/sec        0.000
> 0/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00037|coverage|INFO|dpif_port_add              0.0/sec     0.000/sec        0.00
> 00/sec   total: 5
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00038|coverage|INFO|dpif_flow_flush            0.0/sec     0.000/sec        0.00
> 00/sec   total: 2
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00039|coverage|INFO|dpif_flow_get              0.0/sec     0.000/sec        0.00
> 00/sec   total: 5
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00040|coverage|INFO|dpif_flow_put              0.0/sec     0.000/sec        0.00
> 00/sec   total: 5
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00041|coverage|INFO|dpif_flow_del              0.0/sec     0.000/sec        0.00
> 00/sec   total: 5
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00042|coverage|INFO|dpif_execute               0.0/sec     0.000/sec        0.00
> 00/sec   total: 2
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00043|coverage|INFO|flow_extract               0.0/sec     0.000/sec        0.000
> 0/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00044|coverage|INFO|hmap_pathological          0.0/sec     0.000/sec        0.
> 0000/sec   total: 2
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00001|dpif_netdev(pmd24)|INFO|Core 1 processing port 'vhost-user1'
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00045|coverage|INFO|hmap_expand                0.0/sec     0.000/sec        0.0
> 000/sec   total: 488
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00046|coverage|INFO|netdev_get_stats           0.0/sec     0.000/sec        0.
> 0000/sec   total: 10
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00002|dpif_netdev(pmd24)|INFO|Core 1 processing port 'dpdk0'
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00047|coverage|INFO|txn_unchanged              0.0/sec     0.000/sec        0.0
> 000/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00003|dpif_netdev(pmd24)|INFO|Core 1 processing port 'dpdk1'
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00048|coverage|INFO|txn_incomplete             0.0/sec     0.000/sec        0.0
> 000/sec   total: 2
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00004|dpif_netdev(pmd24)|INFO|Core 1 processing port 'vhost-user2'
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00049|coverage|INFO|poll_create_node           0.0/sec     0.000/sec        0.
> 0000/sec   total: 229
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00050|coverage|INFO|poll_zero_timeout          0.0/sec     0.000/sec        0.
> 0000/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00051|coverage|INFO|pstream_open               0.0/sec     0.000/sec        0.0
> 000/sec   total: 3
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00052|coverage|INFO|stream_open                0.0/sec     0.000/sec        0.00
> 00/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00053|coverage|INFO|util_xalloc                0.0/sec     0.000/sec        0.0000/
> sec   total: 13886
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00054|coverage|INFO|netdev_set_policing        0.0/sec     0.000/sec        0
> .0000/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00055|coverage|INFO|netdev_get_ifindex         0.0/sec     0.000/sec        0
> .0000/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00056|coverage|INFO|netdev_get_hwaddr          0.0/sec     0.000/sec
> 0.0000/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00057|coverage|INFO|netdev_set_hwaddr          0.0/sec     0.000/sec
> 0.0000/sec   total: 1
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00058|coverage|INFO|netdev_get_ethtool         0.0/sec     0.000/sec
> 0.0000/sec   total: 2
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00059|coverage|INFO|netlink_received           0.0/sec     0.000/sec        0.0
> 000/sec   total: 23
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00060|coverage|INFO|netlink_recv_jumbo         0.0/sec     0.000/sec        0
> .0000/sec   total: 2
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00061|coverage|INFO|netlink_sent               0.0/sec     0.000/sec        0.000
> 0/sec   total: 12
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00062|coverage|INFO|nln_changed                0.0/sec     0.000/sec        0.00
> 00/sec   total: 5
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00063|coverage|INFO|67 events never hit
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00064|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.4.0
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00065|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00066|memory|INFO|8252 kB peak resident set size after 10.5 seconds
> Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00067|memory|INFO|handlers:8 ports:5 revalidators:4 rules:5
> Oct 09 15:53:51 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00068|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> Oct 09 15:53:51 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00069|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> Oct 09 15:53:52 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00070|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> Oct 09 15:53:52 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00071|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00072|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00073|poll_loop|INFO|wakeup due to 0-ms timeout at
> ofproto/ofproto-dpif.c:1571 (57% CPU usage)
> Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00074|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> pipe:[12835268]) at lib/ovs-rcu.c:206 (57% CPU usage)
> Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00075|poll_loop|INFO|wakeup due to [POLLIN] on fd 79 (<-
> >/usr/local/var/run/openvswitch/db.sock) at l...PU usage)
> Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> ovs|00076|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> new virtio connection is 110
> Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> new device, handle is 0
> Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_OWNER
> Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_GET_FEATURES
> Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_VRING_CALL
> Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> vring call idx:0 file:111
> Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_VRING_CALL
> Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> vring call idx:1 file:112
> Oct 09 15:54:29 localhost.localdomain kvm[22204]: 1 guest now active
> Oct 09 15:54:39 localhost.localdomain kernel: kvm [22199]: vcpu0 disabled
> perfctr wrmsr: 0xc1 data 0xffff
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_VRING_CALL
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> vring call idx:0 file:113
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_VRING_CALL
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> vring call idx:1 file:111
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_FEATURES
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_MEM_TABLE
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> mapped region 0 fd:112 to 0xffffffffffffffff sz:0xffffab4a9f800000
> off:0xffffab4a5f800000
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> mmap qemu guest failed.
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_VRING_NUM
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_VRING_BASE
> Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]: VHOST_CONFIG:
> read message VHOST_USER_SET_VRING_ADDR
> Oct 09 15:54:40 localhost.localdomain kernel: vhost_thread13[22047]:
> segfault at 18 ip 00007fbb9ffc5f2c sp 00007fbb9822b670 error 4 in
> libdpdk.so[7fbb9ff26000+1b3000]
> Oct 09 15:54:41 localhost.localdomain abrt-hook-ccpp[22244]: Saved core
> dump of pid 22045 (/root/openvswitch/openvswitch-2.4.0/vswitchd/ovs-
> vswitchd) to /var/spool/...08 bytes)
> 
> On Fri, Oct 9, 2015 at 12:07 AM, Loftus, Ciara <ciara.loftus at intel.com> wrote:
> >
> > I have ran into a ovs-vswitchd SEGV while trying to use the vhost-user
> > feature with the latest dpdk. I have attempted to provide as much detail as
> I
> > can.
> >
> > versions compiled from source on CentOS 7.1 x86_64:
> >  - openvswitch 2.4.0 - http://openvswitch.org/releases/openvswitch-
> > 2.4.0.tar.gz
> >  - dpdk 2.1.0 - http://dpdk.org/browse/dpdk/snapshot/dpdk-2.1.0.tar.gz
> >  - qemu - 2.4.0.1 - http://wiki.qemu-project.org/download/qemu-
> > 2.4.0.1.tar.bz2
> >
> >
> > Steps to reproduce:
> >
> > - Build and Install following these instructions
> > http://wiki.qemu.org/Features/vhost-user-ovs-dpdk
> > - setup details:
> >
> > hugepage config:
> > GRUB_CMDLINE_LINUX="rd.lvm.lv=centos/root rd.lvm.lv=centos/swap
> > crashkernel=auto rhgb quiet iommu=pt intel_iommu=on
> > default_hugepagesz=1G hugepagesz=1G hugepages=8
> > isolcpus=1,2,3,4,5,12,13,14,15,16,17,7,8,9,10,11,18,19,20,21,22,23
> > transparent_hugepage=never"
> >
> > # export DPDK_DIR=/root/dpdk/dpdk-2.1.0
> > # export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
> > # export DB_SOCK=/usr/local/var/run/openvswitch/db.sock
> >
> >
> > # modprobe openvswitch
> > # modprobe uio
> > # insmod /root/dpdk/dpdk-2.1.0/x86_64-native-linuxapp-
> > gcc/kmod/igb_uio.ko
> > # insmod /root/dpdk/dpdk-
> > 2.1.0/lib/librte_vhost/eventfd_link/eventfd_link.ko
> >
> > # /root/dpdk/dpdk-2.1.0/tools/dpdk_nic_bind.py --bind=igb_uio ens1f0
> > # /root/dpdk/dpdk-2.1.0/tools/dpdk_nic_bind.py --bind=igb_uio ens1f1
> >
> > # /root/openvswitch/openvswitch-2.4.0/ovsdb/ovsdb-server --
> > remote=punix:/usr/local/var/run/openvswitch/db.sock     --
> > remote=db:Open_vSwitch,Open_vSwitch,manager_options     --pidfile --
> > detach
> >
> > # rm -f /usr/local/var/run/openvswitch/vhost-user*
> >
> > # /root/openvswitch/openvswitch-2.4.0/vswitchd/ovs-vswitchd --dpdk -c
> > 0xffff -n 4 --socket-mem 1024 -- unix:$DB_SOCK --pidfile --detach --log-
> > file=/var/log/openvswitch/ovs-vswitchd.log
> >
> > # lspci | grep Ethernet
> > 01:00.0 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit
> > X540-AT2 (rev 01)
> > 01:00.1 Ethernet controller: Intel Corporation Ethernet Controller 10-Gigabit
> > X540-AT2 (rev 01)
> >
> > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-br br0 -- set
> > bridge br0 datapath_type=netdev
> > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> > dpdk0 -- set Interface dpdk0 type=dpdk
> > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> > dpdk1 -- set Interface dpdk1 type=dpdk
> > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> > vhost-user2 -- set Interface vhost-user2 type=dpdkvhostuser
> > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> > vhost-user1 -- set Interface vhost-user1 type=dpdkvhostuser
> >
> > - Start the first VM like this:
> > ./qemu-system-x86_64 -enable-kvm -m 1024 -smp 2 \
> 
> My first suggestion would be to try supplying your VM with more memory.
> ie. instead of "-m 1024", try "-m 4096"
> 
> Thanks,
> Ciara
> 
> >  -display sdl \
> >  -sdl \
> >  -chardev socket,id=char0,path=/usr/local/var/run/openvswitch/vhost-
> user1
> > \
> >  -netdev type=vhost-user,id=mynet1,chardev=char0,vhostforce  \
> >  -device virtio-net-pci,netdev=mynet1,mac=52:54:00:02:d9:01 \
> >  -object memory-backend-file,id=mem,size=1024M,mem-
> > path=/dev/hugepages,share=on \
> >  -numa node,memdev=mem -mem-prealloc \
> >  -net user,hostfwd=tcp::10021-:22 \
> >  -net nic  \
> >  /var/lib/libvirt/images/centos-vm1.qcow2  &
> >
> > - From another machine send iperf traffic to this VM.
> >   iperf -s (in the VM)
> >   iperf -c <ipaddr> -t 60 -P 12 (from another machine)
> >
> > - After about a few seconds, iperf stalls. network connectivity breaks. Can't
> > ping the VM anymore.
> > - Saw these in the ovs-vswitchd log files.
> >
> > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > Failed to allocate memory for mbuf.
> > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > Failed to allocate memory for mbuf.
> > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > Failed to allocate memory for mbuf.
> > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > Failed to allocate memory for mbuf.
> > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > Failed to allocate memory for mbuf.
> >
> > - shutdown iperf ... then shutdown the VM.
> > - at this point ovs-vswitchd crashes with the following SEGV.
> >
> > [root at localhost vswitchd]# gdb ./ovs-vswitchd /var/spool/abrt/ccpp-2015-
> > 09-29-18\:47\:37-22012/coredump
> > GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-64.el7
> > Copyright (C) 2013 Free Software Foundation, Inc.
> > License GPLv3+: GNU GPL version 3 or later
> > <http://gnu.org/licenses/gpl.html>
> > This is free software: you are free to change and redistribute it.
> > There is NO WARRANTY, to the extent permitted by law.  Type "show
> > copying"
> > and "show warranty" for details.
> > This GDB was configured as "x86_64-redhat-linux-gnu".
> > For bug reporting instructions, please see:
> > <http://www.gnu.org/software/gdb/bugs/>...
> > Reading symbols from /root/openvswitch/openvswitch-
> 2.4.0/vswitchd/ovs-
> > vswitchd...done.
> > [New LWP 22051]
> > [New LWP 22012]
> > [New LWP 22013]
> > [New LWP 22015]
> > [New LWP 22039]
> > [New LWP 22040]
> > [New LWP 22041]
> > [New LWP 22042]
> > [New LWP 22043]
> > [New LWP 22044]
> > [New LWP 22045]
> > [New LWP 22046]
> > [New LWP 22047]
> > [New LWP 22048]
> > [New LWP 22049]
> > [New LWP 22050]
> > [New LWP 22014]
> > [Thread debugging using libthread_db enabled]
> > Using host libthread_db library "/lib64/libthread_db.so.1".
> > Core was generated by `/root/openvswitch/openvswitch-
> > 2.4.0/vswitchd/ovs-vswitchd --dpdk -c 0xffff -n 4'.
> > Program terminated with signal 11, Segmentation fault.
> > #0  0x00007eff4d71df1f in rte_vhost_dequeue_burst () from
> > /lib64/libdpdk.so
> > Missing separate debuginfos, use: debuginfo-install glibc-2.17-
> 78.el7.x86_64
> > (gdb) where
> > #0  0x00007eff4d71df1f in rte_vhost_dequeue_burst () from
> > /lib64/libdpdk.so
> > #1  0x000000000056d103 in netdev_dpdk_vhost_rxq_recv
> > (rxq_=0x7efe5a537600, packets=0x7eff4c9a2930, c=0x7eff4c9a292c)
> >     at lib/netdev-dpdk.c:952
> > #2  0x00000000004a2dec in netdev_rxq_recv (rx=0x7efe5a537600,
> > buffers=0x7eff4c9a2930, cnt=0x7eff4c9a292c)
> >     at lib/netdev.c:652
> > #3  0x0000000000478f33 in dp_netdev_process_rxq_port (pmd=0x231c310,
> > port=0x2166990, rxq=0x7efe5a537600)
> >     at lib/dpif-netdev.c:2520
> > #4  0x0000000000479648 in pmd_thread_main (f_=0x231c310) at lib/dpif-
> > netdev.c:2680
> > #5  0x00000000004f60f3 in ovsthread_wrapper (aux_=0x231c150) at lib/ovs-
> > thread.c:340
> > #6  0x00007eff4d276df5 in start_thread () from /lib64/libpthread.so.0
> > #7  0x00007eff4ca9a1ad in clone () from /lib64/libc.so.6


From jimsonchacko at gmail.com  Mon Oct 12 05:17:11 2015
From: jimsonchacko at gmail.com (jimson chacko)
Date: Mon, 12 Oct 2015 17:47:11 +0530
Subject: [ovs-discuss] Early addition of flows in the kernel.
Message-ID: <CAF4aououi8-KSoe5Lr__-F3oHtfks+esTu2EjwsWu4EZTNSN-A@mail.gmail.com>

Hi,

As per my understanding, OVS inserts the flow in the kernel when an
exception packet is handled by the vswitchd (ofcourse when matching flow is
present in the vswitchd).

Is it possible to push the flow into the kernel as soon as the flow gets
added to vswitchd ? This enables in avoiding the exception mechanism and
hence faster processing.

Can you briefly let me know why the design was kept so ?

Regards
Jimson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/e61849df/attachment.html>

From blp at nicira.com  Mon Oct 12 08:23:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 08:23:10 -0700
Subject: [ovs-discuss] [ovn] API related questions
In-Reply-To: <CAO=R8omxaETTM=787msMso_aA70sZQ-mdjEeuhv+Dw3FM2Caog@mail.gmail.com>
References: <CAO=R8omxaETTM=787msMso_aA70sZQ-mdjEeuhv+Dw3FM2Caog@mail.gmail.com>
Message-ID: <20151012152310.GB1327@nicira.com>

On Mon, Oct 12, 2015 at 12:46:31AM -0500, Murali R wrote:
> - There are external_ids associated with lport in ovn-nbctl. Is there any
> requirement that this must be NULL right now? Does it matter if there is a
> name (for instance port name in neutron).

external-ids is for use by the CMS, which can populate it or leave
unpopulated.

> - Is there any relationship between external_ids defined in lport in nb-db
> and the Interface based external_ids such as iface_id ? 

No.

> Meaning can I have a name defined in nb-db for neutron port-name that
> may not be in any way related to iface_id or any name parameter in
> ovsdb port / Interface?

Yes.

> - Is there any requirement for mac_id to be same between iface in ovsdb and
> lport? I see just second nibble differs fa vs fe in openstack based
> deployment, not sure if that is a neutron/nova quirk or an ovn requirement.

I would ordinarily expect them to be the same.

> - I don't see dedicated api for modifying logical flows? Do we need to use
> ovn-sbctl set Pipeline <field>=<value>.... ?

You shouldn't modify logical flows!  ovn-northd populates them.

From abraam.athanassios at gmail.com  Sun Oct 11 19:07:41 2015
From: abraam.athanassios at gmail.com (Abraam Athanassios)
Date: Mon, 12 Oct 2015 13:07:41 +1100
Subject: [ovs-discuss] Kernal module problems openvswitch-2.4.0
Message-ID: <CAJ8cn6PHksGk_MT3qDyYD3PNo5YwTo21jmGVw1Ap_jQPqmrgqQ@mail.gmail.com>

Hi,

I have used the new openvswitch-2.4.0 to install it on raspberry pi 2 on
operating system Ubuntu mate kernal 3.18.
I am seeking a solution to the problem i am facing.
I did download the openvswitch and when I do execute the

% sudo make
% sudo make install

i do not receive any error but when i do execute the

% insmode datapath/linux/openvswitch.ko

i do get that it is failed as the file openvswitch.ko does not exist

I have been searching for any solution but i did not find any. I hope you
can help me with this problem and direct me to the solution

Kind regrades
Abraam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/de449bfa/attachment.html>

From haristanvir at hotmail.com  Mon Oct 12 00:57:01 2015
From: haristanvir at hotmail.com (haris tanvir)
Date: Mon, 12 Oct 2015 12:57:01 +0500
Subject: [ovs-discuss] ovs 2.4 dpdk ports
Message-ID: <SNT151-W81158F2399AA78BA5EE8EB8310@phx.gbl>

Can someone explain the difference between(and elaborate) the following types of ports in ovs 2.4
1. dpdk2. dpdkr3. dpdkvhostuser 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/10f08be4/attachment.html>

From jpettit at nicira.com  Mon Oct 12 09:04:38 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 12 Oct 2015 09:04:38 -0700
Subject: [ovs-discuss] Kernal module problems openvswitch-2.4.0
In-Reply-To: <CAJ8cn6PHksGk_MT3qDyYD3PNo5YwTo21jmGVw1Ap_jQPqmrgqQ@mail.gmail.com>
References: <CAJ8cn6PHksGk_MT3qDyYD3PNo5YwTo21jmGVw1Ap_jQPqmrgqQ@mail.gmail.com>
Message-ID: <9C2F1334-0059-41AD-A89F-28C46C36068D@nicira.com>


> On Oct 11, 2015, at 7:07 PM, Abraam Athanassios <abraam.athanassios at gmail.com> wrote:
> 
> Hi,
> 
> I have used the new openvswitch-2.4.0 to install it on raspberry pi 2 on operating system Ubuntu mate kernal 3.18. 
> I am seeking a solution to the problem i am facing.
> I did download the openvswitch and when I do execute the 
> 
> % sudo make
> % sudo make install
> 
> i do not receive any error but when i do execute the 
> 
> % insmode datapath/linux/openvswitch.ko 
> 
> i do get that it is failed as the file openvswitch.ko does not exist

Does the file exist?  How did you run "configure"?  You need to tell it to build the kernel module.  Make sure you're following all the steps in "INSTALL.md".

--Justin



From muralirdev at gmail.com  Mon Oct 12 09:05:50 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 12 Oct 2015 11:05:50 -0500
Subject: [ovs-discuss] [ovn] Port bindings to network
Message-ID: <CAO=R8omOfuZA6ZfdXS8-pVjDW8aAs8M+2z7FfwPjHftmVTjjgw@mail.gmail.com>

In neutron ovs agent, a vlan map was used to associate a network with local
vlan id and an associated tunnel id across hypervisors. I was thinking we
have similar mapping in ovn controller, except I don't find one. So trying
to understand. In a previous email, someone mentioned the south bound api
shows host to interface mapping. I was looking there for such association,
but there is none.

List of sb tables.
  <table name="Chassis" title="Physical Network Hypervisor and Gateway
Information">
  <table name="Encap" title="Encapsulation Types">
  <table name="Logical_Flow" title="Logical Network Flows">
  <table name="Multicast_Group" title="Logical Port Multicast Groups">
  <table name="Datapath_Binding" title="Physical-Logical Datapath Bindings">
  <table name="Port_Binding" title="Physical-Logical Port Bindings">

muralir at mmnc-1:~$ ovn-sbctl list Datapath_Binding
_uuid               : be86f1c8-e48f-476f-9dcd-9047947861e0
external_ids        :
{logical-switch="26213aab-087b-4dcd-891a-27c8a5619532"}
tunnel_key          : 1

_uuid               : d28cd285-2529-4f5b-aa77-573ebd93f46d
external_ids        :
{logical-switch="929b3fa8-506c-4a3a-8a95-c7017040f71a"}
tunnel_key          : 2
muralir at mmnc-1:~$
muralir at mmnc-1:~$
muralir at mmnc-1:~$ ovn-sbctl list Chassis
_uuid               : 04b53423-ff87-4e92-a499-0781b40c1088
encaps              : [7d8d6b66-c6de-4853-8345-63270a8343dc]
name                : "5f45d690-18d5-48f6-b700-58e4e88e3c9d"
vtep_logical_switches: []


Port_Binding

_uuid               : f72ce72c-b402-4405-ab7d-a47626c73be4
chassis             : 04b53423-ff87-4e92-a499-0781b40c1088
datapath            : be86f1c8-e48f-476f-9dcd-9047947861e0
logical_port        : "405571f2-5a5b-49b9-919a-52092b9dda3e"
mac                 : ["fa:16:3e:34:82:dd"]
options             : {}
parent_port         : []
tag                 : []
tunnel_key          : 5
type                : ""

_uuid               : fa767216-f506-4cd8-9945-ad48dfe671fd
chassis             : 04b53423-ff87-4e92-a499-0781b40c1088
datapath            : be86f1c8-e48f-476f-9dcd-9047947861e0
logical_port        : "31b72fb5-7467-4401-827c-8031785c5150"
mac                 : ["fa:16:3e:da:eb:0a"]
options             : {}
parent_port         : []
tag                 : []
tunnel_key          : 4
type                : ""

_uuid               : 390b19bf-625a-4535-af4b-ff671a9bc4be
chassis             : 04b53423-ff87-4e92-a499-0781b40c1088
datapath            : be86f1c8-e48f-476f-9dcd-9047947861e0
logical_port        : "ca437555-b282-4f3f-835b-afda00d63f4c"
mac                 : ["fa:16:3e:e8:18:09"]
options             : {}
parent_port         : []
tag                 : []
tunnel_key          : 6
type                : ""


In the tables above, only tables that has mappings to data path is
port_binding. The "tags" are empty in a functional system. The "tag" field
is supposed to have vlan ids per specs. The first 2 are neutron created
during nova boot. The last one is mine. The first 2 works and mine does not
connect to network.

I created a port for docker container exactly identical to what neutron
port creates, I see the logical flows created exactly identical to that of
neutron ports but I cannot ping the nodes on the network. In OVS, the flow
entries are identical to neutron created ones. The OVS external-ids set
right exactly as the corresponding neutron ports - mac address,
attached-mac, active and iface-id exactly to my values. I can ping between
neutron VMs but not from the docker pid-namespace which I created. So I
realized it could be the vlan-id is missing for traffic from container
which is why. But unable to trace where the vlan ids are saved in runtime
tables. If I knew, I can do necessary mapping in a similar way. Any
pointers to show the vlan id mapping for networks will be really helpful.

Thanks
Murali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/468efa68/attachment-0001.html>

From kevin.traynor at intel.com  Mon Oct 12 09:19:36 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Mon, 12 Oct 2015 16:19:36 +0000
Subject: [ovs-discuss] ovs 2.4 dpdk ports
In-Reply-To: <SNT151-W81158F2399AA78BA5EE8EB8310@phx.gbl>
References: <SNT151-W81158F2399AA78BA5EE8EB8310@phx.gbl>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74528C85C@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of haris
> tanvir
> Sent: Monday, October 12, 2015 8:57 AM
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] ovs 2.4 dpdk ports
> 
> Can someone explain the difference between(and elaborate) the following types
> of ports in ovs 2.4
> 
> 1. dpdk
physical NIC ports

> 2. dpdkr
dpdk ring ports, they can be used to read/write memory shared through ivshmem

> 3. dpdkvhostuser
qemu vhostuser ports

Have a look through the dpdk documentation http://www.dpdk.org/doc
or the INSTALL.DPDK.md


From blp at nicira.com  Mon Oct 12 09:20:08 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 09:20:08 -0700
Subject: [ovs-discuss] [ovn] API related questions
In-Reply-To: <CAO=R8onBKoJmmW4v050Vck1UeOJCLf=HMni3W9Xj8RYiECk-Dw@mail.gmail.com>
References: <CAO=R8omxaETTM=787msMso_aA70sZQ-mdjEeuhv+Dw3FM2Caog@mail.gmail.com>
 <20151012152310.GB1327@nicira.com>
 <CAO=R8onBKoJmmW4v050Vck1UeOJCLf=HMni3W9Xj8RYiECk-Dw@mail.gmail.com>
Message-ID: <20151012162008.GA2651@nicira.com>

Please don't drop the mailing list.

On Mon, Oct 12, 2015 at 10:39:21AM -0500, Murali R wrote:
> > > - I don't see dedicated api for modifying logical flows? Do we need to
> > use
> > > ovn-sbctl set Pipeline <field>=<value>.... ?
> >
> > You shouldn't modify logical flows!  ovn-northd populates them.
> 
> My understanding from docs is there would be an api to manage the logical
> flows. Either a NB api or some other means. I see no api in nbctl. 

Can you say where the docs say this or imply it?

> We need to be able to set some "match" and "actions" for customizing
> our flows at logical level which will be translated to actual flows by
> OVN controller.  Is my understanding wrong? What flexibilities do the
> users of OVN get to customize the flows?

ovn-northd produces the logical flows.  They are not for user
modification.

> (Ref: http://openvswitch.org/pipermail/dev/2015-January/050380.html
> "Matching Expression" )

That's a long message, can you be more specific?

From blp at nicira.com  Mon Oct 12 09:30:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 09:30:04 -0700
Subject: [ovs-discuss] ovsdb-client connected error when i update the
 ovsdb-server ca_cert.pem file
In-Reply-To: <621FAA8B3DA4E14193D6933FB72489BA58265FCF@nkgeml511-mbx.china.huawei.com>
References: <621FAA8B3DA4E14193D6933FB72489BA58265FCF@nkgeml511-mbx.china.huawei.com>
Message-ID: <20151012163004.GB2651@nicira.com>

Feel free to submit fixes for these problems.

From er.manpreet25 at gmail.com  Mon Oct 12 09:35:05 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Mon, 12 Oct 2015 22:05:05 +0530
Subject: [ovs-discuss] crash in ovs service with invalid group type
Message-ID: <CALD=K8tHS4JSwgCwpRzSWyjQt8CT6apmnyfnpE_gWzR-xBiBDA@mail.gmail.com>

Hello Team,

I am working on OVS-2.3.2. I got a strange behavior while sending group_mod
message for add group with invalid group type with RYU controller.

This operation should return error OFPGMFC_BAD_TYPE. But vswitchd service
got crashed and connection get lost with the controller.

Have anyone faced this issue?

Regards,
Manpreet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/3bd47c45/attachment.html>

From blp at nicira.com  Mon Oct 12 09:38:21 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 09:38:21 -0700
Subject: [ovs-discuss] set dpdk packet refcnt when flow output to group.
In-Reply-To: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>
References: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>
Message-ID: <20151012163821.GC2651@nicira.com>

On Wed, Oct 07, 2015 at 05:36:18PM -0500, David Evans wrote:
> While using netdev-dpdk - When i add a rule for which the action is to
> send to a group (type=all) containing (x) output buckets (ports) how
> can i increment the dp_packet->pkt_mbuf’s refcnt to (x) so that the
> packet is not deleted before it has transmitted all ports(buckets) in
> the group.
> 
> Perhaps in ofproto-dpif-xlate.c function xlate_all_group find the
> packet and apply the ctx->xin->packet->mbuf->refcnt ?  Will that work
> for all packets for a ctx?

I don't understand what relationship you expect here.  A group has no
direct relationship to a packet.  Translation produces a flat list of
simple actions that don't refer back to the group.

From davidjoshuaevans at gmail.com  Mon Oct 12 09:56:03 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Mon, 12 Oct 2015 11:56:03 -0500
Subject: [ovs-discuss] set dpdk packet refcnt when flow output to group.
In-Reply-To: <20151012163821.GC2651@nicira.com>
References: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>
 <20151012163821.GC2651@nicira.com>
Message-ID: <10E167BF-DA3E-4AAB-8B70-38123A23302F@gmail.com>

Hi Ben,

When i use the OFPGT11_ALL group action, the packets for a  flow will be sent out all buckets in a group. (in my case all the buckets are ports to transmit out)

I added a group_bucket_count to the context 
and 
in xlate_all_group fn the following.

    group_dpif_get_buckets(group, &buckets);
+    if(ctx->group_bucket_count == 0){
+    	LIST_FOR_EACH (bucket, list_node, buckets) {
+    		ctx->group_bucket_count++;
+        }
+    }
+    if(ctx->xin->packet)
+    	if(ctx->xin->packet->source == DPBUF_DPDK)
+    		rte_pktmbuf_refcnt_update(&ctx->xin->packet->mbuf,ctx->group_bucket_count);
	LIST_FOR_EACH (bucket, list_node, buckets) {

this stops the transmit pmd’s attempting to free the packet until all the buckets( ports ) have transmitted it.
My switch also does reassembly on rx - this refcnt is necessary for handling multi-segment dpdk buffers too. 
I also changed the segment free to rte_pktmbuf_free in netdev-dpdk.c for this purpose.
I’m expecting it will also be important for tso or the possibility of using rte_ipv4_fragment_packet on an outgoing port.

i have between 6 and 12 PMD’s depending on the number of dpdk ports running at any time, and if i use OFPGT11_ALL with many output buckets(ports) buffers will disappear from under some pmd’s and cause segfaults etc..

Cheers,

Dave.

> On Oct 12, 2015, at 11:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> On Wed, Oct 07, 2015 at 05:36:18PM -0500, David Evans wrote:
>> While using netdev-dpdk - When i add a rule for which the action is to
>> send to a group (type=all) containing (x) output buckets (ports) how
>> can i increment the dp_packet->pkt_mbuf’s refcnt to (x) so that the
>> packet is not deleted before it has transmitted all ports(buckets) in
>> the group.
>> 
>> Perhaps in ofproto-dpif-xlate.c function xlate_all_group find the
>> packet and apply the ctx->xin->packet->mbuf->refcnt ?  Will that work
>> for all packets for a ctx?
> 
> I don't understand what relationship you expect here.  A group has no
> direct relationship to a packet.  Translation produces a flat list of
> simple actions that don't refer back to the group.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/8064365b/attachment-0001.html>

From muralirdev at gmail.com  Mon Oct 12 09:56:47 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 12 Oct 2015 11:56:47 -0500
Subject: [ovs-discuss] [ovn] API related questions
In-Reply-To: <20151012162008.GA2651@nicira.com>
References: <CAO=R8omxaETTM=787msMso_aA70sZQ-mdjEeuhv+Dw3FM2Caog@mail.gmail.com>
 <20151012152310.GB1327@nicira.com>
 <CAO=R8onBKoJmmW4v050Vck1UeOJCLf=HMni3W9Xj8RYiECk-Dw@mail.gmail.com>
 <20151012162008.GA2651@nicira.com>
Message-ID: <CAO=R8o=jgsMV5pzrw4imXmUKponnq=CXQgJpN4+c3js5obSULg@mail.gmail.com>

>From the link in the previous email
http://openvswitch.org/pipermail/dev/2015-January/050380.html

"Matching expressions provide a superset of OpenFlow matching capabilities
across packets in a logical datapath. Expressions use a syntax similar to
Boolean expressions in a programming language."
​
I was able to use customized flows in ovs-agent to accomplish flow
modifications using ovs-ofctl add-flow. I was expecting we could modify for
logical flows using the ovn-northd but with logical ports. If the flow mods
can only be done from within northd, then I need to start looking into that
code. It is definitely better to have some api be exposed to define the
match and actions and customize flows using lports.

When I say user, I mean a CMS.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/7e1dd772/attachment.html>

From blp at nicira.com  Mon Oct 12 10:11:22 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 10:11:22 -0700
Subject: [ovs-discuss] crash in service with invalid group type
In-Reply-To: <CALD=K8vGLR_N-e4wCi5uL7uFgSGT86c7oG=Cxpp1epBZj-gppw@mail.gmail.com>
References: <CALD=K8vGLR_N-e4wCi5uL7uFgSGT86c7oG=Cxpp1epBZj-gppw@mail.gmail.com>
Message-ID: <20151012171122.GD2651@nicira.com>

On Tue, Oct 06, 2015 at 11:46:52PM +0530, Manpreet Singh wrote:
> I am working on OVS-2.3.2. I got a strange behavior while sending group_mod
> message for add group with invalid group type with RYU controller.
> 
> ofproto_v1_3_parser.OFPGroupMod(datapath, ofproto_v1_3 .OFPGC_ADD, 7,
> group_id, buckets)
> 
> This operation should return error OFPGMFC_BAD_TYPE. But vswitchd service
> got crashed and connection get lost with the controller.

Thank you for the bug report.

I posted a fix to the ovs-dev mailing list:
        http://openvswitch.org/pipermail/dev/2015-October/061109.html

Would you mind testing it?

Thanks,

Ben.

From muralirdev at gmail.com  Mon Oct 12 10:14:58 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 12 Oct 2015 12:14:58 -0500
Subject: [ovs-discuss] [ovn] Port bindings to network
In-Reply-To: <CAO=R8omOfuZA6ZfdXS8-pVjDW8aAs8M+2z7FfwPjHftmVTjjgw@mail.gmail.com>
References: <CAO=R8omOfuZA6ZfdXS8-pVjDW8aAs8M+2z7FfwPjHftmVTjjgw@mail.gmail.com>
Message-ID: <CAO=R8onv3h-F2NEoDpALeJqLuZetXYV+AsUOrWLuBpOibPXFdg@mail.gmail.com>

In other words, where is local vlan id per network stored in southbound db?
Apparently ovn-sb.xml says:

     <p>
      When <ref column="type"/> is set to <code>localnet</code>, this can be
      set to indicate that the port represents a connection to a specific
      VLAN on a locally accessible network. The VLAN ID is used to match
      incoming traffic and is also added to outgoing traffic.
     </p>

And as seen in email above, the type field is left empty. I could not find
the mapping in any other published sb-db schema. So not sure where it is.
​
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/74acf421/attachment.html>

From blp at nicira.com  Mon Oct 12 10:23:46 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 10:23:46 -0700
Subject: [ovs-discuss] set dpdk packet refcnt when flow output to group.
In-Reply-To: <10E167BF-DA3E-4AAB-8B70-38123A23302F@gmail.com>
References: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>
 <20151012163821.GC2651@nicira.com>
 <10E167BF-DA3E-4AAB-8B70-38123A23302F@gmail.com>
Message-ID: <20151012172346.GF2651@nicira.com>

Your change isn't going to have much effect because most packets don't
go through the translation process.  If you try to force all packets
through translation, it will kill performance.

I think that you should read this paper that describes the various
caching layers in Open vSwitch:
        http://openvswitch.org/support/papers/nsdi2015.pdf

On Mon, Oct 12, 2015 at 11:56:03AM -0500, David Evans wrote:
> Hi Ben,
> 
> When i use the OFPGT11_ALL group action, the packets for a  flow will be sent out all buckets in a group. (in my case all the buckets are ports to transmit out)
> 
> I added a group_bucket_count to the context 
> and 
> in xlate_all_group fn the following.
> 
>     group_dpif_get_buckets(group, &buckets);
> +    if(ctx->group_bucket_count == 0){
> +    	LIST_FOR_EACH (bucket, list_node, buckets) {
> +    		ctx->group_bucket_count++;
> +        }
> +    }
> +    if(ctx->xin->packet)
> +    	if(ctx->xin->packet->source == DPBUF_DPDK)
> +    		rte_pktmbuf_refcnt_update(&ctx->xin->packet->mbuf,ctx->group_bucket_count);
> 	LIST_FOR_EACH (bucket, list_node, buckets) {
> 
> this stops the transmit pmd’s attempting to free the packet until all the buckets( ports ) have transmitted it.
> My switch also does reassembly on rx - this refcnt is necessary for handling multi-segment dpdk buffers too. 
> I also changed the segment free to rte_pktmbuf_free in netdev-dpdk.c for this purpose.
> I’m expecting it will also be important for tso or the possibility of using rte_ipv4_fragment_packet on an outgoing port.
> 
> i have between 6 and 12 PMD’s depending on the number of dpdk ports running at any time, and if i use OFPGT11_ALL with many output buckets(ports) buffers will disappear from under some pmd’s and cause segfaults etc..
> 
> Cheers,
> 
> Dave.
> 
> > On Oct 12, 2015, at 11:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> > 
> > On Wed, Oct 07, 2015 at 05:36:18PM -0500, David Evans wrote:
> >> While using netdev-dpdk - When i add a rule for which the action is to
> >> send to a group (type=all) containing (x) output buckets (ports) how
> >> can i increment the dp_packet->pkt_mbuf’s refcnt to (x) so that the
> >> packet is not deleted before it has transmitted all ports(buckets) in
> >> the group.
> >> 
> >> Perhaps in ofproto-dpif-xlate.c function xlate_all_group find the
> >> packet and apply the ctx->xin->packet->mbuf->refcnt ?  Will that work
> >> for all packets for a ctx?
> > 
> > I don't understand what relationship you expect here.  A group has no
> > direct relationship to a packet.  Translation produces a flat list of
> > simple actions that don't refer back to the group.
> 

From blp at nicira.com  Mon Oct 12 10:27:11 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 10:27:11 -0700
Subject: [ovs-discuss] [ovn] API related questions
In-Reply-To: <CAO=R8o=jgsMV5pzrw4imXmUKponnq=CXQgJpN4+c3js5obSULg@mail.gmail.com>
References: <CAO=R8omxaETTM=787msMso_aA70sZQ-mdjEeuhv+Dw3FM2Caog@mail.gmail.com>
 <20151012152310.GB1327@nicira.com>
 <CAO=R8onBKoJmmW4v050Vck1UeOJCLf=HMni3W9Xj8RYiECk-Dw@mail.gmail.com>
 <20151012162008.GA2651@nicira.com>
 <CAO=R8o=jgsMV5pzrw4imXmUKponnq=CXQgJpN4+c3js5obSULg@mail.gmail.com>
Message-ID: <20151012172711.GG2651@nicira.com>

On Mon, Oct 12, 2015 at 11:56:47AM -0500, Murali R wrote:
> From the link in the previous email
> http://openvswitch.org/pipermail/dev/2015-January/050380.html
> 
> "Matching expressions provide a superset of OpenFlow matching capabilities
> across packets in a logical datapath. Expressions use a syntax similar to
> Boolean expressions in a programming language."

This describes the matching syntax.  I don't see how it implies that
users can modify flows directly.

> I was able to use customized flows in ovs-agent to accomplish flow
> modifications using ovs-ofctl add-flow. I was expecting we could modify for
> logical flows using the ovn-northd but with logical ports. If the flow mods
> can only be done from within northd, then I need to start looking into that
> code. It is definitely better to have some api be exposed to define the
> match and actions and customize flows using lports.

The intended CMS interface to OVN is through the northbound database.

Maybe you should explain what you are trying to accomplish.

> When I say user, I mean a CMS.

Understood.

From blp at nicira.com  Mon Oct 12 10:30:40 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 10:30:40 -0700
Subject: [ovs-discuss] [ovn] Port bindings to network
In-Reply-To: <CAO=R8onv3h-F2NEoDpALeJqLuZetXYV+AsUOrWLuBpOibPXFdg@mail.gmail.com>
References: <CAO=R8omOfuZA6ZfdXS8-pVjDW8aAs8M+2z7FfwPjHftmVTjjgw@mail.gmail.com>
 <CAO=R8onv3h-F2NEoDpALeJqLuZetXYV+AsUOrWLuBpOibPXFdg@mail.gmail.com>
Message-ID: <20151012173040.GH2651@nicira.com>

On Mon, Oct 12, 2015 at 12:14:58PM -0500, Murali R wrote:
> In other words, where is local vlan id per network stored in southbound db?
> Apparently ovn-sb.xml says:
> 
>      <p>
>       When <ref column="type"/> is set to <code>localnet</code>, this can be
>       set to indicate that the port represents a connection to a specific
>       VLAN on a locally accessible network. The VLAN ID is used to match
>       incoming traffic and is also added to outgoing traffic.
>      </p>
> 
> And as seen in email above, the type field is left empty. I could not find
> the mapping in any other published sb-db schema. So not sure where it is.

This documentation was recently reorganized for clarity.  The new
version says the following.

--8<--------------------------cut here-------------------------->8--

     Localnet Options:
       These options apply to logical ports with type of localnet.

       options : network_name: optional string
              Required.    ovn-controller   uses   the   configuration   entry
              ovn-bridge-mappings to determine how to connect to this network.
              ovn-bridge-mappings is a list of network names mapped to a local
              OVS bridge that provides access to that network.  An example  of
              configuring ovn-bridge-mappings would be:

              $ ovs-vsctl set open . external-ids:ovn-bridge-mappings=physnet1:br-eth0,physnet2:br-eth1

              When  a logical switch has a localnet port attached, every chas‐
              sis that may have a local vif attached to  that  logical  switch
              must  have  a  bridge mapping configured to reach that localnet.
              Traffic that arrives on a localnet port is never forwarded  over
              a tunnel to another chassis.

       tag: optional integer, in range 1 to 4,095
              If  set,  indicates  that  the port represents a connection to a
              specific VLAN on a locally accessible network. The  VLAN  ID  is
              used  to  match  incoming  traffic and is also added to outgoing
              traffic.

From er.manpreet25 at gmail.com  Mon Oct 12 10:31:07 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Mon, 12 Oct 2015 23:01:07 +0530
Subject: [ovs-discuss] crash in service with invalid group type
In-Reply-To: <20151012171122.GD2651@nicira.com>
References: <CALD=K8vGLR_N-e4wCi5uL7uFgSGT86c7oG=Cxpp1epBZj-gppw@mail.gmail.com>
 <20151012171122.GD2651@nicira.com>
Message-ID: <CALD=K8sD_2_J3ue4enUVTdWPt20_h8jm9hz7Ky-+Md4770xTiQ@mail.gmail.com>

Hi All,

Thanks Ben For Reply !!!!!!!

Yes i will definitely test it and let you know.

Regards,
Manpreet

On Mon, Oct 12, 2015 at 10:41 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Oct 06, 2015 at 11:46:52PM +0530, Manpreet Singh wrote:
> > I am working on OVS-2.3.2. I got a strange behavior while sending
> group_mod
> > message for add group with invalid group type with RYU controller.
> >
> > ofproto_v1_3_parser.OFPGroupMod(datapath, ofproto_v1_3 .OFPGC_ADD, 7,
> > group_id, buckets)
> >
> > This operation should return error OFPGMFC_BAD_TYPE. But vswitchd service
> > got crashed and connection get lost with the controller.
>
> Thank you for the bug report.
>
> I posted a fix to the ovs-dev mailing list:
>         http://openvswitch.org/pipermail/dev/2015-October/061109.html
>
> Would you mind testing it?
>
> Thanks,
>
> Ben.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/ec8f2d0b/attachment.html>

From blp at nicira.com  Mon Oct 12 11:20:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 11:20:02 -0700
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <F6780E6B-871A-4B71-959B-20DF8C411FD2@nicira.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
 <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
 <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
 <F6780E6B-871A-4B71-959B-20DF8C411FD2@nicira.com>
Message-ID: <20151012182002.GL2651@nicira.com>

On Wed, Sep 30, 2015 at 01:48:21PM -0700, Jarno Rajahalme wrote:
> 
> > On Sep 30, 2015, at 1:54 AM, Daniele Venturino <daniele.venturino at m3s.it> wrote:
> > 
> > I tried the commands you listed but I was not able to reproduce this in a simpler setup only with RSTP enabled on the bridge.
> > 
> > I’m attaching a patch I’d like you to try. I’m not really expecting much from it, but can you give it a try since I can’t reproduce this?
> > 
> > Daniele
> > 
> > <0001-ofproto-dpif-Add-check-in-rstp_run.patch>
> > 
> 
> Yes, NULLing the aux’es does not help without checking for NULL :-)
> 
> Acked-by: Jarno Rajahalme <jrajahalme at nicira.com>

Jarno, is this patch ready to go?  Daniele Venturino is not an OVS
committer so if you're happy with the patch then you should apply it
yourself.

From muralirdev at gmail.com  Mon Oct 12 11:32:04 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 12 Oct 2015 13:32:04 -0500
Subject: [ovs-discuss] [ovn] API related questions
In-Reply-To: <20151012172711.GG2651@nicira.com>
References: <CAO=R8omxaETTM=787msMso_aA70sZQ-mdjEeuhv+Dw3FM2Caog@mail.gmail.com>
 <20151012152310.GB1327@nicira.com>
 <CAO=R8onBKoJmmW4v050Vck1UeOJCLf=HMni3W9Xj8RYiECk-Dw@mail.gmail.com>
 <20151012162008.GA2651@nicira.com>
 <CAO=R8o=jgsMV5pzrw4imXmUKponnq=CXQgJpN4+c3js5obSULg@mail.gmail.com>
 <20151012172711.GG2651@nicira.com>
Message-ID: <CAO=R8omOgHv8qR-J0AKXBRqTX11BkU52LNCo4Me3AFQbKrgHKg@mail.gmail.com>

> Maybe you should explain what you are trying to accomplish.

You can imagine a sort traffic manager that will manage how to traverse a
set of destinations (lports in this case). The GBP and SFC as it stands
with neutron today are not useful for our use cases. And using OVN, not
everything can be accomplished from static configuration that is possible
now. But OVN looks like a great fit for what we need otherwise and
generally in our timeline. I am not planning to use Neutron with OVN if I
am not forced to. Currently using it for L3 and DHCP and also general
network management in the background for a quick poc which needs to work
end of this month.

Considering we can only change logical flows from northd, I may have to
look into how to modify northd to expose the kind of api needed. If you
folks can define a high level api along the lines of ofctl add-flow, it
will take quite a bit load off my shoulders :) and make OVN very useful.
One my framework is ready I can help out on ovn modules (generally external
facing) later in about 2 months.

If we need to discuss more details on use cases, we need to get into some
non-disclosures which I don't mind initiating.

-Murali

On Mon, Oct 12, 2015 at 12:27 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Mon, Oct 12, 2015 at 11:56:47AM -0500, Murali R wrote:
> > From the link in the previous email
> > http://openvswitch.org/pipermail/dev/2015-January/050380.html
> >
> > "Matching expressions provide a superset of OpenFlow matching
> capabilities
> > across packets in a logical datapath. Expressions use a syntax similar to
> > Boolean expressions in a programming language."
>
> This describes the matching syntax.  I don't see how it implies that
> users can modify flows directly.
>
> > I was able to use customized flows in ovs-agent to accomplish flow
> > modifications using ovs-ofctl add-flow. I was expecting we could modify
> for
> > logical flows using the ovn-northd but with logical ports. If the flow
> mods
> > can only be done from within northd, then I need to start looking into
> that
> > code. It is definitely better to have some api be exposed to define the
> > match and actions and customize flows using lports.
>
> The intended CMS interface to OVN is through the northbound database.
>
> Maybe you should explain what you are trying to accomplish.
>
> > When I say user, I mean a CMS.
>
> Understood.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/12d1f393/attachment.html>

From jrajahalme at nicira.com  Mon Oct 12 11:45:45 2015
From: jrajahalme at nicira.com (Jarno Rajahalme)
Date: Mon, 12 Oct 2015 11:45:45 -0700
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <20151012182002.GL2651@nicira.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
 <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
 <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
 <F6780E6B-871A-4B71-959B-20DF8C411FD2@nicira.com>
 <20151012182002.GL2651@nicira.com>
Message-ID: <BC9792BB-FA4A-48A5-9D86-0A3B69AF3622@nicira.com>


> On Oct 12, 2015, at 11:20 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> On Wed, Sep 30, 2015 at 01:48:21PM -0700, Jarno Rajahalme wrote:
>> 
>>> On Sep 30, 2015, at 1:54 AM, Daniele Venturino <daniele.venturino at m3s.it> wrote:
>>> 
>>> I tried the commands you listed but I was not able to reproduce this in a simpler setup only with RSTP enabled on the bridge.
>>> 
>>> I’m attaching a patch I’d like you to try. I’m not really expecting much from it, but can you give it a try since I can’t reproduce this?
>>> 
>>> Daniele
>>> 
>>> <0001-ofproto-dpif-Add-check-in-rstp_run.patch>
>>> 
>> 
>> Yes, NULLing the aux’es does not help without checking for NULL :-)
>> 
>> Acked-by: Jarno Rajahalme <jrajahalme at nicira.com>
> 
> Jarno, is this patch ready to go?  Daniele Venturino is not an OVS
> committer so if you're happy with the patch then you should apply it
> yourself.


This patch avoids a crash, so I just applied it. However, this leaves the question open that whether bundle_move is properly called in all cases before the rest port is removed.

I also applied my patch that disables an RSTP port before it is deleted, as Daniel Swahn tested these patches together.

Regards,

  Jarno


From shettyg at nicira.com  Mon Oct 12 14:12:41 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 12 Oct 2015 14:12:41 -0700
Subject: [ovs-discuss] Ubuntu systemd scripts for openvswitch
In-Reply-To: <CAHbON5o8pDsOFVUS1FaBbHn1b6qTfe4xt5_eetk=Dbad+MQLxg@mail.gmail.com>
References: <CAHbON5o8pDsOFVUS1FaBbHn1b6qTfe4xt5_eetk=Dbad+MQLxg@mail.gmail.com>
Message-ID: <CAHbON5oZz9-YAdvNf7uQR7euk9huMSyYbZN2XqGsiK5vPxKDDw@mail.gmail.com>

James,
 Did you have any comment about the above question?

On Tue, Sep 22, 2015 at 3:42 PM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> On Ubuntu 15.04, there are systemd scripts added for
> openvswitch-switch package. (/etc/init/openvswitch-switch.conf). At
> first glance (and based on a user bug report), it does not work with
> OVS integration with 'interfaces' file (as described in the section
> "Debian network scripts integration" at
> https://github.com/openvswitch/ovs/blob/master/debian/openvswitch-switch.README.Debian).
>
> The way 'interfaces' integration currently works is that, in
> /etc/init.d/openvswitch-switch, we call "network_interfaces ifup"
> function when "start" is called. Since
> /etc/init/openvswitch-switch.conf does not have this integration,
> things configured in /etc/network/interfaces for OVS no longer works.
>
> Would adding the following line in /etc/init.d/openvswitch-switch a
> viable solution for those that want the 'interfaces' integration to
> continue to work?
> _SYSTEMCTL_SKIP_REDIRECT=yes

From blp at nicira.com  Mon Oct 12 14:28:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 12 Oct 2015 14:28:51 -0700
Subject: [ovs-discuss] [ovn] API related questions
In-Reply-To: <CAO=R8omOgHv8qR-J0AKXBRqTX11BkU52LNCo4Me3AFQbKrgHKg@mail.gmail.com>
References: <CAO=R8omxaETTM=787msMso_aA70sZQ-mdjEeuhv+Dw3FM2Caog@mail.gmail.com>
 <20151012152310.GB1327@nicira.com>
 <CAO=R8onBKoJmmW4v050Vck1UeOJCLf=HMni3W9Xj8RYiECk-Dw@mail.gmail.com>
 <20151012162008.GA2651@nicira.com>
 <CAO=R8o=jgsMV5pzrw4imXmUKponnq=CXQgJpN4+c3js5obSULg@mail.gmail.com>
 <20151012172711.GG2651@nicira.com>
 <CAO=R8omOgHv8qR-J0AKXBRqTX11BkU52LNCo4Me3AFQbKrgHKg@mail.gmail.com>
Message-ID: <20151012212851.GC15602@nicira.com>

On Mon, Oct 12, 2015 at 01:32:04PM -0500, Murali R wrote:
> > Maybe you should explain what you are trying to accomplish.
> 
> You can imagine a sort traffic manager that will manage how to traverse a
> set of destinations (lports in this case). The GBP and SFC as it stands
> with neutron today are not useful for our use cases. And using OVN, not
> everything can be accomplished from static configuration that is possible
> now. But OVN looks like a great fit for what we need otherwise and
> generally in our timeline. I am not planning to use Neutron with OVN if I
> am not forced to. Currently using it for L3 and DHCP and also general
> network management in the background for a quick poc which needs to work
> end of this month.
> 
> Considering we can only change logical flows from northd, I may have to
> look into how to modify northd to expose the kind of api needed. If you
> folks can define a high level api along the lines of ofctl add-flow, it
> will take quite a bit load off my shoulders :) and make OVN very useful.
> One my framework is ready I can help out on ovn modules (generally external
> facing) later in about 2 months.
> 
> If we need to discuss more details on use cases, we need to get into some
> non-disclosures which I don't mind initiating.

The "normal" way to add a feature to OVN would be to figure out how to
express it in the OVN_Northbound schema.  (That might require extensions
or other updates to the schema, which is fine at this point.)  Then the
rest of the system, ovn-northd particularly and in some cases
ovn-controller or other daemons, gets updated to match.

I don't think it makes sense to sign NDAs for this project.

From muralirdev at gmail.com  Mon Oct 12 16:37:07 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 12 Oct 2015 18:37:07 -0500
Subject: [ovs-discuss] [ovn] API related questions
In-Reply-To: <20151012212851.GC15602@nicira.com>
References: <CAO=R8omxaETTM=787msMso_aA70sZQ-mdjEeuhv+Dw3FM2Caog@mail.gmail.com>
 <20151012152310.GB1327@nicira.com>
 <CAO=R8onBKoJmmW4v050Vck1UeOJCLf=HMni3W9Xj8RYiECk-Dw@mail.gmail.com>
 <20151012162008.GA2651@nicira.com>
 <CAO=R8o=jgsMV5pzrw4imXmUKponnq=CXQgJpN4+c3js5obSULg@mail.gmail.com>
 <20151012172711.GG2651@nicira.com>
 <CAO=R8omOgHv8qR-J0AKXBRqTX11BkU52LNCo4Me3AFQbKrgHKg@mail.gmail.com>
 <20151012212851.GC15602@nicira.com>
Message-ID: <CAO=R8o=TaLiqrtEs-jL7BnGRafVL02=xQovocuZGaqKvt=MkXA@mail.gmail.com>

Thanks Ben. Once I validate on my setup, I will put forward what's on my
mind.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151012/a32bf139/attachment.html>

From jesse at nicira.com  Mon Oct 12 17:06:40 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 12 Oct 2015 17:06:40 -0700
Subject: [ovs-discuss] Early addition of flows in the kernel.
In-Reply-To: <CAF4aououi8-KSoe5Lr__-F3oHtfks+esTu2EjwsWu4EZTNSN-A@mail.gmail.com>
References: <CAF4aououi8-KSoe5Lr__-F3oHtfks+esTu2EjwsWu4EZTNSN-A@mail.gmail.com>
Message-ID: <CAEP_g=_a3E+te4ZcZg1MzKy8+LqPQpx-ZnZDYQ+VBXN8E8sOHQ@mail.gmail.com>

On Mon, Oct 12, 2015 at 5:17 AM, jimson chacko
<jimsonchacko at gmail.com> wrote> Hi,
>
> As per my understanding, OVS inserts the flow in the kernel when an
> exception packet is handled by the vswitchd (ofcourse when matching flow is
> present in the vswitchd).
>
> Is it possible to push the flow into the kernel as soon as the flow gets
> added to vswitchd ? This enables in avoiding the exception mechanism and
> hence faster processing.

No.

> Can you briefly let me know why the design was kept so ?

It's not possible to do in a general and efficient manner. The flows
kept by the kernel are significantly simpler than the ones in
userspace to make them easier to process. The consequence is that they
are less expressive and you can potentially need a lot more of them to
cover the entire space, which is prohibitively expensive.

From jesse at nicira.com  Mon Oct 12 17:29:28 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 12 Oct 2015 17:29:28 -0700
Subject: [ovs-discuss] 2.3.2 kernel module build error on rhel7
In-Reply-To: <CALrtOxoYw2AXz1j6pUzUjHFjL9V93J0Rzh=7YkEs2du3XCNy-w@mail.gmail.com>
References: <CALrtOxoYw2AXz1j6pUzUjHFjL9V93J0Rzh=7YkEs2du3XCNy-w@mail.gmail.com>
Message-ID: <CAEP_g=84uYQEpEY-qgMKx6t3yCf0i-Oh5Js-w9NKiwtArr=zgQ@mail.gmail.com>

On Sat, Oct 10, 2015 at 3:32 AM, Tashi Lu <dotslash.lu at gmail.com> wrote:
> Hi all,
>
> When building LTS version of ovs kernel module from tarball on CentOS 7,
> kernel version 3.10.0-229.el7.x86_64, I encountered following errors. What I
> did wrong here?

RHEL 7 has the OVS kernel module built in, so you shouldn't need to
build it at all. If you really want to use the out of tree module for
some reason, then OVS 2.4 should be compatible with RHEL 7.

From dotslash.lu at gmail.com  Mon Oct 12 17:39:41 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Tue, 13 Oct 2015 00:39:41 +0000
Subject: [ovs-discuss] 2.3.2 kernel module build error on rhel7
In-Reply-To: <CAEP_g=84uYQEpEY-qgMKx6t3yCf0i-Oh5Js-w9NKiwtArr=zgQ@mail.gmail.com>
References: <CALrtOxoYw2AXz1j6pUzUjHFjL9V93J0Rzh=7YkEs2du3XCNy-w@mail.gmail.com>
 <CAEP_g=84uYQEpEY-qgMKx6t3yCf0i-Oh5Js-w9NKiwtArr=zgQ@mail.gmail.com>
Message-ID: <CALrtOxqFKb3=4f9PB6PgMBCSzqthsr=7D_CFqnzo4hK3mLhbpA@mail.gmail.com>

I didn't know RHEL 7 had OVS ko built in, thanks Jesse.

Jesse Gross <jesse at nicira.com>于2015年10月13日周二 08:29写道：

> On Sat, Oct 10, 2015 at 3:32 AM, Tashi Lu <dotslash.lu at gmail.com> wrote:
> > Hi all,
> >
> > When building LTS version of ovs kernel module from tarball on CentOS 7,
> > kernel version 3.10.0-229.el7.x86_64, I encountered following errors.
> What I
> > did wrong here?
>
> RHEL 7 has the OVS kernel module built in, so you shouldn't need to
> build it at all. If you really want to use the out of tree module for
> some reason, then OVS 2.4 should be compatible with RHEL 7.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/1c319c2a/attachment-0001.html>

From jesse at nicira.com  Mon Oct 12 21:21:40 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 12 Oct 2015 21:21:40 -0700
Subject: [ovs-discuss] Early addition of flows in the kernel.
In-Reply-To: <561c5eb1.6591420a.f8ac3.166f@mx.google.com>
References: <CAF4aououi8-KSoe5Lr__-F3oHtfks+esTu2EjwsWu4EZTNSN-A@mail.gmail.com>
 <CAEP_g=_a3E+te4ZcZg1MzKy8+LqPQpx-ZnZDYQ+VBXN8E8sOHQ@mail.gmail.com>
 <561c5eb1.6591420a.f8ac3.166f@mx.google.com>
Message-ID: <CAEP_g=-z0eLcoVMzB4mwdJu8dnLzNtr5Xm5VeYDivFnpswSgAg@mail.gmail.com>

Please don't drop the mailing list or top post.

Yes. Please see here for more information on the design of OVS:
http://openvswitch.org/support/papers/nsdi2015.pdf

On Mon, Oct 12, 2015 at 6:30 PM, jimson jimson <jimsonchacko at gmail.com> wrote:
> You mean to say one user space flow can result in many in the kernel?
> ________________________________
> From: Jesse Gross
> Sent: ‎13-‎10-‎2015 05:37 AM
> To: jimson chacko
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Early addition of flows in the kernel.
>
> On Mon, Oct 12, 2015 at 5:17 AM, jimson chacko
> <jimsonchacko at gmail.com> wrote> Hi,
>>
>> As per my understanding, OVS inserts the flow in the kernel when an
>> exception packet is handled by the vswitchd (ofcourse when matching flow
>> is
>> present in the vswitchd).
>>
>> Is it possible to push the flow into the kernel as soon as the flow gets
>> added to vswitchd ? This enables in avoiding the exception mechanism and
>> hence faster processing.
>
> No.
>
>> Can you briefly let me know why the design was kept so ?
>
> It's not possible to do in a general and efficient manner. The flows
> kept by the kernel are significantly simpler than the ones in
> userspace to make them easier to process. The consequence is that they
> are less expressive and you can potentially need a lot more of them to
> cover the entire space, which is prohibitively expensive.

From liu.liuyongqiang at huawei.com  Tue Oct 13 01:22:24 2015
From: liu.liuyongqiang at huawei.com (Liuyongqiang (A))
Date: Tue, 13 Oct 2015 08:22:24 +0000
Subject: [ovs-discuss] ovsdb-client connected error when i update the
 ovsdb-server ca_cert.pem file
In-Reply-To: <20151012163004.GB2651@nicira.com>
References: <621FAA8B3DA4E14193D6933FB72489BA58265FCF@nkgeml511-mbx.china.huawei.com>
 <20151012163004.GB2651@nicira.com>
Message-ID: <621FAA8B3DA4E14193D6933FB72489BA58266107@nkgeml511-mbx.china.huawei.com>

Hi ben, I found that there is a bug in openssl, if the length of list ctx->client_CA is up to 649, the client will be failed to connect the server. 
It's difficult for me to fix this bug, because I'm not very familiar with the openssl, but I thought it's not very suitable to add client CA using 
the API SSL_CTX_add_client_CA when reconfigure ssl, this API did not delete the old CA certificates, I wonder if the API SSL_CTX_set_client_CA_list
is better than SSL_CTX_add_client_CA, it fix my problem to modify the ovsdb function stream_ssl_set_ca_cert_file__ using the SSL_CTX_set_client_CA_list.

From jimsonchacko at gmail.com  Tue Oct 13 01:48:00 2015
From: jimsonchacko at gmail.com (jimson chacko)
Date: Tue, 13 Oct 2015 14:18:00 +0530
Subject: [ovs-discuss] Early addition of flows in the kernel.
In-Reply-To: <CAEP_g=-z0eLcoVMzB4mwdJu8dnLzNtr5Xm5VeYDivFnpswSgAg@mail.gmail.com>
References: <CAF4aououi8-KSoe5Lr__-F3oHtfks+esTu2EjwsWu4EZTNSN-A@mail.gmail.com>
 <CAEP_g=_a3E+te4ZcZg1MzKy8+LqPQpx-ZnZDYQ+VBXN8E8sOHQ@mail.gmail.com>
 <561c5eb1.6591420a.f8ac3.166f@mx.google.com>
 <CAEP_g=-z0eLcoVMzB4mwdJu8dnLzNtr5Xm5VeYDivFnpswSgAg@mail.gmail.com>
Message-ID: <CAF4aouqHv6gwFQokX4F5RPyKMn=rtshA8kG-O5awp5RH-7-7ug@mail.gmail.com>

Hi,

Can you give an example flow which has one entry in the user space and
multiple entries in the kernel ?

Ok. Now I know OVS is designed to push the flows in the kernel only during
handle_upcalls. But there are exceptions. One is when the flow is deleted.
One is when a flow (which is already present in the kernel) is modified. In
these cases the effect is immediate. That is, vswitchd will sync the flow
deletion/modification to the kernel without waiting for packets. Am I
correct ?

Regards
Jimson

On Tue, Oct 13, 2015 at 9:51 AM, Jesse Gross <jesse at nicira.com> wrote:

> Please don't drop the mailing list or top post.
>
> Yes. Please see here for more information on the design of OVS:
> http://openvswitch.org/support/papers/nsdi2015.pdf
>
> On Mon, Oct 12, 2015 at 6:30 PM, jimson jimson <jimsonchacko at gmail.com>
> wrote:
> > You mean to say one user space flow can result in many in the kernel?
> > ________________________________
> > From: Jesse Gross
> > Sent: ‎13-‎10-‎2015 05:37 AM
> > To: jimson chacko
> > Cc: discuss at openvswitch.org
> > Subject: Re: [ovs-discuss] Early addition of flows in the kernel.
> >
> > On Mon, Oct 12, 2015 at 5:17 AM, jimson chacko
> > <jimsonchacko at gmail.com> wrote> Hi,
> >>
> >> As per my understanding, OVS inserts the flow in the kernel when an
> >> exception packet is handled by the vswitchd (ofcourse when matching flow
> >> is
> >> present in the vswitchd).
> >>
> >> Is it possible to push the flow into the kernel as soon as the flow gets
> >> added to vswitchd ? This enables in avoiding the exception mechanism and
> >> hence faster processing.
> >
> > No.
> >
> >> Can you briefly let me know why the design was kept so ?
> >
> > It's not possible to do in a general and efficient manner. The flows
> > kept by the kernel are significantly simpler than the ones in
> > userspace to make them easier to process. The consequence is that they
> > are less expressive and you can potentially need a lot more of them to
> > cover the entire space, which is prohibitively expensive.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/3496bf84/attachment.html>

From mark.d.gray at intel.com  Tue Oct 13 03:59:21 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Tue, 13 Oct 2015 10:59:21 +0000
Subject: [ovs-discuss] status of ovn-docker
Message-ID: <738D45BC1F695740A983F43CFE1B7EA943839E24@IRSMSX108.ger.corp.intel.com>

Hi,

Can anyone point me to discussions on the status of the ovn-docker driver? It appears to be maintained out of the ovs or docker tree. Is there any intention to upstream it into the main docker code?

Thanks,

Mark

From shettyg at nicira.com  Tue Oct 13 07:37:35 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 13 Oct 2015 07:37:35 -0700
Subject: [ovs-discuss] status of ovn-docker
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA943839E24@IRSMSX108.ger.corp.intel.com>
References: <738D45BC1F695740A983F43CFE1B7EA943839E24@IRSMSX108.ger.corp.intel.com>
Message-ID: <CAHbON5pQvTxiJqDLf5gbxSifUgPENbjbd5HOqydHDqGSZcztQQ@mail.gmail.com>

Are you talking about: https://github.com/shettyg/ovn-docker  ?

If so, there has been a lot of changes in docker api over the last
couple of weeks and that code no longer works. That is one of the
reason I am maintaining it out of tree - libnetwork is still
experimental and the APIs have been changing very often and it does
not make sense for openvswitch to maintain experimental code.

Docker 1.9 will likely remove the experimental tag. When that happens,
I will get the code reviewed in the openvswitch mailing list to add it
to openvswitch repo.

On Tue, Oct 13, 2015 at 3:59 AM, Gray, Mark D <mark.d.gray at intel.com> wrote:
> Hi,
>
> Can anyone point me to discussions on the status of the ovn-docker driver? It appears to be maintained out of the ovs or docker tree. Is there any intention to upstream it into the main docker code?
>
> Thanks,
>
> Mark
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From haristanvir at hotmail.com  Mon Oct 12 12:47:48 2015
From: haristanvir at hotmail.com (haris tanvir)
Date: Tue, 13 Oct 2015 00:47:48 +0500
Subject: [ovs-discuss] ovs 2.4 dpdk ports
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F74528C85C@IRSMSX104.ger.corp.intel.com>
References: <SNT151-W81158F2399AA78BA5EE8EB8310@phx.gbl>,
 <BC0FEEC7D7650749874CEC11314A88F74528C85C@IRSMSX104.ger.corp.intel.com>
Message-ID: <SNT151-W14392B7D8829F4A6DDE773B8310@phx.gbl>

Thanks traynor
Can you kindly elaborate more on the relation between these ports?
Like for instance, do I always need to create port of type dpdk before I create a port of type dpdkvhostuser?
Is a new thread created everytime in case of only type 'dpdk' or is it also created on creating port of type 'dpdkvhostuser' as well?The documentation i found on the web is not very detailed. If you have some other resource on detailed explanation of working of these ports, kindly share that as well. Thank You
RegardsHaris Tanvir

 

> From: kevin.traynor at intel.com
> To: haristanvir at hotmail.com; discuss at openvswitch.org
> Subject: RE: [ovs-discuss] ovs 2.4 dpdk ports
> Date: Mon, 12 Oct 2015 16:19:36 +0000
> 
> 
> > -----Original Message-----
> > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of haris
> > tanvir
> > Sent: Monday, October 12, 2015 8:57 AM
> > To: discuss at openvswitch.org
> > Subject: [ovs-discuss] ovs 2.4 dpdk ports
> > 
> > Can someone explain the difference between(and elaborate) the following types
> > of ports in ovs 2.4
> > 
> > 1. dpdk
> physical NIC ports
> 
> > 2. dpdkr
> dpdk ring ports, they can be used to read/write memory shared through ivshmem
> 
> > 3. dpdkvhostuser
> qemu vhostuser ports
> 
> Have a look through the dpdk documentation http://www.dpdk.org/doc
> or the INSTALL.DPDK.md
> 
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/809a6377/attachment-0001.html>

From dev_raj82 at yahoo.com  Tue Oct 13 00:00:29 2015
From: dev_raj82 at yahoo.com (Nishanth Devarajan)
Date: Tue, 13 Oct 2015 12:30:29 +0530
Subject: [ovs-discuss] Unable to create a port on OVS bridge
Message-ID: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>

Hello all,
	     I was setting up a network architecture with OVS, I’ve already set up bridges with various ports by now. Out of the blue it showed an error when I tried to add port tap0 to one of my bridges. It says: “Error detected while setting up tap0 . See ovs-vscwitchd log for details “  So when I go to the log I see this: 

"another ovs-vswitchd process is running, disabling this process (pid 3094) until it goes away.”

I don’t know why it happened and it keeps happening ever since, even after I restart my machine to add  a port to a new bridge. How do I rectify this error? Thanks in advance.


Thank you for your time,
Nishanth

From amer7777 at hotmail.com  Tue Oct 13 03:48:50 2015
From: amer7777 at hotmail.com (Amer)
Date: Tue, 13 Oct 2015 13:48:50 +0300
Subject: [ovs-discuss] Table 0 in the kernel fast path
Message-ID: <BLU436-SMTP24141CA70D0E826728D41A1D4300@phx.gbl>

Hello,

Dear All

I would like to inserts all the flow-entries of table=0 to be directly handled by the fast-path. 
Something, like offloading the flow-entries of table=0 to the cache "fast-path kernel-level".

if that isn't possible, can I configure the OVS to handle all the incoming flows directly by the fast-path. Or can I disable the user-space mode to force the OVS to do so?

May you please help me to do so?

Best regards,
Amer

From haristanvir at hotmail.com  Tue Oct 13 04:52:33 2015
From: haristanvir at hotmail.com (haris tanvir)
Date: Tue, 13 Oct 2015 16:52:33 +0500
Subject: [ovs-discuss] Cannot add dpdkvhost user ports
Message-ID: <SNT151-W7689A3FB9779F02B79B3CCB8300@phx.gbl>

Hi,I am trying to add in dpdkvhostuser ports in openvswitch 2.4I have followed all the steps described in following documentationhttp://www.ran-lifshitz.com/2015/06/17/open-vswitch-netdev-dpdk-with-vhost-user-support/I have made sure that following checks are enabled when i build dpdkCONFIG_RTE_BUILD_COMBINE_LIBS=y
CONFIG_RTE_LIBRTE_VHOST=y
After all the steps, i am able to add ports of type 'dpdk' but when i add port of type 'dpdkvhostuser', it throws out following error in the logsbridge|WARN|could not open network device dpdkvhost0 (Address family not supported by protocol)
And surprisingly, it adds ports of 'vhostcuse' just fine, even though i have made sure a thousand times that i have checked vhostuser flag rather than vhostcuse flag (CONFIG_RTE_LIBRTE_VHOST=y in dpdk2.0.0/config/linux_common . Infact i have not even loaded 'cuse' module. 
Can someone please point it some step im missing?
Thanks
RegardsHaris Tanvir


  		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/32321847/attachment-0001.html>

From sy.kim at netsys.kaist.ac.kr  Tue Oct 13 05:12:08 2015
From: sy.kim at netsys.kaist.ac.kr (sy.kim)
Date: Tue, 13 Oct 2015 21:12:08 +0900
Subject: [ovs-discuss] I want to connect bridge with wlan0(using hostapd)
Message-ID: <000001d105b0$65a4b0d0$30ee1270$@netsys.kaist.ac.kr>

Hello,

 

I'm now using hostapd 2.1 and openvswitch 2.0.2

I want to make AP(wlan1) using hostapd and OVS (Not bridge-utils)

When I used bidge-utils, AP worked well. 

However, When I changed bridge-utils to OVS bridge with same configuration,
below problem happens.

Actually when I added port eth0 and wlan1, same problem happens.

I think OVS bridge does not have any rule to process packet from wlan1

I'm not sure

Can you help me?

Simply speaking, I want to connect wlan1(AP mode using hostapd) -
bridge(OVS) - eth0 (Ethernet)

Thanks







-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/b80a948a/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 54226 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/b80a948a/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 3325 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/b80a948a/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 5387 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/b80a948a/attachment-0005.png>

From shettyg at nicira.com  Tue Oct 13 08:43:02 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 13 Oct 2015 08:43:02 -0700
Subject: [ovs-discuss] Unable to create a port on OVS bridge
In-Reply-To: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>
References: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>
Message-ID: <CAHbON5qtTDHc4Hx_muXs9d4B+0xKyf04nNoH=oOU+FRmhneVfA@mail.gmail.com>

What does 'find / -name ovs-vswitchd' say?

On Tue, Oct 13, 2015 at 12:00 AM, Nishanth Devarajan
<dev_raj82 at yahoo.com> wrote:
> Hello all,
>              I was setting up a network architecture with OVS, I’ve already set up bridges with various ports by now. Out of the blue it showed an error when I tried to add port tap0 to one of my bridges. It says: “Error detected while setting up tap0 . See ovs-vscwitchd log for details “  So when I go to the log I see this:
>
> "another ovs-vswitchd process is running, disabling this process (pid 3094) until it goes away.”
>
> I don’t know why it happened and it keeps happening ever since, even after I restart my machine to add  a port to a new bridge. How do I rectify this error? Thanks in advance.
>
>
> Thank you for your time,
> Nishanth
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From jpettit at nicira.com  Tue Oct 13 08:46:38 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 13 Oct 2015 08:46:38 -0700
Subject: [ovs-discuss] Table 0 in the kernel fast path
In-Reply-To: <BLU436-SMTP24141CA70D0E826728D41A1D4300@phx.gbl>
References: <BLU436-SMTP24141CA70D0E826728D41A1D4300@phx.gbl>
Message-ID: <032D00F0-4C82-4342-BE05-805FE7A5F522@nicira.com>


> On Oct 13, 2015, at 3:48 AM, Amer <amer7777 at hotmail.com> wrote:
> 
> I would like to inserts all the flow-entries of table=0 to be directly handled by the fast-path. 
> Something, like offloading the flow-entries of table=0 to the cache "fast-path kernel-level".
> 
> if that isn't possible, can I configure the OVS to handle all the incoming flows directly by the fast-path. Or can I disable the user-space mode to force the OVS to do so?
> 
> May you please help me to do so?

That's not possible.  It was just discussed yesterday on this mailing list.  Please take a look at the archives.

--Justin



From mark.d.gray at intel.com  Tue Oct 13 08:56:39 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Tue, 13 Oct 2015 15:56:39 +0000
Subject: [ovs-discuss] status of ovn-docker
In-Reply-To: <CAHbON5pQvTxiJqDLf5gbxSifUgPENbjbd5HOqydHDqGSZcztQQ@mail.gmail.com>
References: <738D45BC1F695740A983F43CFE1B7EA943839E24@IRSMSX108.ger.corp.intel.com>
 <CAHbON5pQvTxiJqDLf5gbxSifUgPENbjbd5HOqydHDqGSZcztQQ@mail.gmail.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA94383A52E@IRSMSX108.ger.corp.intel.com>

> 
> Are you talking about: https://github.com/shettyg/ovn-docker  ?

Yes, I presume this will be the preferred way of interfacing docker with ovs?
> 
> If so, there has been a lot of changes in docker api over the last couple of
> weeks and that code no longer works. That is one of the reason I am
> maintaining it out of tree - libnetwork is still experimental and the APIs have
> been changing very often and it does not make sense for openvswitch to
> maintain experimental code.
> 
> Docker 1.9 will likely remove the experimental tag. When that happens, I will
> get the code reviewed in the openvswitch mailing list to add it to
> openvswitch repo.

How come it will not get upstreamed into the docker repo? Does this mean
that some special configuration will need be done in docker to get this
working?
 


From shettyg at nicira.com  Tue Oct 13 09:18:33 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 13 Oct 2015 09:18:33 -0700
Subject: [ovs-discuss] status of ovn-docker
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA94383A52E@IRSMSX108.ger.corp.intel.com>
References: <738D45BC1F695740A983F43CFE1B7EA943839E24@IRSMSX108.ger.corp.intel.com>
 <CAHbON5pQvTxiJqDLf5gbxSifUgPENbjbd5HOqydHDqGSZcztQQ@mail.gmail.com>
 <738D45BC1F695740A983F43CFE1B7EA94383A52E@IRSMSX108.ger.corp.intel.com>
Message-ID: <CAHbON5prRCdFuM2zBQG_NL_0p611CN3accnvTYzZGXZNy9ZZpg@mail.gmail.com>

>
> Yes, I presume this will be the preferred way of interfacing docker with ovs?

Docker user facing APIs around networking is such that integration
with OVS will need a control plane to provide the desired multi-host
networking to work. OVN is an option for that. So OVN is one way to
integrate Docker with OVS. It is not necessarily the only way as there
are a lot of other people integrating Docker with OVS with their own
control plane.

>>
>> If so, there has been a lot of changes in docker api over the last couple of
>> weeks and that code no longer works. That is one of the reason I am
>> maintaining it out of tree - libnetwork is still experimental and the APIs have
>> been changing very often and it does not make sense for openvswitch to
>> maintain experimental code.
>>
>> Docker 1.9 will likely remove the experimental tag. When that happens, I will
>> get the code reviewed in the openvswitch mailing list to add it to
>> openvswitch repo.
>
> How come it will not get upstreamed into the docker repo? Does this mean
> that some special configuration will need be done in docker to get this
> working?

Docker's libnetwork works with REST APIs. So the driver, as long as it
implements all the REST APIs that Docker expects can reside
independently of Docker daemon. One way to install that driver is via
OVN packaging.

>
>

From jesse at nicira.com  Tue Oct 13 09:22:37 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 13 Oct 2015 09:22:37 -0700
Subject: [ovs-discuss] Early addition of flows in the kernel.
In-Reply-To: <CAF4aouqHv6gwFQokX4F5RPyKMn=rtshA8kG-O5awp5RH-7-7ug@mail.gmail.com>
References: <CAF4aououi8-KSoe5Lr__-F3oHtfks+esTu2EjwsWu4EZTNSN-A@mail.gmail.com>
 <CAEP_g=_a3E+te4ZcZg1MzKy8+LqPQpx-ZnZDYQ+VBXN8E8sOHQ@mail.gmail.com>
 <561c5eb1.6591420a.f8ac3.166f@mx.google.com>
 <CAEP_g=-z0eLcoVMzB4mwdJu8dnLzNtr5Xm5VeYDivFnpswSgAg@mail.gmail.com>
 <CAF4aouqHv6gwFQokX4F5RPyKMn=rtshA8kG-O5awp5RH-7-7ug@mail.gmail.com>
Message-ID: <CAEP_g=-SZ_2hZ9MPYFz6PUuy1zvgSUhZ1869X3=XEOdfx0YTWg@mail.gmail.com>

On Tuesday, October 13, 2015, jimson chacko <jimsonchacko at gmail.com> wrote:

> Hi,
>
> Can you give an example flow which has one entry in the user space and
> multiple entries in the kernel ?
>

Please see the explanation Ben just posted here:
http://openvswitch.org/pipermail/dev/2015-October/061136.html


> Ok. Now I know OVS is designed to push the flows in the kernel only during
> handle_upcalls. But there are exceptions. One is when the flow is deleted.
> One is when a flow (which is already present in the kernel) is modified. In
> these cases the effect is immediate. That is, vswitchd will sync the flow
> deletion/modification to the kernel without waiting for packets. Am I
> correct ?
>

Yes.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/dad0ddc3/attachment.html>

From ciara.loftus at intel.com  Tue Oct 13 09:23:38 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Tue, 13 Oct 2015 16:23:38 +0000
Subject: [ovs-discuss] Cannot add dpdkvhost user ports
In-Reply-To: <SNT151-W7689A3FB9779F02B79B3CCB8300@phx.gbl>
References: <SNT151-W7689A3FB9779F02B79B3CCB8300@phx.gbl>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC24F79A470@IRSMSX102.ger.corp.intel.com>

> 
> Hi,
> I am trying to add in dpdkvhostuser ports in openvswitch 2.4
> I have followed all the steps described in following documentation
> http://www.ran-lifshitz.com/2015/06/17/open-vswitch-netdev-dpdk-with-
> vhost-user-support/
> I have made sure that following checks are enabled when i build dpdk
> CONFIG_RTE_BUILD_COMBINE_LIBS=y
> CONFIG_RTE_LIBRTE_VHOST=y
> 
> After all the steps, i am able to add ports of type 'dpdk' but when i add port
> of type 'dpdkvhostuser', it throws out following error in the logs
> bridge|WARN|could not open network device dpdkvhost0 (Address family
> not supported by protocol)
> 
> And surprisingly, it adds ports of 'vhostcuse' just fine, even though i have
> made sure a thousand times that i have checked vhostuser flag rather than
> vhostcuse flag (CONFIG_RTE_LIBRTE_VHOST=y in
Make sure that CONFIG_RTE_LIBRTE_VHOST_USER=y too.

> dpdk2.0.0/config/linux_common . Infact i have not even loaded 'cuse'
> module.
> 
> Can someone please point it some step im missing?
> 
> Thanks
> 
> Regards
> Haris Tanvir
> 
> 
> 
> 

From shettyg at nicira.com  Tue Oct 13 09:25:47 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 13 Oct 2015 09:25:47 -0700
Subject: [ovs-discuss] Unable to create a port on OVS bridge
In-Reply-To: <7535310D-4EEA-4766-8825-C4655066BAC4@yahoo.com>
References: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>
 <CAHbON5qtTDHc4Hx_muXs9d4B+0xKyf04nNoH=oOU+FRmhneVfA@mail.gmail.com>
 <7535310D-4EEA-4766-8825-C4655066BAC4@yahoo.com>
Message-ID: <CAHbON5piinGiXO3fzGXHyZ-UJCXi_D+XHH3dNtgANR01qJOrrA@mail.gmail.com>

On Tue, Oct 13, 2015 at 9:01 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
> It says;
>  /usr/sbin/ovs-vswitchd
> /usr/local/sbin/ovs-vswitchd

The error message in your log file says that there was already a
ovs-vswitchd running. It is likely that since you have 2 ovs-vswitchd
installed in your system, one of them has already been started with a
startup script. So when you start the other one, it complained saying
that another one has already been started.

You having 2 ovs-vswitchd in /usr/sbin/ and /usr/local/sbin/ also
tells me that you likely installed one using 'make install' and the
other using rpm or ubuntu packages. I strongly suggest to uninstall
one of them (unless you know very well what you are doing)

From shettyg at nicira.com  Tue Oct 13 11:05:45 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 13 Oct 2015 11:05:45 -0700
Subject: [ovs-discuss] Unable to create a port on OVS bridge
In-Reply-To: <83329887-1CE1-4ACD-9A9E-67B41C56ABCC@yahoo.com>
References: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>
 <CAHbON5qtTDHc4Hx_muXs9d4B+0xKyf04nNoH=oOU+FRmhneVfA@mail.gmail.com>
 <7535310D-4EEA-4766-8825-C4655066BAC4@yahoo.com>
 <CAHbON5piinGiXO3fzGXHyZ-UJCXi_D+XHH3dNtgANR01qJOrrA@mail.gmail.com>
 <83329887-1CE1-4ACD-9A9E-67B41C56ABCC@yahoo.com>
Message-ID: <CAHbON5qWqcm78W8cmZN_PFTyfj1DOw9gRFM+dckKo63AgoamsQ@mail.gmail.com>

Where ever you did a 'make install', do a 'make uninstall'. The end
result should be that 'find /usr -name ovs-vswitchd' should only say
/usr/sbin/ovs-vswitchd.

Then:
ps -ef | grep ovs

Kill both ovs-vswitchd and ovsdb-server processes using 'kill'.


Then do '/etc/init.d/openvswitch start'

On Tue, Oct 13, 2015 at 10:17 AM, Nishanth Devarajan
<dev_raj82 at yahoo.com> wrote:
> No I don’t know what Im doing very well. How exactly do I uninstall one of them completely so that I don’t get this problem? Also thanks :)
>> On 13-Oct-2015, at 9:55 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>
>> On Tue, Oct 13, 2015 at 9:01 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
>>> It says;
>>> /usr/sbin/ovs-vswitchd
>>> /usr/local/sbin/ovs-vswitchd
>>
>> The error message in your log file says that there was already a
>> ovs-vswitchd running. It is likely that since you have 2 ovs-vswitchd
>> installed in your system, one of them has already been started with a
>> startup script. So when you start the other one, it complained saying
>> that another one has already been started.
>>
>> You having 2 ovs-vswitchd in /usr/sbin/ and /usr/local/sbin/ also
>> tells me that you likely installed one using 'make install' and the
>> other using rpm or ubuntu packages. I strongly suggest to uninstall
>> one of them (unless you know very well what you are doing)
>

From rajesh.chawla at oracle.com  Tue Oct 13 11:49:14 2015
From: rajesh.chawla at oracle.com (Rajesh Chawla)
Date: Tue, 13 Oct 2015 11:49:14 -0700 (PDT)
Subject: [ovs-discuss] Setting up STT -- receive tunnel port not found
Message-ID: <19783cb4-208c-45ce-bd8b-4d2e649525b2@default>

Hi folks,

 

I'm struggling to set up a simple STT connection between 2 nodes.

I see a reasonable setup using ovs-vsctl show (see below), but when I try to 

ping using the bridge, I get the following error in the log file:

 

2015-10-13T18:31:49.492Z|00005|tunnel(handler4)|WARN|receive tunnel port not found (arp,tun_id=0x64,tun_src=10.106.15.34,tun_dst=10.106.15.30,tun_gbp_id=0,tun_gbp_flags=0,tun_tos=0,tun_ttl=63,csum|key,in_port=2,vlan_tci=0x0000,dl_src=ae:bb:cc:5e:15:48,dl_dst=ff:ff:ff:ff:ff:ff,arp_spa=10.1.2.1,arp_tpa=10.1.2.100,arp_op=1,arp_sha=ae:bb:cc:5e:15:48,arp_tha=00:00:00:00:00:00)
2015-10-13T18:31:49.492Z|00006|ofproto_dpif_upcall(handler4)|INFO|received packet on unassociated datapath port 2
2015-10-13T18:31:52.492Z|00007|ofproto_dpif_upcall(handler4)|INFO|received packet on unassociated datapath port 2

 

Any pointers on where to look to troubleshoot this?

 

Regards,

Rajesh

 

 

$ sudo ovs-vsctl show

0d282c54-21c2-4217-b8e6-ef3e58267e01

    Bridge "br0"

        Port "br0"

            Interface "br0"

                type: internal

        Port "stt0"

            Interface "stt0"

                type: stt

                options: {key=flow, remote_ip="129.144.28.49"}

    ovs_version: "2.4.0"

 

$ sudo ovs-vsctl show

3ab12299-e790-4b33-8e73-7ee7eb25d398

    Bridge "br0"

        Port "stt0"

            Interface "stt0"

                type: stt

                options: {key=flow, remote_ip="129.144.27.61"}

        Port "br0"

            Interface "br0"

                type: internal

    ovs_version: "2.4.0"

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/94b7d77b/attachment.html>

From muralirdev at gmail.com  Tue Oct 13 13:28:59 2015
From: muralirdev at gmail.com (Murali R)
Date: Tue, 13 Oct 2015 15:28:59 -0500
Subject: [ovs-discuss] Setting up STT -- receive tunnel port not found
In-Reply-To: <19783cb4-208c-45ce-bd8b-4d2e649525b2@default>
References: <19783cb4-208c-45ce-bd8b-4d2e649525b2@default>
Message-ID: <CAO=R8okgzgoTBn1S_ddKHOf=d=yu75djW0E9j-azqW5m75MoUA@mail.gmail.com>

Did you check ovs-appctl dpctl/show to see tunnel port configurations?

On Tue, Oct 13, 2015 at 1:49 PM, Rajesh Chawla <rajesh.chawla at oracle.com>
wrote:

> Hi folks,
>
>
>
> I’m struggling to set up a simple STT connection between 2 nodes.
>
> I see a reasonable setup using ovs-vsctl show (see below), but when I try
> to
>
> ping using the bridge, I get the following error in the log file:
>
>
>
> 2015-10-13T18:31:49.492Z|00005|tunnel(handler4)|WARN|receive tunnel port
> not found
> (arp,tun_id=0x64,tun_src=10.106.15.34,tun_dst=10.106.15.30,tun_gbp_id=0,tun_gbp_flags=0,tun_tos=0,tun_ttl=63,csum|key,in_port=2,vlan_tci=0x0000,dl_src=ae:bb:cc:5e:15:48,dl_dst=ff:ff:ff:ff:ff:ff,arp_spa=10.1.2.1,arp_tpa=10.1.2.100,arp_op=1,arp_sha=ae:bb:cc:5e:15:48,arp_tha=00:00:00:00:00:00)
> 2015-10-13T18:31:49.492Z|00006|ofproto_dpif_upcall(handler4)|INFO|received
> packet on unassociated datapath port 2
> 2015-10-13T18:31:52.492Z|00007|ofproto_dpif_upcall(handler4)|INFO|received
> packet on unassociated datapath port 2
>
>
>
> Any pointers on where to look to troubleshoot this?
>
>
>
> Regards,
>
> Rajesh
>
>
>
>
>
> $ sudo ovs-vsctl show
>
> 0d282c54-21c2-4217-b8e6-ef3e58267e01
>
>     Bridge "br0"
>
>         Port "br0"
>
>             Interface "br0"
>
>                 type: internal
>
>         Port "stt0"
>
>             Interface "stt0"
>
>                 type: stt
>
>                 options: {key=flow, remote_ip="129.144.28.49"}
>
>     ovs_version: "2.4.0"
>
>
>
> $ sudo ovs-vsctl show
>
> 3ab12299-e790-4b33-8e73-7ee7eb25d398
>
>     Bridge "br0"
>
>         Port "stt0"
>
>             Interface "stt0"
>
>                 type: stt
>
>                 options: {key=flow, remote_ip="129.144.27.61"}
>
>         Port "br0"
>
>             Interface "br0"
>
>                 type: internal
>
>     ovs_version: "2.4.0"
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/2aa8406c/attachment.html>

From rajesh.chawla at oracle.com  Tue Oct 13 13:44:29 2015
From: rajesh.chawla at oracle.com (Rajesh Chawla)
Date: Tue, 13 Oct 2015 13:44:29 -0700 (PDT)
Subject: [ovs-discuss] Setting up STT -- receive tunnel port not found
In-Reply-To: <CAO=R8okgzgoTBn1S_ddKHOf=d=yu75djW0E9j-azqW5m75MoUA@mail.gmail.com>
References: <19783cb4-208c-45ce-bd8b-4d2e649525b2@default>
 <CAO=R8okgzgoTBn1S_ddKHOf=d=yu75djW0E9j-azqW5m75MoUA@mail.gmail.com>
Message-ID: <0c0a7803-e065-4bef-abdc-0b8b8515b26c@default>

I didn’t do that, however they look to be what I expect.

 

ovs-appctl dpctl/show

system at ovs-system:

        lookups: hit:465 missed:430 lost:0

        flows: 1

        masks: hit:467 total:1 hit/pkt:0.52

        port 0: ovs-system (internal)

        port 1: stt_sys_7471 (stt)

        port 2: br0 (internal)

 

Regards,

Rajesh

 

 

From: Murali R [mailto:muralirdev at gmail.com] 
Sent: Tuesday, October 13, 2015 2:29 PM
To: Rajesh Chawla
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Setting up STT -- receive tunnel port not found

 

Did you check ovs-appctl dpctl/show to see tunnel port configurations?

 

On Tue, Oct 13, 2015 at 1:49 PM, Rajesh Chawla <HYPERLINK "mailto:rajesh.chawla at oracle.com" \nrajesh.chawla at oracle.com> wrote:

Hi folks,

 

I’m struggling to set up a simple STT connection between 2 nodes.

I see a reasonable setup using ovs-vsctl show (see below), but when I try to 

ping using the bridge, I get the following error in the log file:

 

2015-10-13T18:31:49.492Z|00005|tunnel(handler4)|WARN|receive tunnel port not found (arp,tun_id=0x64,tun_src=10.106.15.34,tun_dst=10.106.15.30,tun_gbp_id=0,tun_gbp_flags=0,tun_tos=0,tun_ttl=63,csum|key,in_port=2,vlan_tci=0x0000,dl_src=ae:bb:cc:5e:15:48,dl_dst=ff:ff:ff:ff:ff:ff,arp_spa=10.1.2.1,arp_tpa=10.1.2.100,arp_op=1,arp_sha=ae:bb:cc:5e:15:48,arp_tha=00:00:00:00:00:00)
2015-10-13T18:31:49.492Z|00006|ofproto_dpif_upcall(handler4)|INFO|received packet on unassociated datapath port 2
2015-10-13T18:31:52.492Z|00007|ofproto_dpif_upcall(handler4)|INFO|received packet on unassociated datapath port 2

 

Any pointers on where to look to troubleshoot this?

 

Regards,

Rajesh

 

 

$ sudo ovs-vsctl show

0d282c54-21c2-4217-b8e6-ef3e58267e01

    Bridge "br0"

        Port "br0"

            Interface "br0"

                type: internal

        Port "stt0"

            Interface "stt0"

                type: stt

                options: {key=flow, remote_ip="129.144.28.49"}

    ovs_version: "2.4.0"

 

$ sudo ovs-vsctl show

3ab12299-e790-4b33-8e73-7ee7eb25d398

    Bridge "br0"

        Port "stt0"

            Interface "stt0"

                type: stt

                options: {key=flow, remote_ip="129.144.27.61"}

        Port "br0"

            Interface "br0"

                type: internal

    ovs_version: "2.4.0"

 


_______________________________________________
discuss mailing list
HYPERLINK "mailto:discuss at openvswitch.org"discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/1982de92/attachment-0001.html>

From muralirdev at gmail.com  Tue Oct 13 14:11:57 2015
From: muralirdev at gmail.com (Murali R)
Date: Tue, 13 Oct 2015 16:11:57 -0500
Subject: [ovs-discuss] Setting up STT -- receive tunnel port not found
In-Reply-To: <0c0a7803-e065-4bef-abdc-0b8b8515b26c@default>
References: <19783cb4-208c-45ce-bd8b-4d2e649525b2@default>
 <CAO=R8okgzgoTBn1S_ddKHOf=d=yu75djW0E9j-azqW5m75MoUA@mail.gmail.com>
 <0c0a7803-e065-4bef-abdc-0b8b8515b26c@default>
Message-ID: <CAO=R8okKdzN5Egr1nmbRwsw=mSeS1AbtrYfCEitVYRPubBBgzw@mail.gmail.com>

>From old logs
,in_port=2,vlan_tci=0x0000
does not look like same port receiving as configured. You might want to
check configuration.

On Tue, Oct 13, 2015 at 3:44 PM, Rajesh Chawla <rajesh.chawla at oracle.com>
wrote:

> I didn’t do that, however they look to be what I expect.
>
>
>
> ovs-appctl dpctl/show
>
> system at ovs-system:
>
>         lookups: hit:465 missed:430 lost:0
>
>         flows: 1
>
>         masks: hit:467 total:1 hit/pkt:0.52
>
>         port 0: ovs-system (internal)
>
>         port 1: stt_sys_7471 (stt)
>
>         port 2: br0 (internal)
>
>
>
> Regards,
>
> Rajesh
>
>
>
>
>
> *From:* Murali R [mailto:muralirdev at gmail.com]
> *Sent:* Tuesday, October 13, 2015 2:29 PM
> *To:* Rajesh Chawla
> *Cc:* discuss at openvswitch.org
> *Subject:* Re: [ovs-discuss] Setting up STT -- receive tunnel port not
> found
>
>
>
> Did you check ovs-appctl dpctl/show to see tunnel port configurations?
>
>
>
> On Tue, Oct 13, 2015 at 1:49 PM, Rajesh Chawla <rajesh.chawla at oracle.com>
> wrote:
>
> Hi folks,
>
>
>
> I’m struggling to set up a simple STT connection between 2 nodes.
>
> I see a reasonable setup using ovs-vsctl show (see below), but when I try
> to
>
> ping using the bridge, I get the following error in the log file:
>
>
>
> 2015-10-13T18:31:49.492Z|00005|tunnel(handler4)|WARN|receive tunnel port
> not found
> (arp,tun_id=0x64,tun_src=10.106.15.34,tun_dst=10.106.15.30,tun_gbp_id=0,tun_gbp_flags=0,tun_tos=0,tun_ttl=63,csum|key,in_port=2,vlan_tci=0x0000,dl_src=ae:bb:cc:5e:15:48,dl_dst=ff:ff:ff:ff:ff:ff,arp_spa=10.1.2.1,arp_tpa=10.1.2.100,arp_op=1,arp_sha=ae:bb:cc:5e:15:48,arp_tha=00:00:00:00:00:00)
> 2015-10-13T18:31:49.492Z|00006|ofproto_dpif_upcall(handler4)|INFO|received
> packet on unassociated datapath port 2
> 2015-10-13T18:31:52.492Z|00007|ofproto_dpif_upcall(handler4)|INFO|received
> packet on unassociated datapath port 2
>
>
>
> Any pointers on where to look to troubleshoot this?
>
>
>
> Regards,
>
> Rajesh
>
>
>
>
>
> $ sudo ovs-vsctl show
>
> 0d282c54-21c2-4217-b8e6-ef3e58267e01
>
>     Bridge "br0"
>
>         Port "br0"
>
>             Interface "br0"
>
>                 type: internal
>
>         Port "stt0"
>
>             Interface "stt0"
>
>                 type: stt
>
>                 options: {key=flow, remote_ip="129.144.28.49"}
>
>     ovs_version: "2.4.0"
>
>
>
> $ sudo ovs-vsctl show
>
> 3ab12299-e790-4b33-8e73-7ee7eb25d398
>
>     Bridge "br0"
>
>         Port "stt0"
>
>             Interface "stt0"
>
>                 type: stt
>
>                 options: {key=flow, remote_ip="129.144.27.61"}
>
>         Port "br0"
>
>             Interface "br0"
>
>                 type: internal
>
>     ovs_version: "2.4.0"
>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/a5a69280/attachment.html>

From rajesh.chawla at oracle.com  Tue Oct 13 16:04:54 2015
From: rajesh.chawla at oracle.com (Rajesh Chawla)
Date: Tue, 13 Oct 2015 16:04:54 -0700 (PDT)
Subject: [ovs-discuss] [openvswitch 2.4.0] testsuite: 739 failed
Message-ID: <76eb66c6-a165-42b4-b45f-20305853036a@default>

Commands use to execute:

 

$ wget http://openvswitch.org/releases/openvswitch-2.4.0.tar.gz

$ uname -r

3.8.13-68.2.2.2.el6uek.x86_64

$ ./configure --prefix=/usr --localstatedir=/var  --with-linux=/lib/modules/`uname -r`/build

make

make check

 

Regards,

Rajesh

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/eb6ece9a/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: testsuite.log
Type: application/octet-stream
Size: 290461 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151013/eb6ece9a/attachment-0001.obj>

From fbl at sysclose.org  Tue Oct 13 17:58:15 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Tue, 13 Oct 2015 21:58:15 -0300
Subject: [ovs-discuss] 2.3.2 kernel module build error on rhel7
In-Reply-To: <CALrtOxqFKb3=4f9PB6PgMBCSzqthsr=7D_CFqnzo4hK3mLhbpA@mail.gmail.com>
References: <CALrtOxoYw2AXz1j6pUzUjHFjL9V93J0Rzh=7YkEs2du3XCNy-w@mail.gmail.com>
 <CAEP_g=84uYQEpEY-qgMKx6t3yCf0i-Oh5Js-w9NKiwtArr=zgQ@mail.gmail.com>
 <CALrtOxqFKb3=4f9PB6PgMBCSzqthsr=7D_CFqnzo4hK3mLhbpA@mail.gmail.com>
Message-ID: <20151014005815.GA2399@x240.home>

On Tue, Oct 13, 2015 at 12:39:41AM +0000, Tashi Lu wrote:
> I didn't know RHEL 7 had OVS ko built in, thanks Jesse.

Just to be clear - RHEL-7 kernel package provides the
openvswitch.ko kernel module.

fbl


> 
> Jesse Gross <jesse at nicira.com>于2015年10月13日周二 08:29写道：
> 
> > On Sat, Oct 10, 2015 at 3:32 AM, Tashi Lu <dotslash.lu at gmail.com> wrote:
> > > Hi all,
> > >
> > > When building LTS version of ovs kernel module from tarball on CentOS 7,
> > > kernel version 3.10.0-229.el7.x86_64, I encountered following errors.
> > What I
> > > did wrong here?
> >
> > RHEL 7 has the OVS kernel module built in, so you shouldn't need to
> > build it at all. If you really want to use the out of tree module for
> > some reason, then OVS 2.4 should be compatible with RHEL 7.
> >

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss



From bansaldheeraj001 at gmail.com  Wed Oct 14 00:32:53 2015
From: bansaldheeraj001 at gmail.com (Dheeraj Bansal)
Date: Wed, 14 Oct 2015 13:02:53 +0530
Subject: [ovs-discuss] problem with enqueue action
Message-ID: <CAEYh4422YsXMPCwv2oXYcC+q7XSw7Jc6TG1+=HYGMb8evdvLuw@mail.gmail.com>

Hi All,

Can anyone tell me how to use enqueue action.

When i try to add the flow entry for actions=enqueue(1,1)
but it adds the flow with actions=drop.

I am using ovs-vsctl (Open vSwitch) 2.3.2

Regards
Dheeraj.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/f639e773/attachment.html>

From gal.sagie at gmail.com  Wed Oct 14 01:49:48 2015
From: gal.sagie at gmail.com (Gal Sagie)
Date: Wed, 14 Oct 2015 11:49:48 +0300
Subject: [ovs-discuss] status of ovn-docker
In-Reply-To: <CAHbON5prRCdFuM2zBQG_NL_0p611CN3accnvTYzZGXZNy9ZZpg@mail.gmail.com>
References: <738D45BC1F695740A983F43CFE1B7EA943839E24@IRSMSX108.ger.corp.intel.com>
 <CAHbON5pQvTxiJqDLf5gbxSifUgPENbjbd5HOqydHDqGSZcztQQ@mail.gmail.com>
 <738D45BC1F695740A983F43CFE1B7EA94383A52E@IRSMSX108.ger.corp.intel.com>
 <CAHbON5prRCdFuM2zBQG_NL_0p611CN3accnvTYzZGXZNy9ZZpg@mail.gmail.com>
Message-ID: <CAG9LJa5Yd5k7w3EPDcTe_MAcn47hPszurZztZ=9-HTBaNW-dJQ@mail.gmail.com>

Hi Mark,

If you are deploying this with OpenStack, it will be nice for you to be
familiar with project Kuryr.
I have written an introduction blog post about the project here:
http://galsagie.github.io/sdn/openstack/docker/kuryr/neutron/2015/08/24/kuryr-part1/

And an Integration of Kuryr and OVN blog post here:
http://galsagie.github.io/sdn/openstack/docker/kuryr/neutron/2015/10/10/kuryr-ovn/

In short Kuryr maps Docker APIs to Neutron API so you can use any Neutron
plugin for implementing
containers networking. (and OVN/OVS included)
We also plan to support special use cases for nested containers in VM (that
can expose OVN
feature of defining parent and child logical ports for this same use case)

We are now working as well on modifying all the changes needed due to
Docker 1.9 API changes.

Let me know if you have any questions.

Thanks
Gal.

On Tue, Oct 13, 2015 at 7:18 PM, Gurucharan Shetty <shettyg at nicira.com>
wrote:

> >
> > Yes, I presume this will be the preferred way of interfacing docker with
> ovs?
>
> Docker user facing APIs around networking is such that integration
> with OVS will need a control plane to provide the desired multi-host
> networking to work. OVN is an option for that. So OVN is one way to
> integrate Docker with OVS. It is not necessarily the only way as there
> are a lot of other people integrating Docker with OVS with their own
> control plane.
>
> >>
> >> If so, there has been a lot of changes in docker api over the last
> couple of
> >> weeks and that code no longer works. That is one of the reason I am
> >> maintaining it out of tree - libnetwork is still experimental and the
> APIs have
> >> been changing very often and it does not make sense for openvswitch to
> >> maintain experimental code.
> >>
> >> Docker 1.9 will likely remove the experimental tag. When that happens,
> I will
> >> get the code reviewed in the openvswitch mailing list to add it to
> >> openvswitch repo.
> >
> > How come it will not get upstreamed into the docker repo? Does this mean
> > that some special configuration will need be done in docker to get this
> > working?
>
> Docker's libnetwork works with REST APIs. So the driver, as long as it
> implements all the REST APIs that Docker expects can reside
> independently of Docker daemon. One way to install that driver is via
> OVN packaging.
>
> >
> >
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>



-- 
Best Regards ,

The G.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/278a0fad/attachment.html>

From benedikt.rudolph at ps.tu-darmstadt.de  Wed Oct 14 03:07:51 2015
From: benedikt.rudolph at ps.tu-darmstadt.de (Benedikt Rudolph)
Date: Wed, 14 Oct 2015 12:07:51 +0200
Subject: [ovs-discuss] mapping dpdk ports to physical nics
Message-ID: <561E2977.9030106@ps.tu-darmstadt.de>

Hi all,
I want to add specific dpdk enabled ports to a bridge following the
instructions in Install.DPDK.md.
My setup has multiple (i.e. 4) dpdk enabled nics ports.
So i created the bridge using:
> ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
and add an interface using
> ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk
I wonder if there is a way to address a specific (physical) dpdk port
other than *guessing* the number after “dpdk0“?

Previous to this step, I bound the nics to the igb_uio dpdk driver using
the PCI-ID. The tools, specifically the dpdk_nic_bind.py script that
comes with the dpdk 2.0 uses only PCI device IDs. There is on reference
to the index number after dpdk i.e. “dpdk0” in the scipt.

Thank you for your time,
Benedikt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/53e17d96/attachment.html>

From benoitne at gmail.com  Wed Oct 14 03:25:13 2015
From: benoitne at gmail.com (=?UTF-8?Q?Beno=c3=aet?=)
Date: Wed, 14 Oct 2015 12:25:13 +0200
Subject: [ovs-discuss] I want to connect bridge with wlan0(using hostapd)
In-Reply-To: <000001d105b0$65a4b0d0$30ee1270$@netsys.kaist.ac.kr>
References: <000001d105b0$65a4b0d0$30ee1270$@netsys.kaist.ac.kr>
Message-ID: <561E2D89.8030301@neviani.fr>

Hi,

I think I remember I had the same issue in the past and I would need to 
investigate again for my future installation where I need it.
I think I used this : 
https://github.com/hschaa/hostapd/blob/master/src/drivers/linux_ioctl.c 
and it was working.
without it I had the same issue you had

belette

On 10/13/15 14:12, sy.kim wrote:
>
> Hello,
>
> I’m now using hostapd 2.1 and openvswitch 2.0.2
>
> I want to make AP(wlan1) using hostapd and OVS (Not bridge-utils)
>
> When I used bidge-utils, AP worked well.
>
> However, When I changed bridge-utils to OVS bridge with same 
> configuration, below problem happens.
>
> Actually when I added port eth0 and wlan1, same problem happens.
>
> I think OVS bridge does not have any rule to process packet from wlan1
>
> I’m not sure
>
> Can you help me?
>
> Simply speaking, I want to connect *wlan1(AP mode using hostapd) – 
> bridge(OVS) – eth0 (Ethernet)*
>
> Thanks
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/54e7f7eb/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 54226 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/54e7f7eb/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 3325 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/54e7f7eb/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 5387 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/54e7f7eb/attachment-0005.png>

From bansaldheeraj001 at gmail.com  Wed Oct 14 03:30:18 2015
From: bansaldheeraj001 at gmail.com (Dheeraj Bansal)
Date: Wed, 14 Oct 2015 16:00:18 +0530
Subject: [ovs-discuss] Problem with ovs-ofctl -O openflow13 dump-flows for
	vlan_vid value
Message-ID: <CAEYh442pS6aTFLMb1Q4f1j+KrXdMpTc7thwT1G_GUMww17NoSw@mail.gmail.com>

Hi All,

Can anyone explain the following behavior to me:

When I add a flow entry to modify VLAN ID of the packet to x
it gets successfully added, but when I dump the flows for OpenFlow13 the
value of VLAN ID is always shown as "4096+x"

ovs-ofctl -O openflow13 add-flow br0 "actions=mod_vlan_vid:<100>"
ovs-ofctl -O openflow13 dump-flows br0
=>
cookie=0x0, duration=3995.186s, table=0, n_packets=0, n_bytes=0,
actions=push_vlan:0x8100,set_field:4196->vlan_vid


I am using ovs-vsctl (Open vSwitch) 2.3.2

Regards
Dheeraj Bansal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/97631ef6/attachment.html>

From pmaia at lasige.di.fc.ul.pt  Wed Oct 14 04:28:21 2015
From: pmaia at lasige.di.fc.ul.pt (Pedro Maia)
Date: Wed, 14 Oct 2015 12:28:21 +0100
Subject: [ovs-discuss] Problem with ovs-ofctl -O openflow13 dump-flows
	for vlan_vid value
In-Reply-To: <CAEYh442pS6aTFLMb1Q4f1j+KrXdMpTc7thwT1G_GUMww17NoSw@mail.gmail.com>
References: <CAEYh442pS6aTFLMb1Q4f1j+KrXdMpTc7thwT1G_GUMww17NoSw@mail.gmail.com>
Message-ID: <957E6E24-E08D-4099-A7D9-C7AFB90A5FCD@lasige.di.fc.ul.pt>

Hi Dheeraj,

The vlan id that shows up un dump-flows is, as you mentioned, always 4096+given_vlan_id, but if you look at the actual header of packets you will see that the vlan id is correct. 
It’s the way ovs works, i don’t remember for sure the reason for it tho (i think it uses them internally).

Regards,
Pedro


> On 14 Oct 2015, at 11:30, Dheeraj Bansal <bansaldheeraj001 at gmail.com> wrote:
> 
> Hi All,
> 
> Can anyone explain the following behavior to me:
> 
> When I add a flow entry to modify VLAN ID of the packet to x
> it gets successfully added, but when I dump the flows for OpenFlow13 the value of VLAN ID is always shown as "4096+x"
> 
> ovs-ofctl -O openflow13 add-flow br0 "actions=mod_vlan_vid:<100>"
> ovs-ofctl -O openflow13 dump-flows br0
> =>
> cookie=0x0, duration=3995.186s, table=0, n_packets=0, n_bytes=0, actions=push_vlan:0x8100,set_field:4196->vlan_vid
> 
> 
> I am using ovs-vsctl (Open vSwitch) 2.3.2
> 
> Regards
> Dheeraj Bansal
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/16e8d02e/attachment.html>

From dev_raj82 at yahoo.com  Tue Oct 13 10:17:00 2015
From: dev_raj82 at yahoo.com (Nishanth Devarajan)
Date: Tue, 13 Oct 2015 22:47:00 +0530
Subject: [ovs-discuss] Unable to create a port on OVS bridge
In-Reply-To: <CAHbON5piinGiXO3fzGXHyZ-UJCXi_D+XHH3dNtgANR01qJOrrA@mail.gmail.com>
References: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>
 <CAHbON5qtTDHc4Hx_muXs9d4B+0xKyf04nNoH=oOU+FRmhneVfA@mail.gmail.com>
 <7535310D-4EEA-4766-8825-C4655066BAC4@yahoo.com>
 <CAHbON5piinGiXO3fzGXHyZ-UJCXi_D+XHH3dNtgANR01qJOrrA@mail.gmail.com>
Message-ID: <83329887-1CE1-4ACD-9A9E-67B41C56ABCC@yahoo.com>

No I don’t know what Im doing very well. How exactly do I uninstall one of them completely so that I don’t get this problem? Also thanks :)
> On 13-Oct-2015, at 9:55 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
> 
> On Tue, Oct 13, 2015 at 9:01 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
>> It says;
>> /usr/sbin/ovs-vswitchd
>> /usr/local/sbin/ovs-vswitchd
> 
> The error message in your log file says that there was already a
> ovs-vswitchd running. It is likely that since you have 2 ovs-vswitchd
> installed in your system, one of them has already been started with a
> startup script. So when you start the other one, it complained saying
> that another one has already been started.
> 
> You having 2 ovs-vswitchd in /usr/sbin/ and /usr/local/sbin/ also
> tells me that you likely installed one using 'make install' and the
> other using rpm or ubuntu packages. I strongly suggest to uninstall
> one of them (unless you know very well what you are doing)


From haristanvir at hotmail.com  Tue Oct 13 12:21:50 2015
From: haristanvir at hotmail.com (haris tanvir)
Date: Wed, 14 Oct 2015 00:21:50 +0500
Subject: [ovs-discuss] Cannot add dpdkvhost user ports
In-Reply-To: <74F120C019F4A64C9B78E802F6AD4CC24F79A470@IRSMSX102.ger.corp.intel.com>
References: <SNT151-W7689A3FB9779F02B79B3CCB8300@phx.gbl>,
 <74F120C019F4A64C9B78E802F6AD4CC24F79A470@IRSMSX102.ger.corp.intel.com>
Message-ID: <SNT151-W378393368C7587A22BF016B8300@phx.gbl>

Hi Ciara,Yes i have made sure that 'CONFIG_RTE_LIBRTE_VHOST_USER=y ' is also checked (It is checked by default)But the problem persists.
RegardsHaris 

> From: ciara.loftus at intel.com
> To: haristanvir at hotmail.com
> CC: discuss at openvswitch.org
> Subject: RE: [ovs-discuss] Cannot add dpdkvhost user ports
> Date: Tue, 13 Oct 2015 16:23:38 +0000
> 
> > 
> > Hi,
> > I am trying to add in dpdkvhostuser ports in openvswitch 2.4
> > I have followed all the steps described in following documentation
> > http://www.ran-lifshitz.com/2015/06/17/open-vswitch-netdev-dpdk-with-
> > vhost-user-support/
> > I have made sure that following checks are enabled when i build dpdk
> > CONFIG_RTE_BUILD_COMBINE_LIBS=y
> > CONFIG_RTE_LIBRTE_VHOST=y
> > 
> > After all the steps, i am able to add ports of type 'dpdk' but when i add port
> > of type 'dpdkvhostuser', it throws out following error in the logs
> > bridge|WARN|could not open network device dpdkvhost0 (Address family
> > not supported by protocol)
> > 
> > And surprisingly, it adds ports of 'vhostcuse' just fine, even though i have
> > made sure a thousand times that i have checked vhostuser flag rather than
> > vhostcuse flag (CONFIG_RTE_LIBRTE_VHOST=y in
> Make sure that CONFIG_RTE_LIBRTE_VHOST_USER=y too.
> 
> > dpdk2.0.0/config/linux_common . Infact i have not even loaded 'cuse'
> > module.
> > 
> > Can someone please point it some step im missing?
> > 
> > Thanks
> > 
> > Regards
> > Haris Tanvir
> > 
> > 
> > 
> > 
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/eed49156/attachment-0001.html>

From leo.zhu510 at gmail.com  Tue Oct 13 20:30:49 2015
From: leo.zhu510 at gmail.com (leo zhu)
Date: Wed, 14 Oct 2015 11:30:49 +0800
Subject: [ovs-discuss] Packet size can not exceed 978 bytes when ovs-dpdk
 user space vxlan is used
Message-ID: <CALzAW8QZQNYLftyToUxY-qgF6srU8fboqgeDwZn5xFMP-Owgjw@mail.gmail.com>

Hi all,

I am testing the ovs-dpdk user space vxlan performance.

My topology is as follow:



DPDK pktgen is used to send packet in my test.


In the test process, I found that the packet size can not exceed 978 bytes.
If the packet size is

larger than 978 bytes, the packet that was sent by pktgen on server 3 can
not reach to server 4,

the traffic between server 3 and server 4 was blocked.


Does anybody know why?


Thanks.

Leo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/8255fc99/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Untitled.png
Type: image/png
Size: 105202 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/8255fc99/attachment-0001.png>

From blp at nicira.com  Wed Oct 14 08:39:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 14 Oct 2015 08:39:29 -0700
Subject: [ovs-discuss] Problem with ovs-ofctl -O openflow13 dump-flows
 for vlan_vid value
In-Reply-To: <CAEYh442pS6aTFLMb1Q4f1j+KrXdMpTc7thwT1G_GUMww17NoSw@mail.gmail.com>
References: <CAEYh442pS6aTFLMb1Q4f1j+KrXdMpTc7thwT1G_GUMww17NoSw@mail.gmail.com>
Message-ID: <20151014153929.GA14161@nicira.com>

On Wed, Oct 14, 2015 at 04:00:18PM +0530, Dheeraj Bansal wrote:
> Can anyone explain the following behavior to me:
> 
> When I add a flow entry to modify VLAN ID of the packet to x
> it gets successfully added, but when I dump the flows for OpenFlow13 the
> value of VLAN ID is always shown as "4096+x"
> 
> ovs-ofctl -O openflow13 add-flow br0 "actions=mod_vlan_vid:<100>"
> ovs-ofctl -O openflow13 dump-flows br0
> =>
> cookie=0x0, duration=3995.186s, table=0, n_packets=0, n_bytes=0,
> actions=push_vlan:0x8100,set_field:4196->vlan_vid

OpenFlow 1.2 and later say that bit 12 is always set in OXM_OF_VLAN_VID
when a VLAN header is present, so Open vSwitch is accurately
implementing that.

From blp at nicira.com  Wed Oct 14 08:42:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 14 Oct 2015 08:42:43 -0700
Subject: [ovs-discuss] problem with enqueue action
In-Reply-To: <CAEYh4422YsXMPCwv2oXYcC+q7XSw7Jc6TG1+=HYGMb8evdvLuw@mail.gmail.com>
References: <CAEYh4422YsXMPCwv2oXYcC+q7XSw7Jc6TG1+=HYGMb8evdvLuw@mail.gmail.com>
Message-ID: <20151014154243.GB14161@nicira.com>

On Wed, Oct 14, 2015 at 01:02:53PM +0530, Dheeraj Bansal wrote:
> Can anyone tell me how to use enqueue action.
> 
> When i try to add the flow entry for actions=enqueue(1,1)
> but it adds the flow with actions=drop.

Works fine here.

$ ovs-vsctl add-br br0
$ ovs-ofctl add-flow br0 "actions=enqueue(1,1)"
$ ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=16.119s, table=0, n_packets=0, n_bytes=0, idle_age=16, priority=0 actions=NORMAL
 cookie=0x0, duration=5.028s, table=0, n_packets=0, n_bytes=0, idle_age=5, actions=enqueue:1:1
$ 

From sugesh.chandran at intel.com  Wed Oct 14 09:18:04 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Wed, 14 Oct 2015 16:18:04 +0000
Subject: [ovs-discuss] Packet size can not exceed 978 bytes when
 ovs-dpdk user space vxlan is used
In-Reply-To: <CALzAW8QZQNYLftyToUxY-qgF6srU8fboqgeDwZn5xFMP-Owgjw@mail.gmail.com>
References: <CALzAW8QZQNYLftyToUxY-qgF6srU8fboqgeDwZn5xFMP-Owgjw@mail.gmail.com>
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB13CCA20D@IRSMSX102.ger.corp.intel.com>



Regards
_Sugesh

From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of leo zhu
Sent: Wednesday, October 14, 2015 4:31 AM
To: discuss at openvswitch.org
Subject: [ovs-discuss] Packet size can not exceed 978 bytes when ovs-dpdk user space vxlan is used

Hi all,
I am testing the ovs-dpdk user space vxlan performance.
My topology is as follow:

[cid:image001.jpg at 01D106A4.488D5480]

DPDK pktgen is used to send packet in my test.

In the test process, I found that the packet size can not exceed 978 bytes. If the packet size is
larger than 978 bytes, the packet that was sent by pktgen on server 3 can not reach to server 4,
the traffic between server 3 and server 4 was blocked.
>>>> Can you please confirm whats the MTU value for each interfaces??
>>>>> If the MTU value is sufficient enough, can you please check the“sudo ovs-appctl dpctl/show –s” output to know at which interface the packets getting dropped
Does anybody know why?

Thanks.
Leo


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/540af1b0/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 22228 bytes
Desc: image001.jpg
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/540af1b0/attachment-0001.jpg>

From er.manpreet25 at gmail.com  Wed Oct 14 09:19:11 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Wed, 14 Oct 2015 21:49:11 +0530
Subject: [ovs-discuss] incorrect error code arrived
Message-ID: <CALD=K8s1cOhapPgsTiJ2xF7Bv+rtACwrF0WUXSzxa7dS=1q+0A@mail.gmail.com>

Hello Team,

I am working on OVS-2.3.2. I am changing the switch role to slave, after
slave role is set, sending FlowMod Message from controller.

According Openflow Spec in this case the switch must respond with OFPBRC_IS_
SLAVE error code but it respond with OFPBRC_EPERM error code.

Have anyone faced this issue?

Regards,
Manpreet Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/bb4c4c05/attachment.html>

From timox.puha at intel.com  Wed Oct 14 10:20:18 2015
From: timox.puha at intel.com (Puha, TimoX)
Date: Wed, 14 Oct 2015 17:20:18 +0000
Subject: [ovs-discuss] Cannot add dpdkvhost user ports
In-Reply-To: <SNT151-W378393368C7587A22BF016B8300@phx.gbl>
References: <SNT151-W7689A3FB9779F02B79B3CCB8300@phx.gbl>,
 <74F120C019F4A64C9B78E802F6AD4CC24F79A470@IRSMSX102.ger.corp.intel.com>
 <SNT151-W378393368C7587A22BF016B8300@phx.gbl>
Message-ID: <456300C4CD33BD44AED515BB2F77D5C0FA49D1@IRSMSX103.ger.corp.intel.com>

Hi,

I think 2.4 still has also this problem (http://openvswitch.org/pipermail/dev/2015-September/060106.html) and your symptoms seem to match. So if you used a relative path to DPDK when running OVS configure, you should do configure and build again with an absolute path to DPDK.

-Timo

From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of haris tanvir
Sent: Tuesday, October 13, 2015 12:22 PM
To: Loftus, Ciara
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Cannot add dpdkvhost user ports

Hi Ciara,
Yes i have made sure that 'CONFIG_RTE_LIBRTE_VHOST_USER=y ' is also checked (It is checked by default)
But the problem persists.

Regards
Haris


> From: ciara.loftus at intel.com<mailto:ciara.loftus at intel.com>
> To: haristanvir at hotmail.com<mailto:haristanvir at hotmail.com>
> CC: discuss at openvswitch.org<mailto:discuss at openvswitch.org>
> Subject: RE: [ovs-discuss] Cannot add dpdkvhost user ports
> Date: Tue, 13 Oct 2015 16:23:38 +0000
>
> >
> > Hi,
> > I am trying to add in dpdkvhostuser ports in openvswitch 2.4
> > I have followed all the steps described in following documentation
> > http://www.ran-lifshitz.com/2015/06/17/open-vswitch-netdev-dpdk-with-
> > vhost-user-support/
> > I have made sure that following checks are enabled when i build dpdk
> > CONFIG_RTE_BUILD_COMBINE_LIBS=y
> > CONFIG_RTE_LIBRTE_VHOST=y
> >
> > After all the steps, i am able to add ports of type 'dpdk' but when i add port
> > of type 'dpdkvhostuser', it throws out following error in the logs
> > bridge|WARN|could not open network device dpdkvhost0 (Address family
> > not supported by protocol)
> >
> > And surprisingly, it adds ports of 'vhostcuse' just fine, even though i have
> > made sure a thousand times that i have checked vhostuser flag rather than
> > vhostcuse flag (CONFIG_RTE_LIBRTE_VHOST=y in
> Make sure that CONFIG_RTE_LIBRTE_VHOST_USER=y too.
>
> > dpdk2.0.0/config/linux_common . Infact i have not even loaded 'cuse'
> > module.
> >
> > Can someone please point it some step im missing?
> >
> > Thanks
> >
> > Regards
> > Haris Tanvir
> >
> >
> >
> >
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/22363cc1/attachment-0001.html>

From blp at nicira.com  Wed Oct 14 10:25:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 14 Oct 2015 10:25:13 -0700
Subject: [ovs-discuss] incorrect error code arrived
In-Reply-To: <CALD=K8s1cOhapPgsTiJ2xF7Bv+rtACwrF0WUXSzxa7dS=1q+0A@mail.gmail.com>
References: <CALD=K8s1cOhapPgsTiJ2xF7Bv+rtACwrF0WUXSzxa7dS=1q+0A@mail.gmail.com>
Message-ID: <20151014172513.GA16953@nicira.com>

On Wed, Oct 14, 2015 at 09:49:11PM +0530, Manpreet Singh wrote:
> I am working on OVS-2.3.2. I am changing the switch role to slave, after
> slave role is set, sending FlowMod Message from controller.
> 
> According Openflow Spec in this case the switch must respond with OFPBRC_IS_
> SLAVE error code but it respond with OFPBRC_EPERM error code.
> 
> Have anyone faced this issue?

Ask the same question, get the same answer:
        http://openvswitch.org/pipermail/discuss/2015-September/018872.html

From er.manpreet25 at gmail.com  Wed Oct 14 10:51:02 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Wed, 14 Oct 2015 23:21:02 +0530
Subject: [ovs-discuss] incorrect error code arrived
In-Reply-To: <20151014172513.GA16953@nicira.com>
References: <CALD=K8s1cOhapPgsTiJ2xF7Bv+rtACwrF0WUXSzxa7dS=1q+0A@mail.gmail.com>
 <20151014172513.GA16953@nicira.com>
Message-ID: <CALD=K8t-CNDyHPdDLNKRTa39mf-Y3ixmVgDsVFuKXYR1VQynXw@mail.gmail.com>

Thanks Ben For Reply!!!!!!

Regards,
Manpreet singh

On Wednesday, 14 October 2015, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Oct 14, 2015 at 09:49:11PM +0530, Manpreet Singh wrote:
> > I am working on OVS-2.3.2. I am changing the switch role to slave, after
> > slave role is set, sending FlowMod Message from controller.
> >
> > According Openflow Spec in this case the switch must respond with
> OFPBRC_IS_
> > SLAVE error code but it respond with OFPBRC_EPERM error code.
> >
> > Have anyone faced this issue?
>
> Ask the same question, get the same answer:
>
> http://openvswitch.org/pipermail/discuss/2015-September/018872.html
>


-- 
Sent from iphone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/73433e2f/attachment.html>

From mehtaneeraj07 at gmail.com  Wed Oct 14 11:06:03 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Wed, 14 Oct 2015 23:36:03 +0530
Subject: [ovs-discuss] How to use oxm match structure
Message-ID: <CAHN905+D2ZUacKL++bkTBaAQd6b-3jSiPG9=DdGP8pJfD1Uazw@mail.gmail.com>

Hi

I am working on OVS-2.3.2.I want to use oxm match structure for the
matching of packets.
Can anyone please share the procedure to add flow entry for this from
ovs-ofctl.

Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/3524380f/attachment.html>

From mehtaneeraj07 at gmail.com  Wed Oct 14 11:10:38 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Wed, 14 Oct 2015 23:40:38 +0530
Subject: [ovs-discuss] problem with enqueue action
In-Reply-To: <20151014154243.GB14161@nicira.com>
References: <CAEYh4422YsXMPCwv2oXYcC+q7XSw7Jc6TG1+=HYGMb8evdvLuw@mail.gmail.com>
 <20151014154243.GB14161@nicira.com>
Message-ID: <CAHN905J8ndTyMcxFSsj7=k-r4gyUTuttCKSNwLc_TAJ93TSU7Q@mail.gmail.com>

Hello Ben,

I also faced the same issue. If you try dump flows with -O Openflow13 then
it will show the action as drop.

Regards
Neeraj

On Wednesday, October 14, 2015, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Oct 14, 2015 at 01:02:53PM +0530, Dheeraj Bansal wrote:
> > Can anyone tell me how to use enqueue action.
> >
> > When i try to add the flow entry for actions=enqueue(1,1)
> > but it adds the flow with actions=drop.
>
> Works fine here.
>
> $ ovs-vsctl add-br br0
> $ ovs-ofctl add-flow br0 "actions=enqueue(1,1)"
> $ ovs-ofctl dump-flows br0
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=16.119s, table=0, n_packets=0, n_bytes=0,
> idle_age=16, priority=0 actions=NORMAL
>  cookie=0x0, duration=5.028s, table=0, n_packets=0, n_bytes=0, idle_age=5,
> actions=enqueue:1:1
> $
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org <javascript:;>
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151014/42882212/attachment.html>

From shettyg at nicira.com  Wed Oct 14 11:21:08 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Wed, 14 Oct 2015 11:21:08 -0700
Subject: [ovs-discuss] Unable to create a port on OVS bridge
In-Reply-To: <E071EAC8-CE38-49FC-A872-361E55F1BBBA@yahoo.com>
References: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>
 <CAHbON5qtTDHc4Hx_muXs9d4B+0xKyf04nNoH=oOU+FRmhneVfA@mail.gmail.com>
 <7535310D-4EEA-4766-8825-C4655066BAC4@yahoo.com>
 <CAHbON5piinGiXO3fzGXHyZ-UJCXi_D+XHH3dNtgANR01qJOrrA@mail.gmail.com>
 <83329887-1CE1-4ACD-9A9E-67B41C56ABCC@yahoo.com>
 <CAHbON5qWqcm78W8cmZN_PFTyfj1DOw9gRFM+dckKo63AgoamsQ@mail.gmail.com>
 <E071EAC8-CE38-49FC-A872-361E55F1BBBA@yahoo.com>
Message-ID: <CAHbON5rNUY0Ryrv9X96ofT+UF4O=MwZWiS4=DTvk4P_XJzo2FA@mail.gmail.com>

What is that you want to do at a high level? i.e. what is your goal?

On Wed, Oct 14, 2015 at 6:46 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
> I tried, I don’t know why but it doesn’t work. I even tried removing OVS entirely and reinstalling it again. Even then it gives the same error. However when I run mininet , the topology works fine without any error from OVS or anything else. How does that even work?
>
> Thanks,
> Nishanth
>> On 13-Oct-2015, at 11:35 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>
>> Where ever you did a 'make install', do a 'make uninstall'. The end
>> result should be that 'find /usr -name ovs-vswitchd' should only say
>> /usr/sbin/ovs-vswitchd.
>>
>> Then:
>> ps -ef | grep ovs
>>
>> Kill both ovs-vswitchd and ovsdb-server processes using 'kill'.
>>
>>
>> Then do '/etc/init.d/openvswitch start'
>>
>> On Tue, Oct 13, 2015 at 10:17 AM, Nishanth Devarajan
>> <dev_raj82 at yahoo.com> wrote:
>>> No I don’t know what Im doing very well. How exactly do I uninstall one of them completely so that I don’t get this problem? Also thanks :)
>>>> On 13-Oct-2015, at 9:55 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>>>
>>>> On Tue, Oct 13, 2015 at 9:01 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
>>>>> It says;
>>>>> /usr/sbin/ovs-vswitchd
>>>>> /usr/local/sbin/ovs-vswitchd
>>>>
>>>> The error message in your log file says that there was already a
>>>> ovs-vswitchd running. It is likely that since you have 2 ovs-vswitchd
>>>> installed in your system, one of them has already been started with a
>>>> startup script. So when you start the other one, it complained saying
>>>> that another one has already been started.
>>>>
>>>> You having 2 ovs-vswitchd in /usr/sbin/ and /usr/local/sbin/ also
>>>> tells me that you likely installed one using 'make install' and the
>>>> other using rpm or ubuntu packages. I strongly suggest to uninstall
>>>> one of them (unless you know very well what you are doing)
>>>
>

From blp at nicira.com  Wed Oct 14 13:44:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 14 Oct 2015 13:44:17 -0700
Subject: [ovs-discuss] [openvswitch 2.4.0] testsuite: 739 failed
In-Reply-To: <76eb66c6-a165-42b4-b45f-20305853036a@default>
References: <76eb66c6-a165-42b4-b45f-20305853036a@default>
Message-ID: <20151014204417.GD16953@nicira.com>

On Tue, Oct 13, 2015 at 04:04:54PM -0700, Rajesh Chawla wrote:
> Commands use to execute:
> 
>  
> 
> $ wget http://openvswitch.org/releases/openvswitch-2.4.0.tar.gz
> 
> $ uname -r
> 
> 3.8.13-68.2.2.2.el6uek.x86_64
> 
> $ ./configure --prefix=/usr --localstatedir=/var  --with-linux=/lib/modules/`uname -r`/build
> 
> make
> 
> make check

This looks like a bug in the testsuite rather than in OVS itself.  I
think that you can safely ignore the failure.

From blp at nicira.com  Wed Oct 14 15:01:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 14 Oct 2015 15:01:20 -0700
Subject: [ovs-discuss] problem with enqueue action
In-Reply-To: <CAHN905J8ndTyMcxFSsj7=k-r4gyUTuttCKSNwLc_TAJ93TSU7Q@mail.gmail.com>
References: <CAEYh4422YsXMPCwv2oXYcC+q7XSw7Jc6TG1+=HYGMb8evdvLuw@mail.gmail.com>
 <20151014154243.GB14161@nicira.com>
 <CAHN905J8ndTyMcxFSsj7=k-r4gyUTuttCKSNwLc_TAJ93TSU7Q@mail.gmail.com>
Message-ID: <20151014220120.GB18657@nicira.com>

OpenFlow 1.1 and later do not have an enqueue action, so it's a problem.
If it is important to you, then you could send a patch that adds an Open
vSwitch extension "enqueue" action to OpenFlow 1.1 and later.

On Wed, Oct 14, 2015 at 11:40:38PM +0530, neeraj mehta wrote:
> I also faced the same issue. If you try dump flows with -O Openflow13 then
> it will show the action as drop.
> 
> Regards
> Neeraj
> 
> On Wednesday, October 14, 2015, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Oct 14, 2015 at 01:02:53PM +0530, Dheeraj Bansal wrote:
> > > Can anyone tell me how to use enqueue action.
> > >
> > > When i try to add the flow entry for actions=enqueue(1,1)
> > > but it adds the flow with actions=drop.
> >
> > Works fine here.
> >
> > $ ovs-vsctl add-br br0
> > $ ovs-ofctl add-flow br0 "actions=enqueue(1,1)"
> > $ ovs-ofctl dump-flows br0
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=16.119s, table=0, n_packets=0, n_bytes=0,
> > idle_age=16, priority=0 actions=NORMAL
> >  cookie=0x0, duration=5.028s, table=0, n_packets=0, n_bytes=0, idle_age=5,
> > actions=enqueue:1:1
> > $
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org <javascript:;>
> > http://openvswitch.org/mailman/listinfo/discuss
> >

From blp at nicira.com  Wed Oct 14 15:02:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 14 Oct 2015 15:02:52 -0700
Subject: [ovs-discuss] How to use oxm match structure
In-Reply-To: <CAHN905+D2ZUacKL++bkTBaAQd6b-3jSiPG9=DdGP8pJfD1Uazw@mail.gmail.com>
References: <CAHN905+D2ZUacKL++bkTBaAQd6b-3jSiPG9=DdGP8pJfD1Uazw@mail.gmail.com>
Message-ID: <20151014220252.GC18657@nicira.com>

On Wed, Oct 14, 2015 at 11:36:03PM +0530, neeraj mehta wrote:
> I am working on OVS-2.3.2.I want to use oxm match structure for the
> matching of packets.
> Can anyone please share the procedure to add flow entry for this from
> ovs-ofctl.

The FAQ says the following.

### Q: How do I add support for a new field or header?

A: Add new members for your field to "struct flow" in lib/flow.h, and
   add new enumerations for your new field to "enum mf_field_id" in
   lib/meta-flow.h, following the existing pattern.  Also, add support
   to miniflow_extract() in lib/flow.c for extracting your new field
   from a packet into struct miniflow.  Then recompile and fix all of
   the new warnings, implementing new functionality for the new field
   or header as needed.  (If you configure with --enable-Werror, as
   described in [INSTALL.md], then it is impossible to miss any
   warnings.)

   If you want kernel datapath support for your new field, you also
   need to modify the kernel module for the operating systems you are
   interested in.  This isn't mandatory, since fields understood only
   by userspace work too (with a performance penalty), so it's
   reasonable to start development without it.  If you implement
   kernel module support for Linux, then the Linux kernel "netdev"
   mailing list is the place to submit that support first; please read
   up on the Linux kernel development process separately.  The Windows
   datapath kernel module support, on the other hand, is maintained
   within the OVS tree, so patches for that can go directly to
   ovs-dev.

From blp at nicira.com  Wed Oct 14 17:13:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 14 Oct 2015 17:13:13 -0700
Subject: [ovs-discuss] insert-buckets support?
In-Reply-To: <CA+=-Fx--d8NnW3HUui_iW2=m06PYaLmN3_706i5wVTFCw8YCxA@mail.gmail.com>
References: <CA+=-Fx-qpP4sTypqox1i7zTS0x4=yyo19_0LGSwriv2uXTz9kQ@mail.gmail.com>
 <20150910202113.GA20003@nicira.com>
 <CA+=-Fx-p1MDLR9jBaY0b-SW5kuHtmoqJ7UPkpFKgEXzod2uszQ@mail.gmail.com>
 <20150910215652.GC25835@nicira.com>
 <CA+=-Fx_5TOK-EjoWxTsvDycO4-27FB0OBR06LucmcQiX0mpjYQ@mail.gmail.com>
 <CA+=-Fx--d8NnW3HUui_iW2=m06PYaLmN3_706i5wVTFCw8YCxA@mail.gmail.com>
Message-ID: <20151015001313.GG18657@nicira.com>

Wow, this code is such a disaster.

I sent out a fix:
        http://openvswitch.org/pipermail/dev/2015-October/061212.html

On Fri, Sep 11, 2015 at 01:58:43PM -0700, Ray Li wrote:
> Hi, here's another issue. If I create an empty group first without buckets,
> and then run insert-buckets with command_bucket_id=last, it will fail to
> add the bucket and somehow delete the empty group. it works if I ran
> insert-buckets with command_bucket_id=first though.
> 
> On Thu, Sep 10, 2015 at 5:10 PM, Ray Li <rayli1107 at gmail.com> wrote:
> 
> > Hi, I've ran into another issue. I'm trying this on a new environment.
> > When I tried to add a group for the first time using OpenFlow15 with
> > bucket_id, I got an OFPBAC_BAD_LEN error. It worked though when I tried to
> > add a group using OpenFlow11 without bucket_id. Any idea what this means?
> >
> > ovs-ofctl add-group br1 group_id=0,type=all,bucket="actions=output:10" -O
> > OpenFlow11
> > (This works.)
> >
> > ovs-ofctl del-groups br1 -O OpenFlow11
> >
> > ovs-ofctl add-group br1
> > group_id=0,type=all,bucket="bucket_id=100,actions=output:10" -O OpenFlow15
> > OFPT_ERROR (OF1.5) (xid=0x2): OFPBAC_BAD_LEN
> > OFPT_GROUP_MOD (OF1.5) (xid=0x2):
> >  ADD group_id=0,type=all,bucket=bucket_id:100,actions=output:10
> >
> > When I looked at the log files it shows:
> > 2015-09-11T00:08:59.622Z|00437|ofp_actions|WARN|bad action at offset 0
> > (OFPBAC_BAD_LEN):
> > 00000000  00 00 00 10 00 00 00 0a-
> > 2015-09-11T00:08:59.622Z|00438|connmgr|INFO|br0_vxlan<->unix: sending
> > OFPBAC_BAD_LEN error reply to OFPT_GROUP_MOD message
> >
> >
> >
> > Thanks
> >
> >
> >
> > On Thu, Sep 10, 2015 at 2:56 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> >> With the current behavior, insert-buckets doesn't automatically allocate
> >> non-overlapping bucket ids.  This could be considered a bug in the
> >> documentation or in the code.  It would be more user-friendly to
> >> consider a bug in the code and fix it in ovs-ofctl, but that's a bigger
> >> job than just fixing the crash as these commits do.
> >>
> >> On Thu, Sep 10, 2015 at 02:51:03PM -0700, Ray Li wrote:
> >> > According to ovs-ofctl's man page, if no bucket_id is specified it's
> >> > support to allocate one. Is that not being done? Or is that the bug
> >> itself?
> >> >
> >> > On Thu, Sep 10, 2015 at 1:21 PM, Ben Pfaff <blp at nicira.com> wrote:
> >> >
> >> > > On Thu, Sep 10, 2015 at 11:46:16AM -0700, Ray Li wrote:
> >> > > > Does OVS 2.4 support ovs-ofctl insert-buckets?
> >> > > >
> >> > > > I just upgraded to OVS 2.4.0, and here's what I tried to do:
> >> > > >
> >> > > > ovs-vsctl set bridge br0
> >> > > >
> >> > >
> >> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
> >> > > >
> >> > > > ovs-ofctl add-group br0
> >> group_id=0,type=all,bucket="actions=output:10" -O
> >> > > > OpenFlow11
> >> > > >
> >> > > > ovs-ofctl dump-groups br0 -O OpenFlow11
> >> > > > (which shows the groups table correctly with a single bucket)
> >> > > >
> >> > > > ovs-ofctl insert-buckets br0
> >> > > > group_id=0,command_bucket_id=last,bucket="actions=output:1" -O
> >> OpenFlow15
> >> > > >
> >> > > > ovs-ofctl dump-groups br0 -O OpenFlow11
> >> > > > (This then hangs indefinitely)
> >> > >
> >> > > It's a bug, thanks for reporting it.
> >> > >
> >> > > The underlying problem is that in both cases no bucket_id was
> >> specified,
> >> > > so it defaults to the same value in each case, and duplicate bucket
> >> IDs
> >> > > were not correctly handled.  You can avoid the problem by specifying a
> >> > > different bucket_it in your "insert-buckets" command.
> >> > >
> >> > > I posted a fix.  You can test it by applying the following two
> >> patches,
> >> > > in this order:
> >> > >
> >> http://openvswitch.org/pipermail/dev/2015-September/059865.html
> >> > >
> >> http://openvswitch.org/pipermail/dev/2015-September/059864.html
> >> > >
> >>
> >
> >

From 947835908 at qq.com  Thu Oct 15 01:47:51 2015
From: 947835908 at qq.com (=?ISO-8859-1?B?WUI=?=)
Date: Thu, 15 Oct 2015 16:47:51 +0800
Subject: [ovs-discuss] can I set the counters of the to-be-installed rule
	when adding a new rule to the flow table?
Message-ID: <tencent_51A9BA921766A00433C13B14@qq.com>

Hi all,


Can I set the counters of the to-be-installed rule when adding a new rule to the flow table?


To be more specific, ( ovs-ofctl add-flow s1 "in_port=2 actions=output:3" ) can add a new rule in switch s1.
With dump-flows command, we can see something like:
"... n_packets=0, n_bytes=0,..., in_port=2, actions=output:3...".



So, my question is can I set the field of "n_packets"/"n_bytes" to an arbitrary number as desired?
Is is possible?
If yes, how?


Also, if it is not possible in OpenVswitch, do any commercial physical SDN switches support this?


Thanks a lot!


Best regards,
Bin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151015/06c38f90/attachment-0001.html>

From daniel.herrmann1 at gmail.com  Thu Oct 15 01:57:37 2015
From: daniel.herrmann1 at gmail.com (Daniel Herrmann)
Date: Thu, 15 Oct 2015 10:57:37 +0200
Subject: [ovs-discuss] OF Group Tables Load Balancing
In-Reply-To: <20150929041550.GG29366@nicira.com>
References: <5602F95E.50505@gmail.com> <20150929041550.GG29366@nicira.com>
Message-ID: <561F6A81.6060205@gmail.com>

Hi Ben,

On 29.09.2015 06:15, Ben Pfaff wrote:
> On Wed, Sep 23, 2015 at 09:11:26PM +0200, Daniel Herrmann wrote:
>> I am trying to load-balance traffic in a routed scenario and want to use
>> OF group tables for this.
>>
>> However, it seems that only one bucket is selected. I found some thread
>> from mid 2014, which states that only eth_dst is used for matching:
> 
> See selection_method, selection_method_param, and fields in
> ovs-ofctl(8), in OVS 2.4.0 and later.

Thank you for your answer. Where can I find the required values? The
ovs-ofctl manual always states that the values are known to the lower layer.

I am using OVS in an ESXi based virtualization environment with Debian
7.8 guest VMs running OVS and DPDK as dataplane using e1000 as interface
drivers. The normal kernel module (or vswitchd combined with the kernel
module) seems to have a bug related to flow injection as described in my
previous mail.

So basically the question is: which values are supported by OVS for the
fields "selection_method", "selection_method_param", and "fields"? The
goal is basically to distribute traffic like ECMP does, hence including
L3 and L4 source and destination and L4 protocol number in L4 header. Or
something similar.

One more question: My chosen controller (RYU) does not support those
extensions yet. Is it possible to use the CLI to modify the groups
already created using OpenFlow?

Thank you and regards
Daniel

From jpettit at nicira.com  Thu Oct 15 01:58:05 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 15 Oct 2015 01:58:05 -0700
Subject: [ovs-discuss] can I set the counters of the to-be-installed
	rule when adding a new rule to the flow table?
In-Reply-To: <tencent_51A9BA921766A00433C13B14@qq.com>
References: <tencent_51A9BA921766A00433C13B14@qq.com>
Message-ID: <F3FA0B66-2A2B-4A79-8A79-EAF6D80EDE59@nicira.com>


> On Oct 15, 2015, at 1:47 AM, YB <947835908 at qq.com> wrote:
> 
> Hi all,
> 
> Can I set the counters of the to-be-installed rule when adding a new rule to the flow table?
> 
> To be more specific, ( ovs-ofctl add-flow s1 "in_port=2 actions=output:3" ) can add a new rule in switch s1.
> With dump-flows command, we can see something like:
> "... n_packets=0, n_bytes=0,..., in_port=2, actions=output:3...".
> 
> So, my question is can I set the field of "n_packets"/"n_bytes" to an arbitrary number as desired?
> Is is possible?
> If yes, how?

No.

> Also, if it is not possible in OpenVswitch, do any commercial physical SDN switches support this?

I don't know why they would, but I'm not aware of any.  The usual assumption when these sorts of requests came up in OpenFlow is that software can keep track of the original value and provide a diff.

--Justin



From tervladimir at gmail.com  Thu Oct 15 04:59:20 2015
From: tervladimir at gmail.com (=?UTF-8?B?0JLQu9Cw0LTQuNC80LjRgCDQotC10YDQtdC90YLRjNC10LI=?=)
Date: Thu, 15 Oct 2015 14:59:20 +0300
Subject: [ovs-discuss] Arp and Duplicate IP
Message-ID: <CAPHHpNiBgqhxsx9EJq=hb9PtMnsoHyKcZv9vZbpzOCdGQshAjg@mail.gmail.com>

Hi. I have problem with openvswitch.

I have server (172.16.0.32) and client(172.16.0.222). On server installed
Openvswitch 2.3.0.
On server:
ifconfig eth0 0
ovs-vsctl add-br main-sw
ovs-vsctl add-port main-sw eth0
ovs-vsctl add-port br0 vm1 -- set interface vm1 type=internal
ovs-vsctl add-port br0 vm2 -- set interface vm2 type=internal
ovs-vsctl add-port br0 vm3 -- set interface vm3 type=internal

ifconfig main-sw 172.16.0.32/16 up
ifconfig vm1 0 up
ifconfig vm2 0 up
ifconfig vm3 0 up

When i try arp-scan 172.16.0.32/32 from client i have 4 arp-replays from
ports of openvswitch.(same ip, different mac). This get problem-sometimes i
cant ping server.(client get server mac from vm2, for example and wireshark
get error-Duplicate ip).

How i can fix it? Why ports get arp-answers if i dont set ip address on
ports?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151015/df6b3951/attachment.html>

From shettyg at nicira.com  Thu Oct 15 07:21:10 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 15 Oct 2015 07:21:10 -0700
Subject: [ovs-discuss] Unable to create a port on OVS bridge
In-Reply-To: <0957E03F-87F2-4F90-BDFE-CFDF0723536B@yahoo.com>
References: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>
 <CAHbON5qtTDHc4Hx_muXs9d4B+0xKyf04nNoH=oOU+FRmhneVfA@mail.gmail.com>
 <7535310D-4EEA-4766-8825-C4655066BAC4@yahoo.com>
 <CAHbON5piinGiXO3fzGXHyZ-UJCXi_D+XHH3dNtgANR01qJOrrA@mail.gmail.com>
 <83329887-1CE1-4ACD-9A9E-67B41C56ABCC@yahoo.com>
 <CAHbON5qWqcm78W8cmZN_PFTyfj1DOw9gRFM+dckKo63AgoamsQ@mail.gmail.com>
 <E071EAC8-CE38-49FC-A872-361E55F1BBBA@yahoo.com>
 <CAHbON5rNUY0Ryrv9X96ofT+UF4O=MwZWiS4=DTvk4P_XJzo2FA@mail.gmail.com>
 <0957E03F-87F2-4F90-BDFE-CFDF0723536B@yahoo.com>
Message-ID: <CAHbON5qTURuaGQox68oWqfaM=W8e_rhXKrGMvcfxteiLXFhC-w@mail.gmail.com>

Assuming you start with fresh VMs, all you need to install openvswitch
for your needs on Ubuntu is:
apt-get install openvswitch-switch

But don't try to install mininet on top of it. You should either try
to do everything using openvswitch commands or try to do everything
using mininet. If you try to mix and match, you should know both very
well.

On Thu, Oct 15, 2015 at 1:49 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
> I’m creating an experimental lab setup with topology:  Client ——— S1 ——— S2 ——— S3 ——— Server.   S1, S2, S3 are OVS switches and are in different subnets, and all nodes are Vms. I need to connect the nodes using GRE tunnels and so I need to use ports on OVS to do so.
>
> Is there anything that can be done? Worst case scenario I have to reinstall ubuntu on each VM and start from fresh.
>
> Thanks,
> Nishanth
>> On 14-Oct-2015, at 11:51 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>
>> What is that you want to do at a high level? i.e. what is your goal?
>>
>> On Wed, Oct 14, 2015 at 6:46 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
>>> I tried, I don’t know why but it doesn’t work. I even tried removing OVS entirely and reinstalling it again. Even then it gives the same error. However when I run mininet , the topology works fine without any error from OVS or anything else. How does that even work?
>>>
>>> Thanks,
>>> Nishanth
>>>> On 13-Oct-2015, at 11:35 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>>>
>>>> Where ever you did a 'make install', do a 'make uninstall'. The end
>>>> result should be that 'find /usr -name ovs-vswitchd' should only say
>>>> /usr/sbin/ovs-vswitchd.
>>>>
>>>> Then:
>>>> ps -ef | grep ovs
>>>>
>>>> Kill both ovs-vswitchd and ovsdb-server processes using 'kill'.
>>>>
>>>>
>>>> Then do '/etc/init.d/openvswitch start'
>>>>
>>>> On Tue, Oct 13, 2015 at 10:17 AM, Nishanth Devarajan
>>>> <dev_raj82 at yahoo.com> wrote:
>>>>> No I don’t know what Im doing very well. How exactly do I uninstall one of them completely so that I don’t get this problem? Also thanks :)
>>>>>> On 13-Oct-2015, at 9:55 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>>>>>
>>>>>> On Tue, Oct 13, 2015 at 9:01 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
>>>>>>> It says;
>>>>>>> /usr/sbin/ovs-vswitchd
>>>>>>> /usr/local/sbin/ovs-vswitchd
>>>>>>
>>>>>> The error message in your log file says that there was already a
>>>>>> ovs-vswitchd running. It is likely that since you have 2 ovs-vswitchd
>>>>>> installed in your system, one of them has already been started with a
>>>>>> startup script. So when you start the other one, it complained saying
>>>>>> that another one has already been started.
>>>>>>
>>>>>> You having 2 ovs-vswitchd in /usr/sbin/ and /usr/local/sbin/ also
>>>>>> tells me that you likely installed one using 'make install' and the
>>>>>> other using rpm or ubuntu packages. I strongly suggest to uninstall
>>>>>> one of them (unless you know very well what you are doing)
>>>>>
>>>
>

From blp at nicira.com  Thu Oct 15 09:01:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 15 Oct 2015 09:01:41 -0700
Subject: [ovs-discuss] OF Group Tables Load Balancing
In-Reply-To: <561F6A81.6060205@gmail.com>
References: <5602F95E.50505@gmail.com> <20150929041550.GG29366@nicira.com>
 <561F6A81.6060205@gmail.com>
Message-ID: <20151015160141.GA11553@nicira.com>

On Thu, Oct 15, 2015 at 10:57:37AM +0200, Daniel Herrmann wrote:
> Hi Ben,
> 
> On 29.09.2015 06:15, Ben Pfaff wrote:
> > On Wed, Sep 23, 2015 at 09:11:26PM +0200, Daniel Herrmann wrote:
> >> I am trying to load-balance traffic in a routed scenario and want to use
> >> OF group tables for this.
> >>
> >> However, it seems that only one bucket is selected. I found some thread
> >> from mid 2014, which states that only eth_dst is used for matching:
> > 
> > See selection_method, selection_method_param, and fields in
> > ovs-ofctl(8), in OVS 2.4.0 and later.
> 
> Thank you for your answer. Where can I find the required values? The
> ovs-ofctl manual always states that the values are known to the lower layer.

It looks like the supported methods are "" (to use the default) or
"hash", to use the fields specified in "fields".

> I am using OVS in an ESXi based virtualization environment with Debian
> 7.8 guest VMs running OVS and DPDK as dataplane using e1000 as interface
> drivers. The normal kernel module (or vswitchd combined with the kernel
> module) seems to have a bug related to flow injection as described in my
> previous mail.
> 
> So basically the question is: which values are supported by OVS for the
> fields "selection_method", "selection_method_param", and "fields"? The
> goal is basically to distribute traffic like ECMP does, hence including
> L3 and L4 source and destination and L4 protocol number in L4 header. Or
> something similar.
> 
> One more question: My chosen controller (RYU) does not support those
> extensions yet. Is it possible to use the CLI to modify the groups
> already created using OpenFlow?

Use "group-mod".

From daniel.herrmann1 at gmail.com  Thu Oct 15 09:52:55 2015
From: daniel.herrmann1 at gmail.com (Daniel Herrmann)
Date: Thu, 15 Oct 2015 18:52:55 +0200
Subject: [ovs-discuss] OF Group Tables Load Balancing
In-Reply-To: <20151015160141.GA11553@nicira.com>
References: <5602F95E.50505@gmail.com> <20150929041550.GG29366@nicira.com>
 <561F6A81.6060205@gmail.com> <20151015160141.GA11553@nicira.com>
Message-ID: <561FD9E7.90508@gmail.com>

On 15.10.2015 18:01, Ben Pfaff wrote:
> It looks like the supported methods are "" (to use the default) or
> "hash", to use the fields specified in "fields".

Okay, I am using the following group:

group_id=88,type=select,selection_method=hash,fields=ip_dst,bucket=bucket_id:0,actions=set_field:00:50:56:82:c8:03->eth_dst,set_field:00:50:56:82:cd:d3->eth_src,output:1,bucket=bucket_id:1,actions=set_field:00:50:56:82:89:d5->eth_dst,set_field:00:50:56:82:f7:c0->eth_src,output:2

I am certainly sure that there are different IP destinations (they are
randomly generated in a /16 network). However, still just one bucket is
matched:

---
root at M-OF-Core:~# ovs-ofctl -O OpenFlow15 dump-group-stats br0
OFPST_GROUP reply (OF1.5) (xid=0x2):
 group_id=88,duration=498.390s,ref_count=1,packet_count=636881,byte_count=262778258,bucket0:packet_count=636881,byte_count=262778258,bucket1:packet_count=0,byte_count=0
---

Any ideas?

Thanks and best regards
Daniel

From dev_raj82 at yahoo.com  Wed Oct 14 06:46:29 2015
From: dev_raj82 at yahoo.com (Nishanth Devarajan)
Date: Wed, 14 Oct 2015 19:16:29 +0530
Subject: [ovs-discuss] Unable to create a port on OVS bridge
In-Reply-To: <CAHbON5qWqcm78W8cmZN_PFTyfj1DOw9gRFM+dckKo63AgoamsQ@mail.gmail.com>
References: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>
 <CAHbON5qtTDHc4Hx_muXs9d4B+0xKyf04nNoH=oOU+FRmhneVfA@mail.gmail.com>
 <7535310D-4EEA-4766-8825-C4655066BAC4@yahoo.com>
 <CAHbON5piinGiXO3fzGXHyZ-UJCXi_D+XHH3dNtgANR01qJOrrA@mail.gmail.com>
 <83329887-1CE1-4ACD-9A9E-67B41C56ABCC@yahoo.com>
 <CAHbON5qWqcm78W8cmZN_PFTyfj1DOw9gRFM+dckKo63AgoamsQ@mail.gmail.com>
Message-ID: <E071EAC8-CE38-49FC-A872-361E55F1BBBA@yahoo.com>

I tried, I don’t know why but it doesn’t work. I even tried removing OVS entirely and reinstalling it again. Even then it gives the same error. However when I run mininet , the topology works fine without any error from OVS or anything else. How does that even work? 

Thanks,
Nishanth
> On 13-Oct-2015, at 11:35 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
> 
> Where ever you did a 'make install', do a 'make uninstall'. The end
> result should be that 'find /usr -name ovs-vswitchd' should only say
> /usr/sbin/ovs-vswitchd.
> 
> Then:
> ps -ef | grep ovs
> 
> Kill both ovs-vswitchd and ovsdb-server processes using 'kill'.
> 
> 
> Then do '/etc/init.d/openvswitch start'
> 
> On Tue, Oct 13, 2015 at 10:17 AM, Nishanth Devarajan
> <dev_raj82 at yahoo.com> wrote:
>> No I don’t know what Im doing very well. How exactly do I uninstall one of them completely so that I don’t get this problem? Also thanks :)
>>> On 13-Oct-2015, at 9:55 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>> 
>>> On Tue, Oct 13, 2015 at 9:01 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
>>>> It says;
>>>> /usr/sbin/ovs-vswitchd
>>>> /usr/local/sbin/ovs-vswitchd
>>> 
>>> The error message in your log file says that there was already a
>>> ovs-vswitchd running. It is likely that since you have 2 ovs-vswitchd
>>> installed in your system, one of them has already been started with a
>>> startup script. So when you start the other one, it complained saying
>>> that another one has already been started.
>>> 
>>> You having 2 ovs-vswitchd in /usr/sbin/ and /usr/local/sbin/ also
>>> tells me that you likely installed one using 'make install' and the
>>> other using rpm or ubuntu packages. I strongly suggest to uninstall
>>> one of them (unless you know very well what you are doing)
>> 


From haristanvir at hotmail.com  Wed Oct 14 21:52:54 2015
From: haristanvir at hotmail.com (haris tanvir)
Date: Thu, 15 Oct 2015 09:52:54 +0500
Subject: [ovs-discuss] Cannot add dpdkvhost user ports
In-Reply-To: <456300C4CD33BD44AED515BB2F77D5C0FA49D1@IRSMSX103.ger.corp.intel.com>
References: <SNT151-W7689A3FB9779F02B79B3CCB8300@phx.gbl>
 <74F120C019F4A64C9B78E802F6AD4CC24F79A470@IRSMSX102.ger.corp.intel.com>
 <SNT151-W378393368C7587A22BF016B8300@phx.gbl>
 <456300C4CD33BD44AED515BB2F77D5C0FA49D1@IRSMSX103.ger.corp.intel.com>
Message-ID: <SNT406-EAS2486C36BBD6A14822489641B83E0@phx.gbl>

thanks
it solved the issue



> On 14-Oct-2015, at 10:20 pm, Puha, TimoX <timox.puha at intel.com> wrote:
> 
> Hi,
>  
> I think 2.4 still has also this problem (http://openvswitch.org/pipermail/dev/2015-September/060106.html) and your symptoms seem to match. So if you used a relative path to DPDK when running OVS configure, you should do configure and build again with an absolute path to DPDK.
>  
> -Timo
>  
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of haris tanvir
> Sent: Tuesday, October 13, 2015 12:22 PM
> To: Loftus, Ciara
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Cannot add dpdkvhost user ports
>  
> Hi Ciara,
> Yes i have made sure that 'CONFIG_RTE_LIBRTE_VHOST_USER=y ' is also checked (It is checked by default)
> But the problem persists.
>  
> Regards
> Haris
>  
>  
> 
> > From: ciara.loftus at intel.com
> > To: haristanvir at hotmail.com
> > CC: discuss at openvswitch.org
> > Subject: RE: [ovs-discuss] Cannot add dpdkvhost user ports
> > Date: Tue, 13 Oct 2015 16:23:38 +0000
> > 
> > > 
> > > Hi,
> > > I am trying to add in dpdkvhostuser ports in openvswitch 2.4
> > > I have followed all the steps described in following documentation
> > > http://www.ran-lifshitz.com/2015/06/17/open-vswitch-netdev-dpdk-with-
> > > vhost-user-support/
> > > I have made sure that following checks are enabled when i build dpdk
> > > CONFIG_RTE_BUILD_COMBINE_LIBS=y
> > > CONFIG_RTE_LIBRTE_VHOST=y
> > > 
> > > After all the steps, i am able to add ports of type 'dpdk' but when i add port
> > > of type 'dpdkvhostuser', it throws out following error in the logs
> > > bridge|WARN|could not open network device dpdkvhost0 (Address family
> > > not supported by protocol)
> > > 
> > > And surprisingly, it adds ports of 'vhostcuse' just fine, even though i have
> > > made sure a thousand times that i have checked vhostuser flag rather than
> > > vhostcuse flag (CONFIG_RTE_LIBRTE_VHOST=y in
> > Make sure that CONFIG_RTE_LIBRTE_VHOST_USER=y too.
> > 
> > > dpdk2.0.0/config/linux_common . Infact i have not even loaded 'cuse'
> > > module.
> > > 
> > > Can someone please point it some step im missing?
> > > 
> > > Thanks
> > > 
> > > Regards
> > > Haris Tanvir
> > > 
> > > 
> > > 
> > >
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151015/6b54d7c0/attachment-0001.html>

From mengke.liu at intel.com  Thu Oct 15 00:32:11 2015
From: mengke.liu at intel.com (Liu, Mengke)
Date: Thu, 15 Oct 2015 07:32:11 +0000
Subject: [ovs-discuss] [QUESTION]: iproute2 extension for supporting
	lightweight tunnel
Message-ID: <7DDE0CBD3BECA4418AF34146552BC32B08C3E1D5@SHSMSX104.ccr.corp.intel.com>

Hi all,

I am trying to use the "lightweight tunnels" after building the Linux kernel source with "Lightweight & flow based encapsulation" support. Can you tell me how to get iproute2 extension for supporting the following  command in commit log(commit ID e69724f32e62502a6e686eae36b7aadfeea60dca)
"ip route add 40.1.1.1/32 encap vxlan id 10 dst 50.1.1.2 dev vxlan0" 

Best Regards
Mengke


From dev_raj82 at yahoo.com  Thu Oct 15 01:49:31 2015
From: dev_raj82 at yahoo.com (Nishanth Devarajan)
Date: Thu, 15 Oct 2015 14:19:31 +0530
Subject: [ovs-discuss] Unable to create a port on OVS bridge
In-Reply-To: <CAHbON5rNUY0Ryrv9X96ofT+UF4O=MwZWiS4=DTvk4P_XJzo2FA@mail.gmail.com>
References: <ABB7D6C5-32CD-48EE-8DA1-BBFFA72FA2D0@yahoo.com>
 <CAHbON5qtTDHc4Hx_muXs9d4B+0xKyf04nNoH=oOU+FRmhneVfA@mail.gmail.com>
 <7535310D-4EEA-4766-8825-C4655066BAC4@yahoo.com>
 <CAHbON5piinGiXO3fzGXHyZ-UJCXi_D+XHH3dNtgANR01qJOrrA@mail.gmail.com>
 <83329887-1CE1-4ACD-9A9E-67B41C56ABCC@yahoo.com>
 <CAHbON5qWqcm78W8cmZN_PFTyfj1DOw9gRFM+dckKo63AgoamsQ@mail.gmail.com>
 <E071EAC8-CE38-49FC-A872-361E55F1BBBA@yahoo.com>
 <CAHbON5rNUY0Ryrv9X96ofT+UF4O=MwZWiS4=DTvk4P_XJzo2FA@mail.gmail.com>
Message-ID: <0957E03F-87F2-4F90-BDFE-CFDF0723536B@yahoo.com>

I’m creating an experimental lab setup with topology:  Client ——— S1 ——— S2 ——— S3 ——— Server.   S1, S2, S3 are OVS switches and are in different subnets, and all nodes are Vms. I need to connect the nodes using GRE tunnels and so I need to use ports on OVS to do so.

Is there anything that can be done? Worst case scenario I have to reinstall ubuntu on each VM and start from fresh.

Thanks,
Nishanth 
> On 14-Oct-2015, at 11:51 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
> 
> What is that you want to do at a high level? i.e. what is your goal?
> 
> On Wed, Oct 14, 2015 at 6:46 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
>> I tried, I don’t know why but it doesn’t work. I even tried removing OVS entirely and reinstalling it again. Even then it gives the same error. However when I run mininet , the topology works fine without any error from OVS or anything else. How does that even work?
>> 
>> Thanks,
>> Nishanth
>>> On 13-Oct-2015, at 11:35 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>> 
>>> Where ever you did a 'make install', do a 'make uninstall'. The end
>>> result should be that 'find /usr -name ovs-vswitchd' should only say
>>> /usr/sbin/ovs-vswitchd.
>>> 
>>> Then:
>>> ps -ef | grep ovs
>>> 
>>> Kill both ovs-vswitchd and ovsdb-server processes using 'kill'.
>>> 
>>> 
>>> Then do '/etc/init.d/openvswitch start'
>>> 
>>> On Tue, Oct 13, 2015 at 10:17 AM, Nishanth Devarajan
>>> <dev_raj82 at yahoo.com> wrote:
>>>> No I don’t know what Im doing very well. How exactly do I uninstall one of them completely so that I don’t get this problem? Also thanks :)
>>>>> On 13-Oct-2015, at 9:55 pm, Gurucharan Shetty <shettyg at nicira.com> wrote:
>>>>> 
>>>>> On Tue, Oct 13, 2015 at 9:01 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
>>>>>> It says;
>>>>>> /usr/sbin/ovs-vswitchd
>>>>>> /usr/local/sbin/ovs-vswitchd
>>>>> 
>>>>> The error message in your log file says that there was already a
>>>>> ovs-vswitchd running. It is likely that since you have 2 ovs-vswitchd
>>>>> installed in your system, one of them has already been started with a
>>>>> startup script. So when you start the other one, it complained saying
>>>>> that another one has already been started.
>>>>> 
>>>>> You having 2 ovs-vswitchd in /usr/sbin/ and /usr/local/sbin/ also
>>>>> tells me that you likely installed one using 'make install' and the
>>>>> other using rpm or ubuntu packages. I strongly suggest to uninstall
>>>>> one of them (unless you know very well what you are doing)
>>>> 
>> 


From blp at nicira.com  Thu Oct 15 10:11:40 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 15 Oct 2015 10:11:40 -0700
Subject: [ovs-discuss] Arp and Duplicate IP
In-Reply-To: <CAPHHpNiBgqhxsx9EJq=hb9PtMnsoHyKcZv9vZbpzOCdGQshAjg@mail.gmail.com>
References: <CAPHHpNiBgqhxsx9EJq=hb9PtMnsoHyKcZv9vZbpzOCdGQshAjg@mail.gmail.com>
Message-ID: <20151015171140.GD11553@nicira.com>

On Thu, Oct 15, 2015 at 02:59:20PM +0300, Владимир Терентьев wrote:
> Hi. I have problem with openvswitch.
> 
> I have server (172.16.0.32) and client(172.16.0.222). On server installed
> Openvswitch 2.3.0.
> On server:
> ifconfig eth0 0
> ovs-vsctl add-br main-sw
> ovs-vsctl add-port main-sw eth0
> ovs-vsctl add-port br0 vm1 -- set interface vm1 type=internal
> ovs-vsctl add-port br0 vm2 -- set interface vm2 type=internal
> ovs-vsctl add-port br0 vm3 -- set interface vm3 type=internal
> 
> ifconfig main-sw 172.16.0.32/16 up
> ifconfig vm1 0 up
> ifconfig vm2 0 up
> ifconfig vm3 0 up
> 
> When i try arp-scan 172.16.0.32/32 from client i have 4 arp-replays from
> ports of openvswitch.(same ip, different mac). This get problem-sometimes i
> cant ping server.(client get server mac from vm2, for example and wireshark
> get error-Duplicate ip).

This is the same issue reported in this entry in the FAQ.

### Q: I configured one IP address on VLAN 0 and another on VLAN 9, like
   this:

       ovs-vsctl add-br br0
       ovs-vsctl add-port br0 eth0
       ifconfig br0 192.168.0.5
       ovs-vsctl add-port br0 vlan9 tag=9 -- set interface vlan9 type=internal
       ifconfig vlan9 192.168.0.9

   but other hosts that are only on VLAN 0 can reach the IP address
   configured on VLAN 9.  What's going on?

A: RFC 1122 section 3.3.4.2 "Multihoming Requirements" describes two
   approaches to IP address handling in Internet hosts:

   - In the "Strong ES Model", where an ES is a host ("End
     System"), an IP address is primarily associated with a
     particular interface.  The host discards packets that arrive
     on interface A if they are destined for an IP address that is
     configured on interface B.  The host never sends packets from
     interface A using a source address configured on interface B.

   - In the "Weak ES Model", an IP address is primarily associated
     with a host.  The host accepts packets that arrive on any
     interface if they are destined for any of the host's IP
     addresses, even if the address is configured on some
     interface other than the one on which it arrived.  The host
     does not restrict itself to sending packets from an IP
     address associated with the originating interface.

   Linux uses the weak ES model.  That means that when packets
   destined to the VLAN 9 IP address arrive on eth0 and are bridged to
   br0, the kernel IP stack accepts them there for the VLAN 9 IP
   address, even though they were not received on vlan9, the network
   device for vlan9.

   To simulate the strong ES model on Linux, one may add iptables rule
   to filter packets based on source and destination address and
   adjust ARP configuration with sysctls.

   BSD uses the strong ES model.

From davidjoshuaevans at gmail.com  Thu Oct 15 11:15:11 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Thu, 15 Oct 2015 13:15:11 -0500
Subject: [ovs-discuss] set dpdk packet refcnt when flow output to group.
In-Reply-To: <20151012172346.GF2651@nicira.com>
References: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>
 <20151012163821.GC2651@nicira.com>
 <10E167BF-DA3E-4AAB-8B70-38123A23302F@gmail.com>
 <20151012172346.GF2651@nicira.com>
Message-ID: <DEBA433D-8CE6-45F4-87AA-D3D9516DBA93@gmail.com>

Thanks Ben,

If that’s the case, then it would be better to be adding custom action that applies prior to this group action, to update the refcnt. 

I expect it just has to happen some time before the first PMD has finished processing the packet so that the packet does not get deleted by the tx routine before other PMD’s have seen the packet.

Cheers
Dave.



> On Oct 12, 2015, at 12:23 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> Your change isn't going to have much effect because most packets don't
> go through the translation process.  If you try to force all packets
> through translation, it will kill performance.
> 
> I think that you should read this paper that describes the various
> caching layers in Open vSwitch:
>        http://openvswitch.org/support/papers/nsdi2015.pdf
> 
> On Mon, Oct 12, 2015 at 11:56:03AM -0500, David Evans wrote:
>> Hi Ben,
>> 
>> When i use the OFPGT11_ALL group action, the packets for a  flow will be sent out all buckets in a group. (in my case all the buckets are ports to transmit out)
>> 
>> I added a group_bucket_count to the context 
>> and 
>> in xlate_all_group fn the following.
>> 
>>    group_dpif_get_buckets(group, &buckets);
>> +    if(ctx->group_bucket_count == 0){
>> +    	LIST_FOR_EACH (bucket, list_node, buckets) {
>> +    		ctx->group_bucket_count++;
>> +        }
>> +    }
>> +    if(ctx->xin->packet)
>> +    	if(ctx->xin->packet->source == DPBUF_DPDK)
>> +    		rte_pktmbuf_refcnt_update(&ctx->xin->packet->mbuf,ctx->group_bucket_count);
>> 	LIST_FOR_EACH (bucket, list_node, buckets) {
>> 
>> this stops the transmit pmd’s attempting to free the packet until all the buckets( ports ) have transmitted it.
>> My switch also does reassembly on rx - this refcnt is necessary for handling multi-segment dpdk buffers too. 
>> I also changed the segment free to rte_pktmbuf_free in netdev-dpdk.c for this purpose.
>> I’m expecting it will also be important for tso or the possibility of using rte_ipv4_fragment_packet on an outgoing port.
>> 
>> i have between 6 and 12 PMD’s depending on the number of dpdk ports running at any time, and if i use OFPGT11_ALL with many output buckets(ports) buffers will disappear from under some pmd’s and cause segfaults etc..
>> 
>> Cheers,
>> 
>> Dave.
>> 
>>> On Oct 12, 2015, at 11:38 AM, Ben Pfaff <blp at nicira.com> wrote:
>>> 
>>> On Wed, Oct 07, 2015 at 05:36:18PM -0500, David Evans wrote:
>>>> While using netdev-dpdk - When i add a rule for which the action is to
>>>> send to a group (type=all) containing (x) output buckets (ports) how
>>>> can i increment the dp_packet->pkt_mbuf’s refcnt to (x) so that the
>>>> packet is not deleted before it has transmitted all ports(buckets) in
>>>> the group.
>>>> 
>>>> Perhaps in ofproto-dpif-xlate.c function xlate_all_group find the
>>>> packet and apply the ctx->xin->packet->mbuf->refcnt ?  Will that work
>>>> for all packets for a ctx?
>>> 
>>> I don't understand what relationship you expect here.  A group has no
>>> direct relationship to a packet.  Translation produces a flat list of
>>> simple actions that don't refer back to the group.
>> 


From blp at nicira.com  Thu Oct 15 12:41:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 15 Oct 2015 12:41:02 -0700
Subject: [ovs-discuss] set dpdk packet refcnt when flow output to group.
In-Reply-To: <DEBA433D-8CE6-45F4-87AA-D3D9516DBA93@gmail.com>
References: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>
 <20151012163821.GC2651@nicira.com>
 <10E167BF-DA3E-4AAB-8B70-38123A23302F@gmail.com>
 <20151012172346.GF2651@nicira.com>
 <DEBA433D-8CE6-45F4-87AA-D3D9516DBA93@gmail.com>
Message-ID: <20151015194102.GC9615@nicira.com>

I don't understand what you're asking for.

Daniele or Pravin, I think that you know the DPDK datapath well.  Do you
understand what David wants or why?

On Thu, Oct 15, 2015 at 01:15:11PM -0500, David Evans wrote:
> Thanks Ben,
> 
> If that’s the case, then it would be better to be adding custom action that applies prior to this group action, to update the refcnt. 
> 
> I expect it just has to happen some time before the first PMD has finished processing the packet so that the packet does not get deleted by the tx routine before other PMD’s have seen the packet.
> 
> Cheers
> Dave.
> 
> 
> 
> > On Oct 12, 2015, at 12:23 PM, Ben Pfaff <blp at nicira.com> wrote:
> > 
> > Your change isn't going to have much effect because most packets don't
> > go through the translation process.  If you try to force all packets
> > through translation, it will kill performance.
> > 
> > I think that you should read this paper that describes the various
> > caching layers in Open vSwitch:
> >        http://openvswitch.org/support/papers/nsdi2015.pdf
> > 
> > On Mon, Oct 12, 2015 at 11:56:03AM -0500, David Evans wrote:
> >> Hi Ben,
> >> 
> >> When i use the OFPGT11_ALL group action, the packets for a  flow will be sent out all buckets in a group. (in my case all the buckets are ports to transmit out)
> >> 
> >> I added a group_bucket_count to the context 
> >> and 
> >> in xlate_all_group fn the following.
> >> 
> >>    group_dpif_get_buckets(group, &buckets);
> >> +    if(ctx->group_bucket_count == 0){
> >> +    	LIST_FOR_EACH (bucket, list_node, buckets) {
> >> +    		ctx->group_bucket_count++;
> >> +        }
> >> +    }
> >> +    if(ctx->xin->packet)
> >> +    	if(ctx->xin->packet->source == DPBUF_DPDK)
> >> +    		rte_pktmbuf_refcnt_update(&ctx->xin->packet->mbuf,ctx->group_bucket_count);
> >> 	LIST_FOR_EACH (bucket, list_node, buckets) {
> >> 
> >> this stops the transmit pmd’s attempting to free the packet until all the buckets( ports ) have transmitted it.
> >> My switch also does reassembly on rx - this refcnt is necessary for handling multi-segment dpdk buffers too. 
> >> I also changed the segment free to rte_pktmbuf_free in netdev-dpdk.c for this purpose.
> >> I’m expecting it will also be important for tso or the possibility of using rte_ipv4_fragment_packet on an outgoing port.
> >> 
> >> i have between 6 and 12 PMD’s depending on the number of dpdk ports running at any time, and if i use OFPGT11_ALL with many output buckets(ports) buffers will disappear from under some pmd’s and cause segfaults etc..
> >> 
> >> Cheers,
> >> 
> >> Dave.
> >> 
> >>> On Oct 12, 2015, at 11:38 AM, Ben Pfaff <blp at nicira.com> wrote:
> >>> 
> >>> On Wed, Oct 07, 2015 at 05:36:18PM -0500, David Evans wrote:
> >>>> While using netdev-dpdk - When i add a rule for which the action is to
> >>>> send to a group (type=all) containing (x) output buckets (ports) how
> >>>> can i increment the dp_packet->pkt_mbuf’s refcnt to (x) so that the
> >>>> packet is not deleted before it has transmitted all ports(buckets) in
> >>>> the group.
> >>>> 
> >>>> Perhaps in ofproto-dpif-xlate.c function xlate_all_group find the
> >>>> packet and apply the ctx->xin->packet->mbuf->refcnt ?  Will that work
> >>>> for all packets for a ctx?
> >>> 
> >>> I don't understand what relationship you expect here.  A group has no
> >>> direct relationship to a packet.  Translation produces a flat list of
> >>> simple actions that don't refer back to the group.
> >> 
> 

From mark.d.gray at intel.com  Fri Oct 16 02:08:38 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Fri, 16 Oct 2015 09:08:38 +0000
Subject: [ovs-discuss] status of ovn-docker
In-Reply-To: <CAG9LJa5Yd5k7w3EPDcTe_MAcn47hPszurZztZ=9-HTBaNW-dJQ@mail.gmail.com>
References: <738D45BC1F695740A983F43CFE1B7EA943839E24@IRSMSX108.ger.corp.intel.com>
 <CAHbON5pQvTxiJqDLf5gbxSifUgPENbjbd5HOqydHDqGSZcztQQ@mail.gmail.com>
 <738D45BC1F695740A983F43CFE1B7EA94383A52E@IRSMSX108.ger.corp.intel.com>
 <CAHbON5prRCdFuM2zBQG_NL_0p611CN3accnvTYzZGXZNy9ZZpg@mail.gmail.com>
 <CAG9LJa5Yd5k7w3EPDcTe_MAcn47hPszurZztZ=9-HTBaNW-dJQ@mail.gmail.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA943846617@IRSMSX108.ger.corp.intel.com>

> 
> Hi Mark,
> 
> 
> If you are deploying this with OpenStack, it will be nice for you to be familiar
> with project Kuryr.
> 
> I have written an introduction blog post about the project here:
> http://galsagie.github.io/sdn/openstack/docker/kuryr/neutron/2015/08/24/
> kuryr-part1/
> 
> 
> And an Integration of Kuryr and OVN blog post here:
> http://galsagie.github.io/sdn/openstack/docker/kuryr/neutron/2015/10/10/
> kuryr-ovn/
> 
> 
> In short Kuryr maps Docker APIs to Neutron API so you can use any Neutron
> plugin for implementing containers networking. (and OVN/OVS included) We
> also plan to support special use cases for nested containers in VM (that can
> expose OVN feature of defining parent and child logical ports for this same
> use case)
> 
> We are now working as well on modifying all the changes needed due to
> Docker 1.9 API changes.
> 

This looks interesting. Thanks for the pointer.

From rayli1107 at gmail.com  Fri Oct 16 11:05:43 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Fri, 16 Oct 2015 11:05:43 -0700
Subject: [ovs-discuss] OVS performance with increased number of openflow
	groups?
Message-ID: <CA+=-Fx8EHDmR6TJDyLc8rCrJB678qmU0LzE_CjkLa7s=bynJpg@mail.gmail.com>

Hi, does anyone know if there's a limit on the number of openflow groups,
and how OVS scales with the number of groups?

I'm assuming that as long as there are no operations that goes through the
list of groups, all group actions are indexed by the group id (no complex
search involved), so the number of groups shouldn't have an impact on the
overall performance.

Thanks,
Ray
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151016/c87a2fc5/attachment.html>

From blp at nicira.com  Fri Oct 16 11:08:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 16 Oct 2015 11:08:43 -0700
Subject: [ovs-discuss] OVS performance with increased number of openflow
 groups?
In-Reply-To: <CA+=-Fx8EHDmR6TJDyLc8rCrJB678qmU0LzE_CjkLa7s=bynJpg@mail.gmail.com>
References: <CA+=-Fx8EHDmR6TJDyLc8rCrJB678qmU0LzE_CjkLa7s=bynJpg@mail.gmail.com>
Message-ID: <20151016180843.GA20620@nicira.com>

On Fri, Oct 16, 2015 at 11:05:43AM -0700, Ray Li wrote:
> Hi, does anyone know if there's a limit on the number of openflow groups,
> and how OVS scales with the number of groups?
> 
> I'm assuming that as long as there are no operations that goes through the
> list of groups, all group actions are indexed by the group id (no complex
> search involved), so the number of groups shouldn't have an impact on the
> overall performance.

The number of groups shouldn't matter.

From muralirdev at gmail.com  Fri Oct 16 18:51:41 2015
From: muralirdev at gmail.com (Murali R)
Date: Fri, 16 Oct 2015 18:51:41 -0700
Subject: [ovs-discuss]  [ovn] vswitchd seg fault
Message-ID: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>

This is a neutron/ovn setup. I was just doing regular query
commands following some forced set command. And now it is not restarting.
What did I do wrong?

Oct 16 20:47:25 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
add-port br-int pmdoc1 -- set Interface pmdoc1
external_ids:iface-id=ca437555-b282-4f3f-835b-afda00d63f4c
Oct 16 20:47:25 mmnc-1 ovs-vswitchd: ovs|00075|bridge|INFO|bridge br-int:
added interface pmdoc1 on port 12
Oct 16 20:47:25 mmnc-1 kernel: [461978.174317] device pmdoc1 entered
promiscuous mode
Oct 16 20:47:35 mmnc-1 ovs-vswitchd: ovs|00076|connmgr|INFO|br-int<->unix:
5 flow_mods 10 s ago (4 adds, 1 modifications)
Oct 16 20:49:12 mmnc-1 ovs-ofctl: ovs|00001|command_line|EMER|'show'
command requires at least 1 arguments
Oct 16 21:10:23 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
set interface pmdoc1 qlen=500
Oct 16 21:10:23 mmnc-1 ovs-vsctl: ovs|00002|db_ctl_base|ERR|Interface does
not contain a column whose name matches "qlen"
Oct 16 21:11:39 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
set interface pmdoc1 external_ids:attached-mac=fa:16:3e:e8:18:09
Oct 16 21:12:02 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
set interface pmdoc1 external_ids:iface-status=active
Oct 16 21:14:46 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
set interface pmdoc1 external_ids:vm-id=140dd0def164
Oct 16 21:17:02 mmnc-1 CRON[10504]: (root) CMD (   cd / && run-parts
--report /etc/cron.hourly)
Oct 16 21:21:40 mmnc-1 ovn-sbctl: ovs|00001|db_ctl_base|ERR|unknown command
'lflows-list'; use --help for help
Oct 16 21:21:44 mmnc-1 ovn-sbctl: ovs|00001|db_ctl_base|ERR|unknown command
'lflows-list'; use --help for help
Oct 16 21:25:16 mmnc-1 ovs-vsctl: ovs|00001|db_ctl_base|ERR|unknown command
'dump-flows'; use --help for help
Oct 16 21:25:24 mmnc-1 ovs-vsctl: ovs|00001|db_ctl_base|ERR|unknown command
'dump-flows'; use --help for help
Oct 16 21:32:41 mmnc-1 kernel: [464693.810542] show_signal_msg: 9 callbacks
suppressed
Oct 16 21:32:41 mmnc-1 kernel: [464693.810555] ovs-vswitchd[17530]:
segfault at 1aa0468 ip 0000000001aa0468 sp 00007fffd7540738 error 15
Oct 16 21:32:41 mmnc-1 ovn-controller:
ovs|00009|rconn|INFO|unix:/usr/local/var/run/openvswitch/br-int.mgmt:
connection closed by peer
Oct 16 21:32:41 mmnc-1 ovs-appctl: ovs|00001|unixctl|WARN|error
communicating with
unix:/usr/local/var/run/openvswitch/ovs-vswitchd.17530.ctl: End of file
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151016/92837e67/attachment.html>

From muralirdev at gmail.com  Fri Oct 16 18:58:52 2015
From: muralirdev at gmail.com (Murali R)
Date: Fri, 16 Oct 2015 18:58:52 -0700
Subject: [ovs-discuss] [ovn] vswitchd seg fault
In-Reply-To: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>
References: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>
Message-ID: <CAO=R8om4-_jHdrrWCfr18yu4PfwbFgbfMwyoXkjD+M6aaLLLaA@mail.gmail.com>

.....
  120  ovn-sbctl lflow-list
  121  ovn-sbctl lflow-list | grep ca437555-b282-4f3f-835b-afda00d63f4c
  122  ovn-sbctl lflow-list | grep 31b72fb5-7467-4401-827c-8031785c5150
  123  ovs-vsctl dump-flows br-int | egrep
'fa:16:3e:e8:18:09|fa:16:3e:da:eb:0a'
  124  ovs-vsctl dump-flows br-int | egrep -v
'fa:16:3e:e8:18:09|fa:16:3e:da:eb:0a'
  125  ovs-ofctl dump-flows br-int | egrep -v
'fa:16:3e:e8:18:09|fa:16:3e:da:eb:0a'
  126  ovs-ofctl dump-flows br-int | egrep
'fa:16:3e:e8:18:09|fa:16:3e:da:eb:0a'
  127  ovs-vsctl --help
  128  ovs-appctl list-commands
  129  ovs-appctl dpif/show
  130  ovs-appctl dpctl/show
  131  ovs-appctl vlog/list
  132  ovs-appctl dpctl/dump-dps
  133  ovs-appctl list-commands
  134  ovs-appctl  dpctl/help

crashed here.

On Fri, Oct 16, 2015 at 6:51 PM, Murali R <muralirdev at gmail.com> wrote:

> This is a neutron/ovn setup. I was just doing regular query
> commands following some forced set command. And now it is not restarting.
> What did I do wrong?
>
> Oct 16 20:47:25 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
> add-port br-int pmdoc1 -- set Interface pmdoc1
> external_ids:iface-id=ca437555-b282-4f3f-835b-afda00d63f4c
> Oct 16 20:47:25 mmnc-1 ovs-vswitchd: ovs|00075|bridge|INFO|bridge br-int:
> added interface pmdoc1 on port 12
> Oct 16 20:47:25 mmnc-1 kernel: [461978.174317] device pmdoc1 entered
> promiscuous mode
> Oct 16 20:47:35 mmnc-1 ovs-vswitchd: ovs|00076|connmgr|INFO|br-int<->unix:
> 5 flow_mods 10 s ago (4 adds, 1 modifications)
> Oct 16 20:49:12 mmnc-1 ovs-ofctl: ovs|00001|command_line|EMER|'show'
> command requires at least 1 arguments
> Oct 16 21:10:23 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
> set interface pmdoc1 qlen=500
> Oct 16 21:10:23 mmnc-1 ovs-vsctl: ovs|00002|db_ctl_base|ERR|Interface does
> not contain a column whose name matches "qlen"
> Oct 16 21:11:39 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
> set interface pmdoc1 external_ids:attached-mac=fa:16:3e:e8:18:09
> Oct 16 21:12:02 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
> set interface pmdoc1 external_ids:iface-status=active
> Oct 16 21:14:46 mmnc-1 ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
> set interface pmdoc1 external_ids:vm-id=140dd0def164
> Oct 16 21:17:02 mmnc-1 CRON[10504]: (root) CMD (   cd / && run-parts
> --report /etc/cron.hourly)
> Oct 16 21:21:40 mmnc-1 ovn-sbctl: ovs|00001|db_ctl_base|ERR|unknown
> command 'lflows-list'; use --help for help
> Oct 16 21:21:44 mmnc-1 ovn-sbctl: ovs|00001|db_ctl_base|ERR|unknown
> command 'lflows-list'; use --help for help
> Oct 16 21:25:16 mmnc-1 ovs-vsctl: ovs|00001|db_ctl_base|ERR|unknown
> command 'dump-flows'; use --help for help
> Oct 16 21:25:24 mmnc-1 ovs-vsctl: ovs|00001|db_ctl_base|ERR|unknown
> command 'dump-flows'; use --help for help
> Oct 16 21:32:41 mmnc-1 kernel: [464693.810542] show_signal_msg: 9
> callbacks suppressed
> Oct 16 21:32:41 mmnc-1 kernel: [464693.810555] ovs-vswitchd[17530]:
> segfault at 1aa0468 ip 0000000001aa0468 sp 00007fffd7540738 error 15
> Oct 16 21:32:41 mmnc-1 ovn-controller:
> ovs|00009|rconn|INFO|unix:/usr/local/var/run/openvswitch/br-int.mgmt:
> connection closed by peer
> Oct 16 21:32:41 mmnc-1 ovs-appctl: ovs|00001|unixctl|WARN|error
> communicating with
> unix:/usr/local/var/run/openvswitch/ovs-vswitchd.17530.ctl: End of file
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151016/c4f28ed2/attachment.html>

From blp at nicira.com  Fri Oct 16 19:45:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 16 Oct 2015 19:45:24 -0700
Subject: [ovs-discuss] [ovn] vswitchd seg fault
In-Reply-To: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>
References: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>
Message-ID: <20151017024524.GA20400@nicira.com>

On Fri, Oct 16, 2015 at 06:51:41PM -0700, Murali R wrote:
> This is a neutron/ovn setup. I was just doing regular query
> commands following some forced set command. And now it is not restarting.
> What did I do wrong?

To debug this, we need either a backtrace or instructions for
reproduction.

From jic5760 at naver.com  Sat Oct 17 03:59:16 2015
From: jic5760 at naver.com (=?UTF-8?B?7J207KeA7LCs?=)
Date: Sat, 17 Oct 2015 19:59:16 +0900 (KST)
Subject: [ovs-discuss] =?utf-8?q?Problem_that_the_MAC_address_is_changed?=
 =?utf-8?q?=2E?=
Message-ID: <a382e946fb721f46eef4db7bb56d3@cweb07.nm.nhnsystem.com>

 
ARP : PC2 [ARP Request] -&gt; PC1 [ARP Reply]
 
PC2's Image. 
 
No problem in PC2. 
 
PC1's Image
 
But, Cause problem in PC1. 
 
Strangely change MAC Address in Received packet.
At 11:11:22:22:22:22,
11:11 is original source mac address(11:11:11:11:11:11)'s end 16bits.
22:22:22:22 is original destination mac address(22:22:22:22:22:22)'s begin 16bits.
 
I had never seen these problems... 
 
How can I solve this problem?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151017/5a10233f/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 캡처1.PNG
Type: image/png
Size: 5107 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151017/5a10233f/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 캡처2.PNG
Type: image/png
Size: 5221 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151017/5a10233f/attachment-0003.png>

From muralirdev at gmail.com  Sat Oct 17 12:46:20 2015
From: muralirdev at gmail.com (Murali R)
Date: Sat, 17 Oct 2015 12:46:20 -0700
Subject: [ovs-discuss] [ovn] vswitchd seg fault
In-Reply-To: <20151017024524.GA20400@nicira.com>
References: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>
 <20151017024524.GA20400@nicira.com>
Message-ID: <CAO=R8onR04-htBNuCOURyDicu3wFX4btkAtAxq5sTPBuC=dE0g@mail.gmail.com>

On Fri, Oct 16, 2015 at 7:45 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Oct 16, 2015 at 06:51:41PM -0700, Murali R wrote:
> > This is a neutron/ovn setup. I was just doing regular query
> > commands following some forced set command. And now it is not restarting.
> > What did I do wrong?
>
> To debug this, we need either a backtrace or instructions for
> reproduction.
>
I don't see it generated a core file. Should I look anywhere else? Looked
in most obvious places
/usr/local/sbin/ovs-vswitchd
/usr/local/var/run/openvswitch
/opt/stack/ovs/vswitchd/

I think it failed in "ovs-appctl  dpctl/help" from the history listed in my
above email. That is all the info I have. If I find anything more will post.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151017/eeaefc0d/attachment.html>

From muralirdev at gmail.com  Sat Oct 17 13:04:46 2015
From: muralirdev at gmail.com (Murali R)
Date: Sat, 17 Oct 2015 13:04:46 -0700
Subject: [ovs-discuss]  [ovn] ovs add-port question
Message-ID: <CAO=R8o=RX71ieM5kdjRzU_5o-X4Z3vuNryPrDyAzFvqQvPwepA@mail.gmail.com>

Few questions (in ovn setup):

1. After I do an add-port, who is supposed to add the attached-mac in
external_ids? The doc says
"The MAC address programmed into the ``virtual hardware'' for this
interface..."
meaning vif mac address? The reason is in neutron based ovn setup I see mac
address of netron port (hence lport) is say "fa:16:3e:da:eb:0a" then the
interface mac id (of vm) is set to "fe:16:3e:da:eb:0a" and the attached-mac
is set to "fa:16:3e:da:eb:0a". So in ovn setup, is it vif mac of the
attached to the VM or some lport mac?

2. iface-status in external_ids in Interface. Who sets it? After add-port
and "ip link set <iface> up" this is not getting set as "active". Even if I
set it active using ovs-vsctl the port is not forarding packets out. The
tcpdump shoes icmp traffic from vm at that port but it goes nowhere.

3. Any consequence if "vm-id" in external_ids not set? Is that used by
openstack?

Thanks
Murali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151017/bb750cb6/attachment.html>

From blp at nicira.com  Sat Oct 17 14:24:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 17 Oct 2015 14:24:51 -0700
Subject: [ovs-discuss] [ovn] vswitchd seg fault
In-Reply-To: <CAO=R8onR04-htBNuCOURyDicu3wFX4btkAtAxq5sTPBuC=dE0g@mail.gmail.com>
References: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>
 <20151017024524.GA20400@nicira.com>
 <CAO=R8onR04-htBNuCOURyDicu3wFX4btkAtAxq5sTPBuC=dE0g@mail.gmail.com>
Message-ID: <20151017212451.GE20400@nicira.com>

On Sat, Oct 17, 2015 at 12:46:20PM -0700, Murali R wrote:
> On Fri, Oct 16, 2015 at 7:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Fri, Oct 16, 2015 at 06:51:41PM -0700, Murali R wrote:
> > > This is a neutron/ovn setup. I was just doing regular query
> > > commands following some forced set command. And now it is not restarting.
> > > What did I do wrong?
> >
> > To debug this, we need either a backtrace or instructions for
> > reproduction.
> >
> I don't see it generated a core file. Should I look anywhere else? Looked
> in most obvious places
> /usr/local/sbin/ovs-vswitchd
> /usr/local/var/run/openvswitch
> /opt/stack/ovs/vswitchd/
> 
> I think it failed in "ovs-appctl  dpctl/help" from the history listed in my
> above email. That is all the info I have. If I find anything more will post.

I assumed you were reporting some kind of complex problem, but it turns
out that just running "ovs-appctl dpctl/help" will crash vswitchd.

I sent a fix:
        http://openvswitch.org/pipermail/dev/2015-October/061361.html

Thank you for the report!

From krzysztof.wojciechowski at techstorage.pl  Fri Oct 16 11:52:44 2015
From: krzysztof.wojciechowski at techstorage.pl (Krzysztof Wojciechowski)
Date: Fri, 16 Oct 2015 20:52:44 +0200
Subject: [ovs-discuss] openvswitch with DPDK - gre tunnels over dummy
	interface
Message-ID: <5621477C.1030800@techstorage.pl>

Hello

I have few questions about improving performance of our openvswitch 
implementation. Now we are using some old openvswitch (1.8 or something 
like that) on few machines. We are going to update them. We are using 
them for routers for our software defined network.

Details:
1.Machines have few ovs bridges.
2.Every bridge have one local interface (with assigned ip) and a lot of 
gre tunnels.
3.Machines use ospf to communicate with our internal network (to other 
machines - gre tunnels, its not reachable from inside of ovs networks).
4.They have dummy interface with IP (other machines in network use this 
ip for gre tunnels)
5. This machines have other interface to communicate with internet.
6. we have own modified openflow controller
Its something like this:
http://blog.scottlowe.org/2012/10/31/layer-3-routing-with-open-vswitch/
But we use gre tunnels instead of vlans and separate ovs bridges.

first question- is DPDK fit here? if other nodes are communicating with 
ip on dummy interface its going trough linux routing and then to 
openvswitch or directly from interface to ovs?

Second question - I watched this video:
https://www.youtube.com/watch?v=MbBX_J5zR4w
DPDK performance drop a lot when number of flows increase - was it 
fixed? or can i expect low performance when i will have ~250 flows per 
bridge?

third question  - i have idea to implement routing in openvswitch - is 
there a way to "forward" packets between ovs bridges (i would modify it 
using flows)? or i have to connect everything to one bridge (i would 
like to avoid it because of modified controller - don't know what will 
happen)? or i can use another bridge over interfaces connected to local 
interfaces or something?

last question - i saw that "ovs-ofctl" commands have problems with 
multiple flow tables (in 2.3 and older openvswitches) - for examples 
ovs-ofctl replace-flows. Is it fixed in 2.4? Or someone can fix that?

Sorry for my bad english.

Regards
Krzysztof


From muralirdev at gmail.com  Sat Oct 17 15:16:04 2015
From: muralirdev at gmail.com (Murali R)
Date: Sat, 17 Oct 2015 15:16:04 -0700
Subject: [ovs-discuss] [ovn] vswitchd seg fault
In-Reply-To: <20151017212451.GE20400@nicira.com>
References: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>
 <20151017024524.GA20400@nicira.com>
 <CAO=R8onR04-htBNuCOURyDicu3wFX4btkAtAxq5sTPBuC=dE0g@mail.gmail.com>
 <20151017212451.GE20400@nicira.com>
Message-ID: <CAO=R8omytb5vRafbSWaxY1DBquAQ01BpNUcs83rZ_7x5cyGFAg@mail.gmail.com>

Thanks for the quick analysis & fix Ben.

On Sat, Oct 17, 2015 at 2:24 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Sat, Oct 17, 2015 at 12:46:20PM -0700, Murali R wrote:
> > On Fri, Oct 16, 2015 at 7:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Fri, Oct 16, 2015 at 06:51:41PM -0700, Murali R wrote:
> > > > This is a neutron/ovn setup. I was just doing regular query
> > > > commands following some forced set command. And now it is not
> restarting.
> > > > What did I do wrong?
> > >
> > > To debug this, we need either a backtrace or instructions for
> > > reproduction.
> > >
> > I don't see it generated a core file. Should I look anywhere else? Looked
> > in most obvious places
> > /usr/local/sbin/ovs-vswitchd
> > /usr/local/var/run/openvswitch
> > /opt/stack/ovs/vswitchd/
> >
> > I think it failed in "ovs-appctl  dpctl/help" from the history listed in
> my
> > above email. That is all the info I have. If I find anything more will
> post.
>
> I assumed you were reporting some kind of complex problem, but it turns
> out that just running "ovs-appctl dpctl/help" will crash vswitchd.
>
> I sent a fix:
>         http://openvswitch.org/pipermail/dev/2015-October/061361.html
>
> Thank you for the report!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151017/b257ac95/attachment-0001.html>

From jic5760 at naver.com  Sat Oct 17 17:26:15 2015
From: jic5760 at naver.com (=?UTF-8?B?7J207KeA7LCs?=)
Date: Sun, 18 Oct 2015 09:26:15 +0900 (KST)
Subject: [ovs-discuss]
 =?utf-8?q?Problem_that_the_MAC_address_is_changed?= =?utf-8?q?=2E?=
In-Reply-To: <562239f2.c195420a.e5086.6bec@mx.google.com>
References: <a382e946fb721f46eef4db7bb56d3@cweb07.nm.nhnsystem.com>
 <562239f2.c195420a.e5086.6bec@mx.google.com>
Message-ID: <3424c278d4a3205ef6a473be614bfe4a@cmobileweb04.nm.nhnsystem.com>

No, it is not multicast packet...
Any packet the macaddress is changed...

Addition... my setting is so simple.
[PC1]
br1
 ----- eth0.10 (To PC2)

And... system network...

ifcfg-br1
 DEVICETYPE=ovs
 DEVICE=br1
 TYPE=OVSBridge
 IPADDR=10.205.128.1
 ......
 
ifcfg-eth0.10-ovs
 DEVICETYPE=ovs
 DEVICE=eth0.10
 TYPE=OVSPort
 OVS_Bridge=br1

ifcfg-eth0.10
 DEVICE=eth0.10
 TYPE=Ethernet
 VLAN=yes
 VLAN_ID=10
 PHYSDEV=eth0
-----Original Message-----
From: "jimson jimson"&lt;jimsonchacko at gmail.com&gt; 
To: "이지찬"&lt;jic5760 at naver.com&gt;; 
Cc: 
Sent: 2015-10-17 (토) 21:07:14
Subject: RE: [ovs-discuss] Problem that the MAC address is changed.


Is it related to multicast address?
From: 이지찬
Sent:  17- 10- 2015 04:29 PM
To: discuss at openvswitch.org
Subject: [ovs-discuss] Problem that the MAC address is changed.

 
ARP : PC2 [ARP Request] -&gt; PC1 [ARP Reply]
 
PC2's Image. 
 
No problem in PC2. 
 
PC1's Image
 
But, Cause problem in PC1. 
 
Strangely change MAC Address in Received packet.
At 11:11:22:22:22:22,
11:11 is original source mac address(11:11:11:11:11:11)'s end 16bits.
22:22:22:22 is original destination mac address(22:22:22:22:22:22)'s begin 16bits.
 
I had never seen these problems... 
 
How can I solve this problem?



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151018/44f31df2/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 캡처1.PNG
Type: image/png
Size: 5107 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151018/44f31df2/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 캡처2.PNG
Type: image/png
Size: 5221 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151018/44f31df2/attachment-0001.png>

From jic5760 at naver.com  Sun Oct 18 07:11:18 2015
From: jic5760 at naver.com (=?UTF-8?B?7J207KeA7LCs?=)
Date: Sun, 18 Oct 2015 23:11:18 +0900 (KST)
Subject: [ovs-discuss]
 =?utf-8?q?Problem_that_the_MAC_address_is_changed?= =?utf-8?q?=2E?=
In-Reply-To: <5623a736.8939440a.da7e4.400c@mx.google.com>
References: <a382e946fb721f46eef4db7bb56d3@cweb07.nm.nhnsystem.com>
 <562239f2.c195420a.e5086.6bec@mx.google.com>
 <3424c278d4a3205ef6a473be614bfe4a@cmobileweb04.nm.nhnsystem.com>
 <5623a736.8939440a.da7e4.400c@mx.google.com>
Message-ID: <76f49213a694a92216c3381dd7cc4b4@cweb15.nm.nhnsystem.com>

 11:11:11:11:11:11 MAC Address is just an example.
 
I solved this problem!
The real problem was the wrong set of ifcfg.... 
 
Thank you for your interest.
 
-----Original Message-----
From: "jimson jimson"&lt;jimsonchacko at gmail.com&gt; 
To: "이지찬"&lt;jic5760 at naver.com&gt;; 
Cc: 
Sent: 2015-10-18 (일) 23:05:42
Subject: RE: [ovs-discuss] Problem that the MAC address is changed.
 
Can you try using another mac address instead of using 11:11:11:11:11:11, say 10:11:11:11:11:11? This will make the mac address a unicast address.  From: 이지찬
Sent:  18- 10- 2015 05:56 AM
To: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Problem that the MAC address is changed.
 No, it is not multicast packet...
Any packet the macaddress is changed...

Addition... my setting is so simple.
[PC1]
br1
 ----- eth0.10 (To PC2)

And... system network...

ifcfg-br1
 DEVICETYPE=ovs
 DEVICE=br1
 TYPE=OVSBridge
 IPADDR=10.205.128.1
 ......
 
ifcfg-eth0.10-ovs
 DEVICETYPE=ovs
 DEVICE=eth0.10
 TYPE=OVSPort
 OVS_Bridge=br1

ifcfg-eth0.10
 DEVICE=eth0.10
 TYPE=Ethernet
 VLAN=yes
 VLAN_ID=10
 PHYSDEV=eth0
-----Original Message-----
From: "jimson jimson"&lt;jimsonchacko at gmail.com&gt; 
To: "이지찬"&lt;jic5760 at naver.com&gt;; 
Cc: 
Sent: 2015-10-17 (토) 21:07:14
Subject: RE: [ovs-discuss] Problem that the MAC address is changed.
 
Is it related to multicast address? From: 이지찬
Sent:  17- 10- 2015 04:29 PM
To: discuss at openvswitch.org
Subject: [ovs-discuss] Problem that the MAC address is changed.
  
ARP : PC2 [ARP Request] -&gt; PC1 [ARP Reply]
 
PC2's Image. 
 
No problem in PC2. 
 
PC1's Image
 
But, Cause problem in PC1. 
 
Strangely change MAC Address in Received packet.
At 11:11:22:22:22:22,
11:11 is original source mac address(11:11:11:11:11:11)'s end 16bits.
22:22:22:22 is original destination mac address(22:22:22:22:22:22)'s begin 16bits.
 
I had never seen these problems... 
 
How can I solve this problem?






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151018/743b38f1/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 캡처1.PNG
Type: image/png
Size: 5107 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151018/743b38f1/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 캡처2.PNG
Type: image/png
Size: 5221 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151018/743b38f1/attachment-0003.png>

From jic5760 at naver.com  Sun Oct 18 08:07:59 2015
From: jic5760 at naver.com (=?UTF-8?B?7J207KeA7LCs?=)
Date: Mon, 19 Oct 2015 00:07:59 +0900 (KST)
Subject: [ovs-discuss]
 =?utf-8?q?Problem_that_the_MAC_address_is_changed?= =?utf-8?q?=2E?=
In-Reply-To: <5623b011.87dc440a.d9197.ffff8320@mx.google.com>
References: <a382e946fb721f46eef4db7bb56d3@cweb07.nm.nhnsystem.com>
 <562239f2.c195420a.e5086.6bec@mx.google.com>
 <3424c278d4a3205ef6a473be614bfe4a@cmobileweb04.nm.nhnsystem.com>
 <5623a736.8939440a.da7e4.400c@mx.google.com>
 <76f49213a694a92216c3381dd7cc4b4@cweb15.nm.nhnsystem.com>
 <5623b011.87dc440a.d9197.ffff8320@mx.google.com>
Message-ID: <a0f86a5c53334be893e776e5fc6f65@cweb24.nm.nhnsystem.com>

 
Actually i don't know detailly
 
I check my system, it was set to TYPE=Vlan. 
I just guess that the reason was wrong ifcfg-setting. 
 
 
Before:
[ifcfg-eth0.10]DEVICE=eth0.10TYPE=EthernetVLAN=yesVLAN_ID=10PHYSDEV=eth0 
 
After
[ifcfg-eth0.10]
DEVICE=eth0.10
TYPE=Ethernet
VLAN=yes
BOOTPROTO=none
 
 
-----Original Message-----
From: "jimson jimson"&lt;jimsonchacko at gmail.com&gt; 
To: "이지찬"&lt;jic5760 at naver.com&gt;; 
Cc: 
Sent: 2015-10-18 (일) 23:43:29
Subject: RE: [ovs-discuss] Problem that the MAC address is changed.
 
Can you explain ? Eager to knowFrom: 이지찬
Sent:  18- 10- 2015 07:41 PM
To: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Problem that the MAC address is changed.
  11:11:11:11:11:11 MAC Address is just an example.
 
I solved this problem!
The real problem was the wrong set of ifcfg.... 
 
Thank you for your interest.
 
-----Original Message-----
From: "jimson jimson"&lt;jimsonchacko at gmail.com&gt; 
To: "이지찬"&lt;jic5760 at naver.com&gt;; 
Cc: 
Sent: 2015-10-18 (일) 23:05:42
Subject: RE: [ovs-discuss] Problem that the MAC address is changed.
 
Can you try using another mac address instead of using 11:11:11:11:11:11, say 10:11:11:11:11:11? This will make the mac address a unicast address.  From: 이지찬
Sent:  18- 10- 2015 05:56 AM
To: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Problem that the MAC address is changed.
 No, it is not multicast packet...
Any packet the macaddress is changed...

Addition... my setting is so simple.
[PC1]
br1
 ----- eth0.10 (To PC2)

And... system network...

ifcfg-br1
 DEVICETYPE=ovs
 DEVICE=br1
 TYPE=OVSBridge
 IPADDR=10.205.128.1
 ......
 
ifcfg-eth0.10-ovs
 DEVICETYPE=ovs
 DEVICE=eth0.10
 TYPE=OVSPort
 OVS_Bridge=br1

ifcfg-eth0.10
 DEVICE=eth0.10
 TYPE=Ethernet
 VLAN=yes
 VLAN_ID=10
 PHYSDEV=eth0
-----Original Message-----
From: "jimson jimson"&lt;jimsonchacko at gmail.com&gt; 
To: "이지찬"&lt;jic5760 at naver.com&gt;; 
Cc: 
Sent: 2015-10-17 (토) 21:07:14
Subject: RE: [ovs-discuss] Problem that the MAC address is changed.
 
Is it related to multicast address? From: 이지찬
Sent:  17- 10- 2015 04:29 PM
To: discuss at openvswitch.org
Subject: [ovs-discuss] Problem that the MAC address is changed.
  
ARP : PC2 [ARP Request] -&gt; PC1 [ARP Reply]
 
PC2's Image. 
 
No problem in PC2. 
 
PC1's Image
 
But, Cause problem in PC1. 
 
Strangely change MAC Address in Received packet.
At 11:11:22:22:22:22,
11:11 is original source mac address(11:11:11:11:11:11)'s end 16bits.
22:22:22:22 is original destination mac address(22:22:22:22:22:22)'s begin 16bits.
 
I had never seen these problems... 
 
How can I solve this problem?









-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151019/78216330/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 캡처1.PNG
Type: image/png
Size: 5107 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151019/78216330/attachment.png>

From manojkumar.sure at gmail.com  Sun Oct 18 12:37:51 2015
From: manojkumar.sure at gmail.com (Manojkumar Sure)
Date: Mon, 19 Oct 2015 01:07:51 +0530
Subject: [ovs-discuss] Problem of setting ECN bits to packets through
	floodlight controller
Message-ID: <CAC+zmpPsEHndDV0TLubrHxc71nJ=J_2VjfDFRY++QOjUCdngiQ@mail.gmail.com>

Hi,
  I am running floodlight with OpenFlow V1.3. I am trying to set the ECN
bits of IPV4 packets. I am using mininet with the default topology(2 hosts,
1 switch) with OVS switch version 2.3 set to use OpenFlow V1.3.

The mininet command I am using is
sudo mn --controller remote,ip=127.0.0.1,port=6653
--switch=ovsk,protocols=OpenFlow13  --mac

I am running floodlight at the default port(which is set to 6653).

I was trying to set ECN bits using the following command

curl -d '{"switch": "00:00:00:00:00:00:00:01", "name":"rule-1",
"cookie":"0", "priority":"300",
"ingress-port":"1","eth_type":"0x0800","ip_proto":"0x06","active":"true",
"instruction_apply_actions":"output=2",
"instruction_write_actions":"set_field=ip_ecn->3"}'
http://127.0.0.1:8080/wm/staticflowpusher/json

I was able to see that this rule got added to the switch and the packets
are getting matched to this rule in the switch through the flood light web
interface.

But, the problem is, event though the packets are getting matched to the
rules, I was not able to see any difference in the ECN bits in the packets,
which I am tracing through wireshark.
I was using iperf server on h2 and iperf client on h1 and tracing the
packets on h2-eth0.

I was seeing all the packets that are sent from h1 to h2. But, all the
packets have ECN bits set to 0x00.

I tried with some other fields like setting ip address, setting ttl values
etc. But, none of them changed the packet fields.

It looks like the problem is with OVS not being able to execute those
actions(basically, changing any packet fields).

Am I doing something wrong?


-- 
Regards,
Manoj Kumar Sure,
Senior Undergraduate,
IIT Madras.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151019/531eb35f/attachment.html>

From blp at nicira.com  Sun Oct 18 12:54:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 18 Oct 2015 12:54:06 -0700
Subject: [ovs-discuss] Problem of setting ECN bits to packets through
 floodlight controller
In-Reply-To: <CAC+zmpPsEHndDV0TLubrHxc71nJ=J_2VjfDFRY++QOjUCdngiQ@mail.gmail.com>
References: <CAC+zmpPsEHndDV0TLubrHxc71nJ=J_2VjfDFRY++QOjUCdngiQ@mail.gmail.com>
Message-ID: <20151018195406.GD11027@nicira.com>

On Mon, Oct 19, 2015 at 01:07:51AM +0530, Manojkumar Sure wrote:
>   I am running floodlight with OpenFlow V1.3. I am trying to set the ECN
> bits of IPV4 packets. I am using mininet with the default topology(2 hosts,
> 1 switch) with OVS switch version 2.3 set to use OpenFlow V1.3.
> 
> The mininet command I am using is
> sudo mn --controller remote,ip=127.0.0.1,port=6653
> --switch=ovsk,protocols=OpenFlow13  --mac
> 
> I am running floodlight at the default port(which is set to 6653).
> 
> I was trying to set ECN bits using the following command
> 
> curl -d '{"switch": "00:00:00:00:00:00:00:01", "name":"rule-1",
> "cookie":"0", "priority":"300",
> "ingress-port":"1","eth_type":"0x0800","ip_proto":"0x06","active":"true",
> "instruction_apply_actions":"output=2",
> "instruction_write_actions":"set_field=ip_ecn->3"}'
> http://127.0.0.1:8080/wm/staticflowpusher/json
> 
> I was able to see that this rule got added to the switch and the packets
> are getting matched to this rule in the switch through the flood light web
> interface.

How does the rule appear when OVS prints it, with "ovs-ofctl
dump-flows"?

From er.manpreet25 at gmail.com  Sun Oct 18 22:10:42 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Mon, 19 Oct 2015 10:40:42 +0530
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
Message-ID: <CALD=K8v=j+zb6FP4VW26BSoU4yHyBkznevoe0yR_ykvRomrxZA@mail.gmail.com>

Hello Team,

I am working on OVS-2.3.2.I am sending invalid value of ofp_config_flags in
OFPT_SET_CONFIG message from controller, then sending
OFPT_GET_CONFIG_REQUEST message the switch reply with OFPT_GET_CONFIG_REPLY
message having frag=normal.

I think for invalid flag value the switch must generate an error but it
will set frag to normal.

Is my understanding is correct or not ?


Regards,
Manpreet Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151019/a88233a1/attachment.html>

From blp at nicira.com  Mon Oct 19 08:20:57 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 19 Oct 2015 08:20:57 -0700
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
In-Reply-To: <CALD=K8v=j+zb6FP4VW26BSoU4yHyBkznevoe0yR_ykvRomrxZA@mail.gmail.com>
References: <CALD=K8v=j+zb6FP4VW26BSoU4yHyBkznevoe0yR_ykvRomrxZA@mail.gmail.com>
Message-ID: <20151019152057.GA20995@nicira.com>

On Mon, Oct 19, 2015 at 10:40:42AM +0530, Manpreet Singh wrote:
> I am working on OVS-2.3.2.I am sending invalid value of ofp_config_flags in
> OFPT_SET_CONFIG message from controller, then sending
> OFPT_GET_CONFIG_REQUEST message the switch reply with OFPT_GET_CONFIG_REPLY
> message having frag=normal.
> 
> I think for invalid flag value the switch must generate an error but it
> will set frag to normal.
> 
> Is my understanding is correct or not ?

What version of OpenFlow?

From haristanvir at hotmail.com  Sun Oct 18 11:40:36 2015
From: haristanvir at hotmail.com (haris tanvir)
Date: Sun, 18 Oct 2015 23:40:36 +0500
Subject: [ovs-discuss] ovs 2.4 dpdk ports
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F74528C85C@IRSMSX104.ger.corp.intel.com>
References: <SNT151-W81158F2399AA78BA5EE8EB8310@phx.gbl>,
 <BC0FEEC7D7650749874CEC11314A88F74528C85C@IRSMSX104.ger.corp.intel.com>
Message-ID: <SNT151-W2832365E8CA9B7FD3C6192B83B0@phx.gbl>

What would be the difference if rather than assigning a Guest machine "dpdkvhostuser" ports, i directly assign them "dpdk" physical ports? Would the performance improve?

 

> From: kevin.traynor at intel.com
> To: haristanvir at hotmail.com; discuss at openvswitch.org
> Subject: RE: [ovs-discuss] ovs 2.4 dpdk ports
> Date: Mon, 12 Oct 2015 16:19:36 +0000
> 
> 
> > -----Original Message-----
> > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of haris
> > tanvir
> > Sent: Monday, October 12, 2015 8:57 AM
> > To: discuss at openvswitch.org
> > Subject: [ovs-discuss] ovs 2.4 dpdk ports
> > 
> > Can someone explain the difference between(and elaborate) the following types
> > of ports in ovs 2.4
> > 
> > 1. dpdk
> physical NIC ports
> 
> > 2. dpdkr
> dpdk ring ports, they can be used to read/write memory shared through ivshmem
> 
> > 3. dpdkvhostuser
> qemu vhostuser ports
> 
> Have a look through the dpdk documentation http://www.dpdk.org/doc
> or the INSTALL.DPDK.md
> 
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151018/6c8e3c1c/attachment-0001.html>

From 555deepaksingh at gmail.com  Mon Oct 19 08:15:30 2015
From: 555deepaksingh at gmail.com (deepaksingh)
Date: Mon, 19 Oct 2015 20:45:30 +0530
Subject: [ovs-discuss] ovs-ofctl: /usr/local/var/run/openvswitch/br0.mgmt:
 failed to open socket (Protocol error)
Message-ID: <CADQZbY0xXOqPR5zi0wi3euYOUKbmQVLi6Z5QL5xH9frXG8YrnQ@mail.gmail.com>

Hi,
i am getting this error with my setup. I am using OVS-2.0.0.
Could anyone tell me what is happening ?
-bash-3.2# ovs-ofctl  dump-flows br0
ovs-ofctl: /usr/local/var/run/openvswitch/br0.mgmt: failed to open
socket (Protocol error)
-bash-3.2#
-bash-3.2#


-- 
Thanks & Regards,

From er.manpreet25 at gmail.com  Mon Oct 19 10:52:23 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Mon, 19 Oct 2015 23:22:23 +0530
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
In-Reply-To: <20151019152057.GA20995@nicira.com>
References: <CALD=K8v=j+zb6FP4VW26BSoU4yHyBkznevoe0yR_ykvRomrxZA@mail.gmail.com>
 <20151019152057.GA20995@nicira.com>
Message-ID: <CALD=K8vrp7S=S1r0M928xXTZ7b7asukFeECXLY7Z67QqkZXLBw@mail.gmail.com>

I am using openflow 1.3.0

On Monday, 19 October 2015, Ben Pfaff <blp at nicira.com> wrote:

> On Mon, Oct 19, 2015 at 10:40:42AM +0530, Manpreet Singh wrote:
> > I am working on OVS-2.3.2.I am sending invalid value of ofp_config_flags
> in
> > OFPT_SET_CONFIG message from controller, then sending
> > OFPT_GET_CONFIG_REQUEST message the switch reply with
> OFPT_GET_CONFIG_REPLY
> > message having frag=normal.
> >
> > I think for invalid flag value the switch must generate an error but it
> > will set frag to normal.
> >
> > Is my understanding is correct or not ?
>
> What version of OpenFlow?
>


-- 
Sent from iphone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151019/df5ffa95/attachment.html>

From muralirdev at gmail.com  Mon Oct 19 11:21:30 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 19 Oct 2015 11:21:30 -0700
Subject: [ovs-discuss] [ovn] ovs add-port question
In-Reply-To: <CAO=R8o=RX71ieM5kdjRzU_5o-X4Z3vuNryPrDyAzFvqQvPwepA@mail.gmail.com>
References: <CAO=R8o=RX71ieM5kdjRzU_5o-X4Z3vuNryPrDyAzFvqQvPwepA@mail.gmail.com>
Message-ID: <CAO=R8om+7dU3v5XPA5VaA4FLAR9pS5fYssOgPuPSQP1wnxAkCQ@mail.gmail.com>

I got this to work, errors in my understanding got fixed. So now can
integrate vm, docker containers and neutron all over ovn with my
application.

On the NB APIs, noticed yesterday ovn plugin using python binding. This is
great. Will work on lflow mod api over python binding this week.



>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151019/69f611c0/attachment.html>

From fan.du at intel.com  Mon Oct 19 23:05:42 2015
From: fan.du at intel.com (Du, Fan)
Date: Tue, 20 Oct 2015 14:05:42 +0800
Subject: [ovs-discuss] ARP reply packet fail to transmit on the wire on
	82599ES
Message-ID: <5625D9B6.3010409@intel.com>

hi dpdk and ovs experts

My test bed is pretty simple, setup host1 and host2 with following topology.
I use dpdk-2.0.0 with ovs head commit.

On host1:
kvm guest1 -> dpdkvhostuser -> br-int -> vxlan port -> br-ex -> dpdk port
ifconfig br-ex 192.168.1.2/24

On host2:
kvm guest2 -> dpdkvhostuser -> br-int -> vxlan port -> br-ex -> dpdk port
ifconfig br-ex 192.168.1.4/24

All ovs bridge are on user space, both hosts are connected with DAC 
using 82599ES,
the first packet between guest1 and guest2 triggers arp resolution for 
the vxlan
outer mac address for br-ex ip address.

tcpdump on host1 br-ex with dummy device:
09:32:58.393875 ARP, Request who-has 192.168.1.4 tell 192.168.1.2, length 28

tcpdump on host2 br-ex with dummy device:
21:21:31.766201 ARP, Request who-has 192.168.1.4 tell 192.168.1.2, length 46
21:21:31.766273 ARP, Reply 192.168.1.4 is-at 90:e2:ba:64:f4:05, length 46

It's wired that host1 failed receive ARP Reply packet from host2, so 
guest1 and
guest2 cannot talk to each other. When I replace dpdk port with normal 
net device
ens803f1 using the same NIC physical port, two guests talk to each other 
well.

After some digging, the ARP reply packet did reach on ixgbe tx_pkt_burst 
function,
whether or not RTE_IXGBE_INC_VECTOR is set, ARP reply packet didn't show 
on wire.

This looks like a bug to me, or am I missing something somewhere obviously.
Any suggestions and pointers is appreciated.

From kevin.traynor at intel.com  Tue Oct 20 05:14:48 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 20 Oct 2015 12:14:48 +0000
Subject: [ovs-discuss] ovs 2.4 dpdk ports
In-Reply-To: <SNT151-W2832365E8CA9B7FD3C6192B83B0@phx.gbl>
References: <SNT151-W81158F2399AA78BA5EE8EB8310@phx.gbl>,
 <BC0FEEC7D7650749874CEC11314A88F74528C85C@IRSMSX104.ger.corp.intel.com>
 <SNT151-W2832365E8CA9B7FD3C6192B83B0@phx.gbl>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74529DB9E@IRSMSX104.ger.corp.intel.com>



> -----Original Message-----
> From: haris tanvir [mailto:haristanvir at hotmail.com]
> Sent: Sunday, October 18, 2015 7:41 PM
> To: Traynor, Kevin
> Cc: discuss at openvswitch.org
> Subject: RE: [ovs-discuss] ovs 2.4 dpdk ports
> 
> What would be the difference if rather than assigning a Guest machine
> "dpdkvhostuser" ports, i directly assign them "dpdk" physical ports? Would
> the performance improve?

I'm not sure I understand the question. Do you mean using SR-IOV or something else? 

> 
> 
> 
> > From: kevin.traynor at intel.com
> > To: haristanvir at hotmail.com; discuss at openvswitch.org
> > Subject: RE: [ovs-discuss] ovs 2.4 dpdk ports
> > Date: Mon, 12 Oct 2015 16:19:36 +0000
> >
> >
> > > -----Original Message-----
> > > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of haris
> > > tanvir
> > > Sent: Monday, October 12, 2015 8:57 AM
> > > To: discuss at openvswitch.org
> > > Subject: [ovs-discuss] ovs 2.4 dpdk ports
> > >
> > > Can someone explain the difference between(and elaborate) the following
> types
> > > of ports in ovs 2.4
> > >
> > > 1. dpdk
> > physical NIC ports
> >
> > > 2. dpdkr
> > dpdk ring ports, they can be used to read/write memory shared through
> ivshmem
> >
> > > 3. dpdkvhostuser
> > qemu vhostuser ports
> >
> > Have a look through the dpdk documentation http://www.dpdk.org/doc
> > or the INSTALL.DPDK.md
> >

From sugesh.chandran at intel.com  Tue Oct 20 07:13:17 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Tue, 20 Oct 2015 14:13:17 +0000
Subject: [ovs-discuss] ARP reply packet fail to transmit on the wire
	on	82599ES
In-Reply-To: <5625D9B6.3010409@intel.com>
References: <5625D9B6.3010409@intel.com>
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB13CCB971@IRSMSX102.ger.corp.intel.com>

Have you set the dpdk-port mac address to br-ex using the following command ??
	" ovs-vsctl set bridge br-ex other-config:hwaddr=aa:bb:cc:dd:ee:ff"

Regards
_Sugesh

-----Original Message-----
From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Du, Fan
Sent: Tuesday, October 20, 2015 7:06 AM
To: users at dpdk.org
Cc: discuss at openvswitch.org
Subject: [ovs-discuss] ARP reply packet fail to transmit on the wire on 82599ES

hi dpdk and ovs experts

My test bed is pretty simple, setup host1 and host2 with following topology.
I use dpdk-2.0.0 with ovs head commit.

On host1:
kvm guest1 -> dpdkvhostuser -> br-int -> vxlan port -> br-ex -> dpdk port ifconfig br-ex 192.168.1.2/24

On host2:
kvm guest2 -> dpdkvhostuser -> br-int -> vxlan port -> br-ex -> dpdk port ifconfig br-ex 192.168.1.4/24

All ovs bridge are on user space, both hosts are connected with DAC using 82599ES, the first packet between guest1 and guest2 triggers arp resolution for the vxlan outer mac address for br-ex ip address.

tcpdump on host1 br-ex with dummy device:
09:32:58.393875 ARP, Request who-has 192.168.1.4 tell 192.168.1.2, length 28

tcpdump on host2 br-ex with dummy device:
21:21:31.766201 ARP, Request who-has 192.168.1.4 tell 192.168.1.2, length 46
21:21:31.766273 ARP, Reply 192.168.1.4 is-at 90:e2:ba:64:f4:05, length 46

It's wired that host1 failed receive ARP Reply packet from host2, so
guest1 and
guest2 cannot talk to each other. When I replace dpdk port with normal net device
ens803f1 using the same NIC physical port, two guests talk to each other well.

After some digging, the ARP reply packet did reach on ixgbe tx_pkt_burst function, whether or not RTE_IXGBE_INC_VECTOR is set, ARP reply packet didn't show on wire.

This looks like a bug to me, or am I missing something somewhere obviously.
Any suggestions and pointers is appreciated.
_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss

From 555deepaksingh at gmail.com  Mon Oct 19 21:50:21 2015
From: 555deepaksingh at gmail.com (deepaksingh)
Date: Tue, 20 Oct 2015 10:20:21 +0530
Subject: [ovs-discuss] ovs-ofctl:
 /usr/local/var/run/openvswitch/br0.mgmt:failed to open socket (Protocol
 error)
In-Reply-To: <5625c180.a9c6b40a.9927a.4ce7@mx.google.com>
References: <CADQZbY0xXOqPR5zi0wi3euYOUKbmQVLi6Z5QL5xH9frXG8YrnQ@mail.gmail.com>
 <5625c180.a9c6b40a.9927a.4ce7@mx.google.com>
Message-ID: <CADQZbY02go-6F31SH+aT4GcOZwX+7XT+395=YtXDnGw8afDOQA@mail.gmail.com>

Yes i am login as root only.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151020/e42c8459/attachment-0001.html>

From 555deepaksingh at gmail.com  Mon Oct 19 21:51:51 2015
From: 555deepaksingh at gmail.com (deepaksingh)
Date: Tue, 20 Oct 2015 10:21:51 +0530
Subject: [ovs-discuss] ovs-ofctl:
 /usr/local/var/run/openvswitch/br0.mgmt:failed to open socket (Protocol
 error)
In-Reply-To: <CADQZbY02go-6F31SH+aT4GcOZwX+7XT+395=YtXDnGw8afDOQA@mail.gmail.com>
References: <CADQZbY0xXOqPR5zi0wi3euYOUKbmQVLi6Z5QL5xH9frXG8YrnQ@mail.gmail.com>
 <5625c180.a9c6b40a.9927a.4ce7@mx.google.com>
 <CADQZbY02go-6F31SH+aT4GcOZwX+7XT+395=YtXDnGw8afDOQA@mail.gmail.com>
Message-ID: <CADQZbY28piQThnB9yV7FSqVhwOsmADmaEhZJDCpS8FAgOUHRUg@mail.gmail.com>

-bash-3.2#
-bash-3.2# ovs-ofctl --verbose  show br0
2015-10-20T05:28:00Z|00001|stream_unix|DBG|/usr/local/var/run/openvswitch/br0:
connection failed (No such file or directory)
2015-10-20T05:28:00Z|00002|stream_unix|DBG|/usr/local/var/run/openvswitch/br0.mgmt:
connection failed (Protocol error)
ovs-ofctl: /usr/local/var/run/openvswitch/br0.mgmt: failed to open socket
(Protocol error)


On Tue, Oct 20, 2015 at 10:20 AM, deepaksingh <555deepaksingh at gmail.com>
wrote:

>
> Yes i am login as root only.
>
>
>
>


-- 
Thanks & Regards,
Deepak Singh
dmx.deepak at gmail.com
+91 9739743261
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151020/2b7e0cf5/attachment-0001.html>

From b10102225 at gmail.com  Tue Oct 20 01:20:38 2015
From: b10102225 at gmail.com (Louis Hsieh)
Date: Tue, 20 Oct 2015 16:20:38 +0800
Subject: [ovs-discuss] [openvswitch 2.0.90] testsuite: 693 failed
Message-ID: <CAH_6z0JrN8qk-oYCFgTerS4yqo=UwBSsu8DQGOyKcdVBJV4wqQ@mail.gmail.com>

Dear,
I am Louis,
I want to let my Zedboard(based on ARM coretex-A9) to install Open vSwitch
in Linaro environment

I tried the commands on the web :
https://wiki.linaro.org/ZiShenLim/sandbox/OVS
And just follow these steps on my Zedboard :
1. Get the source
    git clone git://git.linaro.org/lng/openvswitch.git
2. apt-get install autoconf automake libtool
3. Build:
    cd openvswitch
    ./boot.sh
    ./configure
    make
4. Run testsuite:
    make check

But when commanding "make check", I get the testsuite: 693 failed
How should I solve it ?
[image: 內置圖片 1]

Sincerely,
Louis
​
 testsuite.log
<https://drive.google.com/file/d/0B3o1E1-1jCecajFDX1VPeXdTZzA/view?usp=drive_web>
​
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151020/042454a7/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 50840 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151020/042454a7/attachment-0001.png>

From blp at nicira.com  Tue Oct 20 10:08:23 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 20 Oct 2015 10:08:23 -0700
Subject: [ovs-discuss] [openvswitch 2.0.90] testsuite: 693 failed
In-Reply-To: <CAH_6z0JrN8qk-oYCFgTerS4yqo=UwBSsu8DQGOyKcdVBJV4wqQ@mail.gmail.com>
References: <CAH_6z0JrN8qk-oYCFgTerS4yqo=UwBSsu8DQGOyKcdVBJV4wqQ@mail.gmail.com>
Message-ID: <20151020170823.GA2147@nicira.com>

On Tue, Oct 20, 2015 at 04:20:38PM +0800, Louis Hsieh wrote:
> I want to let my Zedboard(based on ARM coretex-A9) to install Open vSwitch
> in Linaro environment
> 
> I tried the commands on the web :
> https://wiki.linaro.org/ZiShenLim/sandbox/OVS
> And just follow these steps on my Zedboard :
> 1. Get the source
>     git clone git://git.linaro.org/lng/openvswitch.git
> 2. apt-get install autoconf automake libtool
> 3. Build:
>     cd openvswitch
>     ./boot.sh
>     ./configure
>     make
> 4. Run testsuite:
>     make check
> 
> But when commanding "make check", I get the testsuite: 693 failed
> How should I solve it ?

Please provide testsuite.log

>  testsuite.log
> <https://drive.google.com/file/d/0B3o1E1-1jCecajFDX1VPeXdTZzA/view?usp=drive_web>

That isn't publicly viewable.

From diproiettod at vmware.com  Tue Oct 20 11:15:27 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 20 Oct 2015 18:15:27 +0000
Subject: [ovs-discuss] mapping dpdk ports to physical nics
In-Reply-To: <561E2977.9030106@ps.tu-darmstadt.de>
References: <561E2977.9030106@ps.tu-darmstadt.de>
Message-ID: <D24BCFF9.7FD9%diproiettod@vmware.com>

Hi,

Currently OVS behaves like most DPDK apps and examples: it uses the port
ID to
name an interface.

This is less than ideal: the PCI id might be a better alternative, but the
DPDK
community is currently considering other options to identify an interface.
 I
think OVS should be consistent with other DPDK apps, and adopt the naming
strategy that will be suggested by DPDK upstream.

Thanks,

Daniele


On 14/10/2015 11:07, "Benedikt Rudolph"
<benedikt.rudolph at ps.tu-darmstadt.de> wrote:

>
>
>
>Hi all,
>I want to add specific dpdk enabled ports to a bridge following the
>instructions in Install.DPDK.md.
>My setup has multiple (i.e. 4) dpdk enabled nics ports.
>So i created the bridge using:
>
>ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
>
>
>and add an interface using
>
>ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk
>
>
>I wonder if there is a way to address a specific (physical) dpdk port
>other than 
>guessing the number after ³dpdk0³?
>
>Previous to this step, I bound the nics to the igb_uio dpdk driver using
>the PCI-ID. The tools, specifically the dpdk_nic_bind.py script that
>comes with the dpdk 2.0 uses only PCI device IDs. There is on reference
>to the index number after dpdk i.e. ³dpdk0²
> in the scipt.
>
>Thank you for your time,
>Benedikt


From diproiettod at vmware.com  Tue Oct 20 11:33:21 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 20 Oct 2015 18:33:21 +0000
Subject: [ovs-discuss] set dpdk packet refcnt when flow output to group.
In-Reply-To: <20151015194102.GC9615@nicira.com>
References: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>
 <20151012163821.GC2651@nicira.com>
 <10E167BF-DA3E-4AAB-8B70-38123A23302F@gmail.com>
 <20151012172346.GF2651@nicira.com>
 <DEBA433D-8CE6-45F4-87AA-D3D9516DBA93@gmail.com>
 <20151015194102.GC9615@nicira.com>
Message-ID: <D24BD318.7FF4%diproiettod@vmware.com>

Hi,

Currently every DPDK mbuf in OVS has the `refcnt` set to one. Output to
multiple ports is handled by making a copy of the packet's payload (see
`may_steal` in dp_netdev_execute_actions(), and in netdev_send()).

You're right, having a `refcnt` != 1 might be necessary to use
rte_ipv4_fragment_packet() or to support certain offloading capabilities
(currently not implemented in OVS).

Does this answer you question?

Daniele


On 15/10/2015 12:41, "Ben Pfaff" <blp at nicira.com> wrote:

>I don't understand what you're asking for.
>
>Daniele or Pravin, I think that you know the DPDK datapath well.  Do you
>understand what David wants or why?
>
>On Thu, Oct 15, 2015 at 01:15:11PM -0500, David Evans wrote:
>> Thanks Ben,
>> 
>> If that¹s the case, then it would be better to be adding custom action
>>that applies prior to this group action, to update the refcnt.
>> 
>> I expect it just has to happen some time before the first PMD has
>>finished processing the packet so that the packet does not get deleted
>>by the tx routine before other PMD¹s have seen the packet.
>> 
>> Cheers
>> Dave.
>> 
>> 
>> 
>> > On Oct 12, 2015, at 12:23 PM, Ben Pfaff <blp at nicira.com> wrote:
>> > 
>> > Your change isn't going to have much effect because most packets don't
>> > go through the translation process.  If you try to force all packets
>> > through translation, it will kill performance.
>> > 
>> > I think that you should read this paper that describes the various
>> > caching layers in Open vSwitch:
>> >        
>>https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_suppo
>>rt_papers_nsdi2015.pdf&d=BQIDaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt
>>-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=xaCdqbPumJKYqzipA2A5
>>CYRDmbv1Q_lFRe2Aw2_bqpQ&s=GdugumekoH_nwJ4XnY2ip92yy-YoGNIV8Rj_tQkQ_b0&e=
>> > 
>> > On Mon, Oct 12, 2015 at 11:56:03AM -0500, David Evans wrote:
>> >> Hi Ben,
>> >> 
>> >> When i use the OFPGT11_ALL group action, the packets for a  flow
>>will be sent out all buckets in a group. (in my case all the buckets are
>>ports to transmit out)
>> >> 
>> >> I added a group_bucket_count to the context
>> >> and 
>> >> in xlate_all_group fn the following.
>> >> 
>> >>    group_dpif_get_buckets(group, &buckets);
>> >> +    if(ctx->group_bucket_count == 0){
>> >> +    	LIST_FOR_EACH (bucket, list_node, buckets) {
>> >> +    		ctx->group_bucket_count++;
>> >> +        }
>> >> +    }
>> >> +    if(ctx->xin->packet)
>> >> +    	if(ctx->xin->packet->source == DPBUF_DPDK)
>> >> +    
>>		rte_pktmbuf_refcnt_update(&ctx->xin->packet->mbuf,ctx->group_bucket_cou
>>nt);
>> >> 	LIST_FOR_EACH (bucket, list_node, buckets) {
>> >> 
>> >> this stops the transmit pmd¹s attempting to free the packet until
>>all the buckets( ports ) have transmitted it.
>> >> My switch also does reassembly on rx - this refcnt is necessary for
>>handling multi-segment dpdk buffers too.
>> >> I also changed the segment free to rte_pktmbuf_free in netdev-dpdk.c
>>for this purpose.
>> >> I¹m expecting it will also be important for tso or the possibility
>>of using rte_ipv4_fragment_packet on an outgoing port.
>> >> 
>> >> i have between 6 and 12 PMD¹s depending on the number of dpdk ports
>>running at any time, and if i use OFPGT11_ALL with many output
>>buckets(ports) buffers will disappear from under some pmd¹s and cause
>>segfaults etc..
>> >> 
>> >> Cheers,
>> >> 
>> >> Dave.
>> >> 
>> >>> On Oct 12, 2015, at 11:38 AM, Ben Pfaff <blp at nicira.com> wrote:
>> >>> 
>> >>> On Wed, Oct 07, 2015 at 05:36:18PM -0500, David Evans wrote:
>> >>>> While using netdev-dpdk - When i add a rule for which the action
>>is to
>> >>>> send to a group (type=all) containing (x) output buckets (ports)
>>how
>> >>>> can i increment the dp_packet->pkt_mbuf¹s refcnt to (x) so that the
>> >>>> packet is not deleted before it has transmitted all ports(buckets)
>>in
>> >>>> the group.
>> >>>> 
>> >>>> Perhaps in ofproto-dpif-xlate.c function xlate_all_group find the
>> >>>> packet and apply the ctx->xin->packet->mbuf->refcnt ?  Will that
>>work
>> >>>> for all packets for a ctx?
>> >>> 
>> >>> I don't understand what relationship you expect here.  A group has
>>no
>> >>> direct relationship to a packet.  Translation produces a flat list
>>of
>> >>> simple actions that don't refer back to the group.
>> >> 
>> 


From davidjoshuaevans at gmail.com  Tue Oct 20 11:41:32 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Tue, 20 Oct 2015 13:41:32 -0500
Subject: [ovs-discuss] set dpdk packet refcnt when flow output to group.
In-Reply-To: <D24BD318.7FF4%diproiettod@vmware.com>
References: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>
 <20151012163821.GC2651@nicira.com>
 <10E167BF-DA3E-4AAB-8B70-38123A23302F@gmail.com>
 <20151012172346.GF2651@nicira.com>
 <DEBA433D-8CE6-45F4-87AA-D3D9516DBA93@gmail.com>
 <20151015194102.GC9615@nicira.com> <D24BD318.7FF4%diproiettod@vmware.com>
Message-ID: <C89D7C82-A4EC-4683-A937-A86F11973F70@gmail.com>

Thanks Daniele 

may_steal sounds like the right thing, but i couldn’t see how it’s set by the group OFPGT11_ALL code path.
Also - maybe refcnt + cloning would be a more efficient option (assuming no packet mod’s would occur after the group)

My main concern is where there are multiple packets for a flow where it may not go through this path for the 2nd and following packets.
to refcnt and or clone the packets for each output.

This use case may not really be a part of your general switching direction though. I don’t expect that OFPGT11_ALL is a really popular use case.

Thanks for replying

Dave.

> On Oct 20, 2015, at 1:33 PM, Daniele Di Proietto <diproiettod at vmware.com> wrote:
> 
> Hi,
> 
> Currently every DPDK mbuf in OVS has the `refcnt` set to one. Output to
> multiple ports is handled by making a copy of the packet's payload (see
> `may_steal` in dp_netdev_execute_actions(), and in netdev_send()).
> 
> You're right, having a `refcnt` != 1 might be necessary to use
> rte_ipv4_fragment_packet() or to support certain offloading capabilities
> (currently not implemented in OVS).
> 
> Does this answer you question?
> 
> Daniele
> 
> 
> On 15/10/2015 12:41, "Ben Pfaff" <blp at nicira.com> wrote:
> 
>> I don't understand what you're asking for.
>> 
>> Daniele or Pravin, I think that you know the DPDK datapath well.  Do you
>> understand what David wants or why?
>> 
>> On Thu, Oct 15, 2015 at 01:15:11PM -0500, David Evans wrote:
>>> Thanks Ben,
>>> 
>>> If that¹s the case, then it would be better to be adding custom action
>>> that applies prior to this group action, to update the refcnt.
>>> 
>>> I expect it just has to happen some time before the first PMD has
>>> finished processing the packet so that the packet does not get deleted
>>> by the tx routine before other PMD¹s have seen the packet.
>>> 
>>> Cheers
>>> Dave.
>>> 
>>> 
>>> 
>>>> On Oct 12, 2015, at 12:23 PM, Ben Pfaff <blp at nicira.com> wrote:
>>>> 
>>>> Your change isn't going to have much effect because most packets don't
>>>> go through the translation process.  If you try to force all packets
>>>> through translation, it will kill performance.
>>>> 
>>>> I think that you should read this paper that describes the various
>>>> caching layers in Open vSwitch:
>>>> 
>>> https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_suppo
>>> rt_papers_nsdi2015.pdf&d=BQIDaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt
>>> -uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=xaCdqbPumJKYqzipA2A5
>>> CYRDmbv1Q_lFRe2Aw2_bqpQ&s=GdugumekoH_nwJ4XnY2ip92yy-YoGNIV8Rj_tQkQ_b0&e=
>>>> 
>>>> On Mon, Oct 12, 2015 at 11:56:03AM -0500, David Evans wrote:
>>>>> Hi Ben,
>>>>> 
>>>>> When i use the OFPGT11_ALL group action, the packets for a  flow
>>> will be sent out all buckets in a group. (in my case all the buckets are
>>> ports to transmit out)
>>>>> 
>>>>> I added a group_bucket_count to the context
>>>>> and 
>>>>> in xlate_all_group fn the following.
>>>>> 
>>>>>   group_dpif_get_buckets(group, &buckets);
>>>>> +    if(ctx->group_bucket_count == 0){
>>>>> +    	LIST_FOR_EACH (bucket, list_node, buckets) {
>>>>> +    		ctx->group_bucket_count++;
>>>>> +        }
>>>>> +    }
>>>>> +    if(ctx->xin->packet)
>>>>> +    	if(ctx->xin->packet->source == DPBUF_DPDK)
>>>>> +    
>>> 		rte_pktmbuf_refcnt_update(&ctx->xin->packet->mbuf,ctx->group_bucket_cou
>>> nt);
>>>>> 	LIST_FOR_EACH (bucket, list_node, buckets) {
>>>>> 
>>>>> this stops the transmit pmd¹s attempting to free the packet until
>>> all the buckets( ports ) have transmitted it.
>>>>> My switch also does reassembly on rx - this refcnt is necessary for
>>> handling multi-segment dpdk buffers too.
>>>>> I also changed the segment free to rte_pktmbuf_free in netdev-dpdk.c
>>> for this purpose.
>>>>> I¹m expecting it will also be important for tso or the possibility
>>> of using rte_ipv4_fragment_packet on an outgoing port.
>>>>> 
>>>>> i have between 6 and 12 PMD¹s depending on the number of dpdk ports
>>> running at any time, and if i use OFPGT11_ALL with many output
>>> buckets(ports) buffers will disappear from under some pmd¹s and cause
>>> segfaults etc..
>>>>> 
>>>>> Cheers,
>>>>> 
>>>>> Dave.
>>>>> 
>>>>>> On Oct 12, 2015, at 11:38 AM, Ben Pfaff <blp at nicira.com> wrote:
>>>>>> 
>>>>>> On Wed, Oct 07, 2015 at 05:36:18PM -0500, David Evans wrote:
>>>>>>> While using netdev-dpdk - When i add a rule for which the action
>>> is to
>>>>>>> send to a group (type=all) containing (x) output buckets (ports)
>>> how
>>>>>>> can i increment the dp_packet->pkt_mbuf¹s refcnt to (x) so that the
>>>>>>> packet is not deleted before it has transmitted all ports(buckets)
>>> in
>>>>>>> the group.
>>>>>>> 
>>>>>>> Perhaps in ofproto-dpif-xlate.c function xlate_all_group find the
>>>>>>> packet and apply the ctx->xin->packet->mbuf->refcnt ?  Will that
>>> work
>>>>>>> for all packets for a ctx?
>>>>>> 
>>>>>> I don't understand what relationship you expect here.  A group has
>>> no
>>>>>> direct relationship to a packet.  Translation produces a flat list
>>> of
>>>>>> simple actions that don't refer back to the group.
>>>>> 
>>> 
> 


From diproiettod at vmware.com  Tue Oct 20 13:00:46 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Tue, 20 Oct 2015 20:00:46 +0000
Subject: [ovs-discuss] set dpdk packet refcnt when flow output to group.
In-Reply-To: <C89D7C82-A4EC-4683-A937-A86F11973F70@gmail.com>
References: <BAE9243E-15FA-4CF3-BA0F-BF9394D8CE44@gmail.com>
 <20151012163821.GC2651@nicira.com>
 <10E167BF-DA3E-4AAB-8B70-38123A23302F@gmail.com>
 <20151012172346.GF2651@nicira.com>
 <DEBA433D-8CE6-45F4-87AA-D3D9516DBA93@gmail.com>
 <20151015194102.GC9615@nicira.com> <D24BD318.7FF4%diproiettod@vmware.com>
 <C89D7C82-A4EC-4683-A937-A86F11973F70@gmail.com>
Message-ID: <D24BE3BD.8087%diproiettod@vmware.com>



On 20/10/2015 11:41, "David Evans" <davidjoshuaevans at gmail.com> wrote:

>Thanks Daniele 
>
>may_steal sounds like the right thing, but i couldn’t see how it’s set by
>the group OFPGT11_ALL code path.
>Also - maybe refcnt + cloning would be a more efficient option (assuming
>no packet mod’s would occur after the group)

The datapath (dpif-netdev, in this case) doesn't deal with OFPGT11_ALL (or
any OpenFlow), it just deals with a list of what we call ODP (or datapath)
actions.

The ofproto layer translates OpenFlow actions into ODP (or datapath)
actions. If a packet need to multiple destination, the ODP action list
will contain more than one OVS_ACTION_ATTR_OUTPUT.

The code in odp_execute_actions() (called by the datapath), contains the
logic to properly set `may_steal` for each call to dp_execute_cb(): only
if there are no more actions `may_steal` is set to true, otherwise it will
be false and the packet will be copied eventually.

If you're not familiar with the distinction between the ofproto layer and
the datapath, I would advise taking a look at the paper that Ben suggested.

>My main concern is where there are multiple packets for a flow where it
>may not go through this path for the 2nd and following packets.
>to refcnt and or clone the packets for each output.

I'm not sure I understand your concern.

>This use case may not really be a part of your general switching
>direction though. I don’t expect that OFPGT11_ALL is a really popular use
>case.
>
>Thanks for replying
>
>Dave.
>
>> On Oct 20, 2015, at 1:33 PM, Daniele Di Proietto
>><diproiettod at vmware.com> wrote:
>> 
>> Hi,
>> 
>> Currently every DPDK mbuf in OVS has the `refcnt` set to one. Output to
>> multiple ports is handled by making a copy of the packet's payload (see
>> `may_steal` in dp_netdev_execute_actions(), and in netdev_send()).
>> 
>> You're right, having a `refcnt` != 1 might be necessary to use
>> rte_ipv4_fragment_packet() or to support certain offloading capabilities
>> (currently not implemented in OVS).
>> 
>> Does this answer you question?
>> 
>> Daniele
>> 
>> 
>> On 15/10/2015 12:41, "Ben Pfaff" <blp at nicira.com> wrote:
>> 
>>> I don't understand what you're asking for.
>>> 
>>> Daniele or Pravin, I think that you know the DPDK datapath well.  Do
>>>you
>>> understand what David wants or why?
>>> 
>>> On Thu, Oct 15, 2015 at 01:15:11PM -0500, David Evans wrote:
>>>> Thanks Ben,
>>>> 
>>>> If that¹s the case, then it would be better to be adding custom action
>>>> that applies prior to this group action, to update the refcnt.
>>>> 
>>>> I expect it just has to happen some time before the first PMD has
>>>> finished processing the packet so that the packet does not get deleted
>>>> by the tx routine before other PMD¹s have seen the packet.
>>>> 
>>>> Cheers
>>>> Dave.
>>>> 
>>>> 
>>>> 
>>>>> On Oct 12, 2015, at 12:23 PM, Ben Pfaff <blp at nicira.com> wrote:
>>>>> 
>>>>> Your change isn't going to have much effect because most packets
>>>>>don't
>>>>> go through the translation process.  If you try to force all packets
>>>>> through translation, it will kill performance.
>>>>> 
>>>>> I think that you should read this paper that describes the various
>>>>> caching layers in Open vSwitch:
>>>>> 
>>>> 
>>>>https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_sup
>>>>po
>>>> 
>>>>rt_papers_nsdi2015.pdf&d=BQIDaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNt
>>>>Xt
>>>> 
>>>>-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=xaCdqbPumJKYqzipA2
>>>>A5
>>>> 
>>>>CYRDmbv1Q_lFRe2Aw2_bqpQ&s=GdugumekoH_nwJ4XnY2ip92yy-YoGNIV8Rj_tQkQ_b0&e
>>>>=
>>>>> 
>>>>> On Mon, Oct 12, 2015 at 11:56:03AM -0500, David Evans wrote:
>>>>>> Hi Ben,
>>>>>> 
>>>>>> When i use the OFPGT11_ALL group action, the packets for a  flow
>>>> will be sent out all buckets in a group. (in my case all the buckets
>>>>are
>>>> ports to transmit out)
>>>>>> 
>>>>>> I added a group_bucket_count to the context
>>>>>> and 
>>>>>> in xlate_all_group fn the following.
>>>>>> 
>>>>>>   group_dpif_get_buckets(group, &buckets);
>>>>>> +    if(ctx->group_bucket_count == 0){
>>>>>> +    	LIST_FOR_EACH (bucket, list_node, buckets) {
>>>>>> +    		ctx->group_bucket_count++;
>>>>>> +        }
>>>>>> +    }
>>>>>> +    if(ctx->xin->packet)
>>>>>> +    	if(ctx->xin->packet->source == DPBUF_DPDK)
>>>>>> +    
>>>> 
>>>>		rte_pktmbuf_refcnt_update(&ctx->xin->packet->mbuf,ctx->group_bucket_c
>>>>ou
>>>> nt);
>>>>>> 	LIST_FOR_EACH (bucket, list_node, buckets) {
>>>>>> 
>>>>>> this stops the transmit pmd¹s attempting to free the packet until
>>>> all the buckets( ports ) have transmitted it.
>>>>>> My switch also does reassembly on rx - this refcnt is necessary for
>>>> handling multi-segment dpdk buffers too.
>>>>>> I also changed the segment free to rte_pktmbuf_free in netdev-dpdk.c
>>>> for this purpose.
>>>>>> I¹m expecting it will also be important for tso or the possibility
>>>> of using rte_ipv4_fragment_packet on an outgoing port.
>>>>>> 
>>>>>> i have between 6 and 12 PMD¹s depending on the number of dpdk ports
>>>> running at any time, and if i use OFPGT11_ALL with many output
>>>> buckets(ports) buffers will disappear from under some pmd¹s and cause
>>>> segfaults etc..
>>>>>> 
>>>>>> Cheers,
>>>>>> 
>>>>>> Dave.
>>>>>> 
>>>>>>> On Oct 12, 2015, at 11:38 AM, Ben Pfaff <blp at nicira.com> wrote:
>>>>>>> 
>>>>>>> On Wed, Oct 07, 2015 at 05:36:18PM -0500, David Evans wrote:
>>>>>>>> While using netdev-dpdk - When i add a rule for which the action
>>>> is to
>>>>>>>> send to a group (type=all) containing (x) output buckets (ports)
>>>> how
>>>>>>>> can i increment the dp_packet->pkt_mbuf¹s refcnt to (x) so that
>>>>>>>>the
>>>>>>>> packet is not deleted before it has transmitted all ports(buckets)
>>>> in
>>>>>>>> the group.
>>>>>>>> 
>>>>>>>> Perhaps in ofproto-dpif-xlate.c function xlate_all_group find the
>>>>>>>> packet and apply the ctx->xin->packet->mbuf->refcnt ?  Will that
>>>> work
>>>>>>>> for all packets for a ctx?
>>>>>>> 
>>>>>>> I don't understand what relationship you expect here.  A group has
>>>> no
>>>>>>> direct relationship to a packet.  Translation produces a flat list
>>>> of
>>>>>>> simple actions that don't refer back to the group.
>>>>>> 
>>>> 
>> 
>


From joestringer at nicira.com  Tue Oct 20 13:11:21 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Tue, 20 Oct 2015 13:11:21 -0700
Subject: [ovs-discuss] [ovn] vswitchd seg fault
In-Reply-To: <CAO=R8onR04-htBNuCOURyDicu3wFX4btkAtAxq5sTPBuC=dE0g@mail.gmail.com>
References: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>
 <20151017024524.GA20400@nicira.com>
 <CAO=R8onR04-htBNuCOURyDicu3wFX4btkAtAxq5sTPBuC=dE0g@mail.gmail.com>
Message-ID: <CANr6G5xnyOTvo779Js1usxhOpA7H5=-5MUv8x+K1-ShjDsdt-A@mail.gmail.com>

On 17 October 2015 at 12:46, Murali R <muralirdev at gmail.com> wrote:
> On Fri, Oct 16, 2015 at 7:45 PM, Ben Pfaff <blp at nicira.com> wrote:
>>
>> On Fri, Oct 16, 2015 at 06:51:41PM -0700, Murali R wrote:
>> > This is a neutron/ovn setup. I was just doing regular query
>> > commands following some forced set command. And now it is not
>> > restarting.
>> > What did I do wrong?
>>
>> To debug this, we need either a backtrace or instructions for
>> reproduction.
>
> I don't see it generated a core file. Should I look anywhere else? Looked in
> most obvious places
> /usr/local/sbin/ovs-vswitchd
> /usr/local/var/run/openvswitch
> /opt/stack/ovs/vswitchd/

For what it's worth, you may need to set the core file size in 'ulimit
-c' to nonzero in the shell that you run OVN/OVS (I use 'unlimited').
Another potential path is /var/crash/.

From jtaleric at redhat.com  Tue Oct 20 13:42:44 2015
From: jtaleric at redhat.com (Joe Talerico)
Date: Tue, 20 Oct 2015 16:42:44 -0400
Subject: [ovs-discuss] OVS balance-tcp bonding
Message-ID: <CAG0YX0W1SexHGNvOE5o65djAkNVR7xQxN5VT2iWKrqrXx6zzPg@mail.gmail.com>

When using balance-tcp bonding with OVS we were seeing ARP issues when we
reached ~ 100 guests. I Tracked as much as possible here :
https://bugzilla.redhat.com/show_bug.cgi?id=1267291

Has anyone seen this behavior before?

Switching to active/backup resolves the issue.

Thanks,
Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151020/df2c56da/attachment.html>

From muralirdev at gmail.com  Tue Oct 20 15:06:18 2015
From: muralirdev at gmail.com (Murali R)
Date: Tue, 20 Oct 2015 15:06:18 -0700
Subject: [ovs-discuss] [ovn] vswitchd seg fault
In-Reply-To: <CANr6G5xnyOTvo779Js1usxhOpA7H5=-5MUv8x+K1-ShjDsdt-A@mail.gmail.com>
References: <CAO=R8okFmn5cA+jY0iL79TRODVDzxO-J+puGEucNj+cHBBnw2w@mail.gmail.com>
 <20151017024524.GA20400@nicira.com>
 <CAO=R8onR04-htBNuCOURyDicu3wFX4btkAtAxq5sTPBuC=dE0g@mail.gmail.com>
 <CANr6G5xnyOTvo779Js1usxhOpA7H5=-5MUv8x+K1-ShjDsdt-A@mail.gmail.com>
Message-ID: <CAO=R8o=x66i1DM7rA5gPpBkcaQtidVbgug_2GbCUJWS+m9w5OQ@mail.gmail.com>

Thanks Joe. Looks like it was ulimit -c. These are VMs I spin up in the
cloud, so was not set. Will add this to the list of things to set in future
on a new vm.

root at mmnc-1:/usr/local/sbin# ulimit -c
0



On Tue, Oct 20, 2015 at 1:11 PM, Joe Stringer <joestringer at nicira.com>
wrote:

> On 17 October 2015 at 12:46, Murali R <muralirdev at gmail.com> wrote:
> > On Fri, Oct 16, 2015 at 7:45 PM, Ben Pfaff <blp at nicira.com> wrote:
> >>
> >> On Fri, Oct 16, 2015 at 06:51:41PM -0700, Murali R wrote:
> >> > This is a neutron/ovn setup. I was just doing regular query
> >> > commands following some forced set command. And now it is not
> >> > restarting.
> >> > What did I do wrong?
> >>
> >> To debug this, we need either a backtrace or instructions for
> >> reproduction.
> >
> > I don't see it generated a core file. Should I look anywhere else?
> Looked in
> > most obvious places
> > /usr/local/sbin/ovs-vswitchd
> > /usr/local/var/run/openvswitch
> > /opt/stack/ovs/vswitchd/
>
> For what it's worth, you may need to set the core file size in 'ulimit
> -c' to nonzero in the shell that you run OVN/OVS (I use 'unlimited').
> Another potential path is /var/crash/.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151020/d6c0abfb/attachment-0001.html>

From pavel.shirshov at gmail.com  Tue Oct 20 16:34:25 2015
From: pavel.shirshov at gmail.com (Pavel Shirshov)
Date: Tue, 20 Oct 2015 16:34:25 -0700
Subject: [ovs-discuss] Point-To-Point link for IPv4-IPv6-MPLS packets
Message-ID: <CALkUq2j6v8vXX74NGqEYczC_xkzU1V+7=hWLobPNUMDKcBxUWA@mail.gmail.com>

Hello,

I'm trying to set raw point-to-point link using openvswitch 2.0.2
(ubuntu trusty default option). By raw I mean that all packets which
are egress for the first interface should be ingress for the second
and otherwise. No other options or checks. But I see in ovs-dpctl
output that only ipv4 packets are forwarded.

I create the bridge and connect two ports to the bridge
# ovs-vsctl add-br b0002.03bb
# ovs-vsctl add-port b0002.03bb
# ovs-vsctl add-port b0002.03bb

Check it
# ovs-vsctl show
    Bridge "b0002.03bb"
        Port "b0002.03bb"
            Interface "b0002.03bb"
                type: internal
        Port "t0002.0120"
            Interface "t0002.0120"
        Port "t0002.011f"
            Interface "t0002.011f"

Set the bridge rules to forward all packets between ports
# ovs-ofctl del-flows b0002.03bb
# ovs-ofctl add-flow b0002.03bb 'table=0,in_port=1,action=output:2']
# ovs-ofctl add-flow b0002.03bb 'table=0,in_port=2,action=output:1']

Check flows in ovs-ofctl
# ovs-ofctl dump-flows b0002.03bb
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=1274.478s, table=0, n_packets=1701895,
n_bytes=187088564, idle_age=1, in_port=1 actions=output:2
 cookie=0x0, duration=1274.466s, table=0, n_packets=8393232,
n_bytes=1024054033, idle_age=0, in_port=2 actions=output:1

Check flows in ovs-dpctl
# ovs-dpctl show | egrep 't0002.0120|t0002.011f'
        port 394: t0002.0120
        port 404: t0002.011f

# ovs-dpctl dump-flows | fgrep '(404)'
skb_priority(0),in_port(404),eth_type(0x0800),ipv4(src=172.16.0.1/0.0.0.0,dst=172.16.0.2/0.0.0.0,proto=6/0,tos=0xc0/0,ttl=64/0,frag=no/0xff),
packets:4658053, bytes:564867731, used:0.083s, flags:SP., actions:394

# ovs-dpctl dump-flows | fgrep 'actions:404'
skb_priority(0),in_port(394),eth_type(0x0800),ipv4(src=172.16.0.2/0.0.0.0,dst=172.16.0.1/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),
packets:2092237, bytes:277216996, used:0.000s, flags:SFP., actions:404

Surprisingly I found that my openvswitch forward ipv4 traffic only:
"eth_type(0x0800)".
Is it possible to forward MPLS and IPv6 traffic too?

Thanks

From jimsonchacko at gmail.com  Tue Oct 20 18:50:27 2015
From: jimsonchacko at gmail.com (jimson jimson)
Date: Wed, 21 Oct 2015 07:20:27 +0530
Subject: [ovs-discuss] User space & kernel space actions.
Message-ID: <5626ef65.e3ec420a.272aa.1fd9@mx.google.com>

Hi

Are there any user space actions in ovs which can be done only at user space ? Any examples?
 Is 'normal' action a user space only action?
If we have a set of actions to be performed, say a user space action then a kernel space action , will they both be performed at the user space? Or is it like, the kernel throws exception -> ovs does user space action -> packet is given to kernel -> kernel does further processing ?

Regards
Jimson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/018a0c35/attachment.html>

From er.manpreet25 at gmail.com  Tue Oct 20 20:35:08 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Wed, 21 Oct 2015 09:05:08 +0530
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
Message-ID: <CALD=K8tqq0Raq48tGgj_Vd3RdqDUOBQ4zXnRFDZ==F-TbNx_Og@mail.gmail.com>

Hello Team,

I am working on OVS-2.3.2 and using  openflow 1.3.0.I am sending invalid
value of ofp_config_flags in OFPT_SET_CONFIG message from controller, then
sending OFPT_GET_CONFIG_REQUEST message the switch reply with
OFPT_GET_CONFIG_REPLY message having frag=normal.

I think for invalid flag value the switch must generate an error but it
will set frag to normal.

Is my understanding is correct or not ?


Regards,
Manpreet Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/e7553f7e/attachment.html>

From azhou at nicira.com  Tue Oct 20 20:55:42 2015
From: azhou at nicira.com (Andy Zhou)
Date: Tue, 20 Oct 2015 20:55:42 -0700
Subject: [ovs-discuss] OVS balance-tcp bonding
In-Reply-To: <CAG0YX0W1SexHGNvOE5o65djAkNVR7xQxN5VT2iWKrqrXx6zzPg@mail.gmail.com>
References: <CAG0YX0W1SexHGNvOE5o65djAkNVR7xQxN5VT2iWKrqrXx6zzPg@mail.gmail.com>
Message-ID: <CACzMAJLQdYnuH2YE3DxGr1UByu9twE5SJZwtSMb7yKCTnLYTQw@mail.gmail.com>

On Tue, Oct 20, 2015 at 1:42 PM, Joe Talerico <jtaleric at redhat.com> wrote:
> When using balance-tcp bonding with OVS we were seeing ARP issues when we
> reached ~ 100 guests. I Tracked as much as possible here :
> https://bugzilla.redhat.com/show_bug.cgi?id=1267291
>
> Has anyone seen this behavior before?
>
> Switching to active/backup resolves the issue.

Thanks for reporting the issue with lots of relevant information.  I
have not seen this issue before.
One the error messages in the bugzilla report suggested that you may
ran into the deferred action fifo limit.

Would you please try to increase its size with the following patch,
and report back how much it helped. This changes OVS kernel module, so
you will have to recompile the kernel module.

This is not like the right fix, but should help to confirm if there
are any other issues in the way to get your set up working.

diff --git a/datapath/actions.c b/datapath/actions.c
index c529bbb..a4afecb 100644
--- a/datapath/actions.c
+++ b/datapath/actions.c
@@ -53,7 +53,7 @@ struct deferred_action {
        struct sw_flow_key pkt_key;
 };

-#define DEFERRED_ACTION_FIFO_SIZE 10
+#define DEFERRED_ACTION_FIFO_SIZE 100
 struct action_fifo {
        int head;
        int tail;

From jimsonchacko at gmail.com  Tue Oct 20 21:10:48 2015
From: jimsonchacko at gmail.com (jimson jimson)
Date: Wed, 21 Oct 2015 09:40:48 +0530
Subject: [ovs-discuss] User space & kernel space actions.
Message-ID: <56271048.6ac5440a.c66aa.410b@mx.google.com>

Hi

Are there any user space actions in ovs which can be done only at user space ? Any examples?
Is 'normal' action a user space only action?
If we have a set of actions to be performed, say a user space action then a kernel space action , will they both be performed at the user space? Or is it like, the kernel throws exception -> ovs does user space action -> packet is given to kernel -> kernel does further processing ?

Regards
Jimson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/e9e86358/attachment.html>

From jpettit at nicira.com  Tue Oct 20 23:41:36 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 20 Oct 2015 23:41:36 -0700
Subject: [ovs-discuss] User space & kernel space actions.
In-Reply-To: <56271048.6ac5440a.c66aa.410b@mx.google.com>
References: <56271048.6ac5440a.c66aa.410b@mx.google.com>
Message-ID: <7F781436-B829-4A6C-A61F-A2CAA4D5BF09@nicira.com>


> On Oct 20, 2015, at 9:10 PM, jimson jimson <jimsonchacko at gmail.com> wrote:
> 
> Hi
> 
> Are there any user space actions in ovs which can be done only at user space ? Any examples?

Yes, there are a few.  Setting an ARP field can only be done in userspace.

> Is 'normal' action a user space only action?

No, userspace figures out where the packet should go, but the pushes down kernel flows to do the forwarding.

> If we have a set of actions to be performed, say a user space action then a kernel space action , will they both be performed at the user space? Or is it like, the kernel throws exception -> ovs does user space action -> packet is given to kernel -> kernel does further processing ?

There's an explicit "userspace" action that acts like an output.  Actions will be executed in the order that they're listed, but sending to userspace doesn't pause the processing after it.

--Justin



From wenhaosen at gmail.com  Wed Oct 21 00:41:57 2015
From: wenhaosen at gmail.com (Haosen Wen)
Date: Wed, 21 Oct 2015 15:41:57 +0800
Subject: [ovs-discuss] Problem extending ovs
Message-ID: <CADnMs2HEpJgpNSOOewVzLY4Dntw8Q1d8QSG+0NFnEOuiQkMg3A@mail.gmail.com>

Hi all,

The program I'm working on require some extensions upon ovs. In short, *I
need to add a packet cache in the switches, which also means a set of
protocol between the controller and some APIs in order to tell the switches
when and how to buffer the packets of a certain flow. *But since I haven't
got familiar with all the usages of ovs, *is there any existing ways that
can solve the problem so that I can spare my energy developing new modules
in ovs?*

Now what I need to do is to find a proper IDE so that I can read and modify
the codes freely. I tried to import ovs-2.4.0 into eclipse for C/C++ and
found that some of the declarations of functions cannot be traced. Also, I
cannot run the project in eclipse to check my modifications. *So I wonder
whether there is a widely used IDE for ovs developing. By the way, I'm new
to ovs developing, so I wonder where I can find some tutorials or documents
for ovs developing.*

Any help will be appreciated.


Regards,
Hs
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/1837468b/attachment.html>

From bansaldheeraj001 at gmail.com  Wed Oct 21 04:06:47 2015
From: bansaldheeraj001 at gmail.com (Dheeraj Bansal)
Date: Wed, 21 Oct 2015 16:36:47 +0530
Subject: [ovs-discuss] problem in dumping table features
Message-ID: <CAEYh440aeBbA8mfmy=fvcVSvh3MX88n06d-Q+CLegOpf-NU++Q@mail.gmail.com>

Hi All,

Can anyone please tell me why dump table features command is not working?.

ovs-ofctl -O openflow13 dump-table-features br0

Best Regards
Dheeraj Bansal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/681007ac/attachment.html>

From benedikt.rudolph at ps.tu-darmstadt.de  Wed Oct 21 08:36:43 2015
From: benedikt.rudolph at ps.tu-darmstadt.de (Benedikt Rudolph)
Date: Wed, 21 Oct 2015 17:36:43 +0200
Subject: [ovs-discuss] ovs dpdk low performance despite optimizations
Message-ID: <5627B10B.2050302@ps.tu-darmstadt.de>

Hi all,
in our test scenario we observe comparably low packet forwarding
performance on a dpdk (2.0) enabled ovs (2.4) switch.
The configuration is a single bridge (br0) with two dpdk enabled
interfaces (10 Gbit/s each) as per the Install.DPDK.md example.
We followed *thoroughly* all performance related optimization steps from
the above document.

Nonetheless the best rate we could get is ca. 2 M packets/s  on each
interface, which equals to about ca. 1.3 Gbit/s for 64byte sized packets.
Our comparison is against the “l2fwd” example dpdk application. Using
“l2fwd“ we can easily achieve 13 M packets /s in the same test
configuration. The only indicator of something going wrong is a high
count of ”errs“ packets in the output of “ovs-ofctl dump-ports”.

In our first runs (using 2 pmd threads) we noticed a high pmd thread
utilization as reported by the $ovs-appctl dpif-netdev/pmd-stats-show
command. We made sure to clear the statistics after every observation to
get an accurate report for the next interval. To mitigate this we
allowed dpdk to use up to 8 cores on a 12 core (24 ht threads) cpu. We
also set “other_config:n-dpdk-rxqs=20”. Now we observed “idle“ pmd
threads but still the packet forwarding performance is limited to the
above values.
We also experimented with the amount of huge pages memory.

Do you know of any *recent* reports on OVS dpdk performance? I found
some papers on the old dpdk-vswitch versiont which claim much higher
pkt. counts than I observed.

What further debugging steps can I make? Below I include the output of
“ovs-ofctl dump-ports br0" and “ovs-ofctl show br0"
Note that the output of  says „Max Speed 1000” despite having 10 Gbit
Interfaces attached. I am not sure wether this is an error.

> $ovs-ofctl dump-ports br0
> OFPST_PORT reply (xid=0x2): 3 ports
>  port  2: rx pkts=5, bytes=925, drop=0, errs=0, frame=0, over=0, crc=0
>           tx pkts=47128219, bytes=3016206016, drop=0, errs=0, coll=0
>  port  1: rx pkts=47130239, bytes=3016335901, drop=0, errs=84435109,
> frame=0, over=0, crc=0
>           tx pkts=0, bytes=0, drop=0, errs=0, coll=0
>  port LOCAL: rx pkts=0, bytes=0, drop=0, errs=0, frame=0, over=0, crc=0
>           tx pkts=47128251, bytes=2827695060, drop=47128251, errs=0,
> coll=0

> $ovs-ofctl show  br0
> OFPT_FEATURES_REPLY (xid=0x2): dpid:00005cb9018f16e0
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan
> mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src
> mod_tp_dst
> 1(dpdk0): addr:5c:b9:01:xx:xx:xx
>     config:     0
>     state:      0
>     current:    10GB-FD
>     supported:  100MB-FD 1GB-HD 1GB-FD FIBER AUTO_NEG AUTO_PAUSE
> AUTO_PAUSE_ASYM
>     speed: 10000 Mbps now, 1000 Mbps max
> 2(dpdk1): addr:5c:b9:01:xx:xx:xx
>     config:     0
>     state:      0
>     current:    10GB-FD
>     supported:  100MB-FD 1GB-HD 1GB-FD FIBER AUTO_NEG AUTO_PAUSE
> AUTO_PAUSE_ASYM
>     speed: 10000 Mbps now, 1000 Mbps max
> LOCAL(br0): addr:5c:b9:01:xx:xx:xx
>     config:     PORT_DOWN
>     state:      LINK_DOWN
>     current:    10MB-FD COPPER
>     speed: 10 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0


From krzysztof.wojciechowski at techstorage.pl  Tue Oct 20 10:04:30 2015
From: krzysztof.wojciechowski at techstorage.pl (Krzysztof Wojciechowski)
Date: Tue, 20 Oct 2015 19:04:30 +0200
Subject: [ovs-discuss] Openvswitch with DPDK - gre tunnels over dummy
	interface
In-Reply-To: <5621477C.1030800@techstorage.pl>
References: <5621477C.1030800@techstorage.pl>
Message-ID: <5626741E.1040908@techstorage.pl>

Hello

I have few questions about improving performance of our openvswitch
implementation. Now we are using some old openvswitch (1.8 or something
like that) on few machines. We are going to update them. We are using
them for routers for our software defined network.

Details:
1.Machines have few ovs bridges.
2.Every bridge have one local interface (with assigned ip) and a lot of
gre tunnels.
3.Machines use ospf to communicate with our internal network (to other
machines - gre tunnels, its not reachable from inside of ovs networks).
4.They have dummy interface with IP (other machines in network use this
ip for gre tunnels)
5. This machines have other interface to communicate with internet.
6. we have own modified openflow controller
Its something like this:
http://blog.scottlowe.org/2012/10/31/layer-3-routing-with-open-vswitch/
But we use gre tunnels instead of vlans and separate ovs bridges.

first question- is DPDK fit here? if other nodes are communicating with
ip on dummy interface its going trough linux routing and then to
openvswitch or directly from interface to ovs?

Second question - I watched this video:
https://www.youtube.com/watch?v=MbBX_J5zR4w
DPDK performance drop a lot when number of flows increase - was it
fixed? or can i expect low performance when i will have ~250 flows per
bridge?

third question  - i have idea to implement routing in openvswitch - is
there a way to "forward" packets between ovs bridges (i would modify it
using flows)? or i have to connect everything to one bridge (i would
like to avoid it because of modified controller - don't know what will
happen)? or i can use another bridge over interfaces connected to local
interfaces or something?

last question - i saw that "ovs-ofctl" commands have problems with
multiple flow tables (in 2.3 and older openvswitches) - for examples
ovs-ofctl replace-flows. Is it fixed in 2.4? Or someone can fix that?

Sorry for my bad english.

Regards
Krzysztof




From kharegaurav75 at gmail.com  Tue Oct 20 14:23:49 2015
From: kharegaurav75 at gmail.com (gaurav khare)
Date: Wed, 21 Oct 2015 02:53:49 +0530
Subject: [ovs-discuss] Issue:- Add Double Vlan
Message-ID: <CAKwkomvKA4it25z1=3sNGMVFxxSmY8oyEL7EXOjYPwdo0z5CLw@mail.gmail.com>

Hi

I need to generate the double Vlan tag and install the flow rules in IPv4
such that when packet comes to the switch , switch will add the double Vlan
tag in the Packet header.

We are using the Floodlight as the controller.
We are using EthType 8100 (VLAN_FRAME) as innervlan and 9100(Q_IN_Q) as
outer vlan for setting the value.
We have build the flowMod in the floolight , but we are getting the
BAD_ARGUMENT
Exception while writing the flow rule on switch

Could you please help me to correct the Flow Rule for the ovs Switch?


*Exception* :- OFBadActionErrorMsgVer13(xid=1700, code=BAD_ARGUMENT,


*Flow Rule added on the switch:-*

OFFlowAddVer13(xid=2396, cookie=0x0000000000000000,
cookieMask=0x0000000000000000, tableId=0x0, idleTimeout=10,
hardTimeout=3600, priority=2, bufferId=4294967295, outPort=2, outGroup=any,
flags=[], match=OFMatchV3Ver13(in_port=1, eth_dst=00:00:00:00:00:05,
eth_src=00:00:00:00:00:01, eth_type=800, ip_proto=6, ipv4_src=10.0.0.1,
ipv4_dst=10.0.0.5, tcp_src=51110, tcp_dst=5001), instructions=[
OFInstructionApplyActionsVer13(actions=[OFActionPushVlanVer13(ethertype=800),
OFActionSetFieldVer13(field=OFOxmVlanVidVer13(value=0x1001)),
OFActionPushVlanVer13(ethertype=9100), OFActionSetFieldVer13(field=
OFOxmVlanVidVer13(value=0x1002)), OFActionOutputVer13(port=1,
maxLen=-1)])]OFActionPushVlanVer13(ethertype=8100),
OFActionSetFieldVer13(field=OFOxmVlanVidVer13(value=0x1002))])]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/6b5ce1aa/attachment-0001.html>

From haristanvir at hotmail.com  Tue Oct 20 15:31:10 2015
From: haristanvir at hotmail.com (haris tanvir)
Date: Wed, 21 Oct 2015 03:31:10 +0500
Subject: [ovs-discuss] ovs 2.4 dpdk ports
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F74529DB9E@IRSMSX104.ger.corp.intel.com>
References: <SNT151-W81158F2399AA78BA5EE8EB8310@phx.gbl>,
 <BC0FEEC7D7650749874CEC11314A88F74528C85C@IRSMSX104.ger.corp.intel.com>,
 <SNT151-W2832365E8CA9B7FD3C6192B83B0@phx.gbl>,
 <BC0FEEC7D7650749874CEC11314A88F74529DB9E@IRSMSX104.ger.corp.intel.com>
Message-ID: <SNT151-W90D63A7E969FEEAE244F93B8390@phx.gbl>

I got the answer :)
Can you please provide a link (or send document) to me explaining in detail the working of vhostuser ports on latest ovs release. Any kind of documentation would be helpful. Thanks
RegardsHaris
 

> From: kevin.traynor at intel.com
> To: haristanvir at hotmail.com
> CC: discuss at openvswitch.org
> Subject: RE: [ovs-discuss] ovs 2.4 dpdk ports
> Date: Tue, 20 Oct 2015 12:14:48 +0000
> 
> 
> 
> > -----Original Message-----
> > From: haris tanvir [mailto:haristanvir at hotmail.com]
> > Sent: Sunday, October 18, 2015 7:41 PM
> > To: Traynor, Kevin
> > Cc: discuss at openvswitch.org
> > Subject: RE: [ovs-discuss] ovs 2.4 dpdk ports
> > 
> > What would be the difference if rather than assigning a Guest machine
> > "dpdkvhostuser" ports, i directly assign them "dpdk" physical ports? Would
> > the performance improve?
> 
> I'm not sure I understand the question. Do you mean using SR-IOV or something else? 
> 
> > 
> > 
> > 
> > > From: kevin.traynor at intel.com
> > > To: haristanvir at hotmail.com; discuss at openvswitch.org
> > > Subject: RE: [ovs-discuss] ovs 2.4 dpdk ports
> > > Date: Mon, 12 Oct 2015 16:19:36 +0000
> > >
> > >
> > > > -----Original Message-----
> > > > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of haris
> > > > tanvir
> > > > Sent: Monday, October 12, 2015 8:57 AM
> > > > To: discuss at openvswitch.org
> > > > Subject: [ovs-discuss] ovs 2.4 dpdk ports
> > > >
> > > > Can someone explain the difference between(and elaborate) the following
> > types
> > > > of ports in ovs 2.4
> > > >
> > > > 1. dpdk
> > > physical NIC ports
> > >
> > > > 2. dpdkr
> > > dpdk ring ports, they can be used to read/write memory shared through
> > ivshmem
> > >
> > > > 3. dpdkvhostuser
> > > qemu vhostuser ports
> > >
> > > Have a look through the dpdk documentation http://www.dpdk.org/doc
> > > or the INSTALL.DPDK.md
> > >
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/08c6896d/attachment-0001.html>

From Tytus.Kurek at pega.com  Tue Oct 20 23:23:05 2015
From: Tytus.Kurek at pega.com (Kurek, Tytus)
Date: Wed, 21 Oct 2015 06:23:05 +0000
Subject: [ovs-discuss] error: Bad exit status from /var/tmp/rpm-tmp.rB5Drx
	(%build)
Message-ID: <a701e90999f94fadabd3dd8922f41c3f@EXCAMB01.rpega.com>

Hi,

I'm experiencing some issues when executing the following command:

rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec

on CentOS 6.7 with OpenVSwitch 2.4.0 . Attached is an output from the above command execution.

Regards

Tytus Kurek | Lead Infrastructure Engineer / Special Projects | Pegasystems Inc.
Mobile: 0048513106743 | E-Mail: tytus.kurek at pega.com<mailto:tytus.kurek at pega.com> | www.pega.com<http://www.pega.com/>
[cid:image002.png at 01D03743.5E77F240]<http://www.facebook.com/pegasystems>  [cid:image003.png at 01D03743.5E77F240] <http://twitter.com/pegasystems>   [cid:image004.png at 01D03743.5E77F240] <http://www.linkedin.com/company/165426> [cid:image005.png at 01D03743.5E77F240] <http://www.youtube.com/pegasystems>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/087fe59d/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 619 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/087fe59d/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 883 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/087fe59d/attachment-0005.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 759 bytes
Desc: image003.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/087fe59d/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 911 bytes
Desc: image004.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/087fe59d/attachment-0007.png>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: output.txt
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/087fe59d/attachment-0001.txt>

From cs13m1015 at iith.ac.in  Wed Oct 21 03:36:40 2015
From: cs13m1015 at iith.ac.in (Prakash Pawar)
Date: Wed, 21 Oct 2015 16:06:40 +0530
Subject: [ovs-discuss] Regarding Support of muli level vlan tagging
Message-ID: <CABAVfZfQWsNyTVGPMyBOOWqHj8BbEZ7QUbwWvgEm3nsruFm4gQ@mail.gmail.com>

Hi,
As Open vSwitch 2.3.1 support OpenFlow version 1.3 .
OpenFlow 1.3  has explicit actions to add, modify and remove VLAN tags, and
can support multiple levels of VLAN tagging.
I am trying to test multi level of VLAN tagging.
But so for no sucess.
I am getting OFBadActionErrorMsgVer13(xid=1767, code=BAD_TAG, on controller
(Floodlight 1.1). I am using 0x8100 for inner tag and 0x9100 for outer tag.
Please help me  in sloving the issue.
-- 
*Regards,*
Prakash Pawar
M.Tech (Research Assistant)
Department of Computer Science & Engineering
Indian Institute of Technology, Hyderabad.
Email: cs13m1015 at iith.ac.in <ms11p008 at iith.ac.in>
          pracashpawar at gmail.com <rahulbpatil10 at gmail.com>
Cell:   +91-7702253176
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/762b466f/attachment.html>

From kharegaurav75 at gmail.com  Wed Oct 21 04:23:52 2015
From: kharegaurav75 at gmail.com (gaurav khare)
Date: Wed, 21 Oct 2015 16:53:52 +0530
Subject: [ovs-discuss] Support for Double Vlan
Message-ID: <CAKwkomteu+VCsd9tiK=9OyVF5MQKPmqWGfMW_Gjx0NyDTR_+gA@mail.gmail.com>

hi

We are trying to add the double Vlan tag for TCP Packets

Question
1. Does  OVS Switch support the double tagging?
2. Does OVS Switch support the IEEE standard 802.1ad
<https://en.wikipedia.org/wiki/802.1ad> ?

Thanks
gaurav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/0d004bc5/attachment.html>

From jsy0906 at postech.ac.kr  Wed Oct 21 08:07:05 2015
From: jsy0906 at postech.ac.kr (=?UTF-8?B?7KCV7IS47Jew?=)
Date: Thu, 22 Oct 2015 00:07:05 +0900
Subject: [ovs-discuss] How does OpenvSwitch buffer packets being matched by
	a flow entry
Message-ID: <CAAV8_Jqk0dPAKcMBEbJQACNf4hSw6Yb0zj2gyYeB_LXweg3wvw@mail.gmail.com>

I could get useful information from the past discussion about "How does OVS
buffer the packet inside packet-in message" (
http://openvswitch.org/pipermail/discuss/2013-October/011580.html)

In my short understanding, I think that successive packets of any single
flow that has a matching flow entry are also buffered temporarily like a
forwarding pipeline queue in a physical switch.

So if my guess is right, I hope to find some implementation source codes or
references in OVS.

Thank you for reading.
ᐧ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151022/0a5fe6bc/attachment.html>

From jpettit at nicira.com  Wed Oct 21 08:50:42 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 21 Oct 2015 08:50:42 -0700
Subject: [ovs-discuss] How does OpenvSwitch buffer packets being matched
	by a flow entry
In-Reply-To: <CAAV8_Jqk0dPAKcMBEbJQACNf4hSw6Yb0zj2gyYeB_LXweg3wvw@mail.gmail.com>
References: <CAAV8_Jqk0dPAKcMBEbJQACNf4hSw6Yb0zj2gyYeB_LXweg3wvw@mail.gmail.com>
Message-ID: <75FC0B88-5CCD-43FB-8B38-C1A652860BD2@nicira.com>


> On Oct 21, 2015, at 8:07 AM, 정세연 <jsy0906 at postech.ac.kr> wrote:
> 
> I could get useful information from the past discussion about "How does OVS buffer the packet inside packet-in message" (http://openvswitch.org/pipermail/discuss/2013-October/011580.html)
> 
> In my short understanding, I think that successive packets of any single flow that has a matching flow entry are also buffered temporarily like a forwarding pipeline queue in a physical switch.
> 
> So if my guess is right, I hope to find some implementation source codes or references in OVS.

Try grep'ing for "buffer_id" in the sources.

--Justin



From jpettit at nicira.com  Wed Oct 21 08:51:32 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 21 Oct 2015 08:51:32 -0700
Subject: [ovs-discuss] Support for Double Vlan
In-Reply-To: <CAKwkomteu+VCsd9tiK=9OyVF5MQKPmqWGfMW_Gjx0NyDTR_+gA@mail.gmail.com>
References: <CAKwkomteu+VCsd9tiK=9OyVF5MQKPmqWGfMW_Gjx0NyDTR_+gA@mail.gmail.com>
Message-ID: <666F1DC0-18BC-4BA0-9014-5869798F37B9@nicira.com>


> On Oct 21, 2015, at 4:23 AM, gaurav khare <kharegaurav75 at gmail.com> wrote:
> 
> hi
> 
> We are trying to add the double Vlan tag for TCP Packets
> 
> Question
> 1. Does  OVS Switch support the double tagging?
> 2. Does OVS Switch support the IEEE standard 802.1ad ?

Support should be added soon.  Try searching the ovs-dev mailing list to see the current progress.

--Justin



From jpettit at nicira.com  Wed Oct 21 08:52:27 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 21 Oct 2015 08:52:27 -0700
Subject: [ovs-discuss] Regarding Support of muli level vlan tagging
In-Reply-To: <CABAVfZfQWsNyTVGPMyBOOWqHj8BbEZ7QUbwWvgEm3nsruFm4gQ@mail.gmail.com>
References: <CABAVfZfQWsNyTVGPMyBOOWqHj8BbEZ7QUbwWvgEm3nsruFm4gQ@mail.gmail.com>
Message-ID: <13D43C0F-5F5F-4A00-B98B-9C0662165B4F@nicira.com>


> On Oct 21, 2015, at 3:36 AM, Prakash Pawar <cs13m1015 at iith.ac.in> wrote:
> 
> Hi,
> As Open vSwitch 2.3.1 support OpenFlow version 1.3 .
> OpenFlow 1.3  has explicit actions to add, modify and remove VLAN tags, and can support multiple levels of VLAN tagging.
> I am trying to test multi level of VLAN tagging.
> But so for no sucess.
> I am getting OFBadActionErrorMsgVer13(xid=1767, code=BAD_TAG, on controller (Floodlight 1.1). I am using 0x8100 for inner tag and 0x9100 for outer tag.
> Please help me  in sloving the issue.

OVS doesn't support this yet.  Work is underway, and you can try searching ovs-dev to see the current progress.

--Justin



From jeff.forbes at mail.nacon.com  Wed Oct 21 09:47:19 2015
From: jeff.forbes at mail.nacon.com (Jeff Forbes)
Date: Wed, 21 Oct 2015 16:47:19 +0000
Subject: [ovs-discuss] VLANs and DHCP
In-Reply-To: <7588F81E-B1B5-42AD-AD31-3FFFEED64A97@scottlowe.org>
References: <1443791467.30733.40.camel@jeffforbes.nacon.com>
 <7588F81E-B1B5-42AD-AD31-3FFFEED64A97@scottlowe.org>
Message-ID: <1445446038.3213.32.camel@nacon.com>

Scott,

Thanks for you detailed response. I will try to explain in more detail
what we are trying to accomplish with openvswitch and VLANs. The
networking environment we are trying to setup is somewhat out of the
ordinary, as we have many small subnets (only 1-3 VMs each) that are
isolated using ebtables rules. The small subnets are typically in the
larger 10.0.x.y (netmask 255.255.0.0) subnet. For example, one subnet
with two VMs would have IPs of 10.0.1.2 and 10.0.1.10. Another subnet
with two VMs may have 10.0.28.1 and 10.0.28.5. Each of these subnets
would then use the server at 10.0.0.1 to get its IP addresses and for
internet access when configured for that. As I said above, we use
ebtables rules to isolate the networks based on the MAC address. The
reason we are using the 10.0.x.y address space is that sometimes we need
to configure the networking so that the VMs on these small subnets can
communicate with one another. As you might imagine, the ebtables rule
set can get quite long and when there are many interacting subnets the
rule set can become quite complex and does not scale well. The
environment is highly dynamic with sets of VMs and their associated
subnets typically running for only tens of minutes to several hours. An
additional complexity is that one of the VMs could have additional NICs
connected to the 10.1.x.y and 10.2.x.y subnets with additional VMs in
this cluster of VMs where they are only allowed to communicate with
their associated neighbors and would be isolated from similarly
configured clusters of VMs with different IP ranges.

We think that the networking options provided by openvswitch will be
more efficient, scale better and easier to make complex networking
scenarios than using sets of ebtables rules.  The way I currently
envision this working (using the examples above) is that the VMs with
the  10.0.1.2 and 10.0.1.10 IPs would be on one VLAN and the VMs with
the 10.0.28.1 and 10.0.28.5 IPs would be on another VLAN. From what you
have said and my reading, each of these VLANs would have to use dhcrelay
to get its ip from the dhcp server at 10.0.0.1. Since we have to use a
router to allow the dhcrelay to send the messages to 10.0.0.1, we
probably could have the netmasks for these small subnets set to allow
the subnets to be aligned with the VLANs as you have suggested. I have
tried to set up a dhcrelay for this, but I have not yet had success.
However, I was not using any router functionality to facilitate this.
Now for these two VLANs to communicate, they would have to be connected
through a router as you say in your message. Presumable, the openflow
SDN feature in openvswitch would allow for the router functionality
required to allow two (or more) VLANs to communicate with one another,
as well as support the dhcrelay functionality. 

I hope that I have provided sufficient detail to allow for you and other
group members to provide some insight into how to accomplish the type of
networking scenario we need with openvswitch.

Best,

Jeff


On Fri, 2015-10-02 at 08:51 -0600, Scott Lowe wrote:
> Hi Jeff, please see my responses inline, prefixed by [SL].
> 
> 
> Jeff Forbes <jeff.forbes at mail.nacon.com> wrote:
> 
> > I have set up the openvswitch demo for isolating VM traffic using VLANs.
> > The setup works as expected. The difficulty I am having is with using
> > DHCP to assign the IPs. The two VLANs have IP ranges of 10.0.0.x and
> > 10.0.1.x and the netmasks are 255.255.0.0. I have been able to get
> > dnsmasq to assigned IPs for one of the VLANs by  assigning an internal
> > openvswitch port on the DHCP server the ip of 10.0.0.1 and the tag of
> > one of the VLANs.
> 
> 
> [SL] Based on the network addresses and subnet mask provided, you have a
> situation where you have two VLANs (which are Layer 2 broadcast domains)
> inside a single IP network (which is a Layer 3 broadcast domain). This can
> produce some unexpected (and typically undesired) results. Generally, you'll
> align your VLANs with your IP subnets, since systems can't communicate
> across VLANs without passing through a Layer 3 device anyway.
> 
> 
> > The goal is to be able to have multiple vlans with IPs in the 10.0.x.y
> > range and have them assigned IPs based on the VMs MAC address.
> > What is the best way to have the DHCP daemon recognize the different
> > VLANs?
> 
> 
> [SL] DHCP itself is not VLAN-aware and operates within a Layer 2 broadcast
> domain (a VLAN). Without assistance, a single DHCP server in one VLAN won't
> be able to provide IP address leases to systems outside its own VLAN. That
> assistance comes in the form of a DHCP relay, which takes DHCP requests on
> one VLAN and forwards them across a router to the DHCP server in the other
> VLAN.
> 
> 
> > I tried to use the trunk directive, but dnamasq did not respond to the
> > broadcast DHCP request. 
> > 
> > The reason for using the 10.0.x.y address space is that we would like to
> > be able to have some of the VLANs be able to communicate between each
> > other without changing the VLAN tag. Is there a way of doing this?
> 
> 
> [SL] Systems in different VLANs can't communicate with systems in other
> VLANs without passing through a Layer 3 device (a router).
> 
> Can you share a bit more on exactly *what* you're trying to achieve with
> this particular environment, so that we can try to provide some guidance as
> to how to achieve it?
> 


From blp at nicira.com  Wed Oct 21 14:41:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 21 Oct 2015 14:41:32 -0700
Subject: [ovs-discuss] How does OpenvSwitch buffer packets being matched
 by a flow entry
In-Reply-To: <CAAV8_Jqk0dPAKcMBEbJQACNf4hSw6Yb0zj2gyYeB_LXweg3wvw@mail.gmail.com>
References: <CAAV8_Jqk0dPAKcMBEbJQACNf4hSw6Yb0zj2gyYeB_LXweg3wvw@mail.gmail.com>
Message-ID: <20151021214132.GA23825@nicira.com>

On Thu, Oct 22, 2015 at 12:07:05AM +0900, 정세연 wrote:
> I could get useful information from the past discussion about "How does OVS
> buffer the packet inside packet-in message" (
> http://openvswitch.org/pipermail/discuss/2013-October/011580.html)
> 
> In my short understanding, I think that successive packets of any single
> flow that has a matching flow entry are also buffered temporarily like a
> forwarding pipeline queue in a physical switch.
> 
> So if my guess is right, I hope to find some implementation source codes or
> references in OVS.

There is some documentation in ovs-vswitchd(8).

From muralirdev at gmail.com  Wed Oct 21 16:18:10 2015
From: muralirdev at gmail.com (Murali R)
Date: Wed, 21 Oct 2015 16:18:10 -0700
Subject: [ovs-discuss] [ovs-vsctl]
Message-ID: <CAO=R8omprSaL1LTG+KnWprTwz-C=iX9uM=PdyY7j+rVPOoQdSg@mail.gmail.com>

This is a line from devstack

addbr_cmd=sudo ovs-vsctl --no-wait -- --may-exist add-br br-ex

when it is executed, the br-ex is not always showing up in the system,
though it does in ovsdb. Please let me know if we can get this working
consistently with additional settings. I encounter this during unstack  /
stack cycles.

root at sc-nc:/home/muralir# ovs-vsctl show
439d323e-51d0-4bed-92bc-8ee7a89fbd20
    Bridge br-int
        fail_mode: secure
        Port br-int
            Interface br-int
                type: internal
    Bridge br-ex
        Port br-ex
            Interface br-ex
                type: internal


root at sc-nc:/home/muralir# ip addr
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group
default
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
.....
.....(other eth devices attached)...
...
8: ovs-system: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group
default
    link/ether ea:41:7d:55:fc:ce brd ff:ff:ff:ff:ff:ff
9: br-int: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group
default
    link/ether ba:d2:cb:68:8f:42 brd ff:ff:ff:ff:ff:ff
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/821dd479/attachment.html>

From muralirdev at gmail.com  Wed Oct 21 16:24:22 2015
From: muralirdev at gmail.com (Murali R)
Date: Wed, 21 Oct 2015 16:24:22 -0700
Subject: [ovs-discuss] [ovs-vsctl]
In-Reply-To: <CAO=R8omprSaL1LTG+KnWprTwz-C=iX9uM=PdyY7j+rVPOoQdSg@mail.gmail.com>
References: <CAO=R8omprSaL1LTG+KnWprTwz-C=iX9uM=PdyY7j+rVPOoQdSg@mail.gmail.com>
Message-ID: <CAO=R8okQwhZf3GUORpcgdfwWiUqn2NcjWyfyQ4yBRp-u42fS3g@mail.gmail.com>

The logs

Oct 21 23:04:27 sc-nc ovs-vswitchd: ovs|00020|memory|INFO|2472 kB peak
resident set size after 10.0 seconds
Oct 21 23:04:27 sc-nc ovs-vswitchd: ovs|00021|memory|INFO|handlers:1
ports:1 revalidators:1 rules:4
Oct 21 23:07:17 sc-nc ovs-vsctl: ovs|00001|vsctl|INFO|Called as ovs-vsctl
--no-wait -- --may-exist add-br br-ex
Oct 21 23:07:17 sc-nc ovs-vswitchd: ovs|00022|netdev_linux|WARN|ethtool
command ETHTOOL_GFLAGS on network device br-ex failed: No such device
Oct 21 23:07:17 sc-nc ovs-vswitchd: ovs|00023|dpif|WARN|Dropped 3 log
messages in last 181 seconds (most recently, 181 seconds ago) due to
excessive rate
Oct 21 23:07:17 sc-nc ovs-vswitchd: ovs|00024|dpif|WARN|system at ovs-system:
failed to add br-ex as port: No such device
Oct 21 23:07:17 sc-nc ovs-vswitchd: ovs|00025|bridge|INFO|bridge br-ex:
using datapath ID 00006202e5b3804a
Oct 21 23:07:17 sc-nc ovs-vswitchd: ovs|00026|connmgr|INFO|br-ex: added
service controller "punix:/usr/local/var/run/openvswitch/br-ex.mgmt"

Same command worked some time back on the same system.

On Wed, Oct 21, 2015 at 4:18 PM, Murali R <muralirdev at gmail.com> wrote:

> This is a line from devstack
>
> addbr_cmd=sudo ovs-vsctl --no-wait -- --may-exist add-br br-ex
>
> when it is executed, the br-ex is not always showing up in the system,
> though it does in ovsdb. Please let me know if we can get this working
> consistently with additional settings. I encounter this during unstack  /
> stack cycles.
>
> root at sc-nc:/home/muralir# ovs-vsctl show
> 439d323e-51d0-4bed-92bc-8ee7a89fbd20
>     Bridge br-int
>         fail_mode: secure
>         Port br-int
>             Interface br-int
>                 type: internal
>     Bridge br-ex
>         Port br-ex
>             Interface br-ex
>                 type: internal
>
>
> root at sc-nc:/home/muralir# ip addr
> 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group
> default
>     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
>     inet 127.0.0.1/8 scope host lo
>        valid_lft forever preferred_lft forever
>     inet6 ::1/128 scope host
>        valid_lft forever preferred_lft forever
> .....
> .....(other eth devices attached)...
> ...
> 8: ovs-system: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group
> default
>     link/ether ea:41:7d:55:fc:ce brd ff:ff:ff:ff:ff:ff
> 9: br-int: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group
> default
>     link/ether ba:d2:cb:68:8f:42 brd ff:ff:ff:ff:ff:ff
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151021/9ef2ad5f/attachment.html>

From v88abdi at gmail.com  Wed Oct 21 22:57:13 2015
From: v88abdi at gmail.com (V Abdi)
Date: Thu, 22 Oct 2015 09:27:13 +0330
Subject: [ovs-discuss] memory usage in ovs
Message-ID: <CAJ3Zi+B1ruVL2jsqmA1P5h0VCtNoovBCPhs91wW6CemTd0Hb5A@mail.gmail.com>

hi all
does any one know that how much memory a flow entry in an openVswitch use?
thanks in advance
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151022/3ac1a836/attachment.html>

From jpettit at nicira.com  Wed Oct 21 23:29:13 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Wed, 21 Oct 2015 23:29:13 -0700
Subject: [ovs-discuss] memory usage in ovs
In-Reply-To: <CAJ3Zi+B1ruVL2jsqmA1P5h0VCtNoovBCPhs91wW6CemTd0Hb5A@mail.gmail.com>
References: <CAJ3Zi+B1ruVL2jsqmA1P5h0VCtNoovBCPhs91wW6CemTd0Hb5A@mail.gmail.com>
Message-ID: <D5DA0473-DADE-44C2-8884-B639C344E2D8@nicira.com>


> On Oct 21, 2015, at 10:57 PM, V Abdi <v88abdi at gmail.com> wrote:
> 
> hi all
> does any one know that how much memory a flow entry in an openVswitch use?

I haven't measured it recently, but the rule of thumb we've used in the past is 1KB.

--Justin



From kevin.traynor at intel.com  Thu Oct 22 02:48:52 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 22 Oct 2015 09:48:52 +0000
Subject: [ovs-discuss] ovs dpdk low performance despite optimizations
In-Reply-To: <5627B10B.2050302@ps.tu-darmstadt.de>
References: <5627B10B.2050302@ps.tu-darmstadt.de>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7452A2CD1@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Benedikt
> Rudolph
> Sent: Wednesday, October 21, 2015 4:37 PM
> To: discuss at openvswitch.com
> Subject: [ovs-discuss] ovs dpdk low performance despite optimizations
> 
> Hi all,
> in our test scenario we observe comparably low packet forwarding
> performance on a dpdk (2.0) enabled ovs (2.4) switch.
> The configuration is a single bridge (br0) with two dpdk enabled
> interfaces (10 Gbit/s each) as per the Install.DPDK.md example.
> We followed *thoroughly* all performance related optimization steps from
> the above document.

Did you catch the updates to that section on the mainline that were not in
the OVS 2.4 package?
https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#performance-tuning

> 
> Nonetheless the best rate we could get is ca. 2 M packets/s  on each
> interface, which equals to about ca. 1.3 Gbit/s for 64byte sized packets.
> Our comparison is against the “l2fwd” example dpdk application. Using
> “l2fwd“ we can easily achieve 13 M packets /s in the same test
> configuration. The only indicator of something going wrong is a high
> count of ”errs“ packets in the output of “ovs-ofctl dump-ports”.
> 
> In our first runs (using 2 pmd threads) we noticed a high pmd thread
> utilization as reported by the $ovs-appctl dpif-netdev/pmd-stats-show
> command. We made sure to clear the statistics after every observation to
> get an accurate report for the next interval. To mitigate this we
> allowed dpdk to use up to 8 cores on a 12 core (24 ht threads) cpu. We
> also set “other_config:n-dpdk-rxqs=20”. Now we observed “idle“ pmd
> threads but still the packet forwarding performance is limited to the
> above values.
> We also experimented with the amount of huge pages memory.
> 
> Do you know of any *recent* reports on OVS dpdk performance? I found
> some papers on the old dpdk-vswitch versiont which claim much higher
> pkt. counts than I observed.
> 
> What further debugging steps can I make? Below I include the output of
> “ovs-ofctl dump-ports br0" and “ovs-ofctl show br0"
> Note that the output of  says „Max Speed 1000” despite having 10 Gbit
> Interfaces attached. I am not sure wether this is an error.

I see the same, so not causing your poor performance.

> 
> > $ovs-ofctl dump-ports br0
> > OFPST_PORT reply (xid=0x2): 3 ports
> >  port  2: rx pkts=5, bytes=925, drop=0, errs=0, frame=0, over=0, crc=0
> >           tx pkts=47128219, bytes=3016206016, drop=0, errs=0, coll=0
> >  port  1: rx pkts=47130239, bytes=3016335901, drop=0, errs=84435109,
> > frame=0, over=0, crc=0
> >           tx pkts=0, bytes=0, drop=0, errs=0, coll=0
> >  port LOCAL: rx pkts=0, bytes=0, drop=0, errs=0, frame=0, over=0, crc=0
> >           tx pkts=47128251, bytes=2827695060, drop=47128251, errs=0,
> > coll=0
> 
> > $ovs-ofctl show  br0
> > OFPT_FEATURES_REPLY (xid=0x2): dpid:00005cb9018f16e0
> > n_tables:254, n_buffers:256
> > capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> > actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan
> > mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src
> > mod_tp_dst
> > 1(dpdk0): addr:5c:b9:01:xx:xx:xx
> >     config:     0
> >     state:      0
> >     current:    10GB-FD
> >     supported:  100MB-FD 1GB-HD 1GB-FD FIBER AUTO_NEG AUTO_PAUSE
> > AUTO_PAUSE_ASYM
> >     speed: 10000 Mbps now, 1000 Mbps max
> > 2(dpdk1): addr:5c:b9:01:xx:xx:xx
> >     config:     0
> >     state:      0
> >     current:    10GB-FD
> >     supported:  100MB-FD 1GB-HD 1GB-FD FIBER AUTO_NEG AUTO_PAUSE
> > AUTO_PAUSE_ASYM
> >     speed: 10000 Mbps now, 1000 Mbps max
> > LOCAL(br0): addr:5c:b9:01:xx:xx:xx
> >     config:     PORT_DOWN
> >     state:      LINK_DOWN
> >     current:    10MB-FD COPPER
> >     speed: 10 Mbps now, 0 Mbps max
> > OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From sugesh.chandran at intel.com  Thu Oct 22 02:55:42 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Thu, 22 Oct 2015 09:55:42 +0000
Subject: [ovs-discuss] Detailed documentation for configuring native
 userspace-tunneling in OVS with/without DPDK.
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB13CCD711@IRSMSX102.ger.corp.intel.com>

Hello,

I have created a pull request as below to add a native userspace tunneling configuration guide in OVS website source tree.
Please review the same and let me know the comments if any?

https://github.com/openvswitch/openvswitch.github.io/pull/23



Regards
_Sugesh

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151022/545a6027/attachment.html>

From jimsonchacko at gmail.com  Thu Oct 22 04:18:13 2015
From: jimsonchacko at gmail.com (jimson jimson)
Date: Thu, 22 Oct 2015 16:48:13 +0530
Subject: [ovs-discuss] User space & kernel space actions.
In-Reply-To: <7F781436-B829-4A6C-A61F-A2CAA4D5BF09@nicira.com>
References: <56271048.6ac5440a.c66aa.410b@mx.google.com>
 <7F781436-B829-4A6C-A61F-A2CAA4D5BF09@nicira.com>
Message-ID: <5628c5f9.44e5440a.940e2.7bdf@mx.google.com>

Hi

You told about an explicit action called "userspace". What is the ovs-ofctl command option ? Is it the same ?

Regards
Jimson

-----Original Message-----
From: "Justin Pettit" <jpettit at nicira.com>
Sent: ‎21-‎10-‎2015 12:11 PM
To: "jimson jimson" <jimsonchacko at gmail.com>
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
Subject: Re: [ovs-discuss] User space & kernel space actions.


> On Oct 20, 2015, at 9:10 PM, jimson jimson <jimsonchacko at gmail.com> wrote:
> 
> Hi
> 
> Are there any user space actions in ovs which can be done only at user space ? Any examples?

Yes, there are a few.  Setting an ARP field can only be done in userspace.

> Is 'normal' action a user space only action?

No, userspace figures out where the packet should go, but the pushes down kernel flows to do the forwarding.

> If we have a set of actions to be performed, say a user space action then a kernel space action , will they both be performed at the user space? Or is it like, the kernel throws exception -> ovs does user space action -> packet is given to kernel -> kernel does further processing ?

There's an explicit "userspace" action that acts like an output.  Actions will be executed in the order that they're listed, but sending to userspace doesn't pause the processing after it.

--Justin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151022/73a79dd4/attachment.html>

From abraam.athanassios at gmail.com  Wed Oct 21 17:20:36 2015
From: abraam.athanassios at gmail.com (Abraam Athanassios)
Date: Thu, 22 Oct 2015 11:20:36 +1100
Subject: [ovs-discuss] Kernal module problems openvswitch-2.4.0
In-Reply-To: <20151014010114.GB2399@x240.home>
References: <CAJ8cn6PHksGk_MT3qDyYD3PNo5YwTo21jmGVw1Ap_jQPqmrgqQ@mail.gmail.com>
 <9C2F1334-0059-41AD-A89F-28C46C36068D@nicira.com>
 <20151014010114.GB2399@x240.home>
Message-ID: <CAJ8cn6N3HD51bAUBL9oLASzmg7ug3xj+4QVtub3nofcQycugzw@mail.gmail.com>

Thank you for your help i did follow the file step by step and still not
getting it.

Also as brief of what i am doing i am trying to install the OVS on Ubuntu
mate for raspberry pi the previous problems i had that the kernel version
was not compatible with the older OVS's and at the moment i was trying to
install the openvswitch-2.4.0.tar.gz.

I am not sure what is wrong with this.

i have kept trying many times and still having the same problem

could this happen because of the raspberry pi limitations (But i don't
believe so) as i heard that others did install the older versions two years
ago but i can't get the source files to use it.

On Wed, Oct 14, 2015 at 12:01 PM, Flavio Leitner <fbl at sysclose.org> wrote:

> On Mon, Oct 12, 2015 at 09:04:38AM -0700, Justin Pettit wrote:
> >
> > > On Oct 11, 2015, at 7:07 PM, Abraam Athanassios <
> abraam.athanassios at gmail.com> wrote:
> > >
> > > Hi,
> > >
> > > I have used the new openvswitch-2.4.0 to install it on raspberry pi 2
> on operating system Ubuntu mate kernal 3.18.
> > > I am seeking a solution to the problem i am facing.
> > > I did download the openvswitch and when I do execute the
> > >
> > > % sudo make
> > > % sudo make install
> > >
> > > i do not receive any error but when i do execute the
> > >
> > > % insmode datapath/linux/openvswitch.ko
>
> You need to pass an additional parameter to ./configure script
> in order to build the datapath module OR you need to use the
> kernel module provided by your distribution's kernel.
>
> See:
> https://github.com/openvswitch/ovs/blob/master/INSTALL.md
> and look for "To build the Linux kernel module"
>
> fbl
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151022/6cc7591c/attachment-0001.html>

From pavel.shirshov at gmail.com  Thu Oct 22 10:34:55 2015
From: pavel.shirshov at gmail.com (Pavel Shirshov)
Date: Thu, 22 Oct 2015 10:34:55 -0700
Subject: [ovs-discuss] Kernal module problems openvswitch-2.4.0
In-Reply-To: <CAJ8cn6N3HD51bAUBL9oLASzmg7ug3xj+4QVtub3nofcQycugzw@mail.gmail.com>
References: <CAJ8cn6PHksGk_MT3qDyYD3PNo5YwTo21jmGVw1Ap_jQPqmrgqQ@mail.gmail.com>
 <9C2F1334-0059-41AD-A89F-28C46C36068D@nicira.com>
 <20151014010114.GB2399@x240.home>
 <CAJ8cn6N3HD51bAUBL9oLASzmg7ug3xj+4QVtub3nofcQycugzw@mail.gmail.com>
Message-ID: <CALkUq2jrRUjyYv3GfhmUFm40=pH0C7iNmhY9aTpigQzd6j4=_w@mail.gmail.com>

Hi Abraam,

Try the following sequence:
1. wget http://openvswitch.org/releases/openvswitch-2.4.0.tar.gz
2. tar xfz openvswitch-2.4.0.tar.gz
3. cd openvswitch-2.4.0
4. DEB_BUILD_OPTIONS='parallel=2 nocheck' fakeroot debian/rules binary
5. cd ..
6. dpkg -i openvswitch-datapath-dkms_2.4.0-1_all.deb
7. dpkg -i openvswitch-common_2.4.0-1_*.deb
8. dpkg -i openvswitch-switch_2.4.0-1_*.deb

P.S.: Put arm_something instead of asterisk. Try to ls to see the file names.

On Wed, Oct 21, 2015 at 5:20 PM, Abraam Athanassios
<abraam.athanassios at gmail.com> wrote:
> Thank you for your help i did follow the file step by step and still not
> getting it.
>
> Also as brief of what i am doing i am trying to install the OVS on Ubuntu
> mate for raspberry pi the previous problems i had that the kernel version
> was not compatible with the older OVS's and at the moment i was trying to
> install the openvswitch-2.4.0.tar.gz.
>
> I am not sure what is wrong with this.
>
> i have kept trying many times and still having the same problem
>
> could this happen because of the raspberry pi limitations (But i don't
> believe so) as i heard that others did install the older versions two years
> ago but i can't get the source files to use it.
>
> On Wed, Oct 14, 2015 at 12:01 PM, Flavio Leitner <fbl at sysclose.org> wrote:
>>
>> On Mon, Oct 12, 2015 at 09:04:38AM -0700, Justin Pettit wrote:
>> >
>> > > On Oct 11, 2015, at 7:07 PM, Abraam Athanassios
>> > > <abraam.athanassios at gmail.com> wrote:
>> > >
>> > > Hi,
>> > >
>> > > I have used the new openvswitch-2.4.0 to install it on raspberry pi 2
>> > > on operating system Ubuntu mate kernal 3.18.
>> > > I am seeking a solution to the problem i am facing.
>> > > I did download the openvswitch and when I do execute the
>> > >
>> > > % sudo make
>> > > % sudo make install
>> > >
>> > > i do not receive any error but when i do execute the
>> > >
>> > > % insmode datapath/linux/openvswitch.ko
>>
>> You need to pass an additional parameter to ./configure script
>> in order to build the datapath module OR you need to use the
>> kernel module provided by your distribution's kernel.
>>
>> See:
>> https://github.com/openvswitch/ovs/blob/master/INSTALL.md
>> and look for "To build the Linux kernel module"
>>
>> fbl
>>
>>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From rohan.shah at hpe.com  Thu Oct 22 15:30:54 2015
From: rohan.shah at hpe.com (Shah, Rohan Atul)
Date: Thu, 22 Oct 2015 22:30:54 +0000
Subject: [ovs-discuss] Pass traffic between Static LAG/Bond in OpenvSwitch.
 Which Mode keeps all the links active all the time?
Message-ID: <3A515C0938C39041B160DF4D81BFDCCC0F509524@G4W3220.americas.hpqcorp.net>

Hi,



I am trying to pass ping traffic via Static LAGs in openvswitch with bond_mode=balance-slb and lacp inactive. Does all the links stay active in balance-slb mode?

I have tried other modes like balance-tcp and active-backup but none of them keep all the links active.

I want to enable traffic for static LAGs as we use your openvswitch in our product which we have just release, i.e. OpenSwitch.

I have a mininet setup which brings up 2 switches, configures bridges, ports and bonds in access mode on both of them with correct tags and want to ping across from host 1 to host 2.

Any help would be a very great help for our team !

Thanks !

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151022/7de9f2cd/attachment.html>

From chy019 at eng.ucsd.edu  Thu Oct 22 16:07:48 2015
From: chy019 at eng.ucsd.edu (Hans Yu)
Date: Thu, 22 Oct 2015 16:07:48 -0700
Subject: [ovs-discuss] Frames are dropped if its input port and output port
	are the same
Message-ID: <CAPZMhkKwgYgg5A0oBwYjF_4WD6iVoQtxTuMraC-97C2w5zCSnA@mail.gmail.com>

Hi,

I noticed that my Ethernet frames are dropped when their input ports are
the same as their output ports. Even though I have the right rule installed
on to Open vSwitch bridge from my controller, they still get dropped.

Here is the output from ovs-ofctl:
$ sudo ovs-dpctl dump-flows
NXST_FLOW reply (xid=0x4):
 cookie=0xa0000b648a713, duration=30.453s, table=0, n_packets=30,
n_bytes=2940, idle_age=0,
priority=10,in_port=1,dl_src=a0:ce:c8:03:2f:bf,dl_dst=a0:ce:c8:02:e9:e1
actions=output:1

And here is the output from ovs-dpctl:
$ sudo ovs-dpctl dump-flows
recirc_id(0),in_port(3),eth(src=a0:ce:c8:03:2f:bf,dst=a0:ce:c8:02:e9:e1),eth_type(0x0800),ipv4(src=
0.0.4.0/0.0.4.0,dst=0.0.4.0/0.0.4.0,frag=no), packets:17, bytes:1666,
used:0.711s, actions:drop

Since I need an implementation which allows input port and output port of
the frame to be the same, I wonder where I can make those frames not get
dropped but sent out from their incoming port.

Best,

Hans
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151022/48c197ca/attachment.html>

From jpettit at nicira.com  Thu Oct 22 16:15:08 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 22 Oct 2015 16:15:08 -0700
Subject: [ovs-discuss] Frames are dropped if its input port and output
	port are the same
In-Reply-To: <CAPZMhkKwgYgg5A0oBwYjF_4WD6iVoQtxTuMraC-97C2w5zCSnA@mail.gmail.com>
References: <CAPZMhkKwgYgg5A0oBwYjF_4WD6iVoQtxTuMraC-97C2w5zCSnA@mail.gmail.com>
Message-ID: <C5B2EF13-3C59-4A80-B6C7-B527A3F64F38@nicira.com>


> On Oct 22, 2015, at 4:07 PM, Hans Yu <chy019 at eng.ucsd.edu> wrote:
> 
> Hi,
> 
> I noticed that my Ethernet frames are dropped when their input ports are the same as their output ports. Even though I have the right rule installed on to Open vSwitch bridge from my controller, they still get dropped.

From the FAQ:

### Q: I added a flow to send packets out the ingress port, like this:

       ovs-ofctl add-flow br0 in_port=2,actions=2

   but OVS drops the packets instead.

A: Yes, OpenFlow requires a switch to ignore attempts to send a packet
   out its ingress port.  The rationale is that dropping these packets
   makes it harder to loop the network.  Sometimes this behavior can
   even be convenient, e.g. it is often the desired behavior in a flow
   that forwards a packet to several ports ("floods" the packet).

   Sometimes one really needs to send a packet out its ingress port
   ("hairpin"). In this case, output to OFPP_IN_PORT, which in
   ovs-ofctl syntax is expressed as just "in_port", e.g.:

       ovs-ofctl add-flow br0 in_port=2,actions=in_port

   This also works in some circumstances where the flow doesn't match
   on the input port.  For example, if you know that your switch has
   five ports numbered 2 through 6, then the following will send every
   received packet out every port, even its ingress port:

       ovs-ofctl add-flow br0 actions=2,3,4,5,6,in_port

   or, equivalently:

       ovs-ofctl add-flow br0 actions=all,in_port

   Sometimes, in complicated flow tables with multiple levels of
   "resubmit" actions, a flow needs to output to a particular port
   that may or may not be the ingress port.  It's difficult to take
   advantage of OFPP_IN_PORT in this situation.  To help, Open vSwitch
   provides, as an OpenFlow extension, the ability to modify the
   in_port field.  Whatever value is currently in the in_port field is
   the port to which outputs will be dropped, as well as the
   destination for OFPP_IN_PORT.  This means that the following will
   reliably output to port 2 or to ports 2 through 6, respectively:

       ovs-ofctl add-flow br0 in_port=2,actions=load:0->NXM_OF_IN_PORT[],2
       ovs-ofctl add-flow br0 actions=load:0->NXM_OF_IN_PORT[],2,3,4,5,6

   If the input port is important, then one may save and restore it on
   the stack:

        ovs-ofctl add-flow br0 actions=push:NXM_OF_IN_PORT[],\
                                       load:0->NXM_OF_IN_PORT[],\
                                       2,3,4,5,6,\
                                       pop:NXM_OF_IN_PORT[]

--Justin



From azhou at nicira.com  Thu Oct 22 16:36:20 2015
From: azhou at nicira.com (Andy Zhou)
Date: Thu, 22 Oct 2015 16:36:20 -0700
Subject: [ovs-discuss] OVS balance-tcp bonding
In-Reply-To: <CACzMAJLQdYnuH2YE3DxGr1UByu9twE5SJZwtSMb7yKCTnLYTQw@mail.gmail.com>
References: <CAG0YX0W1SexHGNvOE5o65djAkNVR7xQxN5VT2iWKrqrXx6zzPg@mail.gmail.com>
 <CACzMAJLQdYnuH2YE3DxGr1UByu9twE5SJZwtSMb7yKCTnLYTQw@mail.gmail.com>
Message-ID: <CACzMAJK1--ze61fHDWz97L8o0WcuxTnnKyoiG-76hkJBmSmpMg@mail.gmail.com>

Hi, Joe,

This is potentially a better fix that I'd like to propose for the
'net' tree. It would be great if you can test it in your set up to
see if it solved the issue you are facing with.

Thanks,

andy

diff --git a/datapath/actions.c b/datapath/actions.c
index c529bbb..208eb30 100644
--- a/datapath/actions.c
+++ b/datapath/actions.c
@@ -1003,11 +1003,11 @@ int ovs_execute_actions(struct datapath *dp,
struct sk_buff *skb,
        err = do_execute_actions(dp, skb, key,
                                 acts->actions, acts->actions_len);

-       if (!level)
-               process_deferred_actions(dp);
-
        this_cpu_dec(exec_actions_level);

+       if (level <= 1)
+               process_deferred_actions(dp);
+
        /* This return status currently does not reflect the errors
         * encounted during deferred actions execution. Probably needs to
         * be fixed in the future.



On Tue, Oct 20, 2015 at 8:55 PM, Andy Zhou <azhou at nicira.com> wrote:
> On Tue, Oct 20, 2015 at 1:42 PM, Joe Talerico <jtaleric at redhat.com> wrote:
>> When using balance-tcp bonding with OVS we were seeing ARP issues when we
>> reached ~ 100 guests. I Tracked as much as possible here :
>> https://bugzilla.redhat.com/show_bug.cgi?id=1267291
>>
>> Has anyone seen this behavior before?
>>
>> Switching to active/backup resolves the issue.
>
> Thanks for reporting the issue with lots of relevant information.  I
> have not seen this issue before.
> One the error messages in the bugzilla report suggested that you may
> ran into the deferred action fifo limit.
>
> Would you please try to increase its size with the following patch,
> and report back how much it helped. This changes OVS kernel module, so
> you will have to recompile the kernel module.
>
> This is not like the right fix, but should help to confirm if there
> are any other issues in the way to get your set up working.
>
> diff --git a/datapath/actions.c b/datapath/actions.c
> index c529bbb..a4afecb 100644
> --- a/datapath/actions.c
> +++ b/datapath/actions.c
> @@ -53,7 +53,7 @@ struct deferred_action {
>         struct sw_flow_key pkt_key;
>  };
>
> -#define DEFERRED_ACTION_FIFO_SIZE 10
> +#define DEFERRED_ACTION_FIFO_SIZE 100
>  struct action_fifo {
>         int head;
>         int tail;

From muralirdev at gmail.com  Thu Oct 22 16:42:21 2015
From: muralirdev at gmail.com (Murali R)
Date: Thu, 22 Oct 2015 16:42:21 -0700
Subject: [ovs-discuss] [ovn] multi node ovn debugging
Message-ID: <CAO=R8onNTRAFVFtpp_B1iv15Z5TQLd3Dmto8ZvPZg6Z6LyhRcw@mail.gmail.com>

I am trying to debug the multi node ovn setup. I see the tunnels are
created,  the associations seems to be done (port, datapath etc) in the db
- however the overlay network (10.0.0.0/24) is accessible only from the
node running ovn-controller (even after attaching floating ip through
neutron).

Even with neutron based setup, I don't see traffic across nodes. The VMs
are created on 2 nodes. On controller node they can talk to each other but
not across tunnel

How can I debug this? In nodes not running ovn, there are no api set
working. Is it possible to crank up logs? I am lost. Please help.

-Murali
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151022/2dc89e66/attachment.html>

From srobertson+ovs at appcomsci.com  Thu Oct 22 17:21:37 2015
From: srobertson+ovs at appcomsci.com (Seth Robertson)
Date: Thu, 22 Oct 2015 20:21:37 -0400
Subject: [ovs-discuss] Is conntrack support working?
Message-ID: <201510230021.t9N0Lbda016703@srobertson.appcomsci.com>


I see openvswitch conntrack support in the source code (master branch)
and discussed in various presentations, but any simple test I attempt
fails utterly as do the test cases in the openvswitch code.

I specifically just installed Fedora 23 in a VM and updated to the
latest RPMs which gave me a 4.3 kernel.  I then compiled openvswitch.
The `make check` tests passed, but `make check-system-userspace`
skipped the conntrack tests (perhaps as expected?) and `make
check-kernel` failed those tests.

----------------------------------------------------------------------
./system-traffic.at:162: ovs-ofctl add-flows br0 flows.txt
--- /dev/null   2015-10-22 15:04:00.905000000 -0400
+++ /home/s/ovs/tests/system-kmod-testsuite.dir/at-groups/6/stderr   2015-10-22 16:07:56.517203730 -0400
@@ -0,0 +1,7 @@
+OFPT_ERROR (xid=0xc): OFPBMC_BAD_FIELD
+NXT_FLOW_MOD (xid=0xc):
+(***truncated to 64 bytes from 88***)
+00000000  01 04 00 58 00 00 00 0c-00 00 23 20 00 00 00 0d |...X......# ....|
+00000010  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 64 |...............d|
+00000020  ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00 |................|
+00000030  00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01 |................|
./system-traffic.at:162: exit code was 1, expected 0
----------------------------------------------------------------------

This is using today's (2015-10-22) openvswitch git repo.  I would be
perfectly happy to try another version.

But perhaps this is all a blind alley for me.  My real goal is for
conntrack and the ftp helper (alg=) to help with NAT to translate the
payload PORT and PASV data containing NAT'd IP addresses.  It isn't
clear whether this functionality is supported.

Thanks,
                                        -Seth Robertson

From joestringer at nicira.com  Thu Oct 22 17:51:52 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 22 Oct 2015 17:51:52 -0700
Subject: [ovs-discuss] Is conntrack support working?
In-Reply-To: <201510230021.t9N0Lbda016703@srobertson.appcomsci.com>
References: <201510230021.t9N0Lbda016703@srobertson.appcomsci.com>
Message-ID: <CANr6G5whqH-019tx57FHzkC2Fm0ApeOXipbQDih9addcdQbsZg@mail.gmail.com>

On 22 October 2015 at 17:21, Seth Robertson
<srobertson+ovs at appcomsci.com> wrote:
>
> I see openvswitch conntrack support in the source code (master branch)
> and discussed in various presentations, but any simple test I attempt
> fails utterly as do the test cases in the openvswitch code.
>
> I specifically just installed Fedora 23 in a VM and updated to the
> latest RPMs which gave me a 4.3 kernel.  I then compiled openvswitch.
> The `make check` tests passed, but `make check-system-userspace`
> skipped the conntrack tests (perhaps as expected?) and `make
> check-kernel` failed those tests.

For what it's worth, Linux-4.3 isn't released yet and some things have
changed in the ABI recently, so without knowing exactly which upstream
commit the fedora-provided kernel comes from, I couldn't tell you if
it works. The most reliable way to test today would be to grab the
linux "net" tree and compile yourself. Alternatively you could wait
for the actual Linux-4.3 release and grab a fresh kernel then (it
should be in the next couple of weeks).

Userspace conntrack support is missing at the moment, so skipping
those tests is to be expected.

> ----------------------------------------------------------------------
> ./system-traffic.at:162: ovs-ofctl add-flows br0 flows.txt
> --- /dev/null   2015-10-22 15:04:00.905000000 -0400
> +++ /home/s/ovs/tests/system-kmod-testsuite.dir/at-groups/6/stderr   2015-10-22 16:07:56.517203730 -0400
> @@ -0,0 +1,7 @@
> +OFPT_ERROR (xid=0xc): OFPBMC_BAD_FIELD
> +NXT_FLOW_MOD (xid=0xc):
> +(***truncated to 64 bytes from 88***)
> +00000000  01 04 00 58 00 00 00 0c-00 00 23 20 00 00 00 0d |...X......# ....|
> +00000010  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 64 |...............d|
> +00000020  ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00 |................|
> +00000030  00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01 |................|
> ./system-traffic.at:162: exit code was 1, expected 0
> ----------------------------------------------------------------------

When the kernel doesn't support connection tracking, then an OpenFlow
controller tries to install flows which match on connection tracking
state, OVS will reject those flows with this kind of "bad field"
error. If you go to the top of the ovs-vswitchd log, I suspect that
you'll see a few messages along the lines of "datapath does not
support ct_state". The kernel may also print some relevant logs to
dmesg.

> This is using today's (2015-10-22) openvswitch git repo.  I would be
> perfectly happy to try another version.
>
> But perhaps this is all a blind alley for me.  My real goal is for
> conntrack and the ftp helper (alg=) to help with NAT to translate the
> payload PORT and PASV data containing NAT'd IP addresses.  It isn't
> clear whether this functionality is supported.

There is no NAT support in OVS tree at the moment; Jarno posted an RFC
patch series recently and that's the bleeding edge.

From zhouhan at gmail.com  Thu Oct 22 21:45:09 2015
From: zhouhan at gmail.com (Han Zhou)
Date: Thu, 22 Oct 2015 21:45:09 -0700
Subject: [ovs-discuss] [ovn] multi node ovn debugging
In-Reply-To: <CAO=R8onNTRAFVFtpp_B1iv15Z5TQLd3Dmto8ZvPZg6Z6LyhRcw@mail.gmail.com>
References: <CAO=R8onNTRAFVFtpp_B1iv15Z5TQLd3Dmto8ZvPZg6Z6LyhRcw@mail.gmail.com>
Message-ID: <CADtzDC=0rwR6voi6n9SQjiZaZ=rh_pzP_3KXH-6SevaVW_OYJw@mail.gmail.com>

Hi Murali,

On Thu, Oct 22, 2015 at 4:42 PM, Murali R <muralirdev at gmail.com> wrote:
> I am trying to debug the multi node ovn setup. I see the tunnels are
> created,  the associations seems to be done (port, datapath etc) in the db -
> however the overlay network (10.0.0.0/24) is accessible only from the node
> running ovn-controller (even after attaching floating ip through neutron).
>

What do you mean by "the node running ovn-controller". Each node
should be running a ovn-controller. And the centralized one is called
ovs-northd.

> Even with neutron based setup, I don't see traffic across nodes. The VMs are
> created on 2 nodes. On controller node they can talk to each other but not
> across tunnel
>

If vms on same node can access each other, but not across tunnel, you
might check is tunnel set up properly. Did you see tunnel port in
ovs-dpctl show?

> How can I debug this? In nodes not running ovn, there are no api set
> working. Is it possible to crank up logs? I am lost. Please help.
>

Dump the southbound DB would help:
ovsdb-client dump OVN_Southbound

Han

From v88abdi at gmail.com  Thu Oct 22 23:46:12 2015
From: v88abdi at gmail.com (V Abdi)
Date: Fri, 23 Oct 2015 10:16:12 +0330
Subject: [ovs-discuss] memory usage in ovs
In-Reply-To: <D5DA0473-DADE-44C2-8884-B639C344E2D8@nicira.com>
References: <CAJ3Zi+B1ruVL2jsqmA1P5h0VCtNoovBCPhs91wW6CemTd0Hb5A@mail.gmail.com>
 <D5DA0473-DADE-44C2-8884-B639C344E2D8@nicira.com>
Message-ID: <CAJ3Zi+BtUPg18WWmTfOS3_AcsHVWX-_twjcC88CDPoe0dF=e6w@mail.gmail.com>

thanks Justin Pettit
is there any reference for this? i want to use it in my document.

On Thu, Oct 22, 2015 at 9:59 AM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Oct 21, 2015, at 10:57 PM, V Abdi <v88abdi at gmail.com> wrote:
> >
> > hi all
> > does any one know that how much memory a flow entry in an openVswitch
> use?
>
> I haven't measured it recently, but the rule of thumb we've used in the
> past is 1KB.
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151023/4e404212/attachment.html>

From jpettit at nicira.com  Fri Oct 23 00:14:47 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Fri, 23 Oct 2015 00:14:47 -0700
Subject: [ovs-discuss] memory usage in ovs
In-Reply-To: <CAJ3Zi+BtUPg18WWmTfOS3_AcsHVWX-_twjcC88CDPoe0dF=e6w@mail.gmail.com>
References: <CAJ3Zi+B1ruVL2jsqmA1P5h0VCtNoovBCPhs91wW6CemTd0Hb5A@mail.gmail.com>
 <D5DA0473-DADE-44C2-8884-B639C344E2D8@nicira.com>
 <CAJ3Zi+BtUPg18WWmTfOS3_AcsHVWX-_twjcC88CDPoe0dF=e6w@mail.gmail.com>
Message-ID: <44B1C4E5-6C27-4025-9821-38F04712FA96@nicira.com>


> On Oct 22, 2015, at 11:46 PM, V Abdi <v88abdi at gmail.com> wrote:
> 
> thanks Justin Pettit
> is there any reference for this? i want to use it in my document.

Unfortunately, I'm not aware of one.

--Justin



From kursat.kobya at argela.com.tr  Fri Oct 23 00:59:37 2015
From: kursat.kobya at argela.com.tr (Kursat Kobya)
Date: Fri, 23 Oct 2015 10:59:37 +0300
Subject: [ovs-discuss] Fwd: lib/dpdk-link.c:25:24: fatal error:
 rte_config.h: No such file or directory #include <rte_config.h>
In-Reply-To: <CAHXFQY0mvV7CgrBxj1=SR72GtKBefrzRx=D++gb57QKfJ7Z6-w@mail.gmail.com>
References: <CAHXFQY0mvV7CgrBxj1=SR72GtKBefrzRx=D++gb57QKfJ7Z6-w@mail.gmail.com>
Message-ID: <CAHXFQY0j5FnEGkjNgdR0r_Qr7eBWDvWVRgeBhgWpejFcPLgsag@mail.gmail.com>

Hello,

I am trying to install and use DPDK vSwitch on Fedora 20. I have installed
dpdk dpdk-2.1.0 and openvswitchdpdk.l.1.1.0. And followed guideline,
https://github.com/01org/dpdk-ovs/blob/development/docs/01_Installation.md
I have already build and install all necessary requirements requirements,
extract source files as indicated in guide, make dpdk. And afterall when
trying to make OpenvSwitch it gave following error

lib/dpdk-link.c:25:24: fatal error: rte_config.h: No such file or directory
 #include <rte_config.h>

my environment variables are as follows :

RTE_SDK=/home/kursad/ovs_dpdk/DPDK
RTE_TARGET=x86_64-ivshmem-linuxapp-gcc

when i search for rte_config.h in the file system i can see it under
./home/kursad/ovs_dpdk/DPDK/x86_64-ivshmem-linuxapp-gcc/include/rte_config.h

i tried to run command make install under dpdk while trying to fix this
problem, it also failed but put another rte_config.h under
./home/kursad/ovs_dpdk/DPDK/x86_64-ivshmem-linuxapp-icc/include/rte_config.h

yet this did not giver any further development and i gave same error again
when i try to make OpenvSwitch.

I also search this issue on the web but couldn't enough clue to fix
problem.
Could you please help me about fixing this problem.

Thanks,
Kursat
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151023/291ca549/attachment.html>

From mehtaneeraj07 at gmail.com  Fri Oct 23 02:23:52 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Fri, 23 Oct 2015 14:53:52 +0530
Subject: [ovs-discuss] Push Vlan over a ARP packet
Message-ID: <CAHN905Km45d85+dxw_quQLRNfSE6V1ub6ojS2yuJLoKV+nAZ5w@mail.gmail.com>

Hello team,

I want to know can I apply push vlan over a ARP packet.
Is it correct to do so?


Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151023/73f28aef/attachment.html>

From muralirdev at gmail.com  Fri Oct 23 08:09:14 2015
From: muralirdev at gmail.com (Murali R)
Date: Fri, 23 Oct 2015 08:09:14 -0700
Subject: [ovs-discuss] [ovn] multi node ovn debugging
In-Reply-To: <CADtzDC=0rwR6voi6n9SQjiZaZ=rh_pzP_3KXH-6SevaVW_OYJw@mail.gmail.com>
References: <CAO=R8onNTRAFVFtpp_B1iv15Z5TQLd3Dmto8ZvPZg6Z6LyhRcw@mail.gmail.com>
 <CADtzDC=0rwR6voi6n9SQjiZaZ=rh_pzP_3KXH-6SevaVW_OYJw@mail.gmail.com>
Message-ID: <CAO=R8onrM2cr0SSjvuA8P6b-9s7jg8VcAJy3PW4_XHtz6JAWnA@mail.gmail.com>

Han, thanks for suggestions. Yes I had tried all that. Controller means
node running northd. The issue is databases are all looking ok and so are
tunnels they have tunnel address correct on both sides. But the overlay
network created is not reachable in remote node. Host routing is not
applicable here because the network is extended through tunnel. I looked at
ovs-appctl routes and the 10.0.0.0/24 is not in there. Should we manually
add the route thru appctl? Or how to debug the routing from remote node
works? Or any other host route setup is needed? For instance I can ping
q-router interface from remote node. But not sure why network is not
available through tunnel.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151023/e2d1cdce/attachment.html>

From fbl at redhat.com  Fri Oct 23 09:05:21 2015
From: fbl at redhat.com (Flavio Leitner)
Date: Fri, 23 Oct 2015 14:05:21 -0200
Subject: [ovs-discuss] OVS balance-tcp bonding
In-Reply-To: <CACzMAJK1--ze61fHDWz97L8o0WcuxTnnKyoiG-76hkJBmSmpMg@mail.gmail.com>
References: <CAG0YX0W1SexHGNvOE5o65djAkNVR7xQxN5VT2iWKrqrXx6zzPg@mail.gmail.com>
 <CACzMAJLQdYnuH2YE3DxGr1UByu9twE5SJZwtSMb7yKCTnLYTQw@mail.gmail.com>
 <CACzMAJK1--ze61fHDWz97L8o0WcuxTnnKyoiG-76hkJBmSmpMg@mail.gmail.com>
Message-ID: <20151023160521.GC7168@x240.home>


Hi Andy,

I built a test package with your previous patch to Joe, but
we need to schedule an appropriate time to test it, so it's
a bit slow on that front.

Having said that, which patch do you think is better to try first?

Thanks,
fbl

On Thu, Oct 22, 2015 at 04:36:20PM -0700, Andy Zhou wrote:
> Hi, Joe,
> 
> This is potentially a better fix that I'd like to propose for the
> 'net' tree. It would be great if you can test it in your set up to
> see if it solved the issue you are facing with.
> 
> Thanks,
> 
> andy
> 
> diff --git a/datapath/actions.c b/datapath/actions.c
> index c529bbb..208eb30 100644
> --- a/datapath/actions.c
> +++ b/datapath/actions.c
> @@ -1003,11 +1003,11 @@ int ovs_execute_actions(struct datapath *dp,
> struct sk_buff *skb,
>         err = do_execute_actions(dp, skb, key,
>                                  acts->actions, acts->actions_len);
> 
> -       if (!level)
> -               process_deferred_actions(dp);
> -
>         this_cpu_dec(exec_actions_level);
> 
> +       if (level <= 1)
> +               process_deferred_actions(dp);
> +
>         /* This return status currently does not reflect the errors
>          * encounted during deferred actions execution. Probably needs to
>          * be fixed in the future.
> 
> 
> 
> On Tue, Oct 20, 2015 at 8:55 PM, Andy Zhou <azhou at nicira.com> wrote:
> > On Tue, Oct 20, 2015 at 1:42 PM, Joe Talerico <jtaleric at redhat.com> wrote:
> >> When using balance-tcp bonding with OVS we were seeing ARP issues when we
> >> reached ~ 100 guests. I Tracked as much as possible here :
> >> https://bugzilla.redhat.com/show_bug.cgi?id=1267291
> >>
> >> Has anyone seen this behavior before?
> >>
> >> Switching to active/backup resolves the issue.
> >
> > Thanks for reporting the issue with lots of relevant information.  I
> > have not seen this issue before.
> > One the error messages in the bugzilla report suggested that you may
> > ran into the deferred action fifo limit.
> >
> > Would you please try to increase its size with the following patch,
> > and report back how much it helped. This changes OVS kernel module, so
> > you will have to recompile the kernel module.
> >
> > This is not like the right fix, but should help to confirm if there
> > are any other issues in the way to get your set up working.
> >
> > diff --git a/datapath/actions.c b/datapath/actions.c
> > index c529bbb..a4afecb 100644
> > --- a/datapath/actions.c
> > +++ b/datapath/actions.c
> > @@ -53,7 +53,7 @@ struct deferred_action {
> >         struct sw_flow_key pkt_key;
> >  };
> >
> > -#define DEFERRED_ACTION_FIFO_SIZE 10
> > +#define DEFERRED_ACTION_FIFO_SIZE 100
> >  struct action_fifo {
> >         int head;
> >         int tail;
> 

From takahashi.minoru7 at gmail.com  Thu Oct 22 19:54:02 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Fri, 23 Oct 2015 11:54:02 +0900
Subject: [ovs-discuss] Problem about QueueGetConfig message
Message-ID: <5629A14A.9030207@gmail.com>

Hi,

I send QueueGetConfig message(*OFPP_ANY* was set to port) to OVS(openflow1.3),
then the following errors occured.

 Version: 1.3 (0x04)
 Type: OFPET_QUEUE_OP_FAILED (9)
 Code: OFPQOFC_BAD_PORT (0)

Is this a bug?

From kursat.kobya at gmail.com  Fri Oct 23 00:11:04 2015
From: kursat.kobya at gmail.com (Kursat Kobya)
Date: Fri, 23 Oct 2015 10:11:04 +0300
Subject: [ovs-discuss] lib/dpdk-link.c:25:24: fatal error: rte_config.h: No
 such file or directory #include <rte_config.h>
Message-ID: <CAHXFQY0mvV7CgrBxj1=SR72GtKBefrzRx=D++gb57QKfJ7Z6-w@mail.gmail.com>

Hello,

I am trying to install and use DPDK vSwitch on Fedora 20. I have installed
dpdk dpdk-2.1.0 and openvswitchdpdk.l.1.1.0. And followed guideline,
https://github.com/01org/dpdk-ovs/blob/development/docs/01_Installation.md
I have already build and install all necessary requirements requirements,
extract source files as indicated in guide, make dpdk. And afterall when
trying to make OpenvSwitch it gave following error

lib/dpdk-link.c:25:24: fatal error: rte_config.h: No such file or directory
 #include <rte_config.h>

my environment variables are as follows :

RTE_SDK=/home/kursad/ovs_dpdk/DPDK
RTE_TARGET=x86_64-ivshmem-linuxapp-gcc

when i search for rte_config.h in the file system i can see it under
./home/kursad/ovs_dpdk/DPDK/x86_64-ivshmem-linuxapp-gcc/include/rte_config.h

i tried to run command make install under dpdk while trying to fix this
problem, it also failed but put another rte_config.h under
./home/kursad/ovs_dpdk/DPDK/x86_64-ivshmem-linuxapp-icc/include/rte_config.h

yet this did not giver any further development and i gave same error again
when i try to make OpenvSwitch.

I also search this issue on the web but couldn't enough clue to fix
problem.
Could you please help me about fixing this problem.

Thanks,
Kursat
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151023/0149f823/attachment.html>

From kevin.traynor at intel.com  Fri Oct 23 09:42:39 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Fri, 23 Oct 2015 16:42:39 +0000
Subject: [ovs-discuss] Fwd: lib/dpdk-link.c:25:24: fatal error:
 rte_config.h: No such file or directory #include <rte_config.h>
In-Reply-To: <CAHXFQY0j5FnEGkjNgdR0r_Qr7eBWDvWVRgeBhgWpejFcPLgsag@mail.gmail.com>
References: <CAHXFQY0mvV7CgrBxj1=SR72GtKBefrzRx=D++gb57QKfJ7Z6-w@mail.gmail.com>
 <CAHXFQY0j5FnEGkjNgdR0r_Qr7eBWDvWVRgeBhgWpejFcPLgsag@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7452A770E@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Kursat
> Kobya
> Sent: Friday, October 23, 2015 9:00 AM
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] Fwd: lib/dpdk-link.c:25:24: fatal error: rte_config.h:
> No such file or directory #include <rte_config.h>
> 
> Hello,
> 
> I am trying to install and use DPDK vSwitch on Fedora 20. I have installed
> dpdk dpdk-2.1.0 and openvswitchdpdk.l.1.1.0. And followed
> guideline, https://github.com/01org/dpdk-
> ovs/blob/development/docs/01_Installation.md

The above is OVDK which is a fork of OVS that Intel previously worked on.
The mailing list for it is at https://lists.01.org/mailman/listinfo/dpdk-ovs

> I have already build and install all necessary requirements requirements,
> extract source files as indicated in guide, make dpdk. And afterall when
> trying to make OpenvSwitch it gave following error
> 
> lib/dpdk-link.c:25:24: fatal error: rte_config.h: No such file or directory
>  #include <rte_config.h>
> 
> my environment variables are as follows :
> 
> RTE_SDK=/home/kursad/ovs_dpdk/DPDK
> RTE_TARGET=x86_64-ivshmem-linuxapp-gcc
> 
> when i search for rte_config.h in the file system i can see it under
> ./home/kursad/ovs_dpdk/DPDK/x86_64-ivshmem-linuxapp-gcc/include/rte_config.h
> 
> i tried to run command make install under dpdk while trying to fix this
> problem, it also failed but put another rte_config.h under
> ./home/kursad/ovs_dpdk/DPDK/x86_64-ivshmem-linuxapp-icc/include/rte_config.h
> 
> yet this did not giver any further development and i gave same error again
> when i try to make OpenvSwitch.
> 
> I also search this issue on the web but couldn't enough clue to fix problem.
> Could you please help me about fixing this problem.
> 
> Thanks,
> Kursat
> 


From zhouhan at gmail.com  Fri Oct 23 09:59:06 2015
From: zhouhan at gmail.com (Han Zhou)
Date: Fri, 23 Oct 2015 09:59:06 -0700
Subject: [ovs-discuss] [ovn] multi node ovn debugging
Message-ID: <CADtzDC=nF_9c3Hxbw98K0S6zw+S+miY-1SyV4kgSv+PP9RoLVw@mail.gmail.com>

Sorry that I dropped the list.

It looks the tunnel is good. I would recommend to look into L2 before
mixing with qrouter:
1. tcpdump on each tap when ping between the 2 VMs on different nodes,
find out where the packet (ARP or ICMP) is dropped.
2. ovs-dpctl dump-flow on the node that packet is dropped to see the drop flow,
3. use ovs-appctl ofproto/trace "<drop flow>" and compare with
southbound DB pipeline to find out which step is missing.

You can find out the port uuid by the MACs in your tap interface and
then lookup the port binding table in SB.

Hope this helps.

Han

On Fri, Oct 23, 2015 at 9:05 AM, Murali R <muralirdev at gmail.com> wrote:
> On Fri, Oct 23, 2015 at 8:26 AM, Han Zhou <zhouhan at gmail.com> wrote:
>>
>> Could you provide the output of the 2 commands?
>> ovs-appctl dpif/show
>> ovsdb-client dump OVN_Southbound
>
>
> system at ovs-system: hit:32 missed:11
>         br-int:
>                 br-int 65534/1: (internal)
>                 ovn-af04a6-0 1/2: (geneve: key=flow, remote_ip=192.168.3.2)
>                 qp-mdoc1 2/3: (system)
>                 tapb958d3fc-47 4/4: (system)
> root at sc-compute-2:/home/muralir/sdev/stack/devstack# ovs-appctl dpctl/show
> system at ovs-system:
>         lookups: hit:32 missed:11 lost:0
>         flows: 0
>         masks: hit:34 total:0 hit/pkt:0.79
>         port 0: ovs-system (internal)
>         port 1: br-int (internal)
>         port 2: genev_sys_6081 (geneve)
>         port 3: qp-mdoc1
>         port 4: tapb958d3fc-47
>
> Attached the output of OVN_Southbound. That's bulky.
>
> To get a few things in order:
> muralir at sc-nc:~/sdev/stack/devstack$ ovn-nbctl lswitch-list
> b14b642d-cb5a-4769-8023-078b2204b20d
> (neutron-5ba74f64-a006-47e3-a7c3-c3e8993616e9)
> 74a4ab4b-71c9-4382-8f67-bb9a013aaf93
> (neutron-90280d8b-5270-4b6c-ba3a-1421c34868b6)
> 108693b9-6c7c-45c6-9c78-eb06a75e8f74
> (neutron-d52d19c6-f4a2-4723-a6e2-215988a3f65f)
>
> This is a lot of data Han. If you can let me know how to look for ouerlay
> routing is done from remote node, I can look through the data. There are 2
> networks and one ext-net through neutron. The overlay goes though
> 192.168.3.0/24 and tunnel ep are looking fine. However, the qrouters are in
> ext-net accessible through 192.168.5.151. The 10.0.0.0/24 is supposed to
> route through that q-router, however the network is not identified at remote
> node. I cannot reach 192.168.5.151 directly from remote node (sc-compute-2)
> - or should I be? That is the external part. As for Southbound entries, I
> will also go through it and see if there is any clues, but I confess I don't
> understand all tables too well. I only see the ports mappings and datapath
> are associated fine.Thank you so much for looking into this.
>
> -Murali
>
>

From azhou at nicira.com  Fri Oct 23 10:04:05 2015
From: azhou at nicira.com (Andy Zhou)
Date: Fri, 23 Oct 2015 10:04:05 -0700
Subject: [ovs-discuss] OVS balance-tcp bonding
In-Reply-To: <20151023160521.GC7168@x240.home>
References: <CAG0YX0W1SexHGNvOE5o65djAkNVR7xQxN5VT2iWKrqrXx6zzPg@mail.gmail.com>
 <CACzMAJLQdYnuH2YE3DxGr1UByu9twE5SJZwtSMb7yKCTnLYTQw@mail.gmail.com>
 <CACzMAJK1--ze61fHDWz97L8o0WcuxTnnKyoiG-76hkJBmSmpMg@mail.gmail.com>
 <20151023160521.GC7168@x240.home>
Message-ID: <CACzMAJJSO7ivPKT1vYbD9PoxbLQ9H9u5jjM5cEVBGCNgKWppYA@mail.gmail.com>

Thanks for getting back to me.

It would be good to try both if at all possible. 2nd patch is probably
closer to what I plan to post for the 'net' tree.

On Fri, Oct 23, 2015 at 9:05 AM, Flavio Leitner <fbl at redhat.com> wrote:
>
> Hi Andy,
>
> I built a test package with your previous patch to Joe, but
> we need to schedule an appropriate time to test it, so it's
> a bit slow on that front.
>
> Having said that, which patch do you think is better to try first?
>
> Thanks,
> fbl
>
> On Thu, Oct 22, 2015 at 04:36:20PM -0700, Andy Zhou wrote:
>> Hi, Joe,
>>
>> This is potentially a better fix that I'd like to propose for the
>> 'net' tree. It would be great if you can test it in your set up to
>> see if it solved the issue you are facing with.
>>
>> Thanks,
>>
>> andy
>>
>> diff --git a/datapath/actions.c b/datapath/actions.c
>> index c529bbb..208eb30 100644
>> --- a/datapath/actions.c
>> +++ b/datapath/actions.c
>> @@ -1003,11 +1003,11 @@ int ovs_execute_actions(struct datapath *dp,
>> struct sk_buff *skb,
>>         err = do_execute_actions(dp, skb, key,
>>                                  acts->actions, acts->actions_len);
>>
>> -       if (!level)
>> -               process_deferred_actions(dp);
>> -
>>         this_cpu_dec(exec_actions_level);
>>
>> +       if (level <= 1)
>> +               process_deferred_actions(dp);
>> +
>>         /* This return status currently does not reflect the errors
>>          * encounted during deferred actions execution. Probably needs to
>>          * be fixed in the future.
>>
>>
>>
>> On Tue, Oct 20, 2015 at 8:55 PM, Andy Zhou <azhou at nicira.com> wrote:
>> > On Tue, Oct 20, 2015 at 1:42 PM, Joe Talerico <jtaleric at redhat.com> wrote:
>> >> When using balance-tcp bonding with OVS we were seeing ARP issues when we
>> >> reached ~ 100 guests. I Tracked as much as possible here :
>> >> https://bugzilla.redhat.com/show_bug.cgi?id=1267291
>> >>
>> >> Has anyone seen this behavior before?
>> >>
>> >> Switching to active/backup resolves the issue.
>> >
>> > Thanks for reporting the issue with lots of relevant information.  I
>> > have not seen this issue before.
>> > One the error messages in the bugzilla report suggested that you may
>> > ran into the deferred action fifo limit.
>> >
>> > Would you please try to increase its size with the following patch,
>> > and report back how much it helped. This changes OVS kernel module, so
>> > you will have to recompile the kernel module.
>> >
>> > This is not like the right fix, but should help to confirm if there
>> > are any other issues in the way to get your set up working.
>> >
>> > diff --git a/datapath/actions.c b/datapath/actions.c
>> > index c529bbb..a4afecb 100644
>> > --- a/datapath/actions.c
>> > +++ b/datapath/actions.c
>> > @@ -53,7 +53,7 @@ struct deferred_action {
>> >         struct sw_flow_key pkt_key;
>> >  };
>> >
>> > -#define DEFERRED_ACTION_FIFO_SIZE 10
>> > +#define DEFERRED_ACTION_FIFO_SIZE 100
>> >  struct action_fifo {
>> >         int head;
>> >         int tail;
>>

From muralirdev at gmail.com  Fri Oct 23 13:14:39 2015
From: muralirdev at gmail.com (Murali R)
Date: Fri, 23 Oct 2015 13:14:39 -0700
Subject: [ovs-discuss] [ovn] multi node ovn debugging
In-Reply-To: <CADtzDC=nF_9c3Hxbw98K0S6zw+S+miY-1SyV4kgSv+PP9RoLVw@mail.gmail.com>
References: <CADtzDC=nF_9c3Hxbw98K0S6zw+S+miY-1SyV4kgSv+PP9RoLVw@mail.gmail.com>
Message-ID: <CAO=R8onp27V1uJqt75Vj1jv=z-uOsDo9apvjpYYwBKTJYn0Q9Q@mail.gmail.com>

Thanks Han. I will check again, but last time no packets were going out of
the switch port. I think something in network config is missing, not sure
what. The tunnel itself is created alright but for ovn there is an extra
element of vlan mapping for network isolation through the tinnel, but don't
know how to debug that. The geneve vni equivalent for each lport is
different from network vni. Not sure if that's how it is. With ovs agent,
the datapath vni was used to tunnel across for each network.
On Oct 23, 2015 9:59 AM, "Han Zhou" <zhouhan at gmail.com> wrote:

> Sorry that I dropped the list.
>
> It looks the tunnel is good. I would recommend to look into L2 before
> mixing with qrouter:
> 1. tcpdump on each tap when ping between the 2 VMs on different nodes,
> find out where the packet (ARP or ICMP) is dropped.
> 2. ovs-dpctl dump-flow on the node that packet is dropped to see the drop
> flow,
> 3. use ovs-appctl ofproto/trace "<drop flow>" and compare with
> southbound DB pipeline to find out which step is missing.
>
> You can find out the port uuid by the MACs in your tap interface and
> then lookup the port binding table in SB.
>
> Hope this helps.
>
> Han
>
> On Fri, Oct 23, 2015 at 9:05 AM, Murali R <muralirdev at gmail.com> wrote:
> > On Fri, Oct 23, 2015 at 8:26 AM, Han Zhou <zhouhan at gmail.com> wrote:
> >>
> >> Could you provide the output of the 2 commands?
> >> ovs-appctl dpif/show
> >> ovsdb-client dump OVN_Southbound
> >
> >
> > system at ovs-system: hit:32 missed:11
> >         br-int:
> >                 br-int 65534/1: (internal)
> >                 ovn-af04a6-0 1/2: (geneve: key=flow,
> remote_ip=192.168.3.2)
> >                 qp-mdoc1 2/3: (system)
> >                 tapb958d3fc-47 4/4: (system)
> > root at sc-compute-2:/home/muralir/sdev/stack/devstack# ovs-appctl
> dpctl/show
> > system at ovs-system:
> >         lookups: hit:32 missed:11 lost:0
> >         flows: 0
> >         masks: hit:34 total:0 hit/pkt:0.79
> >         port 0: ovs-system (internal)
> >         port 1: br-int (internal)
> >         port 2: genev_sys_6081 (geneve)
> >         port 3: qp-mdoc1
> >         port 4: tapb958d3fc-47
> >
> > Attached the output of OVN_Southbound. That's bulky.
> >
> > To get a few things in order:
> > muralir at sc-nc:~/sdev/stack/devstack$ ovn-nbctl lswitch-list
> > b14b642d-cb5a-4769-8023-078b2204b20d
> > (neutron-5ba74f64-a006-47e3-a7c3-c3e8993616e9)
> > 74a4ab4b-71c9-4382-8f67-bb9a013aaf93
> > (neutron-90280d8b-5270-4b6c-ba3a-1421c34868b6)
> > 108693b9-6c7c-45c6-9c78-eb06a75e8f74
> > (neutron-d52d19c6-f4a2-4723-a6e2-215988a3f65f)
> >
> > This is a lot of data Han. If you can let me know how to look for ouerlay
> > routing is done from remote node, I can look through the data. There are
> 2
> > networks and one ext-net through neutron. The overlay goes though
> > 192.168.3.0/24 and tunnel ep are looking fine. However, the qrouters
> are in
> > ext-net accessible through 192.168.5.151. The 10.0.0.0/24 is supposed to
> > route through that q-router, however the network is not identified at
> remote
> > node. I cannot reach 192.168.5.151 directly from remote node
> (sc-compute-2)
> > - or should I be? That is the external part. As for Southbound entries, I
> > will also go through it and see if there is any clues, but I confess I
> don't
> > understand all tables too well. I only see the ports mappings and
> datapath
> > are associated fine.Thank you so much for looking into this.
> >
> > -Murali
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151023/92552b53/attachment.html>

From shettyg at nicira.com  Fri Oct 23 13:20:28 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 23 Oct 2015 13:20:28 -0700
Subject: [ovs-discuss] [ovn] multi node ovn debugging
In-Reply-To: <CAO=R8onp27V1uJqt75Vj1jv=z-uOsDo9apvjpYYwBKTJYn0Q9Q@mail.gmail.com>
References: <CADtzDC=nF_9c3Hxbw98K0S6zw+S+miY-1SyV4kgSv+PP9RoLVw@mail.gmail.com>
 <CAO=R8onp27V1uJqt75Vj1jv=z-uOsDo9apvjpYYwBKTJYn0Q9Q@mail.gmail.com>
Message-ID: <CAHbON5oBYQy7fGeKk_5aDuAieq_inCLSY8G+qStN+2Uvz_Achw@mail.gmail.com>

I did not read the entire thread, so here is an advice if not already
offered . If the tunnels are "geneve", make sure that 'lsmod | grep
geneve" has an entry.

On Fri, Oct 23, 2015 at 1:14 PM, Murali R <muralirdev at gmail.com> wrote:
> Thanks Han. I will check again, but last time no packets were going out of
> the switch port. I think something in network config is missing, not sure
> what. The tunnel itself is created alright but for ovn there is an extra
> element of vlan mapping for network isolation through the tinnel, but don't
> know how to debug that. The geneve vni equivalent for each lport is
> different from network vni. Not sure if that's how it is. With ovs agent,
> the datapath vni was used to tunnel across for each network.
>
> On Oct 23, 2015 9:59 AM, "Han Zhou" <zhouhan at gmail.com> wrote:
>>
>> Sorry that I dropped the list.
>>
>> It looks the tunnel is good. I would recommend to look into L2 before
>> mixing with qrouter:
>> 1. tcpdump on each tap when ping between the 2 VMs on different nodes,
>> find out where the packet (ARP or ICMP) is dropped.
>> 2. ovs-dpctl dump-flow on the node that packet is dropped to see the drop
>> flow,
>> 3. use ovs-appctl ofproto/trace "<drop flow>" and compare with
>> southbound DB pipeline to find out which step is missing.
>>
>> You can find out the port uuid by the MACs in your tap interface and
>> then lookup the port binding table in SB.
>>
>> Hope this helps.
>>
>> Han
>>
>> On Fri, Oct 23, 2015 at 9:05 AM, Murali R <muralirdev at gmail.com> wrote:
>> > On Fri, Oct 23, 2015 at 8:26 AM, Han Zhou <zhouhan at gmail.com> wrote:
>> >>
>> >> Could you provide the output of the 2 commands?
>> >> ovs-appctl dpif/show
>> >> ovsdb-client dump OVN_Southbound
>> >
>> >
>> > system at ovs-system: hit:32 missed:11
>> >         br-int:
>> >                 br-int 65534/1: (internal)
>> >                 ovn-af04a6-0 1/2: (geneve: key=flow,
>> > remote_ip=192.168.3.2)
>> >                 qp-mdoc1 2/3: (system)
>> >                 tapb958d3fc-47 4/4: (system)
>> > root at sc-compute-2:/home/muralir/sdev/stack/devstack# ovs-appctl
>> > dpctl/show
>> > system at ovs-system:
>> >         lookups: hit:32 missed:11 lost:0
>> >         flows: 0
>> >         masks: hit:34 total:0 hit/pkt:0.79
>> >         port 0: ovs-system (internal)
>> >         port 1: br-int (internal)
>> >         port 2: genev_sys_6081 (geneve)
>> >         port 3: qp-mdoc1
>> >         port 4: tapb958d3fc-47
>> >
>> > Attached the output of OVN_Southbound. That's bulky.
>> >
>> > To get a few things in order:
>> > muralir at sc-nc:~/sdev/stack/devstack$ ovn-nbctl lswitch-list
>> > b14b642d-cb5a-4769-8023-078b2204b20d
>> > (neutron-5ba74f64-a006-47e3-a7c3-c3e8993616e9)
>> > 74a4ab4b-71c9-4382-8f67-bb9a013aaf93
>> > (neutron-90280d8b-5270-4b6c-ba3a-1421c34868b6)
>> > 108693b9-6c7c-45c6-9c78-eb06a75e8f74
>> > (neutron-d52d19c6-f4a2-4723-a6e2-215988a3f65f)
>> >
>> > This is a lot of data Han. If you can let me know how to look for
>> > ouerlay
>> > routing is done from remote node, I can look through the data. There are
>> > 2
>> > networks and one ext-net through neutron. The overlay goes though
>> > 192.168.3.0/24 and tunnel ep are looking fine. However, the qrouters are
>> > in
>> > ext-net accessible through 192.168.5.151. The 10.0.0.0/24 is supposed to
>> > route through that q-router, however the network is not identified at
>> > remote
>> > node. I cannot reach 192.168.5.151 directly from remote node
>> > (sc-compute-2)
>> > - or should I be? That is the external part. As for Southbound entries,
>> > I
>> > will also go through it and see if there is any clues, but I confess I
>> > don't
>> > understand all tables too well. I only see the ports mappings and
>> > datapath
>> > are associated fine.Thank you so much for looking into this.
>> >
>> > -Murali
>> >
>> >
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From zhouhan at gmail.com  Fri Oct 23 14:20:20 2015
From: zhouhan at gmail.com (Han Zhou)
Date: Fri, 23 Oct 2015 14:20:20 -0700
Subject: [ovs-discuss] [ovn] multi node ovn debugging
In-Reply-To: <CAHbON5oBYQy7fGeKk_5aDuAieq_inCLSY8G+qStN+2Uvz_Achw@mail.gmail.com>
References: <CADtzDC=nF_9c3Hxbw98K0S6zw+S+miY-1SyV4kgSv+PP9RoLVw@mail.gmail.com>
 <CAO=R8onp27V1uJqt75Vj1jv=z-uOsDo9apvjpYYwBKTJYn0Q9Q@mail.gmail.com>
 <CAHbON5oBYQy7fGeKk_5aDuAieq_inCLSY8G+qStN+2Uvz_Achw@mail.gmail.com>
Message-ID: <CADtzDC=D5G_uFNDZaWtRx_rsO1a3QR0_gFB=4NtHp5dx53d0Cw@mail.gmail.com>

Hi

On Fri, Oct 23, 2015 at 1:20 PM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> I did not read the entire thread, so here is an advice if not already
> offered . If the tunnels are "geneve", make sure that 'lsmod | grep
> geneve" has an entry.
>

The datapath port is created, which indicates kernel module should be there:
>>> >                 ovn-af04a6-0 1/2: (geneve: key=flow,
>>> > remote_ip=192.168.3.2)


> On Fri, Oct 23, 2015 at 1:14 PM, Murali R <muralirdev at gmail.com> wrote:
>> Thanks Han. I will check again, but last time no packets were going out of
>> the switch port.

Which switch port do you refer to? Is it ARP got dropped? And is it
dropped on the src node or dst node?

> element of vlan mapping for network isolation

VLAN is not required by OVN. vlan tag is required in neutron ovs-agent
solution, but not OVN.

Han

From blp at nicira.com  Sat Oct 24 13:18:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 24 Oct 2015 13:18:51 -0700
Subject: [ovs-discuss] Problem about QueueGetConfig message
In-Reply-To: <5629A14A.9030207@gmail.com>
References: <5629A14A.9030207@gmail.com>
Message-ID: <20151024201851.GB19511@nicira.com>

On Fri, Oct 23, 2015 at 11:54:02AM +0900, Minoru TAKAHASHI wrote:
> Hi,
> 
> I send QueueGetConfig message(*OFPP_ANY* was set to port) to OVS(openflow1.3),
> then the following errors occured.
> 
>  Version: 1.3 (0x04)
>  Type: OFPET_QUEUE_OP_FAILED (9)
>  Code: OFPQOFC_BAD_PORT (0)
> 
> Is this a bug?

It works OK here, so you'll have to be more specific.  First add a
bridge and turn on OpenFlow 1.3:

    blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl add-br br0
    blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl set bridge br0 protocols=OpenFlow13

Then request all queue stats:

    blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -O OpenFlow13 queue-stats br0
    OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues

Or with more detailed logging to show that it's using OFPP_ANY:

    blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -vvconn -O OpenFlow13 queue-stats br0
    2015-10-24T20:17:52Z|00001|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPT_HELLO (OF1.3) (xid=0x1):
     version bitmap: 0x04
    2015-10-24T20:17:52Z|00002|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPT_HELLO (OF1.3) (xid=0x2):
     version bitmap: 0x04
    2015-10-24T20:17:52Z|00003|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: negotiated OpenFlow version 0x04 (we support version 0x04, peer supports version 0x04)
    2015-10-24T20:17:52Z|00004|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPST_QUEUE request (OF1.3) (xid=0x2):port=ANY queue=ALL
    2015-10-24T20:17:52Z|00005|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
    OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
    blp at sigabrt:~/nicira/ovs/tutorial(0)$ 

From muralirdev at gmail.com  Sun Oct 25 13:00:22 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 26 Oct 2015 04:00:22 +0800
Subject: [ovs-discuss] [ovn] multi node ovn debugging
In-Reply-To: <CADtzDC=D5G_uFNDZaWtRx_rsO1a3QR0_gFB=4NtHp5dx53d0Cw@mail.gmail.com>
References: <CADtzDC=nF_9c3Hxbw98K0S6zw+S+miY-1SyV4kgSv+PP9RoLVw@mail.gmail.com>
 <CAO=R8onp27V1uJqt75Vj1jv=z-uOsDo9apvjpYYwBKTJYn0Q9Q@mail.gmail.com>
 <CAHbON5oBYQy7fGeKk_5aDuAieq_inCLSY8G+qStN+2Uvz_Achw@mail.gmail.com>
 <CADtzDC=D5G_uFNDZaWtRx_rsO1a3QR0_gFB=4NtHp5dx53d0Cw@mail.gmail.com>
Message-ID: <CAO=R8om0BW4mo-bdepY3jd-jVJwbt37nvgCCsKv8WcUj6DM36g@mail.gmail.com>

Sorry for the delay, I was on flight writing my previous response and had
difficulty reaching my setup in rax from Shanghai,

Re-attached the sb-entries file that earlier got lost when mail group was
dropped. That dump was taken from primary controller node, so not sure how
the tunnels look defined when geneve was not there.

On Sat, Oct 24, 2015 at 5:20 AM, Han Zhou <zhouhan at gmail.com> wrote:

> Hi
>
> On Fri, Oct 23, 2015 at 1:20 PM, Gurucharan Shetty <shettyg at nicira.com>
> wrote:
> > I did not read the entire thread, so here is an advice if not already
> > offered . If the tunnels are "geneve", make sure that 'lsmod | grep
> > geneve" has an entry.
> >
>
> The datapath port is created, which indicates kernel module should be
> there:
> >>> >                 ovn-af04a6-0 1/2: (geneve: key=flow,
> >>> > remote_ip=192.168.3.2)
>

Guru is right. I checked and the master controller node now and it was not
having the module loaded. On the compute node (remote node), it is fine. I
am doing some post-mortem analysis why this happened and will summarize in
a follow up email. To describe briefly, the devstack wasn't deploying
properly with OVN and multiple networks (ext, internal mgmt and tunnel-ip)
so had to make many changes in devstack script to get it to deploy
properly. In course of doing that one time I was trying to configure like
provider network. Not sure if any of these steps prevented ovs from
deploying the geneve module. Interesting find. I am hoping I can rebuild
ovs on this node and it should deploy the module, let me try.

root at sc-nc:/home/muralir# ls /sys/module/openvswitch/holders/
root at sc-nc:/home/muralir#

>
>
> > On Fri, Oct 23, 2015 at 1:14 PM, Murali R <muralirdev at gmail.com> wrote:
> >> Thanks Han. I will check again, but last time no packets were going out
> of
> >> the switch port.
>
> Which switch port do you refer to? Is it ARP got dropped? And is it
> dropped on the src node or dst node?
>
>From the VM or docker ns, I cannot reach network. Like if I do "ip route
add default via 10.0.0.1" it comes back "no network". So if you ping at
most the packets will go to the switch and will get dropped.


>
> > element of vlan mapping for network isolation
>
> VLAN is not required by OVN. vlan tag is required in neutron ovs-agent
> solution, but not OVN.

Yes, you are right thank you. I re-read the arch doc, and examined the
flows. I was doing this experiment to understand how egress flows for ports
are defined because metadata info of datapath willl not be there. The vlan
as per arch doc only used for parent-tag (CIF) of containers and datapath
info is carried by metadata. So I can see how ingress flow is mapped.
However on the egress flow - are they mapped based solely based on source
and dest macs?  That's what I see in the flows.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151026/9500fa3c/attachment-0001.html>
-------------- next part --------------
Chassis table
_uuid                                encaps                                 name                                   vtep_logical_switches
------------------------------------ -------------------------------------- -------------------------------------- ---------------------
cc868565-1582-4eb7-9416-e52e786c6b45 [65b6e18a-9456-42a9-86e4-918cb402f7ba] "af04a6c4-e667-4cfb-9597-9ce0324ae3bf" []                   
374e6aaf-0d56-4912-999a-03232ccb5319 [c454b80d-cce8-45d3-8843-0fc1931c7d13] "dfb5c47e-f6cf-4132-8d90-98ba21610c29" []                   

Datapath_Binding table
_uuid                                external_ids                                            tunnel_key
------------------------------------ ------------------------------------------------------- ----------
e4abe0f4-72bd-4731-93ca-6b9778dce7f1 {logical-router="0db1f346-1a13-40c6-a023-91aa4f3d56da"} 5         
7a86930c-857c-4549-9bac-144e7d135806 {logical-router="1aadb7ed-91c0-4288-8977-fd1fca4f739b"} 2         
d1e43623-d67f-4f28-8540-5237b9601a0e {logical-switch="108693b9-6c7c-45c6-9c78-eb06a75e8f74"} 3         
43dab781-c909-456a-b649-9cd0d5ba9d2e {logical-switch="74a4ab4b-71c9-4382-8f67-bb9a013aaf93"} 1         
e7cbbd4c-9574-44ec-bb83-1a25b3ee926e {logical-switch="b14b642d-cb5a-4769-8023-078b2204b20d"} 4         

Encap table
_uuid                                ip            options type  
------------------------------------ ------------- ------- ------
65b6e18a-9456-42a9-86e4-918cb402f7ba "192.168.3.2" {}      geneve
c454b80d-cce8-45d3-8843-0fc1931c7d13 "192.168.3.6" {}      geneve

Logical_Flow table
_uuid                                actions                                                       external_ids                     logical_datapath                     match                                                                                                                                         pipeline priority table_id
------------------------------------ ------------------------------------------------------------- -------------------------------- ------------------------------------ --------------------------------------------------------------------------------------------------------------------------------------------- -------- -------- --------
54e287f3-104b-46af-a3d6-1db0cddc5bf5 "drop;"                                                       {stage-name=router_in_admission} 7a86930c-857c-4549-9bac-144e7d135806 "vlan.present || eth.src[40]"                                                                                                                 ingress  100      0       
d06b802a-4ce5-451f-ba6c-142e658c2ff9 "drop;"                                                       {stage-name=router_in_admission} e4abe0f4-72bd-4731-93ca-6b9778dce7f1 "vlan.present || eth.src[40]"                                                                                                                 ingress  100      0       
23d7058c-71b3-40b8-8782-8a7087ac6509 "drop;"                                                       {stage-name=router_in_ip_input}  7a86930c-857c-4549-9bac-144e7d135806 eth.bcast                                                                                                                                     ingress  50       1       
ae8b5421-05ea-4e2c-b0db-39884deef533 "drop;"                                                       {stage-name=router_in_ip_input}  e4abe0f4-72bd-4731-93ca-6b9778dce7f1 eth.bcast                                                                                                                                     ingress  50       1       
5e19c033-d776-4cf0-997d-a05f6495a0d7 "drop;"                                                       {stage-name=router_in_ip_input}  e4abe0f4-72bd-4731-93ca-6b9778dce7f1 "ip4 && ip.ttl == {0, 1}"                                                                                                                     ingress  30       1       
a2b18517-e06f-43c9-914f-a3759eedb9ba "drop;"                                                       {stage-name=router_in_ip_input}  7a86930c-857c-4549-9bac-144e7d135806 "ip4 && ip.ttl == {0, 1}"                                                                                                                     ingress  30       1       
c7d7290a-c8fa-4089-9706-f183010677f5 "drop;"                                                       {stage-name=router_in_ip_input}  e4abe0f4-72bd-4731-93ca-6b9778dce7f1 "ip4.mcast"                                                                                                                                   ingress  50       1       
d5995424-3833-44ec-b0cb-ba9e185e906c "drop;"                                                       {stage-name=router_in_ip_input}  7a86930c-857c-4549-9bac-144e7d135806 "ip4.mcast"                                                                                                                                   ingress  50       1       
954ada9c-cd26-4ecf-877e-f005933e0500 "drop;"                                                       {stage-name=router_in_ip_input}  7a86930c-857c-4549-9bac-144e7d135806 "ip4.mcast || ip4.src == 255.255.255.255 || ip4.src == 127.0.0.0/8 || ip4.dst == 127.0.0.0/8 || ip4.src == 0.0.0.0/8 || ip4.dst == 0.0.0.0/8" ingress  100      1       
e7c38bc8-13cf-4620-a5d6-39f9061b58e6 "drop;"                                                       {stage-name=router_in_ip_input}  e4abe0f4-72bd-4731-93ca-6b9778dce7f1 "ip4.mcast || ip4.src == 255.255.255.255 || ip4.src == 127.0.0.0/8 || ip4.dst == 127.0.0.0/8 || ip4.src == 0.0.0.0/8 || ip4.dst == 0.0.0.0/8" ingress  100      1       
4d3f3e4f-ef7a-483e-8799-616010b15c96 "drop;"                                                       {stage-name=switch_in_port_sec}  43dab781-c909-456a-b649-9cd0d5ba9d2e "eth.src[40]"                                                                                                                                 ingress  100      0       
6a2ad79f-b910-4383-abc8-73ebe2d7157c "drop;"                                                       {stage-name=switch_in_port_sec}  d1e43623-d67f-4f28-8540-5237b9601a0e "eth.src[40]"                                                                                                                                 ingress  100      0       
ba63b512-1b54-451c-b21a-f6fad16a0e45 "drop;"                                                       {stage-name=switch_in_port_sec}  e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "eth.src[40]"                                                                                                                                 ingress  100      0       
450c343d-b55c-42f8-9059-7e7e779f150c "drop;"                                                       {stage-name=switch_in_port_sec}  43dab781-c909-456a-b649-9cd0d5ba9d2e vlan.present                                                                                                                                  ingress  100      0       
650ea771-8337-4b3d-99a1-fd3a4fe489fa "drop;"                                                       {stage-name=switch_in_port_sec}  d1e43623-d67f-4f28-8540-5237b9601a0e vlan.present                                                                                                                                  ingress  100      0       
fe093ff3-da2e-4b7c-a404-080c9857a0b2 "drop;"                                                       {stage-name=switch_in_port_sec}  e7cbbd4c-9574-44ec-bb83-1a25b3ee926e vlan.present                                                                                                                                  ingress  100      0       
22bdb0de-a3cd-43f8-a167-7de6f2348ac5 "next;"                                                       {stage-name=router_in_ip_input}  e4abe0f4-72bd-4731-93ca-6b9778dce7f1 "1"                                                                                                                                           ingress  0        1       
607f19e1-d027-42fc-8c6d-6a01bde2dd18 "next;"                                                       {stage-name=router_in_ip_input}  7a86930c-857c-4549-9bac-144e7d135806 "1"                                                                                                                                           ingress  0        1       
3646b4a8-8847-4ae5-b526-af786965e3af "next;"                                                       {stage-name=switch_in_acl}       43dab781-c909-456a-b649-9cd0d5ba9d2e "1"                                                                                                                                           ingress  0        2       
602dc2ae-3bcd-42b3-9391-c6fd3e0c71d5 "next;"                                                       {stage-name=switch_in_acl}       d1e43623-d67f-4f28-8540-5237b9601a0e "1"                                                                                                                                           ingress  0        2       
67d34ae0-c58b-4c1c-95f9-42c94b3d974c "next;"                                                       {stage-name=switch_in_acl}       e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "1"                                                                                                                                           ingress  0        2       
e5c80a49-9106-4f12-8064-f3a0820a1702 "next;"                                                       {stage-name=switch_in_port_sec}  d1e43623-d67f-4f28-8540-5237b9601a0e "inport == \"3dc81bfd-fd17-4bcb-bb07-12c01374c4cf\" && eth.src == {fa:16:3e:7f:67:d2}"                                                        ingress  50       0       
40c4654a-dcf0-4c84-9d59-b38905464655 "next;"                                                       {stage-name=switch_in_port_sec}  43dab781-c909-456a-b649-9cd0d5ba9d2e "inport == \"4958a3ef-6037-4e70-b471-ba81a00c0069\" && eth.src == {fa:16:3e:ed:88:00}"                                                        ingress  50       0       
85e3848a-6825-421b-90d9-e4c489937427 "next;"                                                       {stage-name=switch_in_port_sec}  43dab781-c909-456a-b649-9cd0d5ba9d2e "inport == \"4a1f4161-5178-4726-9ee8-0a10f1fad7f0\" && eth.src == {fa:16:3e:8d:9c:06}"                                                        ingress  50       0       
392cf7cd-79ca-4c8c-b470-b6e940b8ea7a "next;"                                                       {stage-name=switch_in_port_sec}  43dab781-c909-456a-b649-9cd0d5ba9d2e "inport == \"5286a640-9ccc-479e-b5d9-24a941f30d3e\" && eth.src == {fa:16:3e:7a:0f:60}"                                                        ingress  50       0       
200a5c0c-df4c-431c-ad0b-b02077d34377 "next;"                                                       {stage-name=switch_in_port_sec}  43dab781-c909-456a-b649-9cd0d5ba9d2e "inport == \"53150f89-c590-4cbb-b005-04f86382dc42\" && eth.src == {fa:16:3e:24:29:6b}"                                                        ingress  50       0       
63b4be14-edd1-44b8-809a-8b05a160fa71 "next;"                                                       {stage-name=switch_in_port_sec}  e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "inport == \"58229c21-d752-4f1e-af8a-a6559108320c\" && eth.src == {fa:16:3e:c1:6c:29}"                                                        ingress  50       0       
fbe52854-db71-4179-882c-5c69521b8467 "next;"                                                       {stage-name=switch_in_port_sec}  e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "inport == \"7b1bc60f-1874-4817-a684-e0fa6eda3702\" && eth.src == {fa:16:3e:1d:04:07}"                                                        ingress  50       0       
a216ced9-1e84-43d4-b910-8835569a21b4 "next;"                                                       {stage-name=switch_in_port_sec}  43dab781-c909-456a-b649-9cd0d5ba9d2e "inport == \"820bb989-b357-4d83-bbe2-954bd46f1329\" && eth.src == {fa:16:3e:59:3a:cb}"                                                        ingress  50       0       
0ecea1d2-7d5d-4fe8-a9fc-2db9a0514874 "next;"                                                       {stage-name=switch_in_port_sec}  d1e43623-d67f-4f28-8540-5237b9601a0e "inport == \"a6b153e5-88e6-4e9d-a07c-fe9fbaae24eb\" && eth.src == {fa:16:3e:17:5d:d1}"                                                        ingress  50       0       
4505d38d-d808-41b9-8b6c-812eef949dca "next;"                                                       {stage-name=switch_in_port_sec}  e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "inport == \"b958d3fc-47c6-4175-adee-ab718f4fa77e\" && eth.src == {fa:16:3e:fd:87:2d}"                                                        ingress  50       0       
4d255565-5f21-4d54-8bd7-96727b996795 "next;"                                                       {stage-name=switch_in_port_sec}  e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "inport == \"ccaca4e0-3e0c-4783-9322-5315071011ec\" && eth.src == {fa:16:3e:b2:47:d7}"                                                        ingress  50       0       
ab4ace7a-6778-49f3-b04b-9a1f11ff23e6 "next;"                                                       {stage-name=switch_in_port_sec}  d1e43623-d67f-4f28-8540-5237b9601a0e "inport == \"e14ef952-4d9a-4e24-8f4d-0bb81990216b\" && eth.src == {fa:16:3e:26:e8:2c}"                                                        ingress  50       0       
f00b98c2-6c17-4360-a7e4-20b0fbd6b761 "next;"                                                       {stage-name=switch_in_port_sec}  d1e43623-d67f-4f28-8540-5237b9601a0e "inport == \"e57e0c11-6a4f-46ea-82dd-736588e27667\" && eth.src == {fa:16:3e:f4:a6:72}"                                                        ingress  50       0       
36ea9f30-96d9-4256-b9b3-131238d53c3a "next;"                                                       {stage-name=switch_in_port_sec}  43dab781-c909-456a-b649-9cd0d5ba9d2e "inport == \"fb671123-6c8c-476d-8b85-f4677baca93d\" && eth.src == {fa:16:3e:35:04:40}"                                                        ingress  50       0       
0f3cd43c-5448-43fe-a3d5-75a15925cfc5 "next;"                                                       {stage-name=switch_in_pre_acl}   43dab781-c909-456a-b649-9cd0d5ba9d2e "1"                                                                                                                                           ingress  0        1       
2f4bcf02-3aa3-4aeb-82d4-8caf67734dd6 "next;"                                                       {stage-name=switch_in_pre_acl}   e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "1"                                                                                                                                           ingress  0        1       
dfb85edb-8706-437b-b33e-6d97dc308e77 "next;"                                                       {stage-name=switch_in_pre_acl}   d1e43623-d67f-4f28-8540-5237b9601a0e "1"                                                                                                                                           ingress  0        1       
209d1ed4-2fe5-45ca-bfc0-09c20620f376 "next;"                                                       {stage-name=switch_out_acl}      d1e43623-d67f-4f28-8540-5237b9601a0e "1"                                                                                                                                           egress   0        1       
2b18ad91-cc00-4796-b669-18bbff5eee96 "next;"                                                       {stage-name=switch_out_acl}      e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "1"                                                                                                                                           egress   0        1       
b45bd863-cd95-49c8-b973-5efcb11e0abb "next;"                                                       {stage-name=switch_out_acl}      43dab781-c909-456a-b649-9cd0d5ba9d2e "1"                                                                                                                                           egress   0        1       
06948f28-80dd-4fa9-bb6a-e68c7d4bf966 "next;"                                                       {stage-name=switch_out_pre_acl}  d1e43623-d67f-4f28-8540-5237b9601a0e "1"                                                                                                                                           egress   0        0       
a670fbc9-c781-418d-a176-bc30e65c6126 "next;"                                                       {stage-name=switch_out_pre_acl}  43dab781-c909-456a-b649-9cd0d5ba9d2e "1"                                                                                                                                           egress   0        0       
fe134499-7845-4b43-915c-71daec235687 "next;"                                                       {stage-name=switch_out_pre_acl}  e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "1"                                                                                                                                           egress   0        0       
6eb93961-bde2-4d60-a252-46a2305d1f94 "outport = \"3dc81bfd-fd17-4bcb-bb07-12c01374c4cf\"; output;" {stage-name="switch_in_l2_lkup"} d1e43623-d67f-4f28-8540-5237b9601a0e "eth.dst == fa:16:3e:7f:67:d2"                                                                                                                ingress  50       3       
03390321-9864-44fa-9627-b9411ad7acda "outport = \"4958a3ef-6037-4e70-b471-ba81a00c0069\"; output;" {stage-name="switch_in_l2_lkup"} 43dab781-c909-456a-b649-9cd0d5ba9d2e "eth.dst == fa:16:3e:ed:88:00"                                                                                                                ingress  50       3       
01bf030a-4155-4e45-859c-b2f17c8f46b9 "outport = \"4a1f4161-5178-4726-9ee8-0a10f1fad7f0\"; output;" {stage-name="switch_in_l2_lkup"} 43dab781-c909-456a-b649-9cd0d5ba9d2e "eth.dst == fa:16:3e:8d:9c:06"                                                                                                                ingress  50       3       
b0a72ea9-6c71-4a96-bb04-201b889a0a7b "outport = \"5286a640-9ccc-479e-b5d9-24a941f30d3e\"; output;" {stage-name="switch_in_l2_lkup"} 43dab781-c909-456a-b649-9cd0d5ba9d2e "eth.dst == fa:16:3e:7a:0f:60"                                                                                                                ingress  50       3       
79d9b879-5286-4d22-82f9-7e827a0c6034 "outport = \"53150f89-c590-4cbb-b005-04f86382dc42\"; output;" {stage-name="switch_in_l2_lkup"} 43dab781-c909-456a-b649-9cd0d5ba9d2e "eth.dst == fa:16:3e:24:29:6b"                                                                                                                ingress  50       3       
5b36f01d-edf4-4fcf-a119-070df926542d "outport = \"58229c21-d752-4f1e-af8a-a6559108320c\"; output;" {stage-name="switch_in_l2_lkup"} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "eth.dst == fa:16:3e:c1:6c:29"                                                                                                                ingress  50       3       
6c070217-f870-426e-8290-599eb6f3a371 "outport = \"7b1bc60f-1874-4817-a684-e0fa6eda3702\"; output;" {stage-name="switch_in_l2_lkup"} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "eth.dst == fa:16:3e:1d:04:07"                                                                                                                ingress  50       3       
fe1c2c80-296c-43fe-b340-37f7f1f0618c "outport = \"820bb989-b357-4d83-bbe2-954bd46f1329\"; output;" {stage-name="switch_in_l2_lkup"} 43dab781-c909-456a-b649-9cd0d5ba9d2e "eth.dst == fa:16:3e:59:3a:cb"                                                                                                                ingress  50       3       
1d7b96c7-9eee-42c2-b202-eff6a4d13aee "outport = \"_MC_flood\"; output;"                            {stage-name="switch_in_l2_lkup"} d1e43623-d67f-4f28-8540-5237b9601a0e eth.mcast                                                                                                                                     ingress  100      3       
bad7e8cd-fe5d-43d9-bc56-246304ed53af "outport = \"_MC_flood\"; output;"                            {stage-name="switch_in_l2_lkup"} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e eth.mcast                                                                                                                                     ingress  100      3       
ccbda80c-2e35-49bc-ac3a-49bf7aee39eb "outport = \"_MC_flood\"; output;"                            {stage-name="switch_in_l2_lkup"} 43dab781-c909-456a-b649-9cd0d5ba9d2e eth.mcast                                                                                                                                     ingress  100      3       
5ce89f2d-f1c1-4130-92d3-64e48132421e "outport = \"a6b153e5-88e6-4e9d-a07c-fe9fbaae24eb\"; output;" {stage-name="switch_in_l2_lkup"} d1e43623-d67f-4f28-8540-5237b9601a0e "eth.dst == fa:16:3e:17:5d:d1"                                                                                                                ingress  50       3       
ab79702a-e05b-4992-853f-ba4022e69922 "outport = \"b958d3fc-47c6-4175-adee-ab718f4fa77e\"; output;" {stage-name="switch_in_l2_lkup"} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "eth.dst == fa:16:3e:fd:87:2d"                                                                                                                ingress  50       3       
7ec161af-b620-47a5-acb0-6ac0ba3b8cbb "outport = \"ccaca4e0-3e0c-4783-9322-5315071011ec\"; output;" {stage-name="switch_in_l2_lkup"} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "eth.dst == fa:16:3e:b2:47:d7"                                                                                                                ingress  50       3       
835583b6-1eed-4f62-891a-bce289515a3f "outport = \"e14ef952-4d9a-4e24-8f4d-0bb81990216b\"; output;" {stage-name="switch_in_l2_lkup"} d1e43623-d67f-4f28-8540-5237b9601a0e "eth.dst == fa:16:3e:26:e8:2c"                                                                                                                ingress  50       3       
cdad229c-221e-4154-98d1-156a129b8c3d "outport = \"e57e0c11-6a4f-46ea-82dd-736588e27667\"; output;" {stage-name="switch_in_l2_lkup"} d1e43623-d67f-4f28-8540-5237b9601a0e "eth.dst == fa:16:3e:f4:a6:72"                                                                                                                ingress  50       3       
e347702b-e7ea-4f5e-a457-66b5df16a5a2 "outport = \"fb671123-6c8c-476d-8b85-f4677baca93d\"; output;" {stage-name="switch_in_l2_lkup"} 43dab781-c909-456a-b649-9cd0d5ba9d2e "eth.dst == fa:16:3e:35:04:40"                                                                                                                ingress  50       3       
7b974a2a-dc33-46d8-9349-84cdc2635736 "output;"                                                     {stage-name=switch_out_port_sec} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e eth.mcast                                                                                                                                     egress   100      2       
8022bfec-1865-4fc5-ba03-167fabff16dc "output;"                                                     {stage-name=switch_out_port_sec} d1e43623-d67f-4f28-8540-5237b9601a0e eth.mcast                                                                                                                                     egress   100      2       
c7c90761-5511-4d84-97c8-515ab459b0f7 "output;"                                                     {stage-name=switch_out_port_sec} 43dab781-c909-456a-b649-9cd0d5ba9d2e eth.mcast                                                                                                                                     egress   100      2       
9d377969-e9d9-417c-aaed-d0f7060f160d "output;"                                                     {stage-name=switch_out_port_sec} d1e43623-d67f-4f28-8540-5237b9601a0e "outport == \"3dc81bfd-fd17-4bcb-bb07-12c01374c4cf\" && eth.dst == {fa:16:3e:7f:67:d2}"                                                       egress   50       2       
5bbc1893-3117-4405-bcdf-b1ffef7414d4 "output;"                                                     {stage-name=switch_out_port_sec} 43dab781-c909-456a-b649-9cd0d5ba9d2e "outport == \"4958a3ef-6037-4e70-b471-ba81a00c0069\" && eth.dst == {fa:16:3e:ed:88:00}"                                                       egress   50       2       
a9cfe765-de70-4a0d-bbb5-86c0bf3048d1 "output;"                                                     {stage-name=switch_out_port_sec} 43dab781-c909-456a-b649-9cd0d5ba9d2e "outport == \"4a1f4161-5178-4726-9ee8-0a10f1fad7f0\" && eth.dst == {fa:16:3e:8d:9c:06}"                                                       egress   50       2       
3ccd4b62-e21d-4048-9b41-a50426384da5 "output;"                                                     {stage-name=switch_out_port_sec} 43dab781-c909-456a-b649-9cd0d5ba9d2e "outport == \"5286a640-9ccc-479e-b5d9-24a941f30d3e\" && eth.dst == {fa:16:3e:7a:0f:60}"                                                       egress   50       2       
bb3bd0ca-442d-41fd-a58e-143c900450d4 "output;"                                                     {stage-name=switch_out_port_sec} 43dab781-c909-456a-b649-9cd0d5ba9d2e "outport == \"53150f89-c590-4cbb-b005-04f86382dc42\" && eth.dst == {fa:16:3e:24:29:6b}"                                                       egress   50       2       
a39c3043-3239-4ea4-8596-8c11337b14b3 "output;"                                                     {stage-name=switch_out_port_sec} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "outport == \"58229c21-d752-4f1e-af8a-a6559108320c\" && eth.dst == {fa:16:3e:c1:6c:29}"                                                       egress   50       2       
8d6331fe-4d54-441f-809b-d4bc7e97fb88 "output;"                                                     {stage-name=switch_out_port_sec} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "outport == \"7b1bc60f-1874-4817-a684-e0fa6eda3702\" && eth.dst == {fa:16:3e:1d:04:07}"                                                       egress   50       2       
92344de5-e98c-4928-a67b-addb6cad5cf9 "output;"                                                     {stage-name=switch_out_port_sec} 43dab781-c909-456a-b649-9cd0d5ba9d2e "outport == \"820bb989-b357-4d83-bbe2-954bd46f1329\" && eth.dst == {fa:16:3e:59:3a:cb}"                                                       egress   50       2       
23aab6b5-1a7f-4c86-9cd0-f2e94e160df7 "output;"                                                     {stage-name=switch_out_port_sec} d1e43623-d67f-4f28-8540-5237b9601a0e "outport == \"a6b153e5-88e6-4e9d-a07c-fe9fbaae24eb\" && eth.dst == {fa:16:3e:17:5d:d1}"                                                       egress   50       2       
d9714bf4-4b6e-422b-90ad-f0b371b36179 "output;"                                                     {stage-name=switch_out_port_sec} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "outport == \"b958d3fc-47c6-4175-adee-ab718f4fa77e\" && eth.dst == {fa:16:3e:fd:87:2d}"                                                       egress   50       2       
8014e885-0f35-452a-9ff8-55f192502d29 "output;"                                                     {stage-name=switch_out_port_sec} e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "outport == \"ccaca4e0-3e0c-4783-9322-5315071011ec\" && eth.dst == {fa:16:3e:b2:47:d7}"                                                       egress   50       2       
72834dbb-0c1c-4f51-9456-f11273f6db86 "output;"                                                     {stage-name=switch_out_port_sec} d1e43623-d67f-4f28-8540-5237b9601a0e "outport == \"e14ef952-4d9a-4e24-8f4d-0bb81990216b\" && eth.dst == {fa:16:3e:26:e8:2c}"                                                       egress   50       2       
00b2e52f-947c-48f6-a617-b8ae9d09734c "output;"                                                     {stage-name=switch_out_port_sec} d1e43623-d67f-4f28-8540-5237b9601a0e "outport == \"e57e0c11-6a4f-46ea-82dd-736588e27667\" && eth.dst == {fa:16:3e:f4:a6:72}"                                                       egress   50       2       
74a1050b-57ab-4941-be9f-64c77e185394 "output;"                                                     {stage-name=switch_out_port_sec} 43dab781-c909-456a-b649-9cd0d5ba9d2e "outport == \"fb671123-6c8c-476d-8b85-f4677baca93d\" && eth.dst == {fa:16:3e:35:04:40}"                                                       egress   50       2       

Multicast_Group table
_uuid                                datapath                             name      ports                                                                                                                                                                                                                                tunnel_key
------------------------------------ ------------------------------------ --------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ----------
0ec44ee0-07ba-4372-8d14-2022baf48adb 43dab781-c909-456a-b649-9cd0d5ba9d2e _MC_flood [1fddb459-9817-4cbf-8b1d-384b324e26a6, 249c05fc-212f-4766-8a60-cbd5adfa1ec5, 53283de6-0355-4ae9-8de8-e14fc0af81ae, 62d82618-4baf-4afc-8e38-c55b0712ed6e, 757a177f-5686-4d74-b7e6-350200d5c32c, fa783ad4-30cd-4fb7-9205-a7dfd0d2b496] 65535     
1cdad05e-463f-4f85-8cdb-6aa2968ef29b e7cbbd4c-9574-44ec-bb83-1a25b3ee926e _MC_flood [8dbcc2d4-12d4-40d6-a8c3-824cba59a041, b223d747-52c6-4b5e-90ac-2d661150f578, bed7a30a-37cc-4e41-8e2e-fda22fb31253, f6b85970-649f-426a-8e50-a858ad6e8cf6]                                                                             65535     
93aa69ae-45db-41b6-9d58-4face69c19ae d1e43623-d67f-4f28-8540-5237b9601a0e _MC_flood [65a11d0b-9e40-42cb-a808-0142c85d29d2, be021575-63af-472c-9673-8f74cce693aa, fdb6d3bb-2b2c-4d06-b117-e51da2d6c5a8, ffb07c0f-fd5a-4a11-8f14-7359b277c310]                                                                             65535     

Port_Binding table
_uuid                                chassis                              datapath                             logical_port                           mac                   options parent_port tag tunnel_key type
------------------------------------ ------------------------------------ ------------------------------------ -------------------------------------- --------------------- ------- ----------- --- ---------- ----
ffb07c0f-fd5a-4a11-8f14-7359b277c310 []                                   d1e43623-d67f-4f28-8540-5237b9601a0e "3dc81bfd-fd17-4bcb-bb07-12c01374c4cf" ["fa:16:3e:7f:67:d2"] {}      []          []  3          ""  
1fddb459-9817-4cbf-8b1d-384b324e26a6 374e6aaf-0d56-4912-999a-03232ccb5319 43dab781-c909-456a-b649-9cd0d5ba9d2e "4958a3ef-6037-4e70-b471-ba81a00c0069" ["fa:16:3e:ed:88:00"] {}      []          []  6          ""  
757a177f-5686-4d74-b7e6-350200d5c32c cc868565-1582-4eb7-9416-e52e786c6b45 43dab781-c909-456a-b649-9cd0d5ba9d2e "4a1f4161-5178-4726-9ee8-0a10f1fad7f0" ["fa:16:3e:8d:9c:06"] {}      []          []  3          ""  
53283de6-0355-4ae9-8de8-e14fc0af81ae cc868565-1582-4eb7-9416-e52e786c6b45 43dab781-c909-456a-b649-9cd0d5ba9d2e "5286a640-9ccc-479e-b5d9-24a941f30d3e" ["fa:16:3e:7a:0f:60"] {}      []          []  5          ""  
fa783ad4-30cd-4fb7-9205-a7dfd0d2b496 cc868565-1582-4eb7-9416-e52e786c6b45 43dab781-c909-456a-b649-9cd0d5ba9d2e "53150f89-c590-4cbb-b005-04f86382dc42" ["fa:16:3e:24:29:6b"] {}      []          []  2          ""  
8dbcc2d4-12d4-40d6-a8c3-824cba59a041 cc868565-1582-4eb7-9416-e52e786c6b45 e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "58229c21-d752-4f1e-af8a-a6559108320c" ["fa:16:3e:c1:6c:29"] {}      []          []  1          ""  
f6b85970-649f-426a-8e50-a858ad6e8cf6 cc868565-1582-4eb7-9416-e52e786c6b45 e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "7b1bc60f-1874-4817-a684-e0fa6eda3702" ["fa:16:3e:1d:04:07"] {}      []          []  2          ""  
62d82618-4baf-4afc-8e38-c55b0712ed6e cc868565-1582-4eb7-9416-e52e786c6b45 43dab781-c909-456a-b649-9cd0d5ba9d2e "820bb989-b357-4d83-bbe2-954bd46f1329" ["fa:16:3e:59:3a:cb"] {}      []          []  1          ""  
fdb6d3bb-2b2c-4d06-b117-e51da2d6c5a8 []                                   d1e43623-d67f-4f28-8540-5237b9601a0e "a6b153e5-88e6-4e9d-a07c-fe9fbaae24eb" ["fa:16:3e:17:5d:d1"] {}      []          []  1          ""  
b223d747-52c6-4b5e-90ac-2d661150f578 374e6aaf-0d56-4912-999a-03232ccb5319 e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "b958d3fc-47c6-4175-adee-ab718f4fa77e" ["fa:16:3e:fd:87:2d"] {}      []          []  4          ""  
bed7a30a-37cc-4e41-8e2e-fda22fb31253 cc868565-1582-4eb7-9416-e52e786c6b45 e7cbbd4c-9574-44ec-bb83-1a25b3ee926e "ccaca4e0-3e0c-4783-9322-5315071011ec" ["fa:16:3e:b2:47:d7"] {}      []          []  3          ""  
65a11d0b-9e40-42cb-a808-0142c85d29d2 []                                   d1e43623-d67f-4f28-8540-5237b9601a0e "e14ef952-4d9a-4e24-8f4d-0bb81990216b" ["fa:16:3e:26:e8:2c"] {}      []          []  4          ""  
be021575-63af-472c-9673-8f74cce693aa []                                   d1e43623-d67f-4f28-8540-5237b9601a0e "e57e0c11-6a4f-46ea-82dd-736588e27667" ["fa:16:3e:f4:a6:72"] {}      []          []  2          ""  
249c05fc-212f-4766-8a60-cbd5adfa1ec5 cc868565-1582-4eb7-9416-e52e786c6b45 43dab781-c909-456a-b649-9cd0d5ba9d2e "fb671123-6c8c-476d-8b85-f4677baca93d" ["fa:16:3e:35:04:40"] {}      []          []  4          ""  

From a.alnajjar1 at uq.edu.au  Sun Oct 25 17:12:23 2015
From: a.alnajjar1 at uq.edu.au (Anees Mohsin Hadi Al-Najjar)
Date: Mon, 26 Oct 2015 00:12:23 +0000
Subject: [ovs-discuss] writing a flow rule in OF15
Message-ID: <f2830c7649f6492a8df7a3b6008a8df8@uq-exmbx8.soe.uq.edu.au>

Dear all,

I am trying to write rules in latest OVS version, 2.4, and using OpenFlow 1.5. I am facing a problem with that.

Could you possibly tell me how to fix it?

Thanks.

My rule is:

ovs-ofctl -O OpenFlow15 add-flow br0 priority=4000, idle_time_out=0, hard_timeout=0, eth_type=0x0806, arp_op=1, eth_src="00:00:00:00:01:02", actions= set_field:2->arp_op, set_field:"00:00:00:00:01:02"->arp_tha

ovs-ofctl: 'add-flow' command takes at most 2 arguments



Anees

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151026/7328bc87/attachment.html>

From ben at skyportsystems.com  Sun Oct 25 17:17:41 2015
From: ben at skyportsystems.com (Ben Warren)
Date: Sun, 25 Oct 2015 17:17:41 -0700
Subject: [ovs-discuss] writing a flow rule in OF15
In-Reply-To: <f2830c7649f6492a8df7a3b6008a8df8@uq-exmbx8.soe.uq.edu.au>
References: <f2830c7649f6492a8df7a3b6008a8df8@uq-exmbx8.soe.uq.edu.au>
Message-ID: <97701452-9D2F-46BB-B365-91D5A5FD8CCE@skyportsystems.com>

Hi Anees,

Everything from “priority” on has to be a single argument according to your shell: quote it properly and don’t use any spaces.

—Ben

> On Oct 25, 2015, at 5:12 PM, Anees Mohsin Hadi Al-Najjar <a.alnajjar1 at uq.edu.au> wrote:
> 
> Dear all,
>  
> I am trying to write rules in latest OVS version, 2.4, and using OpenFlow 1.5. I am facing a problem with that.
>  
> Could you possibly tell me how to fix it?
>  
> Thanks.
>  
> My rule is:
>  
> ovs-ofctl -O OpenFlow15 add-flow br0 priority=4000, idle_time_out=0, hard_timeout=0, eth_type=0x0806, arp_op=1, eth_src="00:00:00:00:01:02", actions= set_field:2->arp_op, set_field:"00:00:00:00:01:02”->arp_tha
>  
> ovs-ofctl: 'add-flow' command takes at most 2 arguments
>  
>  
>  
> Anees
>  
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org <mailto:discuss at openvswitch.org>
> http://openvswitch.org/mailman/listinfo/discuss <http://openvswitch.org/mailman/listinfo/discuss>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151025/e7ee88e5/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3583 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151025/e7ee88e5/attachment.bin>

From a.alnajjar1 at uq.edu.au  Sun Oct 25 17:46:35 2015
From: a.alnajjar1 at uq.edu.au (Anees Mohsin Hadi Al-Najjar)
Date: Mon, 26 Oct 2015 00:46:35 +0000
Subject: [ovs-discuss] writing a flow rule in OF15
In-Reply-To: <97701452-9D2F-46BB-B365-91D5A5FD8CCE@skyportsystems.com>
References: <f2830c7649f6492a8df7a3b6008a8df8@uq-exmbx8.soe.uq.edu.au>
 <97701452-9D2F-46BB-B365-91D5A5FD8CCE@skyportsystems.com>
Message-ID: <663886717c1146fb988b87ed3c1dee2b@uq-exmbx8.soe.uq.edu.au>

Hi Ben,

I found code to quote the rule like this:
ovs-ofctl -O OpenFlow15 add-flow br0 'priority=4000, idle_timeout=0, hard_timeout=0, eth_type=0x0806, arp_op=1, eth_src="00:00:00:00:01:02", actions= set_field:2->arp_op, set_field:"00:00:00:00:01:02"->arp_tha'

I have applied it, but another type of error, which is:
    ovs-ofctl: "00:00:00:00:01:02": invalid Ethernet address

I appreciate if you or somebody else help me to fix it.

Thanks
Anees
From: Ben Warren [mailto:ben at skyportsystems.com]
Sent: Monday, 26 October 2015 10:18 AM
To: Anees Mohsin Hadi Al-Najjar <a.alnajjar1 at uq.edu.au>
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] writing a flow rule in OF15

Hi Anees,

Everything from “priority” on has to be a single argument according to your shell: quote it properly and don’t use any spaces.

—Ben

On Oct 25, 2015, at 5:12 PM, Anees Mohsin Hadi Al-Najjar <a.alnajjar1 at uq.edu.au<mailto:a.alnajjar1 at uq.edu.au>> wrote:

Dear all,

I am trying to write rules in latest OVS version, 2.4, and using OpenFlow 1.5. I am facing a problem with that.

Could you possibly tell me how to fix it?

Thanks.

My rule is:

ovs-ofctl -O OpenFlow15 add-flow br0 priority=4000, idle_time_out=0, hard_timeout=0, eth_type=0x0806, arp_op=1, eth_src="00:00:00:00:01:02", actions= set_field:2->arp_op, set_field:"00:00:00:00:01:02”->arp_tha

ovs-ofctl: 'add-flow' command takes at most 2 arguments



Anees

_______________________________________________
discuss mailing list
discuss at openvswitch.org<mailto:discuss at openvswitch.org>
http://openvswitch.org/mailman/listinfo/discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151026/1f22070c/attachment-0001.html>

From blp at nicira.com  Sun Oct 25 17:55:57 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 25 Oct 2015 17:55:57 -0700
Subject: [ovs-discuss] writing a flow rule in OF15
In-Reply-To: <663886717c1146fb988b87ed3c1dee2b@uq-exmbx8.soe.uq.edu.au>
References: <f2830c7649f6492a8df7a3b6008a8df8@uq-exmbx8.soe.uq.edu.au>
 <97701452-9D2F-46BB-B365-91D5A5FD8CCE@skyportsystems.com>
 <663886717c1146fb988b87ed3c1dee2b@uq-exmbx8.soe.uq.edu.au>
Message-ID: <20151026005557.GA31441@nicira.com>

Delete the double quotes, keep the single quotes.

On Mon, Oct 26, 2015 at 12:46:35AM +0000, Anees Mohsin Hadi Al-Najjar wrote:
> Hi Ben,
> 
> I found code to quote the rule like this:
> ovs-ofctl -O OpenFlow15 add-flow br0 'priority=4000, idle_timeout=0, hard_timeout=0, eth_type=0x0806, arp_op=1, eth_src="00:00:00:00:01:02", actions= set_field:2->arp_op, set_field:"00:00:00:00:01:02"->arp_tha'
> 
> I have applied it, but another type of error, which is:
>     ovs-ofctl: "00:00:00:00:01:02": invalid Ethernet address
> 
> I appreciate if you or somebody else help me to fix it.
> 
> Thanks
> Anees
> From: Ben Warren [mailto:ben at skyportsystems.com]
> Sent: Monday, 26 October 2015 10:18 AM
> To: Anees Mohsin Hadi Al-Najjar <a.alnajjar1 at uq.edu.au>
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] writing a flow rule in OF15
> 
> Hi Anees,
> 
> Everything from “priority” on has to be a single argument according to your shell: quote it properly and don’t use any spaces.
> 
> —Ben
> 
> On Oct 25, 2015, at 5:12 PM, Anees Mohsin Hadi Al-Najjar <a.alnajjar1 at uq.edu.au<mailto:a.alnajjar1 at uq.edu.au>> wrote:
> 
> Dear all,
> 
> I am trying to write rules in latest OVS version, 2.4, and using OpenFlow 1.5. I am facing a problem with that.
> 
> Could you possibly tell me how to fix it?
> 
> Thanks.
> 
> My rule is:
> 
> ovs-ofctl -O OpenFlow15 add-flow br0 priority=4000, idle_time_out=0, hard_timeout=0, eth_type=0x0806, arp_op=1, eth_src="00:00:00:00:01:02", actions= set_field:2->arp_op, set_field:"00:00:00:00:01:02”->arp_tha
> 
> ovs-ofctl: 'add-flow' command takes at most 2 arguments
> 
> 
> 
> Anees
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org<mailto:discuss at openvswitch.org>
> http://openvswitch.org/mailman/listinfo/discuss
> 

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From a.alnajjar1 at uq.edu.au  Sun Oct 25 18:03:40 2015
From: a.alnajjar1 at uq.edu.au (Anees Mohsin Hadi Al-Najjar)
Date: Mon, 26 Oct 2015 01:03:40 +0000
Subject: [ovs-discuss] writing a flow rule in OF15
In-Reply-To: <20151026005557.GA31441@nicira.com>
References: <f2830c7649f6492a8df7a3b6008a8df8@uq-exmbx8.soe.uq.edu.au>
 <97701452-9D2F-46BB-B365-91D5A5FD8CCE@skyportsystems.com>
 <663886717c1146fb988b87ed3c1dee2b@uq-exmbx8.soe.uq.edu.au>
 <20151026005557.GA31441@nicira.com>
Message-ID: <c69f2424da0f4f07a3c06ffd3c5a8d42@uq-exmbx8.soe.uq.edu.au>

Thanks Bin it has been accepted

Anees

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com] 
Sent: Monday, 26 October 2015 10:56 AM
To: Anees Mohsin Hadi Al-Najjar <a.alnajjar1 at uq.edu.au>
Cc: Ben Warren <ben at skyportsystems.com>; discuss at openvswitch.org
Subject: Re: [ovs-discuss] writing a flow rule in OF15

Delete the double quotes, keep the single quotes.

On Mon, Oct 26, 2015 at 12:46:35AM +0000, Anees Mohsin Hadi Al-Najjar wrote:
> Hi Ben,
> 
> I found code to quote the rule like this:
> ovs-ofctl -O OpenFlow15 add-flow br0 'priority=4000, idle_timeout=0, hard_timeout=0, eth_type=0x0806, arp_op=1, eth_src="00:00:00:00:01:02", actions= set_field:2->arp_op, set_field:"00:00:00:00:01:02"->arp_tha'
> 
> I have applied it, but another type of error, which is:
>     ovs-ofctl: "00:00:00:00:01:02": invalid Ethernet address
> 
> I appreciate if you or somebody else help me to fix it.
> 
> Thanks
> Anees
> From: Ben Warren [mailto:ben at skyportsystems.com]
> Sent: Monday, 26 October 2015 10:18 AM
> To: Anees Mohsin Hadi Al-Najjar <a.alnajjar1 at uq.edu.au>
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] writing a flow rule in OF15
> 
> Hi Anees,
> 
> Everything from “priority” on has to be a single argument according to your shell: quote it properly and don’t use any spaces.
> 
> —Ben
> 
> On Oct 25, 2015, at 5:12 PM, Anees Mohsin Hadi Al-Najjar <a.alnajjar1 at uq.edu.au<mailto:a.alnajjar1 at uq.edu.au>> wrote:
> 
> Dear all,
> 
> I am trying to write rules in latest OVS version, 2.4, and using OpenFlow 1.5. I am facing a problem with that.
> 
> Could you possibly tell me how to fix it?
> 
> Thanks.
> 
> My rule is:
> 
> ovs-ofctl -O OpenFlow15 add-flow br0 priority=4000, idle_time_out=0, hard_timeout=0, eth_type=0x0806, arp_op=1, eth_src="00:00:00:00:01:02", actions= set_field:2->arp_op, set_field:"00:00:00:00:01:02”->arp_tha
> 
> ovs-ofctl: 'add-flow' command takes at most 2 arguments
> 
> 
> 
> Anees
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org<mailto:discuss at openvswitch.org>
> http://openvswitch.org/mailman/listinfo/discuss
> 

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Sun Oct 25 21:51:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 25 Oct 2015 21:51:26 -0700
Subject: [ovs-discuss] Problem about QueueGetConfig message
In-Reply-To: <562DAA63.4040301@gmail.com>
References: <5629A14A.9030207@gmail.com> <20151024201851.GB19511@nicira.com>
 <562DAA63.4040301@gmail.com>
Message-ID: <20151026045126.GE31441@nicira.com>

It seems that this is a missing feature.

On Mon, Oct 26, 2015 at 01:21:55PM +0900, Minoru TAKAHASHI wrote:
> Hi Ben,
> 
> Thank you for your reply!
> 
> On 2015年10月25日 05:18, Ben Pfaff wrote:
> > On Fri, Oct 23, 2015 at 11:54:02AM +0900, Minoru TAKAHASHI wrote:
> >> Hi,
> >>
> >> I send QueueGetConfig message(*OFPP_ANY* was set to port) to OVS(openflow1.3),
> >> then the following errors occured.
> >>
> >>  Version: 1.3 (0x04)
> >>  Type: OFPET_QUEUE_OP_FAILED (9)
> >>  Code: OFPQOFC_BAD_PORT (0)
> >>
> >> Is this a bug?
> > 
> > It works OK here, so you'll have to be more specific.  First add a
> > bridge and turn on OpenFlow 1.3:
> > 
> >     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl add-br br0
> >     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl set bridge br0 protocols=OpenFlow13
> > 
> > Then request all queue stats:
> > 
> >     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -O OpenFlow13 queue-stats br0
> >     OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
> > 
> > Or with more detailed logging to show that it's using OFPP_ANY:
> 
> Yes, I know "queue stats request" works fine now.
> However, I was talking about "queue get config request" in previous mail.
> 
> thanks,
> 
> > 
> >     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -vvconn -O OpenFlow13 queue-stats br0
> >     2015-10-24T20:17:52Z|00001|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPT_HELLO (OF1.3) (xid=0x1):
> >      version bitmap: 0x04
> >     2015-10-24T20:17:52Z|00002|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPT_HELLO (OF1.3) (xid=0x2):
> >      version bitmap: 0x04
> >     2015-10-24T20:17:52Z|00003|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: negotiated OpenFlow version 0x04 (we support version 0x04, peer supports version 0x04)
> >     2015-10-24T20:17:52Z|00004|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPST_QUEUE request (OF1.3) (xid=0x2):port=ANY queue=ALL
> >     2015-10-24T20:17:52Z|00005|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
> >     OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
> >     blp at sigabrt:~/nicira/ovs/tutorial(0)$ 
> > 

From er.manpreet25 at gmail.com  Sun Oct 25 22:14:35 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Mon, 26 Oct 2015 10:44:35 +0530
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
Message-ID: <CALD=K8s-YZNtrh4TEYYMpFHEnpsi79cTSkNAUzPCaGo_HEeKxA@mail.gmail.com>

Hello Team,

I am working on OVS-2.3.2 and using  openflow 1.3.0.I am sending invalid
value of ofp_config_flags in OFPT_SET_CONFIG message from controller, then
sending OFPT_GET_CONFIG_REQUEST message the switch reply with
OFPT_GET_CONFIG_REPLY message having flag=normal.

I think for invalid flag value the switch must generate an error but it
will set flag to normal.

Is my understanding is correct or not ?


Regards,
Manpreet Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151026/e189d549/attachment.html>

From blp at nicira.com  Sun Oct 25 22:19:19 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 25 Oct 2015 22:19:19 -0700
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
In-Reply-To: <CALD=K8s-YZNtrh4TEYYMpFHEnpsi79cTSkNAUzPCaGo_HEeKxA@mail.gmail.com>
References: <CALD=K8s-YZNtrh4TEYYMpFHEnpsi79cTSkNAUzPCaGo_HEeKxA@mail.gmail.com>
Message-ID: <20151026051919.GF31441@nicira.com>

On Mon, Oct 26, 2015 at 10:44:35AM +0530, Manpreet Singh wrote:
> Hello Team,
> 
> I am working on OVS-2.3.2 and using  openflow 1.3.0.I am sending invalid
> value of ofp_config_flags in OFPT_SET_CONFIG message from controller, then
> sending OFPT_GET_CONFIG_REQUEST message the switch reply with
> OFPT_GET_CONFIG_REPLY message having flag=normal.
> 
> I think for invalid flag value the switch must generate an error but it
> will set flag to normal.
> 
> Is my understanding is correct or not ?

I think that it's probably better to just send valid flags.

From wenhaosen at hotmail.com  Sat Oct 24 23:18:22 2015
From: wenhaosen at hotmail.com (WenHensen)
Date: Sun, 25 Oct 2015 14:18:22 +0800
Subject: [ovs-discuss] errors occured during Debian installation
Message-ID: <SNT152-W6808A2CD3C31081159D53CAD240@phx.gbl>

Hi,
I downloaded ovs-2.4.0 and tried to build debian packages on Ubuntu 14.04LTS through command:
fakeroot debian/rules binary
and the error information from the terminal is shown in the document attached.
Is there any problems with the codes or my configurations?
Thanks a lot.

Regards,Hs 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151025/ce5f668e/attachment-0001.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: log.txt
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151025/ce5f668e/attachment-0001.txt>

From dalia.alkhfaji at gmail.com  Sun Oct 25 12:44:09 2015
From: dalia.alkhfaji at gmail.com (Dalia Adheed)
Date: Sun, 25 Oct 2015 22:44:09 +0300
Subject: [ovs-discuss] ovs switch cant pass ping between two VMs
Message-ID: <CAPmebN+WPW3QA_=aek=XRsiebLH50jvcJwmPAP_d4Z9Nzq+8=w@mail.gmail.com>

hello experts..
i have ovs switch in OS host and two VM in virtualbox and want to ping from
vm to vm through ovs-switch but the ovs switch cant pass the ping ???

this is the steps to create the ovs -switch

sudo ovs-vsctl add-br br0
sudo ip tuntap add mode tap x1
sudo ip tuntap add mode tap x2
sudo ifconfig x1 up
sudo ifconfig x2 up
sudo ovs-vsctl add-port br0 x1
sudo ovs-vsctl add-port br0 x2
sudo ifconfig br0 up


and each vm have ip in the same network..
so any one know the problem ????
thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151025/0da0edb7/attachment.html>

From takahashi.minoru7 at gmail.com  Sun Oct 25 21:21:55 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Mon, 26 Oct 2015 13:21:55 +0900
Subject: [ovs-discuss] Problem about QueueGetConfig message
In-Reply-To: <20151024201851.GB19511@nicira.com>
References: <5629A14A.9030207@gmail.com> <20151024201851.GB19511@nicira.com>
Message-ID: <562DAA63.4040301@gmail.com>

Hi Ben,

Thank you for your reply!

On 2015年10月25日 05:18, Ben Pfaff wrote:
> On Fri, Oct 23, 2015 at 11:54:02AM +0900, Minoru TAKAHASHI wrote:
>> Hi,
>>
>> I send QueueGetConfig message(*OFPP_ANY* was set to port) to OVS(openflow1.3),
>> then the following errors occured.
>>
>>  Version: 1.3 (0x04)
>>  Type: OFPET_QUEUE_OP_FAILED (9)
>>  Code: OFPQOFC_BAD_PORT (0)
>>
>> Is this a bug?
> 
> It works OK here, so you'll have to be more specific.  First add a
> bridge and turn on OpenFlow 1.3:
> 
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl add-br br0
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl set bridge br0 protocols=OpenFlow13
> 
> Then request all queue stats:
> 
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -O OpenFlow13 queue-stats br0
>     OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
> 
> Or with more detailed logging to show that it's using OFPP_ANY:

Yes, I know "queue stats request" works fine now.
However, I was talking about "queue get config request" in previous mail.

thanks,

> 
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -vvconn -O OpenFlow13 queue-stats br0
>     2015-10-24T20:17:52Z|00001|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPT_HELLO (OF1.3) (xid=0x1):
>      version bitmap: 0x04
>     2015-10-24T20:17:52Z|00002|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPT_HELLO (OF1.3) (xid=0x2):
>      version bitmap: 0x04
>     2015-10-24T20:17:52Z|00003|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: negotiated OpenFlow version 0x04 (we support version 0x04, peer supports version 0x04)
>     2015-10-24T20:17:52Z|00004|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPST_QUEUE request (OF1.3) (xid=0x2):port=ANY queue=ALL
>     2015-10-24T20:17:52Z|00005|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
>     OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ 
> 

From ravindra.kenchappa at hpe.com  Sun Oct 25 21:45:05 2015
From: ravindra.kenchappa at hpe.com (Kenchappa, Ravindra)
Date: Mon, 26 Oct 2015 04:45:05 +0000
Subject: [ovs-discuss] OVS: not able to add conntack flow rules
Message-ID: <8B736CA61E8F7C44875935637477D33E01079C3BF8@G9W0743.americas.hpqcorp.net>

Hi,

I have downloaded and installed OVS 2.4.90 (https://github.com/justinpettit/ovs/tree/conntrack) and trying to add conntrack flows via ovs-ofctl. I am able to add few sample flows and I am getting errors when tried to added the following flow:

raveek:~/devstack$ sudo ovs-ofctl add-flow br-int table=1,in_port=2,ct_state=+est,tcp,action=1
OFPT_ERROR (xid=0x6): OFPBMC_BAD_FIELD
NXT_FLOW_MOD (xid=0x6):
(truncated to 64 bytes from 88)
00000000 01 04 00 58 00 00 00 06-00 00 23 20 00 00 00 0d |...X......# ....|
00000010 00 00 00 00 00 00 00 00-01 00 00 00 00 00 80 00 |................|
00000020 ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00 |................|
00000030 00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01 |................|

raveek:~/devstack$ sudo ovs-ofctl add-flow br-int table=20,in_port=2,ct_state=+trk+new,tcp,action=drop
OFPT_ERROR (xid=0x6): OFPBMC_BAD_FIELD
NXT_FLOW_MOD (xid=0x6):
(truncated to 64 bytes from 80)
00000000 01 04 00 50 00 00 00 06-00 00 23 20 00 00 00 0d |...P......# ....|
00000010 00 00 00 00 00 00 00 00-14 00 00 00 00 00 80 00 |................|
00000020 ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00 |................|
00000030 00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01 |................|
raveek::~/devstack$

Here is the flow table looks like.

raveek:~/devstack$ sudo ovs-ofctl dump-flows br-int -Oopenflow13
OFPST_FLOW reply (OF1.3) (xid=0x2):
cookie=0x0, duration=98.291s, table=0, n_packets=0, n_bytes=0, dl_type=0x88cc actions=CONTROLLER:65535
cookie=0x0, duration=28.391s, table=0, n_packets=0, n_bytes=0, arp actions=NORMAL
cookie=0x0, duration=28.368s, table=0, n_packets=0, n_bytes=0, ct_state=-trk,tcp,in_port=1 actions=ct(commit,zone=9),output:2
cookie=0x0, duration=28.346s, table=0, n_packets=0, n_bytes=0, ct_state=-trk,tcp,in_port=2 actions=ct(table=1,zone=9)
cookie=0x0, duration=98.291s, table=0, n_packets=0, n_bytes=0, priority=0 actions=goto_table:20
cookie=0x0, duration=28.410s, table=0, n_packets=0, n_bytes=0, priority=1 actions=drop
cookie=0x0, duration=98.288s, table=20, n_packets=0, n_bytes=0, priority=0 actions=goto_table:30
cookie=0x0, duration=98.288s, table=30, n_packets=0, n_bytes=0, priority=0 actions=goto_table:40
cookie=0x0, duration=98.288s, table=40, n_packets=0, n_bytes=0, priority=0 actions=goto_table:50
cookie=0x0, duration=98.291s, table=50, n_packets=0, n_bytes=0, priority=0 actions=goto_table:60
cookie=0x0, duration=98.288s, table=60, n_packets=0, n_bytes=0, priority=0 actions=goto_table:70
cookie=0x0, duration=98.288s, table=70, n_packets=0, n_bytes=0, priority=0 actions=goto_table:80
cookie=0x0, duration=98.289s, table=80, n_packets=0, n_bytes=0, priority=0 actions=goto_table:90
cookie=0x0, duration=98.288s, table=90, n_packets=0, n_bytes=0, priority=0 actions=goto_table:100
cookie=0x0, duration=98.288s, table=100, n_packets=0, n_bytes=0, priority=0 actions=goto_table:110
cookie=0x0, duration=98.291s, table=110, n_packets=0, n_bytes=0, priority=0 actions=drop

raveek::~/devstack$

Could you please help me in identifying the problem?

Thanks,
Raveek

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151026/c7492924/attachment.html>

From andrey at xdel.ru  Mon Oct 26 08:32:58 2015
From: andrey at xdel.ru (Andrey Korolyov)
Date: Mon, 26 Oct 2015 18:32:58 +0300
Subject: [ovs-discuss] Datapath flow eviction rate for 2.x
Message-ID: <CABYiri87YJojbOo0oZ2NJG1ojhsf_dLseR0-w5QhT9xrNHehkQ@mail.gmail.com>

Hi,

As far as I can see, the default 200k limit for in-datapath rules
working not exactly as suggested, because dpctl shows far lower number
of the active flows and with max-idle for 2.5h:

system at ovs-system:
        lookups: hit:176489248433 missed:29538996446 lost:46962
        flows: 6462
        masks: hit:906990269299 total:5 hit/pkt:4.40


Stdev of flow# is about ten percent within a minute, so OVS behaving
slightly different than it should by a bare look at the code. Can
anyone please suggest a way to change an eviction rate so datapath
will hold at least one tenth of amount of prefixes from the limit, or
it is intentional to hold in-dp flow number that low? Indeed there is
a small tail with low hit-rate but most of those subnets are
definitely used more frequently than max-idle.

Thanks!

From joestringer at nicira.com  Mon Oct 26 09:51:50 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Mon, 26 Oct 2015 09:51:50 -0700
Subject: [ovs-discuss] OVS: not able to add conntack flow rules
In-Reply-To: <8B736CA61E8F7C44875935637477D33E01079C3BF8@G9W0743.americas.hpqcorp.net>
References: <8B736CA61E8F7C44875935637477D33E01079C3BF8@G9W0743.americas.hpqcorp.net>
Message-ID: <CANr6G5yTtxan729j9T-HCdpbiqNFd=yBcsL=qK2VQ=Y9fva0wA@mail.gmail.com>

On 25 October 2015 at 21:45, Kenchappa, Ravindra
<ravindra.kenchappa at hpe.com> wrote:
> Hi,
>
> I have downloaded and installed OVS 2.4.90
> (https://github.com/justinpettit/ovs/tree/conntrack) and trying to add
> conntrack flows via ovs-ofctl. I am able to add few sample flows and I am
> getting errors when tried to added the following flow:
>
> raveek:~/devstack$ sudo ovs-ofctl add-flow br-int
> table=1,in_port=2,ct_state=+est,tcp,action=1
> OFPT_ERROR (xid=0x6): OFPBMC_BAD_FIELD
> NXT_FLOW_MOD (xid=0x6):
> (truncated to 64 bytes from 88)
> 00000000 01 04 00 58 00 00 00 06-00 00 23 20 00 00 00 0d |...X......# ....|
> 00000010 00 00 00 00 00 00 00 00-01 00 00 00 00 00 80 00 |................|
> 00000020 ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00 |................|
> 00000030 00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01 |................|
>
> raveek:~/devstack$ sudo ovs-ofctl add-flow br-int
> table=20,in_port=2,ct_state=+trk+new,tcp,action=drop
> OFPT_ERROR (xid=0x6): OFPBMC_BAD_FIELD
> NXT_FLOW_MOD (xid=0x6):
> (truncated to 64 bytes from 80)
> 00000000 01 04 00 50 00 00 00 06-00 00 23 20 00 00 00 0d |...P......# ....|
> 00000010 00 00 00 00 00 00 00 00-14 00 00 00 00 00 80 00 |................|
> 00000020 ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00 |................|
> 00000030 00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01 |................|
> raveek::~/devstack$
>
> Here is the flow table looks like.
>
> raveek:~/devstack$ sudo ovs-ofctl dump-flows br-int -Oopenflow13
> OFPST_FLOW reply (OF1.3) (xid=0x2):
> cookie=0x0, duration=98.291s, table=0, n_packets=0, n_bytes=0,
> dl_type=0x88cc actions=CONTROLLER:65535
> cookie=0x0, duration=28.391s, table=0, n_packets=0, n_bytes=0, arp
> actions=NORMAL
> cookie=0x0, duration=28.368s, table=0, n_packets=0, n_bytes=0,
> ct_state=-trk,tcp,in_port=1 actions=ct(commit,zone=9),output:2
> cookie=0x0, duration=28.346s, table=0, n_packets=0, n_bytes=0,
> ct_state=-trk,tcp,in_port=2 actions=ct(table=1,zone=9)
> cookie=0x0, duration=98.291s, table=0, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:20
> cookie=0x0, duration=28.410s, table=0, n_packets=0, n_bytes=0, priority=1
> actions=drop
> cookie=0x0, duration=98.288s, table=20, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:30
> cookie=0x0, duration=98.288s, table=30, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:40
> cookie=0x0, duration=98.288s, table=40, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:50
> cookie=0x0, duration=98.291s, table=50, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:60
> cookie=0x0, duration=98.288s, table=60, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:70
> cookie=0x0, duration=98.288s, table=70, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:80
> cookie=0x0, duration=98.289s, table=80, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:90
> cookie=0x0, duration=98.288s, table=90, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:100
> cookie=0x0, duration=98.288s, table=100, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:110
> cookie=0x0, duration=98.291s, table=110, n_packets=0, n_bytes=0, priority=0
> actions=drop
>
> raveek::~/devstack$
>
> Could you please help me in identifying the problem?

There have been multiple questions like this recently on this
mailinglist, see those threads:

http://openvswitch.org/pipermail/discuss/2015-October/019201.html
http://openvswitch.org/pipermail/dev/2015-October/061629.html

From joestringer at nicira.com  Mon Oct 26 10:48:32 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Mon, 26 Oct 2015 10:48:32 -0700
Subject: [ovs-discuss] Datapath flow eviction rate for 2.x
In-Reply-To: <CABYiri87YJojbOo0oZ2NJG1ojhsf_dLseR0-w5QhT9xrNHehkQ@mail.gmail.com>
References: <CABYiri87YJojbOo0oZ2NJG1ojhsf_dLseR0-w5QhT9xrNHehkQ@mail.gmail.com>
Message-ID: <CANr6G5wHSCL4Z9Z2pAa8UT6A2fagMdsxEsvM0rYYjHfx2B3AfQ@mail.gmail.com>

On 26 October 2015 at 08:32, Andrey Korolyov <andrey at xdel.ru> wrote:
> Hi,
>
> As far as I can see, the default 200k limit for in-datapath rules
> working not exactly as suggested, because dpctl shows far lower number
> of the active flows and with max-idle for 2.5h:
>
> system at ovs-system:
>         lookups: hit:176489248433 missed:29538996446 lost:46962
>         flows: 6462
>         masks: hit:906990269299 total:5 hit/pkt:4.40
>
>
> Stdev of flow# is about ten percent within a minute, so OVS behaving
> slightly different than it should by a bare look at the code. Can
> anyone please suggest a way to change an eviction rate so datapath
> will hold at least one tenth of amount of prefixes from the limit, or
> it is intentional to hold in-dp flow number that low? Indeed there is
> a small tail with low hit-rate but most of those subnets are
> definitely used more frequently than max-idle.

If your flow table isn't sufficiently complex, then there may be no
reason for OVS userspace to generate more datapath flows.

If traffic isn't regularly hitting your flows, then OVS will evict
those flows from the datapath.

If OVS is not able to validate all datapath flows within a second,
then it will reduce the number of datapath flows that it maintains.

There have been significant improvements in how this works in v2.1.x
(with threaded revalidation) and in v2.4.x (with UFID), so if you're
not already running 2.4 or later, I suggest updating.

Since you're interested in how datapath flow management works, you may
get more insight from "Revaliwhat? Keeping kernel flows fresh" from
OVS fall conference 2014. It's on the OVS website.

From andrey at xdel.ru  Mon Oct 26 10:58:44 2015
From: andrey at xdel.ru (Andrey Korolyov)
Date: Mon, 26 Oct 2015 20:58:44 +0300
Subject: [ovs-discuss] Datapath flow eviction rate for 2.x
In-Reply-To: <CANr6G5wHSCL4Z9Z2pAa8UT6A2fagMdsxEsvM0rYYjHfx2B3AfQ@mail.gmail.com>
References: <CABYiri87YJojbOo0oZ2NJG1ojhsf_dLseR0-w5QhT9xrNHehkQ@mail.gmail.com>
 <CANr6G5wHSCL4Z9Z2pAa8UT6A2fagMdsxEsvM0rYYjHfx2B3AfQ@mail.gmail.com>
Message-ID: <CABYiri8NVR=y2ncoieoLcXfJdM3VLqKVHrgUYVu2-eUbky95dA@mail.gmail.com>

On Mon, Oct 26, 2015 at 8:48 PM, Joe Stringer <joestringer at nicira.com> wrote:
> On 26 October 2015 at 08:32, Andrey Korolyov <andrey at xdel.ru> wrote:
>> Hi,
>>
>> As far as I can see, the default 200k limit for in-datapath rules
>> working not exactly as suggested, because dpctl shows far lower number
>> of the active flows and with max-idle for 2.5h:
>>
>> system at ovs-system:
>>         lookups: hit:176489248433 missed:29538996446 lost:46962
>>         flows: 6462
>>         masks: hit:906990269299 total:5 hit/pkt:4.40
>>
>>
>> Stdev of flow# is about ten percent within a minute, so OVS behaving
>> slightly different than it should by a bare look at the code. Can
>> anyone please suggest a way to change an eviction rate so datapath
>> will hold at least one tenth of amount of prefixes from the limit, or
>> it is intentional to hold in-dp flow number that low? Indeed there is
>> a small tail with low hit-rate but most of those subnets are
>> definitely used more frequently than max-idle.
>
> If your flow table isn't sufficiently complex, then there may be no
> reason for OVS userspace to generate more datapath flows.
>
> If traffic isn't regularly hitting your flows, then OVS will evict
> those flows from the datapath.
>
> If OVS is not able to validate all datapath flows within a second,
> then it will reduce the number of datapath flows that it maintains.
>
> There have been significant improvements in how this works in v2.1.x
> (with threaded revalidation) and in v2.4.x (with UFID), so if you're
> not already running 2.4 or later, I suggest updating.
>
> Since you're interested in how datapath flow management works, you may
> get more insight from "Revaliwhat? Keeping kernel flows fresh" from
> OVS fall conference 2014. It's on the OVS website.

Thanks for the reference Joe,

tables are a bit unusual - there is a dozen of chained tables with
approximately half of million (full-view lookup table) rules in last
one, so I suppose that heuristics could go wrong just because of this
fact. This is very close 2.3-HEAD, will check if 2.4 would improve the
situation - actually, the switchd just eats too much for scattered
lookups like one I described. 2.1 improvement it the past was indeed
quite fantastic.

From dalia.alkhfaji at gmail.com  Mon Oct 26 14:48:27 2015
From: dalia.alkhfaji at gmail.com (Dalia)
Date: Tue, 27 Oct 2015 00:48:27 +0300
Subject: [ovs-discuss] OVS cant pass ping between 2 VMs
Message-ID: <C90E1EBB-BE26-47D5-B659-EE6535972600@gmail.com>


hello experts..
i have ovs switch in OS host and two VM in virtualbox and want to ping from vm to vm through ovs-switch but the ovs switch cant pass the ping ???

this is the steps to create the ovs -switch

sudo ovs-vsctl add-br br0
sudo ip tuntap add mode tap x1
sudo ip tuntap add mode tap x2
sudo ifconfig x1 up
sudo ifconfig x2 up
sudo ovs-vsctl add-port br0 x1
sudo ovs-vsctl add-port br0 x2
sudo ifconfig br0 up
     

and each vm have ip in the same network..
so any one know the problem ????
thanks

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/77b252f2/attachment.html>

From muralirdev at gmail.com  Mon Oct 26 15:15:30 2015
From: muralirdev at gmail.com (Murali R)
Date: Tue, 27 Oct 2015 06:15:30 +0800
Subject: [ovs-discuss] [ovn] multi node ovn debugging
In-Reply-To: <CAO=R8om0BW4mo-bdepY3jd-jVJwbt37nvgCCsKv8WcUj6DM36g@mail.gmail.com>
References: <CADtzDC=nF_9c3Hxbw98K0S6zw+S+miY-1SyV4kgSv+PP9RoLVw@mail.gmail.com>
 <CAO=R8onp27V1uJqt75Vj1jv=z-uOsDo9apvjpYYwBKTJYn0Q9Q@mail.gmail.com>
 <CAHbON5oBYQy7fGeKk_5aDuAieq_inCLSY8G+qStN+2Uvz_Achw@mail.gmail.com>
 <CADtzDC=D5G_uFNDZaWtRx_rsO1a3QR0_gFB=4NtHp5dx53d0Cw@mail.gmail.com>
 <CAO=R8om0BW4mo-bdepY3jd-jVJwbt37nvgCCsKv8WcUj6DM36g@mail.gmail.com>
Message-ID: <CAO=R8okHEeWCZcA0ZRbvorLTyTPgfUpmXq9o8mA5biR+8VAu7w@mail.gmail.com>

​Turns out the only difference between the timing of controller node and
compute node installs was not using main ovs brach until contrack is
merged. Looks like when I installed compute (remote node) after Sep 22, I
had the right repo and it installed vport-geneve. When I build+install the
old checked out files, it did not install the ko for vport-geneve without
any errors. But latest one installs the mod consistently.

In short, use networking-ovn after Sep 22, and keep tracking contrack merge
in ircs.

OVN_REPO=https://github.com/russellb/ovs.git
#OVN_REPO=${OVN_REPO:http://github.com/openvswitch/ovs.git}
OVN_REPO_NAME=$(basename ${OVN_REPO} | cut -f1 -d'.')
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/f1640713/attachment.html>

From muralirdev at gmail.com  Mon Oct 26 15:21:43 2015
From: muralirdev at gmail.com (Murali R)
Date: Tue, 27 Oct 2015 06:21:43 +0800
Subject: [ovs-discuss] [ovn] multi node ovn debugging
In-Reply-To: <CAO=R8okHEeWCZcA0ZRbvorLTyTPgfUpmXq9o8mA5biR+8VAu7w@mail.gmail.com>
References: <CADtzDC=nF_9c3Hxbw98K0S6zw+S+miY-1SyV4kgSv+PP9RoLVw@mail.gmail.com>
 <CAO=R8onp27V1uJqt75Vj1jv=z-uOsDo9apvjpYYwBKTJYn0Q9Q@mail.gmail.com>
 <CAHbON5oBYQy7fGeKk_5aDuAieq_inCLSY8G+qStN+2Uvz_Achw@mail.gmail.com>
 <CADtzDC=D5G_uFNDZaWtRx_rsO1a3QR0_gFB=4NtHp5dx53d0Cw@mail.gmail.com>
 <CAO=R8om0BW4mo-bdepY3jd-jVJwbt37nvgCCsKv8WcUj6DM36g@mail.gmail.com>
 <CAO=R8okHEeWCZcA0ZRbvorLTyTPgfUpmXq9o8mA5biR+8VAu7w@mail.gmail.com>
Message-ID: <CAO=R8okkaLcBoSsgyww+j4xBf78cpJOvAizy34NDXvbC934+WQ@mail.gmail.com>

Correction: not  Sep 22, its Oct 22.

On Tue, Oct 27, 2015 at 6:15 AM, Murali R <muralirdev at gmail.com> wrote:

>
> ​Turns out the only difference between the timing of controller node and
> compute node installs was not using main ovs brach until contrack is
> merged. Looks like when I installed compute (remote node) after Sep 22, I
> had the right repo and it installed vport-geneve. When I build+install the
> old checked out files, it did not install the ko for vport-geneve without
> any errors. But latest one installs the mod consistently.
>
> In short, use networking-ovn after Sep 22, and keep tracking contrack
> merge in ircs.
>
> OVN_REPO=https://github.com/russellb/ovs.git
> #OVN_REPO=${OVN_REPO:http://github.com/openvswitch/ovs.git}
> OVN_REPO_NAME=$(basename ${OVN_REPO} | cut -f1 -d'.')
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/c6ecd0ba/attachment.html>

From muralirdev at gmail.com  Mon Oct 26 18:37:42 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 26 Oct 2015 18:37:42 -0700
Subject: [ovs-discuss] [ovn] Multi host devstack details
Message-ID: <CAO=R8omHM=Tx4KHZVfr2apCXWnTTsoWotfCiQRDohcL4CJwvgg@mail.gmail.com>

Heads up for anyone trying. I might send in a change later once I get a
breather, but something I thought may be useful for anyone setting up
multhost.with dedicated tunnel ip.


diff --git a/devstack/plugin.sh b/devstack/plugin.sh
index bbc04dc..24a4dd3 100644
--- a/devstack/plugin.sh
+++ b/devstack/plugin.sh
@@ -56,7 +56,8 @@ OVN_BRANCH=origin/conntrack
 #OVN_BRANCH=${OVN_BRANCH:-origin/master}

 # How to connect to ovsdb-server hosting the OVN databases.
-OVN_REMOTE=${OVN_REMOTE:-tcp:$HOST_IP:6640}
+OVN_REMOTE=${OVN_REMOTE:-tcp:$SERVICE_HOST:6640}
+OVN_TUNNEL_IP=$(TUNNEL_ENDPOINT_IP:-$HOST_IP)

 # A UUID to uniquely identify this system.  If one is not specified, a
random
 # one will be generated.  A randomly generated UUID will be saved in a file
@@ -250,7 +251,8 @@ function start_ovs {
         ovs-vsctl --no-wait set open_vswitch .
external-ids:ovn-remote="$OVN_REMOTE"
         ovs-vsctl --no-wait set open_vswitch .
external-ids:ovn-bridge="br-int"
         ovs-vsctl --no-wait set open_vswitch .
external-ids:ovn-encap-type="geneve"
-        ovs-vsctl --no-wait set open_vswitch .
external-ids:ovn-encap-ip="$HOST_IP"
-        ovs-vsctl --no-wait set open_vswitch .
external-ids:ovn-encap-ip="$HOST_IP"
+        ovs-vsctl --no-wait set open_vswitch .
external-ids:ovn-encap-ip="$OVN_TUNNEL_IP"

         _neutron_ovs_base_setup_bridge br-int
         ovs-vsctl --no-wait set bridge br-int fail-mode=secure
other-config:disable-in-band
(END)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151026/734de48c/attachment.html>

From V_Dham at Dell.com  Mon Oct 26 23:14:42 2015
From: V_Dham at Dell.com (V_Dham at Dell.com)
Date: Tue, 27 Oct 2015 01:14:42 -0500
Subject: [ovs-discuss] SFC using OVN
Message-ID: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>

Hi All,

I am currently exploring Service Function Chaining (SFC) implementation using OVN and would like to hear thoughts from the community.

Has anyone implemented Service Function Chaining using OVN project and would be willing to share his/her experiences? There are proposals for adding NSH header as well as leveraging MPLS headers (interim solution for lack of NSH support) for SFC but can someone more experienced in this topic share if those modifications are really necessary for real world SFC use cases? 

With the native support for L2 overlays and ACLs inherently built into OVN, I am wondering if we are better off creating point to point overlay networks between the VNFs and using ACLs for traffic classification. Or is there more to it than that?

Thanks,

Vikram

From fichera.sil at gmail.com  Tue Oct 27 02:54:41 2015
From: fichera.sil at gmail.com (Silvia Fichera)
Date: Tue, 27 Oct 2015 10:54:41 +0100
Subject: [ovs-discuss] OpenDaylight and Openstack - Can't connect node to an
	ovs
Message-ID: <CAEFdjR3C4_kwyuC8r9xyr394KFC+1yM7_UPuZD9Ayjvggv2R6Q@mail.gmail.com>

Hi all,
I'm integrating OpenStack via DevStack with OpenDaylight. I'm using
DevStack Kilo and OpenDaylight Lithium.
In a server I have 5 VMs:

VM1: eth0 10.30.3.231
         eth1 10.0.0.1
         This is my OpenStack Controller+compute.

VM2: eth0 10.30.3.232
         eth1 10.0.0.2
         Compute node

VM3: eth0 10.30.3.233
         eth1 10.0.0.3
         Compute node

VM4: eth0 10.30.3.234
         ODL Controller

VM7: eth0 10.30.3.237
         eth1
         eth2
         eth3
         OpenVSwitch

I consider eth0 the mgmt network (I also use this address to access via ssh
into the VMs) and eth1 the data network (VM1 eth1 is connected to OVS eth1,
VM2 eth1 is connected to OVS eth2, VM3 eth1 is connected to OVS eth3).
This network works properly, I've checked.

But, when I stack VM1, vm2 and VM3 I see:

- From DLux that the virtual switches inside the compute nodes are
connected each other (like a ring topology) and my OVS is isolated.

- When I launch instances they are correctly created, but if I ping them
(e.g. Instance1 in VM1 and Instance2 in VM2) the traffic goes through the
mgmt network (eth0).

What I want is that the traffic passes through my data network.
Can you give me some suggestions?

Thank you
Regards,

Silvia

P.S.: I'm not able to log in into ask.opendaylight.org to post this
question also there.
-- 
Silvia Fichera
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/cf395aee/attachment.html>

From zhang.kris at gmail.com  Tue Oct 27 04:13:10 2015
From: zhang.kris at gmail.com (zhang.kris)
Date: Tue, 27 Oct 2015 19:13:10 +0800
Subject: [ovs-discuss] OVS cant pass ping between 2 VMs
References: <1itsrt3gfk56lnrag9a54kr6.1445927888950@email.kingsoft.com>
Message-ID: <qho4lt0i0n4uf4djv3msr6jl.1445944390989@email.kingsoft.com>

An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/1ac12954/attachment.html>

From benedikt.rudolph at ps.tu-darmstadt.de  Tue Oct 27 05:13:49 2015
From: benedikt.rudolph at ps.tu-darmstadt.de (Benedikt Rudolph)
Date: Tue, 27 Oct 2015 13:13:49 +0100
Subject: [ovs-discuss] ovs dpdk low performance despite optimizations
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F7452A2CD1@IRSMSX104.ger.corp.intel.com>
References: <5627B10B.2050302@ps.tu-darmstadt.de>
 <BC0FEEC7D7650749874CEC11314A88F7452A2CD1@IRSMSX104.ger.corp.intel.com>
Message-ID: <562F6A7D.2050604@ps.tu-darmstadt.de>

Hi list, hi Mr. Traynor,

On 22.10.15 11:48, Traynor, Kevin wrote:
> Did you catch the updates to that section on the mainline that were
> not in the OVS 2.4 package?
> https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#performance-tuning

Yep, I looked at the most recent version on github and noticed the
cleanup in the Performance Tuning section.
> I see the same, so not causing your poor performance.
Do you have any numbers of which level of performance can be expected
for the described setup? Theoretical max. for 64 Byte packets is around
14 Mpps. Has anybody observed performance close to this in OpenvSwitch
using DPDK?
We were able to get around 14 Mpps using the l2fwd example app from dpdk.

We also re-tested our setup with OVS master (from github) and DPDK 2.1
and found no difference to the results described in my first posting.

From fichera.sil at gmail.com  Tue Oct 27 06:27:13 2015
From: fichera.sil at gmail.com (Silvia Fichera)
Date: Tue, 27 Oct 2015 14:27:13 +0100
Subject: [ovs-discuss] OVS cant pass ping between 2 VMs
In-Reply-To: <qho4lt0i0n4uf4djv3msr6jl.1445944390989@email.kingsoft.com>
References: <1itsrt3gfk56lnrag9a54kr6.1445927888950@email.kingsoft.com>
 <qho4lt0i0n4uf4djv3msr6jl.1445944390989@email.kingsoft.com>
Message-ID: <CAEFdjR2CsswtLZ0d800HzKgR-Or5Aduyr5ts3kcve4h5n0nhFg@mail.gmail.com>

I did in this way:
ovs-vsctl add-br br0
ovs-vsctl add-port br0 eth1
ovs-vsctl add-port br0 eth2
ifconfig  br0 up
ifconfig  eth1 up
ifconfig  eth2 up

and it worked for me


2015-10-27 12:13 GMT+01:00 zhang.kris <zhang.kris at gmail.com>:

> Have you disable the firewall in the OS of VM?
>
> Best regards,
> Kris
> 在 2015-10-27 上午5:48，Dalia <dalia.alkhfaji at gmail.com>写道：
>
>
> hello experts..
> i have ovs switch in OS host and two VM in virtualbox and want to ping
> from vm to vm through ovs-switch but the ovs switch cant pass the ping ???
>
> this is the steps to create the ovs -switch
>
> sudo ovs-vsctl add-br br0
> sudo ip tuntap add mode tap x1
> sudo ip tuntap add mode tap x2
> sudo ifconfig x1 up
> sudo ifconfig x2 up
> sudo ovs-vsctl add-port br0 x1
> sudo ovs-vsctl add-port br0 x2
> sudo ifconfig br0 up
>
>
> and each vm have ip in the same network..
> so any one know the problem ????
> thanks
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>


-- 
Silvia Fichera
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/6de4c8ea/attachment.html>

From kevin.traynor at intel.com  Tue Oct 27 07:25:02 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 27 Oct 2015 14:25:02 +0000
Subject: [ovs-discuss] ovs dpdk low performance despite optimizations
In-Reply-To: <562F6A7D.2050604@ps.tu-darmstadt.de>
References: <5627B10B.2050302@ps.tu-darmstadt.de>
 <BC0FEEC7D7650749874CEC11314A88F7452A2CD1@IRSMSX104.ger.corp.intel.com>
 <562F6A7D.2050604@ps.tu-darmstadt.de>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7452AE36C@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Benedikt
> Rudolph
> Sent: Tuesday, October 27, 2015 12:14 PM
> To: discuss at openvswitch.com
> Subject: Re: [ovs-discuss] ovs dpdk low performance despite optimizations
> 
> Hi list, hi Mr. Traynor,
> 
> On 22.10.15 11:48, Traynor, Kevin wrote:
> > Did you catch the updates to that section on the mainline that were
> > not in the OVS 2.4 package?
> > https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md#performance-
> tuning
> 
> Yep, I looked at the most recent version on github and noticed the
> cleanup in the Performance Tuning section.
> > I see the same, so not causing your poor performance.
> Do you have any numbers of which level of performance can be expected
> for the described setup? Theoretical max. for 64 Byte packets is around
> 14 Mpps. Has anybody observed performance close to this in OpenvSwitch
> using DPDK?
> We were able to get around 14 Mpps using the l2fwd example app from dpdk.

hi, I think you should be able to hit line rate for a phy-phy test with 1 PMD
depending on what processor you are using. I would stick to 1 PMD and 1 rxq for
debugging - increasing may help mitigate any issue, but will make it harder to
debug. 

What rules are you installing? also what processor are you using? Is the PMD
getting ~100% of a core or is there something else running - you can check
with top -H

> 
> We also re-tested our setup with OVS master (from github) and DPDK 2.1
> and found no difference to the results described in my first posting.
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From praveen.mankara at 6wind.com  Mon Oct 26 10:23:12 2015
From: praveen.mankara at 6wind.com (Praveen MANKARA RADHAKRISHNAN)
Date: Mon, 26 Oct 2015 18:23:12 +0100
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
Message-ID: <CADCo8KC1S0FiZmWQCD_zaH5RYtX_SQBJu8vgr3b2_14vysyxOQ@mail.gmail.com>

HI,

I am Praveen,

I am trying a specific test scenario using ovs-dpdk.

Test set up
-------------------

from the traffgen vlan packets are coming to dpdk interface its stripped
using ovs command.
and sending to a vxlan interface which is comnnected in theo other dpdk
interface and send back to traffgen.

i have done the vxlan set up similar to the sample test case.

https://github.com/openvswitch/ovs/blob/master/README-native-tunneling.md

the issue is that from the sumpflows i can see that packets are send to
vxlan but it is not going to the other bridge.

the same scenario is working without dpdk.

I am using openvswitch-2.4.0.

Linux (without dpdk)
---------------------------------

ovs-vsctl add-br br0
ovs-vsctl add-port br0 eth0
ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
options:remote_ip=10.200.0.6
ovs-ofctl add-flow br0
dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2

ovs-vsctl add-br br1
ovs-vsctl add-port br1 eth1

 ip a a 10.200.0.5/24 dev br1
arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2

and from the traffgen i am sending traffic with dst mac 02:11:22:44:55:22
and vlan id 1.
it is correctly working.

ovs-dpdk
------------------

started ovs-dpdk ::
ovs-vswitchd --dpdk -c 0x1 -n 4 -- unix:$DB_SOCK --pidfile --detach

ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk

ovs-vsctl add-br br1 -- set bridge br1 datapath_type=netdev
ovs-vsctl add-port br1 dpdk1 -- set Interface dpdk1 type=dpdk

ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
options:remote_ip=10.200.0.6
ovs-ofctl add-flow br0
dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2

 ip a a 10.200.0.5/24 dev br1
arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2


here i have started the ovs-dpddk and do the same set up
but packets are not seen in bridge1 (br1) and in traffgen.

is there any specif configuration i need to do in ovs-dpdk
could it be because of the arp?
Is there a way to set static arp to the ovs-dpdk?

Could you help in identifying the problem?

Thanking you in advance
Praveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151026/4dda834a/attachment-0001.html>

From Mehwish_Zaidi at cable.comcast.com  Mon Oct 26 14:27:19 2015
From: Mehwish_Zaidi at cable.comcast.com (Zaidi, Mehwish (Contractor))
Date: Mon, 26 Oct 2015 21:27:19 +0000
Subject: [ovs-discuss] error while trying to build .deb package on ubuntu
	14.10
Message-ID: <b566745d869548928a0e9f922850c895@VAADCEX18.cable.comcast.com>

Hi I am getting below error when I am executing command : fakeroot debian/rules binary

../configure: line 13008: OVS_CHECK_PKIDIR: command not found
../configure: line 13009: OVS_CHECK_RUNDIR: command not found
../configure: line 13010: OVS_CHECK_DBDIR: command not found
../configure: line 13011: OVS_CHECK_BACKTRACE: command not found
../configure: line 13012: OVS_CHECK_PERF_EVENT: command not found
../configure: line 13013: OVS_CHECK_VALGRIND: command not found
../configure: line 13014: OVS_CHECK_SOCKET_LIBS: command not found
checking XenServer release... none
../configure: line 13039: OVS_CHECK_GROFF: command not found
checking whether make is GNU make... yes
../configure: line 13067: OVS_CHECK_TLS: command not found
../configure: line 13068: OVS_CHECK_ATOMIC_LIBS: command not found
../configure: line 13069: OVS_CHECK_GCC4_ATOMICS: command not found
../configure: line 13070: syntax error near unexpected token `1'
../configure: line 13070: `OVS_CHECK_ATOMIC_ALWAYS_LOCK_FREE(1)'
make: *** [configure-stamp] Error 2

Regards,
Mehwish
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151026/d29c8e94/attachment-0001.html>

From takahashi.minoru7 at gmail.com  Mon Oct 26 22:35:53 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Tue, 27 Oct 2015 14:35:53 +0900
Subject: [ovs-discuss] Problem about QueueGetConfig message
In-Reply-To: <20151026045126.GE31441@nicira.com>
References: <5629A14A.9030207@gmail.com> <20151024201851.GB19511@nicira.com>
 <562DAA63.4040301@gmail.com> <20151026045126.GE31441@nicira.com>
Message-ID: <562F0D39.4020402@gmail.com>

Hi,

On 2015年10月26日 13:51, Ben Pfaff wrote:
> It seems that this is a missing feature.

OK, I understood.
I am waiting for this feature to be implemented.

thanks,

> 
> On Mon, Oct 26, 2015 at 01:21:55PM +0900, Minoru TAKAHASHI wrote:
>> Hi Ben,
>>
>> Thank you for your reply!
>>
>> On 2015年10月25日 05:18, Ben Pfaff wrote:
>>> On Fri, Oct 23, 2015 at 11:54:02AM +0900, Minoru TAKAHASHI wrote:
>>>> Hi,
>>>>
>>>> I send QueueGetConfig message(*OFPP_ANY* was set to port) to OVS(openflow1.3),
>>>> then the following errors occured.
>>>>
>>>>  Version: 1.3 (0x04)
>>>>  Type: OFPET_QUEUE_OP_FAILED (9)
>>>>  Code: OFPQOFC_BAD_PORT (0)
>>>>
>>>> Is this a bug?
>>>
>>> It works OK here, so you'll have to be more specific.  First add a
>>> bridge and turn on OpenFlow 1.3:
>>>
>>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl add-br br0
>>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl set bridge br0 protocols=OpenFlow13
>>>
>>> Then request all queue stats:
>>>
>>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -O OpenFlow13 queue-stats br0
>>>     OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
>>>
>>> Or with more detailed logging to show that it's using OFPP_ANY:
>>
>> Yes, I know "queue stats request" works fine now.
>> However, I was talking about "queue get config request" in previous mail.
>>
>> thanks,
>>
>>>
>>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -vvconn -O OpenFlow13 queue-stats br0
>>>     2015-10-24T20:17:52Z|00001|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPT_HELLO (OF1.3) (xid=0x1):
>>>      version bitmap: 0x04
>>>     2015-10-24T20:17:52Z|00002|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPT_HELLO (OF1.3) (xid=0x2):
>>>      version bitmap: 0x04
>>>     2015-10-24T20:17:52Z|00003|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: negotiated OpenFlow version 0x04 (we support version 0x04, peer supports version 0x04)
>>>     2015-10-24T20:17:52Z|00004|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPST_QUEUE request (OF1.3) (xid=0x2):port=ANY queue=ALL
>>>     2015-10-24T20:17:52Z|00005|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
>>>     OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
>>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ 
>>>

From wangrongs163 at 163.com  Tue Oct 27 02:27:48 2015
From: wangrongs163 at 163.com (wangrongs163)
Date: Tue, 27 Oct 2015 17:27:48 +0800 (CST)
Subject: [ovs-discuss] ovs-dpdk:cannot link with dpdk
Message-ID: <135cc283.10816.150a89ffcaa.Coremail.wangrongs163@163.com>

Mr Dear:
    I am using ovs on DPDK platform,and encountered the following issue:  "configure: error: cannot link with dpdk".
Bellows are the details of the commands.
    Here are my files-list:
[root at root /home/wangrong]#ls
dpdk-2.1.0  iperf-2.0.2  openvswitch-2.4.0  ovs-2.4.0  pcap  tar-gz  test


(1)Make DPDK
export DPDK_DIR=/home/wangrong/dpdk-2.1.0

cd $DPDK_DIR
vim config/common_linuxapp <修改之后编译成单个lib大文件，支持vhost>
    CONFIG_RTE_BUILD_COMBINE_LIBS=y
    CONFIG_RTE_LIBRTE_VHOST=y
    CONFIG_RTE_LIBRTE_VHOST_USER=n

make install T=x86_64-native-linuxapp-gcc //若提示fuse头文件错误，解决方法见附1.
export RTE_SDK=/home/wangrong/dpdk-2.1.0
export RTE_TARGET=x86_64-native-linuxapp-gcc
export EXTRA_CFLAGS="-O0 -g"
cd $DPDK_DIR/lib/librte_vhost/eventfd_link <为了支持vhost，需要编译该内核模块>
make
(2)Make OVS
export OVS_DIR=/home/wangrong/ovs-2.4.0
export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc
cd $OVS_DIR
./boot.sh
./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align" <编译OVS的时候指定加入DPDK> 


Here comes the ERROR:configure: error: cannot link with dpdk
        This error confuses me and I come to for help.
Thanks a lot.
  Sincerely youres WangRong









-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/7041fc0f/attachment-0001.html>

From ciara.loftus at intel.com  Tue Oct 27 08:30:38 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Tue, 27 Oct 2015 15:30:38 +0000
Subject: [ovs-discuss] ovs-dpdk:cannot link with dpdk
In-Reply-To: <135cc283.10816.150a89ffcaa.Coremail.wangrongs163@163.com>
References: <135cc283.10816.150a89ffcaa.Coremail.wangrongs163@163.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC24F7B150A@IRSMSX106.ger.corp.intel.com>

> 
> Mr Dear:
>     I am using ovs on DPDK platform,and encountered the following
> issue:  "configure: error: cannot link with dpdk".
> Bellows are the details of the commands.
>     Here are my files-list:
> [root at root /home/wangrong]#ls
> dpdk-2.1.0  iperf-2.0.2  openvswitch-2.4.0  ovs-2.4.0  pcap  tar-gz  test
> 
> (1)Make DPDK
> export DPDK_DIR=/home/wangrong/dpdk-2.1.0
> 
> cd $DPDK_DIR
> vim config/common_linuxapp <修改之后编译成单个lib大文件，支持
> vhost>
>     CONFIG_RTE_BUILD_COMBINE_LIBS=y
>     CONFIG_RTE_LIBRTE_VHOST=y
>     CONFIG_RTE_LIBRTE_VHOST_USER=n
> 
> make install T=x86_64-native-linuxapp-gcc //若提示fuse头文件错误，解
> 决方法见附1.
> export RTE_SDK=/home/wangrong/dpdk-2.1.0
> export RTE_TARGET=x86_64-native-linuxapp-gcc
> export EXTRA_CFLAGS="-O0 -g"
> cd $DPDK_DIR/lib/librte_vhost/eventfd_link <为了支持vhost，需要编译
> 该内核模块>
> make
> (2)Make OVS
> export OVS_DIR=/home/wangrong/ovs-2.4.0
> export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc
> cd $OVS_DIR
> ./boot.sh
> ./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align" <
> 编译OVS的时候指定加入DPDK>

Hi,

If using OVS v2.4 please ensure that --with-dpdk=/home/wangrong/dpdk-2.1.0/x86_64-native-linuxapp-gcc
Do not use a relative path. Or else if using a relative path, you need to apply this patch https://patchwork.ozlabs.org/patch/518491/

If including additional CFLAGS, you can follow this format:
./configure --with-dpdk=/home/wangrong/dpdk-2.1.0/x86_64-native-linuxapp-gcc 'CFLAGS=-g -O2 -Wno-cast-align'

Ciara

> 
> Here comes the ERROR:configure: error: cannot link with dpdk
>         This error confuses me and I come to for help.
> Thanks a lot.
>   Sincerely youres WangRong
> 
> 
> 
> 
> 
> 
> 

From kevin.traynor at intel.com  Tue Oct 27 08:41:18 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 27 Oct 2015 15:41:18 +0000
Subject: [ovs-discuss] ovs-dpdk:cannot link with dpdk
In-Reply-To: <74F120C019F4A64C9B78E802F6AD4CC24F7B150A@IRSMSX106.ger.corp.intel.com>
References: <135cc283.10816.150a89ffcaa.Coremail.wangrongs163@163.com>
 <74F120C019F4A64C9B78E802F6AD4CC24F7B150A@IRSMSX106.ger.corp.intel.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7452AED8D@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Loftus,
> Ciara
> Sent: Tuesday, October 27, 2015 3:31 PM
> To: wangrongs163; discuss at openvswitch.org
> Subject: Re: [ovs-discuss] ovs-dpdk:cannot link with dpdk
> 
> >
> > Mr Dear:
> >     I am using ovs on DPDK platform,and encountered the following
> > issue:  "configure: error: cannot link with dpdk".
> > Bellows are the details of the commands.
> >     Here are my files-list:
> > [root at root /home/wangrong]#ls
> > dpdk-2.1.0  iperf-2.0.2  openvswitch-2.4.0  ovs-2.4.0  pcap  tar-gz  test

OVS 2.4 supports DPDK 2.0 - see the INSTALL.DPDK.md in the package. 

On the master branch OVS supports DPDK 2.1. You could try applying
the patch that adds DPDK 2.1 support to OVS if you really want to try
this combination.
http://openvswitch.org/pipermail/dev/2015-September/059616.html


> >
> > (1)Make DPDK
> > export DPDK_DIR=/home/wangrong/dpdk-2.1.0
> >
> > cd $DPDK_DIR
> > vim config/common_linuxapp <修改之后编译成单个lib大文件，支持
> > vhost>
> >     CONFIG_RTE_BUILD_COMBINE_LIBS=y
> >     CONFIG_RTE_LIBRTE_VHOST=y
> >     CONFIG_RTE_LIBRTE_VHOST_USER=n
> >
> > make install T=x86_64-native-linuxapp-gcc //若提示fuse头文件错误，解
> > 决方法见附1.
> > export RTE_SDK=/home/wangrong/dpdk-2.1.0
> > export RTE_TARGET=x86_64-native-linuxapp-gcc
> > export EXTRA_CFLAGS="-O0 -g"
> > cd $DPDK_DIR/lib/librte_vhost/eventfd_link <为了支持vhost，需要编译
> > 该内核模块>
> > make
> > (2)Make OVS
> > export OVS_DIR=/home/wangrong/ovs-2.4.0
> > export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc
> > cd $OVS_DIR
> > ./boot.sh
> > ./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align" <
> > 编译OVS的时候指定加入DPDK>
> 
> Hi,
> 
> If using OVS v2.4 please ensure that --with-dpdk=/home/wangrong/dpdk-
> 2.1.0/x86_64-native-linuxapp-gcc
> Do not use a relative path. Or else if using a relative path, you need to
> apply this patch https://patchwork.ozlabs.org/patch/518491/
> 
> If including additional CFLAGS, you can follow this format:
> ./configure --with-dpdk=/home/wangrong/dpdk-2.1.0/x86_64-native-linuxapp-gcc
> 'CFLAGS=-g -O2 -Wno-cast-align'
> 
> Ciara
> 
> >
> > Here comes the ERROR:configure: error: cannot link with dpdk
> >         This error confuses me and I come to for help.
> > Thanks a lot.
> >   Sincerely youres WangRong
> >
> >
> >
> >
> >
> >
> >
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From gmussar at ciena.com  Tue Oct 27 10:01:42 2015
From: gmussar at ciena.com (Mussar, Gary)
Date: Tue, 27 Oct 2015 13:01:42 -0400
Subject: [ovs-discuss] ovs-dpdk:cannot link with dpdk
In-Reply-To: <135cc283.10816.150a89ffcaa.Coremail.wangrongs163@163.com>
References: <135cc283.10816.150a89ffcaa.Coremail.wangrongs163@163.com>
Message-ID: <C281A17C31CFD745B242416D0E96EC63943D2B6E@ONWVEXCHMB04.ciena.com>

The name of the dpdk library changed between dpsk-2.0.0 and dpdk-2.1.0. Ovs-2.4 builds against dpdk-2.0.0. You will need some patches to allow it to build against dpdk-2.1.0.

Gary

From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of wangrongs163
Sent: Tuesday, October 27, 2015 05:28
To: discuss at openvswitch.org
Subject: [ovs-discuss] ovs-dpdk:cannot link with dpdk

Mr Dear:
    I am using ovs on DPDK platform,and encountered the following issue:  "configure: error: cannot link with dpdk".
Bellows are the details of the commands.
    Here are my files-list:
[root at root /home/wangrong]#ls
dpdk-2.1.0  iperf-2.0.2  openvswitch-2.4.0  ovs-2.4.0  pcap  tar-gz  test

(1)Make DPDK

export DPDK_DIR=/home/wangrong/dpdk-2.1.0


cd $DPDK_DIR

vim config/common_linuxapp <修改之后编译成单个lib大文件，支持vhost>

    CONFIG_RTE_BUILD_COMBINE_LIBS=y

    CONFIG_RTE_LIBRTE_VHOST=y

    CONFIG_RTE_LIBRTE_VHOST_USER=n



make install T=x86_64-native-linuxapp-gcc //若提示fuse头文件错误，解决方法见附1.

export RTE_SDK=/home/wangrong/dpdk-2.1.0

export RTE_TARGET=x86_64-native-linuxapp-gcc

export EXTRA_CFLAGS="-O0 -g"

cd $DPDK_DIR/lib/librte_vhost/eventfd_link <为了支持vhost，需要编译该内核模块>

make

(2)Make OVS

export OVS_DIR=/home/wangrong/ovs-2.4.0

export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc

cd $OVS_DIR

./boot.sh

./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align" <编译OVS的时候指定加入DPDK>



Here comes the ERROR:configure: error: cannot link with dpdk
        This error confuses me and I come to for help.
Thanks a lot.
  Sincerely youres WangRong













-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/61a230a2/attachment-0001.html>

From sugesh.chandran at intel.com  Tue Oct 27 10:28:58 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Tue, 27 Oct 2015 17:28:58 +0000
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
In-Reply-To: <CADCo8KC1S0FiZmWQCD_zaH5RYtX_SQBJu8vgr3b2_14vysyxOQ@mail.gmail.com>
References: <CADCo8KC1S0FiZmWQCD_zaH5RYtX_SQBJu8vgr3b2_14vysyxOQ@mail.gmail.com>
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB13CCE65D@IRSMSX102.ger.corp.intel.com>



Regards
_Sugesh

From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Praveen MANKARA RADHAKRISHNAN
Sent: Monday, October 26, 2015 5:23 PM
To: bugs at openvswitch.org
Cc: Daniel Virassamy
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)

HI,

I am Praveen,

I am trying a specific test scenario using ovs-dpdk.

Test set up
-------------------

from the traffgen vlan packets are coming to dpdk interface its stripped using ovs command.
and sending to a vxlan interface which is comnnected in theo other dpdk interface and send back to traffgen.

i have done the vxlan set up similar to the sample test case.

https://github.com/openvswitch/ovs/blob/master/README-native-tunneling.md

the issue is that from the sumpflows i can see that packets are send to vxlan but it is not going to the other bridge.

the same scenario is working without dpdk.

I am using openvswitch-2.4.0.

Linux (without dpdk)
---------------------------------

ovs-vsctl add-br br0
ovs-vsctl add-port br0 eth0
ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan options:remote_ip=10.200.0.6
ovs-ofctl add-flow br0 dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2

ovs-vsctl add-br br1
ovs-vsctl add-port br1 eth1

 ip a a 10.200.0.5/24<http://10.200.0.5/24> dev br1
arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2

and from the traffgen i am sending traffic with dst mac 02:11:22:44:55:22 and vlan id 1.
it is correctly working.

ovs-dpdk
------------------

started ovs-dpdk ::
ovs-vswitchd --dpdk -c 0x1 -n 4 -- unix:$DB_SOCK --pidfile --detach

ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk

ovs-vsctl add-br br1 -- set bridge br1 datapath_type=netdev
ovs-vsctl add-port br1 dpdk1 -- set Interface dpdk1 type=dpdk

ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan options:remote_ip=10.200.0.6
ovs-ofctl add-flow br0 dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2

 ip a a 10.200.0.5/24<http://10.200.0.5/24> dev br1
arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2


here i have started the ovs-dpddk and do the same set up
but packets are not seen in bridge1 (br1) and in traffgen.

is there any specif configuration i need to do in ovs-dpdk
could it be because of the arp?
Is there a way to set static arp to the ovs-dpdk?
>>>> Does the arp entries shown properly in “ovs-appctl tnl/arp/show”???
>>>>> You can set the arp entries using ovs-appctl tnl/arp/set <bridge> <ip> <mac>. In OVS-DPDK the DPDK interfaces are not managed by kernel so assigning static arp to physical interface may not work.
Could you help in identifying the problem?

Thanking you in advance
Praveen



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/1a212986/attachment.html>

From manojkumar.sure at gmail.com  Tue Oct 27 12:10:45 2015
From: manojkumar.sure at gmail.com (Manojkumar Sure)
Date: Wed, 28 Oct 2015 00:40:45 +0530
Subject: [ovs-discuss] Get the instantaneous queue length in OVS
Message-ID: <CAC+zmpO5ZsASD9_xE+5efxcOeguk_NpAnALWxn21-2sPqvM8KQ@mail.gmail.com>

Hi,
  Is there a way to get the instantaneous queue length(may be for every 100
ms) of the switch. If it is not possible with the kernel based switch, is
it possible to get the queue length somehow if we run the OVS switch as
user space switch?

Thanks,
-- 
Regards,
Manoj Kumar Sure,
Senior Undergraduate,
IIT Madras.
ᐧ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151028/ebc5965c/attachment.html>

From manojkumar.sure at gmail.com  Tue Oct 27 12:16:19 2015
From: manojkumar.sure at gmail.com (Manojkumar Sure)
Date: Wed, 28 Oct 2015 00:46:19 +0530
Subject: [ovs-discuss] Active Queue Management Schemes in OVS
Message-ID: <CAC+zmpNjQJBp-UO1L741xjkUdARnRnp-38yCD0M09xOY3+Qdfw@mail.gmail.com>

Hi,
  Does OVS support Active Queue Management congestion control schemes like
RED, BLUE,DECbit etc.? If yes, how do I enable them?

Thanks,

-- 
Regards,
Manoj Kumar Sure,
Senior Undergraduate,
IIT Madras.
ᐧ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151028/e549f19a/attachment.html>

From muralirdev at gmail.com  Tue Oct 27 19:34:50 2015
From: muralirdev at gmail.com (Murali R)
Date: Tue, 27 Oct 2015 19:34:50 -0700
Subject: [ovs-discuss] [ovs-discus][ovn] tunneling ip
Message-ID: <CAO=R8onpj124cMOcOKF2O7QzP2q87VuQT2m5jNfJk6p0dag1Pw@mail.gmail.com>

Ovn always uses IP used as remote IP to reference remote db (from remote
nodes) for tunnels to master controller. Is this by design? Shouldn't we
able to have these two different?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151027/35a302b6/attachment.html>

From V_Dham at Dell.com  Tue Oct 27 20:18:02 2015
From: V_Dham at Dell.com (V_Dham at Dell.com)
Date: Tue, 27 Oct 2015 22:18:02 -0500
Subject: [ovs-discuss] [ovs-discus][ovn] tunneling ip
In-Reply-To: <CAO=R8onpj124cMOcOKF2O7QzP2q87VuQT2m5jNfJk6p0dag1Pw@mail.gmail.com>
References: <CAO=R8onpj124cMOcOKF2O7QzP2q87VuQT2m5jNfJk6p0dag1Pw@mail.gmail.com>
Message-ID: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060F0@AUSX7MCPC107.AMER.DELL.COM>

Have you tried using ovs-vsctl --no-wait set open_vswitch . external-ids:ovn-encap-ip="$HOST_IP" on master controller, "HOST_IP" being ip of interface where you would like to have tunnel llistener? Controller would send this IP info to compute nodes for establishing tunnels.
________________________________________
From: discuss [discuss-bounces at openvswitch.org] On Behalf Of Murali R [muralirdev at gmail.com]
Sent: Tuesday, October 27, 2015 7:34 PM
To: discuss
Subject: [ovs-discuss] [ovs-discus][ovn] tunneling ip

Ovn always uses IP used as remote IP to reference remote db (from remote nodes) for tunnels to master controller. Is this by design? Shouldn't we able to have these two different?

From sugesh.chandran at intel.com  Wed Oct 28 03:39:47 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Wed, 28 Oct 2015 10:39:47 +0000
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
In-Reply-To: <CADCo8KDVdH_Rg_k_NwjyRc1sXxzxw9mOD6h4NkX5vw+1SkF7WQ@mail.gmail.com>
References: <CADCo8KC1S0FiZmWQCD_zaH5RYtX_SQBJu8vgr3b2_14vysyxOQ@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCE65D@IRSMSX102.ger.corp.intel.com>
 <CADCo8KDVdH_Rg_k_NwjyRc1sXxzxw9mOD6h4NkX5vw+1SkF7WQ@mail.gmail.com>
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB13CCE8CD@IRSMSX102.ger.corp.intel.com>

Hi Praveen,

The arp entries are learned properly, if the packets are reaching at br1.
Can you please confirm what flow rules are populated on br1 using ,
                ovs-ofctl dump-flows br1

If there is no rules present, please add a rule to forward packet to the physical port as follows,
ovs-ofctl add-flow br1 idle_timeout=0,in_port=LOCAL,action=output:1


Regards
_Sugesh

From: Praveen MANKARA RADHAKRISHNAN [mailto:praveen.mankara at 6wind.com]
Sent: Wednesday, October 28, 2015 10:05 AM
To: Chandran, Sugesh
Cc: bugs at openvswitch.org; Daniel Virassamy
Subject: Re: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)

Hi Sugesh,

Thanks for the reply.
arp entries are show in vs-appctl tnl/arp/show command. but it seems o packet is coming to the bridge with physical port.

I have already tried to set using tnl/arp/set command but it seems set is not present in openvswitch 2.4
it returns the following error.

"
ovs-appctl tnl/arp/set br0 10.200.0.6 02:11:22:44:55:11
"tnl/arp/set" is not a valid command
ovs-appctl: ovs-vswitchd: server returned an error "

One important thing is to note that i was using dpdk-2.0.0. does that make any difference?

Thanks
Praveen

On Tue, Oct 27, 2015 at 6:28 PM, Chandran, Sugesh <sugesh.chandran at intel.com<mailto:sugesh.chandran at intel.com>> wrote:


Regards
_Sugesh

From: discuss [mailto:discuss-bounces at openvswitch.org<mailto:discuss-bounces at openvswitch.org>] On Behalf Of Praveen MANKARA RADHAKRISHNAN
Sent: Monday, October 26, 2015 5:23 PM
To: bugs at openvswitch.org<mailto:bugs at openvswitch.org>
Cc: Daniel Virassamy
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)

HI,

I am Praveen,

I am trying a specific test scenario using ovs-dpdk.

Test set up
-------------------

from the traffgen vlan packets are coming to dpdk interface its stripped using ovs command.
and sending to a vxlan interface which is comnnected in theo other dpdk interface and send back to traffgen.

i have done the vxlan set up similar to the sample test case.

https://github.com/openvswitch/ovs/blob/master/README-native-tunneling.md

the issue is that from the sumpflows i can see that packets are send to vxlan but it is not going to the other bridge.

the same scenario is working without dpdk.

I am using openvswitch-2.4.0.

Linux (without dpdk)
---------------------------------

ovs-vsctl add-br br0
ovs-vsctl add-port br0 eth0
ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan options:remote_ip=10.200.0.6
ovs-ofctl add-flow br0 dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2

ovs-vsctl add-br br1
ovs-vsctl add-port br1 eth1

 ip a a 10.200.0.5/24<http://10.200.0.5/24> dev br1
arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2

and from the traffgen i am sending traffic with dst mac 02:11:22:44:55:22 and vlan id 1.
it is correctly working.

ovs-dpdk
------------------

started ovs-dpdk ::
ovs-vswitchd --dpdk -c 0x1 -n 4 -- unix:$DB_SOCK --pidfile --detach

ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk

ovs-vsctl add-br br1 -- set bridge br1 datapath_type=netdev
ovs-vsctl add-port br1 dpdk1 -- set Interface dpdk1 type=dpdk

ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan options:remote_ip=10.200.0.6
ovs-ofctl add-flow br0 dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2

 ip a a 10.200.0.5/24<http://10.200.0.5/24> dev br1
arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2


here i have started the ovs-dpddk and do the same set up
but packets are not seen in bridge1 (br1) and in traffgen.

is there any specif configuration i need to do in ovs-dpdk
could it be because of the arp?
Is there a way to set static arp to the ovs-dpdk?
>>>> Does the arp entries shown properly in “ovs-appctl tnl/arp/show”???
>>>>> You can set the arp entries using ovs-appctl tnl/arp/set <bridge> <ip> <mac>. In OVS-DPDK the DPDK interfaces are not managed by kernel so assigning static arp to physical interface may not work.
Could you help in identifying the problem?

Thanking you in advance
Praveen




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151028/a2321a67/attachment-0001.html>

From sugesh.chandran at intel.com  Wed Oct 28 03:49:58 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Wed, 28 Oct 2015 10:49:58 +0000
Subject: [ovs-discuss] [openvswitch.github.io] Detailed documentation
 for configuring native userspace-tunneling in OVS. (#23)
In-Reply-To: <openvswitch/openvswitch.github.io/pull/23/c150350920@github.com>
References: <openvswitch/openvswitch.github.io/pull/23@github.com>
 <openvswitch/openvswitch.github.io/pull/23/c150350920@github.com>
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB13CCE900@IRSMSX102.ger.corp.intel.com>

Hi Daniele,
I have incorporated all the comments and created a new pull request as below,
https://github.com/openvswitch/openvswitch.github.io/pull/24

Can you please have a look on this new request and let me know your comments if any.


Regards
_Sugesh

From: ddiproietto [mailto:notifications at github.com]
Sent: Thursday, October 22, 2015 9:44 PM
To: openvswitch/openvswitch.github.io
Cc: Chandran, Sugesh
Subject: Re: [openvswitch.github.io] Detailed documentation for configuring native userspace-tunneling in OVS. (#23)


Thanks for doing this!

This appears to add the guide to the website, but the page doesn't match the style of the rest of the site (it is rendered as simple text). These commits (e7f7d78<https://github.com/openvswitch/openvswitch.github.io/commit/e7f7d78cb558499b4fdd1359da97b8be0019772a> and a8e6f64<https://github.com/openvswitch/openvswitch.github.io/commit/a8e6f6491cc4e6d928a010a8946926213b68942e>) should make more clear how to add an entry to the website. Some comments:

  *   I would rename support/config-cookbooks/userspace-tunneling/README-native-tunneling-DPDK.md to support/config-cookbooks/userspace-tunneling/index.md
  *   The page needs to have an header to be rendered correctly. Something like:

---

layout: page

status: publish

published: true

title: Openvswitch Native tunneling configuration guide

author: sugchand

date: 2015-10-22

categories:

- Uncategorized

tags: []

comments: []

---

  *   A link to the page should be placed in the navbar, by editing _data/nav.yml
  *   The markdown is not rendered correctly (the commands are in bold instead of monospace, the ordered list items are not numbered properly). Github has a good cheatsheet that explains their markdown syntax https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet
  *   I would remove sudo from the commands. The other configuration cookbooks do not have it.

_BUILD<../blob/master/_BUILD> explains how to test your modifications.

Would you mind fixing it and submitting another pull request? Again, thank you for this contribution!

—
Reply to this email directly or view it on GitHub<https://github.com/openvswitch/openvswitch.github.io/pull/23#issuecomment-150350920>.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151028/a0a2038e/attachment-0001.html>

From ciara.loftus at intel.com  Wed Oct 28 04:38:31 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Wed, 28 Oct 2015 11:38:31 +0000
Subject: [ovs-discuss] ovs-vswitchd SEGV when using vhost-user feature
 with dpdk
In-Reply-To: <CAF2CpCm8yWE4Y4DM7UmjZsNWyhAVBcbgGXB+i3U2jWPdiF2_OQ@mail.gmail.com>
References: <CAF2CpC=89Yu3Lub2tsAO7s2pWxS3nhXobi+8c2t_rQVNRY4oDg@mail.gmail.com>
 <74F120C019F4A64C9B78E802F6AD4CC24CBAFF76@IRSMSX106.ger.corp.intel.com>
 <CAF2CpCn_nGxyDj-xU3QwJvajWu5-_1+0DFF1G+SbTMHw8Kti7A@mail.gmail.com>
 <74F120C019F4A64C9B78E802F6AD4CC24F7949A9@IRSMSX102.ger.corp.intel.com>
 <CAF2CpCm8yWE4Y4DM7UmjZsNWyhAVBcbgGXB+i3U2jWPdiF2_OQ@mail.gmail.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC24F7B19AB@IRSMSX106.ger.corp.intel.com>

> 
> Thanks for the response. I switched to QEMU - 2.2.0. No SEGV this time
> around. But even with -m 4096, I get a lot of these messages and the VM
> throws a kernel trace - like I reported on my first message.

Sorry for the delay in response. Some things to try to overcome your issue with v2.2.0:
- Increase the number of hugepages you allocate at boot:
Eg. default_hugepagesz=1G hugepagesz=1G hugepages=16
- Increase the ovs-vswitchd socket-mem:
Eg. --socket-mem 2048,0
- Once again, try allocating more mem to QEMU
Eg. -m 4096M

These are the figures I would typically use so hopefully they work for you too.

Thanks,
Ciara

> 
> Oct 12 10:43:49 localhost.localdomain ovs-vswitchd[29441]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Oct 12 10:43:49 localhost.localdomain ovs-vswitchd[29441]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Oct 12 10:43:49 localhost.localdomain ovs-vswitchd[29441]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Oct 12 10:43:49 localhost.localdomain ovs-vswitchd[29441]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Oct 12 10:43:49 localhost.localdomain ovs-vswitchd[29441]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Oct 12 10:43:49 localhost.localdomain ovs-vswitchd[29441]: VHOST_DATA:
> Failed to allocate memory for mbuf.
> Oct 12 10:43:49 localhost.localdomain ovs-vswitchd[29441]: VHOST_CONFIG:
> read message VHOST_USER_SET_VRING_CALL
> Oct 12 10:43:49 localhost.localdomain ovs-vswitchd[29441]: VHOST_CONFIG:
> vring call idx:0 file:111
>                                                            VHOST_DATA: Failed to allocate memory for
> mbuf.
> 
> 
> On Mon, Oct 12, 2015 at 3:49 AM, Loftus, Ciara <ciara.loftus at intel.com>
> wrote:
> >
> > Increasing qemu to -m 4096, causes an immediate ovs-vswitchd SEGV
> >
> > [Thread debugging using libthread_db enabled]
> > Using host libthread_db library "/lib64/libthread_db.so.1".
> > Core was generated by `/root/openvswitch/openvswitch-
> > 2.4.0/vswitchd/ovs-vswitchd --dpdk -c 0xffff -n 4'.
> > Program terminated with signal 11, Segmentation fault.
> > #0  0x00007fca43ed6f2c in set_vring_addr () from /lib64/libdpdk.so
> > (gdb) where
> > #0  0x00007fca43ed6f2c in set_vring_addr () from /lib64/libdpdk.so
> > #1  0x00007fca43f90d2e in vserver_message_handler () from
> > /lib64/libdpdk.so
> > #2  0x00007fca43f3ad7d in fdset_event_dispatch () from /lib64/libdpdk.so
> > #3  0x00007fca43f91330 in rte_vhost_driver_session_start () from
> > /lib64/libdpdk.so
> > #4  0x000000000056efbf in start_vhost_loop (dummy=0x0) at lib/netdev-
> > dpdk.c:1789
> > #5  0x00000000004f60f3 in ovsthread_wrapper (aux_=0x25248a0) at
> lib/ovs-
> > thread.c:340
> > #6  0x00007fca43a1edf5 in start_thread (arg=0x7fca3c13d700) at
> > pthread_create.c:308
> > #7  0x00007fca432421ad in clone () at
> > ../sysdeps/unix/sysv/linux/x86_64/clone.S:113
> > (gdb)
> >
> >
> 
> I can reproduce a segfault when using QEMU v2.4.0+ like you mentioned you
> are. It looks like something has gone in between v2.3.0 and v2.4.0 in QEMU
> that is causing this issue.
> Can you please try your test with the QEMU version we recommend to use in
> INSTALL.DPDK which is v2.2.0.
> 
> Thanks,
> Ciara
> 
> >
> >
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00021|dpdk|INFO|Port 0: a0:36:9f:5a:cb:1c
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00007|dpif_netdev(pmd16)|INFO|Core 0 processing port 'vhost-
> user1'
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00008|dpif_netdev(pmd16)|INFO|Core 0 processing port 'dpdk0'
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00009|dpif_netdev(pmd16)|INFO|Core 0 processing port 'dpdk1'
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00010|dpif_netdev(pmd16)|INFO|Core 0 processing port 'vhost-
> user2'
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00022|bridge|INFO|bridge br0: added interface dpdk0 on port 2
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00023|bridge|INFO|bridge br0: using datapath ID 0000a0369f5acb1c
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00024|connmgr|INFO|br0: added service controller
> > "punix:/usr/local/var/run/openvswitch/br0.mgmt"
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00025|dpif_netdev|INFO|Created 1 pmd threads on numa node 0
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00026|timeval|WARN|Unreasonably long 2481ms poll interval
> (1726ms
> > user, 2ms system)
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00027|timeval|WARN|faults: 2032 minor, 0 major
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00028|timeval|WARN|disk: 0 reads, 8 writes
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00029|timeval|WARN|context switches: 143 voluntary, 426
> involuntary
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00030|coverage|INFO|Event coverage, avg rate over last: 5 seconds,
> > last minute, last hour,  hash=66963b7f:
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00031|coverage|INFO|bridge_reconfigure         0.0/sec     0.000/sec        0.
> > 0000/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00032|coverage|INFO|ofproto_flush              0.0/sec     0.000/sec        0.00
> > 00/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00033|coverage|INFO|ofproto_update_port        0.0/sec     0.000/sec
> > 0.0000/sec   total: 5
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00034|coverage|INFO|rev_flow_table             0.0/sec     0.000/sec        0.00
> > 00/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00035|coverage|INFO|cmap_expand                0.0/sec     0.000/sec        0.0
> > 000/sec   total: 3
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00036|coverage|INFO|cmap_shrink                0.0/sec     0.000/sec        0.000
> > 0/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00037|coverage|INFO|dpif_port_add              0.0/sec     0.000/sec        0.00
> > 00/sec   total: 5
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00038|coverage|INFO|dpif_flow_flush            0.0/sec     0.000/sec        0.00
> > 00/sec   total: 2
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00039|coverage|INFO|dpif_flow_get              0.0/sec     0.000/sec        0.00
> > 00/sec   total: 5
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00040|coverage|INFO|dpif_flow_put              0.0/sec     0.000/sec        0.00
> > 00/sec   total: 5
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00041|coverage|INFO|dpif_flow_del              0.0/sec     0.000/sec        0.00
> > 00/sec   total: 5
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00042|coverage|INFO|dpif_execute               0.0/sec     0.000/sec        0.00
> > 00/sec   total: 2
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00043|coverage|INFO|flow_extract               0.0/sec     0.000/sec        0.000
> > 0/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00044|coverage|INFO|hmap_pathological          0.0/sec     0.000/sec        0.
> > 0000/sec   total: 2
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00001|dpif_netdev(pmd24)|INFO|Core 1 processing port 'vhost-
> user1'
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00045|coverage|INFO|hmap_expand                0.0/sec     0.000/sec        0.0
> > 000/sec   total: 488
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00046|coverage|INFO|netdev_get_stats           0.0/sec     0.000/sec        0.
> > 0000/sec   total: 10
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00002|dpif_netdev(pmd24)|INFO|Core 1 processing port 'dpdk0'
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00047|coverage|INFO|txn_unchanged              0.0/sec     0.000/sec        0.0
> > 000/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00003|dpif_netdev(pmd24)|INFO|Core 1 processing port 'dpdk1'
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00048|coverage|INFO|txn_incomplete             0.0/sec     0.000/sec        0.0
> > 000/sec   total: 2
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00004|dpif_netdev(pmd24)|INFO|Core 1 processing port 'vhost-
> user2'
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00049|coverage|INFO|poll_create_node           0.0/sec     0.000/sec        0.
> > 0000/sec   total: 229
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00050|coverage|INFO|poll_zero_timeout          0.0/sec     0.000/sec        0.
> > 0000/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00051|coverage|INFO|pstream_open               0.0/sec     0.000/sec        0.0
> > 000/sec   total: 3
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00052|coverage|INFO|stream_open                0.0/sec     0.000/sec        0.00
> > 00/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00053|coverage|INFO|util_xalloc                0.0/sec     0.000/sec        0.0000/
> > sec   total: 13886
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00054|coverage|INFO|netdev_set_policing        0.0/sec     0.000/sec        0
> > .0000/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00055|coverage|INFO|netdev_get_ifindex         0.0/sec     0.000/sec        0
> > .0000/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00056|coverage|INFO|netdev_get_hwaddr          0.0/sec     0.000/sec
> > 0.0000/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00057|coverage|INFO|netdev_set_hwaddr          0.0/sec     0.000/sec
> > 0.0000/sec   total: 1
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00058|coverage|INFO|netdev_get_ethtool         0.0/sec     0.000/sec
> > 0.0000/sec   total: 2
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00059|coverage|INFO|netlink_received           0.0/sec     0.000/sec        0.0
> > 000/sec   total: 23
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00060|coverage|INFO|netlink_recv_jumbo         0.0/sec     0.000/sec        0
> > .0000/sec   total: 2
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00061|coverage|INFO|netlink_sent               0.0/sec     0.000/sec        0.000
> > 0/sec   total: 12
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> >
> ovs|00062|coverage|INFO|nln_changed                0.0/sec     0.000/sec        0.00
> > 00/sec   total: 5
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00063|coverage|INFO|67 events never hit
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00064|bridge|INFO|ovs-vswitchd (Open vSwitch) 2.4.0
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00065|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> > pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00066|memory|INFO|8252 kB peak resident set size after 10.5
> seconds
> > Oct 09 15:53:50 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00067|memory|INFO|handlers:8 ports:5 revalidators:4 rules:5
> > Oct 09 15:53:51 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00068|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> > pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> > Oct 09 15:53:51 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00069|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> > pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> > Oct 09 15:53:52 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00070|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> > pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> > Oct 09 15:53:52 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00071|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> > pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> > Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00072|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> > pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> > Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00073|poll_loop|INFO|wakeup due to 0-ms timeout at
> > ofproto/ofproto-dpif.c:1571 (57% CPU usage)
> > Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00074|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> > pipe:[12835268]) at lib/ovs-rcu.c:206 (57% CPU usage)
> > Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00075|poll_loop|INFO|wakeup due to [POLLIN] on fd 79 (<-
> > >/usr/local/var/run/openvswitch/db.sock) at l...PU usage)
> > Oct 09 15:53:53 localhost.localdomain ovs-vswitchd[22045]:
> > ovs|00076|poll_loop|INFO|wakeup due to [POLLIN] on fd 95 (FIFO
> > pipe:[12835268]) at lib/dpif-netdev.c:2592...PU usage)
> > Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > new virtio connection is 110
> > Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > new device, handle is 0
> > Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_OWNER
> > Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_GET_FEATURES
> > Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_VRING_CALL
> > Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > vring call idx:0 file:111
> > Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_VRING_CALL
> > Oct 09 15:54:29 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > vring call idx:1 file:112
> > Oct 09 15:54:29 localhost.localdomain kvm[22204]: 1 guest now active
> > Oct 09 15:54:39 localhost.localdomain kernel: kvm [22199]: vcpu0 disabled
> > perfctr wrmsr: 0xc1 data 0xffff
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_VRING_CALL
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > vring call idx:0 file:113
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_VRING_CALL
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > vring call idx:1 file:111
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_FEATURES
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_MEM_TABLE
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > mapped region 0 fd:112 to 0xffffffffffffffff sz:0xffffab4a9f800000
> > off:0xffffab4a5f800000
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > mmap qemu guest failed.
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_VRING_NUM
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_VRING_BASE
> > Oct 09 15:54:40 localhost.localdomain ovs-vswitchd[22045]:
> VHOST_CONFIG:
> > read message VHOST_USER_SET_VRING_ADDR
> > Oct 09 15:54:40 localhost.localdomain kernel: vhost_thread13[22047]:
> > segfault at 18 ip 00007fbb9ffc5f2c sp 00007fbb9822b670 error 4 in
> > libdpdk.so[7fbb9ff26000+1b3000]
> > Oct 09 15:54:41 localhost.localdomain abrt-hook-ccpp[22244]: Saved core
> > dump of pid 22045 (/root/openvswitch/openvswitch-2.4.0/vswitchd/ovs-
> > vswitchd) to /var/spool/...08 bytes)
> >
> > On Fri, Oct 9, 2015 at 12:07 AM, Loftus, Ciara <ciara.loftus at intel.com>
> wrote:
> > >
> > > I have ran into a ovs-vswitchd SEGV while trying to use the vhost-user
> > > feature with the latest dpdk. I have attempted to provide as much detail
> as
> > I
> > > can.
> > >
> > > versions compiled from source on CentOS 7.1 x86_64:
> > >  - openvswitch 2.4.0 - http://openvswitch.org/releases/openvswitch-
> > > 2.4.0.tar.gz
> > >  - dpdk 2.1.0 - http://dpdk.org/browse/dpdk/snapshot/dpdk-2.1.0.tar.gz
> > >  - qemu - 2.4.0.1 - http://wiki.qemu-project.org/download/qemu-
> > > 2.4.0.1.tar.bz2
> > >
> > >
> > > Steps to reproduce:
> > >
> > > - Build and Install following these instructions
> > > http://wiki.qemu.org/Features/vhost-user-ovs-dpdk
> > > - setup details:
> > >
> > > hugepage config:
> > > GRUB_CMDLINE_LINUX="rd.lvm.lv=centos/root rd.lvm.lv=centos/swap
> > > crashkernel=auto rhgb quiet iommu=pt intel_iommu=on
> > > default_hugepagesz=1G hugepagesz=1G hugepages=8
> > > isolcpus=1,2,3,4,5,12,13,14,15,16,17,7,8,9,10,11,18,19,20,21,22,23
> > > transparent_hugepage=never"
> > >
> > > # export DPDK_DIR=/root/dpdk/dpdk-2.1.0
> > > # export DPDK_BUILD=$DPDK_DIR/x86_64-native-linuxapp-gcc/
> > > # export DB_SOCK=/usr/local/var/run/openvswitch/db.sock
> > >
> > >
> > > # modprobe openvswitch
> > > # modprobe uio
> > > # insmod /root/dpdk/dpdk-2.1.0/x86_64-native-linuxapp-
> > > gcc/kmod/igb_uio.ko
> > > # insmod /root/dpdk/dpdk-
> > > 2.1.0/lib/librte_vhost/eventfd_link/eventfd_link.ko
> > >
> > > # /root/dpdk/dpdk-2.1.0/tools/dpdk_nic_bind.py --bind=igb_uio ens1f0
> > > # /root/dpdk/dpdk-2.1.0/tools/dpdk_nic_bind.py --bind=igb_uio ens1f1
> > >
> > > # /root/openvswitch/openvswitch-2.4.0/ovsdb/ovsdb-server --
> > > remote=punix:/usr/local/var/run/openvswitch/db.sock     --
> > > remote=db:Open_vSwitch,Open_vSwitch,manager_options     --pidfile --
> > > detach
> > >
> > > # rm -f /usr/local/var/run/openvswitch/vhost-user*
> > >
> > > # /root/openvswitch/openvswitch-2.4.0/vswitchd/ovs-vswitchd --dpdk -
> c
> > > 0xffff -n 4 --socket-mem 1024 -- unix:$DB_SOCK --pidfile --detach --log-
> > > file=/var/log/openvswitch/ovs-vswitchd.log
> > >
> > > # lspci | grep Ethernet
> > > 01:00.0 Ethernet controller: Intel Corporation Ethernet Controller 10-
> Gigabit
> > > X540-AT2 (rev 01)
> > > 01:00.1 Ethernet controller: Intel Corporation Ethernet Controller 10-
> Gigabit
> > > X540-AT2 (rev 01)
> > >
> > > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-br br0 --
> set
> > > bridge br0 datapath_type=netdev
> > > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> > > dpdk0 -- set Interface dpdk0 type=dpdk
> > > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> > > dpdk1 -- set Interface dpdk1 type=dpdk
> > > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> > > vhost-user2 -- set Interface vhost-user2 type=dpdkvhostuser
> > > # /root/openvswitch/openvswitch-2.4.0/utilities/ovs-vsctl add-port br0
> > > vhost-user1 -- set Interface vhost-user1 type=dpdkvhostuser
> > >
> > > - Start the first VM like this:
> > > ./qemu-system-x86_64 -enable-kvm -m 1024 -smp 2 \
> >
> > My first suggestion would be to try supplying your VM with more memory.
> > ie. instead of "-m 1024", try "-m 4096"
> >
> > Thanks,
> > Ciara
> >
> > >  -display sdl \
> > >  -sdl \
> > >  -chardev socket,id=char0,path=/usr/local/var/run/openvswitch/vhost-
> > user1
> > > \
> > >  -netdev type=vhost-user,id=mynet1,chardev=char0,vhostforce  \
> > >  -device virtio-net-pci,netdev=mynet1,mac=52:54:00:02:d9:01 \
> > >  -object memory-backend-file,id=mem,size=1024M,mem-
> > > path=/dev/hugepages,share=on \
> > >  -numa node,memdev=mem -mem-prealloc \
> > >  -net user,hostfwd=tcp::10021-:22 \
> > >  -net nic  \
> > >  /var/lib/libvirt/images/centos-vm1.qcow2  &
> > >
> > > - From another machine send iperf traffic to this VM.
> > >   iperf -s (in the VM)
> > >   iperf -c <ipaddr> -t 60 -P 12 (from another machine)
> > >
> > > - After about a few seconds, iperf stalls. network connectivity breaks.
> Can't
> > > ping the VM anymore.
> > > - Saw these in the ovs-vswitchd log files.
> > >
> > > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > > Failed to allocate memory for mbuf.
> > > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > > Failed to allocate memory for mbuf.
> > > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > > Failed to allocate memory for mbuf.
> > > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > > Failed to allocate memory for mbuf.
> > > Sep 29 17:51:08 localhost.localdomain ovs-vswitchd[6483]: VHOST_DATA:
> > > Failed to allocate memory for mbuf.
> > >
> > > - shutdown iperf ... then shutdown the VM.
> > > - at this point ovs-vswitchd crashes with the following SEGV.
> > >
> > > [root at localhost vswitchd]# gdb ./ovs-vswitchd /var/spool/abrt/ccpp-
> 2015-
> > > 09-29-18\:47\:37-22012/coredump
> > > GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-64.el7
> > > Copyright (C) 2013 Free Software Foundation, Inc.
> > > License GPLv3+: GNU GPL version 3 or later
> > > <http://gnu.org/licenses/gpl.html>
> > > This is free software: you are free to change and redistribute it.
> > > There is NO WARRANTY, to the extent permitted by law.  Type "show
> > > copying"
> > > and "show warranty" for details.
> > > This GDB was configured as "x86_64-redhat-linux-gnu".
> > > For bug reporting instructions, please see:
> > > <http://www.gnu.org/software/gdb/bugs/>...
> > > Reading symbols from /root/openvswitch/openvswitch-
> > 2.4.0/vswitchd/ovs-
> > > vswitchd...done.
> > > [New LWP 22051]
> > > [New LWP 22012]
> > > [New LWP 22013]
> > > [New LWP 22015]
> > > [New LWP 22039]
> > > [New LWP 22040]
> > > [New LWP 22041]
> > > [New LWP 22042]
> > > [New LWP 22043]
> > > [New LWP 22044]
> > > [New LWP 22045]
> > > [New LWP 22046]
> > > [New LWP 22047]
> > > [New LWP 22048]
> > > [New LWP 22049]
> > > [New LWP 22050]
> > > [New LWP 22014]
> > > [Thread debugging using libthread_db enabled]
> > > Using host libthread_db library "/lib64/libthread_db.so.1".
> > > Core was generated by `/root/openvswitch/openvswitch-
> > > 2.4.0/vswitchd/ovs-vswitchd --dpdk -c 0xffff -n 4'.
> > > Program terminated with signal 11, Segmentation fault.
> > > #0  0x00007eff4d71df1f in rte_vhost_dequeue_burst () from
> > > /lib64/libdpdk.so
> > > Missing separate debuginfos, use: debuginfo-install glibc-2.17-
> > 78.el7.x86_64
> > > (gdb) where
> > > #0  0x00007eff4d71df1f in rte_vhost_dequeue_burst () from
> > > /lib64/libdpdk.so
> > > #1  0x000000000056d103 in netdev_dpdk_vhost_rxq_recv
> > > (rxq_=0x7efe5a537600, packets=0x7eff4c9a2930, c=0x7eff4c9a292c)
> > >     at lib/netdev-dpdk.c:952
> > > #2  0x00000000004a2dec in netdev_rxq_recv (rx=0x7efe5a537600,
> > > buffers=0x7eff4c9a2930, cnt=0x7eff4c9a292c)
> > >     at lib/netdev.c:652
> > > #3  0x0000000000478f33 in dp_netdev_process_rxq_port
> (pmd=0x231c310,
> > > port=0x2166990, rxq=0x7efe5a537600)
> > >     at lib/dpif-netdev.c:2520
> > > #4  0x0000000000479648 in pmd_thread_main (f_=0x231c310) at lib/dpif-
> > > netdev.c:2680
> > > #5  0x00000000004f60f3 in ovsthread_wrapper (aux_=0x231c150) at
> lib/ovs-
> > > thread.c:340
> > > #6  0x00007eff4d276df5 in start_thread () from /lib64/libpthread.so.0
> > > #7  0x00007eff4ca9a1ad in clone () from /lib64/libc.so.6


From gstenzel at linux.vnet.ibm.com  Wed Oct 28 06:56:35 2015
From: gstenzel at linux.vnet.ibm.com (Gerhard Stenzel)
Date: Wed, 28 Oct 2015 14:56:35 +0100
Subject: [ovs-discuss] [openvswitch 2.3.2] testsuite: 717 fails on s390x
Message-ID: <5630D413.10904@linux.vnet.ibm.com>

Hello All,

Test case 717 fails on s390x:

717. ofproto-dpif.at:203: 717. ofproto-dpif, balance-tcp bonding,
different recirc flow  (ofproto-dpif.at:203): FAILED (ofproto-dpif.at:253)

The test case was introduced by 4ec2ffe905e266ed27c16294668b8162ec5f29dc
into the 2.3 branch and is also in the 2.4 branch with ID
f9038ef61e0bf89bcd753b7cfd187adb112601ec.

In the 2.4 branch there is also a patch with ID
8ae8176fd0d8ed919e3301cc961dcf02b65ff49d which appears to fix the
failing test case for the 2.4 branch.

With a backported version of this 2.4 patch test case 717 passes most of 
the times but not always.

I would appreciate some feedback if the backported patch is correct ...

Thanks in advance,

Gerhard Stenzel

#####################################



diff --git a/tests/ofproto-dpif.at b/tests/ofproto-dpif.at
index d350b40..914a692 100644
--- a/tests/ofproto-dpif.at
+++ b/tests/ofproto-dpif.at
@@ -250,8 +250,8 @@ megaflows enabled

  # Checks the flow stats in br1, should only be one flow with non-zero
  # 'n_packets' from internal table.
-AT_CHECK([ovs-appctl bridge/dump-flows br1 | ofctl_strip | grep -- 
"n_packets" | grep -- "table_id" | sed -e 's/output:[[0-9]]\+/output/'], 
[0], [dnl
-table_id=254, n_packets=1, n_bytes=64, 
priority=20,recirc_id=0x12d,dp_hash=0xcf/0xff,actions=output
+AT_CHECK([ovs-appctl bridge/dump-flows br1 | ofctl_strip | grep -- 
"n_packets" | grep -- "table_id" | sed -e 
's/dp_hash=0x[[0-9a-f]]\+/dp_hash=0x0/' -e 
's/output:[[0-9]][[0-9]]*/output/'], [0], [dnl
+table_id=254, n_packets=1, n_bytes=64, 
priority=20,recirc_id=0x12d,dp_hash=0x0/0xff,actions=output
  ])

  # Checks the flow stats in br-int, should be only one match.





From sugesh.chandran at intel.com  Wed Oct 28 09:37:26 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Wed, 28 Oct 2015 16:37:26 +0000
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
In-Reply-To: <CADCo8KAsFCPQL9mSBPLVCdyuGi0Qzs-SmFsWOccRWW2qOAKmaA@mail.gmail.com>
References: <CADCo8KC1S0FiZmWQCD_zaH5RYtX_SQBJu8vgr3b2_14vysyxOQ@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCE65D@IRSMSX102.ger.corp.intel.com>
 <CADCo8KDVdH_Rg_k_NwjyRc1sXxzxw9mOD6h4NkX5vw+1SkF7WQ@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCE8CD@IRSMSX102.ger.corp.intel.com>
 <CADCo8KAsFCPQL9mSBPLVCdyuGi0Qzs-SmFsWOccRWW2qOAKmaA@mail.gmail.com>
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB13CCEAE2@IRSMSX102.ger.corp.intel.com>

Hi Praveen,
Thank you sharing your setup details!
It looks like the issue here is ovs doesn’t have the arp entry for remote end point i.e 10.200.0.6.
Can you let OVS to learn the mac address for 10.200.0.6?? You can send a arp reply from Ixia port-2 to make it learn this value. Alternatively you can do the same with tnl/arp/set as well, but it looks like to me that the command not yet available on your OVS version.
And also please remove the static flow rule that configured lately.

You can verify the rules being used in the datapath with
ovs-appctl dpctl/dump-flows

There must be rules for `tnl_push`  for pushing the vxlan header and also for forward the packet to physical interface.

Regards
_Sugesh

From: Praveen MANKARA RADHAKRISHNAN [mailto:praveen.mankara at 6wind.com]
Sent: Wednesday, October 28, 2015 11:17 AM
To: Chandran, Sugesh
Cc: bugs at openvswitch.org; Daniel Virassamy
Subject: Re: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)

Hi Sugesh,

Thanks. but its still the same.It seems the packets are not getting forwarded from the vxlan interface.
Please find the logs attached.

root at ubuntu1404:~# ovs-vsctl show
e2127cda-4b01-4020-8a6c-b5ff6be8f2fa
    Bridge "br0"
        Port "dpdk1"
            Interface "dpdk1"
                type: dpdk
        Port "vxlan0"
            Interface "vxlan0"
                type: vxlan
                options: {remote_ip="10.200.0.6"}
        Port "br0"
            Interface "br0"
                type: internal
    Bridge "br1"
        Port "dpdk0"
            Interface "dpdk0"
                type: dpdk
        Port "br1"
            Interface "br1"
                type: internal


root at ubuntu1404:~# ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=341.284s, table=0, n_packets=1039, n_bytes=68574, idle_age=0, dl_vlan=1,dl_dst=02:11:22:44:55:22 actions=strip_vlan,output:2
 cookie=0x0, duration=427.090s, table=0, n_packets=8, n_bytes=648, idle_age=324, priority=0 actions=NORMAL


root at ubuntu1404:~# ovs-ofctl dump-flows br1
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=66.576s, table=0, n_packets=0, n_bytes=0, idle_age=66, in_port=LOCAL actions=output:1
 cookie=0x0, duration=401.153s, table=0, n_packets=8, n_bytes=648, idle_age=325, priority=0 actions=NORMAL

root at ubuntu1404:~# ovs-appctl tnl/arp/show
IP               MAC                 Bridge
=============================================
10.200.0.5       b8:ca:3a:6f:16:c8   br1

root at ubuntu1404:~# ovs-ofctl show br0
OFPT_FEATURES_REPLY (xid=0x2): dpid:0000b8ca3a6f16ca
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
 1(dpdk1): addr:b8:ca:3a:6f:16:ca
     config:     0
     state:      0
     current:    10GB-FD
     supported:  1GB-FD FIBER AUTO_PAUSE
     speed: 10000 Mbps now, 1000 Mbps max
 2(vxlan0): addr:46:6f:4a:fd:94:75
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 LOCAL(br0): addr:b8:ca:3a:6f:16:ca
     config:     0
     state:      0
     current:    10MB-FD COPPER
     speed: 10 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0


As you can see in the br0 packets are reaching the vxlan interface and its not forwarding form there it seems dropped at vxlan interface.

The same configurations is working without the dpdk.
please refer  the attached diagram for my set up.

Thanks
Praveen


On Wed, Oct 28, 2015 at 11:39 AM, Chandran, Sugesh <sugesh.chandran at intel.com<mailto:sugesh.chandran at intel.com>> wrote:
Hi Praveen,

The arp entries are learned properly, if the packets are reaching at br1.
Can you please confirm what flow rules are populated on br1 using ,
                ovs-ofctl dump-flows br1

If there is no rules present, please add a rule to forward packet to the physical port as follows,
ovs-ofctl add-flow br1 idle_timeout=0,in_port=LOCAL,action=output:1


Regards
_Sugesh

From: Praveen MANKARA RADHAKRISHNAN [mailto:praveen.mankara at 6wind.com<mailto:praveen.mankara at 6wind.com>]
Sent: Wednesday, October 28, 2015 10:05 AM
To: Chandran, Sugesh
Cc: bugs at openvswitch.org<mailto:bugs at openvswitch.org>; Daniel Virassamy
Subject: Re: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)

Hi Sugesh,

Thanks for the reply.
arp entries are show in vs-appctl tnl/arp/show command. but it seems o packet is coming to the bridge with physical port.

I have already tried to set using tnl/arp/set command but it seems set is not present in openvswitch 2.4
it returns the following error.

"
ovs-appctl tnl/arp/set br0 10.200.0.6 02:11:22:44:55:11
"tnl/arp/set" is not a valid command
ovs-appctl: ovs-vswitchd: server returned an error "

One important thing is to note that i was using dpdk-2.0.0. does that make any difference?

Thanks
Praveen

On Tue, Oct 27, 2015 at 6:28 PM, Chandran, Sugesh <sugesh.chandran at intel.com<mailto:sugesh.chandran at intel.com>> wrote:


Regards
_Sugesh

From: discuss [mailto:discuss-bounces at openvswitch.org<mailto:discuss-bounces at openvswitch.org>] On Behalf Of Praveen MANKARA RADHAKRISHNAN
Sent: Monday, October 26, 2015 5:23 PM
To: bugs at openvswitch.org<mailto:bugs at openvswitch.org>
Cc: Daniel Virassamy
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)

HI,

I am Praveen,

I am trying a specific test scenario using ovs-dpdk.

Test set up
-------------------

from the traffgen vlan packets are coming to dpdk interface its stripped using ovs command.
and sending to a vxlan interface which is comnnected in theo other dpdk interface and send back to traffgen.

i have done the vxlan set up similar to the sample test case.

https://github.com/openvswitch/ovs/blob/master/README-native-tunneling.md

the issue is that from the sumpflows i can see that packets are send to vxlan but it is not going to the other bridge.

the same scenario is working without dpdk.

I am using openvswitch-2.4.0.

Linux (without dpdk)
---------------------------------

ovs-vsctl add-br br0
ovs-vsctl add-port br0 eth0
ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan options:remote_ip=10.200.0.6
ovs-ofctl add-flow br0 dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2

ovs-vsctl add-br br1
ovs-vsctl add-port br1 eth1

 ip a a 10.200.0.5/24<http://10.200.0.5/24> dev br1
arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2

and from the traffgen i am sending traffic with dst mac 02:11:22:44:55:22 and vlan id 1.
it is correctly working.

ovs-dpdk
------------------

started ovs-dpdk ::
ovs-vswitchd --dpdk -c 0x1 -n 4 -- unix:$DB_SOCK --pidfile --detach

ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk

ovs-vsctl add-br br1 -- set bridge br1 datapath_type=netdev
ovs-vsctl add-port br1 dpdk1 -- set Interface dpdk1 type=dpdk

ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan options:remote_ip=10.200.0.6
ovs-ofctl add-flow br0 dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2

 ip a a 10.200.0.5/24<http://10.200.0.5/24> dev br1
arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2


here i have started the ovs-dpddk and do the same set up
but packets are not seen in bridge1 (br1) and in traffgen.

is there any specif configuration i need to do in ovs-dpdk
could it be because of the arp?
Is there a way to set static arp to the ovs-dpdk?
>>>> Does the arp entries shown properly in “ovs-appctl tnl/arp/show”???
>>>>> You can set the arp entries using ovs-appctl tnl/arp/set <bridge> <ip> <mac>. In OVS-DPDK the DPDK interfaces are not managed by kernel so assigning static arp to physical interface may not work.
Could you help in identifying the problem?

Thanking you in advance
Praveen





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151028/9067781c/attachment-0001.html>

From joestringer at nicira.com  Wed Oct 28 10:50:56 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Wed, 28 Oct 2015 10:50:56 -0700
Subject: [ovs-discuss] OVS: not able to add conntack flow rules
In-Reply-To: <8B736CA61E8F7C44875935637477D33E01079CF5CF@G4W3231.americas.hpqcorp.net>
References: <8B736CA61E8F7C44875935637477D33E01079C3BF8@G9W0743.americas.hpqcorp.net>
 <CANr6G5yTtxan729j9T-HCdpbiqNFd=yBcsL=qK2VQ=Y9fva0wA@mail.gmail.com>
 <8B736CA61E8F7C44875935637477D33E01079CF5CF@G4W3231.americas.hpqcorp.net>
Message-ID: <CANr6G5yiGZjbMC=3L7ySdJukaeynnEumRb6A41heGJ2B+pXz1w@mail.gmail.com>

I just looked back across the validation and there's two particular
cases that we don't validate on current master code:

- If the ct_state matches on 0-bits. For instance, flows matching
"ct_state=-trk", OVS accepts that even if there is no support for
conntrack.
- If flows specify the ct action, we allow it without checking for
datapath support.

These will need to be fixed.

I think that in your case, there are two possibilities: Either your
OVS kernel module doesn't support connection tracking at all (make
sure you're running the version you think you're running), or perhaps
connlabel support is not enabled on your kernel.

You can check for kernel support by looking at the OVS logs:

# grep "Datapath" /path/to/ovs-vswitchd.log
2015-10-26T17:28:26.801Z|00018|ofproto_dpif|INFO|netdev at ovs-netdev:
Datapath supports recirculation
2015-10-26T17:28:26.802Z|00020|ofproto_dpif|INFO|netdev at ovs-netdev:
Datapath supports unique flow ids
2015-10-26T17:28:26.802Z|00021|ofproto_dpif|INFO|netdev at ovs-netdev:
Datapath does not support ct_state
2015-10-26T17:28:26.802Z|00022|ofproto_dpif|INFO|netdev at ovs-netdev:
Datapath does not support ct_zone
2015-10-26T17:28:26.802Z|00023|ofproto_dpif|INFO|netdev at ovs-netdev:
Datapath does not support ct_mark
2015-10-26T17:28:26.802Z|00024|ofproto_dpif|INFO|netdev at ovs-netdev:
Datapath does not support ct_label

In this example, there is no kernel support for connection tracking.

On 28 October 2015 at 03:31, Kenchappa, Ravindra
<ravindra.kenchappa at hpe.com> wrote:
> Hi,
>
> The two threads :
>
> http://openvswitch.org/pipermail/discuss/2015-October/019201.html
> http://openvswitch.org/pipermail/dev/2015-October/061629.html
>
> discuss about kernel not  supporting  connection tracking and OVS rejecting conntrack  flows with  "bad field" error.
>
> But in my case I was able to added the following flows with ct-state in the match filed:
>
>     table=0,in_port=1,tcp,action=ct(commit,exec(set_field:1->ct_label)),2
>     table=0,in_port=2,ct_state=-trk,tcp,action=ct(table=1)
>
> but the flow below is not accepted by OVS and returns bad field error:
>
>     table=1,in_port=2,ct_state=+trk,ct_label=1,tcp,action=1
>
> Thanks,
> Ravi
>
> -----Original Message-----
> From: Joe Stringer [mailto:joestringer at nicira.com]
> Sent: Monday, October 26, 2015 10:22 PM
> To: Kenchappa, Ravindra
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] OVS: not able to add conntack flow rules
>
> On 25 October 2015 at 21:45, Kenchappa, Ravindra <ravindra.kenchappa at hpe.com> wrote:
>> Hi,
>>
>> I have downloaded and installed OVS 2.4.90
>> (https://github.com/justinpettit/ovs/tree/conntrack) and trying to add
>> conntrack flows via ovs-ofctl. I am able to add few sample flows and I
>> am getting errors when tried to added the following flow:
>>
>> raveek:~/devstack$ sudo ovs-ofctl add-flow br-int
>> table=1,in_port=2,ct_state=+est,tcp,action=1
>> OFPT_ERROR (xid=0x6): OFPBMC_BAD_FIELD NXT_FLOW_MOD (xid=0x6):
>> (truncated to 64 bytes from 88)
>> 00000000 01 04 00 58 00 00 00 06-00 00 23 20 00 00 00 0d |...X......#
>> ....|
>> 00000010 00 00 00 00 00 00 00 00-01 00 00 00 00 00 80 00
>> |................|
>> 00000020 ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00
>> |................|
>> 00000030 00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01
>> |................|
>>
>> raveek:~/devstack$ sudo ovs-ofctl add-flow br-int
>> table=20,in_port=2,ct_state=+trk+new,tcp,action=drop
>> OFPT_ERROR (xid=0x6): OFPBMC_BAD_FIELD NXT_FLOW_MOD (xid=0x6):
>> (truncated to 64 bytes from 80)
>> 00000000 01 04 00 50 00 00 00 06-00 00 23 20 00 00 00 0d |...P......#
>> ....|
>> 00000010 00 00 00 00 00 00 00 00-14 00 00 00 00 00 80 00
>> |................|
>> 00000020 ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00
>> |................|
>> 00000030 00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01
>> |................| raveek::~/devstack$
>>
>> Here is the flow table looks like.
>>
>> raveek:~/devstack$ sudo ovs-ofctl dump-flows br-int -Oopenflow13
>> OFPST_FLOW reply (OF1.3) (xid=0x2):
>> cookie=0x0, duration=98.291s, table=0, n_packets=0, n_bytes=0,
>> dl_type=0x88cc actions=CONTROLLER:65535 cookie=0x0, duration=28.391s,
>> table=0, n_packets=0, n_bytes=0, arp actions=NORMAL cookie=0x0,
>> duration=28.368s, table=0, n_packets=0, n_bytes=0,
>> ct_state=-trk,tcp,in_port=1 actions=ct(commit,zone=9),output:2
>> cookie=0x0, duration=28.346s, table=0, n_packets=0, n_bytes=0,
>> ct_state=-trk,tcp,in_port=2 actions=ct(table=1,zone=9) cookie=0x0,
>> duration=98.291s, table=0, n_packets=0, n_bytes=0, priority=0
>> actions=goto_table:20
>> cookie=0x0, duration=28.410s, table=0, n_packets=0, n_bytes=0,
>> priority=1 actions=drop cookie=0x0, duration=98.288s, table=20,
>> n_packets=0, n_bytes=0, priority=0
>> actions=goto_table:30
>> cookie=0x0, duration=98.288s, table=30, n_packets=0, n_bytes=0,
>> priority=0
>> actions=goto_table:40
>> cookie=0x0, duration=98.288s, table=40, n_packets=0, n_bytes=0,
>> priority=0
>> actions=goto_table:50
>> cookie=0x0, duration=98.291s, table=50, n_packets=0, n_bytes=0,
>> priority=0
>> actions=goto_table:60
>> cookie=0x0, duration=98.288s, table=60, n_packets=0, n_bytes=0,
>> priority=0
>> actions=goto_table:70
>> cookie=0x0, duration=98.288s, table=70, n_packets=0, n_bytes=0,
>> priority=0
>> actions=goto_table:80
>> cookie=0x0, duration=98.289s, table=80, n_packets=0, n_bytes=0,
>> priority=0
>> actions=goto_table:90
>> cookie=0x0, duration=98.288s, table=90, n_packets=0, n_bytes=0,
>> priority=0
>> actions=goto_table:100
>> cookie=0x0, duration=98.288s, table=100, n_packets=0, n_bytes=0,
>> priority=0
>> actions=goto_table:110
>> cookie=0x0, duration=98.291s, table=110, n_packets=0, n_bytes=0,
>> priority=0 actions=drop
>>
>> raveek::~/devstack$
>>
>> Could you please help me in identifying the problem?
>
> There have been multiple questions like this recently on this mailinglist, see those threads:
>
> http://openvswitch.org/pipermail/discuss/2015-October/019201.html
> http://openvswitch.org/pipermail/dev/2015-October/061629.html

From azhou at nicira.com  Wed Oct 28 13:05:08 2015
From: azhou at nicira.com (Andy Zhou)
Date: Wed, 28 Oct 2015 13:05:08 -0700
Subject: [ovs-discuss] [openvswitch 2.3.2] testsuite: 717 fails on s390x
In-Reply-To: <5630D413.10904@linux.vnet.ibm.com>
References: <5630D413.10904@linux.vnet.ibm.com>
Message-ID: <CACzMAJLBhkbksmMj6F0=B0VqpXweTdGOvehtc5hcD1fs91BDMw@mail.gmail.com>

On Wed, Oct 28, 2015 at 6:56 AM, Gerhard Stenzel
<gstenzel at linux.vnet.ibm.com> wrote:
> Hello All,
>
> Test case 717 fails on s390x:
>
> 717. ofproto-dpif.at:203: 717. ofproto-dpif, balance-tcp bonding,
> different recirc flow  (ofproto-dpif.at:203): FAILED (ofproto-dpif.at:253)
>
> The test case was introduced by 4ec2ffe905e266ed27c16294668b8162ec5f29dc
> into the 2.3 branch and is also in the 2.4 branch with ID
> f9038ef61e0bf89bcd753b7cfd187adb112601ec.
>
> In the 2.4 branch there is also a patch with ID
> 8ae8176fd0d8ed919e3301cc961dcf02b65ff49d which appears to fix the
> failing test case for the 2.4 branch.
>
> With a backported version of this 2.4 patch test case 717 passes most of the
> times but not always.
When it still fails with the backported version, what seemed to be the problem?

>
> I would appreciate some feedback if the backported patch is correct ...
Thanks for pointing out this patch was missing from branch-2.3. It
would be nice to figure out the remaining issues (if any) before
cherry pick it into branch 2.3.    Thanks.

From praveen.mankara at 6wind.com  Wed Oct 28 03:05:11 2015
From: praveen.mankara at 6wind.com (Praveen MANKARA RADHAKRISHNAN)
Date: Wed, 28 Oct 2015 11:05:11 +0100
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
In-Reply-To: <2EF2F5C0CC56984AA024D0B180335FCB13CCE65D@IRSMSX102.ger.corp.intel.com>
References: <CADCo8KC1S0FiZmWQCD_zaH5RYtX_SQBJu8vgr3b2_14vysyxOQ@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCE65D@IRSMSX102.ger.corp.intel.com>
Message-ID: <CADCo8KDVdH_Rg_k_NwjyRc1sXxzxw9mOD6h4NkX5vw+1SkF7WQ@mail.gmail.com>

Hi Sugesh,

Thanks for the reply.
arp entries are show in vs-appctl tnl/arp/show command. but it seems o
packet is coming to the bridge with physical port.

I have already tried to set using tnl/arp/set command but it seems set is
not present in openvswitch 2.4
it returns the following error.

"
ovs-appctl tnl/arp/set br0 10.200.0.6 02:11:22:44:55:11
"tnl/arp/set" is not a valid command
ovs-appctl: ovs-vswitchd: server returned an error "

One important thing is to note that i was using dpdk-2.0.0. does that make
any difference?

Thanks
Praveen

On Tue, Oct 27, 2015 at 6:28 PM, Chandran, Sugesh <sugesh.chandran at intel.com
> wrote:

>
>
>
>
> *Regards*
>
> *_Sugesh*
>
>
>
> *From:* discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of *Praveen
> MANKARA RADHAKRISHNAN
> *Sent:* Monday, October 26, 2015 5:23 PM
> *To:* bugs at openvswitch.org
> *Cc:* Daniel Virassamy
> *Subject:* [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
>
>
>
> HI,
>
>
>
> I am Praveen,
>
>
>
> I am trying a specific test scenario using ovs-dpdk.
>
>
>
> Test set up
>
> -------------------
>
>
>
> from the traffgen vlan packets are coming to dpdk interface its stripped
> using ovs command.
>
> and sending to a vxlan interface which is comnnected in theo other dpdk
> interface and send back to traffgen.
>
>
>
> i have done the vxlan set up similar to the sample test case.
>
>
>
> https://github.com/openvswitch/ovs/blob/master/README-native-tunneling.md
>
>
>
> the issue is that from the sumpflows i can see that packets are send to
> vxlan but it is not going to the other bridge.
>
>
>
> the same scenario is working without dpdk.
>
>
>
> I am using openvswitch-2.4.0.
>
>
>
> Linux (without dpdk)
>
> ---------------------------------
>
>
>
> ovs-vsctl add-br br0
>
> ovs-vsctl add-port br0 eth0
>
> ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
> options:remote_ip=10.200.0.6
>
> ovs-ofctl add-flow br0
> dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2
>
>
>
> ovs-vsctl add-br br1
>
> ovs-vsctl add-port br1 eth1
>
>
>
>  ip a a 10.200.0.5/24 dev br1
>
> arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2
>
>
>
> and from the traffgen i am sending traffic with dst mac 02:11:22:44:55:22
> and vlan id 1.
>
> it is correctly working.
>
>
>
> ovs-dpdk
>
> ------------------
>
>
>
> started ovs-dpdk ::
>
> ovs-vswitchd --dpdk -c 0x1 -n 4 -- unix:$DB_SOCK --pidfile --detach
>
>
>
> ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
>
> ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk
>
>
>
> ovs-vsctl add-br br1 -- set bridge br1 datapath_type=netdev
>
> ovs-vsctl add-port br1 dpdk1 -- set Interface dpdk1 type=dpdk
>
>
>
> ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
> options:remote_ip=10.200.0.6
>
> ovs-ofctl add-flow br0
> dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2
>
>
>
>  ip a a 10.200.0.5/24 dev br1
>
> arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2
>
>
>
>
>
> here i have started the ovs-dpddk and do the same set up
>
> but packets are not seen in bridge1 (br1) and in traffgen.
>
>
>
> is there any specif configuration i need to do in ovs-dpdk
>
> could it be because of the arp?
>
> Is there a way to set static arp to the ovs-dpdk?
>
> >>>> Does the arp entries shown properly in “ovs-appctl tnl/arp/show”???
>
> >>>>> You can set the arp entries using ovs-appctl tnl/arp/set <bridge>
> <ip> <mac>. In OVS-DPDK the DPDK interfaces are not managed by kernel so
> assigning static arp to physical interface may not work.
>
> Could you help in identifying the problem?
>
>
>
> Thanking you in advance
>
> Praveen
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151028/1ebbda96/attachment-0001.html>

From ravindra.kenchappa at hpe.com  Wed Oct 28 03:31:44 2015
From: ravindra.kenchappa at hpe.com (Kenchappa, Ravindra)
Date: Wed, 28 Oct 2015 10:31:44 +0000
Subject: [ovs-discuss] OVS: not able to add conntack flow rules
In-Reply-To: <CANr6G5yTtxan729j9T-HCdpbiqNFd=yBcsL=qK2VQ=Y9fva0wA@mail.gmail.com>
References: <8B736CA61E8F7C44875935637477D33E01079C3BF8@G9W0743.americas.hpqcorp.net>
 <CANr6G5yTtxan729j9T-HCdpbiqNFd=yBcsL=qK2VQ=Y9fva0wA@mail.gmail.com>
Message-ID: <8B736CA61E8F7C44875935637477D33E01079CF5CF@G4W3231.americas.hpqcorp.net>

Hi,

The two threads :

http://openvswitch.org/pipermail/discuss/2015-October/019201.html
http://openvswitch.org/pipermail/dev/2015-October/061629.html

discuss about kernel not  supporting  connection tracking and OVS rejecting conntrack  flows with  "bad field" error.

But in my case I was able to added the following flows with ct-state in the match filed:

    table=0,in_port=1,tcp,action=ct(commit,exec(set_field:1->ct_label)),2
    table=0,in_port=2,ct_state=-trk,tcp,action=ct(table=1)

but the flow below is not accepted by OVS and returns bad field error:

    table=1,in_port=2,ct_state=+trk,ct_label=1,tcp,action=1

Thanks,
Ravi

-----Original Message-----
From: Joe Stringer [mailto:joestringer at nicira.com] 
Sent: Monday, October 26, 2015 10:22 PM
To: Kenchappa, Ravindra
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] OVS: not able to add conntack flow rules

On 25 October 2015 at 21:45, Kenchappa, Ravindra <ravindra.kenchappa at hpe.com> wrote:
> Hi,
>
> I have downloaded and installed OVS 2.4.90
> (https://github.com/justinpettit/ovs/tree/conntrack) and trying to add 
> conntrack flows via ovs-ofctl. I am able to add few sample flows and I 
> am getting errors when tried to added the following flow:
>
> raveek:~/devstack$ sudo ovs-ofctl add-flow br-int
> table=1,in_port=2,ct_state=+est,tcp,action=1
> OFPT_ERROR (xid=0x6): OFPBMC_BAD_FIELD NXT_FLOW_MOD (xid=0x6):
> (truncated to 64 bytes from 88)
> 00000000 01 04 00 58 00 00 00 06-00 00 23 20 00 00 00 0d |...X......# 
> ....|
> 00000010 00 00 00 00 00 00 00 00-01 00 00 00 00 00 80 00 
> |................|
> 00000020 ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00 
> |................|
> 00000030 00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01 
> |................|
>
> raveek:~/devstack$ sudo ovs-ofctl add-flow br-int 
> table=20,in_port=2,ct_state=+trk+new,tcp,action=drop
> OFPT_ERROR (xid=0x6): OFPBMC_BAD_FIELD NXT_FLOW_MOD (xid=0x6):
> (truncated to 64 bytes from 80)
> 00000000 01 04 00 50 00 00 00 06-00 00 23 20 00 00 00 0d |...P......# 
> ....|
> 00000010 00 00 00 00 00 00 00 00-14 00 00 00 00 00 80 00 
> |................|
> 00000020 ff ff ff ff ff ff 00 00-00 1d 00 00 00 00 00 00 
> |................|
> 00000030 00 00 00 02 00 02 00 00-06 02 08 00 00 00 0c 01 
> |................| raveek::~/devstack$
>
> Here is the flow table looks like.
>
> raveek:~/devstack$ sudo ovs-ofctl dump-flows br-int -Oopenflow13 
> OFPST_FLOW reply (OF1.3) (xid=0x2):
> cookie=0x0, duration=98.291s, table=0, n_packets=0, n_bytes=0, 
> dl_type=0x88cc actions=CONTROLLER:65535 cookie=0x0, duration=28.391s, 
> table=0, n_packets=0, n_bytes=0, arp actions=NORMAL cookie=0x0, 
> duration=28.368s, table=0, n_packets=0, n_bytes=0,
> ct_state=-trk,tcp,in_port=1 actions=ct(commit,zone=9),output:2
> cookie=0x0, duration=28.346s, table=0, n_packets=0, n_bytes=0,
> ct_state=-trk,tcp,in_port=2 actions=ct(table=1,zone=9) cookie=0x0, 
> duration=98.291s, table=0, n_packets=0, n_bytes=0, priority=0
> actions=goto_table:20
> cookie=0x0, duration=28.410s, table=0, n_packets=0, n_bytes=0, 
> priority=1 actions=drop cookie=0x0, duration=98.288s, table=20, 
> n_packets=0, n_bytes=0, priority=0
> actions=goto_table:30
> cookie=0x0, duration=98.288s, table=30, n_packets=0, n_bytes=0, 
> priority=0
> actions=goto_table:40
> cookie=0x0, duration=98.288s, table=40, n_packets=0, n_bytes=0, 
> priority=0
> actions=goto_table:50
> cookie=0x0, duration=98.291s, table=50, n_packets=0, n_bytes=0, 
> priority=0
> actions=goto_table:60
> cookie=0x0, duration=98.288s, table=60, n_packets=0, n_bytes=0, 
> priority=0
> actions=goto_table:70
> cookie=0x0, duration=98.288s, table=70, n_packets=0, n_bytes=0, 
> priority=0
> actions=goto_table:80
> cookie=0x0, duration=98.289s, table=80, n_packets=0, n_bytes=0, 
> priority=0
> actions=goto_table:90
> cookie=0x0, duration=98.288s, table=90, n_packets=0, n_bytes=0, 
> priority=0
> actions=goto_table:100
> cookie=0x0, duration=98.288s, table=100, n_packets=0, n_bytes=0, 
> priority=0
> actions=goto_table:110
> cookie=0x0, duration=98.291s, table=110, n_packets=0, n_bytes=0, 
> priority=0 actions=drop
>
> raveek::~/devstack$
>
> Could you please help me in identifying the problem?

There have been multiple questions like this recently on this mailinglist, see those threads:

http://openvswitch.org/pipermail/discuss/2015-October/019201.html
http://openvswitch.org/pipermail/dev/2015-October/061629.html

From praveen.mankara at 6wind.com  Wed Oct 28 04:16:37 2015
From: praveen.mankara at 6wind.com (Praveen MANKARA RADHAKRISHNAN)
Date: Wed, 28 Oct 2015 12:16:37 +0100
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
In-Reply-To: <2EF2F5C0CC56984AA024D0B180335FCB13CCE8CD@IRSMSX102.ger.corp.intel.com>
References: <CADCo8KC1S0FiZmWQCD_zaH5RYtX_SQBJu8vgr3b2_14vysyxOQ@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCE65D@IRSMSX102.ger.corp.intel.com>
 <CADCo8KDVdH_Rg_k_NwjyRc1sXxzxw9mOD6h4NkX5vw+1SkF7WQ@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCE8CD@IRSMSX102.ger.corp.intel.com>
Message-ID: <CADCo8KAsFCPQL9mSBPLVCdyuGi0Qzs-SmFsWOccRWW2qOAKmaA@mail.gmail.com>

Hi Sugesh,

Thanks. but its still the same.It seems the packets are not getting
forwarded from the vxlan interface.
Please find the logs attached.

root at ubuntu1404:~# ovs-vsctl show
e2127cda-4b01-4020-8a6c-b5ff6be8f2fa
    Bridge "br0"
        Port "dpdk1"
            Interface "dpdk1"
                type: dpdk
        Port "vxlan0"
            Interface "vxlan0"
                type: vxlan
                options: {remote_ip="10.200.0.6"}
        Port "br0"
            Interface "br0"
                type: internal
    Bridge "br1"
        Port "dpdk0"
            Interface "dpdk0"
                type: dpdk
        Port "br1"
            Interface "br1"
                type: internal


root at ubuntu1404:~# ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=341.284s, table=0, n_packets=1039, n_bytes=68574,
idle_age=0, dl_vlan=1,dl_dst=02:11:22:44:55:22 actions=strip_vlan,output:2
 cookie=0x0, duration=427.090s, table=0, n_packets=8, n_bytes=648,
idle_age=324, priority=0 actions=NORMAL


root at ubuntu1404:~# ovs-ofctl dump-flows br1
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=66.576s, table=0, n_packets=0, n_bytes=0,
idle_age=66, in_port=LOCAL actions=output:1
 cookie=0x0, duration=401.153s, table=0, n_packets=8, n_bytes=648,
idle_age=325, priority=0 actions=NORMAL

root at ubuntu1404:~# ovs-appctl tnl/arp/show
IP               MAC                 Bridge
=============================================
10.200.0.5       b8:ca:3a:6f:16:c8   br1

root at ubuntu1404:~# ovs-ofctl show br0
OFPT_FEATURES_REPLY (xid=0x2): dpid:0000b8ca3a6f16ca
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src
mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
 1(dpdk1): addr:b8:ca:3a:6f:16:ca
     config:     0
     state:      0
     current:    10GB-FD
     supported:  1GB-FD FIBER AUTO_PAUSE
     speed: 10000 Mbps now, 1000 Mbps max
 2(vxlan0): addr:46:6f:4a:fd:94:75
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 LOCAL(br0): addr:b8:ca:3a:6f:16:ca
     config:     0
     state:      0
     current:    10MB-FD COPPER
     speed: 10 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0


As you can see in the br0 packets are reaching the vxlan interface and its
not forwarding form there it seems dropped at vxlan interface.

The same configurations is working without the dpdk.
please refer  the attached diagram for my set up.

Thanks
Praveen


On Wed, Oct 28, 2015 at 11:39 AM, Chandran, Sugesh <
sugesh.chandran at intel.com> wrote:

> Hi Praveen,
>
>
>
> The arp entries are learned properly, if the packets are reaching at br1.
>
> Can you please confirm what flow rules are populated on br1 using ,
>
>                 ovs-ofctl dump-flows br1
>
>
>
> If there is no rules present, please add a rule to forward packet to the
> physical port as follows,
>
> ovs-ofctl add-flow br1 idle_timeout=0,in_port=LOCAL,action=output:1
>
>
>
>
>
> *Regards*
>
> *_Sugesh*
>
>
>
> *From:* Praveen MANKARA RADHAKRISHNAN [mailto:praveen.mankara at 6wind.com]
> *Sent:* Wednesday, October 28, 2015 10:05 AM
> *To:* Chandran, Sugesh
> *Cc:* bugs at openvswitch.org; Daniel Virassamy
> *Subject:* Re: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
>
>
>
> Hi Sugesh,
>
>
>
> Thanks for the reply.
>
> arp entries are show in vs-appctl tnl/arp/show command. but it seems o
> packet is coming to the bridge with physical port.
>
>
>
> I have already tried to set using tnl/arp/set command but it seems set is
> not present in openvswitch 2.4
>
> it returns the following error.
>
>
>
> "
>
> ovs-appctl tnl/arp/set br0 10.200.0.6 02:11:22:44:55:11
>
> "tnl/arp/set" is not a valid command
>
> ovs-appctl: ovs-vswitchd: server returned an error "
>
>
>
> One important thing is to note that i was using dpdk-2.0.0. does that make
> any difference?
>
>
>
> Thanks
>
> Praveen
>
>
>
> On Tue, Oct 27, 2015 at 6:28 PM, Chandran, Sugesh <
> sugesh.chandran at intel.com> wrote:
>
>
>
>
>
> *Regards*
>
> *_Sugesh*
>
>
>
> *From:* discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of *Praveen
> MANKARA RADHAKRISHNAN
> *Sent:* Monday, October 26, 2015 5:23 PM
> *To:* bugs at openvswitch.org
> *Cc:* Daniel Virassamy
> *Subject:* [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
>
>
>
> HI,
>
>
>
> I am Praveen,
>
>
>
> I am trying a specific test scenario using ovs-dpdk.
>
>
>
> Test set up
>
> -------------------
>
>
>
> from the traffgen vlan packets are coming to dpdk interface its stripped
> using ovs command.
>
> and sending to a vxlan interface which is comnnected in theo other dpdk
> interface and send back to traffgen.
>
>
>
> i have done the vxlan set up similar to the sample test case.
>
>
>
> https://github.com/openvswitch/ovs/blob/master/README-native-tunneling.md
>
>
>
> the issue is that from the sumpflows i can see that packets are send to
> vxlan but it is not going to the other bridge.
>
>
>
> the same scenario is working without dpdk.
>
>
>
> I am using openvswitch-2.4.0.
>
>
>
> Linux (without dpdk)
>
> ---------------------------------
>
>
>
> ovs-vsctl add-br br0
>
> ovs-vsctl add-port br0 eth0
>
> ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
> options:remote_ip=10.200.0.6
>
> ovs-ofctl add-flow br0
> dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2
>
>
>
> ovs-vsctl add-br br1
>
> ovs-vsctl add-port br1 eth1
>
>
>
>  ip a a 10.200.0.5/24 dev br1
>
> arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2
>
>
>
> and from the traffgen i am sending traffic with dst mac 02:11:22:44:55:22
> and vlan id 1.
>
> it is correctly working.
>
>
>
> ovs-dpdk
>
> ------------------
>
>
>
> started ovs-dpdk ::
>
> ovs-vswitchd --dpdk -c 0x1 -n 4 -- unix:$DB_SOCK --pidfile --detach
>
>
>
> ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
>
> ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk
>
>
>
> ovs-vsctl add-br br1 -- set bridge br1 datapath_type=netdev
>
> ovs-vsctl add-port br1 dpdk1 -- set Interface dpdk1 type=dpdk
>
>
>
> ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
> options:remote_ip=10.200.0.6
>
> ovs-ofctl add-flow br0
> dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2
>
>
>
>  ip a a 10.200.0.5/24 dev br1
>
> arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2
>
>
>
>
>
> here i have started the ovs-dpddk and do the same set up
>
> but packets are not seen in bridge1 (br1) and in traffgen.
>
>
>
> is there any specif configuration i need to do in ovs-dpdk
>
> could it be because of the arp?
>
> Is there a way to set static arp to the ovs-dpdk?
>
> >>>> Does the arp entries shown properly in “ovs-appctl tnl/arp/show”???
>
> >>>>> You can set the arp entries using ovs-appctl tnl/arp/set <bridge>
> <ip> <mac>. In OVS-DPDK the DPDK interfaces are not managed by kernel so
> assigning static arp to physical interface may not work.
>
> Could you help in identifying the problem?
>
>
>
> Thanking you in advance
>
> Praveen
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151028/6bf6c741/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: VLAN_VXLAN_OVS_2bridge.png
Type: image/png
Size: 63128 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151028/6bf6c741/attachment-0001.png>

From tech.kals at gmail.com  Wed Oct 28 05:28:03 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Wed, 28 Oct 2015 17:58:03 +0530
Subject: [ovs-discuss] Informing the controller through OVS when port state
 is changed to admin up/down
Message-ID: <CAHWErLdw43mVs8iNVPvk=cSiuARpyiMoa76oAd=5pMHRjvTVTg@mail.gmail.com>

Hi experts,

Am facing the issue of the *OVS doesn't inform Controller when port state
is changed to down by admin*.

 When look at the code, " *port_reconfigured " * function would be called
to inform the controller when port state is changed.
 But, the comment says that OVS will not inform the controller about the
same. I found it as true in my testing as well.
 Is my understanding correct ? Could someone correct me if my understanding
is wrong.


*    /* Called after an OpenFlow request changes a port's configuration.*
*     * 'ofport->pp.config' contains the new configuration.  'old_config'*
*     * contains the previous configuration.*
*     **
*     * The caller implements OFPUTIL_PC_PORT_DOWN using netdev functions
to*
*     * turn NETDEV_UP on and off, so this function doesn't have to do
anything*
*     * for that bit (and it won't be called if that is the only bit that*
*     * changes). */*
*    void (*port_reconfigured)(struct ofport *ofport,*
*                              enum ofputil_port_config old_config);*



 Could someone guide me how to fix this issue ? How can make OVS to inform
the controller when port state is changed ? Is there any other function to
do the same ?


Thanks,
~Kals~
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151028/71ed988d/attachment.html>

From mark.d.gray at intel.com  Thu Oct 29 04:14:13 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Thu, 29 Oct 2015 11:14:13 +0000
Subject: [ovs-discuss] "Meter implementation for userspace	datapath"
	upstreamed?
Message-ID: <738D45BC1F695740A983F43CFE1B7EA9438D2455@IRSMSX108.ger.corp.intel.com>

Hi,

Was this patch ever upstreamed? It doesn't seem to be in the code base?

http://openvswitch.org/pipermail/dev/2014-August/043913.html

Mark


From gstenzel at linux.vnet.ibm.com  Thu Oct 29 05:40:08 2015
From: gstenzel at linux.vnet.ibm.com (Gerhard Stenzel)
Date: Thu, 29 Oct 2015 13:40:08 +0100
Subject: [ovs-discuss] [openvswitch 2.3.2] testsuite: 717 fails on s390x
In-Reply-To: <CACzMAJLBhkbksmMj6F0=B0VqpXweTdGOvehtc5hcD1fs91BDMw@mail.gmail.com>
References: <5630D413.10904@linux.vnet.ibm.com>
 <CACzMAJLBhkbksmMj6F0=B0VqpXweTdGOvehtc5hcD1fs91BDMw@mail.gmail.com>
Message-ID: <563213A8.6080700@linux.vnet.ibm.com>


On 10/28/2015 09:05 PM, Andy Zhou wrote:
 > On Wed, Oct 28, 2015 at 6:56 AM, Gerhard Stenzel
...
 > Thanks for pointing out this patch was missing from branch-2.3. It
 > would be nice to figure out the remaining issues (if any) before
 > cherry pick it into branch 2.3.    Thanks.
 >

When test case 717 fails, it seems the recirc_id is not as expected. So 
it is a different issue than the one fixed by 
8ae8176fd0d8ed919e3301cc961dcf02b65ff49d
When failing, the test case run takes a few seconds longer to complete.

Here is the relevant part from the log file:
...
ovs_wait
stderr:
stdout:
./ofproto-dpif.at:237: ovs-ofctl add-flows br-int flows.txt
./ofproto-dpif.at:241: ovs-appctl netdev-dummy/receive p5 
"in_port(5),eth(src=50:54:00:00:00:05,dst=50:54:00:00:01:00),eth_type(0x0800),ipv4(src=10.0.0.2,dst=10.0.0.1,proto=1,tos=0,ttl=64,frag=no)"
./ofproto-dpif.at:244: ovs-appctl upcall/disable-megaflows
./ofproto-dpif.at:247: ovs-appctl upcall/enable-megaflows
./ofproto-dpif.at:253: ovs-appctl bridge/dump-flows br1 | ofctl_strip | 
grep -- "n_packets" | grep -- "table_id" | sed -e 
's/dp_hash=0x[0-9a-f][0-9a-f]*/dp_hash=0x0/' -e 
's/output:[0-9][0-9a-f]*/output/'
--- -   2015-10-29 12:50:26.431895261 +0100
+++ 
/root/test/root/projects/ovs/tests/testsuite.dir/at-groups/717/stdout 
   2015-10-29 12:50:26.422746995 +0100
@@ -1,2 +1,2 @@
-table_id=254, n_packets=1, n_bytes=64, 
priority=20,recirc_id=0x12d,dp_hash=0x0/0xff,actions=output
+table_id=254, n_packets=1, n_bytes=64, 
priority=20,recirc_id=0x12c,dp_hash=0x0/0xff,actions=output
..


From tech.kals at gmail.com  Wed Oct 28 20:15:55 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Thu, 29 Oct 2015 08:45:55 +0530
Subject: [ovs-discuss] Informing the controller through OVS when port
 state is changed to admin up/down
In-Reply-To: <CAHWErLdw43mVs8iNVPvk=cSiuARpyiMoa76oAd=5pMHRjvTVTg@mail.gmail.com>
References: <CAHWErLdw43mVs8iNVPvk=cSiuARpyiMoa76oAd=5pMHRjvTVTg@mail.gmail.com>
Message-ID: <CAHWErLdvQrQG2zEwW2FLmAQak6Dt6HhsSBrwneUbJ+R=XsQyFg@mail.gmail.com>

Can someone have a look at this issue please ?

thanks,
kals

On Wed, Oct 28, 2015 at 5:58 PM, tech_kals Kals <tech.kals at gmail.com> wrote:

> Hi experts,
>
> Am facing the issue of the *OVS doesn't inform Controller when port state
> is changed to down by admin*.
>
>  When look at the code, " *port_reconfigured " * function would be called
> to inform the controller when port state is changed.
>  But, the comment says that OVS will not inform the controller about the
> same. I found it as true in my testing as well.
>  Is my understanding correct ? Could someone correct me if my
> understanding is wrong.
>
>
> *    /* Called after an OpenFlow request changes a port's configuration.*
> *     * 'ofport->pp.config' contains the new configuration.  'old_config'*
> *     * contains the previous configuration.*
> *     **
> *     * The caller implements OFPUTIL_PC_PORT_DOWN using netdev functions
> to*
> *     * turn NETDEV_UP on and off, so this function doesn't have to do
> anything*
> *     * for that bit (and it won't be called if that is the only bit that*
> *     * changes). */*
> *    void (*port_reconfigured)(struct ofport *ofport,*
> *                              enum ofputil_port_config old_config);*
>
>
>
>  Could someone guide me how to fix this issue ? How can make OVS to inform
> the controller when port state is changed ? Is there any other function to
> do the same ?
>
>
> Thanks,
> ~Kals~
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151029/e7ac3d2d/attachment.html>

From jrajahalme at nicira.com  Thu Oct 29 09:32:32 2015
From: jrajahalme at nicira.com (Jarno Rajahalme)
Date: Thu, 29 Oct 2015 09:32:32 -0700
Subject: [ovs-discuss] "Meter implementation for userspace	datapath"
	upstreamed?
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA9438D2455@IRSMSX108.ger.corp.intel.com>
References: <738D45BC1F695740A983F43CFE1B7EA9438D2455@IRSMSX108.ger.corp.intel.com>
Message-ID: <1519012D-6DDB-4ADA-923B-4132EFC9D9C5@nicira.com>


> On Oct 29, 2015, at 4:14 AM, Gray, Mark D <mark.d.gray at intel.com> wrote:
> 
> Hi,
> 
> Was this patch ever upstreamed? It doesn't seem to be in the code base?
> 
> http://openvswitch.org/pipermail/dev/2014-August/043913.html
> 
> Mark
> 

No, it would require rebasing. No immediate plans, but I could work on it sometime later.

  Jarno


From mark.d.gray at intel.com  Thu Oct 29 09:33:37 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Thu, 29 Oct 2015 16:33:37 +0000
Subject: [ovs-discuss] "Meter implementation for userspace	datapath"
	upstreamed?
In-Reply-To: <1519012D-6DDB-4ADA-923B-4132EFC9D9C5@nicira.com>
References: <738D45BC1F695740A983F43CFE1B7EA9438D2455@IRSMSX108.ger.corp.intel.com>
 <1519012D-6DDB-4ADA-923B-4132EFC9D9C5@nicira.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA9438D2EC8@IRSMSX108.ger.corp.intel.com>

> > On Oct 29, 2015, at 4:14 AM, Gray, Mark D <mark.d.gray at intel.com> wrote:
> >
> > Hi,
> >
> > Was this patch ever upstreamed? It doesn't seem to be in the code base?
> >
> > http://openvswitch.org/pipermail/dev/2014-August/043913.html
> >
> > Mark
> >
> 
> No, it would require rebasing. No immediate plans, but I could work on it
> sometime later.

Was there any reason you stopped working on it? It seemed to be in quite an advanced
state?
> 
>   Jarno


From jrajahalme at nicira.com  Thu Oct 29 09:40:58 2015
From: jrajahalme at nicira.com (Jarno Rajahalme)
Date: Thu, 29 Oct 2015 09:40:58 -0700
Subject: [ovs-discuss] "Meter implementation for userspace	datapath"
	upstreamed?
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA9438D2EC8@IRSMSX108.ger.corp.intel.com>
References: <738D45BC1F695740A983F43CFE1B7EA9438D2455@IRSMSX108.ger.corp.intel.com>
 <1519012D-6DDB-4ADA-923B-4132EFC9D9C5@nicira.com>
 <738D45BC1F695740A983F43CFE1B7EA9438D2EC8@IRSMSX108.ger.corp.intel.com>
Message-ID: <ABA57F4F-1438-4EBF-BB66-0093EC619E64@nicira.com>


> On Oct 29, 2015, at 9:33 AM, Gray, Mark D <mark.d.gray at intel.com> wrote:
> 
>>> On Oct 29, 2015, at 4:14 AM, Gray, Mark D <mark.d.gray at intel.com> wrote:
>>> 
>>> Hi,
>>> 
>>> Was this patch ever upstreamed? It doesn't seem to be in the code base?
>>> 
>>> http://openvswitch.org/pipermail/dev/2014-August/043913.html
>>> 
>>> Mark
>>> 
>> 
>> No, it would require rebasing. No immediate plans, but I could work on it
>> sometime later.
> 
> Was there any reason you stopped working on it? It seemed to be in quite an advanced
> state?

No particular reason, other priorities taking over I guess. I’m now busy with NAT but could pick this up after.

  Jarno


From keith.holleman at gmail.com  Thu Oct 29 11:36:48 2015
From: keith.holleman at gmail.com (Keith Holleman)
Date: Thu, 29 Oct 2015 11:36:48 -0700
Subject: [ovs-discuss] Flooding to multiple patch ports
Message-ID: <CAOSDr99ssQrLgiimkm=JQn=hL4TFZUtC5hVhbids1riDHBSdoA@mail.gmail.com>

I saw and followed the fairly recent discussion on the dev alias about
flooding and patch ports here:

http://openvswitch.org/pipermail/dev/2015-September/060118.html

But I have a slightly different question.  In one setup, I have two patch
ports connecting the same two bridges.  One bridge, is a "secure" bridge.
While not actually managed by a controller, it effectively is as all rules
are manually added in a very specific and controlled manner.  The other is
a standard stock "learning" bridge with only a normal action.  To borrow
and enhance the topology from the previous thread:

port_A --- br1 --- port_B (patch) ........ port_C (patch) --- br2 --- port_D

               --- port_E (patch) ........ port_F (patch) ---



The unexpected behavior that I'm seeing is that a broadcast packet
(say ARP) that arrives in br2 on patch port_C is not being flooded to
patch port_F.   That packet is however proper flooded to port_D and
any other ports (real or internal) in br2.  An ARP packet that arrives
on port_D is properly flooded to both port_C and port_F.  The rules in
BR1 do allow such a packet to arrive on port_A, leave on port_E, and
if it returns on port_B to to have a different set of rules applied
and may be resent out of port_A (or other ports in br1) after
modifications.


Other things learned from experiments:


1) a unicast frame that arrives on port_C destined for a MAC learned
in br2 on port_F is properly forwarded out of port_F.  From this I
assume there is not a complete failure in sending from one patch port
to another between two bridges.

2) if I attach a new patch-port to br2 to another bridge (say br3),
the arp packet that arrives on patch port_C is flooded on the new
patch port to the new bridge.  From this I assume that you can flood
across patch ports just fine.


But there seems to be something or some check that is preventing a
broadcast packet arriving on port_C to be flooded out of port_F?   Is
there anything specific someone knows of that would prevent this or
any specific output or debug that could shed light on it?


Thanks for any help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151029/b158c9b7/attachment.html>

From azhou at nicira.com  Thu Oct 29 12:06:17 2015
From: azhou at nicira.com (Andy Zhou)
Date: Thu, 29 Oct 2015 12:06:17 -0700
Subject: [ovs-discuss] [openvswitch 2.3.2] testsuite: 717 fails on s390x
In-Reply-To: <563213A8.6080700@linux.vnet.ibm.com>
References: <5630D413.10904@linux.vnet.ibm.com>
 <CACzMAJLBhkbksmMj6F0=B0VqpXweTdGOvehtc5hcD1fs91BDMw@mail.gmail.com>
 <563213A8.6080700@linux.vnet.ibm.com>
Message-ID: <CACzMAJKpuhbhRdyaqb0m4cA7KQrv5Sj8kwnsm5z+ZAg3PHH58g@mail.gmail.com>

On Thu, Oct 29, 2015 at 5:40 AM, Gerhard Stenzel
<gstenzel at linux.vnet.ibm.com> wrote:
>
> On 10/28/2015 09:05 PM, Andy Zhou wrote:
>> On Wed, Oct 28, 2015 at 6:56 AM, Gerhard Stenzel
> ...
>> Thanks for pointing out this patch was missing from branch-2.3. It
>> would be nice to figure out the remaining issues (if any) before
>> cherry pick it into branch 2.3.    Thanks.
>>
>
> When test case 717 fails, it seems the recirc_id is not as expected. So it
> is a different issue than the one fixed by
> 8ae8176fd0d8ed919e3301cc961dcf02b65ff49d
> When failing, the test case run takes a few seconds longer to complete.
>
> Here is the relevant part from the log file:
> ...
> ovs_wait
> stderr:
> stdout:
> ./ofproto-dpif.at:237: ovs-ofctl add-flows br-int flows.txt
> ./ofproto-dpif.at:241: ovs-appctl netdev-dummy/receive p5
> "in_port(5),eth(src=50:54:00:00:00:05,dst=50:54:00:00:01:00),eth_type(0x0800),ipv4(src=10.0.0.2,dst=10.0.0.1,proto=1,tos=0,ttl=64,frag=no)"
> ./ofproto-dpif.at:244: ovs-appctl upcall/disable-megaflows
> ./ofproto-dpif.at:247: ovs-appctl upcall/enable-megaflows
> ./ofproto-dpif.at:253: ovs-appctl bridge/dump-flows br1 | ofctl_strip | grep
> -- "n_packets" | grep -- "table_id" | sed -e
> 's/dp_hash=0x[0-9a-f][0-9a-f]*/dp_hash=0x0/' -e
> 's/output:[0-9][0-9a-f]*/output/'
> --- -   2015-10-29 12:50:26.431895261 +0100
> +++ /root/test/root/projects/ovs/tests/testsuite.dir/at-groups/717/stdout
> 2015-10-29 12:50:26.422746995 +0100
> @@ -1,2 +1,2 @@
> -table_id=254, n_packets=1, n_bytes=64,
> priority=20,recirc_id=0x12d,dp_hash=0x0/0xff,actions=output
> +table_id=254, n_packets=1, n_bytes=64,
> priority=20,recirc_id=0x12c,dp_hash=0x0/0xff,actions=output
> ..
Thanks for the information. I have never ran into this failure, but
now I can see how it is possible. It seems we
should also not match the exact value of recirc_id.  I will post a
patch for this.

In the mean time, I will merge
8ae8176fd0d8ed919e3301cc961dcf02b65ff49d into branch-2.3.
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From rayli1107 at gmail.com  Thu Oct 29 15:17:35 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Thu, 29 Oct 2015 15:17:35 -0700
Subject: [ovs-discuss] add-group issue
Message-ID: <CA+=-Fx9xp9TGYFk1W2uxAUtvZoP0gkU3xE=6ycEeFoC=xwmjaQ@mail.gmail.com>

Hi, I reinstall my system and OVS 2.4 recently, and this used to work but
isn't working anymore:

ovs-vsctl --may-exist add-br br -- set bridge br
protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15

ovs-ofctl add-group br_vxlan group_id=2147483647,type=all -O OpenFlow15

At which point I get this error:

OFPT_ERROR (OF1.5) (xid=0x2): OFPGMFC_BAD_BUCKET
OFPT_GROUP_MOD (OF1.5) (xid=0x2):
 ADD group_id=2147483647,type=all

Any idea what it means? I'm not sure why it's no longer working for me.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151029/4b9379ed/attachment.html>

From abhishek.lists at gmail.com  Thu Oct 29 16:36:26 2015
From: abhishek.lists at gmail.com (Abhishek Chanda)
Date: Thu, 29 Oct 2015 16:36:26 -0700
Subject: [ovs-discuss] Removing an OVS bridge using iproute2
Message-ID: <CACom5vo2CL6aWzGiqvPGpsBi-gaeS5MxknYmp0BBg0n6UPqfug@mail.gmail.com>

Hi,

I am running OVS in a privileged container. It adds a bridge using
"ovs-vsctl add-br br0". Once that container is removed, I need to
return the host in a clean state. I was hoping to do this
automatically by listening on docker events and running "sudo ip link
del br0" once the container is destroyed. But iproute2 returns
"operation not supported". These are the things I checked:

1. The nfnetfilter module is loaded
2. The bridge does not show up in brctl but shows up when I do a "ip a"

Is there any way to make this work?

Thanks

From lindongyi at bingosoft.net  Fri Oct 30 01:22:15 2015
From: lindongyi at bingosoft.net (=?gb2312?B?wda2rNLV?=)
Date: Fri, 30 Oct 2015 08:22:15 +0000
Subject: [ovs-discuss] Then QOS configuration,
	queue id is not greater than 0xF000.
Message-ID: <FF2F4EC3D0CFB74A88792D19E6C1C8C8BE54CFD8@YT-MAIL-04.bingosoft.local>

An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/de2c2f2e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2015-10-30 16:13:53屏幕截图.png
Type: image/png
Size: 22838 bytes
Desc: 2015-10-30 16:13:53屏幕截图.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/de2c2f2e/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2015-10-30 16:15:27屏幕截图.png
Type: image/png
Size: 31542 bytes
Desc: 2015-10-30 16:15:27屏幕截图.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/de2c2f2e/attachment-0005.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2015-10-30 16:18:10屏幕截图.png
Type: image/png
Size: 87719 bytes
Desc: 2015-10-30 16:18:10屏幕截图.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/de2c2f2e/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2015-10-30 16:19:45屏幕截图.png
Type: image/png
Size: 62179 bytes
Desc: 2015-10-30 16:19:45屏幕截图.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/de2c2f2e/attachment-0007.png>

From lindongyi at bingosoft.net  Fri Oct 30 01:33:59 2015
From: lindongyi at bingosoft.net (=?gb2312?B?wda2rNLV?=)
Date: Fri, 30 Oct 2015 08:33:59 +0000
Subject: [ovs-discuss] In Qos configuration,
	not for Peer network port configuration QOs
Message-ID: <FF2F4EC3D0CFB74A88792D19E6C1C8C8BE54D002@YT-MAIL-04.bingosoft.local>

An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/410a13ca/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2015-10-30 16:24:59屏幕截图.png
Type: image/png
Size: 28696 bytes
Desc: 2015-10-30 16:24:59屏幕截图.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/410a13ca/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 2015-10-30 16:32:15屏幕截图.png
Type: image/png
Size: 109581 bytes
Desc: 2015-10-30 16:32:15屏幕截图.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/410a13ca/attachment-0003.png>

From azhou at nicira.com  Fri Oct 30 11:33:52 2015
From: azhou at nicira.com (Andy Zhou)
Date: Fri, 30 Oct 2015 11:33:52 -0700
Subject: [ovs-discuss] [openvswitch 2.3.2] testsuite: 717 fails on s390x
In-Reply-To: <CACzMAJKpuhbhRdyaqb0m4cA7KQrv5Sj8kwnsm5z+ZAg3PHH58g@mail.gmail.com>
References: <5630D413.10904@linux.vnet.ibm.com>
 <CACzMAJLBhkbksmMj6F0=B0VqpXweTdGOvehtc5hcD1fs91BDMw@mail.gmail.com>
 <563213A8.6080700@linux.vnet.ibm.com>
 <CACzMAJKpuhbhRdyaqb0m4cA7KQrv5Sj8kwnsm5z+ZAg3PHH58g@mail.gmail.com>
Message-ID: <CACzMAJKSnUTFP7Fx=Fk-s4vHokB2=7b+BXLXF4e3c2v+mD0DiQ@mail.gmail.com>

> Thanks for the information. I have never ran into this failure, but
> now I can see how it is possible. It seems we
> should also not match the exact value of recirc_id.  I will post a
> patch for this.

This is done, I have pushed the patch to master, branch-2.4 and 2.3.
>
> In the mean time, I will merge
> 8ae8176fd0d8ed919e3301cc961dcf02b65ff49d into branch-2.3.

This is done as well.

From jeff.forbes at mail.nacon.com  Fri Oct 30 14:04:18 2015
From: jeff.forbes at mail.nacon.com (Jeff Forbes)
Date: Fri, 30 Oct 2015 21:04:18 +0000
Subject: [ovs-discuss] discuss Digest, Vol 76, Issue 95
Message-ID: <rp0otxsqrlvpvs8kucedahti.1446239052576@email.android.com>





Sent on the new Sprint Network from my Samsung Galaxy S®4


-------- Original message --------
From: discuss-request at openvswitch.org
Date: 10/30/2015 3:00 PM (GMT-05:00)
To: discuss at openvswitch.org
Subject: discuss Digest, Vol 76, Issue 95

Send discuss mailing list submissions to
        discuss at openvswitch.org

To subscribe or unsubscribe via the World Wide Web, visit
        http://openvswitch.org/mailman/listinfo/discuss
or, via email, send a message with subject or body 'help' to
        discuss-request at openvswitch.org

You can reach the person managing the list at
        discuss-owner at openvswitch.org

When replying, please edit your Subject line so it is more specific
than "Re: CoqNContents of discuss digest..."


Today's Topics:

   1. Re: [openvswitch 2.3.2] testsuite: 717 fails on s390x (Andy Zhou)


----------------------------------------------------------------------

Message: 1
Date: Fri, 30 Oct 2015 11:33:52 -0700
From: Andy Zhou <azhou at nicira.com>
To: Gerhard Stenzel <gstenzel at linux.vnet.ibm.com>
Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
Subject: Re: [ovs-discuss] [openvswitch 2.3.2] testsuite: 717 fails on
        s390x
Message-ID:
        <CACzMAJKSnUTFP7Fx=Fk-s4vHokB2=7b+BXLXF4e3c2v+mD0DiQ at mail.gmail.com>
Content-Type: text/plain; charset=UTF-8

> Thanks for the information. I have never ran into this failure, but
> now I can see how it is possible. It seems we
> should also not match the exact value of recirc_id.  I will post a
> patch for this.

This is done, I have pushed the patch to master, branch-2.4 and 2.3.
>
> In the mean time, I will merge
> 8ae8176fd0d8ed919e3301cc961dcf02b65ff49d into branch-2.3.

This is done as well.


------------------------------

Subject: Digest Footer

_______________________________________________
discuss mailing list
discuss at openvswitch.org
http://openvswitch.org/mailman/listinfo/discuss


------------------------------

End of discuss Digest, Vol 76, Issue 95
***************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/bc8ebdd7/attachment.html>

From gavin_remaley at selinc.com  Thu Oct 29 08:39:39 2015
From: gavin_remaley at selinc.com (gavin_remaley at selinc.com)
Date: Thu, 29 Oct 2015 09:39:39 -0600
Subject: [ovs-discuss] In-band comm with OF-only Switches
Message-ID: <OF72A47138.643BB0BE-ON88257EED.00554FFF-87257EED.00560815@selinc.com>

Has a general strategy been established for establishing initial in-band 
communication with OF-only Switches?

Note that I have read the OVS Design document "In-Ban" discussion and 
looked at the OVS code where the default flows are established.

The default flows seem to assume a Hybrid Switch.  They use the "NORMAL" 
output port, which is not even supported by an OF-only Switch.  Some of 
the default flows seems to rely on a bit of (hybrid) Switch intelligence. 
If the NORMAL port is just replaced with LOCAL, there is still some work 
to do when sending replies... do we send them out all ports (probably not 
good), or do we implement some normal Switch capability (a departure from 
OF-only?) to decide what specific port to transmit on?

It seems like establishing comms with "dumb" OF-only Switches is a bit 
tricky and probably just not as easy as using the NORMAL port, as for 
Hybrid Switches.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151029/65b62ef8/attachment.html>

From tech.kals at gmail.com  Fri Oct 30 00:59:25 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Fri, 30 Oct 2015 13:29:25 +0530
Subject: [ovs-discuss] ofproto: Send port status message for port-mods from
	OVS to controller
Message-ID: <CAHWErLdbB+FeBdp+ye3crkgGvjKeLh+D4B6Ui5Q-CHWmRUQ2ug@mail.gmail.com>

Hi folks,

As per openflow specification, if port config bits are changed by the
switch through another administrative interface, the switch sends an
OFPT_PORT_STATUS message to notify the controller of the change. Does OVS
supports this functionality?

If OVS doesn't support this then how a switch would inform the controller
when a port is configured to admin down through by some other
administrative interface like CLI.

Can someone quickly clarify my doubt ?

Thanks,
~Kals~
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/55983c6b/attachment.html>

From nick.bastin at gmail.com  Fri Oct 30 19:08:48 2015
From: nick.bastin at gmail.com (Nicholas Bastin)
Date: Fri, 30 Oct 2015 19:08:48 -0700
Subject: [ovs-discuss] In-band comm with OF-only Switches
In-Reply-To: <OF72A47138.643BB0BE-ON88257EED.00554FFF-87257EED.00560815@selinc.com>
References: <OF72A47138.643BB0BE-ON88257EED.00554FFF-87257EED.00560815@selinc.com>
Message-ID: <CADmMkWcUb57Kviewbq9Qf=90jUMzo83Ok9c2k=L5L27=oda8MA@mail.gmail.com>

On Thu, Oct 29, 2015 at 8:39 AM, <gavin_remaley at selinc.com> wrote:

> Has a general strategy been established for establishing initial in-band
> communication with OF-only Switches?


Do you mean OF-only OVS instances, or just OF-only switches in general?

For run-of-the-mill OF-only switches the strategy is a fairly simply
fan-out from the switch(es) your controller is connected to, slowly working
out to the edge of the network as you install rules in each switch along
the way to bring control packets back to your controller.

In an environment with no drops or failures it's completely trivial.  If
you encounter topology changes during the initial process it's a bit more
complex, but nothing too problematic.  More complexity can come into play
if you have OF-only devices that can't make a deep enough packet match to
discriminate control traffic from other traffic you'd like to treat
differently, but that's life.

--
Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/55522b80/attachment-0001.html>

From iwp.yash at gmail.com  Fri Oct 30 20:17:43 2015
From: iwp.yash at gmail.com (Yash Thadhani)
Date: Fri, 30 Oct 2015 20:17:43 -0700
Subject: [ovs-discuss] Attempting to use OpenStack Kilo with OVS-DPDK
Message-ID: <CAMKg0NkRhEO5W3xkOFC-uR8UZnBdJVZowRFeMOfRQpbqb+m+Rg@mail.gmail.com>

Hello everyone,

                       I happened to come across this thread:
https://www.mail-archive.com/discuss at openvswitch.org/msg13925.html, I had a
couple of queries, it would great if someone could guide me.



Firstly, I am using RDO based Packstack (running Kilo) running on CentOS
7.0 servers. Would I still be able to use the networking-ovs-dpdk repo or
would it work only with Devstack?


Secondly, I was able to get OVS 2.4.0 with DPDK 2.1.0 working and was able
to spawn a VM using Libvirt xml. However, the thread clearly states that
support for vhost-user with OpenStack is available for DPDK 2.0.0. I am
supposed to use DPDK 2.1.0 only, would this cause a problem?


Thirdly, I was unable to access the local config example or usage document.
Is running the setup.py all it takes to install the agent? Is there any way
to specify the prefix where I would like my files to be installed to. Some
installations pick the default prefix as /usr/local however, I wish to
modify that to “/” only.


Thanks for your help,

Yash.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/8701c2db/attachment.html>

From sgirem463 at gmail.com  Fri Oct 30 19:51:01 2015
From: sgirem463 at gmail.com (Allan Lue)
Date: Fri, 30 Oct 2015 19:51:01 -0700
Subject: [ovs-discuss] conntrack feature detection
Message-ID: <7A8EF923-9476-44CE-A169-1975F27510AD@gmail.com>

Ben, Justin,
>> On Aug 31, 2015, at 8:40 PM, Ben Warren <ben at skyportsystems.com <http://openvswitch.org/mailman/listinfo/discuss>> wrote:
>> 
>> It’s exciting to see conntrack support being accepted in the Linux kernel.  We’ve been building based on the 
>> justinpettit/ovs tree and so far it works like a charm. Nice work!
>
> Great to hear that it's working for you!

I am new to ovs and github.
I downloaded the zip file from https://github.com/justinpettit/ovs/tree/conntrack <https://github.com/justinpettit/ovs/tree/conntrack>
However there is no “configure” file in the contract directory, it has “boot.sh” but
it doesn’t work.
The same ubuntu environment build the 2.4.0 ovs successfully?
Am I missing something?
The https clone link https://github.com/justinpettit/ovs.git <https://github.com/justinpettit/ovs.git> seems incorrect.
Appreciate your help.

— Allan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/9e89f831/attachment-0001.html>

From tech.kals at gmail.com  Fri Oct 30 21:25:33 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Sat, 31 Oct 2015 09:55:33 +0530
Subject: [ovs-discuss] ofproto: Send port status message for port-mods
	from OVS to controller
In-Reply-To: <CAHWErLdbB+FeBdp+ye3crkgGvjKeLh+D4B6Ui5Q-CHWmRUQ2ug@mail.gmail.com>
References: <CAHWErLdbB+FeBdp+ye3crkgGvjKeLh+D4B6Ui5Q-CHWmRUQ2ug@mail.gmail.com>
Message-ID: <CAHWErLcE_Jj_mw804B=NJQzT_S3+k664LLESV1+VCFeCec-YyA@mail.gmail.com>

could someone have a look at this qury ?

Hi Ben,
  Could you please clarify my doubt ?

On Fri, Oct 30, 2015 at 1:29 PM, tech_kals Kals <tech.kals at gmail.com> wrote:

> Hi folks,
>
> As per openflow specification, if port config bits are changed by the
> switch through another administrative interface, the switch sends an
> OFPT_PORT_STATUS message to notify the controller of the change. Does OVS
> supports this functionality?
>
> If OVS doesn't support this then how a switch would inform the controller
> when a port is configured to admin down through by some other
> administrative interface like CLI.
>
> Can someone quickly clarify my doubt ?
>
> Thanks,
> ~Kals~
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151031/41198ebb/attachment-0001.html>

From sgirem463 at gmail.com  Fri Oct 30 22:03:09 2015
From: sgirem463 at gmail.com (Allan Lue)
Date: Fri, 30 Oct 2015 22:03:09 -0700
Subject: [ovs-discuss] conntrack feature detection
In-Reply-To: <7A8EF923-9476-44CE-A169-1975F27510AD@gmail.com>
References: <7A8EF923-9476-44CE-A169-1975F27510AD@gmail.com>
Message-ID: <66383F1D-0AE2-4BBE-A507-D8FD6CDFA7DF@gmail.com>

I figured it out, need to install libtool

— Allan

On Oct 30, 2015, at 7:51 PM, Allan Lue <sgirem463 at gmail.com> wrote:
> 
> Ben, Justin,
> >> On Aug 31, 2015, at 8:40 PM, Ben Warren <ben at skyportsystems.com <http://openvswitch.org/mailman/listinfo/discuss>> wrote:
> >> 
> >> It’s exciting to see conntrack support being accepted in the Linux kernel.  We’ve been building based on the 
> >> justinpettit/ovs tree and so far it works like a charm. Nice work!
> >
> > Great to hear that it's working for you!
> 
> I am new to ovs and github.
> I downloaded the zip file from https://github.com/justinpettit/ovs/tree/conntrack <https://github.com/justinpettit/ovs/tree/conntrack>
> However there is no “configure” file in the contract directory, it has “boot.sh” but
> it doesn’t work.
> The same ubuntu environment build the 2.4.0 ovs successfully?
> Am I missing something?
> The https clone link https://github.com/justinpettit/ovs.git <https://github.com/justinpettit/ovs.git> seems incorrect.
> Appreciate your help.
> 
> — Allan
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151030/cfd4f019/attachment-0001.html>

From gtvrreddy at gmail.com  Sat Oct 31 00:47:20 2015
From: gtvrreddy at gmail.com (Ramana Reddy)
Date: Sat, 31 Oct 2015 13:17:20 +0530
Subject: [ovs-discuss] Installing VM on KVM hypervisor in Ubuntu 14.04
 with OVS bridge
In-Reply-To: <CAL2CrsP2XS5qZLGCTCcxkAOWrqd8wXjT+yKcKYgLHfxcuvpK7g@mail.gmail.com>
References: <CAL2CrsOxTMsCrWGgsEZopeGYYGTry_WCmqP1mwntuisQC6+7AQ@mail.gmail.com>
 <F25B09B4-21AE-44C6-8FEE-CBCAD49BD72A@scottlowe.org>
 <CAL2CrsMcvMq4SKRXjKrOuy3LWm_ruA2OEcy=S8Y++9DK9oam9w@mail.gmail.com>
 <6F40562A-28DD-4B2F-B54C-60D8B30321B6@scottlowe.org>
 <CAL2CrsOYRU2VbBRGhMi=Bw3zTeEqoqgT9SnWHV5vHNsjXJv57g@mail.gmail.com>
 <D5BAA2D9-9F9C-44FC-AD6F-CB9F985DA5A2@scottlowe.org>
 <CAL2CrsP2XS5qZLGCTCcxkAOWrqd8wXjT+yKcKYgLHfxcuvpK7g@mail.gmail.com>
Message-ID: <CAL2CrsNm_6cJNprms_oWsfwbqZ0q6Bhx_voKc0oXQ3XCMi3oNw@mail.gmail.com>

Hi Scott,

After using --network=network:br0 , its working.

Here is the actual command:

$sudo virt-install --connect qemu:///system --force --name VM2 --ram=1024
--vcpus=1 --disk path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2
--cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc
--os-variant=ubuntutrusty --network=network:br0,model=virtio

Thanks & Regards,
Ramana

On Tue, Oct 6, 2015 at 1:09 AM, Ramana Reddy <gtvrreddy at gmail.com> wrote:

> After modifications also, I got the same error:
> ERROR    Error in network device parameters: Unknown network type br0
>
> I am using Ubuntu 14.04 (64-bit) and libvirt 1.2.2 and OVS 2.4.0
>
> May be I will try from scratch and let you know.
>
>
> On Tue, Oct 6, 2015 at 12:56 AM, Scott Lowe <scott.lowe at scottlowe.org>
> wrote:
>
>> Please see my responses inline, prefixed by [SL].
>>
>>
>> Ramana Reddy <gtvrreddy at gmail.com> wrote:
>>
>> > I got the following error after trying this command:
>> >
>> > $sudo virt-install --connect qemu:///system --force --name VM2
>> --ram=1024 --vcpus=1 --disk
>> path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2
>> --cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc
>> --os-variant=ubuntutrusty --network=br0,model=virtio
>> > ERROR    Error in network device parameters: Unknown network type br0
>> >
>> > br0.xml file:
>> >  <network>
>> >    <name>br0</name>
>> >    <forward mode='bridge'/>
>> >    <bridge name='br0'/>
>> >    <virtualport type='openvswitch'/>
>> >   </network>
>> >
>> > Did I miss something.
>>
>>
>> [SL] Try adding a portgroup, like this:
>>
>>
>> <network>
>>   <name>br0</name>
>>   <forward mode='bridge'/>
>>   <bridge name='br0'/>
>>   <virtualport type='openvswitch'/>
>>   <portgroup name='default' default='yes'>
>>   </portgroup>
>> </network>
>>
>> Let me know how that works. I'm using this configuration actively right
>> now on Ubuntu 14.04, KVM, libvirt 1.2.2, and OVS 2.3.2.
>>
>>
>> > On Tue, Oct 6, 2015 at 12:34 AM, Scott Lowe <scott.lowe at scottlowe.org>
>> wrote:
>> > Please see my responses inline, prefixed by [SL].
>> >
>> > Ramana Reddy <gtvrreddy at gmail.com> wrote:
>> >
>> > > Hi Scott,
>> > >
>> > > I followed your blog mentioned in the url. I tried the following
>> steps:
>> > >
>> > > Create a br0.xml file:
>> > > <network>
>> > >   <name>br0</name>
>> > >   <forward mode='bridge'/>
>> > >   <bridge name='br0'/>
>> > >   <virtualport type='openvswitch'/>
>> > > </network>
>> > >
>> > > $sudo virsh net-define br0.xml
>> > > Network br0 defined from br0.xml
>> > >
>> > > $sudo virsh net-start br0
>> > > Network br0 started
>> > >
>> > > $sudo virsh net-list --all
>> > >  Name                 State      Autostart     Persistent
>> > > ----------------------------------------------------------
>> > >  br0                  active     no            yes
>> > >
>> > > $sudo qemu-img create -f qcow2 /var/lib/libvirt/images/VM2.img 8G
>> > > Formatting '/var/lib/libvirt/images/VM2.img', fmt=qcow2
>> size=8589934592 encryption=off cluster_size=65536 lazy_refcounts=off
>> > >
>> > > $sudo virt-install --connect qemu:///system --force --name VM2
>> --ram=1024 --vcpus=1 --disk
>> path=/var/lib/libvirt/images/VM2.img,size=8,format=qcow2
>> --cdrom=/home/ramanar/Downloads/ubuntu-14.04.3-server-amd64.iso --vnc
>> --os-variant=ubuntutrusty --network=bridge:br0,model=virtio
>> > >
>> > > Starting install...
>> > > ERROR    Unable to add bridge br0 port vnet0: Operation not supported
>> > > Domain installation does not appear to have been successful.
>> > > If it was, you can restart your domain by running:
>> > >   virsh --connect qemu:///system start VM2
>> > >
>> > > $sudo ovs-vsctl show
>> > > 92d0c0b6-bbbb-4f86-aebd-ec4cc33653a3
>> > >     Bridge "br0"
>> > >         Port "br0"
>> > >             Interface "br0"
>> > >                 type: internal
>> > >         Port "eth0"
>> > >             Interface "eth0"
>> > >
>> > >
>> > >
>> > > Any idea why this approach is not working.
>> >
>> >
>> > [SL] If you create a libvirt network to "front end" the OVS bridge,
>> then you would no longer use "--network=bridge:br0,model=virtio" but
>> "--network=br0,model=virtio" (specifying the name of the libvirt network
>> that you created).
>> >
>> > Hope this makes sense.
>> >
>> >
>> > > Some how the second method is working fine. I created a VM using NAT,
>> and then modified VM XML file as per instructions mentioned below:
>> > > <interface type='bridge'>
>> > >   <mac address='52:54:00:71:b1:b6'/>
>> > >   <source bridge='br0'/>
>> > >   <virtualport type='openvswitch'/>
>> > >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
>> function='0x0'/>
>> > >  </interface>
>> > >
>> > > This is working now. I tried this one previously, and not working.
>> May be it messed up with some thing!!
>> > >
>> > > Thanks for all your inputs. I thought that I can go with my old setup
>> (ubuntu 12.04 with brcompat module with ovs 1.9.3: it was working well).
>> > >
>> > >
>> > >
>> > >
>> > >
>> > >
>> > > On Mon, Oct 5, 2015 at 9:51 PM, Scott Lowe <scott.lowe at scottlowe.org>
>> wrote:
>> > > Please see my response below.
>> > >
>> > > Ramana Reddy <gtvrreddy at gmail.com> wrote:
>> > >
>> > > > Hi all,
>> > > >
>> > > > I installed a VM in NAT mode using virt-manager and edited the xml
>> file as per the
>> > > > instructions  given in this link:
>> > > >
>> > > >
>> http://git.openvswitch.org/cgi-bin/gitweb.cgi?p=openvswitch;a=blob_plain;f=INSTALL.Libvirt;hb=HEAD
>> > > >
>> > > > Basically It tells the following modofications:
>> > > > And change it to something like this:
>> > > >
>> > > >  ...
>> > > >  <interface type='bridge'>
>> > > >   <mac address='52:54:00:71:b1:b6'/>
>> > > >   <source bridge='ovsbr'/>
>> > > >   <virtualport type='openvswitch'/>
>> > > >   <address type='pci' domain='0x0000' bus='0x00' slot='0x03'
>> function='0x0'/>
>> > > >  </interface>
>> > > >  ...
>> > > >
>> > > > After modifications, I started VM. But its throwing the errors:
>> Unable to complete install: 'Unable to add bridge br0 port vnet0: Operation
>> not supported'
>> > > >
>> > > > I started VM with both virsh start VM and virt-manager, but both
>> are giving the same error.
>> > > >
>> > > > Does any one face the same problem. Please help me in this regards.
>> > >
>> > >
>> > >
>> > > Can you share the actual XML you're using (just the network interface
>> portion is needed), along with the output of "ovs-vsctl show"?
>> > >
>> > > Also, I (personally) find the easiest way to work with
>> libvirt+KVM+OVS is to use a libvirt network wrapped around OVS, as
>> described here:
>> > >
>> > > <
>> http://blog.scottlowe.org/2012/11/07/using-vlans-with-ovs-and-libvirt/>
>> > >
>> > > --
>> > > Scott
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151031/8f56bc1a/attachment.html>

From chy019 at eng.ucsd.edu  Sat Oct 31 13:34:44 2015
From: chy019 at eng.ucsd.edu (Hans Yu)
Date: Sat, 31 Oct 2015 13:34:44 -0700
Subject: [ovs-discuss] Frames are dropped if its input port and output
 port are the same
In-Reply-To: <C5B2EF13-3C59-4A80-B6C7-B527A3F64F38@nicira.com>
References: <CAPZMhkKwgYgg5A0oBwYjF_4WD6iVoQtxTuMraC-97C2w5zCSnA@mail.gmail.com>
 <C5B2EF13-3C59-4A80-B6C7-B527A3F64F38@nicira.com>
Message-ID: <CAPZMhkJ5neEBFKGkO_DPDQo69KsdtEqH=A=EJaqYC5A7XrhoQA@mail.gmail.com>

Hi Justin,

Thanks for the reply. Now I configured my controller to set output port
as OFPP_IN_PORT to take care of these frames and it worked.

Best,

Hans

On Thu, Oct 22, 2015 at 4:15 PM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Oct 22, 2015, at 4:07 PM, Hans Yu <chy019 at eng.ucsd.edu> wrote:
> >
> > Hi,
> >
> > I noticed that my Ethernet frames are dropped when their input ports are
> the same as their output ports. Even though I have the right rule installed
> on to Open vSwitch bridge from my controller, they still get dropped.
>
> From the FAQ:
>
> ### Q: I added a flow to send packets out the ingress port, like this:
>
>        ovs-ofctl add-flow br0 in_port=2,actions=2
>
>    but OVS drops the packets instead.
>
> A: Yes, OpenFlow requires a switch to ignore attempts to send a packet
>    out its ingress port.  The rationale is that dropping these packets
>    makes it harder to loop the network.  Sometimes this behavior can
>    even be convenient, e.g. it is often the desired behavior in a flow
>    that forwards a packet to several ports ("floods" the packet).
>
>    Sometimes one really needs to send a packet out its ingress port
>    ("hairpin"). In this case, output to OFPP_IN_PORT, which in
>    ovs-ofctl syntax is expressed as just "in_port", e.g.:
>
>        ovs-ofctl add-flow br0 in_port=2,actions=in_port
>
>    This also works in some circumstances where the flow doesn't match
>    on the input port.  For example, if you know that your switch has
>    five ports numbered 2 through 6, then the following will send every
>    received packet out every port, even its ingress port:
>
>        ovs-ofctl add-flow br0 actions=2,3,4,5,6,in_port
>
>    or, equivalently:
>
>        ovs-ofctl add-flow br0 actions=all,in_port
>
>    Sometimes, in complicated flow tables with multiple levels of
>    "resubmit" actions, a flow needs to output to a particular port
>    that may or may not be the ingress port.  It's difficult to take
>    advantage of OFPP_IN_PORT in this situation.  To help, Open vSwitch
>    provides, as an OpenFlow extension, the ability to modify the
>    in_port field.  Whatever value is currently in the in_port field is
>    the port to which outputs will be dropped, as well as the
>    destination for OFPP_IN_PORT.  This means that the following will
>    reliably output to port 2 or to ports 2 through 6, respectively:
>
>        ovs-ofctl add-flow br0 in_port=2,actions=load:0->NXM_OF_IN_PORT[],2
>        ovs-ofctl add-flow br0 actions=load:0->NXM_OF_IN_PORT[],2,3,4,5,6
>
>    If the input port is important, then one may save and restore it on
>    the stack:
>
>         ovs-ofctl add-flow br0 actions=push:NXM_OF_IN_PORT[],\
>                                        load:0->NXM_OF_IN_PORT[],\
>                                        2,3,4,5,6,\
>                                        pop:NXM_OF_IN_PORT[]
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151031/1a26028d/attachment-0001.html>


From maryam.tahhan at intel.com  Wed Jul  1 02:05:48 2015
From: maryam.tahhan at intel.com (Tahhan, Maryam)
Date: Wed, 1 Jul 2015 09:05:48 +0000
Subject: [ovs-discuss] TOIT 2.0 AKA VSPERF Release Announcement
Message-ID: <1A27633A6DA49C4A92FCD5D4312DBF536A455E52@IRSMSX109.ger.corp.intel.com>

Hi Folks

I would like to highlight the release of a new version of TOIT to the vSwitch Characterization project in OPNFV. 

TOIT was refactored to create a more generic framework that would allow for the performance testing of multiple vSwitches. 

**Refresh**: TOIT is an Apache licensed test framework that was developed in Python 2.7 to enable integration testing of Open vSwitch (OVS), and in particular the netdev-dpdk bridge in OVS. TOIT was adopted for the the "Characterize vSwitch Performance for Telco NFV Use Cases" OPNFV project (VSPERF). The main goal of VSPERF is to develop a generic and architecture agnostic vSwitch testing framework and associated tests that will serve as a basis for validating the suitability of different vSwitch implementations in Telco NFV environments. TOIT was extended as a starting point to help achieve the project goal. However, TOITs format was not generic enough to cater for different vSwitches and was redesigned/implemented to be more generic.

The new design allows developers to add different implementations of components, specifically vSwitches, Traffic Generators, Metrics Collectors and VNFs, easily. The goal of this design is that all testcases should run regardless of what is "under the hood".

The framework currently supports a phy to phy RFC2544 testcase only.

vSwitches supported at this time:
 * Open vSwitch (dpdk-netdev)
 * We plan on supporting the kernel datapath soon.

Traffic Generators supported at this time:
 * IxNet - IxNetwork Implementation
 * Ixia - IxExplorer Implementation
 * Dummy - Manual Implementation

Metrics Collectors supported at this time:
 * Linux Metrics

No VNFs are supported at this time but the framework outlines how they should be integrated and provides APIs for them to adhere to.

What's new in VSPERF:
  * CentOS7 support
  * Verified on CentOS7
  * Migrated to Python3

The code is available to view @ https://gerrit.opnfv.org/gerrit/gitweb?p=vswitchperf.git;a=tree or to clone from: https://gerrit.opnfv.org/gerrit/vswitchperf.

Setup guides are in the docs/ directory (https://gerrit.opnfv.org/gerrit/gitweb?p=vswitchperf.git;a=tree;f=docs;h=05a538ba50d29266355a85cb8f6185c9d6cd29fe;hb=HEAD ).

If there are any questions please drop me an email.

Best Regards, 
Maryam


From mark.d.gray at intel.com  Wed Jul  1 03:19:29 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Wed, 1 Jul 2015 10:19:29 +0000
Subject: [ovs-discuss] TOIT 2.0 AKA VSPERF Release Announcement
In-Reply-To: <1A27633A6DA49C4A92FCD5D4312DBF536A455E52@IRSMSX109.ger.corp.intel.com>
References: <1A27633A6DA49C4A92FCD5D4312DBF536A455E52@IRSMSX109.ger.corp.intel.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E2A7D5A@IRSMSX108.ger.corp.intel.com>

> 
> Hi Folks
> 
> I would like to highlight the release of a new version of TOIT to the vSwitch
> Characterization project in OPNFV.
> 
A tool like this could help ensure that there is no unexpected degradation
in performance. Perhaps it could be used to gate patches to prevent performance
drops of the type that Jesse's patch fixed this morning?

From mark.b.kavanagh at intel.com  Wed Jul  1 07:57:54 2015
From: mark.b.kavanagh at intel.com (Kavanagh, Mark B)
Date: Wed, 1 Jul 2015 14:57:54 +0000
Subject: [ovs-discuss] Vxlan encapsulation exceeds the MTU of dpdk port .
In-Reply-To: <558BAD5C.9000402@dtdream.com>
References: <558BAD5C.9000402@dtdream.com>
Message-ID: <DC5AD7FA266D86499789B1BCAEC715F85C42A760@irsmsx105.ger.corp.intel.com>

>As following topology, two VMs communicate via Vxlan tunnel.
>TCP pkts may be droped for exceeding the mtu of host DPDK port in br2.
>Now I can change the VMs' mtu from default to smaller to accommodate the
>traffics, it works well.
>
>The way I have not find to change mtu of DPDK phy port, is there a
>blueprint for supporting this by ovs, like "ovs-appctl
>netdev-dpdk/set-xxx" or another way?
>
>         Host1                  |                     Host2
>                     (l-ip)-   L3    -(r-ip)
>-----   -----        -----     |     -----       -----  ----- -----
>|VM1| --|br1|Vxlan --|br2|DPDK---DPDK|br2|--Vxlan|br2|--|br1|--|VM2|
>-----   -----        -----     |     -----       -----  ----- -----
>
>_______________________________________________
>discuss mailing list
>discuss at openvswitch.org
>http://openvswitch.org/mailman/listinfo/discuss

Hi,

There is currently no way to configure the MTU of a DPDK phy port at runtime.

Theoretically, enabling jumbo frames and adjusting the dev's max_rx_pkt_len in the rte_eth_conf, (and consequently, the size of mbufs in the mempool) could work; however, OVS sets the MTU for all ports to the minimum of the non-datapath ports, so you might need to play around with it. This is something that I plan on looking at in the next few weeks (compile-time option, not runtime).

Thanks,
Mark 

From diproiettod at vmware.com  Wed Jul  1 11:05:42 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Wed, 1 Jul 2015 18:05:42 +0000
Subject: [ovs-discuss] Openvswitch with DPDK issue
In-Reply-To: <856464988.1284599.1435619303789.JavaMail.yahoo@mail.yahoo.com>
References: <D1AF45AE.3513%diproiettod@vmware.com>
 <856464988.1284599.1435619303789.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <D1B9E7E0.3D6B%diproiettod@vmware.com>

One of the problems might be that after starting ovsdb-server
you should also start ovs-vswitchd.  Please see INSTALL.DPDK.

Also, OVS 2.3 supports only DPDK 1.6.  I would recommend to
take OVS from the git repository, branch-2.4 and use it with
DPDK 2.0.

On 30/06/2015 00:08, "Sundar Ramakrishnan" <sundar_ramki at yahoo.com> wrote:

>Thanks to Daniele, I have openvswitch compiled with dpdk. The way I
>installed is posted sundar-ramki/ovs-dpdk
><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_sundar-2D
>ramki_ovs-2Ddpdk_blob_master_OVS-2DDPDK-2DRHEL.Install&d=BQMFaQ&c=Sqcl0Ez6
>M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJq
>Z2uWLlE&m=RC1iGY-tlGnL-Rfetu2Dr1UGh-Sz61bloCGxOTHrin8&s=yPHTaOIyMy-LqFU1pC
>JUspiArNQVVk8-99zJj3tyaW8&e=>.
> 
> 
> 
><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_sundar-2D
>ramki_ovs-2Ddpdk_blob_master_OVS-2DDPDK-2DRHEL.Install&d=BQMFaQ&c=Sqcl0Ez6
>M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJq
>Z2uWLlE&m=RC1iGY-tlGnL-Rfetu2Dr1UGh-Sz61bloCGxOTHrin8&s=yPHTaOIyMy-LqFU1pC
>JUspiArNQVVk8-99zJj3tyaW8&e=>
> 
> 
> 
> 
> 
>sundar-ramki/ovs-dpdk
><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_sundar-2D
>ramki_ovs-2Ddpdk_blob_master_OVS-2DDPDK-2DRHEL.Install&d=BQMFaQ&c=Sqcl0Ez6
>M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJq
>Z2uWLlE&m=RC1iGY-tlGnL-Rfetu2Dr1UGh-Sz61bloCGxOTHrin8&s=yPHTaOIyMy-LqFU1pC
>JUspiArNQVVk8-99zJj3tyaW8&e=>
>ovs-dpdk - Openvswitch with DPDK
>
>
>
>View
> on github.com 
><https://urldefense.proofpoint.com/v2/url?u=https-3A__github.com_sundar-2D
>ramki_ovs-2Ddpdk_blob_master_OVS-2DDPDK-2DRHEL.Install&d=BQMFaQ&c=Sqcl0Ez6
>M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJq
>Z2uWLlE&m=RC1iGY-tlGnL-Rfetu2Dr1UGh-Sz61bloCGxOTHrin8&s=yPHTaOIyMy-LqFU1pC
>JUspiArNQVVk8-99zJj3tyaW8&e=>
>Preview
> by Yahoo
>
> 
>
>
>
>
>
>I have the following questions -
>
>
>1. How do I figure out if my VM is really using Openvswitch with DPDK?
>
>
>2. Are there any counters for packets entering and leaving the switch
>and/or dpdk?
>
>
>3. Also, I am unable to use the ofctl commands. Following is what I get -
>
>
>[root at test1 ~]# ovs-ofctl show br23
>ovs-ofctl: br23 is not a bridge or a socket
>[root at test1 ~]# ovs-vsctl show
>d8cfc890-a4fc-4398-869c-59c5412a3e79
>    Bridge "br23"
>        Port "eth3"
>            Interface "eth3"
>        Port "br23"
>            Interface "br23"
>                type: internal
>        Port "eth2"
>            Interface "eth2"
>
>
>Any input will be appreciated.
>
>
>Thank you
>SRK
>
>
>
>
>
>
>On Tuesday, June 23, 2015 12:25 PM, Daniele Di Proietto
><diproiettod at vmware.com> wrote:
>
>
>
>Hi,
>
>OVS 2.3.2 supports DPDK 1.6, as stated in INSTALL.DPDK.
>Many APIs have changed in DPDK in a backward incompatible
>way.
>
>Also, DPDK support in OVS 2.3.2 is experimental.  It would be
>better to use the code from branch-2.4 (with DPDK 2.0)
>
>Daniele
>
>
>On 22/06/2015 23:30, "Sundar Ramakrishnan" <sundar_ramki at yahoo.com> wrote:
>
>>
>>Hello,
>>
>>
>>I am a newbie to this environment and I am unable to find which release
>>of DPDK works fine with Openvswitch. I hope you could enlighten me with
>>some docs or references with which I could build a working setup -
>>
>>
>>RHEL 6.6
>>DPDK - 1.7.1
>>OVS - 2.3.1
>>
>>
>>Following are some steps I figured out from the web & my experiments -
>>
>>
>>Error:
>>
>>
>>/usr/src/dpdk-1.7.1/x86_64-native-linuxapp-gcc/include/rte_common.h: In
>>function ârte_is_alignedâ:
>>/usr/src/dpdk-1.7.1/x86_64-native-linuxapp-gcc/include/rte_common.h:176:
>>warning: cast from function call of type âuintptr_tâ to non-matching type
>>âvoid *â
>>lib/netdev-dpdk.c: In function âdpdk_class_initâ:
>>lib/netdev-dpdk.c:1081: warning: implicit declaration of function
>>ârte_pmd_init_allâ
>>lib/netdev-dpdk.c: In function âdpdk_initâ:
>>lib/netdev-dpdk.c:1189: error: too few arguments to function
>>ârte_memzone_dumpâ
>>make[2]: *** [lib/netdev-dpdk.lo] Error 1
>>make[2]: Leaving directory `/usr/src/openvswitch-2.3.1'
>>make[1]: *** [all-recursive] Error 1
>>make[1]: Leaving directory `/usr/src/openvswitch-2.3.1'
>>make: *** [all] Error 2
>>
>>
>>
>>
>>DPDK Open vSwitch Notes RHEL6.6:
>>------------------------
>>
>>
>>Additions to kernel cmdline:
>>iommu=pt intel_iommu=on default_hugepagesz=1G hugepagesz=1G
>>transparent_hugepage=never hugepages=32
>>
>>
>>BUILD DPDK:
>>cd /usr/src/dpdk-1.6.0r2 <--- 1st working version
>>cd /usr/src/dpdk-1.7.1 <--- Only works with 82599
>>cd /usr/src/dpdk-1.8.0 <--- x540s are recognized ovs doesn't build with
>>it tho
>>export DPDK=$(pwd)
>>export TGT=x86_64-native-linuxapp-gcc
>>make CONFIG_RTE_BUILD_COMBINE_LIBS=y CONFIG_RTE_BUILD_SHARED_LIB=n
>>CONFIG_RTE_LIBRTE_IXGBE_PMD=y CONFIG_RTE_LIBRTE_IGB_PMD=y install T=$TGT
>>
>>
>>
>>BUILD OpenvSwitch:
>>cd /usr/src/openvswitch-2.3.1
>>export OVS=$(pwd)
>>./boot.sh
>>./configure --disable-ssl --with-dpdk=$DPDK/$TGT LIBS=-ldl
>>make
>>make install
>>ln -sf /usr/local/bin/ovs-vsctl /usr/bin/ovs-vsctl <--- libvirt requires
>>ovs-vsctl to be here
>>
>>
>>
>>
>>Please let me know if you find something wrong in what I am doing.
>>
>>
>>Thanking you
>>
>>
>>Sundar
>>
>>
>>
>
>
>
>
>
>
>
>


From blp at nicira.com  Wed Jul  1 13:16:53 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 1 Jul 2015 13:16:53 -0700
Subject: [ovs-discuss] surprising effects with exit v's drop
In-Reply-To: <03135AEA779D444E90975C2703F148DC15A300CF@IRSMSX107.ger.corp.intel.com>
References: <03135AEA779D444E90975C2703F148DC15A300CF@IRSMSX107.ger.corp.intel.com>
Message-ID: <20150701201653.GJ28944@nicira.com>

On Tue, Jun 30, 2015 at 02:46:59PM +0000, O Mahony, Billy wrote:
> I am getting very surprising (to me at least) effects with the following
> flows installed.
> 
> I am seeing packets forwarded when I expect them to be dropped and dropped 
> when I expect them to be forwarded.

I'm trying to interpret your report.  Is the following correct?

        * When "write_actions" adds an output action, and the pipeline
          ends with an "exit" action, no output actually occurs.

        * When "write_actions" adds an output action, and the pipeline
          ends with "drop", output does occur.

From blp at nicira.com  Wed Jul  1 13:31:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 1 Jul 2015 13:31:10 -0700
Subject: [ovs-discuss] OF 1.3 question
In-Reply-To: <7E446A6128134441B5FE3C3D368FE101351235EB@SJEXCHMB10.corp.ad.broadcom.com>
References: <7E446A6128134441B5FE3C3D368FE101351235EB@SJEXCHMB10.corp.ad.broadcom.com>
Message-ID: <20150701203110.GB31129@nicira.com>

On Mon, Jun 29, 2015 at 09:59:14AM +0000, Abhijit Bhadra wrote:
> Hi,
> I am using ovs-ofctl to test addition/modification/deletion of OF 1.3 flows. I was using the following command to do the actions=mod_nw_tos for OF 1.0,
> ovs-ofctl add-flow tcp:10.130.177.160 dl_vlan=128,in_port=12,table=60,priority=100,actions=mod_nw_tos:4,output:24
> 
> Now I am using ovs-ofctl -O openflow13 add-flow tcp:10.130.177.160 dl_vlan=128,in_port=12,table=60,priority=100,actions=mod_nw_tos:4,output:24. But I get the following error:
> "ovs-ofctl: none of the usable flow formats (OpenFlow10+table_id,NXM+table_id) is among the allowed flow formats (OXM-OpenFlow13)".
> How do I achieve the same actions=mod_nw_tos for OF 1.3 using ovs-ofctl?

In OF1.3, the set_field action that mod_nw_tos gets translated into
requires the flow to match on a field that ensures that a nw_tos field
is present.  That is, if you add "ip" or "ipv6" to your match, it will
work.

From blp at nicira.com  Wed Jul  1 14:55:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 1 Jul 2015 14:55:10 -0700
Subject: [ovs-discuss] Command to get port name and port id mapping
In-Reply-To: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>
References: <CA+oJsLNrLFDhcr9vXbVOB1LmJWwMwViAFGa_buQCqK9qdByHLg@mail.gmail.com>
Message-ID: <20150701215510.GK31129@nicira.com>

On Tue, Jun 30, 2015 at 09:48:12AM -0700, Xuemei Liu wrote:
> I want to generate forwarding rules for ovs, and need to get the port id
> (0, 1, ...) at the ovs from the port name (eth0, ...).  I tried ovs-vsctl
> show, ovs-dpctl show, but they don't show the port id. Could anyone tell me
> the commands to implement this task?

This is in the FAQ.

### Q: How can I figure out the OpenFlow port number for a given port?

A: The OFPT_FEATURES_REQUEST message requests an OpenFlow switch to
   respond with an OFPT_FEATURES_REPLY that, among other information,
   includes a mapping between OpenFlow port names and numbers.  From a
   command prompt, "ovs-ofctl show br0" makes such a request and
   prints the response for switch br0.

   The Interface table in the Open vSwitch database also maps OpenFlow
   port names to numbers.  To print the OpenFlow port number
   associated with interface eth0, run:

       ovs-vsctl get Interface eth0 ofport

   You can print the entire mapping with:

       ovs-vsctl -- --columns=name,ofport list Interface

   but the output mixes together interfaces from all bridges in the
   database, so it may be confusing if more than one bridge exists.

   In the Open vSwitch database, ofport value -1 means that the
   interface could not be created due to an error.  (The Open vSwitch
   log should indicate the reason.)  ofport value [] (the empty set)
   means that the interface hasn't been created yet.  The latter is
   normally an intermittent condition (unless ovs-vswitchd is not
   running).

From blp at nicira.com  Wed Jul  1 15:17:40 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 1 Jul 2015 15:17:40 -0700
Subject: [ovs-discuss] TOIT 2.0 AKA VSPERF Release Announcement
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA92E2A7D5A@IRSMSX108.ger.corp.intel.com>
References: <1A27633A6DA49C4A92FCD5D4312DBF536A455E52@IRSMSX109.ger.corp.intel.com>
 <738D45BC1F695740A983F43CFE1B7EA92E2A7D5A@IRSMSX108.ger.corp.intel.com>
Message-ID: <20150701221740.GM31129@nicira.com>

On Wed, Jul 01, 2015 at 10:19:29AM +0000, Gray, Mark D wrote:
> > I would like to highlight the release of a new version of TOIT to the vSwitch
> > Characterization project in OPNFV.
> > 
> A tool like this could help ensure that there is no unexpected degradation
> in performance. Perhaps it could be used to gate patches to prevent performance
> drops of the type that Jesse's patch fixed this morning?

It would be very useful to have a service that builds OVS DPDK, tests
its performance, and reports it.  It could be a nightly build kind of
service, or it could be more like travis where it automatically tests
every OVS commit (even proposed ones) pushed to github.  It would be a
real service to the community for Intel (or someone else) to set up
something like this.

From jesse at nicira.com  Wed Jul  1 16:02:47 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 1 Jul 2015 16:02:47 -0700
Subject: [ovs-discuss] TOIT 2.0 AKA VSPERF Release Announcement
In-Reply-To: <20150701221740.GM31129@nicira.com>
References: <1A27633A6DA49C4A92FCD5D4312DBF536A455E52@IRSMSX109.ger.corp.intel.com>
 <738D45BC1F695740A983F43CFE1B7EA92E2A7D5A@IRSMSX108.ger.corp.intel.com>
 <20150701221740.GM31129@nicira.com>
Message-ID: <CAEP_g=_RPUHuObbkm7hzRqPpADX0HjwC=x66mA_GEyi1FquV=Q@mail.gmail.com>

On Wed, Jul 1, 2015 at 3:17 PM, Ben Pfaff <blp at nicira.com> wrote:
> On Wed, Jul 01, 2015 at 10:19:29AM +0000, Gray, Mark D wrote:
>> > I would like to highlight the release of a new version of TOIT to the vSwitch
>> > Characterization project in OPNFV.
>> >
>> A tool like this could help ensure that there is no unexpected degradation
>> in performance. Perhaps it could be used to gate patches to prevent performance
>> drops of the type that Jesse's patch fixed this morning?
>
> It would be very useful to have a service that builds OVS DPDK, tests
> its performance, and reports it.  It could be a nightly build kind of
> service, or it could be more like travis where it automatically tests
> every OVS commit (even proposed ones) pushed to github.  It would be a
> real service to the community for Intel (or someone else) to set up
> something like this.

It would definitely be great to have infrastructure to automatically
test proposed patches for correctness and performance. I think this is
one thing that Gerrit does very well, particular as we add more
environments like DPDK and Windows that most developers might not be
setup to test. I guess it seems particularly nice to have something
that is both consistent (rather than having a mixture of different
systems such as email, Travis, performance, Patchwork) and gating for
commits, otherwise it will probably end up breaking at some point and
being ignored.

From dongj at dtdream.com  Wed Jul  1 19:50:55 2015
From: dongj at dtdream.com (Dongjun)
Date: Thu, 2 Jul 2015 10:50:55 +0800
Subject: [ovs-discuss] Vxlan encapsulation exceeds the MTU of dpdk port .
In-Reply-To: <DC5AD7FA266D86499789B1BCAEC715F85C42A760@irsmsx105.ger.corp.intel.com>
References: <558BAD5C.9000402@dtdream.com>
 <DC5AD7FA266D86499789B1BCAEC715F85C42A760@irsmsx105.ger.corp.intel.com>
Message-ID: <5594A70F.7030802@dtdream.com>


On 2015/7/1 22:57, Kavanagh, Mark B wrote:
>> As following topology, two VMs communicate via Vxlan tunnel.
>> TCP pkts may be droped for exceeding the mtu of host DPDK port in br2.
>> Now I can change the VMs' mtu from default to smaller to accommodate the
>> traffics, it works well.
>>
>> The way I have not find to change mtu of DPDK phy port, is there a
>> blueprint for supporting this by ovs, like "ovs-appctl
>> netdev-dpdk/set-xxx" or another way?
>>
>>          Host1                  |                     Host2
>>                      (l-ip)-   L3    -(r-ip)
>> -----   -----        -----     |     -----       -----  ----- -----
>> |VM1| --|br1|Vxlan --|br2|DPDK---DPDK|br2|--Vxlan|br2|--|br1|--|VM2|
>> -----   -----        -----     |     -----       -----  ----- -----
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
> Hi,
>
> There is currently no way to configure the MTU of a DPDK phy port at runtime.
>
> Theoretically, enabling jumbo frames and adjusting the dev's max_rx_pkt_len in the rte_eth_conf, (and consequently, the size of mbufs in the mempool) could work; however, OVS sets the MTU for all ports to the minimum of the non-datapath ports, so you might need to play around with it. This is something that I plan on looking at in the next few weeks (compile-time option, not runtime).
>
> Thanks,
> Mark
Thanks, I will try it based on your suggestion.

From billy.o.mahony at intel.com  Thu Jul  2 00:07:02 2015
From: billy.o.mahony at intel.com (O Mahony, Billy)
Date: Thu, 2 Jul 2015 07:07:02 +0000
Subject: [ovs-discuss] surprising effects with exit v's drop
In-Reply-To: <20150701201653.GJ28944@nicira.com>
References: <03135AEA779D444E90975C2703F148DC15A300CF@IRSMSX107.ger.corp.intel.com>
 <20150701201653.GJ28944@nicira.com>
Message-ID: <03135AEA779D444E90975C2703F148DC15A329F8@IRSMSX107.ger.corp.intel.com>



> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Wednesday, July 1, 2015 9:17 PM
> To: O Mahony, Billy
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] surprising effects with exit v's drop
> 
> On Tue, Jun 30, 2015 at 02:46:59PM +0000, O Mahony, Billy wrote:
> > I am getting very surprising (to me at least) effects with the
> > following flows installed.
> >
> > I am seeing packets forwarded when I expect them to be dropped and
> > dropped when I expect them to be forwarded.
> 
> I'm trying to interpret your report.  Is the following correct?
> 
>         * When "write_actions" adds an output action, and the pipeline
>           ends with an "exit" action, no output actually occurs.
> 
>         * When "write_actions" adds an output action, and the pipeline
>           ends with "drop", output does occur.

Hi Ben. Yes, exactly. 

From mark.d.gray at intel.com  Thu Jul  2 00:58:33 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Thu, 2 Jul 2015 07:58:33 +0000
Subject: [ovs-discuss] TOIT 2.0 AKA VSPERF Release Announcement
In-Reply-To: <20150701221740.GM31129@nicira.com>
References: <1A27633A6DA49C4A92FCD5D4312DBF536A455E52@IRSMSX109.ger.corp.intel.com>
 <738D45BC1F695740A983F43CFE1B7EA92E2A7D5A@IRSMSX108.ger.corp.intel.com>
 <20150701221740.GM31129@nicira.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E2A8D9E@IRSMSX108.ger.corp.intel.com>

> 
> On Wed, Jul 01, 2015 at 10:19:29AM +0000, Gray, Mark D wrote:
> > > I would like to highlight the release of a new version of TOIT to
> > > the vSwitch Characterization project in OPNFV.
> > >
> > A tool like this could help ensure that there is no unexpected
> > degradation in performance. Perhaps it could be used to gate patches
> > to prevent performance drops of the type that Jesse's patch fixed this
> morning?
> 
> It would be very useful to have a service that builds OVS DPDK, tests its
> performance, and reports it.  It could be a nightly build kind of service, or it
> could be more like travis where it automatically tests every OVS commit
> (even proposed ones) pushed to github.  It would be a real service to the
> community for Intel (or someone else) to set up something like this.

The intention with vsperf would be to run this nightly and publish the results :).
I agree, that it would be interesting to set something up for patches that haven't
been pushed yet.

From John.Lange at jdsu.com  Wed Jul  1 13:35:56 2015
From: John.Lange at jdsu.com (John Lange)
Date: Wed, 1 Jul 2015 20:35:56 +0000
Subject: [ovs-discuss] DPDK OVS on multi-host KVM
Message-ID: <82D8F9A463E6AC4B8BCB7AAACF8E87C95793EA11@AMEXMB03.ds.jdsu.net>

Greetings,

We have a multi-host KVM system, with one server for KVM controller, one server for neutron (networking), one server for cinder (bulk disk storage), and multiple servers planned for KVM compute nodes (but currently only one compute node).  We are using Ubuntu 12.04.2 LTS Server on all the hosts.  We need to use SLES 11sp3 as the guest OSes in the KVM-based VMs.

First issue is figuring out which version of DPDK and OVS to use.  Newer versions of OVS are incompatible with newer versions of DPDK.  This seems mostly due to the removal of the pkt.data field in mbuf structure in DPDK (see here<http://dpdk.org/doc/guides/rel_notes/updating_apps.html> for updating DPDK details).  I am currently trying to use DPDK v1.6.0r2 with OVS v2.3.2.  This combination seems to build fine, and I can get through most of the install guide here<http://openvswitch.org/support/dist-docs/INSTALL.DPDK.md.txt>, at least on the compute node, using an 82599 10Gb port for the binding.

However, the install guide doesn't cover how to install in a multi-host KVM deployment and also how to deploy on a KVM-based VM guest.  Near the end of the install guide referenced above, it mentions that a patched QEMU is required, and refers to here<https://01.org/packet-processing/downloads>.  However, that is the link for downloading OVDK (up to v1.1 which is out of date with the most recent v2.3.2 available from openvswitch.org), and there doesn't seem to be any instructions at that link for how to patch QEMU.

I did find an Intel document here<https://01.org/sites/default/files/page/openstack_neutron_with_intel_architecture_gsg_rev004.pdf> from Nov 2014 covering the deployment of OVDK on multiple host KVM, but it seems out of date since OVDK is being deprecated due to it being merged to the common version of OVS.  Is there an updated version of this document available, covering the newer (post-merged version of) OVS?

As it is, I'm not sure how to get DPDK based OVS to work in KVM based VMs.  Do I need to build and deploy DPDK/Open vSwitch on the KVM controller?  On the KVM Neutron node?  On each compute node?  On the VMs?  Can it work with virtio (virtual NICs), or does it require Direct Attach for each VM.  It is all very confusing, and the documentation is either non-existent or is at best incomplete.  Any help you can offer would be greatly appreciated.

Do you (or other companies) offer contract consulting services to support Open vSwitch?

Many thanks,

John Lange
Principal Engineer, Software Development
Solution Architecture/Systems Engineering Group
JDS Uniphase Corporation
9950 Federal Drive, Ste. 150
Colorado Springs, CO 80921
John.Lange at jdsu.com<mailto:John.Lange at jdsu.com>
+1-303-416-9665 office
+1-281-772-5818 cell
www.jdsu.com<http://www.jdsu.com/>
www.jdsu.tv<http://www.jdsu.tv/>


[cid:BBA3B45F-65AA-4291-86AD-168262546767]


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150701/cc5b6dd5/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 4240 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150701/cc5b6dd5/attachment-0001.png>

From haleema.s.mahmood at gmail.com  Thu Jul  2 01:51:51 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Thu, 2 Jul 2015 13:51:51 +0500
Subject: [ovs-discuss] NXM Registers
Message-ID: <CAN-u-61wByfsQmN6L5ygKjEBanVGsow8DT4MNm6sbEUHJkDOzQ@mail.gmail.com>

Hi,

As there are NXM registers in OVS, like, NXM_NX_REG0, NXM_NX_REG1. Are
there OXM registers like these for OpenFlow1.3?

And are the load/move nicira extensions in ovs, because there are no such
actions mentioned in openflow documentation.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150702/5d7a2dfa/attachment.html>

From blp at nicira.com  Thu Jul  2 09:41:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 2 Jul 2015 09:41:25 -0700
Subject: [ovs-discuss] NXM Registers
In-Reply-To: <CAN-u-61wByfsQmN6L5ygKjEBanVGsow8DT4MNm6sbEUHJkDOzQ@mail.gmail.com>
References: <CAN-u-61wByfsQmN6L5ygKjEBanVGsow8DT4MNm6sbEUHJkDOzQ@mail.gmail.com>
Message-ID: <20150702164125.GG14732@nicira.com>

On Thu, Jul 02, 2015 at 01:51:51PM +0500, Haleema Sadia wrote:
> As there are NXM registers in OVS, like, NXM_NX_REG0, NXM_NX_REG1. Are
> there OXM registers like these for OpenFlow1.3?

OpenFlow 1.5 introduced 64-bit registers OXM_OF_PKT_REG<n>.  In OVS,
these overlay NXM_NX_REG<n>; see the documentation.

> And are the load/move nicira extensions in ovs, because there are no such
> actions mentioned in openflow documentation.

OpenFlow 1.2+ "set_field" is similar to load.
OpenFlow 1.5 "copy_field" is similar to move.

From sean.k.mooney at intel.com  Thu Jul  2 12:33:49 2015
From: sean.k.mooney at intel.com (Mooney, Sean K)
Date: Thu, 2 Jul 2015 19:33:49 +0000
Subject: [ovs-discuss] DPDK OVS on multi-host KVM
In-Reply-To: <82D8F9A463E6AC4B8BCB7AAACF8E87C95793EA11@AMEXMB03.ds.jdsu.net>
References: <82D8F9A463E6AC4B8BCB7AAACF8E87C95793EA11@AMEXMB03.ds.jdsu.net>
Message-ID: <4B1BB321037C0849AAE171801564DFA6450F5895@IRSMSX107.ger.corp.intel.com>

Hello john.

I will try to answer some of your question inline.

I work on the team that developed the install guide you have referenced as well as
The software components to integrate ovs +dpdk with OpenStack at intel.

The following repository may be of use to you

https://github.com/stackforge/networking-ovs-dpdk

as of the kilo release of openstack we have migrated the openstack integration code from 01.org to stackforge.

The networking-ovs-dpdk repo provides  a ovsdpdk ml2 mechanism driver  and an ovsdpdk l2 agent to enable support for
Upstream ovs with the dpdk enabled netdev datapath. Additionally the networking-ovs-dpdk provide a devstack plugin
Which will download, compile and install dpdk, ovs and the agent and driver required for OpenStack integration.

At present we do not have a corresponding Getting started guide for deploying via the networking-ovs-dpdk  repo but I can provide assistance configuring ovs+dpdk+openstack.

Please feel free to follow up with me here or directly If I can help.

Regards
Sean.




From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of John Lange
Sent: Wednesday, July 1, 2015 9:36 PM
To: bugs at openvswitch.org
Subject: [ovs-discuss] DPDK OVS on multi-host KVM

Greetings,

We have a multi-host KVM system, with one server for KVM controller, one server for neutron (networking), one server for cinder (bulk disk storage), and multiple servers planned for KVM compute nodes (but currently only one compute node).  We are using Ubuntu 12.04.2 LTS Server on all the hosts.  We need to use SLES 11sp3 as the guest OSes in the KVM-based VMs.

First issue is figuring out which version of DPDK and OVS to use.  Newer versions of OVS are incompatible with newer versions of DPDK.  This seems mostly due to the removal of the pkt.data field in mbuf structure in DPDK (see here<http://dpdk.org/doc/guides/rel_notes/updating_apps.html> for updating DPDK details).  I am currently trying to use DPDK v1.6.0r2 with OVS v2.3.2.  This combination seems to build fine, and I can get through most of the install guide here<http://openvswitch.org/support/dist-docs/INSTALL.DPDK.md.txt>, at least on the compute node, using an 82599 10Gb port for the binding.

[sean] the current master branch of ovs supports dpdk 2.0.
[sean] the current commit of ovs we recommend to use is 7d1ced01772de541d6692c7d5604210e274bcd37 with dpdk v2.0.0

However, the install guide doesn't cover how to install in a multi-host KVM deployment and also how to deploy on a KVM-based VM guest.  Near the end of the install guide referenced above, it mentions that a patched QEMU is required, and refers to here<https://01.org/packet-processing/downloads>.  However, that is the link for downloading OVDK (up to v1.1 which is out of date with the most recent v2.3.2 available from openvswitch.org), and there doesn't seem to be any instructions at that link for how to patch QEMU.

[sean] a patched version of qemu is only required for ivshmem support.
[sean] we recommend use qemu 2.2 or newer when using ovs+dpdk and vhost-user.
[sean]Note that ivshmem support is not intergrated with openstack at this time.

I did find an Intel document here<https://01.org/sites/default/files/page/openstack_neutron_with_intel_architecture_gsg_rev004.pdf> from Nov 2014 covering the deployment of OVDK on multiple host KVM, but it seems out of date since OVDK is being deprecated due to it being merged to the common version of OVS.  Is there an updated version of this document available, covering the newer (post-merged version of) OVS?

[sean] the document you have references was a Getting started guide describing the deployment of ovs+dpdk  and ovdk with openstack juno.
[sean] for kilo release and on this intergrations is now done via the https://github.com/stackforge/networking-ovs-dpdk repo.
[sean] a sample configuration file for an all in one node is available here https://github.com/stackforge/networking-ovs-dpdk/blob/master/doc/source/_downloads/local.conf_example
[sean] an updated onp reference architecture document is available here https://01.org/sites/default/files/page/intel_onp_server_reference_architecture_guide_v1.4.pdf
[sean] while the onp 1.4 document does not describe how to deploy with the vhost-user support available in the networking-ovs-dpdk repo I can provide information on how to enable this support and
[sean] configure a multi node deployment.



As it is, I'm not sure how to get DPDK based OVS to work in KVM based VMs.  Do I need to build and deploy DPDK/Open vSwitch on the KVM controller?  On the KVM Neutron node?  On each compute node?  On the VMs?  Can it work with virtio (virtual NICs), or does it require Direct Attach for each VM.  It is all very confusing, and the documentation is either non-existent or is at best incomplete.  Any help you can offer would be greatly appreciated.

[sean] kernel ovs and UserSpace ovs (dpdk netdev datapath) can coexist in the same cloud.
[sean] ovs +dpdk can be installed on the controller, network node or compute nodes.
[sean] to integrate ovs+dpdk with OpenStack the ovsdpdk ml2 mechanism driver should be installed on network(neutron) node.
[sean] the DPDK ovs agent should be installed on each compute node that you wish to run ovs+dpdk.
[sean] the deployment of these nodes can be supported by the devstack plugin provides as part of the networking-ovs-dpdk repo.

[sean] As of qemu 2.1 a new virtio backend is supported called vhost-user. This interface allows either a standard virtio-net driver or a dpdk poll mode driver to be used in the guest.
[sean] vhost-user does not require vm images to be modified in any way how ever does require vms to use hugepage memory.
[sean] support for vhost-user with openstack is available with the following software versions

*         openstack kilo+

*         ovs commit 7d1ced01772de541d6692c7d5604210e274bcd37 or later

*         dpdk v2.0.0

*         qemu 2.1+(recommend 2.2+)

*         Libvirt 1.2.11+ (recommend 1.2.13)


Do you (or other companies) offer contract consulting services to support Open vSwitch?

[sean] not that I'm aware of but we are happy to help you resolve your issues :)

Many thanks,

John Lange
Principal Engineer, Software Development
Solution Architecture/Systems Engineering Group
JDS Uniphase Corporation
9950 Federal Drive, Ste. 150
Colorado Springs, CO 80921
John.Lange at jdsu.com<mailto:John.Lange at jdsu.com>
+1-303-416-9665 office
+1-281-772-5818 cell
www.jdsu.com<http://www.jdsu.com/>
www.jdsu.tv<http://www.jdsu.tv/>


[cid:BBA3B45F-65AA-4291-86AD-168262546767]


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150702/5b0ca7db/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 4240 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150702/5b0ca7db/attachment-0001.png>

From jacob.chappell at uky.edu  Thu Jul  2 15:44:22 2015
From: jacob.chappell at uky.edu (Jacob Chappell)
Date: Thu, 2 Jul 2015 18:44:22 -0400
Subject: [ovs-discuss] Modify IPv6 Address?
Message-ID: <CANJ8QnemXOCA7EPuBbzt5NfZi5NoGjxhKVtrgsB6yghnkf=NOQ@mail.gmail.com>

Hi all,

Does OVS not support modifying IPv6 addresses as an action? Here are the
commands I'm running and their outputs.

# This works.
$ sudo ovs-ofctl add-flow br-eth3 tcp,actions=mod_nw_dst=127.0.0.1

# This doesn't.
$ sudo ovs-ofctl add-flow br-eth3 tcp6,actions=mod_nw_dst=::1
2015-07-02T22:40:10Z|00001|socket_util|ERR|"::1" is not a valid IP address
ovs-ofctl: ::1: could not convert to IP address

# Neither does this.
$ sudo ovs-ofctl add-flow br-eth3 tcp6,actions=mod_nw_dst=[::1]
2015-07-02T22:40:38Z|00001|socket_util|ERR|"[::1]" is not a valid IP address
ovs-ofctl: [::1]: could not convert to IP address

I am running Open vSwitch version 2.3.1.

Thanks,
Jacob Chappell
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150702/a1fa7c07/attachment.html>

From aatteka at nicira.com  Thu Jul  2 16:21:13 2015
From: aatteka at nicira.com (Ansis Atteka)
Date: Thu, 2 Jul 2015 16:21:13 -0700
Subject: [ovs-discuss] Modify IPv6 Address?
In-Reply-To: <CANJ8QnemXOCA7EPuBbzt5NfZi5NoGjxhKVtrgsB6yghnkf=NOQ@mail.gmail.com>
References: <CANJ8QnemXOCA7EPuBbzt5NfZi5NoGjxhKVtrgsB6yghnkf=NOQ@mail.gmail.com>
Message-ID: <CAA=3OqmnPUcNQ3kw4EXuTvj2MGVRJO5eN5ASxZ_+kCZ1nFB3Kg@mail.gmail.com>

On Thu, Jul 2, 2015 at 3:44 PM, Jacob Chappell <jacob.chappell at uky.edu> wrote:
> Hi all,
>
> Does OVS not support modifying IPv6 addresses as an action? Here are the
> commands I'm running and their outputs.
>
> # This works.
> $ sudo ovs-ofctl add-flow br-eth3 tcp,actions=mod_nw_dst=127.0.0.1
>
> # This doesn't.
> $ sudo ovs-ofctl add-flow br-eth3 tcp6,actions=mod_nw_dst=::1
> 2015-07-02T22:40:10Z|00001|socket_util|ERR|"::1" is not a valid IP address
> ovs-ofctl: ::1: could not convert to IP address
>
> # Neither does this.
> $ sudo ovs-ofctl add-flow br-eth3 tcp6,actions=mod_nw_dst=[::1]
> 2015-07-02T22:40:38Z|00001|socket_util|ERR|"[::1]" is not a valid IP address
> ovs-ofctl: [::1]: could not convert to IP address
>
> I am running Open vSwitch version 2.3.1.

Did you try:
ovs-ofctl -O OpenFlow12 add-flow br-eth3
ipv6,table=1,in_port=3,actions=set_field:fe80:0123:4567:890a:a6ba:dbff:fefe:59fa-\>ipv6_src

>
> Thanks,
> Jacob Chappell
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From tony.vanderpeet at gmail.com  Thu Jul  2 23:58:10 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Fri, 3 Jul 2015 18:58:10 +1200
Subject: [ovs-discuss] OF_DPA integration with OVS
Message-ID: <CAKL=qh_yWWgvn+2fAF1wcR=xf9wANKpBMQj9o8zJPdOr=kmjZg@mail.gmail.com>

Hi Gopi

I have started two attempts to do basically this and have the
following (not very well thought out) comments:

+ you probably need a new ofproto. this is a lot harder than creating
a new dpif. read PORTING.md.
+ a lot of code that you need in your new ofproto actually happens at
the dpif layer. so much so that I decided to make my new ofproto also
use dpif for at least those functions that it can usefully use.
+ ideally, we might consider a new ofproto (called for example
ofproto-ttp) which acts as a general ofproto for lower layers base on
particular TTPs. code that directly parsed a TTP would be handy,
either to operate directly on the TTP or generate code.
+ then we could slot in entities called for example ttps, including a
Broadcom ttp, which would itself interact with something like the
OF-DPA code.
+ you would be slightly crazy to try to create this in your own fork,
judging by how much OVS and the OpenFlow specs are changing - better
to get agreement from the OVS community to support this.
+ check out project Atrium (good luck finding the code - you may need
to be a member of the ONF). it's not based on OVS but on something
older (and possibly simpler and less up to date) called Indigo.

I would be interested in carrying out further discussions on this, but
you probably want to get someone like Ben Pfaff interested... I am
currently considering how best to implement OF-DPA, so it's possible
that I can offer of team of 5 or more engineers to do some of the
heavy lifting on this...

Cheers
Tony

Hi,
I would like to know if anyone tried integrating OF-DPA software with
the OVS code ? I didn't find much information on this topic.And is
there any open source software similar to OF-DPA?
Regards,Gopi

From blp at nicira.com  Fri Jul  3 08:00:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 3 Jul 2015 08:00:10 -0700
Subject: [ovs-discuss] Openflow 1.4 bundle script issue.
In-Reply-To: <SINPR03MB331313449FEC470F695277295960@SINPR03MB331.apcprd03.prod.outlook.com>
References: <SINPR03MB331313449FEC470F695277295960@SINPR03MB331.apcprd03.prod.outlook.com>
Message-ID: <20150703150010.GA30080@nicira.com>

On Fri, Jul 03, 2015 at 04:38:05AM +0000, jayachandran.subramanian at wipro.com wrote:
> We are working on openflow 1.4 bundle Git hub oftest suite and test cases failing with openvswitch for  the below ofp message.
> 
> 
> 
> bundle_ctrl_type=ofp.OFPBCT_OPEN_REQUEST
> 
> self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
> 
> 
> 
> bundle_ctrl_type=ofp.OFPBCT_COMMIT_REQUEST
> 
> self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_COMMIT_REPLY)
> 
> bundle_ctrl_type=ofp.OFPBCT_DISCARD_REQUEST
> 
> self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
> 
> 
> 
>   Openvswitch version : openvswitch - 2.3.90
> 
>   OS version                    : Ubuntu 14.04 Trusty
> 
>   Open flow version      : 1.4
> Kindly let us know the above ofp message is supporting with openvswitch-2.3.90

What commit did you build?

From blp at nicira.com  Fri Jul  3 08:20:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 3 Jul 2015 08:20:25 -0700
Subject: [ovs-discuss] surprising effects with exit v's drop
In-Reply-To: <03135AEA779D444E90975C2703F148DC15A329F8@IRSMSX107.ger.corp.intel.com>
References: <03135AEA779D444E90975C2703F148DC15A300CF@IRSMSX107.ger.corp.intel.com>
 <20150701201653.GJ28944@nicira.com>
 <03135AEA779D444E90975C2703F148DC15A329F8@IRSMSX107.ger.corp.intel.com>
Message-ID: <20150703152025.GB30080@nicira.com>

On Thu, Jul 02, 2015 at 07:07:02AM +0000, O Mahony, Billy wrote:
> > From: Ben Pfaff [mailto:blp at nicira.com]
> > Sent: Wednesday, July 1, 2015 9:17 PM
> > To: O Mahony, Billy
> > Cc: discuss at openvswitch.org
> > Subject: Re: [ovs-discuss] surprising effects with exit v's drop
> > 
> > On Tue, Jun 30, 2015 at 02:46:59PM +0000, O Mahony, Billy wrote:
> > > I am getting very surprising (to me at least) effects with the
> > > following flows installed.
> > >
> > > I am seeing packets forwarded when I expect them to be dropped and
> > > dropped when I expect them to be forwarded.
> > 
> > I'm trying to interpret your report.  Is the following correct?
> > 
> >         * When "write_actions" adds an output action, and the pipeline
> >           ends with an "exit" action, no output actually occurs.
> > 
> >         * When "write_actions" adds an output action, and the pipeline
> >           ends with "drop", output does occur.
> 
> Hi Ben. Yes, exactly. 

The former is the current behavior of "exit".  I think it's the way that
"exit" has always behaved.  It's hard to say whether it's right or
wrong, since "exit" is an Open vSwitch extension that was introduced
before OVS added support for write_actions.  Do you have some kind of
particular interest in the behavior of "exit" in this case?

The latter makes sense, because "drop" does not say that a packet must
be dropped.  As the FAQ says:

### Q: How do I make a flow drop packets?

A: To drop a packet is to receive it without forwarding it.  OpenFlow
   explicitly specifies forwarding actions.  Thus, a flow with an
   empty set of actions does not forward packets anywhere, causing
   them to be dropped.  You can specify an empty set of actions with
   "actions=" on the ovs-ofctl command line.  For example:

       ovs-ofctl add-flow br0 priority=65535,actions=

   would cause every packet entering switch br0 to be dropped.

   You can write "drop" explicitly if you like.  The effect is the
   same.  Thus, the following command also causes every packet
   entering switch br0 to be dropped:

       ovs-ofctl add-flow br0 priority=65535,actions=drop

   "drop" is not an action, either in OpenFlow or Open vSwitch.
   Rather, it is only a way to say that there are no actions.


From jacob.chappell at uky.edu  Fri Jul  3 12:12:43 2015
From: jacob.chappell at uky.edu (Jacob Chappell)
Date: Fri, 3 Jul 2015 15:12:43 -0400
Subject: [ovs-discuss] Modify IPv6 Address?
In-Reply-To: <CAA=3OqmnPUcNQ3kw4EXuTvj2MGVRJO5eN5ASxZ_+kCZ1nFB3Kg@mail.gmail.com>
References: <CANJ8QnemXOCA7EPuBbzt5NfZi5NoGjxhKVtrgsB6yghnkf=NOQ@mail.gmail.com>
 <CAA=3OqmnPUcNQ3kw4EXuTvj2MGVRJO5eN5ASxZ_+kCZ1nFB3Kg@mail.gmail.com>
Message-ID: <CANJ8Qnekx2vJApUNaLiOmsAjF=Bz_NHY=C8=9FBvtbiiN92q=g@mail.gmail.com>

Ah, no I hadn't tried that. Thank you!

On Thu, Jul 2, 2015 at 7:21 PM, Ansis Atteka <aatteka at nicira.com> wrote:

> On Thu, Jul 2, 2015 at 3:44 PM, Jacob Chappell <jacob.chappell at uky.edu>
> wrote:
> > Hi all,
> >
> > Does OVS not support modifying IPv6 addresses as an action? Here are the
> > commands I'm running and their outputs.
> >
> > # This works.
> > $ sudo ovs-ofctl add-flow br-eth3 tcp,actions=mod_nw_dst=127.0.0.1
> >
> > # This doesn't.
> > $ sudo ovs-ofctl add-flow br-eth3 tcp6,actions=mod_nw_dst=::1
> > 2015-07-02T22:40:10Z|00001|socket_util|ERR|"::1" is not a valid IP
> address
> > ovs-ofctl: ::1: could not convert to IP address
> >
> > # Neither does this.
> > $ sudo ovs-ofctl add-flow br-eth3 tcp6,actions=mod_nw_dst=[::1]
> > 2015-07-02T22:40:38Z|00001|socket_util|ERR|"[::1]" is not a valid IP
> address
> > ovs-ofctl: [::1]: could not convert to IP address
> >
> > I am running Open vSwitch version 2.3.1.
>
> Did you try:
> ovs-ofctl -O OpenFlow12 add-flow br-eth3
>
> ipv6,table=1,in_port=3,actions=set_field:fe80:0123:4567:890a:a6ba:dbff:fefe:59fa-\>ipv6_src
>
> >
> > Thanks,
> > Jacob Chappell
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150703/90b4c6ed/attachment.html>

From blp at nicira.com  Fri Jul  3 23:28:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 3 Jul 2015 23:28:03 -0700
Subject: [ovs-discuss] Openflow 1.4 bundle script issue.
In-Reply-To: <SINPR03MB33143448D6C31A08FF302BC95950@SINPR03MB331.apcprd03.prod.outlook.com>
References: <SINPR03MB331313449FEC470F695277295960@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150703150010.GA30080@nicira.com>
 <SINPR03MB33143448D6C31A08FF302BC95950@SINPR03MB331.apcprd03.prod.outlook.com>
Message-ID: <20150704062803.GN30080@nicira.com>

What commit from Github did you build?

On Sat, Jul 04, 2015 at 04:09:16AM +0000, jayachandran.subramanian at wipro.com wrote:
> Hi Ben ,
> 
> Thank you for your mail , we havent build any package. we have downloaded openvswitch-2.3.90 from git hub and executing for bundle(openflow version 1.4) related scripts.
> 
> Openvswitch 2.3.90 supports wire protocol upto 0x04. This bundle feature is in openflow version 1.4 which is wire protocol of 0x05.
> 
> Kindly let me know openvswitch 2.3.90 supports this bundle (wire protocol of 0x04)feature .
> 
> Thanks
> Jayachandran S
> +91-8861883300
> 
> ________________________________________
> From: Ben Pfaff <blp at nicira.com>
> Sent: Friday, July 3, 2015 8:30 PM
> To: Jayachandran Subramanian (WT01 - PES)
> Cc: bugs at openvswitch.org; Suresh Mahadevappa (WT01 - PES)
> Subject: Re: Openflow 1.4 bundle script issue.
> 
> On Fri, Jul 03, 2015 at 04:38:05AM +0000, jayachandran.subramanian at wipro.com wrote:
> > We are working on openflow 1.4 bundle Git hub oftest suite and test cases failing with openvswitch for  the below ofp message.
> >
> >
> >
> > bundle_ctrl_type=ofp.OFPBCT_OPEN_REQUEST
> >
> > self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
> >
> >
> >
> > bundle_ctrl_type=ofp.OFPBCT_COMMIT_REQUEST
> >
> > self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_COMMIT_REPLY)
> >
> > bundle_ctrl_type=ofp.OFPBCT_DISCARD_REQUEST
> >
> > self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
> >
> >
> >
> >   Openvswitch version : openvswitch - 2.3.90
> >
> >   OS version                    : Ubuntu 14.04 Trusty
> >
> >   Open flow version      : 1.4
> > Kindly let us know the above ofp message is supporting with openvswitch-2.3.90
> 
> What commit did you build?
> The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com

From Dave.Johnston at owmobility.com  Sat Jul  4 01:34:18 2015
From: Dave.Johnston at owmobility.com (Dave Johnston)
Date: Sat, 4 Jul 2015 08:34:18 +0000
Subject: [ovs-discuss] Performance on Openstack Kilo
Message-ID: <DM2PR0501MB15816336B15BBB76C9E0CF9291950@DM2PR0501MB1581.namprd05.prod.outlook.com>

Hi,


I've been running some load tests on Openstack Kilo with CentOS 7.1 and OVS 2.3.1.


The out of the box performance seems to be poor, I can only manage around 21000 TPS (web requests).

That equates to roughty


  239309.20 txpck/s or  276117.34 txkB/s


This post indicates that with OVS > 2.1 and megaflows I should be seeing signficanlty higher than that

http://networkheresy.com/tag/megaflows/

megaflows | Network Heresy
Posts about megaflows written by justindpettit
Read more...<http://networkheresy.com/tag/megaflows/>

Is the megaflows features something that can be switched off/on at runtime, or is there a way to verify if it was enabled?


Thanks




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150704/aedaeb9d/attachment.html>

From jayachandran.subramanian at wipro.com  Thu Jul  2 21:38:05 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Fri, 3 Jul 2015 04:38:05 +0000
Subject: [ovs-discuss] Openflow 1.4 bundle script issue.
Message-ID: <SINPR03MB331313449FEC470F695277295960@SINPR03MB331.apcprd03.prod.outlook.com>

Hi Ben ,



We are working on openflow 1.4 bundle Git hub oftest suite and test cases failing with openvswitch for  the below ofp message.



bundle_ctrl_type=ofp.OFPBCT_OPEN_REQUEST

self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)



bundle_ctrl_type=ofp.OFPBCT_COMMIT_REQUEST

self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_COMMIT_REPLY)

bundle_ctrl_type=ofp.OFPBCT_DISCARD_REQUEST

self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)



  Openvswitch version : openvswitch - 2.3.90

  OS version                    : Ubuntu 14.04 Trusty

  Open flow version      : 1.4
Kindly let us know the above ofp message is supporting with openvswitch-2.3.90


Thanks
Jayachandran S
+91-8861883300
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150703/8a2c0512/attachment-0001.html>

From jayachandran.subramanian at wipro.com  Fri Jul  3 21:09:16 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Sat, 4 Jul 2015 04:09:16 +0000
Subject: [ovs-discuss] Openflow 1.4 bundle script issue.
In-Reply-To: <20150703150010.GA30080@nicira.com>
References: <SINPR03MB331313449FEC470F695277295960@SINPR03MB331.apcprd03.prod.outlook.com>,
 <20150703150010.GA30080@nicira.com>
Message-ID: <SINPR03MB33143448D6C31A08FF302BC95950@SINPR03MB331.apcprd03.prod.outlook.com>

Hi Ben ,

Thank you for your mail , we havent build any package. we have downloaded openvswitch-2.3.90 from git hub and executing for bundle(openflow version 1.4) related scripts.

Openvswitch 2.3.90 supports wire protocol upto 0x04. This bundle feature is in openflow version 1.4 which is wire protocol of 0x05.

Kindly let me know openvswitch 2.3.90 supports this bundle (wire protocol of 0x04)feature .

Thanks
Jayachandran S
+91-8861883300

________________________________________
From: Ben Pfaff <blp at nicira.com>
Sent: Friday, July 3, 2015 8:30 PM
To: Jayachandran Subramanian (WT01 - PES)
Cc: bugs at openvswitch.org; Suresh Mahadevappa (WT01 - PES)
Subject: Re: Openflow 1.4 bundle script issue.

On Fri, Jul 03, 2015 at 04:38:05AM +0000, jayachandran.subramanian at wipro.com wrote:
> We are working on openflow 1.4 bundle Git hub oftest suite and test cases failing with openvswitch for  the below ofp message.
>
>
>
> bundle_ctrl_type=ofp.OFPBCT_OPEN_REQUEST
>
> self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
>
>
>
> bundle_ctrl_type=ofp.OFPBCT_COMMIT_REQUEST
>
> self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_COMMIT_REPLY)
>
> bundle_ctrl_type=ofp.OFPBCT_DISCARD_REQUEST
>
> self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
>
>
>
>   Openvswitch version : openvswitch - 2.3.90
>
>   OS version                    : Ubuntu 14.04 Trusty
>
>   Open flow version      : 1.4
> Kindly let us know the above ofp message is supporting with openvswitch-2.3.90

What commit did you build?
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com

From calebmyu at gmail.com  Sat Jul  4 07:45:51 2015
From: calebmyu at gmail.com (Caleb Yu)
Date: Sat, 4 Jul 2015 22:45:51 +0800
Subject: [ovs-discuss] openvswitch with POX and qemu guests
Message-ID: <CAJ9ww9gFoq9Mc7gnPx22Mvoy06Z5jfV0VetEBBZBWFS5zO5yaw@mail.gmail.com>

I have question concerning linking POX controller with openvswitch. I link
bridge br0 of openvswitch to two qemu VM guests.
The configuration of qemu VM to openvswitch bridge is sudo
qemu-system-x86_64 -m 1028 -net nic,macaddr=00:00:00:00:cc:10 -net
tap,script=/etc/ovs-ifup,downscript=//etc/ovs-ifdown -drive
file=/home/pads/Desktop/kvmguest/pads1.qcow2 -vnc :1.
I am using ./pox.py forwarding.l2_learning to start pox.
I hit two problems while linking openvswitch to pox.

1. packet:(udp parse) warning UDP packet data shorter than UDP len: 94 < 251

2.INFO:packet:(dhcp parse) warning DHCP packet data too short to parse
header: data len 86

The result is that whlie in guest1 I can't ping the controller's ip. The
controller ip is the same as the host ip. I don't seem to have this problem
when I use floodlight controller. Thus do I have to modify the pox
controller to make it work. I have to use POX controller to do some test. I
find from online that I may have to change the default data len number in
POX. But I am not sure.

Thank you,

Caleb
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150704/b7317506/attachment-0001.html>

From epretorious at yahoo.com  Sat Jul  4 11:24:13 2015
From: epretorious at yahoo.com (Eric)
Date: Sat, 4 Jul 2015 18:24:13 +0000 (UTC)
Subject: [ovs-discuss] Best Practices for Configuring a Bonded Interface
 with Open vSwitch?
Message-ID: <1692339001.2163035.1436034253084.JavaMail.yahoo@mail.yahoo.com>

Hello, All:

I've just installed OVS on my Xen host and I'm wondering if there's a recommended configuration for bonding [pysical] interfaces with OVS? e.g., My host system has six [physical] interfaces. I've combined those [physical] interfaces to create three bonded interfaces: 'bond0', 'bond1', and 'bond2'.

For the initial OVS implementation, I created three virtual bridges: 'EXT', 'MGT', and 'SAN':

> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge SAN
>         Port SAN
>             Interface SAN
>                 type: internal
>     Bridge EXT
>         Port EXT
>             Interface EXT
>                 type: internal
>     Bridge MGT
>         Port MGT
>             Interface MGT
>                 type: internal
>     ovs_version: "2.3.2"

Then I removed the IP address from the bonded interface 'bond2' (manually *and* via configuration files) and connected it to the virtual bridge 'EXT':

> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge SAN
>         Port SAN
>             Interface SAN
>                 type: internal
>     Bridge EXT
>         Port "bond2"
>             Interface "bond2"
>         Port EXT
>             Interface EXT
>                 type: internal
>     Bridge MGT
>         Port MGT
>             Interface MGT
>                 type: internal
>     ovs_version: "2.3.2"

This works well enough but, after a reboot, the 'bond2' interface refuses to pass any traffic to the [physical] gateway, XXX.YYY.237.1 until I disconnect the bond (i.e., 'bond2') from the virtual switch and re-attach it:

> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> From XXX.YYY.237.65 icmp_seq=1 Destination Host Unreachable
> From XXX.YYY.237.65 icmp_seq=2 Destination Host Unreachable
> From XXX.YYY.237.65 icmp_seq=3 Destination Host Unreachable
>
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2937ms
> pipe 3
> 
> [root at xen-2 ~]# ovs-vsctl del-port EXT bond2 && ovs-vsctl --may-exist add-port EXT bond2
>
> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> 64 bytes from XXX.YYY.237.1: icmp_seq=1 ttl=64 time=56.7 ms
> 64 bytes from XXX.YYY.237.1: icmp_seq=2 ttl=64 time=48.8 ms
> 64 bytes from XXX.YYY.237.1: icmp_seq=3 ttl=64 time=47.6 ms
>
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 2049ms
> rtt min/avg/max/mdev = 47.650/51.073/56.724/4.033 ms

Should I destroy the 'bond2' interface and create the bond using OVS instead? Or is this configuration correct?

FWIW: I've provided a few more details and demonstrations here: https://www.centos.org/forums/viewtopic.php?f=50&t=53219
TIA,
Eric Pretorious
Portland, OR

REFERENCE:

[root at xen-2 ~]# cat /etc/sysconfig/network /etc/sysconfig/network-scripts/ifcfg-{bond2,EXT}
NETWORKING=yes
GATEWAY=XXX.YYY.237.1
HOSTNAME=xen-2
DNS1=208.67.220.220
DNS2=208.67.222.222
...
DEVICE=bond2
BOOTPROTO=none
ONBOOT=yes
NM_CONTOLLED=no
USERCTL=no
BONDING_OPTS='mode=1 miimon=100'
...
DEVICE=EXT
OVSBRIDGE=EXT
TYPE=ovs
DEVICETYPE=OVSPort
IPADDR=XXX.YYY.237.65
NETMASK=255.255.255.0
BOOTPROTO=static
ONBOOT=yes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150704/19185746/attachment-0001.html>

From epretorious at yahoo.com  Sat Jul  4 15:26:26 2015
From: epretorious at yahoo.com (Eric)
Date: Sat, 4 Jul 2015 22:26:26 +0000 (UTC)
Subject: [ovs-discuss] Best Practices for Configuring a Bonded Interface
 with Open vSwitch?
In-Reply-To: <1692339001.2163035.1436034253084.JavaMail.yahoo@mail.yahoo.com>
References: <1692339001.2163035.1436034253084.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <16174579.2200513.1436048786782.JavaMail.yahoo@mail.yahoo.com>

After reading "Red Hat network scripts integration" [https://github.com/openvswitch/ovs/blob/master/rhel/README.RHEL] I realized that I had a few typos in my configuration script so I decided to start all over.
I disable the bonded [physical] interface 'bond2':
> [root at xen-2 ~]# ifenslave -d bond2 eth1 eth5> [root at xen-2 ~]# grep ONBOOT /etc/sysconfig/network-scripts/ifcfg-bond2
>  ONBOOT=no

I removed the bonding configuration setting from eth1 & eth5:
> [root at xen-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth{1,5}
> DEVICE=eth1
> HWADDR=00:1F:29:69:6E:F0
> TYPE=Ethernet
> UUID=c1e34dd4-4fc5-47e7-9f90-a628d455528c
> ONBOOT=no
> USERCTL=no
> NM_CONTROLLED=no
> BOOTPROTO=none
> ...> DEVICE=eth5
> HWADDR=00:17:08:7D:66:1A
> TYPE=Ethernet
> UUID=72ff5cc7-b0c6-4958-bc8c-11ed95bd18a4
> ONBOOT=no
> USERCTL=no
> NM_CONTROLLED=no
> BOOTPROTO=none

I deleted all OVS bridges:
> [root at xen-2 ~]# ovs-vsctl del-br SAN
> [root at xen-2 ~]# ovs-vsctl del-br MGT
> [root at xen-2 ~]# ovs-vsctl del-br EXT

...and then I started from scratch (*after* a reboot)...
I created the virtual bridge 'EXT':
> [root at xen-2 ~]# ovs-vsctl add-br EXT

I added a [virtual] bonded port 'bond3' to the virtual bridge 'EXT':
> [root at xen-2 ~]# ovs-vsctl add-bond EXT bond3 eth1 eth5

...and I created the configuration for the 'EXT' interface from scratch:
> [root at xen-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond3
> DEVICE=EXT
> DEVICETYPE=ovs
> TYPE=OVSBond
> OVS_BRIDGE=EXT
> BOND_IFACES="ext1 ext5"
> OVS_OPTIONS="bonding_mode=active-backup"
> BOOTPROTO=static
> IPADDR=XXX.YYY.237.65
> NETMASK=255.255.255.0
> ONBOOT=yes
> USERCTL=no
> NM_CONTROLLED=no

This seems to work:
> [root at xen-2 ~]# ifconfig 
> EXT       Link encap:Ethernet  HWaddr 00:1F:29:69:6E:F0  
>           inet addr:XXX.YYY.237.65  Bcast:XXX.YYY.237.255  Mask:255.255.255.0
> <SNIP>
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
> <SNIP>
> 
> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> <SNIP>> 
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 2012ms
> ...
> 
> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge EXT
>         Port "bond3"
>             Interface "eth5"
>             Interface "eth1"
>         Port EXT
>             Interface EXT
>                 type: internal
>     ovs_version: "2.3.2"

> [root at xen-2 ~]# ovs-appctl bond/show bond3 > ---- bond3 ----
> bond_mode: active-backup
> bond may use recirculation: no, Recirc-ID : -1
> bond-hash-basis: 0
> updelay: 0 ms
> downdelay: 0 ms
> lacp_status: off
> active slave mac: 00:1f:29:69:6e:f0(eth1)
> 
> slave eth1: enabled
>         active slave
>         may_enable: true
> 
> slave eth5: enabled
>         may_enable: true
> 

I see that I have some adjustments to make in the 'OVS_BRIDGE' & 'DEVICETYPE' fields of the ifcfg-bond3 configuration file but, overall: Is this approach "more correct"?

TIA,
Eric Pretorious
Portland, OR

 
      From: Eric <epretorious at yahoo.com>
 To: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Saturday, July 4, 2015 11:24 AM
 Subject: Best Practices for Configuring a Bonded Interface with Open vSwitch?
   
Hello, All:

I've just installed OVS on my Xen host and I'm wondering if there's a recommended configuration for bonding [pysical] interfaces with OVS? e.g., My host system has six [physical] interfaces. I've combined those [physical] interfaces to create three bonded interfaces: 'bond0', 'bond1', and 'bond2'.

For the initial OVS implementation, I created three virtual bridges: 'EXT', 'MGT', and 'SAN':

> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge SAN
>         Port SAN
>             Interface SAN
>                 type: internal
>     Bridge EXT
>         Port EXT
>             Interface EXT
>                 type: internal
>     Bridge MGT
>         Port MGT
>             Interface MGT
>                 type: internal
>     ovs_version: "2.3.2"

Then I removed the IP address from the bonded interface 'bond2' (manually *and* via configuration files) and connected it to the virtual bridge 'EXT':

> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge SAN
>         Port SAN
>             Interface SAN
>                 type: internal
>     Bridge EXT
>         Port "bond2"
>             Interface "bond2"
>         Port EXT
>             Interface EXT
>                 type: internal
>     Bridge MGT
>         Port MGT
>             Interface MGT
>                 type: internal
>     ovs_version: "2.3.2"

This works well enough but, after a reboot, the 'bond2' interface refuses to pass any traffic to the [physical] gateway, XXX.YYY.237.1 until I disconnect the bond (i.e., 'bond2') from the virtual switch and re-attach it:

> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> From XXX.YYY.237.65 icmp_seq=1 Destination Host Unreachable
> From XXX.YYY.237.65 icmp_seq=2 Destination Host Unreachable
> From XXX.YYY.237.65 icmp_seq=3 Destination Host Unreachable
>
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2937ms
> pipe 3
> 
> [root at xen-2 ~]# ovs-vsctl del-port EXT bond2 && ovs-vsctl --may-exist add-port EXT bond2
>
> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> 64 bytes from XXX.YYY.237.1: icmp_seq=1 ttl=64 time=56.7 ms
> 64 bytes from XXX.YYY.237.1: icmp_seq=2 ttl=64 time=48.8 ms
> 64 bytes from XXX.YYY.237.1: icmp_seq=3 ttl=64 time=47.6 ms
>
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 2049ms
> rtt min/avg/max/mdev = 47.650/51.073/56.724/4.033 ms

Should I destroy the 'bond2' interface and create the bond using OVS instead? Or is this configuration correct?

FWIW: I've provided a few more details and demonstrations here: https://www.centos.org/forums/viewtopic.php?f=50&t=53219
TIA,
Eric Pretorious
Portland, OR

REFERENCE:

[root at xen-2 ~]# cat /etc/sysconfig/network /etc/sysconfig/network-scripts/ifcfg-{bond2,EXT}
NETWORKING=yes
GATEWAY=XXX.YYY.237.1
HOSTNAME=xen-2
DNS1=208.67.220.220
DNS2=208.67.222.222
...
DEVICE=bond2
BOOTPROTO=none
ONBOOT=yes
NM_CONTOLLED=no
USERCTL=no
BONDING_OPTS='mode=1 miimon=100'
...
DEVICE=EXT
OVSBRIDGE=EXT
TYPE=ovs
DEVICETYPE=OVSPort
IPADDR=XXX.YYY.237.65
NETMASK=255.255.255.0
BOOTPROTO=static
ONBOOT=yes


   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150704/b5efbcf0/attachment-0001.html>

From epretorious at yahoo.com  Sat Jul  4 16:34:11 2015
From: epretorious at yahoo.com (Eric)
Date: Sat, 4 Jul 2015 23:34:11 +0000 (UTC)
Subject: [ovs-discuss] Best Practices for Configuring a Bonded Interface
 with Open vSwitch?
In-Reply-To: <16174579.2200513.1436048786782.JavaMail.yahoo@mail.yahoo.com>
References: <1692339001.2163035.1436034253084.JavaMail.yahoo@mail.yahoo.com>
 <16174579.2200513.1436048786782.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <1769874714.1542942.1436052852056.JavaMail.yahoo@mail.yahoo.com>

During a reboot, I see LOTS of errors about my sloppy typing:
> BOND_IFACES="ext1 ext5"
Otherwise, things are working pretty well:
> [root at xen-2 network-scripts]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge EXT
>         Port "bond3"
>             Interface "eth5"
>             Interface "eth1"
>         Port EXT
>             Interface EXT
>                 type: internal
>     ovs_version: "2.3.2"
> 
> [root at xen-2 network-scripts]# ovs-appctl bond/show bond3 
> ---- bond3 ----
> bond_mode: active-backup
> bond may use recirculation: no, Recirc-ID : -1
> bond-hash-basis: 0
> updelay: 0 ms
> downdelay: 0 ms
> lacp_status: off
> active slave mac: 00:1f:29:69:6e:f0(eth1)
> 
> slave eth1: enabled
>         active slave
>         may_enable: true
> 
> slave eth5: enabled
>         may_enable: true

I'm still kind'a puzzled about the 'DEVICE' and the 'OVS_BRIDGE' configuration settings, though:

> [root at xen-2 network-scripts]# cat ifcfg-bond3
> DEVICE=EXT
> DEVICETYPE=ovs
> TYPE=OVSBond
> OVS_BRIDGE=EXT
> BOND_IFACES="eth1 eth5"
> OVS_OPTIONS="bonding_mode=active-backup"
> BOOTPROTO=static
> IPADDR=XXX.YYY.237.65
> NETMASK=255.255.255.0
> ONBOOT=yes
> USERCTL=no
> NM_CONTROLLED=no

e.g., When restarting the host's networking stack, the system complains:
> Bringing up interface bond3:  ovs-vsctl: cannot create a port named EXT because a bridge named EXT already exists
> RTNETLINK answers: File exists
> Bringing up interface eth1:  RTNETLINK answers: File exists
> Bringing up interface eth5:  RTNETLINK answers: File exists

...and eth1 & eth5 are the only two [physical] interfaces to have IPv6 addresses assigned to them. (The other four [physical] interfaces are in active bonds ['bond0' & 'bond1'].)
> eth1      Link encap:Ethernet  HWaddr 00:1F:29:69:6E:F0  
>           inet6 addr: fe80::XXXX:29ff:fe69:6ef0/64 Scope:Link
> eth5      Link encap:Ethernet  HWaddr 00:17:08:7D:66:1A  
>           inet6 addr: fe80::YYYY:8ff:fe7d:661a/64 Scope:Link

Should the 'DEVICE' and the 'OVS_BRIDGE' configuration settings be changed (to prevent the errors [above])? Or are they correct? e.g., Should one of those settings contain the name of the [virtual] port 'bond3'?
Should the 'ifcfg-bond3' file be renamed? Or is 'ifcfg-bond3' correct+appropriate?

Should I modify the 'ifcfg-eth1' & 'ifcfg-eth5' settings (to prevent the "TRNETLINK" errors [above])?
TIA,Eric Pretorious
Portland, OR



 
      From: Eric <epretorious at yahoo.com>
 To: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Saturday, July 4, 2015 3:26 PM
 Subject: Re: Best Practices for Configuring a Bonded Interface with Open vSwitch?
   
After reading "Red Hat network scripts integration" [https://github.com/openvswitch/ovs/blob/master/rhel/README.RHEL] I realized that I had a few typos in my configuration script so I decided to start all over.
I disable the bonded [physical] interface 'bond2':
> [root at xen-2 ~]# ifenslave -d bond2 eth1 eth5> [root at xen-2 ~]# grep ONBOOT /etc/sysconfig/network-scripts/ifcfg-bond2
>  ONBOOT=no

I removed the bonding configuration setting from eth1 & eth5:
> [root at xen-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth{1,5}
> DEVICE=eth1
> HWADDR=00:1F:29:69:6E:F0
> TYPE=Ethernet
> UUID=c1e34dd4-4fc5-47e7-9f90-a628d455528c
> ONBOOT=no
> USERCTL=no
> NM_CONTROLLED=no
> BOOTPROTO=none
> ...> DEVICE=eth5
> HWADDR=00:17:08:7D:66:1A
> TYPE=Ethernet
> UUID=72ff5cc7-b0c6-4958-bc8c-11ed95bd18a4
> ONBOOT=no
> USERCTL=no
> NM_CONTROLLED=no
> BOOTPROTO=none

I deleted all OVS bridges:
> [root at xen-2 ~]# ovs-vsctl del-br SAN
> [root at xen-2 ~]# ovs-vsctl del-br MGT
> [root at xen-2 ~]# ovs-vsctl del-br EXT

...and then I started from scratch (*after* a reboot)...
I created the virtual bridge 'EXT':
> [root at xen-2 ~]# ovs-vsctl add-br EXT

I added a [virtual] bonded port 'bond3' to the virtual bridge 'EXT':
> [root at xen-2 ~]# ovs-vsctl add-bond EXT bond3 eth1 eth5

...and I created the configuration for the 'EXT' interface from scratch:
> [root at xen-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond3
> DEVICE=EXT
> DEVICETYPE=ovs
> TYPE=OVSBond
> OVS_BRIDGE=EXT
> BOND_IFACES="ext1 ext5"
> OVS_OPTIONS="bonding_mode=active-backup"
> BOOTPROTO=static
> IPADDR=XXX.YYY.237.65
> NETMASK=255.255.255.0
> ONBOOT=yes
> USERCTL=no
> NM_CONTROLLED=no

This seems to work:
> [root at xen-2 ~]# ifconfig 
> EXT       Link encap:Ethernet  HWaddr 00:1F:29:69:6E:F0  
>           inet addr:XXX.YYY.237.65  Bcast:XXX.YYY.237.255  Mask:255.255.255.0
> <SNIP>
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
> <SNIP>
> 
> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> <SNIP>> 
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 2012ms
> ...
> 
> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge EXT
>         Port "bond3"
>             Interface "eth5"
>             Interface "eth1"
>         Port EXT
>             Interface EXT
>                 type: internal
>     ovs_version: "2.3.2"

> [root at xen-2 ~]# ovs-appctl bond/show bond3 > ---- bond3 ----
> bond_mode: active-backup
> bond may use recirculation: no, Recirc-ID : -1
> bond-hash-basis: 0
> updelay: 0 ms
> downdelay: 0 ms
> lacp_status: off
> active slave mac: 00:1f:29:69:6e:f0(eth1)
> 
> slave eth1: enabled
>         active slave
>         may_enable: true
> 
> slave eth5: enabled
>         may_enable: true
> 

I see that I have some adjustments to make in the 'OVS_BRIDGE' & 'DEVICETYPE' fields of the ifcfg-bond3 configuration file but, overall: Is this approach "more correct"?

TIA,
Eric Pretorious
Portland, OR

 


      From: Eric <epretorious at yahoo.com>
 To: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Saturday, July 4, 2015 11:24 AM
 Subject: Best Practices for Configuring a Bonded Interface with Open vSwitch?
   
Hello, All:

I've just installed OVS on my Xen host and I'm wondering if there's a recommended configuration for bonding [pysical] interfaces with OVS? e.g., My host system has six [physical] interfaces. I've combined those [physical] interfaces to create three bonded interfaces: 'bond0', 'bond1', and 'bond2'.

For the initial OVS implementation, I created three virtual bridges: 'EXT', 'MGT', and 'SAN':

> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge SAN
>         Port SAN
>             Interface SAN
>                 type: internal
>     Bridge EXT
>         Port EXT
>             Interface EXT
>                 type: internal
>     Bridge MGT
>         Port MGT
>             Interface MGT
>                 type: internal
>     ovs_version: "2.3.2"

Then I removed the IP address from the bonded interface 'bond2' (manually *and* via configuration files) and connected it to the virtual bridge 'EXT':

> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge SAN
>         Port SAN
>             Interface SAN
>                 type: internal
>     Bridge EXT
>         Port "bond2"
>             Interface "bond2"
>         Port EXT
>             Interface EXT
>                 type: internal
>     Bridge MGT
>         Port MGT
>             Interface MGT
>                 type: internal
>     ovs_version: "2.3.2"

This works well enough but, after a reboot, the 'bond2' interface refuses to pass any traffic to the [physical] gateway, XXX.YYY.237.1 until I disconnect the bond (i.e., 'bond2') from the virtual switch and re-attach it:

> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> From XXX.YYY.237.65 icmp_seq=1 Destination Host Unreachable
> From XXX.YYY.237.65 icmp_seq=2 Destination Host Unreachable
> From XXX.YYY.237.65 icmp_seq=3 Destination Host Unreachable
>
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2937ms
> pipe 3
> 
> [root at xen-2 ~]# ovs-vsctl del-port EXT bond2 && ovs-vsctl --may-exist add-port EXT bond2
>
> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> 64 bytes from XXX.YYY.237.1: icmp_seq=1 ttl=64 time=56.7 ms
> 64 bytes from XXX.YYY.237.1: icmp_seq=2 ttl=64 time=48.8 ms
> 64 bytes from XXX.YYY.237.1: icmp_seq=3 ttl=64 time=47.6 ms
>
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 2049ms
> rtt min/avg/max/mdev = 47.650/51.073/56.724/4.033 ms

Should I destroy the 'bond2' interface and create the bond using OVS instead? Or is this configuration correct?

FWIW: I've provided a few more details and demonstrations here: https://www.centos.org/forums/viewtopic.php?f=50&t=53219
TIA,
Eric Pretorious
Portland, OR

REFERENCE:

[root at xen-2 ~]# cat /etc/sysconfig/network /etc/sysconfig/network-scripts/ifcfg-{bond2,EXT}
NETWORKING=yes
GATEWAY=XXX.YYY.237.1
HOSTNAME=xen-2
DNS1=208.67.220.220
DNS2=208.67.222.222
...
DEVICE=bond2
BOOTPROTO=none
ONBOOT=yes
NM_CONTOLLED=no
USERCTL=no
BONDING_OPTS='mode=1 miimon=100'
...
DEVICE=EXT
OVSBRIDGE=EXT
TYPE=ovs
DEVICETYPE=OVSPort
IPADDR=XXX.YYY.237.65
NETMASK=255.255.255.0
BOOTPROTO=static
ONBOOT=yes


   
 

   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150704/32d5fbb6/attachment-0001.html>

From jayachandran.subramanian at wipro.com  Sun Jul  5 21:23:42 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Mon, 6 Jul 2015 04:23:42 +0000
Subject: [ovs-discuss] Openflow 1.4 bundle script issue.
In-Reply-To: <20150704062803.GN30080@nicira.com>
References: <SINPR03MB331313449FEC470F695277295960@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150703150010.GA30080@nicira.com>
 <SINPR03MB33143448D6C31A08FF302BC95950@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150704062803.GN30080@nicira.com>
Message-ID: <SINPR03MB331F2C8038A93A5A118613295930@SINPR03MB331.apcprd03.prod.outlook.com>

HI Ben ,

Thank you for your mail , please find the github commit "512f6c83585bb0e32ef9faf215e595f1e85d56de".

Here we are not committing anything in Github . We have downloaded the Git hub oftest scripts and using with openvswitch for execution .

But observed that , openvswitch2.3.90 only supports up to wire protocol of 0x04 . which version of openvswitch supports wire protocol 0x05 .(i.e openflow version 1.4)

Please let us know the same .

Thanks
Jayachandran S
+91-8861883300

-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com]
Sent: 04 July 2015 11:58
To: Jayachandran Subramanian (WT01 - PES)
Cc: bugs at openvswitch.org; Suresh Mahadevappa (WT01 - PES)
Subject: Re: Openflow 1.4 bundle script issue.

What commit from Github did you build?

On Sat, Jul 04, 2015 at 04:09:16AM +0000, jayachandran.subramanian at wipro.com wrote:
> Hi Ben ,
>
> Thank you for your mail , we havent build any package. we have downloaded openvswitch-2.3.90 from git hub and executing for bundle(openflow version 1.4) related scripts.
>
> Openvswitch 2.3.90 supports wire protocol upto 0x04. This bundle feature is in openflow version 1.4 which is wire protocol of 0x05.
>
> Kindly let me know openvswitch 2.3.90 supports this bundle (wire protocol of 0x04)feature .
>
> Thanks
> Jayachandran S
> +91-8861883300
>
> ________________________________________
> From: Ben Pfaff <blp at nicira.com>
> Sent: Friday, July 3, 2015 8:30 PM
> To: Jayachandran Subramanian (WT01 - PES)
> Cc: bugs at openvswitch.org; Suresh Mahadevappa (WT01 - PES)
> Subject: Re: Openflow 1.4 bundle script issue.
>
> On Fri, Jul 03, 2015 at 04:38:05AM +0000, jayachandran.subramanian at wipro.com wrote:
> > We are working on openflow 1.4 bundle Git hub oftest suite and test cases failing with openvswitch for  the below ofp message.
> >
> >
> >
> > bundle_ctrl_type=ofp.OFPBCT_OPEN_REQUEST
> >
> > self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
> >
> >
> >
> > bundle_ctrl_type=ofp.OFPBCT_COMMIT_REQUEST
> >
> > self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_COMMIT_REPLY)
> >
> > bundle_ctrl_type=ofp.OFPBCT_DISCARD_REQUEST
> >
> > self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
> >
> >
> >
> >   Openvswitch version : openvswitch - 2.3.90
> >
> >   OS version                    : Ubuntu 14.04 Trusty
> >
> >   Open flow version      : 1.4
> > Kindly let us know the above ofp message is supporting with openvswitch-2.3.90
>
> What commit did you build?
> The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com

From jayachandran.subramanian at wipro.com  Sun Jul  5 23:29:33 2015
From: jayachandran.subramanian at wipro.com (jayachandran.subramanian at wipro.com)
Date: Mon, 6 Jul 2015 06:29:33 +0000
Subject: [ovs-discuss] openflow 1.4 support in openvswitch 2.3.90
Message-ID: <SINPR03MB3312364E97A01FDE0C94B8A95930@SINPR03MB331.apcprd03.prod.outlook.com>

Hi ,We have downloaded openvswitch 2.3.90 and executing open flow git hub oftest suite's



openvswitch2.3.90 only supports up to wire protocol of 0x04 . which version of openvswitch supports wire protocol 0x05 .(i.e openflow version 1.4)



Please let us know the same .



Thanks

Jayachandran S
+91-8861883300
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150706/882ec1e2/attachment.html>

From blp at nicira.com  Mon Jul  6 07:24:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 6 Jul 2015 07:24:25 -0700
Subject: [ovs-discuss] Openflow 1.4 bundle script issue.
In-Reply-To: <SINPR03MB331F2C8038A93A5A118613295930@SINPR03MB331.apcprd03.prod.outlook.com>
References: <SINPR03MB331313449FEC470F695277295960@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150703150010.GA30080@nicira.com>
 <SINPR03MB33143448D6C31A08FF302BC95950@SINPR03MB331.apcprd03.prod.outlook.com>
 <20150704062803.GN30080@nicira.com>
 <SINPR03MB331F2C8038A93A5A118613295930@SINPR03MB331.apcprd03.prod.outlook.com>
Message-ID: <20150706142425.GB7061@nicira.com>


There is no such commit on github.

On Mon, Jul 06, 2015 at 04:23:42AM +0000, jayachandran.subramanian at wipro.com wrote:
> Thank you for your mail , please find the github commit "512f6c83585bb0e32ef9faf215e595f1e85d56de".
>
> Here we are not committing anything in Github . We have downloaded the Git hub oftest scripts and using with openvswitch for execution .
> 
> But observed that , openvswitch2.3.90 only supports up to wire protocol of 0x04 . which version of openvswitch supports wire protocol 0x05 .(i.e openflow version 1.4)
> 
> Please let us know the same .
> 
> Thanks
> Jayachandran S
> +91-8861883300
> 
> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: 04 July 2015 11:58
> To: Jayachandran Subramanian (WT01 - PES)
> Cc: bugs at openvswitch.org; Suresh Mahadevappa (WT01 - PES)
> Subject: Re: Openflow 1.4 bundle script issue.
> 
> What commit from Github did you build?
> 
> On Sat, Jul 04, 2015 at 04:09:16AM +0000, jayachandran.subramanian at wipro.com wrote:
> > Hi Ben ,
> >
> > Thank you for your mail , we havent build any package. we have downloaded openvswitch-2.3.90 from git hub and executing for bundle(openflow version 1.4) related scripts.
> >
> > Openvswitch 2.3.90 supports wire protocol upto 0x04. This bundle feature is in openflow version 1.4 which is wire protocol of 0x05.
> >
> > Kindly let me know openvswitch 2.3.90 supports this bundle (wire protocol of 0x04)feature .
> >
> > Thanks
> > Jayachandran S
> > +91-8861883300
> >
> > ________________________________________
> > From: Ben Pfaff <blp at nicira.com>
> > Sent: Friday, July 3, 2015 8:30 PM
> > To: Jayachandran Subramanian (WT01 - PES)
> > Cc: bugs at openvswitch.org; Suresh Mahadevappa (WT01 - PES)
> > Subject: Re: Openflow 1.4 bundle script issue.
> >
> > On Fri, Jul 03, 2015 at 04:38:05AM +0000, jayachandran.subramanian at wipro.com wrote:
> > > We are working on openflow 1.4 bundle Git hub oftest suite and test cases failing with openvswitch for  the below ofp message.
> > >
> > >
> > >
> > > bundle_ctrl_type=ofp.OFPBCT_OPEN_REQUEST
> > >
> > > self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
> > >
> > >
> > >
> > > bundle_ctrl_type=ofp.OFPBCT_COMMIT_REQUEST
> > >
> > > self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_COMMIT_REPLY)
> > >
> > > bundle_ctrl_type=ofp.OFPBCT_DISCARD_REQUEST
> > >
> > > self.assertEqual(response.bundle_ctrl_type, ofp.OFPBCT_OPEN_REPLY)
> > >
> > >
> > >
> > >   Openvswitch version : openvswitch - 2.3.90
> > >
> > >   OS version                    : Ubuntu 14.04 Trusty
> > >
> > >   Open flow version      : 1.4
> > > Kindly let us know the above ofp message is supporting with openvswitch-2.3.90
> >
> > What commit did you build?
> > The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
> The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com

From blp at nicira.com  Mon Jul  6 07:25:09 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 6 Jul 2015 07:25:09 -0700
Subject: [ovs-discuss] openflow 1.4 support in openvswitch 2.3.90
In-Reply-To: <SINPR03MB3312364E97A01FDE0C94B8A95930@SINPR03MB331.apcprd03.prod.outlook.com>
References: <SINPR03MB3312364E97A01FDE0C94B8A95930@SINPR03MB331.apcprd03.prod.outlook.com>
Message-ID: <20150706142509.GC7061@nicira.com>

Please read the FAQ.

### Q: What versions of OpenFlow does Open vSwitch support?

A: The following table lists the versions of OpenFlow supported by
   each version of Open vSwitch:

       Open vSwitch      OF1.0  OF1.1  OF1.2  OF1.3  OF1.4  OF1.5
       ###============   =====  =====  =====  =====  =====  =====
       1.9 and earlier    yes    ---    ---    ---    ---    ---
       1.10               yes    ---    [*]    [*]    ---    ---
       1.11               yes    ---    [*]    [*]    ---    ---
       2.0                yes    [*]    [*]    [*]    ---    ---
       2.1                yes    [*]    [*]    [*]    ---    ---
       2.2                yes    [*]    [*]    [*]    [%]    [*]
       2.3                yes    yes    yes    yes    [*]    [*]

       [*] Supported, with one or more missing features.
       [%] Experimental, unsafe implementation.

   Open vSwitch 2.3 enables OpenFlow 1.0, 1.1, 1.2, and 1.3 by default
   in ovs-vswitchd.  In Open vSwitch 1.10 through 2.2, OpenFlow 1.1,
   1.2, and 1.3 must be enabled manually in ovs-vswitchd.  OpenFlow
   1.4 and 1.5 are also supported, with missing features, in Open
   vSwitch 2.3 and later, but not enabled by default.  In any case,
   the user may override the default:

   - To enable OpenFlow 1.0, 1.1, 1.2, and 1.3 on bridge br0:

     ovs-vsctl set bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13

   - To enable OpenFlow 1.0, 1.1, 1.2, 1.3, 1.4, and 1.5 on bridge br0:

     ovs-vsctl set bridge br0 protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15

   - To enable only OpenFlow 1.0 on bridge br0:

     ovs-vsctl set bridge br0 protocols=OpenFlow10

   All current versions of ovs-ofctl enable only OpenFlow 1.0 by
   default.  Use the -O option to enable support for later versions of
   OpenFlow in ovs-ofctl.  For example:

       ovs-ofctl -O OpenFlow13 dump-flows br0

   (Open vSwitch 2.2 had an experimental implementation of OpenFlow
   1.4 that could cause crashes.  We don't recommend enabling it.)

   [OPENFLOW-1.1+.md] in the Open vSwitch source tree tracks support for
   OpenFlow 1.1 and later features.  When support for OpenFlow 1.4 and
   1.5 is solidly implemented, Open vSwitch will enable those version
   by default.  Also, the OpenFlow 1.5 specification is still under
   development and thus subject to change.

On Mon, Jul 06, 2015 at 06:29:33AM +0000, jayachandran.subramanian at wipro.com wrote:
> Hi ,We have downloaded openvswitch 2.3.90 and executing open flow git hub oftest suite's
> 
> 
> 
> openvswitch2.3.90 only supports up to wire protocol of 0x04 . which version of openvswitch supports wire protocol 0x05 .(i.e openflow version 1.4)
> 
> 
> 
> Please let us know the same .
> 
> 
> 
> Thanks
> 
> Jayachandran S
> +91-8861883300
> The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From blp at nicira.com  Mon Jul  6 08:22:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 6 Jul 2015 08:22:17 -0700
Subject: [ovs-discuss] openvswitch with POX and qemu guests
In-Reply-To: <CAJ9ww9gFoq9Mc7gnPx22Mvoy06Z5jfV0VetEBBZBWFS5zO5yaw@mail.gmail.com>
References: <CAJ9ww9gFoq9Mc7gnPx22Mvoy06Z5jfV0VetEBBZBWFS5zO5yaw@mail.gmail.com>
Message-ID: <20150706152217.GD7061@nicira.com>

On Sat, Jul 04, 2015 at 10:45:51PM +0800, Caleb Yu wrote:
> I have question concerning linking POX controller with openvswitch. I link
> bridge br0 of openvswitch to two qemu VM guests.
> The configuration of qemu VM to openvswitch bridge is sudo
> qemu-system-x86_64 -m 1028 -net nic,macaddr=00:00:00:00:cc:10 -net
> tap,script=/etc/ovs-ifup,downscript=//etc/ovs-ifdown -drive
> file=/home/pads/Desktop/kvmguest/pads1.qcow2 -vnc :1.
> I am using ./pox.py forwarding.l2_learning to start pox.
> I hit two problems while linking openvswitch to pox.
> 
> 1. packet:(udp parse) warning UDP packet data shorter than UDP len: 94 < 251
> 
> 2.INFO:packet:(dhcp parse) warning DHCP packet data too short to parse
> header: data len 86
> 
> The result is that whlie in guest1 I can't ping the controller's ip. The
> controller ip is the same as the host ip. I don't seem to have this problem
> when I use floodlight controller. Thus do I have to modify the pox
> controller to make it work. I have to use POX controller to do some test. I
> find from online that I may have to change the default data len number in
> POX. But I am not sure.

Off-hand, these problems sound like ones that the people on the POX
mailing lists might be better equipped to help with.

From ckonstanski at pippiandcarlos.com  Mon Jul  6 11:50:02 2015
From: ckonstanski at pippiandcarlos.com (Carlos Konstanski)
Date: Mon, 06 Jul 2015 12:50:02 -0600
Subject: [ovs-discuss] upgrading openvswitch
Message-ID: <559ACDDA.9050003@pippiandcarlos.com>

I am in the middle of an openvswitch upgrade from version 2.3.0 to 
2.3.1. It is not going well. The issue: conf.db.

The format of the JSON changed, so it is not possible to start 2.3.1 
with a file generated under 2.3.0. The file must be regenerated.

In order to regenerate it, I had to do the following:

- stop openvswitch services
- delete conf.db
- generate a new conf.db (used emerge --config openvswitch in gentoo)
- start openvswitch services
- re-configure openvswitch from scratch because all the config in 
conf.db was lost

I tried a modified version of these steps to attempt doing the procedure 
over an SSH connection. (I temporarily made eth0 the primary interface.) 
In the end it proved to be impossible. There comes a point when you have 
to turn on openvswitch with a blank config, and at point you have no 
network connectivity.

I thought of copying the relevant portions of the old conf.db to paste 
into the new file. But that seemed like a bad idea because the format fo 
the JSON could have changed. Indeed some part of the file changed enough 
to render the old format unusable, which is why this entire procedure 
was necessary to begin with.

Openvswith must be running in order to execute the commands needed to 
add interfaces to the config. Had it been possible to edit the config 
while openvswitch was down, I would have had a way out of this quandry.

It seems that a highly advanced networking software package needs to be 
capable of being upgraded over a network connection. There should be an 
upgrade path for non-backward-compatible changes.

Is there an alternative to running ovs-vsctl commands for writing the 
config that can be done while openvswitch is down?

Thanks,
Carlos Konstanski

From shettyg at nicira.com  Mon Jul  6 13:03:55 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 6 Jul 2015 13:03:55 -0700
Subject: [ovs-discuss] upgrading openvswitch
In-Reply-To: <559ACDDA.9050003@pippiandcarlos.com>
References: <559ACDDA.9050003@pippiandcarlos.com>
Message-ID: <CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>

On Mon, Jul 6, 2015 at 11:50 AM, Carlos Konstanski
<ckonstanski at pippiandcarlos.com> wrote:
> I am in the middle of an openvswitch upgrade from version 2.3.0 to 2.3.1. It
> is not going well. The issue: conf.db.
>
> The format of the JSON changed, so it is not possible to start 2.3.1 with a
> file generated under 2.3.0. The file must be regenerated.

What is the platform on which you have installed openvswitch? (i.e.
Ubuntu, Rhel etc)
Usually a simple '/etc/init.d/openvswitch* restart' should
automatically take care of the changes in database schema. If it did
not, it is an unfortunate bug.


>
> In order to regenerate it, I had to do the following:
>
> - stop openvswitch services
> - delete conf.db
> - generate a new conf.db (used emerge --config openvswitch in gentoo)
> - start openvswitch services
> - re-configure openvswitch from scratch because all the config in conf.db
> was lost
>
> I tried a modified version of these steps to attempt doing the procedure
> over an SSH connection. (I temporarily made eth0 the primary interface.) In
> the end it proved to be impossible. There comes a point when you have to
> turn on openvswitch with a blank config, and at point you have no network
> connectivity.
>
> I thought of copying the relevant portions of the old conf.db to paste into
> the new file. But that seemed like a bad idea because the format fo the JSON
> could have changed. Indeed some part of the file changed enough to render
> the old format unusable, which is why this entire procedure was necessary to
> begin with.
>
> Openvswith must be running in order to execute the commands needed to add
> interfaces to the config. Had it been possible to edit the config while
> openvswitch was down, I would have had a way out of this quandry.
>
> It seems that a highly advanced networking software package needs to be
> capable of being upgraded over a network connection. There should be an
> upgrade path for non-backward-compatible changes.
>
> Is there an alternative to running ovs-vsctl commands for writing the config
> that can be done while openvswitch is down?
>
> Thanks,
> Carlos Konstanski
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From ckonstanski at pippiandcarlos.com  Mon Jul  6 13:18:57 2015
From: ckonstanski at pippiandcarlos.com (Carlos Konstanski)
Date: Mon, 06 Jul 2015 14:18:57 -0600
Subject: [ovs-discuss] upgrading openvswitch
In-Reply-To: <CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>
References: <559ACDDA.9050003@pippiandcarlos.com>
 <CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>
Message-ID: <559AE2B1.40402@pippiandcarlos.com>

Gentoo. Looking at the ebuild script, I see that it downloads the source 
from:

http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz

I actually have two service scripts:

/etc/init.d/ovsdb-server
/etc/init.d/ovs-vswitchd

ovs-vswitchd depends on ovsdb-server.

The moment I tried to restart these services after the upgrade, it 
complained that conf.db was incompatible. That's when it all started.

Carlos

On 06.07.15 14:03, Gurucharan Shetty wrote:
> On Mon, Jul 6, 2015 at 11:50 AM, Carlos Konstanski
> <ckonstanski at pippiandcarlos.com> wrote:
>> I am in the middle of an openvswitch upgrade from version 2.3.0 to 2.3.1. It
>> is not going well. The issue: conf.db.
>>
>> The format of the JSON changed, so it is not possible to start 2.3.1 with a
>> file generated under 2.3.0. The file must be regenerated.
>
> What is the platform on which you have installed openvswitch? (i.e.
> Ubuntu, Rhel etc)
> Usually a simple '/etc/init.d/openvswitch* restart' should
> automatically take care of the changes in database schema. If it did
> not, it is an unfortunate bug.
>
>
>>
>> In order to regenerate it, I had to do the following:
>>
>> - stop openvswitch services
>> - delete conf.db
>> - generate a new conf.db (used emerge --config openvswitch in gentoo)
>> - start openvswitch services
>> - re-configure openvswitch from scratch because all the config in conf.db
>> was lost
>>
>> I tried a modified version of these steps to attempt doing the procedure
>> over an SSH connection. (I temporarily made eth0 the primary interface.) In
>> the end it proved to be impossible. There comes a point when you have to
>> turn on openvswitch with a blank config, and at point you have no network
>> connectivity.
>>
>> I thought of copying the relevant portions of the old conf.db to paste into
>> the new file. But that seemed like a bad idea because the format fo the JSON
>> could have changed. Indeed some part of the file changed enough to render
>> the old format unusable, which is why this entire procedure was necessary to
>> begin with.
>>
>> Openvswith must be running in order to execute the commands needed to add
>> interfaces to the config. Had it been possible to edit the config while
>> openvswitch was down, I would have had a way out of this quandry.
>>
>> It seems that a highly advanced networking software package needs to be
>> capable of being upgraded over a network connection. There should be an
>> upgrade path for non-backward-compatible changes.
>>
>> Is there an alternative to running ovs-vsctl commands for writing the config
>> that can be done while openvswitch is down?
>>
>> Thanks,
>> Carlos Konstanski
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss

From shettyg at nicira.com  Mon Jul  6 13:22:36 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 6 Jul 2015 13:22:36 -0700
Subject: [ovs-discuss] upgrading openvswitch
In-Reply-To: <559AE2B1.40402@pippiandcarlos.com>
References: <559ACDDA.9050003@pippiandcarlos.com>
 <CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>
 <559AE2B1.40402@pippiandcarlos.com>
Message-ID: <CAHbON5qqTpNN5h__3_YRn9EABEQcdyPhv-ZQ96ZH7hrNE6DMEw@mail.gmail.com>

Looks like Gentoo has screwed it up for you without providing a proper
way to upgrade OVS.

On Mon, Jul 6, 2015 at 1:18 PM, Carlos Konstanski
<ckonstanski at pippiandcarlos.com> wrote:
> Gentoo. Looking at the ebuild script, I see that it downloads the source
> from:
>
> http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz
>
> I actually have two service scripts:
>
> /etc/init.d/ovsdb-server
> /etc/init.d/ovs-vswitchd
>
> ovs-vswitchd depends on ovsdb-server.
>
> The moment I tried to restart these services after the upgrade, it
> complained that conf.db was incompatible. That's when it all started.
>
> Carlos
>
>
> On 06.07.15 14:03, Gurucharan Shetty wrote:
>>
>> On Mon, Jul 6, 2015 at 11:50 AM, Carlos Konstanski
>> <ckonstanski at pippiandcarlos.com> wrote:
>>>
>>> I am in the middle of an openvswitch upgrade from version 2.3.0 to 2.3.1.
>>> It
>>> is not going well. The issue: conf.db.
>>>
>>> The format of the JSON changed, so it is not possible to start 2.3.1 with
>>> a
>>> file generated under 2.3.0. The file must be regenerated.
>>
>>
>> What is the platform on which you have installed openvswitch? (i.e.
>> Ubuntu, Rhel etc)
>> Usually a simple '/etc/init.d/openvswitch* restart' should
>> automatically take care of the changes in database schema. If it did
>> not, it is an unfortunate bug.
>>
>>
>>>
>>> In order to regenerate it, I had to do the following:
>>>
>>> - stop openvswitch services
>>> - delete conf.db
>>> - generate a new conf.db (used emerge --config openvswitch in gentoo)
>>> - start openvswitch services
>>> - re-configure openvswitch from scratch because all the config in conf.db
>>> was lost
>>>
>>> I tried a modified version of these steps to attempt doing the procedure
>>> over an SSH connection. (I temporarily made eth0 the primary interface.)
>>> In
>>> the end it proved to be impossible. There comes a point when you have to
>>> turn on openvswitch with a blank config, and at point you have no network
>>> connectivity.
>>>
>>> I thought of copying the relevant portions of the old conf.db to paste
>>> into
>>> the new file. But that seemed like a bad idea because the format fo the
>>> JSON
>>> could have changed. Indeed some part of the file changed enough to render
>>> the old format unusable, which is why this entire procedure was necessary
>>> to
>>> begin with.
>>>
>>> Openvswith must be running in order to execute the commands needed to add
>>> interfaces to the config. Had it been possible to edit the config while
>>> openvswitch was down, I would have had a way out of this quandry.
>>>
>>> It seems that a highly advanced networking software package needs to be
>>> capable of being upgraded over a network connection. There should be an
>>> upgrade path for non-backward-compatible changes.
>>>
>>> Is there an alternative to running ovs-vsctl commands for writing the
>>> config
>>> that can be done while openvswitch is down?
>>>
>>> Thanks,
>>> Carlos Konstanski
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss

From ckonstanski at pippiandcarlos.com  Mon Jul  6 13:25:23 2015
From: ckonstanski at pippiandcarlos.com (Carlos Konstanski)
Date: Mon, 06 Jul 2015 14:25:23 -0600
Subject: [ovs-discuss] upgrading openvswitch
In-Reply-To: <CAHbON5qqTpNN5h__3_YRn9EABEQcdyPhv-ZQ96ZH7hrNE6DMEw@mail.gmail.com>
References: <559ACDDA.9050003@pippiandcarlos.com>	<CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>	<559AE2B1.40402@pippiandcarlos.com>
 <CAHbON5qqTpNN5h__3_YRn9EABEQcdyPhv-ZQ96ZH7hrNE6DMEw@mail.gmail.com>
Message-ID: <559AE433.1070504@pippiandcarlos.com>

I'll enter this as a gentoo bug.

Carlos

On 06.07.15 14:22, Gurucharan Shetty wrote:
> Looks like Gentoo has screwed it up for you without providing a proper
> way to upgrade OVS.
>
> On Mon, Jul 6, 2015 at 1:18 PM, Carlos Konstanski
> <ckonstanski at pippiandcarlos.com> wrote:
>> Gentoo. Looking at the ebuild script, I see that it downloads the source
>> from:
>>
>> http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz
>>
>> I actually have two service scripts:
>>
>> /etc/init.d/ovsdb-server
>> /etc/init.d/ovs-vswitchd
>>
>> ovs-vswitchd depends on ovsdb-server.
>>
>> The moment I tried to restart these services after the upgrade, it
>> complained that conf.db was incompatible. That's when it all started.
>>
>> Carlos
>>
>>
>> On 06.07.15 14:03, Gurucharan Shetty wrote:
>>>
>>> On Mon, Jul 6, 2015 at 11:50 AM, Carlos Konstanski
>>> <ckonstanski at pippiandcarlos.com> wrote:
>>>>
>>>> I am in the middle of an openvswitch upgrade from version 2.3.0 to 2.3.1.
>>>> It
>>>> is not going well. The issue: conf.db.
>>>>
>>>> The format of the JSON changed, so it is not possible to start 2.3.1 with
>>>> a
>>>> file generated under 2.3.0. The file must be regenerated.
>>>
>>>
>>> What is the platform on which you have installed openvswitch? (i.e.
>>> Ubuntu, Rhel etc)
>>> Usually a simple '/etc/init.d/openvswitch* restart' should
>>> automatically take care of the changes in database schema. If it did
>>> not, it is an unfortunate bug.
>>>
>>>
>>>>
>>>> In order to regenerate it, I had to do the following:
>>>>
>>>> - stop openvswitch services
>>>> - delete conf.db
>>>> - generate a new conf.db (used emerge --config openvswitch in gentoo)
>>>> - start openvswitch services
>>>> - re-configure openvswitch from scratch because all the config in conf.db
>>>> was lost
>>>>
>>>> I tried a modified version of these steps to attempt doing the procedure
>>>> over an SSH connection. (I temporarily made eth0 the primary interface.)
>>>> In
>>>> the end it proved to be impossible. There comes a point when you have to
>>>> turn on openvswitch with a blank config, and at point you have no network
>>>> connectivity.
>>>>
>>>> I thought of copying the relevant portions of the old conf.db to paste
>>>> into
>>>> the new file. But that seemed like a bad idea because the format fo the
>>>> JSON
>>>> could have changed. Indeed some part of the file changed enough to render
>>>> the old format unusable, which is why this entire procedure was necessary
>>>> to
>>>> begin with.
>>>>
>>>> Openvswith must be running in order to execute the commands needed to add
>>>> interfaces to the config. Had it been possible to edit the config while
>>>> openvswitch was down, I would have had a way out of this quandry.
>>>>
>>>> It seems that a highly advanced networking software package needs to be
>>>> capable of being upgraded over a network connection. There should be an
>>>> upgrade path for non-backward-compatible changes.
>>>>
>>>> Is there an alternative to running ovs-vsctl commands for writing the
>>>> config
>>>> that can be done while openvswitch is down?
>>>>
>>>> Thanks,
>>>> Carlos Konstanski
>>>> _______________________________________________
>>>> discuss mailing list
>>>> discuss at openvswitch.org
>>>> http://openvswitch.org/mailman/listinfo/discuss

From shettyg at nicira.com  Mon Jul  6 13:27:24 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 6 Jul 2015 13:27:24 -0700
Subject: [ovs-discuss] upgrading openvswitch
In-Reply-To: <CAHbON5qqTpNN5h__3_YRn9EABEQcdyPhv-ZQ96ZH7hrNE6DMEw@mail.gmail.com>
References: <559ACDDA.9050003@pippiandcarlos.com>
 <CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>
 <559AE2B1.40402@pippiandcarlos.com>
 <CAHbON5qqTpNN5h__3_YRn9EABEQcdyPhv-ZQ96ZH7hrNE6DMEw@mail.gmail.com>
Message-ID: <CAHbON5p1rhBU58uHkfraWT1ZmE_uOA7WOkoFZLCcgz=hCN60Ug@mail.gmail.com>

Please have a look at the function ''restart ()" and
"force_reload_kmod ()"  in utilities/ovs-ctl.in of OVS repo for the
proper way to handle upgrades.

There is also a note in "Upgrading" and "Hot Upgrading" sections of
INSTALL.md file of OVS repo which talks about this topic.


On Mon, Jul 6, 2015 at 1:22 PM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> Looks like Gentoo has screwed it up for you without providing a proper
> way to upgrade OVS.
>
> On Mon, Jul 6, 2015 at 1:18 PM, Carlos Konstanski
> <ckonstanski at pippiandcarlos.com> wrote:
>> Gentoo. Looking at the ebuild script, I see that it downloads the source
>> from:
>>
>> http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz
>>
>> I actually have two service scripts:
>>
>> /etc/init.d/ovsdb-server
>> /etc/init.d/ovs-vswitchd
>>
>> ovs-vswitchd depends on ovsdb-server.
>>
>> The moment I tried to restart these services after the upgrade, it
>> complained that conf.db was incompatible. That's when it all started.
>>
>> Carlos
>>
>>
>> On 06.07.15 14:03, Gurucharan Shetty wrote:
>>>
>>> On Mon, Jul 6, 2015 at 11:50 AM, Carlos Konstanski
>>> <ckonstanski at pippiandcarlos.com> wrote:
>>>>
>>>> I am in the middle of an openvswitch upgrade from version 2.3.0 to 2.3.1.
>>>> It
>>>> is not going well. The issue: conf.db.
>>>>
>>>> The format of the JSON changed, so it is not possible to start 2.3.1 with
>>>> a
>>>> file generated under 2.3.0. The file must be regenerated.
>>>
>>>
>>> What is the platform on which you have installed openvswitch? (i.e.
>>> Ubuntu, Rhel etc)
>>> Usually a simple '/etc/init.d/openvswitch* restart' should
>>> automatically take care of the changes in database schema. If it did
>>> not, it is an unfortunate bug.
>>>
>>>
>>>>
>>>> In order to regenerate it, I had to do the following:
>>>>
>>>> - stop openvswitch services
>>>> - delete conf.db
>>>> - generate a new conf.db (used emerge --config openvswitch in gentoo)
>>>> - start openvswitch services
>>>> - re-configure openvswitch from scratch because all the config in conf.db
>>>> was lost
>>>>
>>>> I tried a modified version of these steps to attempt doing the procedure
>>>> over an SSH connection. (I temporarily made eth0 the primary interface.)
>>>> In
>>>> the end it proved to be impossible. There comes a point when you have to
>>>> turn on openvswitch with a blank config, and at point you have no network
>>>> connectivity.
>>>>
>>>> I thought of copying the relevant portions of the old conf.db to paste
>>>> into
>>>> the new file. But that seemed like a bad idea because the format fo the
>>>> JSON
>>>> could have changed. Indeed some part of the file changed enough to render
>>>> the old format unusable, which is why this entire procedure was necessary
>>>> to
>>>> begin with.
>>>>
>>>> Openvswith must be running in order to execute the commands needed to add
>>>> interfaces to the config. Had it been possible to edit the config while
>>>> openvswitch was down, I would have had a way out of this quandry.
>>>>
>>>> It seems that a highly advanced networking software package needs to be
>>>> capable of being upgraded over a network connection. There should be an
>>>> upgrade path for non-backward-compatible changes.
>>>>
>>>> Is there an alternative to running ovs-vsctl commands for writing the
>>>> config
>>>> that can be done while openvswitch is down?
>>>>
>>>> Thanks,
>>>> Carlos Konstanski
>>>> _______________________________________________
>>>> discuss mailing list
>>>> discuss at openvswitch.org
>>>> http://openvswitch.org/mailman/listinfo/discuss

From ckonstanski at pippiandcarlos.com  Mon Jul  6 13:28:26 2015
From: ckonstanski at pippiandcarlos.com (Carlos Konstanski)
Date: Mon, 06 Jul 2015 14:28:26 -0600
Subject: [ovs-discuss] upgrading openvswitch
In-Reply-To: <559AE433.1070504@pippiandcarlos.com>
References: <559ACDDA.9050003@pippiandcarlos.com>	<CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>	<559AE2B1.40402@pippiandcarlos.com>
 <CAHbON5qqTpNN5h__3_YRn9EABEQcdyPhv-ZQ96ZH7hrNE6DMEw@mail.gmail.com>
 <559AE433.1070504@pippiandcarlos.com>
Message-ID: <559AE4EA.9030401@pippiandcarlos.com>

Again looking at the ebuild, this is how it tries to upgrade the db:

/usr/bin/ovsdb-tool convert /var/lib/openvswitch/conf.db 
/usr/share/openvswitch/vswitch.ovsschema

Carlos

On 06.07.15 14:25, Carlos Konstanski wrote:
> I'll enter this as a gentoo bug.
>
> Carlos
>
> On 06.07.15 14:22, Gurucharan Shetty wrote:
>> Looks like Gentoo has screwed it up for you without providing a proper
>> way to upgrade OVS.
>>
>> On Mon, Jul 6, 2015 at 1:18 PM, Carlos Konstanski
>> <ckonstanski at pippiandcarlos.com> wrote:
>>> Gentoo. Looking at the ebuild script, I see that it downloads the source
>>> from:
>>>
>>> http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz
>>>
>>> I actually have two service scripts:
>>>
>>> /etc/init.d/ovsdb-server
>>> /etc/init.d/ovs-vswitchd
>>>
>>> ovs-vswitchd depends on ovsdb-server.
>>>
>>> The moment I tried to restart these services after the upgrade, it
>>> complained that conf.db was incompatible. That's when it all started.
>>>
>>> Carlos
>>>
>>>
>>> On 06.07.15 14:03, Gurucharan Shetty wrote:
>>>>
>>>> On Mon, Jul 6, 2015 at 11:50 AM, Carlos Konstanski
>>>> <ckonstanski at pippiandcarlos.com> wrote:
>>>>>
>>>>> I am in the middle of an openvswitch upgrade from version 2.3.0 to
>>>>> 2.3.1.
>>>>> It
>>>>> is not going well. The issue: conf.db.
>>>>>
>>>>> The format of the JSON changed, so it is not possible to start
>>>>> 2.3.1 with
>>>>> a
>>>>> file generated under 2.3.0. The file must be regenerated.
>>>>
>>>>
>>>> What is the platform on which you have installed openvswitch? (i.e.
>>>> Ubuntu, Rhel etc)
>>>> Usually a simple '/etc/init.d/openvswitch* restart' should
>>>> automatically take care of the changes in database schema. If it did
>>>> not, it is an unfortunate bug.
>>>>
>>>>
>>>>>
>>>>> In order to regenerate it, I had to do the following:
>>>>>
>>>>> - stop openvswitch services
>>>>> - delete conf.db
>>>>> - generate a new conf.db (used emerge --config openvswitch in gentoo)
>>>>> - start openvswitch services
>>>>> - re-configure openvswitch from scratch because all the config in
>>>>> conf.db
>>>>> was lost
>>>>>
>>>>> I tried a modified version of these steps to attempt doing the
>>>>> procedure
>>>>> over an SSH connection. (I temporarily made eth0 the primary
>>>>> interface.)
>>>>> In
>>>>> the end it proved to be impossible. There comes a point when you
>>>>> have to
>>>>> turn on openvswitch with a blank config, and at point you have no
>>>>> network
>>>>> connectivity.
>>>>>
>>>>> I thought of copying the relevant portions of the old conf.db to paste
>>>>> into
>>>>> the new file. But that seemed like a bad idea because the format fo
>>>>> the
>>>>> JSON
>>>>> could have changed. Indeed some part of the file changed enough to
>>>>> render
>>>>> the old format unusable, which is why this entire procedure was
>>>>> necessary
>>>>> to
>>>>> begin with.
>>>>>
>>>>> Openvswith must be running in order to execute the commands needed
>>>>> to add
>>>>> interfaces to the config. Had it been possible to edit the config
>>>>> while
>>>>> openvswitch was down, I would have had a way out of this quandry.
>>>>>
>>>>> It seems that a highly advanced networking software package needs
>>>>> to be
>>>>> capable of being upgraded over a network connection. There should
>>>>> be an
>>>>> upgrade path for non-backward-compatible changes.
>>>>>
>>>>> Is there an alternative to running ovs-vsctl commands for writing the
>>>>> config
>>>>> that can be done while openvswitch is down?
>>>>>
>>>>> Thanks,
>>>>> Carlos Konstanski
>>>>> _______________________________________________
>>>>> discuss mailing list
>>>>> discuss at openvswitch.org
>>>>> http://openvswitch.org/mailman/listinfo/discuss
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Mon Jul  6 13:52:11 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 6 Jul 2015 13:52:11 -0700
Subject: [ovs-discuss] upgrading openvswitch
In-Reply-To: <559AE4EA.9030401@pippiandcarlos.com>
References: <559ACDDA.9050003@pippiandcarlos.com>
 <CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>
 <559AE2B1.40402@pippiandcarlos.com>
 <CAHbON5qqTpNN5h__3_YRn9EABEQcdyPhv-ZQ96ZH7hrNE6DMEw@mail.gmail.com>
 <559AE433.1070504@pippiandcarlos.com>
 <559AE4EA.9030401@pippiandcarlos.com>
Message-ID: <20150706205211.GA16203@nicira.com>

On Mon, Jul 06, 2015 at 02:28:26PM -0600, Carlos Konstanski wrote:
> Again looking at the ebuild, this is how it tries to upgrade the db:
> 
> /usr/bin/ovsdb-tool convert /var/lib/openvswitch/conf.db
> /usr/share/openvswitch/vswitch.ovsschema

That's the correct technique, assuming that the file names are correct.
See the "Upgrading" section in INSTALL.md for details.

From ckonstanski at pippiandcarlos.com  Mon Jul  6 14:01:38 2015
From: ckonstanski at pippiandcarlos.com (Carlos Konstanski)
Date: Mon, 06 Jul 2015 15:01:38 -0600
Subject: [ovs-discuss] upgrading openvswitch
In-Reply-To: <20150706205211.GA16203@nicira.com>
References: <559ACDDA.9050003@pippiandcarlos.com>
 <CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>
 <559AE2B1.40402@pippiandcarlos.com>
 <CAHbON5qqTpNN5h__3_YRn9EABEQcdyPhv-ZQ96ZH7hrNE6DMEw@mail.gmail.com>
 <559AE433.1070504@pippiandcarlos.com> <559AE4EA.9030401@pippiandcarlos.com>
 <20150706205211.GA16203@nicira.com>
Message-ID: <559AECB2.3040203@pippiandcarlos.com>

The file names are correct. And the "conversion" works once the old 
conf.db is deleted or moved out of the way.

I wish I had a copy of the old conf.db so I could provide it as a 
sample. I'd be curious to know which section causes the failure. Is it 
the big blob of JSON at the beginning, or the smaller blobs of JSON 
which describe the attached interfaces?

I held off on the upgrade for as long as possible. But then the gentoo 
kernel jumped to 4.0.5, and I had no choice.

Carlos

On 06.07.15 14:52, Ben Pfaff wrote:
> On Mon, Jul 06, 2015 at 02:28:26PM -0600, Carlos Konstanski wrote:
>> Again looking at the ebuild, this is how it tries to upgrade the db:
>>
>> /usr/bin/ovsdb-tool convert /var/lib/openvswitch/conf.db
>> /usr/share/openvswitch/vswitch.ovsschema
>
> That's the correct technique, assuming that the file names are correct.
> See the "Upgrading" section in INSTALL.md for details.
>

From blp at nicira.com  Mon Jul  6 14:03:54 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 6 Jul 2015 14:03:54 -0700
Subject: [ovs-discuss] upgrading openvswitch
In-Reply-To: <559AECB2.3040203@pippiandcarlos.com>
References: <559ACDDA.9050003@pippiandcarlos.com>
 <CAHbON5o_hrJTqA9AyQVa9TALehrjyncLAKm9qm+Lx9S2VVjUOg@mail.gmail.com>
 <559AE2B1.40402@pippiandcarlos.com>
 <CAHbON5qqTpNN5h__3_YRn9EABEQcdyPhv-ZQ96ZH7hrNE6DMEw@mail.gmail.com>
 <559AE433.1070504@pippiandcarlos.com>
 <559AE4EA.9030401@pippiandcarlos.com>
 <20150706205211.GA16203@nicira.com>
 <559AECB2.3040203@pippiandcarlos.com>
Message-ID: <20150706210354.GC16203@nicira.com>

It's hard to guess without seeing the file.  If you have it, please pass
it along.

On Mon, Jul 06, 2015 at 03:01:38PM -0600, Carlos Konstanski wrote:
> The file names are correct. And the "conversion" works once the old conf.db
> is deleted or moved out of the way.
> 
> I wish I had a copy of the old conf.db so I could provide it as a sample.
> I'd be curious to know which section causes the failure. Is it the big blob
> of JSON at the beginning, or the smaller blobs of JSON which describe the
> attached interfaces?
> 
> I held off on the upgrade for as long as possible. But then the gentoo
> kernel jumped to 4.0.5, and I had no choice.
> 
> Carlos
> 
> On 06.07.15 14:52, Ben Pfaff wrote:
> >On Mon, Jul 06, 2015 at 02:28:26PM -0600, Carlos Konstanski wrote:
> >>Again looking at the ebuild, this is how it tries to upgrade the db:
> >>
> >>/usr/bin/ovsdb-tool convert /var/lib/openvswitch/conf.db
> >>/usr/share/openvswitch/vswitch.ovsschema
> >
> >That's the correct technique, assuming that the file names are correct.
> >See the "Upgrading" section in INSTALL.md for details.
> >

From adilahmad17 at gmail.com  Mon Jul  6 06:46:52 2015
From: adilahmad17 at gmail.com (Adil Ahmad)
Date: Mon, 6 Jul 2015 18:46:52 +0500
Subject: [ovs-discuss] Limitations of Mininet
Message-ID: <CADgTXSMN0s9mVDFp_t_kCmvNnGUkuuXQ+hvLTkWBikWij_TUdg@mail.gmail.com>

Hey,

I was trying to get flow statistics and the implementation that I'm working
on requires that I get flow stats in RTT timescales. But, the flow
statistics show that the packet count counter is updated after almost a
second for OF 1.0 swtiches using POX. I want the packet counters to be
updated at every iteration around 1 ms. Is that a limitation with mininet
or OF 1.0?

Adil
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150706/273c754e/attachment-0001.html>

From epretorious at yahoo.com  Mon Jul  6 13:22:33 2015
From: epretorious at yahoo.com (Eric)
Date: Mon, 6 Jul 2015 20:22:33 +0000 (UTC)
Subject: [ovs-discuss] Best Practices for Configuring a Bonded Interface
 with Open vSwitch?
In-Reply-To: <1769874714.1542942.1436052852056.JavaMail.yahoo@mail.yahoo.com>
References: <1692339001.2163035.1436034253084.JavaMail.yahoo@mail.yahoo.com>
 <16174579.2200513.1436048786782.JavaMail.yahoo@mail.yahoo.com>
 <1769874714.1542942.1436052852056.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <428117198.3171943.1436214153284.JavaMail.yahoo@mail.yahoo.com>

> e.g., When restarting the host's networking stack, the system complains:
After destroying the bond and disbling the bond's ifcfg file:
> [root at xen-2 ~]# grep ONBOOT /etc/sysconfig/network-scripts/ifcfg-{bond2,eth1,eth5}
> /etc/sysconfig/network-scripts/ifcfg-bond2:ONBOOT=no
> /etc/sysconfig/network-scripts/ifcfg-eth1:ONBOOT=no
> /etc/sysconfig/network-scripts/ifcfg-eth5:ONBOOT=no
> 
> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge EXT
>         Port "bond3"
>             Interface "eth5"
>             Interface "eth1"
>         Port EXT
>             Interface EXT
>                 type: internal
>     ovs_version: "2.3.2"
> 
> [root at xen-2 ~]# ovs-appctl bond/show
> ---- bond3 ----
> bond_mode: active-backup
> bond may use recirculation: no, Recirc-ID : -1
> bond-hash-basis: 0
> updelay: 0 ms
> downdelay: 0 ms
> lacp_status: off
> active slave mac: 00:1f:29:69:6e:f0(eth1)
> 
> slave eth1: enabled
>         active slave
>         may_enable: true
> 
> slave eth5: enabled
>         may_enable: true

...things are working much more reliably. (I've noticed that, after creating the virtual bridge's bond *from*the*CLI*, things are a bit unstable. Creating the virtual bridge's bond *and*then* rebooting [to allow the init scripts to configure everything] seems to work much more reliably.)
> Should the 'DEVICE' and the 'OVS_BRIDGE' configuration settings be 
> changed (to prevent the errors [above])? Or are they correct? e.g.,> Should one of those settings contain the name of the [virtual] port 'bond3'?
I've played with the /etc/sysconfig/network-scripts/ifcfg-bond3 file and I haven't quite figured out the significance of the DEVICE and the OVS_BRIDGE values yet except that:
 * OVS_BRIDGE should be set to the name of the OVS bridge device.

> Should the 'ifcfg-bond3' file be renamed? Or is 'ifcfg-bond3'> correct+appropriate?
Seems to work just fine. 

> Should I modify the 'ifcfg-eth1' & 'ifcfg-eth5' settings (to prevent> the "TRNETLINK" errors [above])?
I've set "ONBOOT=no" for both interfaces and that seems to work just fine.
Eric Pretorious
Portland, OR



      From: Eric <epretorious at yahoo.com>
 To: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Saturday, July 4, 2015 4:34 PM
 Subject: Re: Best Practices for Configuring a Bonded Interface with Open vSwitch?
   
During a reboot, I see LOTS of errors about my sloppy typing:
> BOND_IFACES="ext1 ext5"
Otherwise, things are working pretty well:
> [root at xen-2 network-scripts]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge EXT
>         Port "bond3"
>             Interface "eth5"
>             Interface "eth1"
>         Port EXT
>             Interface EXT
>                 type: internal
>     ovs_version: "2.3.2"
> 
> [root at xen-2 network-scripts]# ovs-appctl bond/show bond3 
> ---- bond3 ----
> bond_mode: active-backup
> bond may use recirculation: no, Recirc-ID : -1
> bond-hash-basis: 0
> updelay: 0 ms
> downdelay: 0 ms
> lacp_status: off
> active slave mac: 00:1f:29:69:6e:f0(eth1)
> 
> slave eth1: enabled
>         active slave
>         may_enable: true
> 
> slave eth5: enabled
>         may_enable: true

I'm still kind'a puzzled about the 'DEVICE' and the 'OVS_BRIDGE' configuration settings, though:

> [root at xen-2 network-scripts]# cat ifcfg-bond3
> DEVICE=EXT
> DEVICETYPE=ovs
> TYPE=OVSBond
> OVS_BRIDGE=EXT
> BOND_IFACES="eth1 eth5"
> OVS_OPTIONS="bonding_mode=active-backup"
> BOOTPROTO=static
> IPADDR=XXX.YYY.237.65
> NETMASK=255.255.255.0
> ONBOOT=yes
> USERCTL=no
> NM_CONTROLLED=no

e.g., When restarting the host's networking stack, the system complains:
> Bringing up interface bond3:  ovs-vsctl: cannot create a port named EXT because a bridge named EXT already exists
> RTNETLINK answers: File exists
> Bringing up interface eth1:  RTNETLINK answers: File exists
> Bringing up interface eth5:  RTNETLINK answers: File exists

...and eth1 & eth5 are the only two [physical] interfaces to have IPv6 addresses assigned to them. (The other four [physical] interfaces are in active bonds ['bond0' & 'bond1'].)
> eth1      Link encap:Ethernet  HWaddr 00:1F:29:69:6E:F0  
>           inet6 addr: fe80::XXXX:29ff:fe69:6ef0/64 Scope:Link
> eth5      Link encap:Ethernet  HWaddr 00:17:08:7D:66:1A  
>           inet6 addr: fe80::YYYY:8ff:fe7d:661a/64 Scope:Link

Should the 'DEVICE' and the 'OVS_BRIDGE' configuration settings be changed (to prevent the errors [above])? Or are they correct? e.g., Should one of those settings contain the name of the [virtual] port 'bond3'?
Should the 'ifcfg-bond3' file be renamed? Or is 'ifcfg-bond3' correct+appropriate?

Should I modify the 'ifcfg-eth1' & 'ifcfg-eth5' settings (to prevent the "TRNETLINK" errors [above])?
TIA,Eric Pretorious
Portland, OR



 


      From: Eric <epretorious at yahoo.com>
 To: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Saturday, July 4, 2015 3:26 PM
 Subject: Re: Best Practices for Configuring a Bonded Interface with Open vSwitch?
   
After reading "Red Hat network scripts integration" [https://github.com/openvswitch/ovs/blob/master/rhel/README.RHEL] I realized that I had a few typos in my configuration script so I decided to start all over.
I disable the bonded [physical] interface 'bond2':
> [root at xen-2 ~]# ifenslave -d bond2 eth1 eth5> [root at xen-2 ~]# grep ONBOOT /etc/sysconfig/network-scripts/ifcfg-bond2
>  ONBOOT=no

I removed the bonding configuration setting from eth1 & eth5:
> [root at xen-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth{1,5}
> DEVICE=eth1
> HWADDR=00:1F:29:69:6E:F0
> TYPE=Ethernet
> UUID=c1e34dd4-4fc5-47e7-9f90-a628d455528c
> ONBOOT=no
> USERCTL=no
> NM_CONTROLLED=no
> BOOTPROTO=none
> ...> DEVICE=eth5
> HWADDR=00:17:08:7D:66:1A
> TYPE=Ethernet
> UUID=72ff5cc7-b0c6-4958-bc8c-11ed95bd18a4
> ONBOOT=no
> USERCTL=no
> NM_CONTROLLED=no
> BOOTPROTO=none

I deleted all OVS bridges:
> [root at xen-2 ~]# ovs-vsctl del-br SAN
> [root at xen-2 ~]# ovs-vsctl del-br MGT
> [root at xen-2 ~]# ovs-vsctl del-br EXT

...and then I started from scratch (*after* a reboot)...
I created the virtual bridge 'EXT':
> [root at xen-2 ~]# ovs-vsctl add-br EXT

I added a [virtual] bonded port 'bond3' to the virtual bridge 'EXT':
> [root at xen-2 ~]# ovs-vsctl add-bond EXT bond3 eth1 eth5

...and I created the configuration for the 'EXT' interface from scratch:
> [root at xen-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond3
> DEVICE=EXT
> DEVICETYPE=ovs
> TYPE=OVSBond
> OVS_BRIDGE=EXT
> BOND_IFACES="ext1 ext5"
> OVS_OPTIONS="bonding_mode=active-backup"
> BOOTPROTO=static
> IPADDR=XXX.YYY.237.65
> NETMASK=255.255.255.0
> ONBOOT=yes
> USERCTL=no
> NM_CONTROLLED=no

This seems to work:
> [root at xen-2 ~]# ifconfig 
> EXT       Link encap:Ethernet  HWaddr 00:1F:29:69:6E:F0  
>           inet addr:XXX.YYY.237.65  Bcast:XXX.YYY.237.255  Mask:255.255.255.0
> <SNIP>
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
> <SNIP>
> 
> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> <SNIP>> 
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 2012ms
> ...
> 
> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge EXT
>         Port "bond3"
>             Interface "eth5"
>             Interface "eth1"
>         Port EXT
>             Interface EXT
>                 type: internal
>     ovs_version: "2.3.2"

> [root at xen-2 ~]# ovs-appctl bond/show bond3 > ---- bond3 ----
> bond_mode: active-backup
> bond may use recirculation: no, Recirc-ID : -1
> bond-hash-basis: 0
> updelay: 0 ms
> downdelay: 0 ms
> lacp_status: off
> active slave mac: 00:1f:29:69:6e:f0(eth1)
> 
> slave eth1: enabled
>         active slave
>         may_enable: true
> 
> slave eth5: enabled
>         may_enable: true
> 

I see that I have some adjustments to make in the 'OVS_BRIDGE' & 'DEVICETYPE' fields of the ifcfg-bond3 configuration file but, overall: Is this approach "more correct"?

TIA,
Eric Pretorious
Portland, OR

 


      From: Eric <epretorious at yahoo.com>
 To: "discuss at openvswitch.org" <discuss at openvswitch.org> 
 Sent: Saturday, July 4, 2015 11:24 AM
 Subject: Best Practices for Configuring a Bonded Interface with Open vSwitch?
   
Hello, All:

I've just installed OVS on my Xen host and I'm wondering if there's a recommended configuration for bonding [pysical] interfaces with OVS? e.g., My host system has six [physical] interfaces. I've combined those [physical] interfaces to create three bonded interfaces: 'bond0', 'bond1', and 'bond2'.

For the initial OVS implementation, I created three virtual bridges: 'EXT', 'MGT', and 'SAN':

> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge SAN
>         Port SAN
>             Interface SAN
>                 type: internal
>     Bridge EXT
>         Port EXT
>             Interface EXT
>                 type: internal
>     Bridge MGT
>         Port MGT
>             Interface MGT
>                 type: internal
>     ovs_version: "2.3.2"

Then I removed the IP address from the bonded interface 'bond2' (manually *and* via configuration files) and connected it to the virtual bridge 'EXT':

> [root at xen-2 ~]# ovs-vsctl show
> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>     Bridge SAN
>         Port SAN
>             Interface SAN
>                 type: internal
>     Bridge EXT
>         Port "bond2"
>             Interface "bond2"
>         Port EXT
>             Interface EXT
>                 type: internal
>     Bridge MGT
>         Port MGT
>             Interface MGT
>                 type: internal
>     ovs_version: "2.3.2"

This works well enough but, after a reboot, the 'bond2' interface refuses to pass any traffic to the [physical] gateway, XXX.YYY.237.1 until I disconnect the bond (i.e., 'bond2') from the virtual switch and re-attach it:

> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> From XXX.YYY.237.65 icmp_seq=1 Destination Host Unreachable
> From XXX.YYY.237.65 icmp_seq=2 Destination Host Unreachable
> From XXX.YYY.237.65 icmp_seq=3 Destination Host Unreachable
>
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2937ms
> pipe 3
> 
> [root at xen-2 ~]# ovs-vsctl del-port EXT bond2 && ovs-vsctl --may-exist add-port EXT bond2
>
> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
> 64 bytes from XXX.YYY.237.1: icmp_seq=1 ttl=64 time=56.7 ms
> 64 bytes from XXX.YYY.237.1: icmp_seq=2 ttl=64 time=48.8 ms
> 64 bytes from XXX.YYY.237.1: icmp_seq=3 ttl=64 time=47.6 ms
>
> --- XXX.YYY.237.1 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 2049ms
> rtt min/avg/max/mdev = 47.650/51.073/56.724/4.033 ms

Should I destroy the 'bond2' interface and create the bond using OVS instead? Or is this configuration correct?

FWIW: I've provided a few more details and demonstrations here: https://www.centos.org/forums/viewtopic.php?f=50&t=53219
TIA,
Eric Pretorious
Portland, OR

REFERENCE:

[root at xen-2 ~]# cat /etc/sysconfig/network /etc/sysconfig/network-scripts/ifcfg-{bond2,EXT}
NETWORKING=yes
GATEWAY=XXX.YYY.237.1
HOSTNAME=xen-2
DNS1=208.67.220.220
DNS2=208.67.222.222
...
DEVICE=bond2
BOOTPROTO=none
ONBOOT=yes
NM_CONTOLLED=no
USERCTL=no
BONDING_OPTS='mode=1 miimon=100'
...
DEVICE=EXT
OVSBRIDGE=EXT
TYPE=ovs
DEVICETYPE=OVSPort
IPADDR=XXX.YYY.237.65
NETMASK=255.255.255.0
BOOTPROTO=static
ONBOOT=yes


   
 

   
 

   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150706/02fed504/attachment-0001.html>

From nick.bastin at gmail.com  Mon Jul  6 14:28:09 2015
From: nick.bastin at gmail.com (Nicholas Bastin)
Date: Mon, 6 Jul 2015 11:28:09 -1000
Subject: [ovs-discuss] Limitations of Mininet
In-Reply-To: <CADgTXSMN0s9mVDFp_t_kCmvNnGUkuuXQ+hvLTkWBikWij_TUdg@mail.gmail.com>
References: <CADgTXSMN0s9mVDFp_t_kCmvNnGUkuuXQ+hvLTkWBikWij_TUdg@mail.gmail.com>
Message-ID: <CADmMkWd4yi0tbnrZrKVQzKeYPCv+fJ=8Ne4WoQnXuzBtm_3UTg@mail.gmail.com>

On Mon, Jul 6, 2015 at 3:46 AM, Adil Ahmad <adilahmad17 at gmail.com> wrote:

> I was trying to get flow statistics and the implementation that I'm
> working on requires that I get flow stats in RTT timescales. But, the flow
> statistics show that the packet count counter is updated after almost a
> second for OF 1.0 swtiches using POX. I want the packet counters to be
> updated at every iteration around 1 ms. Is that a limitation with mininet
> or OF 1.0?
>

This is a limitation of mininet, although what mininet does (and OVS, by
extension) is much closer to what you want than any other OF device will do.

There is exactly zero chance that a real OF network (or any network) can
update packet counters on a per-ms basis.  Most hardware does so on a 1-10s
interval, and the shorter the interval the more sampling is used (and thus
the more inaccurate it may be).

This is not specific to OF - SNMP, NetFlow, sFlow, etc. also suffer from
this kind of update and sampling issue.  As a practical matter if you want
1ms accurate counters you will need to employ high-speed taps in your
network.

--
Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150706/cb736fe6/attachment.html>

From blp at nicira.com  Mon Jul  6 14:30:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 6 Jul 2015 14:30:52 -0700
Subject: [ovs-discuss] Limitations of Mininet
In-Reply-To: <CADmMkWd4yi0tbnrZrKVQzKeYPCv+fJ=8Ne4WoQnXuzBtm_3UTg@mail.gmail.com>
References: <CADgTXSMN0s9mVDFp_t_kCmvNnGUkuuXQ+hvLTkWBikWij_TUdg@mail.gmail.com>
 <CADmMkWd4yi0tbnrZrKVQzKeYPCv+fJ=8Ne4WoQnXuzBtm_3UTg@mail.gmail.com>
Message-ID: <20150706213052.GD16203@nicira.com>

On Mon, Jul 06, 2015 at 11:28:09AM -1000, Nicholas Bastin wrote:
> On Mon, Jul 6, 2015 at 3:46 AM, Adil Ahmad <adilahmad17 at gmail.com> wrote:
> 
> > I was trying to get flow statistics and the implementation that I'm
> > working on requires that I get flow stats in RTT timescales. But, the flow
> > statistics show that the packet count counter is updated after almost a
> > second for OF 1.0 swtiches using POX. I want the packet counters to be
> > updated at every iteration around 1 ms. Is that a limitation with mininet
> > or OF 1.0?
> >
> 
> This is a limitation of mininet, although what mininet does (and OVS, by
> extension) is much closer to what you want than any other OF device will do.
> 
> There is exactly zero chance that a real OF network (or any network) can
> update packet counters on a per-ms basis.  Most hardware does so on a 1-10s
> interval, and the shorter the interval the more sampling is used (and thus
> the more inaccurate it may be).

As long as OVS has mentioned mentioned anyway, OVS itself only updates
its counters about every second in normal operation.

From superk1947 at gmail.com  Mon Jul  6 16:39:58 2015
From: superk1947 at gmail.com (Super K)
Date: Mon, 6 Jul 2015 16:39:58 -0700
Subject: [ovs-discuss] handling packet from OFPP_LOCAL
Message-ID: <CANs9vWRPBVwwD4qttcs_0w=vUzSM3MmDd-1-206UkEaxn6LKdA@mail.gmail.com>

Hello,

I am new to OVS. I am trying to trace through the code to understand it
better. I programmed a flow to send the packet to LOCAL port.

Where can I see this packet within the code handled? I would like to get an
handle to the packet to do further processing on it.

Thank you in advance for help.

Thanks
Kiran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150706/66b1ce43/attachment.html>

From contact at progbau.de  Tue Jul  7 01:23:37 2015
From: contact at progbau.de (Chris)
Date: Tue, 7 Jul 2015 15:23:37 +0700
Subject: [ovs-discuss] ovs kernel module 2.3.2 build failed
Message-ID: <004b01d0b88e$3ae04ef0$b0a0ecd0$@progbau.de>

Hello,

 

I tried to build the kernel module rpm for the openvswitch version 2.3.2
with the Centos 6.6 kernel  2.6.32-504.23.4.el6.centos.plus.x86_64.

 

Please see the output below, I skipped a little bit and copied the piece
when its starts to throw errors:

 

rpmbuild -bb --without check
~/openvswitch-2.3.2/rhel/openvswitch-kmod-rhel6.spec

[.]

ln -s
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/.
./linux/compat/skbuff-openvswitch.c

ln -s
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/.
./linux/compat/vxlan.c

ln -s
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/.
./linux/compat/utils.c

/usr/bin/make -C /usr/src/kernels/2.6.32-504.23.4.el6.centos.plus.x86_64
M=/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux
modules

make[1]: Entering directory
`/usr/src/kernels/2.6.32-504.23.4.el6.centos.plus.x86_64'

  CC [M]
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/acti
ons.o

  CC [M]
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/data
path.o

In file included from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/acti
ons.c:21:

/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/skbuff.h: In function 'skb_clear_hash':

/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/skbuff.h:302: error: 'struct sk_buff' has no member
named 'l4_rxhash'

In file included from include/net/sock.h:50,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/net/sock.h:4,

                 from include/linux/tcp.h:180,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/tcp.h:4,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/acti
ons.c:26:

/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/netdevice.h: At top level:

/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/netdevice.h:37: error: conflicting types for
'netdev_rx_handler_register'

include/linux/netdevice.h:2204: note: previous declaration of
'netdev_rx_handler_register' was here

In file included from include/linux/if_ether.h:130,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/if_ether.h:4,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../include/linux/if
_ether.h:26,

                 from include/linux/netdevice.h:29,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/netdevice.h:4,

                 from include/linux/if_arp.h:26,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/if_arp.h:4,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/data
path.c:23:

/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/skbuff.h: In function 'skb_clear_hash':

/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/skbuff.h:302: error: 'struct sk_buff' has no member
named 'l4_rxhash'

make[2]: ***
[/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/act
ions.o] Error 1

make[2]: *** Waiting for unfinished jobs....

In file included from include/linux/if_arp.h:26,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/if_arp.h:4,

                 from
/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/data
path.c:23:

/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/netdevice.h: At top level:

/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/c
ompat/include/linux/netdevice.h:37: error: conflicting types for
'netdev_rx_handler_register'

include/linux/netdevice.h:2204: note: previous declaration of
'netdev_rx_handler_register' was here

make[2]: ***
[/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dat
apath.o] Error 1

make[1]: ***
[_module_/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/l
inux] Error 2

make[1]: Leaving directory
`/usr/src/kernels/2.6.32-504.23.4.el6.centos.plus.x86_64'

make: *** [default] Error 2

make: Leaving directory
`/home/ovswitch/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux'

error: Bad exit status from /var/tmp/rpm-tmp.J1Os80 (%build)

 

 

RPM build errors:

    Bad exit status from /var/tmp/rpm-tmp.J1Os80 (%build)

 

 

Any help appreciated!

 

Thanks,

Chris

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150707/f9824596/attachment-0001.html>

From shettyg at nicira.com  Tue Jul  7 07:50:57 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 7 Jul 2015 07:50:57 -0700
Subject: [ovs-discuss] Best Practices for Configuring a Bonded Interface
 with Open vSwitch?
In-Reply-To: <428117198.3171943.1436214153284.JavaMail.yahoo@mail.yahoo.com>
References: <1692339001.2163035.1436034253084.JavaMail.yahoo@mail.yahoo.com>
 <16174579.2200513.1436048786782.JavaMail.yahoo@mail.yahoo.com>
 <1769874714.1542942.1436052852056.JavaMail.yahoo@mail.yahoo.com>
 <428117198.3171943.1436214153284.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CAHbON5pt_SVwzmR0Anc8ygY_+01T+quVMR-MHW4W-x402sUpGA@mail.gmail.com>

I tried to follow the emails, but got lost a bit.
Fwiw,
 If you get bitten more, do have a look at
https://github.com/openvswitch/ovs/blob/master/rhel/etc_sysconfig_network-scripts_ifup-ovs
to know how the information in ifcfg-* gets translated into OVS
objects.

On Mon, Jul 6, 2015 at 1:22 PM, Eric <epretorious at yahoo.com> wrote:
>> e.g., When restarting the host's networking stack, the system complains:
>
> After destroying the bond and disbling the bond's ifcfg file:
>
>> [root at xen-2 ~]# grep ONBOOT
>> /etc/sysconfig/network-scripts/ifcfg-{bond2,eth1,eth5}
>> /etc/sysconfig/network-scripts/ifcfg-bond2:ONBOOT=no
>> /etc/sysconfig/network-scripts/ifcfg-eth1:ONBOOT=no
>> /etc/sysconfig/network-scripts/ifcfg-eth5:ONBOOT=no
>>
>> [root at xen-2 ~]# ovs-vsctl show
>> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>>     Bridge EXT
>>         Port "bond3"
>>             Interface "eth5"
>>             Interface "eth1"
>>         Port EXT
>>             Interface EXT
>>                 type: internal
>>     ovs_version: "2.3.2"
>>
>> [root at xen-2 ~]# ovs-appctl bond/show
>> ---- bond3 ----
>> bond_mode: active-backup
>> bond may use recirculation: no, Recirc-ID : -1
>> bond-hash-basis: 0
>> updelay: 0 ms
>> downdelay: 0 ms
>> lacp_status: off
>> active slave mac: 00:1f:29:69:6e:f0(eth1)
>>
>> slave eth1: enabled
>>         active slave
>>         may_enable: true
>>
>> slave eth5: enabled
>>         may_enable: true
>
> ...things are working much more reliably. (I've noticed that, after creating
> the virtual bridge's bond *from*the*CLI*, things are a bit unstable.
> Creating the virtual bridge's bond *and*then* rebooting [to allow the init
> scripts to configure everything] seems to work much more reliably.)
>
>> Should the 'DEVICE' and the 'OVS_BRIDGE' configuration settings be
>> changed (to prevent the errors [above])? Or are they correct? e.g.,
>> Should one of those settings contain the name of the [virtual] port
>> 'bond3'?
>
> I've played with the /etc/sysconfig/network-scripts/ifcfg-bond3 file and I
> haven't quite figured out the significance of the DEVICE and the OVS_BRIDGE
> values yet except that:
>
>  * OVS_BRIDGE should be set to the name of the OVS bridge device.
>
>> Should the 'ifcfg-bond3' file be renamed? Or is 'ifcfg-bond3'
>> correct+appropriate?
>
> Seems to work just fine.
>
>> Should I modify the 'ifcfg-eth1' & 'ifcfg-eth5' settings (to prevent
>> the "TRNETLINK" errors [above])?
>
> I've set "ONBOOT=no" for both interfaces and that seems to work just fine.
>
> Eric Pretorious
> Portland, OR
>
>
> ________________________________
> From: Eric <epretorious at yahoo.com>
> To: "discuss at openvswitch.org" <discuss at openvswitch.org>
> Sent: Saturday, July 4, 2015 4:34 PM
>
> Subject: Re: Best Practices for Configuring a Bonded Interface with Open
> vSwitch?
>
> During a reboot, I see LOTS of errors about my sloppy typing:
>
>> BOND_IFACES="ext1 ext5"
>
> Otherwise, things are working pretty well:
>
>> [root at xen-2 network-scripts]# ovs-vsctl show
>> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>>     Bridge EXT
>>         Port "bond3"
>>             Interface "eth5"
>>             Interface "eth1"
>>         Port EXT
>>             Interface EXT
>>                 type: internal
>>     ovs_version: "2.3.2"
>>
>> [root at xen-2 network-scripts]# ovs-appctl bond/show bond3
>> ---- bond3 ----
>> bond_mode: active-backup
>> bond may use recirculation: no, Recirc-ID : -1
>> bond-hash-basis: 0
>> updelay: 0 ms
>> downdelay: 0 ms
>> lacp_status: off
>> active slave mac: 00:1f:29:69:6e:f0(eth1)
>>
>> slave eth1: enabled
>>         active slave
>>         may_enable: true
>>
>> slave eth5: enabled
>>         may_enable: true
>
> I'm still kind'a puzzled about the 'DEVICE' and the 'OVS_BRIDGE'
> configuration settings, though:
>
>> [root at xen-2 network-scripts]# cat ifcfg-bond3
>> DEVICE=EXT
>> DEVICETYPE=ovs
>> TYPE=OVSBond
>> OVS_BRIDGE=EXT
>> BOND_IFACES="eth1 eth5"
>> OVS_OPTIONS="bonding_mode=active-backup"
>> BOOTPROTO=static
>> IPADDR=XXX.YYY.237.65
>> NETMASK=255.255.255.0
>> ONBOOT=yes
>> USERCTL=no
>> NM_CONTROLLED=no
>
> e.g., When restarting the host's networking stack, the system complains:
>
>> Bringing up interface bond3:  ovs-vsctl: cannot create a port named EXT
>> because a bridge named EXT already exists
>> RTNETLINK answers: File exists
>> Bringing up interface eth1:  RTNETLINK answers: File exists
>> Bringing up interface eth5:  RTNETLINK answers: File exists
>
> ...and eth1 & eth5 are the only two [physical] interfaces to have IPv6
> addresses assigned to them. (The other four [physical] interfaces are in
> active bonds ['bond0' & 'bond1'].)
>
>> eth1      Link encap:Ethernet  HWaddr 00:1F:29:69:6E:F0
>>           inet6 addr: fe80::XXXX:29ff:fe69:6ef0/64 Scope:Link
>> eth5      Link encap:Ethernet  HWaddr 00:17:08:7D:66:1A
>>           inet6 addr: fe80::YYYY:8ff:fe7d:661a/64 Scope:Link
>
> Should the 'DEVICE' and the 'OVS_BRIDGE' configuration settings be changed
> (to prevent the errors [above])? Or are they correct? e.g., Should one of
> those settings contain the name of the [virtual] port 'bond3'?
>
> Should the 'ifcfg-bond3' file be renamed? Or is 'ifcfg-bond3'
> correct+appropriate?
>
> Should I modify the 'ifcfg-eth1' & 'ifcfg-eth5' settings (to prevent the
> "TRNETLINK" errors [above])?
>
> TIA,
> Eric Pretorious
> Portland, OR
>
>
>
>
>
> ________________________________
> From: Eric <epretorious at yahoo.com>
> To: "discuss at openvswitch.org" <discuss at openvswitch.org>
> Sent: Saturday, July 4, 2015 3:26 PM
> Subject: Re: Best Practices for Configuring a Bonded Interface with Open
> vSwitch?
>
> After reading "Red Hat network scripts integration"
> [https://github.com/openvswitch/ovs/blob/master/rhel/README.RHEL] I realized
> that I had a few typos in my configuration script so I decided to start all
> over.
>
> I disable the bonded [physical] interface 'bond2':
>
>> [root at xen-2 ~]# ifenslave -d bond2 eth1 eth5
>> [root at xen-2 ~]# grep ONBOOT /etc/sysconfig/network-scripts/ifcfg-bond2
>>  ONBOOT=no
>
> I removed the bonding configuration setting from eth1 & eth5:
>
>> [root at xen-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth{1,5}
>> DEVICE=eth1
>> HWADDR=00:1F:29:69:6E:F0
>> TYPE=Ethernet
>> UUID=c1e34dd4-4fc5-47e7-9f90-a628d455528c
>> ONBOOT=no
>> USERCTL=no
>> NM_CONTROLLED=no
>> BOOTPROTO=none
>> ...
>> DEVICE=eth5
>> HWADDR=00:17:08:7D:66:1A
>> TYPE=Ethernet
>> UUID=72ff5cc7-b0c6-4958-bc8c-11ed95bd18a4
>> ONBOOT=no
>> USERCTL=no
>> NM_CONTROLLED=no
>> BOOTPROTO=none
>
> I deleted all OVS bridges:
>
>> [root at xen-2 ~]# ovs-vsctl del-br SAN
>> [root at xen-2 ~]# ovs-vsctl del-br MGT
>> [root at xen-2 ~]# ovs-vsctl del-br EXT
>
> ...and then I started from scratch (*after* a reboot)...
>
> I created the virtual bridge 'EXT':
>
>> [root at xen-2 ~]# ovs-vsctl add-br EXT
>
> I added a [virtual] bonded port 'bond3' to the virtual bridge 'EXT':
>
>> [root at xen-2 ~]# ovs-vsctl add-bond EXT bond3 eth1 eth5
>
> ...and I created the configuration for the 'EXT' interface from scratch:
>
>> [root at xen-2 ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond3
>> DEVICE=EXT
>> DEVICETYPE=ovs
>> TYPE=OVSBond
>> OVS_BRIDGE=EXT
>> BOND_IFACES="ext1 ext5"
>> OVS_OPTIONS="bonding_mode=active-backup"
>> BOOTPROTO=static
>> IPADDR=XXX.YYY.237.65
>> NETMASK=255.255.255.0
>> ONBOOT=yes
>> USERCTL=no
>> NM_CONTROLLED=no
>
> This seems to work:
>
>> [root at xen-2 ~]# ifconfig
>> EXT       Link encap:Ethernet  HWaddr 00:1F:29:69:6E:F0
>>           inet addr:XXX.YYY.237.65  Bcast:XXX.YYY.237.255
>> Mask:255.255.255.0
>> <SNIP>
>>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>> <SNIP>
>>
>> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
>> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
>> <SNIP>
>>
>> --- XXX.YYY.237.1 ping statistics ---
>> 3 packets transmitted, 3 received, 0% packet loss, time 2012ms
>> ...
>>
>> [root at xen-2 ~]# ovs-vsctl show
>> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>>     Bridge EXT
>>         Port "bond3"
>>             Interface "eth5"
>>             Interface "eth1"
>>         Port EXT
>>             Interface EXT
>>                 type: internal
>>     ovs_version: "2.3.2"
>
>> [root at xen-2 ~]# ovs-appctl bond/show bond3
>> ---- bond3 ----
>> bond_mode: active-backup
>> bond may use recirculation: no, Recirc-ID : -1
>> bond-hash-basis: 0
>> updelay: 0 ms
>> downdelay: 0 ms
>> lacp_status: off
>> active slave mac: 00:1f:29:69:6e:f0(eth1)
>>
>> slave eth1: enabled
>>         active slave
>>         may_enable: true
>>
>> slave eth5: enabled
>>         may_enable: true
>>
>
> I see that I have some adjustments to make in the 'OVS_BRIDGE' &
> 'DEVICETYPE' fields of the ifcfg-bond3 configuration file but, overall: Is
> this approach "more correct"?
>
> TIA,
> Eric Pretorious
> Portland, OR
>
>
>
> ________________________________
> From: Eric <epretorious at yahoo.com>
> To: "discuss at openvswitch.org" <discuss at openvswitch.org>
> Sent: Saturday, July 4, 2015 11:24 AM
> Subject: Best Practices for Configuring a Bonded Interface with Open
> vSwitch?
>
> Hello, All:
>
> I've just installed OVS on my Xen host and I'm wondering if there's a
> recommended configuration for bonding [pysical] interfaces with OVS? e.g.,
> My host system has six [physical] interfaces. I've combined those [physical]
> interfaces to create three bonded interfaces: 'bond0', 'bond1', and 'bond2'.
>
> For the initial OVS implementation, I created three virtual bridges: 'EXT',
> 'MGT', and 'SAN':
>
>> [root at xen-2 ~]# ovs-vsctl show
>> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>>     Bridge SAN
>>         Port SAN
>>             Interface SAN
>>                 type: internal
>>     Bridge EXT
>>         Port EXT
>>             Interface EXT
>>                 type: internal
>>     Bridge MGT
>>         Port MGT
>>             Interface MGT
>>                 type: internal
>>     ovs_version: "2.3.2"
>
> Then I removed the IP address from the bonded interface 'bond2' (manually
> *and* via configuration files) and connected it to the virtual bridge 'EXT':
>
>> [root at xen-2 ~]# ovs-vsctl show
>> 0dfeba4c-bcae-4773-8bd9-582a9ebbd01a
>>     Bridge SAN
>>         Port SAN
>>             Interface SAN
>>                 type: internal
>>     Bridge EXT
>>         Port "bond2"
>>             Interface "bond2"
>>         Port EXT
>>             Interface EXT
>>                 type: internal
>>     Bridge MGT
>>         Port MGT
>>             Interface MGT
>>                 type: internal
>>     ovs_version: "2.3.2"
>
> This works well enough but, after a reboot, the 'bond2' interface refuses to
> pass any traffic to the [physical] gateway, XXX.YYY.237.1 until I disconnect
> the bond (i.e., 'bond2') from the virtual switch and re-attach it:
>
>> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
>> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
>> From XXX.YYY.237.65 icmp_seq=1 Destination Host Unreachable
>> From XXX.YYY.237.65 icmp_seq=2 Destination Host Unreachable
>> From XXX.YYY.237.65 icmp_seq=3 Destination Host Unreachable
>>
>> --- XXX.YYY.237.1 ping statistics ---
>> 3 packets transmitted, 0 received, +3 errors, 100% packet loss, time
>> 2937ms
>> pipe 3
>>
>> [root at xen-2 ~]# ovs-vsctl del-port EXT bond2 && ovs-vsctl --may-exist
>> add-port EXT bond2
>>
>> [root at xen-2 ~]# ping -c3 XXX.YYY.237.1
>> PING XXX.YYY.237.1 (XXX.YYY.237.1) 56(84) bytes of data.
>> 64 bytes from XXX.YYY.237.1: icmp_seq=1 ttl=64 time=56.7 ms
>> 64 bytes from XXX.YYY.237.1: icmp_seq=2 ttl=64 time=48.8 ms
>> 64 bytes from XXX.YYY.237.1: icmp_seq=3 ttl=64 time=47.6 ms
>>
>> --- XXX.YYY.237.1 ping statistics ---
>> 3 packets transmitted, 3 received, 0% packet loss, time 2049ms
>> rtt min/avg/max/mdev = 47.650/51.073/56.724/4.033 ms
>
> Should I destroy the 'bond2' interface and create the bond using OVS
> instead? Or is this configuration correct?
>
> FWIW: I've provided a few more details and demonstrations here:
> https://www.centos.org/forums/viewtopic.php?f=50&t=53219
>
> TIA,
> Eric Pretorious
> Portland, OR
>
> REFERENCE:
>
> [root at xen-2 ~]# cat /etc/sysconfig/network
> /etc/sysconfig/network-scripts/ifcfg-{bond2,EXT}
> NETWORKING=yes
> GATEWAY=XXX.YYY.237.1
> HOSTNAME=xen-2
> DNS1=208.67.220.220
> DNS2=208.67.222.222
> ...
> DEVICE=bond2
> BOOTPROTO=none
> ONBOOT=yes
> NM_CONTOLLED=no
> USERCTL=no
> BONDING_OPTS='mode=1 miimon=100'
> ...
> DEVICE=EXT
> OVSBRIDGE=EXT
> TYPE=ovs
> DEVICETYPE=OVSPort
> IPADDR=XXX.YYY.237.65
> NETMASK=255.255.255.0
> BOOTPROTO=static
> ONBOOT=yes
>
>
>
>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From jesse at nicira.com  Tue Jul  7 09:23:39 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 7 Jul 2015 09:23:39 -0700
Subject: [ovs-discuss] ovs kernel module 2.3.2 build failed
In-Reply-To: <004b01d0b88e$3ae04ef0$b0a0ecd0$@progbau.de>
References: <004b01d0b88e$3ae04ef0$b0a0ecd0$@progbau.de>
Message-ID: <CAEP_g=_=u8So3dG1wTsF5=djq+AYJVrtTJw7OOE2R=q0afJkYg@mail.gmail.com>

On Tue, Jul 7, 2015 at 1:23 AM, Chris <contact at progbau.de> wrote:
> Hello,
>
>
>
> I tried to build the kernel module rpm for the openvswitch version 2.3.2
> with the Centos 6.6 kernel  2.6.32-504.23.4.el6.centos.plus.x86_64.
>
>
>
> Please see the output below, I skipped a little bit and copied the piece
> when its starts to throw errors:

Can you try cherry picking commit
3d174bfd1a6dc0734f4333385fbcb0dd4dd12df4 ("datapath: compat: Fix build
on RHEL 6.6") and the patch I just sent out?

From adilahmad17 at gmail.com  Mon Jul  6 16:14:55 2015
From: adilahmad17 at gmail.com (Adil Ahmad)
Date: Mon, 06 Jul 2015 23:14:55 +0000
Subject: [ovs-discuss] Limitations of Mininet
In-Reply-To: <20150706213052.GD16203@nicira.com>
References: <CADgTXSMN0s9mVDFp_t_kCmvNnGUkuuXQ+hvLTkWBikWij_TUdg@mail.gmail.com>
 <CADmMkWd4yi0tbnrZrKVQzKeYPCv+fJ=8Ne4WoQnXuzBtm_3UTg@mail.gmail.com>
 <20150706213052.GD16203@nicira.com>
Message-ID: <CADgTXSMS7NbqWgucOvNMkA1sOs8Z-3wGgenBA06jQyxZARO0Aw@mail.gmail.com>

Alright, thank you for the insights.

Adil.

On Tue, 7 Jul 2015 at 2:30 am Ben Pfaff <blp at nicira.com> wrote:

> On Mon, Jul 06, 2015 at 11:28:09AM -1000, Nicholas Bastin wrote:
> > On Mon, Jul 6, 2015 at 3:46 AM, Adil Ahmad <adilahmad17 at gmail.com>
> wrote:
> >
> > > I was trying to get flow statistics and the implementation that I'm
> > > working on requires that I get flow stats in RTT timescales. But, the
> flow
> > > statistics show that the packet count counter is updated after almost a
> > > second for OF 1.0 swtiches using POX. I want the packet counters to be
> > > updated at every iteration around 1 ms. Is that a limitation with
> mininet
> > > or OF 1.0?
> > >
> >
> > This is a limitation of mininet, although what mininet does (and OVS, by
> > extension) is much closer to what you want than any other OF device will
> do.
> >
> > There is exactly zero chance that a real OF network (or any network) can
> > update packet counters on a per-ms basis.  Most hardware does so on a
> 1-10s
> > interval, and the shorter the interval the more sampling is used (and
> thus
> > the more inaccurate it may be).
>
> As long as OVS has mentioned mentioned anyway, OVS itself only updates
> its counters about every second in normal operation.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150706/727d3700/attachment-0001.html>

From pritamkharat10221 at gmail.com  Tue Jul  7 02:32:54 2015
From: pritamkharat10221 at gmail.com (Pritam Kharat)
Date: Tue, 7 Jul 2015 15:02:54 +0530
Subject: [ovs-discuss] Problem in using packet values against register
	values in ovs-flow
Message-ID: <CALeURuOFcN7dC6ZuRcsGW4q9LgpzzWEWWbasdYub6ifkQnw7Jg@mail.gmail.com>

Hi All,

1) In a ovs flow how do I load a nw_src with mask value  from a packet to
register say reg0 ? Doc says we can load only integer or hex value to a
register ? Is there any way to do it ?

e.g
*table=0,<flow-match>,actions=load:(nw_src/mask)->NXM_NX_REG0[],load:(nw_dst/mask)->NXM_NX_REG1[],resubmit(,1)*

2) Can we create ovs flow which compares values in two registers. ?
 e.g * match -> table=1,reg0==reg1*
*       actions -> drop*

What I am trying to do is, see if packet is destined to vm of same subnet.
If yes then drop the packet.This I want to do using registers so that way I
will have only one flow ?


3) Can I compare value from packet with value in register ?

e.g *table=1,nw_src=reg0,actions=drop*

How do we do it through ovs-ofctl command if possible and  if not, then
what can be other way ?



-- 
Thanks and Regards,
Pritam Kharat
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150707/d0e398bb/attachment-0001.html>

From zhaojun12 at outlook.com  Tue Jul  7 06:04:01 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Tue, 7 Jul 2015 21:04:01 +0800
Subject: [ovs-discuss] configure openvswitch in Amazon EC2
Message-ID: <BAY172-W55C4D0BD8EA0409658726B2920@phx.gbl>

hi, all
i have installed openvswitch-2.3.2 in Amazon EC2, and want to use openvswitch to build a gre tunnel with other PC.
this is the ifconfig output








[root at ip-172-31-30-157 openvswitch]# ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9001
        inet 172.31.30.157  netmask 255.255.240.0  broadcast 172.31.31.255
        inet6 fe80::47b:d1ff:fe65:5a6d  prefixlen 64  scopeid 0x20<link>
        ether 06:7b:d1:65:5a:6d  txqueuelen 1000  (Ethernet)
        RX packets 573591  bytes 200865634 (191.5 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 496014  bytes 101375588 (96.6 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0


lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 0  (Local Loopback)
        RX packets 3669  bytes 1032693 (1008.4 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3669  bytes 1032693 (1008.4 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
and route output
Kernel IP routing tableDestination     Gateway         Genmask         Flags Metric Ref    Use Ifacedefault         ip-172-31-16-1. 0.0.0.0         UG    100    0        0 eth0172.31.16.0     0.0.0.0         255.255.240.0   U     0      0        0 eth0











172.31.16.0     0.0.0.0         255.255.240.0   U     100    0        0 eth0

and i use the following commands
ovs-vsctl add-br OVS-SWITCH && ovs-vsctl add-port OVS-SWITCH eth0 && ifconfig eth0 0 && ifconfig OVS-SWITCH 172.31.30.157 netmask 255.255.240.0 && route add default gw 172.31.16.1 dev OVS-SWITCH
but after i execute these commands, i lose the connection with my ec2.
does anyone have deployed openvswitch in amazon ec2, and could you please give me some suggestions.
Many thanks!

Zhao Jun 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150707/9af4ab6a/attachment.html>

From zhaojun12 at outlook.com  Tue Jul  7 06:08:04 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Tue, 7 Jul 2015 21:08:04 +0800
Subject: [ovs-discuss] Subscribing to this mailing list
Message-ID: <BAY172-W37B9C77D9DE79AFDF0F447B2920@phx.gbl>

i want to Subscribe to this mailing list using the following link, http://mail.openvswitch.org/mailman/listinfo/discuss, but when i submit my email, i donot receive the confirm email.
thanks

Zhao Jun 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150707/0bef9142/attachment.html>

From jpettit at nicira.com  Tue Jul  7 10:16:56 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 7 Jul 2015 10:16:56 -0700
Subject: [ovs-discuss] Subscribing to this mailing list
In-Reply-To: <BAY172-W37B9C77D9DE79AFDF0F447B2920@phx.gbl>
References: <BAY172-W37B9C77D9DE79AFDF0F447B2920@phx.gbl>
Message-ID: <DE28A7E3-986E-4EDF-AF47-3856AE1996BA@nicira.com>

Check your spam folder.  If you still can't subscribe, email me off-list, and I'll manually subscribe you.

--Justin


> On Jul 7, 2015, at 6:08 AM, 俊 赵 <zhaojun12 at outlook.com> wrote:
> 
> i want to Subscribe to this mailing list using the following link, http://mail.openvswitch.org/mailman/listinfo/discuss, but when i submit my email, i donot receive the confirm email.
> 
> thanks
> 
> 
> Zhao Jun
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From abhishekv.verma at gmail.com  Tue Jul  7 20:11:11 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Wed, 8 Jul 2015 08:41:11 +0530
Subject: [ovs-discuss] Am i using the linux kernel or OVS for packet
	processing?
Message-ID: <CADDmorT4Nj3EJ-OChvHGnvCoeojZxCOSLJpM5uxPR4P-VjdBfQ@mail.gmail.com>

Hi,

I want to test OVS between two virtual machines hosted over the same host.
I created an OVS bridge where i added the NIC that connects the two VMs and
used ifconfig to assign an IP address to the bridge port.

With this i am able to ping the two VMs.

root at VirtualBox:/home/akabra# ovs-vsctl show
e71e7608-7bfe-4293-ac5a-8705355ba16e

    Bridge mybridge
        Port mybridge
            Interface mybridge
                type: internal
        Port "eth2"
            Interface "eth2"
root at VirtualBox:/home/akabra#

root at VirtualBox:/home/akabra# ifconfig
eth2      Link encap:Ethernet  HWaddr 08:00:27:7b:2d:b2
          inet6 addr: fe80::a00:27ff:fe7b:2db2/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1074400 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3290 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:1003962152 (1.0 GB)  TX bytes:363441 (363.4 KB)

mybridge  Link encap:Ethernet  HWaddr 08:00:27:7b:2d:b2
          inet addr:2.2.2.2  Bcast:2.2.2.255  Mask:255.255.255.0
          inet6 addr: fe80::c8f8:7cff:fe8a:5b4a/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:36387 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3160 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:8220698 (8.2 MB)  TX bytes:340708 (340.7 KB)

I did exactly the same on the other VM and am able to ping between the two
VMs.

I have two questions here:

(1) Am i completely bypassing the Linux kernel stack to get this ping
working?

(2) How do i verify that i am indeed using OVS for packet forwarding.

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/697857b1/attachment.html>

From jesse at nicira.com  Tue Jul  7 20:20:05 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 7 Jul 2015 20:20:05 -0700
Subject: [ovs-discuss] Am i using the linux kernel or OVS for packet
	processing?
In-Reply-To: <CADDmorT4Nj3EJ-OChvHGnvCoeojZxCOSLJpM5uxPR4P-VjdBfQ@mail.gmail.com>
References: <CADDmorT4Nj3EJ-OChvHGnvCoeojZxCOSLJpM5uxPR4P-VjdBfQ@mail.gmail.com>
Message-ID: <CAEP_g=8HWQFf++6LWV36_guqupN_nPR3zvtPQqdJ2QwWO9LbnQ@mail.gmail.com>

On Tue, Jul 7, 2015 at 8:11 PM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Hi,
>
> I want to test OVS between two virtual machines hosted over the same host. I
> created an OVS bridge where i added the NIC that connects the two VMs and
> used ifconfig to assign an IP address to the bridge port.
>
> With this i am able to ping the two VMs.
>
> root at VirtualBox:/home/akabra# ovs-vsctl show
> e71e7608-7bfe-4293-ac5a-8705355ba16e
>
>     Bridge mybridge
>         Port mybridge
>             Interface mybridge
>                 type: internal
>         Port "eth2"
>             Interface "eth2"
> root at VirtualBox:/home/akabra#
>
> root at VirtualBox:/home/akabra# ifconfig
> eth2      Link encap:Ethernet  HWaddr 08:00:27:7b:2d:b2
>           inet6 addr: fe80::a00:27ff:fe7b:2db2/64 Scope:Link
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:1074400 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:3290 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:1000
>           RX bytes:1003962152 (1.0 GB)  TX bytes:363441 (363.4 KB)
>
> mybridge  Link encap:Ethernet  HWaddr 08:00:27:7b:2d:b2
>           inet addr:2.2.2.2  Bcast:2.2.2.255  Mask:255.255.255.0
>           inet6 addr: fe80::c8f8:7cff:fe8a:5b4a/64 Scope:Link
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:36387 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:3160 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:8220698 (8.2 MB)  TX bytes:340708 (340.7 KB)
>
> I did exactly the same on the other VM and am able to ping between the two
> VMs.

You need to add the VM ports to OVS. Currently only traffic between
eth2 and the hypervisor host is going through OVS.

From pritam.kharat at oneconvergence.com  Tue Jul  7 21:08:06 2015
From: pritam.kharat at oneconvergence.com (Pritam Kharat)
Date: Wed, 8 Jul 2015 09:38:06 +0530
Subject: [ovs-discuss] Problem in using packet values against register
	values in ovs-flow
Message-ID: <CAKXxEYx=NXka4DpY08PGOVMo3e9FbSA3AYWhQkiaSTdS+mo5hQ@mail.gmail.com>

Hi All,

1) In a ovs flow how do I load a nw_src with mask value  from a packet to
register say reg0 ? Doc says we can load only integer or hex value to a
register ? Is there any way to do it ?

e.g
*table=0,<flow-match>,actions=load:(nw_src/mask)->NXM_NX_REG0[],load:(nw_dst/mask)->NXM_NX_REG1[],resubmit(,1)*

2) Can we create ovs flow which compares values in two registers. ?
 e.g * match -> table=1,reg0==reg1*
*       actions -> drop*

What I am trying to do is, see if packet is destined to vm of same subnet.
If yes then drop the packet.This I want to do using registers so that way I
will have only one flow ?


3) Can I compare value from packet with value in register ?

e.g *table=1,nw_src=reg0,actions=drop*

How do we do it through ovs-ofctl command if possible and  if not, then
what can be other way ?

-- 
Thanks and Regards,
Pritam Kharat.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/c3d91b5a/attachment.html>

From abhishekv.verma at gmail.com  Tue Jul  7 21:17:38 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Wed, 8 Jul 2015 09:47:38 +0530
Subject: [ovs-discuss] Am i using the linux kernel or OVS for packet
	processing?
In-Reply-To: <CAEP_g=8HWQFf++6LWV36_guqupN_nPR3zvtPQqdJ2QwWO9LbnQ@mail.gmail.com>
References: <CADDmorT4Nj3EJ-OChvHGnvCoeojZxCOSLJpM5uxPR4P-VjdBfQ@mail.gmail.com>
 <CAEP_g=8HWQFf++6LWV36_guqupN_nPR3zvtPQqdJ2QwWO9LbnQ@mail.gmail.com>
Message-ID: <CADDmorTYLmO4Oiw=rwUuXJkachwncFtdjPzC7iXh6+Ros4kSVQ@mail.gmail.com>

Hi,

I dont understand.

eth2 is my VM port. And i have added that to the OVS bridge "mybridge"

Am i missing something?

Thanks, Abhishek

On Wed, Jul 8, 2015 at 8:50 AM, Jesse Gross <jesse at nicira.com> wrote:

> On Tue, Jul 7, 2015 at 8:11 PM, Abhishek Verma
> <abhishekv.verma at gmail.com> wrote:
> > Hi,
> >
> > I want to test OVS between two virtual machines hosted over the same
> host. I
> > created an OVS bridge where i added the NIC that connects the two VMs and
> > used ifconfig to assign an IP address to the bridge port.
> >
> > With this i am able to ping the two VMs.
> >
> > root at VirtualBox:/home/akabra# ovs-vsctl show
> > e71e7608-7bfe-4293-ac5a-8705355ba16e
> >
> >     Bridge mybridge
> >         Port mybridge
> >             Interface mybridge
> >                 type: internal
> >         Port "eth2"
> >             Interface "eth2"
> > root at VirtualBox:/home/akabra#
> >
> > root at VirtualBox:/home/akabra# ifconfig
> > eth2      Link encap:Ethernet  HWaddr 08:00:27:7b:2d:b2
> >           inet6 addr: fe80::a00:27ff:fe7b:2db2/64 Scope:Link
> >           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
> >           RX packets:1074400 errors:0 dropped:0 overruns:0 frame:0
> >           TX packets:3290 errors:0 dropped:0 overruns:0 carrier:0
> >           collisions:0 txqueuelen:1000
> >           RX bytes:1003962152 (1.0 GB)  TX bytes:363441 (363.4 KB)
> >
> > mybridge  Link encap:Ethernet  HWaddr 08:00:27:7b:2d:b2
> >           inet addr:2.2.2.2  Bcast:2.2.2.255  Mask:255.255.255.0
> >           inet6 addr: fe80::c8f8:7cff:fe8a:5b4a/64 Scope:Link
> >           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
> >           RX packets:36387 errors:0 dropped:0 overruns:0 frame:0
> >           TX packets:3160 errors:0 dropped:0 overruns:0 carrier:0
> >           collisions:0 txqueuelen:0
> >           RX bytes:8220698 (8.2 MB)  TX bytes:340708 (340.7 KB)
> >
> > I did exactly the same on the other VM and am able to ping between the
> two
> > VMs.
>
> You need to add the VM ports to OVS. Currently only traffic between
> eth2 and the hypervisor host is going through OVS.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/c876fe1e/attachment-0001.html>

From jesse at nicira.com  Tue Jul  7 21:46:03 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 7 Jul 2015 21:46:03 -0700
Subject: [ovs-discuss] Am i using the linux kernel or OVS for packet
	processing?
In-Reply-To: <CADDmorTYLmO4Oiw=rwUuXJkachwncFtdjPzC7iXh6+Ros4kSVQ@mail.gmail.com>
References: <CADDmorT4Nj3EJ-OChvHGnvCoeojZxCOSLJpM5uxPR4P-VjdBfQ@mail.gmail.com>
 <CAEP_g=8HWQFf++6LWV36_guqupN_nPR3zvtPQqdJ2QwWO9LbnQ@mail.gmail.com>
 <CADDmorTYLmO4Oiw=rwUuXJkachwncFtdjPzC7iXh6+Ros4kSVQ@mail.gmail.com>
Message-ID: <CAEP_g=-j=8=TuyrbAtjcsXwCkCBHg8HpePZwp4mfBDkvdwHY7A@mail.gmail.com>

eth2 is not the interface to a VM - it is the uplink to the physical
network. A VM interface is actually connected to a particular virtual
machine.

There are several tutorials about setting up OVS available online. I
would recommend that you follow one and then try to make modifications
from there.

On Tue, Jul 7, 2015 at 9:17 PM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Hi,
>
> I dont understand.
>
> eth2 is my VM port. And i have added that to the OVS bridge "mybridge"
>
> Am i missing something?
>
> Thanks, Abhishek
>
> On Wed, Jul 8, 2015 at 8:50 AM, Jesse Gross <jesse at nicira.com> wrote:
>>
>> On Tue, Jul 7, 2015 at 8:11 PM, Abhishek Verma
>> <abhishekv.verma at gmail.com> wrote:
>> > Hi,
>> >
>> > I want to test OVS between two virtual machines hosted over the same
>> > host. I
>> > created an OVS bridge where i added the NIC that connects the two VMs
>> > and
>> > used ifconfig to assign an IP address to the bridge port.
>> >
>> > With this i am able to ping the two VMs.
>> >
>> > root at VirtualBox:/home/akabra# ovs-vsctl show
>> > e71e7608-7bfe-4293-ac5a-8705355ba16e
>> >
>> >     Bridge mybridge
>> >         Port mybridge
>> >             Interface mybridge
>> >                 type: internal
>> >         Port "eth2"
>> >             Interface "eth2"
>> > root at VirtualBox:/home/akabra#
>> >
>> > root at VirtualBox:/home/akabra# ifconfig
>> > eth2      Link encap:Ethernet  HWaddr 08:00:27:7b:2d:b2
>> >           inet6 addr: fe80::a00:27ff:fe7b:2db2/64 Scope:Link
>> >           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>> >           RX packets:1074400 errors:0 dropped:0 overruns:0 frame:0
>> >           TX packets:3290 errors:0 dropped:0 overruns:0 carrier:0
>> >           collisions:0 txqueuelen:1000
>> >           RX bytes:1003962152 (1.0 GB)  TX bytes:363441 (363.4 KB)
>> >
>> > mybridge  Link encap:Ethernet  HWaddr 08:00:27:7b:2d:b2
>> >           inet addr:2.2.2.2  Bcast:2.2.2.255  Mask:255.255.255.0
>> >           inet6 addr: fe80::c8f8:7cff:fe8a:5b4a/64 Scope:Link
>> >           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>> >           RX packets:36387 errors:0 dropped:0 overruns:0 frame:0
>> >           TX packets:3160 errors:0 dropped:0 overruns:0 carrier:0
>> >           collisions:0 txqueuelen:0
>> >           RX bytes:8220698 (8.2 MB)  TX bytes:340708 (340.7 KB)
>> >
>> > I did exactly the same on the other VM and am able to ping between the
>> > two
>> > VMs.
>>
>> You need to add the VM ports to OVS. Currently only traffic between
>> eth2 and the hypervisor host is going through OVS.
>
>

From weihj1999 at gmail.com  Wed Jul  8 00:26:47 2015
From: weihj1999 at gmail.com (Hongjin Wei)
Date: Wed, 8 Jul 2015 15:26:47 +0800
Subject: [ovs-discuss] ovs-vswitchd:
 ovs|15644|odp_util(revalidator_1168)|ERR|mask expected for non-Ethernet II
Message-ID: <CAPCEwzB3AqEgem5qgM7ro3kdubC9FZP8z72zL6jrFcjT5RxQpg@mail.gmail.com>

All,

In my openstack environment, I used ovs for the network plugin. Everything
works fine. but I nonitce there are lots of record update in
/var/log/message like this:
YB-CH242-02  Jun  9 20:17:51 YB-CH242-02 ovs-vswitchd:
ovs|15643|odp_util(revalidator_1168)|ERR|Dropped 17 log messages in last 60
seconds (most recently, 10 secone
Jun  9 20:17:51 YB-CH242-02 ovs-vswitchd:
ovs|15644|odp_util(revalidator_1168)|ERR|mask expected for non-Ethernet II

anyone can tell me how this message means? And what this will impact?


thanks all
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/cf995144/attachment.html>

From contact at progbau.de  Wed Jul  8 01:41:55 2015
From: contact at progbau.de (Chris)
Date: Wed, 8 Jul 2015 15:41:55 +0700
Subject: [ovs-discuss] ovs kernel module 2.3.2 build failed
In-Reply-To: <CAEP_g=_=u8So3dG1wTsF5=djq+AYJVrtTJw7OOE2R=q0afJkYg@mail.gmail.com>
References: <004b01d0b88e$3ae04ef0$b0a0ecd0$@progbau.de>
 <CAEP_g=_=u8So3dG1wTsF5=djq+AYJVrtTJw7OOE2R=q0afJkYg@mail.gmail.com>
Message-ID: <007901d0b959$f3d254a0$db76fde0$@progbau.de>

Hello Jesse,

What is the patch commit id?

Cheers
Chris

-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com] 
Sent: Tuesday, July 07, 2015 23:24
To: Chris
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] ovs kernel module 2.3.2 build failed

On Tue, Jul 7, 2015 at 1:23 AM, Chris <contact at progbau.de> wrote:
> Hello,
>
>
>
> I tried to build the kernel module rpm for the openvswitch version 
> 2.3.2 with the Centos 6.6 kernel  2.6.32-504.23.4.el6.centos.plus.x86_64.
>
>
>
> Please see the output below, I skipped a little bit and copied the 
> piece when its starts to throw errors:

Can you try cherry picking commit
3d174bfd1a6dc0734f4333385fbcb0dd4dd12df4 ("datapath: compat: Fix build on RHEL 6.6") and the patch I just sent out?



From yass524 at yahoo.com.au  Wed Jul  8 05:32:07 2015
From: yass524 at yahoo.com.au (yas nak)
Date: Wed, 8 Jul 2015 12:32:07 +0000 (UTC)
Subject: [ovs-discuss] Learning OVS - Bonding / LACP on Ubuntu
Message-ID: <2041119313.550292.1436358727762.JavaMail.yahoo@mail.yahoo.com>

Hi Forum
I am really new to OVS and trying to understand.  I am trying to get LACP bonding to work on Ubuntu 14.04 and cisco switch.
I have configured the cisco 2960CG switch with the following configinterface Port-channel1 switchport mode trunk!interface GigabitEthernet0/1 switchport mode trunk channel-protocol lacp channel-group 1 mode active!interface GigabitEthernet0/2 switchport mode trunk channel-protocol lacp channel-group 1 mode active
 On my Ubuntu x64 14.04.02 server I have installed openvswitch-switch.  I have configured /etc/network/interfaces as

auto loiface lo inet loopback
auto p2p1iface p2p1 inet manual
auto p3p1iface p3p1 inet manual## OVS Bridge#auto vmbr0iface vmbr0 inet manual  ovs_type OVSBridge  ovs_ports bond0 vlan1
allow-vmbr0 bond0iface bond0 inet manual  ovs_bridge vmbr0  ovs_type OVSBond  ovs_bonds p2p1 p3p1  ovs_options bond_mode=balance-tcp lacp=active other_config:lacp-time=fast other_config:trunks=1 allow-vmbr0 vlan1iface vlan1 inet dhcp  ovs_type OVSIntPort  ovs_bridge vmbr0  ovs_options tag=1 
I can see using tcpdump -i p2p1 that the DHCP request is being responded on my PC but VLAN1 never gets an IP assigned to the interface VLAN1
Could someone point me towards what I have configured incorrectly?
Thanks
Yas
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/a01ab587/attachment.html>

From yszhou4tech at gmail.com  Wed Jul  8 06:39:55 2015
From: yszhou4tech at gmail.com (Yousong Zhou)
Date: Wed, 8 Jul 2015 21:39:55 +0800
Subject: [ovs-discuss] =?utf-8?q?On_TCP=5FCRR_test_setup_in_=22Acceleratin?=
	=?utf-8?q?g_Open_vSwitch_to_=E2=80=9CLudicrous_Speed=E2=80=9D=22?=
Message-ID: <CAECwjAi6U4UfYn9itPbciYgUYuwwwXRJCyU=yaaXpVEDbwsrCw@mail.gmail.com>

Hello, list

I am doing some performance tests for the preparation of upgrading
Open vSwitch from 1.11.0 to 2.3.2.  However, with TCP_CRR, I can only
achieve about 130k tps (last time I got only 40k because of a .debug
type kernel), not even close to the reported 680k from the blog post
[0].  I also found other available reports [1, 2] but those results
were even worse and not consistent with each other.

I guess difference in the test environment/method should be the main
cause and would like to know more about other possible optimizations
to make 680k tps possible.

I cleaned up my test scripts a bit and posted them on github [3].
Here I am going to summarize test methods used in my tests in case
that you can shed some light on me and give your test setup for
reference?  There are so many details.  Sorry that it's going to be a
little verbose :)

I have 2 physical hosts with the following configuration

 - 2 Intel Xeon E5-2650 v2 @ 2.60Ghz on 2 sockets
 - 256 (16 * 16) GB memory
 - Intel Corporation Ethernet Controller 10-Gigabit X540-AT2 (rev 03)
 - CentOS 6.6 with 2.6.32-431.20.3.el6.xxxx.x86_64
 - Open vSwitch 2.3.2
 - Netperf 2.6.0

On both hosts,

 - HyperThreading was disabled by kernel parameter maxcpus=16
 - Interrupts of 16 queues of the NIC were distributed to all online
cores with set_irq_affinity.sh
 - rx, tx sg and other offload features were all off
 - rx-flow-hash of tcp4 was set to sdfn
 - tcp_tw_recycle and tcp_tw_reuse were enabled
 - connection tracking is disabled with iptables on all flows involved
in the tests

Then on Host A

 - OVS bridge ovsbr was created
 - 127 OVS internal ports were created, placed into 32 different net namespaces
 - Those 127 internal ports were also placed as members of the bridge ovsbr
 - No special flow rule was added to the bridge.  It's just a plain
bridge the default settings

Then

 - addresses and routes were configured
 - 1, 16, 32, 127 netserver instances were started on Host B listening
on different port
 - 1, 16, 32, 127 netperf instances were started within net namespaces
created earlier and each connected to a netserver instance
 - Each netserver and netperf instance were bound to a core with taskset

Then test results from netperf instances were collected and summed
together and they never came close to 680k tps

Tests were conducted on Linux bridge with veth, Open vSwitch 1.11.0
and 2.3.2 with internal ports.  Their upper limits attained in my
TCP_CRR tests were as the following (details can be found in link [4])

    Linux bridge                  110k
    Open vSwitch 1.11.0            19k
    Open vSwitch 2.3.2            130k

Regards

 [0] Accelerating Open vSwitch to “Ludicrous Speed”,
http://networkheresy.com/2014/11/13/accelerating-open-vswitch-to-ludicrous-speed/
 [1] Reports for netperf's TCP_CRR test (i.e TCP accept()
performance), https://gist.github.com/cgbystrom/985475
 [2] `[ovs-dev] [TCP_CRR 0/6] improve TCP_CRR performance by 87%`, for
Open vSwitch 1.3,
http://openvswitch.org/pipermail/dev/2011-November/013183.html
 [3] brtest, Scripts mainly for testing bridge implementations (Linux
bridge and Open vSwitch), https://github.com/yousong/brtest
 [4] https://github.com/yousong/brtest/blob/master/out/yousong-X540-AT2.md


                yousong

From blp at nicira.com  Wed Jul  8 08:05:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 8 Jul 2015 08:05:55 -0700
Subject: [ovs-discuss] Problem in using packet values against register
 values in ovs-flow
In-Reply-To: <CAKXxEYx=NXka4DpY08PGOVMo3e9FbSA3AYWhQkiaSTdS+mo5hQ@mail.gmail.com>
References: <CAKXxEYx=NXka4DpY08PGOVMo3e9FbSA3AYWhQkiaSTdS+mo5hQ@mail.gmail.com>
Message-ID: <20150708150555.GA5246@nicira.com>

On Wed, Jul 08, 2015 at 09:38:06AM +0530, Pritam Kharat wrote:
> 1) In a ovs flow how do I load a nw_src with mask value  from a packet to
> register say reg0 ? Doc says we can load only integer or hex value to a
> register ? Is there any way to do it ?
> 
> e.g
> *table=0,<flow-match>,actions=load:(nw_src/mask)->NXM_NX_REG0[],load:(nw_dst/mask)->NXM_NX_REG1[],resubmit(,1)*

I guess you want the "move" action.

> 2) Can we create ovs flow which compares values in two registers. ?
>  e.g * match -> table=1,reg0==reg1*
> *       actions -> drop*
> 
> What I am trying to do is, see if packet is destined to vm of same subnet.
> If yes then drop the packet.This I want to do using registers so that way I
> will have only one flow ?

OVS doesn't have a general-purpose comparison operator or an easy way to
construct one.

> 3) Can I compare value from packet with value in register ?
> 
> e.g *table=1,nw_src=reg0,actions=drop*

Same as #2.

From pritam.kharat at oneconvergence.com  Wed Jul  8 09:02:25 2015
From: pritam.kharat at oneconvergence.com (Pritam Kharat)
Date: Wed, 8 Jul 2015 21:32:25 +0530
Subject: [ovs-discuss] Problem in using packet values against register
 values in ovs-flow
In-Reply-To: <20150708150555.GA5246@nicira.com>
References: <CAKXxEYx=NXka4DpY08PGOVMo3e9FbSA3AYWhQkiaSTdS+mo5hQ@mail.gmail.com>
 <20150708150555.GA5246@nicira.com>
Message-ID: <CAKXxEYxdQ8jkgOJiWG0s+y+n3rL5bR_Y5sOF7kXo=78mWqMgnA@mail.gmail.com>

Tried with move but gives error

root at pritam:/home/pritam/git# ovs-ofctl add-flow br-int
'table=0,in_port=5,actions=move:NXM_OF_IP_SRC[]->NXM_NX_REG0[]'
2015-07-08T16:01:45Z|00001|meta_flow|WARN|source field ip_src lacks correct
prerequisites
ovs-ofctl: actions are invalid with specified match
(OFPBAC_MATCH_INCONSISTENT)




On Wed, Jul 8, 2015 at 8:35 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Jul 08, 2015 at 09:38:06AM +0530, Pritam Kharat wrote:
> > 1) In a ovs flow how do I load a nw_src with mask value  from a packet to
> > register say reg0 ? Doc says we can load only integer or hex value to a
> > register ? Is there any way to do it ?
> >
> > e.g
> >
> *table=0,<flow-match>,actions=load:(nw_src/mask)->NXM_NX_REG0[],load:(nw_dst/mask)->NXM_NX_REG1[],resubmit(,1)*
>
> I guess you want the "move" action.
>
> > 2) Can we create ovs flow which compares values in two registers. ?
> >  e.g * match -> table=1,reg0==reg1*
> > *       actions -> drop*
> >
> > What I am trying to do is, see if packet is destined to vm of same
> subnet.
> > If yes then drop the packet.This I want to do using registers so that
> way I
> > will have only one flow ?
>
> OVS doesn't have a general-purpose comparison operator or an easy way to
> construct one.
>
> > 3) Can I compare value from packet with value in register ?
> >
> > e.g *table=1,nw_src=reg0,actions=drop*
>
> Same as #2.
>



-- 
Thanks and Regards,
Pritam Kharat.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/f65ff6a1/attachment.html>

From jesse at nicira.com  Wed Jul  8 09:05:08 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 8 Jul 2015 09:05:08 -0700
Subject: [ovs-discuss] ovs kernel module 2.3.2 build failed
In-Reply-To: <007901d0b959$f3d254a0$db76fde0$@progbau.de>
References: <004b01d0b88e$3ae04ef0$b0a0ecd0$@progbau.de>
 <CAEP_g=_=u8So3dG1wTsF5=djq+AYJVrtTJw7OOE2R=q0afJkYg@mail.gmail.com>
 <007901d0b959$f3d254a0$db76fde0$@progbau.de>
Message-ID: <CAEP_g=-sJNDOMS1yCqFZQM03LAcFC5WhMKab+M+f2CN8JUP4aQ@mail.gmail.com>

The second patch isn't committed yet so it doesn't have an ID. It was
sent out for review by email and CC'ed to you - you'll need to use
"git am" to apply it.

On Wed, Jul 8, 2015 at 1:41 AM, Chris <contact at progbau.de> wrote:
> Hello Jesse,
>
> What is the patch commit id?
>
> Cheers
> Chris
>
> -----Original Message-----
> From: Jesse Gross [mailto:jesse at nicira.com]
> Sent: Tuesday, July 07, 2015 23:24
> To: Chris
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] ovs kernel module 2.3.2 build failed
>
> On Tue, Jul 7, 2015 at 1:23 AM, Chris <contact at progbau.de> wrote:
>> Hello,
>>
>>
>>
>> I tried to build the kernel module rpm for the openvswitch version
>> 2.3.2 with the Centos 6.6 kernel  2.6.32-504.23.4.el6.centos.plus.x86_64.
>>
>>
>>
>> Please see the output below, I skipped a little bit and copied the
>> piece when its starts to throw errors:
>
> Can you try cherry picking commit
> 3d174bfd1a6dc0734f4333385fbcb0dd4dd12df4 ("datapath: compat: Fix build on RHEL 6.6") and the patch I just sent out?
>
>

From scott.lowe at scottlowe.org  Wed Jul  8 09:10:50 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Wed, 8 Jul 2015 09:10:50 -0700
Subject: [ovs-discuss] Learning OVS - Bonding / LACP on Ubuntu
In-Reply-To: <2041119313.550292.1436358727762.JavaMail.yahoo@mail.yahoo.com>
References: <2041119313.550292.1436358727762.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <A47B456C-2A42-440A-97CE-65F58BD89F4D@scottlowe.org>

My guess is that the Cisco switch is expecting traffic on VLAN 1 to be untagged since it is the native VLAN. Try setting a different native VLAN on the interfaces on the Cisco switch to see if that helps.

-- 
Scott

Sent from my mobile device

> On Jul 8, 2015, at 5:32 AM, yas nak <yass524 at yahoo.com.au> wrote:
> 
> Hi Forum
> 
> I am really new to OVS and trying to understand.  I am trying to get LACP bonding to work on Ubuntu 14.04 and cisco switch.
> 
> I have configured the cisco 2960CG switch with the following config
> interface Port-channel1
>  switchport mode trunk
> !
> interface GigabitEthernet0/1
>  switchport mode trunk
>  channel-protocol lacp
>  channel-group 1 mode active
> !
> interface GigabitEthernet0/2
>  switchport mode trunk
>  channel-protocol lacp
>  channel-group 1 mode active
> 
>  On my Ubuntu x64 14.04.02 server I have installed openvswitch-switch.  I have configured /etc/network/interfaces as
> 
> 
> auto lo
> iface lo inet loopback
> 
> auto p2p1
> iface p2p1 inet manual
> 
> auto p3p1
> iface p3p1 inet manual
> #
> # OVS Bridge
> #
> auto vmbr0
> iface vmbr0 inet manual
>   ovs_type OVSBridge
>   ovs_ports bond0 vlan1
> 
> allow-vmbr0 bond0
> iface bond0 inet manual
>   ovs_bridge vmbr0
>   ovs_type OVSBond
>   ovs_bonds p2p1 p3p1
>   ovs_options bond_mode=balance-tcp lacp=active other_config:lacp-time=fast other_config:trunks=1
>  
> allow-vmbr0 vlan1
> iface vlan1 inet dhcp
>   ovs_type OVSIntPort
>   ovs_bridge vmbr0
>   ovs_options tag=1 
> 
> I can see using tcpdump -i p2p1 that the DHCP request is being responded on my PC but VLAN1 never gets an IP assigned to the interface VLAN1
> 
> Could someone point me towards what I have configured incorrectly?
> 
> Thanks
> 
> Yas
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/4b8878c8/attachment-0001.html>

From haleema.s.mahmood at gmail.com  Wed Jul  8 01:36:43 2015
From: haleema.s.mahmood at gmail.com (Haleema Sadia)
Date: Wed, 8 Jul 2015 13:36:43 +0500
Subject: [ovs-discuss] IP_DSCP field
Message-ID: <CAN-u-63v9Ez7_KUCzmxJTDzhUjB0X9oDrSCjZZUdLCcQgcqzkA@mail.gmail.com>

Hi,

I am trying to make a flow entry in which I am trying to set the ip_dscp
field for the packet. But the entry that I receive from the ovs-ofctl
dump-flows command shows that nw_tos field is being set. Can anyone explain
why this is happening?

The OpenFlow version 1.3
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/2594651b/attachment.html>

From blp at nicira.com  Wed Jul  8 10:15:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 8 Jul 2015 10:15:59 -0700
Subject: [ovs-discuss] Problem in using packet values against register
 values in ovs-flow
In-Reply-To: <CAKXxEYxdQ8jkgOJiWG0s+y+n3rL5bR_Y5sOF7kXo=78mWqMgnA@mail.gmail.com>
References: <CAKXxEYx=NXka4DpY08PGOVMo3e9FbSA3AYWhQkiaSTdS+mo5hQ@mail.gmail.com>
 <20150708150555.GA5246@nicira.com>
 <CAKXxEYxdQ8jkgOJiWG0s+y+n3rL5bR_Y5sOF7kXo=78mWqMgnA@mail.gmail.com>
Message-ID: <20150708171559.GA31439@nicira.com>

Yes, you need to match on IP to use an IP field, e.g.:
        ovs-ofctl add-flow br-int 'table=0,ip,in_port=5,actions=move:NXM_OF_IP_SRC[]->NXM_NX_REG0[]'


On Wed, Jul 08, 2015 at 09:32:25PM +0530, Pritam Kharat wrote:
> Tried with move but gives error
> 
> root at pritam:/home/pritam/git# ovs-ofctl add-flow br-int
> 'table=0,in_port=5,actions=move:NXM_OF_IP_SRC[]->NXM_NX_REG0[]'
> 2015-07-08T16:01:45Z|00001|meta_flow|WARN|source field ip_src lacks correct
> prerequisites
> ovs-ofctl: actions are invalid with specified match
> (OFPBAC_MATCH_INCONSISTENT)
> 
> 
> 
> 
> On Wed, Jul 8, 2015 at 8:35 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Jul 08, 2015 at 09:38:06AM +0530, Pritam Kharat wrote:
> > > 1) In a ovs flow how do I load a nw_src with mask value  from a packet to
> > > register say reg0 ? Doc says we can load only integer or hex value to a
> > > register ? Is there any way to do it ?
> > >
> > > e.g
> > >
> > *table=0,<flow-match>,actions=load:(nw_src/mask)->NXM_NX_REG0[],load:(nw_dst/mask)->NXM_NX_REG1[],resubmit(,1)*
> >
> > I guess you want the "move" action.
> >
> > > 2) Can we create ovs flow which compares values in two registers. ?
> > >  e.g * match -> table=1,reg0==reg1*
> > > *       actions -> drop*
> > >
> > > What I am trying to do is, see if packet is destined to vm of same
> > subnet.
> > > If yes then drop the packet.This I want to do using registers so that
> > way I
> > > will have only one flow ?
> >
> > OVS doesn't have a general-purpose comparison operator or an easy way to
> > construct one.
> >
> > > 3) Can I compare value from packet with value in register ?
> > >
> > > e.g *table=1,nw_src=reg0,actions=drop*
> >
> > Same as #2.
> >
> 
> 
> 
> -- 
> Thanks and Regards,
> Pritam Kharat.

From pritam.kharat at oneconvergence.com  Wed Jul  8 10:20:05 2015
From: pritam.kharat at oneconvergence.com (Pritam Kharat)
Date: Wed, 8 Jul 2015 22:50:05 +0530
Subject: [ovs-discuss] Problem in using packet values against register
 values in ovs-flow
In-Reply-To: <20150708171559.GA31439@nicira.com>
References: <CAKXxEYx=NXka4DpY08PGOVMo3e9FbSA3AYWhQkiaSTdS+mo5hQ@mail.gmail.com>
 <20150708150555.GA5246@nicira.com>
 <CAKXxEYxdQ8jkgOJiWG0s+y+n3rL5bR_Y5sOF7kXo=78mWqMgnA@mail.gmail.com>
 <20150708171559.GA31439@nicira.com>
Message-ID: <CAKXxEYz=VnanXghJ7OtX3CgUDbWimCuYw_WJwD3ec0zJkPZo2Q@mail.gmail.com>

NXM_OF_IP_SRC[] will it cover cidr with mask also. e.g 10.0.0.0/8

On Wed, Jul 8, 2015 at 10:45 PM, Ben Pfaff <blp at nicira.com> wrote:

> Yes, you need to match on IP to use an IP field, e.g.:
>         ovs-ofctl add-flow br-int
> 'table=0,ip,in_port=5,actions=move:NXM_OF_IP_SRC[]->NXM_NX_REG0[]'
>
>
> On Wed, Jul 08, 2015 at 09:32:25PM +0530, Pritam Kharat wrote:
> > Tried with move but gives error
> >
> > root at pritam:/home/pritam/git# ovs-ofctl add-flow br-int
> > 'table=0,in_port=5,actions=move:NXM_OF_IP_SRC[]->NXM_NX_REG0[]'
> > 2015-07-08T16:01:45Z|00001|meta_flow|WARN|source field ip_src lacks
> correct
> > prerequisites
> > ovs-ofctl: actions are invalid with specified match
> > (OFPBAC_MATCH_INCONSISTENT)
> >
> >
> >
> >
> > On Wed, Jul 8, 2015 at 8:35 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Wed, Jul 08, 2015 at 09:38:06AM +0530, Pritam Kharat wrote:
> > > > 1) In a ovs flow how do I load a nw_src with mask value  from a
> packet to
> > > > register say reg0 ? Doc says we can load only integer or hex value
> to a
> > > > register ? Is there any way to do it ?
> > > >
> > > > e.g
> > > >
> > >
> *table=0,<flow-match>,actions=load:(nw_src/mask)->NXM_NX_REG0[],load:(nw_dst/mask)->NXM_NX_REG1[],resubmit(,1)*
> > >
> > > I guess you want the "move" action.
> > >
> > > > 2) Can we create ovs flow which compares values in two registers. ?
> > > >  e.g * match -> table=1,reg0==reg1*
> > > > *       actions -> drop*
> > > >
> > > > What I am trying to do is, see if packet is destined to vm of same
> > > subnet.
> > > > If yes then drop the packet.This I want to do using registers so that
> > > way I
> > > > will have only one flow ?
> > >
> > > OVS doesn't have a general-purpose comparison operator or an easy way
> to
> > > construct one.
> > >
> > > > 3) Can I compare value from packet with value in register ?
> > > >
> > > > e.g *table=1,nw_src=reg0,actions=drop*
> > >
> > > Same as #2.
> > >
> >
> >
> >
> > --
> > Thanks and Regards,
> > Pritam Kharat.
>



-- 
Thanks and Regards,
Pritam Kharat.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/2d759892/attachment.html>

From joestringer at nicira.com  Wed Jul  8 10:38:26 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Wed, 8 Jul 2015 10:38:26 -0700
Subject: [ovs-discuss] ovs-vswitchd:
 ovs|15644|odp_util(revalidator_1168)|ERR|mask expected for non-Ethernet II
In-Reply-To: <CAPCEwzB3AqEgem5qgM7ro3kdubC9FZP8z72zL6jrFcjT5RxQpg@mail.gmail.com>
References: <CAPCEwzB3AqEgem5qgM7ro3kdubC9FZP8z72zL6jrFcjT5RxQpg@mail.gmail.com>
Message-ID: <CANr6G5wzLZ1_rZBfeRuPoqiouKSodeWpgZuz1nfmSVHyxDHM5A@mail.gmail.com>

On 8 July 2015 at 00:26, Hongjin Wei <weihj1999 at gmail.com> wrote:
>
>
> All,
>
> In my openstack environment, I used ovs for the network plugin. Everything
> works fine. but I nonitce there are lots of record update in
> /var/log/message like this:
> YB-CH242-02  Jun  9 20:17:51 YB-CH242-02 ovs-vswitchd:
> ovs|15643|odp_util(revalidator_1168)|ERR|Dropped 17 log messages in last 60
> seconds (most recently, 10 secone
> Jun  9 20:17:51 YB-CH242-02 ovs-vswitchd:
> ovs|15644|odp_util(revalidator_1168)|ERR|mask expected for non-Ethernet II

This message looks truncated, is there any more?

> anyone can tell me how this message means? And what this will impact?

There's a few different possible reasons for this, without
investigating further it's hard to say.

Can you specify which version of ovs-vswitchd is being used, and which
openvswitch kernel module?

From blp at nicira.com  Wed Jul  8 11:34:01 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 8 Jul 2015 11:34:01 -0700
Subject: [ovs-discuss] IP_DSCP field
In-Reply-To: <CAN-u-63v9Ez7_KUCzmxJTDzhUjB0X9oDrSCjZZUdLCcQgcqzkA@mail.gmail.com>
References: <CAN-u-63v9Ez7_KUCzmxJTDzhUjB0X9oDrSCjZZUdLCcQgcqzkA@mail.gmail.com>
Message-ID: <20150708183401.GA32472@nicira.com>

On Wed, Jul 08, 2015 at 01:36:43PM +0500, Haleema Sadia wrote:
> I am trying to make a flow entry in which I am trying to set the ip_dscp
> field for the packet. But the entry that I receive from the ovs-ofctl
> dump-flows command shows that nw_tos field is being set. Can anyone explain
> why this is happening?

They're the same field.

From azhou at nicira.com  Wed Jul  8 15:04:34 2015
From: azhou at nicira.com (Andy Zhou)
Date: Wed, 8 Jul 2015 15:04:34 -0700
Subject: [ovs-discuss] Learning OVS - Bonding / LACP on Ubuntu
In-Reply-To: <2041119313.550292.1436358727762.JavaMail.yahoo@mail.yahoo.com>
References: <2041119313.550292.1436358727762.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CACzMAJ+rSMs7sFcSMz_omP1tdtFfAqjQE4YwbzQZ9Sc81OsypQ@mail.gmail.com>

Answers to the following questions may help narrow the issue down further.

What's the output of 'ovs-appctl bond/show" and 'ovs-appctl lacp/show' ?
Does it work without bond port configuration?
Does it work with a different bond mode configuration, such as active-backup?


On Wed, Jul 8, 2015 at 5:32 AM, yas nak <yass524 at yahoo.com.au> wrote:
> Hi Forum
>
> I am really new to OVS and trying to understand.  I am trying to get LACP
> bonding to work on Ubuntu 14.04 and cisco switch.
>
> I have configured the cisco 2960CG switch with the following config
> interface Port-channel1
>  switchport mode trunk
> !
> interface GigabitEthernet0/1
>  switchport mode trunk
>  channel-protocol lacp
>  channel-group 1 mode active
> !
> interface GigabitEthernet0/2
>  switchport mode trunk
>  channel-protocol lacp
>  channel-group 1 mode active
>
>  On my Ubuntu x64 14.04.02 server I have installed openvswitch-switch.  I
> have configured /etc/network/interfaces as
>
>
> auto lo
> iface lo inet loopback
>
> auto p2p1
> iface p2p1 inet manual
>
> auto p3p1
> iface p3p1 inet manual
> #
> # OVS Bridge
> #
> auto vmbr0
> iface vmbr0 inet manual
>   ovs_type OVSBridge
>   ovs_ports bond0 vlan1
>
> allow-vmbr0 bond0
> iface bond0 inet manual
>   ovs_bridge vmbr0
>   ovs_type OVSBond
>   ovs_bonds p2p1 p3p1
>   ovs_options bond_mode=balance-tcp lacp=active other_config:lacp-time=fast
> other_config:trunks=1
>
> allow-vmbr0 vlan1
> iface vlan1 inet dhcp
>   ovs_type OVSIntPort
>   ovs_bridge vmbr0
>   ovs_options tag=1
>
> I can see using tcpdump -i p2p1 that the DHCP request is being responded on
> my PC but VLAN1 never gets an IP assigned to the interface VLAN1
>
> Could someone point me towards what I have configured incorrectly?
>
> Thanks
>
> Yas
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From scott.lowe at scottlowe.org  Wed Jul  8 19:30:32 2015
From: scott.lowe at scottlowe.org (Scott Lowe)
Date: Wed, 8 Jul 2015 19:30:32 -0700
Subject: [ovs-discuss] Learning OVS - Bonding / LACP on Ubuntu
In-Reply-To: <27851489.757899.1436391665212.JavaMail.yahoo@mail.yahoo.com>
References: <A47B456C-2A42-440A-97CE-65F58BD89F4D@scottlowe.org>
 <27851489.757899.1436391665212.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <91ADC35B-01DF-40FD-90F8-FDFBC55C9742@scottlowe.org>

Please don't drop the list. :-)

I *think* that setting native-untagged is what you need, though it's been a while since I used this option.

-- 
Scott

Sent from my mobile device

> On Jul 8, 2015, at 2:41 PM, yas nak <yass524 at yahoo.com.au> wrote:
> 
> Scott
> 
> Yes you were correct - I change switch to native vlan2 and traffic is flowing.
> 
> To make it work with native vlan=1.  Is the native-untagged option what I need to use?
> 
> Do I need to specify this on both bond and vlan1?
> 
> Thanks
> 
> Yas
> 
> 
> 
> On Thursday, 9 July 2015, 2:10, Scott Lowe <scott.lowe at scottlowe.org> wrote:
> 
> 
> My guess is that the Cisco switch is expecting traffic on VLAN 1 to be untagged since it is the native VLAN. Try setting a different native VLAN on the interfaces on the Cisco switch to see if that helps.
> 
> -- 
> Scott
> 
> Sent from my mobile device
> 
>> On Jul 8, 2015, at 5:32 AM, yas nak <yass524 at yahoo.com.au> wrote:
>> 
>> Hi Forum
>> 
>> I am really new to OVS and trying to understand.  I am trying to get LACP bonding to work on Ubuntu 14.04 and cisco switch.
>> 
>> I have configured the cisco 2960CG switch with the following config
>> interface Port-channel1
>>  switchport mode trunk
>> !
>> interface GigabitEthernet0/1
>>  switchport mode trunk
>>  channel-protocol lacp
>>  channel-group 1 mode active
>> !
>> interface GigabitEthernet0/2
>>  switchport mode trunk
>>  channel-protocol lacp
>>  channel-group 1 mode active
>> 
>>  On my Ubuntu x64 14.04.02 server I have installed openvswitch-switch.  I have configured /etc/network/interfaces as
>> 
>> 
>> auto lo
>> iface lo inet loopback
>> 
>> auto p2p1
>> iface p2p1 inet manual
>> 
>> auto p3p1
>> iface p3p1 inet manual
>> #
>> # OVS Bridge
>> #
>> auto vmbr0
>> iface vmbr0 inet manual
>>   ovs_type OVSBridge
>>   ovs_ports bond0 vlan1
>> 
>> allow-vmbr0 bond0
>> iface bond0 inet manual
>>   ovs_bridge vmbr0
>>   ovs_type OVSBond
>>   ovs_bonds p2p1 p3p1
>>   ovs_options bond_mode=balance-tcp lacp=active other_config:lacp-time=fast other_config:trunks=1
>>  
>> allow-vmbr0 vlan1
>> iface vlan1 inet dhcp
>>   ovs_type OVSIntPort
>>   ovs_bridge vmbr0
>>   ovs_options tag=1 
>> 
>> I can see using tcpdump -i p2p1 that the DHCP request is being responded on my PC but VLAN1 never gets an IP assigned to the interface VLAN1
>> 
>> Could someone point me towards what I have configured incorrectly?
>> 
>> Thanks
>> 
>> Yas
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
> 
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150708/c4fb2332/attachment.html>

From 56708313 at qq.com  Wed Jul  8 19:35:21 2015
From: 56708313 at qq.com (=?gb18030?B?uMm77sHL?=)
Date: Thu, 9 Jul 2015 10:35:21 +0800
Subject: [ovs-discuss] openstack ovs performance issues
Message-ID: <tencent_6904B6F7271C0DAD3EDF7A76@qq.com>

Hello! 


Surroundings:
Compute nodes: DELL _R720
CPU: E5-2640v2 * 2 (32-core)
MEM: 16G * 24
Disk: 2 * 600G SAS (Raid1) + 6 * 4T (Raid5) SATA
NIC: 1G * 2 + 10G * 2 (Intel 82599EB 10-Gigabit SFI / SFP +


Network test is divided into two groups of test, a test is done HelloWorld, and the other is PhoInfo do. When using PhoInfo test, the difference between virtual and physical machines is not large, but when using HelloWorld test, the difference is very obvious, the virtual machine is only about 1/4 of a physical machine. Our analysis of the causes, because the HelloWorld page is very small, the testing process is equivalent to generating a lot of small packets, PhpInfo opposite page a lot, so that data packets generated relatively large. When tested in the packet, the network bottleneck in the PPS, we have repeatedly tested, the performance of the virtual machine software bridge can only reach about 5wPPS, this time OpenVswitch has reached the limit, and ordinary physical NIC determined to reach 200wPPS.
OVS really packet forwarding is much PPS? When IO-intensive data traffic onto smaller, will not lead to OVS to hang? Packet forwarding delay would likely increase?


thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/6c33f5bb/attachment-0001.html>

From pritam.kharat at oneconvergence.com  Wed Jul  8 21:30:49 2015
From: pritam.kharat at oneconvergence.com (Pritam Kharat)
Date: Thu, 9 Jul 2015 10:00:49 +0530
Subject: [ovs-discuss] Problem in using packet values against register
 values in ovs-flow
In-Reply-To: <CAKXxEYz=VnanXghJ7OtX3CgUDbWimCuYw_WJwD3ec0zJkPZo2Q@mail.gmail.com>
References: <CAKXxEYx=NXka4DpY08PGOVMo3e9FbSA3AYWhQkiaSTdS+mo5hQ@mail.gmail.com>
 <20150708150555.GA5246@nicira.com>
 <CAKXxEYxdQ8jkgOJiWG0s+y+n3rL5bR_Y5sOF7kXo=78mWqMgnA@mail.gmail.com>
 <20150708171559.GA31439@nicira.com>
 <CAKXxEYz=VnanXghJ7OtX3CgUDbWimCuYw_WJwD3ec0zJkPZo2Q@mail.gmail.com>
Message-ID: <CAKXxEYyZyxfeEHJs7ZwbsgsU0aEeu65V7-nTnkttQNmc4t+F9w@mail.gmail.com>

Thanks for your help :-)

On Wed, Jul 8, 2015 at 10:50 PM, Pritam Kharat <
pritam.kharat at oneconvergence.com> wrote:

> NXM_OF_IP_SRC[] will it cover cidr with mask also. e.g 10.0.0.0/8
>
> On Wed, Jul 8, 2015 at 10:45 PM, Ben Pfaff <blp at nicira.com> wrote:
>
>> Yes, you need to match on IP to use an IP field, e.g.:
>>         ovs-ofctl add-flow br-int
>> 'table=0,ip,in_port=5,actions=move:NXM_OF_IP_SRC[]->NXM_NX_REG0[]'
>>
>>
>> On Wed, Jul 08, 2015 at 09:32:25PM +0530, Pritam Kharat wrote:
>> > Tried with move but gives error
>> >
>> > root at pritam:/home/pritam/git# ovs-ofctl add-flow br-int
>> > 'table=0,in_port=5,actions=move:NXM_OF_IP_SRC[]->NXM_NX_REG0[]'
>> > 2015-07-08T16:01:45Z|00001|meta_flow|WARN|source field ip_src lacks
>> correct
>> > prerequisites
>> > ovs-ofctl: actions are invalid with specified match
>> > (OFPBAC_MATCH_INCONSISTENT)
>> >
>> >
>> >
>> >
>> > On Wed, Jul 8, 2015 at 8:35 PM, Ben Pfaff <blp at nicira.com> wrote:
>> >
>> > > On Wed, Jul 08, 2015 at 09:38:06AM +0530, Pritam Kharat wrote:
>> > > > 1) In a ovs flow how do I load a nw_src with mask value  from a
>> packet to
>> > > > register say reg0 ? Doc says we can load only integer or hex value
>> to a
>> > > > register ? Is there any way to do it ?
>> > > >
>> > > > e.g
>> > > >
>> > >
>> *table=0,<flow-match>,actions=load:(nw_src/mask)->NXM_NX_REG0[],load:(nw_dst/mask)->NXM_NX_REG1[],resubmit(,1)*
>> > >
>> > > I guess you want the "move" action.
>> > >
>> > > > 2) Can we create ovs flow which compares values in two registers. ?
>> > > >  e.g * match -> table=1,reg0==reg1*
>> > > > *       actions -> drop*
>> > > >
>> > > > What I am trying to do is, see if packet is destined to vm of same
>> > > subnet.
>> > > > If yes then drop the packet.This I want to do using registers so
>> that
>> > > way I
>> > > > will have only one flow ?
>> > >
>> > > OVS doesn't have a general-purpose comparison operator or an easy way
>> to
>> > > construct one.
>> > >
>> > > > 3) Can I compare value from packet with value in register ?
>> > > >
>> > > > e.g *table=1,nw_src=reg0,actions=drop*
>> > >
>> > > Same as #2.
>> > >
>> >
>> >
>> >
>> > --
>> > Thanks and Regards,
>> > Pritam Kharat.
>>
>
>
>
> --
> Thanks and Regards,
> Pritam Kharat.
>



-- 
Thanks and Regards,
Pritam Kharat.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/9600821e/attachment.html>

From zhaojun12 at outlook.com  Thu Jul  9 02:31:28 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Thu, 9 Jul 2015 17:31:28 +0800
Subject: [ovs-discuss] install openvswitch in VM without ipv6
Message-ID: <BAY172-W3C57C694C65D7897E42B2B2900@phx.gbl>

hi, all
i wonder if a VM has no ipv6 support, can openvswitch be install successfully?
i have a VM without ipv6 support with centos 7.0, i try to install openvswitch under instruction INSTALL.RHEL.md
and i donot go through test section, all errors is related with IPV6
and the process to build rpm exit with 1.
attachment is the testsuite.log 
thanks.

Zhao Jun 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/689f1dc2/attachment-0001.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: testsuite.log
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/689f1dc2/attachment-0001.ksh>

From Dave.Johnston at owmobility.com  Thu Jul  9 02:44:30 2015
From: Dave.Johnston at owmobility.com (Dave Johnston)
Date: Thu, 9 Jul 2015 09:44:30 +0000
Subject: [ovs-discuss] DPDK OVS on multi-host KVM
In-Reply-To: <4B1BB321037C0849AAE171801564DFA6450F5895@IRSMSX107.ger.corp.intel.com>
References: <82D8F9A463E6AC4B8BCB7AAACF8E87C95793EA11@AMEXMB03.ds.jdsu.net>,
 <4B1BB321037C0849AAE171801564DFA6450F5895@IRSMSX107.ger.corp.intel.com>
Message-ID: <DM2PR0501MB158196AED90143FFA93EEA4691900@DM2PR0501MB1581.namprd05.prod.outlook.com>

Hi Sean,


[sean] while the onp 1.4 document does not describe how to deploy with the vhost-user support available in the networking-ovs-dpdk repo I can provide information on how to enable this support and configure a multi node deployment.


Hi Sean, Can you provide some details on how to do this?  It looks like the ONP guide talks about using DPDK 1.8, but 2.0 is required for this?  If I enable
OVS_DPDK_RTE_LIBRTE_VHOST=y

Will the correct version of DPDK be downloaded and compiled.
What is required, is it just the setup of hugepages ?





Dave Johnston | Software Engineer | Openwave Mobility


________________________________
From: discuss <discuss-bounces at openvswitch.org> on behalf of Mooney, Sean K <sean.k.mooney at intel.com>
Sent: 02 July 2015 20:33
To: John Lange; bugs at openvswitch.org
Subject: Re: [ovs-discuss] DPDK OVS on multi-host KVM


Hello john.


I will try to answer some of your question inline.



I work on the team that developed the install guide you have referenced as well as

The software components to integrate ovs +dpdk with OpenStack at intel.



The following repository may be of use to you



https://github.com/stackforge/networking-ovs-dpdk



as of the kilo release of openstack we have migrated the openstack integration code from 01.org to stackforge.



The networking-ovs-dpdk repo provides  a ovsdpdk ml2 mechanism driver  and an ovsdpdk l2 agent to enable support for

Upstream ovs with the dpdk enabled netdev datapath. Additionally the networking-ovs-dpdk provide a devstack plugin

Which will download, compile and install dpdk, ovs and the agent and driver required for OpenStack integration.



At present we do not have a corresponding Getting started guide for deploying via the networking-ovs-dpdk  repo but I can provide assistance configuring ovs+dpdk+openstack.



Please feel free to follow up with me here or directly If I can help.



Regards

Sean.







From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of John Lange
Sent: Wednesday, July 1, 2015 9:36 PM
To: bugs at openvswitch.org
Subject: [ovs-discuss] DPDK OVS on multi-host KVM



Greetings,



We have a multi-host KVM system, with one server for KVM controller, one server for neutron (networking), one server for cinder (bulk disk storage), and multiple servers planned for KVM compute nodes (but currently only one compute node).  We are using Ubuntu 12.04.2 LTS Server on all the hosts.  We need to use SLES 11sp3 as the guest OSes in the KVM-based VMs.



First issue is figuring out which version of DPDK and OVS to use.  Newer versions of OVS are incompatible with newer versions of DPDK.  This seems mostly due to the removal of the pkt.data field in mbuf structure in DPDK (see here<http://dpdk.org/doc/guides/rel_notes/updating_apps.html> for updating DPDK details).  I am currently trying to use DPDK v1.6.0r2 with OVS v2.3.2.  This combination seems to build fine, and I can get through most of the install guide here<http://openvswitch.org/support/dist-docs/INSTALL.DPDK.md.txt>, at least on the compute node, using an 82599 10Gb port for the binding.



[sean] the current master branch of ovs supports dpdk 2.0.

[sean] the current commit of ovs we recommend to use is 7d1ced01772de541d6692c7d5604210e274bcd37 with dpdk v2.0.0



However, the install guide doesn’t cover how to install in a multi-host KVM deployment and also how to deploy on a KVM-based VM guest.  Near the end of the install guide referenced above, it mentions that a patched QEMU is required, and refers to here<https://01.org/packet-processing/downloads>.  However, that is the link for downloading OVDK (up to v1.1 which is out of date with the most recent v2.3.2 available from openvswitch.org), and there doesn’t seem to be any instructions at that link for how to patch QEMU.



[sean] a patched version of qemu is only required for ivshmem support.

[sean] we recommend use qemu 2.2 or newer when using ovs+dpdk and vhost-user.

[sean]Note that ivshmem support is not intergrated with openstack at this time.



I did find an Intel document here<https://01.org/sites/default/files/page/openstack_neutron_with_intel_architecture_gsg_rev004.pdf> from Nov 2014 covering the deployment of OVDK on multiple host KVM, but it seems out of date since OVDK is being deprecated due to it being merged to the common version of OVS.  Is there an updated version of this document available, covering the newer (post-merged version of) OVS?



[sean] the document you have references was a Getting started guide describing the deployment of ovs+dpdk  and ovdk with openstack juno.

[sean] for kilo release and on this intergrations is now done via the https://github.com/stackforge/networking-ovs-dpdk repo.

[sean] a sample configuration file for an all in one node is available here https://github.com/stackforge/networking-ovs-dpdk/blob/master/doc/source/_downloads/local.conf_example

[sean] an updated onp reference architecture document is available here https://01.org/sites/default/files/page/intel_onp_server_reference_architecture_guide_v1.4.pdf

[sean] while the onp 1.4 document does not describe how to deploy with the vhost-user support available in the networking-ovs-dpdk repo I can provide information on how to enable this support and

[sean] configure a multi node deployment.





As it is, I’m not sure how to get DPDK based OVS to work in KVM based VMs.  Do I need to build and deploy DPDK/Open vSwitch on the KVM controller?  On the KVM Neutron node?  On each compute node?  On the VMs?  Can it work with virtio (virtual NICs), or does it require Direct Attach for each VM.  It is all very confusing, and the documentation is either non-existent or is at best incomplete.  Any help you can offer would be greatly appreciated.



[sean] kernel ovs and UserSpace ovs (dpdk netdev datapath) can coexist in the same cloud.

[sean] ovs +dpdk can be installed on the controller, network node or compute nodes.

[sean] to integrate ovs+dpdk with OpenStack the ovsdpdk ml2 mechanism driver should be installed on network(neutron) node.

[sean] the DPDK ovs agent should be installed on each compute node that you wish to run ovs+dpdk.

[sean] the deployment of these nodes can be supported by the devstack plugin provides as part of the networking-ovs-dpdk repo.



[sean] As of qemu 2.1 a new virtio backend is supported called vhost-user. This interface allows either a standard virtio-net driver or a dpdk poll mode driver to be used in the guest.

[sean] vhost-user does not require vm images to be modified in any way how ever does require vms to use hugepage memory.

[sean] support for vhost-user with openstack is available with the following software versions

·         openstack kilo+

·         ovs commit 7d1ced01772de541d6692c7d5604210e274bcd37 or later

·         dpdk v2.0.0

·         qemu 2.1+(recommend 2.2+)

·         Libvirt 1.2.11+ (recommend 1.2.13)





Do you (or other companies) offer contract consulting services to support Open vSwitch?



[sean] not that I’m aware of but we are happy to help you resolve your issues :)



Many thanks,



John Lange

Principal Engineer, Software Development
Solution Architecture/Systems Engineering Group
JDS Uniphase Corporation
9950 Federal Drive, Ste. 150
Colorado Springs, CO 80921

John.Lange at jdsu.com<mailto:John.Lange at jdsu.com>
+1-303-416-9665 office

+1-281-772-5818 cell
www.jdsu.com<http://www.jdsu.com/>

www.jdsu.tv<http://www.jdsu.tv/>





[cid:BBA3B45F-65AA-4291-86AD-168262546767]




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/dd7f2fbe/attachment-0001.html>

From john.hurley at netronome.com  Thu Jul  9 04:59:31 2015
From: john.hurley at netronome.com (John Hurley)
Date: Thu, 9 Jul 2015 12:59:31 +0100
Subject: [ovs-discuss] ovs-conntrack helper functions
Message-ID: <CAK+XE=nXcH4VHVopHc_dB+EZc4DhGZRkEVq8=mrBgq3aa90OLA@mail.gmail.com>

Hi,

I have a few queries about the use of helper functions in ovs-conntrack.
I've tried multiple tests and cannot get the ftp expected flows to work
correctly.

As an example, take the following rules:

ovs-ofctl add-flow br0 "tcp,conn_state=-trk,action=ct(recirc)"
ovs-ofctl add-flow br0
"priority=11,tcp,conn_state=+trk+new,action=ct(alg=ftp,commit),2"
ovs-ofctl add-flow br0
"priority=12,tcp,conn_state=+trk+new+rel,action=ct(commit),2"
ovs-ofctl add-flow br0 "priority=11,tcp,conn_state=+trk-new+rel,action=2"
ovs-ofctl add-flow br0 "priority=10,tcp,conn_state=+trk-new,action=2"

For an ftp session I would expect all packets to hit the top rule, new
flows to recirculate and be committed to the Conntrack tables with the ftp
helper assigned (nf_conntrack_ftp is running).  Then the following packets
in that flow should have the helper function applied to them. New or
realated flows spawned from the controol channel should be picked up by the
3rd and 4th rule. In my tests only the 1st, 2nd and last rule are hit.  Is
my interpretation correct?

>From tracing some of the code I can see that the helper is assigned
correctly on the first packet of a flow but this is not maintained across
following packets. These all fail to implement the helper function due to
the call of nfct_help(ct) returning NULL. The help function will be
correctly applied to each packet if a 'commit' is not used to in the 2nd
rule as all packets are assumed new and assigned the helper in the
nf_conntrack_in function. But doing this means that the state information
is incorrect for the packet and it will fail to match in nf_conntrack_ftp.

I would also like to understand more about the use of a nf_conntrack
template. It seems that the use of 'alg=ftp' is only for copying the
correct helper to a template that is set up with a new rule - the ftp
helper module will be added automatically based on port number in
nf_conntrack_in? The helper seems to be added to the template correctly but
is never used again from what I can see.

Can you clear up some of my misunderstandings here? An example ruleset that
is known to work would also be helpful.

Thanks,
John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/e0549af5/attachment.html>

From blp at nicira.com  Thu Jul  9 07:45:00 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 9 Jul 2015 07:45:00 -0700
Subject: [ovs-discuss] install openvswitch in VM without ipv6
In-Reply-To: <BAY172-W3C57C694C65D7897E42B2B2900@phx.gbl>
References: <BAY172-W3C57C694C65D7897E42B2B2900@phx.gbl>
Message-ID: <20150709144500.GB5369@nicira.com>

On Thu, Jul 09, 2015 at 05:31:28PM +0800, 俊 赵 wrote:
> i wonder if a VM has no ipv6 support, can openvswitch be install successfully?
> i have a VM without ipv6 support with centos 7.0, i try to install openvswitch under instruction INSTALL.RHEL.md
> and i donot go through test section, all errors is related with IPV6
> and the process to build rpm exit with 1.
> attachment is the testsuite.log 

Just run the build "--without check" in that case.

From blp at nicira.com  Thu Jul  9 08:12:31 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 9 Jul 2015 08:12:31 -0700
Subject: [ovs-discuss] install openvswitch in VM without ipv6
In-Reply-To: <BAY172-W4031CA6BB4E28667EE42ECB2900@phx.gbl>
References: <BAY172-W3C57C694C65D7897E42B2B2900@phx.gbl>
 <20150709144500.GB5369@nicira.com>
 <BAY172-W4031CA6BB4E28667EE42ECB2900@phx.gbl>
Message-ID: <20150709151231.GC5369@nicira.com>

Please don't drop the mailing list.

Those errors are outside my specialty.  I hope that someone who
understands the kernel module interaction with Centos will speak up.

On Thu, Jul 09, 2015 at 11:11:20PM +0800, 俊 赵 wrote:
> yes, --without check works, but it leads to another errors.
> 
> 
> 
> 
> 
> 
> 
> 
> [root at iZ25dj6r23bZ x86_64]# rpm -ivh kmod-openvswitch-2.3.2-1.el7.centos.x86_64.rpm 
> errors：
> 	kernel(__crc32c_le_combine) = 0x6cd8c86b is needed by mod-openvswitch-2.3.2-1.el7.centos.x86_64
> 	kernel(__genl_register_family) = 0xcc1d296d 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(__skb_checksum) = 0x1c96dfd0 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(__skb_get_hash) = 0x70a8b95f 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(flex_array_alloc) = 0x13315729 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(flex_array_free) = 0x07a4b576 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(flex_array_get) = 0xa37e78b6 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(flex_array_prealloc) = 0x9fd7cda1 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(genl_notify) = 0x36aa026d 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(genl_unregister_family) = 0xa9a4f805 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(genlmsg_put) = 0xdbce6f67 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(ip_local_out_sk) = 0xcf6b0abb 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(iptunnel_xmit) = 0x7bb6c8a8 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> 	kernel(vxlan_sock_add) = 0xe9ab4230 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> [root at iZ25dj6r23bZ x86_64]# rpm -ivh openvswitch-2.3.2-1.x86_64.rpm 
> 错误：依赖检测失败：
> 	openvswitch-kmod 被 openvswitch-2.3.2-1.x86_64 需要
> and i solved it by running commands.
> sed 's/openvswitch-kmod, //g' openvswitch-2.3.2/rhel/openvswitch.spec > openvswitch-2.3.2/rhel/openvswitch_no_kmod.spec
> my os is centos 7.0; i wonder if some features will be disabled if I use commands metioned above.
> thanks
> 
> Zhao Jun
> 
> > Date: Thu, 9 Jul 2015 07:45:00 -0700
> > From: blp at nicira.com
> > To: zhaojun12 at outlook.com
> > CC: discuss at openvswitch.org
> > Subject: Re: [ovs-discuss] install openvswitch in VM without ipv6
> > 
> > On Thu, Jul 09, 2015 at 05:31:28PM +0800, 俊 赵 wrote:
> > > i wonder if a VM has no ipv6 support, can openvswitch be install successfully?
> > > i have a VM without ipv6 support with centos 7.0, i try to install openvswitch under instruction INSTALL.RHEL.md
> > > and i donot go through test section, all errors is related with IPV6
> > > and the process to build rpm exit with 1.
> > > attachment is the testsuite.log 
> > 
> > Just run the build "--without check" in that case.
>  		 	   		  

From zhaojun12 at outlook.com  Thu Jul  9 08:14:47 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Thu, 9 Jul 2015 23:14:47 +0800
Subject: [ovs-discuss] install openvswitch in VM without ipv6
In-Reply-To: <20150709151231.GC5369@nicira.com>
References: <BAY172-W3C57C694C65D7897E42B2B2900@phx.gbl>,
 <20150709144500.GB5369@nicira.com>,
 <BAY172-W4031CA6BB4E28667EE42ECB2900@phx.gbl>,
 <20150709151231.GC5369@nicira.com>
Message-ID: <BAY172-W333820E59C23DA88BE7CB9B2900@phx.gbl>

sorry, i just clicked reply button, and didnot notice sending without mailing list.
^_^

Zhao Jun

> Date: Thu, 9 Jul 2015 08:12:31 -0700
> From: blp at nicira.com
> To: zhaojun12 at outlook.com
> CC: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] install openvswitch in VM without ipv6
> 
> Please don't drop the mailing list.
> 
> Those errors are outside my specialty.  I hope that someone who
> understands the kernel module interaction with Centos will speak up.
> 
> On Thu, Jul 09, 2015 at 11:11:20PM +0800, 俊 赵 wrote:
> > yes, --without check works, but it leads to another errors.
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > 
> > [root at iZ25dj6r23bZ x86_64]# rpm -ivh kmod-openvswitch-2.3.2-1.el7.centos.x86_64.rpm 
> > errors：
> > 	kernel(__crc32c_le_combine) = 0x6cd8c86b is needed by mod-openvswitch-2.3.2-1.el7.centos.x86_64
> > 	kernel(__genl_register_family) = 0xcc1d296d 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(__skb_checksum) = 0x1c96dfd0 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(__skb_get_hash) = 0x70a8b95f 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(flex_array_alloc) = 0x13315729 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(flex_array_free) = 0x07a4b576 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(flex_array_get) = 0xa37e78b6 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(flex_array_prealloc) = 0x9fd7cda1 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(genl_notify) = 0x36aa026d 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(genl_unregister_family) = 0xa9a4f805 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(genlmsg_put) = 0xdbce6f67 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(ip_local_out_sk) = 0xcf6b0abb 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(iptunnel_xmit) = 0x7bb6c8a8 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > 	kernel(vxlan_sock_add) = 0xe9ab4230 被 kmod-openvswitch-2.3.2-1.el7.centos.x86_64 需要
> > [root at iZ25dj6r23bZ x86_64]# rpm -ivh openvswitch-2.3.2-1.x86_64.rpm 
> > 错误：依赖检测失败：
> > 	openvswitch-kmod 被 openvswitch-2.3.2-1.x86_64 需要
> > and i solved it by running commands.
> > sed 's/openvswitch-kmod, //g' openvswitch-2.3.2/rhel/openvswitch.spec > openvswitch-2.3.2/rhel/openvswitch_no_kmod.spec
> > my os is centos 7.0; i wonder if some features will be disabled if I use commands metioned above.
> > thanks
> > 
> > Zhao Jun
> > 
> > > Date: Thu, 9 Jul 2015 07:45:00 -0700
> > > From: blp at nicira.com
> > > To: zhaojun12 at outlook.com
> > > CC: discuss at openvswitch.org
> > > Subject: Re: [ovs-discuss] install openvswitch in VM without ipv6
> > > 
> > > On Thu, Jul 09, 2015 at 05:31:28PM +0800, 俊 赵 wrote:
> > > > i wonder if a VM has no ipv6 support, can openvswitch be install successfully?
> > > > i have a VM without ipv6 support with centos 7.0, i try to install openvswitch under instruction INSTALL.RHEL.md
> > > > and i donot go through test section, all errors is related with IPV6
> > > > and the process to build rpm exit with 1.
> > > > attachment is the testsuite.log 
> > > 
> > > Just run the build "--without check" in that case.
> >  		 	   		  
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/03e734b1/attachment-0001.html>

From 56708313 at qq.com  Wed Jul  8 18:33:56 2015
From: 56708313 at qq.com (=?gb18030?B?uMm77sHL?=)
Date: Thu, 9 Jul 2015 09:33:56 +0800
Subject: [ovs-discuss] openstack ovs performance issues
Message-ID: <tencent_1B6314414A0D220654EBE25F@qq.com>

Hello! 


Surroundings:
Compute nodes: DELL _R720
CPU: E5-2640v2 * 2 (32-core)
MEM: 16G * 24
Disk: 2 * 600G SAS (Raid1) + 6 * 4T (Raid5) SATA
NIC: 1G * 2 + 10G * 2 (Intel 82599EB 10-Gigabit SFI / SFP +


Network test is divided into two groups of test, a test is done HelloWorld, and the other is PhoInfo do. When using PhoInfo test, the difference between virtual and physical machines is not large, but when using HelloWorld test, the difference is very obvious, the virtual machine is only about 1/4 of a physical machine. Our analysis of the causes, because the HelloWorld page is very small, the testing process is equivalent to generating a lot of small packets, PhpInfo opposite page a lot, so that data packets generated relatively large. When tested in the packet, the network bottleneck in the PPS, we have repeatedly tested, the performance of the virtual machine software bridge can only reach about 5wPPS, this time OpenVswitch has reached the limit, and ordinary physical NIC determined to reach 200wPPS.
OVS really packet forwarding is much PPS? When IO-intensive data traffic onto smaller, will not lead to OVS to hang? Packet forwarding delay would likely increase?


thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/8cf4073b/attachment-0001.html>

From exiaoli at 163.com  Wed Jul  8 19:36:13 2015
From: exiaoli at 163.com (=?GBK?B?0KTBpg==?=)
Date: Thu, 9 Jul 2015 10:36:13 +0800 (CST)
Subject: [ovs-discuss] openstack ovs performance issues
Message-ID: <3e8b4920.4e41.14e70aba40e.Coremail.exiaoli@163.com>

Hello!


Surroundings:
Compute nodes: DELL _R720
CPU: E5-2640v2 * 2 (32-core)
MEM: 16G * 24
Disk: 2 * 600G SAS (Raid1) + 6 * 4T (Raid5) SATA
NIC: 1G * 2 + 10G * 2 (Intel 82599EB 10-Gigabit SFI / SFP +


Network test is divided into two groups of test, a test is done HelloWorld, and the other is PhoInfo do. When using PhoInfo test, the difference between virtual and physical machines is not large, but when using HelloWorld test, the difference is very obvious, the virtual machine is only about 1/4 of a physical machine. Our analysis of the causes, because the HelloWorld page is very small, the testing process is equivalent to generating a lot of small packets, PhpInfo opposite page a lot, so that data packets generated relatively large. When tested in the packet, the network bottleneck in the PPS, we have repeatedly tested, the performance of the virtual machine software bridge can only reach about 5wPPS, this time OpenVswitch has reached the limit, and ordinary physical NIC determined to reach 200wPPS.
OVS really packet forwarding is much PPS? When IO-intensive data traffic onto smaller, will not lead to OVS to hang? Packet forwarding delay would likely increase?


thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/2a829d37/attachment-0001.html>

From iwase.yusuke0 at gmail.com  Wed Jul  8 21:42:16 2015
From: iwase.yusuke0 at gmail.com (Yusuke Iwase)
Date: Thu, 09 Jul 2015 13:42:16 +0900
Subject: [ovs-discuss] OpenFlow1.5 support status of lib.ofp-util
Message-ID: <559DFBA8.8020403@gmail.com>

Hi,

I'm developing an OpenFlow controller which supports OpenFlow 1.5.
I want to validate my implementation by using the packet data
generated by lib.ofp-util.

But, unfortunately, some packet data of lib.ofp-util seems not be
composed in OpenFlow 1.5 structure.
It seems to be version 1.4 or earlier structure.
aggregate_stats, flow_removed, packet_out, etc

e.g.)
struct ofpbuf *
generate_aggregate_stats_reply(enum ofputil_protocol proto)
{
    struct ofputil_aggregate_stats as;
    struct ofp_header oh;

    memset(&oh, 0, sizeof(oh));
    oh.version = 0x06;
    oh.type = 18;  /* OFPT11_STATS_REQUEST */
    oh.length = htons(0x10);
    oh.xid = 0;

    memset(&as, 0, sizeof(as));
    as.packet_count = 0x123456789abcdef0;
    as.byte_count = 0x0fedcba987654321;
    as.flow_count = 0x12345678;

    return ofputil_encode_aggregate_stats_reply(&as, &oh);
}

Is there a mistake?
Or, please tell me support status of lib.ofp-util in OpenFlow 1.5.

Best Regards,
Iwase

From mir_ali at outlook.com  Thu Jul  9 03:19:55 2015
From: mir_ali at outlook.com (Mir Ali)
Date: Thu, 9 Jul 2015 03:19:55 -0700
Subject: [ovs-discuss] ovsdb python library .. accessing row elements using
 a variable as the key
Message-ID: <BAY176-W3107498DE65915C39BA87091900@phx.gbl>

Hi,
How can I access a particular column from the row if the column attribute is a variable.

For example, in a Bridge table I can access the name of the bridge using 'row.name'. I want to do the same but using the column name as a variable. If I can do something as row['name'] it will help me a lot. So far all the methods I tried failed.

row._data['name'] doesn't work either.

My code is as follows:

txn = ovs.db.idl.Transaction(idl)
bridge_table = idl.tables['Bridge']
column_keys = bridge_table.columns.keys()
row = txn.insert(bridge_table)

for key in column_keys:
   # how can I assign row elements using the variable 'key'
    row['key'] = some_default_value # This doesn't work.

Any help will be great.

Thanks
Mir

 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150709/e6150fef/attachment-0001.html>

From blp at nicira.com  Thu Jul  9 10:24:56 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 9 Jul 2015 10:24:56 -0700
Subject: [ovs-discuss] ovsdb python library .. accessing row elements
 using a variable as the key
In-Reply-To: <BAY176-W3107498DE65915C39BA87091900@phx.gbl>
References: <BAY176-W3107498DE65915C39BA87091900@phx.gbl>
Message-ID: <20150709172456.GD5369@nicira.com>

On Thu, Jul 09, 2015 at 03:19:55AM -0700, Mir Ali wrote:
> Hi,
> How can I access a particular column from the row if the column attribute is a variable.
> 
> For example, in a Bridge table I can access the name of the bridge using 'row.name'. I want to do the same but using the column name as a variable. If I can do something as row['name'] it will help me a lot. So far all the methods I tried failed.
> 
> row._data['name'] doesn't work either.

They're attributes, so presumably you can use Python techniques for
accessing attributes, like the getattr function.

From blp at nicira.com  Thu Jul  9 10:30:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 9 Jul 2015 10:30:59 -0700
Subject: [ovs-discuss] OpenFlow1.5 support status of lib.ofp-util
In-Reply-To: <559DFBA8.8020403@gmail.com>
References: <559DFBA8.8020403@gmail.com>
Message-ID: <20150709173059.GA10579@nicira.com>

On Thu, Jul 09, 2015 at 01:42:16PM +0900, Yusuke Iwase wrote:
> I'm developing an OpenFlow controller which supports OpenFlow 1.5.
> I want to validate my implementation by using the packet data
> generated by lib.ofp-util.
> 
> But, unfortunately, some packet data of lib.ofp-util seems not be
> composed in OpenFlow 1.5 structure.
> It seems to be version 1.4 or earlier structure.
> aggregate_stats, flow_removed, packet_out, etc

OpenFlow 1.4 and 1.5 aren't fully supported, which is why they aren't
enabled by default.

From blp at nicira.com  Thu Jul  9 23:00:18 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 9 Jul 2015 23:00:18 -0700
Subject: [ovs-discuss] OpenFlow1.5 support status of lib.ofp-util
In-Reply-To: <559F2152.6000901@gmail.com>
References: <559DFBA8.8020403@gmail.com> <20150709173059.GA10579@nicira.com>
 <559F2152.6000901@gmail.com>
Message-ID: <20150710060018.GA23335@nicira.com>

On Fri, Jul 10, 2015 at 10:35:14AM +0900, Yusuke Iwase wrote:
> If you don't mind, please let us know if there is any plan when to
> release OpenFlow 1.5 support?

You can see a list of the missing features for OpenFlow 1.4 and 1.5 in
OPENFLOW-1.1+.md in the source tree.  Only a few required features are
missing, but we don't have volunteers for most of them.  We'd be
grateful if you want to volunteer to implement any of them.

From joestringer at nicira.com  Fri Jul 10 00:00:08 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Fri, 10 Jul 2015 00:00:08 -0700
Subject: [ovs-discuss] ovs-conntrack helper functions
In-Reply-To: <CAK+XE=nXcH4VHVopHc_dB+EZc4DhGZRkEVq8=mrBgq3aa90OLA@mail.gmail.com>
References: <CAK+XE=nXcH4VHVopHc_dB+EZc4DhGZRkEVq8=mrBgq3aa90OLA@mail.gmail.com>
Message-ID: <CANr6G5xax4dw3f-fbao+Cwjqv6O4vVD7FqnP5u7_4LZg5M+zZg@mail.gmail.com>

On 9 July 2015 at 04:59, John Hurley <john.hurley at netronome.com> wrote:
> Hi,
>
> I have a few queries about the use of helper functions in ovs-conntrack.
> I've tried multiple tests and cannot get the ftp expected flows to work
> correctly.
>
> As an example, take the following rules:
>
> ovs-ofctl add-flow br0 "tcp,conn_state=-trk,action=ct(recirc)"
> ovs-ofctl add-flow br0 "priority=11,tcp,conn_state=+trk+new,action=ct(alg=ftp,commit),2"
> ovs-ofctl add-flow br0 "priority=12,tcp,conn_state=+trk+new+rel,action=ct(commit),2"
> ovs-ofctl add-flow br0 "priority=11,tcp,conn_state=+trk-new+rel,action=2"
> ovs-ofctl add-flow br0 "priority=10,tcp,conn_state=+trk-new,action=2"
>
> For an ftp session I would expect all packets to hit the top rule, new flows
> to recirculate and be committed to the Conntrack tables with the ftp helper
> assigned (nf_conntrack_ftp is running).  Then the following packets in that
> flow should have the helper function applied to them. New or realated flows
> spawned from the controol channel should be picked up by the 3rd and 4th
> rule. In my tests only the 1st, 2nd and last rule are hit.  Is my
> interpretation correct?

Your interpretation sounds correct. The main strange thing I see is
that you aren't matching on in_port. So it seems like all of your
packets will always go out port 2. If the control connection cannot be
established, or if the relevant messages are not passing through
conntrack, then it might not identify the FTP connection. There's a
couple of examples in the "FTP" kernel module test from
tests/kmod-traffic.at, perhaps you'll find this useful:
https://github.com/justinpettit/ovs/blob/8aeba8479754750a0c0f8adc05458707ff301d44/tests/kmod-traffic.at#L473

Other useful debugging pieces would be things like:
- Once you've run the test, is the nf_conntrack_ftp module loaded?
- What does ovs-dpctl dump-flows show?
- What packets do you see flow through OVS?

> From tracing some of the code I can see that the helper is assigned
> correctly on the first packet of a flow but this is not maintained across
> following packets. These all fail to implement the helper function due to
> the call of nfct_help(ct) returning NULL. The help function will be
> correctly applied to each packet if a 'commit' is not used to in the 2nd
> rule as all packets are assumed new and assigned the helper in the
> nf_conntrack_in function. But doing this means that the state information is
> incorrect for the packet and it will fail to match in nf_conntrack_ftp.

The way that the templates work is that there is one template created
when the flow is first created in the kernel. The FTP helper is
attached to this template. For all of the packets which match this
flow, they will take the template and use it for conntrack lookup -
whether this is a new packet or a subsequent packet. If it's a new
connection, that should allow the new connection tracking entry to
inherit the helper from the template and use it; if it's an existing
connection, then conntrack lookup should find a conntrack entry which
has the helper associated. Does that make sense?

> I would also like to understand more about the use of a nf_conntrack
> template. It seems that the use of 'alg=ftp' is only for copying the correct
> helper to a template that is set up with a new rule - the ftp helper module
> will be added automatically based on port number in nf_conntrack_in? The
> helper seems to be added to the template correctly but is never used again
> from what I can see.

The helper module is not based on port number, but based on a string
literal passed through the OVS netlink interface.

From joestringer at nicira.com  Fri Jul 10 00:03:53 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Fri, 10 Jul 2015 00:03:53 -0700
Subject: [ovs-discuss] ovs-conntrack action ordering?
In-Reply-To: <CANr6G5w8huEGRwsfQ85bsnQKzaT9J5CO1_m8RUm5HQ-BzCBLnA@mail.gmail.com>
References: <CAK+XE=njXUSy6QpYzowQP6FrGy1qboaC23jfW7+nvxeH-UOoew@mail.gmail.com>
 <CANr6G5xTqCTQmskJ6-qioLNHg5CNdDSqxFVcUe7DXPiuKz40uQ@mail.gmail.com>
 <CAK+XE=kNCFUdeqp3vu5BHWQ9N9wsXHTDFNU2K86eMV5k5qY_iw@mail.gmail.com>
 <CANr6G5w8huEGRwsfQ85bsnQKzaT9J5CO1_m8RUm5HQ-BzCBLnA@mail.gmail.com>
Message-ID: <CANr6G5xxRCgrunnMeRKVoqu3rzhC6qgfLDahHKyM=S1fHMuDjQ@mail.gmail.com>

On 25 June 2015 at 03:23, Joe Stringer <joestringer at nicira.com> wrote:
> Good example. I agree that the ovs conntrack support should consider
> the ordering this way. Setting conn_mark/conn_label is also relevant
> to this, as they are currently done via commit_odp_actions(). So they
> cannot be done before conntrack() action. This was already how we were
> thinking about these commands, and perhaps their ordering should also
> be enforced by OpenFlow.
>
> Right, the commit call is what I was looking for. I'll roll this
> change into the series soon and start testing with it, see what comes
> up. Perhaps the datapath flow translation like this would be a good
> test case for the kernel module testsuite too.
>
> Thanks,
> Joe

FWIW this went smoothly and the fix should be present in the latest
branch. Thanks for the suggestion!

From sugesh.chandran at intel.com  Fri Jul 10 05:01:27 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Fri, 10 Jul 2015 12:01:27 +0000
Subject: [ovs-discuss] Issues with configuring multitenant network using OVN.
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB8387BE@IRSMSX102.ger.corp.intel.com>

Hi,
I am trying to create a simple two tenant logical network on a single chassis using OVN as shown below.



........................................................
.                                                      .
.                        Sw1                           .
.  .------------------.        .------------------.    .
. / 00:00:00:00:00:01, \      / 00:00:00:00:00:02, \   .
.(  100.0.0.1           )    (  100.0.0.2           )  .
. \                    /      \                    /   .
.  '----.--------.----'        '----.--------.----'    .
.       | tap0   |                  | tap1   |         .
........'--------'..................'--------'..........




..........--------....................--------..........
.        | tap2   |       Sw0        | tap3   |        .
.   .----'--------'----.        .----'--------'----.   .
.  / 00:00:00:00:00:03, \      / 00:00:00:00:00:04, \  .
. (  100.0.0.3           )    (  100.0.0.4           ) .
.  \                    /      \                    /  .
.   '------------------'        '------------------'   .
.                                                      .
........................................................


Here is the OVN commands I used to create this topology.

ovn-nbctl lswitch-add sw0
ovn-nbctl lport-add sw0 sw0-port1
ovn-nbctl lport-add sw0 sw0-port2
ovn-nbctl lport-set-macs sw0-port1 00:00:00:00:00:01
ovn-nbctl lport-set-macs sw0-port2 00:00:00:00:00:02
ovs-vsctl add-port br-int tap0 -- \
set Interface tap0 external-ids:iface-id=sw0-port1
ovs-vsctl add-port br-int tap1 -- \
set Interface tap1 external-ids:iface-id=sw0-port2

ovn-nbctl lswitch-add sw1
ovn-nbctl lport-add sw1 sw1-port1
ovn-nbctl lport-add sw1 sw1-port2
ovn-nbctl lport-set-macs sw1-port1 00:00:00:00:00:03
ovn-nbctl lport-set-macs sw1-port2 00:00:00:00:00:04
ovs-vsctl add-port br-int tap2 -- \
set Interface tap2 external-ids:iface-id=sw1-port1
ovs-vsctl add-port br-int tap3 -- \
set Interface tap3 external-ids:iface-id=sw1-port2

tap0, tap1, tap2 and tap3 are the physical network interfaces attached to the VMs.
The issue is all the VMs are added to same network even though they belongs different logical network. There is no vlan tag /tunneling configured to any of these ports whatsoever.
I confirmed that the Southbound DB has populated correctly with the two set of  logical datapath rules, but its not getting populated at the forwarding path.
I am using Ubuntu with kernel 3.13 and OVN compiled from origin/ovn branch.

My north bound configuration can be seen below.

sugesh at silpixa00389816:~/repo/OVN# ovn-nbctl show
    lswitch 7816e518-7ea0-48df-aae6-0e0b8e9f87fc (sw0)
        lport sw0-port2
            macs: 00:00:00:00:00:02
        lport sw0-port1
            macs: 00:00:00:00:00:01
    lswitch 40c94a0e-c93d-4f5b-b9df-0330ad5cb5f8 (sw1)
        lport sw1-port1
            macs: 00:00:00:00:00:03
        lport sw1-port2
            macs: 00:00:00:00:00:04

It seems to me like the ovn-controller cannot access the OVN_Southbound DB (the controller logs message shows "2015-07-10T10:45:15.771Z|00031|main|INFO|OVN OVSDB remote not specified.  Waiting...") to configure the OVS.
I started the controller and northd with following commands which doesn't take any argument as such.
ovn-ctl start_northd
ovn-ctl start_controller

Could someone help me out to figure out what has been configured wrongly here??




Regards
_Sugesh

--------------------------------------------------------------
Intel Shannon Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263
Business address: Dromore House, East Park, Shannon, Co. Clare

This e-mail and any attachments may contain confidential material for the sole use of the intended recipient(s). Any review or distribution by others is strictly prohibited. If you are not the intended recipient, please contact the sender and delete all copies.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150710/ac8cda8e/attachment-0001.html>

From yszhou4tech at gmail.com  Fri Jul 10 05:54:03 2015
From: yszhou4tech at gmail.com (Yousong Zhou)
Date: Fri, 10 Jul 2015 20:54:03 +0800
Subject: [ovs-discuss]
	=?utf-8?q?On_TCP=5FCRR_test_setup_in_=22Acceleratin?=
	=?utf-8?q?g_Open_vSwitch_to_=E2=80=9CLudicrous_Speed=E2=80=9D=22?=
In-Reply-To: <CAECwjAi6U4UfYn9itPbciYgUYuwwwXRJCyU=yaaXpVEDbwsrCw@mail.gmail.com>
References: <CAECwjAi6U4UfYn9itPbciYgUYuwwwXRJCyU=yaaXpVEDbwsrCw@mail.gmail.com>
Message-ID: <CAECwjAjQu-2_a_LrkcCBUuG_RMOy-=yTyFGx7ikcZnPsb+u==Q@mail.gmail.com>

On 8 July 2015 at 21:39, Yousong Zhou <yszhou4tech at gmail.com> wrote:
> Hello, list
>
> I am doing some performance tests for the preparation of upgrading
> Open vSwitch from 1.11.0 to 2.3.2.  However, with TCP_CRR, I can only
> achieve about 130k tps (last time I got only 40k because of a .debug
> type kernel), not even close to the reported 680k from the blog post
> [0].  I also found other available reports [1, 2] but those results
> were even worse and not consistent with each other.
>

Hi, I just found the 680k tps TCP_CRR test result in the nsdi2015
paper "The design and implementation of Open vSwitch" [1].  Hmm, the
120k tps in section "Cache layer performance" is similar to what I
have got.  But how were they boosted to 688k for both Linux bridge and
Open vSwitch in section "Comparison to in-kernel switch"?

 [1] https://www.usenix.org/conference/nsdi15/technical-sessions/presentation/pfaff

Regards

                yousong

From davidjoshuaevans at gmail.com  Fri Jul 10 07:55:39 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Fri, 10 Jul 2015 09:55:39 -0500
Subject: [ovs-discuss] custom match layer 3-4
Message-ID: <D1C5471B.2C9C2%davidjoshuaevans@gmail.com>

Hi Ben & Co,

I¹m trying to add matches for specific types of GRE protocols as per the
GRE header protocol type.
I have added code in what I think are  in flow.c match.c and odp-util.c
and ofp-util.c etc.

But I don¹t quite get how a mini flow is assembled and matched.

I got a match to add because in miniflow_extract (lib/flow.c)  I push my
field in using miniflow_push_be16(mf, gre_type,gre_type);
BUT when I get to odp_key_from_flow__  I find  data->gre_type is zero in
the incoming flow structure.
So I don¹t get how that is supposed to be populated.

Any pointers? 

(all my work is with userspace dpdk netdev so no netlink to driver or
datapath/flow.c etc involved.)


Warmest Regards and thanks.

Dave.



From john.hurley at netronome.com  Fri Jul 10 07:57:27 2015
From: john.hurley at netronome.com (John Hurley)
Date: Fri, 10 Jul 2015 15:57:27 +0100
Subject: [ovs-discuss] ovs-conntrack action ordering?
In-Reply-To: <CANr6G5xxRCgrunnMeRKVoqu3rzhC6qgfLDahHKyM=S1fHMuDjQ@mail.gmail.com>
References: <CAK+XE=njXUSy6QpYzowQP6FrGy1qboaC23jfW7+nvxeH-UOoew@mail.gmail.com>
 <CANr6G5xTqCTQmskJ6-qioLNHg5CNdDSqxFVcUe7DXPiuKz40uQ@mail.gmail.com>
 <CAK+XE=kNCFUdeqp3vu5BHWQ9N9wsXHTDFNU2K86eMV5k5qY_iw@mail.gmail.com>
 <CANr6G5w8huEGRwsfQ85bsnQKzaT9J5CO1_m8RUm5HQ-BzCBLnA@mail.gmail.com>
 <CANr6G5xxRCgrunnMeRKVoqu3rzhC6qgfLDahHKyM=S1fHMuDjQ@mail.gmail.com>
Message-ID: <CAK+XE=kR+hLLDtcazkVEMD6pEnPKr7qr9bPZQ1i672mGYx6jDQ@mail.gmail.com>

Good stuff, Thanks

On Fri, Jul 10, 2015 at 8:03 AM, Joe Stringer <joestringer at nicira.com>
wrote:

> On 25 June 2015 at 03:23, Joe Stringer <joestringer at nicira.com> wrote:
> > Good example. I agree that the ovs conntrack support should consider
> > the ordering this way. Setting conn_mark/conn_label is also relevant
> > to this, as they are currently done via commit_odp_actions(). So they
> > cannot be done before conntrack() action. This was already how we were
> > thinking about these commands, and perhaps their ordering should also
> > be enforced by OpenFlow.
> >
> > Right, the commit call is what I was looking for. I'll roll this
> > change into the series soon and start testing with it, see what comes
> > up. Perhaps the datapath flow translation like this would be a good
> > test case for the kernel module testsuite too.
> >
> > Thanks,
> > Joe
>
> FWIW this went smoothly and the fix should be present in the latest
> branch. Thanks for the suggestion!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150710/3ffbb1b6/attachment.html>

From shettyg at nicira.com  Fri Jul 10 08:01:33 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 10 Jul 2015 08:01:33 -0700
Subject: [ovs-discuss] Issues with configuring multitenant network using
	OVN.
In-Reply-To: <2EF2F5C0CC56984AA024D0B180335FCB8387BE@IRSMSX102.ger.corp.intel.com>
References: <2EF2F5C0CC56984AA024D0B180335FCB8387BE@IRSMSX102.ger.corp.intel.com>
Message-ID: <CAHbON5qMNLpPLDSx1zKMm3TuZAj9i8eFfnBgB-+CFnhGBxRnww@mail.gmail.com>

> It seems to me like the ovn-controller cannot access the OVN_Southbound DB
> (the controller logs message shows
> “2015-07-10T10:45:15.771Z|00031|main|INFO|OVN OVSDB remote not specified.
> Waiting...”) to configure the OVS.
>
> I started the controller and northd with following commands which doesn’t
> take any argument as such.
>
> ovn-ctl start_northd
>
> ovn-ctl start_controller
>
before your start your controller, you need to set some information in
the database for the controller to read.

'man ovn-controller' has more information.

A non-official working vagrant if you would like to look at is here:
https://github.com/shettyg/ovn-docker/tree/master/vagrant


>
>
> Could someone help me out to figure out what has been configured wrongly
> here??
>
>
>
>
>
>
>
>
>
> Regards
>
> _Sugesh
>
>
>
> --------------------------------------------------------------
> Intel Shannon Limited
> Registered in Ireland
> Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
> Registered Number: 308263
> Business address: Dromore House, East Park, Shannon, Co. Clare
>
> This e-mail and any attachments may contain confidential material for the
> sole use of the intended recipient(s). Any review or distribution by others
> is strictly prohibited. If you are not the intended recipient, please
> contact the sender and delete all copies.
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From zhaojun12 at outlook.com  Fri Jul 10 08:16:20 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Fri, 10 Jul 2015 23:16:20 +0800
Subject: [ovs-discuss] openvswitch: module verification failed: signature
 and/or required key missing - tainting kernel
Message-ID: <BAY172-W81FD8FE36ACAB18BAE2E3B29F0@phx.gbl>

Hi, OVS group
I have installed OVS in Amazon EC2 with OS RHEL7.0.
and I create a bridge called OVS-SWITCH, and the only NIC eth0 to the bridge, also configure the IP address and route of OVS-SWITCH.
but as soon as I execute add-port commands, I lose connection with my VM.
Using get system log, I get the following logs:
[ 4.837620] alg: No test for crc32 (crc32-pclmul)[ 5.075279] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready[ 5.523745] gre: GRE over IPv4 demultiplexor driver[ 5.576857] openvswitch: module verification failed: signature and/or required key missing - tainting kernel[ 5.584415] openvswitch: Open vSwitch switching datapath 2.3.2[ 5.648948] device ovs-system entered promiscuous mode[ 5.652820] openvswitch: netlink: Key attribute has unexpected length (type=62, length=4, expected=0).[ 5.663333] device eth0 entered promiscuous mode[ 5.715595] device OVS-SWITCH entered promiscuous modeI wonder what is the reason causing failure in red line? Does the red line has relationship with my lost connection?
Many thanks.

Zhao Jun 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150710/5da02eee/attachment-0001.html>

From blp at nicira.com  Fri Jul 10 08:47:36 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 10 Jul 2015 08:47:36 -0700
Subject: [ovs-discuss] custom match layer 3-4
In-Reply-To: <D1C5471B.2C9C2%davidjoshuaevans@gmail.com>
References: <D1C5471B.2C9C2%davidjoshuaevans@gmail.com>
Message-ID: <20150710154736.GC23335@nicira.com>

On Fri, Jul 10, 2015 at 09:55:39AM -0500, David Evans wrote:
> I¹m trying to add matches for specific types of GRE protocols as per the
> GRE header protocol type.
> I have added code in what I think are  in flow.c match.c and odp-util.c
> and ofp-util.c etc.
> 
> But I don¹t quite get how a mini flow is assembled and matched.
> 
> I got a match to add because in miniflow_extract (lib/flow.c)  I push my
> field in using miniflow_push_be16(mf, gre_type,gre_type);
> BUT when I get to odp_key_from_flow__  I find  data->gre_type is zero in
> the incoming flow structure.
> So I don¹t get how that is supposed to be populated.
> 
> Any pointers? 

The miniflow_extract() code is certainly tricky (I've made multiple
attempts to make it easier to understand, but each time it has hurt
performance so I couldn't commit it), but I don't have a good guess
about what's going wrong.

From kkbrat9 at gmail.com  Fri Jul 10 10:16:21 2015
From: kkbrat9 at gmail.com (Kk Bk)
Date: Fri, 10 Jul 2015 10:16:21 -0700
Subject: [ovs-discuss] docker-ovs question.
Message-ID: <CANuit0qT0ZM4qe4SU9oPp3Q0HHKe5mj5kxvwz67N4nR0nOJeRA@mail.gmail.com>

Found this link on OVS

https://github.com/openvswitch/ovs/blob/master/INSTALL.Docker.md

But i don't find ovs-docker command. OVS version is 2.0.2. Should i upgrade
?

-Bhargav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150710/9abdcade/attachment.html>

From shettyg at nicira.com  Fri Jul 10 10:43:34 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 10 Jul 2015 10:43:34 -0700
Subject: [ovs-discuss] docker-ovs question.
In-Reply-To: <CANuit0qT0ZM4qe4SU9oPp3Q0HHKe5mj5kxvwz67N4nR0nOJeRA@mail.gmail.com>
References: <CANuit0qT0ZM4qe4SU9oPp3Q0HHKe5mj5kxvwz67N4nR0nOJeRA@mail.gmail.com>
Message-ID: <CAHbON5qhgFhNMs7z9qr4n8c4QtySTGXXS7yyhhQEO7152_AYkw@mail.gmail.com>

ovs-docker is only part of yet unreleased OVS 2.4.

OVS 2.5 is expected to have a native integration using Docker's
libnetwork driver.

On Fri, Jul 10, 2015 at 10:16 AM, Kk Bk <kkbrat9 at gmail.com> wrote:
> Found this link on OVS
>
> https://github.com/openvswitch/ovs/blob/master/INSTALL.Docker.md
>
> But i don't find ovs-docker command. OVS version is 2.0.2. Should i upgrade
> ?
>
> -Bhargav
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From iwase.yusuke0 at gmail.com  Thu Jul  9 18:35:14 2015
From: iwase.yusuke0 at gmail.com (Yusuke Iwase)
Date: Fri, 10 Jul 2015 10:35:14 +0900
Subject: [ovs-discuss] OpenFlow1.5 support status of lib.ofp-util
In-Reply-To: <20150709173059.GA10579@nicira.com>
References: <559DFBA8.8020403@gmail.com> <20150709173059.GA10579@nicira.com>
Message-ID: <559F2152.6000901@gmail.com>

Hi Ben,

Thank you for your reply!

On 2015年07月10日 02:30, Ben Pfaff wrote:
> On Thu, Jul 09, 2015 at 01:42:16PM +0900, Yusuke Iwase wrote:
>> I'm developing an OpenFlow controller which supports OpenFlow 1.5.
>> I want to validate my implementation by using the packet data
>> generated by lib.ofp-util.
>>
>> But, unfortunately, some packet data of lib.ofp-util seems not be
>> composed in OpenFlow 1.5 structure.
>> It seems to be version 1.4 or earlier structure.
>> aggregate_stats, flow_removed, packet_out, etc
> 
> OpenFlow 1.4 and 1.5 aren't fully supported, which is why they aren't
> enabled by default.
> 

Thanks, I understood.

If you don't mind, please let us know if there is any plan when to
release OpenFlow 1.5 support?

Best Regards,
Iwase

From iwase.yusuke0 at gmail.com  Fri Jul 10 01:18:57 2015
From: iwase.yusuke0 at gmail.com (Yusuke Iwase)
Date: Fri, 10 Jul 2015 17:18:57 +0900
Subject: [ovs-discuss] OpenFlow1.5 support status of lib.ofp-util
In-Reply-To: <20150710060018.GA23335@nicira.com>
References: <559DFBA8.8020403@gmail.com> <20150709173059.GA10579@nicira.com>
 <559F2152.6000901@gmail.com> <20150710060018.GA23335@nicira.com>
Message-ID: <559F7FF1.9000603@gmail.com>

Hi Ben,

On 2015年07月10日 15:00, Ben Pfaff wrote:
> On Fri, Jul 10, 2015 at 10:35:14AM +0900, Yusuke Iwase wrote:
>> If you don't mind, please let us know if there is any plan when to
>> release OpenFlow 1.5 support?
> 
> You can see a list of the missing features for OpenFlow 1.4 and 1.5 in
> OPENFLOW-1.1+.md in the source tree.  Only a few required features are
> missing, but we don't have volunteers for most of them.  We'd be
> grateful if you want to volunteer to implement any of them.
> 

Thanks, I will check it.

Best Regards,
Iwase

From scherepnin at gmail.com  Fri Jul 10 06:23:47 2015
From: scherepnin at gmail.com (Sergey Cherepnin)
Date: Fri, 10 Jul 2015 16:23:47 +0300
Subject: [ovs-discuss] MPLS push errors
Message-ID: <CA+Nr6-20hJwmYtfeLZkZaXnAr46-X0uZP2cTiMw8yBCD-vr3mw@mail.gmail.com>

Hello,

I try to configure MPLS in ovs 2.3.1 version. I have br0 and the following
open flow rule:

ovs-ofctl add-flow br0
priority=40000,in_port=LOCAL,dl_type=0x0800,nw_dst=118.0.0.2,actions=push_mpls:0x8847,set_mpls_label:255,output:1

I use user space datapath in br0:
ovs-vsctl add-br br0
ovs-vsctl set bridge br0 datapath_type=netdev
ovs-vsctl add-port br0 eth3

ifconfig br0 10.0.0.1
route add -net 118.0.0.0/8 gw 10.0.0.2

When I try the MPLS work and ping over br0 the following error occurs:

ping 118.0.0.2

1970-01-01T20:18:49.689Z|00001|dpif_netdev(handler13)|ERR|internal error
parsing flow mask
skb_priority(0),skb_mark(0/0),in_port(1),eth(src=00:0f:b7:12:03:7a/00:00:00:00:00:00,dst=14:cc:20:00:06:5c/00:00:00:00:00:00),eth_type(0x0800),ipv4(src=
10.0.0.1/0.0.0.0,dst=118.0.0.2/255.255.255.255,proto=1/0,tos=0/0xfc,ttl=64/0xff,frag=no/0xff),icmp(type=8,code=0)
(error)

1970-01-01T20:18:49.689Z|00002|dpif(handler13)|WARN|netdev at ovs-netdev:
failed to put[create] (Invalid argument)
skb_priority(0),skb_mark(0/0),in_port(1),eth(src=00:0f:b7:12:03:7a/00:00:00:00:00:00,dst=14:cc:20:00:06:5c/00:00:00:00:00:00),eth_type(0x0800),ipv4(src=
10.0.0.1/0.0.0.0,dst=118.0.0.2/255.255.255.255,proto=1/0,tos=0/0xfc,ttl=64/0xff,frag=no/0xff),icmp(type=8,code=0),
actions:push_mpls(label=10,tc=0,ttl=64,bos=1,eth_type=0x8847),2

Note, the packets get forwarded as expected with the MPLS label. But how to
avoid the errors above? What wrong in my config?

I also tried:

ovs-ofctl add-flow br0
priority=40001,in_port=LOCAL,dl_type=0x0800,nw_dst=118.0.0.2,actions=push_mpls:0x8847,set_field:20-\>mpls_label,output:1


--
Sergey.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150710/f50c2978/attachment-0001.html>

From abarbadekar at virtela.net  Fri Jul 10 08:11:39 2015
From: abarbadekar at virtela.net (Barbadekar, Anil)
Date: Fri, 10 Jul 2015 15:11:39 +0000
Subject: [ovs-discuss] Cemtos 6.5- Openvswitch 2.3.2 update
Message-ID: <67F0EF41D350C547AEF9ADA277E1938918D0B03E@VSGSNG3-EX-MB1.virtela.cc>

Dear Admins,

We have tried to deploy this openvswitch using following command

rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec


config.status: executing include/openflow/openflow.h.stamp commands
config.status: executing utilities/bugtool/dummy commands
+ /usr/bin/make -C _default/datapath/linux -j4
make: Entering directory `/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux'
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../actions.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../dp_notify.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow_netlink.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow_table.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-gre.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-internal_dev.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-lisp.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-netdev.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-vxlan.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/dev-openvswitch.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/exthdrs_core.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/flex_array.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/flow_dissector.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/gre.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/gso.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/genetlink-openvswitch.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/hash.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/hash-x86.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/ip_tunnels_core.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/netdevice.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/net_namespace.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/reciprocal_div.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/skbuff-openvswitch.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/vxlan.c
ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/utils.c
/usr/bin/make -C /usr/src/kernels/2.6.32-504.23.4.el6.x86_64 M=/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux modules
make[1]: Entering directory `/usr/src/kernels/2.6.32-504.23.4.el6.x86_64'
  CC [M]  /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.o
  CC [M]  /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.o
  CC [M]  /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.o
  CC [M]  /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.o
In file included from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:21:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h: In function 'skb_clear_hash':In file included from include/linux/if_ether.h:130,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/if_ether.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../include/linux/if_ether.h:26,
                 from include/linux/netdevice.h:29,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.c:20:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h: In function 'skb_clear_hash':

/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h:302: error: 'struct sk_buff' has no member named 'l4_rxhash'
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h:302: error: 'struct sk_buff' has no member named 'l4_rxhash'
In file included from include/linux/if_ether.h:130,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/if_ether.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../include/linux/if_ether.h:26,
                 from include/linux/netdevice.h:29,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.c:19:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h: In function 'skb_clear_hash':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h:302: error: 'struct sk_buff' has no member named 'l4_rxhash'
In file included from include/linux/if_ether.h:130,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/if_ether.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../include/linux/if_ether.h:26,
                 from include/linux/netdevice.h:29,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from include/linux/if_arp.h:26,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/if_arp.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:23:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h: In function 'skb_clear_hash':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h:302: error: 'struct sk_buff' has no member named 'l4_rxhash'
In file included from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.c:19:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h: At top level:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:37: error: conflicting types for 'netdev_rx_handler_register'
include/linux/netdevice.h:2204: note: previous declaration of 'netdev_rx_handler_register' was here
In file included from include/linux/if_arp.h:26,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/if_arp.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:23:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h: At top level:
In file included from include/net/sock.h:50,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/sock.h:4,
                 from include/linux/tcp.h:180,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/tcp.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:26:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h: At top level:/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:37: error: conflicting types for 'netdev_rx_handler_register'

/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:37: error: conflicting types for 'netdev_rx_handler_register'
include/linux/netdevice.h:2204: note: previous declaration of 'netdev_rx_handler_register' was here
include/linux/netdevice.h:2204: note: previous declaration of 'netdev_rx_handler_register' was here
In file included from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.c:20:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h: At top level:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:37: error: conflicting types for 'netdev_rx_handler_register'
include/linux/netdevice.h:2204: note: previous declaration of 'netdev_rx_handler_register' was here
make[2]: *** [/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/dp_notify.o] Error 1
make[2]: *** Waiting for unfinished jobs....
make[2]: *** [/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/flow.o] Error 1
make[2]: *** [/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.o] Error 1
make[2]: *** [/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.o] Error 1
make[1]: *** [_module_/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux] Error 2
make[1]: Leaving directory `/usr/src/kernels/2.6.32-504.23.4.el6.x86_64'
make: *** [default] Error 2
make: Leaving directory `/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux'
error: Bad exit status from /var/tmp/rpm-tmp.kPBI0L (%build)


RPM build errors:
    Bad exit status from /var/tmp/rpm-tmp.kPBI0L (%build)
================

openvswitch-2.3.2]# uname -r
2.6.32-504.23.4.el6.x86_64


openvswitch-2.3.2]# cat /etc/redhat-release
CentOS release 6.5 (Final)

Kindly share the bugfix available with this issue.

Regards,
Anil Barbadekar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150710/612d59d7/attachment-0001.html>

From jesse at nicira.com  Fri Jul 10 16:04:50 2015
From: jesse at nicira.com (Jesse Gross)
Date: Fri, 10 Jul 2015 16:04:50 -0700
Subject: [ovs-discuss] Cemtos 6.5- Openvswitch 2.3.2 update
In-Reply-To: <67F0EF41D350C547AEF9ADA277E1938918D0B03E@VSGSNG3-EX-MB1.virtela.cc>
References: <67F0EF41D350C547AEF9ADA277E1938918D0B03E@VSGSNG3-EX-MB1.virtela.cc>
Message-ID: <CAEP_g=-M1=gOXoq5XWu9yRhbBJ7UW0Xpqq64jVLFAVJoEvcMAw@mail.gmail.com>

On Fri, Jul 10, 2015 at 8:11 AM, Barbadekar, Anil
<abarbadekar at virtela.net> wrote:
> Dear Admins,
>
> We have tried to deploy this openvswitch using following command
>
> rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec

There is a patch to fix this that hasn't been reviewed or tested yet.
Can you try cherry picking commit
3d174bfd1a6dc0734f4333385fbcb0dd4dd12df4 ("datapath: compat: Fix build
on RHEL 6.6") and apply this patch:
http://openvswitch.org/pipermail/dev/2015-July/057228.html

And report if it solves the problem?

From gowrishankar.m at linux.vnet.ibm.com  Sat Jul 11 01:07:47 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Sat, 11 Jul 2015 13:37:47 +0530
Subject: [ovs-discuss] [ovs-dpdk] multiqueue support for vhost-user netdev
Message-ID: <55A0CED3.9090508@linux.vnet.ibm.com>

Hello list,

I would like to know if ovs today (master) is ready (or in plan to get 
ready)
to support multiqueue for virtio-net driver with vhost-user backend. 
There is
an upstream dpdk patch which leverages VMDq pool and RSS in NIC and creates
multiqueue per virtio port in guest.

     http://dpdk.org/ml/archives/dev/2015-June/019094.html

As I could not find relevant support in OVS (to start with, no EAL 
option for
--rxq), I guess OVS needs some work to enable the same. Or, does this option
other_config:n-dpdk-rxqs mean the same ?

I may be wrong in my understanding as it is something new for me to 
learn its
operation. Appreciating your suggestion/pointers.

Regards,
Gowri Shankar



From abhishekv.verma at gmail.com  Sun Jul 12 03:47:20 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Sun, 12 Jul 2015 16:17:20 +0530
Subject: [ovs-discuss] One NIC -- one bridge only?
Message-ID: <CADDmorT_ET=fFbhfOKKw7U-NiZcC1f4BtWdXRTwVDbwHCg5gLg@mail.gmail.com>

Hi,

I am running OVS inside a VM. I have only one virtual NIC from which i can
receive traffic. I was trying to do something wherein i create different
GRE tunnels terminating at different VMs based on the result of some
classification done on the incoming packets. You can imagine that i have
packets belonging to different sessions that need to be identified and sent
to a different GRE tunnel.

Given that i have only one NIC from which i can receive packets, i can only
create one bridge right? I say this because its only the bridge in which i
have added this virtual NIC that i will be able to receive packets. I need
to do whatever classification i want inside this bridge and send packets
out on different GRE tunnel ports.

I will however have to be very careful in doing this since all traffic by
default will be flooded to all ports of the bridge. And hence, if i am not
very careful with my flow rules, then i will leak traffic from one session
to the other.

Is my understanding correct here?

Ideally i would like to create a different bridge per session so that
traffic can be isolated. Any ideas on how i can achieve this?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150712/80fbb0af/attachment.html>

From blp at nicira.com  Sun Jul 12 10:40:26 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 12 Jul 2015 10:40:26 -0700
Subject: [ovs-discuss] One NIC -- one bridge only?
In-Reply-To: <CADDmorT_ET=fFbhfOKKw7U-NiZcC1f4BtWdXRTwVDbwHCg5gLg@mail.gmail.com>
References: <CADDmorT_ET=fFbhfOKKw7U-NiZcC1f4BtWdXRTwVDbwHCg5gLg@mail.gmail.com>
Message-ID: <20150712174026.GA19365@nicira.com>

On Sun, Jul 12, 2015 at 04:17:20PM +0530, Abhishek Verma wrote:
> I am running OVS inside a VM. I have only one virtual NIC from which i can
> receive traffic. I was trying to do something wherein i create different
> GRE tunnels terminating at different VMs based on the result of some
> classification done on the incoming packets. You can imagine that i have
> packets belonging to different sessions that need to be identified and sent
> to a different GRE tunnel.
> 
> Given that i have only one NIC from which i can receive packets, i can only
> create one bridge right? I say this because its only the bridge in which i
> have added this virtual NIC that i will be able to receive packets. I need
> to do whatever classification i want inside this bridge and send packets
> out on different GRE tunnel ports.
> 
> I will however have to be very careful in doing this since all traffic by
> default will be flooded to all ports of the bridge. And hence, if i am not
> very careful with my flow rules, then i will leak traffic from one session
> to the other.

GRE tunnel ports don't need to be on (indeed, ordinarily should not be
on) the same bridge as the port that carries the encapsulated traffic.
Thus, you can spread the GRE tunnel ports among as many bridges as you
like.

From superk1947 at gmail.com  Sun Jul 12 21:39:07 2015
From: superk1947 at gmail.com (Super K)
Date: Sun, 12 Jul 2015 21:39:07 -0700
Subject: [ovs-discuss] handling packet from OFPP_LOCAL
In-Reply-To: <CANs9vWRPBVwwD4qttcs_0w=vUzSM3MmDd-1-206UkEaxn6LKdA@mail.gmail.com>
References: <CANs9vWRPBVwwD4qttcs_0w=vUzSM3MmDd-1-206UkEaxn6LKdA@mail.gmail.com>
Message-ID: <CANs9vWTGSPrzp4vDP79nFqR5pKGknOFkE-SEGJ5xT0-JXBUeug@mail.gmail.com>

Hi Guys,

Any help?

Thanks.

On Mon, Jul 6, 2015 at 4:39 PM, Super K <superk1947 at gmail.com> wrote:

> Hello,
>
> I am new to OVS. I am trying to trace through the code to understand it
> better. I programmed a flow to send the packet to LOCAL port.
>
> Where can I see this packet within the code handled? I would like to get
> an handle to the packet to do further processing on it.
>
> Thank you in advance for help.
>
> Thanks
> Kiran
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150712/6969cba8/attachment.html>

From d.reade at Reades.co.uk  Mon Jul 13 01:06:41 2015
From: d.reade at Reades.co.uk (David Reade)
Date: Mon, 13 Jul 2015 09:06:41 +0100
Subject: [ovs-discuss] Traffic Mirroring using XenServer and OpenVSwitch
Message-ID: <0E6E632C7139354E9310905023FAF9CA842C2E9430@L1VS02SBS08.reades.local>

Good morning all!

I am using XenServer 6.5 SP1 with OpenVSwitch 2.1.3 and I need to mirror traffic from the source port (vif2.0) to the destination port (vif13.1). I have enabled promiscuous mode on the PIF and target VIF. Using the following command, I can enable traffic mirroring and see the results instantly:

ovs-vsctl -- set Bridge xenbr1 mirrors=@m \
-- --id=@vif2.0 get Port vif2.0 \
-- --id=@vif13.1 get Port vif13.1 \
-- --id=@m create Mirror name=MyMirror select-all=true output-port=@vif13.1

However the port information changes every time the source/target VM is rebooted. This means I have to keep re-adding the mirror every time I reboot a VM using different VIFs which is not practical.

I have devised a way to get the current VIF ID and send it to OVS using a cron job or shell script. However I would prefer to just run a single command without resorting to cron jobs and shell scripts as they need managing themselves.
 
Is there a way to setup traffic mirroring to run permanently which is unaffected by VM reboots?

Thanks in advance,

David

From lxuemei3000 at gmail.com  Mon Jul 13 01:10:07 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Mon, 13 Jul 2015 01:10:07 -0700
Subject: [ovs-discuss] Link static library in ovs
Message-ID: <CA+oJsLN5J3QV8gdV59-tfo6MV17nf=rZVuKUYGV09+LspRXNww@mail.gmail.com>

Hi,

I want to link a static library file (.a file) in ovs, and don't know which
file I should add it into. I found some automake.mk file (e.g., lib/
automake.mk). However, I don't know how to add mine .a file into it. Could
anyone give me some hint?

Thanks,
Xuemei
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/5a2429ec/attachment.html>

From abhishekv.verma at gmail.com  Mon Jul 13 04:23:42 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Mon, 13 Jul 2015 16:53:42 +0530
Subject: [ovs-discuss] open vswitch on AWS EC2
Message-ID: <CADDmorQELFfMRsHja0NGopQDz35zgN+N7VCyc8Y4UygnKQy13w@mail.gmail.com>

Hi,

Has anybody run OVS on Amazon EC2 instance? I lose all connectivity as soon
as i add my default eth0 to an OVS bridge. I created a script that added
eth0 to the default bridge, removed eth0 IP address and assigned the same
IP address to the OVS bridge.

I executed that script and lost connectivity.

Any help here?

For those of you who have not worked on EC2, my question is this:

I access a VM using its IP address accessible using eth0. I am only allowed
to ssh to this VM. Now, i want to add this eth0 to an OVS bridge. As soon
as i add eth0 to OVS, i will lose connectivity since my access to the VM is
using this interface. For this reason i create a script and do as i
described above.

I end up losing connectivity. Any idea on what could be going wrong here?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/ee3c3960/attachment.html>

From zhaojun12 at outlook.com  Mon Jul 13 06:37:42 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Mon, 13 Jul 2015 21:37:42 +0800
Subject: [ovs-discuss] configure openvswitch in Amazon EC2
In-Reply-To: <BAY172-W55C4D0BD8EA0409658726B2920@phx.gbl>
References: <BAY172-W55C4D0BD8EA0409658726B2920@phx.gbl>
Message-ID: <BAY172-W40EBBB8499928ECD8B212DB29C0@phx.gbl>

For your reference.
Using the following commands.
systemctl start openvswitch && killall dhclient && ovs-vsctl add-br OFSWITCH -- set Bridge OFSWITCH other-config:hwaddr=06:a7:ea:7a:1e:11 && ovs-vsctl add-port OFSWITCH eth0 && ifconfig eth0 0.0.0.0 && dhclient OFSWITCH && service network restart
These commands are tested on RHEL7.1 and make sure that setting the MAC address of newly created bridge the same as eht0.
EC2 uses dhcp to assign private address and public address, so you should also using dhcp to acquire IP address for newly created bridge.
Thanks.

Zhao Jun

From: zhaojun12 at outlook.com
To: discuss at openvswitch.org
Subject: configure openvswitch in Amazon EC2
Date: Tue, 7 Jul 2015 21:04:01 +0800




hi, all
i have installed openvswitch-2.3.2 in Amazon EC2, and want to use openvswitch to build a gre tunnel with other PC.
this is the ifconfig output








[root at ip-172-31-30-157 openvswitch]# ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9001
        inet 172.31.30.157  netmask 255.255.240.0  broadcast 172.31.31.255
        inet6 fe80::47b:d1ff:fe65:5a6d  prefixlen 64  scopeid 0x20<link>
        ether 06:7b:d1:65:5a:6d  txqueuelen 1000  (Ethernet)
        RX packets 573591  bytes 200865634 (191.5 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 496014  bytes 101375588 (96.6 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0


lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 0  (Local Loopback)
        RX packets 3669  bytes 1032693 (1008.4 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3669  bytes 1032693 (1008.4 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
and route output
Kernel IP routing tableDestination     Gateway         Genmask         Flags Metric Ref    Use Ifacedefault         ip-172-31-16-1. 0.0.0.0         UG    100    0        0 eth0172.31.16.0     0.0.0.0         255.255.240.0   U     0      0        0 eth0











172.31.16.0     0.0.0.0         255.255.240.0   U     100    0        0 eth0

and i use the following commands
ovs-vsctl add-br OVS-SWITCH && ovs-vsctl add-port OVS-SWITCH eth0 && ifconfig eth0 0 && ifconfig OVS-SWITCH 172.31.30.157 netmask 255.255.240.0 && route add default gw 172.31.16.1 dev OVS-SWITCH
but after i execute these commands, i lose the connection with my ec2.
does anyone have deployed openvswitch in amazon ec2, and could you please give me some suggestions.
Many thanks!

Zhao Jun 		 	   		   		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/75fb95a6/attachment-0001.html>

From zhaojun12 at outlook.com  Mon Jul 13 06:51:33 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Mon, 13 Jul 2015 21:51:33 +0800
Subject: [ovs-discuss] configure openvswitch in Amazon EC2
In-Reply-To: <CADDmorTod3EGYiYhDCGzS8FAkODvCaFTkQh=aZGbib3r8RiOhg@mail.gmail.com>
References: <BAY172-W55C4D0BD8EA0409658726B2920@phx.gbl>,
 <BAY172-W40EBBB8499928ECD8B212DB29C0@phx.gbl>,
 <CADDmorTod3EGYiYhDCGzS8FAkODvCaFTkQh=aZGbib3r8RiOhg@mail.gmail.com>
Message-ID: <BAY172-W15D73F496C72423583FE21B29C0@phx.gbl>

I use the first method.
I also want to create a GRE tunnel between VM in EC2 and a server in my lab.
In EC2 I create a bridge called OFSWITCH, and attach eth0 to it.
I also create a gre port and attach it to OFSWITCH.
It works.

Zhao Jun

Date: Mon, 13 Jul 2015 19:16:44 +0530
Subject: Re: [ovs-discuss] configure openvswitch in Amazon EC2
From: abhishekv.verma at gmail.com
To: zhaojun12 at outlook.com

Thanks Zhao!
I am trying to create a GRE tunnel to connect two VMs in EC2.
I was thinking of putting eth0 in one bridge (OFSWITCH in your example). Then do you create a GRE port on the same bridge or do you create a new bridge and use a OVS port patch to connect the two bridges to be able to send a recv traffic into the VM?
Thanks, Abhishek
On Mon, Jul 13, 2015 at 7:07 PM, 俊 赵 <zhaojun12 at outlook.com> wrote:



For your reference.
Using the following commands.
systemctl start openvswitch && killall dhclient && ovs-vsctl add-br OFSWITCH -- set Bridge OFSWITCH other-config:hwaddr=06:a7:ea:7a:1e:11 && ovs-vsctl add-port OFSWITCH eth0 && ifconfig eth0 0.0.0.0 && dhclient OFSWITCH && service network restart
These commands are tested on RHEL7.1 and make sure that setting the MAC address of newly created bridge the same as eht0.
EC2 uses dhcp to assign private address and public address, so you should also using dhcp to acquire IP address for newly created bridge.
Thanks.


Zhao Jun

From: zhaojun12 at outlook.com
To: discuss at openvswitch.org
Subject: configure openvswitch in Amazon EC2
Date: Tue, 7 Jul 2015 21:04:01 +0800




hi, all
i have installed openvswitch-2.3.2 in Amazon EC2, and want to use openvswitch to build a gre tunnel with other PC.
this is the ifconfig output








[root at ip-172-31-30-157 openvswitch]# ifconfig

eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 9001

        inet 172.31.30.157  netmask 255.255.240.0  broadcast 172.31.31.255

        inet6 fe80::47b:d1ff:fe65:5a6d  prefixlen 64  scopeid 0x20<link>

        ether 06:7b:d1:65:5a:6d  txqueuelen 1000  (Ethernet)

        RX packets 573591  bytes 200865634 (191.5 MiB)

        RX errors 0  dropped 0  overruns 0  frame 0

        TX packets 496014  bytes 101375588 (96.6 MiB)

        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0




lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536

        inet 127.0.0.1  netmask 255.0.0.0

        inet6 ::1  prefixlen 128  scopeid 0x10<host>

        loop  txqueuelen 0  (Local Loopback)

        RX packets 3669  bytes 1032693 (1008.4 KiB)

        RX errors 0  dropped 0  overruns 0  frame 0

        TX packets 3669  bytes 1032693 (1008.4 KiB)

        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0


and route output


Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         ip-172-31-16-1. 0.0.0.0         UG    100    0        0 eth0
172.31.16.0     0.0.0.0         255.255.240.0   U     0      0        0 eth0













172.31.16.0     0.0.0.0         255.255.240.0   U     100    0        0 eth0




and i use the following commands


ovs-vsctl add-br OVS-SWITCH && ovs-vsctl add-port OVS-SWITCH eth0 && ifconfig eth0 0 && ifconfig OVS-SWITCH 172.31.30.157 netmask 255.255.240.0 && route add default gw 172.31.16.1 dev OVS-SWITCH


but after i execute these commands, i lose the connection with my ec2.


does anyone have deployed openvswitch in amazon ec2, and could you please give me some suggestions.


Many thanks!


Zhao Jun 		 	   		   		 	   		  

_______________________________________________

discuss mailing list

discuss at openvswitch.org

http://openvswitch.org/mailman/listinfo/discuss



 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/b88f6300/attachment.html>

From shettyg at nicira.com  Mon Jul 13 07:08:42 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 13 Jul 2015 07:08:42 -0700
Subject: [ovs-discuss] open vswitch on AWS EC2
In-Reply-To: <CADDmorQELFfMRsHja0NGopQDz35zgN+N7VCyc8Y4UygnKQy13w@mail.gmail.com>
References: <CADDmorQELFfMRsHja0NGopQDz35zgN+N7VCyc8Y4UygnKQy13w@mail.gmail.com>
Message-ID: <CAHbON5qFskdVxx-EV=3Y=SYw7eKy6hnrfqQRS6ukUCae-CEU=A@mail.gmail.com>

On Mon, Jul 13, 2015 at 4:23 AM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Hi,
>
> Has anybody run OVS on Amazon EC2 instance? I lose all connectivity as soon
> as i add my default eth0 to an OVS bridge. I created a script that added
> eth0 to the default bridge, removed eth0 IP address and assigned the same IP
> address to the OVS bridge.
>
> I executed that script and lost connectivity.
Did you move your 'route' information from eth0 to OVS bridge?

From hardik.soni at inria.fr  Mon Jul 13 07:43:20 2015
From: hardik.soni at inria.fr (Hardik Soni)
Date: Mon, 13 Jul 2015 16:43:20 +0200 (CEST)
Subject: [ovs-discuss] ovs openflow bridge client TCP port towards the
	controller
In-Reply-To: <1329645681.3048939.1436798091497.JavaMail.zimbra@inria.fr>
Message-ID: <846149925.3049652.1436798600272.JavaMail.zimbra@inria.fr>

Hi All, 

Is there anyway using any ovs utilities to get the client tcp port through which the Openflow bridge is connected to the controller in the network? 
I can do netstat and all, but searching for some straight-forward better way. 
I might have multiple openflow bridges running. 

Thanks, 
Hardik Soni 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/dd21ea69/attachment.html>

From jesse at nicira.com  Mon Jul 13 07:58:38 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 13 Jul 2015 07:58:38 -0700
Subject: [ovs-discuss] Cemtos 6.5- Openvswitch 2.3.2 update
In-Reply-To: <67F0EF41D350C547AEF9ADA277E1938918D0B55F@VSGSNG3-EX-MB1.virtela.cc>
References: <67F0EF41D350C547AEF9ADA277E1938918D0B03E@VSGSNG3-EX-MB1.virtela.cc>
 <CAEP_g=-M1=gOXoq5XWu9yRhbBJ7UW0Xpqq64jVLFAVJoEvcMAw@mail.gmail.com>
 <67F0EF41D350C547AEF9ADA277E1938918D0B55F@VSGSNG3-EX-MB1.virtela.cc>
Message-ID: <CAEP_g=-R7oLeeg3Upyp+4Vkbu9TLUgubF-GnqKVcumEj5B6deA@mail.gmail.com>

You can apply patches from email using "git am".

On Monday, July 13, 2015, Barbadekar, Anil <abarbadekar at virtela.net> wrote:

> Hi Jesse,
>
> We do not have steps to applying this patch. It will be nice if you share
> those steps.
>
> Regards,
> Anil Barbadekar
>
> -----Original Message-----
> From: Jesse Gross [mailto:jesse at nicira.com <javascript:;>]
> Sent: 11 July 2015 04:35
> To: Barbadekar, Anil
> Cc: bugs at openvswitch.org <javascript:;>
> Subject: Re: [ovs-discuss] Cemtos 6.5- Openvswitch 2.3.2 update
>
> On Fri, Jul 10, 2015 at 8:11 AM, Barbadekar, Anil <abarbadekar at virtela.net
> <javascript:;>> wrote:
> > Dear Admins,
> >
> > We have tried to deploy this openvswitch using following command
> >
> > rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec
>
> There is a patch to fix this that hasn't been reviewed or tested yet.
> Can you try cherry picking commit
> 3d174bfd1a6dc0734f4333385fbcb0dd4dd12df4 ("datapath: compat: Fix build on
> RHEL 6.6") and apply this patch:
> http://openvswitch.org/pipermail/dev/2015-July/057228.html
>
> And report if it solves the problem?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/68199d3a/attachment-0001.html>

From ciara.loftus at intel.com  Mon Jul 13 08:58:10 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Mon, 13 Jul 2015 15:58:10 +0000
Subject: [ovs-discuss] [ovs-dpdk] multiqueue support for vhost-user
 netdev
In-Reply-To: <55A0CED3.9090508@linux.vnet.ibm.com>
References: <55A0CED3.9090508@linux.vnet.ibm.com>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC225EC113A@IRSMSX106.ger.corp.intel.com>

> 
> Hello list,
> 
> I would like to know if ovs today (master) is ready (or in plan to get
> ready)
> to support multiqueue for virtio-net driver with vhost-user backend.
At the moment multiqueue support is not available in OVS for vHost.
If it becomes available in an official DPDK release, we can look to provide the functionality in OVS too.

> There is
> an upstream dpdk patch which leverages VMDq pool and RSS in NIC and
> creates
> multiqueue per virtio port in guest.
> 
>      http://dpdk.org/ml/archives/dev/2015-June/019094.html
> 
> As I could not find relevant support in OVS (to start with, no EAL
> option for
> --rxq), I guess OVS needs some work to enable the same. Or, does this
> option
> other_config:n-dpdk-rxqs mean the same ?
> 
> I may be wrong in my understanding as it is something new for me to
> learn its
> operation. Appreciating your suggestion/pointers.
> 
> Regards,
> Gowri Shankar
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From zhunatuzi at gmail.com  Sun Jul 12 19:14:48 2015
From: zhunatuzi at gmail.com (Na Zhu)
Date: Mon, 13 Jul 2015 10:14:48 +0800
Subject: [ovs-discuss] ovs-dpdk performance is not good
Message-ID: <CABDe9TyYE1Z03kX6DkpkSHDw0=xoHj2--+nHwb-r=fxshY6w_Q@mail.gmail.com>

Dear all,

I want to use ovs-dpdk to improve my nfv performance. But when i compare
the throughput between standard ovs and ovs-dpdk, the ovs is better, does
anyone know why?

I use netperf to test the throughput.
use vhost-net to test standard ovs.
use vhost-user to test ovs-dpdk.
My topology is as follow:

[image: 内嵌图片 1]

The result is that standard ovs performance is better. Throughput unit Mbps.
[image: 内嵌图片 2]

[image: 内嵌图片 3]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/e679eae8/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 3285 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/e679eae8/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 8571 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/e679eae8/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 3929 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150713/e679eae8/attachment-0005.png>

From abarbadekar at virtela.net  Mon Jul 13 01:36:49 2015
From: abarbadekar at virtela.net (Barbadekar, Anil)
Date: Mon, 13 Jul 2015 08:36:49 +0000
Subject: [ovs-discuss] Cemtos 6.5- Openvswitch 2.3.2 update
In-Reply-To: <CAEP_g=-M1=gOXoq5XWu9yRhbBJ7UW0Xpqq64jVLFAVJoEvcMAw@mail.gmail.com>
References: <67F0EF41D350C547AEF9ADA277E1938918D0B03E@VSGSNG3-EX-MB1.virtela.cc>
 <CAEP_g=-M1=gOXoq5XWu9yRhbBJ7UW0Xpqq64jVLFAVJoEvcMAw@mail.gmail.com>
Message-ID: <67F0EF41D350C547AEF9ADA277E1938918D0B55F@VSGSNG3-EX-MB1.virtela.cc>

Hi Jesse,

We do not have steps to applying this patch. It will be nice if you share those steps.

Regards,
Anil Barbadekar

-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com] 
Sent: 11 July 2015 04:35
To: Barbadekar, Anil
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] Cemtos 6.5- Openvswitch 2.3.2 update

On Fri, Jul 10, 2015 at 8:11 AM, Barbadekar, Anil <abarbadekar at virtela.net> wrote:
> Dear Admins,
>
> We have tried to deploy this openvswitch using following command
>
> rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec

There is a patch to fix this that hasn't been reviewed or tested yet.
Can you try cherry picking commit
3d174bfd1a6dc0734f4333385fbcb0dd4dd12df4 ("datapath: compat: Fix build on RHEL 6.6") and apply this patch:
http://openvswitch.org/pipermail/dev/2015-July/057228.html

And report if it solves the problem?

From sugesh.chandran at intel.com  Mon Jul 13 09:58:51 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Mon, 13 Jul 2015 16:58:51 +0000
Subject: [ovs-discuss] Issues with configuring multitenant network using
 OVN.
In-Reply-To: <CAHbON5qMNLpPLDSx1zKMm3TuZAj9i8eFfnBgB-+CFnhGBxRnww@mail.gmail.com>
References: <2EF2F5C0CC56984AA024D0B180335FCB8387BE@IRSMSX102.ger.corp.intel.com>
 <CAHbON5qMNLpPLDSx1zKMm3TuZAj9i8eFfnBgB-+CFnhGBxRnww@mail.gmail.com>
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB838CA6@IRSMSX102.ger.corp.intel.com>

Hi Gurucharan,
Thanks a lot for the information and the link !!
The OF rules are getting populated correctly now.


Regards
_Sugesh

-----Original Message-----
From: Gurucharan Shetty [mailto:shettyg at nicira.com] 
Sent: Friday, July 10, 2015 4:02 PM
To: Chandran, Sugesh
Cc: discuss at openvswitch.org; Mulhall, Kate
Subject: Re: [ovs-discuss] Issues with configuring multitenant network using OVN.

> It seems to me like the ovn-controller cannot access the 
> OVN_Southbound DB (the controller logs message shows 
> "2015-07-10T10:45:15.771Z|00031|main|INFO|OVN OVSDB remote not specified.
> Waiting...") to configure the OVS.
>
> I started the controller and northd with following commands which 
> doesn't take any argument as such.
>
> ovn-ctl start_northd
>
> ovn-ctl start_controller
>
before your start your controller, you need to set some information in the database for the controller to read.

'man ovn-controller' has more information.

A non-official working vagrant if you would like to look at is here:
https://github.com/shettyg/ovn-docker/tree/master/vagrant


>
>
> Could someone help me out to figure out what has been configured 
> wrongly here??
>
>
>
>
>
>
>
>
>
> Regards
>
> _Sugesh
>
>
>
> --------------------------------------------------------------
> Intel Shannon Limited
> Registered in Ireland
> Registered Office: Collinstown Industrial Park, Leixlip, County 
> Kildare Registered Number: 308263 Business address: Dromore House, 
> East Park, Shannon, Co. Clare
>
> This e-mail and any attachments may contain confidential material for 
> the sole use of the intended recipient(s). Any review or distribution 
> by others is strictly prohibited. If you are not the intended 
> recipient, please contact the sender and delete all copies.
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From kevin.traynor at intel.com  Tue Jul 14 05:25:00 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 14 Jul 2015 12:25:00 +0000
Subject: [ovs-discuss] ovs-dpdk performance is not good
In-Reply-To: <CABDe9TyYE1Z03kX6DkpkSHDw0=xoHj2--+nHwb-r=fxshY6w_Q@mail.gmail.com>
References: <CABDe9TyYE1Z03kX6DkpkSHDw0=xoHj2--+nHwb-r=fxshY6w_Q@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F745190437@IRSMSX104.ger.corp.intel.com>


From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Na Zhu
Sent: Monday, July 13, 2015 3:15 AM
To: bugs at openvswitch.org
Subject: [ovs-discuss] ovs-dpdk performance is not good

Dear all,

I want to use ovs-dpdk to improve my nfv performance. But when i compare the throughput between standard ovs and ovs-dpdk, the ovs is better, does anyone know why?

I use netperf to test the throughput.
use vhost-net to test standard ovs.
use vhost-user to test ovs-dpdk.
My topology is as follow:

[内嵌图片 1]

The result is that standard ovs performance is better. Throughput unit Mbps.
[内嵌图片 2]

[内嵌图片 3]


[kt] I would check your core affinitization to ensure that the vswitchd
pmd is on a separate core to the vCPUs (set with other_config:pmd-cpu-mask).
Also, this test is not using the DPDK vitrio PMD in the guest which provides
performance gains.

What packet sizes are you using? you should see a greater gain from DPDK
at lower packet sizes (i.e. more PPS)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/23f8f422/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 16645 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/23f8f422/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 11447 bytes
Desc: image004.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/23f8f422/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 9044 bytes
Desc: image006.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/23f8f422/attachment-0005.png>

From gowrishankar.m at linux.vnet.ibm.com  Tue Jul 14 06:00:06 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Tue, 14 Jul 2015 18:30:06 +0530
Subject: [ovs-discuss] ovs-dpdk performance is not good
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F745190437@IRSMSX104.ger.corp.intel.com>
References: <CABDe9TyYE1Z03kX6DkpkSHDw0=xoHj2--+nHwb-r=fxshY6w_Q@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F745190437@IRSMSX104.ger.corp.intel.com>
Message-ID: <55A507D6.8010703@linux.vnet.ibm.com>

What I realised while I too observed similar lower perf with dpdk was, 
because of TSO.

In case of VM just launched with virtio-net driver, most of segmentation 
offload
settings are turned on and notably TSO. Due to this, tcp could throttle 
for larger
segment even more than mtu 1500 (i.e 1448 data). Where as, in case of 
vhost-net
offloaded through vhost-user, it seems TSO is fixed as "off" and can not 
be turned on.
This limits tcp segment length not to exceed mtu. This also means, DPDK 
would gain
on lower packet sizes (as shown below).

I disabled TSO in LINUX BR and OVS (2.3.1) scenarios and we see 
ovs-dpdk's winning
figures. But that need not be preferable way of launching guests on 
vhost-net normally.

Here are my observations:

      LINUX BR   OVS (v2.3.1)   1xPMD    4xPMD    8xPMD

BW   6599         6367            2409     2270      1642
RR   1674         1830            13296     14680      12541

<AFTER DISABLING TSO IN VHOST-NET>

BW   1326         1507            2409     2270      1642
RR   1597         1830            13296     14680      12541

I had taken care of isolating cpus to run PMD threads as above. Earlier, 
there was some
suggestions on other alternatives to do with MTU.

https://www.mail-archive.com/discuss at openvswitch.org/msg13912.html

It may help. Then I thought of making use of upstream multiqueue support 
in dpdk but
it seems not yet supported yet in ovs. I am also curious to find 
ovs-dpdk tuned for more
perf than ovs.

Regards,
Gowrishankar

On Tuesday 14 July 2015 05:55 PM, Traynor, Kevin wrote:
>
> *From:*discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of 
> *Na Zhu
> *Sent:* Monday, July 13, 2015 3:15 AM
> *To:* bugs at openvswitch.org
> *Subject:* [ovs-discuss] ovs-dpdk performance is not good
>
> Dear all,
>
> I want to use ovs-dpdk to improve my nfv performance. But when i 
> compare the throughput between standard ovs and ovs-dpdk, the ovs is 
> better, does anyone know why?
>
> I use netperf to test the throughput.
>
> use vhost-net to test standard ovs.
>
> use vhost-user to test ovs-dpdk.
>
> My topology is as follow:
>
> 内嵌图片 1
>
> The result is that standard ovs performance is better. Throughput unit 
> Mbps.
>
> 内嵌图片 2
>
> 内嵌图片 3
>
> [kt] I would check your core affinitization to ensure that the vswitchd
>
> pmd is on a separate core to the vCPUs (set with 
> other_config:pmd-cpu-mask).
>
> Also, this test is not using the DPDK vitrio PMD in the guest which 
> provides
>
> performance gains.
>
> What packet sizes are you using? you should see a greater gain from DPDK
>
> at lower packet sizes (i.e. more PPS)
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/7438d171/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 16645 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/7438d171/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 11447 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/7438d171/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 9044 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/7438d171/attachment-0005.png>

From abhishekv.verma at gmail.com  Tue Jul 14 07:56:51 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Tue, 14 Jul 2015 20:26:51 +0530
Subject: [ovs-discuss] mod_dl_dst action not working
Message-ID: <CADDmorTQ20x1Ok0ygMuNxkx4ZpyBW13T2HWV2FFAH0ajsSKC_A@mail.gmail.com>

Hi,

I have added a flow rule as follows:

ovs-ofctl add-flow OFSWITCH priority=501,dl_type=0x800,nw_dst=
10.0.0.0/24,actions=output:3,mod_dl_dst:de:ad:ba:be:ba:be

I see that packets entering my bridge with dest_IP 10.0.0.1 hit this flow
rule and go out on the specified port. I however, dont see the the
destination MAC address being updated as expected.

root at akabra:/home/ubuntu#  ovs-ofctl dump-flows OFSWITCH
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=3522.895s, table=0, n_packets=3736, n_bytes=429792,
idle_age=0, priority=0 actions=NORMAL
 cookie=0x0, duration=59.564s, table=0, n_packets=31, n_bytes=3038,
idle_age=24, priority=501,ip,nw_dst=10.0.0.0/24
actions=output:3,mod_dl_dst:de:ad:ba:be:ba:be
root at akabra:/home/ubuntu#

More Information:

root at akabra:/home/ubuntu#  ovs-ofctl show OFSWITCH
OFPT_FEATURES_REPLY (xid=0x2): dpid:00000ab2d52dcd55
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
 1(eth0): addr:0a:b2:d5:2d:cd:55
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 2(veth1): addr:8e:f8:0f:1b:ad:4d
     config:     0
     state:      0
     current:    10GB-FD COPPER
     speed: 10000 Mbps now, 0 Mbps max
 3(gre0): addr:d6:75:ec:16:1f:86
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 LOCAL(OFSWITCH): addr:0a:b2:d5:2d:cd:55
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
root at akabra:/home/ubuntu#

OF port 3 is a GRE tunnel end-point. I expect to see the dest MAC of the
inner payload to get replaced with the MAC that i specify in the flow-rule.

Is there something that i am missing?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/b3f240a8/attachment.html>

From abhishekv.verma at gmail.com  Tue Jul 14 08:07:14 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Tue, 14 Jul 2015 20:37:14 +0530
Subject: [ovs-discuss] mod_dl_dst action not working
In-Reply-To: <CADDmorTQ20x1Ok0ygMuNxkx4ZpyBW13T2HWV2FFAH0ajsSKC_A@mail.gmail.com>
References: <CADDmorTQ20x1Ok0ygMuNxkx4ZpyBW13T2HWV2FFAH0ajsSKC_A@mail.gmail.com>
Message-ID: <CADDmorSkKT1UAa5trye1vLPkWJWzM10mo3MQ+4kHL0TdrW88Aw@mail.gmail.com>

I tried trace and i saw this:

root at akabra:/home/ubuntu# ovs-appctl ofproto/trace OFSWITCH
dl_type=0x800,nw_dst=10.0.0.1
Bridge: OFSWITCH
Flow:
ip,metadata=0,in_port=ANY,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,nw_src=0.0.0.0,nw_dst=10.0.0.1,nw_tos=0,nw_ecn=0,nw_ttl=0
Rule: table=0 cookie=0 priority=501,ip,nw_dst=10.0.0.0/24
OpenFlow actions=output:3,mod_dl_dst:de:ad:ba:be:ba:be

Final flow:
ip,metadata=0,in_port=ANY,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=de:ad:ba:be:ba:be,nw_src=0.0.0.0,nw_dst=10.0.0.1,nw_tos=0,nw_ecn=0,nw_ttl=0
Megaflow: skb_priority=0,ip,in_port=ANY,dl_dst=00:00:00:00:00:00,nw_dst=
10.0.0.0/24,nw_ecn=0,nw_frag=no
Datapath actions:
set(tunnel(tun_id=0x0,src=0.0.0.0,dst=152.27.111.15,tos=0x0,ttl=64,flags(df))),4
root at akabra:/home/ubuntu#

I am sending out a packet with destination IP 10.0.0.1

Any ideas here?

Thanks, Abhishek




On Tue, Jul 14, 2015 at 8:26 PM, Abhishek Verma <abhishekv.verma at gmail.com>
wrote:

> Hi,
>
> I have added a flow rule as follows:
>
> ovs-ofctl add-flow OFSWITCH priority=501,dl_type=0x800,nw_dst=
> 10.0.0.0/24,actions=output:3,mod_dl_dst:de:ad:ba:be:ba:be
>
> I see that packets entering my bridge with dest_IP 10.0.0.1 hit this flow
> rule and go out on the specified port. I however, dont see the the
> destination MAC address being updated as expected.
>
> root at akabra:/home/ubuntu#  ovs-ofctl dump-flows OFSWITCH
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=3522.895s, table=0, n_packets=3736, n_bytes=429792,
> idle_age=0, priority=0 actions=NORMAL
>  cookie=0x0, duration=59.564s, table=0, n_packets=31, n_bytes=3038,
> idle_age=24, priority=501,ip,nw_dst=10.0.0.0/24
> actions=output:3,mod_dl_dst:de:ad:ba:be:ba:be
> root at akabra:/home/ubuntu#
>
> More Information:
>
> root at akabra:/home/ubuntu#  ovs-ofctl show OFSWITCH
> OFPT_FEATURES_REPLY (xid=0x2): dpid:00000ab2d52dcd55
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
> SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>  1(eth0): addr:0a:b2:d5:2d:cd:55
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
>  2(veth1): addr:8e:f8:0f:1b:ad:4d
>      config:     0
>      state:      0
>      current:    10GB-FD COPPER
>      speed: 10000 Mbps now, 0 Mbps max
>  3(gre0): addr:d6:75:ec:16:1f:86
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
>  LOCAL(OFSWITCH): addr:0a:b2:d5:2d:cd:55
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> root at akabra:/home/ubuntu#
>
> OF port 3 is a GRE tunnel end-point. I expect to see the dest MAC of the
> inner payload to get replaced with the MAC that i specify in the flow-rule.
>
> Is there something that i am missing?
>
> Thanks, Abhishek
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/f0d5bf95/attachment.html>

From blp at nicira.com  Tue Jul 14 08:16:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 14 Jul 2015 08:16:17 -0700
Subject: [ovs-discuss] mod_dl_dst action not working
In-Reply-To: <CADDmorTQ20x1Ok0ygMuNxkx4ZpyBW13T2HWV2FFAH0ajsSKC_A@mail.gmail.com>
References: <CADDmorTQ20x1Ok0ygMuNxkx4ZpyBW13T2HWV2FFAH0ajsSKC_A@mail.gmail.com>
Message-ID: <20150714151617.GE31347@nicira.com>

On Tue, Jul 14, 2015 at 08:26:51PM +0530, Abhishek Verma wrote:
> ovs-ofctl add-flow OFSWITCH priority=501,dl_type=0x800,nw_dst=
> 10.0.0.0/24,actions=output:3,mod_dl_dst:de:ad:ba:be:ba:be

Actions are executed in order.  There's no point in modifying the packet
*after* it's been sent.

From sbezverk at cisco.com  Tue Jul 14 12:12:32 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Tue, 14 Jul 2015 19:12:32 +0000
Subject: [ovs-discuss] ovs and wpa supplicant
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216CC73CE@xmb-rcd-x06.cisco.com>

Hello,

I was wondering if somebody is aware of a workaround to make wpa_supplicant working with OVS bridge. I have wpa configured with Linux bridge, which is working fine, but same wpa config with OVS fails. I tried OVS version 2.3.2.

Thank you

Serguei


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/f78cb027/attachment.html>

From blp at nicira.com  Tue Jul 14 15:12:46 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 14 Jul 2015 15:12:46 -0700
Subject: [ovs-discuss]
 =?utf-8?q?On_TCP=5FCRR_test_setup_in_=22Acceleratin?=
 =?utf-8?q?g_Open_vSwitch_to_=E2=80=9CLudicrous_Speed=E2=80=9D=22?=
In-Reply-To: <CAECwjAjQu-2_a_LrkcCBUuG_RMOy-=yTyFGx7ikcZnPsb+u==Q@mail.gmail.com>
References: <CAECwjAi6U4UfYn9itPbciYgUYuwwwXRJCyU=yaaXpVEDbwsrCw@mail.gmail.com>
 <CAECwjAjQu-2_a_LrkcCBUuG_RMOy-=yTyFGx7ikcZnPsb+u==Q@mail.gmail.com>
Message-ID: <20150714221246.GE13347@nicira.com>

On Fri, Jul 10, 2015 at 08:54:03PM +0800, Yousong Zhou wrote:
> On 8 July 2015 at 21:39, Yousong Zhou <yszhou4tech at gmail.com> wrote:
> > Hello, list
> >
> > I am doing some performance tests for the preparation of upgrading
> > Open vSwitch from 1.11.0 to 2.3.2.  However, with TCP_CRR, I can only
> > achieve about 130k tps (last time I got only 40k because of a .debug
> > type kernel), not even close to the reported 680k from the blog post
> > [0].  I also found other available reports [1, 2] but those results
> > were even worse and not consistent with each other.
> >
> 
> Hi, I just found the 680k tps TCP_CRR test result in the nsdi2015
> paper "The design and implementation of Open vSwitch" [1].  Hmm, the
> 120k tps in section "Cache layer performance" is similar to what I
> have got.  But how were they boosted to 688k for both Linux bridge and
> Open vSwitch in section "Comparison to in-kernel switch"?

I think that the configuration we used is described in that paper under
"Cache layer performance":

    In all following tests, Open vSwitch ran on a Linux server with two
    8-core, 2.0 GHz Xeon processors and two Intel 10-Gb NICs. To generate
    many connections, we used Netperf’s TCP CRR test [25], which repeatedly
    establishes a TCP connection, sends and receives one byte of traffic,
    and disconnects.  The results are reported in transactions per second
    (tps).  Netperf only makes one connection attempt at a time, so we ran
    400 Netperf sessions in parallel and reported the sum.

From davidjoshuaevans at gmail.com  Tue Jul 14 15:36:07 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Tue, 14 Jul 2015 17:36:07 -0500
Subject: [ovs-discuss] netdev-dpdk determine lcore on setup
Message-ID: <D1CAF907.2D94E%davidjoshuaevans@gmail.com>

Hi ovs wizards!

Is there a way to determine the lcore for the pmd when configuring a netdev
dpdk interface using netdev_dpdk_set_config()?

Cheers,
Dave.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150714/02a3ea0e/attachment.html>

From yszhou4tech at gmail.com  Tue Jul 14 20:09:43 2015
From: yszhou4tech at gmail.com (Yousong Zhou)
Date: Wed, 15 Jul 2015 11:09:43 +0800
Subject: [ovs-discuss]
	=?utf-8?q?On_TCP=5FCRR_test_setup_in_=22Acceleratin?=
	=?utf-8?q?g_Open_vSwitch_to_=E2=80=9CLudicrous_Speed=E2=80=9D=22?=
In-Reply-To: <20150714221246.GE13347@nicira.com>
References: <CAECwjAi6U4UfYn9itPbciYgUYuwwwXRJCyU=yaaXpVEDbwsrCw@mail.gmail.com>
 <CAECwjAjQu-2_a_LrkcCBUuG_RMOy-=yTyFGx7ikcZnPsb+u==Q@mail.gmail.com>
 <20150714221246.GE13347@nicira.com>
Message-ID: <CAECwjAgmdvSVjAFDYvMk5FcTTT+H85XmRv14-iTRxde1OtMm0w@mail.gmail.com>

Hi

On 15 July 2015 at 06:12, Ben Pfaff <blp at nicira.com> wrote:
> On Fri, Jul 10, 2015 at 08:54:03PM +0800, Yousong Zhou wrote:
>> On 8 July 2015 at 21:39, Yousong Zhou <yszhou4tech at gmail.com> wrote:
>> > Hello, list
>> >
>> > I am doing some performance tests for the preparation of upgrading
>> > Open vSwitch from 1.11.0 to 2.3.2.  However, with TCP_CRR, I can only
>> > achieve about 130k tps (last time I got only 40k because of a .debug
>> > type kernel), not even close to the reported 680k from the blog post
>> > [0].  I also found other available reports [1, 2] but those results
>> > were even worse and not consistent with each other.
>> >
>>
>> Hi, I just found the 680k tps TCP_CRR test result in the nsdi2015
>> paper "The design and implementation of Open vSwitch" [1].  Hmm, the
>> 120k tps in section "Cache layer performance" is similar to what I
>> have got.  But how were they boosted to 688k for both Linux bridge and
>> Open vSwitch in section "Comparison to in-kernel switch"?
>
> I think that the configuration we used is described in that paper under
> "Cache layer performance":
>
>     In all following tests, Open vSwitch ran on a Linux server with two
>     8-core, 2.0 GHz Xeon processors and two Intel 10-Gb NICs. To generate
>     many connections, we used Netperf’s TCP CRR test [25], which repeatedly
>     establishes a TCP connection, sends and receives one byte of traffic,
>     and disconnects.  The results are reported in transactions per second
>     (tps).  Netperf only makes one connection attempt at a time, so we ran
>     400 Netperf sessions in parallel and reported the sum.

I already read that part.  The hardware configuration seems to be
comparable [1].  In our tests 32 netperf instances were more or less
enough to get the 130k tps and we increased the number of netperf
pairs to 127 with no obvious improvement.

But when we read that the performance can be as high as 680k with both
Linux bridge and Open vSwitch, we thought there should be something we
overlooked, e.g. system parameters tuning, kernel configuration.

I noticed that in section "Cache layer performance" the best result
was about 120k tps with all optimisations on.  But the result was more
than 680k tps in section "Comparison to in-kernel switch".  How this
boost was done?

Thanks for the reply.

 [1] https://github.com/yousong/brtest/blob/master/out/yousong-X540-AT2.md


Regards

                yousong

From weihj1999 at gmail.com  Tue Jul 14 20:24:17 2015
From: weihj1999 at gmail.com (Hongjin Wei)
Date: Wed, 15 Jul 2015 11:24:17 +0800
Subject: [ovs-discuss] ovs-vswitchd:
 ovs|15644|odp_util(revalidator_1168)|ERR|mask expected for non-Ethernet II
In-Reply-To: <CANr6G5wzLZ1_rZBfeRuPoqiouKSodeWpgZuz1nfmSVHyxDHM5A@mail.gmail.com>
References: <CAPCEwzB3AqEgem5qgM7ro3kdubC9FZP8z72zL6jrFcjT5RxQpg@mail.gmail.com>
 <CANr6G5wzLZ1_rZBfeRuPoqiouKSodeWpgZuz1nfmSVHyxDHM5A@mail.gmail.com>
Message-ID: <CAPCEwzAFMhi55bSjMXLTV172LAYyf7FLooUH+k+CiNhGbECWgw@mail.gmail.com>

version:
kmod-openvswitch-2.1.2-2
openvswitch-2.1.2-3

2015-07-09 1:38 GMT+08:00 Joe Stringer <joestringer at nicira.com>:

> On 8 July 2015 at 00:26, Hongjin Wei <weihj1999 at gmail.com> wrote:
> >
> >
> > All,
> >
> > In my openstack environment, I used ovs for the network plugin.
> Everything
> > works fine. but I nonitce there are lots of record update in
> > /var/log/message like this:
> > YB-CH242-02  Jun  9 20:17:51 YB-CH242-02 ovs-vswitchd:
> > ovs|15643|odp_util(revalidator_1168)|ERR|Dropped 17 log messages in last
> 60
> > seconds (most recently, 10 secone
> > Jun  9 20:17:51 YB-CH242-02 ovs-vswitchd:
> > ovs|15644|odp_util(revalidator_1168)|ERR|mask expected for non-Ethernet
> II
>
> This message looks truncated, is there any more?
>
> > anyone can tell me how this message means? And what this will impact?
>
> There's a few different possible reasons for this, without
> investigating further it's hard to say.
>
> Can you specify which version of ovs-vswitchd is being used, and which
> openvswitch kernel module?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/e6da322b/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: messages_2t
Type: application/octet-stream
Size: 2368490 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/e6da322b/attachment-0001.obj>

From blp at nicira.com  Tue Jul 14 22:30:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 14 Jul 2015 22:30:17 -0700
Subject: [ovs-discuss]
 =?utf-8?q?On_TCP=5FCRR_test_setup_in_=22Acceleratin?=
 =?utf-8?q?g_Open_vSwitch_to_=E2=80=9CLudicrous_Speed=E2=80=9D=22?=
In-Reply-To: <CAECwjAgmdvSVjAFDYvMk5FcTTT+H85XmRv14-iTRxde1OtMm0w@mail.gmail.com>
References: <CAECwjAi6U4UfYn9itPbciYgUYuwwwXRJCyU=yaaXpVEDbwsrCw@mail.gmail.com>
 <CAECwjAjQu-2_a_LrkcCBUuG_RMOy-=yTyFGx7ikcZnPsb+u==Q@mail.gmail.com>
 <20150714221246.GE13347@nicira.com>
 <CAECwjAgmdvSVjAFDYvMk5FcTTT+H85XmRv14-iTRxde1OtMm0w@mail.gmail.com>
Message-ID: <20150715053017.GB27152@nicira.com>

On Wed, Jul 15, 2015 at 11:09:43AM +0800, Yousong Zhou wrote:
> On 15 July 2015 at 06:12, Ben Pfaff <blp at nicira.com> wrote:
> > On Fri, Jul 10, 2015 at 08:54:03PM +0800, Yousong Zhou wrote:
> >> On 8 July 2015 at 21:39, Yousong Zhou <yszhou4tech at gmail.com> wrote:
> >> > Hello, list
> >> >
> >> > I am doing some performance tests for the preparation of upgrading
> >> > Open vSwitch from 1.11.0 to 2.3.2.  However, with TCP_CRR, I can only
> >> > achieve about 130k tps (last time I got only 40k because of a .debug
> >> > type kernel), not even close to the reported 680k from the blog post
> >> > [0].  I also found other available reports [1, 2] but those results
> >> > were even worse and not consistent with each other.
> >> >
> >>
> >> Hi, I just found the 680k tps TCP_CRR test result in the nsdi2015
> >> paper "The design and implementation of Open vSwitch" [1].  Hmm, the
> >> 120k tps in section "Cache layer performance" is similar to what I
> >> have got.  But how were they boosted to 688k for both Linux bridge and
> >> Open vSwitch in section "Comparison to in-kernel switch"?
> >
> > I think that the configuration we used is described in that paper under
> > "Cache layer performance":
> >
> >     In all following tests, Open vSwitch ran on a Linux server with two
> >     8-core, 2.0 GHz Xeon processors and two Intel 10-Gb NICs. To generate
> >     many connections, we used Netperf’s TCP CRR test [25], which repeatedly
> >     establishes a TCP connection, sends and receives one byte of traffic,
> >     and disconnects.  The results are reported in transactions per second
> >     (tps).  Netperf only makes one connection attempt at a time, so we ran
> >     400 Netperf sessions in parallel and reported the sum.
> 
> I already read that part.  The hardware configuration seems to be
> comparable [1].  In our tests 32 netperf instances were more or less
> enough to get the 130k tps and we increased the number of netperf
> pairs to 127 with no obvious improvement.
> 
> But when we read that the performance can be as high as 680k with both
> Linux bridge and Open vSwitch, we thought there should be something we
> overlooked, e.g. system parameters tuning, kernel configuration.
> 
> I noticed that in section "Cache layer performance" the best result
> was about 120k tps with all optimisations on.  But the result was more
> than 680k tps in section "Comparison to in-kernel switch".  How this
> boost was done?

I am surprised that the paper doesn't seem to clearly address state the
flow table used in each case.  Based on the numbers of datapath flows
and masks listed in Table 1, though, I would guess that the OpenFlow
flow table in this case was sophisticated (that is, several OpenFlow
tables with nontrivial classifications).  I don't recall the exact
experiment setup, but I suspect that we were using the VMware NVP (aka
NSX-MH) controller.

For the comparison to the Linux bridge, though, I imagine that for a
fair comparison we used a simple Open vSwitch flow table (one that just
executes the OpenFlow "normal switching" action), since that is close in
effect to what the Linux bridge does.

If I recall correctly, the main problem we had with that comparison was
test load generation.  I don't think that we maxed out the performance;
with more or more efficient test load generation machines, I think it
could be faster.

From gowrishankar.m at linux.vnet.ibm.com  Wed Jul 15 00:37:32 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Wed, 15 Jul 2015 13:07:32 +0530
Subject: [ovs-discuss] ovs-dpdk performance is not good
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F745190437@IRSMSX104.ger.corp.intel.com>
References: <CABDe9TyYE1Z03kX6DkpkSHDw0=xoHj2--+nHwb-r=fxshY6w_Q@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F745190437@IRSMSX104.ger.corp.intel.com>
Message-ID: <55A60DBC.8070001@linux.vnet.ibm.com>

Hi Kevin,

On Tuesday 14 July 2015 05:55 PM, Traynor, Kevin wrote:
>
> [kt] I would check your core affinitization to ensure that the vswitchd
>
> pmd is on a separate core to the vCPUs (set with 
> other_config:pmd-cpu-mask).
>

I hope you mean host CPUs. Is that right ?

> Also, this test is not using the DPDK vitrio PMD in the guest which 
> provides
>
> performance gains.
>

In the above topology, VM1-VM2 communication happens within same host.
So, would that still require dpdk virtio pmd ? But, VM1 has to also 
communicate
with VM3 (in remote host). How can we address flow rules related to VM1 
for both
the cases ?

I'm also trying to understand if dpdk virtio pmd can support overlay 
tunnel ?
Currently, in test, I made use of ovs integration bridge to connect 
vhost-user netdev
and vxlan port, and then through external ovs bridge connecting dpdk0 
port.  Would
that not be required incase of virtio pmd driver case ?

Appreciating your help to more understand on this perf problem.

Regards,
Gowrishankar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/a37e06ff/attachment.html>

From ian.stokes at intel.com  Wed Jul 15 03:49:58 2015
From: ian.stokes at intel.com (Stokes, Ian)
Date: Wed, 15 Jul 2015 10:49:58 +0000
Subject: [ovs-discuss] OVS segmentation fault due to incorrect TX queue
 setup with netdev-dpdk
Message-ID: <CD7C01071941AC429549C17338DB8A526AC49E13@IRSMSX101.ger.corp.intel.com>

Hi All,

I've been investigating a segmentation fault caused by the incorrect setup of TX queues for netdev-dpdk. It occurs in the following scenario.

Running OVS with DPDK on a system with 72 cores (Hyper threading enabled) and using an Intel XL710 Network Card.

Default behavior in OVS when adding a DPDK physical port is to attempt to setup 1 tx queue for each core detected on the system plus one more queue for non_pmd threads.

In this case 73 tx queues will be requested in total.

The standard behavior when initializing a DPDK port is to check the number of queues being requested against the max number of queues available for the device itself.

This is done in dpdk_eth_dev_init() with the following code segment
...
    rte_eth_dev_info_get(dev->port_id, &info);
    dev->up.n_rxq = MIN(info.max_rx_queues, dev->up.n_rxq);
    dev->real_n_txq = MIN(info.max_tx_queues, dev->up.n_txq);

    diag = rte_eth_dev_configure(dev->port_id, dev->up.n_rxq, dev->real_n_txq, &port_conf);
...

The smaller of the two values is selected as the real amount of tx queues that can be setup. This accommodates a situation where we could have more cores on a system than we have tx queues on the network device in DPDK.

This has worked fine with the previous generation of Intel interfaces such as Intel 82599. However it will not work with the XL710.

In DPDK the XL710 has a total of 316 tx queues that can be used. From the check above we would think we can allocate 73 of these tx queues without issue. But the 316 queues available are subdivided between different queue types.

For a DPDK host application (In this case OVS) queues 1 - 64 inclusive can be used. However queue 65 to 96 are strictly for SRIOV tx queue use.

The check for max_tx_queues above will identify the total number of queues available (316), compare it to the number of queues being requested (73) and will select 73 as the real_n_txq. But this is not the correct number of tx queues that are usable by OVS (64).

We can cause the switch to segfault by doing the following

Add a dpdk physical port

sudo $OVS_DIR/utilities/ovs-vsctl add-br br0 -- set Bridge br0 datapath_type=netdev
sudo $OVS_DIR/utilities/ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk

This will output the following warning
ovs-vsctl: Error detected while setting up 'dpdk0'.  See ovs-vswitchd log for details.

Looking at the log we see

PMD: i40e_dev_tx_queue_setup(): Using simple tx path
PMD: i40e_pf_get_vsi_by_qindex(): queue_idx out of range. VMDQ configured?
2015-07-15T01:22:48Z|00019|dpdk|ERR|eth dev tx queue setup error -5
2015-07-15T01:22:48Z|00020|dpif_netdev|ERR|dpdk0, cannot set multiq
2015-07-15T01:22:48Z|00021|dpif|WARN|netdev at ovs-netdev: failed to add dpdk0 as port: Resource temporarily unavailable

This is as expected. This warning will be reported in dpdk_eth_dev_init() by the following code segment when it attempts to initialize the 65th queue

    for (i = 0; i < dev->real_n_txq; i++) {
        diag = rte_eth_tx_queue_setup(dev->port_id, i, NIC_PORT_TX_Q_SIZE,
                                      dev->socket_id, NULL);
        if (diag) {
            VLOG_ERR("eth dev tx queue setup error %d",diag);
            return -diag;
        }
    }

Then add an internal port type to the same bridge

sudo $OVS_DIR/utilities/ovs-vsctl add-port br0 testif1 -- set interface testif1 type=internal

I was surprised to see that after adding the internal port , the DPDK port that failed previously is now added as well. Is this expected behavior?
Looking at the vswitch log I can see that both the internal port and the DPDK port have port IDs now.

2015-07-15T01:23:19Z|00024|bridge|INFO|bridge br0: added interface testif1 on port 1
2015-07-15T01:23:19Z|00025|dpif_netdev|INFO|Created 1 pmd threads on numa node 0
2015-07-15T01:23:19Z|00001|dpif_netdev(pmd40)|INFO|Core 0 processing port 'dpdk0'
2015-07-15T01:23:19Z|00002|dpif_netdev(pmd40)|INFO|Core 0 processing port 'dpdk0'
2015-07-15T01:23:19Z|00026|bridge|INFO|bridge br0: added interface dpdk0 on port 2
2015-07-15T01:23:19Z|00027|bridge|INFO|bridge br0: using datapath ID 00006805ca2d3cb8

If we assign an IP to the internal port we will segfault the vswitch
sudo ip addr add 192.168.1.1/24 dev testif1

This is caused by the internal interface broadcasting an ICMP6 neighbor solicitation message. This packet is copied from kernel space memory to DPDK memory in the netdev_dpdk_send__() function.
The issue is that the qid passed to netdev_dpdk_send__ function is 72. This packet will eventually be transmitted with with rte_eth_tx_burst with a tx qid of 72.
In DPDK, queue 72 for the XL710 is for SRIOV use only and so will not be initialized during the rte_eth_tx_queue_setup process above and so the switch segfaults when an attempt is made to access it.


In terms of a solution to this I would appreciate some feedback on what people think is the best approach.

Ideally DPDK could extend the number of sequential queues supported for host DPDK applications.
Previous generation cards supported 128 TX queues that could be used with a host application, hence why this issue is not seen with them.
This however would not fix the immediate issue and would be more of a long term solution. It could be flagged in the documentation as a known issue/corner case that is not supported in the mean time.

Alternatively OVS could attempt to setup as many queues as possible on the DPDK device itself. If an error is detected the appropriate fields would have to be updated such as dev->real_n_txq.
In this case we would setup 64 of the requested 73, log a warning message to the user. However there may be issues with how the pmd threads map to the correct tx queue IDs.
I've noticed that when netdev_dpdk_send__ is called the qid is 72, and this value comes from dp_execute_cb() where the tx_qid is taken from the dp_netdev_pmd_thread.

Any Feedback would be appreciated.

Thanks
Ian




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/7eb769db/attachment-0001.html>

From kevin.traynor at intel.com  Wed Jul 15 09:39:57 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Wed, 15 Jul 2015 16:39:57 +0000
Subject: [ovs-discuss] ovs-dpdk performance is not good
In-Reply-To: <55A60DBC.8070001@linux.vnet.ibm.com>
References: <CABDe9TyYE1Z03kX6DkpkSHDw0=xoHj2--+nHwb-r=fxshY6w_Q@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F745190437@IRSMSX104.ger.corp.intel.com>
 <55A60DBC.8070001@linux.vnet.ibm.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F745193D9C@IRSMSX104.ger.corp.intel.com>



From: gowrishankar [mailto:gowrishankar.m at linux.vnet.ibm.com]
Sent: Wednesday, July 15, 2015 8:38 AM
To: Traynor, Kevin
Cc: Na Zhu; bugs at openvswitch.org
Subject: Re: [ovs-discuss] ovs-dpdk performance is not good

Hi Kevin,

On Tuesday 14 July 2015 05:55 PM, Traynor, Kevin wrote:

[kt] I would check your core affinitization to ensure that the vswitchd
pmd is on a separate core to the vCPUs (set with other_config:pmd-cpu-mask).

I hope you mean host CPUs. Is that right ?

[kt] yes, sorry for the confusion



Also, this test is not using the DPDK vitrio PMD in the guest which provides
performance gains.

In the above topology, VM1-VM2 communication happens within same host.
So, would that still require dpdk virtio pmd ?

[kt] it’s not a requirement to use it, but it should give better performance

But, VM1 has to also communicate
with VM3 (in remote host). How can we address flow rules related to VM1 for both
the cases ?

[kt] you would have different rules for both flows

I'm also trying to understand if dpdk virtio pmd can support overlay tunnel ?
Currently, in test, I made use of ovs integration bridge to connect vhost-user netdev
and vxlan port, and then through external ovs bridge connecting dpdk0 port.  Would
that not be required incase of virtio pmd driver case ?

[kt] The virtio pmd is just a faster transport mechanism to userspace in the
guest using virtio, which in OVS with DPDK context can be used to connect the
guest to dpdkvhostcuse/user ports. Any overlay setup would be independent of it.


Appreciating your help to more understand on this perf problem.

Regards,
Gowrishankar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/42928f9e/attachment.html>

From workbu at 163.com  Tue Jul 14 19:48:41 2015
From: workbu at 163.com (zy)
Date: Wed, 15 Jul 2015 10:48:41 +0800 (CST)
Subject: [ovs-discuss] ovs-vswitchd:
 ovs|15644|odp_util(revalidator_1168)|ERR|mask expected for non-Ethernet II
Message-ID: <216b8690.44ee.14e8f9d35e0.Coremail.workbu@163.com>

The openvswitch 's version show as below:

kmod-openvswitch-2.1.2-2.ibm.el6.x86_64
openvswitch-2.1.2-3.ibm.el6.x86_64

Is there any clue ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/e0e9712f/attachment-0001.html>

From abarbadekar at virtela.net  Wed Jul 15 07:04:08 2015
From: abarbadekar at virtela.net (Barbadekar, Anil)
Date: Wed, 15 Jul 2015 14:04:08 +0000
Subject: [ovs-discuss] Cemtos 6.5- Openvswitch 2.3.2 update
In-Reply-To: <CAEP_g=-R7oLeeg3Upyp+4Vkbu9TLUgubF-GnqKVcumEj5B6deA@mail.gmail.com>
References: <67F0EF41D350C547AEF9ADA277E1938918D0B03E@VSGSNG3-EX-MB1.virtela.cc>
 <CAEP_g=-M1=gOXoq5XWu9yRhbBJ7UW0Xpqq64jVLFAVJoEvcMAw@mail.gmail.com>
 <67F0EF41D350C547AEF9ADA277E1938918D0B55F@VSGSNG3-EX-MB1.virtela.cc>
 <CAEP_g=-R7oLeeg3Upyp+4Vkbu9TLUgubF-GnqKVcumEj5B6deA@mail.gmail.com>
Message-ID: <67F0EF41D350C547AEF9ADA277E1938918D0C204@VSGSNG3-EX-MB1.virtela.cc>

Hi Jesse,

Even after applying this patch & rebuild these packages. We are receiving below error.

ln -s /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/utils.c
/usr/bin/make -C /usr/src/kernels/2.6.32-504.23.4.el6.x86_64 M=/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux modules
make[1]: Entering directory `/usr/src/kernels/2.6.32-504.23.4.el6.x86_64'
  CC [M]  /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.o
In file included from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:21:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h: In function 'skb_clear_hash':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h:302: error: 'struct sk_buff' has no member named 'l4_rxhash'
In file included from include/net/sock.h:50,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/sock.h:4,
                 from include/linux/tcp.h:180,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/tcp.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:26:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h: At top level:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:37: error: conflicting types for 'netdev_rx_handler_register'
include/linux/netdevice.h:2204: note: previous declaration of 'netdev_rx_handler_register' was here
make[2]: *** [/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.o] Error 1
make[1]: *** [_module_/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux] Error 2
make[1]: Leaving directory `/usr/src/kernels/2.6.32-504.23.4.el6.x86_64'
make: *** [default] Error 2
make: Leaving directory `/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux'
error: Bad exit status from /var/tmp/rpm-tmp.lvm4VS (%build)


RPM build errors:
    Bad exit status from /var/tmp/rpm-tmp.lvm4VS (%build)

Regards,
Anil Barbadekar

From: Jesse Gross [mailto:jesse at nicira.com]
Sent: 13 July 2015 20:29
To: Barbadekar, Anil
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] Cemtos 6.5- Openvswitch 2.3.2 update

You can apply patches from email using "git am".

On Monday, July 13, 2015, Barbadekar, Anil <abarbadekar at virtela.net<mailto:abarbadekar at virtela.net>> wrote:
Hi Jesse,

We do not have steps to applying this patch. It will be nice if you share those steps.

Regards,
Anil Barbadekar

-----Original Message-----
From: Jesse Gross [mailto:jesse at nicira.com<javascript:;>]
Sent: 11 July 2015 04:35
To: Barbadekar, Anil
Cc: bugs at openvswitch.org<javascript:;>
Subject: Re: [ovs-discuss] Cemtos 6.5- Openvswitch 2.3.2 update

On Fri, Jul 10, 2015 at 8:11 AM, Barbadekar, Anil <abarbadekar at virtela.net<javascript:;>> wrote:
> Dear Admins,
>
> We have tried to deploy this openvswitch using following command
>
> rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec

There is a patch to fix this that hasn't been reviewed or tested yet.
Can you try cherry picking commit
3d174bfd1a6dc0734f4333385fbcb0dd4dd12df4 ("datapath: compat: Fix build on RHEL 6.6") and apply this patch:
http://openvswitch.org/pipermail/dev/2015-July/057228.html

And report if it solves the problem?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/667c31cf/attachment-0001.html>

From wuhao.thu at gmail.com  Wed Jul 15 15:10:33 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Wed, 15 Jul 2015 15:10:33 -0700
Subject: [ovs-discuss] How to set the best setting to test packet processing
	performance?
Message-ID: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>

Hi,

   I'm using OVS 2.3.0 and testing the packet processing throughput.
Currently, I build a simple network via Mninet which consists of 3 hosts
connecting to 1 ovs instance. Then, I use the 3 hosts send out 64-byte
packets via Tcpreplay, and I measure the packet processing throughput in
OVS and get the result at 750Kpps.

   I want to know is there any method to enhance OVS performance? like
binding multi cores or some other settings? Since I notice the performance
in NSDI 15 paper is several Mpps.

   Any reply is highly appreciated!


+++++++++++++++++
Best,
Hao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/c407b8e6/attachment.html>

From davewaters1970 at gmail.com  Wed Jul 15 22:44:58 2015
From: davewaters1970 at gmail.com (Dave Waters)
Date: Thu, 16 Jul 2015 11:14:58 +0530
Subject: [ovs-discuss] GRE tunnel
Message-ID: <CAARSoVyyfaPD1=pu7NqJSc==t9tY7ypoTswrJFVqErOUNohnig@mail.gmail.com>

Hi,

I am using OVS to send traffic over GRE tunnels. While it works, the data
is sent out with the L2 headers. Is it possible for us to send data inside
the GRE header without the L2 header.

So basically i am looking at a packet going out of my OVS like this.

+---------------------------------------------------------------------------------------------------------+
| L2 hdr | IP Hdr | GRE Header | Inner Payload starting from the IP header |
+----------------------------------------------------------------------------------------------------------+

Regards,
Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/63345fa9/attachment.html>

From vikram.darsi at overturenetworks.com  Thu Jul 16 00:08:38 2015
From: vikram.darsi at overturenetworks.com (Vikram Darsi)
Date: Thu, 16 Jul 2015 07:08:38 +0000
Subject: [ovs-discuss] Assigning IP Address to a created bridge
Message-ID: <BBAF002000CD044DABCA0480EC19B59F02FD55E6@mbx024-e1-nj-2.exch024.domain.local>

Hi



I am a application guy and have a small question on ovs-vsctl command, no idea it is a valid question or not





Why the option of assigning the ip address is not given in ovs-vsctl command? My controller (Open Daylight) supports ovsdb protocol and openflow protocol. using  ovsdb protocol , I am able to create a tunnels but could not find a way to assign ipaddress to the created bridge in the OpenvSwtiches with either of these protocols.



currently, assigning of ip address is external to ovs-vsctl  and using the below the command to set it



ip addr add 10.10.10.221/24 dev br0





No idea, how to perform the above configuration on the created bridge from opendaylight. this can be done with cli only? can you please give me an idea





Thanks

Vikram












This email and attachments may contain privileged or confidential information intended only for the addressee(s) indicated. The sender does not waive any of its rights, privileges or protections respecting this information. If you are not the named addressee, an employee, or agent responsible for sending this message to the named addressee (or this message was received by mistake), you are not authorized to read, print, retain, copy or disseminate this message or any part of it. If received in error, please notify us immediately by e-mail, discard any paper copies and delete all electronic files of the email.

Computer viruses can be transmitted via email. The recipient should check this email and any attachments for viruses. Email transmission cannot be guaranteed to be secured or error-free as information could be intercepted, corrupted, lost, destroyed, arrive late or incomplete, or contain viruses. The sender accepts no liability for any damage caused by any transmitted viruses or errors or omissions in the contents of this message.

Overture Networks, Inc. 637 Davis Drive, Morrisville, NC USA 27560 www.overturenetworks.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/f7516f2a/attachment.html>

From blp at nicira.com  Thu Jul 16 00:20:19 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 16 Jul 2015 00:20:19 -0700
Subject: [ovs-discuss] Assigning IP Address to a created bridge
In-Reply-To: <BBAF002000CD044DABCA0480EC19B59F02FD55E6@mbx024-e1-nj-2.exch024.domain.local>
References: <BBAF002000CD044DABCA0480EC19B59F02FD55E6@mbx024-e1-nj-2.exch024.domain.local>
Message-ID: <20150716072019.GB22655@nicira.com>

On Thu, Jul 16, 2015 at 07:08:38AM +0000, Vikram Darsi wrote:
> I am a application guy and have a small question on ovs-vsctl command, no idea it is a valid question or not
> 
> 
> 
> 
> 
> Why the option of assigning the ip address is not given in ovs-vsctl command? My controller (Open Daylight) supports ovsdb protocol and openflow protocol. using  ovsdb protocol , I am able to create a tunnels but could not find a way to assign ipaddress to the created bridge in the OpenvSwtiches with either of these protocols.
> 
> 
> 
> currently, assigning of ip address is external to ovs-vsctl  and using the below the command to set it
> 
> 
> 
> ip addr add 10.10.10.221/24 dev br0

It's because OVS is only a client of the TCP/IP stack, not the owner of
it.  It makes sense for the OVS database (which ovs-vsctl accesses) to
define bridges and their ports, because OVS defines and owns that state.
But if the OVS database contained IP addresses for each interface, then
what should happen if the system administrator changed the IP address on
an interface by other means?  Should OVS change it back to whatever is
in the database?  (If the database has an empty value, should it delete
the IP address?)  Or should it mirror in the other direction, changing
the database to reflect the kernel state?

At any rate, we don't have any desire for OVS to be the master of the
entire TCP/IP stack.  There's an ecosystem of tools for that already,
and if we tried to supplant them then the community would reject it.

From blp at nicira.com  Thu Jul 16 00:28:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 16 Jul 2015 00:28:29 -0700
Subject: [ovs-discuss] How to set the best setting to test packet
 processing performance?
In-Reply-To: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>
References: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>
Message-ID: <20150716072829.GE22655@nicira.com>

On Wed, Jul 15, 2015 at 03:10:33PM -0700, Hao Wu wrote:
>    I'm using OVS 2.3.0 and testing the packet processing throughput.
> Currently, I build a simple network via Mninet which consists of 3 hosts
> connecting to 1 ovs instance. Then, I use the 3 hosts send out 64-byte
> packets via Tcpreplay, and I measure the packet processing throughput in
> OVS and get the result at 750Kpps.
> 
>    I want to know is there any method to enhance OVS performance? like
> binding multi cores or some other settings? Since I notice the performance
> in NSDI 15 paper is several Mpps.

Have you determined for sure that OVS is the bottleneck in the setup?

From abhishekv.verma at gmail.com  Thu Jul 16 02:27:18 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Thu, 16 Jul 2015 14:57:18 +0530
Subject: [ovs-discuss] Routing at the termination point
Message-ID: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>

Hi,

I am using a GRE tunnel to connect two VMs, VM-A and VM-B. VM-B is
connected to other networks as well.

I want the packets terminating at the GRE tunnel on VM-B, to do an L3
lookup, and to get forwarded based on the result of the L3 lookup.

To do this, i changed the destination MAC at the ingress (on VM-A) to match
the MAC address of one of the ports on VM-B. This way when the packets
emerge from the GRE tunnel, they already have a dest MAC that matches one
of its port MACs. I assumed that because of this the kernel will
automatically do an L3 lookup and will forward the packet out to the right
place. However, this isnt happening, and am wondering why.

I see that i am able to ping the interface if it resides on VM-B. I can
however, not get the VM-B to L3 route that packet out. I want the packet to
be looked up in the L3 kernel table and get forwarded out. Is there
anything that i am missing here.

My configs:

*The packet arrives on a GRE tunnel (port 4) and i hence add a rule which
says that anything arriving on port 4, should undergo normal (L2 and L3)
processing. However, since the dest MAC matches one of the port's MACs, i
expect the packet to undergo L3 processing.*

root@:/home/ubuntu# ovs-ofctl show OFSWITCH
OFPT_FEATURES_REPLY (xid=0x2): dpid:000006451ad21ced
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
 1(eth0): addr:06:45:1a:d2:1c:ed
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 4(gre0): addr:06:48:6f:be:b0:f5
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 LOCAL(OFSWITCH): addr:06:45:1a:d2:1c:ed
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
root@:/home/ubuntu#

root@:/home/ubuntu# ovs-ofctl dump-flows OFSWITCH
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=147000.263s, table=0, n_packets=196105,
n_bytes=117995996, idle_age=0, hard_age=65534, priority=0 actions=NORMAL
 cookie=0x0, duration=1185.832s, table=0, n_packets=62, n_bytes=6076,
idle_age=971, priority=501,in_port=4 actions=NORMAL


Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/7a1a74fd/attachment.html>

From lojakab at cisco.com  Thu Jul 16 03:08:11 2015
From: lojakab at cisco.com (Lori Jakab)
Date: Thu, 16 Jul 2015 13:08:11 +0300
Subject: [ovs-discuss] GRE tunnel
In-Reply-To: <CAARSoVyyfaPD1=pu7NqJSc==t9tY7ypoTswrJFVqErOUNohnig@mail.gmail.com>
References: <CAARSoVyyfaPD1=pu7NqJSc==t9tY7ypoTswrJFVqErOUNohnig@mail.gmail.com>
Message-ID: <55A7828B.1030502@cisco.com>

Hi Dave,

On 7/16/15 8:44 AM, Dave Waters wrote:
> Hi,
>
> I am using OVS to send traffic over GRE tunnels. While it works, the
> data is sent out with the L2 headers. Is it possible for us to send
> data inside the GRE header without the L2 header.
>
> So basically i am looking at a packet going out of my OVS like this.
>
> +---------------------------------------------------------------------------------------------------------+
> | L2 hdr | IP Hdr | GRE Header | Inner Payload starting from the IP
> header |
> +----------------------------------------------------------------------------------------------------------+

I have been working on adding layer 3 flow/packet support in general to
OVS and specifically for LISP tunneling, and based on my work Thomas
Morin (CC) created some patches for GRE. They have not been merged yet,
since I haven't had time to keep up with current developments and get
the kernel part ported to net-next. I will eventually get to it. In the
meantime, you may be able to use Thomas' tree from Github:
https://github.com/tmmorin/openvswitch/tree/grempls_fromloriv9-20150619

HTH,
-Lori

>
> Regards,
> Dave


From kevin.traynor at intel.com  Thu Jul 16 06:45:38 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 16 Jul 2015 13:45:38 +0000
Subject: [ovs-discuss] ovs-dpdk performance is not good
In-Reply-To: <CABDe9TwzvJd0MWOfpkSXS4Dfm-RmxN=F2a_cRup40yqTebhyuA@mail.gmail.com>
References: <CABDe9TyYE1Z03kX6DkpkSHDw0=xoHj2--+nHwb-r=fxshY6w_Q@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F745190437@IRSMSX104.ger.corp.intel.com>
 <CABDe9TwzvJd0MWOfpkSXS4Dfm-RmxN=F2a_cRup40yqTebhyuA@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74519560F@IRSMSX104.ger.corp.intel.com>

(re-adding the ovs-discuss list)

This might be better on the dpdk dev mailing list. For the OVS part, see this thread http://openvswitch.org/pipermail/discuss/2015-July/018095.html

Kevin.

From: Na Zhu [mailto:zhunatuzi at gmail.com]
Sent: Wednesday, July 15, 2015 6:16 AM
To: Traynor, Kevin
Subject: Re: [ovs-discuss] ovs-dpdk performance is not good

Hi Kevin,

The interface MTU is 1500, the TCP message size is 16384 and the UDP message size is 65507.
How to use DPDK virtio PMD?

2015-07-14 20:25 GMT+08:00 Traynor, Kevin <kevin.traynor at intel.com<mailto:kevin.traynor at intel.com>>:

From: discuss [mailto:discuss-bounces at openvswitch.org<mailto:discuss-bounces at openvswitch.org>] On Behalf Of Na Zhu
Sent: Monday, July 13, 2015 3:15 AM
To: bugs at openvswitch.org<mailto:bugs at openvswitch.org>
Subject: [ovs-discuss] ovs-dpdk performance is not good

Dear all,

I want to use ovs-dpdk to improve my nfv performance. But when i compare the throughput between standard ovs and ovs-dpdk, the ovs is better, does anyone know why?

I use netperf to test the throughput.
use vhost-net to test standard ovs.
use vhost-user to test ovs-dpdk.
My topology is as follow:

[内嵌图片 1]

The result is that standard ovs performance is better. Throughput unit Mbps.
[内嵌图片 2]

[内嵌图片 3]


[kt] I would check your core affinitization to ensure that the vswitchd
pmd is on a separate core to the vCPUs (set with other_config:pmd-cpu-mask).
Also, this test is not using the DPDK vitrio PMD in the guest which provides
performance gains.

What packet sizes are you using? you should see a greater gain from DPDK
at lower packet sizes (i.e. more PPS)



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/cd547de8/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 16645 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/cd547de8/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 11447 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/cd547de8/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 9044 bytes
Desc: image003.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/cd547de8/attachment-0005.png>

From athompson at avant.ca  Thu Jul 16 08:16:35 2015
From: athompson at avant.ca (Adam Thompson)
Date: Thu, 16 Jul 2015 10:16:35 -0500
Subject: [ovs-discuss] Multicast UDP on OVSIntPort with active tap
 interface still generates/detects corrupt checksums (v2.3.1)
In-Reply-To: <CAFGv8b-_gxo7y3dQz__-aBW9+-USZRb3_vY5yaPV6bFdYJeqBQ@mail.gmail.com>
References: <CAFGv8b-_gxo7y3dQz__-aBW9+-USZRb3_vY5yaPV6bFdYJeqBQ@mail.gmail.com>
Message-ID: <CAFGv8b_KkR8UWPSE5O2c_ivLxSk4nZRj0a7_H024Rdfp1_Pngw@mail.gmail.com>

I should also have mentioned that only multicast traffic appears to be
affected.  Switching to unicast prevents the error, but swamps the switch &
cluster members with unicast traffic; PVE's unicast mode doesn't scale well
beyond ~4 members.

  [image: Avant logo] *Adam Thompson*
Senior Systems Administrator
*voice:* 204.789.9596 x24 | *email:* athompson at avant.ca | *web:* avant.ca

On Thu, Jul 16, 2015 at 10:13 AM, Adam Thompson <athompson at avant.ca> wrote:

> The problem first reported (as far as I can tell) at
> http://openvswitch.org/pipermail/discuss/2014-May/013856.html still
> occurs.
>
> I'm uncertain whether the problem is in creating the checksums or
> validating them.
>
> Scenario: 9 hosts in a cluster (running Proxmox VE on top of Debian 7.8
> using PVE's backported RHEL7 kernel) that use multicast to talk to each
> other and stay in sync.  Management IP address bound to an OVSIntPort (VLAN
> tagged) through an OVS bridge, then over a two-way LACP-bonded pair to the
> switch and the rest of the cluster.  IGMP is disabled completely in this
> environment.  Various other tap interfaces exist for KVM, some tagged, some
> untagged.
>
> Symptom: A non-deterministic set of cluster members will at some point
> (fairly soon after boot, usually within 15 minutes) begin complaining about
> UDP checksum errors on received packets from peer nodes.
>    This causes the cluster to lose quorum in interesting ways (including
> overlapping but divergent views of cluster membership causing
> quasi-split-brain situations).
>    The UDP checksum error is *only* reported on nodes where VMs are
> currently running, and have created tap interfaces, and (something) was put
> into promiscuous mode (according to dmesg).
>
> Workaround: reboot one or more nodes in the cluster; the first ~10 minutes
> of operation are usually error-free.
>
> Other notes: Dietmar noted in his original report last year that sending
> untagged multicast frames from the OVS Bridge interface itself does not
> trigger this behaviour - I haven't tested this yet.
>   I'm not sure precisely which component is generating the UDP Checksum
> error; I assume the kernel's IP stack (since it shows up in dmesg without
> any annotation) but am not familiar enough with the code to be certain.
>
> Guesses: since it *only* occurs when there are tap interfaces active, I
> would assume that something to do with that code is accidentally mangling
> the incoming packet before the it gets delivered to the logical internal
> interface for handoff to the Linux network stack.
>   Since only *some* of the nodes (given 100% identical hardware, versions,
> drivers, etc.) report the error and *only* when tap interfaces are active,
> I assume the checksum is correct on the wire and that the packet gets
> mangled on input at the receiving node, not on output from the sending node.
>
>
> Other data, as requested by
> https://github.com/openvswitch/ovs/blob/master/REPORTING-BUGS.md:
>
> root at pve1:~# ovs-vswitchd --version
> ovs-vswitchd (Open vSwitch) 2.3.1
> Compiled Dec 27 2014 11:00:44
> OpenFlow versions 0x1:0x1
>
> root at pve1:/var/log# ovs-vsctl show
> 0e3b4265-911c-4e8f-9fae-5a19ab628828
>     Bridge "vmbr0"
>         Port "tap102i0"
>             tag: 158
>             Interface "tap102i0"
>         Port "tap104i0"
>             Interface "tap104i0"
>         Port "vmbr0"
>             Interface "vmbr0"
>                 type: internal
>         Port "tap117i0"
>             Interface "tap117i0"
>         Port "mgmt158"
>             tag: 158
>             Interface "mgmt158"
>                 type: internal
>         Port "tap101i0"
>             tag: 158
>             Interface "tap101i0"
>         Port "ceph157"
>             tag: 157
>             Interface "ceph157"
>                 type: internal
>         Port "tap100i0"
>             Interface "tap100i0"
>         Port "bond0"
>             Interface "eth0"
>             Interface "eth1"
>     ovs_version: "2.3.1"
>
> root at pve1:~# ovs-vswitchd --version
> ovs-vswitchd (Open vSwitch) 2.3.1
> Compiled Dec 27 2014 11:00:44
> OpenFlow versions 0x1:0x1
>
> root at pve1:~# cat /proc/version
> Linux version 3.10.0-10-pve (root at lola) (gcc version 4.7.2 (Debian
> 4.7.2-5) ) #1 SMP Fri May 8 10:33:04 CEST 2015
>
> root at pve1:~# cat /etc/debian_version 7.8
>
> root at pve1:~# cat /proc/version
> Linux version 3.10.0-10-pve (root at lola) (gcc version 4.7.2 (Debian
> 4.7.2-5) ) #1 SMP Fri May 8 10:33:04 CEST 2015
>
> root at pve1:~# cat /etc/openvswitch/conf.db
> OVSDB JSON 11702 23281c151b8d8785fc2f3f3a6620829bd3d9bcf3
> {"tables":{"Port":{"columns":{"name":{"mutable":false,"type":"string"},"qos":{"type":{"key":{"type":"uuid","refTable":"QoS"},"min":0}},"vlan_mode":{"type":{"key":{"type":"string","enum":["set",["access","native-tagged","native-untagged","trunk"]]},"min":0}},"statistics":{"ephemeral":true,"type":{"key":"string","min":0,"value":"integer","max":"unlimited"}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"mac":{"type":{"key":"string","min":0}},"trunks":{"type":{"key":{"maxInteger":4095,"minInteger":0,"type":"integer"},"min":0,"max":4096}},"interfaces":{"type":{"key":{"type":"uuid","refTable":"Interface"},"max":"unlimited"}},"bond_active_slave":{"type":{"key":"string","min":0}},"bond_downdelay":{"type":"integer"},"bond_mode":{"type":{"key":{"type":"string","enum":["set",["active-backup","balance-slb","balance-tcp"]]},"min":0}},"bond_updelay":{"type":"integer"},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"bond_fake_iface":{"type":"boolean"},"tag":{"type":{"key":{"maxInteger":4095,"minInteger":0,"type":"integer"},"min":0}},"fake_bridge":{"type":"boolean"},"lacp":{"type":{"key":{"type":"string","enum":["set",["active","off","passive"]]},"min":0}}},"indexes":[["name"]]},"Manager":{"columns":{"is_connected":{"ephemeral":true,"type":"boolean"},"target":{"type":"string"},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"max_backoff":{"type":{"key":{"minInteger":1000,"type":"integer"},"min":0}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"connection_mode":{"type":{"key":{"type":"string","enum":["set",["in-band","out-of-band"]]},"min":0}},"inactivity_probe":{"type":{"key":"integer","min":0}}},"indexes":[["target"]]},"Bridge":{"columns":{"name":{"mutable":false,"type":"string"},"netflow":{"type":{"key":{"type":"uuid","refTable":"NetFlow"},"min":0}},"flood_vlans":{"type":{"key":{"maxInteger":4095,"minInteger":0,"type":"integer"},"min":0,"max":4096}},"mirrors":{"type":{"key":{"type":"uuid","refTable":"Mirror"},"min":0,"max":"unlimited"}},"datapath_id":{"ephemeral":true,"type":{"key":"string","min":0}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"controller":{"type":{"key":{"type":"uuid","refTable":"Controller"},"min":0,"max":"unlimited"}},"ipfix":{"type":{"key":{"type":"uuid","refTable":"IPFIX"},"min":0}},"protocols":{"type":{"key":{"type":"string","enum":["set",["OpenFlow10","OpenFlow11","OpenFlow12","OpenFlow13","OpenFlow14","OpenFlow15"]]},"min":0,"max":"unlimited"}},"fail_mode":{"type":{"key":{"type":"string","enum":["set",["secure","standalone"]]},"min":0}},"ports":{"type":{"key":{"type":"uuid","refTable":"Port"},"min":0,"max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"flow_tables":{"type":{"key":{"maxInteger":254,"minInteger":0,"type":"integer"},"min":0,"value":{"type":"uuid","refTable":"Flow_Table"},"max":"unlimited"}},"sflow":{"type":{"key":{"type":"uuid","refTable":"sFlow"},"min":0}},"datapath_type":{"type":"string"},"stp_enable":{"type":"boolean"}},"indexes":[["name"]]},"Interface":{"columns":{"name":{"mutable":false,"type":"string"},"options":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"statistics":{"ephemeral":true,"type":{"key":"string","min":0,"value":"integer","max":"unlimited"}},"link_speed":{"ephemeral":true,"type":{"key":"integer","min":0}},"mtu":{"ephemeral":true,"type":{"key":"integer","min":0}},"mac_in_use":{"ephemeral":true,"type":{"key":"string","min":0}},"type":{"type":"string"},"cfm_remote_opstate":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["down","up"]]},"min":0}},"ingress_policing_rate":{"type":{"key":{"minInteger":0,"type":"integer"}}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"mac":{"type":{"key":"string","min":0}},"ofport":{"type":{"key":"integer","min":0}},"ifindex":{"ephemeral":true,"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0}},"cfm_fault_status":{"ephemeral":true,"type":{"key":"string","min":0,"max":"unlimited"}},"duplex":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["full","half"]]},"min":0}},"lacp_current":{"ephemeral":true,"type":{"key":"boolean","min":0}},"cfm_fault":{"ephemeral":true,"type":{"key":"boolean","min":0}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"admin_state":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["down","up"]]},"min":0}},"link_state":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["down","up"]]},"min":0}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"bfd_status":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"cfm_remote_mpids":{"ephemeral":true,"type":{"key":"integer","min":0,"max":"unlimited"}},"cfm_mpid":{"type":{"key":"integer","min":0}},"bfd":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"ofport_request":{"type":{"key":{"maxInteger":65279,"minInteger":1,"type":"integer"},"min":0}},"ingress_policing_burst":{"type":{"key":{"minInteger":0,"type":"integer"}}},"cfm_flap_count":{"type":{"key":"integer","min":0}},"cfm_health":{"ephemeral":true,"type":{"key":{"maxInteger":100,"minInteger":0,"type":"integer"},"min":0}},"link_resets":{"ephemeral":true,"type":{"key":"integer","min":0}}},"indexes":[["name"]]},"SSL":{"columns":{"private_key":{"type":"string"},"ca_cert":{"type":"string"},"bootstrap_ca_cert":{"type":"boolean"},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"certificate":{"type":"string"}},"maxRows":1},"IPFIX":{"columns":{"targets":{"type":{"key":"string","min":0,"max":"unlimited"}},"obs_point_id":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0}},"cache_max_flows":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0}},"cache_active_timeout":{"type":{"key":{"maxInteger":4200,"minInteger":0,"type":"integer"},"min":0}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"obs_domain_id":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0}},"sampling":{"type":{"key":{"maxInteger":4294967295,"minInteger":1,"type":"integer"},"min":0}}}},"Open_vSwitch":{"columns":{"ovs_version":{"type":{"key":"string","min":0}},"system_version":{"type":{"key":"string","min":0}},"bridges":{"type":{"key":{"type":"uuid","refTable":"Bridge"},"min":0,"max":"unlimited"}},"statistics":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"next_cfg":{"type":"integer"},"system_type":{"type":{"key":"string","min":0}},"manager_options":{"type":{"key":{"type":"uuid","refTable":"Manager"},"min":0,"max":"unlimited"}},"db_version":{"type":{"key":"string","min":0}},"ssl":{"type":{"key":{"type":"uuid","refTable":"SSL"},"min":0}},"cur_cfg":{"type":"integer"}},"maxRows":1,"isRoot":true},"Queue":{"columns":{"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"dscp":{"type":{"key":{"maxInteger":63,"minInteger":0,"type":"integer"},"min":0}}},"isRoot":true},"NetFlow":{"columns":{"engine_type":{"type":{"key":{"maxInteger":255,"minInteger":0,"type":"integer"},"min":0}},"targets":{"type":{"key":"string","max":"unlimited"}},"add_id_to_interface":{"type":"boolean"},"active_timeout":{"type":{"key":{"minInteger":-1,"type":"integer"}}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"engine_id":{"type":{"key":{"maxInteger":255,"minInteger":0,"type":"integer"},"min":0}}}},"Controller":{"columns":{"is_connected":{"ephemeral":true,"type":"boolean"},"enable_async_messages":{"type":{"key":"boolean","min":0}},"controller_rate_limit":{"type":{"key":{"minInteger":100,"type":"integer"},"min":0}},"target":{"type":"string"},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"local_netmask":{"type":{"key":"string","min":0}},"local_gateway":{"type":{"key":"string","min":0}},"max_backoff":{"type":{"key":{"minInteger":1000,"type":"integer"},"min":0}},"local_ip":{"type":{"key":"string","min":0}},"connection_mode":{"type":{"key":{"type":"string","enum":["set",["in-band","out-of-band"]]},"min":0}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"role":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["master","other","slave"]]},"min":0}},"inactivity_probe":{"type":{"key":"integer","min":0}},"controller_burst_limit":{"type":{"key":{"minInteger":25,"type":"integer"},"min":0}}}},"QoS":{"columns":{"queues":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0,"value":{"type":"uuid","refTable":"Queue"},"max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"type":{"type":"string"}},"isRoot":true},"Mirror":{"columns":{"name":{"type":"string"},"output_port":{"type":{"key":{"refType":"weak","type":"uuid","refTable":"Port"},"min":0}},"output_vlan":{"type":{"key":{"maxInteger":4095,"minInteger":1,"type":"integer"},"min":0}},"statistics":{"ephemeral":true,"type":{"key":"string","min":0,"value":"integer","max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"select_dst_port":{"type":{"key":{"refType":"weak","type":"uuid","refTable":"Port"},"min":0,"max":"unlimited"}},"select_vlan":{"type":{"key":{"maxInteger":4095,"minInteger":0,"type":"integer"},"min":0,"max":4096}},"select_all":{"type":"boolean"},"select_src_port":{"type":{"key":{"refType":"weak","type":"uuid","refTable":"Port"},"min":0,"max":"unlimited"}}}},"Flow_Sample_Collector_Set":{"columns":{"ipfix":{"type":{"key":{"type":"uuid","refTable":"IPFIX"},"min":0}},"id":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"}}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"bridge":{"type":{"key":{"type":"uuid","refTable":"Bridge"}}}},"isRoot":true,"indexes":[["id","bridge"]]},"sFlow":{"columns":{"polling":{"type":{"key":"integer","min":0}},"header":{"type":{"key":"integer","min":0}},"targets":{"type":{"key":"string","max":"unlimited"}},"agent":{"type":{"key":"string","min":0}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"sampling":{"type":{"key":"integer","min":0}}}},"Flow_Table":{"columns":{"groups":{"type":{"key":"string","min":0,"max":"unlimited"}},"name":{"type":{"key":"string","min":0}},"overflow_policy":{"type":{"key":{"type":"string","enum":["set",["evict","refuse"]]},"min":0}},"prefixes":{"type":{"key":"string","min":0,"max":3}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"flow_limit":{"type":{"key":{"minInteger":0,"type":"integer"},"min":0}}}}},"cksum":"3478940432
> 20717","name":"Open_vSwitch","version":"7.6.2"}
> OVSDB JSON 194 e3568d4c5a38ddbc71f84232f63a364bedcc8650
> {"_date":1436987680725,"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"db_version":"7.6.2"}},"_comment":"ovs-vsctl:
> ovs-vsctl --no-wait -- init -- set Open_vSwitch . db-version=7.6.2"}
> OVSDB JSON 453 ac40dd1f3b81a9dbdbc0667e66b3b64cbddededf
> {"_date":1436987680792,"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"system_version":"unknown","ovs_version":"2.3.1","system_type":"unknown","external_ids":["map",[["system-id","93e4c489-b78c-4a4a-a7ec-ca98916a3e83"]]]}},"_comment":"ovs-vsctl:
> ovs-vsctl --no-wait set Open_vSwitch . ovs-version=2.3.1
> \"external-ids:system-id=\\\"93e4c489-b78c-4a4a-a7ec-ca98916a3e83\\\"\"
> \"system-type=\\\"unknown\\\"\" \"system-version=\\\"unknown\\\"\""}
> OVSDB JSON 567 d156b984f16309e9618a16905da65f3580295198
> {"_date":1436987681022,"Port":{"c0c8331e-354b-436f-be1f-04c785bdb10a":{"name":"vmbr0","interfaces":["uuid","de9d193d-efc0-42de-8f04-81b3d05fd45e"]}},"Interface":{"de9d193d-efc0-42de-8f04-81b3d05fd45e":{"name":"vmbr0","type":"internal"}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"name":"vmbr0","ports":["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"]}},"_comment":"ovs-vsctl:
> ovs-vsctl --timeout=5 -- --may-exist add-br vmbr0
> --","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"bridges":["uuid","6602557a-7e30-4dc7-a5f4-0eca29bfb2f3"],"next_cfg":1}}}
> OVSDB JSON 164 d5f5306c90919a761cb0b31eb6d3d50fbd4c166c
>
> {"_date":1436987681149,"Interface":{"de9d193d-efc0-42de-8f04-81b3d05fd45e":{"ofport":65534}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":1}}}
> OVSDB JSON 764 39f789756c054e4b0a027a67fce078b2746de1c2
> {"_date":1436987681200,"Port":{"4346c2cb-2f68-4a72-9c54-b1c561438eec":{"name":"bond0","bond_mode":"balance-tcp","lacp":"active","interfaces":["set",[["uuid","35537fd4-f5f7-4fba-acf9-0c88748b8990"],["uuid","8f6b0722-7235-4925-994e-0b82b9f8109d"]]],"bond_fake_iface":true}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"ports":["set",[["uuid","4346c2cb-2f68-4a72-9c54-b1c561438eec"],["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"]]]}},"Interface":{"35537fd4-f5f7-4fba-acf9-0c88748b8990":{"name":"eth0"},"8f6b0722-7235-4925-994e-0b82b9f8109d":{"name":"eth1"}},"_comment":"ovs-vsctl:
> ovs-vsctl --timeout=5 -- --fake-iface add-bond vmbr0 bond0 eth0 eth1
> lacp=active bond_mode=balance-tcp
> --","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"next_cfg":2}}}
> OVSDB JSON 212 df73e852a500b8f5f374e047d1685267a8281d12
>
> {"_date":1436987681328,"Interface":{"35537fd4-f5f7-4fba-acf9-0c88748b8990":{"ofport":1},"8f6b0722-7235-4925-994e-0b82b9f8109d":{"ofport":2}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":2}}}
> OVSDB JSON 671 9c43be618258aaeae473e23ba71a71b865e5e958
> {"_date":1436987681856,"Port":{"b1ea8a16-a3ed-4c65-bbaf-d961db7eca32":{"name":"ceph157","interfaces":["uuid","44b1a528-02a4-4371-9290-c6c356b538d5"],"tag":157}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"ports":["set",[["uuid","4346c2cb-2f68-4a72-9c54-b1c561438eec"],["uuid","b1ea8a16-a3ed-4c65-bbaf-d961db7eca32"],["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"]]]}},"Interface":{"44b1a528-02a4-4371-9290-c6c356b538d5":{"name":"ceph157","type":"internal"}},"_comment":"ovs-vsctl:
> ovs-vsctl --timeout=5 -- --may-exist add-port vmbr0 ceph157 tag=157 -- set
> Interface ceph157 type=internal
> --","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"next_cfg":3}}}
> OVSDB JSON 160 947ab8f46acb663a4aeeaff0d09e99e2127791ef
>
> {"_date":1436987681859,"Interface":{"44b1a528-02a4-4371-9290-c6c356b538d5":{"ofport":4}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":3}}}
> OVSDB JSON 719 19d9cfc5b32420c363708790222751665bebb32a
> {"_date":1436987682027,"Port":{"c15ac310-c6f9-427d-a3d3-035296c325a5":{"name":"mgmt158","interfaces":["uuid","a267cf7b-c9cb-44ab-b4cd-1a2903b8f2ca"],"tag":158}},"Interface":{"a267cf7b-c9cb-44ab-b4cd-1a2903b8f2ca":{"name":"mgmt158","type":"internal"}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"ports":["set",[["uuid","4346c2cb-2f68-4a72-9c54-b1c561438eec"],["uuid","b1ea8a16-a3ed-4c65-bbaf-d961db7eca32"],["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"],["uuid","c15ac310-c6f9-427d-a3d3-035296c325a5"]]]}},"_comment":"ovs-vsctl:
> ovs-vsctl --timeout=5 -- --may-exist add-port vmbr0 mgmt158 tag=158 -- set
> Interface mgmt158 type=internal
> --","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"next_cfg":4}}}
> OVSDB JSON 160 e6b463920954ae8b1d63ba60c288f2ee82b2e862
>
> {"_date":1436987682030,"Interface":{"a267cf7b-c9cb-44ab-b4cd-1a2903b8f2ca":{"ofport":5}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":4}}}
> OVSDB JSON 114 4cc9441f8bae008c72cce1e42c2eb842cec66e03
>
> {"Port":{"4346c2cb-2f68-4a72-9c54-b1c561438eec":{"bond_active_slave":"00:a0:d1:ea:a2:85"}},"_date":1436987686331}
> OVSDB JSON 674 2bf2bf53a25e10c1144490609a960855758b158c
> {"_date":1436988249724,"Port":{"55abe05a-e508-4e3d-9971-9cf42b31d552":{"name":"tap100i0","interfaces":["uuid","87b44c4b-8123-4e30-880d-7865fa9cb056"]}},"Interface":{"87b44c4b-8123-4e30-880d-7865fa9cb056":{"name":"tap100i0"}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"ports":["set",[["uuid","4346c2cb-2f68-4a72-9c54-b1c561438eec"],["uuid","55abe05a-e508-4e3d-9971-9cf42b31d552"],["uuid","b1ea8a16-a3ed-4c65-bbaf-d961db7eca32"],["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"],["uuid","c15ac310-c6f9-427d-a3d3-035296c325a5"]]]}},"_comment":"ovs-vsctl:
> /usr/bin/ovs-vsctl add-port vmbr0
> tap100i0","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"next_cfg":5}}}
> OVSDB JSON 160 fe52c4d6b136e32802a3d410319025b46649ed50
>
> {"_date":1436988249725,"Interface":{"87b44c4b-8123-4e30-880d-7865fa9cb056":{"ofport":6}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":5}}}
>
> root at pve1:~# ovs-dpctl show
> system at ovs-system:
> lookups: hit:97368456 missed:4177248 lost:0
> flows: 138
> masks: hit:551673431 total:6 hit/pkt:5.43
> port 0: ovs-system (internal)
> port 1: vmbr0 (internal)
> port 2: eth0
> port 3: eth1
> port 4: bond0 (internal)
> port 5: ceph157 (internal)
> port 6: mgmt158 (internal)
> port 7: tap100i0
>
> root at pve1:~# dmesg|tail
> [70679.622950] UDP: bad checksum. From 192.168.158.38:5404 to
> 239.192.72.34:5405 ulen 83
> [70680.834679] UDP: bad checksum. From 192.168.158.37:5404 to
> 239.192.72.34:5405 ulen 1482
> [70680.836025] UDP: bad checksum. From 192.168.158.34:5404 to
> 239.192.72.34:5405 ulen 821
> [70680.838299] UDP: bad checksum. From 192.168.158.34:5404 to
> 239.192.72.34:5405 ulen 821
> [70680.853189] UDP: bad checksum. From 192.168.158.34:5404 to
> 239.192.72.34:5405 ulen 821
> [70680.854095] UDP: bad checksum. From 192.168.158.34:5404 to
> 239.192.72.34:5405 ulen 821
> [70680.855628] UDP: bad checksum. From 192.168.158.34:5404 to
> 239.192.72.34:5405 ulen 821
> [70680.856488] UDP: bad checksum. From 192.168.158.34:5404 to
> 239.192.72.34:5405 ulen 821
> [70680.857216] UDP: bad checksum. From 192.168.158.34:5404 to
> 239.192.72.34:5405 ulen 821
> [70683.642617] UDP: bad checksum. From 192.168.158.37:5404 to
> 239.192.72.34:5405 ulen 1481
>
>
>
>
>   [image: Avant logo] *Adam Thompson*
> Senior Systems Administrator
> *voice:* 204.789.9596 x24 | *email:* athompson at avant.ca | *web:* avant.ca
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/2bcf1443/attachment-0001.html>

From shyam.pujar at nokia.com  Wed Jul 15 12:18:33 2015
From: shyam.pujar at nokia.com (Pujar, Shyam (Nokia - IN/Bangalore))
Date: Wed, 15 Jul 2015 19:18:33 +0000
Subject: [ovs-discuss] Flooding of packets destined to OVS port's mac address
Message-ID: <54F3CC316BCACF48A126BE3ED38CD1F319B4E84C@SGSIMBX005.nsn-intra.net>

Hi ,
        Please find setup and testing procedure below.



1>      In the above setup, Client Program tries to send packet with src_mac: 3:3:3:3:3:3  and dst_mac: 1:1:1:1:1:1.
2>      Packet is flood to port tap2.
3>      Why does OVS flood packets when dst_mac received is its own port's mac address.
4>      As it forwards to other ports, there is no one to reply for dst_mac other than OVS bridge itself.
5>      Where as in case of Linux bridge, packet is not flooded to other ports. Instead packet is dropped.

   Could you please tell me how do switches in real work? As per my understanding there should be static entries in forwarding table of switch for its own mac addresses.
   And default action should be present for it.


Regards,
Shyam

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/cb96c59d/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Picture (Device Independent Bitmap) 1.jpg
Type: image/jpeg
Size: 18205 bytes
Desc: Picture (Device Independent Bitmap) 1.jpg
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150715/cb96c59d/attachment-0001.jpg>

From takahashi.minoru7 at gmail.com  Wed Jul 15 22:31:10 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Thu, 16 Jul 2015 14:31:10 +0900
Subject: [ovs-discuss] Problem about ofp-util.c
Message-ID: <55A7419E.7010306@gmail.com>

Hi,

Maybe I’ve found a problem on "ofputil_encode_group_desc_request" of ofp-util.c.
According to the OFspec v1.5, the last element of ofp_group_multipart_request has to be filled with zeros.

  /* Body of OFPMP_GROUP_STATS and OFPMP_GROUP_DESC requests. */
      struct ofp_group_multipart_request {
      uint32_t group_id;  /* All groups if OFPG_ALL. */
      uint8_t pad[4];     /* Align to 64 bits. */
  };
  OFP_ASSERT(sizeof(struct ofp_group_multipart_request) == 8);

I’ve checked the source code of "ofputil_encode_group_desc_request", such a process it could not find.

  * ofputil_encode_group_desc_request
  https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L7274-L7279

I guess it should be write in the same way as follows.

  * ofputil_encode_group_stats_request
  https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L7207-L7213

And, I think "ofputil_encode_port_desc_stats_request" also has a similar problem.

  * ofputil_encode_port_desc_stats_request
  https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L4009-L4014

Please confirm if it’s correct.

From athompson at avant.ca  Thu Jul 16 08:13:38 2015
From: athompson at avant.ca (Adam Thompson)
Date: Thu, 16 Jul 2015 10:13:38 -0500
Subject: [ovs-discuss] Multicast UDP on OVSIntPort with active tap interface
 still generates/detects corrupt checksums (v2.3.1)
Message-ID: <CAFGv8b-_gxo7y3dQz__-aBW9+-USZRb3_vY5yaPV6bFdYJeqBQ@mail.gmail.com>

The problem first reported (as far as I can tell) at
http://openvswitch.org/pipermail/discuss/2014-May/013856.html still occurs.

I'm uncertain whether the problem is in creating the checksums or
validating them.

Scenario: 9 hosts in a cluster (running Proxmox VE on top of Debian 7.8
using PVE's backported RHEL7 kernel) that use multicast to talk to each
other and stay in sync.  Management IP address bound to an OVSIntPort (VLAN
tagged) through an OVS bridge, then over a two-way LACP-bonded pair to the
switch and the rest of the cluster.  IGMP is disabled completely in this
environment.  Various other tap interfaces exist for KVM, some tagged, some
untagged.

Symptom: A non-deterministic set of cluster members will at some point
(fairly soon after boot, usually within 15 minutes) begin complaining about
UDP checksum errors on received packets from peer nodes.
   This causes the cluster to lose quorum in interesting ways (including
overlapping but divergent views of cluster membership causing
quasi-split-brain situations).
   The UDP checksum error is *only* reported on nodes where VMs are
currently running, and have created tap interfaces, and (something) was put
into promiscuous mode (according to dmesg).

Workaround: reboot one or more nodes in the cluster; the first ~10 minutes
of operation are usually error-free.

Other notes: Dietmar noted in his original report last year that sending
untagged multicast frames from the OVS Bridge interface itself does not
trigger this behaviour - I haven't tested this yet.
  I'm not sure precisely which component is generating the UDP Checksum
error; I assume the kernel's IP stack (since it shows up in dmesg without
any annotation) but am not familiar enough with the code to be certain.

Guesses: since it *only* occurs when there are tap interfaces active, I
would assume that something to do with that code is accidentally mangling
the incoming packet before the it gets delivered to the logical internal
interface for handoff to the Linux network stack.
  Since only *some* of the nodes (given 100% identical hardware, versions,
drivers, etc.) report the error and *only* when tap interfaces are active,
I assume the checksum is correct on the wire and that the packet gets
mangled on input at the receiving node, not on output from the sending node.


Other data, as requested by
https://github.com/openvswitch/ovs/blob/master/REPORTING-BUGS.md:

root at pve1:~# ovs-vswitchd --version
ovs-vswitchd (Open vSwitch) 2.3.1
Compiled Dec 27 2014 11:00:44
OpenFlow versions 0x1:0x1

root at pve1:/var/log# ovs-vsctl show
0e3b4265-911c-4e8f-9fae-5a19ab628828
    Bridge "vmbr0"
        Port "tap102i0"
            tag: 158
            Interface "tap102i0"
        Port "tap104i0"
            Interface "tap104i0"
        Port "vmbr0"
            Interface "vmbr0"
                type: internal
        Port "tap117i0"
            Interface "tap117i0"
        Port "mgmt158"
            tag: 158
            Interface "mgmt158"
                type: internal
        Port "tap101i0"
            tag: 158
            Interface "tap101i0"
        Port "ceph157"
            tag: 157
            Interface "ceph157"
                type: internal
        Port "tap100i0"
            Interface "tap100i0"
        Port "bond0"
            Interface "eth0"
            Interface "eth1"
    ovs_version: "2.3.1"

root at pve1:~# ovs-vswitchd --version
ovs-vswitchd (Open vSwitch) 2.3.1
Compiled Dec 27 2014 11:00:44
OpenFlow versions 0x1:0x1

root at pve1:~# cat /proc/version
Linux version 3.10.0-10-pve (root at lola) (gcc version 4.7.2 (Debian 4.7.2-5)
) #1 SMP Fri May 8 10:33:04 CEST 2015

root at pve1:~# cat /etc/debian_version 7.8

root at pve1:~# cat /proc/version
Linux version 3.10.0-10-pve (root at lola) (gcc version 4.7.2 (Debian 4.7.2-5)
) #1 SMP Fri May 8 10:33:04 CEST 2015

root at pve1:~# cat /etc/openvswitch/conf.db
OVSDB JSON 11702 23281c151b8d8785fc2f3f3a6620829bd3d9bcf3
{"tables":{"Port":{"columns":{"name":{"mutable":false,"type":"string"},"qos":{"type":{"key":{"type":"uuid","refTable":"QoS"},"min":0}},"vlan_mode":{"type":{"key":{"type":"string","enum":["set",["access","native-tagged","native-untagged","trunk"]]},"min":0}},"statistics":{"ephemeral":true,"type":{"key":"string","min":0,"value":"integer","max":"unlimited"}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"mac":{"type":{"key":"string","min":0}},"trunks":{"type":{"key":{"maxInteger":4095,"minInteger":0,"type":"integer"},"min":0,"max":4096}},"interfaces":{"type":{"key":{"type":"uuid","refTable":"Interface"},"max":"unlimited"}},"bond_active_slave":{"type":{"key":"string","min":0}},"bond_downdelay":{"type":"integer"},"bond_mode":{"type":{"key":{"type":"string","enum":["set",["active-backup","balance-slb","balance-tcp"]]},"min":0}},"bond_updelay":{"type":"integer"},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"bond_fake_iface":{"type":"boolean"},"tag":{"type":{"key":{"maxInteger":4095,"minInteger":0,"type":"integer"},"min":0}},"fake_bridge":{"type":"boolean"},"lacp":{"type":{"key":{"type":"string","enum":["set",["active","off","passive"]]},"min":0}}},"indexes":[["name"]]},"Manager":{"columns":{"is_connected":{"ephemeral":true,"type":"boolean"},"target":{"type":"string"},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"max_backoff":{"type":{"key":{"minInteger":1000,"type":"integer"},"min":0}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"connection_mode":{"type":{"key":{"type":"string","enum":["set",["in-band","out-of-band"]]},"min":0}},"inactivity_probe":{"type":{"key":"integer","min":0}}},"indexes":[["target"]]},"Bridge":{"columns":{"name":{"mutable":false,"type":"string"},"netflow":{"type":{"key":{"type":"uuid","refTable":"NetFlow"},"min":0}},"flood_vlans":{"type":{"key":{"maxInteger":4095,"minInteger":0,"type":"integer"},"min":0,"max":4096}},"mirrors":{"type":{"key":{"type":"uuid","refTable":"Mirror"},"min":0,"max":"unlimited"}},"datapath_id":{"ephemeral":true,"type":{"key":"string","min":0}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"controller":{"type":{"key":{"type":"uuid","refTable":"Controller"},"min":0,"max":"unlimited"}},"ipfix":{"type":{"key":{"type":"uuid","refTable":"IPFIX"},"min":0}},"protocols":{"type":{"key":{"type":"string","enum":["set",["OpenFlow10","OpenFlow11","OpenFlow12","OpenFlow13","OpenFlow14","OpenFlow15"]]},"min":0,"max":"unlimited"}},"fail_mode":{"type":{"key":{"type":"string","enum":["set",["secure","standalone"]]},"min":0}},"ports":{"type":{"key":{"type":"uuid","refTable":"Port"},"min":0,"max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"flow_tables":{"type":{"key":{"maxInteger":254,"minInteger":0,"type":"integer"},"min":0,"value":{"type":"uuid","refTable":"Flow_Table"},"max":"unlimited"}},"sflow":{"type":{"key":{"type":"uuid","refTable":"sFlow"},"min":0}},"datapath_type":{"type":"string"},"stp_enable":{"type":"boolean"}},"indexes":[["name"]]},"Interface":{"columns":{"name":{"mutable":false,"type":"string"},"options":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"statistics":{"ephemeral":true,"type":{"key":"string","min":0,"value":"integer","max":"unlimited"}},"link_speed":{"ephemeral":true,"type":{"key":"integer","min":0}},"mtu":{"ephemeral":true,"type":{"key":"integer","min":0}},"mac_in_use":{"ephemeral":true,"type":{"key":"string","min":0}},"type":{"type":"string"},"cfm_remote_opstate":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["down","up"]]},"min":0}},"ingress_policing_rate":{"type":{"key":{"minInteger":0,"type":"integer"}}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"mac":{"type":{"key":"string","min":0}},"ofport":{"type":{"key":"integer","min":0}},"ifindex":{"ephemeral":true,"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0}},"cfm_fault_status":{"ephemeral":true,"type":{"key":"string","min":0,"max":"unlimited"}},"duplex":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["full","half"]]},"min":0}},"lacp_current":{"ephemeral":true,"type":{"key":"boolean","min":0}},"cfm_fault":{"ephemeral":true,"type":{"key":"boolean","min":0}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"admin_state":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["down","up"]]},"min":0}},"link_state":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["down","up"]]},"min":0}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"bfd_status":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"cfm_remote_mpids":{"ephemeral":true,"type":{"key":"integer","min":0,"max":"unlimited"}},"cfm_mpid":{"type":{"key":"integer","min":0}},"bfd":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"ofport_request":{"type":{"key":{"maxInteger":65279,"minInteger":1,"type":"integer"},"min":0}},"ingress_policing_burst":{"type":{"key":{"minInteger":0,"type":"integer"}}},"cfm_flap_count":{"type":{"key":"integer","min":0}},"cfm_health":{"ephemeral":true,"type":{"key":{"maxInteger":100,"minInteger":0,"type":"integer"},"min":0}},"link_resets":{"ephemeral":true,"type":{"key":"integer","min":0}}},"indexes":[["name"]]},"SSL":{"columns":{"private_key":{"type":"string"},"ca_cert":{"type":"string"},"bootstrap_ca_cert":{"type":"boolean"},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"certificate":{"type":"string"}},"maxRows":1},"IPFIX":{"columns":{"targets":{"type":{"key":"string","min":0,"max":"unlimited"}},"obs_point_id":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0}},"cache_max_flows":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0}},"cache_active_timeout":{"type":{"key":{"maxInteger":4200,"minInteger":0,"type":"integer"},"min":0}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"obs_domain_id":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0}},"sampling":{"type":{"key":{"maxInteger":4294967295,"minInteger":1,"type":"integer"},"min":0}}}},"Open_vSwitch":{"columns":{"ovs_version":{"type":{"key":"string","min":0}},"system_version":{"type":{"key":"string","min":0}},"bridges":{"type":{"key":{"type":"uuid","refTable":"Bridge"},"min":0,"max":"unlimited"}},"statistics":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"next_cfg":{"type":"integer"},"system_type":{"type":{"key":"string","min":0}},"manager_options":{"type":{"key":{"type":"uuid","refTable":"Manager"},"min":0,"max":"unlimited"}},"db_version":{"type":{"key":"string","min":0}},"ssl":{"type":{"key":{"type":"uuid","refTable":"SSL"},"min":0}},"cur_cfg":{"type":"integer"}},"maxRows":1,"isRoot":true},"Queue":{"columns":{"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"dscp":{"type":{"key":{"maxInteger":63,"minInteger":0,"type":"integer"},"min":0}}},"isRoot":true},"NetFlow":{"columns":{"engine_type":{"type":{"key":{"maxInteger":255,"minInteger":0,"type":"integer"},"min":0}},"targets":{"type":{"key":"string","max":"unlimited"}},"add_id_to_interface":{"type":"boolean"},"active_timeout":{"type":{"key":{"minInteger":-1,"type":"integer"}}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"engine_id":{"type":{"key":{"maxInteger":255,"minInteger":0,"type":"integer"},"min":0}}}},"Controller":{"columns":{"is_connected":{"ephemeral":true,"type":"boolean"},"enable_async_messages":{"type":{"key":"boolean","min":0}},"controller_rate_limit":{"type":{"key":{"minInteger":100,"type":"integer"},"min":0}},"target":{"type":"string"},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"local_netmask":{"type":{"key":"string","min":0}},"local_gateway":{"type":{"key":"string","min":0}},"max_backoff":{"type":{"key":{"minInteger":1000,"type":"integer"},"min":0}},"local_ip":{"type":{"key":"string","min":0}},"connection_mode":{"type":{"key":{"type":"string","enum":["set",["in-band","out-of-band"]]},"min":0}},"status":{"ephemeral":true,"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"role":{"ephemeral":true,"type":{"key":{"type":"string","enum":["set",["master","other","slave"]]},"min":0}},"inactivity_probe":{"type":{"key":"integer","min":0}},"controller_burst_limit":{"type":{"key":{"minInteger":25,"type":"integer"},"min":0}}}},"QoS":{"columns":{"queues":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"},"min":0,"value":{"type":"uuid","refTable":"Queue"},"max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"other_config":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"type":{"type":"string"}},"isRoot":true},"Mirror":{"columns":{"name":{"type":"string"},"output_port":{"type":{"key":{"refType":"weak","type":"uuid","refTable":"Port"},"min":0}},"output_vlan":{"type":{"key":{"maxInteger":4095,"minInteger":1,"type":"integer"},"min":0}},"statistics":{"ephemeral":true,"type":{"key":"string","min":0,"value":"integer","max":"unlimited"}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"select_dst_port":{"type":{"key":{"refType":"weak","type":"uuid","refTable":"Port"},"min":0,"max":"unlimited"}},"select_vlan":{"type":{"key":{"maxInteger":4095,"minInteger":0,"type":"integer"},"min":0,"max":4096}},"select_all":{"type":"boolean"},"select_src_port":{"type":{"key":{"refType":"weak","type":"uuid","refTable":"Port"},"min":0,"max":"unlimited"}}}},"Flow_Sample_Collector_Set":{"columns":{"ipfix":{"type":{"key":{"type":"uuid","refTable":"IPFIX"},"min":0}},"id":{"type":{"key":{"maxInteger":4294967295,"minInteger":0,"type":"integer"}}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"bridge":{"type":{"key":{"type":"uuid","refTable":"Bridge"}}}},"isRoot":true,"indexes":[["id","bridge"]]},"sFlow":{"columns":{"polling":{"type":{"key":"integer","min":0}},"header":{"type":{"key":"integer","min":0}},"targets":{"type":{"key":"string","max":"unlimited"}},"agent":{"type":{"key":"string","min":0}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"sampling":{"type":{"key":"integer","min":0}}}},"Flow_Table":{"columns":{"groups":{"type":{"key":"string","min":0,"max":"unlimited"}},"name":{"type":{"key":"string","min":0}},"overflow_policy":{"type":{"key":{"type":"string","enum":["set",["evict","refuse"]]},"min":0}},"prefixes":{"type":{"key":"string","min":0,"max":3}},"external_ids":{"type":{"key":"string","min":0,"value":"string","max":"unlimited"}},"flow_limit":{"type":{"key":{"minInteger":0,"type":"integer"},"min":0}}}}},"cksum":"3478940432
20717","name":"Open_vSwitch","version":"7.6.2"}
OVSDB JSON 194 e3568d4c5a38ddbc71f84232f63a364bedcc8650
{"_date":1436987680725,"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"db_version":"7.6.2"}},"_comment":"ovs-vsctl:
ovs-vsctl --no-wait -- init -- set Open_vSwitch . db-version=7.6.2"}
OVSDB JSON 453 ac40dd1f3b81a9dbdbc0667e66b3b64cbddededf
{"_date":1436987680792,"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"system_version":"unknown","ovs_version":"2.3.1","system_type":"unknown","external_ids":["map",[["system-id","93e4c489-b78c-4a4a-a7ec-ca98916a3e83"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl --no-wait set Open_vSwitch . ovs-version=2.3.1
\"external-ids:system-id=\\\"93e4c489-b78c-4a4a-a7ec-ca98916a3e83\\\"\"
\"system-type=\\\"unknown\\\"\" \"system-version=\\\"unknown\\\"\""}
OVSDB JSON 567 d156b984f16309e9618a16905da65f3580295198
{"_date":1436987681022,"Port":{"c0c8331e-354b-436f-be1f-04c785bdb10a":{"name":"vmbr0","interfaces":["uuid","de9d193d-efc0-42de-8f04-81b3d05fd45e"]}},"Interface":{"de9d193d-efc0-42de-8f04-81b3d05fd45e":{"name":"vmbr0","type":"internal"}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"name":"vmbr0","ports":["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"]}},"_comment":"ovs-vsctl:
ovs-vsctl --timeout=5 -- --may-exist add-br vmbr0
--","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"bridges":["uuid","6602557a-7e30-4dc7-a5f4-0eca29bfb2f3"],"next_cfg":1}}}
OVSDB JSON 164 d5f5306c90919a761cb0b31eb6d3d50fbd4c166c
{"_date":1436987681149,"Interface":{"de9d193d-efc0-42de-8f04-81b3d05fd45e":{"ofport":65534}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":1}}}
OVSDB JSON 764 39f789756c054e4b0a027a67fce078b2746de1c2
{"_date":1436987681200,"Port":{"4346c2cb-2f68-4a72-9c54-b1c561438eec":{"name":"bond0","bond_mode":"balance-tcp","lacp":"active","interfaces":["set",[["uuid","35537fd4-f5f7-4fba-acf9-0c88748b8990"],["uuid","8f6b0722-7235-4925-994e-0b82b9f8109d"]]],"bond_fake_iface":true}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"ports":["set",[["uuid","4346c2cb-2f68-4a72-9c54-b1c561438eec"],["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"]]]}},"Interface":{"35537fd4-f5f7-4fba-acf9-0c88748b8990":{"name":"eth0"},"8f6b0722-7235-4925-994e-0b82b9f8109d":{"name":"eth1"}},"_comment":"ovs-vsctl:
ovs-vsctl --timeout=5 -- --fake-iface add-bond vmbr0 bond0 eth0 eth1
lacp=active bond_mode=balance-tcp
--","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"next_cfg":2}}}
OVSDB JSON 212 df73e852a500b8f5f374e047d1685267a8281d12
{"_date":1436987681328,"Interface":{"35537fd4-f5f7-4fba-acf9-0c88748b8990":{"ofport":1},"8f6b0722-7235-4925-994e-0b82b9f8109d":{"ofport":2}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":2}}}
OVSDB JSON 671 9c43be618258aaeae473e23ba71a71b865e5e958
{"_date":1436987681856,"Port":{"b1ea8a16-a3ed-4c65-bbaf-d961db7eca32":{"name":"ceph157","interfaces":["uuid","44b1a528-02a4-4371-9290-c6c356b538d5"],"tag":157}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"ports":["set",[["uuid","4346c2cb-2f68-4a72-9c54-b1c561438eec"],["uuid","b1ea8a16-a3ed-4c65-bbaf-d961db7eca32"],["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"]]]}},"Interface":{"44b1a528-02a4-4371-9290-c6c356b538d5":{"name":"ceph157","type":"internal"}},"_comment":"ovs-vsctl:
ovs-vsctl --timeout=5 -- --may-exist add-port vmbr0 ceph157 tag=157 -- set
Interface ceph157 type=internal
--","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"next_cfg":3}}}
OVSDB JSON 160 947ab8f46acb663a4aeeaff0d09e99e2127791ef
{"_date":1436987681859,"Interface":{"44b1a528-02a4-4371-9290-c6c356b538d5":{"ofport":4}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":3}}}
OVSDB JSON 719 19d9cfc5b32420c363708790222751665bebb32a
{"_date":1436987682027,"Port":{"c15ac310-c6f9-427d-a3d3-035296c325a5":{"name":"mgmt158","interfaces":["uuid","a267cf7b-c9cb-44ab-b4cd-1a2903b8f2ca"],"tag":158}},"Interface":{"a267cf7b-c9cb-44ab-b4cd-1a2903b8f2ca":{"name":"mgmt158","type":"internal"}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"ports":["set",[["uuid","4346c2cb-2f68-4a72-9c54-b1c561438eec"],["uuid","b1ea8a16-a3ed-4c65-bbaf-d961db7eca32"],["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"],["uuid","c15ac310-c6f9-427d-a3d3-035296c325a5"]]]}},"_comment":"ovs-vsctl:
ovs-vsctl --timeout=5 -- --may-exist add-port vmbr0 mgmt158 tag=158 -- set
Interface mgmt158 type=internal
--","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"next_cfg":4}}}
OVSDB JSON 160 e6b463920954ae8b1d63ba60c288f2ee82b2e862
{"_date":1436987682030,"Interface":{"a267cf7b-c9cb-44ab-b4cd-1a2903b8f2ca":{"ofport":5}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":4}}}
OVSDB JSON 114 4cc9441f8bae008c72cce1e42c2eb842cec66e03
{"Port":{"4346c2cb-2f68-4a72-9c54-b1c561438eec":{"bond_active_slave":"00:a0:d1:ea:a2:85"}},"_date":1436987686331}
OVSDB JSON 674 2bf2bf53a25e10c1144490609a960855758b158c
{"_date":1436988249724,"Port":{"55abe05a-e508-4e3d-9971-9cf42b31d552":{"name":"tap100i0","interfaces":["uuid","87b44c4b-8123-4e30-880d-7865fa9cb056"]}},"Interface":{"87b44c4b-8123-4e30-880d-7865fa9cb056":{"name":"tap100i0"}},"Bridge":{"6602557a-7e30-4dc7-a5f4-0eca29bfb2f3":{"ports":["set",[["uuid","4346c2cb-2f68-4a72-9c54-b1c561438eec"],["uuid","55abe05a-e508-4e3d-9971-9cf42b31d552"],["uuid","b1ea8a16-a3ed-4c65-bbaf-d961db7eca32"],["uuid","c0c8331e-354b-436f-be1f-04c785bdb10a"],["uuid","c15ac310-c6f9-427d-a3d3-035296c325a5"]]]}},"_comment":"ovs-vsctl:
/usr/bin/ovs-vsctl add-port vmbr0
tap100i0","Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"next_cfg":5}}}
OVSDB JSON 160 fe52c4d6b136e32802a3d410319025b46649ed50
{"_date":1436988249725,"Interface":{"87b44c4b-8123-4e30-880d-7865fa9cb056":{"ofport":6}},"Open_vSwitch":{"796212bb-db53-4578-9d72-d06d723e5583":{"cur_cfg":5}}}

root at pve1:~# ovs-dpctl show
system at ovs-system:
lookups: hit:97368456 missed:4177248 lost:0
flows: 138
masks: hit:551673431 total:6 hit/pkt:5.43
port 0: ovs-system (internal)
port 1: vmbr0 (internal)
port 2: eth0
port 3: eth1
port 4: bond0 (internal)
port 5: ceph157 (internal)
port 6: mgmt158 (internal)
port 7: tap100i0

root at pve1:~# dmesg|tail
[70679.622950] UDP: bad checksum. From 192.168.158.38:5404 to
239.192.72.34:5405 ulen 83
[70680.834679] UDP: bad checksum. From 192.168.158.37:5404 to
239.192.72.34:5405 ulen 1482
[70680.836025] UDP: bad checksum. From 192.168.158.34:5404 to
239.192.72.34:5405 ulen 821
[70680.838299] UDP: bad checksum. From 192.168.158.34:5404 to
239.192.72.34:5405 ulen 821
[70680.853189] UDP: bad checksum. From 192.168.158.34:5404 to
239.192.72.34:5405 ulen 821
[70680.854095] UDP: bad checksum. From 192.168.158.34:5404 to
239.192.72.34:5405 ulen 821
[70680.855628] UDP: bad checksum. From 192.168.158.34:5404 to
239.192.72.34:5405 ulen 821
[70680.856488] UDP: bad checksum. From 192.168.158.34:5404 to
239.192.72.34:5405 ulen 821
[70680.857216] UDP: bad checksum. From 192.168.158.34:5404 to
239.192.72.34:5405 ulen 821
[70683.642617] UDP: bad checksum. From 192.168.158.37:5404 to
239.192.72.34:5405 ulen 1481




  [image: Avant logo] *Adam Thompson*
Senior Systems Administrator
*voice:* 204.789.9596 x24 | *email:* athompson at avant.ca | *web:* avant.ca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/c8bc53c8/attachment-0001.html>

From shettyg at nicira.com  Thu Jul 16 11:18:19 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 16 Jul 2015 11:18:19 -0700
Subject: [ovs-discuss] Flooding of packets destined to OVS port's mac
	address
In-Reply-To: <54F3CC316BCACF48A126BE3ED38CD1F319B4E84C@SGSIMBX005.nsn-intra.net>
References: <54F3CC316BCACF48A126BE3ED38CD1F319B4E84C@SGSIMBX005.nsn-intra.net>
Message-ID: <CAHbON5piZJMbkvfRtvoe726nP9wu-7DzB1A1Z4b0Ki7O2DSaYA@mail.gmail.com>

I don't know the answer, but some of your mac addresses have multi-cast bit
enabled. So I wonder whether that is the problem.

On Wed, Jul 15, 2015 at 12:18 PM, Pujar, Shyam (Nokia - IN/Bangalore) <
shyam.pujar at nokia.com> wrote:

>  Hi ,
>         Please find setup and testing procedure below.
>
>
>
>    1. In the above setup, Client Program tries to send packet with
>    src_mac: 3:3:3:3:3:3  and dst_mac: 1:1:1:1:1:1.
>    2. Packet is flood to port tap2.
>    3. Why does OVS flood packets when dst_mac received is its own port’s
>    mac address.
>    4. As it forwards to other ports, there is no one to reply for dst_mac
>    other than OVS bridge itself.
>    5. Where as in case of Linux bridge, packet is not flooded to other
>    ports. Instead packet is dropped.
>
>
> Could you please tell me how do switches in real work? As per my
> understanding there should be static entries in forwarding table of switch
> for its own mac addresses.
> And default action should be present for it.
>
>
> Regards,
> Shyam
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/8296b642/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Picture (Device Independent Bitmap) 1.jpg
Type: image/jpeg
Size: 18205 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/8296b642/attachment-0001.jpg>

From wuhao.thu at gmail.com  Thu Jul 16 11:22:29 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Thu, 16 Jul 2015 11:22:29 -0700
Subject: [ovs-discuss] How to set the best setting to test packet
 processing performance?
In-Reply-To: <20150716072829.GE22655@nicira.com>
References: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>
 <20150716072829.GE22655@nicira.com>
Message-ID: <CAHmvmjGHa+ciLTcFkJc80-azF=uCbfeC2pqrfXnOfztXVxY9xg@mail.gmail.com>

Hi Ben,

   Yes, you are right. I find the bottleneck is tcprelay which only
generates packets at 750Kpps. But even when I add more hosts to send
packets in parallel, I can't get a higher generation rate. E.g., if I use
only one host, tcpreplay sends packets at 300Kpps, while if I use 6 hosts,
each tcpreplay sends packets at around 130Kpps and the total rate is still
750Kpps. How do you get a higher generation rate in your experiment? Thanks.

+++++++++++++++++
Best,
Hao

On Thu, Jul 16, 2015 at 12:28 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Jul 15, 2015 at 03:10:33PM -0700, Hao Wu wrote:
> >    I'm using OVS 2.3.0 and testing the packet processing throughput.
> > Currently, I build a simple network via Mninet which consists of 3 hosts
> > connecting to 1 ovs instance. Then, I use the 3 hosts send out 64-byte
> > packets via Tcpreplay, and I measure the packet processing throughput in
> > OVS and get the result at 750Kpps.
> >
> >    I want to know is there any method to enhance OVS performance? like
> > binding multi cores or some other settings? Since I notice the
> performance
> > in NSDI 15 paper is several Mpps.
>
> Have you determined for sure that OVS is the bottleneck in the setup?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/8c4b40e8/attachment.html>

From blp at nicira.com  Thu Jul 16 11:38:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 16 Jul 2015 11:38:13 -0700
Subject: [ovs-discuss] ovs-vswitchd:
 ovs|15644|odp_util(revalidator_1168)|ERR|mask expected for non-Ethernet II
In-Reply-To: <216b8690.44ee.14e8f9d35e0.Coremail.workbu@163.com>
References: <216b8690.44ee.14e8f9d35e0.Coremail.workbu@163.com>
Message-ID: <20150716183813.GK11792@nicira.com>

On Wed, Jul 15, 2015 at 10:48:41AM +0800, zy wrote:
> The openvswitch 's version show as below:
> 
> kmod-openvswitch-2.1.2-2.ibm.el6.x86_64
> openvswitch-2.1.2-3.ibm.el6.x86_64
> 
> Is there any clue ?

OVS 2.1.x isn't a long-term support release, and it's pretty old, and
that's not the newest version in branch-2.1, so I'd recommend upgrading.

From diproiettod at vmware.com  Thu Jul 16 12:02:33 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Thu, 16 Jul 2015 19:02:33 +0000
Subject: [ovs-discuss] OVS segmentation fault due to incorrect TX queue
 setup with netdev-dpdk
Message-ID: <D1CDBBCA.4CCE%diproiettod@vmware.com>

Hi,

Thanks for the very detailed report!  I've sent two
patches to the mailing list that should address the
issues.  Would you mind testing them?

More comments inline

On 15/07/2015 11:49, "Stokes, Ian" <ian.stokes at intel.com> wrote:

>Hi All,
> 
>I¹ve been investigating a segmentation fault caused by the incorrect
>setup of TX queues for netdev-dpdk. It occurs in the following scenario.
> 
>Running OVS with DPDK on a system with 72 cores (Hyper threading enabled)
>and using an Intel XL710 Network Card.
> 
>Default behavior in OVS when adding a DPDK physical port is to attempt to
>setup 1 tx queue for each core detected on the system plus one more queue
>for non_pmd threads.
> 
>In this case 73 tx queues will be requested in total.
> 
>The standard behavior when initializing a DPDK port is to check the
>number of queues being requested against the max number of queues
>available for the device itself.
> 
>This is done in dpdk_eth_dev_init() with the following code segment
>Š
>    rte_eth_dev_info_get(dev->port_id, &info);
>    dev->up.n_rxq = MIN(info.max_rx_queues, dev->up.n_rxq);
>    dev->real_n_txq = MIN(info.max_tx_queues, dev->up.n_txq);
> 
>    diag = rte_eth_dev_configure(dev->port_id, dev->up.n_rxq,
>dev->real_n_txq, &port_conf);
>Š
> 
>The smaller of the two values is selected as the real amount of tx queues
>that can be setup. This accommodates a situation where we could have more
>cores on a system than we have tx queues on the network device in DPDK.
> 
>This has worked fine with the previous generation of Intel interfaces
>such as Intel 82599. However it will not work with the XL710.
> 
>In DPDK the XL710 has a total of 316 tx queues that can be used. From the
>check above we would think we can allocate 73 of these tx queues without
>issue. But the 316 queues available are subdivided between different
>queue types.
> 
>For a DPDK host application (In this case OVS) queues 1 ­ 64 inclusive
>can be used. However queue 65 to 96 are strictly for SRIOV tx queue use.
>
> 
>The check for max_tx_queues above will identify the total number of
>queues available (316), compare it to the number of queues being
>requested (73) and will select 73 as the real_n_txq. But this is not the
>correct number of tx queues that are usable by
> OVS (64).
> 
>We can cause the switch to segfault by doing the following
> 
>Add a dpdk physical port
> 
>sudo $OVS_DIR/utilities/ovs-vsctl add-br br0 -- set Bridge br0
>datapath_type=netdev
>sudo $OVS_DIR/utilities/ovs-vsctl add-port br0 dpdk0 -- set Interface
>dpdk0 type=dpdk
> 
>This will output the following warning
>ovs-vsctl: Error detected while setting up 'dpdk0'.  See ovs-vswitchd log
>for details.
> 
>Looking at the log we see
> 
>PMD: i40e_dev_tx_queue_setup(): Using simple tx path
>PMD: i40e_pf_get_vsi_by_qindex(): queue_idx out of range. VMDQ configured?
>2015-07-15T01:22:48Z|00019|dpdk|ERR|eth dev tx queue setup error -5
>2015-07-15T01:22:48Z|00020|dpif_netdev|ERR|dpdk0, cannot set multiq
>2015-07-15T01:22:48Z|00021|dpif|WARN|netdev at ovs-netdev: failed to add
>dpdk0 as port: Resource temporarily unavailable
> 
>This is as expected. This warning will be reported in dpdk_eth_dev_init()
>by the following code segment when it attempts to initialize the 65th
>queue
> 
>    for (i = 0; i < dev->real_n_txq; i++) {
>        diag = rte_eth_tx_queue_setup(dev->port_id, i, NIC_PORT_TX_Q_SIZE,
>                                      dev->socket_id, NULL);
>        if (diag) {
>            VLOG_ERR("eth dev tx queue setup error %d",diag);
>            return -diag;
>        }
>    }
> 
>Then add an internal port type to the same bridge
> 
>sudo $OVS_DIR/utilities/ovs-vsctl add-port br0 testif1 -- set interface
>testif1 type=internal
> 
>I was surprised to see that after adding the internal port , the DPDK
>port that failed previously is now added as well. Is this expected
>behavior?

No, this is a genuine OVS bug.  The first patch in the series
addresses that.

>Looking at the vswitch log I can see that both the internal port and the
>DPDK port have port IDs now.
> 
>2015-07-15T01:23:19Z|00024|bridge|INFO|bridge br0: added interface
>testif1 on port 1
>2015-07-15T01:23:19Z|00025|dpif_netdev|INFO|Created 1 pmd threads on numa
>node 0
>2015-07-15T01:23:19Z|00001|dpif_netdev(pmd40)|INFO|Core 0 processing port
>'dpdk0'
>2015-07-15T01:23:19Z|00002|dpif_netdev(pmd40)|INFO|Core 0 processing port
>'dpdk0'
>2015-07-15T01:23:19Z|00026|bridge|INFO|bridge br0: added interface dpdk0
>on port 2
>2015-07-15T01:23:19Z|00027|bridge|INFO|bridge br0: using datapath ID
>00006805ca2d3cb8
> 
>If we assign an IP to the internal port we will segfault the vswitch
>sudo ip addr add 192.168.1.1/24 dev testif1
> 
>This is caused by the internal interface broadcasting an ICMP6 neighbor
>solicitation message. This packet is copied from kernel space memory to
>DPDK memory in the netdev_dpdk_send__() function.
>The issue is that the qid passed to netdev_dpdk_send__ function is 72.
>This packet will eventually be transmitted with with rte_eth_tx_burst
>with a tx qid of 72.
>In DPDK, queue 72 for the XL710 is for SRIOV use only and so will not be
>initialized during the rte_eth_tx_queue_setup process above and so the
>switch segfaults when an attempt is made to access it.
> 
> 
>In terms of a solution to this I would appreciate some feedback on what
>people think is the best approach.
> 
>Ideally DPDK could extend the number of sequential queues supported for
>host DPDK applications.
>Previous generation cards supported 128 TX queues that could be used with
>a host application, hence why this issue is not seen with them.
>
>This however would not fix the immediate issue and would be more of a
>long term solution. It could be flagged in the documentation as a known
>issue/corner case that is not supported in the mean time.
> 
>Alternatively OVS could attempt to setup as many queues as possible on
>the DPDK device itself. If an error is detected the appropriate fields
>would have to be updated such as
>dev->real_n_txq.
>In this case we would setup 64 of the requested 73, log a warning message
>to the user. However there may be issues with how the pmd threads map to
>the correct tx queue IDs.
>I¹ve noticed that when netdev_dpdk_send__ is called the qid is 72, and
>this value comes from dp_execute_cb() where the tx_qid is taken from the
>dp_netdev_pmd_thread.
> 
>Any Feedback would be appreciated.

netdev-dpdk already supports working with a smaller of
txqs by using a spinlock.

The ideal fix (IMHO) would be for DPDK to report the usable
number of transmission queues.  In the meantime we can retry
with less transmission queues if the queue setup fails.

I've implemented this workaroud in the second patch of the
series.

> 
>Thanks
>Ian
> 
> 
> 
> 


From blp at nicira.com  Thu Jul 16 13:08:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 16 Jul 2015 13:08:02 -0700
Subject: [ovs-discuss] How to set the best setting to test packet
 processing performance?
In-Reply-To: <CAHmvmjGHa+ciLTcFkJc80-azF=uCbfeC2pqrfXnOfztXVxY9xg@mail.gmail.com>
References: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>
 <20150716072829.GE22655@nicira.com>
 <CAHmvmjGHa+ciLTcFkJc80-azF=uCbfeC2pqrfXnOfztXVxY9xg@mail.gmail.com>
Message-ID: <20150716200802.GP11792@nicira.com>

On Thu, Jul 16, 2015 at 11:22:29AM -0700, Hao Wu wrote:
>    Yes, you are right. I find the bottleneck is tcprelay which only
> generates packets at 750Kpps. But even when I add more hosts to send
> packets in parallel, I can't get a higher generation rate. E.g., if I use
> only one host, tcpreplay sends packets at 300Kpps, while if I use 6 hosts,
> each tcpreplay sends packets at around 130Kpps and the total rate is still
> 750Kpps. How do you get a higher generation rate in your experiment? Thanks.

I think we used netperf.  I've never use tcpreplay so I don't have any
hints.

From joestringer at nicira.com  Thu Jul 16 13:12:49 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 16 Jul 2015 13:12:49 -0700
Subject: [ovs-discuss] How to set the best setting to test packet
 processing performance?
In-Reply-To: <20150716200802.GP11792@nicira.com>
References: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>
 <20150716072829.GE22655@nicira.com>
 <CAHmvmjGHa+ciLTcFkJc80-azF=uCbfeC2pqrfXnOfztXVxY9xg@mail.gmail.com>
 <20150716200802.GP11792@nicira.com>
Message-ID: <CANr6G5wihpLirS7iBvGUJKqY=HasjFVsJJ7QKp+Q9EX1YkB_Jw@mail.gmail.com>

On 16 July 2015 at 13:08, Ben Pfaff <blp at nicira.com> wrote:
> On Thu, Jul 16, 2015 at 11:22:29AM -0700, Hao Wu wrote:
>>    Yes, you are right. I find the bottleneck is tcprelay which only
>> generates packets at 750Kpps. But even when I add more hosts to send
>> packets in parallel, I can't get a higher generation rate. E.g., if I use
>> only one host, tcpreplay sends packets at 300Kpps, while if I use 6 hosts,
>> each tcpreplay sends packets at around 130Kpps and the total rate is still
>> 750Kpps. How do you get a higher generation rate in your experiment? Thanks.
>
> I think we used netperf.  I've never use tcpreplay so I don't have any
> hints.

Even with netperf, you need to run several threads and depending on
the test you may exhaust all CPU running netperf to generate the
traffic before you start hitting OVS performance limits.

From blp at nicira.com  Thu Jul 16 13:14:34 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 16 Jul 2015 13:14:34 -0700
Subject: [ovs-discuss] How to set the best setting to test packet
 processing performance?
In-Reply-To: <CANr6G5wihpLirS7iBvGUJKqY=HasjFVsJJ7QKp+Q9EX1YkB_Jw@mail.gmail.com>
References: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>
 <20150716072829.GE22655@nicira.com>
 <CAHmvmjGHa+ciLTcFkJc80-azF=uCbfeC2pqrfXnOfztXVxY9xg@mail.gmail.com>
 <20150716200802.GP11792@nicira.com>
 <CANr6G5wihpLirS7iBvGUJKqY=HasjFVsJJ7QKp+Q9EX1YkB_Jw@mail.gmail.com>
Message-ID: <20150716201434.GR11792@nicira.com>

On Thu, Jul 16, 2015 at 01:12:49PM -0700, Joe Stringer wrote:
> On 16 July 2015 at 13:08, Ben Pfaff <blp at nicira.com> wrote:
> > On Thu, Jul 16, 2015 at 11:22:29AM -0700, Hao Wu wrote:
> >>    Yes, you are right. I find the bottleneck is tcprelay which only
> >> generates packets at 750Kpps. But even when I add more hosts to send
> >> packets in parallel, I can't get a higher generation rate. E.g., if I use
> >> only one host, tcpreplay sends packets at 300Kpps, while if I use 6 hosts,
> >> each tcpreplay sends packets at around 130Kpps and the total rate is still
> >> 750Kpps. How do you get a higher generation rate in your experiment? Thanks.
> >
> > I think we used netperf.  I've never use tcpreplay so I don't have any
> > hints.
> 
> Even with netperf, you need to run several threads and depending on
> the test you may exhaust all CPU running netperf to generate the
> traffic before you start hitting OVS performance limits.

Right, the OVS paper mentions that we ran 400 netperf instances in
parallel.

From blp at nicira.com  Thu Jul 16 14:40:18 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 16 Jul 2015 14:40:18 -0700
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <55A7419E.7010306@gmail.com>
References: <55A7419E.7010306@gmail.com>
Message-ID: <20150716214018.GD11792@nicira.com>

On Thu, Jul 16, 2015 at 02:31:10PM +0900, Minoru TAKAHASHI wrote:
> Maybe I’ve found a problem on "ofputil_encode_group_desc_request" of ofp-util.c.
> According to the OFspec v1.5, the last element of ofp_group_multipart_request has to be filled with zeros.
> 
>   /* Body of OFPMP_GROUP_STATS and OFPMP_GROUP_DESC requests. */
>       struct ofp_group_multipart_request {
>       uint32_t group_id;  /* All groups if OFPG_ALL. */
>       uint8_t pad[4];     /* Align to 64 bits. */
>   };
>   OFP_ASSERT(sizeof(struct ofp_group_multipart_request) == 8);
> 
> I’ve checked the source code of "ofputil_encode_group_desc_request", such a process it could not find.
> 
>   * ofputil_encode_group_desc_request
>   https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L7274-L7279
> 
> I guess it should be write in the same way as follows.
> 
>   * ofputil_encode_group_stats_request
>   https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L7207-L7213
> 
> And, I think "ofputil_encode_port_desc_stats_request" also has a similar problem.
> 
>   * ofputil_encode_port_desc_stats_request
>   https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L4009-L4014
> 
> Please confirm if it’s correct.

You're right.

Will you submit a patch?

Thanks,

Ben.

From abhishekv.verma at gmail.com  Thu Jul 16 17:23:35 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 17 Jul 2015 05:53:35 +0530
Subject: [ovs-discuss] Fwd: Routing at the termination point
In-Reply-To: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
References: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
Message-ID: <CADDmorT8+Sr6y+LRuW0i-6OJn1dpk-mRvKu=wOr_4fKd7mbRuw@mail.gmail.com>

Hi,

Can somebody help me here!

Thanks, Abhishek

---------- Forwarded message ----------
From: Abhishek Verma <abhishekv.verma at gmail.com>
Date: Thu, Jul 16, 2015 at 2:57 PM
Subject: Routing at the termination point
To: discuss at openvswitch.org


Hi,

I am using a GRE tunnel to connect two VMs, VM-A and VM-B. VM-B is
connected to other networks as well.

I want the packets terminating at the GRE tunnel on VM-B, to do an L3
lookup, and to get forwarded based on the result of the L3 lookup.

To do this, i changed the destination MAC at the ingress (on VM-A) to match
the MAC address of one of the ports on VM-B. This way when the packets
emerge from the GRE tunnel, they already have a dest MAC that matches one
of its port MACs. I assumed that because of this the kernel will
automatically do an L3 lookup and will forward the packet out to the right
place. However, this isnt happening, and am wondering why.

I see that i am able to ping the interface if it resides on VM-B. I can
however, not get the VM-B to L3 route that packet out. I want the packet to
be looked up in the L3 kernel table and get forwarded out. Is there
anything that i am missing here.

My configs:

*The packet arrives on a GRE tunnel (port 4) and i hence add a rule which
says that anything arriving on port 4, should undergo normal (L2 and L3)
processing. However, since the dest MAC matches one of the port's MACs, i
expect the packet to undergo L3 processing.*

root@:/home/ubuntu# ovs-ofctl show OFSWITCH
OFPT_FEATURES_REPLY (xid=0x2): dpid:000006451ad21ced
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
 1(eth0): addr:06:45:1a:d2:1c:ed
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 4(gre0): addr:06:48:6f:be:b0:f5
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 LOCAL(OFSWITCH): addr:06:45:1a:d2:1c:ed
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
root@:/home/ubuntu#

root@:/home/ubuntu# ovs-ofctl dump-flows OFSWITCH
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=147000.263s, table=0, n_packets=196105,
n_bytes=117995996, idle_age=0, hard_age=65534, priority=0 actions=NORMAL
 cookie=0x0, duration=1185.832s, table=0, n_packets=62, n_bytes=6076,
idle_age=971, priority=501,in_port=4 actions=NORMAL


Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/781a4be9/attachment.html>

From wuhao.thu at gmail.com  Thu Jul 16 17:31:00 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Thu, 16 Jul 2015 17:31:00 -0700
Subject: [ovs-discuss] How to set the best setting to test packet
 processing performance?
In-Reply-To: <20150716201434.GR11792@nicira.com>
References: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>
 <20150716072829.GE22655@nicira.com>
 <CAHmvmjGHa+ciLTcFkJc80-azF=uCbfeC2pqrfXnOfztXVxY9xg@mail.gmail.com>
 <20150716200802.GP11792@nicira.com>
 <CANr6G5wihpLirS7iBvGUJKqY=HasjFVsJJ7QKp+Q9EX1YkB_Jw@mail.gmail.com>
 <20150716201434.GR11792@nicira.com>
Message-ID: <CAHmvmjF7jqKQCe2dHY2u+DF8rAvGE9OTcpeEji8-Nvf4FKXmcQ@mail.gmail.com>

Got it, then I will try netperf. Thanks.

+++++++++++++++++
Best,
Hao

On Thu, Jul 16, 2015 at 1:14 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Jul 16, 2015 at 01:12:49PM -0700, Joe Stringer wrote:
> > On 16 July 2015 at 13:08, Ben Pfaff <blp at nicira.com> wrote:
> > > On Thu, Jul 16, 2015 at 11:22:29AM -0700, Hao Wu wrote:
> > >>    Yes, you are right. I find the bottleneck is tcprelay which only
> > >> generates packets at 750Kpps. But even when I add more hosts to send
> > >> packets in parallel, I can't get a higher generation rate. E.g., if I
> use
> > >> only one host, tcpreplay sends packets at 300Kpps, while if I use 6
> hosts,
> > >> each tcpreplay sends packets at around 130Kpps and the total rate is
> still
> > >> 750Kpps. How do you get a higher generation rate in your experiment?
> Thanks.
> > >
> > > I think we used netperf.  I've never use tcpreplay so I don't have any
> > > hints.
> >
> > Even with netperf, you need to run several threads and depending on
> > the test you may exhaust all CPU running netperf to generate the
> > traffic before you start hitting OVS performance limits.
>
> Right, the OVS paper mentions that we ran 400 netperf instances in
> parallel.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150716/17410394/attachment.html>

From changchun.ouyang at intel.com  Thu Jul 16 20:04:55 2015
From: changchun.ouyang at intel.com (Ouyang, Changchun)
Date: Fri, 17 Jul 2015 11:04:55 +0800
Subject: [ovs-discuss] ovs-dpdk performance is not good
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F74519560F@IRSMSX104.ger.corp.intel.com>
References: <CABDe9TyYE1Z03kX6DkpkSHDw0=xoHj2--+nHwb-r=fxshY6w_Q@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F745190437@IRSMSX104.ger.corp.intel.com>
 <CABDe9TwzvJd0MWOfpkSXS4Dfm-RmxN=F2a_cRup40yqTebhyuA@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F74519560F@IRSMSX104.ger.corp.intel.com>
Message-ID: <55A870D7.8060803@intel.com>



On 7/16/2015 9:45 PM, Traynor, Kevin wrote:
>
> (re-adding the ovs-discuss list)
>
> This might be better on the dpdk dev mailing list. For the OVS part, 
> see this thread 
> http://openvswitch.org/pipermail/discuss/2015-July/018095.html
>
> Kevin.
>
> *From:*Na Zhu [mailto:zhunatuzi at gmail.com]
> *Sent:* Wednesday, July 15, 2015 6:16 AM
> *To:* Traynor, Kevin
> *Subject:* Re: [ovs-discuss] ovs-dpdk performance is not good
>
> Hi Kevin,
>
> The interface MTU is 1500, the TCP message size is 16384 and the UDP 
> message size is 65507.
>
> How to use DPDK virtio PMD?
>
in DPDK virtio PMD, it uses mergeable feature to support jumbo frame,
the mergeable feature need negotiate with vhost on the backend,
so if ovs enable the mergeable feature, and virtio can succeed in 
negotiating this feature,
then jumbo frame can be supported.

thanks
Changchun

> 2015-07-14 20:25 GMT+08:00 Traynor, Kevin <kevin.traynor at intel.com 
> <mailto:kevin.traynor at intel.com>>:
>
>     *From:*discuss [mailto:discuss-bounces at openvswitch.org
>     <mailto:discuss-bounces at openvswitch.org>] *On Behalf Of *Na Zhu
>     *Sent:* Monday, July 13, 2015 3:15 AM
>     *To:* bugs at openvswitch.org <mailto:bugs at openvswitch.org>
>     *Subject:* [ovs-discuss] ovs-dpdk performance is not good
>
>     Dear all,
>
>     I want to use ovs-dpdk to improve my nfv performance. But when i
>     compare the throughput between standard ovs and ovs-dpdk, the ovs
>     is better, does anyone know why?
>
>     I use netperf to test the throughput.
>
>     use vhost-net to test standard ovs.
>
>     use vhost-user to test ovs-dpdk.
>
>     My topology is as follow:
>
>     内嵌图片 1
>
>     The result is that standard ovs performance is better. Throughput
>     unit Mbps.
>
>     内嵌图片 2
>
>     内嵌图片 3
>
>     [kt] I would check your core affinitization to ensure that the
>     vswitchd
>
>     pmd is on a separate core to the vCPUs (set with
>     other_config:pmd-cpu-mask).
>
>     Also, this test is not using the DPDK vitrio PMD in the guest
>     which provides
>
>     performance gains.
>
>     What packet sizes are you using? you should see a greater gain
>     from DPDK
>
>     at lower packet sizes (i.e. more PPS)
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/d7f8d36f/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 16645 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/d7f8d36f/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 11447 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/d7f8d36f/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 9044 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/d7f8d36f/attachment-0005.png>

From abhishekv.verma at gmail.com  Fri Jul 17 01:21:27 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 17 Jul 2015 13:51:27 +0530
Subject: [ovs-discuss] Programmers Guide
Message-ID: <CADDmorTLfinyx0t_7CCavYo6aAxEVKi5GgRTLY+haK0Vt=N4VQ@mail.gmail.com>

Hi,

Is there a programmer's guide or some reference material that i could
browse/read to get a handle on how open vswitch code has been organized and
works?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/b9c743ff/attachment.html>

From daniel.herrmann at igd.fraunhofer.de  Fri Jul 17 01:43:20 2015
From: daniel.herrmann at igd.fraunhofer.de (Daniel Herrmann)
Date: Fri, 17 Jul 2015 10:43:20 +0200
Subject: [ovs-discuss] Problems with MPLS header pushing
Message-ID: <55A8C028.1060308@igd.fraunhofer.de>

 Hi,

I have installed OVS 2.3.2-1 on a Debian Wheezy(7.8) maschine. Two
interfaces (eth1 and eth2) are connected to bridge 0:

--- schnip ---
root at SOF:~# ovs-ofctl -O OpenFlow13 show br0
OFPT_FEATURES_REPLY (OF1.3) (xid=0x2): dpid:aaaaaaaaaaaaaa19
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS
OFPST_PORT_DESC reply (OF1.3) (xid=0x3):
 4(eth1): addr:00:50:56:82:c5:47
     config:     0
     state:      0
     current:    10GB-FD COPPER
     advertised: COPPER
     supported:  1GB-FD 10GB-FD COPPER
     speed: 10000 Mbps now, 10000 Mbps max
 5(eth2): addr:00:50:56:82:5f:a4
     config:     0
     state:      0
     current:    10GB-FD COPPER
     advertised: COPPER
     supported:  1GB-FD 10GB-FD COPPER
     speed: 10000 Mbps now, 10000 Mbps max
 LOCAL(br0): addr:00:50:56:82:5f:a4
     config:     PORT_DOWN
     state:      LINK_DOWN
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (OF1.3) (xid=0x5): frags=normal miss_send_len=0
--- snap ---

I am using Ryu to program the switch and I am trying to implement basic
Segment Routing support based on MPLS. For example, packages coming into
eth1 should be encapsulated in an MPLS header using an appropriate
label. Actually, I think the flow generation part works:

--- snip ---
root at SOF:~# ovs-ofctl -O OpenFlow13 dump-flows br0
OFPST_FLOW reply (OF1.3) (xid=0x2):
 cookie=0x0, duration=327.703s, table=0, n_packets=325, n_bytes=31850,
ip,in_port=4,nw_dst=10.0.0.88/29
actions=write_metadata:0x15/0xff,goto_table:10
 cookie=0x0, duration=327.703s, table=0, n_packets=0, n_bytes=0,
ip,in_port=4,nw_dst=20.0.0.0/8
actions=write_metadata:0x14/0xff,goto_table:10
 cookie=0x0, duration=327.703s, table=0, n_packets=0, n_bytes=0,
ip,in_port=4,nw_dst=21.0.0.0/8
actions=write_metadata:0x15/0xff,goto_table:10
 cookie=0x0, duration=327.703s, table=10, n_packets=0, n_bytes=0,
ip,metadata=0x14
actions=set_field:00:50:56:82:b2:66->eth_dst,set_field:00:50:56:82:5f:a4->eth_src,push_mpls:0x8847,set_field:16020->mpls_label,output:5
 cookie=0x0, duration=327.703s, table=10, n_packets=325, n_bytes=31850,
ip,metadata=0x15
actions=set_field:00:50:56:82:b2:66->eth_dst,set_field:00:50:56:82:5f:a4->eth_src,push_mpls:0x8847,set_field:16021->mpls_label,output:5
 --- snap ---

As you can see, I am using a two-table approach using metadata. The
first table basically identifies the target, the second adds MPLS header
and label. Now, If I am sending packages into Port 5, it is matching
both rules in Table 0 and Table 10, so actually it should be forwarded.
tcpdump on eth1 shows the packages coming in, however tcpdump on eth2
does not see any packages going out. Tracing example packages however
show, that the package actually should be processed correctly:

--- snip ---
root at SOF:~# ovs-appctl ofproto/trace br0
in_port=4,dl_dst=00:50:56:82:c5:47,ip,ip_dst=21.0.0.1
Bridge: br0
Flow:
ip,metadata=0,in_port=4,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:50:56:82:c5:47,nw_src=0.0.0.0,nw_dst=21.0.0.1,nw_tos=0,nw_ecn=0,nw_ttl=0
Rule: table=0 cookie=0 ip,in_port=4,nw_dst=21.0.0.0/8
OpenFlow actions=write_metadata:0x15/0xff,goto_table:10

    Resubmitted flow:
ip,metadata=0x15,in_port=4,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:50:56:82:c5:47,nw_src=0.0.0.0,nw_dst=21.0.0.1,nw_tos=0,nw_ecn=0,nw_ttl=0
    Resubmitted regs: reg0=0x0 reg1=0x0 reg2=0x0 reg3=0x0 reg4=0x0
reg5=0x0 reg6=0x0 reg7=0x0
    Resubmitted  odp: drop
    Resubmitted megaflow:
recirc_id=0,skb_priority=0,ip,metadata=0,in_port=4,dl_src=00:00:00:00:00:00,dl_dst=00:50:56:82:c5:47,nw_src=0.0.0.0,nw_dst=21.0.0.1,nw_proto=0,nw_frag=no
    Rule: table=10 cookie=0 ip,metadata=0x15
    OpenFlow
actions=set_field:00:50:56:82:b2:66->eth_dst,set_field:00:50:56:82:5f:a4->eth_src,push_mpls:0x8847,set_field:16021->mpls_label,output:5

Final flow:
mpls,metadata=0x15,in_port=4,vlan_tci=0x0000,dl_src=00:50:56:82:5f:a4,dl_dst=00:50:56:82:b2:66,mpls_label=16021,mpls_tc=0,mpls_ttl=64,mpls_bos=1
Megaflow:
recirc_id=0,skb_priority=0,ip,metadata=0,in_port=4,dl_src=00:00:00:00:00:00,dl_dst=00:50:56:82:c5:47,nw_src=0.0.0.0,nw_dst=21.0.0.1,nw_proto=0,nw_tos=0,nw_ttl=0,mpls_label=0,mpls_tc=0,mpls_ttl=0,mpls_bos=0,mpls_lse1=0,mpls_lse2=0,nw_frag=no
Datapath actions:
set(eth(src=00:50:56:82:5f:a4,dst=00:50:56:82:b2:66)),push_mpls(label=16021,tc=0,ttl=64,bos=1,eth_type=0x8847),3
--- snap ---

The datapath ports look like this:

--- snip ---
root at SOF:~# ovs-dpctl show
system at ovs-system:
    lookups: hit:61368 missed:60694 lost:0
    flows: 1
    masks: hit:154718 total:2 hit/pkt:1.27
    port 0: ovs-system (internal)
    port 1: br0 (internal)
    port 2: eth1
    port 3: eth2
--- snap ---

So... what am I missing here? Why are the packets not forwarded? If
required, I can also post the Ryu code used to generate the flow rules.

Thanks in advance!
Best regards
  Daniel

From abhishekv.verma at gmail.com  Fri Jul 17 04:56:01 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 17 Jul 2015 17:26:01 +0530
Subject: [ovs-discuss] Routing at the termination point
In-Reply-To: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
References: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
Message-ID: <CADDmorQGztYcJU_J9-XkgRLuCdnJYr5=WbZmJ5Vv40QA-GBKoA@mail.gmail.com>

I have set /proc/sys/net/ipv4/ip_forward=1 and have ensured that this is
set to 1 for all the participating ports.

I send the packet with the OVS bridge's MAC address. This means that when
the GRE header is popped off, the packet's dest MAC is the same as that of
the OVS bridge. I now expect the linux kernel to kick in. I however dont
see the packet getting forwarded. Can somebody guide me on what else i can
look at?

>From the logs you can see that the packet after GRE decap comes with the
MAC address of the OVS bridge.

root at akabra:/proc/sys/net/ipv4/conf# tcpdump -xx -ni OFSWITCH not port 22
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on OFSWITCH, link-type EN10MB (Ethernet), capture size 65535 bytes
11:52:48.980347 IP 52.27.111.115 > 172.31.1.48: GREv0, key=0x258, length
106: IP 8.8.8.1 > 202.83.17.191: ICMP echo request, id 23162, seq 476,
length 64
0x0000:  0645 1ad2 1ced 0628 ae10 f98a 0800 4500
0x0010:  007e 9f8d 4000 352f 54e6 341b 6f73 ac1f
0x0020:  0130 2000 6558 0000 0258 0645 1ad2 1ced
0x0030:  5e21 e8f3 446a 0800 4500 0054 bf46 4000
0x0040:  4001 8f47 0808 0801 ca53 11bf 0800 bb3f
0x0050:  5a7a 01dc 96ec a855 0000 0000 d854 0a00
0x0060:  0000 0000 1011 1213 1415 1617 1819 1a1b
0x0070:  1c1d 1e1f 2021 2223 2425 2627 2829 2a2b
0x0080:  2c2d 2e2f 3031 3233 3435 3637
11:52:48.980347 IP 8.8.8.1 > 202.83.17.191: ICMP echo request, id 23162,
seq 476, length 64
0x0000:  0645 1ad2 1ced 5e21 e8f3 446a 0800 4500
0x0010:  0054 bf46 4000 4001 8f47 0808 0801 ca53
0x0020:  11bf 0800 bb3f 5a7a 01dc 96ec a855 0000
0x0030:  0000 d854 0a00 0000 0000 1011 1213 1415
0x0040:  1617 1819 1a1b 1c1d 1e1f 2021 2223 2425
0x0050:  2627 2829 2a2b 2c2d 2e2f 3031 3233 3435
0x0060:  3637

root at akabra:/proc/sys/net/ipv4/conf# ovs-ofctl show OFSWITCH
OFPT_FEATURES_REPLY (xid=0x2): dpid:000006451ad21ced
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
 1(eth0): addr:06:45:1a:d2:1c:ed
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 3(gre0): addr:da:67:8f:b2:c1:34
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 LOCAL(OFSWITCH): addr:06:45:1a:d2:1c:ed
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0

Thanks, Abhishek

On Thu, Jul 16, 2015 at 2:57 PM, Abhishek Verma <abhishekv.verma at gmail.com>
wrote:

> Hi,
>
> I am using a GRE tunnel to connect two VMs, VM-A and VM-B. VM-B is
> connected to other networks as well.
>
> I want the packets terminating at the GRE tunnel on VM-B, to do an L3
> lookup, and to get forwarded based on the result of the L3 lookup.
>
> To do this, i changed the destination MAC at the ingress (on VM-A) to
> match the MAC address of one of the ports on VM-B. This way when the
> packets emerge from the GRE tunnel, they already have a dest MAC that
> matches one of its port MACs. I assumed that because of this the kernel
> will automatically do an L3 lookup and will forward the packet out to the
> right place. However, this isnt happening, and am wondering why.
>
> I see that i am able to ping the interface if it resides on VM-B. I can
> however, not get the VM-B to L3 route that packet out. I want the packet to
> be looked up in the L3 kernel table and get forwarded out. Is there
> anything that i am missing here.
>
> My configs:
>
> *The packet arrives on a GRE tunnel (port 4) and i hence add a rule which
> says that anything arriving on port 4, should undergo normal (L2 and L3)
> processing. However, since the dest MAC matches one of the port's MACs, i
> expect the packet to undergo L3 processing.*
>
> root@:/home/ubuntu# ovs-ofctl show OFSWITCH
> OFPT_FEATURES_REPLY (xid=0x2): dpid:000006451ad21ced
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
> SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>  1(eth0): addr:06:45:1a:d2:1c:ed
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
>  4(gre0): addr:06:48:6f:be:b0:f5
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
>  LOCAL(OFSWITCH): addr:06:45:1a:d2:1c:ed
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> root@:/home/ubuntu#
>
> root@:/home/ubuntu# ovs-ofctl dump-flows OFSWITCH
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=147000.263s, table=0, n_packets=196105,
> n_bytes=117995996, idle_age=0, hard_age=65534, priority=0 actions=NORMAL
>  cookie=0x0, duration=1185.832s, table=0, n_packets=62, n_bytes=6076,
> idle_age=971, priority=501,in_port=4 actions=NORMAL
>
>
> Thanks, Abhishek
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/67b1e854/attachment-0001.html>

From shettyg at nicira.com  Fri Jul 17 07:56:09 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 17 Jul 2015 07:56:09 -0700
Subject: [ovs-discuss] Flooding of packets destined to OVS port's mac
	address
In-Reply-To: <54F3CC316BCACF48A126BE3ED38CD1F319B4EE7C@SGSIMBX005.nsn-intra.net>
References: <54F3CC316BCACF48A126BE3ED38CD1F319B4E84C@SGSIMBX005.nsn-intra.net>
 <CAHbON5piZJMbkvfRtvoe726nP9wu-7DzB1A1Z4b0Ki7O2DSaYA@mail.gmail.com>
 <54F3CC316BCACF48A126BE3ED38CD1F319B4EE7C@SGSIMBX005.nsn-intra.net>
Message-ID: <CAHbON5rG=vRmptfseDc6uj9tzhbpm4Ofn7MHxYVqj6EVzigymw@mail.gmail.com>

I re-read your question properly again. The behavior that you see looks
correct to me. OVS is a switch and switch's ports don't have mac addresses.
It only cares about the mac addresses in the packet.

On Fri, Jul 17, 2015 at 12:13 AM, Pujar, Shyam (Nokia - IN/Bangalore) <
shyam.pujar at nokia.com> wrote:

>  Hi,
>
>                 MAC addresses mentioned in the diagram are just for
> example.
>
> MAC addresses used were as follows:
>
>
>
> Client Program:
>
> 52:54:00:00:01:02
>
>
>
> Server Program:
>
> 52:56:11:80:80:41
>
>
>
> TAP1:
>
> 52:F3:12:E4:6D:A9
>
>
>
> TAP2:
>
> 72:17:32:32:15:F8
>
>
>
> Regards,
>
> Shyam
>
>
>
> *From:* ext Gurucharan Shetty [mailto:shettyg at nicira.com]
> *Sent:* Thursday, July 16, 2015 11:48 PM
> *To:* Pujar, Shyam (Nokia - IN/Bangalore)
> *Cc:* bugs at openvswitch.org
> *Subject:* Re: [ovs-discuss] Flooding of packets destined to OVS port's
> mac address
>
>
>
> I don't know the answer, but some of your mac addresses have multi-cast
> bit enabled. So I wonder whether that is the problem.
>
>
>
> On Wed, Jul 15, 2015 at 12:18 PM, Pujar, Shyam (Nokia - IN/Bangalore) <
> shyam.pujar at nokia.com> wrote:
>
> Hi ,
>
>         Please find setup and testing procedure below.
>
>
>
>
>
> 1.       In the above setup, Client Program tries to send packet with
> src_mac: 3:3:3:3:3:3  and dst_mac: 1:1:1:1:1:1.
>
> 2.       Packet is flood to port tap2.
>
> 3.       Why does OVS flood packets when dst_mac received is its own
> port’s mac address.
>
> 4.       As it forwards to other ports, there is no one to reply for
> dst_mac other than OVS bridge itself.
>
> 5.       Where as in case of Linux bridge, packet is not flooded to other
> ports. Instead packet is dropped.
>
>
>
> Could you please tell me how do switches in real work? As per my
> understanding there should be static entries in forwarding table of switch
> for its own mac addresses.
>
> And default action should be present for it.
>
>
>
>
>
> Regards,
>
> Shyam
>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/3f187a0d/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 18205 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/3f187a0d/attachment-0001.jpg>

From shettyg at nicira.com  Fri Jul 17 07:57:15 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 17 Jul 2015 07:57:15 -0700
Subject: [ovs-discuss] Programmers Guide
In-Reply-To: <CADDmorTLfinyx0t_7CCavYo6aAxEVKi5GgRTLY+haK0Vt=N4VQ@mail.gmail.com>
References: <CADDmorTLfinyx0t_7CCavYo6aAxEVKi5GgRTLY+haK0Vt=N4VQ@mail.gmail.com>
Message-ID: <CAHbON5pHeEuqpYuCGWJFLnE=1PpF1HbCd-bH7d1GGjSeYVBiHA@mail.gmail.com>

Nope. The code changes so fast that I think it is really hard to
maintain a manual.

On Fri, Jul 17, 2015 at 1:21 AM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Hi,
>
> Is there a programmer's guide or some reference material that i could
> browse/read to get a handle on how open vswitch code has been organized and
> works?
>
> Thanks, Abhishek
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From blp at nicira.com  Fri Jul 17 08:06:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 17 Jul 2015 08:06:59 -0700
Subject: [ovs-discuss] Routing at the termination point
In-Reply-To: <CADDmorQGztYcJU_J9-XkgRLuCdnJYr5=WbZmJ5Vv40QA-GBKoA@mail.gmail.com>
References: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
 <CADDmorQGztYcJU_J9-XkgRLuCdnJYr5=WbZmJ5Vv40QA-GBKoA@mail.gmail.com>
Message-ID: <20150717150659.GB10847@nicira.com>

### Q: I have a sophisticated network setup involving Open vSwitch, VMs or
   multiple hosts, and other components.  The behavior isn't what I
   expect.  Help!

A: To debug network behavior problems, trace the path of a packet,
   hop-by-hop, from its origin in one host to a remote host.  If
   that's correct, then trace the path of the response packet back to
   the origin.

   Usually a simple ICMP echo request and reply ("ping") packet is
   good enough.  Start by initiating an ongoing "ping" from the origin
   host to a remote host.  If you are tracking down a connectivity
   problem, the "ping" will not display any successful output, but
   packets are still being sent.  (In this case the packets being sent
   are likely ARP rather than ICMP.)

   Tools available for tracing include the following:

   - "tcpdump" and "wireshark" for observing hops across network
     devices, such as Open vSwitch internal devices and physical
     wires.

   - "ovs-appctl dpif/dump-flows <br>" in Open vSwitch 1.10 and
     later or "ovs-dpctl dump-flows <br>" in earlier versions.
     These tools allow one to observe the actions being taken on
     packets in ongoing flows.

     See ovs-vswitchd(8) for "ovs-appctl dpif/dump-flows"
     documentation, ovs-dpctl(8) for "ovs-dpctl dump-flows"
     documentation, and "Why are there so many different ways to
     dump flows?" above for some background.

   - "ovs-appctl ofproto/trace" to observe the logic behind how
     ovs-vswitchd treats packets.  See ovs-vswitchd(8) for
     documentation.  You can out more details about a given flow
     that "ovs-dpctl dump-flows" displays, by cutting and pasting
     a flow from the output into an "ovs-appctl ofproto/trace"
     command.

   - SPAN, RSPAN, and ERSPAN features of physical switches, to
     observe what goes on at these physical hops.

   Starting at the origin of a given packet, observe the packet at
   each hop in turn.  For example, in one plausible scenario, you
   might:

   1. "tcpdump" the "eth" interface through which an ARP egresses
      a VM, from inside the VM.

   2. "tcpdump" the "vif" or "tap" interface through which the ARP
      ingresses the host machine.

   3. Use "ovs-dpctl dump-flows" to spot the ARP flow and observe
      the host interface through which the ARP egresses the
      physical machine.  You may need to use "ovs-dpctl show" to
      interpret the port numbers.  If the output seems surprising,
      you can use "ovs-appctl ofproto/trace" to observe details of
      how ovs-vswitchd determined the actions in the "ovs-dpctl
      dump-flows" output.

   4. "tcpdump" the "eth" interface through which the ARP egresses
      the physical machine.

   5. "tcpdump" the "eth" interface through which the ARP
      ingresses the physical machine, at the remote host that
      receives the ARP.

   6. Use "ovs-dpctl dump-flows" to spot the ARP flow on the
      remote host that receives the ARP and observe the VM "vif"
      or "tap" interface to which the flow is directed.  Again,
      "ovs-dpctl show" and "ovs-appctl ofproto/trace" might help.

   7. "tcpdump" the "vif" or "tap" interface to which the ARP is
      directed.

   8. "tcpdump" the "eth" interface through which the ARP
      ingresses a VM, from inside the VM.

   It is likely that during one of these steps you will figure out the
   problem.  If not, then follow the ARP reply back to the origin, in
   reverse.

From maniksidana019 at gmail.com  Fri Jul 17 08:07:51 2015
From: maniksidana019 at gmail.com (Manik Sidana)
Date: Fri, 17 Jul 2015 20:37:51 +0530
Subject: [ovs-discuss] Routing at the termination point
In-Reply-To: <CADDmorQGztYcJU_J9-XkgRLuCdnJYr5=WbZmJ5Vv40QA-GBKoA@mail.gmail.com>
References: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
 <CADDmorQGztYcJU_J9-XkgRLuCdnJYr5=WbZmJ5Vv40QA-GBKoA@mail.gmail.com>
Message-ID: <CAG-CZ9edrvJRYSUsrsx=4iK1cM=1R0XA-sJLe=1rtHJQJOefRg@mail.gmail.com>

If the packets Mac address matches that of the ovs bridge, the packet would
be accepted by the bridge. Can you try the below
Create an SNAT rule using iptables and snat the packets with VM B's IP
address.
(Use -v option on iptables to see the rule hit counters) Use route command
and set a default route.
Do this without changing the Mac address
On 17 Jul 2015 17:26, "Abhishek Verma" <abhishekv.verma at gmail.com> wrote:

> I have set /proc/sys/net/ipv4/ip_forward=1 and have ensured that this is
> set to 1 for all the participating ports.
>
> I send the packet with the OVS bridge's MAC address. This means that when
> the GRE header is popped off, the packet's dest MAC is the same as that of
> the OVS bridge. I now expect the linux kernel to kick in. I however dont
> see the packet getting forwarded. Can somebody guide me on what else i can
> look at?
>
> From the logs you can see that the packet after GRE decap comes with the
> MAC address of the OVS bridge.
>
> root at akabra:/proc/sys/net/ipv4/conf# tcpdump -xx -ni OFSWITCH not port 22
> tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
> listening on OFSWITCH, link-type EN10MB (Ethernet), capture size 65535
> bytes
> 11:52:48.980347 IP 52.27.111.115 > 172.31.1.48: GREv0, key=0x258, length
> 106: IP 8.8.8.1 > 202.83.17.191: ICMP echo request, id 23162, seq 476,
> length 64
> 0x0000:  0645 1ad2 1ced 0628 ae10 f98a 0800 4500
> 0x0010:  007e 9f8d 4000 352f 54e6 341b 6f73 ac1f
> 0x0020:  0130 2000 6558 0000 0258 0645 1ad2 1ced
> 0x0030:  5e21 e8f3 446a 0800 4500 0054 bf46 4000
> 0x0040:  4001 8f47 0808 0801 ca53 11bf 0800 bb3f
> 0x0050:  5a7a 01dc 96ec a855 0000 0000 d854 0a00
> 0x0060:  0000 0000 1011 1213 1415 1617 1819 1a1b
> 0x0070:  1c1d 1e1f 2021 2223 2425 2627 2829 2a2b
> 0x0080:  2c2d 2e2f 3031 3233 3435 3637
> 11:52:48.980347 IP 8.8.8.1 > 202.83.17.191: ICMP echo request, id 23162,
> seq 476, length 64
> 0x0000:  0645 1ad2 1ced 5e21 e8f3 446a 0800 4500
> 0x0010:  0054 bf46 4000 4001 8f47 0808 0801 ca53
> 0x0020:  11bf 0800 bb3f 5a7a 01dc 96ec a855 0000
> 0x0030:  0000 d854 0a00 0000 0000 1011 1213 1415
> 0x0040:  1617 1819 1a1b 1c1d 1e1f 2021 2223 2425
> 0x0050:  2627 2829 2a2b 2c2d 2e2f 3031 3233 3435
> 0x0060:  3637
>
> root at akabra:/proc/sys/net/ipv4/conf# ovs-ofctl show OFSWITCH
> OFPT_FEATURES_REPLY (xid=0x2): dpid:000006451ad21ced
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST
> SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>  1(eth0): addr:06:45:1a:d2:1c:ed
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
>  3(gre0): addr:da:67:8f:b2:c1:34
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
>  LOCAL(OFSWITCH): addr:06:45:1a:d2:1c:ed
>      config:     0
>      state:      0
>      speed: 0 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>
> Thanks, Abhishek
>
> On Thu, Jul 16, 2015 at 2:57 PM, Abhishek Verma <abhishekv.verma at gmail.com
> > wrote:
>
>> Hi,
>>
>> I am using a GRE tunnel to connect two VMs, VM-A and VM-B. VM-B is
>> connected to other networks as well.
>>
>> I want the packets terminating at the GRE tunnel on VM-B, to do an L3
>> lookup, and to get forwarded based on the result of the L3 lookup.
>>
>> To do this, i changed the destination MAC at the ingress (on VM-A) to
>> match the MAC address of one of the ports on VM-B. This way when the
>> packets emerge from the GRE tunnel, they already have a dest MAC that
>> matches one of its port MACs. I assumed that because of this the kernel
>> will automatically do an L3 lookup and will forward the packet out to the
>> right place. However, this isnt happening, and am wondering why.
>>
>> I see that i am able to ping the interface if it resides on VM-B. I can
>> however, not get the VM-B to L3 route that packet out. I want the packet to
>> be looked up in the L3 kernel table and get forwarded out. Is there
>> anything that i am missing here.
>>
>> My configs:
>>
>> *The packet arrives on a GRE tunnel (port 4) and i hence add a rule which
>> says that anything arriving on port 4, should undergo normal (L2 and L3)
>> processing. However, since the dest MAC matches one of the port's MACs, i
>> expect the packet to undergo L3 processing.*
>>
>> root@:/home/ubuntu# ovs-ofctl show OFSWITCH
>> OFPT_FEATURES_REPLY (xid=0x2): dpid:000006451ad21ced
>> n_tables:254, n_buffers:256
>> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
>> actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC
>> SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
>>  1(eth0): addr:06:45:1a:d2:1c:ed
>>      config:     0
>>      state:      0
>>      speed: 0 Mbps now, 0 Mbps max
>>  4(gre0): addr:06:48:6f:be:b0:f5
>>      config:     0
>>      state:      0
>>      speed: 0 Mbps now, 0 Mbps max
>>  LOCAL(OFSWITCH): addr:06:45:1a:d2:1c:ed
>>      config:     0
>>      state:      0
>>      speed: 0 Mbps now, 0 Mbps max
>> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>> root@:/home/ubuntu#
>>
>> root@:/home/ubuntu# ovs-ofctl dump-flows OFSWITCH
>> NXST_FLOW reply (xid=0x4):
>>  cookie=0x0, duration=147000.263s, table=0, n_packets=196105,
>> n_bytes=117995996, idle_age=0, hard_age=65534, priority=0 actions=NORMAL
>>  cookie=0x0, duration=1185.832s, table=0, n_packets=62, n_bytes=6076,
>> idle_age=971, priority=501,in_port=4 actions=NORMAL
>>
>>
>> Thanks, Abhishek
>>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/6c65d5b7/attachment-0001.html>

From d.reade at Reades.co.uk  Fri Jul 17 08:09:01 2015
From: d.reade at Reades.co.uk (David Reade)
Date: Fri, 17 Jul 2015 16:09:01 +0100
Subject: [ovs-discuss] FW: Traffic Mirroring using XenServer and OpenVSwitch
Message-ID: <0E6E632C7139354E9310905023FAF9CA844DC46799@L1VS02SBS08.reades.local>

Anyone?

-----Original Message-----
From: David Reade 
Sent: 13 July 2015 09:07
To: 'discuss at openvswitch.org'
Subject: Traffic Mirroring using XenServer and OpenVSwitch

Good morning all!

I am using XenServer 6.5 SP1 with OpenVSwitch 2.1.3 and I need to mirror traffic from the source port (vif2.0) to the destination port (vif13.1). I have enabled promiscuous mode on the PIF and target VIF. Using the following command, I can enable traffic mirroring and see the results instantly:

ovs-vsctl -- set Bridge xenbr1 mirrors=@m \
-- --id=@vif2.0 get Port vif2.0 \
-- --id=@vif13.1 get Port vif13.1 \
-- --id=@m create Mirror name=MyMirror select-all=true output-port=@vif13.1

However the port information changes every time the source/target VM is rebooted. This means I have to keep re-adding the mirror every time I reboot a VM using different VIFs which is not practical.

I have devised a way to get the current VIF ID and send it to OVS using a cron job or shell script. However I would prefer to just run a single command without resorting to cron jobs and shell scripts as they need managing themselves.
 
Is there a way to setup traffic mirroring to run permanently which is unaffected by VM reboots?

Thanks in advance,

David

From shettyg at nicira.com  Fri Jul 17 08:26:27 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 17 Jul 2015 08:26:27 -0700
Subject: [ovs-discuss] Traffic Mirroring using XenServer and OpenVSwitch
In-Reply-To: <0E6E632C7139354E9310905023FAF9CA842C2E9430@L1VS02SBS08.reades.local>
References: <0E6E632C7139354E9310905023FAF9CA842C2E9430@L1VS02SBS08.reades.local>
Message-ID: <CAHbON5qr-8yVazO8maC6540LDSF7WnL-qN8voB2UbUbEc1KwgQ@mail.gmail.com>

On Mon, Jul 13, 2015 at 1:06 AM, David Reade <d.reade at reades.co.uk> wrote:
> Good morning all!
>
> I am using XenServer 6.5 SP1 with OpenVSwitch 2.1.3 and I need to mirror traffic from the source port (vif2.0) to the destination port (vif13.1). I have enabled promiscuous mode on the PIF and target VIF. Using the following command, I can enable traffic mirroring and see the results instantly:
>
> ovs-vsctl -- set Bridge xenbr1 mirrors=@m \
> -- --id=@vif2.0 get Port vif2.0 \
> -- --id=@vif13.1 get Port vif13.1 \
> -- --id=@m create Mirror name=MyMirror select-all=true output-port=@vif13.1
>
> However the port information changes every time the source/target VM is rebooted. This means I have to keep re-adding the mirror every time I reboot a VM using different VIFs which is not practical.

It has bee a while that I have used Xenserver, so I have a couple of
counter questions for you. When a VM is rebooted, does Xenserver
delete the vif and re-add it? Does it get added with a different vif
name? You can test it with doing a 'ovs-vsctl show' before the
shutdown. Again after "shutdown" and again after "start".  If I
remember correctly the name remains the same. But it likely deletes it
and re-adds it. If it does the latter, I see how your mirror
configuration gets destroyed.

Usually such situations are handled via a controller, which watches
OVSDB for changes and re-creates the mirror if it gets destroyed.

If you don't want to use a cron job, another option is to not setup
your mirror on the same bridge that has your vif attached. You can use
a different bridge for each of your vif and then connect them to a
separate bridge via a OVS patch port. You can add your mirror on this
separate bridge which does not get effected with vm reboots.


>
> I have devised a way to get the current VIF ID and send it to OVS using a cron job or shell script. However I would prefer to just run a single command without resorting to cron jobs and shell scripts as they need managing themselves.
>
> Is there a way to setup traffic mirroring to run permanently which is unaffected by VM reboots?
>
> Thanks in advance,
>
> David
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From athompson at avant.ca  Fri Jul 17 08:44:01 2015
From: athompson at avant.ca (Adam Thompson)
Date: Fri, 17 Jul 2015 10:44:01 -0500
Subject: [ovs-discuss] SPF errors for this mailing list
Message-ID: <CAFGv8b8OiA9StnDuEZ_8cQ8vfYxW5w4mqz85=iFF=_0qjBQw9A@mail.gmail.com>

I'm noticing that *every* *single* *email* from this list gets dumped into
Google Mail's Spam folder, because of a typo in the SPF record.

Received-SPF: fail (google.com: domain of
discuss-bounces at openvswitch.org does not designate
2600:3c00::f03c:91ff:fe6e:bdf7 as permitted sender) client-ip=
> ​​
> 2600:3c00::f03c:91ff:fe6e:bdf7;
>
>
The SPF record for openvswitch.org contains
"ipv6:2600:3c00::f03c:91ff:fe6e:bdf7", but the correct syntax is "ip6:",
not "ipv6:".

Can someone make that minor syntax correction in the DNS entry?  I'm hoping
that someone reads discuss...?


  [image: Avant logo] *Adam Thompson*
Senior Systems Administrator
*voice:* 204.789.9596 x24 | *email:* athompson at avant.ca | *web:* avant.ca
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/8bf59256/attachment.html>

From blp at nicira.com  Fri Jul 17 09:42:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 17 Jul 2015 09:42:04 -0700
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <55A886CE.3040305@gmail.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
 <55A886CE.3040305@gmail.com>
Message-ID: <20150717164204.GG10847@nicira.com>

On Fri, Jul 17, 2015 at 01:38:38PM +0900, Minoru TAKAHASHI wrote:
> For starters, I've created patches that fixes the following problem.
> 
> >> I’ve checked the source code of "ofputil_encode_group_desc_request", such a process it could not find.
> >>
> >>   * ofputil_encode_group_desc_request
> >>   https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L7274-L7279
> 
> I would like you to review my patches.

Thank you for the patches.  They are going in the right direction, but
because they do not make the corresponding change to the decoder they
break two tests:

## ------------------------------ ##
## openvswitch 2.4.90 test suite. ##
## ------------------------------ ##

694: ofproto - del group (OpenFlow 1.5)              FAILED (ofproto.at:350)
696: ofproto - insert buckets                        FAILED (ofproto.at:424)

From abhishekv.verma at gmail.com  Fri Jul 17 09:49:46 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 17 Jul 2015 22:19:46 +0530
Subject: [ovs-discuss] Routing at the termination point
In-Reply-To: <20150717150659.GB10847@nicira.com>
References: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
 <CADDmorQGztYcJU_J9-XkgRLuCdnJYr5=WbZmJ5Vv40QA-GBKoA@mail.gmail.com>
 <20150717150659.GB10847@nicira.com>
Message-ID: <CADDmorSAt5WMGR8L917_Scdr5z8Dn+=bwDAv+YQuW2nQijCX0g@mail.gmail.com>

Hi Ben,

I understand its exasperating for you and other veterans to respond to
questions like forwarding not working, etc. However, i did enough googling
and i really couldnt, and am still unable to, figure out the real problem.

I am trying to see why the L3 packet is not going out and i see this:

I am constantly sending the ping traffic. As a result of that, i see the
following flow in the dataplane being created.

root at ip-172-31-1-48:~# ovs-dpctl dump-flows
skb_priority(0),tunnel(tun_id=0x258,src=52.27.111.115,dst=172.31.1.48,tos=0x0,ttl=53,flags(key)),in_port(4),skb_mark(0),eth(src=5e:21:e8:f3:44:6a,dst=06:45:1a:d2:1c:ed),eth_type(0x0800),ipv4(src=
8.8.8.1/0.0.0.0,dst=202.83.17.191/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
packets:1351, bytes:132398, used:0.340s, actions:1

Based on this flow i created a flow-rule which i expect the packet to
always hit:

root at ip-172-31-1-48:~# ovs-ofctl dump-flows ion1
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=26573.649s, table=0, n_packets=34881,
n_bytes=4025577, idle_age=0, priority=0 actions=NORMAL
 cookie=0x0, duration=338.021s, table=0, n_packets=0, n_bytes=0,
idle_age=338, priority=500,ip,in_port=4,nw_dst=202.83.17.191
actions=output:2

However, for some reason i dont see my packets hitting the rule that i have
created.

This is strange since i created this based on the flow that was created in
the kernel.

Thanks, Abhishek

On Fri, Jul 17, 2015 at 8:36 PM, Ben Pfaff <blp at nicira.com> wrote:

> ### Q: I have a sophisticated network setup involving Open vSwitch, VMs or
>    multiple hosts, and other components.  The behavior isn't what I
>    expect.  Help!
>
> A: To debug network behavior problems, trace the path of a packet,
>    hop-by-hop, from its origin in one host to a remote host.  If
>    that's correct, then trace the path of the response packet back to
>    the origin.
>
>    Usually a simple ICMP echo request and reply ("ping") packet is
>    good enough.  Start by initiating an ongoing "ping" from the origin
>    host to a remote host.  If you are tracking down a connectivity
>    problem, the "ping" will not display any successful output, but
>    packets are still being sent.  (In this case the packets being sent
>    are likely ARP rather than ICMP.)
>
>    Tools available for tracing include the following:
>
>    - "tcpdump" and "wireshark" for observing hops across network
>      devices, such as Open vSwitch internal devices and physical
>      wires.
>
>    - "ovs-appctl dpif/dump-flows <br>" in Open vSwitch 1.10 and
>      later or "ovs-dpctl dump-flows <br>" in earlier versions.
>      These tools allow one to observe the actions being taken on
>      packets in ongoing flows.
>
>      See ovs-vswitchd(8) for "ovs-appctl dpif/dump-flows"
>      documentation, ovs-dpctl(8) for "ovs-dpctl dump-flows"
>      documentation, and "Why are there so many different ways to
>      dump flows?" above for some background.
>
>    - "ovs-appctl ofproto/trace" to observe the logic behind how
>      ovs-vswitchd treats packets.  See ovs-vswitchd(8) for
>      documentation.  You can out more details about a given flow
>      that "ovs-dpctl dump-flows" displays, by cutting and pasting
>      a flow from the output into an "ovs-appctl ofproto/trace"
>      command.
>
>    - SPAN, RSPAN, and ERSPAN features of physical switches, to
>      observe what goes on at these physical hops.
>
>    Starting at the origin of a given packet, observe the packet at
>    each hop in turn.  For example, in one plausible scenario, you
>    might:
>
>    1. "tcpdump" the "eth" interface through which an ARP egresses
>       a VM, from inside the VM.
>
>    2. "tcpdump" the "vif" or "tap" interface through which the ARP
>       ingresses the host machine.
>
>    3. Use "ovs-dpctl dump-flows" to spot the ARP flow and observe
>       the host interface through which the ARP egresses the
>       physical machine.  You may need to use "ovs-dpctl show" to
>       interpret the port numbers.  If the output seems surprising,
>       you can use "ovs-appctl ofproto/trace" to observe details of
>       how ovs-vswitchd determined the actions in the "ovs-dpctl
>       dump-flows" output.
>
>    4. "tcpdump" the "eth" interface through which the ARP egresses
>       the physical machine.
>
>    5. "tcpdump" the "eth" interface through which the ARP
>       ingresses the physical machine, at the remote host that
>       receives the ARP.
>
>    6. Use "ovs-dpctl dump-flows" to spot the ARP flow on the
>       remote host that receives the ARP and observe the VM "vif"
>       or "tap" interface to which the flow is directed.  Again,
>       "ovs-dpctl show" and "ovs-appctl ofproto/trace" might help.
>
>    7. "tcpdump" the "vif" or "tap" interface to which the ARP is
>       directed.
>
>    8. "tcpdump" the "eth" interface through which the ARP
>       ingresses a VM, from inside the VM.
>
>    It is likely that during one of these steps you will figure out the
>    problem.  If not, then follow the ARP reply back to the origin, in
>    reverse.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/06141463/attachment-0001.html>

From blp at nicira.com  Fri Jul 17 09:52:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 17 Jul 2015 09:52:51 -0700
Subject: [ovs-discuss] Routing at the termination point
In-Reply-To: <CADDmorSAt5WMGR8L917_Scdr5z8Dn+=bwDAv+YQuW2nQijCX0g@mail.gmail.com>
References: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
 <CADDmorQGztYcJU_J9-XkgRLuCdnJYr5=WbZmJ5Vv40QA-GBKoA@mail.gmail.com>
 <20150717150659.GB10847@nicira.com>
 <CADDmorSAt5WMGR8L917_Scdr5z8Dn+=bwDAv+YQuW2nQijCX0g@mail.gmail.com>
Message-ID: <20150717165251.GH10847@nicira.com>

On Fri, Jul 17, 2015 at 10:19:46PM +0530, Abhishek Verma wrote:
> Hi Ben,
> 
> I understand its exasperating for you and other veterans to respond to
> questions like forwarding not working, etc. However, i did enough googling
> and i really couldnt, and am still unable to, figure out the real problem.
> 
> I am trying to see why the L3 packet is not going out and i see this:
> 
> I am constantly sending the ping traffic. As a result of that, i see the
> following flow in the dataplane being created.
> 
> root at ip-172-31-1-48:~# ovs-dpctl dump-flows
> skb_priority(0),tunnel(tun_id=0x258,src=52.27.111.115,dst=172.31.1.48,tos=0x0,ttl=53,flags(key)),in_port(4),skb_mark(0),eth(src=5e:21:e8:f3:44:6a,dst=06:45:1a:d2:1c:ed),eth_type(0x0800),ipv4(src=
> 8.8.8.1/0.0.0.0,dst=202.83.17.191/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
> packets:1351, bytes:132398, used:0.340s, actions:1
> 
> Based on this flow i created a flow-rule which i expect the packet to
> always hit:
> 
> root at ip-172-31-1-48:~# ovs-ofctl dump-flows ion1
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=26573.649s, table=0, n_packets=34881,
> n_bytes=4025577, idle_age=0, priority=0 actions=NORMAL
>  cookie=0x0, duration=338.021s, table=0, n_packets=0, n_bytes=0,
> idle_age=338, priority=500,ip,in_port=4,nw_dst=202.83.17.191
> actions=output:2
> 
> However, for some reason i dont see my packets hitting the rule that i have
> created.
> 
> This is strange since i created this based on the flow that was created in
> the kernel.

Did you use the correct userspace port number, i.e. one from "ovs-ofctl
show ion1"?

From workbu at 163.com  Thu Jul 16 19:57:13 2015
From: workbu at 163.com (zy)
Date: Fri, 17 Jul 2015 10:57:13 +0800 (CST)
Subject: [ovs-discuss] ovs-vswitchd:
 ovs|15644|odp_util(revalidator_1168)|ERR|mask expected for non-Ethernet II
In-Reply-To: <20150716183813.GK11792@nicira.com>
References: <216b8690.44ee.14e8f9d35e0.Coremail.workbu@163.com>
 <20150716183813.GK11792@nicira.com>
Message-ID: <38c80948.4733.14e99f1bd5d.Coremail.workbu@163.com>

Thanks a lot! 
But we hardly to upgrade the OVS in the env due to some restrict , is there any other method to solve it?  If possible, could I disable something to prevent the error prompts in the log?
Or Who can explain here why this error occurs ? What possibly reason will result in it?  Does it affect my perfomance?  Because the function seems work fine now....  We can safely to omit it and treat is as the alarm? 

Thanks in advance!


At 2015-07-17 02:38:13, "Ben Pfaff" <blp at nicira.com> wrote:
>On Wed, Jul 15, 2015 at 10:48:41AM +0800, zy wrote:
>> The openvswitch 's version show as below:
>> 
>> kmod-openvswitch-2.1.2-2.ibm.el6.x86_64
>> openvswitch-2.1.2-3.ibm.el6.x86_64
>> 
>> Is there any clue ?
>
>OVS 2.1.x isn't a long-term support release, and it's pretty old, and
>that's not the newest version in branch-2.1, so I'd recommend upgrading.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/60c008d3/attachment-0001.html>

From zhunatuzi at gmail.com  Thu Jul 16 20:55:04 2015
From: zhunatuzi at gmail.com (Na Zhu)
Date: Fri, 17 Jul 2015 11:55:04 +0800
Subject: [ovs-discuss] ovs-dpdk performance is not good
In-Reply-To: <55A870D7.8060803@intel.com>
References: <CABDe9TyYE1Z03kX6DkpkSHDw0=xoHj2--+nHwb-r=fxshY6w_Q@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F745190437@IRSMSX104.ger.corp.intel.com>
 <CABDe9TwzvJd0MWOfpkSXS4Dfm-RmxN=F2a_cRup40yqTebhyuA@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F74519560F@IRSMSX104.ger.corp.intel.com>
 <55A870D7.8060803@intel.com>
Message-ID: <CABDe9TxpgJUG9D9RNSqginVuxCOhrQ+p9udA2nOuST8VRY5EXQ@mail.gmail.com>

Hi,

Can you tell me how to enable the mergeable feature in ovs?

BR

2015-07-17 11:04 GMT+08:00 Ouyang, Changchun <changchun.ouyang at intel.com>:

>
>
> On 7/16/2015 9:45 PM, Traynor, Kevin wrote:
>
>  (re-adding the ovs-discuss list)
>
>
>
> This might be better on the dpdk dev mailing list. For the OVS part, see
> this thread http://openvswitch.org/pipermail/discuss/2015-July/018095.html
>
>
>
> Kevin.
>
>
>
> *From:* Na Zhu [mailto:zhunatuzi at gmail.com <zhunatuzi at gmail.com>]
> *Sent:* Wednesday, July 15, 2015 6:16 AM
> *To:* Traynor, Kevin
> *Subject:* Re: [ovs-discuss] ovs-dpdk performance is not good
>
>
>
> Hi Kevin,
>
>
>
> The interface MTU is 1500, the TCP message size is 16384 and the UDP
> message size is 65507.
>
> How to use DPDK virtio PMD?
>
> in DPDK virtio PMD, it uses mergeable feature to support jumbo frame,
> the mergeable feature need negotiate with vhost on the backend,
> so if ovs enable the mergeable feature, and virtio can succeed in
> negotiating this feature,
> then jumbo frame can be supported.
>
> thanks
> Changchun
>
>
>
> 2015-07-14 20:25 GMT+08:00 Traynor, Kevin <kevin.traynor at intel.com>:
>
>
>
> *From:* discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of *Na
> Zhu
> *Sent:* Monday, July 13, 2015 3:15 AM
> *To:* bugs at openvswitch.org
> *Subject:* [ovs-discuss] ovs-dpdk performance is not good
>
>
>
> Dear all,
>
>
>
> I want to use ovs-dpdk to improve my nfv performance. But when i compare
> the throughput between standard ovs and ovs-dpdk, the ovs is better, does
> anyone know why?
>
>
>
> I use netperf to test the throughput.
>
> use vhost-net to test standard ovs.
>
> use vhost-user to test ovs-dpdk.
>
> My topology is as follow:
>
>
>
> [image: 内嵌图片 1]
>
>
>
> The result is that standard ovs performance is better. Throughput unit
> Mbps.
>
> [image: 内嵌图片 2]
>
>
>
> [image: 内嵌图片 3]
>
>
>
>
>
> [kt] I would check your core affinitization to ensure that the vswitchd
>
> pmd is on a separate core to the vCPUs (set with
> other_config:pmd-cpu-mask).
>
> Also, this test is not using the DPDK vitrio PMD in the guest which
> provides
>
> performance gains.
>
>
>
> What packet sizes are you using? you should see a greater gain from DPDK
>
> at lower packet sizes (i.e. more PPS)
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/4bc3448e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 11447 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/4bc3448e/attachment-0003.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 9044 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/4bc3448e/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 16645 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/4bc3448e/attachment-0005.png>

From takahashi.minoru7 at gmail.com  Thu Jul 16 21:38:38 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Fri, 17 Jul 2015 13:38:38 +0900
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <20150716214018.GD11792@nicira.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
Message-ID: <55A886CE.3040305@gmail.com>

Hi,

On 2015年07月17日 06:40, Ben Pfaff wrote:
> On Thu, Jul 16, 2015 at 02:31:10PM +0900, Minoru TAKAHASHI wrote:
>> Maybe I’ve found a problem on "ofputil_encode_group_desc_request" of ofp-util.c.
>> According to the OFspec v1.5, the last element of ofp_group_multipart_request has to be filled with zeros.
>>
>>   /* Body of OFPMP_GROUP_STATS and OFPMP_GROUP_DESC requests. */
>>       struct ofp_group_multipart_request {
>>       uint32_t group_id;  /* All groups if OFPG_ALL. */
>>       uint8_t pad[4];     /* Align to 64 bits. */
>>   };
>>   OFP_ASSERT(sizeof(struct ofp_group_multipart_request) == 8);
>>
>> I’ve checked the source code of "ofputil_encode_group_desc_request", such a process it could not find.
>>
>>   * ofputil_encode_group_desc_request
>>   https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L7274-L7279
>>
>> I guess it should be write in the same way as follows.
>>
>>   * ofputil_encode_group_stats_request
>>   https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L7207-L7213
>>
>> And, I think "ofputil_encode_port_desc_stats_request" also has a similar problem.
>>
>>   * ofputil_encode_port_desc_stats_request
>>   https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L4009-L4014
>>
>> Please confirm if it’s correct.
> 
> You're right.
> 
> Will you submit a patch?

For starters, I've created patches that fixes the following problem.

>> I’ve checked the source code of "ofputil_encode_group_desc_request", such a process it could not find.
>>
>>   * ofputil_encode_group_desc_request
>>   https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L7274-L7279

I would like you to review my patches.

thanks,

> 
> Thanks,
> 
> Ben.
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-openflow-Add-OpenFlow1.5-group-desc-request.patch
Type: text/x-patch
Size: 1038 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/15bbfcda/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-ofp-util-Fix-group-desc-request-encoding.patch
Type: text/x-patch
Size: 1431 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/15bbfcda/attachment-0003.bin>

From shyam.pujar at nokia.com  Fri Jul 17 00:13:48 2015
From: shyam.pujar at nokia.com (Pujar, Shyam (Nokia - IN/Bangalore))
Date: Fri, 17 Jul 2015 07:13:48 +0000
Subject: [ovs-discuss] Flooding of packets destined to OVS port's mac
 address
In-Reply-To: <CAHbON5piZJMbkvfRtvoe726nP9wu-7DzB1A1Z4b0Ki7O2DSaYA@mail.gmail.com>
References: <54F3CC316BCACF48A126BE3ED38CD1F319B4E84C@SGSIMBX005.nsn-intra.net>
 <CAHbON5piZJMbkvfRtvoe726nP9wu-7DzB1A1Z4b0Ki7O2DSaYA@mail.gmail.com>
Message-ID: <54F3CC316BCACF48A126BE3ED38CD1F319B4EE7C@SGSIMBX005.nsn-intra.net>

Hi,
                MAC addresses mentioned in the diagram are just for example.
MAC addresses used were as follows:

Client Program:
52:54:00:00:01:02

Server Program:
52:56:11:80:80:41

TAP1:
52:F3:12:E4:6D:A9

TAP2:
72:17:32:32:15:F8

Regards,
Shyam

From: ext Gurucharan Shetty [mailto:shettyg at nicira.com]
Sent: Thursday, July 16, 2015 11:48 PM
To: Pujar, Shyam (Nokia - IN/Bangalore)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] Flooding of packets destined to OVS port's mac address

I don't know the answer, but some of your mac addresses have multi-cast bit enabled. So I wonder whether that is the problem.

On Wed, Jul 15, 2015 at 12:18 PM, Pujar, Shyam (Nokia - IN/Bangalore) <shyam.pujar at nokia.com<mailto:shyam.pujar at nokia.com>> wrote:
Hi ,
        Please find setup and testing procedure below.

[cid:image001.jpg at 01D0C08E.397321C0]

1.       In the above setup, Client Program tries to send packet with src_mac: 3:3:3:3:3:3  and dst_mac: 1:1:1:1:1:1.
2.       Packet is flood to port tap2.
3.       Why does OVS flood packets when dst_mac received is its own port’s mac address.
4.       As it forwards to other ports, there is no one to reply for dst_mac other than OVS bridge itself.
5.       Where as in case of Linux bridge, packet is not flooded to other ports. Instead packet is dropped.

Could you please tell me how do switches in real work? As per my understanding there should be static entries in forwarding table of switch for its own mac addresses.
And default action should be present for it.


Regards,
Shyam


_______________________________________________
discuss mailing list
discuss at openvswitch.org<mailto:discuss at openvswitch.org>
http://openvswitch.org/mailman/listinfo/discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/eff7de5f/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 18205 bytes
Desc: image001.jpg
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/eff7de5f/attachment-0001.jpg>

From jpettit at nicira.com  Fri Jul 17 10:15:33 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Fri, 17 Jul 2015 10:15:33 -0700
Subject: [ovs-discuss] SPF errors for this mailing list
In-Reply-To: <CAFGv8b8OiA9StnDuEZ_8cQ8vfYxW5w4mqz85=iFF=_0qjBQw9A@mail.gmail.com>
References: <CAFGv8b8OiA9StnDuEZ_8cQ8vfYxW5w4mqz85=iFF=_0qjBQw9A@mail.gmail.com>
Message-ID: <9BE27BE7-F092-4C54-ACCD-767EB34AECDE@nicira.com>

Yes, we read it.  :-)  Thank you very much for the report!  I assume that will solve a lot of the questions people have been having.  We're tracking down the appropriate people to update the record, so it may take us a couple of days.  I'll follow up when I've heard something.

--Justin


> On Jul 17, 2015, at 8:44 AM, Adam Thompson <athompson at avant.ca> wrote:
> 
> I'm noticing that *every* *single* *email* from this list gets dumped into Google Mail's Spam folder, because of a typo in the SPF record.
> 
> Received-SPF: fail (google.com: domain of discuss-bounces at openvswitch.org does not designate 2600:3c00::f03c:91ff:fe6e:bdf7 as permitted sender) client-ip=​​2600:3c00::f03c:91ff:fe6e:bdf7;
> 
> The SPF record for openvswitch.org contains "ipv6:2600:3c00::f03c:91ff:fe6e:bdf7", but the correct syntax is "ip6:", not "ipv6:".
> 
> Can someone make that minor syntax correction in the DNS entry?  I'm hoping that someone reads discuss...?
> 
>  
> 	Adam Thompson
> Senior Systems Administrator
> voice: 204.789.9596 x24 | email: athompson at avant.ca | web: avant.ca
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From abhishekv.verma at gmail.com  Fri Jul 17 10:23:05 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 17 Jul 2015 22:53:05 +0530
Subject: [ovs-discuss] Routing at the termination point
In-Reply-To: <20150717165251.GH10847@nicira.com>
References: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
 <CADDmorQGztYcJU_J9-XkgRLuCdnJYr5=WbZmJ5Vv40QA-GBKoA@mail.gmail.com>
 <20150717150659.GB10847@nicira.com>
 <CADDmorSAt5WMGR8L917_Scdr5z8Dn+=bwDAv+YQuW2nQijCX0g@mail.gmail.com>
 <20150717165251.GH10847@nicira.com>
Message-ID: <CADDmorTSr4q3mtpsEsV1SOXCFMRtMK9wzU3KRGkTZz+iReA6Zg@mail.gmail.com>

Thanks Ben. I was using the wrong port.

I added a flow-rule that changes the MAC address to the MAC of the nexthop
and pushed it on the interface that connects this VM to the destination
that i am trying to ping.

I see that packets are hitting this flow-rule, but the ICMP packets are NOT
going out.

root at akabra:~# ovs-dpctl dump-flows
skb_priority(0),tunnel(tun_id=0x258,src=52.27.111.115,dst=172.31.1.48,tos=0x0,ttl=53,flags(key)),in_port(4),skb_mark(0),eth(src=5e:21:e8:f3:44:6a,dst=06:45:1a:d2:1c:ed),eth_type(0x0800),ipv4(src=
8.8.8.1/0.0.0.0,dst=200.83.17.91/255.255.255.255,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
packets:348, bytes:34104, used:0.048s,
actions:set(eth(src=5e:21:e8:f3:44:6a,dst=06:28:ae:10:f9:8a)),1

The above flow rule is generated for the packets arriving on the GRE tunnel.

I see the following dump on my OVS bridge port:

17:11:00.408665 IP 52.27.111.115 > 172.31.1.48: GREv0, key=0x258, length
106: IP 8.8.8.1 > 202.83.17.191: ICMP echo request, id 23417, seq 650,
length 64
0x0000:  0645 1ad2 1ced 0628 ae10 f98a 0800 4500
0x0010:  007e ff03 4000 352f f56f 341b 6f73 ac1f
0x0020:  0130 2000 6558 0000 0258 0645 1ad2 1ced
0x0030:  5e21 e8f3 446a 0800 4500 0054 b797 4000
[clipped]

17:11:00.408665 IP 8.8.8.1 > 202.83.17.191: ICMP echo request, id 23417,
seq 650, length 64
0x0000:  0628 ae10 f98a 5e21 e8f3 446a 0800 4500
0x0010:  0054 b797 4000 4001 96f6 0808 0801 ca53
0x0020:  11bf 0800 ef22 5b79 028a 2a37 a955 0000
[clipped]

So my flow-rule is working. The destination MAC is being replaced, but the
ping is not working.

QUESTION: Can i assume that since tcpdump shows the 2nd output on the OVS
bridge port, the packet is actually sent out from the OVS bridge port?

Let me see what is going wrong here now!

Thanks, Abhishek





On Fri, Jul 17, 2015 at 10:22 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Jul 17, 2015 at 10:19:46PM +0530, Abhishek Verma wrote:
> > Hi Ben,
> >
> > I understand its exasperating for you and other veterans to respond to
> > questions like forwarding not working, etc. However, i did enough
> googling
> > and i really couldnt, and am still unable to, figure out the real
> problem.
> >
> > I am trying to see why the L3 packet is not going out and i see this:
> >
> > I am constantly sending the ping traffic. As a result of that, i see the
> > following flow in the dataplane being created.
> >
> > root at ip-172-31-1-48:~# ovs-dpctl dump-flows
> >
> skb_priority(0),tunnel(tun_id=0x258,src=52.27.111.115,dst=172.31.1.48,tos=0x0,ttl=53,flags(key)),in_port(4),skb_mark(0),eth(src=5e:21:e8:f3:44:6a,dst=06:45:1a:d2:1c:ed),eth_type(0x0800),ipv4(src=
> >
> 8.8.8.1/0.0.0.0,dst=202.83.17.191/0.0.0.0,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff
> ),
> > packets:1351, bytes:132398, used:0.340s, actions:1
> >
> > Based on this flow i created a flow-rule which i expect the packet to
> > always hit:
> >
> > root at ip-172-31-1-48:~# ovs-ofctl dump-flows ion1
> > NXST_FLOW reply (xid=0x4):
> >  cookie=0x0, duration=26573.649s, table=0, n_packets=34881,
> > n_bytes=4025577, idle_age=0, priority=0 actions=NORMAL
> >  cookie=0x0, duration=338.021s, table=0, n_packets=0, n_bytes=0,
> > idle_age=338, priority=500,ip,in_port=4,nw_dst=202.83.17.191
> > actions=output:2
> >
> > However, for some reason i dont see my packets hitting the rule that i
> have
> > created.
> >
> > This is strange since i created this based on the flow that was created
> in
> > the kernel.
>
> Did you use the correct userspace port number, i.e. one from "ovs-ofctl
> show ion1"?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/e00070e3/attachment.html>

From blp at nicira.com  Fri Jul 17 10:24:46 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 17 Jul 2015 10:24:46 -0700
Subject: [ovs-discuss] Routing at the termination point
In-Reply-To: <CADDmorTSr4q3mtpsEsV1SOXCFMRtMK9wzU3KRGkTZz+iReA6Zg@mail.gmail.com>
References: <CADDmorRaSECFJv_jeVycg9Jdo7mdykskZifKARpiWH4uy85L3A@mail.gmail.com>
 <CADDmorQGztYcJU_J9-XkgRLuCdnJYr5=WbZmJ5Vv40QA-GBKoA@mail.gmail.com>
 <20150717150659.GB10847@nicira.com>
 <CADDmorSAt5WMGR8L917_Scdr5z8Dn+=bwDAv+YQuW2nQijCX0g@mail.gmail.com>
 <20150717165251.GH10847@nicira.com>
 <CADDmorTSr4q3mtpsEsV1SOXCFMRtMK9wzU3KRGkTZz+iReA6Zg@mail.gmail.com>
Message-ID: <20150717172446.GI10847@nicira.com>

On Fri, Jul 17, 2015 at 10:53:05PM +0530, Abhishek Verma wrote:
> QUESTION: Can i assume that since tcpdump shows the 2nd output on the OVS
> bridge port, the packet is actually sent out from the OVS bridge port?

Yes, that's generally a safe assumption.

From wuhao.thu at gmail.com  Fri Jul 17 21:03:02 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Fri, 17 Jul 2015 21:03:02 -0700
Subject: [ovs-discuss] Why OVS needs arp?
Message-ID: <CAHmvmjEWtM42JLeKYv5x3B+-OO3MO8aS7KQswa1FDwLdBSmr2g@mail.gmail.com>

Hi,

   I'm curious that why OVS forwarding also needs arp? I find if I add a
flow in flow table as
"idle_timeout=0,ip,dst_scr=10.0.0.2,actions=output:2", the packets can't be
forwarded unless I also add the arp part:
"idle_timeout=0,arp,dst_scr=10.0.0.2,actions=output:2". For OVS, I think it
can work without the help of arp because it uses OF table which can match
IP part.

+++++++++++++++++
Best,
Hao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/79850788/attachment.html>

From jpettit at nicira.com  Fri Jul 17 21:34:47 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Sat, 18 Jul 2015 00:34:47 -0400
Subject: [ovs-discuss] Why OVS needs arp?
In-Reply-To: <CAHmvmjEWtM42JLeKYv5x3B+-OO3MO8aS7KQswa1FDwLdBSmr2g@mail.gmail.com>
References: <CAHmvmjEWtM42JLeKYv5x3B+-OO3MO8aS7KQswa1FDwLdBSmr2g@mail.gmail.com>
Message-ID: <42FC0CA1-AD27-45DB-BB49-1E007B0C5F89@nicira.com>


> On Jul 18, 2015, at 12:03 AM, Hao Wu <wuhao.thu at gmail.com> wrote:
> 
> Hi,
> 
>    I'm curious that why OVS forwarding also needs arp? I find if I add a flow in flow table as "idle_timeout=0,ip,dst_scr=10.0.0.2,actions=output:2", the packets can't be forwarded unless I also add the arp part: "idle_timeout=0,arp,dst_scr=10.0.0.2,actions=output:2". For OVS, I think it can work without the help of arp because it uses OF table which can match IP part. 

ARP isn't IP--it has a different Ethertype--so you have to tell OVS to forward it.

--Justin



From abhishekv.verma at gmail.com  Fri Jul 17 21:51:23 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Sat, 18 Jul 2015 10:21:23 +0530
Subject: [ovs-discuss] Why OVS needs arp?
In-Reply-To: <42FC0CA1-AD27-45DB-BB49-1E007B0C5F89@nicira.com>
References: <CAHmvmjEWtM42JLeKYv5x3B+-OO3MO8aS7KQswa1FDwLdBSmr2g@mail.gmail.com>
 <42FC0CA1-AD27-45DB-BB49-1E007B0C5F89@nicira.com>
Message-ID: <CADDmorRNVRk=-tcX8W6eZFSyA=DP=aL-+VRfwsHnSERyjADgrg@mail.gmail.com>

Hao,

OVS doesnt need ARP -- its L3 forwarding that needs it.

When you ping, the kernel needs to know the destination MAC address that it
needs to slap on to the packet. Unless it gets this the packet will not be
forwarded. When it sends out the ARP request, OVS must forward it so that
the other end can receive it and respond to it. If OVS is dropping the
ARPs, then the other end will never receive it and the sender will never be
able to send out the IP packet.

You could try out by adding static ARPs. In that case, OVS with just the IP
rules installed will be able to send out IP packets.

Hope this helps.

Thanks, Abhishek

On Sat, Jul 18, 2015 at 10:04 AM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Jul 18, 2015, at 12:03 AM, Hao Wu <wuhao.thu at gmail.com> wrote:
> >
> > Hi,
> >
> >    I'm curious that why OVS forwarding also needs arp? I find if I add a
> flow in flow table as
> "idle_timeout=0,ip,dst_scr=10.0.0.2,actions=output:2", the packets can't be
> forwarded unless I also add the arp part:
> "idle_timeout=0,arp,dst_scr=10.0.0.2,actions=output:2". For OVS, I think it
> can work without the help of arp because it uses OF table which can match
> IP part.
>
> ARP isn't IP--it has a different Ethertype--so you have to tell OVS to
> forward it.
>
> --Justin
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150718/67d8d14d/attachment.html>

From wuhao.thu at gmail.com  Fri Jul 17 21:59:22 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Fri, 17 Jul 2015 21:59:22 -0700
Subject: [ovs-discuss] Why OVS needs arp?
In-Reply-To: <CADDmorRNVRk=-tcX8W6eZFSyA=DP=aL-+VRfwsHnSERyjADgrg@mail.gmail.com>
References: <CAHmvmjEWtM42JLeKYv5x3B+-OO3MO8aS7KQswa1FDwLdBSmr2g@mail.gmail.com>
 <42FC0CA1-AD27-45DB-BB49-1E007B0C5F89@nicira.com>
 <CADDmorRNVRk=-tcX8W6eZFSyA=DP=aL-+VRfwsHnSERyjADgrg@mail.gmail.com>
Message-ID: <CAHmvmjHe0Rb6MWReo-FZ-q3K2N2TrSEVBGNFOoHm++t2OTo3LQ@mail.gmail.com>

Hi Abhishek and Justin,

    Got it! Thanks for your kind help.

+++++++++++++++++
Best,
Hao

On Fri, Jul 17, 2015 at 9:51 PM, Abhishek Verma <abhishekv.verma at gmail.com>
wrote:

> Hao,
>
> OVS doesnt need ARP -- its L3 forwarding that needs it.
>
> When you ping, the kernel needs to know the destination MAC address that
> it needs to slap on to the packet. Unless it gets this the packet will not
> be forwarded. When it sends out the ARP request, OVS must forward it so
> that the other end can receive it and respond to it. If OVS is dropping the
> ARPs, then the other end will never receive it and the sender will never be
> able to send out the IP packet.
>
> You could try out by adding static ARPs. In that case, OVS with just the
> IP rules installed will be able to send out IP packets.
>
> Hope this helps.
>
> Thanks, Abhishek
>
> On Sat, Jul 18, 2015 at 10:04 AM, Justin Pettit <jpettit at nicira.com>
> wrote:
>
>>
>> > On Jul 18, 2015, at 12:03 AM, Hao Wu <wuhao.thu at gmail.com> wrote:
>> >
>> > Hi,
>> >
>> >    I'm curious that why OVS forwarding also needs arp? I find if I add
>> a flow in flow table as
>> "idle_timeout=0,ip,dst_scr=10.0.0.2,actions=output:2", the packets can't be
>> forwarded unless I also add the arp part:
>> "idle_timeout=0,arp,dst_scr=10.0.0.2,actions=output:2". For OVS, I think it
>> can work without the help of arp because it uses OF table which can match
>> IP part.
>>
>> ARP isn't IP--it has a different Ethertype--so you have to tell OVS to
>> forward it.
>>
>> --Justin
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150717/b5041d5e/attachment.html>

From abhishekv.verma at gmail.com  Sat Jul 18 07:27:40 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Sat, 18 Jul 2015 19:57:40 +0530
Subject: [ovs-discuss] Action in the output of ovs-appctl dpif/dump-flows
Message-ID: <CADDmorSoU1j-ry+9Gy=WrDwNnDdW2AXv7jBX378LkjbTbMTb2w@mail.gmail.com>

Hi,

The output of my ovs-appctl dpif/dump-flows BRIDGE shows:

skb_priority(0),tunnel(tun_id=0x262,src=152.169.188.120,dst=100.2.17.191,tos=0x8,ttl=50,flags(key)),in_port(3),skb_mark(0),eth(src=0a:b2:d5:2d:cd:55,dst=00:90:0b:35:e4:26),eth_type(0x0800),ipv4(src=
72.1.1.63/0.0.0.0,dst=192.168.1.14/255.255.255.255,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
packets:293, bytes:28714, used:0.667s, *actions:2*

What is the meaning of the action = 2. There are entries for which the
action is 1.

What do the two actions mean?

Any pointer to a document that i can read to get this info?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150718/1035d8c0/attachment-0001.html>

From benoit.georgelin at web4all.fr  Sat Jul 18 15:36:17 2015
From: benoit.georgelin at web4all.fr (Benoit GEORGELIN - Association Web4all)
Date: Sun, 19 Jul 2015 00:36:17 +0200 (CEST)
Subject: [ovs-discuss] Restrict IP address dst to an Openvswitch port
Message-ID: <1664355036.455693.1437258977584.JavaMail.zimbra@web4all.fr>

Hi openvswitch community , 

Since few weeks i'm using OpenVswitch , I'm looking to build a virtual network for lxc containers. 
I would like to use OpenVswitch to restrict communication on a specific port. 

In my example I have two containers A and B 
Each containers are linked to an OpenVswitch Interface ( int-A et int-B ) 

A have an IP address : 10.0.0.1 configured inside the container 
B have an IP address: 10.0.0.2 configured inside the container 

I would like to allow only destination 10.0.0.1 to int-A and 10.0.0.2 to int-B 

Can I do it this by Openflow ? Any example would be appreciated. 

This is to avoid user in container B to user A's IP address . 

Thanks for you help 


Cordialement, 
Benoit 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150719/0c4e75a0/attachment.html>

From wuhao.thu at gmail.com  Sat Jul 18 16:35:02 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Sat, 18 Jul 2015 16:35:02 -0700
Subject: [ovs-discuss] How to set the best setting to test packet
 processing performance?
In-Reply-To: <20150716201434.GR11792@nicira.com>
References: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>
 <20150716072829.GE22655@nicira.com>
 <CAHmvmjGHa+ciLTcFkJc80-azF=uCbfeC2pqrfXnOfztXVxY9xg@mail.gmail.com>
 <20150716200802.GP11792@nicira.com>
 <CANr6G5wihpLirS7iBvGUJKqY=HasjFVsJJ7QKp+Q9EX1YkB_Jw@mail.gmail.com>
 <20150716201434.GR11792@nicira.com>
Message-ID: <CAHmvmjGy13wEyiqn+Vqen7d5wYZujezkR6dGVn5GP+v7R0dwcw@mail.gmail.com>

Hi Ben,

   I tried netperf. I run 40 netperf instances in 40 different hosts
connecting to one OVS. For every two host, I set one as the server and the
other one as the client that sends out packets. Thus, I have 20 pairs of
C/S. In this scenario, I get 1.27Mpps. I also tried to only hold one server
and let other 39 host send packets to it in parallel, but the throughput is
less than the former case. Which is the one you take in your setting? I
even add more hosts, say, 100 hosts. But Mininet crashes when OVS adds the
100 ports connecting to the 100 hosts.....

+++++++++++++++++
Best,
Hao

On Thu, Jul 16, 2015 at 1:14 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Jul 16, 2015 at 01:12:49PM -0700, Joe Stringer wrote:
> > On 16 July 2015 at 13:08, Ben Pfaff <blp at nicira.com> wrote:
> > > On Thu, Jul 16, 2015 at 11:22:29AM -0700, Hao Wu wrote:
> > >>    Yes, you are right. I find the bottleneck is tcprelay which only
> > >> generates packets at 750Kpps. But even when I add more hosts to send
> > >> packets in parallel, I can't get a higher generation rate. E.g., if I
> use
> > >> only one host, tcpreplay sends packets at 300Kpps, while if I use 6
> hosts,
> > >> each tcpreplay sends packets at around 130Kpps and the total rate is
> still
> > >> 750Kpps. How do you get a higher generation rate in your experiment?
> Thanks.
> > >
> > > I think we used netperf.  I've never use tcpreplay so I don't have any
> > > hints.
> >
> > Even with netperf, you need to run several threads and depending on
> > the test you may exhaust all CPU running netperf to generate the
> > traffic before you start hitting OVS performance limits.
>
> Right, the OVS paper mentions that we ran 400 netperf instances in
> parallel.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150718/0e27b9da/attachment.html>

From blp at nicira.com  Sat Jul 18 16:42:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 18 Jul 2015 16:42:29 -0700
Subject: [ovs-discuss] How to set the best setting to test packet
 processing performance?
In-Reply-To: <CAHmvmjGy13wEyiqn+Vqen7d5wYZujezkR6dGVn5GP+v7R0dwcw@mail.gmail.com>
References: <CAHmvmjHSpsDc-sAKq4RBUgS1pFT8SsWVotOFsG-Li4CRQw7DUA@mail.gmail.com>
 <20150716072829.GE22655@nicira.com>
 <CAHmvmjGHa+ciLTcFkJc80-azF=uCbfeC2pqrfXnOfztXVxY9xg@mail.gmail.com>
 <20150716200802.GP11792@nicira.com>
 <CANr6G5wihpLirS7iBvGUJKqY=HasjFVsJJ7QKp+Q9EX1YkB_Jw@mail.gmail.com>
 <20150716201434.GR11792@nicira.com>
 <CAHmvmjGy13wEyiqn+Vqen7d5wYZujezkR6dGVn5GP+v7R0dwcw@mail.gmail.com>
Message-ID: <20150718234229.GA2582@nicira.com>

As the paper says, we used one server with two 10-Gbps NICs.

Please read the paper:
        http://openvswitch.org/support/papers/nsdi2015.pdf

On Sat, Jul 18, 2015 at 04:35:02PM -0700, Hao Wu wrote:
> Hi Ben,
> 
>    I tried netperf. I run 40 netperf instances in 40 different hosts
> connecting to one OVS. For every two host, I set one as the server and the
> other one as the client that sends out packets. Thus, I have 20 pairs of
> C/S. In this scenario, I get 1.27Mpps. I also tried to only hold one server
> and let other 39 host send packets to it in parallel, but the throughput is
> less than the former case. Which is the one you take in your setting? I
> even add more hosts, say, 100 hosts. But Mininet crashes when OVS adds the
> 100 ports connecting to the 100 hosts.....
> 
> +++++++++++++++++
> Best,
> Hao
> 
> On Thu, Jul 16, 2015 at 1:14 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Thu, Jul 16, 2015 at 01:12:49PM -0700, Joe Stringer wrote:
> > > On 16 July 2015 at 13:08, Ben Pfaff <blp at nicira.com> wrote:
> > > > On Thu, Jul 16, 2015 at 11:22:29AM -0700, Hao Wu wrote:
> > > >>    Yes, you are right. I find the bottleneck is tcprelay which only
> > > >> generates packets at 750Kpps. But even when I add more hosts to send
> > > >> packets in parallel, I can't get a higher generation rate. E.g., if I
> > use
> > > >> only one host, tcpreplay sends packets at 300Kpps, while if I use 6
> > hosts,
> > > >> each tcpreplay sends packets at around 130Kpps and the total rate is
> > still
> > > >> 750Kpps. How do you get a higher generation rate in your experiment?
> > Thanks.
> > > >
> > > > I think we used netperf.  I've never use tcpreplay so I don't have any
> > > > hints.
> > >
> > > Even with netperf, you need to run several threads and depending on
> > > the test you may exhaust all CPU running netperf to generate the
> > > traffic before you start hitting OVS performance limits.
> >
> > Right, the OVS paper mentions that we ran 400 netperf instances in
> > parallel.
> >

From huhui_email at 126.com  Sat Jul 18 20:07:01 2015
From: huhui_email at 126.com (Huhui)
Date: Sun, 19 Jul 2015 11:07:01 +0800 (CST)
Subject: [ovs-discuss] Can we set the priority queues in the port connecting
 to controller?
Message-ID: <27d1d49c.1ce2.14ea4476e98.Coremail.huhui_email@126.com>

Hi openvswitch community , 


 I'm looking to set two priority queues (queue 0 and queue 1) in the port connecting  to controller in OpenVswitch(V2.3.1) with POX controller. 
When I used the OVS command: sudo ovs-ofctl queue-stats br0 eth0,I could see the priority queues.




In my example I add two flow-table in the event of ConnectionUp.
The action of flow-table like this:of.ofp_action_enqueue(port=of.OFPP_CONTROLLER,queue_id=0).
When OVS connectted,OpenFlow said that "bad action',and priority queues did work.
Checked flow-table' action like this:action:output:2(didn't have queue' id).
Could OVS permit to set the priority queues in the port connecting to controller?
If could,how to set that?

Thanks for you help 




Best,

Huhui


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150719/0af59b44/attachment-0001.html>

From azhou at nicira.com  Sat Jul 18 22:00:35 2015
From: azhou at nicira.com (Andy Zhou)
Date: Sat, 18 Jul 2015 22:00:35 -0700
Subject: [ovs-discuss]
	=?utf-8?q?On_TCP=5FCRR_test_setup_in_=22Acceleratin?=
	=?utf-8?q?g_Open_vSwitch_to_=E2=80=9CLudicrous_Speed=E2=80=9D=22?=
In-Reply-To: <CAECwjAgmdvSVjAFDYvMk5FcTTT+H85XmRv14-iTRxde1OtMm0w@mail.gmail.com>
References: <CAECwjAi6U4UfYn9itPbciYgUYuwwwXRJCyU=yaaXpVEDbwsrCw@mail.gmail.com>
 <CAECwjAjQu-2_a_LrkcCBUuG_RMOy-=yTyFGx7ikcZnPsb+u==Q@mail.gmail.com>
 <20150714221246.GE13347@nicira.com>
 <CAECwjAgmdvSVjAFDYvMk5FcTTT+H85XmRv14-iTRxde1OtMm0w@mail.gmail.com>
Message-ID: <CACzMAJ+t-6Pni6hR17j4ws+q-i1Th52P5c18DkieNbmqAZAoDw@mail.gmail.com>

Hi, Yousong,

The 120K and 680K tps are not collected from the same test setups.
They are collected a few month apart and on different machines.

The 680K tps was collected using 3 machines. One runs netperf in
client mode, the middle one runs OVS and the third one runs netperf in
server mode.
The performance number is most limited by the 20Gbps link speed, as
there are more CPU head rooms in the OVS machine.

The cache optimization data was collected on a different set up which
is more limited in its ability to generate traffic (possibly due to
NIC type)
compare to the first setup.

It would have been great that we could have collected the numbers from
the exact setup. But it proves to be hard to have a monopoly use of
multiple powerful servers.
In the mean time, compare absolute TPS is not that useful anyways. In
both sets of numbers, OVS are not the bottle neck; The absolute number
is limited by the traffic
generating capabilities.

Since we reported CPU load on both sets of data, compare "% cpu" per
transaction may be more useful.

For OVS:

680K tps, with 161% cpu usage,  %cpu/ktps = 0.23%
120K tps, with   20% cpu usage, %cpu/ktps = 0.16%

The 2nd number is better because of further optimization in the
classifier documented in the paper.

On the other hand,  with Linux bridging:
680K tps with 48% cpu usage, %cpu/ktps = 0.07%.

This number should be considered a limit for OVS, since OVS has to
provide more features than Linux bridge.

Make sense?

Andy

On Tue, Jul 14, 2015 at 8:09 PM, Yousong Zhou <yszhou4tech at gmail.com> wrote:
> Hi
>
> On 15 July 2015 at 06:12, Ben Pfaff <blp at nicira.com> wrote:
>> On Fri, Jul 10, 2015 at 08:54:03PM +0800, Yousong Zhou wrote:
>>> On 8 July 2015 at 21:39, Yousong Zhou <yszhou4tech at gmail.com> wrote:
>>> > Hello, list
>>> >
>>> > I am doing some performance tests for the preparation of upgrading
>>> > Open vSwitch from 1.11.0 to 2.3.2.  However, with TCP_CRR, I can only
>>> > achieve about 130k tps (last time I got only 40k because of a .debug
>>> > type kernel), not even close to the reported 680k from the blog post
>>> > [0].  I also found other available reports [1, 2] but those results
>>> > were even worse and not consistent with each other.
>>> >
>>>
>>> Hi, I just found the 680k tps TCP_CRR test result in the nsdi2015
>>> paper "The design and implementation of Open vSwitch" [1].  Hmm, the
>>> 120k tps in section "Cache layer performance" is similar to what I
>>> have got.  But how were they boosted to 688k for both Linux bridge and
>>> Open vSwitch in section "Comparison to in-kernel switch"?
>>
>> I think that the configuration we used is described in that paper under
>> "Cache layer performance":
>>
>>     In all following tests, Open vSwitch ran on a Linux server with two
>>     8-core, 2.0 GHz Xeon processors and two Intel 10-Gb NICs. To generate
>>     many connections, we used Netperf’s TCP CRR test [25], which repeatedly
>>     establishes a TCP connection, sends and receives one byte of traffic,
>>     and disconnects.  The results are reported in transactions per second
>>     (tps).  Netperf only makes one connection attempt at a time, so we ran
>>     400 Netperf sessions in parallel and reported the sum.
>
> I already read that part.  The hardware configuration seems to be
> comparable [1].  In our tests 32 netperf instances were more or less
> enough to get the 130k tps and we increased the number of netperf
> pairs to 127 with no obvious improvement.
>
> But when we read that the performance can be as high as 680k with both
> Linux bridge and Open vSwitch, we thought there should be something we
> overlooked, e.g. system parameters tuning, kernel configuration.
>
> I noticed that in section "Cache layer performance" the best result
> was about 120k tps with all optimisations on.  But the result was more
> than 680k tps in section "Comparison to in-kernel switch".  How this
> boost was done?
>
> Thanks for the reply.
>
>  [1] https://github.com/yousong/brtest/blob/master/out/yousong-X540-AT2.md
>
>
> Regards
>
>                 yousong
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From pnk003 at naver.com  Sun Jul 19 01:30:46 2015
From: pnk003 at naver.com (=?UTF-8?B?7LWc7J217ISx?=)
Date: Sun, 19 Jul 2015 17:30:46 +0900 (KST)
Subject: [ovs-discuss] =?utf-8?q?Information_about_functional_call_relatio?=
 =?utf-8?q?n_structures_in_Openvswitch=2E?=
Message-ID: <cbb21fc3fa481ee98ff291bae6a74a7@cweb23.nm.nhnsystem.com>

Dear Experts.
Thank you very much for your best efforts to openvswitch.
It is very surprising design and have a lot of functions.
I am studying the source of openvswitch.
It is very hard for me to understand the behavior of functions since a lot of function call is via function pointer call.
 
If there is any Information about functional call structures in Openvswitch, would you let me know it ? 
If I can get it, I will appreciate.
It will be very helpful for my study.
 
I know that using function call pointer has a lot of advantages.
However it is very hard to study because static function call analysis is not possible.
If it is possible, would you program the source code without function pointer call?
 
Thank you very much.
 
Sincerely Yours,
Ick-Sung Choi.
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150719/bcf1f191/attachment.html>

From abhishekv.verma at gmail.com  Sun Jul 19 09:19:37 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Sun, 19 Jul 2015 21:49:37 +0530
Subject: [ovs-discuss] Action in the output of ovs-appctl dpif/dump-flows
In-Reply-To: <CADDmorSoU1j-ry+9Gy=WrDwNnDdW2AXv7jBX378LkjbTbMTb2w@mail.gmail.com>
References: <CADDmorSoU1j-ry+9Gy=WrDwNnDdW2AXv7jBX378LkjbTbMTb2w@mail.gmail.com>
Message-ID: <CADDmorSQkU3HQcp0kLqm3mUaXMQntb=WjWZSksG4snHxJ+2smA@mail.gmail.com>

Ok, this means that the packet will be forwarded to the data plane port 2
(not the Open FLow port 2).

Thanks, Abhishek

On Sat, Jul 18, 2015 at 7:57 PM, Abhishek Verma <abhishekv.verma at gmail.com>
wrote:

> Hi,
>
> The output of my ovs-appctl dpif/dump-flows BRIDGE shows:
>
>
> skb_priority(0),tunnel(tun_id=0x262,src=152.169.188.120,dst=100.2.17.191,tos=0x8,ttl=50,flags(key)),in_port(3),skb_mark(0),eth(src=0a:b2:d5:2d:cd:55,dst=00:90:0b:35:e4:26),eth_type(0x0800),ipv4(src=
> 72.1.1.63/0.0.0.0,dst=192.168.1.14/255.255.255.255,proto=1/0,tos=0/0,ttl=64/0,frag=no/0xff),
> packets:293, bytes:28714, used:0.667s, *actions:2*
>
> What is the meaning of the action = 2. There are entries for which the
> action is 1.
>
> What do the two actions mean?
>
> Any pointer to a document that i can read to get this info?
>
> Thanks, Abhishek
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150719/568d8f40/attachment.html>

From blp at nicira.com  Sun Jul 19 10:08:22 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 19 Jul 2015 10:08:22 -0700
Subject: [ovs-discuss] Can we set the priority queues in the port
 connecting to controller?
In-Reply-To: <27d1d49c.1ce2.14ea4476e98.Coremail.huhui_email@126.com>
References: <27d1d49c.1ce2.14ea4476e98.Coremail.huhui_email@126.com>
Message-ID: <20150719170822.GA21455@nicira.com>

On Sun, Jul 19, 2015 at 11:07:01AM +0800, Huhui wrote:
> In my example I add two flow-table in the event of ConnectionUp.
> The action of flow-table like this:of.ofp_action_enqueue(port=of.OFPP_CONTROLLER,queue_id=0).
> When OVS connectted,OpenFlow said that "bad action',and priority queues did work.

OpenFlow 1.0 says that the port in an enqueue action "Should refer to a
valid physical port (i.e. < OFPP_MAX) or OFPP_IN_PORT."  OFPP_CONTROLLER
isn't any of those, thus OVS rejects it.

From jun.xiao at cloudnetengine.com  Sun Jul 19 17:42:20 2015
From: jun.xiao at cloudnetengine.com (Jun Xiao)
Date: Mon, 20 Jul 2015 08:42:20 +0800
Subject: [ovs-discuss] =?utf-8?q?CloudNetEngine_vSwitch_technical_preview_?=
	=?utf-8?q?is_available!?=
Message-ID: <----Tc------lRRzc$60305a6e-d918-49c0-b7c6-81c8c12bc762@cloudnetengine.com>

We are very excited to announce that CloudNetEngine vswitch is available for
technical preview!

CloudNetEngine vswitch perfectly bridges the gaps of performance, efficiency and
full feature requirements which existing vswitches simply cannot provide.
CloudNetEngine vswitch is based on some great open source projects OVS,
DPDK, NPF, and more importantly with our own very unique proprietary network
stack to support following important features:

-  H/W and S/W TSO and CSUM support for both native and overlay networks.

-  Distributed stateful firewall per virtual port with powerful BPF JIT
   engine. 

-  Patent-pending approach for tunneling acceleration, which achieves the best
   VXLAN performance in the industry.

•  Network traffic shapping for virtual ports.

•  Very efficient and user friendly userspace vswitch traffic sniffing.

One quick reference on performance data, on our setup (Xeon E5-2620 v3 2.40GHz
+ Intel 82599 NICs), if we use VMs’ TCP traffic to drive to NIC's line rate,
CloudNetEngine vswitch can save more than 1.5 logical core than native kernel
OVS on *EACH* hypervisor! You can imagine how amazing saving it would be for
your clouds. 
(Note: the TCP test is already the best case for native kernel OVS, and the 
difference is much more significant for small/medium packet size traffic.)
 
We encourage you to try it out in your own setup, please send evaluation
requests to info at cloudnetengine.com. (Note: we only accept requests with
corporate emails for now)

Cheers!
Jun Xiao
www.cloudnetengine.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150720/f36b1b27/attachment.html>

From blp at nicira.com  Sun Jul 19 22:01:12 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 19 Jul 2015 22:01:12 -0700
Subject: [ovs-discuss] Can we set the priority queues in the port
 connecting to controller?
In-Reply-To: <e881ee.5bab.14ea957682f.Coremail.huhui_email@126.com>
References: <27d1d49c.1ce2.14ea4476e98.Coremail.huhui_email@126.com>
 <20150719170822.GA21455@nicira.com>
 <e881ee.5bab.14ea957682f.Coremail.huhui_email@126.com>
Message-ID: <20150720050112.GC21455@nicira.com>

[adding back ovs-discuss]

I do believe that your computer has physical ports.  Your enqueue action
isn't using any of them, though, and OpenFlow 1.0 forbids that, with the
wording that I quoted.  To make your action acceptable, enqueue to a
physical port.

On Mon, Jul 20, 2015 at 10:42:34AM +0800, Huhui wrote:
> 
> 
> In fact,I used a computer with five NICs,and controller connected to OVS with one NIC named eh0 in in-band mode.That means I had a valid physical port.
> In this case, can I set the priority queues in the port connecting to controller?
> If can,how can I get information of the port?
> Thanks for your help!
> 
> 
> 
> 
> 
> At 2015-07-20 01:08:22, "Ben Pfaff" <blp at nicira.com> wrote:
> >On Sun, Jul 19, 2015 at 11:07:01AM +0800, Huhui wrote:
> >> In my example I add two flow-table in the event of ConnectionUp.
> >> The action of flow-table like this:of.ofp_action_enqueue(port=of.OFPP_CONTROLLER,queue_id=0).
> >> When OVS connectted,OpenFlow said that "bad action',and priority queues did work.
> >
> >OpenFlow 1.0 says that the port in an enqueue action "Should refer to a
> >valid physical port (i.e. < OFPP_MAX) or OFPP_IN_PORT."  OFPP_CONTROLLER
> >isn't any of those, thus OVS rejects it.

From d.reade at Reades.co.uk  Mon Jul 20 00:40:57 2015
From: d.reade at Reades.co.uk (David Reade)
Date: Mon, 20 Jul 2015 08:40:57 +0100
Subject: [ovs-discuss] Traffic Mirroring using XenServer and OpenVSwitch
In-Reply-To: <CAHbON5qr-8yVazO8maC6540LDSF7WnL-qN8voB2UbUbEc1KwgQ@mail.gmail.com>
References: <0E6E632C7139354E9310905023FAF9CA842C2E9430@L1VS02SBS08.reades.local>
 <CAHbON5qr-8yVazO8maC6540LDSF7WnL-qN8voB2UbUbEc1KwgQ@mail.gmail.com>
Message-ID: <0E6E632C7139354E9310905023FAF9CA844DC467EF@L1VS02SBS08.reades.local>

Hi Gurucharan

Please see the answers to your questions below:

Q. When a VM is rebooted, does Xenserver delete the vif and re-add it?
A. Yes.

Q. Does it get added with a different vif name?
A. Yes - the "dom-id" changes; the VIF name is made up of <dom-id>.<device-id> (e.g. vif2.0).

The controller - would that be something within XenServer or OVS?

Is there no other way to get this to work without resorting to cron jobs, shell scripts and separate bridges?

Kind regards

David

-----Original Message-----
From: Gurucharan Shetty [mailto:shettyg at nicira.com] 
Sent: 17 July 2015 16:26
To: David Reade
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] Traffic Mirroring using XenServer and OpenVSwitch

On Mon, Jul 13, 2015 at 1:06 AM, David Reade <d.reade at reades.co.uk> wrote:
> Good morning all!
>
> I am using XenServer 6.5 SP1 with OpenVSwitch 2.1.3 and I need to mirror traffic from the source port (vif2.0) to the destination port (vif13.1). I have enabled promiscuous mode on the PIF and target VIF. Using the following command, I can enable traffic mirroring and see the results instantly:
>
> ovs-vsctl -- set Bridge xenbr1 mirrors=@m \
> -- --id=@vif2.0 get Port vif2.0 \
> -- --id=@vif13.1 get Port vif13.1 \
> -- --id=@m create Mirror name=MyMirror select-all=true 
> output-port=@vif13.1
>
> However the port information changes every time the source/target VM is rebooted. This means I have to keep re-adding the mirror every time I reboot a VM using different VIFs which is not practical.

It has bee a while that I have used Xenserver, so I have a couple of counter questions for you. When a VM is rebooted, does Xenserver delete the vif and re-add it? Does it get added with a different vif name? You can test it with doing a 'ovs-vsctl show' before the shutdown. Again after "shutdown" and again after "start".  If I remember correctly the name remains the same. But it likely deletes it and re-adds it. If it does the latter, I see how your mirror configuration gets destroyed.

Usually such situations are handled via a controller, which watches OVSDB for changes and re-creates the mirror if it gets destroyed.

If you don't want to use a cron job, another option is to not setup your mirror on the same bridge that has your vif attached. You can use a different bridge for each of your vif and then connect them to a separate bridge via a OVS patch port. You can add your mirror on this separate bridge which does not get effected with vm reboots.


>
> I have devised a way to get the current VIF ID and send it to OVS using a cron job or shell script. However I would prefer to just run a single command without resorting to cron jobs and shell scripts as they need managing themselves.
>
> Is there a way to setup traffic mirroring to run permanently which is unaffected by VM reboots?
>
> Thanks in advance,
>
> David
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From shettyg at nicira.com  Mon Jul 20 07:28:32 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Mon, 20 Jul 2015 07:28:32 -0700
Subject: [ovs-discuss] Traffic Mirroring using XenServer and OpenVSwitch
In-Reply-To: <0E6E632C7139354E9310905023FAF9CA844DC467EF@L1VS02SBS08.reades.local>
References: <0E6E632C7139354E9310905023FAF9CA842C2E9430@L1VS02SBS08.reades.local>
 <CAHbON5qr-8yVazO8maC6540LDSF7WnL-qN8voB2UbUbEc1KwgQ@mail.gmail.com>
 <0E6E632C7139354E9310905023FAF9CA844DC467EF@L1VS02SBS08.reades.local>
Message-ID: <CAHbON5pOt9b7GamxoAW3BfCQZun32apkku1MtD7QRp7NO04JQw@mail.gmail.com>

> Q. Does it get added with a different vif name?
> A. Yes - the "dom-id" changes; the VIF name is made up of <dom-id>.<device-id> (e.g. vif2.0).
So you are saying instead of vif2.0, it can become vif3.0

>
> The controller - would that be something within XenServer or OVS?
It would be something that speaks to OVS. For e.g:
https://github.com/openvswitch/ovs/blob/master/xenserver/usr_share_openvswitch_scripts_ovs-xapi-sync

>
> Is there no other way to get this to work without resorting to cron jobs, shell scripts and separate bridges?
You are configuring mirroring without going through Xenserver's
inbuilt tools (if there are any) and using OVS directly instead.  So
it pretty much means that you will need something that watches Open
vSwitch database and performs corrective actions.

A quick Google search talks about "RSPAN" feature in Xenserver (this
is another name for port mirroring). So may be you should try that,
and if it does work, you likely don't need workarounds.

>
> Kind regards
>
> David
>
> -----Original Message-----
> From: Gurucharan Shetty [mailto:shettyg at nicira.com]
> Sent: 17 July 2015 16:26
> To: David Reade
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Traffic Mirroring using XenServer and OpenVSwitch
>
> On Mon, Jul 13, 2015 at 1:06 AM, David Reade <d.reade at reades.co.uk> wrote:
>> Good morning all!
>>
>> I am using XenServer 6.5 SP1 with OpenVSwitch 2.1.3 and I need to mirror traffic from the source port (vif2.0) to the destination port (vif13.1). I have enabled promiscuous mode on the PIF and target VIF. Using the following command, I can enable traffic mirroring and see the results instantly:
>>
>> ovs-vsctl -- set Bridge xenbr1 mirrors=@m \
>> -- --id=@vif2.0 get Port vif2.0 \
>> -- --id=@vif13.1 get Port vif13.1 \
>> -- --id=@m create Mirror name=MyMirror select-all=true
>> output-port=@vif13.1
>>
>> However the port information changes every time the source/target VM is rebooted. This means I have to keep re-adding the mirror every time I reboot a VM using different VIFs which is not practical.
>
> It has bee a while that I have used Xenserver, so I have a couple of counter questions for you. When a VM is rebooted, does Xenserver delete the vif and re-add it? Does it get added with a different vif name? You can test it with doing a 'ovs-vsctl show' before the shutdown. Again after "shutdown" and again after "start".  If I remember correctly the name remains the same. But it likely deletes it and re-adds it. If it does the latter, I see how your mirror configuration gets destroyed.
>
> Usually such situations are handled via a controller, which watches OVSDB for changes and re-creates the mirror if it gets destroyed.
>
> If you don't want to use a cron job, another option is to not setup your mirror on the same bridge that has your vif attached. You can use a different bridge for each of your vif and then connect them to a separate bridge via a OVS patch port. You can add your mirror on this separate bridge which does not get effected with vm reboots.
>
>
>>
>> I have devised a way to get the current VIF ID and send it to OVS using a cron job or shell script. However I would prefer to just run a single command without resorting to cron jobs and shell scripts as they need managing themselves.
>>
>> Is there a way to setup traffic mirroring to run permanently which is unaffected by VM reboots?
>>
>> Thanks in advance,
>>
>> David
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From randall.sharo at navy.mil  Fri Jul 17 15:40:30 2015
From: randall.sharo at navy.mil (Sharo, Randall A CIV SPAWARSYSCEN-ATLANTIC, 55200)
Date: Fri, 17 Jul 2015 22:40:30 +0000
Subject: [ovs-discuss] resubmit-table action port number -- how to get it to
 the controller?
Message-ID: <510DC3B1BD795E44B303FB45A6565F191423AA1E@NAEACHRLXM01V.nadsusea.nads.navy.mil>

Hi all,



I noticed something unexpected about the resubmit-table action in openvswitch.



Installing flows as follows will forward packets to port 2.  The value 100 is substituted for in_port and matching occurs as expected:



   ovs-ofctl add-flows s1 - << EOF

      table=0,actions=resubmit(100,1)

      table=1,in_port=100,actions=2

   EOF



But, if I try to send the packet to the controller from table 1, the packet-in messages reports the original in_port (in my case, 1):



   ovs-ofctl add-flows s1 - << EOF

      table=0,actions=resubmit(100,1)

      table=1,in_port=100,actions=controller

   EOF



I tried working around this by stuffing the port into metadata, but was surprised to see that it too returned the original in_port -- not the substituted one.  Note that I'm using apply-actions -- this is not a side effect of action sets.



   ovs-ofctl add-flows s1 - << EOF

      table=0,actions=resubmit(100,1)

      table=1,in_port=100,actions=move:OXM_OF_IN_PORT[]->OXM_OF_METADATA[0..31],controller

   EOF



So...  is there any way I can get the port number from the resubmit action up to the controller?  Is there perhaps an alternate register that holds the substitute port number?  I don't mind using non-portable/experimental messages, but I want to avoid patching the ovs source until I know it is necessary.



Thanks,

   Randy

From huhui_email at 126.com  Sat Jul 18 20:02:49 2015
From: huhui_email at 126.com (Huhui)
Date: Sun, 19 Jul 2015 11:02:49 +0800 (CST)
Subject: [ovs-discuss] Can we set the priority queues in the port connecting
 to controller?
Message-ID: <6b5bae1c.1c7a.14ea4439631.Coremail.huhui_email@126.com>

Hi openvswitch community , 


 I'm looking to set two priority queues (queue 0 and queue 1) in the port connecting  to controller in OpenVswitch(V2.3.1) with POX controller. 
When I used the OVS command: sudo ovs-ofctl queue-stats br0 eth0,I could see the priority queues.




In my example I add two flow-table in the event of ConnectionUp.
The action of flow-table like this:of.ofp_action_enqueue(port=of.OFPP_CONTROLLER,queue_id=0).
When OVS connectted,OpenFlow said that "bad action',and priority queues did work.
Checked flow-table' action like this:action:output:2(didn't have queue' id).
Could OVS permit to set the priority queues in the port connecting to controller?
If could,how to set that?

Thanks for you help 




Best,

Huhui
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150719/61d0a132/attachment-0001.html>

From shyam.pujar at nokia.com  Sun Jul 19 21:35:00 2015
From: shyam.pujar at nokia.com (Pujar, Shyam (Nokia - IN/Bangalore))
Date: Mon, 20 Jul 2015 04:35:00 +0000
Subject: [ovs-discuss] Flooding of packets destined to OVS port's mac
 address
In-Reply-To: <CAHbON5rG=vRmptfseDc6uj9tzhbpm4Ofn7MHxYVqj6EVzigymw@mail.gmail.com>
References: <54F3CC316BCACF48A126BE3ED38CD1F319B4E84C@SGSIMBX005.nsn-intra.net>
 <CAHbON5piZJMbkvfRtvoe726nP9wu-7DzB1A1Z4b0Ki7O2DSaYA@mail.gmail.com>
 <54F3CC316BCACF48A126BE3ED38CD1F319B4EE7C@SGSIMBX005.nsn-intra.net>
 <CAHbON5rG=vRmptfseDc6uj9tzhbpm4Ofn7MHxYVqj6EVzigymw@mail.gmail.com>
Message-ID: <54F3CC316BCACF48A126BE3ED38CD1F319BDE115@SGSIMBX005.nsn-intra.net>

Thank you for the reply. Now its clear on the  behavior of OVS.

Regards,
Shyam

From: ext Gurucharan Shetty [mailto:shettyg at nicira.com]
Sent: Friday, July 17, 2015 8:26 PM
To: Pujar, Shyam (Nokia - IN/Bangalore)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] Flooding of packets destined to OVS port's mac address

I re-read your question properly again. The behavior that you see looks correct to me. OVS is a switch and switch's ports don't have mac addresses. It only cares about the mac addresses in the packet.

On Fri, Jul 17, 2015 at 12:13 AM, Pujar, Shyam (Nokia - IN/Bangalore) <shyam.pujar at nokia.com<mailto:shyam.pujar at nokia.com>> wrote:
Hi,
                MAC addresses mentioned in the diagram are just for example.
MAC addresses used were as follows:

Client Program:
52:54:00:00:01:02

Server Program:
52:56:11:80:80:41

TAP1:
52:F3:12:E4:6D:A9

TAP2:
72:17:32:32:15:F8

Regards,
Shyam

From: ext Gurucharan Shetty [mailto:shettyg at nicira.com<mailto:shettyg at nicira.com>]
Sent: Thursday, July 16, 2015 11:48 PM
To: Pujar, Shyam (Nokia - IN/Bangalore)
Cc: bugs at openvswitch.org<mailto:bugs at openvswitch.org>
Subject: Re: [ovs-discuss] Flooding of packets destined to OVS port's mac address

I don't know the answer, but some of your mac addresses have multi-cast bit enabled. So I wonder whether that is the problem.

On Wed, Jul 15, 2015 at 12:18 PM, Pujar, Shyam (Nokia - IN/Bangalore) <shyam.pujar at nokia.com<mailto:shyam.pujar at nokia.com>> wrote:
Hi ,
        Please find setup and testing procedure below.

[cid:image001.jpg at 01D0C2D3.53D6F9F0]

1.       In the above setup, Client Program tries to send packet with src_mac: 3:3:3:3:3:3  and dst_mac: 1:1:1:1:1:1.
2.       Packet is flood to port tap2.
3.       Why does OVS flood packets when dst_mac received is its own port’s mac address.
4.       As it forwards to other ports, there is no one to reply for dst_mac other than OVS bridge itself.
5.       Where as in case of Linux bridge, packet is not flooded to other ports. Instead packet is dropped.

Could you please tell me how do switches in real work? As per my understanding there should be static entries in forwarding table of switch for its own mac addresses.
And default action should be present for it.


Regards,
Shyam


_______________________________________________
discuss mailing list
discuss at openvswitch.org<mailto:discuss at openvswitch.org>
http://openvswitch.org/mailman/listinfo/discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150720/c37f3c49/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 18205 bytes
Desc: image001.jpg
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150720/c37f3c49/attachment-0001.jpg>

From zhwang at SonicWALL.com  Sun Jul 19 23:55:28 2015
From: zhwang at SonicWALL.com (Rex (Zhengxian) Wang)
Date: Sun, 19 Jul 2015 23:55:28 -0700
Subject: [ovs-discuss] OVS overload issue on openstack
Message-ID: <F188762380AFE049B93CBB6573F6E5700A13967A86@US0SCC02.us.sonicwall.com>

Hi OVS team,

I've met with a problem by using 2.3.0 for openstack setup that when large number of virtual instances exist parallel within heavy network traffic on, ovsdb-server.log shows message "poll_loop|INFO|wakeup due to [POLLIN] on fd 26 (/var/run/openvswitch/db.sock<->) at ../lib/stream-fd-unix.c:124 (67% CPU usage)".
And this causes some network problems on Network node of openstack setup.

So I've got 2 questions:
1. if you have noticed this issue?
2. if latest verison OVS has such problem?

It'll be grateful of you to give me a reply if you have any suggestion to me.


B.R.
Rex(Zhengxian) Wang
Phone:  +86-21-65100909 Ext. 42651
Dell-Sonicwall, Shanghai Ltd.
8/F, FuDan Hi-Tech Park Building
No.11 GuoTai Road, 200433

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150719/fb1739d9/attachment.html>

From blp at nicira.com  Mon Jul 20 10:50:31 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 20 Jul 2015 10:50:31 -0700
Subject: [ovs-discuss] resubmit-table action port number -- how to get
 it to the controller?
In-Reply-To: <510DC3B1BD795E44B303FB45A6565F191423AA1E@NAEACHRLXM01V.nadsusea.nads.navy.mil>
References: <510DC3B1BD795E44B303FB45A6565F191423AA1E@NAEACHRLXM01V.nadsusea.nads.navy.mil>
Message-ID: <20150720175031.GD18140@nicira.com>

On Fri, Jul 17, 2015 at 10:40:30PM +0000, Sharo, Randall A CIV SPAWARSYSCEN-ATLANTIC, 55200 wrote:
> Hi all,
> 
> 
> 
> I noticed something unexpected about the resubmit-table action in openvswitch.
> 
> 
> 
> Installing flows as follows will forward packets to port 2.  The value 100 is substituted for in_port and matching occurs as expected:
> 
> 
> 
>    ovs-ofctl add-flows s1 - << EOF
> 
>       table=0,actions=resubmit(100,1)
> 
>       table=1,in_port=100,actions=2
> 
>    EOF
> 
> 
> 
> But, if I try to send the packet to the controller from table 1, the packet-in messages reports the original in_port (in my case, 1):
> 
> 
> 
>    ovs-ofctl add-flows s1 - << EOF
> 
>       table=0,actions=resubmit(100,1)
> 
>       table=1,in_port=100,actions=controller
> 
>    EOF
> 
> 
> 
> I tried working around this by stuffing the port into metadata, but was surprised to see that it too returned the original in_port -- not the substituted one.  Note that I'm using apply-actions -- this is not a side effect of action sets.
> 
> 
> 
>    ovs-ofctl add-flows s1 - << EOF
> 
>       table=0,actions=resubmit(100,1)
> 
>       table=1,in_port=100,actions=move:OXM_OF_IN_PORT[]->OXM_OF_METADATA[0..31],controller
> 
>    EOF
> 
> 
> 
> So...  is there any way I can get the port number from the resubmit
> action up to the controller?  Is there perhaps an alternate register
> that holds the substitute port number?  I don't mind using
> non-portable/experimental messages, but I want to avoid patching the
> ovs source until I know it is necessary.

The "resubmit" action only uses the resubmitted port number for
searching the flow table, it doesn't actually change the input port.  If
you really want to do that, you can use the "load" or "set_field" action
to change the input port and *then* resubmit.

From benoitne at gmail.com  Tue Jul 21 03:23:39 2015
From: benoitne at gmail.com (Ben)
Date: Tue, 21 Jul 2015 12:23:39 +0200
Subject: [ovs-discuss] Interface name@NONE after upgrade to 2.3.2
Message-ID: <55AE1DAB.8070008@gmail.com>

Hi,

I just notice that I have */@NONE/* when I do a *ip link *after an 
update to 2.3.2, anything changed?

9: ovs-system*@NONE*: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state 
DOWN mode DEFAULT group default
     link/ether c2:8b:8f:16:4b:a0 brd ff:ff:ff:ff:ff:ff
10: vswitch_untrust*@NONE*: <BROADCAST,MULTICAST> mtu 1500 qdisc noop 
state DOWN mode DEFAULT group default
     link/ether 00:01:c0:17:26:a5 brd ff:ff:ff:ff:ff:ff
30: vswitch_trust*@NONE*: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 
qdisc noqueue state UNKNOWN mode DEFAULT group default
     link/ether 00:01:c0:15:f1:ec brd ff:ff:ff:ff:ff:ff
56: vnic_vl08_secu*@NONE*: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 
qdisc fq_codel master ovs-system state UNKNOWN mode DEFAULT group 
default qlen 500
     link/ether fa:6e:3a:e7:be:6c brd ff:ff:ff:ff:ff:ff

Doing a ovs-vsctl show is showing me the things correctly, it is just 
under my system where the interfaces are named with ... at NONE.

Many thanks!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150721/b95271a5/attachment.html>

From kevin.traynor at intel.com  Tue Jul 21 03:59:49 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 21 Jul 2015 10:59:49 +0000
Subject: [ovs-discuss] Missing mails in patchset
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74519BA6F@IRSMSX104.ger.corp.intel.com>

Hi All,

I'm seeing that when there is a patch set of several patches
sent out on the ovs-dev ML, one or more may be missing from
my inbox. For example, in the recent 22 patch set 'change
strategy for tunnel keys' from Ben, patch 20/22
(http://openvswitch.org/pipermail/dev/2015-July/057752.html)
is missing for me and my colleagues. I've checked with the
mail people in our IT department and they say it was never
received by our servers.

It may be the case that some other mails are not getting
through also but it's more noticeable with a patchset.

Is anyone else seeing this?

Kevin.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150721/abee2c4a/attachment.html>

From blp at nicira.com  Tue Jul 21 07:45:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 21 Jul 2015 07:45:20 -0700
Subject: [ovs-discuss] Missing mails in patchset
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F74519BA6F@IRSMSX104.ger.corp.intel.com>
References: <BC0FEEC7D7650749874CEC11314A88F74519BA6F@IRSMSX104.ger.corp.intel.com>
Message-ID: <20150721144520.GA15450@nicira.com>

On Tue, Jul 21, 2015 at 10:59:49AM +0000, Traynor, Kevin wrote:
> I'm seeing that when there is a patch set of several patches
> sent out on the ovs-dev ML, one or more may be missing from
> my inbox. For example, in the recent 22 patch set 'change
> strategy for tunnel keys' from Ben, patch 20/22
> (http://openvswitch.org/pipermail/dev/2015-July/057752.html)
> is missing for me and my colleagues. I've checked with the
> mail people in our IT department and they say it was never
> received by our servers.
> 
> It may be the case that some other mails are not getting
> through also but it's more noticeable with a patchset.
> 
> Is anyone else seeing this?

We're currently trying to get a SPF problem fixed on openvswitch.org,
see:
http://openvswitch.org/pipermail/discuss/2015-July/018266.html

It's possible that some MTA is dropping emails.

From daniel.herrmann at igd.fraunhofer.de  Tue Jul 21 08:07:31 2015
From: daniel.herrmann at igd.fraunhofer.de (Daniel Herrmann)
Date: Tue, 21 Jul 2015 17:07:31 +0200
Subject: [ovs-discuss] Problems with MPLS header pushing
In-Reply-To: <55A8C028.1060308@igd.fraunhofer.de>
References: <55A8C028.1060308@igd.fraunhofer.de>
Message-ID: <55AE6033.7080803@igd.fraunhofer.de>

Hi,

I know this may not be a very interesting question, but I do not have
any idea why forwarding does not work.

Any help would really be appreciated.

Best regards
 Daniel

On 17.07.2015 10:43, Daniel Herrmann wrote:
>  Hi,
>
> I have installed OVS 2.3.2-1 on a Debian Wheezy(7.8) maschine. Two
> interfaces (eth1 and eth2) are connected to bridge 0:
>
> --- schnip ---
> root at SOF:~# ovs-ofctl -O OpenFlow13 show br0
> OFPT_FEATURES_REPLY (OF1.3) (xid=0x2): dpid:aaaaaaaaaaaaaa19
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS
> OFPST_PORT_DESC reply (OF1.3) (xid=0x3):
>  4(eth1): addr:00:50:56:82:c5:47
>      config:     0
>      state:      0
>      current:    10GB-FD COPPER
>      advertised: COPPER
>      supported:  1GB-FD 10GB-FD COPPER
>      speed: 10000 Mbps now, 10000 Mbps max
>  5(eth2): addr:00:50:56:82:5f:a4
>      config:     0
>      state:      0
>      current:    10GB-FD COPPER
>      advertised: COPPER
>      supported:  1GB-FD 10GB-FD COPPER
>      speed: 10000 Mbps now, 10000 Mbps max
>  LOCAL(br0): addr:00:50:56:82:5f:a4
>      config:     PORT_DOWN
>      state:      LINK_DOWN
>      speed: 0 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (OF1.3) (xid=0x5): frags=normal miss_send_len=0
> --- snap ---
>
> I am using Ryu to program the switch and I am trying to implement basic
> Segment Routing support based on MPLS. For example, packages coming into
> eth1 should be encapsulated in an MPLS header using an appropriate
> label. Actually, I think the flow generation part works:
>
> --- snip ---
> root at SOF:~# ovs-ofctl -O OpenFlow13 dump-flows br0
> OFPST_FLOW reply (OF1.3) (xid=0x2):
>  cookie=0x0, duration=327.703s, table=0, n_packets=325, n_bytes=31850,
> ip,in_port=4,nw_dst=10.0.0.88/29
> actions=write_metadata:0x15/0xff,goto_table:10
>  cookie=0x0, duration=327.703s, table=0, n_packets=0, n_bytes=0,
> ip,in_port=4,nw_dst=20.0.0.0/8
> actions=write_metadata:0x14/0xff,goto_table:10
>  cookie=0x0, duration=327.703s, table=0, n_packets=0, n_bytes=0,
> ip,in_port=4,nw_dst=21.0.0.0/8
> actions=write_metadata:0x15/0xff,goto_table:10
>  cookie=0x0, duration=327.703s, table=10, n_packets=0, n_bytes=0,
> ip,metadata=0x14
> actions=set_field:00:50:56:82:b2:66->eth_dst,set_field:00:50:56:82:5f:a4->eth_src,push_mpls:0x8847,set_field:16020->mpls_label,output:5
>  cookie=0x0, duration=327.703s, table=10, n_packets=325, n_bytes=31850,
> ip,metadata=0x15
> actions=set_field:00:50:56:82:b2:66->eth_dst,set_field:00:50:56:82:5f:a4->eth_src,push_mpls:0x8847,set_field:16021->mpls_label,output:5
>  --- snap ---
>
> As you can see, I am using a two-table approach using metadata. The
> first table basically identifies the target, the second adds MPLS header
> and label. Now, If I am sending packages into Port 5, it is matching
> both rules in Table 0 and Table 10, so actually it should be forwarded.
> tcpdump on eth1 shows the packages coming in, however tcpdump on eth2
> does not see any packages going out. Tracing example packages however
> show, that the package actually should be processed correctly:
>
> --- snip ---
> root at SOF:~# ovs-appctl ofproto/trace br0
> in_port=4,dl_dst=00:50:56:82:c5:47,ip,ip_dst=21.0.0.1
> Bridge: br0
> Flow:
> ip,metadata=0,in_port=4,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:50:56:82:c5:47,nw_src=0.0.0.0,nw_dst=21.0.0.1,nw_tos=0,nw_ecn=0,nw_ttl=0
> Rule: table=0 cookie=0 ip,in_port=4,nw_dst=21.0.0.0/8
> OpenFlow actions=write_metadata:0x15/0xff,goto_table:10
>
>     Resubmitted flow:
> ip,metadata=0x15,in_port=4,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:50:56:82:c5:47,nw_src=0.0.0.0,nw_dst=21.0.0.1,nw_tos=0,nw_ecn=0,nw_ttl=0
>     Resubmitted regs: reg0=0x0 reg1=0x0 reg2=0x0 reg3=0x0 reg4=0x0
> reg5=0x0 reg6=0x0 reg7=0x0
>     Resubmitted  odp: drop
>     Resubmitted megaflow:
> recirc_id=0,skb_priority=0,ip,metadata=0,in_port=4,dl_src=00:00:00:00:00:00,dl_dst=00:50:56:82:c5:47,nw_src=0.0.0.0,nw_dst=21.0.0.1,nw_proto=0,nw_frag=no
>     Rule: table=10 cookie=0 ip,metadata=0x15
>     OpenFlow
> actions=set_field:00:50:56:82:b2:66->eth_dst,set_field:00:50:56:82:5f:a4->eth_src,push_mpls:0x8847,set_field:16021->mpls_label,output:5
>
> Final flow:
> mpls,metadata=0x15,in_port=4,vlan_tci=0x0000,dl_src=00:50:56:82:5f:a4,dl_dst=00:50:56:82:b2:66,mpls_label=16021,mpls_tc=0,mpls_ttl=64,mpls_bos=1
> Megaflow:
> recirc_id=0,skb_priority=0,ip,metadata=0,in_port=4,dl_src=00:00:00:00:00:00,dl_dst=00:50:56:82:c5:47,nw_src=0.0.0.0,nw_dst=21.0.0.1,nw_proto=0,nw_tos=0,nw_ttl=0,mpls_label=0,mpls_tc=0,mpls_ttl=0,mpls_bos=0,mpls_lse1=0,mpls_lse2=0,nw_frag=no
> Datapath actions:
> set(eth(src=00:50:56:82:5f:a4,dst=00:50:56:82:b2:66)),push_mpls(label=16021,tc=0,ttl=64,bos=1,eth_type=0x8847),3
> --- snap ---
>
> The datapath ports look like this:
>
> --- snip ---
> root at SOF:~# ovs-dpctl show
> system at ovs-system:
>     lookups: hit:61368 missed:60694 lost:0
>     flows: 1
>     masks: hit:154718 total:2 hit/pkt:1.27
>     port 0: ovs-system (internal)
>     port 1: br0 (internal)
>     port 2: eth1
>     port 3: eth2
> --- snap ---
>
> So... what am I missing here? Why are the packets not forwarded? If
> required, I can also post the Ryu code used to generate the flow rules.
>
> Thanks in advance!
> Best regards
>   Daniel
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From blp at nicira.com  Tue Jul 21 08:19:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 21 Jul 2015 08:19:17 -0700
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <55ADE240.8000309@gmail.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
 <55A886CE.3040305@gmail.com> <20150717164204.GG10847@nicira.com>
 <55ADE240.8000309@gmail.com>
Message-ID: <20150721151917.GC15450@nicira.com>

On Tue, Jul 21, 2015 at 03:10:08PM +0900, Minoru TAKAHASHI wrote:
> > they do not make the corresponding change to the decoder
> 
> Should I fix this problem?
> If so, please tell me that which source file should I fix.
> (Sorry, I am new in implementation of OpenvSwitch.)

I cannot apply anything to the repository that makes tests fail, so yes
you should fix the decoder.

The decode function is right next to the encode function.

From abhishekv.verma at gmail.com  Tue Jul 21 09:20:47 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Tue, 21 Jul 2015 21:50:47 +0530
Subject: [ovs-discuss] flow-rules for arp
Message-ID: <CADDmorSwR9RkWX8w5Vx0JsuAQ184TvzZ-Z17NpxsrnKYqpx4NA@mail.gmail.com>

Hi,

I am adding the following rules:

ovs-ofctl add-flow SWITCH priority=500,arp,nw_dst=
100.0.0.0/24,actions=normal
ovs-ofctl add-flow SWITCH priority=501,arp,nw_dst=
200.99.0.0/16,actions=normal
ovs-ofctl add-flow SWITCH priority=502,arp,actions=drop

My understanding is that with these rules i will be able to recieve ARP
requests and replies for all hosts falling in subnets 100.0.0.0/24 and
200.99.0.0/16. Every other ARP message will be dropped.

Is my understanding correct?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150721/0c4a7d6b/attachment.html>

From blp at nicira.com  Tue Jul 21 09:43:25 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 21 Jul 2015 09:43:25 -0700
Subject: [ovs-discuss] flow-rules for arp
In-Reply-To: <CADDmorSwR9RkWX8w5Vx0JsuAQ184TvzZ-Z17NpxsrnKYqpx4NA@mail.gmail.com>
References: <CADDmorSwR9RkWX8w5Vx0JsuAQ184TvzZ-Z17NpxsrnKYqpx4NA@mail.gmail.com>
Message-ID: <20150721164325.GA474@nicira.com>

On Tue, Jul 21, 2015 at 09:50:47PM +0530, Abhishek Verma wrote:
> I am adding the following rules:
> 
> ovs-ofctl add-flow SWITCH priority=500,arp,nw_dst=
> 100.0.0.0/24,actions=normal
> ovs-ofctl add-flow SWITCH priority=501,arp,nw_dst=
> 200.99.0.0/16,actions=normal
> ovs-ofctl add-flow SWITCH priority=502,arp,actions=drop
> 
> My understanding is that with these rules i will be able to recieve ARP
> requests and replies for all hosts falling in subnets 100.0.0.0/24 and
> 200.99.0.0/16. Every other ARP message will be dropped.
> 
> Is my understanding correct?

You have the priorities backward: this set of flows will drop all ARPs.

From pshelar at nicira.com  Tue Jul 21 09:47:54 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Tue, 21 Jul 2015 09:47:54 -0700
Subject: [ovs-discuss] Problems with MPLS header pushing
In-Reply-To: <55AE6033.7080803@igd.fraunhofer.de>
References: <55A8C028.1060308@igd.fraunhofer.de>
 <55AE6033.7080803@igd.fraunhofer.de>
Message-ID: <CALnjE+o5FGFOQ9SVgsbneka8rhN7g4Xpag3kKdJN9midhR_mHA@mail.gmail.com>

On Tue, Jul 21, 2015 at 8:07 AM, Daniel Herrmann
<daniel.herrmann at igd.fraunhofer.de> wrote:
> Hi,
>
> I know this may not be a very interesting question, but I do not have
> any idea why forwarding does not work.
>
> Any help would really be appreciated.
>
There were few MPLS fixed pushed in branch 2.4, Can you try it on
master or branch 2.4?

From maniksidana019 at gmail.com  Tue Jul 21 10:00:18 2015
From: maniksidana019 at gmail.com (maniksidana019 at gmail.com)
Date: Tue, 21 Jul 2015 22:30:18 +0530
Subject: [ovs-discuss] ovs-vsctl output question
Message-ID: <55ae7aa7.4106460a.2d92.ffffeb15@mx.google.com>

If you are using vxlan then I think tunnels between your compute, network etc nodes would be of type vxlan. Vlan on br-int is used only for tenant isolation.

On 31 May 2015 11:14, Shaival J Chokshi <schokshi at us.ibm.com> wrote:
>
> Hi All, 
>
> I have a question about ovs-vsctl output on br-int bridge. We are using OVS-vxlan in open stack. My question is why do I see tag (VLAN tag?) in ovs-vsctl output when I am using vxlan for my overlay networks. 
> Also, what concerns me is the tag 4095? This tag shouldn't be used unless it is used for some local / management traffic. 
>
> We are experiencing periodical packet loss for significant time so trying to identify root cause. 
>
> Any help is greatly appreciated. 
>
> Thanks, 
> Shaival

From jun.xiao at cloudnetengine.com  Tue Jul 21 11:00:42 2015
From: jun.xiao at cloudnetengine.com (Jun Xiao)
Date: Wed, 22 Jul 2015 02:00:42 +0800
Subject: [ovs-discuss] =?utf-8?q?vswitches_performance_comparison?=
Message-ID: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>

After CloudNetEngine vswitch technical preview is launched, we received quite
a few queries on vswitches performance comparison, but we cannot simply give a
 test result on our platform because performance varies on different H/Ws and
different workloads, and that's why we encourage you to try the evaluation 
package to get real data on your setup.

Anyway, we share a little more performance data on our H/W which is a comparison
 among native kernel OVS/OVS-DPDK/CNE vswitch under the most common workload:
concurrent bi-directional TCP traffics cross hosts, and hope you can have a rough idea.
http://www.cloudnetengine.com/weblog/2015/07/22/vswitches-performance-comparison/

Thanks,
Jun

From mark.d.gray at intel.com  Tue Jul 21 11:14:07 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Tue, 21 Jul 2015 18:14:07 +0000
Subject: [ovs-discuss] vswitches performance comparison
In-Reply-To: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>
References: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E2BEF4B@IRSMSX108.ger.corp.intel.com>



> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Jun
> Xiao
> Sent: Tuesday, July 21, 2015 7:01 PM
> To: discuss; dev
> Subject: [ovs-discuss] vswitches performance comparison
> 
> After CloudNetEngine vswitch technical preview is launched, we received
> quite a few queries on vswitches performance comparison, but we cannot
> simply give a  test result on our platform because performance varies on
> different H/Ws and different workloads, and that's why we encourage you to
> try the evaluation package to get real data on your setup.
> 
> Anyway, we share a little more performance data on our H/W which is a
> comparison  among native kernel OVS/OVS-DPDK/CNE vswitch under the
> most common workload:
> concurrent bi-directional TCP traffics cross hosts, and hope you can have a
> rough idea.
> http://www.cloudnetengine.com/weblog/2015/07/22/vswitches-
> performance-comparison/

I think there is an issue with you methodology. ovs-dpdk performance should be
significantly higher than kernel ovs.

> 
> Thanks,
> Jun
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From jun.xiao at cloudnetengine.com  Tue Jul 21 11:28:09 2015
From: jun.xiao at cloudnetengine.com (Jun Xiao)
Date: Wed, 22 Jul 2015 02:28:09 +0800
Subject: [ovs-discuss] vswitches performance comparison
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA92E2BEF4B@IRSMSX108.ger.corp.intel.com>
References: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>
 <738D45BC1F695740A983F43CFE1B7EA92E2BEF4B@IRSMSX108.ger.corp.intel.com>
Message-ID: <F22B6292-38B7-4D9D-94CA-154FFF2C6B75@cloudnetengine.com>

I'd like to hope that's my methodology problem, but I just follow the installation guide without any customization.

Hi Mark, do you have any performance data share with us? Maybe we are using different type of workloads, like I mentioned I am using typical data center workload, I guess you are talking about NFV type of workload?

Thanks,
Jun
Sent from my iPhone

> On Jul 22, 2015, at 2:14 AM, Gray, Mark D <mark.d.gray at intel.com> wrote:
> 
> 
> 
>> -----Original Message-----
>> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Jun
>> Xiao
>> Sent: Tuesday, July 21, 2015 7:01 PM
>> To: discuss; dev
>> Subject: [ovs-discuss] vswitches performance comparison
>> 
>> After CloudNetEngine vswitch technical preview is launched, we received
>> quite a few queries on vswitches performance comparison, but we cannot
>> simply give a  test result on our platform because performance varies on
>> different H/Ws and different workloads, and that's why we encourage you to
>> try the evaluation package to get real data on your setup.
>> 
>> Anyway, we share a little more performance data on our H/W which is a
>> comparison  among native kernel OVS/OVS-DPDK/CNE vswitch under the
>> most common workload:
>> concurrent bi-directional TCP traffics cross hosts, and hope you can have a
>> rough idea.
>> http://www.cloudnetengine.com/weblog/2015/07/22/vswitches-
>> performance-comparison/
> 
> I think there is an issue with you methodology. ovs-dpdk performance should be
> significantly higher than kernel ovs.
> 
>> 
>> Thanks,
>> Jun
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss

From amuller at redhat.com  Tue Jul 21 11:35:04 2015
From: amuller at redhat.com (Assaf Muller)
Date: Tue, 21 Jul 2015 14:35:04 -0400 (EDT)
Subject: [ovs-discuss] ovs-vsctl output question
In-Reply-To: <55ae7aa7.4106460a.2d92.ffffeb15@mx.google.com>
References: <55ae7aa7.4106460a.2d92.ffffeb15@mx.google.com>
Message-ID: <1116050135.2641597.1437503704337.JavaMail.zimbra@redhat.com>



----- Original Message -----
> If you are using vxlan then I think tunnels between your compute, network etc
> nodes would be of type vxlan. Vlan on br-int is used only for tenant
> isolation.
> 
> On 31 May 2015 11:14, Shaival J Chokshi <schokshi at us.ibm.com> wrote:
> >
> > Hi All,
> >
> > I have a question about ovs-vsctl output on br-int bridge. We are using
> > OVS-vxlan in open stack. My question is why do I see tag (VLAN tag?) in
> > ovs-vsctl output when I am using vxlan for my overlay networks.
> > Also, what concerns me is the tag 4095? This tag shouldn't be used unless
> > it is used for some local / management traffic.

As pointed out above, when using OpenStack Neutron with ML2 and OVS, br-int
will have VLAN tags to provide segmentation of networks on the local hypervisor,
so that VMs on different networks (And possibly different tenants) will not be
able to communicate without being explicitly connected via a Neutron router.

That being said, the VLAN tag of 4095 is an error VLAN. This means that Neutron
failed to bind the port, and is usually indicative of a configuration issue.
This probably has nothing to do with OVS and I would advise you to ask this
question on ask.openstack.org, with all of the Neutron configuration files
attached.

> >
> > We are experiencing periodical packet loss for significant time so trying
> > to identify root cause.
> >
> > Any help is greatly appreciated.
> >
> > Thanks,
> > Shaival
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
> 

From mark.d.gray at intel.com  Tue Jul 21 11:36:03 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Tue, 21 Jul 2015 18:36:03 +0000
Subject: [ovs-discuss] vswitches performance comparison
In-Reply-To: <F22B6292-38B7-4D9D-94CA-154FFF2C6B75@cloudnetengine.com>
References: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>
 <738D45BC1F695740A983F43CFE1B7EA92E2BEF4B@IRSMSX108.ger.corp.intel.com>
 <F22B6292-38B7-4D9D-94CA-154FFF2C6B75@cloudnetengine.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E2BEFD4@IRSMSX108.ger.corp.intel.com>


> 
> I'd like to hope that's my methodology problem, but I just follow the
> installation guide without any customization.
> 
> Hi Mark, do you have any performance data share with us? Maybe we are
> using different type of workloads, like I mentioned I am using typical data
> center workload, I guess you are talking about NFV type of workload?

The number getting floated around on the mailing list recently is 16.5Mpps
for phy-phy. However, I don't think we have any iperf data off-hand for your
usecase. When we test throughput into the vm we usually generate the traffic externally
and send NIC->OVS->VM->OVS->NIC. This is a little different to your setup.

I do know, however, that ovs-dpdk typically has a much larger throughput than
the kernel space datapath.
 
Have you seen this? https://wiki.opnfv.org/characterize_vswitch_performance_for_telco_nfv_use_cases

> 
> Thanks,
> Jun


From jun.xiao at cloudnetengine.com  Tue Jul 21 11:48:51 2015
From: jun.xiao at cloudnetengine.com (Jun Xiao)
Date: Wed, 22 Jul 2015 02:48:51 +0800
Subject: [ovs-discuss] vswitches performance comparison
In-Reply-To: <738D45BC1F695740A983F43CFE1B7EA92E2BEFD4@IRSMSX108.ger.corp.intel.com>
References: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>
 <738D45BC1F695740A983F43CFE1B7EA92E2BEF4B@IRSMSX108.ger.corp.intel.com>
 <F22B6292-38B7-4D9D-94CA-154FFF2C6B75@cloudnetengine.com>
 <738D45BC1F695740A983F43CFE1B7EA92E2BEFD4@IRSMSX108.ger.corp.intel.com>
Message-ID: <9D0E6ED2-6171-4EF5-AD21-01B1844B5136@cloudnetengine.com>



> On Jul 22, 2015, at 2:36 AM, Gray, Mark D <mark.d.gray at intel.com> wrote:
> 
> 
>> 
>> I'd like to hope that's my methodology problem, but I just follow the
>> installation guide without any customization.
>> 
>> Hi Mark, do you have any performance data share with us? Maybe we are
>> using different type of workloads, like I mentioned I am using typical data
>> center workload, I guess you are talking about NFV type of workload?
> 
> The number getting floated around on the mailing list recently is 16.5Mpps
> for phy-phy. However, I don't think we have any iperf data off-hand for your
> usecase. When we test throughput into the vm we usually generate the traffic externally
> and send NIC->OVS->VM->OVS->NIC. This is a little different to your setup.
> 

I guess pmd driver is used inside VM in that case, right?
> I do know, however, that ovs-dpdk typically has a much larger throughput than
> the kernel space datapath.
> 

I'd like to say it depends on workloads, for small/medium packet size workload, that's definitely true, while for TSO size workload, it's not that obvious (or worse) as data path overheads are amortized and H/W can be leveraged.
> Have you seen this? https://wiki.opnfv.org/characterize_vswitch_performance_for_telco_nfv_use_cases
> 

Thanks for the pointer, I'll try later.
>> 
>> Thanks,
>> Jun

From takahashi.minoru7 at gmail.com  Mon Jul 20 23:10:08 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Tue, 21 Jul 2015 15:10:08 +0900
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <20150717164204.GG10847@nicira.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
 <55A886CE.3040305@gmail.com> <20150717164204.GG10847@nicira.com>
Message-ID: <55ADE240.8000309@gmail.com>

Hi,

Thank you for reviewing!

> they do not make the corresponding change to the decoder

Should I fix this problem?
If so, please tell me that which source file should I fix.
(Sorry, I am new in implementation of OpenvSwitch.)

thanks,

On 2015年07月18日 01:42, Ben Pfaff wrote:
> On Fri, Jul 17, 2015 at 01:38:38PM +0900, Minoru TAKAHASHI wrote:
>> For starters, I've created patches that fixes the following problem.
>>
>>>> I’ve checked the source code of "ofputil_encode_group_desc_request", such a process it could not find.
>>>>
>>>>   * ofputil_encode_group_desc_request
>>>>   https://github.com/openvswitch/ovs/blob/master/lib/ofp-util.c#L7274-L7279
>>
>> I would like you to review my patches.
> 
> Thank you for the patches.  They are going in the right direction, but
> because they do not make the corresponding change to the decoder they
> break two tests:
> 
> ## ------------------------------ ##
> ## openvswitch 2.4.90 test suite. ##
> ## ------------------------------ ##
> 
> 694: ofproto - del group (OpenFlow 1.5)              FAILED (ofproto.at:350)
> 696: ofproto - insert buckets                        FAILED (ofproto.at:424)
> 

From stephen at networkplumber.org  Tue Jul 21 14:02:05 2015
From: stephen at networkplumber.org (Stephen Hemminger)
Date: Tue, 21 Jul 2015 14:02:05 -0700
Subject: [ovs-discuss] [dpdk-dev] vswitches performance comparison
In-Reply-To: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>
References: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>
Message-ID: <20150721140205.485d35b4@urahara>

On Wed, 22 Jul 2015 02:00:42 +0800
"Jun Xiao" <jun.xiao at cloudnetengine.com> wrote:

> After CloudNetEngine vswitch technical preview is launched, we received quite
> a few queries on vswitches performance comparison, but we cannot simply give a
>  test result on our platform because performance varies on different H/Ws and
> different workloads, and that's why we encourage you to try the evaluation 
> package to get real data on your setup.
> 
> Anyway, we share a little more performance data on our H/W which is a comparison
>  among native kernel OVS/OVS-DPDK/CNE vswitch under the most common workload:
> concurrent bi-directional TCP traffics cross hosts, and hope you can have a rough idea.
> http://www.cloudnetengine.com/weblog/2015/07/22/vswitches-performance-comparison/
> 
> Thanks,
> Jun

Since the real bottleneck in most vswitches is per-packet overhead.
I would recommend running RFC-2544 tests for better data.

You probably need to use something like pktgen to get enough packets-per-second.

From art.perkins at gmail.com  Tue Jul 21 16:39:05 2015
From: art.perkins at gmail.com (Art Perkins)
Date: Tue, 21 Jul 2015 16:39:05 -0700
Subject: [ovs-discuss] Bonding configuration balance-slb
Message-ID: <CAOWDBzMRoj4hagHTk9gZ393WaS+Z0Kcg0XbCgx-CqYX-iy3gKQ@mail.gmail.com>

Hello,

Are there RARP packets sent from OVS when a MAC address is moved due to a
re-balancing operation being performed?

Is it still the case that balance-slb should not be used when connected to
separate upstream switches, or was this resolved with the RARP support
added in 1.8?

If balance-slb is used for connections to the same switch, how does it
notify the switch that a MAC has been moved due to a re-balancing operation?


Thanks in advance...

Art
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150721/12162a9f/attachment.html>

From abhishekv.verma at gmail.com  Tue Jul 21 17:36:51 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Wed, 22 Jul 2015 06:06:51 +0530
Subject: [ovs-discuss] flow-rules for arp
In-Reply-To: <20150721164325.GA474@nicira.com>
References: <CADDmorSwR9RkWX8w5Vx0JsuAQ184TvzZ-Z17NpxsrnKYqpx4NA@mail.gmail.com>
 <20150721164325.GA474@nicira.com>
Message-ID: <CADDmorTC10sDc6VuCbdbQkSiuL+hzNC39yyE_xhcUXcjYSrTWw@mail.gmail.com>

Oops! :)

If i fix my priorities then this should work right?

So if i have a rule

ovs-ofctl add-flow SWITCH priority=500,arp,nw_dst=
100.0.0.0/24,actions=normal

then i will process both arp requests and replies for any network falling
within 100.0.0.0/24.

Thanks, Abhishek

On Tue, Jul 21, 2015 at 10:13 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Jul 21, 2015 at 09:50:47PM +0530, Abhishek Verma wrote:
> > I am adding the following rules:
> >
> > ovs-ofctl add-flow SWITCH priority=500,arp,nw_dst=
> > 100.0.0.0/24,actions=normal
> > ovs-ofctl add-flow SWITCH priority=501,arp,nw_dst=
> > 200.99.0.0/16,actions=normal
> > ovs-ofctl add-flow SWITCH priority=502,arp,actions=drop
> >
> > My understanding is that with these rules i will be able to recieve ARP
> > requests and replies for all hosts falling in subnets 100.0.0.0/24 and
> > 200.99.0.0/16. Every other ARP message will be dropped.
> >
> > Is my understanding correct?
>
> You have the priorities backward: this set of flows will drop all ARPs.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150722/e5366fba/attachment.html>

From ychen103103 at 163.com  Tue Jul 21 19:04:20 2015
From: ychen103103 at 163.com (ychen)
Date: Wed, 22 Jul 2015 10:04:20 +0800 (CST)
Subject: [ovs-discuss] tc ingress qdisc of tapB disappeared when del-port
	tapA from bridge
Message-ID: <1c0e8fce.1792d.14eb3811fcd.Coremail.ychen103103@163.com>

I found that when delete one port from ovs bridge, then another port's tc ingress qdisc automatically disappeared, but egress qdisc is still existed.
I have tried version 2.3.2 and master branch of ovs, the bug still exists in these 2 branch.
we can reproduce this phenomenon following the step:
1. create 2 tap device
   ip tuntap add dev tap111 mode tap
  ip tuntap add dev tap222 mode tap


2. add port to ovs bridge
   ovs-vsctl add-br br0
   ovs-vsctl add-port br0 tap111
  ovs-vsctl add-port br0 tap222


3. add ingress qdisc for these 2 ports
   tc qdisc add dev tap111 ingress
  tc qdisc add dev tap222 ingress


4.delete port tap111
   ovs-vsctl del-port br0 tap111   
  ////// then we can see tc ingress qdisc of tap222 disappear//////////


Also, I found that when I add port tap111 to ovs bridge or set tag for port tap111, 
ingress qdisc of port tap111 disappeared.


I have debuged ovs code, and there maybe 3 functions related for this problem:
iface_configure_qos
netdev_linux_set_policing
netdev_linux_update
and the flag VALID_POLICING is also very important for this bug.


I have made a little modification for function netdev_linux_set_policing(),
and it seems all these 3 problems can be resolved.
can anyone help me to review this patch? 


index 0656f36..b41e1dd 100644
--- a/lib/netdev-linux.c
+++ b/lib/netdev-linux.c
@@ -1974,13 +1974,14 @@ netdev_linux_set_policing(struct netdev *netdev_,
                    : kbits_burst);       /* Stick with user-specified value. */


     ovs_mutex_lock(&netdev->mutex);
-    if (netdev->cache_valid & VALID_POLICING) {
-        error = netdev->netdev_policing_error;
-        if (error || (netdev->kbits_rate == kbits_rate &&
-                      netdev->kbits_burst == kbits_burst)) {
-            /* Assume that settings haven't changed since we last set them. */
-            goto out;
-        }
+
+    error = netdev->netdev_policing_error;
+    if (error || (netdev->kbits_rate == kbits_rate &&
+                  netdev->kbits_burst == kbits_burst)) {
+        /* Assume that settings haven't changed since we last set them. */
+        goto out;
+    }
+    if (netdev->cache_valid & VALID_POLICING){
         netdev->cache_valid &= ~VALID_POLICING;
     }





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150722/574620b6/attachment-0001.html>

From mark.d.gray at intel.com  Wed Jul 22 01:06:36 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Wed, 22 Jul 2015 08:06:36 +0000
Subject: [ovs-discuss] vswitches performance comparison
In-Reply-To: <9D0E6ED2-6171-4EF5-AD21-01B1844B5136@cloudnetengine.com>
References: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>
 <738D45BC1F695740A983F43CFE1B7EA92E2BEF4B@IRSMSX108.ger.corp.intel.com>
 <F22B6292-38B7-4D9D-94CA-154FFF2C6B75@cloudnetengine.com>
 <738D45BC1F695740A983F43CFE1B7EA92E2BEFD4@IRSMSX108.ger.corp.intel.com>
 <9D0E6ED2-6171-4EF5-AD21-01B1844B5136@cloudnetengine.com>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E2BF8CC@IRSMSX108.ger.corp.intel.com>

> >>
> >> I'd like to hope that's my methodology problem, but I just follow the
> >> installation guide without any customization.
> >>
> >> Hi Mark, do you have any performance data share with us? Maybe we are
> >> using different type of workloads, like I mentioned I am using
> >> typical data center workload, I guess you are talking about NFV type of
> workload?
> >
> > The number getting floated around on the mailing list recently is
> > 16.5Mpps for phy-phy. However, I don't think we have any iperf data
> > off-hand for your usecase. When we test throughput into the vm we
> > usually generate the traffic externally and send NIC->OVS->VM->OVS-
> >NIC. This is a little different to your setup.
> >
> 
> I guess pmd driver is used inside VM in that case, right?

Yes, but even when we use virtio-net we see the same if not *slightly* better
performance.

> > I do know, however, that ovs-dpdk typically has a much larger
> > throughput than the kernel space datapath.
> >
> 
> I'd like to say it depends on workloads, for small/medium packet size
> workload, that's definitely true, while for TSO size workload, it's not that
> obvious (or worse) as data path overheads are amortized and H/W can be
> leveraged.

For large packets the switch will eventually saturate the NIC at line rate but the
total aggregate throughput of the switch should be faster (you could
add more interfaces for example to take advantage of that). 

TSO is missing from the DPDK ports at the moment but it is something
we plan to look at. We are currently enabling Jumbo frames (which don't
work at the moment).

> > Have you seen this?
> > https://wiki.opnfv.org/characterize_vswitch_performance_for_telco_nfv_
> > use_cases
> >
> 
> Thanks for the pointer, I'll try later.
> >>
> >> Thanks,
> >> Jun

From mark.d.gray at intel.com  Wed Jul 22 01:07:04 2015
From: mark.d.gray at intel.com (Gray, Mark D)
Date: Wed, 22 Jul 2015 08:07:04 +0000
Subject: [ovs-discuss] [dpdk-dev] vswitches performance comparison
In-Reply-To: <20150721140205.485d35b4@urahara>
References: <----Tc------lRRzc$3e501353-5ebe-4161-b9d4-01ebdf81a6de@cloudnetengine.com>
 <20150721140205.485d35b4@urahara>
Message-ID: <738D45BC1F695740A983F43CFE1B7EA92E2BF8DF@IRSMSX108.ger.corp.intel.com>

> "Jun Xiao" <jun.xiao at cloudnetengine.com> wrote:
> 
> > After CloudNetEngine vswitch technical preview is launched, we
> > received quite a few queries on vswitches performance comparison, but
> > we cannot simply give a  test result on our platform because
> > performance varies on different H/Ws and different workloads, and
> > that's why we encourage you to try the evaluation package to get real data
> on your setup.
> >
> > Anyway, we share a little more performance data on our H/W which is a
> > comparison  among native kernel OVS/OVS-DPDK/CNE vswitch under the
> most common workload:
> > concurrent bi-directional TCP traffics cross hosts, and hope you can have a
> rough idea.
> > http://www.cloudnetengine.com/weblog/2015/07/22/vswitches-
> performance-
> > comparison/
> >
> > Thanks,
> > Jun
> 
> Since the real bottleneck in most vswitches is per-packet overhead.
> I would recommend running RFC-2544 tests for better data.
> 
> You probably need to use something like pktgen to get enough packets-per-
> second.

Yeah this is the methodology that we use aswell.

From soumya03081986 at gmail.com  Wed Jul 22 06:45:27 2015
From: soumya03081986 at gmail.com (soumya kumar)
Date: Wed, 22 Jul 2015 19:15:27 +0530
Subject: [ovs-discuss] Need help to verify SCTP traffic using openvswitch
Message-ID: <CALK75vhBMTK8G3UtPDiSFYwsE76Wy6iOxV1HxBWs4RVzqiJRjA@mail.gmail.com>

Hi,

I want to verify SCTP traffic between two Hosts.
I was trying to verify using two ways
   1> using iperf3 ( as it support sctp traffic)
   2> using sctp_test command


I am not able to see sctp traffic while checking with openvswitch 2.3.1.
The same command works and able to see sctp traffic when i am not using
openvswitch and checked with back-back connected port.


Is there a way to verify sctp traffic support for openvswitch.Any simple
test to verify this.




Regards,
Soumya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150722/4c58d0fa/attachment.html>

From yinpeijun at huawei.com  Wed Jul 22 06:57:37 2015
From: yinpeijun at huawei.com (yinpeijun)
Date: Wed, 22 Jul 2015 21:57:37 +0800
Subject: [ovs-discuss] when ovs-2.4.0 release ?
Message-ID: <55AFA151.8020809@huawei.com>

  Hi all，
        In OPNFV community I saw the ovs-2.4 trend to release at the end of August，is that really?

And in the maillist of ovs discuss say ovs-2.4 will not be a LTS ?

 

        If that is true, what will be the next LTS release except ovs-2.3 and what is the plan ?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150722/09256242/attachment-0001.html>

From kevin.traynor at intel.com  Wed Jul 22 08:25:13 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Wed, 22 Jul 2015 15:25:13 +0000
Subject: [ovs-discuss] Missing mails in patchset
In-Reply-To: <20150721144520.GA15450@nicira.com>
References: <BC0FEEC7D7650749874CEC11314A88F74519BA6F@IRSMSX104.ger.corp.intel.com>
 <20150721144520.GA15450@nicira.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74519ED93@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Tuesday, July 21, 2015 3:45 PM
> To: Traynor, Kevin
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Missing mails in patchset
> 
> On Tue, Jul 21, 2015 at 10:59:49AM +0000, Traynor, Kevin wrote:
> > I'm seeing that when there is a patch set of several patches
> > sent out on the ovs-dev ML, one or more may be missing from
> > my inbox. For example, in the recent 22 patch set 'change
> > strategy for tunnel keys' from Ben, patch 20/22
> > (http://openvswitch.org/pipermail/dev/2015-July/057752.html)
> > is missing for me and my colleagues. I've checked with the
> > mail people in our IT department and they say it was never
> > received by our servers.
> >
> > It may be the case that some other mails are not getting
> > through also but it's more noticeable with a patchset.
> >
> > Is anyone else seeing this?
> 
> We're currently trying to get a SPF problem fixed on openvswitch.org,
> see:
> http://openvswitch.org/pipermail/discuss/2015-July/018266.html
> 
> It's possible that some MTA is dropping emails.

ok, thanks for the info, I'll pass it on to our IT people.

From blp at nicira.com  Wed Jul 22 08:34:15 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 22 Jul 2015 08:34:15 -0700
Subject: [ovs-discuss] tc ingress qdisc of tapB disappeared when
 del-port tapA from bridge
In-Reply-To: <1c0e8fce.1792d.14eb3811fcd.Coremail.ychen103103@163.com>
References: <1c0e8fce.1792d.14eb3811fcd.Coremail.ychen103103@163.com>
Message-ID: <20150722153415.GC28552@nicira.com>

On Wed, Jul 22, 2015 at 10:04:20AM +0800, ychen wrote:
> I found that when delete one port from ovs bridge, then another port's tc ingress qdisc automatically disappeared, but egress qdisc is still existed.
> I have tried version 2.3.2 and master branch of ovs, the bug still exists in these 2 branch.
> we can reproduce this phenomenon following the step:
> 1. create 2 tap device
>    ip tuntap add dev tap111 mode tap
>   ip tuntap add dev tap222 mode tap
> 
> 
> 2. add port to ovs bridge
>    ovs-vsctl add-br br0
>    ovs-vsctl add-port br0 tap111
>   ovs-vsctl add-port br0 tap222
> 
> 
> 3. add ingress qdisc for these 2 ports
>    tc qdisc add dev tap111 ingress
>   tc qdisc add dev tap222 ingress
> 
> 
> 4.delete port tap111
>    ovs-vsctl del-port br0 tap111   
>   ////// then we can see tc ingress qdisc of tap222 disappear//////////

OVS assumes it's in charge of QoS currently for ports in its bridges.

If you want to change that assumption then you should contribute to this
thread:
http://openvswitch.org/pipermail/discuss/2015-May/017687.html

From blp at nicira.com  Wed Jul 22 08:37:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 22 Jul 2015 08:37:45 -0700
Subject: [ovs-discuss] flow-rules for arp
In-Reply-To: <CADDmorTC10sDc6VuCbdbQkSiuL+hzNC39yyE_xhcUXcjYSrTWw@mail.gmail.com>
References: <CADDmorSwR9RkWX8w5Vx0JsuAQ184TvzZ-Z17NpxsrnKYqpx4NA@mail.gmail.com>
 <20150721164325.GA474@nicira.com>
 <CADDmorTC10sDc6VuCbdbQkSiuL+hzNC39yyE_xhcUXcjYSrTWw@mail.gmail.com>
Message-ID: <20150722153745.GE28552@nicira.com>

On Wed, Jul 22, 2015 at 06:06:51AM +0530, Abhishek Verma wrote:
> Oops! :)
> 
> If i fix my priorities then this should work right?
> 
> So if i have a rule
> 
> ovs-ofctl add-flow SWITCH priority=500,arp,nw_dst=
> 100.0.0.0/24,actions=normal
> 
> then i will process both arp requests and replies for any network falling
> within 100.0.0.0/24.

That sounds correct.

From joestringer at nicira.com  Wed Jul 22 14:49:07 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Wed, 22 Jul 2015 14:49:07 -0700
Subject: [ovs-discuss] Need help to verify SCTP traffic using openvswitch
In-Reply-To: <CALK75vhBMTK8G3UtPDiSFYwsE76Wy6iOxV1HxBWs4RVzqiJRjA@mail.gmail.com>
References: <CALK75vhBMTK8G3UtPDiSFYwsE76Wy6iOxV1HxBWs4RVzqiJRjA@mail.gmail.com>
Message-ID: <CANr6G5wF=o-LDib2NLNpAd793zoBizicHYJ9xWjaLiQJeA7VUQ@mail.gmail.com>

What do you mean by verify?

You'll need to be more specific on your configuration, what openflow
flows you have, etc. Specifically what is the difference between the
behaviour you expect and the behaviour you see?

On 22 July 2015 at 06:45, soumya kumar <soumya03081986 at gmail.com> wrote:
> Hi,
>
> I want to verify SCTP traffic between two Hosts.
> I was trying to verify using two ways
>    1> using iperf3 ( as it support sctp traffic)
>    2> using sctp_test command
>
>
> I am not able to see sctp traffic while checking with openvswitch 2.3.1. The
> same command works and able to see sctp traffic when i am not using
> openvswitch and checked with back-back connected port.
>
>
> Is there a way to verify sctp traffic support for openvswitch.Any simple
> test to verify this.
>
>
>
>
> Regards,
> Soumya
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From davewaters1970 at gmail.com  Wed Jul 22 15:46:08 2015
From: davewaters1970 at gmail.com (Dave Waters)
Date: Thu, 23 Jul 2015 04:16:08 +0530
Subject: [ovs-discuss] packets getting dropped at egress
Message-ID: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>

Hi,

I have two ports in my OVS bridge. I receive packets from one port (portA)
and i send them out of the other (portB). When i send out the packets, they
are VXLAN tunneled to the other end.

Now, the default MTU of all ports (including the bridge port) is 1500 in my
setup.

The issue is that when i get a 1500 byte packet on portA, i try to push it
out on portB after slapping on the VXLAN headers. This results in a packet
size thats greater than what portB can handle, and hence the packets are
dropped.

I know that OVS does not handle IP fragmentation/reassembly, so how do we
deal with this situation? I dont think we can rely on path MTU discovery
since not all applications do PMTU before spewing out packets. Any ideas,
anybody?

Warm regards,
Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/55761101/attachment.html>

From davewaters1970 at gmail.com  Wed Jul 22 15:53:41 2015
From: davewaters1970 at gmail.com (Dave Waters)
Date: Thu, 23 Jul 2015 04:23:41 +0530
Subject: [ovs-discuss] Flooding of packets destined to OVS port's mac
	address
In-Reply-To: <54F3CC316BCACF48A126BE3ED38CD1F319B4EE7C@SGSIMBX005.nsn-intra.net>
References: <54F3CC316BCACF48A126BE3ED38CD1F319B4E84C@SGSIMBX005.nsn-intra.net>
 <CAHbON5piZJMbkvfRtvoe726nP9wu-7DzB1A1Z4b0Ki7O2DSaYA@mail.gmail.com>
 <54F3CC316BCACF48A126BE3ED38CD1F319B4EE7C@SGSIMBX005.nsn-intra.net>
Message-ID: <CAARSoVxpgHQ0P4hHOLu0tqXpp5ajrcL98NzcP8CqmcCLZS2OHA@mail.gmail.com>

Shyam,

Not sure but the following could be happening:

When OVS receives the first packet with its own MAC address it hands it
over to the Linux kernel for L3 processing. Its the linux kernel that will
now forward the packet. Not sure if there will be a data plane rule
installed for this flow.

You could send us the output of ovs-dpctl dump-flows so that we could look
at what flow gets installed when you send packets.

Dave

On Fri, Jul 17, 2015 at 12:43 PM, Pujar, Shyam (Nokia - IN/Bangalore) <
shyam.pujar at nokia.com> wrote:

>  Hi,
>
>                 MAC addresses mentioned in the diagram are just for
> example.
>
> MAC addresses used were as follows:
>
>
>
> Client Program:
>
> 52:54:00:00:01:02
>
>
>
> Server Program:
>
> 52:56:11:80:80:41
>
>
>
> TAP1:
>
> 52:F3:12:E4:6D:A9
>
>
>
> TAP2:
>
> 72:17:32:32:15:F8
>
>
>
> Regards,
>
> Shyam
>
>
>
> *From:* ext Gurucharan Shetty [mailto:shettyg at nicira.com]
> *Sent:* Thursday, July 16, 2015 11:48 PM
> *To:* Pujar, Shyam (Nokia - IN/Bangalore)
> *Cc:* bugs at openvswitch.org
> *Subject:* Re: [ovs-discuss] Flooding of packets destined to OVS port's
> mac address
>
>
>
> I don't know the answer, but some of your mac addresses have multi-cast
> bit enabled. So I wonder whether that is the problem.
>
>
>
> On Wed, Jul 15, 2015 at 12:18 PM, Pujar, Shyam (Nokia - IN/Bangalore) <
> shyam.pujar at nokia.com> wrote:
>
> Hi ,
>
>         Please find setup and testing procedure below.
>
>
>
>
>
> 1.       In the above setup, Client Program tries to send packet with
> src_mac: 3:3:3:3:3:3  and dst_mac: 1:1:1:1:1:1.
>
> 2.       Packet is flood to port tap2.
>
> 3.       Why does OVS flood packets when dst_mac received is its own
> port’s mac address.
>
> 4.       As it forwards to other ports, there is no one to reply for
> dst_mac other than OVS bridge itself.
>
> 5.       Where as in case of Linux bridge, packet is not flooded to other
> ports. Instead packet is dropped.
>
>
>
> Could you please tell me how do switches in real work? As per my
> understanding there should be static entries in forwarding table of switch
> for its own mac addresses.
>
> And default action should be present for it.
>
>
>
>
>
> Regards,
>
> Shyam
>
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/645213f2/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 18205 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/645213f2/attachment-0001.jpg>

From davewaters1970 at gmail.com  Wed Jul 22 15:56:05 2015
From: davewaters1970 at gmail.com (Dave Waters)
Date: Thu, 23 Jul 2015 04:26:05 +0530
Subject: [ovs-discuss] Need help to verify SCTP traffic using openvswitch
In-Reply-To: <CANr6G5wF=o-LDib2NLNpAd793zoBizicHYJ9xWjaLiQJeA7VUQ@mail.gmail.com>
References: <CALK75vhBMTK8G3UtPDiSFYwsE76Wy6iOxV1HxBWs4RVzqiJRjA@mail.gmail.com>
 <CANr6G5wF=o-LDib2NLNpAd793zoBizicHYJ9xWjaLiQJeA7VUQ@mail.gmail.com>
Message-ID: <CAARSoVy7pUjrJVHtsYRq9KBhV6Egfgr1S93=1vtYPuY6FP2Agg@mail.gmail.com>

On the source and the destination where you're sending this sctp traffic,
can you send the output of ovs-dpctl dump-flows and ovs-ofctl dump-flows?
If there is a tunnel between the two hosts, then the packets could be
getting dropped because of the additional header that you have slapped on.

Dave

On Thu, Jul 23, 2015 at 3:19 AM, Joe Stringer <joestringer at nicira.com>
wrote:

> What do you mean by verify?
>
> You'll need to be more specific on your configuration, what openflow
> flows you have, etc. Specifically what is the difference between the
> behaviour you expect and the behaviour you see?
>
> On 22 July 2015 at 06:45, soumya kumar <soumya03081986 at gmail.com> wrote:
> > Hi,
> >
> > I want to verify SCTP traffic between two Hosts.
> > I was trying to verify using two ways
> >    1> using iperf3 ( as it support sctp traffic)
> >    2> using sctp_test command
> >
> >
> > I am not able to see sctp traffic while checking with openvswitch 2.3.1.
> The
> > same command works and able to see sctp traffic when i am not using
> > openvswitch and checked with back-back connected port.
> >
> >
> > Is there a way to verify sctp traffic support for openvswitch.Any simple
> > test to verify this.
> >
> >
> >
> >
> > Regards,
> > Soumya
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/d2bc9ce7/attachment.html>

From ychen103103 at 163.com  Wed Jul 22 20:12:22 2015
From: ychen103103 at 163.com (ychen)
Date: Thu, 23 Jul 2015 11:12:22 +0800 (CST)
Subject: [ovs-discuss] tc ingress qdisc of tapB disappeared when
 del-port tapA from bridge
In-Reply-To: <20150722153415.GC28552@nicira.com>
References: <1c0e8fce.1792d.14eb3811fcd.Coremail.ychen103103@163.com>
 <20150722153415.GC28552@nicira.com>
Message-ID: <5ecd6666.62cd.14eb8e5c3ac.Coremail.ychen103103@163.com>



sorry, but how to contribute to this thread: http://openvswitch.org/pipermail/discuss/2015-May/017687.html
It seems I can only reply this thread http://openvswitch.org/pipermail/discuss/2015-July/018324.html
for this QoS question, here is some of my ideas:
1. add ingress type for QOS just like egress qdisc.
   but I don't think it is a good idea.
   first, it needs lots of code modifcation;
  second, ingress  qdisc have only  one queue, if we add another type for ingress qdisc, it seems incompatible with linux tc.


2. do some query with kernel before del/add ingress qdisc in OVS.
   The main problem is OVS does't know whether users have already configured ingress qdisc without OVS command.
   so if we query kernel first, and compare the kernel rate with OVS ingress rate.
  but still I think it is not a good way. 
  this method needs communication with kernel every time ports updated, and may consume lots of resource.


3. use flag to mark ingress qdisc
    there is already a flag VALID_POLICING to mark OVS ingress qdisc.
   but I don't know why VALID_POLICING is still set when iface->cfg->ingress_policing_rate=0
   I have read the ovs qos code,  and it seems when we use command
   ovs-vsctl set interface tapxxx ingress_policing_rate=0  is just like ovs-vsctl clear interface tapxxx ingress_policing_rate
   so I think we can just use the already existing flag VALID_POLICING
   when VALID_POLICING is unset, and when update port qos function is called with parameter kbits_rate equal to netdev->kbits_rate
  then we do nothing for  this port.


  I have tested QOS feature with method 3, and when ovs restart, add-port to qos. del-port from qos, update port's atrributes, 
  tc ingress qdisc can be reserved.

At 2015-07-22 23:34:15, "Ben Pfaff" <blp at nicira.com> wrote:
>On Wed, Jul 22, 2015 at 10:04:20AM +0800, ychen wrote:
>> I found that when delete one port from ovs bridge, then another port's tc ingress qdisc automatically disappeared, but egress qdisc is still existed.
>> I have tried version 2.3.2 and master branch of ovs, the bug still exists in these 2 branch.
>> we can reproduce this phenomenon following the step:
>> 1. create 2 tap device
>>    ip tuntap add dev tap111 mode tap
>>   ip tuntap add dev tap222 mode tap
>> 
>> 
>> 2. add port to ovs bridge
>>    ovs-vsctl add-br br0
>>    ovs-vsctl add-port br0 tap111
>>   ovs-vsctl add-port br0 tap222
>> 
>> 
>> 3. add ingress qdisc for these 2 ports
>>    tc qdisc add dev tap111 ingress
>>   tc qdisc add dev tap222 ingress
>> 
>> 
>> 4.delete port tap111
>>    ovs-vsctl del-port br0 tap111   
>>   ////// then we can see tc ingress qdisc of tap222 disappear//////////
>
>OVS assumes it's in charge of QoS currently for ports in its bridges.
>
>If you want to change that assumption then you should contribute to this
>thread:
>http://openvswitch.org/pipermail/discuss/2015-May/017687.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/141c8c74/attachment.html>

From soumya03081986 at gmail.com  Wed Jul 22 22:36:26 2015
From: soumya03081986 at gmail.com (soumya kumar)
Date: Thu, 23 Jul 2015 11:06:26 +0530
Subject: [ovs-discuss] Need help to verify SCTP traffic using openvswitch
In-Reply-To: <CAARSoVy7pUjrJVHtsYRq9KBhV6Egfgr1S93=1vtYPuY6FP2Agg@mail.gmail.com>
References: <CALK75vhBMTK8G3UtPDiSFYwsE76Wy6iOxV1HxBWs4RVzqiJRjA@mail.gmail.com>
 <CANr6G5wF=o-LDib2NLNpAd793zoBizicHYJ9xWjaLiQJeA7VUQ@mail.gmail.com>
 <CAARSoVy7pUjrJVHtsYRq9KBhV6Egfgr1S93=1vtYPuY6FP2Agg@mail.gmail.com>
Message-ID: <CALK75viu5Ds+Az0F5U9Aesa76wg-Wn_BPOXrv5=5PfbWmLi6Vw@mail.gmail.com>

Hi Dave,

Thanks for your reply.

I have attached the configuration detail in the email, Please let me know
if you need more information on the same.

Joe, I just want to check sctp traffic communication between two ovs
bridge, i was expecting that i should see sctp traffic, able to see tcp and
udp traffic between two bridge but sctp traffic is not seen.
Please check the attached configuration detail .


Regard,
Soumya

On 23 July 2015 at 04:26, Dave Waters <davewaters1970 at gmail.com> wrote:

> On the source and the destination where you're sending this sctp traffic,
> can you send the output of ovs-dpctl dump-flows and ovs-ofctl dump-flows?
> If there is a tunnel between the two hosts, then the packets could be
> getting dropped because of the additional header that you have slapped on.
>
> Dave
>
> On Thu, Jul 23, 2015 at 3:19 AM, Joe Stringer <joestringer at nicira.com>
> wrote:
>
>> What do you mean by verify?
>>
>> You'll need to be more specific on your configuration, what openflow
>> flows you have, etc. Specifically what is the difference between the
>> behaviour you expect and the behaviour you see?
>>
>> On 22 July 2015 at 06:45, soumya kumar <soumya03081986 at gmail.com> wrote:
>> > Hi,
>> >
>> > I want to verify SCTP traffic between two Hosts.
>> > I was trying to verify using two ways
>> >    1> using iperf3 ( as it support sctp traffic)
>> >    2> using sctp_test command
>> >
>> >
>> > I am not able to see sctp traffic while checking with openvswitch
>> 2.3.1. The
>> > same command works and able to see sctp traffic when i am not using
>> > openvswitch and checked with back-back connected port.
>> >
>> >
>> > Is there a way to verify sctp traffic support for openvswitch.Any simple
>> > test to verify this.
>> >
>> >
>> >
>> >
>> > Regards,
>> > Soumya
>> >
>> > _______________________________________________
>> > discuss mailing list
>> > discuss at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/discuss
>> >
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/4cc2a27e/attachment-0001.html>
-------------- next part --------------
Host-1 configuration:
====================
[root at localhost openvswitch-2.3.1]# ovs-vsctl show
0b49e9b6-4b37-46d1-9e92-f9d5f995af8a
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
        Port "vxlan0"
            Interface "vxlan0"
                type: vxlan
                options: {remote_ip="192.168.1.10"}
[root at localhost openvswitch-2.3.1]# ifconfig p2p1
p2p1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::21b:21ff:fe47:6af8  prefixlen 64  scopeid 0x20<link>
        ether 00:1b:21:47:6a:f8  txqueuelen 1000  (Ethernet)
        RX packets 71  bytes 10567 (10.3 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 147  bytes 28491 (27.8 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root at localhost openvswitch-2.3.1]# ifconfig br0
br0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450
        inet 10.10.10.2  netmask 255.255.255.0  broadcast 10.10.10.255
        inet6 fe80::34d3:f2ff:fe2e:394d  prefixlen 64  scopeid 0x20<link>
        ether 36:d3:f2:2e:39:4d  txqueuelen 0  (Ethernet)
        RX packets 3  bytes 182 (182.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 30  bytes 4252 (4.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root at localhost openvswitch-2.3.1]# 


Host-2 configuration:
====================
[root at localhost openvswitch-2.3.1]# ovs-vsctl show
88f2bd6b-abdb-42c5-9762-be193883b363
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
        Port "vxlan0"
            Interface "vxlan0"
                type: vxlan
                options: {remote_ip="192.168.1.11"}
[root at localhost openvswitch-2.3.1]# ifconfig p1p1
p1p1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.10  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::21b:21ff:febb:3104  prefixlen 64  scopeid 0x20<link>
        ether 00:1b:21:bb:31:04  txqueuelen 1000  (Ethernet)
        RX packets 139  bytes 29443 (28.7 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 217  bytes 25247 (24.6 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root at localhost openvswitch-2.3.1]# ifconfig br0
br0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450
        inet 10.10.10.3  netmask 255.255.255.0  broadcast 10.10.10.255
        inet6 fe80::1495:cff:fe48:5847  prefixlen 64  scopeid 0x20<link>
        ether 16:95:0c:48:58:47  txqueuelen 0  (Ethernet)
        RX packets 30  bytes 4252 (4.1 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 29  bytes 4897 (4.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root at localhost openvswitch-2.3.1]# 




SCTP TEST:
=========
Host-2:

[root at localhost openvswitch-2.3.1]# sctp_test -H 10.10.10.3 -P 19000 -h 10.10.10.2 -p 19001 -l
remote:addr=10.10.10.2, port=19001, family=2
local:addr=10.10.10.3, port=igrid, family=2
seed = 1437629180

Starting tests...
	socket(SOCK_SEQPACKET, IPPROTO_SCTP)  ->  sk=3
	bind(sk=3, [a:10.10.10.3,p:igrid])  --  attempt 1/10
	listen(sk=3,backlog=100)
Server: Receiving packets.
	recvmsg(sk=3) Notification: SCTP_ASSOC_CHANGE(COMMUNICATION_UP)
		(assoc_change: state=0, error=0, instr=10 outstr=10)
	recvmsg(sk=3) Data 1 bytes. First 1 bytes: <empty> text[0]=0
	recvmsg(sk=3) Notification: SCTP_ASSOC_CHANGE(COMMUNICATION_LOST)
		(assoc_change: state=1, error=0, instr=0 outstr=0)
	recvmsg(sk=3) 



=============
Host-1:

[root at localhost openvswitch-2.3.1]# sctp_test -H 10.10.10.2 -P 19001 -h 10.10.10.3 -p 19000 -s
remote:addr=10.10.10.3, port=igrid, family=2
local:addr=10.10.10.2, port=19001, family=2
seed = 1437627548

Starting tests...
	socket(SOCK_SEQPACKET, IPPROTO_SCTP)  ->  sk=3
	bind(sk=3, [a:10.10.10.2,p:19001])  --  attempt 1/10
Client: Sending packets.(1/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2082906182
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1491096876
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1422135459
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1321169211
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=223500771
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1439362218
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=546555122
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=664489249
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1284111518
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2109450025
Client: Sending packets.(2/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1756070314
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=129647013
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1840072735
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=459604053
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1912473904
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1560941021
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=879714667
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1394742665
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=791413906
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1667658877
Client: Sending packets.(3/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1739004425
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1750090747
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1997851308
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1045391409
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1510755697
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1700671588
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1165511316
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=702361361
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=870604023
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1885747051
Client: Sending packets.(4/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=143644437
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=806026557
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1229360279
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1565779897
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2127195769
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1452861050
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=857658467
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=526267243
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2117350300
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2141769985
Client: Sending packets.(5/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=488233620
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1725936966
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=123933350
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=180822708
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=38057371
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2036407254
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1741763729
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=917772039
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1283666271
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=385693987
Client: Sending packets.(6/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=437947268
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=875187048
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2135784734
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=288314928
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1920578457
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1499056784
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1988986517
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=938606125
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=53934497
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=712106892
Client: Sending packets.(7/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=676869529
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=197578934
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1518133450
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1906229808
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1763358831
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1497845571
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1211607211
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=473533650
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2024112814
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1181473863
Client: Sending packets.(8/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=467819987
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=364862786
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=759927181
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=591753337
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=545685494
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=797984552
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=480676943
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=139965575
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1715756591
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1764343214
Client: Sending packets.(9/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=525659563
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=6220212
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=492046614
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=513960649
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=294535140
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=265141423
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2013017433
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=136038009
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1203747549
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=2066951930
Client: Sending packets.(10/10)
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=848144902
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1880617078
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=117047217
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=218794704
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1639363238
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1880406048
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1716640275
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=703486801
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=206456051
	sendmsg(sk=3, assoc=0)    1 bytes.
	  SNDRCV(stream=0 flags=0x1 ppid=1593269441
	close(sk=3)
[root at localhost openvswitch-2.3.1]# 

dpclt aoutput while running above test:
======================================
Host-1:

[root at localhost ~]# ovs-dpctl dump-flows
recirc_id(0),skb_priority(0),in_port(1),eth(src=36:d3:f2:2e:39:4d,dst=16:95:0c:48:58:47),eth_type(0x0800),ipv4(src=10.10.10.2/0.0.0.0,dst=10.10.10.3/0.0.0.0,proto=132/0,tos=0x2/0x3,ttl=64/0,frag=no/0xff), packets:2, bytes:348, used:0.482s, actions:set(tunnel(tun_id=0x0,src=0.0.0.0,dst=192.168.1.10,tos=0x2,ttl=64,flags(df))),2
recirc_id(0),skb_priority(0),tunnel(tun_id=0x0,src=192.168.1.10,dst=192.168.1.11,tos=0x2,ttl=64,flags(key)),in_port(2),skb_mark(0),eth(src=16:95:0c:48:58:47,dst=36:d3:f2:2e:39:4d),eth_type(0x0800),ipv4(src=10.10.10.3/0.0.0.0,dst=10.10.10.2/0.0.0.0,proto=132/0,tos=0x2/0,ttl=64/0,frag=no/0xff), packets:1, bytes:66, used:0.482s, actions:1
[root at localhost ~]# 

[root at localhost ~]# ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=520.150s, table=0, n_packets=96, n_bytes=11120, idle_age=0, priority=0 actions=NORMAL
[root at localhost ~]# 



TCP and UDP traffic:

[root at localhost openvswitch-2.3.1]# iperf -s
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size: 85.3 KByte (default)
------------------------------------------------------------
[  4] local 10.10.10.2 port 5001 connected with 10.10.10.3 port 50307
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0-11.2 sec   640 KBytes   469 Kbits/sec
^C[root at localhost openvswitch-2.3.1]# iperf -s -u
------------------------------------------------------------
Server listening on UDP port 5001
Receiving 1470 byte datagrams
UDP buffer size:  208 KByte (default)
------------------------------------------------------------
[  3] local 10.10.10.2 port 5001 connected with 10.10.10.3 port 36930
[ ID] Interval       Transfer     Bandwidth        Jitter   Lost/Total Datagrams
[  3]  0.0-10.0 sec  1.25 MBytes  1.05 Mbits/sec   0.004 ms    0/  893 (0%)
^C[root at localhost openvswitch-2.3.1]# 



From daniel.herrmann at igd.fraunhofer.de  Thu Jul 23 02:30:26 2015
From: daniel.herrmann at igd.fraunhofer.de (Daniel Herrmann)
Date: Thu, 23 Jul 2015 11:30:26 +0200
Subject: [ovs-discuss] Problems with MPLS header pushing
In-Reply-To: <CALnjE+o5FGFOQ9SVgsbneka8rhN7g4Xpag3kKdJN9midhR_mHA@mail.gmail.com>
References: <55A8C028.1060308@igd.fraunhofer.de>	<55AE6033.7080803@igd.fraunhofer.de>
 <CALnjE+o5FGFOQ9SVgsbneka8rhN7g4Xpag3kKdJN9midhR_mHA@mail.gmail.com>
Message-ID: <55B0B432.8020700@igd.fraunhofer.de>

On 21.07.2015 18:47, Pravin Shelar wrote:
> On Tue, Jul 21, 2015, Daniel Herrmann wrote:
>> Hi,
>>
>> I know this may not be a very interesting question, but I do not have
>> any idea why forwarding does not work.
>>
>> Any help would really be appreciated.
>>
> There were few MPLS fixed pushed in branch 2.4, Can you try it on
> master or branch 2.4?

Thank you very much, too easy solution... recompiled OVS based on the
master branch and now it works.

Best regards
Daniel

From kevin.traynor at intel.com  Thu Jul 23 03:26:21 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 23 Jul 2015 10:26:21 +0000
Subject: [ovs-discuss] OVS segmentation fault due to incorrect TX queue
 setup with netdev-dpdk
In-Reply-To: <D1CDBBCA.4CCE%diproiettod@vmware.com>
References: <D1CDBBCA.4CCE%diproiettod@vmware.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7451BB85A@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Daniele
> Di Proietto
> Sent: Thursday, July 16, 2015 8:03 PM
> To: Stokes, Ian
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] OVS segmentation fault due to incorrect TX queue
> setup with netdev-dpdk
> 
> Hi,
> 
> Thanks for the very detailed report!  I've sent two
> patches to the mailing list that should address the
> issues.  Would you mind testing them?
> 
> More comments inline
> 
> On 15/07/2015 11:49, "Stokes, Ian" <ian.stokes at intel.com> wrote:
> 
> >Hi All,
> >
> >I¹ve been investigating a segmentation fault caused by the incorrect
> >setup of TX queues for netdev-dpdk. It occurs in the following scenario.
> >
> >Running OVS with DPDK on a system with 72 cores (Hyper threading enabled)
> >and using an Intel XL710 Network Card.
> >
> >Default behavior in OVS when adding a DPDK physical port is to attempt to
> >setup 1 tx queue for each core detected on the system plus one more queue
> >for non_pmd threads.
> >
> >In this case 73 tx queues will be requested in total.
> >
> >The standard behavior when initializing a DPDK port is to check the
> >number of queues being requested against the max number of queues
> >available for the device itself.
> >
> >This is done in dpdk_eth_dev_init() with the following code segment
> >Š
> >    rte_eth_dev_info_get(dev->port_id, &info);
> >    dev->up.n_rxq = MIN(info.max_rx_queues, dev->up.n_rxq);
> >    dev->real_n_txq = MIN(info.max_tx_queues, dev->up.n_txq);
> >
> >    diag = rte_eth_dev_configure(dev->port_id, dev->up.n_rxq,
> >dev->real_n_txq, &port_conf);
> >Š
> >
> >The smaller of the two values is selected as the real amount of tx queues
> >that can be setup. This accommodates a situation where we could have more
> >cores on a system than we have tx queues on the network device in DPDK.
> >
> >This has worked fine with the previous generation of Intel interfaces
> >such as Intel 82599. However it will not work with the XL710.
> >
> >In DPDK the XL710 has a total of 316 tx queues that can be used. From the
> >check above we would think we can allocate 73 of these tx queues without
> >issue. But the 316 queues available are subdivided between different
> >queue types.
> >
> >For a DPDK host application (In this case OVS) queues 1 ­ 64 inclusive
> >can be used. However queue 65 to 96 are strictly for SRIOV tx queue use.
> >
> >
> >The check for max_tx_queues above will identify the total number of
> >queues available (316), compare it to the number of queues being
> >requested (73) and will select 73 as the real_n_txq. But this is not the
> >correct number of tx queues that are usable by
> > OVS (64).
> >
> >We can cause the switch to segfault by doing the following
> >
> >Add a dpdk physical port
> >
> >sudo $OVS_DIR/utilities/ovs-vsctl add-br br0 -- set Bridge br0
> >datapath_type=netdev
> >sudo $OVS_DIR/utilities/ovs-vsctl add-port br0 dpdk0 -- set Interface
> >dpdk0 type=dpdk
> >
> >This will output the following warning
> >ovs-vsctl: Error detected while setting up 'dpdk0'.  See ovs-vswitchd log
> >for details.
> >
> >Looking at the log we see
> >
> >PMD: i40e_dev_tx_queue_setup(): Using simple tx path
> >PMD: i40e_pf_get_vsi_by_qindex(): queue_idx out of range. VMDQ configured?
> >2015-07-15T01:22:48Z|00019|dpdk|ERR|eth dev tx queue setup error -5
> >2015-07-15T01:22:48Z|00020|dpif_netdev|ERR|dpdk0, cannot set multiq
> >2015-07-15T01:22:48Z|00021|dpif|WARN|netdev at ovs-netdev: failed to add
> >dpdk0 as port: Resource temporarily unavailable
> >
> >This is as expected. This warning will be reported in dpdk_eth_dev_init()
> >by the following code segment when it attempts to initialize the 65th
> >queue
> >
> >    for (i = 0; i < dev->real_n_txq; i++) {
> >        diag = rte_eth_tx_queue_setup(dev->port_id, i, NIC_PORT_TX_Q_SIZE,
> >                                      dev->socket_id, NULL);
> >        if (diag) {
> >            VLOG_ERR("eth dev tx queue setup error %d",diag);
> >            return -diag;
> >        }
> >    }
> >
> >Then add an internal port type to the same bridge
> >
> >sudo $OVS_DIR/utilities/ovs-vsctl add-port br0 testif1 -- set interface
> >testif1 type=internal
> >
> >I was surprised to see that after adding the internal port , the DPDK
> >port that failed previously is now added as well. Is this expected
> >behavior?
> 
> No, this is a genuine OVS bug.  The first patch in the series
> addresses that.
> 
> >Looking at the vswitch log I can see that both the internal port and the
> >DPDK port have port IDs now.
> >
> >2015-07-15T01:23:19Z|00024|bridge|INFO|bridge br0: added interface
> >testif1 on port 1
> >2015-07-15T01:23:19Z|00025|dpif_netdev|INFO|Created 1 pmd threads on numa
> >node 0
> >2015-07-15T01:23:19Z|00001|dpif_netdev(pmd40)|INFO|Core 0 processing port
> >'dpdk0'
> >2015-07-15T01:23:19Z|00002|dpif_netdev(pmd40)|INFO|Core 0 processing port
> >'dpdk0'
> >2015-07-15T01:23:19Z|00026|bridge|INFO|bridge br0: added interface dpdk0
> >on port 2
> >2015-07-15T01:23:19Z|00027|bridge|INFO|bridge br0: using datapath ID
> >00006805ca2d3cb8
> >
> >If we assign an IP to the internal port we will segfault the vswitch
> >sudo ip addr add 192.168.1.1/24 dev testif1
> >
> >This is caused by the internal interface broadcasting an ICMP6 neighbor
> >solicitation message. This packet is copied from kernel space memory to
> >DPDK memory in the netdev_dpdk_send__() function.
> >The issue is that the qid passed to netdev_dpdk_send__ function is 72.
> >This packet will eventually be transmitted with with rte_eth_tx_burst
> >with a tx qid of 72.
> >In DPDK, queue 72 for the XL710 is for SRIOV use only and so will not be
> >initialized during the rte_eth_tx_queue_setup process above and so the
> >switch segfaults when an attempt is made to access it.
> >
> >
> >In terms of a solution to this I would appreciate some feedback on what
> >people think is the best approach.
> >
> >Ideally DPDK could extend the number of sequential queues supported for
> >host DPDK applications.
> >Previous generation cards supported 128 TX queues that could be used with
> >a host application, hence why this issue is not seen with them.
> >
> >This however would not fix the immediate issue and would be more of a
> >long term solution. It could be flagged in the documentation as a known
> >issue/corner case that is not supported in the mean time.
> >
> >Alternatively OVS could attempt to setup as many queues as possible on
> >the DPDK device itself. If an error is detected the appropriate fields
> >would have to be updated such as
> >dev->real_n_txq.
> >In this case we would setup 64 of the requested 73, log a warning message
> >to the user. However there may be issues with how the pmd threads map to
> >the correct tx queue IDs.
> >I¹ve noticed that when netdev_dpdk_send__ is called the qid is 72, and
> >this value comes from dp_execute_cb() where the tx_qid is taken from the
> >dp_netdev_pmd_thread.
> >
> >Any Feedback would be appreciated.
> 
> netdev-dpdk already supports working with a smaller of
> txqs by using a spinlock.
> 
> The ideal fix (IMHO) would be for DPDK to report the usable
> number of transmission queues.  In the meantime we can retry
> with less transmission queues if the queue setup fails.
> 
> I've implemented this workaroud in the second patch of the
> series.

Thanks. I agree, ideally we could get this information from DPDK. DPDK team
are aware of it and hopefully we can get a fix into R2.2

> 
> >
> >Thanks
> >Ian
> >
> >
> >
> >
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From Dave.Johnston at owmobility.com  Thu Jul 23 04:08:15 2015
From: Dave.Johnston at owmobility.com (Dave Johnston)
Date: Thu, 23 Jul 2015 11:08:15 +0000
Subject: [ovs-discuss] How to connect to physical hosts with OVS and VLAN
	tags
In-Reply-To: <mailman.0.1437649039.14758.discuss@openvswitch.org>
References: <mailman.0.1437649039.14758.discuss@openvswitch.org>
Message-ID: <DM2PR0501MB158117CF37A423E817FEB7F591820@DM2PR0501MB1581.namprd05.prod.outlook.com>

Hi,

I'm attempting to test a workload over OVS.  
Currently I can run the workload without OVS, with the following network configuration:

Host1:
eth1.1000 (192.168.0.10) => eth1

Host2:
eth1.1000 (192.168.0.20) => eth1

Both hosts have an interface configured to perform VLAN tagging.  From host1 I can ping 192.168.0.20 and visa versa.

I tried to setup an OVS bridge on host2, so I removed eth1.1000 and did the following:

# Create the bridge
ovs-vsctl add-br br-eth1

# Add the port
ovs-vsctl add-port eth1

# Create a veth pair
ip link add veth0 type veth peer name veth1

# Plug veth1 into the switch
ovs-vsctl add-port veth1

# Configure IP on veth0
ifconfig veth0 192.168.0.20

# Add tagging to the port
ovs-vsctl set port veth1 tag=1000

Running:
ping -I veth0 192.168.0.10 shows the destination is unavailable.

Any suggestions on whats wrong here?  How can I configure the setup?

Thanks

From gowrishankar.m at linux.vnet.ibm.com  Thu Jul 23 07:19:06 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Thu, 23 Jul 2015 19:49:06 +0530
Subject: [ovs-discuss] packets getting dropped at egress
In-Reply-To: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>
References: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>
Message-ID: <55B0F7DA.7090401@linux.vnet.ibm.com>

On Thursday 23 July 2015 04:16 AM, Dave Waters wrote:
> Hi,
>
> I have two ports in my OVS bridge. I receive packets from one port 
> (portA) and i send them out of the other (portB). When i send out the 
> packets, they are VXLAN tunneled to the other end.
>
> Now, the default MTU of all ports (including the bridge port) is 1500 
> in my setup.
>
> The issue is that when i get a 1500 byte packet on portA, i try to 
> push it out on portB after slapping on the VXLAN headers. This results 
> in a packet size thats greater than what portB can handle, and hence 
> the packets are dropped.
>

Is increasing MTU of portB to 1550 (to accommodate additional 50 bytes 
when no vlan taged) a constraint in your setup ?

> I know that OVS does not handle IP fragmentation/reassembly, so how do 
> we deal with this situation? I dont think we can rely on path MTU 
> discovery since not all applications do PMTU before spewing out 
> packets. Any ideas, anybody?
>
> Warm regards,
> Dave
>

-- 
Regards,
Gowrishankar M


From davewaters1970 at gmail.com  Thu Jul 23 08:19:46 2015
From: davewaters1970 at gmail.com (Dave Waters)
Date: Thu, 23 Jul 2015 20:49:46 +0530
Subject: [ovs-discuss] packets getting dropped at egress
In-Reply-To: <55B0F7DA.7090401@linux.vnet.ibm.com>
References: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>
 <55B0F7DA.7090401@linux.vnet.ibm.com>
Message-ID: <CAARSoVwfr6RhixEDWgGoa3zXRQC5B2QeR9EYVtDi5bfnnYYxTg@mail.gmail.com>

Its not. But how do i ensure that my packet does not get dropped somewhere
downstream, since i have now increased it beyond the original value?

On Thu, Jul 23, 2015 at 7:49 PM, gowrishankar <
gowrishankar.m at linux.vnet.ibm.com> wrote:

> On Thursday 23 July 2015 04:16 AM, Dave Waters wrote:
>
>> Hi,
>>
>> I have two ports in my OVS bridge. I receive packets from one port
>> (portA) and i send them out of the other (portB). When i send out the
>> packets, they are VXLAN tunneled to the other end.
>>
>> Now, the default MTU of all ports (including the bridge port) is 1500 in
>> my setup.
>>
>> The issue is that when i get a 1500 byte packet on portA, i try to push
>> it out on portB after slapping on the VXLAN headers. This results in a
>> packet size thats greater than what portB can handle, and hence the packets
>> are dropped.
>>
>>
> Is increasing MTU of portB to 1550 (to accommodate additional 50 bytes
> when no vlan taged) a constraint in your setup ?
>
>
>  I know that OVS does not handle IP fragmentation/reassembly, so how do we
>> deal with this situation? I dont think we can rely on path MTU discovery
>> since not all applications do PMTU before spewing out packets. Any ideas,
>> anybody?
>>
>> Warm regards,
>> Dave
>>
>>
> --
> Regards,
> Gowrishankar M
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/259184f3/attachment.html>

From blp at nicira.com  Thu Jul 23 08:34:53 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 23 Jul 2015 08:34:53 -0700
Subject: [ovs-discuss] How to connect to physical hosts with OVS and
 VLAN tags
In-Reply-To: <DM2PR0501MB158117CF37A423E817FEB7F591820@DM2PR0501MB1581.namprd05.prod.outlook.com>
References: <mailman.0.1437649039.14758.discuss@openvswitch.org>
 <DM2PR0501MB158117CF37A423E817FEB7F591820@DM2PR0501MB1581.namprd05.prod.outlook.com>
Message-ID: <20150723153453.GA3888@nicira.com>

On Thu, Jul 23, 2015 at 11:08:15AM +0000, Dave Johnston wrote:
> Hi,
> 
> I'm attempting to test a workload over OVS.  
> Currently I can run the workload without OVS, with the following network configuration:
> 
> Host1:
> eth1.1000 (192.168.0.10) => eth1
> 
> Host2:
> eth1.1000 (192.168.0.20) => eth1
> 
> Both hosts have an interface configured to perform VLAN tagging.  From host1 I can ping 192.168.0.20 and visa versa.
> 
> I tried to setup an OVS bridge on host2, so I removed eth1.1000 and did the following:
> 
> # Create the bridge
> ovs-vsctl add-br br-eth1
> 
> # Add the port
> ovs-vsctl add-port eth1
> 
> # Create a veth pair
> ip link add veth0 type veth peer name veth1
> 
> # Plug veth1 into the switch
> ovs-vsctl add-port veth1
> 
> # Configure IP on veth0
> ifconfig veth0 192.168.0.20
> 
> # Add tagging to the port
> ovs-vsctl set port veth1 tag=1000
> 
> Running:
> ping -I veth0 192.168.0.10 shows the destination is unavailable.
> 
> Any suggestions on whats wrong here?  How can I configure the setup?

Can you explain why you're using a veth pair?  I don't see a reason for
it, and it makes the whole setup more complicated.

From blp at nicira.com  Thu Jul 23 08:51:41 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 23 Jul 2015 08:51:41 -0700
Subject: [ovs-discuss] tc ingress qdisc of tapB disappeared when
 del-port tapA from bridge
In-Reply-To: <5ecd6666.62cd.14eb8e5c3ac.Coremail.ychen103103@163.com>
References: <1c0e8fce.1792d.14eb3811fcd.Coremail.ychen103103@163.com>
 <20150722153415.GC28552@nicira.com>
 <5ecd6666.62cd.14eb8e5c3ac.Coremail.ychen103103@163.com>
Message-ID: <20150723155141.GD3888@nicira.com>

On Thu, Jul 23, 2015 at 11:12:22AM +0800, ychen wrote:
> sorry, but how to contribute to this thread: http://openvswitch.org/pipermail/discuss/2015-May/017687.html
> It seems I can only reply this thread http://openvswitch.org/pipermail/discuss/2015-July/018324.html

I don't see how any of your solutions solve the problem described in
http://openvswitch.org/pipermail/discuss/2015-May/017687.html.  I don't
see much value in just tweaking the parameters of the problem.

From lxuemei3000 at gmail.com  Thu Jul 23 10:04:23 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Thu, 23 Jul 2015 10:04:23 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
Message-ID: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>

Hi,

I am new to ovs, and I am trying to send all packets from kernel space to
user space. I comment the "unlikely(!flow)" in datapath/datapath.c.
However, it seems I just receive the first packet of each flow (the first
packet that match one forwarding rule in the bridge) in user space. Could
anyone tell me why? and is there other way to achieve my goal?

[image: Inline image 1]

Thanks,
Xuemei
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/b994b501/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 148483 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/b994b501/attachment-0001.png>

From blp at nicira.com  Thu Jul 23 10:13:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 23 Jul 2015 10:13:59 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
Message-ID: <20150723171359.GG3888@nicira.com>

On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
> I am new to ovs, and I am trying to send all packets from kernel space to
> user space. I comment the "unlikely(!flow)" in datapath/datapath.c.
> However, it seems I just receive the first packet of each flow (the first
> packet that match one forwarding rule in the bridge) in user space. Could
> anyone tell me why? and is there other way to achieve my goal?

You realize that this will be terrible for performance, right?

It's kind of a waste to modify the kernel module for this.  I'd just
modify userspace to send all packets to userspace, something like this:

diff --git a/ofproto/ofproto-dpif-xlate.c b/ofproto/ofproto-dpif-xlate.c
index 52395a7..a98406a 100644
--- a/ofproto/ofproto-dpif-xlate.c
+++ b/ofproto/ofproto-dpif-xlate.c
@@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin, struct xlate_out *xout)
 
     ctx.xin = xin;
     ctx.xout = xout;
-    ctx.xout->slow = 0;
+    ctx.xout->slow = SLOW_ACTION;
     ctx.xout->has_learn = false;
     ctx.xout->has_normal = false;
     ctx.xout->has_fin_timeout = false;

From lxuemei3000 at gmail.com  Thu Jul 23 10:19:33 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Thu, 23 Jul 2015 10:19:33 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <20150723171359.GG3888@nicira.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
 <20150723171359.GG3888@nicira.com>
Message-ID: <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>

Hi, Ben,

Thanks for your response.
"You realize that this will be terrible for performance, right?"
In fact, I have not got all packets sent to user space. That is the problem
I am facing now. I think performance might be another problem after I can
receive all packet in user space.

Thanks,
Xuemei

On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
> > I am new to ovs, and I am trying to send all packets from kernel space to
> > user space. I comment the "unlikely(!flow)" in datapath/datapath.c.
> > However, it seems I just receive the first packet of each flow (the first
> > packet that match one forwarding rule in the bridge) in user space. Could
> > anyone tell me why? and is there other way to achieve my goal?
>
> You realize that this will be terrible for performance, right?
>
> It's kind of a waste to modify the kernel module for this.  I'd just
> modify userspace to send all packets to userspace, something like this:
>
> diff --git a/ofproto/ofproto-dpif-xlate.c b/ofproto/ofproto-dpif-xlate.c
> index 52395a7..a98406a 100644
> --- a/ofproto/ofproto-dpif-xlate.c
> +++ b/ofproto/ofproto-dpif-xlate.c
> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin, struct xlate_out
> *xout)
>
>      ctx.xin = xin;
>      ctx.xout = xout;
> -    ctx.xout->slow = 0;
> +    ctx.xout->slow = SLOW_ACTION;
>      ctx.xout->has_learn = false;
>      ctx.xout->has_normal = false;
>      ctx.xout->has_fin_timeout = false;
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/9ad3920c/attachment.html>

From takahashi.minoru7 at gmail.com  Wed Jul 22 01:25:30 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Wed, 22 Jul 2015 17:25:30 +0900
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <20150721151917.GC15450@nicira.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
 <55A886CE.3040305@gmail.com> <20150717164204.GG10847@nicira.com>
 <55ADE240.8000309@gmail.com> <20150721151917.GC15450@nicira.com>
Message-ID: <55AF537A.3060800@gmail.com>

Hi,

Thank you for reply.

On 2015年07月22日 00:19, Ben Pfaff wrote:
> On Tue, Jul 21, 2015 at 03:10:08PM +0900, Minoru TAKAHASHI wrote:
>>> they do not make the corresponding change to the decoder
>>
>> Should I fix this problem?
>> If so, please tell me that which source file should I fix.
>> (Sorry, I am new in implementation of OpenvSwitch.)
> 
> I cannot apply anything to the repository that makes tests fail, so yes
> you should fix the decoder.
> 
> The decode function is right next to the encode function.
> 

OK, I will try to make a patch.
Please, wait a while.

thanks,

From takahashi.minoru7 at gmail.com  Wed Jul 22 21:41:45 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Thu, 23 Jul 2015 13:41:45 +0900
Subject: [ovs-discuss] Questions about the implementation of the ofp-util
Message-ID: <55B07089.7070902@gmail.com>

Hi,

I plan to implement encoding function of ofp-util that unsupported now (ex. QueueDescRequest, GroupDescStatsReply,,,).
So, there are a few things that I would like to know.

 * When I post, are there any implementation to be posted at the same time?
    (testcase? decoding fuction? ...)

 * If there is an implementation should be posted at the same time, 
    is it possible to post the only encoding function as a first step?
    (In other words, Is it possible to add encoding function only to ovs repository?)

thanks,

From shyam.pujar at nokia.com  Thu Jul 23 05:36:41 2015
From: shyam.pujar at nokia.com (Pujar, Shyam (Nokia - IN/Bangalore))
Date: Thu, 23 Jul 2015 12:36:41 +0000
Subject: [ovs-discuss] Flooding of packets destined to OVS port's mac
 address
In-Reply-To: <CAARSoVxpgHQ0P4hHOLu0tqXpp5ajrcL98NzcP8CqmcCLZS2OHA@mail.gmail.com>
References: <54F3CC316BCACF48A126BE3ED38CD1F319B4E84C@SGSIMBX005.nsn-intra.net>
 <CAHbON5piZJMbkvfRtvoe726nP9wu-7DzB1A1Z4b0Ki7O2DSaYA@mail.gmail.com>
 <54F3CC316BCACF48A126BE3ED38CD1F319B4EE7C@SGSIMBX005.nsn-intra.net>
 <CAARSoVxpgHQ0P4hHOLu0tqXpp5ajrcL98NzcP8CqmcCLZS2OHA@mail.gmail.com>
Message-ID: <54F3CC316BCACF48A126BE3ED38CD1F319BE236E@SGSIMBX005.nsn-intra.net>

Hi,
                Flow entries in ovs are 0 in the initial phase. However I got reply from the group that switch ports do not have mac address.


Regards,
Shyam

From: ext Dave Waters [mailto:davewaters1970 at gmail.com]
Sent: Thursday, July 23, 2015 4:24 AM
To: Pujar, Shyam (Nokia - IN/Bangalore)
Cc: ext Gurucharan Shetty; bugs at openvswitch.org
Subject: Re: [ovs-discuss] Flooding of packets destined to OVS port's mac address

Shyam,

Not sure but the following could be happening:

When OVS receives the first packet with its own MAC address it hands it over to the Linux kernel for L3 processing. Its the linux kernel that will now forward the packet. Not sure if there will be a data plane rule installed for this flow.

You could send us the output of ovs-dpctl dump-flows so that we could look at what flow gets installed when you send packets.

Dave

On Fri, Jul 17, 2015 at 12:43 PM, Pujar, Shyam (Nokia - IN/Bangalore) <shyam.pujar at nokia.com<mailto:shyam.pujar at nokia.com>> wrote:
Hi,
                MAC addresses mentioned in the diagram are just for example.
MAC addresses used were as follows:

Client Program:
52:54:00:00:01:02

Server Program:
52:56:11:80:80:41

TAP1:
52:F3:12:E4:6D:A9

TAP2:
72:17:32:32:15:F8

Regards,
Shyam

From: ext Gurucharan Shetty [mailto:shettyg at nicira.com<mailto:shettyg at nicira.com>]
Sent: Thursday, July 16, 2015 11:48 PM
To: Pujar, Shyam (Nokia - IN/Bangalore)
Cc: bugs at openvswitch.org<mailto:bugs at openvswitch.org>
Subject: Re: [ovs-discuss] Flooding of packets destined to OVS port's mac address

I don't know the answer, but some of your mac addresses have multi-cast bit enabled. So I wonder whether that is the problem.

On Wed, Jul 15, 2015 at 12:18 PM, Pujar, Shyam (Nokia - IN/Bangalore) <shyam.pujar at nokia.com<mailto:shyam.pujar at nokia.com>> wrote:
Hi ,
        Please find setup and testing procedure below.

[cid:image001.jpg at 01D0C572.52474350]

1.       In the above setup, Client Program tries to send packet with src_mac: 3:3:3:3:3:3  and dst_mac: 1:1:1:1:1:1.
2.       Packet is flood to port tap2.
3.       Why does OVS flood packets when dst_mac received is its own port’s mac address.
4.       As it forwards to other ports, there is no one to reply for dst_mac other than OVS bridge itself.
5.       Where as in case of Linux bridge, packet is not flooded to other ports. Instead packet is dropped.

Could you please tell me how do switches in real work? As per my understanding there should be static entries in forwarding table of switch for its own mac addresses.
And default action should be present for it.


Regards,
Shyam


_______________________________________________
discuss mailing list
discuss at openvswitch.org<mailto:discuss at openvswitch.org>
http://openvswitch.org/mailman/listinfo/discuss


_______________________________________________
discuss mailing list
discuss at openvswitch.org<mailto:discuss at openvswitch.org>
http://openvswitch.org/mailman/listinfo/discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/c66a4c54/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 18205 bytes
Desc: image001.jpg
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/c66a4c54/attachment-0001.jpg>
-------------- next part --------------
An embedded message was scrubbed...
From: ext Gurucharan Shetty <shettyg at nicira.com>
Subject: Re: [ovs-discuss] Flooding of packets destined to OVS port's mac address
Date: Fri, 17 Jul 2015 14:56:09 +0000
Size: 45414
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/c66a4c54/attachment-0001.mht>

From amaldrygenia at gmail.com  Thu Jul 23 06:53:49 2015
From: amaldrygenia at gmail.com (Amal R Krishna)
Date: Thu, 23 Jul 2015 19:23:49 +0530
Subject: [ovs-discuss] to extract source/dest ip/mac - please help
Message-ID: <CADoe31c2fM183iCAf=nZxCLywn6j2TYWjjqW8xfjPQVhzo6GZQ@mail.gmail.com>

Hi,

I am working on an project which involves Openvswitch 2.3.1. In my case I
am working on an environment when the controller is down. So I need to get
the source/dest ip/mac in the switches itself (i.e as soon as a packet is
received and when no flow can be requested to the controller.). Will I have
to edit the source code of Openvswitch? I think datapath/flow.c or
lib/flow.c should provide the values, but I am still unable to figure out a
solution. Kindly let me know which function gets activated as soon as a
packet arrives in a network device and whether I can extract the required
info and write it to a file from there in the switch. Thanks in Advance.
Kindly Reply.

Thank you,
Amal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/92360861/attachment-0001.html>

From tabkaslim at gmail.com  Thu Jul 23 07:18:17 2015
From: tabkaslim at gmail.com (slim tabka)
Date: Thu, 23 Jul 2015 15:18:17 +0100
Subject: [ovs-discuss] Problem with mutiple vxlan tunnels only one works
Message-ID: <CADRPDnjoOkiR5OnPCxY7OTYNAggS6VPoMYUa=htZkYv7XB-eoQ@mail.gmail.com>

Hello everyone,

I recently started working on ovs and while implementing vxlan when I
create 2 vxlan tunnels between two Hosts (KVM, I'm using libvirt to manage
KVM) everything works fine and I had no problems.

Then I needed to connect multiple hosts between them and due to the fact
that ovs does'n't support multi-casting, the topology that I'm using ,where
I encountered some problems that I'll explain, is connecting multiple hosts
to a vrouter (ubuntu VM with ovs) so I can do a simple configuration on
each host and like that I have only to manage the vrouter to assure the
tunneling between the hosts (star topology).

 I created 2 vxlan in two hosts, the vms in the first vxlan can ping each
other  but those in the second one can't ping each other (I used flow
control in the vrouter to connect the two hosts), my problem is that I a
correct configuration for the two vxlan and can't seem to find the problem
even when I create more bridges with a vxlan interface they don't seem to
work only he first bridge that I created works.

To make some tests I captured udp packets with tcpdump in the first host
but I can see the encapsulated packets from the first vxlan and none from
the other vxlan.

These are the configuration of the two hosts and the vrouter:
_________                                                        ________
|                 |                 _______                       |
       |
|                 |                |              |                      |
               |
|  HOST1   |________| vrouter  |___________| HOST2   |
|                 |                |_______|                      |
       |
|________ |                                                      |________|



*********************HOST1(10.0.60.120)**********************
ovs-vsctl add-br br1
ovs-vsctl add-br br2
ovs-vsctl add-port br1 vx1 -- set interface vx1 type=vxlan
options:remote_ip=10.0.60.140 options:keys=10
ovs-vsctl add-port br2 vx2 -- set interface vx2 type=vxlan
options:remote_ip=10.0.60.140 options:keys=20

root at host1:/home/slim# ovs-vsctl show    (exactely the same on the second
host)
14afba6d-4075-47e0-85a4-355aae20b642
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
        Port "eth0"
            Interface "eth0"
    Bridge "br2"
        Port "vnet1"
            Interface "vnet1"
        Port "br2"
            Interface "br2"
                type: internal
        Port "vx2"
            Interface "vx2"
                type: vxlan
                options: {keys="20", remote_ip="10.0.60.140"}
    Bridge "br1"
        Port "vnet0"
            Interface "vnet0"
        Port "vx1"
            Interface "vx1"
                type: vxlan
                options: {keys="10", remote_ip="10.0.60.140"}
        Port "br1"
            Interface "br1"
                type: internal
    ovs_version: "2.3.2"
root at host1:/home/slim# ovs-dpctl show
system at ovs-system:
lookups: hit:481 missed:153 lost:0
flows: 0
masks: hit:881 total:0 hit/pkt:1.39
port 0: ovs-system (internal)
port 1: br1 (internal)
port 2: br2 (internal)
port 3: vxlan_sys_4789 (vxlan: df_default=false, ttl=0)
port 4: vnet0
port 5: vnet1



*********************HOST2(10.0.60.130)**********************
ovs-vsctl add-br br1
ovs-vsctl add-br br2
ovs-vsctl add-port br1 vx1 -- set interface vx1 type=vxlan
options:remote_ip=10.0.60.140 options:keys=10
ovs-vsctl add-port br2 vx2 -- set interface vx2 type=vxlan
options:remote_ip=10.0.60.140 options:keys=20



*********************vrouter(10.0.60.140)**********************
ovs-vsctl add-br br1
ovs-vsctl add-br br2
ovs-vsctl add-port br1 vx1.1 -- set interface vx1.1 type=vxlan
options:remote_ip=10.0.60.120 options:keys=10
ovs-vsctl add-port br1 vx1.2 -- set interface vx1.2 type=vxlan
options:remote_ip=10.0.60.130 options:keys=10
ovs-vsctl add-port br2 vx2.1 -- set interface vx2.1 type=vxlan
options:remote_ip=10.0.60.120 options:keys=20
ovs-vsctl add-port br2 vx2.2 -- set interface vx2.2 type=vxlan
options:remote_ip=10.0.60.130 options:keys=20
ovs-ofctl show br1
ovs-ofctl add-flow br1 in_port=1,actions=output:2
ovs-ofctl add-flow br1 in_port=2,actions=output:1
ovs-ofctl add-flow br2 in_port=1,actions=output:2
ovs-ofctl add-flow br2 in_port=2,actions=output:1

root at vrouter:/home/slim# ovs-ofctl dump-flows br1
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=12808.910s, table=0, n_packets=0, n_bytes=0,
idle_age=12808, priority=0 actions=NORMAL
 cookie=0x0, duration=12614.007s, table=0, n_packets=247, n_bytes=23667,
idle_age=2695, in_port=1 actions=output:2
 cookie=0x0, duration=12607.024s, table=0, n_packets=263, n_bytes=23947,
idle_age=2695, in_port=2 actions=output:1
root at vrouter:/home/slim# ovs-ofctl dump-flows br1 && ovs-ofctl dump-flows
br2
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=12821.126s, table=0, n_packets=0, n_bytes=0,
idle_age=12821, priority=0 actions=NORMAL
 cookie=0x0, duration=12626.223s, table=0, n_packets=247, n_bytes=23667,
idle_age=2707, in_port=1 actions=output:2
 cookie=0x0, duration=12619.240s, table=0, n_packets=263, n_bytes=23947,
idle_age=2707, in_port=2 actions=output:1
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=12814.208s, table=0, n_packets=0, n_bytes=0,
idle_age=12814, priority=0 actions=NORMAL
 cookie=0x0, duration=12610.048s, table=0, n_packets=0, n_bytes=0,
idle_age=12610, in_port=1 actions=output:2
 cookie=0x0, duration=12597.760s, table=0, n_packets=0, n_bytes=0,
idle_age=12597, in_port=2 actions=output:1


root at vrouter:/home/slim# ovs-vsctl show && ovs-dpctl show
1de210f0-26cd-4e1e-8386-d724095f166b
    Bridge "br0"
        Port "br0"
            Interface "br0"
                type: internal
        Port "eth0"
            Interface "eth0"
    Bridge "br1"
        Port "vx1.2"
            Interface "vx1.2"
                type: vxlan
                options: {keys="10", remote_ip="10.0.60.130"}
        Port "vx1.1"
            Interface "vx1.1"
                type: vxlan
                options: {keys="10", remote_ip="10.0.60.120"}
        Port "br1"
            Interface "br1"
                type: internal
    Bridge "br2"
        Port "vx2.1"
            Interface "vx2.1"
                type: vxlan
                options: {keys="20", remote_ip="10.0.60.120"}
        Port "br2"
            Interface "br2"
                type: internal
        Port "vx2.2"
            Interface "vx2.2"
                type: vxlan
                options: {keys="20", remote_ip="10.0.60.130"}
    ovs_version: "2.3.2"
system at ovs-system:
lookups: hit:43402 missed:59874 lost:0
flows: 26
masks: hit:222548 total:3 hit/pkt:2.15
port 0: ovs-system (internal)
port 1: br0 (internal)
port 2: eth0
port 3: br1 (internal)
port 4: br2 (internal)
port 5: vxlan_sys_4789 (vxlan: df_default=false, ttl=0)

I chose this way because multicasting is not supported in ovs so if any one
know about a better solution for connecting multiple hosts between them let
me know.
Can anyone help me understand why the first vxlan tunnel works and the
other don't? I'm quite sure that my configuration is correct and don't
think that this behavior is logical, and Id'ont know if it's a bug in ovs
or if it's not even related to ovs.
Thank you for your time and patience .

Best regards,
Slim TABKA
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/abbf94de/attachment-0001.html>

From blp at nicira.com  Thu Jul 23 12:36:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 23 Jul 2015 12:36:06 -0700
Subject: [ovs-discuss] to extract source/dest ip/mac - please help
In-Reply-To: <CADoe31c2fM183iCAf=nZxCLywn6j2TYWjjqW8xfjPQVhzo6GZQ@mail.gmail.com>
References: <CADoe31c2fM183iCAf=nZxCLywn6j2TYWjjqW8xfjPQVhzo6GZQ@mail.gmail.com>
Message-ID: <20150723193606.GB2405@nicira.com>

On Thu, Jul 23, 2015 at 07:23:49PM +0530, Amal R Krishna wrote:
> I am working on an project which involves Openvswitch 2.3.1. In my case I
> am working on an environment when the controller is down. So I need to get
> the source/dest ip/mac in the switches itself (i.e as soon as a packet is
> received and when no flow can be requested to the controller.). Will I have
> to edit the source code of Openvswitch? I think datapath/flow.c or
> lib/flow.c should provide the values, but I am still unable to figure out a
> solution. Kindly let me know which function gets activated as soon as a
> packet arrives in a network device and whether I can extract the required
> info and write it to a file from there in the switch. Thanks in Advance.

It seems like a better approach would be to implement a fallback
OpenFlow controller, running on the same machine as OVS.  Then you
wouldn't need to modify OVS at all.

From blp at nicira.com  Thu Jul 23 12:37:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 23 Jul 2015 12:37:04 -0700
Subject: [ovs-discuss] Problem with mutiple vxlan tunnels only one works
In-Reply-To: <CADRPDnjoOkiR5OnPCxY7OTYNAggS6VPoMYUa=htZkYv7XB-eoQ@mail.gmail.com>
References: <CADRPDnjoOkiR5OnPCxY7OTYNAggS6VPoMYUa=htZkYv7XB-eoQ@mail.gmail.com>
Message-ID: <20150723193704.GC2405@nicira.com>

The option name is "key", not "keys".

From blp at nicira.com  Thu Jul 23 12:40:49 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 23 Jul 2015 12:40:49 -0700
Subject: [ovs-discuss] Questions about the implementation of the ofp-util
In-Reply-To: <55B07089.7070902@gmail.com>
References: <55B07089.7070902@gmail.com>
Message-ID: <20150723194049.GD2405@nicira.com>

On Thu, Jul 23, 2015 at 01:41:45PM +0900, Minoru TAKAHASHI wrote:
> I plan to implement encoding function of ofp-util that unsupported now (ex. QueueDescRequest, GroupDescStatsReply,,,).
> So, there are a few things that I would like to know.
> 
>  * When I post, are there any implementation to be posted at the same time?
>     (testcase? decoding fuction? ...)
> 
>  * If there is an implementation should be posted at the same time, 
>     is it possible to post the only encoding function as a first step?
>     (In other words, Is it possible to add encoding function only to ovs repository?)

I don't see much value in implementing only part.  These are usually
quite simple pieces of code, and so usually I'd expect to see the
encoder, the decoder, a testcase for decoding in tests/ofp-print.at, an
implementation in ofproto/ofproto.c, code to use it in
utilities/ovs-ofctl.c, and a testcase that uses the new ovs-ofctl
functionality somewhere in tests/, all in one patch.  Commit
03c72922c2c7 (Implement OpenFlow 1.4+ OFPMP_TABLE_DESC message.) is a
recent example.

Sometimes there can be exceptions, of course.

From lxuemei3000 at gmail.com  Thu Jul 23 16:10:14 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Thu, 23 Jul 2015 16:10:14 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
 <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
Message-ID: <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>

Hi, Ben,

I tried your method, but the switch seems to drop some packets, as it does
not output the expected packets that I forward to send to it. Any advice?

Thanks,
Xuemei

On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:

> Hi, Ben,
>
> Thanks for your response.
> "You realize that this will be terrible for performance, right?"
> In fact, I have not got all packets sent to user space. That is the
> problem I am facing now. I think performance might be another problem after
> I can receive all packet in user space.
>
> Thanks,
> Xuemei
>
> On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com> wrote:
>
>> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
>> > I am new to ovs, and I am trying to send all packets from kernel space
>> to
>> > user space. I comment the "unlikely(!flow)" in datapath/datapath.c.
>> > However, it seems I just receive the first packet of each flow (the
>> first
>> > packet that match one forwarding rule in the bridge) in user space.
>> Could
>> > anyone tell me why? and is there other way to achieve my goal?
>>
>> You realize that this will be terrible for performance, right?
>>
>> It's kind of a waste to modify the kernel module for this.  I'd just
>> modify userspace to send all packets to userspace, something like this:
>>
>> diff --git a/ofproto/ofproto-dpif-xlate.c b/ofproto/ofproto-dpif-xlate.c
>> index 52395a7..a98406a 100644
>> --- a/ofproto/ofproto-dpif-xlate.c
>> +++ b/ofproto/ofproto-dpif-xlate.c
>> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin, struct
>> xlate_out *xout)
>>
>>      ctx.xin = xin;
>>      ctx.xout = xout;
>> -    ctx.xout->slow = 0;
>> +    ctx.xout->slow = SLOW_ACTION;
>>      ctx.xout->has_learn = false;
>>      ctx.xout->has_normal = false;
>>      ctx.xout->has_fin_timeout = false;
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/3c447e74/attachment.html>

From blp at nicira.com  Thu Jul 23 16:18:35 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 23 Jul 2015 16:18:35 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
 <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
 <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
Message-ID: <20150723231835.GB10520@nicira.com>

That's too vague for me to guess.  What packets are getting lost?

On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> Hi, Ben,
> 
> I tried your method, but the switch seems to drop some packets, as it does
> not output the expected packets that I forward to send to it. Any advice?
> 
> Thanks,
> Xuemei
> 
> On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:
> 
> > Hi, Ben,
> >
> > Thanks for your response.
> > "You realize that this will be terrible for performance, right?"
> > In fact, I have not got all packets sent to user space. That is the
> > problem I am facing now. I think performance might be another problem after
> > I can receive all packet in user space.
> >
> > Thanks,
> > Xuemei
> >
> > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
> >> > I am new to ovs, and I am trying to send all packets from kernel space
> >> to
> >> > user space. I comment the "unlikely(!flow)" in datapath/datapath.c.
> >> > However, it seems I just receive the first packet of each flow (the
> >> first
> >> > packet that match one forwarding rule in the bridge) in user space.
> >> Could
> >> > anyone tell me why? and is there other way to achieve my goal?
> >>
> >> You realize that this will be terrible for performance, right?
> >>
> >> It's kind of a waste to modify the kernel module for this.  I'd just
> >> modify userspace to send all packets to userspace, something like this:
> >>
> >> diff --git a/ofproto/ofproto-dpif-xlate.c b/ofproto/ofproto-dpif-xlate.c
> >> index 52395a7..a98406a 100644
> >> --- a/ofproto/ofproto-dpif-xlate.c
> >> +++ b/ofproto/ofproto-dpif-xlate.c
> >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin, struct
> >> xlate_out *xout)
> >>
> >>      ctx.xin = xin;
> >>      ctx.xout = xout;
> >> -    ctx.xout->slow = 0;
> >> +    ctx.xout->slow = SLOW_ACTION;
> >>      ctx.xout->has_learn = false;
> >>      ctx.xout->has_normal = false;
> >>      ctx.xout->has_fin_timeout = false;
> >>
> >
> >

From lxuemei3000 at gmail.com  Thu Jul 23 16:42:17 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Thu, 23 Jul 2015 16:42:17 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <20150723231835.GB10520@nicira.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
 <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
 <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
 <20150723231835.GB10520@nicira.com>
Message-ID: <CA+oJsLOhR6QxcCAb0jcyNjH3cP9b4fR7MREinR8jO-x8mF=Mbg@mail.gmail.com>

Let me try to describe it. Suppose the topology is h1-s1-h2, where h1, h2
are hosts, and s1 is the ovs switch. I add policy in s1 to forward packets
with dstip of h2 to h2. Then I test in two scenarios.
1. h1 sends 9 packets (3 packet for each of 3 different flows) to h2. With
your methods, userspace in s1 can accept all the packets, and h2 can
receive all the 9 packets. Work perfect.
2. h1 sends 10000 packets to h2. In this case, h2 receives the same packets
as userspace in s1 does. However, the number of packets received is much
less than 10000. Which means many packets are lost in s1.
Is this clear now?

Thanks,
Xuemei

On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com> wrote:

> That's too vague for me to guess.  What packets are getting lost?
>
> On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> > Hi, Ben,
> >
> > I tried your method, but the switch seems to drop some packets, as it
> does
> > not output the expected packets that I forward to send to it. Any advice?
> >
> > Thanks,
> > Xuemei
> >
> > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <lxuemei3000 at gmail.com>
> wrote:
> >
> > > Hi, Ben,
> > >
> > > Thanks for your response.
> > > "You realize that this will be terrible for performance, right?"
> > > In fact, I have not got all packets sent to user space. That is the
> > > problem I am facing now. I think performance might be another problem
> after
> > > I can receive all packet in user space.
> > >
> > > Thanks,
> > > Xuemei
> > >
> > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
> > >> > I am new to ovs, and I am trying to send all packets from kernel
> space
> > >> to
> > >> > user space. I comment the "unlikely(!flow)" in datapath/datapath.c.
> > >> > However, it seems I just receive the first packet of each flow (the
> > >> first
> > >> > packet that match one forwarding rule in the bridge) in user space.
> > >> Could
> > >> > anyone tell me why? and is there other way to achieve my goal?
> > >>
> > >> You realize that this will be terrible for performance, right?
> > >>
> > >> It's kind of a waste to modify the kernel module for this.  I'd just
> > >> modify userspace to send all packets to userspace, something like
> this:
> > >>
> > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> b/ofproto/ofproto-dpif-xlate.c
> > >> index 52395a7..a98406a 100644
> > >> --- a/ofproto/ofproto-dpif-xlate.c
> > >> +++ b/ofproto/ofproto-dpif-xlate.c
> > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin, struct
> > >> xlate_out *xout)
> > >>
> > >>      ctx.xin = xin;
> > >>      ctx.xout = xout;
> > >> -    ctx.xout->slow = 0;
> > >> +    ctx.xout->slow = SLOW_ACTION;
> > >>      ctx.xout->has_learn = false;
> > >>      ctx.xout->has_normal = false;
> > >>      ctx.xout->has_fin_timeout = false;
> > >>
> > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/6a21a9e3/attachment.html>

From blp at nicira.com  Thu Jul 23 16:46:57 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 23 Jul 2015 16:46:57 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <CA+oJsLOhR6QxcCAb0jcyNjH3cP9b4fR7MREinR8jO-x8mF=Mbg@mail.gmail.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
 <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
 <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
 <20150723231835.GB10520@nicira.com>
 <CA+oJsLOhR6QxcCAb0jcyNjH3cP9b4fR7MREinR8jO-x8mF=Mbg@mail.gmail.com>
Message-ID: <20150723234657.GD10520@nicira.com>

Well, yes, there are performance problems, as I predicted.

On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
> Let me try to describe it. Suppose the topology is h1-s1-h2, where h1, h2
> are hosts, and s1 is the ovs switch. I add policy in s1 to forward packets
> with dstip of h2 to h2. Then I test in two scenarios.
> 1. h1 sends 9 packets (3 packet for each of 3 different flows) to h2. With
> your methods, userspace in s1 can accept all the packets, and h2 can
> receive all the 9 packets. Work perfect.
> 2. h1 sends 10000 packets to h2. In this case, h2 receives the same packets
> as userspace in s1 does. However, the number of packets received is much
> less than 10000. Which means many packets are lost in s1.
> Is this clear now?
> 
> Thanks,
> Xuemei
> 
> On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > That's too vague for me to guess.  What packets are getting lost?
> >
> > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> > > Hi, Ben,
> > >
> > > I tried your method, but the switch seems to drop some packets, as it
> > does
> > > not output the expected packets that I forward to send to it. Any advice?
> > >
> > > Thanks,
> > > Xuemei
> > >
> > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <lxuemei3000 at gmail.com>
> > wrote:
> > >
> > > > Hi, Ben,
> > > >
> > > > Thanks for your response.
> > > > "You realize that this will be terrible for performance, right?"
> > > > In fact, I have not got all packets sent to user space. That is the
> > > > problem I am facing now. I think performance might be another problem
> > after
> > > > I can receive all packet in user space.
> > > >
> > > > Thanks,
> > > > Xuemei
> > > >
> > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
> > > >> > I am new to ovs, and I am trying to send all packets from kernel
> > space
> > > >> to
> > > >> > user space. I comment the "unlikely(!flow)" in datapath/datapath.c.
> > > >> > However, it seems I just receive the first packet of each flow (the
> > > >> first
> > > >> > packet that match one forwarding rule in the bridge) in user space.
> > > >> Could
> > > >> > anyone tell me why? and is there other way to achieve my goal?
> > > >>
> > > >> You realize that this will be terrible for performance, right?
> > > >>
> > > >> It's kind of a waste to modify the kernel module for this.  I'd just
> > > >> modify userspace to send all packets to userspace, something like
> > this:
> > > >>
> > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> > b/ofproto/ofproto-dpif-xlate.c
> > > >> index 52395a7..a98406a 100644
> > > >> --- a/ofproto/ofproto-dpif-xlate.c
> > > >> +++ b/ofproto/ofproto-dpif-xlate.c
> > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin, struct
> > > >> xlate_out *xout)
> > > >>
> > > >>      ctx.xin = xin;
> > > >>      ctx.xout = xout;
> > > >> -    ctx.xout->slow = 0;
> > > >> +    ctx.xout->slow = SLOW_ACTION;
> > > >>      ctx.xout->has_learn = false;
> > > >>      ctx.xout->has_normal = false;
> > > >>      ctx.xout->has_fin_timeout = false;
> > > >>
> > > >
> > > >
> >

From lxuemei3000 at gmail.com  Thu Jul 23 17:07:58 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Thu, 23 Jul 2015 17:07:58 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <20150723234657.GD10520@nicira.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
 <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
 <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
 <20150723231835.GB10520@nicira.com>
 <CA+oJsLOhR6QxcCAb0jcyNjH3cP9b4fR7MREinR8jO-x8mF=Mbg@mail.gmail.com>
 <20150723234657.GD10520@nicira.com>
Message-ID: <CA+oJsLMsn6qrA-7bHt6jGy7B6QLqCrMbduWiC-OKiWtNECFkWQ@mail.gmail.com>

Hi, Ben,

After I decreased the sending rate at h1, I find s1 userspace/h2 can
receive all packets. What does SLOW_ACTION mean? Why this will make the
packets forwarded from kernel space to user space?

Thanks,
Xuemei

On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com> wrote:

> Well, yes, there are performance problems, as I predicted.
>
> On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
> > Let me try to describe it. Suppose the topology is h1-s1-h2, where h1, h2
> > are hosts, and s1 is the ovs switch. I add policy in s1 to forward
> packets
> > with dstip of h2 to h2. Then I test in two scenarios.
> > 1. h1 sends 9 packets (3 packet for each of 3 different flows) to h2.
> With
> > your methods, userspace in s1 can accept all the packets, and h2 can
> > receive all the 9 packets. Work perfect.
> > 2. h1 sends 10000 packets to h2. In this case, h2 receives the same
> packets
> > as userspace in s1 does. However, the number of packets received is much
> > less than 10000. Which means many packets are lost in s1.
> > Is this clear now?
> >
> > Thanks,
> > Xuemei
> >
> > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > That's too vague for me to guess.  What packets are getting lost?
> > >
> > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> > > > Hi, Ben,
> > > >
> > > > I tried your method, but the switch seems to drop some packets, as it
> > > does
> > > > not output the expected packets that I forward to send to it. Any
> advice?
> > > >
> > > > Thanks,
> > > > Xuemei
> > > >
> > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <lxuemei3000 at gmail.com>
> > > wrote:
> > > >
> > > > > Hi, Ben,
> > > > >
> > > > > Thanks for your response.
> > > > > "You realize that this will be terrible for performance, right?"
> > > > > In fact, I have not got all packets sent to user space. That is the
> > > > > problem I am facing now. I think performance might be another
> problem
> > > after
> > > > > I can receive all packet in user space.
> > > > >
> > > > > Thanks,
> > > > > Xuemei
> > > > >
> > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com>
> wrote:
> > > > >
> > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
> > > > >> > I am new to ovs, and I am trying to send all packets from kernel
> > > space
> > > > >> to
> > > > >> > user space. I comment the "unlikely(!flow)" in
> datapath/datapath.c.
> > > > >> > However, it seems I just receive the first packet of each flow
> (the
> > > > >> first
> > > > >> > packet that match one forwarding rule in the bridge) in user
> space.
> > > > >> Could
> > > > >> > anyone tell me why? and is there other way to achieve my goal?
> > > > >>
> > > > >> You realize that this will be terrible for performance, right?
> > > > >>
> > > > >> It's kind of a waste to modify the kernel module for this.  I'd
> just
> > > > >> modify userspace to send all packets to userspace, something like
> > > this:
> > > > >>
> > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> > > b/ofproto/ofproto-dpif-xlate.c
> > > > >> index 52395a7..a98406a 100644
> > > > >> --- a/ofproto/ofproto-dpif-xlate.c
> > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
> > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin, struct
> > > > >> xlate_out *xout)
> > > > >>
> > > > >>      ctx.xin = xin;
> > > > >>      ctx.xout = xout;
> > > > >> -    ctx.xout->slow = 0;
> > > > >> +    ctx.xout->slow = SLOW_ACTION;
> > > > >>      ctx.xout->has_learn = false;
> > > > >>      ctx.xout->has_normal = false;
> > > > >>      ctx.xout->has_fin_timeout = false;
> > > > >>
> > > > >
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/cea82e7f/attachment-0001.html>

From songole at oneconvergence.com  Thu Jul 23 18:49:01 2015
From: songole at oneconvergence.com (Subrahmanyam Ongole)
Date: Thu, 23 Jul 2015 18:49:01 -0700
Subject: [ovs-discuss] Renaming ovs patch port inside namespace issues
Message-ID: <CAPKA9wMtMqYQEN8jLGi_eoALDp5S6iLy_QBOQD8HeJLo6-fofA@mail.gmail.com>

Hi

I am connecting two namespaces using OVS patch ports as described in
http://www.opencloudblog.com/?p=66. Reproduced the code below for quick
reference.

# add the namespaces
ip netns add ns1
ip netns add ns2
# create the switch
BRIDGE=ovs-test
ovs-vsctl add-br $BRIDGE
#
#### PORT 1
# create an internal ovs port
ovs-vsctl add-port $BRIDGE tap1 -- set Interface tap1 type=internal
# attach it to namespace
ip link set tap1 netns ns1
# set the ports to up
*# (1) *
ip netns exec ns1 ip link set dev tap1 up
#
#### PORT 2
# create an internal ovs port
ovs-vsctl add-port $BRIDGE tap2 -- set Interface tap2 type=internal
# attach it to namespace
ip link set tap2 netns ns2
# set the ports to up
ip netns exec ns2 ip link set dev tap2 up
*# (2)*

I am using ovs 2.3.2. The above code works. However, I like to rename the
ports to eth0 inside (both) the namespaces.

a) If I rename after both the ports are created and attached to respective
name spaces, there are no issues. This is after *# (2)* above.

b) If I rename tap1 (as eth0) before tap2 is created, at* # (1)* above,
eth0 (ie tap1) goes away from the namespace ns1, as soon as tap2 is
created. I see the following message

"device eth0 left promiscuous mode"
"device tap1 left promiscuous mode"
I am using the following command to rename

ip netns exec ns1 ip link set dev tap1 name eth0 up

I couldn't find any related posts. Appreciate your help
​. ​

​Thanks​

-- 

Thanks
OSM
(Subrahmanyam Ongole)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/87e518b6/attachment.html>

From blp at nicira.com  Fri Jul 24 08:34:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 24 Jul 2015 08:34:28 -0700
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <55B1D0FD.1020601@gmail.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
 <55A886CE.3040305@gmail.com> <20150717164204.GG10847@nicira.com>
 <55ADE240.8000309@gmail.com> <20150721151917.GC15450@nicira.com>
 <55AF537A.3060800@gmail.com> <55B1D0FD.1020601@gmail.com>
Message-ID: <20150724153428.GA20805@nicira.com>

On Fri, Jul 24, 2015 at 02:45:33PM +0900, Minoru TAKAHASHI wrote:
> Hi,
> 
> On 2015年07月22日 17:25, Minoru TAKAHASHI wrote:
> > Hi,
> > 
> > Thank you for reply.
> > 
> > On 2015年07月22日 00:19, Ben Pfaff wrote:
> >> On Tue, Jul 21, 2015 at 03:10:08PM +0900, Minoru TAKAHASHI wrote:
> >>>> they do not make the corresponding change to the decoder
> >>>
> >>> Should I fix this problem?
> >>> If so, please tell me that which source file should I fix.
> >>> (Sorry, I am new in implementation of OpenvSwitch.)
> >>
> >> I cannot apply anything to the repository that makes tests fail, so yes
> >> you should fix the decoder.
> >>
> >> The decode function is right next to the encode function.
> 
> > ## ------------------------------ ##
> > ## openvswitch 2.4.90 test suite. ##
> > ## ------------------------------ ##
> > 
> > 694: ofproto - del group (OpenFlow 1.5)              FAILED (ofproto.at:350)
> > 696: ofproto - insert buckets                        FAILED (ofproto.at:424)
> 
> I think that the following code is causing the above error.
> 
> [lib/ofp-msgs.h]
> https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L336
> 
> [tests/ofp-print.at]
> https://github.com/openvswitch/ovs/blob/master/tests/ofp-print.at#L2003
> 
> After I fix these, the above error does not occur.

Did you run all the tests?  I see three failures:

## ------------------------ ##
## Summary of the failures. ##
## ------------------------ ##
Failed tests:
openvswitch 2.4.90 test suite test groups:

 NUM: FILE-NAME:LINE     TEST-GROUP-NAME
      KEYWORDS

 695: ofproto.at:343     ofproto - del group (OpenFlow 1.5)
 697: ofproto.at:418     ofproto - insert buckets
 698: ofproto.at:476     ofproto - remove buckets

From davewaters1970 at gmail.com  Fri Jul 24 08:56:33 2015
From: davewaters1970 at gmail.com (Dave Waters)
Date: Fri, 24 Jul 2015 21:26:33 +0530
Subject: [ovs-discuss] packets getting dropped at egress
In-Reply-To: <55B0F7DA.7090401@linux.vnet.ibm.com>
References: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>
 <55B0F7DA.7090401@linux.vnet.ibm.com>
Message-ID: <CAARSoVwCfjdxCe+W2Qnb8GtC9_OhrJx71A9TE0WXC4owkqNtTA@mail.gmail.com>

Hi,

I am unable to increase the MTU of the bridge port (the internal port) to
be anything more than 1500. While i am able to reduce it, i am not able to
increase it.

The reason i want to increase the MTU of the internal port is because i am
encapsulating all packets that i recieve on eth1 inside VXLAN which
increase the packet size. If i recieve a 1500 byte packet on eth1, then i
am dropping the packets since the size goes beyond the MTU of the bridge
after i put in VXLAN encapsulation.

root at ubuntu:/home/dw# ovs-vsctl show
b69c9516-a7dd-445c-a82d-8fb704e587a3
    Bridge "br0"
        Port "gre0"
            Interface "vxlanIp"
                type: vxlan
                options: {key="500", remote_ip="192.168.0.1"}
        Port "eth1"
            Interface "eth1"
        Port "br0"
            Interface "br0"
                type: internal
        Port "eth0"
            Interface "eth0"
    ovs_version: "2.0.2"
root at ubuntu:/home/dw#

root at ubuntu:/home/dw# ifconfig br0 mtu 1600

root at ubuntu:/home/dw# ifconfig br0
br0     Link encap:Ethernet  HWaddr 00:90:0b:35:e4:36
          inet addr:192.16.10.147  Bcast:192.168.10.255  Mask:255.255.255.0
          inet6 addr: fe80::dc88:f5ff:feef:ef9b/64 Scope:Link
          UP BROADCAST RUNNING  MTU:1500  Metric:1
[clipped]

root at ubuntu:/home/dw#

Dave

On Thu, Jul 23, 2015 at 7:49 PM, gowrishankar <
gowrishankar.m at linux.vnet.ibm.com> wrote:

> On Thursday 23 July 2015 04:16 AM, Dave Waters wrote:
>
>> Hi,
>>
>> I have two ports in my OVS bridge. I receive packets from one port
>> (portA) and i send them out of the other (portB). When i send out the
>> packets, they are VXLAN tunneled to the other end.
>>
>> Now, the default MTU of all ports (including the bridge port) is 1500 in
>> my setup.
>>
>> The issue is that when i get a 1500 byte packet on portA, i try to push
>> it out on portB after slapping on the VXLAN headers. This results in a
>> packet size thats greater than what portB can handle, and hence the packets
>> are dropped.
>>
>>
> Is increasing MTU of portB to 1550 (to accommodate additional 50 bytes
> when no vlan taged) a constraint in your setup ?
>
>
>  I know that OVS does not handle IP fragmentation/reassembly, so how do we
>> deal with this situation? I dont think we can rely on path MTU discovery
>> since not all applications do PMTU before spewing out packets. Any ideas,
>> anybody?
>>
>> Warm regards,
>> Dave
>>
>>
> --
> Regards,
> Gowrishankar M
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150724/1eb57abb/attachment.html>

From blp at nicira.com  Fri Jul 24 09:25:46 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 24 Jul 2015 09:25:46 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <CA+oJsLMsn6qrA-7bHt6jGy7B6QLqCrMbduWiC-OKiWtNECFkWQ@mail.gmail.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
 <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
 <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
 <20150723231835.GB10520@nicira.com>
 <CA+oJsLOhR6QxcCAb0jcyNjH3cP9b4fR7MREinR8jO-x8mF=Mbg@mail.gmail.com>
 <20150723234657.GD10520@nicira.com>
 <CA+oJsLMsn6qrA-7bHt6jGy7B6QLqCrMbduWiC-OKiWtNECFkWQ@mail.gmail.com>
Message-ID: <20150724162546.GG20805@nicira.com>

Any SLOW_* constant indicates why a packet can't be processed in the
fast path (e.g. in the kernel).  Such packets always have to be handled
in userspace.  Thus, tagging all flow translations with any SLOW_*
constant causes them all to be sent to userspace.

On Thu, Jul 23, 2015 at 05:07:58PM -0700, Xuemei Liu wrote:
> Hi, Ben,
> 
> After I decreased the sending rate at h1, I find s1 userspace/h2 can
> receive all packets. What does SLOW_ACTION mean? Why this will make the
> packets forwarded from kernel space to user space?
> 
> Thanks,
> Xuemei
> 
> On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > Well, yes, there are performance problems, as I predicted.
> >
> > On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
> > > Let me try to describe it. Suppose the topology is h1-s1-h2, where h1, h2
> > > are hosts, and s1 is the ovs switch. I add policy in s1 to forward
> > packets
> > > with dstip of h2 to h2. Then I test in two scenarios.
> > > 1. h1 sends 9 packets (3 packet for each of 3 different flows) to h2.
> > With
> > > your methods, userspace in s1 can accept all the packets, and h2 can
> > > receive all the 9 packets. Work perfect.
> > > 2. h1 sends 10000 packets to h2. In this case, h2 receives the same
> > packets
> > > as userspace in s1 does. However, the number of packets received is much
> > > less than 10000. Which means many packets are lost in s1.
> > > Is this clear now?
> > >
> > > Thanks,
> > > Xuemei
> > >
> > > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > > > That's too vague for me to guess.  What packets are getting lost?
> > > >
> > > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> > > > > Hi, Ben,
> > > > >
> > > > > I tried your method, but the switch seems to drop some packets, as it
> > > > does
> > > > > not output the expected packets that I forward to send to it. Any
> > advice?
> > > > >
> > > > > Thanks,
> > > > > Xuemei
> > > > >
> > > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <lxuemei3000 at gmail.com>
> > > > wrote:
> > > > >
> > > > > > Hi, Ben,
> > > > > >
> > > > > > Thanks for your response.
> > > > > > "You realize that this will be terrible for performance, right?"
> > > > > > In fact, I have not got all packets sent to user space. That is the
> > > > > > problem I am facing now. I think performance might be another
> > problem
> > > > after
> > > > > > I can receive all packet in user space.
> > > > > >
> > > > > > Thanks,
> > > > > > Xuemei
> > > > > >
> > > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com>
> > wrote:
> > > > > >
> > > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
> > > > > >> > I am new to ovs, and I am trying to send all packets from kernel
> > > > space
> > > > > >> to
> > > > > >> > user space. I comment the "unlikely(!flow)" in
> > datapath/datapath.c.
> > > > > >> > However, it seems I just receive the first packet of each flow
> > (the
> > > > > >> first
> > > > > >> > packet that match one forwarding rule in the bridge) in user
> > space.
> > > > > >> Could
> > > > > >> > anyone tell me why? and is there other way to achieve my goal?
> > > > > >>
> > > > > >> You realize that this will be terrible for performance, right?
> > > > > >>
> > > > > >> It's kind of a waste to modify the kernel module for this.  I'd
> > just
> > > > > >> modify userspace to send all packets to userspace, something like
> > > > this:
> > > > > >>
> > > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> > > > b/ofproto/ofproto-dpif-xlate.c
> > > > > >> index 52395a7..a98406a 100644
> > > > > >> --- a/ofproto/ofproto-dpif-xlate.c
> > > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
> > > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin, struct
> > > > > >> xlate_out *xout)
> > > > > >>
> > > > > >>      ctx.xin = xin;
> > > > > >>      ctx.xout = xout;
> > > > > >> -    ctx.xout->slow = 0;
> > > > > >> +    ctx.xout->slow = SLOW_ACTION;
> > > > > >>      ctx.xout->has_learn = false;
> > > > > >>      ctx.xout->has_normal = false;
> > > > > >>      ctx.xout->has_fin_timeout = false;
> > > > > >>
> > > > > >
> > > > > >
> > > >
> >

From lxuemei3000 at gmail.com  Fri Jul 24 09:30:30 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Fri, 24 Jul 2015 09:30:30 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <20150724162546.GG20805@nicira.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
 <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
 <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
 <20150723231835.GB10520@nicira.com>
 <CA+oJsLOhR6QxcCAb0jcyNjH3cP9b4fR7MREinR8jO-x8mF=Mbg@mail.gmail.com>
 <20150723234657.GD10520@nicira.com>
 <CA+oJsLMsn6qrA-7bHt6jGy7B6QLqCrMbduWiC-OKiWtNECFkWQ@mail.gmail.com>
 <20150724162546.GG20805@nicira.com>
Message-ID: <CA+oJsLMPCy5Gdro8bsiFH6nufEo7pc2fUBm+RFP0MEpF6GqK3A@mail.gmail.com>

Thanks very much Ben.

On Fri, Jul 24, 2015 at 9:25 AM, Ben Pfaff <blp at nicira.com> wrote:

> Any SLOW_* constant indicates why a packet can't be processed in the
> fast path (e.g. in the kernel).  Such packets always have to be handled
> in userspace.  Thus, tagging all flow translations with any SLOW_*
> constant causes them all to be sent to userspace.
>
> On Thu, Jul 23, 2015 at 05:07:58PM -0700, Xuemei Liu wrote:
> > Hi, Ben,
> >
> > After I decreased the sending rate at h1, I find s1 userspace/h2 can
> > receive all packets. What does SLOW_ACTION mean? Why this will make the
> > packets forwarded from kernel space to user space?
> >
> > Thanks,
> > Xuemei
> >
> > On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > Well, yes, there are performance problems, as I predicted.
> > >
> > > On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
> > > > Let me try to describe it. Suppose the topology is h1-s1-h2, where
> h1, h2
> > > > are hosts, and s1 is the ovs switch. I add policy in s1 to forward
> > > packets
> > > > with dstip of h2 to h2. Then I test in two scenarios.
> > > > 1. h1 sends 9 packets (3 packet for each of 3 different flows) to h2.
> > > With
> > > > your methods, userspace in s1 can accept all the packets, and h2 can
> > > > receive all the 9 packets. Work perfect.
> > > > 2. h1 sends 10000 packets to h2. In this case, h2 receives the same
> > > packets
> > > > as userspace in s1 does. However, the number of packets received is
> much
> > > > less than 10000. Which means many packets are lost in s1.
> > > > Is this clear now?
> > > >
> > > > Thanks,
> > > > Xuemei
> > > >
> > > > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com> wrote:
> > > >
> > > > > That's too vague for me to guess.  What packets are getting lost?
> > > > >
> > > > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> > > > > > Hi, Ben,
> > > > > >
> > > > > > I tried your method, but the switch seems to drop some packets,
> as it
> > > > > does
> > > > > > not output the expected packets that I forward to send to it. Any
> > > advice?
> > > > > >
> > > > > > Thanks,
> > > > > > Xuemei
> > > > > >
> > > > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <
> lxuemei3000 at gmail.com>
> > > > > wrote:
> > > > > >
> > > > > > > Hi, Ben,
> > > > > > >
> > > > > > > Thanks for your response.
> > > > > > > "You realize that this will be terrible for performance,
> right?"
> > > > > > > In fact, I have not got all packets sent to user space. That
> is the
> > > > > > > problem I am facing now. I think performance might be another
> > > problem
> > > > > after
> > > > > > > I can receive all packet in user space.
> > > > > > >
> > > > > > > Thanks,
> > > > > > > Xuemei
> > > > > > >
> > > > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com>
> > > wrote:
> > > > > > >
> > > > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
> > > > > > >> > I am new to ovs, and I am trying to send all packets from
> kernel
> > > > > space
> > > > > > >> to
> > > > > > >> > user space. I comment the "unlikely(!flow)" in
> > > datapath/datapath.c.
> > > > > > >> > However, it seems I just receive the first packet of each
> flow
> > > (the
> > > > > > >> first
> > > > > > >> > packet that match one forwarding rule in the bridge) in user
> > > space.
> > > > > > >> Could
> > > > > > >> > anyone tell me why? and is there other way to achieve my
> goal?
> > > > > > >>
> > > > > > >> You realize that this will be terrible for performance, right?
> > > > > > >>
> > > > > > >> It's kind of a waste to modify the kernel module for this.
> I'd
> > > just
> > > > > > >> modify userspace to send all packets to userspace, something
> like
> > > > > this:
> > > > > > >>
> > > > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> > > > > b/ofproto/ofproto-dpif-xlate.c
> > > > > > >> index 52395a7..a98406a 100644
> > > > > > >> --- a/ofproto/ofproto-dpif-xlate.c
> > > > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
> > > > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin,
> struct
> > > > > > >> xlate_out *xout)
> > > > > > >>
> > > > > > >>      ctx.xin = xin;
> > > > > > >>      ctx.xout = xout;
> > > > > > >> -    ctx.xout->slow = 0;
> > > > > > >> +    ctx.xout->slow = SLOW_ACTION;
> > > > > > >>      ctx.xout->has_learn = false;
> > > > > > >>      ctx.xout->has_normal = false;
> > > > > > >>      ctx.xout->has_fin_timeout = false;
> > > > > > >>
> > > > > > >
> > > > > > >
> > > > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150724/2290c95c/attachment.html>

From lxuemei3000 at gmail.com  Fri Jul 24 09:42:05 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Fri, 24 Jul 2015 09:42:05 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <CA+oJsLMPCy5Gdro8bsiFH6nufEo7pc2fUBm+RFP0MEpF6GqK3A@mail.gmail.com>
References: <CA+oJsLP0htabzvzjRDAbE5YKf3LGHvOqTJsotYHjim8wPXTHEQ@mail.gmail.com>
 <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
 <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
 <20150723231835.GB10520@nicira.com>
 <CA+oJsLOhR6QxcCAb0jcyNjH3cP9b4fR7MREinR8jO-x8mF=Mbg@mail.gmail.com>
 <20150723234657.GD10520@nicira.com>
 <CA+oJsLMsn6qrA-7bHt6jGy7B6QLqCrMbduWiC-OKiWtNECFkWQ@mail.gmail.com>
 <20150724162546.GG20805@nicira.com>
 <CA+oJsLMPCy5Gdro8bsiFH6nufEo7pc2fUBm+RFP0MEpF6GqK3A@mail.gmail.com>
Message-ID: <CA+oJsLMsZh5mN8-unFGMnqX5uiRhje=H9h7jmV+_WyYZyE9LNA@mail.gmail.com>

Hi, Ben,

I have one follow-up question. I setup a topology with 12 hosts and 12
switches in Mininet. The hosts (acting as the packets generator to the
network) should send packets around 30 pps in order to make the switches
not drop packets. However, I find that the CPU/MEM usage of ovs-vswitchd is
not high (both < 10%). According to your experience, where do you think is
the bottleneck? How can I improve the performance of packet processing
speed in userspace in Mininet?

Thanks,
Xuemei

On Fri, Jul 24, 2015 at 9:30 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:

> Thanks very much Ben.
>
> On Fri, Jul 24, 2015 at 9:25 AM, Ben Pfaff <blp at nicira.com> wrote:
>
>> Any SLOW_* constant indicates why a packet can't be processed in the
>> fast path (e.g. in the kernel).  Such packets always have to be handled
>> in userspace.  Thus, tagging all flow translations with any SLOW_*
>> constant causes them all to be sent to userspace.
>>
>> On Thu, Jul 23, 2015 at 05:07:58PM -0700, Xuemei Liu wrote:
>> > Hi, Ben,
>> >
>> > After I decreased the sending rate at h1, I find s1 userspace/h2 can
>> > receive all packets. What does SLOW_ACTION mean? Why this will make the
>> > packets forwarded from kernel space to user space?
>> >
>> > Thanks,
>> > Xuemei
>> >
>> > On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com> wrote:
>> >
>> > > Well, yes, there are performance problems, as I predicted.
>> > >
>> > > On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
>> > > > Let me try to describe it. Suppose the topology is h1-s1-h2, where
>> h1, h2
>> > > > are hosts, and s1 is the ovs switch. I add policy in s1 to forward
>> > > packets
>> > > > with dstip of h2 to h2. Then I test in two scenarios.
>> > > > 1. h1 sends 9 packets (3 packet for each of 3 different flows) to
>> h2.
>> > > With
>> > > > your methods, userspace in s1 can accept all the packets, and h2 can
>> > > > receive all the 9 packets. Work perfect.
>> > > > 2. h1 sends 10000 packets to h2. In this case, h2 receives the same
>> > > packets
>> > > > as userspace in s1 does. However, the number of packets received is
>> much
>> > > > less than 10000. Which means many packets are lost in s1.
>> > > > Is this clear now?
>> > > >
>> > > > Thanks,
>> > > > Xuemei
>> > > >
>> > > > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com> wrote:
>> > > >
>> > > > > That's too vague for me to guess.  What packets are getting lost?
>> > > > >
>> > > > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
>> > > > > > Hi, Ben,
>> > > > > >
>> > > > > > I tried your method, but the switch seems to drop some packets,
>> as it
>> > > > > does
>> > > > > > not output the expected packets that I forward to send to it.
>> Any
>> > > advice?
>> > > > > >
>> > > > > > Thanks,
>> > > > > > Xuemei
>> > > > > >
>> > > > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <
>> lxuemei3000 at gmail.com>
>> > > > > wrote:
>> > > > > >
>> > > > > > > Hi, Ben,
>> > > > > > >
>> > > > > > > Thanks for your response.
>> > > > > > > "You realize that this will be terrible for performance,
>> right?"
>> > > > > > > In fact, I have not got all packets sent to user space. That
>> is the
>> > > > > > > problem I am facing now. I think performance might be another
>> > > problem
>> > > > > after
>> > > > > > > I can receive all packet in user space.
>> > > > > > >
>> > > > > > > Thanks,
>> > > > > > > Xuemei
>> > > > > > >
>> > > > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com>
>>
>> > > wrote:
>> > > > > > >
>> > > > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
>> > > > > > >> > I am new to ovs, and I am trying to send all packets from
>> kernel
>> > > > > space
>> > > > > > >> to
>> > > > > > >> > user space. I comment the "unlikely(!flow)" in
>> > > datapath/datapath.c.
>> > > > > > >> > However, it seems I just receive the first packet of each
>> flow
>> > > (the
>> > > > > > >> first
>> > > > > > >> > packet that match one forwarding rule in the bridge) in
>> user
>> > > space.
>> > > > > > >> Could
>> > > > > > >> > anyone tell me why? and is there other way to achieve my
>> goal?
>> > > > > > >>
>> > > > > > >> You realize that this will be terrible for performance,
>> right?
>> > > > > > >>
>> > > > > > >> It's kind of a waste to modify the kernel module for this.
>> I'd
>> > > just
>> > > > > > >> modify userspace to send all packets to userspace, something
>> like
>> > > > > this:
>> > > > > > >>
>> > > > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
>> > > > > b/ofproto/ofproto-dpif-xlate.c
>> > > > > > >> index 52395a7..a98406a 100644
>> > > > > > >> --- a/ofproto/ofproto-dpif-xlate.c
>> > > > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
>> > > > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin,
>> struct
>> > > > > > >> xlate_out *xout)
>> > > > > > >>
>> > > > > > >>      ctx.xin = xin;
>> > > > > > >>      ctx.xout = xout;
>> > > > > > >> -    ctx.xout->slow = 0;
>> > > > > > >> +    ctx.xout->slow = SLOW_ACTION;
>> > > > > > >>      ctx.xout->has_learn = false;
>> > > > > > >>      ctx.xout->has_normal = false;
>> > > > > > >>      ctx.xout->has_fin_timeout = false;
>> > > > > > >>
>> > > > > > >
>> > > > > > >
>> > > > >
>> > >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150724/a904df3c/attachment-0001.html>

From joestringer at nicira.com  Fri Jul 24 10:02:03 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Fri, 24 Jul 2015 10:02:03 -0700
Subject: [ovs-discuss] packets getting dropped at egress
In-Reply-To: <CAARSoVwfr6RhixEDWgGoa3zXRQC5B2QeR9EYVtDi5bfnnYYxTg@mail.gmail.com>
References: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>
 <55B0F7DA.7090401@linux.vnet.ibm.com>
 <CAARSoVwfr6RhixEDWgGoa3zXRQC5B2QeR9EYVtDi5bfnnYYxTg@mail.gmail.com>
Message-ID: <CANr6G5wq_Dv7jcCD341OSONe8Vqp0g4QMtvOnEyy+Bdd5eoqWA@mail.gmail.com>

Have you tried decreasing the MTU of portA such that packets are
encapsulated they're <=1500B?

On 23 July 2015 at 08:19, Dave Waters <davewaters1970 at gmail.com> wrote:
> Its not. But how do i ensure that my packet does not get dropped somewhere
> downstream, since i have now increased it beyond the original value?
>
> On Thu, Jul 23, 2015 at 7:49 PM, gowrishankar
> <gowrishankar.m at linux.vnet.ibm.com> wrote:
>>
>> On Thursday 23 July 2015 04:16 AM, Dave Waters wrote:
>>>
>>> Hi,
>>>
>>> I have two ports in my OVS bridge. I receive packets from one port
>>> (portA) and i send them out of the other (portB). When i send out the
>>> packets, they are VXLAN tunneled to the other end.
>>>
>>> Now, the default MTU of all ports (including the bridge port) is 1500 in
>>> my setup.
>>>
>>> The issue is that when i get a 1500 byte packet on portA, i try to push
>>> it out on portB after slapping on the VXLAN headers. This results in a
>>> packet size thats greater than what portB can handle, and hence the packets
>>> are dropped.
>>>
>>
>> Is increasing MTU of portB to 1550 (to accommodate additional 50 bytes
>> when no vlan taged) a constraint in your setup ?
>>
>>
>>> I know that OVS does not handle IP fragmentation/reassembly, so how do we
>>> deal with this situation? I dont think we can rely on path MTU discovery
>>> since not all applications do PMTU before spewing out packets. Any ideas,
>>> anybody?
>>>
>>> Warm regards,
>>> Dave
>>>
>>
>> --
>> Regards,
>> Gowrishankar M
>>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From davewaters1970 at gmail.com  Fri Jul 24 10:09:06 2015
From: davewaters1970 at gmail.com (Dave Waters)
Date: Fri, 24 Jul 2015 22:39:06 +0530
Subject: [ovs-discuss] packets getting dropped at egress
In-Reply-To: <CANr6G5wq_Dv7jcCD341OSONe8Vqp0g4QMtvOnEyy+Bdd5eoqWA@mail.gmail.com>
References: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>
 <55B0F7DA.7090401@linux.vnet.ibm.com>
 <CAARSoVwfr6RhixEDWgGoa3zXRQC5B2QeR9EYVtDi5bfnnYYxTg@mail.gmail.com>
 <CANr6G5wq_Dv7jcCD341OSONe8Vqp0g4QMtvOnEyy+Bdd5eoqWA@mail.gmail.com>
Message-ID: <CAARSoVy-DJd5mZjjwFU2AE2uu6T0cJKBTJRymSp2YJdw5yHJJA@mail.gmail.com>

That wouldnt work since anybody connected to portA and sending a 1500 byte
packet, would be unable to do so.

Is there a known limitation wherein i can increase the MTU of an internal
bridge port?

Dave

On Fri, Jul 24, 2015 at 10:32 PM, Joe Stringer <joestringer at nicira.com>
wrote:

> Have you tried decreasing the MTU of portA such that packets are
> encapsulated they're <=1500B?
>
> On 23 July 2015 at 08:19, Dave Waters <davewaters1970 at gmail.com> wrote:
> > Its not. But how do i ensure that my packet does not get dropped
> somewhere
> > downstream, since i have now increased it beyond the original value?
> >
> > On Thu, Jul 23, 2015 at 7:49 PM, gowrishankar
> > <gowrishankar.m at linux.vnet.ibm.com> wrote:
> >>
> >> On Thursday 23 July 2015 04:16 AM, Dave Waters wrote:
> >>>
> >>> Hi,
> >>>
> >>> I have two ports in my OVS bridge. I receive packets from one port
> >>> (portA) and i send them out of the other (portB). When i send out the
> >>> packets, they are VXLAN tunneled to the other end.
> >>>
> >>> Now, the default MTU of all ports (including the bridge port) is 1500
> in
> >>> my setup.
> >>>
> >>> The issue is that when i get a 1500 byte packet on portA, i try to push
> >>> it out on portB after slapping on the VXLAN headers. This results in a
> >>> packet size thats greater than what portB can handle, and hence the
> packets
> >>> are dropped.
> >>>
> >>
> >> Is increasing MTU of portB to 1550 (to accommodate additional 50 bytes
> >> when no vlan taged) a constraint in your setup ?
> >>
> >>
> >>> I know that OVS does not handle IP fragmentation/reassembly, so how do
> we
> >>> deal with this situation? I dont think we can rely on path MTU
> discovery
> >>> since not all applications do PMTU before spewing out packets. Any
> ideas,
> >>> anybody?
> >>>
> >>> Warm regards,
> >>> Dave
> >>>
> >>
> >> --
> >> Regards,
> >> Gowrishankar M
> >>
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150724/994ba944/attachment.html>

From blp at nicira.com  Fri Jul 24 13:24:09 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 24 Jul 2015 13:24:09 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <CA+oJsLMsZh5mN8-unFGMnqX5uiRhje=H9h7jmV+_WyYZyE9LNA@mail.gmail.com>
References: <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
 <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
 <20150723231835.GB10520@nicira.com>
 <CA+oJsLOhR6QxcCAb0jcyNjH3cP9b4fR7MREinR8jO-x8mF=Mbg@mail.gmail.com>
 <20150723234657.GD10520@nicira.com>
 <CA+oJsLMsn6qrA-7bHt6jGy7B6QLqCrMbduWiC-OKiWtNECFkWQ@mail.gmail.com>
 <20150724162546.GG20805@nicira.com>
 <CA+oJsLMPCy5Gdro8bsiFH6nufEo7pc2fUBm+RFP0MEpF6GqK3A@mail.gmail.com>
 <CA+oJsLMsZh5mN8-unFGMnqX5uiRhje=H9h7jmV+_WyYZyE9LNA@mail.gmail.com>
Message-ID: <20150724202409.GE14358@nicira.com>

It doesn't sound like you have a bottleneck, if CPU is less than 10%, so
I don't understand the question.

On Fri, Jul 24, 2015 at 09:42:05AM -0700, Xuemei Liu wrote:
> Hi, Ben,
> 
> I have one follow-up question. I setup a topology with 12 hosts and 12
> switches in Mininet. The hosts (acting as the packets generator to the
> network) should send packets around 30 pps in order to make the switches
> not drop packets. However, I find that the CPU/MEM usage of ovs-vswitchd is
> not high (both < 10%). According to your experience, where do you think is
> the bottleneck? How can I improve the performance of packet processing
> speed in userspace in Mininet?
> 
> Thanks,
> Xuemei
> 
> On Fri, Jul 24, 2015 at 9:30 AM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:
> 
> > Thanks very much Ben.
> >
> > On Fri, Jul 24, 2015 at 9:25 AM, Ben Pfaff <blp at nicira.com> wrote:
> >
> >> Any SLOW_* constant indicates why a packet can't be processed in the
> >> fast path (e.g. in the kernel).  Such packets always have to be handled
> >> in userspace.  Thus, tagging all flow translations with any SLOW_*
> >> constant causes them all to be sent to userspace.
> >>
> >> On Thu, Jul 23, 2015 at 05:07:58PM -0700, Xuemei Liu wrote:
> >> > Hi, Ben,
> >> >
> >> > After I decreased the sending rate at h1, I find s1 userspace/h2 can
> >> > receive all packets. What does SLOW_ACTION mean? Why this will make the
> >> > packets forwarded from kernel space to user space?
> >> >
> >> > Thanks,
> >> > Xuemei
> >> >
> >> > On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> >> >
> >> > > Well, yes, there are performance problems, as I predicted.
> >> > >
> >> > > On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
> >> > > > Let me try to describe it. Suppose the topology is h1-s1-h2, where
> >> h1, h2
> >> > > > are hosts, and s1 is the ovs switch. I add policy in s1 to forward
> >> > > packets
> >> > > > with dstip of h2 to h2. Then I test in two scenarios.
> >> > > > 1. h1 sends 9 packets (3 packet for each of 3 different flows) to
> >> h2.
> >> > > With
> >> > > > your methods, userspace in s1 can accept all the packets, and h2 can
> >> > > > receive all the 9 packets. Work perfect.
> >> > > > 2. h1 sends 10000 packets to h2. In this case, h2 receives the same
> >> > > packets
> >> > > > as userspace in s1 does. However, the number of packets received is
> >> much
> >> > > > less than 10000. Which means many packets are lost in s1.
> >> > > > Is this clear now?
> >> > > >
> >> > > > Thanks,
> >> > > > Xuemei
> >> > > >
> >> > > > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com> wrote:
> >> > > >
> >> > > > > That's too vague for me to guess.  What packets are getting lost?
> >> > > > >
> >> > > > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> >> > > > > > Hi, Ben,
> >> > > > > >
> >> > > > > > I tried your method, but the switch seems to drop some packets,
> >> as it
> >> > > > > does
> >> > > > > > not output the expected packets that I forward to send to it.
> >> Any
> >> > > advice?
> >> > > > > >
> >> > > > > > Thanks,
> >> > > > > > Xuemei
> >> > > > > >
> >> > > > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <
> >> lxuemei3000 at gmail.com>
> >> > > > > wrote:
> >> > > > > >
> >> > > > > > > Hi, Ben,
> >> > > > > > >
> >> > > > > > > Thanks for your response.
> >> > > > > > > "You realize that this will be terrible for performance,
> >> right?"
> >> > > > > > > In fact, I have not got all packets sent to user space. That
> >> is the
> >> > > > > > > problem I am facing now. I think performance might be another
> >> > > problem
> >> > > > > after
> >> > > > > > > I can receive all packet in user space.
> >> > > > > > >
> >> > > > > > > Thanks,
> >> > > > > > > Xuemei
> >> > > > > > >
> >> > > > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <blp at nicira.com>
> >>
> >> > > wrote:
> >> > > > > > >
> >> > > > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu wrote:
> >> > > > > > >> > I am new to ovs, and I am trying to send all packets from
> >> kernel
> >> > > > > space
> >> > > > > > >> to
> >> > > > > > >> > user space. I comment the "unlikely(!flow)" in
> >> > > datapath/datapath.c.
> >> > > > > > >> > However, it seems I just receive the first packet of each
> >> flow
> >> > > (the
> >> > > > > > >> first
> >> > > > > > >> > packet that match one forwarding rule in the bridge) in
> >> user
> >> > > space.
> >> > > > > > >> Could
> >> > > > > > >> > anyone tell me why? and is there other way to achieve my
> >> goal?
> >> > > > > > >>
> >> > > > > > >> You realize that this will be terrible for performance,
> >> right?
> >> > > > > > >>
> >> > > > > > >> It's kind of a waste to modify the kernel module for this.
> >> I'd
> >> > > just
> >> > > > > > >> modify userspace to send all packets to userspace, something
> >> like
> >> > > > > this:
> >> > > > > > >>
> >> > > > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> >> > > > > b/ofproto/ofproto-dpif-xlate.c
> >> > > > > > >> index 52395a7..a98406a 100644
> >> > > > > > >> --- a/ofproto/ofproto-dpif-xlate.c
> >> > > > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
> >> > > > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin,
> >> struct
> >> > > > > > >> xlate_out *xout)
> >> > > > > > >>
> >> > > > > > >>      ctx.xin = xin;
> >> > > > > > >>      ctx.xout = xout;
> >> > > > > > >> -    ctx.xout->slow = 0;
> >> > > > > > >> +    ctx.xout->slow = SLOW_ACTION;
> >> > > > > > >>      ctx.xout->has_learn = false;
> >> > > > > > >>      ctx.xout->has_normal = false;
> >> > > > > > >>      ctx.xout->has_fin_timeout = false;
> >> > > > > > >>
> >> > > > > > >
> >> > > > > > >
> >> > > > >
> >> > >
> >>
> >
> >

From davewaters1970 at gmail.com  Fri Jul 24 22:30:08 2015
From: davewaters1970 at gmail.com (Dave Waters)
Date: Sat, 25 Jul 2015 11:00:08 +0530
Subject: [ovs-discuss] packets getting dropped at egress
In-Reply-To: <CAARSoVy-DJd5mZjjwFU2AE2uu6T0cJKBTJRymSp2YJdw5yHJJA@mail.gmail.com>
References: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>
 <55B0F7DA.7090401@linux.vnet.ibm.com>
 <CAARSoVwfr6RhixEDWgGoa3zXRQC5B2QeR9EYVtDi5bfnnYYxTg@mail.gmail.com>
 <CANr6G5wq_Dv7jcCD341OSONe8Vqp0g4QMtvOnEyy+Bdd5eoqWA@mail.gmail.com>
 <CAARSoVy-DJd5mZjjwFU2AE2uu6T0cJKBTJRymSp2YJdw5yHJJA@mail.gmail.com>
Message-ID: <CAARSoVxJHfGc6fyvOxUV3jzg+GJ5Di6GaXnA=CKp28zaqj663g@mail.gmail.com>

In my case all my NIC cards can support jumbo frames. So i can really send
a 1600 byte packet. However, i am being restricted by the OVS's internal
port's MTU which is fixed to 1500. As a result i am unable to send out
larger packets (because of the VXLAN header addition). Can somebody please
help me here?

Dave

On Fri, Jul 24, 2015 at 10:39 PM, Dave Waters <davewaters1970 at gmail.com>
wrote:

> That wouldnt work since anybody connected to portA and sending a 1500 byte
> packet, would be unable to do so.
>
> Is there a known limitation wherein i can increase the MTU of an internal
> bridge port?
>
> Dave
>
> On Fri, Jul 24, 2015 at 10:32 PM, Joe Stringer <joestringer at nicira.com>
> wrote:
>
>> Have you tried decreasing the MTU of portA such that packets are
>> encapsulated they're <=1500B?
>>
>> On 23 July 2015 at 08:19, Dave Waters <davewaters1970 at gmail.com> wrote:
>> > Its not. But how do i ensure that my packet does not get dropped
>> somewhere
>> > downstream, since i have now increased it beyond the original value?
>> >
>> > On Thu, Jul 23, 2015 at 7:49 PM, gowrishankar
>> > <gowrishankar.m at linux.vnet.ibm.com> wrote:
>> >>
>> >> On Thursday 23 July 2015 04:16 AM, Dave Waters wrote:
>> >>>
>> >>> Hi,
>> >>>
>> >>> I have two ports in my OVS bridge. I receive packets from one port
>> >>> (portA) and i send them out of the other (portB). When i send out the
>> >>> packets, they are VXLAN tunneled to the other end.
>> >>>
>> >>> Now, the default MTU of all ports (including the bridge port) is 1500
>> in
>> >>> my setup.
>> >>>
>> >>> The issue is that when i get a 1500 byte packet on portA, i try to
>> push
>> >>> it out on portB after slapping on the VXLAN headers. This results in a
>> >>> packet size thats greater than what portB can handle, and hence the
>> packets
>> >>> are dropped.
>> >>>
>> >>
>> >> Is increasing MTU of portB to 1550 (to accommodate additional 50 bytes
>> >> when no vlan taged) a constraint in your setup ?
>> >>
>> >>
>> >>> I know that OVS does not handle IP fragmentation/reassembly, so how
>> do we
>> >>> deal with this situation? I dont think we can rely on path MTU
>> discovery
>> >>> since not all applications do PMTU before spewing out packets. Any
>> ideas,
>> >>> anybody?
>> >>>
>> >>> Warm regards,
>> >>> Dave
>> >>>
>> >>
>> >> --
>> >> Regards,
>> >> Gowrishankar M
>> >>
>> >
>> >
>> > _______________________________________________
>> > discuss mailing list
>> > discuss at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/discuss
>> >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150725/32306b11/attachment.html>

From takahashi.minoru7 at gmail.com  Thu Jul 23 22:45:33 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Fri, 24 Jul 2015 14:45:33 +0900
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <55AF537A.3060800@gmail.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
 <55A886CE.3040305@gmail.com> <20150717164204.GG10847@nicira.com>
 <55ADE240.8000309@gmail.com> <20150721151917.GC15450@nicira.com>
 <55AF537A.3060800@gmail.com>
Message-ID: <55B1D0FD.1020601@gmail.com>

Hi,

On 2015年07月22日 17:25, Minoru TAKAHASHI wrote:
> Hi,
> 
> Thank you for reply.
> 
> On 2015年07月22日 00:19, Ben Pfaff wrote:
>> On Tue, Jul 21, 2015 at 03:10:08PM +0900, Minoru TAKAHASHI wrote:
>>>> they do not make the corresponding change to the decoder
>>>
>>> Should I fix this problem?
>>> If so, please tell me that which source file should I fix.
>>> (Sorry, I am new in implementation of OpenvSwitch.)
>>
>> I cannot apply anything to the repository that makes tests fail, so yes
>> you should fix the decoder.
>>
>> The decode function is right next to the encode function.

> ## ------------------------------ ##
> ## openvswitch 2.4.90 test suite. ##
> ## ------------------------------ ##
> 
> 694: ofproto - del group (OpenFlow 1.5)              FAILED (ofproto.at:350)
> 696: ofproto - insert buckets                        FAILED (ofproto.at:424)

I think that the following code is causing the above error.

[lib/ofp-msgs.h]
https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L336

[tests/ofp-print.at]
https://github.com/openvswitch/ovs/blob/master/tests/ofp-print.at#L2003

After I fix these, the above error does not occur.

## ------------------------------ ##

## openvswitch 2.4.90 test suite. ##

## ------------------------------ ##


692: ofproto - no group support (OpenFlow 1.0)       ok

693: ofproto - del group (OpenFlow 1.1)              ok

694: ofproto - add indirect group                    ok

695: ofproto - del group (OpenFlow 1.5)              ok

696: ofproto - del group deletes flows               ok

Could you please take another look on the patches.

Thanks!

>>
> 
> OK, I will try to make a patch.
> Please, wait a while.
> 
> thanks,
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-openflow-Add-OpenFlow1.5-group-desc-request.patch
Type: text/x-patch
Size: 1105 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150724/b2b6bc4a/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-ofp-util-Fix-group-desc-request-encoding.patch
Type: text/x-patch
Size: 2375 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150724/b2b6bc4a/attachment-0003.bin>

From abhishekv.verma at gmail.com  Sat Jul 25 12:00:10 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Sun, 26 Jul 2015 00:30:10 +0530
Subject: [ovs-discuss] packets getting dropped at egress
In-Reply-To: <CAARSoVxJHfGc6fyvOxUV3jzg+GJ5Di6GaXnA=CKp28zaqj663g@mail.gmail.com>
References: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>
 <55B0F7DA.7090401@linux.vnet.ibm.com>
 <CAARSoVwfr6RhixEDWgGoa3zXRQC5B2QeR9EYVtDi5bfnnYYxTg@mail.gmail.com>
 <CANr6G5wq_Dv7jcCD341OSONe8Vqp0g4QMtvOnEyy+Bdd5eoqWA@mail.gmail.com>
 <CAARSoVy-DJd5mZjjwFU2AE2uu6T0cJKBTJRymSp2YJdw5yHJJA@mail.gmail.com>
 <CAARSoVxJHfGc6fyvOxUV3jzg+GJ5Di6GaXnA=CKp28zaqj663g@mail.gmail.com>
Message-ID: <CADDmorRWQ_LKGdu3uf6yw6nUjm0OXxc2Zbp-ejJpm8W1y_UuyQ@mail.gmail.com>

I think the only way to fix this issue is by configuring other devices in
your network with an MTU < 1500. This way, when your OVS gets the packet,
it can slap on additional headers and still get the packet across since the
overall length would be <= 1500.



On Sat, Jul 25, 2015 at 11:00 AM, Dave Waters <davewaters1970 at gmail.com>
wrote:

> In my case all my NIC cards can support jumbo frames. So i can really send
> a 1600 byte packet. However, i am being restricted by the OVS's internal
> port's MTU which is fixed to 1500. As a result i am unable to send out
> larger packets (because of the VXLAN header addition). Can somebody please
> help me here?
>
> Dave
>
> On Fri, Jul 24, 2015 at 10:39 PM, Dave Waters <davewaters1970 at gmail.com>
> wrote:
>
>> That wouldnt work since anybody connected to portA and sending a 1500
>> byte packet, would be unable to do so.
>>
>> Is there a known limitation wherein i can increase the MTU of an internal
>> bridge port?
>>
>> Dave
>>
>> On Fri, Jul 24, 2015 at 10:32 PM, Joe Stringer <joestringer at nicira.com>
>> wrote:
>>
>>> Have you tried decreasing the MTU of portA such that packets are
>>> encapsulated they're <=1500B?
>>>
>>> On 23 July 2015 at 08:19, Dave Waters <davewaters1970 at gmail.com> wrote:
>>> > Its not. But how do i ensure that my packet does not get dropped
>>> somewhere
>>> > downstream, since i have now increased it beyond the original value?
>>> >
>>> > On Thu, Jul 23, 2015 at 7:49 PM, gowrishankar
>>> > <gowrishankar.m at linux.vnet.ibm.com> wrote:
>>> >>
>>> >> On Thursday 23 July 2015 04:16 AM, Dave Waters wrote:
>>> >>>
>>> >>> Hi,
>>> >>>
>>> >>> I have two ports in my OVS bridge. I receive packets from one port
>>> >>> (portA) and i send them out of the other (portB). When i send out the
>>> >>> packets, they are VXLAN tunneled to the other end.
>>> >>>
>>> >>> Now, the default MTU of all ports (including the bridge port) is
>>> 1500 in
>>> >>> my setup.
>>> >>>
>>> >>> The issue is that when i get a 1500 byte packet on portA, i try to
>>> push
>>> >>> it out on portB after slapping on the VXLAN headers. This results in
>>> a
>>> >>> packet size thats greater than what portB can handle, and hence the
>>> packets
>>> >>> are dropped.
>>> >>>
>>> >>
>>> >> Is increasing MTU of portB to 1550 (to accommodate additional 50 bytes
>>> >> when no vlan taged) a constraint in your setup ?
>>> >>
>>> >>
>>> >>> I know that OVS does not handle IP fragmentation/reassembly, so how
>>> do we
>>> >>> deal with this situation? I dont think we can rely on path MTU
>>> discovery
>>> >>> since not all applications do PMTU before spewing out packets. Any
>>> ideas,
>>> >>> anybody?
>>> >>>
>>> >>> Warm regards,
>>> >>> Dave
>>> >>>
>>> >>
>>> >> --
>>> >> Regards,
>>> >> Gowrishankar M
>>> >>
>>> >
>>> >
>>> > _______________________________________________
>>> > discuss mailing list
>>> > discuss at openvswitch.org
>>> > http://openvswitch.org/mailman/listinfo/discuss
>>> >
>>>
>>
>>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150726/41e13ec7/attachment.html>

From lxuemei3000 at gmail.com  Sat Jul 25 18:15:18 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Sat, 25 Jul 2015 18:15:18 -0700
Subject: [ovs-discuss] How to set the number of threads in usespace to
	handle upcalls?
Message-ID: <CA+oJsLOBRfN9n323sB32V2JECD7wf0pr_aciFDhmWJS0xDNWOw@mail.gmail.com>

Hi, all,

Following Ben's advice, I can forward all packets from kernel space to
userspace. However, the performance of handling packets in userspace is not
good enough. I read the code and find threads are used to handle the
userspace upcalls (in ofproto/ofproto-dpif-upcall.c, function
udpif_set_thread() ). According to the code, the number of threads should
be adjustable. What I track from the code is shown below (in bridge.c), but
I don't know where to set the number of threads. Could you give me some
hint if possible?
[image: Inline image 1]

Thanks,
Xuemei

On Fri, Jul 24, 2015 at 1:24 PM, Ben Pfaff <blp at nicira.com> wrote:

> It doesn't sound like you have a bottleneck, if CPU is less than 10%, so
> I don't understand the question.
>
> On Fri, Jul 24, 2015 at 09:42:05AM -0700, Xuemei Liu wrote:
> > Hi, Ben,
> >
> > I have one follow-up question. I setup a topology with 12 hosts and 12
> > switches in Mininet. The hosts (acting as the packets generator to the
> > network) should send packets around 30 pps in order to make the switches
> > not drop packets. However, I find that the CPU/MEM usage of ovs-vswitchd
> is
> > not high (both < 10%). According to your experience, where do you think
> is
> > the bottleneck? How can I improve the performance of packet processing
> > speed in userspace in Mininet?
> >
> > Thanks,
> > Xuemei
> >
> > On Fri, Jul 24, 2015 at 9:30 AM, Xuemei Liu <lxuemei3000 at gmail.com>
> wrote:
> >
> > > Thanks very much Ben.
> > >
> > > On Fri, Jul 24, 2015 at 9:25 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > >> Any SLOW_* constant indicates why a packet can't be processed in the
> > >> fast path (e.g. in the kernel).  Such packets always have to be
> handled
> > >> in userspace.  Thus, tagging all flow translations with any SLOW_*
> > >> constant causes them all to be sent to userspace.
> > >>
> > >> On Thu, Jul 23, 2015 at 05:07:58PM -0700, Xuemei Liu wrote:
> > >> > Hi, Ben,
> > >> >
> > >> > After I decreased the sending rate at h1, I find s1 userspace/h2 can
> > >> > receive all packets. What does SLOW_ACTION mean? Why this will make
> the
> > >> > packets forwarded from kernel space to user space?
> > >> >
> > >> > Thanks,
> > >> > Xuemei
> > >> >
> > >> > On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >> >
> > >> > > Well, yes, there are performance problems, as I predicted.
> > >> > >
> > >> > > On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
> > >> > > > Let me try to describe it. Suppose the topology is h1-s1-h2,
> where
> > >> h1, h2
> > >> > > > are hosts, and s1 is the ovs switch. I add policy in s1 to
> forward
> > >> > > packets
> > >> > > > with dstip of h2 to h2. Then I test in two scenarios.
> > >> > > > 1. h1 sends 9 packets (3 packet for each of 3 different flows)
> to
> > >> h2.
> > >> > > With
> > >> > > > your methods, userspace in s1 can accept all the packets, and
> h2 can
> > >> > > > receive all the 9 packets. Work perfect.
> > >> > > > 2. h1 sends 10000 packets to h2. In this case, h2 receives the
> same
> > >> > > packets
> > >> > > > as userspace in s1 does. However, the number of packets
> received is
> > >> much
> > >> > > > less than 10000. Which means many packets are lost in s1.
> > >> > > > Is this clear now?
> > >> > > >
> > >> > > > Thanks,
> > >> > > > Xuemei
> > >> > > >
> > >> > > > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com>
> wrote:
> > >> > > >
> > >> > > > > That's too vague for me to guess.  What packets are getting
> lost?
> > >> > > > >
> > >> > > > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> > >> > > > > > Hi, Ben,
> > >> > > > > >
> > >> > > > > > I tried your method, but the switch seems to drop some
> packets,
> > >> as it
> > >> > > > > does
> > >> > > > > > not output the expected packets that I forward to send to
> it.
> > >> Any
> > >> > > advice?
> > >> > > > > >
> > >> > > > > > Thanks,
> > >> > > > > > Xuemei
> > >> > > > > >
> > >> > > > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <
> > >> lxuemei3000 at gmail.com>
> > >> > > > > wrote:
> > >> > > > > >
> > >> > > > > > > Hi, Ben,
> > >> > > > > > >
> > >> > > > > > > Thanks for your response.
> > >> > > > > > > "You realize that this will be terrible for performance,
> > >> right?"
> > >> > > > > > > In fact, I have not got all packets sent to user space.
> That
> > >> is the
> > >> > > > > > > problem I am facing now. I think performance might be
> another
> > >> > > problem
> > >> > > > > after
> > >> > > > > > > I can receive all packet in user space.
> > >> > > > > > >
> > >> > > > > > > Thanks,
> > >> > > > > > > Xuemei
> > >> > > > > > >
> > >> > > > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <
> blp at nicira.com>
> > >>
> > >> > > wrote:
> > >> > > > > > >
> > >> > > > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu
> wrote:
> > >> > > > > > >> > I am new to ovs, and I am trying to send all packets
> from
> > >> kernel
> > >> > > > > space
> > >> > > > > > >> to
> > >> > > > > > >> > user space. I comment the "unlikely(!flow)" in
> > >> > > datapath/datapath.c.
> > >> > > > > > >> > However, it seems I just receive the first packet of
> each
> > >> flow
> > >> > > (the
> > >> > > > > > >> first
> > >> > > > > > >> > packet that match one forwarding rule in the bridge) in
> > >> user
> > >> > > space.
> > >> > > > > > >> Could
> > >> > > > > > >> > anyone tell me why? and is there other way to achieve
> my
> > >> goal?
> > >> > > > > > >>
> > >> > > > > > >> You realize that this will be terrible for performance,
> > >> right?
> > >> > > > > > >>
> > >> > > > > > >> It's kind of a waste to modify the kernel module for
> this.
> > >> I'd
> > >> > > just
> > >> > > > > > >> modify userspace to send all packets to userspace,
> something
> > >> like
> > >> > > > > this:
> > >> > > > > > >>
> > >> > > > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> > >> > > > > b/ofproto/ofproto-dpif-xlate.c
> > >> > > > > > >> index 52395a7..a98406a 100644
> > >> > > > > > >> --- a/ofproto/ofproto-dpif-xlate.c
> > >> > > > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
> > >> > > > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin,
> > >> struct
> > >> > > > > > >> xlate_out *xout)
> > >> > > > > > >>
> > >> > > > > > >>      ctx.xin = xin;
> > >> > > > > > >>      ctx.xout = xout;
> > >> > > > > > >> -    ctx.xout->slow = 0;
> > >> > > > > > >> +    ctx.xout->slow = SLOW_ACTION;
> > >> > > > > > >>      ctx.xout->has_learn = false;
> > >> > > > > > >>      ctx.xout->has_normal = false;
> > >> > > > > > >>      ctx.xout->has_fin_timeout = false;
> > >> > > > > > >>
> > >> > > > > > >
> > >> > > > > > >
> > >> > > > >
> > >> > >
> > >>
> > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150725/7e440c4f/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 17952 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150725/7e440c4f/attachment-0001.png>

From lxuemei3000 at gmail.com  Sat Jul 25 18:15:54 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Sat, 25 Jul 2015 18:15:54 -0700
Subject: [ovs-discuss] How to send all packets to userspace?
In-Reply-To: <20150724202409.GE14358@nicira.com>
References: <20150723171359.GG3888@nicira.com>
 <CA+oJsLOh_3d2c60vhVuqq0ds99348D+G5dpOV_AjCvnG0_EhHA@mail.gmail.com>
 <CA+oJsLMw2S30bdvr0Od9fEG++DWBvk-02-RPoFux4XUc1SATWA@mail.gmail.com>
 <20150723231835.GB10520@nicira.com>
 <CA+oJsLOhR6QxcCAb0jcyNjH3cP9b4fR7MREinR8jO-x8mF=Mbg@mail.gmail.com>
 <20150723234657.GD10520@nicira.com>
 <CA+oJsLMsn6qrA-7bHt6jGy7B6QLqCrMbduWiC-OKiWtNECFkWQ@mail.gmail.com>
 <20150724162546.GG20805@nicira.com>
 <CA+oJsLMPCy5Gdro8bsiFH6nufEo7pc2fUBm+RFP0MEpF6GqK3A@mail.gmail.com>
 <CA+oJsLMsZh5mN8-unFGMnqX5uiRhje=H9h7jmV+_WyYZyE9LNA@mail.gmail.com>
 <20150724202409.GE14358@nicira.com>
Message-ID: <CA+oJsLMJD5xsZN=DzbVK-t-zUoG4ug3=fkqRnMvn7hc5d6i77Q@mail.gmail.com>

I found that problem in the VM of my pc. When I run the experiments on one
physical server, the CPU usage is not that low.

On Fri, Jul 24, 2015 at 1:24 PM, Ben Pfaff <blp at nicira.com> wrote:

> It doesn't sound like you have a bottleneck, if CPU is less than 10%, so
> I don't understand the question.
>
> On Fri, Jul 24, 2015 at 09:42:05AM -0700, Xuemei Liu wrote:
> > Hi, Ben,
> >
> > I have one follow-up question. I setup a topology with 12 hosts and 12
> > switches in Mininet. The hosts (acting as the packets generator to the
> > network) should send packets around 30 pps in order to make the switches
> > not drop packets. However, I find that the CPU/MEM usage of ovs-vswitchd
> is
> > not high (both < 10%). According to your experience, where do you think
> is
> > the bottleneck? How can I improve the performance of packet processing
> > speed in userspace in Mininet?
> >
> > Thanks,
> > Xuemei
> >
> > On Fri, Jul 24, 2015 at 9:30 AM, Xuemei Liu <lxuemei3000 at gmail.com>
> wrote:
> >
> > > Thanks very much Ben.
> > >
> > > On Fri, Jul 24, 2015 at 9:25 AM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > >> Any SLOW_* constant indicates why a packet can't be processed in the
> > >> fast path (e.g. in the kernel).  Such packets always have to be
> handled
> > >> in userspace.  Thus, tagging all flow translations with any SLOW_*
> > >> constant causes them all to be sent to userspace.
> > >>
> > >> On Thu, Jul 23, 2015 at 05:07:58PM -0700, Xuemei Liu wrote:
> > >> > Hi, Ben,
> > >> >
> > >> > After I decreased the sending rate at h1, I find s1 userspace/h2 can
> > >> > receive all packets. What does SLOW_ACTION mean? Why this will make
> the
> > >> > packets forwarded from kernel space to user space?
> > >> >
> > >> > Thanks,
> > >> > Xuemei
> > >> >
> > >> > On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >> >
> > >> > > Well, yes, there are performance problems, as I predicted.
> > >> > >
> > >> > > On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
> > >> > > > Let me try to describe it. Suppose the topology is h1-s1-h2,
> where
> > >> h1, h2
> > >> > > > are hosts, and s1 is the ovs switch. I add policy in s1 to
> forward
> > >> > > packets
> > >> > > > with dstip of h2 to h2. Then I test in two scenarios.
> > >> > > > 1. h1 sends 9 packets (3 packet for each of 3 different flows)
> to
> > >> h2.
> > >> > > With
> > >> > > > your methods, userspace in s1 can accept all the packets, and
> h2 can
> > >> > > > receive all the 9 packets. Work perfect.
> > >> > > > 2. h1 sends 10000 packets to h2. In this case, h2 receives the
> same
> > >> > > packets
> > >> > > > as userspace in s1 does. However, the number of packets
> received is
> > >> much
> > >> > > > less than 10000. Which means many packets are lost in s1.
> > >> > > > Is this clear now?
> > >> > > >
> > >> > > > Thanks,
> > >> > > > Xuemei
> > >> > > >
> > >> > > > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com>
> wrote:
> > >> > > >
> > >> > > > > That's too vague for me to guess.  What packets are getting
> lost?
> > >> > > > >
> > >> > > > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> > >> > > > > > Hi, Ben,
> > >> > > > > >
> > >> > > > > > I tried your method, but the switch seems to drop some
> packets,
> > >> as it
> > >> > > > > does
> > >> > > > > > not output the expected packets that I forward to send to
> it.
> > >> Any
> > >> > > advice?
> > >> > > > > >
> > >> > > > > > Thanks,
> > >> > > > > > Xuemei
> > >> > > > > >
> > >> > > > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <
> > >> lxuemei3000 at gmail.com>
> > >> > > > > wrote:
> > >> > > > > >
> > >> > > > > > > Hi, Ben,
> > >> > > > > > >
> > >> > > > > > > Thanks for your response.
> > >> > > > > > > "You realize that this will be terrible for performance,
> > >> right?"
> > >> > > > > > > In fact, I have not got all packets sent to user space.
> That
> > >> is the
> > >> > > > > > > problem I am facing now. I think performance might be
> another
> > >> > > problem
> > >> > > > > after
> > >> > > > > > > I can receive all packet in user space.
> > >> > > > > > >
> > >> > > > > > > Thanks,
> > >> > > > > > > Xuemei
> > >> > > > > > >
> > >> > > > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <
> blp at nicira.com>
> > >>
> > >> > > wrote:
> > >> > > > > > >
> > >> > > > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu
> wrote:
> > >> > > > > > >> > I am new to ovs, and I am trying to send all packets
> from
> > >> kernel
> > >> > > > > space
> > >> > > > > > >> to
> > >> > > > > > >> > user space. I comment the "unlikely(!flow)" in
> > >> > > datapath/datapath.c.
> > >> > > > > > >> > However, it seems I just receive the first packet of
> each
> > >> flow
> > >> > > (the
> > >> > > > > > >> first
> > >> > > > > > >> > packet that match one forwarding rule in the bridge) in
> > >> user
> > >> > > space.
> > >> > > > > > >> Could
> > >> > > > > > >> > anyone tell me why? and is there other way to achieve
> my
> > >> goal?
> > >> > > > > > >>
> > >> > > > > > >> You realize that this will be terrible for performance,
> > >> right?
> > >> > > > > > >>
> > >> > > > > > >> It's kind of a waste to modify the kernel module for
> this.
> > >> I'd
> > >> > > just
> > >> > > > > > >> modify userspace to send all packets to userspace,
> something
> > >> like
> > >> > > > > this:
> > >> > > > > > >>
> > >> > > > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> > >> > > > > b/ofproto/ofproto-dpif-xlate.c
> > >> > > > > > >> index 52395a7..a98406a 100644
> > >> > > > > > >> --- a/ofproto/ofproto-dpif-xlate.c
> > >> > > > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
> > >> > > > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in *xin,
> > >> struct
> > >> > > > > > >> xlate_out *xout)
> > >> > > > > > >>
> > >> > > > > > >>      ctx.xin = xin;
> > >> > > > > > >>      ctx.xout = xout;
> > >> > > > > > >> -    ctx.xout->slow = 0;
> > >> > > > > > >> +    ctx.xout->slow = SLOW_ACTION;
> > >> > > > > > >>      ctx.xout->has_learn = false;
> > >> > > > > > >>      ctx.xout->has_normal = false;
> > >> > > > > > >>      ctx.xout->has_fin_timeout = false;
> > >> > > > > > >>
> > >> > > > > > >
> > >> > > > > > >
> > >> > > > >
> > >> > >
> > >>
> > >
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150725/ff5d111a/attachment.html>

From lxuemei3000 at gmail.com  Sat Jul 25 18:58:09 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Sat, 25 Jul 2015 18:58:09 -0700
Subject: [ovs-discuss] How to set the number of threads in usespace to
 handle upcalls?
Message-ID: <CA+oJsLN-4ZGLpcjEBVKcn0rhzmLzBiMVo1Z=4TX98+fX4r8cqQ@mail.gmail.com>

This is the thread information for ovs-vswitchd, I test with different
traffic rate, the number of threads for ovs-vswitchd is already 11,
including 5 handler threads (should be the threads handling userspace
upcalls). How can I increase the number of handler threads?
[image: Inline image 1]

​Thanks,
Xuemei​


On Sat, Jul 25, 2015 at 6:15 PM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:

> Hi, all,
>
> Following Ben's advice, I can forward all packets from kernel space to
> userspace. However, the performance of handling packets in userspace is not
> good enough. I read the code and find threads are used to handle the
> userspace upcalls (in ofproto/ofproto-dpif-upcall.c, function
> udpif_set_thread() ). According to the code, the number of threads should
> be adjustable. What I track from the code is shown below (in bridge.c), but
> I don't know where to set the number of threads. Could you give me some
> hint if possible?
> [image: Inline image 1]
>
> Thanks,
> Xuemei
>
> On Fri, Jul 24, 2015 at 1:24 PM, Ben Pfaff <blp at nicira.com> wrote:
>
>> It doesn't sound like you have a bottleneck, if CPU is less than 10%, so
>> I don't understand the question.
>>
>> On Fri, Jul 24, 2015 at 09:42:05AM -0700, Xuemei Liu wrote:
>> > Hi, Ben,
>> >
>> > I have one follow-up question. I setup a topology with 12 hosts and 12
>> > switches in Mininet. The hosts (acting as the packets generator to the
>> > network) should send packets around 30 pps in order to make the switches
>> > not drop packets. However, I find that the CPU/MEM usage of
>> ovs-vswitchd is
>> > not high (both < 10%). According to your experience, where do you think
>> is
>> > the bottleneck? How can I improve the performance of packet processing
>> > speed in userspace in Mininet?
>> >
>> > Thanks,
>> > Xuemei
>> >
>> > On Fri, Jul 24, 2015 at 9:30 AM, Xuemei Liu <lxuemei3000 at gmail.com>
>> wrote:
>> >
>> > > Thanks very much Ben.
>> > >
>> > > On Fri, Jul 24, 2015 at 9:25 AM, Ben Pfaff <blp at nicira.com> wrote:
>> > >
>> > >> Any SLOW_* constant indicates why a packet can't be processed in the
>> > >> fast path (e.g. in the kernel).  Such packets always have to be
>> handled
>> > >> in userspace.  Thus, tagging all flow translations with any SLOW_*
>> > >> constant causes them all to be sent to userspace.
>> > >>
>> > >> On Thu, Jul 23, 2015 at 05:07:58PM -0700, Xuemei Liu wrote:
>> > >> > Hi, Ben,
>> > >> >
>> > >> > After I decreased the sending rate at h1, I find s1 userspace/h2
>> can
>> > >> > receive all packets. What does SLOW_ACTION mean? Why this will
>> make the
>> > >> > packets forwarded from kernel space to user space?
>> > >> >
>> > >> > Thanks,
>> > >> > Xuemei
>> > >> >
>> > >> > On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com> wrote:
>> > >> >
>> > >> > > Well, yes, there are performance problems, as I predicted.
>> > >> > >
>> > >> > > On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
>> > >> > > > Let me try to describe it. Suppose the topology is h1-s1-h2,
>> where
>> > >> h1, h2
>> > >> > > > are hosts, and s1 is the ovs switch. I add policy in s1 to
>> forward
>> > >> > > packets
>> > >> > > > with dstip of h2 to h2. Then I test in two scenarios.
>> > >> > > > 1. h1 sends 9 packets (3 packet for each of 3 different flows)
>> to
>> > >> h2.
>> > >> > > With
>> > >> > > > your methods, userspace in s1 can accept all the packets, and
>> h2 can
>> > >> > > > receive all the 9 packets. Work perfect.
>> > >> > > > 2. h1 sends 10000 packets to h2. In this case, h2 receives the
>> same
>> > >> > > packets
>> > >> > > > as userspace in s1 does. However, the number of packets
>> received is
>> > >> much
>> > >> > > > less than 10000. Which means many packets are lost in s1.
>> > >> > > > Is this clear now?
>> > >> > > >
>> > >> > > > Thanks,
>> > >> > > > Xuemei
>> > >> > > >
>> > >> > > > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com>
>> wrote:
>> > >> > > >
>> > >> > > > > That's too vague for me to guess.  What packets are getting
>> lost?
>> > >> > > > >
>> > >> > > > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
>> > >> > > > > > Hi, Ben,
>> > >> > > > > >
>> > >> > > > > > I tried your method, but the switch seems to drop some
>> packets,
>> > >> as it
>> > >> > > > > does
>> > >> > > > > > not output the expected packets that I forward to send to
>> it.
>> > >> Any
>> > >> > > advice?
>> > >> > > > > >
>> > >> > > > > > Thanks,
>> > >> > > > > > Xuemei
>> > >> > > > > >
>> > >> > > > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <
>> > >> lxuemei3000 at gmail.com>
>> > >> > > > > wrote:
>> > >> > > > > >
>> > >> > > > > > > Hi, Ben,
>> > >> > > > > > >
>> > >> > > > > > > Thanks for your response.
>> > >> > > > > > > "You realize that this will be terrible for performance,
>> > >> right?"
>> > >> > > > > > > In fact, I have not got all packets sent to user space.
>> That
>> > >> is the
>> > >> > > > > > > problem I am facing now. I think performance might be
>> another
>> > >> > > problem
>> > >> > > > > after
>> > >> > > > > > > I can receive all packet in user space.
>> > >> > > > > > >
>> > >> > > > > > > Thanks,
>> > >> > > > > > > Xuemei
>> > >> > > > > > >
>> > >> > > > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <
>> blp at nicira.com>
>> > >>
>> > >> > > wrote:
>> > >> > > > > > >
>> > >> > > > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu
>> wrote:
>> > >> > > > > > >> > I am new to ovs, and I am trying to send all packets
>> from
>> > >> kernel
>> > >> > > > > space
>> > >> > > > > > >> to
>> > >> > > > > > >> > user space. I comment the "unlikely(!flow)" in
>> > >> > > datapath/datapath.c.
>> > >> > > > > > >> > However, it seems I just receive the first packet of
>> each
>> > >> flow
>> > >> > > (the
>> > >> > > > > > >> first
>> > >> > > > > > >> > packet that match one forwarding rule in the bridge)
>> in
>> > >> user
>> > >> > > space.
>> > >> > > > > > >> Could
>> > >> > > > > > >> > anyone tell me why? and is there other way to achieve
>> my
>> > >> goal?
>> > >> > > > > > >>
>> > >> > > > > > >> You realize that this will be terrible for performance,
>> > >> right?
>> > >> > > > > > >>
>> > >> > > > > > >> It's kind of a waste to modify the kernel module for
>> this.
>> > >> I'd
>> > >> > > just
>> > >> > > > > > >> modify userspace to send all packets to userspace,
>> something
>> > >> like
>> > >> > > > > this:
>> > >> > > > > > >>
>> > >> > > > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
>> > >> > > > > b/ofproto/ofproto-dpif-xlate.c
>> > >> > > > > > >> index 52395a7..a98406a 100644
>> > >> > > > > > >> --- a/ofproto/ofproto-dpif-xlate.c
>> > >> > > > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
>> > >> > > > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in
>> *xin,
>> > >> struct
>> > >> > > > > > >> xlate_out *xout)
>> > >> > > > > > >>
>> > >> > > > > > >>      ctx.xin = xin;
>> > >> > > > > > >>      ctx.xout = xout;
>> > >> > > > > > >> -    ctx.xout->slow = 0;
>> > >> > > > > > >> +    ctx.xout->slow = SLOW_ACTION;
>> > >> > > > > > >>      ctx.xout->has_learn = false;
>> > >> > > > > > >>      ctx.xout->has_normal = false;
>> > >> > > > > > >>      ctx.xout->has_fin_timeout = false;
>> > >> > > > > > >>
>> > >> > > > > > >
>> > >> > > > > > >
>> > >> > > > >
>> > >> > >
>> > >>
>> > >
>> > >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150725/4673330e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 17952 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150725/4673330e/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 95869 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150725/4673330e/attachment-0003.png>

From blp at nicira.com  Sat Jul 25 20:16:15 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 25 Jul 2015 20:16:15 -0700
Subject: [ovs-discuss] How to set the number of threads in usespace to
 handle upcalls?
In-Reply-To: <CA+oJsLN-4ZGLpcjEBVKcn0rhzmLzBiMVo1Z=4TX98+fX4r8cqQ@mail.gmail.com>
References: <CA+oJsLN-4ZGLpcjEBVKcn0rhzmLzBiMVo1Z=4TX98+fX4r8cqQ@mail.gmail.com>
Message-ID: <20150726031615.GC12583@nicira.com>

It's documented, see ovs-vswitchd.conf.db(5).

On Sat, Jul 25, 2015 at 06:58:09PM -0700, Xuemei Liu wrote:
> This is the thread information for ovs-vswitchd, I test with different
> traffic rate, the number of threads for ovs-vswitchd is already 11,
> including 5 handler threads (should be the threads handling userspace
> upcalls). How can I increase the number of handler threads?
> [image: Inline image 1]
> 
> ​Thanks,
> Xuemei​
> 
> 
> On Sat, Jul 25, 2015 at 6:15 PM, Xuemei Liu <lxuemei3000 at gmail.com> wrote:
> 
> > Hi, all,
> >
> > Following Ben's advice, I can forward all packets from kernel space to
> > userspace. However, the performance of handling packets in userspace is not
> > good enough. I read the code and find threads are used to handle the
> > userspace upcalls (in ofproto/ofproto-dpif-upcall.c, function
> > udpif_set_thread() ). According to the code, the number of threads should
> > be adjustable. What I track from the code is shown below (in bridge.c), but
> > I don't know where to set the number of threads. Could you give me some
> > hint if possible?
> > [image: Inline image 1]
> >
> > Thanks,
> > Xuemei
> >
> > On Fri, Jul 24, 2015 at 1:24 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> >> It doesn't sound like you have a bottleneck, if CPU is less than 10%, so
> >> I don't understand the question.
> >>
> >> On Fri, Jul 24, 2015 at 09:42:05AM -0700, Xuemei Liu wrote:
> >> > Hi, Ben,
> >> >
> >> > I have one follow-up question. I setup a topology with 12 hosts and 12
> >> > switches in Mininet. The hosts (acting as the packets generator to the
> >> > network) should send packets around 30 pps in order to make the switches
> >> > not drop packets. However, I find that the CPU/MEM usage of
> >> ovs-vswitchd is
> >> > not high (both < 10%). According to your experience, where do you think
> >> is
> >> > the bottleneck? How can I improve the performance of packet processing
> >> > speed in userspace in Mininet?
> >> >
> >> > Thanks,
> >> > Xuemei
> >> >
> >> > On Fri, Jul 24, 2015 at 9:30 AM, Xuemei Liu <lxuemei3000 at gmail.com>
> >> wrote:
> >> >
> >> > > Thanks very much Ben.
> >> > >
> >> > > On Fri, Jul 24, 2015 at 9:25 AM, Ben Pfaff <blp at nicira.com> wrote:
> >> > >
> >> > >> Any SLOW_* constant indicates why a packet can't be processed in the
> >> > >> fast path (e.g. in the kernel).  Such packets always have to be
> >> handled
> >> > >> in userspace.  Thus, tagging all flow translations with any SLOW_*
> >> > >> constant causes them all to be sent to userspace.
> >> > >>
> >> > >> On Thu, Jul 23, 2015 at 05:07:58PM -0700, Xuemei Liu wrote:
> >> > >> > Hi, Ben,
> >> > >> >
> >> > >> > After I decreased the sending rate at h1, I find s1 userspace/h2
> >> can
> >> > >> > receive all packets. What does SLOW_ACTION mean? Why this will
> >> make the
> >> > >> > packets forwarded from kernel space to user space?
> >> > >> >
> >> > >> > Thanks,
> >> > >> > Xuemei
> >> > >> >
> >> > >> > On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com> wrote:
> >> > >> >
> >> > >> > > Well, yes, there are performance problems, as I predicted.
> >> > >> > >
> >> > >> > > On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
> >> > >> > > > Let me try to describe it. Suppose the topology is h1-s1-h2,
> >> where
> >> > >> h1, h2
> >> > >> > > > are hosts, and s1 is the ovs switch. I add policy in s1 to
> >> forward
> >> > >> > > packets
> >> > >> > > > with dstip of h2 to h2. Then I test in two scenarios.
> >> > >> > > > 1. h1 sends 9 packets (3 packet for each of 3 different flows)
> >> to
> >> > >> h2.
> >> > >> > > With
> >> > >> > > > your methods, userspace in s1 can accept all the packets, and
> >> h2 can
> >> > >> > > > receive all the 9 packets. Work perfect.
> >> > >> > > > 2. h1 sends 10000 packets to h2. In this case, h2 receives the
> >> same
> >> > >> > > packets
> >> > >> > > > as userspace in s1 does. However, the number of packets
> >> received is
> >> > >> much
> >> > >> > > > less than 10000. Which means many packets are lost in s1.
> >> > >> > > > Is this clear now?
> >> > >> > > >
> >> > >> > > > Thanks,
> >> > >> > > > Xuemei
> >> > >> > > >
> >> > >> > > > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com>
> >> wrote:
> >> > >> > > >
> >> > >> > > > > That's too vague for me to guess.  What packets are getting
> >> lost?
> >> > >> > > > >
> >> > >> > > > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu wrote:
> >> > >> > > > > > Hi, Ben,
> >> > >> > > > > >
> >> > >> > > > > > I tried your method, but the switch seems to drop some
> >> packets,
> >> > >> as it
> >> > >> > > > > does
> >> > >> > > > > > not output the expected packets that I forward to send to
> >> it.
> >> > >> Any
> >> > >> > > advice?
> >> > >> > > > > >
> >> > >> > > > > > Thanks,
> >> > >> > > > > > Xuemei
> >> > >> > > > > >
> >> > >> > > > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <
> >> > >> lxuemei3000 at gmail.com>
> >> > >> > > > > wrote:
> >> > >> > > > > >
> >> > >> > > > > > > Hi, Ben,
> >> > >> > > > > > >
> >> > >> > > > > > > Thanks for your response.
> >> > >> > > > > > > "You realize that this will be terrible for performance,
> >> > >> right?"
> >> > >> > > > > > > In fact, I have not got all packets sent to user space.
> >> That
> >> > >> is the
> >> > >> > > > > > > problem I am facing now. I think performance might be
> >> another
> >> > >> > > problem
> >> > >> > > > > after
> >> > >> > > > > > > I can receive all packet in user space.
> >> > >> > > > > > >
> >> > >> > > > > > > Thanks,
> >> > >> > > > > > > Xuemei
> >> > >> > > > > > >
> >> > >> > > > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <
> >> blp at nicira.com>
> >> > >>
> >> > >> > > wrote:
> >> > >> > > > > > >
> >> > >> > > > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu
> >> wrote:
> >> > >> > > > > > >> > I am new to ovs, and I am trying to send all packets
> >> from
> >> > >> kernel
> >> > >> > > > > space
> >> > >> > > > > > >> to
> >> > >> > > > > > >> > user space. I comment the "unlikely(!flow)" in
> >> > >> > > datapath/datapath.c.
> >> > >> > > > > > >> > However, it seems I just receive the first packet of
> >> each
> >> > >> flow
> >> > >> > > (the
> >> > >> > > > > > >> first
> >> > >> > > > > > >> > packet that match one forwarding rule in the bridge)
> >> in
> >> > >> user
> >> > >> > > space.
> >> > >> > > > > > >> Could
> >> > >> > > > > > >> > anyone tell me why? and is there other way to achieve
> >> my
> >> > >> goal?
> >> > >> > > > > > >>
> >> > >> > > > > > >> You realize that this will be terrible for performance,
> >> > >> right?
> >> > >> > > > > > >>
> >> > >> > > > > > >> It's kind of a waste to modify the kernel module for
> >> this.
> >> > >> I'd
> >> > >> > > just
> >> > >> > > > > > >> modify userspace to send all packets to userspace,
> >> something
> >> > >> like
> >> > >> > > > > this:
> >> > >> > > > > > >>
> >> > >> > > > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> >> > >> > > > > b/ofproto/ofproto-dpif-xlate.c
> >> > >> > > > > > >> index 52395a7..a98406a 100644
> >> > >> > > > > > >> --- a/ofproto/ofproto-dpif-xlate.c
> >> > >> > > > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
> >> > >> > > > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in
> >> *xin,
> >> > >> struct
> >> > >> > > > > > >> xlate_out *xout)
> >> > >> > > > > > >>
> >> > >> > > > > > >>      ctx.xin = xin;
> >> > >> > > > > > >>      ctx.xout = xout;
> >> > >> > > > > > >> -    ctx.xout->slow = 0;
> >> > >> > > > > > >> +    ctx.xout->slow = SLOW_ACTION;
> >> > >> > > > > > >>      ctx.xout->has_learn = false;
> >> > >> > > > > > >>      ctx.xout->has_normal = false;
> >> > >> > > > > > >>      ctx.xout->has_fin_timeout = false;
> >> > >> > > > > > >>
> >> > >> > > > > > >
> >> > >> > > > > > >
> >> > >> > > > >
> >> > >> > >
> >> > >>
> >> > >
> >> > >
> >>
> >
> >




From lxuemei3000 at gmail.com  Sun Jul 26 00:00:34 2015
From: lxuemei3000 at gmail.com (Xuemei Liu)
Date: Sun, 26 Jul 2015 00:00:34 -0700
Subject: [ovs-discuss] How to set the number of threads in usespace to
 handle upcalls?
In-Reply-To: <20150726031615.GC12583@nicira.com>
References: <CA+oJsLN-4ZGLpcjEBVKcn0rhzmLzBiMVo1Z=4TX98+fX4r8cqQ@mail.gmail.com>
 <20150726031615.GC12583@nicira.com>
Message-ID: <CA+oJsLNOXXh-OV_C5OHugyTrLSV3DwzOvhaDdpifyf8xhHufoA@mail.gmail.com>

Hi, Ben,

Thanks, I follow the command in
http://openvswitch.org/pipermail/discuss/2013-November/011994.html. It
works for me.
However, I find one problem. My machine has 8 cores, ovs-vswitchd works
fine if I set n-handler-threads=10, but exits if I increase the number to
20. I am guessing there is thread number upper limit proportional to the
number of cores?

Thanks,
Xuemei

On Sat, Jul 25, 2015 at 8:16 PM, Ben Pfaff <blp at nicira.com> wrote:

> It's documented, see ovs-vswitchd.conf.db(5).
>
> On Sat, Jul 25, 2015 at 06:58:09PM -0700, Xuemei Liu wrote:
> > This is the thread information for ovs-vswitchd, I test with different
> > traffic rate, the number of threads for ovs-vswitchd is already 11,
> > including 5 handler threads (should be the threads handling userspace
> > upcalls). How can I increase the number of handler threads?
> > [image: Inline image 1]
> >
> > ​Thanks,
> > Xuemei​
> >
> >
> > On Sat, Jul 25, 2015 at 6:15 PM, Xuemei Liu <lxuemei3000 at gmail.com>
> wrote:
> >
> > > Hi, all,
> > >
> > > Following Ben's advice, I can forward all packets from kernel space to
> > > userspace. However, the performance of handling packets in userspace
> is not
> > > good enough. I read the code and find threads are used to handle the
> > > userspace upcalls (in ofproto/ofproto-dpif-upcall.c, function
> > > udpif_set_thread() ). According to the code, the number of threads
> should
> > > be adjustable. What I track from the code is shown below (in
> bridge.c), but
> > > I don't know where to set the number of threads. Could you give me some
> > > hint if possible?
> > > [image: Inline image 1]
> > >
> > > Thanks,
> > > Xuemei
> > >
> > > On Fri, Jul 24, 2015 at 1:24 PM, Ben Pfaff <blp at nicira.com> wrote:
> > >
> > >> It doesn't sound like you have a bottleneck, if CPU is less than 10%,
> so
> > >> I don't understand the question.
> > >>
> > >> On Fri, Jul 24, 2015 at 09:42:05AM -0700, Xuemei Liu wrote:
> > >> > Hi, Ben,
> > >> >
> > >> > I have one follow-up question. I setup a topology with 12 hosts and
> 12
> > >> > switches in Mininet. The hosts (acting as the packets generator to
> the
> > >> > network) should send packets around 30 pps in order to make the
> switches
> > >> > not drop packets. However, I find that the CPU/MEM usage of
> > >> ovs-vswitchd is
> > >> > not high (both < 10%). According to your experience, where do you
> think
> > >> is
> > >> > the bottleneck? How can I improve the performance of packet
> processing
> > >> > speed in userspace in Mininet?
> > >> >
> > >> > Thanks,
> > >> > Xuemei
> > >> >
> > >> > On Fri, Jul 24, 2015 at 9:30 AM, Xuemei Liu <lxuemei3000 at gmail.com>
> > >> wrote:
> > >> >
> > >> > > Thanks very much Ben.
> > >> > >
> > >> > > On Fri, Jul 24, 2015 at 9:25 AM, Ben Pfaff <blp at nicira.com>
> wrote:
> > >> > >
> > >> > >> Any SLOW_* constant indicates why a packet can't be processed in
> the
> > >> > >> fast path (e.g. in the kernel).  Such packets always have to be
> > >> handled
> > >> > >> in userspace.  Thus, tagging all flow translations with any
> SLOW_*
> > >> > >> constant causes them all to be sent to userspace.
> > >> > >>
> > >> > >> On Thu, Jul 23, 2015 at 05:07:58PM -0700, Xuemei Liu wrote:
> > >> > >> > Hi, Ben,
> > >> > >> >
> > >> > >> > After I decreased the sending rate at h1, I find s1
> userspace/h2
> > >> can
> > >> > >> > receive all packets. What does SLOW_ACTION mean? Why this will
> > >> make the
> > >> > >> > packets forwarded from kernel space to user space?
> > >> > >> >
> > >> > >> > Thanks,
> > >> > >> > Xuemei
> > >> > >> >
> > >> > >> > On Thu, Jul 23, 2015 at 4:46 PM, Ben Pfaff <blp at nicira.com>
> wrote:
> > >> > >> >
> > >> > >> > > Well, yes, there are performance problems, as I predicted.
> > >> > >> > >
> > >> > >> > > On Thu, Jul 23, 2015 at 04:42:17PM -0700, Xuemei Liu wrote:
> > >> > >> > > > Let me try to describe it. Suppose the topology is
> h1-s1-h2,
> > >> where
> > >> > >> h1, h2
> > >> > >> > > > are hosts, and s1 is the ovs switch. I add policy in s1 to
> > >> forward
> > >> > >> > > packets
> > >> > >> > > > with dstip of h2 to h2. Then I test in two scenarios.
> > >> > >> > > > 1. h1 sends 9 packets (3 packet for each of 3 different
> flows)
> > >> to
> > >> > >> h2.
> > >> > >> > > With
> > >> > >> > > > your methods, userspace in s1 can accept all the packets,
> and
> > >> h2 can
> > >> > >> > > > receive all the 9 packets. Work perfect.
> > >> > >> > > > 2. h1 sends 10000 packets to h2. In this case, h2 receives
> the
> > >> same
> > >> > >> > > packets
> > >> > >> > > > as userspace in s1 does. However, the number of packets
> > >> received is
> > >> > >> much
> > >> > >> > > > less than 10000. Which means many packets are lost in s1.
> > >> > >> > > > Is this clear now?
> > >> > >> > > >
> > >> > >> > > > Thanks,
> > >> > >> > > > Xuemei
> > >> > >> > > >
> > >> > >> > > > On Thu, Jul 23, 2015 at 4:18 PM, Ben Pfaff <blp at nicira.com
> >
> > >> wrote:
> > >> > >> > > >
> > >> > >> > > > > That's too vague for me to guess.  What packets are
> getting
> > >> lost?
> > >> > >> > > > >
> > >> > >> > > > > On Thu, Jul 23, 2015 at 04:10:14PM -0700, Xuemei Liu
> wrote:
> > >> > >> > > > > > Hi, Ben,
> > >> > >> > > > > >
> > >> > >> > > > > > I tried your method, but the switch seems to drop some
> > >> packets,
> > >> > >> as it
> > >> > >> > > > > does
> > >> > >> > > > > > not output the expected packets that I forward to send
> to
> > >> it.
> > >> > >> Any
> > >> > >> > > advice?
> > >> > >> > > > > >
> > >> > >> > > > > > Thanks,
> > >> > >> > > > > > Xuemei
> > >> > >> > > > > >
> > >> > >> > > > > > On Thu, Jul 23, 2015 at 10:19 AM, Xuemei Liu <
> > >> > >> lxuemei3000 at gmail.com>
> > >> > >> > > > > wrote:
> > >> > >> > > > > >
> > >> > >> > > > > > > Hi, Ben,
> > >> > >> > > > > > >
> > >> > >> > > > > > > Thanks for your response.
> > >> > >> > > > > > > "You realize that this will be terrible for
> performance,
> > >> > >> right?"
> > >> > >> > > > > > > In fact, I have not got all packets sent to user
> space.
> > >> That
> > >> > >> is the
> > >> > >> > > > > > > problem I am facing now. I think performance might be
> > >> another
> > >> > >> > > problem
> > >> > >> > > > > after
> > >> > >> > > > > > > I can receive all packet in user space.
> > >> > >> > > > > > >
> > >> > >> > > > > > > Thanks,
> > >> > >> > > > > > > Xuemei
> > >> > >> > > > > > >
> > >> > >> > > > > > > On Thu, Jul 23, 2015 at 10:13 AM, Ben Pfaff <
> > >> blp at nicira.com>
> > >> > >>
> > >> > >> > > wrote:
> > >> > >> > > > > > >
> > >> > >> > > > > > >> On Thu, Jul 23, 2015 at 10:04:23AM -0700, Xuemei Liu
> > >> wrote:
> > >> > >> > > > > > >> > I am new to ovs, and I am trying to send all
> packets
> > >> from
> > >> > >> kernel
> > >> > >> > > > > space
> > >> > >> > > > > > >> to
> > >> > >> > > > > > >> > user space. I comment the "unlikely(!flow)" in
> > >> > >> > > datapath/datapath.c.
> > >> > >> > > > > > >> > However, it seems I just receive the first packet
> of
> > >> each
> > >> > >> flow
> > >> > >> > > (the
> > >> > >> > > > > > >> first
> > >> > >> > > > > > >> > packet that match one forwarding rule in the
> bridge)
> > >> in
> > >> > >> user
> > >> > >> > > space.
> > >> > >> > > > > > >> Could
> > >> > >> > > > > > >> > anyone tell me why? and is there other way to
> achieve
> > >> my
> > >> > >> goal?
> > >> > >> > > > > > >>
> > >> > >> > > > > > >> You realize that this will be terrible for
> performance,
> > >> > >> right?
> > >> > >> > > > > > >>
> > >> > >> > > > > > >> It's kind of a waste to modify the kernel module for
> > >> this.
> > >> > >> I'd
> > >> > >> > > just
> > >> > >> > > > > > >> modify userspace to send all packets to userspace,
> > >> something
> > >> > >> like
> > >> > >> > > > > this:
> > >> > >> > > > > > >>
> > >> > >> > > > > > >> diff --git a/ofproto/ofproto-dpif-xlate.c
> > >> > >> > > > > b/ofproto/ofproto-dpif-xlate.c
> > >> > >> > > > > > >> index 52395a7..a98406a 100644
> > >> > >> > > > > > >> --- a/ofproto/ofproto-dpif-xlate.c
> > >> > >> > > > > > >> +++ b/ofproto/ofproto-dpif-xlate.c
> > >> > >> > > > > > >> @@ -4777,7 +4777,7 @@ xlate_actions(struct xlate_in
> > >> *xin,
> > >> > >> struct
> > >> > >> > > > > > >> xlate_out *xout)
> > >> > >> > > > > > >>
> > >> > >> > > > > > >>      ctx.xin = xin;
> > >> > >> > > > > > >>      ctx.xout = xout;
> > >> > >> > > > > > >> -    ctx.xout->slow = 0;
> > >> > >> > > > > > >> +    ctx.xout->slow = SLOW_ACTION;
> > >> > >> > > > > > >>      ctx.xout->has_learn = false;
> > >> > >> > > > > > >>      ctx.xout->has_normal = false;
> > >> > >> > > > > > >>      ctx.xout->has_fin_timeout = false;
> > >> > >> > > > > > >>
> > >> > >> > > > > > >
> > >> > >> > > > > > >
> > >> > >> > > > >
> > >> > >> > >
> > >> > >>
> > >> > >
> > >> > >
> > >>
> > >
> > >
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150726/63db12d4/attachment-0001.html>

From blp at nicira.com  Sun Jul 26 08:29:55 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sun, 26 Jul 2015 08:29:55 -0700
Subject: [ovs-discuss] How to set the number of threads in usespace to
 handle upcalls?
In-Reply-To: <CA+oJsLNOXXh-OV_C5OHugyTrLSV3DwzOvhaDdpifyf8xhHufoA@mail.gmail.com>
References: <CA+oJsLN-4ZGLpcjEBVKcn0rhzmLzBiMVo1Z=4TX98+fX4r8cqQ@mail.gmail.com>
 <20150726031615.GC12583@nicira.com>
 <CA+oJsLNOXXh-OV_C5OHugyTrLSV3DwzOvhaDdpifyf8xhHufoA@mail.gmail.com>
Message-ID: <20150726152955.GA29357@nicira.com>

On Sun, Jul 26, 2015 at 12:00:34AM -0700, Xuemei Liu wrote:
> Thanks, I follow the command in
> http://openvswitch.org/pipermail/discuss/2013-November/011994.html. It
> works for me.
> However, I find one problem. My machine has 8 cores, ovs-vswitchd works
> fine if I set n-handler-threads=10, but exits if I increase the number to
> 20. I am guessing there is thread number upper limit proportional to the
> number of cores?

There shouldn't be.  That sounds like a bug of some kind.

From davewaters1970 at gmail.com  Sun Jul 26 16:20:56 2015
From: davewaters1970 at gmail.com (Dave Waters)
Date: Mon, 27 Jul 2015 04:50:56 +0530
Subject: [ovs-discuss] dpctl and user-defined flows
Message-ID: <CAARSoVxcd77-LYhL7tO-boRg0nmiYTQT4be9Mh=x+Lun5HA73g@mail.gmail.com>

Hi,

When i switch traffic in OVS i see that the dataplane automatically creates
a flow that i can see with the ovs-dpctl dump-flows command. And then there
are flows that are created by the user using ofctl add-flow command. One
difference that i see between the two is that the flows added automatically
by the data plane are restricted to Layer 3 information (source IP, dest IP
and protocol type) while the user defined can go all the way till Layer 4
(UDP source port, UDP dest port, etc).

So are the ones created by the data plane automatically the "mega flows"
while the ones created by users the "micro flows"?

Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150727/1eaf5256/attachment.html>

From abhishekv.verma at gmail.com  Sun Jul 26 17:49:35 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Mon, 27 Jul 2015 06:19:35 +0530
Subject: [ovs-discuss] dpctl and user-defined flows
In-Reply-To: <CAARSoVxcd77-LYhL7tO-boRg0nmiYTQT4be9Mh=x+Lun5HA73g@mail.gmail.com>
References: <CAARSoVxcd77-LYhL7tO-boRg0nmiYTQT4be9Mh=x+Lun5HA73g@mail.gmail.com>
Message-ID: <CADDmorTV9ZV1wJRj0t5FAE8ysp=mkZoqskTXPyCfimJUYx5EBw@mail.gmail.com>

Yes, since ones installed by dataplane only affect forwarding and are hence
mega-flows.

On Mon, Jul 27, 2015 at 4:50 AM, Dave Waters <davewaters1970 at gmail.com>
wrote:

> Hi,
>
> When i switch traffic in OVS i see that the dataplane automatically
> creates a flow that i can see with the ovs-dpctl dump-flows command. And
> then there are flows that are created by the user using ofctl add-flow
> command. One difference that i see between the two is that the flows added
> automatically by the data plane are restricted to Layer 3 information
> (source IP, dest IP and protocol type) while the user defined can go all
> the way till Layer 4 (UDP source port, UDP dest port, etc).
>
> So are the ones created by the data plane automatically the "mega flows"
> while the ones created by users the "micro flows"?
>
> Dave
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150727/eea0fe55/attachment.html>

From thomas.morin at orange.com  Fri Jul 24 10:32:34 2015
From: thomas.morin at orange.com (thomas.morin at orange.com)
Date: Fri, 24 Jul 2015 19:32:34 +0200
Subject: [ovs-discuss] Problems with MPLS header pushing
In-Reply-To: <CALnjE+o5FGFOQ9SVgsbneka8rhN7g4Xpag3kKdJN9midhR_mHA@mail.gmail.com>
References: <55A8C028.1060308@igd.fraunhofer.de>
 <55AE6033.7080803@igd.fraunhofer.de>
 <CALnjE+o5FGFOQ9SVgsbneka8rhN7g4Xpag3kKdJN9midhR_mHA@mail.gmail.com>
Message-ID: <7020_1437982657_55B5DFC1_7020_2295_1_55B276B2.9030109@orange.com>

Hi Pravin,

Pravin Shelar :
> On Tue, Jul 21, 2015 at 8:07 AM, Daniel Herrmann
> <daniel.herrmann at igd.fraunhofer.de> wrote:
>> I know this may not be a very interesting question, but I do not have
>> any idea why forwarding does not work.
>>
>> Any help would really be appreciated.
> There were few MPLS fixed pushed in branch 2.4, Can you try it on
> master or branch 2.4?

Although 2.4 will be much better for MPLS with the kernel dataplane, I 
think it would still be nice if that bug could be solved in a 2.3.x 
release because, looking at the mailing list, it seems like many people 
may be running into that issue (scherepnin at gmail.com recently, but 
looking at the explanations it seems many others).

This an issue that I've always ran into with 2.3.x (which is why we use 
pre 2.4 for our work).
So, going 2.4 is nicer for sure, but I suspect 2.4 won't make it into 
distros overnight...

For instance (2.3.2 with linux 3.16 kernel module):

ovs-ofctl dump-flows:
lnx01:~# ovs-ofctl dump-flows ovsbr0
NXST_FLOW reply (xid=0x4):
  cookie=0x0, duration=61.390s, table=0, n_packets=13, n_bytes=1274, 
idle_age=1, ip,in_port=1,nw_dst=2.2.2.2 
actions=push_mpls:0x8847,load:0x2a->OXM_OF_MPLS_LABEL[],output:3

2015-07-21T16:17:06.863Z|00185|dpif(handler7)|WARN|system at ovs-system: 
failed to put[create] (Invalid argument) 
skb_priority(0),in_port(2),skb_mark(0/0),eth(src=4a:ee:e6:1d:f9:58/00:00:00:00:00:00,dst=82:4c:1b:8e:a2:62/00:00:00:00:00:00),eth_type(0x0800),ipv4(src=2.2.2.1/0.0.0.0,dst=2.2.2.2/255.255.255.255,proto=1/0,tos=0/0xfc,ttl=64/0xff,frag=no/0xff),icmp(type=8,code=0), 
actions:set(tunnel(tun_id=0x0,src=0.0.0.0,dst=192.168.122.102,tos=0x0,ttl=64,flags(df))),push_mpls(label=42,tc=0,ttl=64,bos=1,eth_type=0x8847),3

in dmesg:
[  364.756239] openvswitch: netlink: Contain more than allowed mask 
fields (mask_attrs=108cc, mask_allowed=180dc).

The bit in masked attributes that is not in mask allowed is bit 11, 
OVS_KEY_ATTR_ICMP.
I'm not familiar enough with the masking code to debug further.

Best,

-Thomas

_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d'alteration,
Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.
Thank you.


From hsn.noun at gmail.com  Sat Jul 25 12:40:01 2015
From: hsn.noun at gmail.com (Hassan Noun)
Date: Sat, 25 Jul 2015 22:40:01 +0300
Subject: [ovs-discuss] gtpu in openvswitch
Message-ID: <CAJfbj=F0Or0VnMzCgQ8ojM4-_k5sP2vyA0A6A+YwHD3Et-A0gg@mail.gmail.com>

hi,
please can send me the steps to  Implement GTP tunneling support in OVS
i highly appreciate your cooperation

BRs,
Hassan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150725/9ffb5890/attachment-0001.html>

From takahashi.minoru7 at gmail.com  Mon Jul 27 01:01:26 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Mon, 27 Jul 2015 17:01:26 +0900
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <20150724153428.GA20805@nicira.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
 <55A886CE.3040305@gmail.com> <20150717164204.GG10847@nicira.com>
 <55ADE240.8000309@gmail.com> <20150721151917.GC15450@nicira.com>
 <55AF537A.3060800@gmail.com> <55B1D0FD.1020601@gmail.com>
 <20150724153428.GA20805@nicira.com>
Message-ID: <55B5E556.9050106@gmail.com>

Hi,

On 2015年07月25日 00:34, Ben Pfaff wrote:
> On Fri, Jul 24, 2015 at 02:45:33PM +0900, Minoru TAKAHASHI wrote:
>> Hi,
>>
>> On 2015年07月22日 17:25, Minoru TAKAHASHI wrote:
>>> Hi,
>>>
>>> Thank you for reply.
>>>
>>> On 2015年07月22日 00:19, Ben Pfaff wrote:
>>>> On Tue, Jul 21, 2015 at 03:10:08PM +0900, Minoru TAKAHASHI wrote:
>>>>>> they do not make the corresponding change to the decoder
>>>>>
>>>>> Should I fix this problem?
>>>>> If so, please tell me that which source file should I fix.
>>>>> (Sorry, I am new in implementation of OpenvSwitch.)
>>>>
>>>> I cannot apply anything to the repository that makes tests fail, so yes
>>>> you should fix the decoder.
>>>>
>>>> The decode function is right next to the encode function.
>>
>>> ## ------------------------------ ##
>>> ## openvswitch 2.4.90 test suite. ##
>>> ## ------------------------------ ##
>>>
>>> 694: ofproto - del group (OpenFlow 1.5)              FAILED (ofproto.at:350)
>>> 696: ofproto - insert buckets                        FAILED (ofproto.at:424)
>>
>> I think that the following code is causing the above error.
>>
>> [lib/ofp-msgs.h]
>> https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L336
>>
>> [tests/ofp-print.at]
>> https://github.com/openvswitch/ovs/blob/master/tests/ofp-print.at#L2003
>>
>> After I fix these, the above error does not occur.
> 
> Did you run all the tests?  I see three failures:

Oh, sorry about that.
Hmm, how to run the testsuite is correct in the following?

1. uninstall ovs

 sudo make uninstall
 sudo make distclean

2. install ovs

 ./boot.sh
 ./configure
 make && sudo make install

3. run tests

 ./tests/testsuite -C tests AUTOTEST_PATH=utilities:vswitchd:ovsdb:vtep:tests

And, previous patch has the following error.
I attached fixed patch in this email.
(However, might this patch still have an error.
 Because I don't know how to run correctly the testsuite.)

thanks,

## ------------------------ ##
## Summary of the failures. ##
## ------------------------ ##

 243: ofp-print.at:2000  OFPST_GROUP_DESC request - OF1.5
      ofp-print ofpt_stats_request

## ---------------------- ##
## Detailed failed tests. ##
## ---------------------- ##

#                             -*- compilation -*-
243. ofp-print.at:2000: testing OFPST_GROUP_DESC request - OF1.5 ...
./ofp-print.at:2002: ovs-ofctl ofp-print "\
06 12 00 14 00 00 00 02 00 07 00 00 00 00 00 00 \
00 00 00 01
"
--- /dev/null	2015-07-27 08:55:16.622039910 +0900
+++ /home/ryu/wk_takahashi/my_ovs/ovs/tests/testsuite.dir/at-groups/243/stderr	2015-07-27 15:43:43.304223828 +0900
@@ -0,0 +1 @@
+2015-07-27T06:43:43Z|00001|ofp_msgs|WARN|received OFPST_GROUP_DESC request with incorrect length 20 (expected length 24)
--- -	2015-07-27 15:43:43.314504500 +0900
+++ /home/ryu/wk_takahashi/my_ovs/ovs/tests/testsuite.dir/at-groups/243/stdout	2015-07-27 15:43:43.308223828 +0900
@@ -1,2 +1,4 @@
-OFPST_GROUP_DESC request (OF1.5) (xid=0x2): group_id=1
+***decode error: OFPBRC_BAD_LEN***
+00000000  06 12 00 14 00 00 00 02-00 07 00 00 00 00 00 00 |................|
+00000010  00 00 00 01                                     |....            |
 
243. ofp-print.at:2000: 243. OFPST_GROUP_DESC request - OF1.5 (ofp-print.at:2000): FAILED (ofp-print.at:2002)

> 
> ## ------------------------ ##
> ## Summary of the failures. ##
> ## ------------------------ ##
> Failed tests:
> openvswitch 2.4.90 test suite test groups:
> 
>  NUM: FILE-NAME:LINE     TEST-GROUP-NAME
>       KEYWORDS
> 
>  695: ofproto.at:343     ofproto - del group (OpenFlow 1.5)
>  697: ofproto.at:418     ofproto - insert buckets
>  698: ofproto.at:476     ofproto - remove buckets
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-openflow-Add-OpenFlow1.5-group-desc-request.patch
Type: text/x-patch
Size: 1105 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150727/488dcaf8/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-ofp-util-Fix-group-desc-request-encoding.patch
Type: text/x-patch
Size: 2414 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150727/488dcaf8/attachment-0003.bin>

From gowrishankar.m at linux.vnet.ibm.com  Sun Jul 26 21:50:26 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Mon, 27 Jul 2015 10:20:26 +0530
Subject: [ovs-discuss] packets getting dropped at egress
In-Reply-To: <CAARSoVwCfjdxCe+W2Qnb8GtC9_OhrJx71A9TE0WXC4owkqNtTA@mail.gmail.com>
References: <CAARSoVzgtNFsApTnukZyFCWmgxAwpqBJuYCT7UV-XJ8_PJ47aA@mail.gmail.com>
 <55B0F7DA.7090401@linux.vnet.ibm.com>
 <CAARSoVwCfjdxCe+W2Qnb8GtC9_OhrJx71A9TE0WXC4owkqNtTA@mail.gmail.com>
Message-ID: <55B5B892.1070904@linux.vnet.ibm.com>

ifconfig br0 mtu 1600 works expectedly. Even ip link set command too.

You might need to check on why ifconfig fails to update br0. dmesg ?

Thanks,
Gowrishankar

On Friday 24 July 2015 09:26 PM, Dave Waters wrote:
> Hi,
>
> I am unable to increase the MTU of the bridge port (the internal port) 
> to be anything more than 1500. While i am able to reduce it, i am not 
> able to increase it.
>
> The reason i want to increase the MTU of the internal port is because 
> i am encapsulating all packets that i recieve on eth1 inside VXLAN 
> which increase the packet size. If i recieve a 1500 byte packet on 
> eth1, then i am dropping the packets since the size goes beyond the 
> MTU of the bridge after i put in VXLAN encapsulation.
>
> root at ubuntu:/home/dw# ovs-vsctl show
> b69c9516-a7dd-445c-a82d-8fb704e587a3
>     Bridge "br0"
>         Port "gre0"
>             Interface "vxlanIp"
>                 type: vxlan
>                 options: {key="500", remote_ip="192.168.0.1"}
>         Port "eth1"
>             Interface "eth1"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "eth0"
>             Interface "eth0"
>     ovs_version: "2.0.2"
> root at ubuntu:/home/dw#
> root at ubuntu:/home/dw# ifconfig br0 mtu 1600
>
> root at ubuntu:/home/dw# ifconfig br0
> br0     Link encap:Ethernet  HWaddr 00:90:0b:35:e4:36
>           inet addr:192.16.10.147  Bcast:192.168.10.255 
>  Mask:255.255.255.0
>           inet6 addr: fe80::dc88:f5ff:feef:ef9b/64 Scope:Link
>           UP BROADCAST RUNNING  MTU:1500  Metric:1
> [clipped]
>
> root at ubuntu:/home/dw#
>
> Dave
>
> On Thu, Jul 23, 2015 at 7:49 PM, gowrishankar 
> <gowrishankar.m at linux.vnet.ibm.com 
> <mailto:gowrishankar.m at linux.vnet.ibm.com>> wrote:
>
>     On Thursday 23 July 2015 04:16 AM, Dave Waters wrote:
>
>         Hi,
>
>         I have two ports in my OVS bridge. I receive packets from one
>         port (portA) and i send them out of the other (portB). When i
>         send out the packets, they are VXLAN tunneled to the other end.
>
>         Now, the default MTU of all ports (including the bridge port)
>         is 1500 in my setup.
>
>         The issue is that when i get a 1500 byte packet on portA, i
>         try to push it out on portB after slapping on the VXLAN
>         headers. This results in a packet size thats greater than what
>         portB can handle, and hence the packets are dropped.
>
>
>     Is increasing MTU of portB to 1550 (to accommodate additional 50
>     bytes when no vlan taged) a constraint in your setup ?
>
>
>         I know that OVS does not handle IP fragmentation/reassembly,
>         so how do we deal with this situation? I dont think we can
>         rely on path MTU discovery since not all applications do PMTU
>         before spewing out packets. Any ideas, anybody?
>
>         Warm regards,
>         Dave
>
>
>     -- 
>     Regards,
>     Gowrishankar M
>
>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150727/7d3689d1/attachment.html>

From benoit.georgelin at web4all.fr  Mon Jul 27 09:51:08 2015
From: benoit.georgelin at web4all.fr (Benoit GEORGELIN - Association Web4all)
Date: Mon, 27 Jul 2015 18:51:08 +0200 (CEST)
Subject: [ovs-discuss] Restrict IP address dst to an Openvswitch port
In-Reply-To: <1664355036.455693.1437258977584.JavaMail.zimbra@web4all.fr>
References: <1664355036.455693.1437258977584.JavaMail.zimbra@web4all.fr>
Message-ID: <203721320.1023781.1438015868799.JavaMail.zimbra@web4all.fr>

Anyone can help to secure communication on a OpenVswitch ? 

Thanks. 


Cordialement, 


De: "Benoit GEORGELIN - Association Web4all" <benoit.georgelin at web4all.fr> 
À: discuss at openvswitch.org 
Envoyé: Samedi 18 Juillet 2015 18:36:17 
Objet: [ovs-discuss] Restrict IP address dst to an Openvswitch port 

Hi openvswitch community , 

Since few weeks i'm using OpenVswitch , I'm looking to build a virtual network for lxc containers. 
I would like to use OpenVswitch to restrict communication on a specific port. 

In my example I have two containers A and B 
Each containers are linked to an OpenVswitch Interface ( int-A et int-B ) 

A have an IP address : 10.0.0.1 configured inside the container 
B have an IP address: 10.0.0.2 configured inside the container 

I would like to allow only destination 10.0.0.1 to int-A and 10.0.0.2 to int-B 

Can I do it this by Openflow ? Any example would be appreciated. 

This is to avoid user in container B to user A's IP address . 

Thanks for you help 


Cordialement, 
Benoit 

_______________________________________________ 
discuss mailing list 
discuss at openvswitch.org 
http://openvswitch.org/mailman/listinfo/discuss 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150727/0589db3b/attachment.html>

From blp at nicira.com  Mon Jul 27 09:56:12 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 27 Jul 2015 09:56:12 -0700
Subject: [ovs-discuss] Problems with MPLS header pushing
In-Reply-To: <7020_1437982657_55B5DFC1_7020_2295_1_55B276B2.9030109@orange.com>
References: <55A8C028.1060308@igd.fraunhofer.de>
 <55AE6033.7080803@igd.fraunhofer.de>
 <CALnjE+o5FGFOQ9SVgsbneka8rhN7g4Xpag3kKdJN9midhR_mHA@mail.gmail.com>
 <7020_1437982657_55B5DFC1_7020_2295_1_55B276B2.9030109@orange.com>
Message-ID: <20150727165612.GD5243@nicira.com>

On Fri, Jul 24, 2015 at 07:32:34PM +0200, thomas.morin at orange.com wrote:
> Pravin Shelar :
> >On Tue, Jul 21, 2015 at 8:07 AM, Daniel Herrmann
> ><daniel.herrmann at igd.fraunhofer.de> wrote:
> >>I know this may not be a very interesting question, but I do not have
> >>any idea why forwarding does not work.
> >>
> >>Any help would really be appreciated.
> >There were few MPLS fixed pushed in branch 2.4, Can you try it on
> >master or branch 2.4?
> 
> Although 2.4 will be much better for MPLS with the kernel dataplane, I think
> it would still be nice if that bug could be solved in a 2.3.x release
> because, looking at the mailing list, it seems like many people may be
> running into that issue (scherepnin at gmail.com recently, but looking at the
> explanations it seems many others).

If MPLS is going to work well in Open vSwitch, we need a developer to
champion implementing and testing it.  None of the OVS developers right
now have a use case for MPLS, so we don't use it and don't test it, and
therefore don't find bugs, missing features, performance problems, etc.,
and no one has incentive to improve the situation.

If you are able and willing to work on MPLS in OVS, please do!

From jpettit at nicira.com  Mon Jul 27 09:59:31 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 27 Jul 2015 09:59:31 -0700
Subject: [ovs-discuss] Restrict IP address dst to an Openvswitch port
In-Reply-To: <1664355036.455693.1437258977584.JavaMail.zimbra@web4all.fr>
References: <1664355036.455693.1437258977584.JavaMail.zimbra@web4all.fr>
Message-ID: <4024A5B3-C1BC-478D-9D27-174C56B915C9@nicira.com>


> On Jul 18, 2015, at 3:36 PM, Benoit GEORGELIN - Association Web4all <benoit.georgelin at web4all.fr> wrote:
> 
> Hi openvswitch community , 
> 
> Since few weeks i'm using OpenVswitch , I'm looking to build a virtual network for lxc containers. 
> I would like to use OpenVswitch to restrict communication on a specific port. 
> 
> In my example I have two containers A and B 
> Each containers are linked to an OpenVswitch Interface ( int-A et int-B ) 
> 
> A have an IP address : 10.0.0.1 configured inside the container
> B have an IP address: 10.0.0.2 configured inside the container
> 
> I would like to allow only destination 10.0.0.1 to int-A and 10.0.0.2 to int-B
> 
> Can I do it this by Openflow ? Any example would be appreciated. 

Yes.  Take a look at the ovs-ofctl man page.  You'll want to look at the "nw_dst" match in particular.

--Justin




From blp at nicira.com  Mon Jul 27 13:32:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 27 Jul 2015 13:32:17 -0700
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <55B5E556.9050106@gmail.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
 <55A886CE.3040305@gmail.com> <20150717164204.GG10847@nicira.com>
 <55ADE240.8000309@gmail.com> <20150721151917.GC15450@nicira.com>
 <55AF537A.3060800@gmail.com> <55B1D0FD.1020601@gmail.com>
 <20150724153428.GA20805@nicira.com> <55B5E556.9050106@gmail.com>
Message-ID: <20150727203217.GG5243@nicira.com>

On Mon, Jul 27, 2015 at 05:01:26PM +0900, Minoru TAKAHASHI wrote:
> On 2015年07月25日 00:34, Ben Pfaff wrote:
> > On Fri, Jul 24, 2015 at 02:45:33PM +0900, Minoru TAKAHASHI wrote:
> >> Hi,
> >>
> >> On 2015年07月22日 17:25, Minoru TAKAHASHI wrote:
> >>> Hi,
> >>>
> >>> Thank you for reply.
> >>>
> >>> On 2015年07月22日 00:19, Ben Pfaff wrote:
> >>>> On Tue, Jul 21, 2015 at 03:10:08PM +0900, Minoru TAKAHASHI wrote:
> >>>>>> they do not make the corresponding change to the decoder
> >>>>>
> >>>>> Should I fix this problem?
> >>>>> If so, please tell me that which source file should I fix.
> >>>>> (Sorry, I am new in implementation of OpenvSwitch.)
> >>>>
> >>>> I cannot apply anything to the repository that makes tests fail, so yes
> >>>> you should fix the decoder.
> >>>>
> >>>> The decode function is right next to the encode function.
> >>
> >>> ## ------------------------------ ##
> >>> ## openvswitch 2.4.90 test suite. ##
> >>> ## ------------------------------ ##
> >>>
> >>> 694: ofproto - del group (OpenFlow 1.5)              FAILED (ofproto.at:350)
> >>> 696: ofproto - insert buckets                        FAILED (ofproto.at:424)
> >>
> >> I think that the following code is causing the above error.
> >>
> >> [lib/ofp-msgs.h]
> >> https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L336
> >>
> >> [tests/ofp-print.at]
> >> https://github.com/openvswitch/ovs/blob/master/tests/ofp-print.at#L2003
> >>
> >> After I fix these, the above error does not occur.
> > 
> > Did you run all the tests?  I see three failures:
> 
> Oh, sorry about that.
> Hmm, how to run the testsuite is correct in the following?
> 
> 1. uninstall ovs
> 
>  sudo make uninstall
>  sudo make distclean
> 
> 2. install ovs
> 
>  ./boot.sh
>  ./configure
>  make && sudo make install
> 
> 3. run tests
> 
>  ./tests/testsuite -C tests AUTOTEST_PATH=utilities:vswitchd:ovsdb:vtep:tests

You don't have to install (or uninstall) OVS to run the testsuite.  Just
build OVS then run "make check".

From vbadiger at avaya.com  Tue Jul 28 04:21:56 2015
From: vbadiger at avaya.com (Badiger, Vishwanath (Vishwa))
Date: Tue, 28 Jul 2015 11:21:56 +0000
Subject: [ovs-discuss] Is it possible to clear statistics of bridge ?
Message-ID: <7712B9DB39307A41B020D8182A22B13C446702EC@AZ-FFEXMB04.global.avaya.com>

Hi All,
Is it possible to clear statistics of bridge using any of ovs commands ? If yes, which command and how can we do it ?
I am searching for such command in OVS documents, but not finding such information. Would like to know the reason if clearing statistics is not supported by OVS.
Thanks in advance.


Regards,
Vishwa.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150728/4d2c5b74/attachment.html>

From abhishekv.verma at gmail.com  Tue Jul 28 05:18:01 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Tue, 28 Jul 2015 17:48:01 +0530
Subject: [ovs-discuss] OVS -- Linux interaction
Message-ID: <CADDmorTr+a38U-hc48DDOKsrj+ua7AdOCk3=sC17kRYe76+Zww@mail.gmail.com>

Hi,

I have an OVS bridge in which i have added an eth0 and an eth1 port. I am
receiving some traffic on eth1 and am sending it out on a VXLAN tunnel that
goes out over eth0.

My question is this:

For the packet to eventually go out, the outer L2 header must be populated.
For that we need to construct the packet with the right source and dest
MACs. I understand that we get the source MAC from the bridge port.
However, for the dest MAC we need to look at our ARP table to figure out
the ARP of the directly connected nexthop. This information lies in the
linux kernel -- outside OVS. So how does this interaction happen.

OVS has a packet and then does it do like a data structure lookup to find
out the dest MAC for a given gateway OR does the packet go out of the OVS
and into the Linux kernel for that final processing. If its the latter,
then how does the packet get inserted back into the OVS since it can
finally egress out of eth0 only by using the OVS stack.

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150728/31983bd0/attachment.html>

From thomas.morin at orange.com  Tue Jul 28 05:33:12 2015
From: thomas.morin at orange.com (thomas.morin at orange.com)
Date: Tue, 28 Jul 2015 14:33:12 +0200
Subject: [ovs-discuss] Problems with MPLS header pushing
In-Reply-To: <20150727165612.GD5243@nicira.com>
References: <55A8C028.1060308@igd.fraunhofer.de>
 <55AE6033.7080803@igd.fraunhofer.de>
 <CALnjE+o5FGFOQ9SVgsbneka8rhN7g4Xpag3kKdJN9midhR_mHA@mail.gmail.com>
 <7020_1437982657_55B5DFC1_7020_2295_1_55B276B2.9030109@orange.com>
 <20150727165612.GD5243@nicira.com>
Message-ID: <8151_1438086794_55B7768A_8151_2626_1_55B77688.9040009@orange.com>

Hi Ben,

2015-07-27, Ben Pfaff:
> If MPLS is going to work well in Open vSwitch, we need a developer to
> champion implementing and testing it.  None of the OVS developers right
> now have a use case for MPLS, so we don't use it and don't test it, and
> therefore don't find bugs, missing features, performance problems, etc.,
> and no one has incentive to improve the situation.

There are many people/projects based on OVS and needing an MPLS 
dataplane, in particular for use cases where OVS has to interconnect 
with IP/MPLS routers for BGP VPNs:
- the reference driver for networking-bgpvpn Neutron project
- work in progress in ODL for BGP VPN interconnection
- Nuage Networks solution

So I'm not pessimistic, I expect this to happen.
But 2.3 is likely to receive less interest.

> If you are able and willing to work on MPLS in OVS, please do!

Well I'll be humble here: without some support, my mastership of OVS in 
insufficient to allow me to dive in kernel/userspace interactions and 
fix things in an amount of time reasonable compared to how important 
MPLS is in the 2.3 branch.

In that particular case (trying to fix tat bug in the 2.3.x branch for 
MPLS) I could use some help: a hint on where to start to find why 
match->mask->key.ip.proto ends up being something else than 0xff in 
match_validate (datapath/flow_netlink.c).

-Thomas


_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d'alteration,
Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.
Thank you.


From blp at nicira.com  Tue Jul 28 08:21:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 28 Jul 2015 08:21:29 -0700
Subject: [ovs-discuss] Problems with MPLS header pushing
In-Reply-To: <8151_1438086794_55B7768A_8151_2626_1_55B77688.9040009@orange.com>
References: <55A8C028.1060308@igd.fraunhofer.de>
 <55AE6033.7080803@igd.fraunhofer.de>
 <CALnjE+o5FGFOQ9SVgsbneka8rhN7g4Xpag3kKdJN9midhR_mHA@mail.gmail.com>
 <7020_1437982657_55B5DFC1_7020_2295_1_55B276B2.9030109@orange.com>
 <20150727165612.GD5243@nicira.com>
 <8151_1438086794_55B7768A_8151_2626_1_55B77688.9040009@orange.com>
Message-ID: <20150728152129.GI3736@nicira.com>

On Tue, Jul 28, 2015 at 02:33:12PM +0200, thomas.morin at orange.com wrote:
> 2015-07-27, Ben Pfaff:
> >If MPLS is going to work well in Open vSwitch, we need a developer to
> >champion implementing and testing it.  None of the OVS developers right
> >now have a use case for MPLS, so we don't use it and don't test it, and
> >therefore don't find bugs, missing features, performance problems, etc.,
> >and no one has incentive to improve the situation.
> 
> There are many people/projects based on OVS and needing an MPLS dataplane,
> in particular for use cases where OVS has to interconnect with IP/MPLS
> routers for BGP VPNs:
> - the reference driver for networking-bgpvpn Neutron project
> - work in progress in ODL for BGP VPN interconnection
> - Nuage Networks solution
> 
> So I'm not pessimistic, I expect this to happen.

Well, that's good.

> >If you are able and willing to work on MPLS in OVS, please do!
> 
> Well I'll be humble here: without some support, my mastership of OVS in
> insufficient to allow me to dive in kernel/userspace interactions and fix
> things in an amount of time reasonable compared to how important MPLS is in
> the 2.3 branch.
> 
> In that particular case (trying to fix tat bug in the 2.3.x branch for MPLS)
> I could use some help: a hint on where to start to find why
> match->mask->key.ip.proto ends up being something else than 0xff in
> match_validate (datapath/flow_netlink.c).

Usually that would mean that userspace wanted to wildcard everything at
L4.

From standulwadka at avaya.com  Mon Jul 27 10:05:36 2015
From: standulwadka at avaya.com (Tandulwadkar, Sanket Ravindra (Sanket Ravindra))
Date: Mon, 27 Jul 2015 17:05:36 +0000
Subject: [ovs-discuss] is_connected parameter absent:
 2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms timeout at
 lib/ovsdb-idl.c:1354
Message-ID: <9CE18184B620BC45BF38C3D5361BCDA802BD68@AZ-US1EXMB01.global.avaya.com>

Hello,

I am trying to add TLS support to ODL using OVS. I believe my controller is not able to receive packets. I am setting controller using: sudo ovs-vsctl --verbose set-controller br0 ssl:172.31.1.2:6633

The output I get is:

2015-07-27T16:59:41Z|00002|reconnect|DBG|unix:/var/run/openvswitch/db.sock: entering BACKOFF
2015-07-27T16:59:41Z|00003|hmap|DBG|lib/shash.c:112: 6 nodes in bucket (16 nodes, 8 buckets)
2015-07-27T16:59:41Z|00004|reconnect|INFO|unix:/var/run/openvswitch/db.sock: connecting...
2015-07-27T16:59:41Z|00005|reconnect|DBG|unix:/var/run/openvswitch/db.sock: entering CONNECTING
2015-07-27T16:59:41Z|00006|poll_loop|DBG|wakeup due to [POLLOUT] on fd 4 (<->/var/run/openvswitch/db.sock) at lib/stream-fd-unix.c:120
2015-07-27T16:59:41Z|00007|reconnect|INFO|unix:/var/run/openvswitch/db.sock: connected
2015-07-27T16:59:41Z|00008|reconnect|DBG|unix:/var/run/openvswitch/db.sock: entering ACTIVE
2015-07-27T16:59:41Z|00009|jsonrpc|DBG|unix:/var/run/openvswitch/db.sock: send request, method="monitor", params=["Open_vSwitch",null,{"Port":{"columns":["fake_bridge","interfaces","name","tag"]},"Interface":{"columns":["name","ofport"]},"Bridge":{"columns":["controller","fail_mode","name","ports"]},"Controller":{"columns":["target"]},"Open_vSwitch":{"columns":["bridges","cur_cfg"]}}], id=0
2015-07-27T16:59:41Z|00010|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (<->/var/run/openvswitch/db.sock) at lib/stream-fd-unix.c:124
2015-07-27T16:59:41Z|00011|jsonrpc|DBG|unix:/var/run/openvswitch/db.sock: received reply, result={"Port":{"1788020b-a37c-44dd-80c8-8738adb8b2c6":{"new":{"name":"eth1","fake_bridge":false,"interfaces":["uuid","1c9212b1-eba7-4633-807b-82aeed0cd32e"],"tag":["set",[]]}},"94736136-c277-4096-bd96-e3d13c43c9ba":{"new":{"name":"br0","fake_bridge":false,"interfaces":["uuid","1d26a8ea-83cc-47d7-b51d-2470f1a57e68"],"tag":["set",[]]}}},"Interface":{"1c9212b1-eba7-4633-807b-82aeed0cd32e":{"new":{"name":"eth1","ofport":1}},"1d26a8ea-83cc-47d7-b51d-2470f1a57e68":{"new":{"name":"br0","ofport":65534}}},"Bridge":{"2ff9ef0a-5e29-4bf3-937d-59f5646cee2c":{"new":{"fail_mode":["set",[]],"name":"br0","ports":["set",[["uuid","1788020b-a37c-44dd-80c8-8738adb8b2c6"],["uuid","94736136-c277-4096-bd96-e3d13c43c9ba"]]],"controller":["uuid","5b812d0b-cda4-49f7-b303-57f04a08b710"]}}},"Controller":{"5b812d0b-cda4-49f7-b303-57f04a08b710":{"new":{"target":"ssl:172.31.1.2:6633"}}},"Open_vSwitch":{"cdf33b4e-420b-434d-87ba-d0e2183c9d47":{"new":{"bridges":["uuid","2ff9ef0a-5e29-4bf3-937d-59f5646cee2c"],"cur_cfg":129}}}}, id=0
2015-07-27T16:59:41Z|00012|jsonrpc|DBG|unix:/var/run/openvswitch/db.sock: send request, method="transact", params=["Open_vSwitch",{"rows":[{"bridges":["uuid","2ff9ef0a-5e29-4bf3-937d-59f5646cee2c"]}],"columns":["bridges"],"table":"Open_vSwitch","until":"==","where":[["_uuid","==",["uuid","cdf33b4e-420b-434d-87ba-d0e2183c9d47"]]],"timeout":0,"op":"wait"},{"rows":[{"controller":["uuid","5b812d0b-cda4-49f7-b303-57f04a08b710"]}],"columns":["controller"],"table":"Bridge","until":"==","where":[["_uuid","==",["uuid","2ff9ef0a-5e29-4bf3-937d-59f5646cee2c"]]],"timeout":0,"op":"wait"},{"rows":[{"target":"ssl:172.31.1.2:6633"}],"columns":["target"],"table":"Controller","until":"==","where":[["_uuid","==",["uuid","5b812d0b-cda4-49f7-b303-57f04a08b710"]]],"timeout":0,"op":"wait"},{"row":{"target":"ssl:172.31.1.2:6633"},"table":"Controller","uuid-name":"row4754739a_ae59_4c03_8882_3ad93d5a3ec7","op":"insert"},{"row":{"controller":["named-uuid","row4754739a_ae59_4c03_8882_3ad93d5a3ec7"]},"table":"Bridge","where":[["_uuid","==",["uuid","2ff9ef0a-5e29-4bf3-937d-59f5646cee2c"]]],"op":"update"},{"mutations":[["next_cfg","+=",1]],"table":"Open_vSwitch","where":[["_uuid","==",["uuid","cdf33b4e-420b-434d-87ba-d0e2183c9d47"]]],"op":"mutate"},{"columns":["next_cfg"],"table":"Open_vSwitch","where":[["_uuid","==",["uuid","cdf33b4e-420b-434d-87ba-d0e2183c9d47"]]],"op":"select"},{"comment":"ovs-vsctl: ovs-vsctl --verbose set-controller br0 ssl:172.31.1.2:6633","op":"comment"}], id=1
2015-07-27T16:59:41Z|00013|jsonrpc|DBG|unix:/var/run/openvswitch/db.sock: received notification, method="update", params=[null,{"Bridge":{"2ff9ef0a-5e29-4bf3-937d-59f5646cee2c":{"old":{"controller":["uuid","5b812d0b-cda4-49f7-b303-57f04a08b710"]},"new":{"fail_mode":["set",[]],"name":"br0","ports":["set",[["uuid","1788020b-a37c-44dd-80c8-8738adb8b2c6"],["uuid","94736136-c277-4096-bd96-e3d13c43c9ba"]]],"controller":["uuid","bd3b8498-025f-4916-9c4c-24a3eb02a7e5"]}}},"Controller":{"bd3b8498-025f-4916-9c4c-24a3eb02a7e5":{"new":{"target":"ssl:172.31.1.2:6633"}},"5b812d0b-cda4-49f7-b303-57f04a08b710":{"old":{"target":"ssl:172.31.1.2:6633"}}}}]
2015-07-27T16:59:41Z|00014|jsonrpc|DBG|unix:/var/run/openvswitch/db.sock: received reply, result=[{},{},{},{"uuid":["uuid","bd3b8498-025f-4916-9c4c-24a3eb02a7e5"]},{"count":1},{"count":1},{"rows":[{"next_cfg":130}]},{}], id=1
2015-07-27T16:59:41Z|00015|jsonrpc|DBG|unix:/var/run/openvswitch/db.sock: received notification, method="update", params=[null,{"Open_vSwitch":{"cdf33b4e-420b-434d-87ba-d0e2183c9d47":{"old":{"cur_cfg":129},"new":{"bridges":["uuid","2ff9ef0a-5e29-4bf3-937d-59f5646cee2c"],"cur_cfg":130}}}}]
2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms timeout at lib/ovsdb-idl.c:1354
sanket at sanket-ubuntu-ovs:~$ ^C
sanket at sanket-ubuntu-ovs:~$

sanket at sanket-ubuntu-ovs:~$ sudo ovs-vsctl show
cdf33b4e-420b-434d-87ba-d0e2183c9d47
    Bridge "br0"
        Controller "ssl:172.31.1.2:6633"
        Port "eth1"
            Interface "eth1"
        Port "br0"
            Interface "br0"
                type: internal
    ovs_version: "2.3.1"
sanket at sanket-ubuntu-ovs:

Why can I not see the is_connected parameter? Am I missing something?

Sincerely,
Sanket Tandulwadkar
standulwadka at avaya.com<mailto:standulwadka at avaya.com>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150727/6e56ee7b/attachment.html>

From jpettit at nicira.com  Tue Jul 28 09:03:36 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 28 Jul 2015 09:03:36 -0700
Subject: [ovs-discuss] is_connected parameter absent:
	2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms
	timeout at lib/ovsdb-idl.c:1354
In-Reply-To: <9CE18184B620BC45BF38C3D5361BCDA802BD68@AZ-US1EXMB01.global.avaya.com>
References: <9CE18184B620BC45BF38C3D5361BCDA802BD68@AZ-US1EXMB01.global.avaya.com>
Message-ID: <6A0F35D6-058E-41B9-8A95-911FD508CCAC@nicira.com>


> On Jul 27, 2015, at 10:05 AM, Tandulwadkar, Sanket Ravindra (Sanket Ravindra) <standulwadka at avaya.com> wrote:
>  
> sanket at sanket-ubuntu-ovs:~$ sudo ovs-vsctl show
> cdf33b4e-420b-434d-87ba-d0e2183c9d47
>     Bridge "br0"
>         Controller "ssl:172.31.1.2:6633"
>         Port "eth1"
>             Interface "eth1"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>     ovs_version: "2.3.1"
> sanket at sanket-ubuntu-ovs:
>  
> Why can I not see the is_connected parameter? Am I missing something?

That's just a summary with certain fields.  You should see it if you run "ovs-vsctl list controller".

--Justin



From jpettit at nicira.com  Tue Jul 28 09:17:26 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 28 Jul 2015 09:17:26 -0700
Subject: [ovs-discuss] is_connected parameter absent:
	2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms
	timeout at lib/ovsdb-idl.c:1354
In-Reply-To: <9CE18184B620BC45BF38C3D5361BCDA802BE82@AZ-US1EXMB01.global.avaya.com>
References: <9CE18184B620BC45BF38C3D5361BCDA802BD68@AZ-US1EXMB01.global.avaya.com>
 <6A0F35D6-058E-41B9-8A95-911FD508CCAC@nicira.com>
 <9CE18184B620BC45BF38C3D5361BCDA802BE82@AZ-US1EXMB01.global.avaya.com>
Message-ID: <7EB44382-4EB8-41FB-944F-29B7B8BC19F9@nicira.com>


> On Jul 28, 2015, at 9:09 AM, Tandulwadkar, Sanket Ravindra (Sanket Ravindra) <standulwadka at avaya.com> wrote:
> 
> Hello Justin,
> 
> Thank you for the tip. I did run that, and I could see that its set to false.
> 
> sanket at sanket-ubuntu-ovs:~$ sudo ovs-vsctl list controller
> _uuid               : 5236a306-4ec2-4ee8-b554-e09d42ecc1fc
> connection_mode     : []
> controller_burst_limit: []
> controller_rate_limit: []
> enable_async_messages: []
> external_ids        : {}
> inactivity_probe    : []
> is_connected        : false
> local_gateway       : []
> local_ip            : []
> local_netmask       : []
> max_backoff         : []
> other_config        : {}
> role                : other
> status              : {last_error="Protocol error", sec_since_disconnect="0", state=BACKOFF}
> target              : "ssl:172.31.1.2:6633"
> 
> But on pinging the same target I am able to receive packets.
> 
> PING 172.31.1.2 (172.31.1.2) 56(84) bytes of data.
> 64 bytes from 172.31.1.2: icmp_seq=1 ttl=64 time=0.456 ms
> 64 bytes from 172.31.1.2: icmp_seq=2 ttl=64 time=0.156 ms
> 64 bytes from 172.31.1.2: icmp_seq=3 ttl=64 time=0.177 ms
> ^C
> --- 172.31.1.2 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 1998ms
> rtt min/avg/max/mdev = 0.156/0.263/0.456/0.136 ms
> sanket at sanket-ubuntu-ovs:~$
> 
> sanket at sanket-ubuntu-odl:~$ ping 172.31.1.1
> PING 172.31.1.1 (172.31.1.1) 56(84) bytes of data.
> 64 bytes from 172.31.1.1: icmp_seq=1 ttl=64 time=0.467 ms
> 64 bytes from 172.31.1.1: icmp_seq=2 ttl=64 time=0.185 ms
> 64 bytes from 172.31.1.1: icmp_seq=3 ttl=64 time=0.212 ms
> ^C
> --- 172.31.1.1 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 1998ms
> rtt min/avg/max/mdev = 0.185/0.288/0.467/0.127 ms
> sanket at sanket-ubuntu-odl:~$
> 
> My ODL controller iss on 172.31.1.2 and OvS is running on 172.31.1.1
> 
> Am I missing something here?

It's reporting a "Protocol error" in the "status" column.  Have you looked at your OVS logs to see if there are any logs?  You might try connecting to your controller with s_client to make sure that SSL is configure properly.

--Justin



From jesse at nicira.com  Tue Jul 28 09:24:15 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 28 Jul 2015 09:24:15 -0700
Subject: [ovs-discuss] OVS -- Linux interaction
In-Reply-To: <CADDmorTr+a38U-hc48DDOKsrj+ua7AdOCk3=sC17kRYe76+Zww@mail.gmail.com>
References: <CADDmorTr+a38U-hc48DDOKsrj+ua7AdOCk3=sC17kRYe76+Zww@mail.gmail.com>
Message-ID: <CAEP_g=-5Gj1SLMvaFCD2-ZaU2dTb=YGPTn5H4p2SvL04w=d89w@mail.gmail.com>

On Tue, Jul 28, 2015 at 5:18 AM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Hi,
>
> I have an OVS bridge in which i have added an eth0 and an eth1 port. I am
> receiving some traffic on eth1 and am sending it out on a VXLAN tunnel that
> goes out over eth0.

It does not make sense to have eth0 in the same bridge as the VXLAN
port since they are not in the same network segment (encapsulated vs.
not). OVS simply sends tunneled packets as IP to the Linux stack,
similar to any other application. These packets do not re-enter OVS
unless there is another bridge that is in the normal Linux forwarding
path.

From jpettit at nicira.com  Tue Jul 28 09:34:04 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 28 Jul 2015 09:34:04 -0700
Subject: [ovs-discuss] is_connected parameter absent:
	2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms
	timeout at lib/ovsdb-idl.c:1354
In-Reply-To: <9CE18184B620BC45BF38C3D5361BCDA802BEB1@AZ-US1EXMB01.global.avaya.com>
References: <9CE18184B620BC45BF38C3D5361BCDA802BD68@AZ-US1EXMB01.global.avaya.com>
 <6A0F35D6-058E-41B9-8A95-911FD508CCAC@nicira.com>
 <9CE18184B620BC45BF38C3D5361BCDA802BE82@AZ-US1EXMB01.global.avaya.com>
 <7EB44382-4EB8-41FB-944F-29B7B8BC19F9@nicira.com>
 <9CE18184B620BC45BF38C3D5361BCDA802BEB1@AZ-US1EXMB01.global.avaya.com>
Message-ID: <B7B64702-7273-4B20-9D5C-5ABEC2CC205F@nicira.com>


> On Jul 28, 2015, at 9:26 AM, Tandulwadkar, Sanket Ravindra (Sanket Ravindra) <standulwadka at avaya.com> wrote:
> 
> sanket at sanket-ubuntu-ovs:~$ openssl s_client -connect 172.31.1.2:6633
> CONNECTED(00000003)
> 140381499594384:error:140770FC:SSL routines:SSL23_GET_SERVER_HELLO:unknown protocol:s23_clnt.c:795:

It looks like it's reporting unknown protocol.  My guess is that SSL isn't properly configured on the controller.

--Justin



From standulwadka at avaya.com  Tue Jul 28 09:09:57 2015
From: standulwadka at avaya.com (Tandulwadkar, Sanket Ravindra (Sanket Ravindra))
Date: Tue, 28 Jul 2015 16:09:57 +0000
Subject: [ovs-discuss] is_connected parameter absent:
 2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms timeout at
 lib/ovsdb-idl.c:1354
In-Reply-To: <6A0F35D6-058E-41B9-8A95-911FD508CCAC@nicira.com>
References: <9CE18184B620BC45BF38C3D5361BCDA802BD68@AZ-US1EXMB01.global.avaya.com>
 <6A0F35D6-058E-41B9-8A95-911FD508CCAC@nicira.com>
Message-ID: <9CE18184B620BC45BF38C3D5361BCDA802BE82@AZ-US1EXMB01.global.avaya.com>

Hello Justin,

Thank you for the tip. I did run that, and I could see that its set to false.

sanket at sanket-ubuntu-ovs:~$ sudo ovs-vsctl list controller
_uuid               : 5236a306-4ec2-4ee8-b554-e09d42ecc1fc
connection_mode     : []
controller_burst_limit: []
controller_rate_limit: []
enable_async_messages: []
external_ids        : {}
inactivity_probe    : []
is_connected        : false
local_gateway       : []
local_ip            : []
local_netmask       : []
max_backoff         : []
other_config        : {}
role                : other
status              : {last_error="Protocol error", sec_since_disconnect="0", state=BACKOFF}
target              : "ssl:172.31.1.2:6633"

But on pinging the same target I am able to receive packets.

PING 172.31.1.2 (172.31.1.2) 56(84) bytes of data.
64 bytes from 172.31.1.2: icmp_seq=1 ttl=64 time=0.456 ms
64 bytes from 172.31.1.2: icmp_seq=2 ttl=64 time=0.156 ms
64 bytes from 172.31.1.2: icmp_seq=3 ttl=64 time=0.177 ms
^C
--- 172.31.1.2 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 1998ms
rtt min/avg/max/mdev = 0.156/0.263/0.456/0.136 ms
sanket at sanket-ubuntu-ovs:~$

sanket at sanket-ubuntu-odl:~$ ping 172.31.1.1
PING 172.31.1.1 (172.31.1.1) 56(84) bytes of data.
64 bytes from 172.31.1.1: icmp_seq=1 ttl=64 time=0.467 ms
64 bytes from 172.31.1.1: icmp_seq=2 ttl=64 time=0.185 ms
64 bytes from 172.31.1.1: icmp_seq=3 ttl=64 time=0.212 ms
^C
--- 172.31.1.1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 1998ms
rtt min/avg/max/mdev = 0.185/0.288/0.467/0.127 ms
sanket at sanket-ubuntu-odl:~$

My ODL controller iss on 172.31.1.2 and OvS is running on 172.31.1.1

Am I missing something here?

-----Original Message-----
From: Justin Pettit [mailto:jpettit at nicira.com] 
Sent: Tuesday, July 28, 2015 12:04 PM
To: Tandulwadkar, Sanket Ravindra (Sanket Ravindra)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] is_connected parameter absent: 2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms timeout at lib/ovsdb-idl.c:1354


> On Jul 27, 2015, at 10:05 AM, Tandulwadkar, Sanket Ravindra (Sanket Ravindra) <standulwadka at avaya.com> wrote:
>  
> sanket at sanket-ubuntu-ovs:~$ sudo ovs-vsctl show
> cdf33b4e-420b-434d-87ba-d0e2183c9d47
>     Bridge "br0"
>         Controller "ssl:172.31.1.2:6633"
>         Port "eth1"
>             Interface "eth1"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>     ovs_version: "2.3.1"
> sanket at sanket-ubuntu-ovs:
>  
> Why can I not see the is_connected parameter? Am I missing something?

That's just a summary with certain fields.  You should see it if you run "ovs-vsctl list controller".

--Justin



From standulwadka at avaya.com  Tue Jul 28 09:16:43 2015
From: standulwadka at avaya.com (Tandulwadkar, Sanket Ravindra (Sanket Ravindra))
Date: Tue, 28 Jul 2015 16:16:43 +0000
Subject: [ovs-discuss] is_connected parameter absent:
 2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms timeout at
 lib/ovsdb-idl.c:1354
In-Reply-To: <6A0F35D6-058E-41B9-8A95-911FD508CCAC@nicira.com>
References: <9CE18184B620BC45BF38C3D5361BCDA802BD68@AZ-US1EXMB01.global.avaya.com>
 <6A0F35D6-058E-41B9-8A95-911FD508CCAC@nicira.com>
Message-ID: <9CE18184B620BC45BF38C3D5361BCDA802BE95@AZ-US1EXMB01.global.avaya.com>

Just figured out the error was in the protocol. When changed to TCP, it is connected. How do I make it work for SSL instead?

Thank you for the help. I appreciate it.

-----Original Message-----
From: Justin Pettit [mailto:jpettit at nicira.com] 
Sent: Tuesday, July 28, 2015 12:04 PM
To: Tandulwadkar, Sanket Ravindra (Sanket Ravindra)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] is_connected parameter absent: 2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms timeout at lib/ovsdb-idl.c:1354


> On Jul 27, 2015, at 10:05 AM, Tandulwadkar, Sanket Ravindra (Sanket Ravindra) <standulwadka at avaya.com> wrote:
>  
> sanket at sanket-ubuntu-ovs:~$ sudo ovs-vsctl show
> cdf33b4e-420b-434d-87ba-d0e2183c9d47
>     Bridge "br0"
>         Controller "ssl:172.31.1.2:6633"
>         Port "eth1"
>             Interface "eth1"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>     ovs_version: "2.3.1"
> sanket at sanket-ubuntu-ovs:
>  
> Why can I not see the is_connected parameter? Am I missing something?

That's just a summary with certain fields.  You should see it if you run "ovs-vsctl list controller".

--Justin



From standulwadka at avaya.com  Tue Jul 28 09:26:21 2015
From: standulwadka at avaya.com (Tandulwadkar, Sanket Ravindra (Sanket Ravindra))
Date: Tue, 28 Jul 2015 16:26:21 +0000
Subject: [ovs-discuss] is_connected parameter absent:
 2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms timeout at
 lib/ovsdb-idl.c:1354
In-Reply-To: <7EB44382-4EB8-41FB-944F-29B7B8BC19F9@nicira.com>
References: <9CE18184B620BC45BF38C3D5361BCDA802BD68@AZ-US1EXMB01.global.avaya.com>
 <6A0F35D6-058E-41B9-8A95-911FD508CCAC@nicira.com>
 <9CE18184B620BC45BF38C3D5361BCDA802BE82@AZ-US1EXMB01.global.avaya.com>
 <7EB44382-4EB8-41FB-944F-29B7B8BC19F9@nicira.com>
Message-ID: <9CE18184B620BC45BF38C3D5361BCDA802BEB1@AZ-US1EXMB01.global.avaya.com>

The OvS log suggest connection refused.

2015-07-28T11:50:22.459Z|11536|vlog|INFO|opened log file /var/log/openvswitch/ovs-vswitchd.log
2015-07-28T11:50:22.890Z|11537|rconn|WARN|br0<->ssl:172.31.1.2:6633: connection dropped (Connection refused)
2015-07-28T11:50:30.890Z|11538|rconn|WARN|br0<->ssl:172.31.1.2:6633: connection dropped (Connection refused)
2015-07-28T11:50:38.891Z|11539|rconn|WARN|br0<->ssl:172.31.1.2:6633: connection dropped (Connection refused)
2015-07-28T11:50:46.891Z|11540|rconn|WARN|br0<->ssl:172.31.1.2:6633: connection dropped (Connection refused)
2015-07-28T11:50:54.890Z|11541|rconn|WARN|br0<->ssl:172.31.1.2:6633: connection dropped (Connection refused)
2015-07-28T11:50:55.890Z|11542|fail_open|INFO|Still in fail-open mode after 73520 seconds disconnected from controller
2015-07-28T11:51:02.890Z|11543|rconn|WARN|br0<->ssl:172.31.1.2:6633: connection dropped (Connection refused)
2015-07-28T11:51:10.891Z|11544|rconn|WARN|br0<->ssl:172.31.1.2:6633: connection dropped (Connection refused)
2015-07-28T11:51:18.891Z|11545|rconn|WARN|br0<->ssl:172.31.1.2:6633: connection dropped (Connection refused)
2015-07-28T11:51:26.890Z|11546|rconn|WARN|br0<->ssl:172.31.1.2:6633: connection dropped (Connection refused)

Would that be an issue with the controller?

I checked the SSL client part. It says connected.

sanket at sanket-ubuntu-ovs:~$ openssl s_client -connect 172.31.1.2:6633
CONNECTED(00000003)
140381499594384:error:140770FC:SSL routines:SSL23_GET_SERVER_HELLO:unknown protocol:s23_clnt.c:795:
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 7 bytes and written 295 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
---


>From what I can understand. But no certificates available.


Regards,
Sanket

-----Original Message-----
From: Justin Pettit [mailto:jpettit at nicira.com] 
Sent: Tuesday, July 28, 2015 12:17 PM
To: Tandulwadkar, Sanket Ravindra (Sanket Ravindra)
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] is_connected parameter absent: 2015-07-27T16:59:41Z|00016|poll_loop|DBG|wakeup due to 0-ms timeout at lib/ovsdb-idl.c:1354


> On Jul 28, 2015, at 9:09 AM, Tandulwadkar, Sanket Ravindra (Sanket Ravindra) <standulwadka at avaya.com> wrote:
> 
> Hello Justin,
> 
> Thank you for the tip. I did run that, and I could see that its set to false.
> 
> sanket at sanket-ubuntu-ovs:~$ sudo ovs-vsctl list controller
> _uuid               : 5236a306-4ec2-4ee8-b554-e09d42ecc1fc
> connection_mode     : []
> controller_burst_limit: []
> controller_rate_limit: []
> enable_async_messages: []
> external_ids        : {}
> inactivity_probe    : []
> is_connected        : false
> local_gateway       : []
> local_ip            : []
> local_netmask       : []
> max_backoff         : []
> other_config        : {}
> role                : other
> status              : {last_error="Protocol error", sec_since_disconnect="0", state=BACKOFF}
> target              : "ssl:172.31.1.2:6633"
> 
> But on pinging the same target I am able to receive packets.
> 
> PING 172.31.1.2 (172.31.1.2) 56(84) bytes of data.
> 64 bytes from 172.31.1.2: icmp_seq=1 ttl=64 time=0.456 ms
> 64 bytes from 172.31.1.2: icmp_seq=2 ttl=64 time=0.156 ms
> 64 bytes from 172.31.1.2: icmp_seq=3 ttl=64 time=0.177 ms ^C
> --- 172.31.1.2 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 1998ms rtt 
> min/avg/max/mdev = 0.156/0.263/0.456/0.136 ms 
> sanket at sanket-ubuntu-ovs:~$
> 
> sanket at sanket-ubuntu-odl:~$ ping 172.31.1.1 PING 172.31.1.1 
> (172.31.1.1) 56(84) bytes of data.
> 64 bytes from 172.31.1.1: icmp_seq=1 ttl=64 time=0.467 ms
> 64 bytes from 172.31.1.1: icmp_seq=2 ttl=64 time=0.185 ms
> 64 bytes from 172.31.1.1: icmp_seq=3 ttl=64 time=0.212 ms ^C
> --- 172.31.1.1 ping statistics ---
> 3 packets transmitted, 3 received, 0% packet loss, time 1998ms rtt 
> min/avg/max/mdev = 0.185/0.288/0.467/0.127 ms 
> sanket at sanket-ubuntu-odl:~$
> 
> My ODL controller iss on 172.31.1.2 and OvS is running on 172.31.1.1
> 
> Am I missing something here?

It's reporting a "Protocol error" in the "status" column.  Have you looked at your OVS logs to see if there are any logs?  You might try connecting to your controller with s_client to make sure that SSL is configure properly.

--Justin



From jpettit at nicira.com  Tue Jul 28 15:45:43 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 28 Jul 2015 15:45:43 -0700
Subject: [ovs-discuss] when ovs-2.4.0 release ?
In-Reply-To: <55AFA151.8020809@huawei.com>
References: <55AFA151.8020809@huawei.com>
Message-ID: <340FFC96-9D5E-4C75-9368-C78B81EA7ECF@nicira.com>


> On Jul 22, 2015, at 6:57 AM, yinpeijun <yinpeijun at huawei.com> wrote:
> 
>   Hi all， 
>         In OPNFV community I saw the ovs-2.4 trend to release at the end of August，is that really?

Mid to end of August seems likely.

> And in the maillist of ovs discuss say ovs-2.4 will not be a LTS ? 

Correct.

>         If that is true, what will be the next LTS release except ovs-2.3 and what is the plan ?

It will probably be the release after 2.4, but that hasn't been definitely decided yet.

--Justin



From abhishekv.verma at gmail.com  Tue Jul 28 17:02:59 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Wed, 29 Jul 2015 05:32:59 +0530
Subject: [ovs-discuss] OVS -- Linux interaction
In-Reply-To: <CAEP_g=-5Gj1SLMvaFCD2-ZaU2dTb=YGPTn5H4p2SvL04w=d89w@mail.gmail.com>
References: <CADDmorTr+a38U-hc48DDOKsrj+ua7AdOCk3=sC17kRYe76+Zww@mail.gmail.com>
 <CAEP_g=-5Gj1SLMvaFCD2-ZaU2dTb=YGPTn5H4p2SvL04w=d89w@mail.gmail.com>
Message-ID: <CADDmorTuLjvvcG5X23Sxuhz6Naa07RND+xNjoyG66P77xFbgBg@mail.gmail.com>

Thanks Jesse.

How does this work when OVS is running in the user space along with DPDK.
Does OVS again send packets to Linux stack for forwarding? I thought the
whole point there was NOT to involve the Linux stack.

Asking this since i thought that since eth0 is a part of the OVS bridge,
its OVS that actually frames the entire packet and sends it out.

Thanks, Abhishek


> It does not make sense to have eth0 in the same bridge as the VXLAN
> port since they are not in the same network segment (encapsulated vs.
> not). OVS simply sends tunneled packets as IP to the Linux stack,
> similar to any other application. These packets do not re-enter OVS
> unless there is another bridge that is in the normal Linux forwarding
> path.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150729/c09f742d/attachment.html>

From jesse at nicira.com  Tue Jul 28 17:39:44 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 28 Jul 2015 17:39:44 -0700
Subject: [ovs-discuss] OVS -- Linux interaction
In-Reply-To: <CADDmorTuLjvvcG5X23Sxuhz6Naa07RND+xNjoyG66P77xFbgBg@mail.gmail.com>
References: <CADDmorTr+a38U-hc48DDOKsrj+ua7AdOCk3=sC17kRYe76+Zww@mail.gmail.com>
 <CAEP_g=-5Gj1SLMvaFCD2-ZaU2dTb=YGPTn5H4p2SvL04w=d89w@mail.gmail.com>
 <CADDmorTuLjvvcG5X23Sxuhz6Naa07RND+xNjoyG66P77xFbgBg@mail.gmail.com>
Message-ID: <CAEP_g=8dH09+FhTnE1zDNOC27SKeLgh3Esmc6W=rfJrvTRbTug@mail.gmail.com>

The DPDK path operates differently - the kernel stack in not invoked.
In that case, eth0 does need to be attached to OVS but, again, not in
the same bridge. OVS will sync the routing table from the kernel but
otherwise implements ARP, etc. internally and retains control of the
packet until it is sent out on the physical interface.

On Tue, Jul 28, 2015 at 5:02 PM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Thanks Jesse.
>
> How does this work when OVS is running in the user space along with DPDK.
> Does OVS again send packets to Linux stack for forwarding? I thought the
> whole point there was NOT to involve the Linux stack.
>
> Asking this since i thought that since eth0 is a part of the OVS bridge, its
> OVS that actually frames the entire packet and sends it out.
>
> Thanks, Abhishek
>
>>
>> It does not make sense to have eth0 in the same bridge as the VXLAN
>> port since they are not in the same network segment (encapsulated vs.
>> not). OVS simply sends tunneled packets as IP to the Linux stack,
>> similar to any other application. These packets do not re-enter OVS
>> unless there is another bridge that is in the normal Linux forwarding
>> path.
>
>

From abhishekv.verma at gmail.com  Tue Jul 28 17:44:50 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Wed, 29 Jul 2015 06:14:50 +0530
Subject: [ovs-discuss] OVS -- Linux interaction
In-Reply-To: <CAEP_g=8dH09+FhTnE1zDNOC27SKeLgh3Esmc6W=rfJrvTRbTug@mail.gmail.com>
References: <CADDmorTr+a38U-hc48DDOKsrj+ua7AdOCk3=sC17kRYe76+Zww@mail.gmail.com>
 <CAEP_g=-5Gj1SLMvaFCD2-ZaU2dTb=YGPTn5H4p2SvL04w=d89w@mail.gmail.com>
 <CADDmorTuLjvvcG5X23Sxuhz6Naa07RND+xNjoyG66P77xFbgBg@mail.gmail.com>
 <CAEP_g=8dH09+FhTnE1zDNOC27SKeLgh3Esmc6W=rfJrvTRbTug@mail.gmail.com>
Message-ID: <CADDmorQhkPncJTU4uPrL6kfG+nhE15QV2u_MRMKi-ATasifsTA@mail.gmail.com>

So youre saying that in DPDK + OVS, OVS actually retains a copy of the
entire routing and ARP tables. Interesting, i hadnt realized that.

About eth0, my assumption was that a port over which a packet needs to be
sent out or received on MUST always be added to the OVS bridge. How can i
trap a packet arriving on eth0, if it has not been added to the OVS bridge?

Thanks, Abhishek

On Wed, Jul 29, 2015 at 6:09 AM, Jesse Gross <jesse at nicira.com> wrote:

> The DPDK path operates differently - the kernel stack in not invoked.
> In that case, eth0 does need to be attached to OVS but, again, not in
> the same bridge. OVS will sync the routing table from the kernel but
> otherwise implements ARP, etc. internally and retains control of the
> packet until it is sent out on the physical interface.
>
> On Tue, Jul 28, 2015 at 5:02 PM, Abhishek Verma
> <abhishekv.verma at gmail.com> wrote:
> > Thanks Jesse.
> >
> > How does this work when OVS is running in the user space along with DPDK.
> > Does OVS again send packets to Linux stack for forwarding? I thought the
> > whole point there was NOT to involve the Linux stack.
> >
> > Asking this since i thought that since eth0 is a part of the OVS bridge,
> its
> > OVS that actually frames the entire packet and sends it out.
> >
> > Thanks, Abhishek
> >
> >>
> >> It does not make sense to have eth0 in the same bridge as the VXLAN
> >> port since they are not in the same network segment (encapsulated vs.
> >> not). OVS simply sends tunneled packets as IP to the Linux stack,
> >> similar to any other application. These packets do not re-enter OVS
> >> unless there is another bridge that is in the normal Linux forwarding
> >> path.
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150729/455bd8da/attachment.html>

From abhishekv.verma at gmail.com  Tue Jul 28 18:04:44 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Wed, 29 Jul 2015 06:34:44 +0530
Subject: [ovs-discuss] OVS -- Linux interaction
In-Reply-To: <CADDmorQhkPncJTU4uPrL6kfG+nhE15QV2u_MRMKi-ATasifsTA@mail.gmail.com>
References: <CADDmorTr+a38U-hc48DDOKsrj+ua7AdOCk3=sC17kRYe76+Zww@mail.gmail.com>
 <CAEP_g=-5Gj1SLMvaFCD2-ZaU2dTb=YGPTn5H4p2SvL04w=d89w@mail.gmail.com>
 <CADDmorTuLjvvcG5X23Sxuhz6Naa07RND+xNjoyG66P77xFbgBg@mail.gmail.com>
 <CAEP_g=8dH09+FhTnE1zDNOC27SKeLgh3Esmc6W=rfJrvTRbTug@mail.gmail.com>
 <CADDmorQhkPncJTU4uPrL6kfG+nhE15QV2u_MRMKi-ATasifsTA@mail.gmail.com>
Message-ID: <CADDmorSw27nrUtWuv0n0WKnhopJaKUE=jKKc0P=zZwJpLSvjMw@mail.gmail.com>

Jesse,

Can i do the following:

I create an OVS bridge with only 2 VXLAN tunnels. So, i have two virtual
ports in my bridge.

I have eth0, over which i physically recieve the VXLAN packets, and i dont
add that to OVS.

Is this configuration possible? I thought that i ought to add eth0 also to
my bridge.

Thanks, Abhishek

On Wed, Jul 29, 2015 at 6:14 AM, Abhishek Verma <abhishekv.verma at gmail.com>
wrote:

> So youre saying that in DPDK + OVS, OVS actually retains a copy of the
> entire routing and ARP tables. Interesting, i hadnt realized that.
>
> About eth0, my assumption was that a port over which a packet needs to be
> sent out or received on MUST always be added to the OVS bridge. How can i
> trap a packet arriving on eth0, if it has not been added to the OVS bridge?
>
> Thanks, Abhishek
>
> On Wed, Jul 29, 2015 at 6:09 AM, Jesse Gross <jesse at nicira.com> wrote:
>
>> The DPDK path operates differently - the kernel stack in not invoked.
>> In that case, eth0 does need to be attached to OVS but, again, not in
>> the same bridge. OVS will sync the routing table from the kernel but
>> otherwise implements ARP, etc. internally and retains control of the
>> packet until it is sent out on the physical interface.
>>
>> On Tue, Jul 28, 2015 at 5:02 PM, Abhishek Verma
>> <abhishekv.verma at gmail.com> wrote:
>> > Thanks Jesse.
>> >
>> > How does this work when OVS is running in the user space along with
>> DPDK.
>> > Does OVS again send packets to Linux stack for forwarding? I thought the
>> > whole point there was NOT to involve the Linux stack.
>> >
>> > Asking this since i thought that since eth0 is a part of the OVS
>> bridge, its
>> > OVS that actually frames the entire packet and sends it out.
>> >
>> > Thanks, Abhishek
>> >
>> >>
>> >> It does not make sense to have eth0 in the same bridge as the VXLAN
>> >> port since they are not in the same network segment (encapsulated vs.
>> >> not). OVS simply sends tunneled packets as IP to the Linux stack,
>> >> similar to any other application. These packets do not re-enter OVS
>> >> unless there is another bridge that is in the normal Linux forwarding
>> >> path.
>> >
>> >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150729/911e905a/attachment-0001.html>

From jesse at nicira.com  Tue Jul 28 18:13:06 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 28 Jul 2015 18:13:06 -0700
Subject: [ovs-discuss] OVS -- Linux interaction
In-Reply-To: <CADDmorSw27nrUtWuv0n0WKnhopJaKUE=jKKc0P=zZwJpLSvjMw@mail.gmail.com>
References: <CADDmorTr+a38U-hc48DDOKsrj+ua7AdOCk3=sC17kRYe76+Zww@mail.gmail.com>
 <CAEP_g=-5Gj1SLMvaFCD2-ZaU2dTb=YGPTn5H4p2SvL04w=d89w@mail.gmail.com>
 <CADDmorTuLjvvcG5X23Sxuhz6Naa07RND+xNjoyG66P77xFbgBg@mail.gmail.com>
 <CAEP_g=8dH09+FhTnE1zDNOC27SKeLgh3Esmc6W=rfJrvTRbTug@mail.gmail.com>
 <CADDmorQhkPncJTU4uPrL6kfG+nhE15QV2u_MRMKi-ATasifsTA@mail.gmail.com>
 <CADDmorSw27nrUtWuv0n0WKnhopJaKUE=jKKc0P=zZwJpLSvjMw@mail.gmail.com>
Message-ID: <CAEP_g=-4uroaWCcguAC1U0M0ZxLLqEA95vTi-smCFSX+NK=How@mail.gmail.com>

Yes - for the Linux kernel datapath; there are many tutorials on
configuring VXLAN on OVS online, please take a look at one of these
for information on how to set up ports.

As I mentioned before, with the kernel module OVS receives packets
through the Linux IP stack, which means the physical device does not
to be attached to OVS. With DPDK, the interface needs to be attached
but in a different bridge - there is an internal hook to allow tunnel
packets to traverse between the two.

On Tue, Jul 28, 2015 at 6:04 PM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Jesse,
>
> Can i do the following:
>
> I create an OVS bridge with only 2 VXLAN tunnels. So, i have two virtual
> ports in my bridge.
>
> I have eth0, over which i physically recieve the VXLAN packets, and i dont
> add that to OVS.
>
> Is this configuration possible? I thought that i ought to add eth0 also to
> my bridge.
>
> Thanks, Abhishek
>
> On Wed, Jul 29, 2015 at 6:14 AM, Abhishek Verma <abhishekv.verma at gmail.com>
> wrote:
>>
>> So youre saying that in DPDK + OVS, OVS actually retains a copy of the
>> entire routing and ARP tables. Interesting, i hadnt realized that.
>>
>> About eth0, my assumption was that a port over which a packet needs to be
>> sent out or received on MUST always be added to the OVS bridge. How can i
>> trap a packet arriving on eth0, if it has not been added to the OVS bridge?
>>
>> Thanks, Abhishek
>>
>> On Wed, Jul 29, 2015 at 6:09 AM, Jesse Gross <jesse at nicira.com> wrote:
>>>
>>> The DPDK path operates differently - the kernel stack in not invoked.
>>> In that case, eth0 does need to be attached to OVS but, again, not in
>>> the same bridge. OVS will sync the routing table from the kernel but
>>> otherwise implements ARP, etc. internally and retains control of the
>>> packet until it is sent out on the physical interface.
>>>
>>> On Tue, Jul 28, 2015 at 5:02 PM, Abhishek Verma
>>> <abhishekv.verma at gmail.com> wrote:
>>> > Thanks Jesse.
>>> >
>>> > How does this work when OVS is running in the user space along with
>>> > DPDK.
>>> > Does OVS again send packets to Linux stack for forwarding? I thought
>>> > the
>>> > whole point there was NOT to involve the Linux stack.
>>> >
>>> > Asking this since i thought that since eth0 is a part of the OVS
>>> > bridge, its
>>> > OVS that actually frames the entire packet and sends it out.
>>> >
>>> > Thanks, Abhishek
>>> >
>>> >>
>>> >> It does not make sense to have eth0 in the same bridge as the VXLAN
>>> >> port since they are not in the same network segment (encapsulated vs.
>>> >> not). OVS simply sends tunneled packets as IP to the Linux stack,
>>> >> similar to any other application. These packets do not re-enter OVS
>>> >> unless there is another bridge that is in the normal Linux forwarding
>>> >> path.
>>> >
>>> >
>>
>>
>

From abhishekv.verma at gmail.com  Wed Jul 29 17:26:29 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Thu, 30 Jul 2015 05:56:29 +0530
Subject: [ovs-discuss] Drops in OVS
Message-ID: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>

Hi,

I have 3 switches connected via OVS like this:

R1 -- R2 -- R3

I am doing an iperf test using TCP between R1 and R3. R1, R2 and R3 are
spread out geographically and i use a VXLAN tunnel to connect them.

iperf test shows me considerable packet losses. However, ovs-vsctl get
interface stats is showing me zero losses on all the legs.

This means that OVS for example on R2 forwarded all the packets that it
recieved on the VXLAN tunnel from R1 to R3. Is my assumption correct. This
means that the packet losses reported by iperf are the packet losses in the
network and not because of OVS.

Besides interface statistics is there any other way to get packet drops by
OVS?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/62008578/attachment.html>

From jpettit at nicira.com  Thu Jul 30 00:02:42 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 30 Jul 2015 00:02:42 -0700
Subject: [ovs-discuss] SPF errors for this mailing list
In-Reply-To: <9BE27BE7-F092-4C54-ACCD-767EB34AECDE@nicira.com>
References: <CAFGv8b8OiA9StnDuEZ_8cQ8vfYxW5w4mqz85=iFF=_0qjBQw9A@mail.gmail.com>
 <9BE27BE7-F092-4C54-ACCD-767EB34AECDE@nicira.com>
Message-ID: <801D55AA-057A-4531-8AAC-C745E5678EE4@nicira.com>

Hi, Adam.  As of a few hours ago, the SPF record should be correct.  Can you check to see if it solved the problem for you?  The TTL is around an hour, so it should be caught up, but it can sometimes take longer to propagate.

--Justin


> On Jul 17, 2015, at 10:15 AM, Justin Pettit <jpettit at nicira.com> wrote:
> 
> Yes, we read it.  :-)  Thank you very much for the report!  I assume that will solve a lot of the questions people have been having.  We're tracking down the appropriate people to update the record, so it may take us a couple of days.  I'll follow up when I've heard something.
> 
> --Justin
> 
> 
>> On Jul 17, 2015, at 8:44 AM, Adam Thompson <athompson at avant.ca> wrote:
>> 
>> I'm noticing that *every* *single* *email* from this list gets dumped into Google Mail's Spam folder, because of a typo in the SPF record.
>> 
>> Received-SPF: fail (google.com: domain of discuss-bounces at openvswitch.org does not designate 2600:3c00::f03c:91ff:fe6e:bdf7 as permitted sender) client-ip=​​2600:3c00::f03c:91ff:fe6e:bdf7;
>> 
>> The SPF record for openvswitch.org contains "ipv6:2600:3c00::f03c:91ff:fe6e:bdf7", but the correct syntax is "ip6:", not "ipv6:".
>> 
>> Can someone make that minor syntax correction in the DNS entry?  I'm hoping that someone reads discuss...?
>> 
>> 
>> 	Adam Thompson
>> Senior Systems Administrator
>> voice: 204.789.9596 x24 | email: athompson at avant.ca | web: avant.ca
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
> 


From vbadiger at avaya.com  Thu Jul 30 04:57:18 2015
From: vbadiger at avaya.com (Badiger, Vishwanath (Vishwa))
Date: Thu, 30 Jul 2015 11:57:18 +0000
Subject: [ovs-discuss] Is it possible to clear statistics of bridge ?
In-Reply-To: <7712B9DB39307A41B020D8182A22B13C446702EC@AZ-FFEXMB04.global.avaya.com>
References: <7712B9DB39307A41B020D8182A22B13C446702EC@AZ-FFEXMB04.global.avaya.com>
Message-ID: <7712B9DB39307A41B020D8182A22B13C44670B26@AZ-FFEXMB04.global.avaya.com>

I tried "ovs-vsctl clear Interface br0 statistics" and this command does not clear statistics. But we can use "ovs-vsctl get Interface br0 statistics" to get br0 statistics.
Is there any other command that can clear bridge statistics ?


Regards,
Vishwa.

From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Badiger, Vishwanath (Vishwa)
Sent: Tuesday, July 28, 2015 4:52 PM
To: discuss at openvswitch.org
Subject: [ovs-discuss] Is it possible to clear statistics of bridge ?

Hi All,
Is it possible to clear statistics of bridge using any of ovs commands ? If yes, which command and how can we do it ?
I am searching for such command in OVS documents, but not finding such information. Would like to know the reason if clearing statistics is not supported by OVS.
Thanks in advance.


Regards,
Vishwa.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/ae3a16d8/attachment.html>

From fbl at sysclose.org  Thu Jul 30 05:48:45 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Thu, 30 Jul 2015 09:48:45 -0300
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
Message-ID: <20150730124845.GA2310@x240.home>

On Thu, Jul 30, 2015 at 05:56:29AM +0530, Abhishek Verma wrote:
> Hi,
> 
> I have 3 switches connected via OVS like this:
> 
> R1 -- R2 -- R3
> 
> I am doing an iperf test using TCP between R1 and R3. R1, R2 and R3 are
> spread out geographically and i use a VXLAN tunnel to connect them.
> 
> iperf test shows me considerable packet losses. However, ovs-vsctl get
> interface stats is showing me zero losses on all the legs.
> 
> This means that OVS for example on R2 forwarded all the packets that it
> recieved on the VXLAN tunnel from R1 to R3. Is my assumption correct. This
> means that the packet losses reported by iperf are the packet losses in the
> network and not because of OVS.
> 
> Besides interface statistics is there any other way to get packet drops by
> OVS?

You might have drops at the NIC level, so check ethtool -S output or
bad flows  which for some reason is dropping packets too.

fbl


From nasir.mahmood at gmail.com  Thu Jul 30 05:49:06 2015
From: nasir.mahmood at gmail.com (Nasir Mahmood)
Date: Thu, 30 Jul 2015 05:49:06 -0700
Subject: [ovs-discuss] OpenStack -- Add a Layer2 Device between two VMs
Message-ID: <CACnWpYOy9wGN0No8m-wTXo=EXOksRiLV9oTNYfG9TqtpMwpMOg@mail.gmail.com>

Hi,


I'm looking for an external Layer2 Device integration within the OpenStack.
This Layer2 device can have only 2 physical cable 1 for input and 1 for
output to enable a network interception and then blocking the traffic based
on the analysis.

The whole of the OpenStack setup is comprised of 3 VMs itself. Controller +
Compute1 + Network. so far the instances are able to do what I'm looking
for but without network interception by my physical board.

Here is the pic.

VM --> Layer2 Device --> VM2 +VM3


This Layer2 device has to be physically connected which I have achieved by
exposing the two port net work card to compute node and then adding it a
new bridge so that the traffic should pass through it solely.

PS. I can't assign IP addresses to my Layer2 Device's network ports. its a
dumb device.


Any idea how I can create a new bridge and then embed the external device
on it .


OR

Is it possible to send the Layer2 over IP to a Cisco Switch's 2 ports so
that I can send and recieve data from there in a mode which should enable
 network blocking by an external device.


PS. I can't assign IP addresses to my Layer2 Device's network ports. its a
dumb device.







Regards,



-- 
Nasir Mahmood
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/650635fd/attachment-0001.html>

From athompson at avant.ca  Thu Jul 30 08:47:12 2015
From: athompson at avant.ca (Adam Thompson)
Date: Thu, 30 Jul 2015 10:47:12 -0500
Subject: [ovs-discuss] discuss Digest, Vol 73, Issue 97
In-Reply-To: <mailman.2643.1438260571.23826.discuss@openvswitch.org>
References: <mailman.2643.1438260571.23826.discuss@openvswitch.org>
Message-ID: <CAFGv8b9jrL=24fZnmh8oF5CD+Ddj93V2xarq_gg6zoieQ5adrQ@mail.gmail.com>

I can confirm that Google now adds an SPF=pass header, so all looks good!
-Adam


  [image: Avant logo] *Adam Thompson*
Senior Systems Administrator
*voice:* 204.789.9596 x24 | *email:* athompson at avant.ca | *web:* avant.ca

On Thu, Jul 30, 2015 at 7:49 AM, <discuss-request at openvswitch.org> wrote:

> Message: 2
> Date: Thu, 30 Jul 2015 00:02:42 -0700
> From: Justin Pettit <jpettit at nicira.com>
> To: Adam Thompson <athompson at avant.ca>
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] SPF errors for this mailing list
> Message-ID: <801D55AA-057A-4531-8AAC-C745E5678EE4 at nicira.com>
> Content-Type: text/plain; charset=utf-8
>
> Hi, Adam.  As of a few hours ago, the SPF record should be correct.  Can
> you check to see if it solved the problem for you?  The TTL is around an
> hour, so it should be caught up, but it can sometimes take longer to
> propagate.
>
> --Justin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/78e3bba4/attachment.html>

From jpettit at nicira.com  Thu Jul 30 08:49:05 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Thu, 30 Jul 2015 08:49:05 -0700
Subject: [ovs-discuss] discuss Digest, Vol 73, Issue 97
In-Reply-To: <CAFGv8b9jrL=24fZnmh8oF5CD+Ddj93V2xarq_gg6zoieQ5adrQ@mail.gmail.com>
References: <mailman.2643.1438260571.23826.discuss@openvswitch.org>
 <CAFGv8b9jrL=24fZnmh8oF5CD+Ddj93V2xarq_gg6zoieQ5adrQ@mail.gmail.com>
Message-ID: <5EDE7398-63B9-45AD-B9EC-2083B61B5868@nicira.com>

Great!  Thanks again for tracking down the issue!

--Justin


> On Jul 30, 2015, at 8:47 AM, Adam Thompson <athompson at avant.ca> wrote:
> 
> I can confirm that Google now adds an SPF=pass header, so all looks good!
> -Adam
> 
> 
> 	Adam Thompson
> Senior Systems Administrator
> voice: 204.789.9596 x24 | email: athompson at avant.ca | web: avant.ca
> 
> On Thu, Jul 30, 2015 at 7:49 AM, <discuss-request at openvswitch.org> wrote:
> Message: 2
> Date: Thu, 30 Jul 2015 00:02:42 -0700
> From: Justin Pettit <jpettit at nicira.com>
> To: Adam Thompson <athompson at avant.ca>
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] SPF errors for this mailing list
> Message-ID: <801D55AA-057A-4531-8AAC-C745E5678EE4 at nicira.com>
> Content-Type: text/plain; charset=utf-8
> 
> Hi, Adam.  As of a few hours ago, the SPF record should be correct.  Can you check to see if it solved the problem for you?  The TTL is around an hour, so it should be caught up, but it can sometimes take longer to propagate.
> 
> --Justin
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From mita.cokic at uns.ac.rs  Thu Jul 30 09:04:22 2015
From: mita.cokic at uns.ac.rs (Mita Cokic)
Date: Thu, 30 Jul 2015 18:04:22 +0200
Subject: [ovs-discuss] Combining traffic policing and shaping performance
	question
Message-ID: <006501d0cae1$66209c90$3261d5b0$@uns.ac.rs>

Regards,

 

I am trying to test QoS in mininet environment using open vswitch with two
interfaces - s1-eth1 and s2-eth2.

 

I have limited links to 10Mbps and added QoS queue with 2MB limit for both
interfaces:

ovs-vsctl set interface s1-eth1 ingress_policing_rate=1000

ovs-vsctl set interface s1-eth1 ingress_policing_burst=100

ovs-vsctl set port s1-eth1 qos=@newqos -- --id=@newqos create qos
type=linux-htb queues=0=@q0 -- --id=@q0 create queue
other-config:min-rate=2000000 other-config:max-rate=2000000

 

When I test network bandwidth with iperf (s1-eth1 ingress, s1-eth2 egress) I
get maximum bw ~1Mbps.

 

When I test bw without setting ingress_policing_rate and
ingress_policing_burst I get 2Mbps as expected.

 

I don't understand why I don't get pre-configured bandwidth limiting
policing rate and queues together. 

 

Can someone help me understand this behavior or direct me to documentation I
can read to understand this? Did I misconfigure the switch?

 

I have tried searching a solution but with no results.

 

Regards,

Mita

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/705264c0/attachment.html>

From blp at nicira.com  Thu Jul 30 09:17:57 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 30 Jul 2015 09:17:57 -0700
Subject: [ovs-discuss] Is it possible to clear statistics of bridge ?
In-Reply-To: <7712B9DB39307A41B020D8182A22B13C44670B26@AZ-FFEXMB04.global.avaya.com>
References: <7712B9DB39307A41B020D8182A22B13C446702EC@AZ-FFEXMB04.global.avaya.com>
 <7712B9DB39307A41B020D8182A22B13C44670B26@AZ-FFEXMB04.global.avaya.com>
Message-ID: <20150730161757.GA17188@nicira.com>

On Thu, Jul 30, 2015 at 11:57:18AM +0000, Badiger, Vishwanath (Vishwa) wrote:
> I tried "ovs-vsctl clear Interface br0 statistics" and this command does not clear statistics. But we can use "ovs-vsctl get Interface br0 statistics" to get br0 statistics.
> Is there any other command that can clear bridge statistics ?

There is no way to zero interface statistics.

From jschaeffer0922 at gmail.com  Thu Jul 30 14:08:05 2015
From: jschaeffer0922 at gmail.com (Joshua Schaeffer)
Date: Thu, 30 Jul 2015 15:08:05 -0600
Subject: [ovs-discuss] Setting up host bridge with VLAN tags
Message-ID: <55BA9235.8080601@gmail.com>

I'm trying to create a bridge with openvswitch on a new physical system 
I have that I'm planing to connect LXC's to but can't get the bridge to 
connect to my network. I installed openvswitch from the Ubuntu 
repositories without any issue. I have my system connected to my switch 
that allows tagged VLAN 31 traffic. The VLAN network is 10.1.10.32/27

I've been following the openvswitch-switch.README.Debian document 
(specifically example 4). Here is what I've done on the system:

cat /etc/network/interfaces
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
allow-br0 vlan31
iface vlan31 inet manual
	ovs_bridge br0
	ovs_type OVSIntPort
	ovs_options tag=31
	ovs_extra set interface ${IFACE} external-ids:iface-id=$(hostname -s)

# Bridge device
allow-ovs br0
iface br0 inet static
	ovs_type OVSBridge
	ovs_ports vlan31
	address 10.1.10.52
	netmask 255.255.255.224
	gateway 10.1.10.33
	dns-servers 10.1.10.6

I can bring up the bridge successfully and ifconfig shows the correct 
information:

sudo ifconfig
br0       Link encap:Ethernet  HWaddr ca:75:db:04:e7:41
           inet addr:10.1.10.52  Bcast:10.1.10.63  Mask:255.255.255.224
           inet6 addr: fe80::c875:dbff:fe04:e741/64 Scope:Link
           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
           RX packets:7 errors:0 dropped:1 overruns:0 frame:0
           TX packets:17 errors:0 dropped:0 overruns:0 carrier:0
           collisions:0 txqueuelen:0
           RX bytes:558 (558.0 B)  TX bytes:1026 (1.0 KB)

lo        Link encap:Local Loopback
           inet addr:127.0.0.1  Mask:255.0.0.0
           inet6 addr: ::1/128 Scope:Host
           UP LOOPBACK RUNNING  MTU:65536  Metric:1
           RX packets:3773 errors:0 dropped:0 overruns:0 frame:0
           TX packets:3773 errors:0 dropped:0 overruns:0 carrier:0
           collisions:0 txqueuelen:0
           RX bytes:305456 (305.4 KB)  TX bytes:305456 (305.4 KB)

vlan31    Link encap:Ethernet  HWaddr 96:d5:8a:3f:6f:66
           inet6 addr: fe80::94d5:8aff:fe3f:6f66/64 Scope:Link
           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
           TX packets:8 errors:0 dropped:0 overruns:0 carrier:0
           collisions:0 txqueuelen:0
           RX bytes:0 (0.0 B)  TX bytes:648 (648.0 B)

sudo ovs-vsctl show
430caed4-a66f-4577-96eb-48e7841905e8
     Bridge "br0"
         Port "br0"
             Interface "br0"
                 type: internal
         Port "vlan31"
             tag: 31
             Interface "vlan31"
                 type: internal
     ovs_version: "2.3.1"

However I can't ping the gateway:

ping 10.1.10.33
PING 10.1.10.33 (10.1.10.33) 56(84) bytes of data.
 From 10.1.10.52 icmp_seq=1 Destination Host Unreachable
 From 10.1.10.52 icmp_seq=2 Destination Host Unreachable
 From 10.1.10.52 icmp_seq=3 Destination Host Unreachable

--- 10.1.10.33 ping statistics ---
4 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2999ms
pipe 3

I know the NIC, VLAN, and switch are operating correctly. If just use 
the vlan program to configure eth0 directly to send tagged VLAN traffic 
I can reach the outside world.

Thanks,
Joshua

From abhishekv.verma at gmail.com  Thu Jul 30 17:08:12 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 31 Jul 2015 05:38:12 +0530
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <20150730124845.GA2310@x240.home>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
 <20150730124845.GA2310@x240.home>
Message-ID: <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>

Thanks Flavio.

I installed very specific flow-rules and checked the counter values. That
way i checked the segment where there were losses.

My question is this:

When i add a flow rule which matches on some source IP, dest IP and i give
a output port as an action, then if i see the packet counter incrementing
then can i be sure that the packet was successfully sent out by OVS?

Is the counter incremented in the ingress pipeline or the egress? That is,
is it possible that the counter was incremented, and then OVS later dropped
it because of some reason?

Thanks, Abhishek

On Thu, Jul 30, 2015 at 6:18 PM, Flavio Leitner <fbl at sysclose.org> wrote:

> On Thu, Jul 30, 2015 at 05:56:29AM +0530, Abhishek Verma wrote:
> > Hi,
> >
> > I have 3 switches connected via OVS like this:
> >
> > R1 -- R2 -- R3
> >
> > I am doing an iperf test using TCP between R1 and R3. R1, R2 and R3 are
> > spread out geographically and i use a VXLAN tunnel to connect them.
> >
> > iperf test shows me considerable packet losses. However, ovs-vsctl get
> > interface stats is showing me zero losses on all the legs.
> >
> > This means that OVS for example on R2 forwarded all the packets that it
> > recieved on the VXLAN tunnel from R1 to R3. Is my assumption correct.
> This
> > means that the packet losses reported by iperf are the packet losses in
> the
> > network and not because of OVS.
> >
> > Besides interface statistics is there any other way to get packet drops
> by
> > OVS?
>
> You might have drops at the NIC level, so check ethtool -S output or
> bad flows  which for some reason is dropping packets too.
>
> fbl
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150731/e85618bf/attachment.html>

From blp at nicira.com  Thu Jul 30 17:20:14 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 30 Jul 2015 17:20:14 -0700
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
 <20150730124845.GA2310@x240.home>
 <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>
Message-ID: <20150731002014.GA5647@nicira.com>

On Fri, Jul 31, 2015 at 05:38:12AM +0530, Abhishek Verma wrote:
> When i add a flow rule which matches on some source IP, dest IP and i give
> a output port as an action, then if i see the packet counter incrementing
> then can i be sure that the packet was successfully sent out by OVS?
> 
> Is the counter incremented in the ingress pipeline or the egress? That is,
> is it possible that the counter was incremented, and then OVS later dropped
> it because of some reason?

Flow counters means that the flow processed the packet, but that doesn't
guarantee that every action taken by the flow succeeded.  If the flow
outputs to 100 different ports, the counter will be incremented whether
0 or 100 or any other number of those outputs were successful.

From abhishekv.verma at gmail.com  Thu Jul 30 17:30:47 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 31 Jul 2015 06:00:47 +0530
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <20150731002014.GA5647@nicira.com>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
 <20150730124845.GA2310@x240.home>
 <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>
 <20150731002014.GA5647@nicira.com>
Message-ID: <CADDmorRR89dKxJ1VweCq177KiXnWtbjUoPchn9oSTeah0MP6UQ@mail.gmail.com>

Great. So, its an ingress counter then.

So how do i verify if the packet got dropped at the egress. In my case the
output is a single port. My counter increments, which means OVS will now
send the packet to the egress port. If the interface stats for the output
port show zero drops then can i assume that the packet was successfully
sent out?

Under what scenario can OVS drop packets in the egress pipeline? Assume
that the nexthop that the flow is pointing to is all correct, the nexthop
MAC is there, etc. Just line or two if you could tell me under what
circumstance can OVS drop a packet ..

Thanks, Abhishek

On Fri, Jul 31, 2015 at 5:50 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Jul 31, 2015 at 05:38:12AM +0530, Abhishek Verma wrote:
> > When i add a flow rule which matches on some source IP, dest IP and i
> give
> > a output port as an action, then if i see the packet counter incrementing
> > then can i be sure that the packet was successfully sent out by OVS?
> >
> > Is the counter incremented in the ingress pipeline or the egress? That
> is,
> > is it possible that the counter was incremented, and then OVS later
> dropped
> > it because of some reason?
>
> Flow counters means that the flow processed the packet, but that doesn't
> guarantee that every action taken by the flow succeeded.  If the flow
> outputs to 100 different ports, the counter will be incremented whether
> 0 or 100 or any other number of those outputs were successful.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150731/637b55de/attachment.html>

From blp at nicira.com  Thu Jul 30 17:57:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 30 Jul 2015 17:57:29 -0700
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <CADDmorRR89dKxJ1VweCq177KiXnWtbjUoPchn9oSTeah0MP6UQ@mail.gmail.com>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
 <20150730124845.GA2310@x240.home>
 <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>
 <20150731002014.GA5647@nicira.com>
 <CADDmorRR89dKxJ1VweCq177KiXnWtbjUoPchn9oSTeah0MP6UQ@mail.gmail.com>
Message-ID: <20150731005729.GB5647@nicira.com>

On Fri, Jul 31, 2015 at 06:00:47AM +0530, Abhishek Verma wrote:
> So how do i verify if the packet got dropped at the egress. In my case the
> output is a single port. My counter increments, which means OVS will now
> send the packet to the egress port. If the interface stats for the output
> port show zero drops then can i assume that the packet was successfully
> sent out?
> 
> Under what scenario can OVS drop packets in the egress pipeline? Assume
> that the nexthop that the flow is pointing to is all correct, the nexthop
> MAC is there, etc. Just line or two if you could tell me under what
> circumstance can OVS drop a packet ..

OVS wouldn't normally drop packets.  It would normally happen before or
after OVS.

OVS *can* drop packets at the kernel/user interface.  Those would show
up in "ovs-dpctl show" as "lost" packets.

Are you looking at the OVS vport stats or the stats via e.g. "ifconfig"?
Both are relevant.

From abhishekv.verma at gmail.com  Thu Jul 30 18:18:26 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 31 Jul 2015 06:48:26 +0530
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <20150731005729.GB5647@nicira.com>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
 <20150730124845.GA2310@x240.home>
 <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>
 <20150731002014.GA5647@nicira.com>
 <CADDmorRR89dKxJ1VweCq177KiXnWtbjUoPchn9oSTeah0MP6UQ@mail.gmail.com>
 <20150731005729.GB5647@nicira.com>
Message-ID: <CADDmorQQc6qApj8jEpwKsg5zwoPX3UB17LHDJ-yRNL--derP3w@mail.gmail.com>

Ben,


> OVS wouldn't normally drop packets.  It would normally happen before or
> after OVS.
>
> OVS *can* drop packets at the kernel/user interface.  Those would show
> up in "ovs-dpctl show" as "lost" packets.
>
> Are you looking at the OVS vport stats or the stats via e.g. "ifconfig"?
> Both are relevant.
>

I look at

root#ovs-vsctl get interface port-to-routerA statistics
{collisions=0, rx_bytes=2845224091, rx_crc_err=0, *rx_dropped=0*,
rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=2469921,
tx_bytes=1390987, *tx_dropped=0*, tx_errors=0, tx_packets=11200}
root#

and the ifconfig statistics.

root# ovs-dpctl show
system at ovs-system:
lookups: hit:50254324 missed:15221 *lost:4424*
flows: 0
port 0: ovs-system (internal)
port 1: br0 (internal)
port 2: port-to-routerA (gre: df_default=false, ttl=0)
root#

I just see *4424 *packets getting lost. What are these packets? Any idea
when would we lose them?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150731/ac91dcde/attachment.html>

From blp at nicira.com  Thu Jul 30 18:22:00 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 30 Jul 2015 18:22:00 -0700
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <CADDmorQQc6qApj8jEpwKsg5zwoPX3UB17LHDJ-yRNL--derP3w@mail.gmail.com>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
 <20150730124845.GA2310@x240.home>
 <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>
 <20150731002014.GA5647@nicira.com>
 <CADDmorRR89dKxJ1VweCq177KiXnWtbjUoPchn9oSTeah0MP6UQ@mail.gmail.com>
 <20150731005729.GB5647@nicira.com>
 <CADDmorQQc6qApj8jEpwKsg5zwoPX3UB17LHDJ-yRNL--derP3w@mail.gmail.com>
Message-ID: <20150731012200.GD5647@nicira.com>

On Fri, Jul 31, 2015 at 06:48:26AM +0530, Abhishek Verma wrote:
> > OVS wouldn't normally drop packets.  It would normally happen before or
> > after OVS.
> >
> > OVS *can* drop packets at the kernel/user interface.  Those would show
> > up in "ovs-dpctl show" as "lost" packets.
> >
> > Are you looking at the OVS vport stats or the stats via e.g. "ifconfig"?
> > Both are relevant.
> >
> 
> I look at
> 
> root#ovs-vsctl get interface port-to-routerA statistics
> {collisions=0, rx_bytes=2845224091, rx_crc_err=0, *rx_dropped=0*,
> rx_errors=0, rx_frame_err=0, rx_over_err=0, rx_packets=2469921,
> tx_bytes=1390987, *tx_dropped=0*, tx_errors=0, tx_packets=11200}
> root#
> 
> and the ifconfig statistics.
> 
> root# ovs-dpctl show
> system at ovs-system:
> lookups: hit:50254324 missed:15221 *lost:4424*
> flows: 0
> port 0: ovs-system (internal)
> port 1: br0 (internal)
> port 2: port-to-routerA (gre: df_default=false, ttl=0)
> root#
> 
> I just see *4424 *packets getting lost. What are these packets? Any idea
> when would we lose them?

"lost" means that a queue from the kernel to userspace overflowed.  It
would ordinarily happen if there was a big burst of packets that didn't
match in the kernel flow table.  Packets can also be lost this way if
OVS is stopped and restarted.

Since this is a GRE tunnel, packets can get lost in the kernel TCP/IP
stack GRE processing on ingress or egress, and that wouldn't show up in
any of these places.

From masri.sahri at gmail.com  Thu Jul 30 18:25:37 2015
From: masri.sahri at gmail.com (nor masri sahri)
Date: Fri, 31 Jul 2015 10:25:37 +0900
Subject: [ovs-discuss] Fwd: flow table priority
In-Reply-To: <CAFzAnhgAXzgUQFk=0s1HLQRbkBV0sG7Rt7XQCEYymqUYN8HBAw@mail.gmail.com>
References: <CAFzAnhgAXzgUQFk=0s1HLQRbkBV0sG7Rt7XQCEYymqUYN8HBAw@mail.gmail.com>
Message-ID: <CAFzAnhiUpmc+EmQXQH5aqHJ+rw_qsDM+pfVpiahQa6r6voM45A@mail.gmail.com>

hi all, in ovs, the process to have multiple flow entries for single match
can be differentiate by the priority field. Flow entries with higher number
of priority will be match first.
If there is a way or even supported in OVS that multiple flow table has
priority also like the flow entries.
 For example, first action for specific flow entries is in flow table 0
(match is purposedly configured to not match the packet sent via packet-in
before) and second action (match packet sent via packet-in before) is in
flow table 1 (pre-installed).Then it will force packet-in to sent in again
to controller. This second time, i wanted to redirect the packet to the
preinstalled match and action in flow table 1.
Appreciate if anyone can help shed the light for me. thanks


Regards,

masri.sahri
Advanced Network Laboratory (Okamura Lab)
Graduate School and Faculty of Information Science and Electrical
Engineering,
Kyushu University
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150731/2f022139/attachment.html>

From Sabyasachi.Sengupta at alcatel-lucent.com  Thu Jul 30 19:03:36 2015
From: Sabyasachi.Sengupta at alcatel-lucent.com (Sabyasachi Sengupta)
Date: Thu, 30 Jul 2015 19:03:36 -0700
Subject: [ovs-discuss] [ovs-dev] issue with ovs_rcu corrupted cbset (fwd)
Message-ID: <alpine.OSX.1.10.1507301903170.398@sabyasg-mbp-02>


---------- Forwarded message ----------
Date: Wed, 29 Jul 2015 17:02:13 -0700
From: Sabyasachi Sengupta <Sabyasachi.Sengupta at alcatel-lucent.com>
To: ovs-dev <dev at openvswitch.org>
Subject: [ovs-dev] issue with ovs_rcu corrupted cbset


We recently came across a case where ovs trips due to a bad function pointer 
because of a possible corruption in ovs rcu cbset. This typically happens if 
we have 100+ VMs with ~1000 flows.

(gdb) p *cbset
$16 = {list_node = {prev = 0x7f69c0e77b70, next = 0x208f730}, cbs = {{
        function = 0x416e80 <rule_destroy_cb>, aux = 0x461d540}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x45e1d40}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x29cb240}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x1c05c60}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x215c410}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x20cdca0}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x2224ce0}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x29c8710}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x29c8a80}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x2492670}, {
        function = 0x198e1b8, aux = 0x25832f0}, { <<<<<
        function = 0x416e80 <rule_destroy_cb>, aux = 0x25adc80}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x39cb7d0}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x39cb1f0}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x39cb4e0}, {
        function = 0x416e80 <rule_destroy_cb>, aux = 0x292b130}}, n_cbs = 16}

We see that vswitchd trips with the below stacktrace.

Thread 1 (Thread 0x7f69c0e78700 (LWP 5308)):
#0  0x000000000198e1b8 in ?? ()
#1  0x0000000000499430 in ovsrcu_call_postponed () at lib/ovs-rcu.c:249
#2  0x0000000000499674 in ovsrcu_postpone_thread (arg=<value optimized out>)
      at lib/ovs-rcu.c:265
#3  0x00000000004998f1 in ovsthread_wrapper (aux_=<value optimized out>)
      at lib/ovs-thread.c:322
#4  0x00000030b80079d1 in start_thread () from /lib64/libpthread.so.0
#5  0x00000030b78e8b5d in clone () from /lib64/libc.so.6

We are on ovs-2.3.1. Is this problem fixed in more recent ovs (upcoming 2.4) 
or in master? If so, can anyone point me to the patch or commit hash that we 
can try?
_______________________________________________
dev mailing list
dev at openvswitch.org
http://openvswitch.org/mailman/listinfo/dev

From abhishekv.verma at gmail.com  Thu Jul 30 21:08:17 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 31 Jul 2015 09:38:17 +0530
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <20150731012200.GD5647@nicira.com>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
 <20150730124845.GA2310@x240.home>
 <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>
 <20150731002014.GA5647@nicira.com>
 <CADDmorRR89dKxJ1VweCq177KiXnWtbjUoPchn9oSTeah0MP6UQ@mail.gmail.com>
 <20150731005729.GB5647@nicira.com>
 <CADDmorQQc6qApj8jEpwKsg5zwoPX3UB17LHDJ-yRNL--derP3w@mail.gmail.com>
 <20150731012200.GD5647@nicira.com>
Message-ID: <CADDmorSQPJTjNP3T=PED6a7WGVrP-s8=ytKj_y4U404tVAJT=g@mail.gmail.com>

>
> >
> > I just see *4424 *packets getting lost. What are these packets? Any idea
> > when would we lose them?
>
> "lost" means that a queue from the kernel to userspace overflowed.  It
> would ordinarily happen if there was a big burst of packets that didn't
> match in the kernel flow table.
>

But this wouldnt ever happen if i have an explicit flow-rule added that
says, for example, that all packets with a certain IP address coming on a
certain OVS port must go out on a certain OVS port. In that case i already
have a flow programmed before the packets started arriving. That way i can
at least rule out the packet drops because of the reason you cited above.

Is this correct?


Packets can also be lost this way if OVS is stopped and restarted.
>
> Since this is a GRE tunnel, packets can get lost in the kernel TCP/IP
> stack GRE processing on ingress or egress, and that wouldn't show up in
> any of these places.
>

Do you know if there are any stats that i could look at in the Linux kernel
that will give me these stats?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150731/6457f017/attachment-0001.html>

From fbl at sysclose.org  Thu Jul 30 21:19:35 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Fri, 31 Jul 2015 01:19:35 -0300
Subject: [ovs-discuss] Setting up host bridge with VLAN tags
In-Reply-To: <55BA9235.8080601@gmail.com>
References: <55BA9235.8080601@gmail.com>
Message-ID: <20150731041935.GB2310@x240.home>

On Thu, Jul 30, 2015 at 03:08:05PM -0600, Joshua Schaeffer wrote:
> I'm trying to create a bridge with openvswitch on a new physical system I
> have that I'm planing to connect LXC's to but can't get the bridge to
> connect to my network. I installed openvswitch from the Ubuntu repositories
> without any issue. I have my system connected to my switch that allows
> tagged VLAN 31 traffic. The VLAN network is 10.1.10.32/27
> 
> I've been following the openvswitch-switch.README.Debian document
> (specifically example 4). Here is what I've done on the system:
> 
> cat /etc/network/interfaces
> # This file describes the network interfaces available on your system
> # and how to activate them. For more information, see interfaces(5).
> 
> source /etc/network/interfaces.d/*
> 
> # The loopback network interface
> auto lo
> iface lo inet loopback
> 
> # The primary network interface
> allow-br0 vlan31
> iface vlan31 inet manual
> 	ovs_bridge br0
> 	ovs_type OVSIntPort
> 	ovs_options tag=31
> 	ovs_extra set interface ${IFACE} external-ids:iface-id=$(hostname -s)
> 
> # Bridge device
> allow-ovs br0
> iface br0 inet static
> 	ovs_type OVSBridge
> 	ovs_ports vlan31
> 	address 10.1.10.52
> 	netmask 255.255.255.224
> 	gateway 10.1.10.33
> 	dns-servers 10.1.10.6
> 
> I can bring up the bridge successfully and ifconfig shows the correct
> information:
> 
> sudo ifconfig
> br0       Link encap:Ethernet  HWaddr ca:75:db:04:e7:41
>           inet addr:10.1.10.52  Bcast:10.1.10.63  Mask:255.255.255.224
>           inet6 addr: fe80::c875:dbff:fe04:e741/64 Scope:Link
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:7 errors:0 dropped:1 overruns:0 frame:0
>           TX packets:17 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:558 (558.0 B)  TX bytes:1026 (1.0 KB)
> 
> lo        Link encap:Local Loopback
>           inet addr:127.0.0.1  Mask:255.0.0.0
>           inet6 addr: ::1/128 Scope:Host
>           UP LOOPBACK RUNNING  MTU:65536  Metric:1
>           RX packets:3773 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:3773 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:305456 (305.4 KB)  TX bytes:305456 (305.4 KB)
> 
> vlan31    Link encap:Ethernet  HWaddr 96:d5:8a:3f:6f:66
>           inet6 addr: fe80::94d5:8aff:fe3f:6f66/64 Scope:Link
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:8 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:0 (0.0 B)  TX bytes:648 (648.0 B)
> 
> sudo ovs-vsctl show
> 430caed4-a66f-4577-96eb-48e7841905e8
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "vlan31"
>             tag: 31
>             Interface "vlan31"
>                 type: internal
>     ovs_version: "2.3.1"
> 
> However I can't ping the gateway:

Basically you have an OVS internal port (vlan31) connected to
another OVS internal port (br0), so it won't go anywhere.
You need to add the NIC (real HW/type=OVSPort) to the bridge as well.

fbl



From fbl at sysclose.org  Thu Jul 30 21:31:48 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Fri, 31 Jul 2015 01:31:48 -0300
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <CADDmorSQPJTjNP3T=PED6a7WGVrP-s8=ytKj_y4U404tVAJT=g@mail.gmail.com>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
 <20150730124845.GA2310@x240.home>
 <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>
 <20150731002014.GA5647@nicira.com>
 <CADDmorRR89dKxJ1VweCq177KiXnWtbjUoPchn9oSTeah0MP6UQ@mail.gmail.com>
 <20150731005729.GB5647@nicira.com>
 <CADDmorQQc6qApj8jEpwKsg5zwoPX3UB17LHDJ-yRNL--derP3w@mail.gmail.com>
 <20150731012200.GD5647@nicira.com>
 <CADDmorSQPJTjNP3T=PED6a7WGVrP-s8=ytKj_y4U404tVAJT=g@mail.gmail.com>
Message-ID: <20150731043148.GC2310@x240.home>

On Fri, Jul 31, 2015 at 09:38:17AM +0530, Abhishek Verma wrote:
> >
> > >
> > > I just see *4424 *packets getting lost. What are these packets? Any idea
> > > when would we lose them?
> >
> > "lost" means that a queue from the kernel to userspace overflowed.  It
> > would ordinarily happen if there was a big burst of packets that didn't
> > match in the kernel flow table.
> >
> 
> But this wouldnt ever happen if i have an explicit flow-rule added that
> says, for example, that all packets with a certain IP address coming on a
> certain OVS port must go out on a certain OVS port. In that case i already
> have a flow programmed before the packets started arriving. That way i can
> at least rule out the packet drops because of the reason you cited above.
> 
> Is this correct?

No, there is a cache in the kernel which is periodically refreshed or
empty at the initialization.  When the first packet comes in the
packet is queued to the userspace daemon which will update the
kernel's cache.  Next packets matching the cached flow will pass
directly.

However, depending on how you programmed your flows and the traffic,
you could see a burst coming for a flow that isn't cached yet. Since
the queue is limited, it can overflow.

> Packets can also be lost this way if OVS is stopped and restarted.
> >
> > Since this is a GRE tunnel, packets can get lost in the kernel TCP/IP
> > stack GRE processing on ingress or egress, and that wouldn't show up in
> > any of these places.
> >
> 
> Do you know if there are any stats that i could look at in the Linux kernel
> that will give me these stats?

netstat -s/dropwatch

fbl


From abhishekv.verma at gmail.com  Thu Jul 30 21:44:32 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Fri, 31 Jul 2015 10:14:32 +0530
Subject: [ovs-discuss] Drops in OVS
In-Reply-To: <20150731043148.GC2310@x240.home>
References: <CADDmorSbVLx6jQjk9g9V1i_2SWMLjMvtFBnY1qvEWuXm3NOoig@mail.gmail.com>
 <20150730124845.GA2310@x240.home>
 <CADDmorSJneLZdgu_xgEsgL3TStMFJUCONasmMKLEY4vxws+OPA@mail.gmail.com>
 <20150731002014.GA5647@nicira.com>
 <CADDmorRR89dKxJ1VweCq177KiXnWtbjUoPchn9oSTeah0MP6UQ@mail.gmail.com>
 <20150731005729.GB5647@nicira.com>
 <CADDmorQQc6qApj8jEpwKsg5zwoPX3UB17LHDJ-yRNL--derP3w@mail.gmail.com>
 <20150731012200.GD5647@nicira.com>
 <CADDmorSQPJTjNP3T=PED6a7WGVrP-s8=ytKj_y4U404tVAJT=g@mail.gmail.com>
 <20150731043148.GC2310@x240.home>
Message-ID: <CADDmorRK8=9o-Y_DMFKjsg4C_Mpa2VuP7-8sm2wib4xTMpEXRQ@mail.gmail.com>

Hi Flavio,


> > Is this correct?
>
> No, there is a cache in the kernel which is periodically refreshed or
> empty at the initialization.  When the first packet comes in the
> packet is queued to the userspace daemon which will update the
> kernel's cache.  Next packets matching the cached flow will pass
> directly.
>

Aha. So, the of-ctl add-flow really adds a flow only in the User Space and
nothing in the kernel space. If this flow rule isnt added then all packets
will hit the default rule where we do normal L2 learning and switching. By
adding of-ctl add-flow rules we simply over-ride that behavior.

The real flows that get added by the user space daemon that the packets
actually hit can be viewed by "ovs-dpctl dump-flows".

Is this how it is?


> However, depending on how you programmed your flows and the traffic,
> you could see a burst coming for a flow that isn't cached yet. Since
> the queue is limited, it can overflow.
>

Ok, and these drops are visible when i give "ovs-dpctl show" command. Is
there a way to increase this queue size?

Flows afaik are always timed out after 5 secs. Assume i have an application
that bursts every 6 secs. In that case i always run the risk of losing
packets. Is there a way to pin a flow or increase its timeout value?

Thanks, Abhishek


>
> > Packets can also be lost this way if OVS is stopped and restarted.
> > >
> > > Since this is a GRE tunnel, packets can get lost in the kernel TCP/IP
> > > stack GRE processing on ingress or egress, and that wouldn't show up in
> > > any of these places.
> > >
> >
> > Do you know if there are any stats that i could look at in the Linux
> kernel
> > that will give me these stats?
>
> netstat -s/dropwatch
>
> fbl
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150731/41dc739c/attachment.html>

From shad.ansari at hp.com  Fri Jul 31 13:03:41 2015
From: shad.ansari at hp.com (Ansari, Shad)
Date: Fri, 31 Jul 2015 20:03:41 +0000
Subject: [ovs-discuss] Scaling ovsdb-idl's update notification
Message-ID: <8CA204A851B7B14E86E75054661E41750F92FD87@G4W3217.americas.hpqcorp.net>


Ovsdb-idl notifies a client that "something" changed; it does not track "what" changed. The client then typically either reconfigures itself by scanning the idl to determine what changed, or - simply reloads the entire idl. This presumably works since the ovs schema tables aren't typically large.

In a use-case where ovsdb is used with a schema that can have very large tables (imagine route table), the current ovsdb-idl notification mechanism doesn't appear to scale - clients need to do a lot of processing to determine the exact change delta.

I would like to hear from others if they have any views/insights on how to handle this scalability use-case. Obviously, this will require changes in ovsdb-idl, possibly on the lines of:

-        Supporting more granular sequence numbers (table, row, column)

-        Giving client visibility to the update (so that the client can view both the old, new data)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150731/2e51bb46/attachment.html>

From blp at nicira.com  Fri Jul 31 14:55:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 31 Jul 2015 14:55:43 -0700
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <55B999B2.5000408@gmail.com>
References: <55A886CE.3040305@gmail.com> <20150717164204.GG10847@nicira.com>
 <55ADE240.8000309@gmail.com> <20150721151917.GC15450@nicira.com>
 <55AF537A.3060800@gmail.com> <55B1D0FD.1020601@gmail.com>
 <20150724153428.GA20805@nicira.com> <55B5E556.9050106@gmail.com>
 <20150727203217.GG5243@nicira.com> <55B999B2.5000408@gmail.com>
Message-ID: <20150731215543.GG29934@nicira.com>

On Thu, Jul 30, 2015 at 12:27:46PM +0900, Minoru TAKAHASHI wrote:
> I attached fixed patches in this email as follows.
> In my environment, following patches did not cause the error when testsuite(make check) run.
> 
> * Fix group desc request encoding.
>  - 0001-openflow-Add-OpenFlow1.5-group-desc-request.patch
>  - 0002-ofp-util-Fix-group-desc-request-encoding.patch
> 
> * Fix port desc request encoding.
>  - 0001-openflow-Add-OpenFlow1.5-port-desc-request.patch
>  - 0002-ofp-util-Fix-port-desc-request-encoding.patch

Thank you for the contributions!  I applied all of these patches to the
OVS "master" branch.

From xuzk1992 at gmail.com  Wed Jul 29 00:38:02 2015
From: xuzk1992 at gmail.com (=?UTF-8?B?5b6Q5YWG6a2B?=)
Date: Wed, 29 Jul 2015 07:38:02 +0000
Subject: [ovs-discuss] [Kernel panic] BUG: unable to handle kernel NULL
	pointer dereference
Message-ID: <CAOmrz4U=bs1=xBjtCS=1fgnJ8gA_8Ho5Bmod1fxyKZ23UMH65w@mail.gmail.com>

Running ovs-v2.3.2 on ubuntu 12.04-lts with kernel 3.13.0-55-generic, it
panics like this:

```
[195686.613495] BUG: unable to handle kernel NULL pointer dereference at
0000000000000004
[195686.619873] IP: [<ffffffff8169ee18>] tcp_sacktag_write_queue+0x388/0x900
[195686.626038] PGD bfa35c067 PUD bfc358067 PMD 0
[195686.631977] Oops: 0000 [#1] SMP
[195686.637763] Modules linked in: netconsole configfs iptable_nat
nf_nat_ipv4 xt_addrtype nf_nat bridge stp llc aufs veth ip6table_filter
ip6_tables iptable_filter ip_tables x_tables openvswitch vxlan ip_tunnel
gre libcrc32c deflate ctr twofish_generic twofish_avx_x86_64
twofish_x86_64_3way twofish_x86_64 twofish_common camellia_generic
camellia_aesni_avx_x86_64 camellia_x86_64 serpent_sse2_x86_64 glue_helper
lrw serpent_generic xts gf128mul blowfish_generic blowfish_x86_64
blowfish_common cast5_avx_x86_64 ablk_helper cryptd cast5_generic
cast_common des_generic cmac xcbc rmd160 crypto_null af_key xfrm_algo
nf_conntrack_ipv4 nf_conntrack nf_defrag_ipv4 gpio_ich dcdbas mei_me
sb_edac mei edac_core lpc_ich shpchp joydev wmi acpi_power_meter ipmi_si
mac_hid bonding lp parport ses enclosure hid_generic usbhid hid tg3 ptp
megaraid_sas pps_core
[195686.683889] CPU: 0 PID: 3153 Comm: netagent Tainted: G        W
3.13.0-55-generic #94~precise1-Ubuntu
[195686.691138] Hardware name: Dell Inc. PowerEdge R720xd/0X6FFV, BIOS
1.6.0 03/07/2013
[195686.698524] task: ffff880bf1de3000 ti: ffff880bfbab8000 task.ti:
ffff880bfbab8000
[195686.706082] RIP: 0010:[<ffffffff8169ee18>]  [<ffffffff8169ee18>]
tcp_sacktag_write_queue+0x388/0x900
[195686.713852] RSP: 0018:ffff880c0fc03a58  EFLAGS: 00010a06
[195686.721645] RAX: ffff880082d23800 RBX: ffff880bf2416360 RCX:
ffff880c0fc03ad8
[195686.729566] RDX: 0000000000000000 RSI: 0000000000000000 RDI:
0000000000000000
[195686.737597] RBP: ffff880c0fc03b18 R08: 0000000000000000 R09:
0000000000000000
[195686.745587] R10: ffff880bf2416360 R11: 0000000000000000 R12:
00000000b23f1d13
[195686.753654] R13: ffff880bf2415d00 R14: ffff880bf2416360 R15:
ffff880bf2415e20
[195686.761738] FS:  00007f79cdffb700(0000) GS:ffff880c0fc00000(0000)
knlGS:0000000000000000
[195686.769992] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[195686.778240] CR2: 0000000000000004 CR3: 0000000bfc1eb000 CR4:
00000000000407f0
[195686.786639] Stack:
[195686.795019]  ffff880c0fc03a88 ffffffffa02740ab ffff880361482838
ffff8803f2fd7800
[195686.803764]  ffff8817fa814888 ffff880c0fc03b74 000000030fc03a01
001dca8002275741
[195686.812566]  0000000000000002 0000000000000002 01771fe4b23f2295
0000000000000000
[195686.821544] Call Trace:
[195686.830370]  <IRQ>
[195686.830442]  [<ffffffffa02740ab>] ?
vxlan_udp_encap_recv.part.44+0xbb/0x110 [vxlan]
[195686.848438]  [<ffffffffa0166a13>] ? __nf_ct_refresh_acct+0x43/0x90
[nf_conntrack]
[195686.857702]  [<ffffffff816a330e>] tcp_ack+0x54e/0x6d0
[195686.866941]  [<ffffffffa02ae544>] ? ipt_do_table+0x234/0x540 [ip_tables]
[195686.876228]  [<ffffffff816a3a9a>] tcp_rcv_established+0x2ea/0x6b0
[195686.885449]  [<ffffffffa032635e>] ? nf_nat_ipv4_fn+0x1ee/0x280
[iptable_nat]
[195686.894678]  [<ffffffff816ae1bd>] tcp_v4_do_rcv+0x15d/0x240
[195686.903848]  [<ffffffff816affd1>] tcp_v4_rcv+0x721/0x760
[195686.912954]  [<ffffffff81689dd0>] ? ip_rcv_finish+0x380/0x380
[195686.922080]  [<ffffffff8168324d>] ? nf_hook_slow+0x7d/0x150
[195686.931036]  [<ffffffff81689dd0>] ? ip_rcv_finish+0x380/0x380
[195686.939929]  [<ffffffff81689e78>] ip_local_deliver_finish+0xa8/0x220
[195686.948741]  [<ffffffff8168a17b>] ip_local_deliver+0x4b/0x90
[195686.957598]  [<ffffffff81689b71>] ip_rcv_finish+0x121/0x380
[195686.966433]  [<ffffffff8168a446>] ip_rcv+0x286/0x380
[195686.975261]  [<ffffffff81652042>] __netif_receive_skb_core+0x5e2/0x730
[195686.984180]  [<ffffffff8149b22f>] ? add_interrupt_randomness+0xef/0x140
[195686.993238]  [<ffffffff816521b1>] __netif_receive_skb+0x21/0x70
[195687.002089]  [<ffffffff81652981>] process_backlog+0xb1/0x190
[195687.010793]  [<ffffffff81653219>] net_rx_action+0x139/0x250
[195687.019442]  [<ffffffff8107035d>] __do_softirq+0xdd/0x300
[195687.028057]  [<ffffffff8107091e>] irq_exit+0x11e/0x140
[195687.036484]  [<ffffffff817720f3>] do_IRQ+0x63/0xe0
[195687.044631]  [<ffffffff8176722d>] common_interrupt+0x6d/0x6d
[195687.052580]  <EOI>
[195687.052644]  [<ffffffff811aeda9>] ? kmem_cache_free+0x1e9/0x220
[195687.067824]  [<ffffffff8164398b>] ? skb_release_data.part.52+0xcb/0x140
[195687.075234]  [<ffffffff81641852>] ? kfree_skbmem+0x32/0xa0
[195687.082369]  [<ffffffff81766cce>] ?
_raw_spin_unlock_irqrestore+0x1e/0x50
[195687.089416]  [<ffffffff810affaa>] remove_wait_queue+0x5a/0x70
[195687.096275]  [<ffffffff8154bf83>] tun_do_read.isra.24+0x103/0x180
[195687.103069]  [<ffffffff8109fc20>] ? try_to_wake_up+0x210/0x210
[195687.109697]  [<ffffffff8154c19c>] tun_chr_aio_read+0xac/0xd0
[195687.116216]  [<ffffffff811ca8ca>] do_sync_read+0x5a/0x90
[195687.122638]  [<ffffffff811cb95b>] vfs_read+0xab/0x180
[195687.128984]  [<ffffffff811cbbe2>] SyS_read+0x52/0xa0
[195687.135320]  [<ffffffff8176fddd>] system_call_fastpath+0x1a/0x1f
[195687.141723] Code: 3b 60 44 78 38 8b 51 04 eb 14 66 0f 1f 84 00 00 00 00
00 4c 39 c0 74 25 44 3b 60 44 78 1f 8b b0 cc 00 00 00 48 8b b8 d0 00 00 00
<0f> b7 74 37 04 01 f2 89 55 c4 48 8b 00 49 39 c7 75 d6 0f b6 55
[195687.155358] RIP  [<ffffffff8169ee18>]
tcp_sacktag_write_queue+0x388/0x900
[195687.162041]  RSP <ffff880c0fc03a58>
[195687.168644] CR2: 0000000000000004
[195687.192263] ---[ end trace 3306ec4515f3eef8 ]---
[195687.203457] Kernel panic - not syncing: Fatal exception in interrupt
[195687.217033] ------------[ cut here ]------------
[195687.223470] WARNING: CPU: 0 PID: 3153 at
/build/buildd/linux-lts-trusty-3.13.0/arch/x86/kernel/smp.c:124
native_smp_send_reschedule+0x5e/0x60()
[195687.236984] Modules linked in: netconsole configfs iptable_nat
nf_nat_ipv4 xt_addrtype nf_nat bridge stp llc aufs veth ip6table_filter
ip6_tables iptable_filter ip_tables x_tables openvswitch vxlan ip_tunnel
gre libcrc32c deflate ctr twofish_generic twofish_avx_x86_64
twofish_x86_64_3way twofish_x86_64 twofish_common camellia_generic
camellia_aesni_avx_x86_64 camellia_x86_64 serpent_avx_x86_64
serpent_sse2_x86_64 glue_helper lrw serpent_generic xts gf128mul
blowfish_generic blowfish_x86_64 blowfish_common cast5_avx_x86_64
ablk_helper cryptd cast5_generic cast_common des_generic cmac xcbc rmd160
crypto_null af_key xfrm_algo nf_conntrack_ipv4 nf_conntrack nf_defrag_ipv4
gpio_ich dcdbas mei_me sb_edac mei edac_core lpc_ich shpchp joydev wmi
acpi_power_meter ipmi_si mac_hid bonding lp parport ses enclosure
hid_generic usbhid hid tg3 ptp megaraid_sas pps_core
[195687.291518] CPU: 0 PID: 3153 Comm: netagent Tainted: G      D W
3.13.0-55-generic #94~precise1-Ubuntu
[195687.299953] Hardware name: Dell Inc. PowerEdge R720xd/0X6FFV, BIOS
1.6.0 03/07/2013
[195687.308494]  000000000000007c ffff880c0fc033b0 ffffffff8175a7b4
000000000000e130
[195687.317159]  0000000000000000 ffff880c0fc033f0 ffffffff8106b07c
ffff880c0fc131c0
[195687.325816]  0000000000000001 0000000000000000 ffff88183fc13140
ffff880c0fc13140
[195687.334451] Call Trace:
[195687.343036]  <IRQ>  [<ffffffff8175a7b4>] dump_stack+0x46/0x58
[195687.351793]  [<ffffffff8106b07c>] warn_slowpath_common+0x8c/0xc0
[195687.360611]  [<ffffffff8106b0ca>] warn_slowpath_null+0x1a/0x20
[195687.369368]  [<ffffffff8104321e>] native_smp_send_reschedule+0x5e/0x60
[195687.378146]  [<ffffffff810ad13e>] trigger_load_balance+0x17e/0x1f0
[195687.386902]  [<ffffffff8109e4df>] scheduler_tick+0xaf/0xf0
[195687.395643]  [<ffffffff8107a2e1>] update_process_times+0x61/0x80
[195687.404430]  [<ffffffff810dc2b3>] tick_sched_handle.isra.12+0x33/0x70
[195687.413235]  [<ffffffff810dc3dc>] tick_sched_timer+0x4c/0x80
[195687.422034]  [<ffffffff810930a6>] __run_hrtimer+0x76/0x230
[195687.430820]  [<ffffffff810dc390>] ? tick_nohz_handler+0xa0/0xa0
[195687.439676]  [<ffffffff81093897>] hrtimer_interrupt+0x107/0x260
[195687.448477]  [<ffffffff810460fb>] local_apic_timer_interrupt+0x3b/0x60
[195687.457279]  [<ffffffff817721b5>] smp_apic_timer_interrupt+0x45/0x60
[195687.466055]  [<ffffffff81770b1d>] apic_timer_interrupt+0x6d/0x80
[195687.474837]  [<ffffffff810c27c8>] ? console_unlock.part.12+0x218/0x260
[195687.483595]  [<ffffffff8174d279>] ? panic+0x194/0x1d7
[195687.492413]  [<ffffffff8174d1db>] ? panic+0xf6/0x1d7
[195687.501049]  [<ffffffff8176837a>] oops_end+0x14a/0x160
[195687.509680]  [<ffffffff8174c615>] no_context+0x1be/0x1cd
[195687.518287]  [<ffffffff8174c7f7>] __bad_area_nosemaphore+0x1d3/0x1f2
[195687.526958]  [<ffffffffa028bc00>] ? flow_mask_insert.isra.2+0x1d0/0x1f0
[openvswitch]
[195687.535763]  [<ffffffff8174c829>] bad_area_nosemaphore+0x13/0x15
[195687.544623]  [<ffffffff8176b2b2>] __do_page_fault+0x3c2/0x580
[195687.553497]  [<ffffffffa02833ee>] ? do_output+0x2e/0x50 [openvswitch]
[195687.562215]  [<ffffffffa02840c5>] ? do_execute_actions+0x1b5/0x220
[openvswitch]
[195687.570844]  [<ffffffffa028c456>] ? ovs_flow_tbl_lookup+0x76/0x90
[openvswitch]
[195687.579367]  [<ffffffffa028415b>] ? ovs_execute_actions+0x2b/0x30
[openvswitch]
[195687.587797]  [<ffffffffa0286a7d>] ?
ovs_dp_process_received_packet+0x9d/0x130 [openvswitch]
[195687.596349]  [<ffffffff8176b48a>] do_page_fault+0x1a/0x70
[195687.604916]  [<ffffffff817675a8>] page_fault+0x28/0x30
[195687.613369]  [<ffffffff8169ee18>] ? tcp_sacktag_write_queue+0x388/0x900
[195687.621874]  [<ffffffff8169eb4f>] ? tcp_sacktag_write_queue+0xbf/0x900
[195687.630059]  [<ffffffffa02740ab>] ?
vxlan_udp_encap_recv.part.44+0xbb/0x110 [vxlan]
[195687.638141]  [<ffffffffa0166a13>] ? __nf_ct_refresh_acct+0x43/0x90
[nf_conntrack]
[195687.646019]  [<ffffffff816a330e>] tcp_ack+0x54e/0x6d0
[195687.653673]  [<ffffffffa02ae544>] ? ipt_do_table+0x234/0x540 [ip_tables]
[195687.661176]  [<ffffffff816a3a9a>] tcp_rcv_established+0x2ea/0x6b0
[195687.668456]  [<ffffffffa032635e>] ? nf_nat_ipv4_fn+0x1ee/0x280
[iptable_nat]
[195687.675605]  [<ffffffff816ae1bd>] tcp_v4_do_rcv+0x15d/0x240
[195687.682513]  [<ffffffff816affd1>] tcp_v4_rcv+0x721/0x760
[195687.689162]  [<ffffffff81689dd0>] ? ip_rcv_finish+0x380/0x380
[195687.695617]  [<ffffffff8168324d>] ? nf_hook_slow+0x7d/0x150
[195687.701923]  [<ffffffff81689dd0>] ? ip_rcv_finish+0x380/0x380
[195687.708110]  [<ffffffff81689e78>] ip_local_deliver_finish+0xa8/0x220
[195687.714336]  [<ffffffff8168a17b>] ip_local_deliver+0x4b/0x90
[195687.720544]  [<ffffffff81689b71>] ip_rcv_finish+0x121/0x380
[195687.726639]  [<ffffffff8168a446>] ip_rcv+0x286/0x380
[195687.732620]  [<ffffffff81652042>] __netif_receive_skb_core+0x5e2/0x730
[195687.738647]  [<ffffffff8149b22f>] ? add_interrupt_randomness+0xef/0x140
[195687.744736]  [<ffffffff816521b1>] __netif_receive_skb+0x21/0x70
[195687.750790]  [<ffffffff81652981>] process_backlog+0xb1/0x190
[195687.756826]  [<ffffffff81653219>] net_rx_action+0x139/0x250
[195687.762822]  [<ffffffff8107035d>] __do_softirq+0xdd/0x300
[195687.768831]  [<ffffffff8107091e>] irq_exit+0x11e/0x140
[195687.774781]  [<ffffffff817720f3>] do_IRQ+0x63/0xe0
[195687.780711]  [<ffffffff8176722d>] common_interrupt+0x6d/0x6d
[195687.786680]  <EOI>  [<ffffffff811aeda9>] ? kmem_cache_free+0x1e9/0x220
[195687.792744]  [<ffffffff8164398b>] ? skb_release_data.part.52+0xcb/0x140
[195687.798847]  [<ffffffff81641852>] ? kfree_skbmem+0x32/0xa0
[195687.804930]  [<ffffffff81766cce>] ?
_raw_spin_unlock_irqrestore+0x1e/0x50
[195687.811059]  [<ffffffff810affaa>] remove_wait_queue+0x5a/0x70
[195687.817145]  [<ffffffff8154bf83>] tun_do_read.isra.24+0x103/0x180
[195687.823256]  [<ffffffff8109fc20>] ? try_to_wake_up+0x210/0x210
[195687.829319]  [<ffffffff8154c19c>] tun_chr_aio_read+0xac/0xd0
[195687.835441]  [<ffffffff811ca8ca>] do_sync_read+0x5a/0x90
[195687.841562]  [<ffffffff811cb95b>] vfs_read+0xab/0x180
[195687.847669]  [<ffffffff811cbbe2>] SyS_read+0x52/0xa0
[195687.859706] ---[ end trace 3306ec4515f3eef9 ]---
```
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150729/3cbd544b/attachment-0001.html>

From takahashi.minoru7 at gmail.com  Wed Jul 29 20:27:46 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Thu, 30 Jul 2015 12:27:46 +0900
Subject: [ovs-discuss] Problem about ofp-util.c
In-Reply-To: <20150727203217.GG5243@nicira.com>
References: <55A7419E.7010306@gmail.com> <20150716214018.GD11792@nicira.com>
 <55A886CE.3040305@gmail.com> <20150717164204.GG10847@nicira.com>
 <55ADE240.8000309@gmail.com> <20150721151917.GC15450@nicira.com>
 <55AF537A.3060800@gmail.com> <55B1D0FD.1020601@gmail.com>
 <20150724153428.GA20805@nicira.com> <55B5E556.9050106@gmail.com>
 <20150727203217.GG5243@nicira.com>
Message-ID: <55B999B2.5000408@gmail.com>

Hi,

On 2015年07月28日 05:32, Ben Pfaff wrote:
> On Mon, Jul 27, 2015 at 05:01:26PM +0900, Minoru TAKAHASHI wrote:
>> On 2015年07月25日 00:34, Ben Pfaff wrote:
>>> On Fri, Jul 24, 2015 at 02:45:33PM +0900, Minoru TAKAHASHI wrote:
>>>> Hi,
>>>>
>>>> On 2015年07月22日 17:25, Minoru TAKAHASHI wrote:
>>>>> Hi,
>>>>>
>>>>> Thank you for reply.
>>>>>
>>>>> On 2015年07月22日 00:19, Ben Pfaff wrote:
>>>>>> On Tue, Jul 21, 2015 at 03:10:08PM +0900, Minoru TAKAHASHI wrote:
>>>>>>>> they do not make the corresponding change to the decoder
>>>>>>>
>>>>>>> Should I fix this problem?
>>>>>>> If so, please tell me that which source file should I fix.
>>>>>>> (Sorry, I am new in implementation of OpenvSwitch.)
>>>>>>
>>>>>> I cannot apply anything to the repository that makes tests fail, so yes
>>>>>> you should fix the decoder.
>>>>>>
>>>>>> The decode function is right next to the encode function.
>>>>
>>>>> ## ------------------------------ ##
>>>>> ## openvswitch 2.4.90 test suite. ##
>>>>> ## ------------------------------ ##
>>>>>
>>>>> 694: ofproto - del group (OpenFlow 1.5)              FAILED (ofproto.at:350)
>>>>> 696: ofproto - insert buckets                        FAILED (ofproto.at:424)
>>>>
>>>> I think that the following code is causing the above error.
>>>>
>>>> [lib/ofp-msgs.h]
>>>> https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L336
>>>>
>>>> [tests/ofp-print.at]
>>>> https://github.com/openvswitch/ovs/blob/master/tests/ofp-print.at#L2003
>>>>
>>>> After I fix these, the above error does not occur.
>>>
>>> Did you run all the tests?  I see three failures:
>>
>> Oh, sorry about that.
>> Hmm, how to run the testsuite is correct in the following?
>>
>> 1. uninstall ovs
>>
>>  sudo make uninstall
>>  sudo make distclean
>>
>> 2. install ovs
>>
>>  ./boot.sh
>>  ./configure
>>  make && sudo make install
>>
>> 3. run tests
>>
>>  ./tests/testsuite -C tests AUTOTEST_PATH=utilities:vswitchd:ovsdb:vtep:tests
> 
> You don't have to install (or uninstall) OVS to run the testsuite.  Just
> build OVS then run "make check".
> 

Thank you for your infomation!

I attached fixed patches in this email as follows.
In my environment, following patches did not cause the error when testsuite(make check) run.

* Fix group desc request encoding.
 - 0001-openflow-Add-OpenFlow1.5-group-desc-request.patch
 - 0002-ofp-util-Fix-group-desc-request-encoding.patch

* Fix port desc request encoding.
 - 0001-openflow-Add-OpenFlow1.5-port-desc-request.patch
 - 0002-ofp-util-Fix-port-desc-request-encoding.patch

thanks,
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-openflow-Add-OpenFlow1.5-port-desc-request.patch
Type: text/x-patch
Size: 1010 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/97d4194a/attachment-0004.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-ofp-util-Fix-port-desc-request-encoding.patch
Type: text/x-patch
Size: 2504 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/97d4194a/attachment-0005.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-openflow-Add-OpenFlow1.5-group-desc-request.patch
Type: text/x-patch
Size: 1105 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/97d4194a/attachment-0006.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0002-ofp-util-Fix-group-desc-request-encoding.patch
Type: text/x-patch
Size: 2414 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/97d4194a/attachment-0007.bin>

From laxmikanta.behera at wipro.com  Fri Jul 31 02:41:14 2015
From: laxmikanta.behera at wipro.com (laxmikanta.behera at wipro.com)
Date: Fri, 31 Jul 2015 09:41:14 +0000
Subject: [ovs-discuss] One Issue with IGMP Snooping for OVS2.3.9
Message-ID: <SG2PR0301MB13024A7504A540CAA0CD2DE1F18A0@SG2PR0301MB1302.apcprd03.prod.outlook.com>

Hi,

Age time reset to zero for existing host 1 ( stream from group IP-239.225.255.100) while  join request coming from host2 for different group Ip(239.255.255.250).
Please find below screen shot.


[cid:image001.png at 01D0CB8D.DA92B7A0]


Thanks & Regards,
Laxmikanta

The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150731/31fa5733/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 19030 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150731/31fa5733/attachment-0001.png>

From pshetty at virtela.net  Thu Jul 30 07:51:55 2015
From: pshetty at virtela.net (Shetty, Pradeep)
Date: Thu, 30 Jul 2015 14:51:55 +0000
Subject: [ovs-discuss] List of Openvswitch bugs with fix
Message-ID: <659EF5C7A0B2134793E1A6D463A568A03755B979@DCOENG1-EX-MB5.virtela.cc>

Hello,

Can anybody help me out with the information requested below;


*         Bugs/issues encountered with openvswitch version 2.3.1(Cloudstack Integrated)

*         Bug fixes, new bugs/issues seen in the new release 2.3.2.(Cloudstack Integrated)

Thanks,
Pradeep

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150730/f4702059/attachment.html>


From hwchiu at cs.nctu.edu.tw  Sun Nov  1 22:17:35 2015
From: hwchiu at cs.nctu.edu.tw (=?UTF-8?B?SHVuZy1XZWkgQ2hpdSAo6YKx5a6P55GLKQ==?=)
Date: Mon, 2 Nov 2015 14:17:35 +0800
Subject: [ovs-discuss] OVS bridge doesn't reply any packets.
Message-ID: <CALkuH4E062xEkgpsi8z4yU196RTtyk-nq_e3dOO+a5fE94-OXQ@mail.gmail.com>

Hi all.

I install the OpenvSwitch 2.3.1 on my system with linux 3.10.77.
My system has 4 physical interface eth0, eth1, eth2 and eth3.
I create 4 OVS bridge for each ethX interfaces and attch the ethX to its
OVS bridge.
The topology likes below.

ovs_eth0   ovs_eth1 ovs_eth2  ovs_eth3
   |                  |              |           |
  eth0           eht1         eht2      eht3

After attch the ethX interface, I do the following thing.
1. Clone the mac address of ethX to ovs_ethX.
2. Set the ip address of ehtX to 0.
3. Set the static ip to ovs_ethX.

It looks like below.

----
eth0      Link encap:Ethernet  HWaddr 00:11:32:32:93:99
          inet6 addr: fe80::211:32ff:fe32:9399/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4022865 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11384 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:883577555 (842.6 MiB)  TX bytes:2135843 (2.0 MiB)
ovs_eth0  Link encap:Ethernet  HWaddr 00:11:32:32:93:99
          inet addr:10.11.243.26  Bcast:10.11.243.255  Mask:255.255.255.0
          inet6 addr: fe80::211:32ff:fe32:9399/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4013419 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11389 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:882582231 (841.6 MiB)  TX bytes:2136397 (2.0 MiB)
----

In my topology, I don't use any controller to control the flow, I use the
normal action in the flow table.

----
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=283795.407s, table=0, n_packets=4035185,
n_bytes=885870336, idle_age=0, hard_age=65534, priority=0 actions=NORMAL
-----

Atfet those setting, the network works.
Now. I write a script to do all thing I mentioned before and it will excute
after the system has boot done.
After reboot, sometimes it works, sometimes it doesn't work.
The ratio of goot do bad is 14000 to 2. I want to figure out why the
network doesn't work.

In that condtion. Only the ovs_eth0 can't reply packet but ovs_eth1,
ovs_eth2 and ovs_eth3 works.
I use the tcpdump to listen the packet. I found that the ovs_eth0 has
received the ARP request but didn't reply the ARP packet.

I try to check the network setting but I can't figure out.

ifconfig
------
eth0      Link encap:Ethernet  HWaddr 00:11:32:32:93:99
          inet6 addr: fe80::211:32ff:fe32:9399/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4026717 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11384 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:884523841 (843.5 MiB)  TX bytes:2135843 (2.0 MiB)
ovs_eth0  Link encap:Ethernet  HWaddr 00:11:32:32:93:99
          inet addr:10.11.243.26  Bcast:10.11.243.255  Mask:255.255.255.0
          inet6 addr: fe80::211:32ff:fe32:9399/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4017284 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11389 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:883539398 (842.6 MiB)  TX bytes:2136397 (2.0 MiB)
------


ovs-vsctl show
--------
    Bridge "ovs_eth0"
        Port "ovs_eth0"
            Interface "ovs_eth0"
                type: internal
        Port "eth0"
            Interface "eth0"
--------

ovs-ofctl dump-flows ovs_eth0 (the n_packets counter will increase)
--------
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=284607.822s, table=0, n_packets=4039935,
n_bytes=887091701, idle_age=0, hard_age=65534, priority=0 actions=NORMAL
--------

I also try to flush the fdb and the entries has been add again later but it
doens't solve the problem.

First time I met this problem, I solve this by using ifconfig to assign the
same ip address again.

Does any one has the similar experience of OVS before?

Thanks.



Best Regards,

Hung-Wei Chiu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151102/89b45893/attachment.html>

From gstenzel at linux.vnet.ibm.com  Mon Nov  2 03:57:20 2015
From: gstenzel at linux.vnet.ibm.com (Gerhard Stenzel)
Date: Mon, 2 Nov 2015 12:57:20 +0100
Subject: [ovs-discuss] [openvswitch 2.3.2] testsuite: 717 fails on s390x
In-Reply-To: <CACzMAJKSnUTFP7Fx=Fk-s4vHokB2=7b+BXLXF4e3c2v+mD0DiQ@mail.gmail.com>
References: <5630D413.10904@linux.vnet.ibm.com>
 <CACzMAJLBhkbksmMj6F0=B0VqpXweTdGOvehtc5hcD1fs91BDMw@mail.gmail.com>
 <563213A8.6080700@linux.vnet.ibm.com>
 <CACzMAJKpuhbhRdyaqb0m4cA7KQrv5Sj8kwnsm5z+ZAg3PHH58g@mail.gmail.com>
 <CACzMAJKSnUTFP7Fx=Fk-s4vHokB2=7b+BXLXF4e3c2v+mD0DiQ@mail.gmail.com>
Message-ID: <56374FA0.6090709@linux.vnet.ibm.com>

On 10/30/2015 07:33 PM, Andy Zhou wrote:
>> Thanks for the information. I have never ran into this failure, but
>> now I can see how it is possible. It seems we
>> should also not match the exact value of recirc_id.  I will post a
>> patch for this.
>
> This is done, I have pushed the patch to master, branch-2.4 and 2.3.
>>
>> In the mean time, I will merge
>> 8ae8176fd0d8ed919e3301cc961dcf02b65ff49d into branch-2.3.
>
> This is done as well.
>

testcase 717 passes now on .. thanks for the patch.


From zhangzhiming at yunshan.net.cn  Mon Nov  2 06:12:32 2015
From: zhangzhiming at yunshan.net.cn (ZHANG Zhiming)
Date: Mon, 2 Nov 2015 22:12:32 +0800
Subject: [ovs-discuss] ipfix leads to kernel crash
Message-ID: <201511022212301753210@yunshan.net.cn>

Hi,

Could someone help me check this kernel crash?
I set ipfix to send report to a collector, and the kernel crashed after several hours.
Thanks!

ovs-vsctl (Open vSwitch) 2.3.1
Compiled Aug 11 2015 05:18:30
DB Schema 7.6.2

kernel version:
3.10.0-123.el7.x86_64 

crash> bt
PID: 1614   TASK: ffff8817fb7638e0  CPU: 1   COMMAND: "avahi-daemon"
 #0 [ffff8817f78c71e8] machine_kexec at ffffffff8104105b
 #1 [ffff8817f78c7248] crash_kexec at ffffffff810ceec2
 #2 [ffff8817f78c7318] oops_end at ffffffff815e9b08
 #3 [ffff8817f78c7340] die at ffffffff810162ab
 #4 [ffff8817f78c7370] do_trap at ffffffff815e91e0
 #5 [ffff8817f78c73c0] do_invalid_op at ffffffff810130d4
 #6 [ffff8817f78c7470] invalid_op at ffffffff815f2d9e
    [exception RIP: pskb_expand_head+526]
    RIP: ffffffff814c107e  RSP: ffff8817f78c7528  RFLAGS: 00010202
    RAX: 0000000000000002  RBX: ffff8817fb2e1700  RCX: 0000000000000020
    RDX: 00000000000002c0  RSI: 0000000000000000  RDI: ffff8817fb2e1700
    RBP: ffff8817f78c7560   R8: 0000000000000132   R9: 0000000000000000
    R10: 0000000000000100  R11: 0000000000000004  R12: 0000000000000000
    R13: ffff8817fb2e1700  R14: 00000000958819e2  R15: ffff8817fab82500
    ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018
 #7 [ffff8817f78c7568] skb_checksum_help at ffffffff814cd85b
 #8 [ffff8817f78c7598] queue_userspace_packet at ffffffffa043cf03 [openvswitch]
 #9 [ffff8817f78c7638] ovs_dp_upcall at ffffffffa043e5a5 [openvswitch]
#10 [ffff8817f78c7650] do_execute_actions at ffffffffa043aa0e [openvswitch]
#11 [ffff8817f78c76f0] do_execute_actions at ffffffffa043aa3b [openvswitch]
#12 [ffff8817f78c7790] ovs_execute_actions at ffffffffa043b3f7 [openvswitch]
#13 [ffff8817f78c77c8] ovs_dp_process_packet_with_key at ffffffffa043e64e [openvswitch]
#14 [ffff8817f78c7838] ovs_dp_process_received_packet at ffffffffa043e794 [openvswitch]
#15 [ffff8817f78c7900] ovs_vport_receive at ffffffffa0444d7a [openvswitch]
#16 [ffff8817f78c7910] internal_dev_xmit at ffffffffa0445a4d [openvswitch]
#17 [ffff8817f78c7920] dev_hard_start_xmit at ffffffff814d10f8
#18 [ffff8817f78c7978] dev_queue_xmit at ffffffff814d1680
#19 [ffff8817f78c79c8] ip_finish_output at ffffffff8150d321
#20 [ffff8817f78c7a18] ip_mc_output at ffffffff8150e53a
#21 [ffff8817f78c7a48] ip_local_out at ffffffff8150dec5
#22 [ffff8817f78c7a60] ip_send_skb at ffffffff8150f235
#23 [ffff8817f78c7a78] udp_send_skb at ffffffff81534ea2
#24 [ffff8817f78c7ab8] udp_sendmsg at ffffffff81535e37
#25 [ffff8817f78c7bd8] inet_sendmsg at ffffffff81542074
#26 [ffff8817f78c7c08] sock_sendmsg at ffffffff814b6f30
#27 [ffff8817f78c7d70] ___sys_sendmsg at ffffffff814b7369
#28 [ffff8817f78c7f00] __sys_sendmsg at ffffffff814b8251
#29 [ffff8817f78c7f70] sys_sendmsg at ffffffff814b82a2
#30 [ffff8817f78c7f80] system_call_fastpath at ffffffff815f1659
    RIP: 00007f48906247a0  RSP: 00007fff5ee93768  RFLAGS: 00000207
    RAX: 000000000000002e  RBX: ffffffff815f1659  RCX: 00007f48912d3e20
    RDX: 0000000000000000  RSI: 00007fff5ee93fa0  RDI: 000000000000000c
    RBP: 000000000000000c   R8: 00007fff5ee93f13   R9: 0000000000000004
    R10: 0000000000000019  R11: 0000000000000246  R12: ffffffff814b82a2
    R13: ffff8817f78c7f78  R14: 000000000000000c  R15: 00007fff5ee93fa0
    ORIG_RAX: 000000000000002e  CS: 0033  SS: 002b
crash> sys
      KERNEL: /usr/lib/debug/lib/modules/3.10.0-123.el7.x86_64/vmlinux
    DUMPFILE: vmcore  [PARTIAL DUMP]
        CPUS: 8
        DATE: Fri Oct 23 22:15:37 2015
      UPTIME: 00:00:21
LOAD AVERAGE: 1.01, 0.24, 0.08
       TASKS: 445
    NODENAME: centos131
     RELEASE: 3.10.0-123.el7.x86_64
     VERSION: #1 SMP Tue Jul 14 11:00:37 CST 2015
     MACHINE: x86_64  (2500 Mhz)
      MEMORY: 96 GB
       PANIC: "kernel BUG at net/core/skbuff.c:1060!"




ZHANG Zhiming
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151102/db4eeeb5/attachment-0001.html>

From tech.kals at gmail.com  Sun Nov  1 19:54:11 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Mon, 2 Nov 2015 09:24:11 +0530
Subject: [ovs-discuss] ofproto: Send port status message for port-mods
	from OVS to controller
In-Reply-To: <CAHWErLcE_Jj_mw804B=NJQzT_S3+k664LLESV1+VCFeCec-YyA@mail.gmail.com>
References: <CAHWErLdbB+FeBdp+ye3crkgGvjKeLh+D4B6Ui5Q-CHWmRUQ2ug@mail.gmail.com>
 <CAHWErLcE_Jj_mw804B=NJQzT_S3+k664LLESV1+VCFeCec-YyA@mail.gmail.com>
Message-ID: <CAHWErLeuKFbsrJM1whH93uUGVBR-wMyNt1pxvtEaasPWsTi0Ng@mail.gmail.com>

Hi,

  Could someone please clarify my doubt? I am really stuck on this issue?

Thanks,
Kals.

On Sat, Oct 31, 2015 at 9:55 AM, tech_kals Kals <tech.kals at gmail.com> wrote:

> could someone have a look at this qury ?
>
> Hi Ben,
>   Could you please clarify my doubt ?
>
> On Fri, Oct 30, 2015 at 1:29 PM, tech_kals Kals <tech.kals at gmail.com>
> wrote:
>
>> Hi folks,
>>
>> As per openflow specification, if port config bits are changed by the
>> switch through another administrative interface, the switch sends an
>> OFPT_PORT_STATUS message to notify the controller of the change. Does OVS
>> supports this functionality?
>>
>> If OVS doesn't support this then how a switch would inform the controller
>> when a port is configured to admin down through by some other
>> administrative interface like CLI.
>>
>> Can someone quickly clarify my doubt ?
>>
>> Thanks,
>> ~Kals~
>>
>>
>>
>>
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151102/58851966/attachment-0001.html>

From vrapelly at sonusnet.com  Mon Nov  2 03:11:24 2015
From: vrapelly at sonusnet.com (Rapelly, Varun)
Date: Mon, 2 Nov 2015 11:11:24 +0000
Subject: [ovs-discuss] networking-ovs-dpdk on ubuntu
Message-ID: <BY2PR0301MB1542415DFB2C27F9F3B0EAA3B72C0@BY2PR0301MB1542.namprd03.prod.outlook.com>

Hi All,

I'm trying to install networking-ovs-dpdk with openstack (devstack) on Ubuntu 14.04 (3.13 kernel) on a single node.

Used following steps:

1.       echo "stack ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

2.       apt-get install sudo -y

3.       apt-get install sudo -y || yum install -y sudo

4.       sudo apt-get install git -y || sudo yum install -y git

5.       git clone https://git.openstack.org/openstack-dev/devstack

6.       cd devstack

7.       ./stack.sh

stack at ubuntu:~/devstack$ ifconfig
eth0      Link encap:Ethernet  HWaddr 52:55:00:00:00:01
          inet addr:10.54.218.56  Bcast:10.54.218.255  Mask:255.255.255.0
          inet6 addr: fe80::5055:ff:fe00:1/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:104 errors:0 dropped:0 overruns:0 frame:0
          TX packets:102 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:10537 (10.5 KB)  TX bytes:14847 (14.8 KB)

I have two other eth1,2 ports on the machine.

I used https://github.com/openstack/networking-ovs-dpdk/blob/master/doc/source/_downloads/local.conf.single_node file as local.conf<https://github.com/openstack/networking-ovs-dpdk/blob/master/doc/source/_downloads/local.conf.single_node%20file%20as%20local.conf> and copied the
same to devstack directory and updated with following details.

I'm facing problem with following configuration.

stack at ubuntu:~/devstack$ cat local.conf
#All in one single node config
[[local|localrc]]
HOST_IP_IFACE=eth0
HOST_IP=10.54.218.56
OVS_BRIDGE_MAPPINGS="default:br-eth0"

With the above configuration, I'm loosing the management connection of the host.

Log shows:
2015-11-02 16:06:13.752 | libvirt-bin start/running, process 11517
2015-11-02 16:06:13.752 | loading OVS_INTERFACE_DRIVER diver
2015-11-02 16:06:13.753 | Unloading any existing DPDK UIO module
2015-11-02 16:06:13.761 | Loading uio module
2015-11-02 16:06:13.768 | Loading DPDK UIO module
2015-11-02 16:06:13.773 | starting ovs db
2015-11-02 16:06:13.773 | binding nics
2015-11-02 16:06:13.773 | starting vswitchd
2015-11-02 16:06:13.969 | sudo ovs-vsctl --no-wait -- --may-exist add-port  eth1
2015-11-02 16:06:13.974 | ovs-vsctl: 'add-port' command requires at least 2 arguments
2015-11-02 16:06:15.033 | Waiting for ovs-vswitchd to start...
2015-11-02 16:06:16.041 | Waiting for ovs-vswitchd to start...
2015-11-02 16:06:17.050 | Waiting for ovs-vswitchd to start...
2015-11-02 16:06:18.058 | Waiting for ovs-vswitchd to start...
2015-11-02 16:06:19.066 | Waiting for ovs-vswitchd to start...
2015-11-02 16:06:20.074 | Waiting for ovs-vswitchd to start...
2015-11-02 16:06:21.076 | /etc/init.d/ovs-dpdk: line 483: [: 2015-11-02T16:06:20Z|00005|reconnect|INFO|unix:/var/run/openvswitch/db.sock:: unary operator expected

Please let me know:

1.       Do we need to update any other files along with copying local.conf to devstack directory?

2.       In OVS_BRIDGE_MAPPINGS="default:br-eth0", do I need to change the interface to some other interface?

3.       I would like to build DPDK with "x86_64-native-linuxapp-gcc", where should I update this?

4.       I would like to create the ovs-dpdk vhostuser ports, with the other two eth ports, ie.., eth1 & eth2. Where should I update the config for this?

FYI: DPDK: 2.0.0 version OVS: 2.4.0
stack at ubuntu:~/devstack$ uname -a
Linux ubuntu 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux




Regards,
Varun

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151102/2741ce27/attachment-0001.html>

From ravulakollu.kumar at wipro.com  Mon Nov  2 06:27:21 2015
From: ravulakollu.kumar at wipro.com (ravulakollu.kumar at wipro.com)
Date: Mon, 2 Nov 2015 14:27:21 +0000
Subject: [ovs-discuss] vlan_tci flow key attribute becoming zero
Message-ID: <SG2PR03MB07964C9CDA7F15D11C1A4228E42C0@SG2PR03MB0796.apcprd03.prod.outlook.com>

Hello All,

I am using openvswitch 2.4  version , compiled under centos 7 (kernel version 3.18.22) .  I am sending double tagged traffic to one trunk port , the same
and coming out from the other trunk port (vswitchd is configured in normal mode flow operation).
But somehow the vlan ID is becoming zero in the flow key. I believe it should show the outer vlan ID. Is this a bug or what  please, let me know .

Thanks & Regards,
Uday
The information contained in this electronic message and any attachments to this message are intended for the exclusive use of the addressee(s) and may contain proprietary, confidential or privileged information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately and destroy all copies of this message and any attachments. WARNING: Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. The company accepts no liability for any damage caused by any virus transmitted by this email. www.wipro.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151102/1b8f999d/attachment.html>

From azhou at nicira.com  Mon Nov  2 10:05:37 2015
From: azhou at nicira.com (Andy Zhou)
Date: Mon, 2 Nov 2015 10:05:37 -0800
Subject: [ovs-discuss] [openvswitch 2.3.2] testsuite: 717 fails on s390x
In-Reply-To: <56374FA0.6090709@linux.vnet.ibm.com>
References: <5630D413.10904@linux.vnet.ibm.com>
 <CACzMAJLBhkbksmMj6F0=B0VqpXweTdGOvehtc5hcD1fs91BDMw@mail.gmail.com>
 <563213A8.6080700@linux.vnet.ibm.com>
 <CACzMAJKpuhbhRdyaqb0m4cA7KQrv5Sj8kwnsm5z+ZAg3PHH58g@mail.gmail.com>
 <CACzMAJKSnUTFP7Fx=Fk-s4vHokB2=7b+BXLXF4e3c2v+mD0DiQ@mail.gmail.com>
 <56374FA0.6090709@linux.vnet.ibm.com>
Message-ID: <CACzMAJL-gF25GCbjtprueJAA+-vRLwY=xi-iaWPbgGMjZxHTOA@mail.gmail.com>

On Mon, Nov 2, 2015 at 3:57 AM, Gerhard Stenzel
<gstenzel at linux.vnet.ibm.com> wrote:
> On 10/30/2015 07:33 PM, Andy Zhou wrote:
>>>
>>> Thanks for the information. I have never ran into this failure, but
>>> now I can see how it is possible. It seems we
>>> should also not match the exact value of recirc_id.  I will post a
>>> patch for this.
>>
>>
>> This is done, I have pushed the patch to master, branch-2.4 and 2.3.
>>>
>>>
>>> In the mean time, I will merge
>>> 8ae8176fd0d8ed919e3301cc961dcf02b65ff49d into branch-2.3.
>>
>>
>> This is done as well.
>>
>
> testcase 717 passes now on .. thanks for the patch.
>
Glad to hear. Thanks for the feedback!

From nick.bastin at gmail.com  Mon Nov  2 10:21:06 2015
From: nick.bastin at gmail.com (Nicholas Bastin)
Date: Mon, 2 Nov 2015 13:21:06 -0500
Subject: [ovs-discuss] In-band comm with OF-only Switches
In-Reply-To: <OF304AFDC1.8E63AFAA-ON88257EF1.005A4C61-87257EF1.00633FE1@selinc.com>
References: <OF72A47138.643BB0BE-ON88257EED.00554FFF-87257EED.00560815@selinc.com>
 <CADmMkWcUb57Kviewbq9Qf=90jUMzo83Ok9c2k=L5L27=oda8MA@mail.gmail.com>
 <OF304AFDC1.8E63AFAA-ON88257EF1.005A4C61-87257EF1.00633FE1@selinc.com>
Message-ID: <CADmMkWfVfRjVk2ypeqC8H__tduQPT_NR0vY0k8+D+90_as8N4Q@mail.gmail.com>

On Mon, Nov 2, 2015 at 1:04 PM, <gavin_remaley at selinc.com> wrote:

> Thanks for the reply.  My main concern here is the set of default flows
> that must already be running in each OF-only Switch in order for the
> Controller to reach them and program them.
>

There are not necessarily any pre-existing flows - that is an
implementation detail.  What there must be is *some* kind of pre-existing
"configuration" - implementation as flows or something else doesn't really
matter.


> It seems that those default flows have to allow for certain traffic
> to/from all next-hop devices... just as the existing OVS default flows do.  But
> as mentioned, the current OVS default flows seem to be intended for a
> hybrid Switch.  In a true OF-only Switch, it seems that we have to just
> send requests to port LOCAL.  The Switch will respond to requests such as
> ARP... so we get a ARP (response) packet from port LOCAL and we have to
> send it out.  Without any hybrid type intelligence (port/MAC
> associations?), we are left to flood that response out all ports.  That
> seems less than ideal, but perhaps is what has to be done... short of
> something that requires more direct configuration via a UI or some other
> less general set up option.


There are many ways this can work, although it's best not to think about
this with only the constraints of openflow (e.g. LOCAL port).  Pure OF
switches have functionality and configuration that is outside the purview
of the OpenFlow specification.

Two common mechanisms are to configure the control plane connection as
either being on a specific front-panel port (which also handles data-plane
traffic, so this is still "in-band"), or on a specific VLAN.   In the case
of a specific port the initial ARP is sent out that port, and assuming your
controller is directly connected to it (for the first switch), or has
properly configured flows (for later switches in the tree), this ARP
reaches your controller host and the response is sent back.  After that you
can establish a control plane connection and then insert flows for the next
downstream hop.  Note that the switch implementation must take particular
care not to drop the control connection as soon as it creates it (this is
sortof what the "hidden flows" are for - so you never lose your connection
when the flow table is empty but you're in fail-secure mode, but whether
those are hidden flows or some other implementation is not relevant).  If
the configuration is by VLAN then this is similar, but the ARP is flooded
out all ports, tagged with the management VLAN.  Ultimately using a
specific port isn't a good long-term plan, as it significantly limits your
ability to handle link failures.

There are other options as well, but really the implementation is not
particularly important - the way this works is the controller is the root
of a spanning tree, and the switches are configured in whatever way they
support to allow them to become functioning members of the control
network.  If a switch claims to support "in-band" control, it will have
*some* mechanism that works to configure this (otherwise your vendor is
lying to you).

--
Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151102/1628baf4/attachment.html>

From er.manpreet25 at gmail.com  Tue Nov  3 05:46:31 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Tue, 3 Nov 2015 19:16:31 +0530
Subject: [ovs-discuss] Select Group Type
Message-ID: <CALD=K8ucW0Y6m11=4Xn5ExpZ5fzsHsJknjW2FqUnc8ap_MtEFg@mail.gmail.com>

Hi All,

I am working on ovs 2.3.2 using openflow13, i have a query regarding select
group type that
 if weights are not define for group type= select and having multiple
buckets, then which bucket execute first.

Is there any mechanism define in ovs 2.3.2 for this ??

Regards,
Manpreet Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151103/25f5de1c/attachment.html>

From blp at nicira.com  Tue Nov  3 08:27:19 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 08:27:19 -0800
Subject: [ovs-discuss] Select Group Type
In-Reply-To: <CALD=K8ucW0Y6m11=4Xn5ExpZ5fzsHsJknjW2FqUnc8ap_MtEFg@mail.gmail.com>
References: <CALD=K8ucW0Y6m11=4Xn5ExpZ5fzsHsJknjW2FqUnc8ap_MtEFg@mail.gmail.com>
Message-ID: <20151103162719.GA11814@nicira.com>

On Tue, Nov 03, 2015 at 07:16:31PM +0530, Manpreet Singh wrote:
> I am working on ovs 2.3.2 using openflow13, i have a query regarding select
> group type that
>  if weights are not define for group type= select and having multiple
> buckets, then which bucket execute first.
> 
> Is there any mechanism define in ovs 2.3.2 for this ??

OVS 2.3 chooses a select group based on destination Ethernet address.
OVS 2.4 makes it configurable, see the documentation.

From gavin_remaley at selinc.com  Mon Nov  2 10:04:24 2015
From: gavin_remaley at selinc.com (gavin_remaley at selinc.com)
Date: Mon, 2 Nov 2015 11:04:24 -0700
Subject: [ovs-discuss] In-band comm with OF-only Switches
In-Reply-To: <CADmMkWcUb57Kviewbq9Qf=90jUMzo83Ok9c2k=L5L27=oda8MA@mail.gmail.com>
References: <OF72A47138.643BB0BE-ON88257EED.00554FFF-87257EED.00560815@selinc.com>
 <CADmMkWcUb57Kviewbq9Qf=90jUMzo83Ok9c2k=L5L27=oda8MA@mail.gmail.com>
Message-ID: <OF304AFDC1.8E63AFAA-ON88257EF1.005A4C61-87257EF1.00633FE1@selinc.com>

Thanks for the reply.  My main concern here is the set of default flows 
that must already be running in each OF-only Switch in order for the 
Controller to reach them and program them.

It seems that those default flows have to allow for certain traffic 
to/from all next-hop devices... just as the existing OVS default flows do. 
 But as mentioned, the current OVS default flows seem to be intended for a 
hybrid Switch.  In a true OF-only Switch, it seems that we have to just 
send requests to port LOCAL.  The Switch will respond to requests such as 
ARP... so we get a ARP (response) packet from port LOCAL and we have to 
send it out.  Without any hybrid type intelligence (port/MAC 
associations?), we are left to flood that response out all ports.  That 
seems less than ideal, but perhaps is what has to be done... short of 
something that requires more direct configuration via a UI or some other 
less general set up option.

Thanks.



From:   Nicholas Bastin <nick.bastin at gmail.com>
To:     gavin_remaley at selinc.com
Cc:     "discuss at openvswitch.org" <discuss at openvswitch.org>
Date:   10/30/2015 08:08 PM
Subject:        Re: [ovs-discuss] In-band comm with OF-only Switches



On Thu, Oct 29, 2015 at 8:39 AM, <gavin_remaley at selinc.com> wrote:
Has a general strategy been established for establishing initial in-band 
communication with OF-only Switches?

Do you mean OF-only OVS instances, or just OF-only switches in general?

For run-of-the-mill OF-only switches the strategy is a fairly simply 
fan-out from the switch(es) your controller is connected to, slowly 
working out to the edge of the network as you install rules in each switch 
along the way to bring control packets back to your controller.

In an environment with no drops or failures it's completely trivial.  If 
you encounter topology changes during the initial process it's a bit more 
complex, but nothing too problematic.  More complexity can come into play 
if you have OF-only devices that can't make a deep enough packet match to 
discriminate control traffic from other traffic you'd like to treat 
differently, but that's life.

--
Nick 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151102/44c17268/attachment-0001.html>

From dongkansheng at chinamobile.com  Mon Nov  2 19:10:14 2015
From: dongkansheng at chinamobile.com (dongkansheng)
Date: Tue, 3 Nov 2015 11:10:14 +0800
Subject: [ovs-discuss] how to keep flows from being cleaned when controller
	becomes out of service.
Message-ID: <001c01d115e5$28fb58b0$7af20a10$@chinamobile.com>

Hi guys,

I connect ovs to opendaylight controller, and write flows to ovs through the
controller.

After the controller becoming out of service, I found that the flows in the
ovs will be cleaned sometimes.

 

I wonder how to keep the flows from being cleaned when controller becomes
out of service ?

 

=============

Thanks

Best Regards

Kansheng Dong

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151103/4fc2b9e0/attachment-0001.html>

From tech.kals at gmail.com  Mon Nov  2 22:05:49 2015
From: tech.kals at gmail.com (tech_kals Kals)
Date: Tue, 3 Nov 2015 11:35:49 +0530
Subject: [ovs-discuss] ofproto: Send port status message for port-mods
	from OVS to controller
In-Reply-To: <CAHWErLeuKFbsrJM1whH93uUGVBR-wMyNt1pxvtEaasPWsTi0Ng@mail.gmail.com>
References: <CAHWErLdbB+FeBdp+ye3crkgGvjKeLh+D4B6Ui5Q-CHWmRUQ2ug@mail.gmail.com>
 <CAHWErLcE_Jj_mw804B=NJQzT_S3+k664LLESV1+VCFeCec-YyA@mail.gmail.com>
 <CAHWErLeuKFbsrJM1whH93uUGVBR-wMyNt1pxvtEaasPWsTi0Ng@mail.gmail.com>
Message-ID: <CAHWErLcN1t03SoHhUBRz+yxH4YzZzjLKKun3uSxdLtiARdf4=Q@mail.gmail.com>

Hi all,

  can someone please have a look at my query? Should I explain in depth ?
am really surprised when i dont get any answer to this question?


On Mon, Nov 2, 2015 at 9:24 AM, tech_kals Kals <tech.kals at gmail.com> wrote:

> Hi,
>
>   Could someone please clarify my doubt? I am really stuck on this issue?
>
> Thanks,
> Kals.
>
> On Sat, Oct 31, 2015 at 9:55 AM, tech_kals Kals <tech.kals at gmail.com>
> wrote:
>
>> could someone have a look at this qury ?
>>
>> Hi Ben,
>>   Could you please clarify my doubt ?
>>
>> On Fri, Oct 30, 2015 at 1:29 PM, tech_kals Kals <tech.kals at gmail.com>
>> wrote:
>>
>>> Hi folks,
>>>
>>> As per openflow specification, if port config bits are changed by the
>>> switch through another administrative interface, the switch sends an
>>> OFPT_PORT_STATUS message to notify the controller of the change. Does OVS
>>> supports this functionality?
>>>
>>> If OVS doesn't support this then how a switch would inform the
>>> controller when a port is configured to admin down through by some other
>>> administrative interface like CLI.
>>>
>>> Can someone quickly clarify my doubt ?
>>>
>>> Thanks,
>>> ~Kals~
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151103/5964ecc0/attachment-0001.html>

From cristi.calin at orange.com  Tue Nov  3 01:55:20 2015
From: cristi.calin at orange.com (cristi.calin at orange.com)
Date: Tue, 3 Nov 2015 09:55:20 +0000
Subject: [ovs-discuss] linux kernel 3.19 compatibility
Message-ID: <10046_1446544525_5638848D_10046_1379_1_2142BFD7C911CC4CBEF9DC1D6E9A61AC01221C3B@EASTON.office.orange.intra>

Hi,


We are running an openstack instance with kernel 3.19 (due to some bugs in a Broadcom NIC we have in our server we had to use this particular kernel version) from Ubuntu 14.04.
The openvswitch build from our vendor is version 2.3.1 which our vendor only supports on version 3.13.
We have observed two issues so far when running in this configuration:

*         We had to disable GRO on the uplinks to our ovs, otherwise vxlan forwarding would stall

*         We encountered an issue this morning where on some vlans traffic would not be forwarded at all to the uplink
Is there a specific version (or set of patches) of openvswitch which would be recommended with this particular kernel version ? (3.19.0-30-generic)


Thank you,
Cristian Calin



_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l'expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d'alteration,
Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.
Thank you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151103/6d7f9499/attachment-0001.html>

From praveen.mankara at 6wind.com  Tue Nov  3 02:33:39 2015
From: praveen.mankara at 6wind.com (Praveen MANKARA RADHAKRISHNAN)
Date: Tue, 3 Nov 2015 11:33:39 +0100
Subject: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
In-Reply-To: <2EF2F5C0CC56984AA024D0B180335FCB13CCEAE2@IRSMSX102.ger.corp.intel.com>
References: <CADCo8KC1S0FiZmWQCD_zaH5RYtX_SQBJu8vgr3b2_14vysyxOQ@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCE65D@IRSMSX102.ger.corp.intel.com>
 <CADCo8KDVdH_Rg_k_NwjyRc1sXxzxw9mOD6h4NkX5vw+1SkF7WQ@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCE8CD@IRSMSX102.ger.corp.intel.com>
 <CADCo8KAsFCPQL9mSBPLVCdyuGi0Qzs-SmFsWOccRWW2qOAKmaA@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCEAE2@IRSMSX102.ger.corp.intel.com>
Message-ID: <CADCo8KD5R-zjXGzsFwBgY-9OpimTTssPCdUigvoepo0GaqQ8gA@mail.gmail.com>

Hi Sugesh,

Thanks for the information.
by adding the flow in reverse direction OVS learns the arp and the scenario
works correctly.

Thanks
Praveen


On Wed, Oct 28, 2015 at 5:37 PM, Chandran, Sugesh <sugesh.chandran at intel.com
> wrote:

> Hi Praveen,
>
> Thank you sharing your setup details!
>
> It looks like the issue here is ovs doesn’t have the arp entry for remote
> end point i.e 10.200.0.6.
>
> Can you let OVS to learn the mac address for 10.200.0.6?? You can send a
> arp reply from Ixia port-2 to make it learn this value. Alternatively you
> can do the same with tnl/arp/set as well, but it looks like to me that the
> command not yet available on your OVS version.
>
> And also please remove the static flow rule that configured lately.
>
>
>
> You can verify the rules being used in the datapath with
>
> ovs-appctl dpctl/dump-flows
>
>
>
> There must be rules for `tnl_push`  for pushing the vxlan header and also
> for forward the packet to physical interface.
>
>
>
> *Regards*
>
> *_Sugesh*
>
>
>
> *From:* Praveen MANKARA RADHAKRISHNAN [mailto:praveen.mankara at 6wind.com]
> *Sent:* Wednesday, October 28, 2015 11:17 AM
>
> *To:* Chandran, Sugesh
> *Cc:* bugs at openvswitch.org; Daniel Virassamy
> *Subject:* Re: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
>
>
>
> Hi Sugesh,
>
>
>
> Thanks. but its still the same.It seems the packets are not getting
> forwarded from the vxlan interface.
>
> Please find the logs attached.
>
>
>
> root at ubuntu1404:~# ovs-vsctl show
>
> e2127cda-4b01-4020-8a6c-b5ff6be8f2fa
>
>     Bridge "br0"
>
>         Port "dpdk1"
>
>             Interface "dpdk1"
>
>                 type: dpdk
>
>         Port "vxlan0"
>
>             Interface "vxlan0"
>
>                 type: vxlan
>
>                 options: {remote_ip="10.200.0.6"}
>
>         Port "br0"
>
>             Interface "br0"
>
>                 type: internal
>
>     Bridge "br1"
>
>         Port "dpdk0"
>
>             Interface "dpdk0"
>
>                 type: dpdk
>
>         Port "br1"
>
>             Interface "br1"
>
>                 type: internal
>
>
>
>
>
> root at ubuntu1404:~# ovs-ofctl dump-flows br0
>
> NXST_FLOW reply (xid=0x4):
>
>  cookie=0x0, duration=341.284s, table=0, n_packets=1039, n_bytes=68574,
> idle_age=0, dl_vlan=1,dl_dst=02:11:22:44:55:22 actions=strip_vlan,output:2
>
>  cookie=0x0, duration=427.090s, table=0, n_packets=8, n_bytes=648,
> idle_age=324, priority=0 actions=NORMAL
>
>
>
>
>
> root at ubuntu1404:~# ovs-ofctl dump-flows br1
>
> NXST_FLOW reply (xid=0x4):
>
>  cookie=0x0, duration=66.576s, table=0, n_packets=0, n_bytes=0,
> idle_age=66, in_port=LOCAL actions=output:1
>
>  cookie=0x0, duration=401.153s, table=0, n_packets=8, n_bytes=648,
> idle_age=325, priority=0 actions=NORMAL
>
>
>
> root at ubuntu1404:~# ovs-appctl tnl/arp/show
>
> IP               MAC                 Bridge
>
> =============================================
>
> 10.200.0.5       b8:ca:3a:6f:16:c8   br1
>
>
>
> root at ubuntu1404:~# ovs-ofctl show br0
>
> OFPT_FEATURES_REPLY (xid=0x2): dpid:0000b8ca3a6f16ca
>
> n_tables:254, n_buffers:256
>
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
>
> actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src
> mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
>
>  1(dpdk1): addr:b8:ca:3a:6f:16:ca
>
>      config:     0
>
>      state:      0
>
>      current:    10GB-FD
>
>      supported:  1GB-FD FIBER AUTO_PAUSE
>
>      speed: 10000 Mbps now, 1000 Mbps max
>
>  2(vxlan0): addr:46:6f:4a:fd:94:75
>
>      config:     0
>
>      state:      0
>
>      speed: 0 Mbps now, 0 Mbps max
>
>  LOCAL(br0): addr:b8:ca:3a:6f:16:ca
>
>      config:     0
>
>      state:      0
>
>      current:    10MB-FD COPPER
>
>      speed: 10 Mbps now, 0 Mbps max
>
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
>
>
>
>
>
> As you can see in the br0 packets are reaching the vxlan interface and its
> not forwarding form there it seems dropped at vxlan interface.
>
>
>
> The same configurations is working without the dpdk.
>
> please refer  the attached diagram for my set up.
>
>
>
> Thanks
>
> Praveen
>
>
>
>
>
> On Wed, Oct 28, 2015 at 11:39 AM, Chandran, Sugesh <
> sugesh.chandran at intel.com> wrote:
>
> Hi Praveen,
>
>
>
> The arp entries are learned properly, if the packets are reaching at br1.
>
> Can you please confirm what flow rules are populated on br1 using ,
>
>                 ovs-ofctl dump-flows br1
>
>
>
> If there is no rules present, please add a rule to forward packet to the
> physical port as follows,
>
> ovs-ofctl add-flow br1 idle_timeout=0,in_port=LOCAL,action=output:1
>
>
>
>
>
> *Regards*
>
> *_Sugesh*
>
>
>
> *From:* Praveen MANKARA RADHAKRISHNAN [mailto:praveen.mankara at 6wind.com]
> *Sent:* Wednesday, October 28, 2015 10:05 AM
> *To:* Chandran, Sugesh
> *Cc:* bugs at openvswitch.org; Daniel Virassamy
> *Subject:* Re: [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
>
>
>
> Hi Sugesh,
>
>
>
> Thanks for the reply.
>
> arp entries are show in vs-appctl tnl/arp/show command. but it seems o
> packet is coming to the bridge with physical port.
>
>
>
> I have already tried to set using tnl/arp/set command but it seems set is
> not present in openvswitch 2.4
>
> it returns the following error.
>
>
>
> "
>
> ovs-appctl tnl/arp/set br0 10.200.0.6 02:11:22:44:55:11
>
> "tnl/arp/set" is not a valid command
>
> ovs-appctl: ovs-vswitchd: server returned an error "
>
>
>
> One important thing is to note that i was using dpdk-2.0.0. does that make
> any difference?
>
>
>
> Thanks
>
> Praveen
>
>
>
> On Tue, Oct 27, 2015 at 6:28 PM, Chandran, Sugesh <
> sugesh.chandran at intel.com> wrote:
>
>
>
>
>
> *Regards*
>
> *_Sugesh*
>
>
>
> *From:* discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of *Praveen
> MANKARA RADHAKRISHNAN
> *Sent:* Monday, October 26, 2015 5:23 PM
> *To:* bugs at openvswitch.org
> *Cc:* Daniel Virassamy
> *Subject:* [ovs-discuss] Test with vxlan using ovs-dpdk (2.4)
>
>
>
> HI,
>
>
>
> I am Praveen,
>
>
>
> I am trying a specific test scenario using ovs-dpdk.
>
>
>
> Test set up
>
> -------------------
>
>
>
> from the traffgen vlan packets are coming to dpdk interface its stripped
> using ovs command.
>
> and sending to a vxlan interface which is comnnected in theo other dpdk
> interface and send back to traffgen.
>
>
>
> i have done the vxlan set up similar to the sample test case.
>
>
>
> https://github.com/openvswitch/ovs/blob/master/README-native-tunneling.md
>
>
>
> the issue is that from the sumpflows i can see that packets are send to
> vxlan but it is not going to the other bridge.
>
>
>
> the same scenario is working without dpdk.
>
>
>
> I am using openvswitch-2.4.0.
>
>
>
> Linux (without dpdk)
>
> ---------------------------------
>
>
>
> ovs-vsctl add-br br0
>
> ovs-vsctl add-port br0 eth0
>
> ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
> options:remote_ip=10.200.0.6
>
> ovs-ofctl add-flow br0
> dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2
>
>
>
> ovs-vsctl add-br br1
>
> ovs-vsctl add-port br1 eth1
>
>
>
>  ip a a 10.200.0.5/24 dev br1
>
> arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2
>
>
>
> and from the traffgen i am sending traffic with dst mac 02:11:22:44:55:22
> and vlan id 1.
>
> it is correctly working.
>
>
>
> ovs-dpdk
>
> ------------------
>
>
>
> started ovs-dpdk ::
>
> ovs-vswitchd --dpdk -c 0x1 -n 4 -- unix:$DB_SOCK --pidfile --detach
>
>
>
> ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
>
> ovs-vsctl add-port br0 dpdk0 -- set Interface dpdk0 type=dpdk
>
>
>
> ovs-vsctl add-br br1 -- set bridge br1 datapath_type=netdev
>
> ovs-vsctl add-port br1 dpdk1 -- set Interface dpdk1 type=dpdk
>
>
>
> ovs-vsctl add-port br0 vxlan0 -- set interface vxlan0 type=vxlan
> options:remote_ip=10.200.0.6
>
> ovs-ofctl add-flow br0
> dl_vlan=1,dl_dst=02:11:22:44:55:22,actions=strip_vlan,output:2
>
>
>
>  ip a a 10.200.0.5/24 dev br1
>
> arp -s 10.200.0.6 02:11:22:44:55:11 -i eth2
>
>
>
>
>
> here i have started the ovs-dpddk and do the same set up
>
> but packets are not seen in bridge1 (br1) and in traffgen.
>
>
>
> is there any specif configuration i need to do in ovs-dpdk
>
> could it be because of the arp?
>
> Is there a way to set static arp to the ovs-dpdk?
>
> >>>> Does the arp entries shown properly in “ovs-appctl tnl/arp/show”???
>
> >>>>> You can set the arp entries using ovs-appctl tnl/arp/set <bridge>
> <ip> <mac>. In OVS-DPDK the DPDK interfaces are not managed by kernel so
> assigning static arp to physical interface may not work.
>
> Could you help in identifying the problem?
>
>
>
> Thanking you in advance
>
> Praveen
>
>
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151103/9362bb9b/attachment-0001.html>

From jpettit at nicira.com  Tue Nov  3 09:37:19 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 3 Nov 2015 09:37:19 -0800
Subject: [ovs-discuss] linux kernel 3.19 compatibility
In-Reply-To: <10046_1446544525_5638848D_10046_1379_1_2142BFD7C911CC4CBEF9DC1D6E9A61AC01221C3B@EASTON.office.orange.intra>
References: <10046_1446544525_5638848D_10046_1379_1_2142BFD7C911CC4CBEF9DC1D6E9A61AC01221C3B@EASTON.office.orange.intra>
Message-ID: <D04E8AFF-BCC5-4AC7-B287-83F639DB061C@nicira.com>


> On Nov 3, 2015, at 1:55 AM, <cristi.calin at orange.com> <cristi.calin at orange.com> wrote:
> 
> Hi,
>  
>  
> We are running an openstack instance with kernel 3.19 (due to some bugs in a Broadcom NIC we have in our server we had to use this particular kernel version) from Ubuntu 14.04.
> The openvswitch build from our vendor is version 2.3.1 which our vendor only supports on version 3.13.
> We have observed two issues so far when running in this configuration:
> ·         We had to disable GRO on the uplinks to our ovs, otherwise vxlan forwarding would stall
> ·         We encountered an issue this morning where on some vlans traffic would not be forwarded at all to the uplink
> Is there a specific version (or set of patches) of openvswitch which would be recommended with this particular kernel version ? (3.19.0-30-generic)

As mentioned in the FAQ, OVS 2.3 only supports up to kernel version 3.14.  Have you tried OVS 2.4?  If your vendor supplied to you the kernel and OVS, you could ask them what they did to make it work.

--Justin


-=-=-=-=-=-=-=-=-=-
Q: What Linux kernel versions does each Open vSwitch release work with?

A: The following table lists the Linux kernel versions against which the given versions of the Open vSwitch kernel module will successfully build. The Linux kernel versions are upstream kernel versions, so Linux kernels modified from the upstream sources may not build in some cases even if they are based on a supported version. This is most notably true of Red Hat Enterprise Linux (RHEL) kernels, which are extensively modified from upstream.

Open vSwitch	Linux kernel
1.4.x	2.6.18 to 3.2
1.5.x	2.6.18 to 3.2
1.6.x	2.6.18 to 3.2
1.7.x	2.6.18 to 3.3
1.8.x	2.6.18 to 3.4
1.9.x	2.6.18 to 3.8
1.10.x	2.6.18 to 3.8
1.11.x	2.6.18 to 3.8
2.0.x	2.6.32 to 3.10
2.1.x	2.6.32 to 3.11
2.3.x	2.6.32 to 3.14
2.4.x	2.6.32 to 4.0
2.5.x	2.6.32 to 4.2
Open vSwitch userspace should also work with the Linux kernel module built into Linux 3.3 and later.

Open vSwitch userspace is not sensitive to the Linux kernel version. It should build against almost any kernel, certainly against 2.6.32 and later.
-=-=-=-=-=-=-=-=-=-



From keith.holleman at gmail.com  Tue Nov  3 09:53:42 2015
From: keith.holleman at gmail.com (Keith Holleman)
Date: Tue, 3 Nov 2015 09:53:42 -0800
Subject: [ovs-discuss] Flooding to multiple patch ports
In-Reply-To: <CAOSDr99ssQrLgiimkm=JQn=hL4TFZUtC5hVhbids1riDHBSdoA@mail.gmail.com>
References: <CAOSDr99ssQrLgiimkm=JQn=hL4TFZUtC5hVhbids1riDHBSdoA@mail.gmail.com>
Message-ID: <CAOSDr9-42gHA8uygP+Ms-8t2c9gqmTnLbKh0_yw7T8jeg8voNQ@mail.gmail.com>

I should retract this request for help so as no one wastes any time on it.
I've figured out that is mostly working as expected after finding some some
flawed rule ordering in br1.  However would still welcome any comments or
insights if there is an easier/cleaner/more efficient way to achieve this.

On Thu, Oct 29, 2015 at 11:36 AM, Keith Holleman <keith.holleman at gmail.com>
wrote:

>
> I saw and followed the fairly recent discussion on the dev alias about
> flooding and patch ports here:
>
> http://openvswitch.org/pipermail/dev/2015-September/060118.html
>
> But I have a slightly different question.  In one setup, I have two patch
> ports connecting the same two bridges.  One bridge, is a "secure" bridge.
> While not actually managed by a controller, it effectively is as all rules
> are manually added in a very specific and controlled manner.  The other is
> a standard stock "learning" bridge with only a normal action.  To borrow
> and enhance the topology from the previous thread:
>
> port_A --- br1 --- port_B (patch) ........ port_C (patch) --- br2 --- port_D
>
>                --- port_E (patch) ........ port_F (patch) ---
>
>
>
> The unexpected behavior that I'm seeing is that a broadcast packet (say ARP) that arrives in br2 on patch port_C is not being flooded to patch port_F.   That packet is however proper flooded to port_D and any other ports (real or internal) in br2.  An ARP packet that arrives on port_D is properly flooded to both port_C and port_F.  The rules in BR1 do allow such a packet to arrive on port_A, leave on port_E, and if it returns on port_B to to have a different set of rules applied and may be resent out of port_A (or other ports in br1) after modifications.
>
>
> Other things learned from experiments:
>
>
> 1) a unicast frame that arrives on port_C destined for a MAC learned in br2 on port_F is properly forwarded out of port_F.  From this I assume there is not a complete failure in sending from one patch port to another between two bridges.
>
> 2) if I attach a new patch-port to br2 to another bridge (say br3), the arp packet that arrives on patch port_C is flooded on the new patch port to the new bridge.  From this I assume that you can flood across patch ports just fine.
>
>
> But there seems to be something or some check that is preventing a broadcast packet arriving on port_C to be flooded out of port_F?   Is there anything specific someone knows of that would prevent this or any specific output or debug that could shed light on it?
>
>
> Thanks for any help.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151103/11252d29/attachment.html>

From blp at nicira.com  Tue Nov  3 10:08:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 10:08:43 -0800
Subject: [ovs-discuss] [ovs-dev] vlan_tci flow key attribute becoming
	zero
In-Reply-To: <SG2PR03MB07964C9CDA7F15D11C1A4228E42C0@SG2PR03MB0796.apcprd03.prod.outlook.com>
References: <SG2PR03MB07964C9CDA7F15D11C1A4228E42C0@SG2PR03MB0796.apcprd03.prod.outlook.com>
Message-ID: <20151103180843.GE13445@nicira.com>

On Mon, Nov 02, 2015 at 02:27:21PM +0000, ravulakollu.kumar at wipro.com wrote:
> I am using openvswitch 2.4  version , compiled under centos 7 (kernel version 3.18.22) .  I am sending double tagged traffic to one trunk port , the same
> and coming out from the other trunk port (vswitchd is configured in normal mode flow operation).
> But somehow the vlan ID is becoming zero in the flow key. I believe it should show the outer vlan ID. Is this a bug or what  please, let me know .

OVS doesn't fully support multiple tags, but if you're not popping off
the outer tag then it should work OK.  Can you explain how to reproduce
the problem?

From blp at nicira.com  Tue Nov  3 10:36:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 10:36:03 -0800
Subject: [ovs-discuss] In Qos configuration,
 not for Peer network port configuration QOs
In-Reply-To: <FF2F4EC3D0CFB74A88792D19E6C1C8C8BE54D002@YT-MAIL-04.bingosoft.local>
References: <FF2F4EC3D0CFB74A88792D19E6C1C8C8BE54D002@YT-MAIL-04.bingosoft.local>
Message-ID: <20151103183603.GH13445@nicira.com>

Patch ports don't support QoS.

From blp at nicira.com  Tue Nov  3 10:37:05 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 10:37:05 -0800
Subject: [ovs-discuss] Then QOS configuration,
 queue id is not greater than 0xF000.
In-Reply-To: <FF2F4EC3D0CFB74A88792D19E6C1C8C8BE54CFD8@YT-MAIL-04.bingosoft.local>
References: <FF2F4EC3D0CFB74A88792D19E6C1C8C8BE54CFD8@YT-MAIL-04.bingosoft.local>
Message-ID: <20151103183705.GI13445@nicira.com>

Restrictions on queue IDs are documented in ovs-vswitchd.conf.db(5).

From blp at nicira.com  Tue Nov  3 10:37:58 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 10:37:58 -0800
Subject: [ovs-discuss] ofproto: Send port status message for port-mods
 from OVS to controller
In-Reply-To: <CAHWErLcN1t03SoHhUBRz+yxH4YzZzjLKKun3uSxdLtiARdf4=Q@mail.gmail.com>
References: <CAHWErLdbB+FeBdp+ye3crkgGvjKeLh+D4B6Ui5Q-CHWmRUQ2ug@mail.gmail.com>
 <CAHWErLcE_Jj_mw804B=NJQzT_S3+k664LLESV1+VCFeCec-YyA@mail.gmail.com>
 <CAHWErLeuKFbsrJM1whH93uUGVBR-wMyNt1pxvtEaasPWsTi0Ng@mail.gmail.com>
 <CAHWErLcN1t03SoHhUBRz+yxH4YzZzjLKKun3uSxdLtiARdf4=Q@mail.gmail.com>
Message-ID: <20151103183758.GJ13445@nicira.com>

I see a OFPT_PORT_STATUS message when a port goes down, e.g. when I run
"ifconfig eth0 down".

On Tue, Nov 03, 2015 at 11:35:49AM +0530, tech_kals Kals wrote:
> Hi all,
> 
>   can someone please have a look at my query? Should I explain in depth ?
> am really surprised when i dont get any answer to this question?
> 
> 
> On Mon, Nov 2, 2015 at 9:24 AM, tech_kals Kals <tech.kals at gmail.com> wrote:
> 
> > Hi,
> >
> >   Could someone please clarify my doubt? I am really stuck on this issue?
> >
> > Thanks,
> > Kals.
> >
> > On Sat, Oct 31, 2015 at 9:55 AM, tech_kals Kals <tech.kals at gmail.com>
> > wrote:
> >
> >> could someone have a look at this qury ?
> >>
> >> Hi Ben,
> >>   Could you please clarify my doubt ?
> >>
> >> On Fri, Oct 30, 2015 at 1:29 PM, tech_kals Kals <tech.kals at gmail.com>
> >> wrote:
> >>
> >>> Hi folks,
> >>>
> >>> As per openflow specification, if port config bits are changed by the
> >>> switch through another administrative interface, the switch sends an
> >>> OFPT_PORT_STATUS message to notify the controller of the change. Does OVS
> >>> supports this functionality?
> >>>
> >>> If OVS doesn't support this then how a switch would inform the
> >>> controller when a port is configured to admin down through by some other
> >>> administrative interface like CLI.
> >>>
> >>> Can someone quickly clarify my doubt ?
> >>>
> >>> Thanks,
> >>> ~Kals~
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>
> >

From blp at nicira.com  Tue Nov  3 10:38:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 10:38:59 -0800
Subject: [ovs-discuss] Removing an OVS bridge using iproute2
In-Reply-To: <CACom5vo2CL6aWzGiqvPGpsBi-gaeS5MxknYmp0BBg0n6UPqfug@mail.gmail.com>
References: <CACom5vo2CL6aWzGiqvPGpsBi-gaeS5MxknYmp0BBg0n6UPqfug@mail.gmail.com>
Message-ID: <20151103183859.GK13445@nicira.com>

On Thu, Oct 29, 2015 at 04:36:26PM -0700, Abhishek Chanda wrote:
> I am running OVS in a privileged container. It adds a bridge using
> "ovs-vsctl add-br br0". Once that container is removed, I need to
> return the host in a clean state. I was hoping to do this
> automatically by listening on docker events and running "sudo ip link
> del br0" once the container is destroyed. But iproute2 returns
> "operation not supported". These are the things I checked:
> 
> 1. The nfnetfilter module is loaded
> 2. The bridge does not show up in brctl but shows up when I do a "ip a"
> 
> Is there any way to make this work?

Use ovs-vsctl to delete an OVS bridge.

From blp at nicira.com  Tue Nov  3 10:43:47 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 10:43:47 -0800
Subject: [ovs-discuss] add-group issue
In-Reply-To: <CA+=-Fx9xp9TGYFk1W2uxAUtvZoP0gkU3xE=6ycEeFoC=xwmjaQ@mail.gmail.com>
References: <CA+=-Fx9xp9TGYFk1W2uxAUtvZoP0gkU3xE=6ycEeFoC=xwmjaQ@mail.gmail.com>
Message-ID: <20151103184347.GL13445@nicira.com>

On Thu, Oct 29, 2015 at 03:17:35PM -0700, Ray Li wrote:
> Hi, I reinstall my system and OVS 2.4 recently, and this used to work but
> isn't working anymore:
> 
> ovs-vsctl --may-exist add-br br -- set bridge br
> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
> 
> ovs-ofctl add-group br_vxlan group_id=2147483647,type=all -O OpenFlow15
> 
> At which point I get this error:
> 
> OFPT_ERROR (OF1.5) (xid=0x2): OFPGMFC_BAD_BUCKET
> OFPT_GROUP_MOD (OF1.5) (xid=0x2):
>  ADD group_id=2147483647,type=all
> 
> Any idea what it means? I'm not sure why it's no longer working for me.

This does work with OVS master (if I s/br_vxlan/br), maybe it was a bug
in 2.4.  We don't usually bother to fix bugs in only partially supported
versions of OpenFlow, in old versions of OVS.

However, probably OVS logs something when you do this, what does it log?

From blp at nicira.com  Tue Nov  3 10:49:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 10:49:43 -0800
Subject: [ovs-discuss] Flooding to multiple patch ports
In-Reply-To: <CAOSDr99ssQrLgiimkm=JQn=hL4TFZUtC5hVhbids1riDHBSdoA@mail.gmail.com>
References: <CAOSDr99ssQrLgiimkm=JQn=hL4TFZUtC5hVhbids1riDHBSdoA@mail.gmail.com>
Message-ID: <20151103184943.GM13445@nicira.com>

On Thu, Oct 29, 2015 at 11:36:48AM -0700, Keith Holleman wrote:
> I saw and followed the fairly recent discussion on the dev alias about
> flooding and patch ports here:
> 
> http://openvswitch.org/pipermail/dev/2015-September/060118.html
> 
> But I have a slightly different question.  In one setup, I have two patch
> ports connecting the same two bridges.  One bridge, is a "secure" bridge.
> While not actually managed by a controller, it effectively is as all rules
> are manually added in a very specific and controlled manner.  The other is
> a standard stock "learning" bridge with only a normal action.  To borrow
> and enhance the topology from the previous thread:
> 
> port_A --- br1 --- port_B (patch) ........ port_C (patch) --- br2 --- port_D
> 
>                --- port_E (patch) ........ port_F (patch) ---
> 
> 
> 
> The unexpected behavior that I'm seeing is that a broadcast packet
> (say ARP) that arrives in br2 on patch port_C is not being flooded to
> patch port_F.   That packet is however proper flooded to port_D and
> any other ports (real or internal) in br2.  An ARP packet that arrives
> on port_D is properly flooded to both port_C and port_F.  The rules in
> BR1 do allow such a packet to arrive on port_A, leave on port_E, and
> if it returns on port_B to to have a different set of rules applied
> and may be resent out of port_A (or other ports in br1) after
> modifications.
> 
> 
> Other things learned from experiments:
> 
> 
> 1) a unicast frame that arrives on port_C destined for a MAC learned
> in br2 on port_F is properly forwarded out of port_F.  From this I
> assume there is not a complete failure in sending from one patch port
> to another between two bridges.
> 
> 2) if I attach a new patch-port to br2 to another bridge (say br3),
> the arp packet that arrives on patch port_C is flooded on the new
> patch port to the new bridge.  From this I assume that you can flood
> across patch ports just fine.
> 
> 
> But there seems to be something or some check that is preventing a
> broadcast packet arriving on port_C to be flooded out of port_F?   Is
> there anything specific someone knows of that would prevent this or
> any specific output or debug that could shed light on it?

This is really unusual.  It's not related to disabled flooding on
port_F, since some packets do get flooded to port_F.  It's probably not
related to MAC learning, since it's a broadcast packet (though you might
want to check the MAC learning table just to be sure).

Have you tried running "ovs-appctl ofproto/trace" on an appropriate
packet to see the details of how OVS is processing this packet?

From blp at nicira.com  Tue Nov  3 11:33:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 11:33:04 -0800
Subject: [ovs-discuss] Active Queue Management Schemes in OVS
In-Reply-To: <CAC+zmpNjQJBp-UO1L741xjkUdARnRnp-38yCD0M09xOY3+Qdfw@mail.gmail.com>
References: <CAC+zmpNjQJBp-UO1L741xjkUdARnRnp-38yCD0M09xOY3+Qdfw@mail.gmail.com>
Message-ID: <20151103193304.GR13445@nicira.com>

On Wed, Oct 28, 2015 at 12:46:19AM +0530, Manojkumar Sure wrote:
>   Does OVS support Active Queue Management congestion control schemes like
> RED, BLUE,DECbit etc.? If yes, how do I enable them?

You can use Linux kernel QoS with Open vSwitch, so you should be able to
use whatever Linux supports.

From blp at nicira.com  Tue Nov  3 11:36:34 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 11:36:34 -0800
Subject: [ovs-discuss] ovs-dpdk:cannot link with dpdk
In-Reply-To: <C281A17C31CFD745B242416D0E96EC63943D2B6E@ONWVEXCHMB04.ciena.com>
References: <135cc283.10816.150a89ffcaa.Coremail.wangrongs163@163.com>
 <C281A17C31CFD745B242416D0E96EC63943D2B6E@ONWVEXCHMB04.ciena.com>
Message-ID: <20151103193634.GT13445@nicira.com>

On Tue, Oct 27, 2015 at 01:01:42PM -0400, Mussar, Gary wrote:
> The name of the dpdk library changed between dpsk-2.0.0 and
> dpdk-2.1.0. Ovs-2.4 builds against dpdk-2.0.0. You will need some
> patches to allow it to build against dpdk-2.1.0.

Since OVS needs such a specific version of DPDK, I wonder whether the
configure script should check the version number and verify that it's
acceptable?  I suspect that users aren't getting an easy-to-understand
error message when they use the wrong version.

From blp at nicira.com  Tue Nov  3 11:57:46 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 11:57:46 -0800
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
Message-ID: <20151103195746.GU13445@nicira.com>

On Tue, Oct 27, 2015 at 01:14:42AM -0500, V_Dham at Dell.com wrote:
> I am currently exploring Service Function Chaining (SFC)
> implementation using OVN and would like to hear thoughts from the
> community.
> 
> Has anyone implemented Service Function Chaining using OVN project and
> would be willing to share his/her experiences? There are proposals for
> adding NSH header as well as leveraging MPLS headers (interim solution
> for lack of NSH support) for SFC but can someone more experienced in
> this topic share if those modifications are really necessary for real
> world SFC use cases?
> 
> With the native support for L2 overlays and ACLs inherently built into
> OVN, I am wondering if we are better off creating point to point
> overlay networks between the VNFs and using ACLs for traffic
> classification. Or is there more to it than that?

Justin, Russell, Thomas, and I brainstormed together about SFC a bit in
Tokyo.  There was a brief discussion related to the topic on the
openstack-dev list last week as well (see the thread
"[neutron][networking-sfc] API clarification questions").  Thomas built
a strawman prototype, I believe, though as I understand it the
conversation on openstack-dev meant that it implemented an inadequate
model.

I don't know what the immediate plans are, but I expect that there'll be
a place for SFC in OVN.

From blp at nicira.com  Tue Nov  3 12:13:45 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 12:13:45 -0800
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <20151103195746.GU13445@nicira.com>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
 <20151103195746.GU13445@nicira.com>
Message-ID: <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>

On Nov 3, 2015 11:57 AM, "Ben Pfaff" <blp at nicira.com> wrote:
>
> On Tue, Oct 27, 2015 at 01:14:42AM -0500, V_Dham at Dell.com wrote:
> > I am currently exploring Service Function Chaining (SFC)
> > implementation using OVN and would like to hear thoughts from the
> > community.
> >
> > Has anyone implemented Service Function Chaining using OVN project and
> > would be willing to share his/her experiences? There are proposals for
> > adding NSH header as well as leveraging MPLS headers (interim solution
> > for lack of NSH support) for SFC but can someone more experienced in
> > this topic share if those modifications are really necessary for real
> > world SFC use cases?
> >
> > With the native support for L2 overlays and ACLs inherently built into
> > OVN, I am wondering if we are better off creating point to point
> > overlay networks between the VNFs and using ACLs for traffic
> > classification. Or is there more to it than that?
>
> Justin, Russell, Thomas, and I brainstormed together about SFC a bit in
> Tokyo.  There was a brief discussion related to the topic on the
> openstack-dev list last week as well (see the thread
> "[neutron][networking-sfc] API clarification questions").  Thomas built
> a strawman prototype, I believe, though as I understand it the
> conversation on openstack-dev meant that it implemented an inadequate
> model.
>
> I don't know what the immediate plans are, but I expect that there'll be
> a place for SFC in OVN.

Correction: Russell wrote the prototype.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151103/4fdd5ca1/attachment.html>

From blp at nicira.com  Tue Nov  3 12:42:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 12:42:06 -0800
Subject: [ovs-discuss] error while trying to build .deb package on
 ubuntu 14.10
In-Reply-To: <b566745d869548928a0e9f922850c895@VAADCEX18.cable.comcast.com>
References: <b566745d869548928a0e9f922850c895@VAADCEX18.cable.comcast.com>
Message-ID: <20151103204206.GC13445@nicira.com>

On Mon, Oct 26, 2015 at 09:27:19PM +0000, Zaidi, Mehwish (Contractor) wrote:
> Hi I am getting below error when I am executing command : fakeroot debian/rules binary
> 
> ../configure: line 13008: OVS_CHECK_PKIDIR: command not found
> ../configure: line 13009: OVS_CHECK_RUNDIR: command not found
> ../configure: line 13010: OVS_CHECK_DBDIR: command not found
> ../configure: line 13011: OVS_CHECK_BACKTRACE: command not found
> ../configure: line 13012: OVS_CHECK_PERF_EVENT: command not found
> ../configure: line 13013: OVS_CHECK_VALGRIND: command not found
> ../configure: line 13014: OVS_CHECK_SOCKET_LIBS: command not found
> checking XenServer release... none
> ../configure: line 13039: OVS_CHECK_GROFF: command not found
> checking whether make is GNU make... yes
> ../configure: line 13067: OVS_CHECK_TLS: command not found
> ../configure: line 13068: OVS_CHECK_ATOMIC_LIBS: command not found
> ../configure: line 13069: OVS_CHECK_GCC4_ATOMICS: command not found
> ../configure: line 13070: syntax error near unexpected token `1'
> ../configure: line 13070: `OVS_CHECK_ATOMIC_ALWAYS_LOCK_FREE(1)'
> make: *** [configure-stamp] Error 2

Install the build dependencies first.

From rbryant at redhat.com  Tue Nov  3 12:45:45 2015
From: rbryant at redhat.com (Russell Bryant)
Date: Tue, 3 Nov 2015 15:45:45 -0500
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
 <20151103195746.GU13445@nicira.com>
 <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>
Message-ID: <56391CF9.8000803@redhat.com>

On 11/03/2015 03:13 PM, Ben Pfaff wrote:
> On Nov 3, 2015 11:57 AM, "Ben Pfaff" <blp at nicira.com
> <mailto:blp at nicira.com>> wrote:
>>
>> On Tue, Oct 27, 2015 at 01:14:42AM -0500, V_Dham at Dell.com wrote:
>> > I am currently exploring Service Function Chaining (SFC)
>> > implementation using OVN and would like to hear thoughts from the
>> > community.
>> >
>> > Has anyone implemented Service Function Chaining using OVN project and
>> > would be willing to share his/her experiences? There are proposals for
>> > adding NSH header as well as leveraging MPLS headers (interim solution
>> > for lack of NSH support) for SFC but can someone more experienced in
>> > this topic share if those modifications are really necessary for real
>> > world SFC use cases?
>> >
>> > With the native support for L2 overlays and ACLs inherently built into
>> > OVN, I am wondering if we are better off creating point to point
>> > overlay networks between the VNFs and using ACLs for traffic
>> > classification. Or is there more to it than that?
>>
>> Justin, Russell, Thomas, and I brainstormed together about SFC a bit in
>> Tokyo.  There was a brief discussion related to the topic on the
>> openstack-dev list last week as well (see the thread
>> "[neutron][networking-sfc] API clarification questions").  Thomas built
>> a strawman prototype, I believe, though as I understand it the
>> conversation on openstack-dev meant that it implemented an inadequate
>> model.
>>
>> I don't know what the immediate plans are, but I expect that there'll be
>> a place for SFC in OVN.
> 
> Correction: Russell wrote the prototype.
> 

Yeah, I tried to build a prototype but it's inadequate for a few
reasons, so it needs a do-over. I think I understand the problem better,
at least. :-)

I basically modeled it as a chain of logical ports all on the same
logical switch.  If those constraints were valid, we can send the packet
through a chain without having to modify the source/dest IP, or even the
source/dest MAC.

We need to support more interesting chains, which means we need to pass
around some additional metadata.  We can do that with Geneve.  We also
need to expose some metadata about the chain into the VM (VNF) itself.
There's lots of ways we could do that, but there seems to be more
momentum behind NSH for this for whatever reason.  We can actually
decouple how we pass metadata between hosts from how we communicate
chain related metadata in/out of a VNF.

If NSH gets into OVS, we can use it for SFC as well.  It probably makes
sense to add NSH as a generic encap for OVN.  We could also use it only
to pass metadata in/out of a VNF if we wanted.

In the meantime, we can be working on how to model this properly in
OVN_Northbound, as well as trying to work out a reasonable
implementation based on Geneve.  The modeling in my prototype isn't
expressive enough.

-- 
Russell Bryant

From blp at nicira.com  Tue Nov  3 13:01:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 13:01:03 -0800
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <56391CF9.8000803@redhat.com>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
 <20151103195746.GU13445@nicira.com>
 <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>
 <56391CF9.8000803@redhat.com>
Message-ID: <20151103210103.GF13445@nicira.com>

On Tue, Nov 03, 2015 at 03:45:45PM -0500, Russell Bryant wrote:
> In the meantime, we can be working on how to model this properly in
> OVN_Northbound, as well as trying to work out a reasonable
> implementation based on Geneve.  The modeling in my prototype isn't
> expressive enough.

The model that I proposed in Tokyo was to make redirection through a
chain one of the possible actions for ACLs in the OVN_Northbound
database.  (I'm not claiming this is original or inspired; maybe you had
the same idea.)

Parameters would be needed, and that's probably the harder part.  I
don't know what the universe of reasonable ways to redirect through a
service includes.  I believe we mentioned that redirecting to an IP
address or a MAC address are both expected to be supported.  But that
leaves a lot of questions, such as:

        * Would each service be expected to be able to send the packet
          directly to the next service?  Or would it just bounce it back
          to OVN and OVN would redirect it again?

        * Would the services be able to preserve arbitrary Geneve (or
          NSH) metadata that OVN attaches to packets, so that it can be
          passed back to OVN on exit from the services?

        * Do the services themselves live in logical networks or are
          they identified by IP address (etc.) on a physical network?

Some of these might have obvious answers to people who work in the area
of NFV or SFC.

From rbryant at redhat.com  Tue Nov  3 13:15:40 2015
From: rbryant at redhat.com (Russell Bryant)
Date: Tue, 3 Nov 2015 16:15:40 -0500
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <20151103210103.GF13445@nicira.com>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
 <20151103195746.GU13445@nicira.com>
 <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>
 <56391CF9.8000803@redhat.com> <20151103210103.GF13445@nicira.com>
Message-ID: <563923FC.3070003@redhat.com>

On 11/03/2015 04:01 PM, Ben Pfaff wrote:
> On Tue, Nov 03, 2015 at 03:45:45PM -0500, Russell Bryant wrote:
>> In the meantime, we can be working on how to model this properly in
>> OVN_Northbound, as well as trying to work out a reasonable
>> implementation based on Geneve.  The modeling in my prototype isn't
>> expressive enough.
> 
> The model that I proposed in Tokyo was to make redirection through a
> chain one of the possible actions for ACLs in the OVN_Northbound
> database.  (I'm not claiming this is original or inspired; maybe you had
> the same idea.)

And have the chain be a list of parameters to the action?

My original thought was a new table of chains.  Each chain has a list of
service endpoints (originally i had this as logical ports, but it'd need
to be IP or MAC addresses, I guess).  A chain would also have a match
defined in the same syntax used by ACLs.  I imagined the implementation
in a separate logical flow table.

I guess both sound like the same thing, really.  It's just a matter of
how strictly the data gets structured in OVN_Northbound.  Doing it in
ACLs sounds pretty convenient and actually makes good sense when
thinking about where this fits into the logical flow stages.

> Parameters would be needed, and that's probably the harder part.  I
> don't know what the universe of reasonable ways to redirect through a
> service includes.  I believe we mentioned that redirecting to an IP
> address or a MAC address are both expected to be supported.  But that
> leaves a lot of questions, such as:
> 
>         * Would each service be expected to be able to send the packet
>           directly to the next service?  Or would it just bounce it back
>           to OVN and OVN would redirect it again?
>
>         * Would the services be able to preserve arbitrary Geneve (or
>           NSH) metadata that OVN attaches to packets, so that it can be
>           passed back to OVN on exit from the services?
> 
>         * Do the services themselves live in logical networks or are
>           they identified by IP address (etc.) on a physical network?
> 
> Some of these might have obvious answers to people who work in the area
> of NFV or SFC.

Good questions.  So far I haven't done a great job guessing correctly
when I've tried to guess the answers to things like this.  :-)

FWIW, it seems the API proposed for Neutron (networking-sfc) proposes
the services as members of logical networks.  You specify the chain in
terms of logical ports in that API.

I wonder how much of this OPNFV has specified?  This seems like the
perfect sort of thing OPNFV can help specify and work with upstream
projects to get implemented.

-- 
Russell Bryant

From blp at nicira.com  Tue Nov  3 13:29:01 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 13:29:01 -0800
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <563923FC.3070003@redhat.com>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
 <20151103195746.GU13445@nicira.com>
 <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>
 <56391CF9.8000803@redhat.com> <20151103210103.GF13445@nicira.com>
 <563923FC.3070003@redhat.com>
Message-ID: <20151103212901.GH13445@nicira.com>

On Tue, Nov 03, 2015 at 04:15:40PM -0500, Russell Bryant wrote:
> On 11/03/2015 04:01 PM, Ben Pfaff wrote:
> > On Tue, Nov 03, 2015 at 03:45:45PM -0500, Russell Bryant wrote:
> >> In the meantime, we can be working on how to model this properly in
> >> OVN_Northbound, as well as trying to work out a reasonable
> >> implementation based on Geneve.  The modeling in my prototype isn't
> >> expressive enough.
> > 
> > The model that I proposed in Tokyo was to make redirection through a
> > chain one of the possible actions for ACLs in the OVN_Northbound
> > database.  (I'm not claiming this is original or inspired; maybe you had
> > the same idea.)
> 
> And have the chain be a list of parameters to the action?

Yes.  That could be some kind of inline set of parameters in the ACL
table, or a reference to some new table.

> My original thought was a new table of chains.  Each chain has a list of
> service endpoints (originally i had this as logical ports, but it'd need
> to be IP or MAC addresses, I guess).  A chain would also have a match
> defined in the same syntax used by ACLs.  I imagined the implementation
> in a separate logical flow table.
> 
> I guess both sound like the same thing, really.  It's just a matter of
> how strictly the data gets structured in OVN_Northbound.  Doing it in
> ACLs sounds pretty convenient and actually makes good sense when
> thinking about where this fits into the logical flow stages.

Some differences:

        * If chains are a separate table then one must define whether
          ACLs are applied before or after service chains.  If chains
          are part of the ACL table then some ACLs could have higher
          priority than chaining, which could be a useful way to drop
          some packets without bothering to process them through chains.

        * Only a single ACL can apply to a packet (on ingress or egress)
          so using ACLs for chains would prevent doing connection
          tracking ACLs for packets that pass through chains.  I don't
          know whether users would want to combine them but if so then
          this would be a problem.

I guess another way to handle it would be to add a new chains table as
you suggest, and then add another ACL direction, so that you'd have
from-lport-pre-chains, from-lport-post-chains, and to-lport directions.
Sort of like prerouting, postrouting, etc. in iptables.  At that point
I'm not sure that "direction" is the right vocabulary word but we can
paint that bikeshed when we get there.

> I wonder how much of this OPNFV has specified?  This seems like the
> perfect sort of thing OPNFV can help specify and work with upstream
> projects to get implemented.

Yes, I think so too.

From blp at nicira.com  Tue Nov  3 17:11:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 17:11:24 -0800
Subject: [ovs-discuss] Problem about QueueGetConfig message
In-Reply-To: <562F0D39.4020402@gmail.com>
References: <5629A14A.9030207@gmail.com> <20151024201851.GB19511@nicira.com>
 <562DAA63.4040301@gmail.com> <20151026045126.GE31441@nicira.com>
 <562F0D39.4020402@gmail.com>
Message-ID: <20151104011124.GB17568@nicira.com>

I sent out an implementation:
        http://openvswitch.org/pipermail/dev/2015-November/061811.html
        http://openvswitch.org/pipermail/dev/2015-November/061812.html

Please consider testing and reviewing it.

(But it's hard for me to believe that this is genuinely useful.)

Thanks,

Ben.

On Tue, Oct 27, 2015 at 02:35:53PM +0900, Minoru TAKAHASHI wrote:
> Hi,
> 
> On 2015年10月26日 13:51, Ben Pfaff wrote:
> > It seems that this is a missing feature.
> 
> OK, I understood.
> I am waiting for this feature to be implemented.
> 
> thanks,
> 
> > 
> > On Mon, Oct 26, 2015 at 01:21:55PM +0900, Minoru TAKAHASHI wrote:
> >> Hi Ben,
> >>
> >> Thank you for your reply!
> >>
> >> On 2015年10月25日 05:18, Ben Pfaff wrote:
> >>> On Fri, Oct 23, 2015 at 11:54:02AM +0900, Minoru TAKAHASHI wrote:
> >>>> Hi,
> >>>>
> >>>> I send QueueGetConfig message(*OFPP_ANY* was set to port) to OVS(openflow1.3),
> >>>> then the following errors occured.
> >>>>
> >>>>  Version: 1.3 (0x04)
> >>>>  Type: OFPET_QUEUE_OP_FAILED (9)
> >>>>  Code: OFPQOFC_BAD_PORT (0)
> >>>>
> >>>> Is this a bug?
> >>>
> >>> It works OK here, so you'll have to be more specific.  First add a
> >>> bridge and turn on OpenFlow 1.3:
> >>>
> >>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl add-br br0
> >>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-vsctl set bridge br0 protocols=OpenFlow13
> >>>
> >>> Then request all queue stats:
> >>>
> >>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -O OpenFlow13 queue-stats br0
> >>>     OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
> >>>
> >>> Or with more detailed logging to show that it's using OFPP_ANY:
> >>
> >> Yes, I know "queue stats request" works fine now.
> >> However, I was talking about "queue get config request" in previous mail.
> >>
> >> thanks,
> >>
> >>>
> >>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ ovs-ofctl -vvconn -O OpenFlow13 queue-stats br0
> >>>     2015-10-24T20:17:52Z|00001|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPT_HELLO (OF1.3) (xid=0x1):
> >>>      version bitmap: 0x04
> >>>     2015-10-24T20:17:52Z|00002|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPT_HELLO (OF1.3) (xid=0x2):
> >>>      version bitmap: 0x04
> >>>     2015-10-24T20:17:52Z|00003|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: negotiated OpenFlow version 0x04 (we support version 0x04, peer supports version 0x04)
> >>>     2015-10-24T20:17:52Z|00004|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: sent (Success): OFPST_QUEUE request (OF1.3) (xid=0x2):port=ANY queue=ALL
> >>>     2015-10-24T20:17:52Z|00005|vconn|DBG|unix:/home/blp/nicira/ovs/tutorial/sandbox/br0.mgmt: received: OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
> >>>     OFPST_QUEUE reply (OF1.3) (xid=0x2): 0 queues
> >>>     blp at sigabrt:~/nicira/ovs/tutorial(0)$ 
> >>>

From blp at nicira.com  Tue Nov  3 17:17:03 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 17:17:03 -0800
Subject: [ovs-discuss] Push Vlan over a ARP packet
In-Reply-To: <CAHN905Km45d85+dxw_quQLRNfSE6V1ub6ojS2yuJLoKV+nAZ5w@mail.gmail.com>
References: <CAHN905Km45d85+dxw_quQLRNfSE6V1ub6ojS2yuJLoKV+nAZ5w@mail.gmail.com>
Message-ID: <20151104011703.GC17568@nicira.com>

On Fri, Oct 23, 2015 at 02:53:52PM +0530, neeraj mehta wrote:
> I want to know can I apply push vlan over a ARP packet.
> Is it correct to do so?

The usual OpenFlow actions should work just as well for ARP as for other
packets.  ovs-ofctl(8) has some documentation.

From blp at nicira.com  Tue Nov  3 17:25:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 17:25:10 -0800
Subject: [ovs-discuss] Regarding Support of muli level vlan tagging
In-Reply-To: <CABAVfZfQWsNyTVGPMyBOOWqHj8BbEZ7QUbwWvgEm3nsruFm4gQ@mail.gmail.com>
References: <CABAVfZfQWsNyTVGPMyBOOWqHj8BbEZ7QUbwWvgEm3nsruFm4gQ@mail.gmail.com>
Message-ID: <20151104012510.GF17568@nicira.com>

On Wed, Oct 21, 2015 at 04:06:40PM +0530, Prakash Pawar wrote:
> As Open vSwitch 2.3.1 support OpenFlow version 1.3 .
> OpenFlow 1.3  has explicit actions to add, modify and remove VLAN tags, and
> can support multiple levels of VLAN tagging.
> I am trying to test multi level of VLAN tagging.
> But so for no sucess.
> I am getting OFBadActionErrorMsgVer13(xid=1767, code=BAD_TAG, on controller
> (Floodlight 1.1). I am using 0x8100 for inner tag and 0x9100 for outer tag.
> Please help me  in sloving the issue.

OVS doesn't support multiple tags.

From blp at nicira.com  Tue Nov  3 17:26:28 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 17:26:28 -0800
Subject: [ovs-discuss] problem in dumping table features
In-Reply-To: <CAEYh440aeBbA8mfmy=fvcVSvh3MX88n06d-Q+CLegOpf-NU++Q@mail.gmail.com>
References: <CAEYh440aeBbA8mfmy=fvcVSvh3MX88n06d-Q+CLegOpf-NU++Q@mail.gmail.com>
Message-ID: <20151104012628.GG17568@nicira.com>

On Wed, Oct 21, 2015 at 04:36:47PM +0530, Dheeraj Bansal wrote:
> Can anyone please tell me why dump table features command is not working?.
> 
> ovs-ofctl -O openflow13 dump-table-features br0

It works OK here, so we'll need more details.

From blp at nicira.com  Tue Nov  3 17:37:48 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 17:37:48 -0800
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
In-Reply-To: <CALD=K8vrp7S=S1r0M928xXTZ7b7asukFeECXLY7Z67QqkZXLBw@mail.gmail.com>
References: <CALD=K8v=j+zb6FP4VW26BSoU4yHyBkznevoe0yR_ykvRomrxZA@mail.gmail.com>
 <20151019152057.GA20995@nicira.com>
 <CALD=K8vrp7S=S1r0M928xXTZ7b7asukFeECXLY7Z67QqkZXLBw@mail.gmail.com>
Message-ID: <20151104013748.GJ17568@nicira.com>

So, you've complained about this a number of times.

Can you explain why you want to send an invalid flags value?

On Mon, Oct 19, 2015 at 11:22:23PM +0530, Manpreet Singh wrote:
> I am using openflow 1.3.0
> 
> On Monday, 19 October 2015, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Mon, Oct 19, 2015 at 10:40:42AM +0530, Manpreet Singh wrote:
> > > I am working on OVS-2.3.2.I am sending invalid value of ofp_config_flags
> > in
> > > OFPT_SET_CONFIG message from controller, then sending
> > > OFPT_GET_CONFIG_REQUEST message the switch reply with
> > OFPT_GET_CONFIG_REPLY
> > > message having frag=normal.
> > >
> > > I think for invalid flag value the switch must generate an error but it
> > > will set frag to normal.
> > >
> > > Is my understanding is correct or not ?
> >
> > What version of OpenFlow?
> >
> 
> 
> -- 
> Sent from iphone

From blp at nicira.com  Tue Nov  3 19:36:56 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 19:36:56 -0800
Subject: [ovs-discuss]
 =?utf-8?b?562U5aSNOiAgVGhlbiBRT1MgY29uZmlndXJhdGlv?=
 =?utf-8?q?n=2C_queue_id_is_not_greater_than_0xF000=2E?=
In-Reply-To: <FF2F4EC3D0CFB74A88792D19E6C1C8C8BE54D2C3@YT-MAIL-04.bingosoft.local>
References: <FF2F4EC3D0CFB74A88792D19E6C1C8C8BE54CFD8@YT-MAIL-04.bingosoft.local>
 <20151103183705.GI13445@nicira.com>
 <FF2F4EC3D0CFB74A88792D19E6C1C8C8BE54D2C3@YT-MAIL-04.bingosoft.local>
Message-ID: <20151104033656.GN17568@nicira.com>

Please don't drop the mailing list.

The manpage says:

     Configuration for linux-htb QoS:
       QoS  type linux-htb may use queue_ids less than 61440.  It has the fol‐
       lowing key-value pairs defined.

...

     Configuration for linux-hfsc QoS:
       QoS type linux-hfsc may use queue_ids less than 61440.  It has the fol‐
       lowing key-value pairs defined.


On Wed, Nov 04, 2015 at 03:33:35AM +0000, 林冬艺 wrote:
>        
> 
> I saw ovs-vswitch.conf.db, it shows limitations queue ID is 0 to 4,294,967,295. But I actually used for a 0 to 0xF000.
> 
> 林冬艺
> 云架构产品部
> 软件工程师
> ======================================================
> 手机：13556019654
> 邮箱：lindongyi at bingosoft.net
> 地址：广州市天河区高唐软件基地软件路17号G1栋
> ======================================================
> 
> ________________________________________
> 发件人: Ben Pfaff [blp at nicira.com]
> 发送时间: 2015年11月4日 2:37
> 到: 林冬艺
> Cc: bugs at openvswitch.org
> 主题: Re: [ovs-discuss] Then QOS configuration, queue id is not greater than 0xF000.
> 
> Restrictions on queue IDs are documented in ovs-vswitchd.conf.db(5).

From er.manpreet25 at gmail.com  Tue Nov  3 20:00:22 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Wed, 4 Nov 2015 09:30:22 +0530
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
In-Reply-To: <20151104013748.GJ17568@nicira.com>
References: <CALD=K8v=j+zb6FP4VW26BSoU4yHyBkznevoe0yR_ykvRomrxZA@mail.gmail.com>
 <20151019152057.GA20995@nicira.com>
 <CALD=K8vrp7S=S1r0M928xXTZ7b7asukFeECXLY7Z67QqkZXLBw@mail.gmail.com>
 <20151104013748.GJ17568@nicira.com>
Message-ID: <CALD=K8sdmroJO=QiL-n+FE9BEScpSK4Esc4p9YBkNeMXMT50Eg@mail.gmail.com>

Hello Ben,


> Can you explain why you want to send an invalid flags value?
I want to check the error handling capabilities of the switch that why I am
testing the OVS in abnormal conditions.



Regards
Manpreet

On Wed, Nov 4, 2015 at 7:07 AM, Ben Pfaff <blp at nicira.com> wrote:

> So, you've complained about this a number of times.
>
> Can you explain why you want to send an invalid flags value?
>
> On Mon, Oct 19, 2015 at 11:22:23PM +0530, Manpreet Singh wrote:
> > I am using openflow 1.3.0
> >
> > On Monday, 19 October 2015, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Mon, Oct 19, 2015 at 10:40:42AM +0530, Manpreet Singh wrote:
> > > > I am working on OVS-2.3.2.I am sending invalid value of
> ofp_config_flags
> > > in
> > > > OFPT_SET_CONFIG message from controller, then sending
> > > > OFPT_GET_CONFIG_REQUEST message the switch reply with
> > > OFPT_GET_CONFIG_REPLY
> > > > message having frag=normal.
> > > >
> > > > I think for invalid flag value the switch must generate an error but
> it
> > > > will set frag to normal.
> > > >
> > > > Is my understanding is correct or not ?
> > >
> > > What version of OpenFlow?
> > >
> >
> >
> > --
> > Sent from iphone
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151104/ec63174f/attachment.html>

From blp at nicira.com  Tue Nov  3 20:05:35 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 3 Nov 2015 20:05:35 -0800
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
In-Reply-To: <CALD=K8sdmroJO=QiL-n+FE9BEScpSK4Esc4p9YBkNeMXMT50Eg@mail.gmail.com>
References: <CALD=K8v=j+zb6FP4VW26BSoU4yHyBkznevoe0yR_ykvRomrxZA@mail.gmail.com>
 <20151019152057.GA20995@nicira.com>
 <CALD=K8vrp7S=S1r0M928xXTZ7b7asukFeECXLY7Z67QqkZXLBw@mail.gmail.com>
 <20151104013748.GJ17568@nicira.com>
 <CALD=K8sdmroJO=QiL-n+FE9BEScpSK4Esc4p9YBkNeMXMT50Eg@mail.gmail.com>
Message-ID: <20151104040535.GT17568@nicira.com>

On Wed, Nov 04, 2015 at 09:30:22AM +0530, Manpreet Singh wrote:
> > Can you explain why you want to send an invalid flags value?
> I want to check the error handling capabilities of the switch that why I am
> testing the OVS in abnormal conditions.

Have you found any significant bugs?  Nitpicking is OK (and if you were
supplying fixes instead of just reports it would be great) but I'd much
rather hear about substantive bugs.

From pnahar at eng.ucsd.edu  Tue Nov  3 20:13:33 2015
From: pnahar at eng.ucsd.edu (Piyush Anil Nahar)
Date: Tue, 3 Nov 2015 20:13:33 -0800
Subject: [ovs-discuss] Get queue statistics on openvswitch
Message-ID: <CACfjnkr9P=bt1M5EoEVQANvDWWDhuSJTGgdG-km=oadohag+4g@mail.gmail.com>

Hello,

I'm trying to implement ECN on openvswitch.
For that I need to set ECN bits on packets if the queue length on the port
is greater than K.
Any idea how I get the queue length from the switch?

Thanks in advance.

-- 
Piyush Anil Nahar
Graduate Student
Computer Science & Engineering Department
University of California San Diego
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151103/88d0b9c0/attachment-0001.html>

From er.manpreet25 at gmail.com  Tue Nov  3 20:20:42 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Wed, 4 Nov 2015 09:50:42 +0530
Subject: [ovs-discuss] Problem with OFPT_SET_CONFIG message
In-Reply-To: <20151104040535.GT17568@nicira.com>
References: <CALD=K8v=j+zb6FP4VW26BSoU4yHyBkznevoe0yR_ykvRomrxZA@mail.gmail.com>
 <20151019152057.GA20995@nicira.com>
 <CALD=K8vrp7S=S1r0M928xXTZ7b7asukFeECXLY7Z67QqkZXLBw@mail.gmail.com>
 <20151104013748.GJ17568@nicira.com>
 <CALD=K8sdmroJO=QiL-n+FE9BEScpSK4Esc4p9YBkNeMXMT50Eg@mail.gmail.com>
 <20151104040535.GT17568@nicira.com>
Message-ID: <CALD=K8tEvSXVTUJprUUXNN=hQTH3oz6_hU3kCFRkWBDJAy9LPw@mail.gmail.com>

> Have you found any significant bugs? Nitpicking is OK (and if you were
> supplying fixes instead of just reports it would be great) but I'd much
> rather hear about substantive bugs.
I got your point Ben. Obviously I am testing it to fix the defects.
As I am new to OVS so I choose first to test it for understanding the
behavior/Architecture of switch.

Regards
Manpreet


On Wed, Nov 4, 2015 at 9:35 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Nov 04, 2015 at 09:30:22AM +0530, Manpreet Singh wrote:
> > > Can you explain why you want to send an invalid flags value?
> > I want to check the error handling capabilities of the switch that why I
> am
> > testing the OVS in abnormal conditions.
>
> Have you found any significant bugs?  Nitpicking is OK (and if you were
> supplying fixes instead of just reports it would be great) but I'd much
> rather hear about substantive bugs.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151104/33933a57/attachment.html>

From mailing.jyc at gmail.com  Wed Nov  4 07:27:41 2015
From: mailing.jyc at gmail.com (jyc)
Date: Wed, 4 Nov 2015 16:27:41 +0100
Subject: [ovs-discuss] openvswitch active passive bond on two lacp bond
	problem
Message-ID: <563A23ED.5030407@gmail.com>

Hi everyone !

I'm working on a problem on proxmox using openvswitch.

let me explain my goal :

i have one server : 4 interfaces : eth1 eth2 eth3 eth4
i have two juniper switch.

i want to create a lacp bond0 on eth1 and eth2
i want to create a lacp bond1 on eth3 and eth4

upon that, i want to create a fail-over, active-passive bond3 upon bond0 
and bond1

for instance, here is what i get :

root at debian:~# ovs-vsctl show
e5124c02-05e7-40ae-a2e3-473c8b0414d9
     Bridge "br1"
         Port "bond0"
             Interface "eth2"
             Interface "eth1"
         Port "br1"
             Interface "br1"
                 type: internal
         Port "bond1"
             Interface "eth3"
             Interface "eth4"
     ovs_version: "1.4.2"
root at debian:~# ovs-vsctl add-bond br1 bond2  bond0 bond1
ovs-vsctl: cannot create an interface named bond0 because a port named 
bond0 already exists on bridge br1
root at debian:~# ovs-vsctl add-br br2
root at debian:~# ovs-vsctl add-bond br2 bond2  bond0 bond1
ovs-vsctl: cannot create an interface named bond0 because a port named 
bond0 already exists on bridge br1

is there any way to make a fail over bonding upon two lacp bonding with 
openvswitch ?


for now, maybe i'll try to create the two lacp bond without openvswitch, 
on later, create a fail-over bond with openvswitch.
that's my last hope if you have no answer for me :-(





From blp at nicira.com  Wed Nov  4 07:54:58 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Nov 2015 07:54:58 -0800
Subject: [ovs-discuss] openvswitch active passive bond on two lacp bond
 problem
In-Reply-To: <563A23ED.5030407@gmail.com>
References: <563A23ED.5030407@gmail.com>
Message-ID: <20151104155458.GU17568@nicira.com>

On Wed, Nov 04, 2015 at 04:27:41PM +0100, jyc wrote:
> Hi everyone !
> 
> I'm working on a problem on proxmox using openvswitch.
> 
> let me explain my goal :
> 
> i have one server : 4 interfaces : eth1 eth2 eth3 eth4
> i have two juniper switch.
> 
> i want to create a lacp bond0 on eth1 and eth2
> i want to create a lacp bond1 on eth3 and eth4
> 
> upon that, i want to create a fail-over, active-passive bond3 upon bond0 and
> bond1

OVS doesn't nest bonds.

From bschang at mit.edu  Wed Nov  4 08:34:07 2015
From: bschang at mit.edu (Brendan Chang)
Date: Wed, 4 Nov 2015 11:34:07 -0500
Subject: [ovs-discuss] Source network of a packet
Message-ID: <CAGmPJqsTzV-NYmDYn-5WvDHjoFVNZFWA0w+pnTy-HgY34kVqLQ@mail.gmail.com>

Hello,

I'm using OVN for a project for network performance isolation and I was
wondering if there are any packet headers or fields which tell what logical
network they came from?

For example, if I had two isolated logical networks where switch 1 connects
clients A and B and switch 2 connects clients C and D, is there some field
which tells if a packet came from the first network or the second?

Thanks,

Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151104/bdd16f4f/attachment.html>

From blp at nicira.com  Wed Nov  4 10:00:06 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 4 Nov 2015 10:00:06 -0800
Subject: [ovs-discuss] Source network of a packet
In-Reply-To: <CAGmPJqsTzV-NYmDYn-5WvDHjoFVNZFWA0w+pnTy-HgY34kVqLQ@mail.gmail.com>
References: <CAGmPJqsTzV-NYmDYn-5WvDHjoFVNZFWA0w+pnTy-HgY34kVqLQ@mail.gmail.com>
Message-ID: <20151104180006.GA18885@nicira.com>

On Wed, Nov 04, 2015 at 11:34:07AM -0500, Brendan Chang wrote:
> I'm using OVN for a project for network performance isolation and I was
> wondering if there are any packet headers or fields which tell what logical
> network they came from?
> 
> For example, if I had two isolated logical networks where switch 1 connects
> clients A and B and switch 2 connects clients C and D, is there some field
> which tells if a packet came from the first network or the second?

Yes, the network of a packet is encoded in the encapsulation.  See
"Tunnel Encapsulation" in ovn-architecture(7).

(A packet that traverses a logical router passes through multiple
networks.  The one that appears on the wire would be that of the
destination logical switch.)

From gd0204 at gmail.com  Wed Nov  4 21:06:41 2015
From: gd0204 at gmail.com (Gayathri)
Date: Wed, 4 Nov 2015 21:06:41 -0800
Subject: [ovs-discuss] Run dpdk application in a VM
In-Reply-To: <CADYNHPpUaVgB6QucwUVxM6i2+SQDdefF=pTpdsCZnuzpGYnt8A@mail.gmail.com>
References: <CADYNHPpUaVgB6QucwUVxM6i2+SQDdefF=pTpdsCZnuzpGYnt8A@mail.gmail.com>
Message-ID: <CADYNHPpC-uXWHPu64pHkOtByWMRGF+jzukWU9_7bsx6jGEt0Zw@mail.gmail.com>

Hi *,

I am new to dpdk, please do help me.

My setup has a host with dpdk-ovs, with VMs connected to it. We need to run
dpdk applications on these VMs. The host dpdk is built for
x86_64-native-linuxapp-gcc.
Please advice if we should be using x86_64-ivshmem-linuxapp-gcc instead.

Could somebody share with me the steps to install x86_64-ivshmem-linuxapp-gcc
based dpdk-ovs in the host/guest. Apart from the below two configs, are
there any more details involved plz suggest
export RTE_TARGET=x86_64-ivshmem-linuxapp-gcc
make install T=x86_64-ivshmem-linuxapp-gcc

Also please let me know if the hugepages in the VM could be 2M pages or its
mandatory to have 1 Gb pages.

Thanks in advance
Regards,
Gayathri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151104/4582e797/attachment.html>

From kursat.kobya at argela.com.tr  Thu Nov  5 00:22:54 2015
From: kursat.kobya at argela.com.tr (Kursat Kobya)
Date: Thu, 5 Nov 2015 11:22:54 +0300
Subject: [ovs-discuss] Getting errors when testsuite is run
Message-ID: <CAHXFQY3nW78-3k5y6QUmV7ZgWkeMhfm0nZ2P4fPfoaxNxNGgRw@mail.gmail.com>

Hi All,

             I am trying to understand whether everything is established
correctly or not. When I try to follow instructions in
https://github.com/01org/dpdk-ovs/blob/development/docs/02_Using_Intel_DPDK_vSwitch.md
the ovs-dpdk command fails with errors like

EAL: VFIO support could not be initialized
EAL: Searching for IVSHMEM devices...
EAL: No IVSHMEM configuration found!

Then i think it woul be better if i use testsuite to understand what is
wrong. Using manual at
https://github.com/01org/dpdk-ovs/blob/development/docs/05_Testing.md , i
tried make check ang get

1392 tests were run, 197 failed unexpectedly, 34 tests were skipped.

Then to narrow problems i try to test only dpdk related make check
TESTSUITEFLAGS='-k dpdk'  and i got  "All 98 tests were run, 37 failed
unexpectedly". After this message i start
digging openvswitch/tests/testsuite.dir and try to investigate first dpdk
related test error. and run the test under 1390. I got following error


1390. dpif-dpdk.at:21: testing port add ...

./dpif-dpdk.at:21: sudo -E $srcdir/test-dpif-dpdk -c 1 -n 4 -- port-add

stderr:

stdout:

EAL: Detected lcore 0 as core 0 on socket 0

EAL: Detected lcore 1 as core 1 on socket 0

EAL: Support maximum 64 logical core(s) by configuration.

EAL: Detected 2 lcore(s)

EAL:   cannot open VFIO container, error 2 (No such file or directory)

EAL: VFIO support could not be initialized

EAL: Searching for IVSHMEM devices...

EAL: No IVSHMEM configuration found!

EAL: Setting up memory...

EAL: Ask a virtual area of 0x1000000 bytes

EAL: Virtual area found at 0x7f0309600000 (size = 0x1000000)

EAL: Requesting 8 pages of size 2MB from socket 0

EAL: TSC frequency is ~1995019 KHz

EAL: Master core 0 is ready (tid=a6879c0)

APP: Created OVDK01_Exception_Ring

APP: Created OVDK01_Packet_Ring

APP: Created OVDK01_Reply_Ring

APP: Created OVDK01_Request_Ring

APP: Created OVDK01_Packet_Free_Ring

APP: Created OVDK01_Control_Free_Ring

APP: Created OVDK01_Packet_Alloc_Ring

APP: Created OVDK01_Control_Alloc_Ring

./dpif-dpdk.at:21: exit code was 139, expected 0

1390. dpif-dpdk.at:21:  FAILED (dpif-dpdk.at:21)


## ------------- ##

## Test results. ##

## ------------- ##


ERROR: 1 test was run,

1 failed unexpectedly.


Can anyone help me if you have any clue about this. My operating system is
Fedora 20, I am using a virtual machine with processor Intel(R) Xeon(R) CPU
E5-2650, and 2 virtual 82545EM Gigabit Ethernet Nic.
binding status is as following :

dpdk_nic_bind.py --status



Network devices using DPDK-compatible driver

============================================

0000:02:01.0 '82545EM Gigabit Ethernet Controller (Copper)' drv=igb_uio
unused=e1000


Network devices using kernel driver

===================================

0000:02:00.0 '82545EM Gigabit Ethernet Controller (Copper)' if=ens32
drv=e1000 unused=igb_uio *Active*


Other network devices

=====================

<none>




With my Best Regards,
Kursat
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151105/9814bbc2/attachment.html>

From ppnaik at cse.iitb.ac.in  Thu Nov  5 04:09:18 2015
From: ppnaik at cse.iitb.ac.in (Priyanka)
Date: Thu, 05 Nov 2015 17:39:18 +0530
Subject: [ovs-discuss] DPDK support in openstack juno
In-Reply-To: <563B46C9.1090305@cse.iitb.ac.in>
References: <563B46C9.1090305@cse.iitb.ac.in>
Message-ID: <563B46EE.8090301@cse.iitb.ac.in>





Hi,

Is it possible to enable dpdk on openstack juno on CentOS7? Can someone
please provide the steps to enable it. I am using VXLAN tunneling.


Thanks,

Priyanka




From agpozuelo91 at gmail.com  Thu Nov  5 12:41:21 2015
From: agpozuelo91 at gmail.com (=?UTF-8?Q?Alberto_Guti=C3=A9rrez?=)
Date: Thu, 5 Nov 2015 21:41:21 +0100
Subject: [ovs-discuss] OVS Basic topology
Message-ID: <CAPOUwWJ1hD+k3OtFvazv=yNWnoSyXARDDLCyrQac1emCZcRqKQ@mail.gmail.com>

Hi, I'm trying to stablish a basic topoogy just using a bridge an two hosts
(VM's)

The point is that i want them torun at the same time. In other words I have
3 VM's :

#VM1 ---> Here I've installed OVS and I've created a bridge with two
interfaces

#VM2 & #VM3 ----> They're just the same, a simply linux distribution.

My problem is that i dont know how to connect 2 & 3 to the bridge I created
in 1. In all the tutorials I've found they run the VM's in the physical
hardware where they have OVS installed, so they use nested virtualitation.
Despite it's an option, I want them to run in parallel.


I want this:


Internet-----------(eth0)-----bridge ----- (vport1) -------- VM2
                                    OVS -------(vport2) ---------VM3


Any idea??

Many thx.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151105/75dc332d/attachment.html>

From joe at wand.net.nz  Thu Nov  5 15:43:25 2015
From: joe at wand.net.nz (Joe Stringer)
Date: Thu, 5 Nov 2015 15:43:25 -0800
Subject: [ovs-discuss] Getting errors when testsuite is run
In-Reply-To: <CAHXFQY3nW78-3k5y6QUmV7ZgWkeMhfm0nZ2P4fPfoaxNxNGgRw@mail.gmail.com>
References: <CAHXFQY3nW78-3k5y6QUmV7ZgWkeMhfm0nZ2P4fPfoaxNxNGgRw@mail.gmail.com>
Message-ID: <CAOftzPj6VL3-XC+dmd1QVQR0TtkDa_fkvMHPVysw+y6XFQXAfg@mail.gmail.com>

On 5 November 2015 at 00:22, Kursat Kobya <kursat.kobya at argela.com.tr> wrote:
> Hi All,
>
>              I am trying to understand whether everything is established
> correctly or not. When I try to follow instructions in
> https://github.com/01org/dpdk-ovs/blob/development/docs/02_Using_Intel_DPDK_vSwitch.md
> the ovs-dpdk command fails with errors like

I don't think that this branch is maintained any more; the most recent
commit is over 6 months ago, and there is now support for DPDK in
upstream OVS.

I suggest you try from https://github.com/openvswitch/ovs instead.

From leo.zhu510 at gmail.com  Thu Nov  5 23:10:36 2015
From: leo.zhu510 at gmail.com (leo zhu)
Date: Fri, 6 Nov 2015 15:10:36 +0800
Subject: [ovs-discuss] OVS internal port performance is not good when used
	with OVS DPDK
Message-ID: <CALzAW8TZM6MX+vRh2WdVNGSddbQJUb7xuH_aPR9nWQLUBDue6A@mail.gmail.com>

Hi all,

I tried below test cases to compare the performance of OVS/OVS
DPDK+Internal port.

*Topology*:

​*Test results:*


​

 Now I have following 2 questions.

1.  Does the test result is normal?  If it is not normal, why?
2.  When ovs internal port is used with OVS DPDK, the max packet size sent
by DPDK PKTGEN
     can not be larger than 978 bytes. Otherwise the traffic will be
blocked. Does anyone know the
     reason?

It will be great if someone from the list could give the answers and clues.

Thanks.
Leo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151106/128d030e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: New Picture.jpg
Type: image/jpeg
Size: 34969 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151106/128d030e/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: New Picture (1).jpg
Type: image/jpeg
Size: 23569 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151106/128d030e/attachment-0003.jpg>

From lapngodoan at gmail.com  Thu Nov  5 23:14:38 2015
From: lapngodoan at gmail.com (Ngo Doan Lap)
Date: Fri, 6 Nov 2015 14:14:38 +0700
Subject: [ovs-discuss] OVS internal port performance is not good when
	used with OVS DPDK
In-Reply-To: <CALzAW8TZM6MX+vRh2WdVNGSddbQJUb7xuH_aPR9nWQLUBDue6A@mail.gmail.com>
References: <CALzAW8TZM6MX+vRh2WdVNGSddbQJUb7xuH_aPR9nWQLUBDue6A@mail.gmail.com>
Message-ID: <F11BF4B3-260B-4A65-9D32-50315A97F91C@gmail.com>

Hi Leo,
You can refer to this document get correct setup/result.
We are able to replicate the results on this doc.
https://download.01.org/packet-processing/ONPS1.5/Intel_ONP_Server_Release_1.5_Performance_Test_Report_Rev1.1.pdf <https://download.01.org/packet-processing/ONPS1.5/Intel_ONP_Server_Release_1.5_Performance_Test_Report_Rev1.1.pdf>
Thank and Best Regards
Lapd
> On Nov 6, 2015, at 2:10 PM, leo zhu <leo.zhu510 at gmail.com> wrote:
> 
> Hi all,      
> 
> I tried below test cases to compare the performance of OVS/OVS DPDK+Internal port.
> 
> Topology:
> <New Picture.jpg>
> ​Test results:
> 
> <New Picture (1).jpg>
> ​
> 
>  Now I have following 2 questions.
> 
> 1.  Does the test result is normal?  If it is not normal, why?
> 2.  When ovs internal port is used with OVS DPDK, the max packet size sent by DPDK PKTGEN
>      can not be larger than 978 bytes. Otherwise the traffic will be blocked. Does anyone know the
>      reason?
> 
> It will be great if someone from the list could give the answers and clues.
> 
> Thanks.
> Leo
> 
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151106/bd6cccc5/attachment.html>

From jeremias at blendin.org  Fri Nov  6 15:40:04 2015
From: jeremias at blendin.org (Jeremias Blendin)
Date: Sat, 7 Nov 2015 00:40:04 +0100
Subject: [ovs-discuss] Open vSwitch with DPDK on FreeBSD
Message-ID: <CAFZrTr7TtTdBi+j-z+WHY2xNxpuZdsYD6YxgmYNM1SJhrZ8Hew@mail.gmail.com>

Hi,

I am having trouble compiling OVS with DPDK on FreeBSD. Is this
configuration supposed to work?

OVS looks for virtio, which DPDK seems not to provide, although it is
enabled in the configuration. Any ideas on pointers on the issue?

Thanks!

Here is the output:

DPDK_BUILD=/usr/home/user/install/dpdk/x86_64-native-bsdapp-clang
./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align
-march=native"

gmake
------8<------
libtool: compile:  cc -DHAVE_CONFIG_H -I. -I ./include -I ./include -I
./lib -I ./lib -I/usr/include -Wstrict-prototypes -Wall -Wextra
-Wno-sign-compare -Wpointer-arith -Wformat-security -Wswitch-enum
-Wunused-parameter -Wbad-function-cast -Wcast-align
-Wstrict-prototypes -Wold-style-definition -Wmissing-prototypes
-Wmissing-field-initializers -Wthread-safety -fno-strict-aliasing
-Qunused-arguments
-I/usr/home/user/install/dpdk/x86_64-native-bsdapp-clang/include
-mssse3 -D_FILE_OFFSET_BITS=64 -g -O2 -Wno-cast-align -march=native
-MT lib/netdev-dpdk.lo -MD -MP -MF lib/.deps/netdev-dpdk.Tpo -c
lib/netdev-dpdk.c -o lib/netdev-dpdk.o
lib/netdev-dpdk.c:55:10: fatal error: 'rte_virtio_net.h' file not found
#include "rte_virtio_net.h"
         ^
1 error generated.
Makefile:3584: recipe for target 'lib/netdev-dpdk.lo' failed
gmake[2]: *** [lib/netdev-dpdk.lo] Error 1
gmake[2]: Leaving directory '/usr/home/user/install/ovs'
Makefile:4188: recipe for target 'all-recursive' failed
gmake[1]: *** [all-recursive] Error 1
gmake[1]: Leaving directory '/usr/home/user/install/ovs'
Makefile:2327: recipe for target 'all' failed
gmake: *** [all] Error 2

From diproiettod at vmware.com  Fri Nov  6 16:29:25 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Sat, 7 Nov 2015 00:29:25 +0000
Subject: [ovs-discuss] Open vSwitch with DPDK on FreeBSD
In-Reply-To: <CAFZrTr7TtTdBi+j-z+WHY2xNxpuZdsYD6YxgmYNM1SJhrZ8Hew@mail.gmail.com>
References: <CAFZrTr7TtTdBi+j-z+WHY2xNxpuZdsYD6YxgmYNM1SJhrZ8Hew@mail.gmail.com>
Message-ID: <D26282B3.8E84%diproiettod@vmware.com>

Hi,

Using OVS with DPDK on BSD is not supported at the moment.

The current OVS code assumes that the DPDK is compiled with vhost support,
which is not supported on BSD.  Also, some of the APIs that we use in
netdev-dpdk.c are linux specific (e.g. pthread_setaffinity_np).

I suppose it won't be to hard to work around these limitations and,
obviously,
patches are welcome!



On 06/11/2015 15:40, "Jeremias Blendin" <jeremias at blendin.org> wrote:

>Hi,
>
>I am having trouble compiling OVS with DPDK on FreeBSD. Is this
>configuration supposed to work?
>
>OVS looks for virtio, which DPDK seems not to provide, although it is
>enabled in the configuration. Any ideas on pointers on the issue?
>
>Thanks!
>
>Here is the output:
>
>DPDK_BUILD=/usr/home/user/install/dpdk/x86_64-native-bsdapp-clang
>./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align
>-march=native"
>
>gmake
>------8<------
>libtool: compile:  cc -DHAVE_CONFIG_H -I. -I ./include -I ./include -I
>./lib -I ./lib -I/usr/include -Wstrict-prototypes -Wall -Wextra
>-Wno-sign-compare -Wpointer-arith -Wformat-security -Wswitch-enum
>-Wunused-parameter -Wbad-function-cast -Wcast-align
>-Wstrict-prototypes -Wold-style-definition -Wmissing-prototypes
>-Wmissing-field-initializers -Wthread-safety -fno-strict-aliasing
>-Qunused-arguments
>-I/usr/home/user/install/dpdk/x86_64-native-bsdapp-clang/include
>-mssse3 -D_FILE_OFFSET_BITS=64 -g -O2 -Wno-cast-align -march=native
>-MT lib/netdev-dpdk.lo -MD -MP -MF lib/.deps/netdev-dpdk.Tpo -c
>lib/netdev-dpdk.c -o lib/netdev-dpdk.o
>lib/netdev-dpdk.c:55:10: fatal error: 'rte_virtio_net.h' file not found
>#include "rte_virtio_net.h"
>         ^
>1 error generated.
>Makefile:3584: recipe for target 'lib/netdev-dpdk.lo' failed
>gmake[2]: *** [lib/netdev-dpdk.lo] Error 1
>gmake[2]: Leaving directory '/usr/home/user/install/ovs'
>Makefile:4188: recipe for target 'all-recursive' failed
>gmake[1]: *** [all-recursive] Error 1
>gmake[1]: Leaving directory '/usr/home/user/install/ovs'
>Makefile:2327: recipe for target 'all' failed
>gmake: *** [all] Error 2
>_______________________________________________
>discuss mailing list
>discuss at openvswitch.org
>https://urldefense.proofpoint.com/v2/url?u=http-3A__openvswitch.org_mailma
>n_listinfo_discuss&d=BQIGaQ&c=Sqcl0Ez6M0X8aeM67LKIiDJAXVeAw-YihVMNtXt-uEs&
>r=SmB5nZacmXNq0gKCC1s_Cw5yUNjxgD4v5kJqZ2uWLlE&m=02q1IWwJIe0oxPhzb_unTziH1B
>vqErQ6WaRQIbZncS4&s=XBr7Hm3XDQnL4TzUVxMViof8mAxCmHbZ9Cowt5NJIsQ&e= 


From jesse at nicira.com  Fri Nov  6 19:40:12 2015
From: jesse at nicira.com (Jesse Gross)
Date: Sat, 7 Nov 2015 12:40:12 +0900
Subject: [ovs-discuss] ipfix leads to kernel crash
In-Reply-To: <201511022212301753210@yunshan.net.cn>
References: <201511022212301753210@yunshan.net.cn>
Message-ID: <CAEP_g=_e3_ogbw4E1EdLSYemYWYMD6uCkxcJ5ZxsGj_RFViJgQ@mail.gmail.com>

On Monday, November 2, 2015, ZHANG Zhiming <zhangzhiming at yunshan.net.cn>
wrote:

> Hi,
>
> Could someone help me check this kernel crash?
> I set ipfix to send report to a collector, and the kernel crashed after
> several hours.
> Thanks!
>
> ovs-vsctl (Open vSwitch) 2.3.1
> Compiled Aug 11 2015 05:18:30
> DB Schema 7.6.2
>

This bug has already been fixed. Please upgrade to either OVS 2.3.2 or 2.4.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151107/9ee737f5/attachment.html>

From ecelgp at gmail.com  Wed Nov  4 17:27:50 2015
From: ecelgp at gmail.com (Luis Gomez)
Date: Wed, 4 Nov 2015 17:27:50 -0800
Subject: [ovs-discuss] OVS 2.4.0 broadcast when OF controller is not
	reachable
Message-ID: <45399F04-0B07-4754-9325-08CF14552996@gmail.com>

Hi,

I use OVS to simulate a looped topology (bridges connected in a ring and multiple links between bridges). The workflow is as follows:

1) I setup the entire topology using OVS bridges (I set disable-in-band=true and remove all flows), veth interfaces to interconnect the bridges and Linux containers (lxc) to simulate attached hosts.
2) Once topology is setup I connect OVS bridges to OpenFlow controller

This worked very well for me in previous versions of OVS regardless whether the controller is present or absent.

However when I updated to OVS 2.4.0, if the controller is not reachable when provisioning it in the bridge or if the bridge loses connection to controller, the OVS bridges starts to broadcast packets to all ports creating a packet storm in the case of my topology.

Details of my installation:

OVS:
ovs-vswitchd (Open vSwitch) 2.4.0
Compiled Aug 29 2015 11:20:23

Kernel and OS:
Ubuntu 14.04 LTS
cat /proc/version
Linux version 3.13.0-43-generic (buildd at tipua) (gcc version 4.8.2 (Ubuntu 4.8.2-19ubuntu1) ) #72-Ubuntu SMP Mon Dec 8 19:35:06 UTC 2014

Other printouts:

sudo ovs-dpctl show
system at ovs-system:
	lookups: hit:715066804 missed:10477446 lost:10223814
	flows: 0
	masks: hit:820418364 total:0 hit/pkt:1.13
	port 0: ovs-system (internal)
	port 1: dc1fb1 (internal)
	port 2: dc1fb2 (internal)
	port 3: dc2fb1 (internal)
	port 4: dc2fb2 (internal)
	port 5: dc3fb1 (internal)
	port 6: dc3fb2 (internal)

sudo ovs-appctl bridge/dump-flows dc1fb1 (same flows in all 6 bridges)
table_id=254, duration=69s, n_packets=0, n_bytes=0, priority=2,recirc_id=0,actions=drop
table_id=254, duration=69s, n_packets=0, n_bytes=0, priority=0,reg0=0x1,actions=controller(reason=no_match)
table_id=254, duration=69s, n_packets=0, n_bytes=0, priority=0,reg0=0x2,actions=drop
table_id=254, duration=69s, n_packets=0, n_bytes=0, priority=0,reg0=0x3,actions=drop

Please let me know if you need any other information.

BR/Luis

From gd0204 at gmail.com  Wed Nov  4 20:57:08 2015
From: gd0204 at gmail.com (Gayathri)
Date: Wed, 4 Nov 2015 20:57:08 -0800
Subject: [ovs-discuss] Run dpdk application in a VM
Message-ID: <CADYNHPpUaVgB6QucwUVxM6i2+SQDdefF=pTpdsCZnuzpGYnt8A@mail.gmail.com>

Hi *,

I am new to dpdk please do help me.

My setup has a host with dpdk-ovs, with VMs connected to it. We need to run
dpdk applications on these VMs. The host dpdk is built for
x86_64-native-linuxapp-gcc.
Please advice if we should be using x86_64-ivshmem-linuxapp-gcc instead.

Could somebody share with me the steps to install x86_64-ivshmem-linuxapp-gcc
based dpdk-ovs in the host/guest. Apart from the below two configs, are
there any more details involved plz suggest
export RTE_TARGET=x86_64-ivshmem-linuxapp-gcc
make install T=x86_64-ivshmem-linuxapp-gcc

Also please let me know if the hugepages in the VM could be 2M pages or its
mandatory to have 1 Gb pages.

Thanks in advance
Regards,
Gayathri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151104/bb38bce4/attachment.html>

From gd0204 at gmail.com  Wed Nov  4 21:00:48 2015
From: gd0204 at gmail.com (Gayathri)
Date: Wed, 4 Nov 2015 21:00:48 -0800
Subject: [ovs-discuss] Fwd: Run dpdk application in a VM
In-Reply-To: <CADYNHPpUaVgB6QucwUVxM6i2+SQDdefF=pTpdsCZnuzpGYnt8A@mail.gmail.com>
References: <CADYNHPpUaVgB6QucwUVxM6i2+SQDdefF=pTpdsCZnuzpGYnt8A@mail.gmail.com>
Message-ID: <CADYNHPqbC6Spb2uwNEkdVCtXDH0h+Uo83VdOOYg3NHk5ZOHLSQ@mail.gmail.com>

Hi *,

I am new to dpdk please do help me.

My setup has a host with dpdk-ovs, with VMs connected to it. We need to run
dpdk applications on these VMs. The host dpdk is built for
x86_64-native-linuxapp-gcc.
Please advice if we should be using x86_64-ivshmem-linuxapp-gcc instead.

Could somebody share with me the steps to install x86_64-ivshmem-linuxapp-gcc
based dpdk-ovs in the host/guest. Apart from the below two configs, are
there any more details involved plz suggest
export RTE_TARGET=x86_64-ivshmem-linuxapp-gcc
make install T=x86_64-ivshmem-linuxapp-gcc

Also please let me know if the hugepages in the VM could be 2M pages or its
mandatory to have 1 Gb pages.

Thanks in advance
Regards,
Gayathri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151104/c48982c0/attachment.html>

From zhangzhiming at yunshan.net.cn  Sun Nov  8 02:32:27 2015
From: zhangzhiming at yunshan.net.cn (ZHANG Zhiming)
Date: Sun, 8 Nov 2015 18:32:27 +0800
Subject: [ovs-discuss] ipfix leads to kernel crash
References: <201511022212301753210@yunshan.net.cn>, 
 <CAEP_g=_e3_ogbw4E1EdLSYemYWYMD6uCkxcJ5ZxsGj_RFViJgQ@mail.gmail.com>
Message-ID: <201511081832262254792@yunshan.net.cn>

Hi Gross,

Thank you very much.

You save me so much time.

The version of OVS may not be changed due to some reasons. So I have to fix it on versoin 2.31.
Could you tell me which patch solved this bug?
I checked a commit logs, and found no clues.

Best regards,




ZHANG Zhiming
Yunshan Networks

From: Jesse Gross
Date: 2015-11-07 11:40
To: zhangzhiming
CC: discuss
Subject: Re: [ovs-discuss] ipfix leads to kernel crash
On Monday, November 2, 2015, ZHANG Zhiming <zhangzhiming at yunshan.net.cn> wrote:

Hi,

Could someone help me check this kernel crash?
I set ipfix to send report to a collector, and the kernel crashed after several hours.
Thanks!

ovs-vsctl (Open vSwitch) 2.3.1
Compiled Aug 11 2015 05:18:30
DB Schema 7.6.2


This bug has already been fixed. Please upgrade to either OVS 2.3.2 or 2.4. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151108/d163ff16/attachment.html>

From hanxueluo at gmail.com  Sun Nov  8 07:54:43 2015
From: hanxueluo at gmail.com (Huanle Han)
Date: Sun, 8 Nov 2015 23:54:43 +0800
Subject: [ovs-discuss] first ip fragment packet doesn't match the L4 field
Message-ID: <CACRYWptwdBiHEYXHWx9VY=V39Z3=v00UOVwAxJCE-=7ex=GTJQ@mail.gmail.com>

Hi,
When I look into the function 'rule_dpif_lookup_from_table', I find it set
0 to tp_src and tp_dst for the ip fragment flow, before looking up the rule
in table.
It make sense for the later fragments because they have no L4 information.
But why do it for the first fragment ?

In below case, first fragment flow matches the second flow entry rather
than the first one.

root at ubuntu:~# ovs-ofctl dump-flows br
NXST_FLOW reply (xid=0x4):
    cookie=0x0, duration=23.387s, table=0, n_packets=0, n_bytes=0,
idle_age=23, priority=10,udp,in_port=2,*nw_frag=first*,tp_dst=8001
actions=mod_tp_dst:8002,output:1
    cookie=0x0, duration=8.432s, table=0, n_packets=0, n_bytes=0,
idle_age=8, priority=5,udp,in_port=2,tp_dst=8001
actions=mod_tp_dst:8003,output:1
    cookie=0x0, duration=36.275s, table=0, n_packets=57, n_bytes=59184,
idle_age=0, priority=0 actions=NORMAL
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151108/d90ee484/attachment-0001.html>

From blp at ovn.org  Sun Nov  8 09:19:00 2015
From: blp at ovn.org (Ben Pfaff)
Date: Sun, 8 Nov 2015 09:19:00 -0800
Subject: [ovs-discuss] first ip fragment packet doesn't match the L4
	field
In-Reply-To: <CACRYWptwdBiHEYXHWx9VY=V39Z3=v00UOVwAxJCE-=7ex=GTJQ@mail.gmail.com>
References: <CACRYWptwdBiHEYXHWx9VY=V39Z3=v00UOVwAxJCE-=7ex=GTJQ@mail.gmail.com>
Message-ID: <20151108171900.GC21318@ovn.org>

On Sun, Nov 08, 2015 at 11:54:43PM +0800, Huanle Han wrote:
> Hi,
> When I look into the function 'rule_dpif_lookup_from_table', I find it set
> 0 to tp_src and tp_dst for the ip fragment flow, before looking up the rule
> in table.
> It make sense for the later fragments because they have no L4 information.
> But why do it for the first fragment ?

OpenFlow requires it.  See Figure 3 in the OpenFlow 1.0.0 specification.

From zhaojun12 at outlook.com  Sun Nov  8 05:04:33 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Sun, 8 Nov 2015 21:04:33 +0800
Subject: [ovs-discuss] build OpenvSwitch.deb package failed
Message-ID: <BAY172-W512589F6A722729D407B0DB2160@phx.gbl>

Hi all, I have some questions to ask.

First, I am trying to build OpenvSwitch 2.3.2 .deb package in raspberry with 500MB ram and Debian based Raspberry OS.

But it failed when testing.
820: ofproto-dpif - exponential resubmit chain   FAILED (ofproto-dpif.at:4726)
821: ofproto-dpif - too many output actions        FAILED(ofproto-dpif.at:4741)

I wonder what is the reason causing these errors?

Second, due to testing errors, I am trying to use "DEB_BUILD_OPTIONS='parallel=8 nocheck' fakeroot debian/rules binary" to skip tests, and I finished success.

I wonder if I install these .deb files, which functions may be influenced due to tests failures?

Third, in openvswitch's parent folder, there are many .deb files

drwxrwxr-x 20 sasm sasm    4096 Nov  8 20:52 openvswitch-2.3.2
-rw-r--r--  1 root root 3277164 Jun 19 03:50 openvswitch-2.3.2.tar.gz
-rw-r--r--  1 root root  725388 Nov  8 20:49 openvswitch-common_2.3.2-1_armhf.deb
-rw-r--r--  1 root root 3246776 Nov  8 20:55 openvswitch-datapath-dkms_2.3.2-1_all.deb
-rw-r--r--  1 root root 3323462 Nov  8 20:55 openvswitch-datapath-source_2.3.2-1_all.deb
-rw-r--r--  1 root root 7642302 Nov  8 20:51 openvswitch-dbg_2.3.2-1_armhf.deb
-rw-r--r--  1 root root   38136 Nov  8 20:49 openvswitch-ipsec_2.3.2-1_armhf.deb
-rw-r--r--  1 root root   31962 Nov  8 20:55 openvswitch-pki_2.3.2-1_all.deb
-rw-r--r--  1 root root 1907866 Nov  8 20:49 openvswitch-switch_2.3.2-1_armhf.deb
-rw-r--r--  1 root root   50040 Nov  8 20:55 openvswitch-test_2.3.2-1_all.deb
-rw-r--r--  1 root root  187756 Nov  8 20:49 openvswitch-vtep_2.3.2-1_armhf.deb
-rw-r--r--  1 root root   91236 Nov  8 20:55 python-openvswitch_2.3.2-1_all.deb

Should I install all these .deb files?

Many thanks.

Zhao Jun 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151108/f966ba20/attachment.html>

From amer7777 at hotmail.com  Sun Nov  8 07:53:58 2015
From: amer7777 at hotmail.com (AMER)
Date: Sun, 8 Nov 2015 15:53:58 +0000
Subject: [ovs-discuss] mpls push
Message-ID: <DUB113-W1365C85FD233140C7D48CBD4160@phx.gbl>

Dear all

I would like to ask you about how many mpls labels can be pushed per flow in latest OvS switch version

Best regards,

Eng Amer Alghadhban

COE

SANS-GCFW

CEH, SCNP, CCNA
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151108/0af56c7d/attachment.html>

From zhangzhiming at yunshan.net.cn  Mon Nov  9 05:18:31 2015
From: zhangzhiming at yunshan.net.cn (ZHANG Zhiming)
Date: Mon, 9 Nov 2015 21:18:31 +0800
Subject: [ovs-discuss] ipfix leads to kernel crash
References: <201511022212301753210@yunshan.net.cn>
 <CAEP_g=_e3_ogbw4E1EdLSYemYWYMD6uCkxcJ5ZxsGj_RFViJgQ@mail.gmail.com>
 <201511081832262254792@yunshan.net.cn>, 
 <CAEP_g=8ZrMeMFBPL6f5NFO0=VUPfKo05bzA2FfXe2TD=1unaUA@mail.gmail.com>
Message-ID: <201511092118307590224@yunshan.net.cn>

Hi Gross,

That works!

Thank you very much!


Best regards,




ZHANG Zhiming
Yunshan Networks

From: Jesse Gross
Date: 2015-11-09 20:20
To: zhangzhiming
CC: discuss
Subject: Re: [ovs-discuss] ipfix leads to kernel crash
This is the relevant commit:
https://github.com/openvswitch/ovs/commit/b953042214201e2693a485a8ba8b19f69e5bdf34


Unfortunately, it's not very obvious from the commit message that this is a bug fix.

On Sunday, November 8, 2015, ZHANG Zhiming <zhangzhiming at yunshan.net.cn> wrote:

Hi Gross,

Thank you very much.

You save me so much time.

The version of OVS may not be changed due to some reasons. So I have to fix it on versoin 2.31.
Could you tell me which patch solved this bug?
I checked a commit logs, and found no clues.

Best regards,




ZHANG Zhiming
Yunshan Networks

From: Jesse Gross
Date: 2015-11-07 11:40
To: zhangzhiming
CC: discuss
Subject: Re: [ovs-discuss] ipfix leads to kernel crash
On Monday, November 2, 2015, ZHANG Zhiming <zhangzhiming at yunshan.net.cn> wrote:

Hi,

Could someone help me check this kernel crash?
I set ipfix to send report to a collector, and the kernel crashed after several hours.
Thanks!

ovs-vsctl (Open vSwitch) 2.3.1
Compiled Aug 11 2015 05:18:30
DB Schema 7.6.2


This bug has already been fixed. Please upgrade to either OVS 2.3.2 or 2.4. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151109/c735c66f/attachment.html>

From kevin.traynor at intel.com  Mon Nov  9 05:40:51 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Mon, 9 Nov 2015 13:40:51 +0000
Subject: [ovs-discuss] Fwd: Run dpdk application in a VM
In-Reply-To: <CADYNHPqbC6Spb2uwNEkdVCtXDH0h+Uo83VdOOYg3NHk5ZOHLSQ@mail.gmail.com>
References: <CADYNHPpUaVgB6QucwUVxM6i2+SQDdefF=pTpdsCZnuzpGYnt8A@mail.gmail.com>
 <CADYNHPqbC6Spb2uwNEkdVCtXDH0h+Uo83VdOOYg3NHk5ZOHLSQ@mail.gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7452E2AA9@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Gayathri
> Sent: Thursday, November 5, 2015 5:01 AM
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] Fwd: Run dpdk application in a VM
> 
> Hi *,
> 
> I am new to dpdk please do help me.
> 
> My setup has a host with dpdk-ovs, with VMs connected to it. We need to run
> dpdk applications on these VMs. The host dpdk is built for x86_64-native-
> linuxapp-gcc. Please advice if we should be using x86_64-ivshmem-linuxapp-gcc
> instead.

Native is fine in the host. If you want to use dpdkr ports to the guest, then
dpdk in the guest will have to have be built with ivshmem.

Probably config will be simpler if you use vhost-user. Is there a reason you
want to use dpdkr/ivshmem? 

> 
> Could somebody share with me the steps to install x86_64-ivshmem-linuxapp-gcc
> based dpdk-ovs in the host/guest. Apart from the below two configs, are there
> any more details involved plz suggest
> export RTE_TARGET=x86_64-ivshmem-linuxapp-gcc
> make install T=x86_64-ivshmem-linuxapp-gcc

There's information in the INSTALL.DPDK.md. There was a also a patch that provided
a very long and extremely detailed explanation with different alternatives here 
http://openvswitch.org/pipermail/dev/2015-June/056586.html

> 
> Also please let me know if the hugepages in the VM could be 2M pages or its
> mandatory to have 1 Gb pages.
> 
> Thanks in advance
> Regards,
> Gayathri


From kevin.traynor at intel.com  Mon Nov  9 09:25:16 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Mon, 9 Nov 2015 17:25:16 +0000
Subject: [ovs-discuss] OVS with DPDK Meetup, Nov 18th, San Jose.
Message-ID: <BC0FEEC7D7650749874CEC11314A88F7452E3253@IRSMSX104.ger.corp.intel.com>

Hi,

We're going to have an OVS with DPDK Meetup on Wednesday,
November 18th (day after OVS Conference) in San Jose. 

While there will be some OVS with DPDK presentations in the
OVS conference, having a lot of the people who contribute to
OVS with DPDK in the same place gives a good opportunity to
discuss it further. I'd expect discussion to be lower level
than the OVS Conference on things like usability, performance
improvements, workings of current and future features, testing
etc.

Numbers are limited due to room size, so I've already sent some
invitations to people who are active contributors. At this point
I'd like to open it up to anyone else who wants to attend, and
especially anyone with good ideas!

Details as follows:
Wednesday November 18th, 8:30am - 5:00pm at the Doubletree Hotel, San Jose. 

Please register on Eventbrite
https://www.eventbrite.com/e/ovs-with-dpdk-meetup-tickets-19216389739

Thanks,
Kevin.


From gd0204 at gmail.com  Mon Nov  9 09:53:30 2015
From: gd0204 at gmail.com (Gayathri)
Date: Mon, 9 Nov 2015 09:53:30 -0800
Subject: [ovs-discuss] Fwd: Run dpdk application in a VM
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F7452E2AA9@IRSMSX104.ger.corp.intel.com>
References: <CADYNHPpUaVgB6QucwUVxM6i2+SQDdefF=pTpdsCZnuzpGYnt8A@mail.gmail.com>
 <CADYNHPqbC6Spb2uwNEkdVCtXDH0h+Uo83VdOOYg3NHk5ZOHLSQ@mail.gmail.com>
 <BC0FEEC7D7650749874CEC11314A88F7452E2AA9@IRSMSX104.ger.corp.intel.com>
Message-ID: <CADYNHPo=UEh7322KaNgc8rrAydhML8t9zSXeoH02B8dBCMQWeQ@mail.gmail.com>

Hi Kevin,

Thank you for the reply. With vhost-user it was not working and vswitchd
crashed in host, aswell as guest. So was thinking if that was the right
mode to have dpdk applications working in the VM.


Regards,
Gayathri

On Mon, Nov 9, 2015 at 5:40 AM, Traynor, Kevin <kevin.traynor at intel.com>
wrote:

>
> > -----Original Message-----
> > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> Gayathri
> > Sent: Thursday, November 5, 2015 5:01 AM
> > To: discuss at openvswitch.org
> > Subject: [ovs-discuss] Fwd: Run dpdk application in a VM
> >
> > Hi *,
> >
> > I am new to dpdk please do help me.
> >
> > My setup has a host with dpdk-ovs, with VMs connected to it. We need to
> run
> > dpdk applications on these VMs. The host dpdk is built for x86_64-native-
> > linuxapp-gcc. Please advice if we should be
> using x86_64-ivshmem-linuxapp-gcc
> > instead.
>
> Native is fine in the host. If you want to use dpdkr ports to the guest,
> then
> dpdk in the guest will have to have be built with ivshmem.
>
> Probably config will be simpler if you use vhost-user. Is there a reason
> you
> want to use dpdkr/ivshmem?
>
> >
> > Could somebody share with me the steps to
> install x86_64-ivshmem-linuxapp-gcc
> > based dpdk-ovs in the host/guest. Apart from the below two configs, are
> there
> > any more details involved plz suggest
> > export RTE_TARGET=x86_64-ivshmem-linuxapp-gcc
> > make install T=x86_64-ivshmem-linuxapp-gcc
>
> There's information in the INSTALL.DPDK.md. There was a also a patch that
> provided
> a very long and extremely detailed explanation with different alternatives
> here
> http://openvswitch.org/pipermail/dev/2015-June/056586.html
>
> >
> > Also please let me know if the hugepages in the VM could be 2M pages or
> its
> > mandatory to have 1 Gb pages.
> >
> > Thanks in advance
> > Regards,
> > Gayathri
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151109/5e190ae5/attachment-0001.html>

From V_Dham at Dell.com  Mon Nov  9 10:18:24 2015
From: V_Dham at Dell.com (V_Dham at Dell.com)
Date: Mon, 9 Nov 2015 12:18:24 -0600
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <20151103212901.GH13445@nicira.com>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
 <20151103195746.GU13445@nicira.com>
 <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>
 <56391CF9.8000803@redhat.com> <20151103210103.GF13445@nicira.com>
 <563923FC.3070003@redhat.com>,<20151103212901.GH13445@nicira.com>
Message-ID: <81BC5BD589E8294BB3F1DA06D04E8A642A89B0619C@AUSX7MCPC107.AMER.DELL.COM>

> My original thought was a new table of chains.  Each chain has a list of
> service endpoints (originally i had this as logical ports, but it'd need
> to be IP or MAC addresses, I guess).  A chain would also have a match
> defined in the same syntax used by ACLs.  I imagined the implementation
> in a separate logical flow table.

Would the IP or MAC addresses be on same logical network or outside it?

> I wonder how much of this OPNFV has specified?  This seems like the
> perfect sort of thing OPNFV can help specify and work with upstream
> projects to get implemented.

>> Yes, I think so too.

Will be at OPNFV summit to get clarity on SFC requirements. 

Thanks,

Vikram
________________________________________
From: Ben Pfaff [blp at nicira.com]
Sent: Tuesday, November 03, 2015 1:29 PM
To: Russell Bryant
Cc: Thomas Graf; Dham, V; Justin Pettit; discuss at openvswitch.org
Subject: Re: [ovs-discuss] SFC using OVN

On Tue, Nov 03, 2015 at 04:15:40PM -0500, Russell Bryant wrote:
> On 11/03/2015 04:01 PM, Ben Pfaff wrote:
> > On Tue, Nov 03, 2015 at 03:45:45PM -0500, Russell Bryant wrote:
> >> In the meantime, we can be working on how to model this properly in
> >> OVN_Northbound, as well as trying to work out a reasonable
> >> implementation based on Geneve.  The modeling in my prototype isn't
> >> expressive enough.
> >
> > The model that I proposed in Tokyo was to make redirection through a
> > chain one of the possible actions for ACLs in the OVN_Northbound
> > database.  (I'm not claiming this is original or inspired; maybe you had
> > the same idea.)
>
> And have the chain be a list of parameters to the action?

Yes.  That could be some kind of inline set of parameters in the ACL
table, or a reference to some new table.

> My original thought was a new table of chains.  Each chain has a list of
> service endpoints (originally i had this as logical ports, but it'd need
> to be IP or MAC addresses, I guess).  A chain would also have a match
> defined in the same syntax used by ACLs.  I imagined the implementation
> in a separate logical flow table.
>
> I guess both sound like the same thing, really.  It's just a matter of
> how strictly the data gets structured in OVN_Northbound.  Doing it in
> ACLs sounds pretty convenient and actually makes good sense when
> thinking about where this fits into the logical flow stages.

Some differences:

        * If chains are a separate table then one must define whether
          ACLs are applied before or after service chains.  If chains
          are part of the ACL table then some ACLs could have higher
          priority than chaining, which could be a useful way to drop
          some packets without bothering to process them through chains.

        * Only a single ACL can apply to a packet (on ingress or egress)
          so using ACLs for chains would prevent doing connection
          tracking ACLs for packets that pass through chains.  I don't
          know whether users would want to combine them but if so then
          this would be a problem.

I guess another way to handle it would be to add a new chains table as
you suggest, and then add another ACL direction, so that you'd have
from-lport-pre-chains, from-lport-post-chains, and to-lport directions.
Sort of like prerouting, postrouting, etc. in iptables.  At that point
I'm not sure that "direction" is the right vocabulary word but we can
paint that bikeshed when we get there.

> I wonder how much of this OPNFV has specified?  This seems like the
> perfect sort of thing OPNFV can help specify and work with upstream
> projects to get implemented.

Yes, I think so too.

From rbryant at redhat.com  Mon Nov  9 12:07:58 2015
From: rbryant at redhat.com (Russell Bryant)
Date: Mon, 9 Nov 2015 15:07:58 -0500
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <81BC5BD589E8294BB3F1DA06D04E8A642A89B0619C@AUSX7MCPC107.AMER.DELL.COM>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
 <20151103195746.GU13445@nicira.com>
 <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>
 <56391CF9.8000803@redhat.com> <20151103210103.GF13445@nicira.com>
 <563923FC.3070003@redhat.com> <20151103212901.GH13445@nicira.com>
 <81BC5BD589E8294BB3F1DA06D04E8A642A89B0619C@AUSX7MCPC107.AMER.DELL.COM>
Message-ID: <5640FD1E.2070701@redhat.com>

On 11/09/2015 01:18 PM, V_Dham at dell.com wrote:
>> My original thought was a new table of chains.  Each chain has a list of
>> service endpoints (originally i had this as logical ports, but it'd need
>> to be IP or MAC addresses, I guess).  A chain would also have a match
>> defined in the same syntax used by ACLs.  I imagined the implementation
>> in a separate logical flow table.
> 
> Would the IP or MAC addresses be on same logical network or outside it?

Everything is on the table.  My guess is that in both cases, it could be
either.

An L2 destination could be on the same logical network, or on a physical
network on the other side of a vtep logical-to-physical gateway.  An L3
destination just has to be route-able from the current logical network,
so it could be either.

>> I wonder how much of this OPNFV has specified?  This seems like the
>> perfect sort of thing OPNFV can help specify and work with upstream
>> projects to get implemented.
> 
>>> Yes, I think so too.
> 
> Will be at OPNFV summit to get clarity on SFC requirements. 

Great, thanks.  I'd like to get started on a design doc that starts to
capture the details.  It may still be a few weeks before I can get back
to it, though.

-- 
Russell Bryant

From muralirdev at gmail.com  Mon Nov  9 21:28:05 2015
From: muralirdev at gmail.com (Murali R)
Date: Mon, 9 Nov 2015 23:28:05 -0600
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <5640FD1E.2070701@redhat.com>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
 <20151103195746.GU13445@nicira.com>
 <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>
 <56391CF9.8000803@redhat.com> <20151103210103.GF13445@nicira.com>
 <563923FC.3070003@redhat.com> <20151103212901.GH13445@nicira.com>
 <81BC5BD589E8294BB3F1DA06D04E8A642A89B0619C@AUSX7MCPC107.AMER.DELL.COM>
 <5640FD1E.2070701@redhat.com>
Message-ID: <CAO=R8ok-jpEuoZ-4wP24JPCak=+seqWD+spL9+yMrpU38iUROg@mail.gmail.com>

In the old poc (march - may 2015) the way the service chains worked was a
custom flow programmed based on an nsh key per chain. The nsh header was
sort of the service chain key. The flow was programmed from ovs agent. For
instance you would have video compression and url filter on a chain. They
could be on same hypervisor or different one. The flows were built with
condition nsh header (and few more params) and action routed to next
destination using the following process (abstract).
- Input was 5 tuple + list of dict with IP address of vnf, prev-vnf and
next-vnf. For first, the prev was HEAD and last next was TAIL enums in the
input.
- In the neutron servicechain plugin I was able to create a linked-list of
VNFs using IP address chain list within a plugin. For each node I got the
ports, device id  & mac addresses from the neutron db.
- The enhanced linked-list was then broadcast to all agents (could be
optimized) and each agent identified itself in the chain and programmed the
flows for that node. If it didn't find itself, the agent would not alter
standard flows. If the prev had an IP (not HEAD enum) then there is ingress
path. So I routed the packets from br-int (I guess it was table 20 or 40
from br-tun patch), the next hop was programmed to the mac address within
the switch.
- A dedicated nsh tunnel was created (different port) if there was an
egress to next node, the packet was moved to egress table (I recall 40?) so
it went out to the next hypervisor. Note that unclassified traffic would go
though the standard vxlan tunnel.
- A custom flow definition was required from entry point classifier to the
first vnf in the chain
- A custom flow also routed all traffic from user end points to the
classifier mentioned above.
- Once the flows programmed, packets with that nsh header would traverse
that chain once the classifier puts the packets in this network.

For the poc, all the vnf were in the same network. Additional work was
needed to do the routing across networks but was not done due to time
constraint. The actual solution was a bit more detailed in impl than the
abstract above.

The issue with the solution was the nsh had to be re-classified every time
packet came out of a VNF because they (vnf) were not service aware. Also
there was a hack added to use another port & tunnel type in ovs by one of
my colleague to handle nsh header - so we were able to add an action to put
the value of nsh at an address upon classification. I had to enhance ovs
agent and kvm lib to pass these data through to the ovs.

The solution was not clean but worked. We were able to dynamically create
flows based on a servicechain input. Because the nsh was not traveling
through the switch if we had multiple VNFs on one hypervisor, this needed
multiple re-classification steps.

In the current run with OVN, a better way to program the flows will be
using ovn metadata within the OVN domain. Once it heads out (towards vtep),
one could use mpls tags or nsh headers. Because we already use metadata
info to manage networks, it is not essential to use nsh headers in OVN and
probably (not sure) can be routed without reclassification. However, in the
old poc the flows were programmed from individual hypervisors by ovs agent
so was more predictable. Now it has to be done by the ovn controller by
translating NB DB data and has to maintain the associations in lflow -
phy-flow creations, I have not yet figured out a way to do that, Besides
sfc, I have many other use cases for custom flow definitions. So any design
ideas welcome.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151109/0c117428/attachment.html>

From zhangxinyi1111 at 126.com  Mon Nov  9 22:05:30 2015
From: zhangxinyi1111 at 126.com (=?GBK?B?1cXqv+L5?=)
Date: Tue, 10 Nov 2015 14:05:30 +0800 (CST)
Subject: [ovs-discuss] Open vSwitch running on DPDK
Message-ID: <521de145.9f19.150efffcdc4.Coremail.zhangxinyi1111@126.com>

When Open vSwitch is running on DPDK, we know that the OVS is in userspace. I read the source code and found that the userspace has a cache like microflow. My question is that is there a version that also has megaflow in userspace ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151110/2bb26397/attachment.html>

From xushengping2015 at foxmail.com  Mon Nov  9 23:24:11 2015
From: xushengping2015 at foxmail.com (=?ISO-8859-1?B?c2hlbmdwaW5nLnh1?=)
Date: Tue, 10 Nov 2015 15:24:11 +0800
Subject: [ovs-discuss] Memory leak problem
Message-ID: <tencent_653FEC7F34224BB859D1E2C0@qq.com>

Hello everyone:
       After testing, there may be a memory lead problem in function ovsthread_key_destruct__,for details,see e-mail attachment.
Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151110/936f8333/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 5ABUW%U08Y]VMP{}1DK%553.png
Type: application/octet-stream
Size: 22813 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151110/936f8333/attachment-0001.obj>

From dotslash.lu at gmail.com  Tue Nov 10 04:52:19 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Tue, 10 Nov 2015 20:52:19 +0800
Subject: [ovs-discuss] Tag lost after network restart
Message-ID: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>

Hi all,

I set a tag on a port, but once I restart the network service, e.g.
/etc/init.d/network restart, the tag will be lost, tested on both 2.3.2 and
2.4.0. Is this normal? How can I make vlan tag persistent?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151110/590b913e/attachment.html>

From antonio.fischetti at intel.com  Tue Nov 10 05:50:39 2015
From: antonio.fischetti at intel.com (Fischetti, Antonio)
Date: Tue, 10 Nov 2015 13:50:39 +0000
Subject: [ovs-discuss] Open vSwitch running on DPDK
In-Reply-To: <521de145.9f19.150efffcdc4.Coremail.zhangxinyi1111@126.com>
References: <521de145.9f19.150efffcdc4.Coremail.zhangxinyi1111@126.com>
Message-ID: <BCFD2BB875535045A5368D9ADBF2969909C3F4A0@IRSMSX101.ger.corp.intel.com>

Hi,
Please find below my replies inline.

> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of ???
> Sent: Tuesday, November 10, 2015 6:06 AM
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] Open vSwitch running on DPDK
> 
> When Open vSwitch is running on DPDK, we know that the OVS is in
> userspace. I read the source code and found that the userspace has a cache
> like microflow. My question is that is there a version that also has megaflow
> in userspace ?
> 
> 
Yes, megaflows - i.e. wildcarded flows - are managed in User-Space. 
Megaflows are collected in the Classifier Table, while microflows are 
collected in the EMC table (= Exact Match Cache). 
So both tables are now running in User Space. 
You can find their implementations in OVS/lib/dpif-netdev.c. 
All the functions like 'emc_insert()', 'emc_lookup()', 'emc_..' refer to the 
microflow cache (EMC).
Instead the functions like 'dpcls_insert()', 'dpcls_lookup()', 'dpcls_..' refer 
to the megaflow cache (Classifier).
If you like to see how a packet gets processed and 'bounced' by one table up 
to the other, you could start from the function dp_netdev_process_rxq_port(). 
By following the function calls you will see the decoding, then the lookup 
against the EMC. If that fails there's will be a lookup against the Classifier. 
All these functions are in 'dpif-netdev.c'.
Hope that helps.
--------------------------------------------------------------
Intel Research and Development Ireland Limited
Registered in Ireland
Registered Office: Collinstown Industrial Park, Leixlip, County Kildare
Registered Number: 308263


This e-mail and any attachments may contain confidential material for the sole
use of the intended recipient(s). Any review or distribution by others is
strictly prohibited. If you are not the intended recipient, please contact the
sender and delete all copies.

From blp at ovn.org  Tue Nov 10 09:53:21 2015
From: blp at ovn.org (Ben Pfaff)
Date: Tue, 10 Nov 2015 09:53:21 -0800
Subject: [ovs-discuss] Point-To-Point link for IPv4-IPv6-MPLS packets
In-Reply-To: <CALkUq2j6v8vXX74NGqEYczC_xkzU1V+7=hWLobPNUMDKcBxUWA@mail.gmail.com>
References: <CALkUq2j6v8vXX74NGqEYczC_xkzU1V+7=hWLobPNUMDKcBxUWA@mail.gmail.com>
Message-ID: <20151110175321.GK31271@ovn.org>

On Tue, Oct 20, 2015 at 04:34:25PM -0700, Pavel Shirshov wrote:
> I'm trying to set raw point-to-point link using openvswitch 2.0.2
> (ubuntu trusty default option). By raw I mean that all packets which
> are egress for the first interface should be ingress for the second
> and otherwise. No other options or checks. But I see in ovs-dpctl
> output that only ipv4 packets are forwarded.
> 
> I create the bridge and connect two ports to the bridge
> # ovs-vsctl add-br b0002.03bb
> # ovs-vsctl add-port b0002.03bb
> # ovs-vsctl add-port b0002.03bb
> 
> Check it
> # ovs-vsctl show
>     Bridge "b0002.03bb"
>         Port "b0002.03bb"
>             Interface "b0002.03bb"
>                 type: internal
>         Port "t0002.0120"
>             Interface "t0002.0120"
>         Port "t0002.011f"
>             Interface "t0002.011f"
> 
> Set the bridge rules to forward all packets between ports
> # ovs-ofctl del-flows b0002.03bb
> # ovs-ofctl add-flow b0002.03bb 'table=0,in_port=1,action=output:2']
> # ovs-ofctl add-flow b0002.03bb 'table=0,in_port=2,action=output:1']
> 
> Check flows in ovs-ofctl
> # ovs-ofctl dump-flows b0002.03bb
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=1274.478s, table=0, n_packets=1701895,
> n_bytes=187088564, idle_age=1, in_port=1 actions=output:2
>  cookie=0x0, duration=1274.466s, table=0, n_packets=8393232,
> n_bytes=1024054033, idle_age=0, in_port=2 actions=output:1
> 
> Check flows in ovs-dpctl
> # ovs-dpctl show | egrep 't0002.0120|t0002.011f'
>         port 394: t0002.0120
>         port 404: t0002.011f
> 
> # ovs-dpctl dump-flows | fgrep '(404)'
> skb_priority(0),in_port(404),eth_type(0x0800),ipv4(src=172.16.0.1/0.0.0.0,dst=172.16.0.2/0.0.0.0,proto=6/0,tos=0xc0/0,ttl=64/0,frag=no/0xff),
> packets:4658053, bytes:564867731, used:0.083s, flags:SP., actions:394
> 
> # ovs-dpctl dump-flows | fgrep 'actions:404'
> skb_priority(0),in_port(394),eth_type(0x0800),ipv4(src=172.16.0.2/0.0.0.0,dst=172.16.0.1/0.0.0.0,proto=6/0,tos=0/0,ttl=64/0,frag=no/0xff),
> packets:2092237, bytes:277216996, used:0.000s, flags:SFP., actions:404
> 
> Surprisingly I found that my openvswitch forward ipv4 traffic only:
> "eth_type(0x0800)".
> Is it possible to forward MPLS and IPv6 traffic too?

The flows displayed by ovs-dpctl are based on the traffic actually
observed.  If you've only actually been passing in IPv4 traffic in the
last few seconds, you'll only see a flow for IPv4 there.

From muralirdev at gmail.com  Tue Nov 10 11:03:15 2015
From: muralirdev at gmail.com (Murali R)
Date: Tue, 10 Nov 2015 13:03:15 -0600
Subject: [ovs-discuss] SFC using OVN
In-Reply-To: <CAO=R8ok-jpEuoZ-4wP24JPCak=+seqWD+spL9+yMrpU38iUROg@mail.gmail.com>
References: <81BC5BD589E8294BB3F1DA06D04E8A642A89B060DC@AUSX7MCPC107.AMER.DELL.COM>
 <20151103195746.GU13445@nicira.com>
 <CACjuMbyhJhEoLeHuaP8JyxRjfPdVpmrakhYYUWw9KNR-06LAsw@mail.gmail.com>
 <56391CF9.8000803@redhat.com> <20151103210103.GF13445@nicira.com>
 <563923FC.3070003@redhat.com> <20151103212901.GH13445@nicira.com>
 <81BC5BD589E8294BB3F1DA06D04E8A642A89B0619C@AUSX7MCPC107.AMER.DELL.COM>
 <5640FD1E.2070701@redhat.com>
 <CAO=R8ok-jpEuoZ-4wP24JPCak=+seqWD+spL9+yMrpU38iUROg@mail.gmail.com>
Message-ID: <CAO=R8o=bQDb2HKoJBnmbGDWPxK4PSEdsk7NmN1Hh2Kwgp-xMaQ@mail.gmail.com>

On the ACL preceding or integrated with the sfc flow - I think ACL has to
be applied first then the classifier channels the packets to the respective
network that has VNFs. The scope of sfc flow programming is generally
orthogonal to how the network is setup and where classifier is placed,
which are typically done during the system setup. Typically the classifier
adds the service chain id, which probably better off past the acl..

                                   internet
                                        /\
                     __________|____
     <ACL>----| classifier |(GW) |-------> vnfs
                     ~~~~~~~~~~~~~
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151110/1ab05972/attachment.html>

From blp at ovn.org  Tue Nov 10 11:28:33 2015
From: blp at ovn.org (Ben Pfaff)
Date: Tue, 10 Nov 2015 11:28:33 -0800
Subject: [ovs-discuss] Tag lost after network restart
In-Reply-To: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
References: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
Message-ID: <20151110192833.GB10475@ovn.org>

On Tue, Nov 10, 2015 at 08:52:19PM +0800, Tashi Lu wrote:
> I set a tag on a port, but once I restart the network service, e.g.
> /etc/init.d/network restart, the tag will be lost, tested on both 2.3.2 and
> 2.4.0. Is this normal? How can I make vlan tag persistent?

No, that doesn't make sense.

How are you setting up your configuration?

From dotslash.lu at gmail.com  Wed Nov 11 18:42:51 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Thu, 12 Nov 2015 10:42:51 +0800
Subject: [ovs-discuss] Tag lost after network restart
In-Reply-To: <20151110192833.GB10475@ovn.org>
References: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
 <20151110192833.GB10475@ovn.org>
Message-ID: <CALrtOxpHUz_MF9v264qXRv+w4gntPW_7L0fBLVHFQiGOuJ_h+A@mail.gmail.com>

Hi blp, Shetty,

Sorry for my late reply.
uname -a: 2.6.32-504.el6.x86_64 #1 SMP Wed Oct 15 04:27:16 UTC 2014 x86_64
x86_64 x86_64 GNU/Linux

before restarting network:
[root at GZ-NS-C1-POOL-kvm-ops-150.20 openvswitch]# ovs-vsctl show
c5ee1b0f-e7ec-4c73-a3fa-c79662619cba
    Bridge "ovsbr0"
        Port "v5254007ec542"
            tag: 142
            Interface "v5254007ec542"
        Port "bond0"
            Interface "bond0"
        Port "ovsbr0"
            tag: 150
            Interface "ovsbr0"
                type: internal

after: http://imgur.com/jU4CY2i (sorry for a image link, because the
network was lost I had to use virtual console thus unable to copy text)

We can see both the vlan tag and the port I created for a virtual machine
was lost after the network restart.
I think it might be related to /etc/sysconfig/network-scripts/ifup-ovs,
since this is the only point ovs relates to `service network restart`.

And there are no special logs in ovs-ctl.log, ovsdb-server.log, and
ovs-vswitchd.log. But my ovs-vswitchd.log keeps logging following lines
every second, is this relevant?:

2015-11-12T02:33:57.516Z|584314|dpif(revalidator406)|WARN|Dropped 3 log
messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
rate
2015-11-12T02:33:57.516Z|584315|dpif(revalidator406)|WARN|system at ovs-system:
get_stats failed (No such file or directory)
2015-11-12T02:33:57.516Z|584316|netlink_socket(revalidator406)|INFO|Dropped
1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
excessive rate
2015-11-12T02:33:57.516Z|584317|netlink_socket(revalidator406)|INFO|netlink
dump request error (No such file or directory)
2015-11-12T02:33:58.518Z|584318|dpif(revalidator406)|WARN|Dropped 3 log
messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
rate
2015-11-12T02:33:58.518Z|584319|dpif(revalidator406)|WARN|system at ovs-system:
get_stats failed (No such file or directory)
2015-11-12T02:33:58.518Z|584320|netlink_socket(revalidator406)|INFO|Dropped
1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
excessive rate
2015-11-12T02:33:58.518Z|584321|netlink_socket(revalidator406)|INFO|netlink
dump request error (No such file or directory)
2015-11-12T02:33:59.520Z|584322|dpif(revalidator406)|WARN|Dropped 3 log
messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
rate
2015-11-12T02:33:59.520Z|584323|dpif(revalidator406)|WARN|system at ovs-system:
get_stats failed (No such file or directory)
2015-11-12T02:33:59.520Z|584324|netlink_socket(revalidator406)|INFO|Dropped
1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
excessive rate
2015-11-12T02:33:59.520Z|584325|netlink_socket(revalidator406)|INFO|netlink
dump request error (No such file or directory)
2015-11-12T02:34:00.520Z|584326|dpif(revalidator406)|WARN|Dropped 3 log
messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
rate
2015-11-12T02:34:00.520Z|584327|dpif(revalidator406)|WARN|system at ovs-system:
get_stats failed (No such file or directory)
2015-11-12T02:34:00.520Z|584328|netlink_socket(revalidator406)|INFO|Dropped
1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
excessive rate
2015-11-12T02:34:00.520Z|584329|netlink_socket(revalidator406)|INFO|netlink
dump request error (No such file or directory)

On 11 November 2015 at 03:28, Ben Pfaff <blp at ovn.org> wrote:

> On Tue, Nov 10, 2015 at 08:52:19PM +0800, Tashi Lu wrote:
> > I set a tag on a port, but once I restart the network service, e.g.
> > /etc/init.d/network restart, the tag will be lost, tested on both 2.3.2
> and
> > 2.4.0. Is this normal? How can I make vlan tag persistent?
>
> No, that doesn't make sense.
>
> How are you setting up your configuration?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/59ce828d/attachment.html>

From dotslash.lu at gmail.com  Wed Nov 11 19:02:16 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Thu, 12 Nov 2015 11:02:16 +0800
Subject: [ovs-discuss] Tag lost after network restart
In-Reply-To: <CALrtOxpHUz_MF9v264qXRv+w4gntPW_7L0fBLVHFQiGOuJ_h+A@mail.gmail.com>
References: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
 <20151110192833.GB10475@ovn.org>
 <CALrtOxpHUz_MF9v264qXRv+w4gntPW_7L0fBLVHFQiGOuJ_h+A@mail.gmail.com>
Message-ID: <CALrtOxqf=jjevy0fCb1rw-vhxoX8EiSyqNg=eYCYdYj=xAeObQ@mail.gmail.com>

By the way, I just saw some one with the same situation:
http://website-humblec.rhcloud.com/configure-openvswitch-in-virt-environment/
search with 'lost' you'll see that comment.

And he used Ubuntu, so this problem is platform irrelevant. I'm guessing
misconfiguration now. But I don't know where I did wrong. Here are my
ifcfgs:

ifcfg-bond0:
DEVICE=bond0
ONBOOT=yes
BOOTPROTO=none
TYPE=OVSPort
DEVICETYPE=ovs
OVS_BRIDGE=ovsbr0

ifcfg-ovsbr0:
IPADDR=10.3.150.20
NETMASK=255.255.255.0
DEVICE=ovsbr0
TYPE=OVSBridge
DEVICETYPE=ovs
ONBOOT=yes
BOOT_PROTO=static


On 12 November 2015 at 10:42, Tashi Lu <dotslash.lu at gmail.com> wrote:

> Hi blp, Shetty,
>
> Sorry for my late reply.
> uname -a: 2.6.32-504.el6.x86_64 #1 SMP Wed Oct 15 04:27:16 UTC 2014 x86_64
> x86_64 x86_64 GNU/Linux
>
> before restarting network:
> [root at GZ-NS-C1-POOL-kvm-ops-150.20 openvswitch]# ovs-vsctl show
> c5ee1b0f-e7ec-4c73-a3fa-c79662619cba
>     Bridge "ovsbr0"
>         Port "v5254007ec542"
>             tag: 142
>             Interface "v5254007ec542"
>         Port "bond0"
>             Interface "bond0"
>         Port "ovsbr0"
>             tag: 150
>             Interface "ovsbr0"
>                 type: internal
>
> after: http://imgur.com/jU4CY2i (sorry for a image link, because the
> network was lost I had to use virtual console thus unable to copy text)
>
> We can see both the vlan tag and the port I created for a virtual machine
> was lost after the network restart.
> I think it might be related to /etc/sysconfig/network-scripts/ifup-ovs,
> since this is the only point ovs relates to `service network restart`.
>
> And there are no special logs in ovs-ctl.log, ovsdb-server.log, and
> ovs-vswitchd.log. But my ovs-vswitchd.log keeps logging following lines
> every second, is this relevant?:
>
> 2015-11-12T02:33:57.516Z|584314|dpif(revalidator406)|WARN|Dropped 3 log
> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
> rate
> 2015-11-12T02:33:57.516Z|584315|dpif(revalidator406)|WARN|system at ovs-system:
> get_stats failed (No such file or directory)
> 2015-11-12T02:33:57.516Z|584316|netlink_socket(revalidator406)|INFO|Dropped
> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
> excessive rate
> 2015-11-12T02:33:57.516Z|584317|netlink_socket(revalidator406)|INFO|netlink
> dump request error (No such file or directory)
> 2015-11-12T02:33:58.518Z|584318|dpif(revalidator406)|WARN|Dropped 3 log
> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
> rate
> 2015-11-12T02:33:58.518Z|584319|dpif(revalidator406)|WARN|system at ovs-system:
> get_stats failed (No such file or directory)
> 2015-11-12T02:33:58.518Z|584320|netlink_socket(revalidator406)|INFO|Dropped
> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
> excessive rate
> 2015-11-12T02:33:58.518Z|584321|netlink_socket(revalidator406)|INFO|netlink
> dump request error (No such file or directory)
> 2015-11-12T02:33:59.520Z|584322|dpif(revalidator406)|WARN|Dropped 3 log
> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
> rate
> 2015-11-12T02:33:59.520Z|584323|dpif(revalidator406)|WARN|system at ovs-system:
> get_stats failed (No such file or directory)
> 2015-11-12T02:33:59.520Z|584324|netlink_socket(revalidator406)|INFO|Dropped
> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
> excessive rate
> 2015-11-12T02:33:59.520Z|584325|netlink_socket(revalidator406)|INFO|netlink
> dump request error (No such file or directory)
> 2015-11-12T02:34:00.520Z|584326|dpif(revalidator406)|WARN|Dropped 3 log
> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
> rate
> 2015-11-12T02:34:00.520Z|584327|dpif(revalidator406)|WARN|system at ovs-system:
> get_stats failed (No such file or directory)
> 2015-11-12T02:34:00.520Z|584328|netlink_socket(revalidator406)|INFO|Dropped
> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
> excessive rate
> 2015-11-12T02:34:00.520Z|584329|netlink_socket(revalidator406)|INFO|netlink
> dump request error (No such file or directory)
>
> On 11 November 2015 at 03:28, Ben Pfaff <blp at ovn.org> wrote:
>
>> On Tue, Nov 10, 2015 at 08:52:19PM +0800, Tashi Lu wrote:
>> > I set a tag on a port, but once I restart the network service, e.g.
>> > /etc/init.d/network restart, the tag will be lost, tested on both 2.3.2
>> and
>> > 2.4.0. Is this normal? How can I make vlan tag persistent?
>>
>> No, that doesn't make sense.
>>
>> How are you setting up your configuration?
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/7d186860/attachment.html>

From dotslash.lu at gmail.com  Wed Nov 11 19:45:17 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Thu, 12 Nov 2015 11:45:17 +0800
Subject: [ovs-discuss] Tag lost after network restart
In-Reply-To: <CALrtOxqf=jjevy0fCb1rw-vhxoX8EiSyqNg=eYCYdYj=xAeObQ@mail.gmail.com>
References: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
 <20151110192833.GB10475@ovn.org>
 <CALrtOxpHUz_MF9v264qXRv+w4gntPW_7L0fBLVHFQiGOuJ_h+A@mail.gmail.com>
 <CALrtOxqf=jjevy0fCb1rw-vhxoX8EiSyqNg=eYCYdYj=xAeObQ@mail.gmail.com>
Message-ID: <CALrtOxrZz_94ce+Rc8m99w_+oYOoud8K-8SmTRr8683opHU0kQ@mail.gmail.com>

Update:
Since there are too many messages, I cleaned the ovs-vswitchd.log and found
these after I restart network,
2015-11-12T03:18:20.337Z|594939|dpif(revalidator406)|WARN|Dropped 3 log
messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
rate
2015-11-12T03:18:20.338Z|594940|dpif(revalidator406)|WARN|system at ovs-system:
get_stats failed (No such file or directory)
2015-11-12T03:18:20.338Z|594941|netlink_socket(revalidator406)|INFO|Dropped
1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
excessive rate
2015-11-12T03:18:20.338Z|594942|netlink_socket(revalidator406)|INFO|netlink
dump request error (No such file or directory)
2015-11-12T03:18:20.725Z|05099|netdev_linux|INFO|ioctl(SIOCGIFHWADDR) on
ovsbr0 device failed: No such device
2015-11-12T03:18:20.729Z|05100|netdev_linux|WARN|ioctl(SIOCGIFINDEX) on
ovsbr0 device failed: No such device
2015-11-12T03:18:21.337Z|594943|dpif(revalidator406)|WARN|Dropped 3 log
messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
rate
2015-11-12T03:18:21.337Z|594944|dpif(revalidator406)|WARN|system at ovs-system:
get_stats failed (No such file or directory)
2015-11-12T03:18:21.337Z|594945|netlink_socket(revalidator406)|INFO|Dropped
1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
excessive rate
2015-11-12T03:18:21.337Z|594946|netlink_socket(revalidator406)|INFO|netlink
dump request error (No such file or directory)

"on ovsbr0 device failed, no such device"? But after restart, ovsbr0 was
up. And why those "No such file or directory"s?

On 12 November 2015 at 11:02, Tashi Lu <dotslash.lu at gmail.com> wrote:

> By the way, I just saw some one with the same situation:
> http://website-humblec.rhcloud.com/configure-openvswitch-in-virt-environment/
> search with 'lost' you'll see that comment.
>
> And he used Ubuntu, so this problem is platform irrelevant. I'm guessing
> misconfiguration now. But I don't know where I did wrong. Here are my
> ifcfgs:
>
> ifcfg-bond0:
> DEVICE=bond0
> ONBOOT=yes
> BOOTPROTO=none
> TYPE=OVSPort
> DEVICETYPE=ovs
> OVS_BRIDGE=ovsbr0
>
> ifcfg-ovsbr0:
> IPADDR=10.3.150.20
> NETMASK=255.255.255.0
> DEVICE=ovsbr0
> TYPE=OVSBridge
> DEVICETYPE=ovs
> ONBOOT=yes
> BOOT_PROTO=static
>
>
> On 12 November 2015 at 10:42, Tashi Lu <dotslash.lu at gmail.com> wrote:
>
>> Hi blp, Shetty,
>>
>> Sorry for my late reply.
>> uname -a: 2.6.32-504.el6.x86_64 #1 SMP Wed Oct 15 04:27:16 UTC 2014
>> x86_64 x86_64 x86_64 GNU/Linux
>>
>> before restarting network:
>> [root at GZ-NS-C1-POOL-kvm-ops-150.20 openvswitch]# ovs-vsctl show
>> c5ee1b0f-e7ec-4c73-a3fa-c79662619cba
>>     Bridge "ovsbr0"
>>         Port "v5254007ec542"
>>             tag: 142
>>             Interface "v5254007ec542"
>>         Port "bond0"
>>             Interface "bond0"
>>         Port "ovsbr0"
>>             tag: 150
>>             Interface "ovsbr0"
>>                 type: internal
>>
>> after: http://imgur.com/jU4CY2i (sorry for a image link, because the
>> network was lost I had to use virtual console thus unable to copy text)
>>
>> We can see both the vlan tag and the port I created for a virtual machine
>> was lost after the network restart.
>> I think it might be related to /etc/sysconfig/network-scripts/ifup-ovs,
>> since this is the only point ovs relates to `service network restart`.
>>
>> And there are no special logs in ovs-ctl.log, ovsdb-server.log, and
>> ovs-vswitchd.log. But my ovs-vswitchd.log keeps logging following lines
>> every second, is this relevant?:
>>
>> 2015-11-12T02:33:57.516Z|584314|dpif(revalidator406)|WARN|Dropped 3 log
>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>> rate
>>
>> 2015-11-12T02:33:57.516Z|584315|dpif(revalidator406)|WARN|system at ovs-system:
>> get_stats failed (No such file or directory)
>> 2015-11-12T02:33:57.516Z|584316|netlink_socket(revalidator406)|INFO|Dropped
>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>> excessive rate
>> 2015-11-12T02:33:57.516Z|584317|netlink_socket(revalidator406)|INFO|netlink
>> dump request error (No such file or directory)
>> 2015-11-12T02:33:58.518Z|584318|dpif(revalidator406)|WARN|Dropped 3 log
>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>> rate
>>
>> 2015-11-12T02:33:58.518Z|584319|dpif(revalidator406)|WARN|system at ovs-system:
>> get_stats failed (No such file or directory)
>> 2015-11-12T02:33:58.518Z|584320|netlink_socket(revalidator406)|INFO|Dropped
>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>> excessive rate
>> 2015-11-12T02:33:58.518Z|584321|netlink_socket(revalidator406)|INFO|netlink
>> dump request error (No such file or directory)
>> 2015-11-12T02:33:59.520Z|584322|dpif(revalidator406)|WARN|Dropped 3 log
>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>> rate
>>
>> 2015-11-12T02:33:59.520Z|584323|dpif(revalidator406)|WARN|system at ovs-system:
>> get_stats failed (No such file or directory)
>> 2015-11-12T02:33:59.520Z|584324|netlink_socket(revalidator406)|INFO|Dropped
>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>> excessive rate
>> 2015-11-12T02:33:59.520Z|584325|netlink_socket(revalidator406)|INFO|netlink
>> dump request error (No such file or directory)
>> 2015-11-12T02:34:00.520Z|584326|dpif(revalidator406)|WARN|Dropped 3 log
>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>> rate
>>
>> 2015-11-12T02:34:00.520Z|584327|dpif(revalidator406)|WARN|system at ovs-system:
>> get_stats failed (No such file or directory)
>> 2015-11-12T02:34:00.520Z|584328|netlink_socket(revalidator406)|INFO|Dropped
>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>> excessive rate
>> 2015-11-12T02:34:00.520Z|584329|netlink_socket(revalidator406)|INFO|netlink
>> dump request error (No such file or directory)
>>
>> On 11 November 2015 at 03:28, Ben Pfaff <blp at ovn.org> wrote:
>>
>>> On Tue, Nov 10, 2015 at 08:52:19PM +0800, Tashi Lu wrote:
>>> > I set a tag on a port, but once I restart the network service, e.g.
>>> > /etc/init.d/network restart, the tag will be lost, tested on both
>>> 2.3.2 and
>>> > 2.4.0. Is this normal? How can I make vlan tag persistent?
>>>
>>> No, that doesn't make sense.
>>>
>>> How are you setting up your configuration?
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/6bec2eaf/attachment-0001.html>

From dotslash.lu at gmail.com  Wed Nov 11 19:59:05 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Thu, 12 Nov 2015 11:59:05 +0800
Subject: [ovs-discuss] Tag lost after network restart
In-Reply-To: <CALrtOxrZz_94ce+Rc8m99w_+oYOoud8K-8SmTRr8683opHU0kQ@mail.gmail.com>
References: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
 <20151110192833.GB10475@ovn.org>
 <CALrtOxpHUz_MF9v264qXRv+w4gntPW_7L0fBLVHFQiGOuJ_h+A@mail.gmail.com>
 <CALrtOxqf=jjevy0fCb1rw-vhxoX8EiSyqNg=eYCYdYj=xAeObQ@mail.gmail.com>
 <CALrtOxrZz_94ce+Rc8m99w_+oYOoud8K-8SmTRr8683opHU0kQ@mail.gmail.com>
Message-ID: <CALrtOxrG91saWuLF3Xk0XKcN-M927xfQnASv7H8r+2wBhbFF4g@mail.gmail.com>

/var/log/messages during network restart:

Nov 12 11:54:53 GZ-NS-C1-POOL-kvm-ops-150 kernel: br1: port 1(eth2)
entering disabled state
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: Removing
slave eth0
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: Warning:
the permanent HWaddr of eth0 - ec:f4:bb:c4:3e:90 - is still in use by
bond0. Set the HWaddr of eth0 to a different address to avoid conflicts.
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: releasing
active interface eth0
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: bond0: mixed no
checksumming and other settings.
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: device eth0 left
promiscuous mode
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: making
interface eth1 the new active one.
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: device eth1 entered
promiscuous mode
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: Removing
slave eth1
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: releasing
active interface eth1
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: device eth1 left
promiscuous mode
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 ovs-vsctl:
ovs|00001|vsctl|INFO|Called as ovs-vsctl -t 10 -- --if-exists del-port
ovsbr0 bond0
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: device bond0 left
promiscuous mode
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00072|bridge|INFO|bridge ovsbr0: using datapath ID 0000c2f9be679645
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: device eth2 left
promiscuous mode
Nov 12 11:54:54 GZ-NS-C1-POOL-kvm-ops-150 kernel: br1: port 1(eth2)
entering disabled state
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 ovs-vsctl:
ovs|00001|vsctl|INFO|Called as ovs-vsctl -t 10 -- --if-exists del-br ovsbr0
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 kernel: device ovsbr0 left
promiscuous mode
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 ovs-vsctl:
ovs|00001|vsctl|INFO|Called as ovs-vsctl -t 10 -- --if-exists del-br ovsbr0
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 ovs-vsctl:
ovs|00001|vsctl|INFO|Called as ovs-vsctl -t 10 -- --may-exist add-br ovsbr0
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00073|ofproto_dpif|INFO|system at ovs-system: Datapath supports
recirculation
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00074|ofproto_dpif|INFO|system at ovs-system: MPLS label stack length
probed as 0
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00075|ofproto_dpif|INFO|system at ovs-system: datapath does not support
masked set action feature.
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00076|ofproto_dpif|INFO|system at ovs-system: Datapath does not support
unique flow ids
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 kernel: openvswitch: netlink: Key
attribute has unexpected length (type=21, length=4, expected=0).
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00001|ofproto_dpif_upcall(handler290)|INFO|received packet on
unassociated datapath port 0
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00077|bridge|INFO|bridge ovsbr0: added interface ovsbr0 on port 65534
Nov 12 11:54:55 GZ-NS-C1-POOL-kvm-ops-150 kernel: device ovsbr0 entered
promiscuous mode
Nov 12 11:54:56 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00078|bridge|INFO|bridge ovsbr0: using datapath ID 000032137010614a
Nov 12 11:54:56 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00079|connmgr|INFO|ovsbr0: added service controller
"punix:/usr/var/run/openvswitch/ovsbr0.mgmt"
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: ADDRCONF(NETDEV_UP):
bond0: link is not ready
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: 8021q: adding VLAN 0 to
HW filter on device bond0
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: Adding
slave eth0.
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: 8021q: adding VLAN 0 to
HW filter on device eth0
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: bond0: mixed no
checksumming and other settings.
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: enslaving
eth0 as a backup interface with a down link.
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: Adding
slave eth1.
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: 8021q: adding VLAN 0 to
HW filter on device eth1
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: bond0: mixed no
checksumming and other settings.
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: enslaving
eth1 as a backup interface with a down link.
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: ADDRCONF(NETDEV_UP):
bond0: link is not ready
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: 8021q: adding VLAN 0 to
HW filter on device bond0
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 ovs-vsctl:
ovs|00001|vsctl|INFO|Called as ovs-vsctl -t 10 -- --may-exist add-port
ovsbr0 bond0
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: device bond0 entered
promiscuous mode
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00080|bridge|INFO|bridge ovsbr0: added interface bond0 on port 1
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 ovs-vswitchd:
ovs|00081|bridge|INFO|bridge ovsbr0: using datapath ID 0000ecf4bbc43e90
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: ADDRCONF(NETDEV_UP):
eth2: link is not ready
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: 8021q: adding VLAN 0 to
HW filter on device eth2
Nov 12 11:54:58 GZ-NS-C1-POOL-kvm-ops-150 kernel: device eth2 entered
promiscuous mode
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: igb 0000:01:00.0: eth0:
igb: eth0 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: None
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: bond0: link status
definitely up for interface eth0, 1000 Mbps full duplex.
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: making
interface eth0 the new active one.
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: device eth0 entered
promiscuous mode
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: bonding: bond0: first
active interface up!
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: ADDRCONF(NETDEV_CHANGE):
bond0: link becomes ready
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: igb 0000:01:00.2: eth2:
igb: eth2 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: None
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: ADDRCONF(NETDEV_CHANGE):
eth2: link becomes ready
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: br1: port 1(eth2)
entering forwarding state
Nov 12 11:55:01 GZ-NS-C1-POOL-kvm-ops-150 kernel: igb 0000:01:00.1: eth1:
igb: eth1 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: None
Nov 12 11:55:02 GZ-NS-C1-POOL-kvm-ops-150 kernel: bond0: link status
definitely up for interface eth1, 1000 Mbps full duplex.

On 12 November 2015 at 11:45, Tashi Lu <dotslash.lu at gmail.com> wrote:

> Update:
> Since there are too many messages, I cleaned the ovs-vswitchd.log and
> found these after I restart network,
> 2015-11-12T03:18:20.337Z|594939|dpif(revalidator406)|WARN|Dropped 3 log
> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
> rate
> 2015-11-12T03:18:20.338Z|594940|dpif(revalidator406)|WARN|system at ovs-system:
> get_stats failed (No such file or directory)
> 2015-11-12T03:18:20.338Z|594941|netlink_socket(revalidator406)|INFO|Dropped
> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
> excessive rate
> 2015-11-12T03:18:20.338Z|594942|netlink_socket(revalidator406)|INFO|netlink
> dump request error (No such file or directory)
> 2015-11-12T03:18:20.725Z|05099|netdev_linux|INFO|ioctl(SIOCGIFHWADDR) on
> ovsbr0 device failed: No such device
> 2015-11-12T03:18:20.729Z|05100|netdev_linux|WARN|ioctl(SIOCGIFINDEX) on
> ovsbr0 device failed: No such device
> 2015-11-12T03:18:21.337Z|594943|dpif(revalidator406)|WARN|Dropped 3 log
> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
> rate
> 2015-11-12T03:18:21.337Z|594944|dpif(revalidator406)|WARN|system at ovs-system:
> get_stats failed (No such file or directory)
> 2015-11-12T03:18:21.337Z|594945|netlink_socket(revalidator406)|INFO|Dropped
> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
> excessive rate
> 2015-11-12T03:18:21.337Z|594946|netlink_socket(revalidator406)|INFO|netlink
> dump request error (No such file or directory)
>
> "on ovsbr0 device failed, no such device"? But after restart, ovsbr0 was
> up. And why those "No such file or directory"s?
>
> On 12 November 2015 at 11:02, Tashi Lu <dotslash.lu at gmail.com> wrote:
>
>> By the way, I just saw some one with the same situation:
>> http://website-humblec.rhcloud.com/configure-openvswitch-in-virt-environment/
>> search with 'lost' you'll see that comment.
>>
>> And he used Ubuntu, so this problem is platform irrelevant. I'm guessing
>> misconfiguration now. But I don't know where I did wrong. Here are my
>> ifcfgs:
>>
>> ifcfg-bond0:
>> DEVICE=bond0
>> ONBOOT=yes
>> BOOTPROTO=none
>> TYPE=OVSPort
>> DEVICETYPE=ovs
>> OVS_BRIDGE=ovsbr0
>>
>> ifcfg-ovsbr0:
>> IPADDR=10.3.150.20
>> NETMASK=255.255.255.0
>> DEVICE=ovsbr0
>> TYPE=OVSBridge
>> DEVICETYPE=ovs
>> ONBOOT=yes
>> BOOT_PROTO=static
>>
>>
>> On 12 November 2015 at 10:42, Tashi Lu <dotslash.lu at gmail.com> wrote:
>>
>>> Hi blp, Shetty,
>>>
>>> Sorry for my late reply.
>>> uname -a: 2.6.32-504.el6.x86_64 #1 SMP Wed Oct 15 04:27:16 UTC 2014
>>> x86_64 x86_64 x86_64 GNU/Linux
>>>
>>> before restarting network:
>>> [root at GZ-NS-C1-POOL-kvm-ops-150.20 openvswitch]# ovs-vsctl show
>>> c5ee1b0f-e7ec-4c73-a3fa-c79662619cba
>>>     Bridge "ovsbr0"
>>>         Port "v5254007ec542"
>>>             tag: 142
>>>             Interface "v5254007ec542"
>>>         Port "bond0"
>>>             Interface "bond0"
>>>         Port "ovsbr0"
>>>             tag: 150
>>>             Interface "ovsbr0"
>>>                 type: internal
>>>
>>> after: http://imgur.com/jU4CY2i (sorry for a image link, because the
>>> network was lost I had to use virtual console thus unable to copy text)
>>>
>>> We can see both the vlan tag and the port I created for a virtual
>>> machine was lost after the network restart.
>>> I think it might be related to /etc/sysconfig/network-scripts/ifup-ovs,
>>> since this is the only point ovs relates to `service network restart`.
>>>
>>> And there are no special logs in ovs-ctl.log, ovsdb-server.log, and
>>> ovs-vswitchd.log. But my ovs-vswitchd.log keeps logging following lines
>>> every second, is this relevant?:
>>>
>>> 2015-11-12T02:33:57.516Z|584314|dpif(revalidator406)|WARN|Dropped 3 log
>>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>>> rate
>>>
>>> 2015-11-12T02:33:57.516Z|584315|dpif(revalidator406)|WARN|system at ovs-system:
>>> get_stats failed (No such file or directory)
>>> 2015-11-12T02:33:57.516Z|584316|netlink_socket(revalidator406)|INFO|Dropped
>>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>>> excessive rate
>>> 2015-11-12T02:33:57.516Z|584317|netlink_socket(revalidator406)|INFO|netlink
>>> dump request error (No such file or directory)
>>> 2015-11-12T02:33:58.518Z|584318|dpif(revalidator406)|WARN|Dropped 3 log
>>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>>> rate
>>>
>>> 2015-11-12T02:33:58.518Z|584319|dpif(revalidator406)|WARN|system at ovs-system:
>>> get_stats failed (No such file or directory)
>>> 2015-11-12T02:33:58.518Z|584320|netlink_socket(revalidator406)|INFO|Dropped
>>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>>> excessive rate
>>> 2015-11-12T02:33:58.518Z|584321|netlink_socket(revalidator406)|INFO|netlink
>>> dump request error (No such file or directory)
>>> 2015-11-12T02:33:59.520Z|584322|dpif(revalidator406)|WARN|Dropped 3 log
>>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>>> rate
>>>
>>> 2015-11-12T02:33:59.520Z|584323|dpif(revalidator406)|WARN|system at ovs-system:
>>> get_stats failed (No such file or directory)
>>> 2015-11-12T02:33:59.520Z|584324|netlink_socket(revalidator406)|INFO|Dropped
>>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>>> excessive rate
>>> 2015-11-12T02:33:59.520Z|584325|netlink_socket(revalidator406)|INFO|netlink
>>> dump request error (No such file or directory)
>>> 2015-11-12T02:34:00.520Z|584326|dpif(revalidator406)|WARN|Dropped 3 log
>>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>>> rate
>>>
>>> 2015-11-12T02:34:00.520Z|584327|dpif(revalidator406)|WARN|system at ovs-system:
>>> get_stats failed (No such file or directory)
>>> 2015-11-12T02:34:00.520Z|584328|netlink_socket(revalidator406)|INFO|Dropped
>>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>>> excessive rate
>>> 2015-11-12T02:34:00.520Z|584329|netlink_socket(revalidator406)|INFO|netlink
>>> dump request error (No such file or directory)
>>>
>>> On 11 November 2015 at 03:28, Ben Pfaff <blp at ovn.org> wrote:
>>>
>>>> On Tue, Nov 10, 2015 at 08:52:19PM +0800, Tashi Lu wrote:
>>>> > I set a tag on a port, but once I restart the network service, e.g.
>>>> > /etc/init.d/network restart, the tag will be lost, tested on both
>>>> 2.3.2 and
>>>> > 2.4.0. Is this normal? How can I make vlan tag persistent?
>>>>
>>>> No, that doesn't make sense.
>>>>
>>>> How are you setting up your configuration?
>>>>
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/cf4dcdfd/attachment-0001.html>

From leo.zhu510 at gmail.com  Wed Nov 11 21:34:50 2015
From: leo.zhu510 at gmail.com (leo zhu)
Date: Thu, 12 Nov 2015 13:34:50 +0800
Subject: [ovs-discuss] OVS internal port performance is not good when
 used with OVS DPDK
In-Reply-To: <F11BF4B3-260B-4A65-9D32-50315A97F91C@gmail.com>
References: <CALzAW8TZM6MX+vRh2WdVNGSddbQJUb7xuH_aPR9nWQLUBDue6A@mail.gmail.com>
 <F11BF4B3-260B-4A65-9D32-50315A97F91C@gmail.com>
Message-ID: <CALzAW8TDJ3R9KuR6SR1ORGdTo763S_r0X11gzsa+4aSNEwCuDg@mail.gmail.com>

Hi Lapd,

Thanks for your reply.

Thanks.
Leo

On Fri, Nov 6, 2015 at 3:14 PM, Ngo Doan Lap <lapngodoan at gmail.com> wrote:

> Hi Leo,
> You can refer to this document get correct setup/result.
> We are able to replicate the results on this doc.
>
> https://download.01.org/packet-processing/ONPS1.5/Intel_ONP_Server_Release_1.5_Performance_Test_Report_Rev1.1.pdf
> Thank and Best Regards
> Lapd
>
> On Nov 6, 2015, at 2:10 PM, leo zhu <leo.zhu510 at gmail.com> wrote:
>
> Hi all,
>
> I tried below test cases to compare the performance of OVS/OVS
> DPDK+Internal port.
>
> *Topology*:
> <New Picture.jpg>
> ​*Test results:*
>
> <New Picture (1).jpg>
> ​
>
>  Now I have following 2 questions.
>
> 1.  Does the test result is normal?  If it is not normal, why?
> 2.  When ovs internal port is used with OVS DPDK, the max packet size sent
> by DPDK PKTGEN
>      can not be larger than 978 bytes. Otherwise the traffic will be
> blocked. Does anyone know the
>      reason?
>
> It will be great if someone from the list could give the answers and clues.
>
> Thanks.
> Leo
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/7d6f0736/attachment.html>

From leo.zhu510 at gmail.com  Wed Nov 11 21:38:03 2015
From: leo.zhu510 at gmail.com (leo zhu)
Date: Thu, 12 Nov 2015 13:38:03 +0800
Subject: [ovs-discuss] Packet size can not exceed 978 bytes when
 ovs-dpdk user space vxlan is used
In-Reply-To: <2EF2F5C0CC56984AA024D0B180335FCB13CCA20D@IRSMSX102.ger.corp.intel.com>
References: <CALzAW8QZQNYLftyToUxY-qgF6srU8fboqgeDwZn5xFMP-Owgjw@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CCA20D@IRSMSX102.ger.corp.intel.com>
Message-ID: <CALzAW8TJNqP_uU2ozFGtz16GuUygzLvdAn+GX3469yq=ujW3rw@mail.gmail.com>

Hi Sugesh,

Thanks for your reply. I found the issue has gone in ovs 2.4.90.

Thanks.
Leo

On Thu, Oct 15, 2015 at 12:18 AM, Chandran, Sugesh <
sugesh.chandran at intel.com> wrote:

>
>
>
>
> *Regards*
>
> *_Sugesh*
>
>
>
> *From:* discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of *leo
> zhu
> *Sent:* Wednesday, October 14, 2015 4:31 AM
> *To:* discuss at openvswitch.org
> *Subject:* [ovs-discuss] Packet size can not exceed 978 bytes when
> ovs-dpdk user space vxlan is used
>
>
>
> Hi all,
>
> I am testing the ovs-dpdk user space vxlan performance.
>
> My topology is as follow:
>
>
>
>
>
> DPDK pktgen is used to send packet in my test.
>
>
>
> In the test process, I found that the packet size can not exceed 978
> bytes. If the packet size is
>
> larger than 978 bytes, the packet that was sent by pktgen on server 3 can
> not reach to server 4,
>
> the traffic between server 3 and server 4 was blocked.
>
> >>>> Can you please confirm whats the MTU value for each interfaces??
>
> >>>>> If the MTU value is sufficient enough, can you please check the“sudo
> ovs-appctl dpctl/show –s” output to know at which interface the packets
> getting dropped
>
> Does anybody know why?
>
>
>
> Thanks.
>
> Leo
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/f8be6727/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 22228 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/f8be6727/attachment-0001.jpg>

From hassan_samii21 at yahoo.com  Thu Nov 12 01:45:59 2015
From: hassan_samii21 at yahoo.com (Hassan Samii)
Date: Thu, 12 Nov 2015 09:45:59 +0000 (UTC)
Subject: [ovs-discuss] openvswich freebsd 10.1 release configuration error
References: <480939646.5784922.1447321559038.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <480939646.5784922.1447321559038.JavaMail.yahoo@mail.yahoo.com>

Hi everyone, Firstly i'd like to thank everyone for the amazing work that your doing.
To my problem.I installed Open vSwitch on a FreeBSD 10.1 Release (which resides on a virtual machine working on Virtualbox). I used the Freshports to install openvswitch and the installation completed successfully. Now the problem is that if i do ovs-vsctl --version i get the following (which i suspect is good):

root at FreeBSDPrimo:~ # ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.3.2
Compiled Nov  4 2015 16:39:41
DB Schema 7.6.2
but if i use the command ovs-vsctl show i get the following (which is not good):
ovs-vsctl: unix:/var/run/openvswitch/db.sock: database connection failed (No such file or directory)

So then i thought that the configuration do the db was not set so i tried this and got the following error:

root at FreeBSDPrimo:~ # rm -f /var/db/openvswitch/conf.db
root at FreeBSDPrimo:~ # ovsdb-tool create /var/db/openvswitch/conf.db /usr/local/share/openvswitch/vswitch.ovsschema
ovsdb-tool: failed to read schema: "/usr/local/share/openvswitch/vswitch.ovsschema" could not be read as JSON (error opening "/usr/local/share/openvswitch/vswitch.ovsschema": No such file or directory)

Please help. i dont know what to do.Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/db57b601/attachment.html>

From dsainz at CS.technion.ac.il  Thu Nov 12 04:52:28 2015
From: dsainz at CS.technion.ac.il (dsainz at CS.technion.ac.il)
Date: Thu, 12 Nov 2015 14:52:28 +0200
Subject: [ovs-discuss] find the goto table instruction in the code
Message-ID: <1773506714f5923588989ae69fecb48b.squirrel@wassist.cs.technion.ac.il>

Hi to all,

I want to locate the code (I imagine it is inside of the Kernel module
datapath) where when a flow is found, the instructions are executed, it
finds the "goto table" instruction and redirects the packet to another
table.

So far I found the ovs_dp_process_packet in datapath\datapath.c but it
cares only about flow actions and the goto table processing is nowhere to
be found there. There is something I am missing, and I doubt the
processing is sent to userspace to handle this...

Thanks in advance!

David


From antonio.fischetti at intel.com  Thu Nov 12 05:18:31 2015
From: antonio.fischetti at intel.com (Fischetti, Antonio)
Date: Thu, 12 Nov 2015 13:18:31 +0000
Subject: [ovs-discuss] find the goto table instruction in the code
In-Reply-To: <1773506714f5923588989ae69fecb48b.squirrel@wassist.cs.technion.ac.il>
References: <1773506714f5923588989ae69fecb48b.squirrel@wassist.cs.technion.ac.il>
Message-ID: <BCFD2BB875535045A5368D9ADBF2969909C42E47@IRSMSX101.ger.corp.intel.com>

Hi,
You may want to have a look at 'OVS/lib/dpif-netdev.c' file.
You can start with the 'dp_netdev_process_rxq_port()' function and follow the calls.
You can see for ex.
dp_netdev_input()  which at first calls 
emc_processing() 
and in case a match is not found in the EMC it will call
fast_path_processing() 
to check for a match inside the Classifier. In case it is still
unsuccessful it will make an 'up-call' to the 'ofproto' table via 
dp_netdev_upcall()
so that it knows what to do with that packet.
As a consequence new Rules and Flows, see
dpcls_insert(), and
dp_netdev_flow_add()
are inserted into the tables, so that next time they will 'know' what to do with 
similar packets.

HTH

> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> dsainz at CS.technion.ac.il
> Sent: Thursday, November 12, 2015 12:52 PM
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] find the goto table instruction in the code
> 
> Hi to all,
> 
> I want to locate the code (I imagine it is inside of the Kernel module
> datapath) where when a flow is found, the instructions are executed, it
> finds the "goto table" instruction and redirects the packet to another
> table.
> 
> So far I found the ovs_dp_process_packet in datapath\datapath.c but it
> cares only about flow actions and the goto table processing is nowhere to
> be found there. There is something I am missing, and I doubt the
> processing is sent to userspace to handle this...
> 
> Thanks in advance!
> 
> David
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From hassan_samii21 at yahoo.com  Thu Nov 12 05:42:25 2015
From: hassan_samii21 at yahoo.com (Hassan Samii)
Date: Thu, 12 Nov 2015 13:42:25 +0000 (UTC)
Subject: [ovs-discuss] openvswich freebsd 10.1 release configuration error
References: <495080879.6004134.1447335745087.JavaMail.yahoo.ref@mail.yahoo.com>
Message-ID: <495080879.6004134.1447335745087.JavaMail.yahoo@mail.yahoo.com>

Hi everyone, Firstly i'd like to thank everyone for the amazing work that your doing.
To my problem.I installed Open vSwitch on a FreeBSD 10.1 Release (which resides on a virtual machine working on Virtualbox). I used the Freshports to install openvswitch and the installation completed successfully. Now the problem is that if i do ovs-vsctl --version i get the following (which i suspect is good):

root at FreeBSDPrimo:~ # ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.3.2
Compiled Nov  4 2015 16:39:41
DB Schema 7.6.2
but if i use the command ovs-vsctl show i get the following (which is not good):
ovs-vsctl: unix:/var/run/openvswitch/db.sock: database connection failed (No such file or directory)

So then i thought that the configuration do the db was not set so i tried this and got the following error:

root at FreeBSDPrimo:~ # rm -f /var/db/openvswitch/conf.db
root at FreeBSDPrimo:~ # ovsdb-tool create /var/db/openvswitch/conf.db /usr/local/share/openvswitch/vswitch.ovsschema
ovsdb-tool: failed to read schema: "/usr/local/share/openvswitch/vswitch.ovsschema" could not be read as JSON (error opening "/usr/local/share/openvswitch/vswitch.ovsschema": No such file or directory)

Please help. i dont know what to do.Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/9c71e329/attachment-0001.html>

From shettyg at nicira.com  Thu Nov 12 07:18:01 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 12 Nov 2015 07:18:01 -0800
Subject: [ovs-discuss] Tag lost after network restart
In-Reply-To: <CALrtOxqf=jjevy0fCb1rw-vhxoX8EiSyqNg=eYCYdYj=xAeObQ@mail.gmail.com>
References: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
 <20151110192833.GB10475@ovn.org>
 <CALrtOxpHUz_MF9v264qXRv+w4gntPW_7L0fBLVHFQiGOuJ_h+A@mail.gmail.com>
 <CALrtOxqf=jjevy0fCb1rw-vhxoX8EiSyqNg=eYCYdYj=xAeObQ@mail.gmail.com>
Message-ID: <CAHbON5ryh+KQYGe41QtsZfNxiVzwD+z2KfgYtvz-wib7pBVcWA@mail.gmail.com>

I am a little short on time to do a thorough look at your logs. So I
will try to ask more pertinent questions.

Q: Did you create your vlan tagged ports using ovs-vsctl?

Because your ifcfg-* does not indicate that you are doing it via those scripts.

If the answer to the above question is yes, then it is expected that
you will loose your tags after a restart. The reason is that ifcfg-*
scripts cause the OVS bridge to get deleted and recreated. Since you
don't specify the tags in those scripts, you will loose them.

Read the following documentation if you would like to do everything
from ifcfg-* scripts.
https://github.com/openvswitch/ovs/blob/master/rhel/README.RHEL


On Wed, Nov 11, 2015 at 7:02 PM, Tashi Lu <dotslash.lu at gmail.com> wrote:
> By the way, I just saw some one with the same situation:
> http://website-humblec.rhcloud.com/configure-openvswitch-in-virt-environment/
> search with 'lost' you'll see that comment.
>
> And he used Ubuntu, so this problem is platform irrelevant. I'm guessing
> misconfiguration now. But I don't know where I did wrong. Here are my
> ifcfgs:
>
> ifcfg-bond0:
> DEVICE=bond0
> ONBOOT=yes
> BOOTPROTO=none
> TYPE=OVSPort
> DEVICETYPE=ovs
> OVS_BRIDGE=ovsbr0
>
> ifcfg-ovsbr0:
> IPADDR=10.3.150.20
> NETMASK=255.255.255.0
> DEVICE=ovsbr0
> TYPE=OVSBridge
> DEVICETYPE=ovs
> ONBOOT=yes
> BOOT_PROTO=static
>
>
> On 12 November 2015 at 10:42, Tashi Lu <dotslash.lu at gmail.com> wrote:
>>
>> Hi blp, Shetty,
>>
>> Sorry for my late reply.
>> uname -a: 2.6.32-504.el6.x86_64 #1 SMP Wed Oct 15 04:27:16 UTC 2014 x86_64
>> x86_64 x86_64 GNU/Linux
>>
>> before restarting network:
>> [root at GZ-NS-C1-POOL-kvm-ops-150.20 openvswitch]# ovs-vsctl show
>> c5ee1b0f-e7ec-4c73-a3fa-c79662619cba
>>     Bridge "ovsbr0"
>>         Port "v5254007ec542"
>>             tag: 142
>>             Interface "v5254007ec542"
>>         Port "bond0"
>>             Interface "bond0"
>>         Port "ovsbr0"
>>             tag: 150
>>             Interface "ovsbr0"
>>                 type: internal
>>
>> after: http://imgur.com/jU4CY2i (sorry for a image link, because the
>> network was lost I had to use virtual console thus unable to copy text)
>>
>> We can see both the vlan tag and the port I created for a virtual machine
>> was lost after the network restart.
>> I think it might be related to /etc/sysconfig/network-scripts/ifup-ovs,
>> since this is the only point ovs relates to `service network restart`.
>>
>> And there are no special logs in ovs-ctl.log, ovsdb-server.log, and
>> ovs-vswitchd.log. But my ovs-vswitchd.log keeps logging following lines
>> every second, is this relevant?:
>>
>> 2015-11-12T02:33:57.516Z|584314|dpif(revalidator406)|WARN|Dropped 3 log
>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>> rate
>>
>> 2015-11-12T02:33:57.516Z|584315|dpif(revalidator406)|WARN|system at ovs-system:
>> get_stats failed (No such file or directory)
>>
>> 2015-11-12T02:33:57.516Z|584316|netlink_socket(revalidator406)|INFO|Dropped
>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>> excessive rate
>>
>> 2015-11-12T02:33:57.516Z|584317|netlink_socket(revalidator406)|INFO|netlink
>> dump request error (No such file or directory)
>> 2015-11-12T02:33:58.518Z|584318|dpif(revalidator406)|WARN|Dropped 3 log
>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>> rate
>>
>> 2015-11-12T02:33:58.518Z|584319|dpif(revalidator406)|WARN|system at ovs-system:
>> get_stats failed (No such file or directory)
>>
>> 2015-11-12T02:33:58.518Z|584320|netlink_socket(revalidator406)|INFO|Dropped
>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>> excessive rate
>>
>> 2015-11-12T02:33:58.518Z|584321|netlink_socket(revalidator406)|INFO|netlink
>> dump request error (No such file or directory)
>> 2015-11-12T02:33:59.520Z|584322|dpif(revalidator406)|WARN|Dropped 3 log
>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>> rate
>>
>> 2015-11-12T02:33:59.520Z|584323|dpif(revalidator406)|WARN|system at ovs-system:
>> get_stats failed (No such file or directory)
>>
>> 2015-11-12T02:33:59.520Z|584324|netlink_socket(revalidator406)|INFO|Dropped
>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>> excessive rate
>>
>> 2015-11-12T02:33:59.520Z|584325|netlink_socket(revalidator406)|INFO|netlink
>> dump request error (No such file or directory)
>> 2015-11-12T02:34:00.520Z|584326|dpif(revalidator406)|WARN|Dropped 3 log
>> messages in last 1 seconds (most recently, 1 seconds ago) due to excessive
>> rate
>>
>> 2015-11-12T02:34:00.520Z|584327|dpif(revalidator406)|WARN|system at ovs-system:
>> get_stats failed (No such file or directory)
>>
>> 2015-11-12T02:34:00.520Z|584328|netlink_socket(revalidator406)|INFO|Dropped
>> 1 log messages in last 1 seconds (most recently, 1 seconds ago) due to
>> excessive rate
>>
>> 2015-11-12T02:34:00.520Z|584329|netlink_socket(revalidator406)|INFO|netlink
>> dump request error (No such file or directory)
>>
>> On 11 November 2015 at 03:28, Ben Pfaff <blp at ovn.org> wrote:
>>>
>>> On Tue, Nov 10, 2015 at 08:52:19PM +0800, Tashi Lu wrote:
>>> > I set a tag on a port, but once I restart the network service, e.g.
>>> > /etc/init.d/network restart, the tag will be lost, tested on both 2.3.2
>>> > and
>>> > 2.4.0. Is this normal? How can I make vlan tag persistent?
>>>
>>> No, that doesn't make sense.
>>>
>>> How are you setting up your configuration?
>>
>>
>

From jpettit at ovn.org  Thu Nov 12 09:13:01 2015
From: jpettit at ovn.org (Justin Pettit)
Date: Thu, 12 Nov 2015 09:13:01 -0800
Subject: [ovs-discuss] find the goto table instruction in the code
In-Reply-To: <1773506714f5923588989ae69fecb48b.squirrel@wassist.cs.technion.ac.il>
References: <1773506714f5923588989ae69fecb48b.squirrel@wassist.cs.technion.ac.il>
Message-ID: <46BB4518-F978-4C1A-A16F-CB0EC13D32ED@ovn.org>


> On Nov 12, 2015, at 4:52 AM, dsainz at CS.technion.ac.il wrote:
> 
> Hi to all,
> 
> I want to locate the code (I imagine it is inside of the Kernel module
> datapath) where when a flow is found, the instructions are executed, it
> finds the "goto table" instruction and redirects the packet to another
> table.

"goto table" is an entirely userspace concept.  The kernel flows are a cache of recently seen flows and their associated actions with all the table jumps removed.  Here's an entry from the FAQ that help explain it:

-=-=-=-=-=-=-=-=-=-
Q: I hear OVS has a couple of kinds of flows. Can you tell me about them?

A: Open vSwitch uses different kinds of flows for different purposes:

	• OpenFlow flows are the most important kind of flow. OpenFlow controllers use these flows to define a switch's policy. OpenFlow flows support wildcards, priorities, and multiple tables.

When in-band control is in use, Open vSwitch sets up a few "hidden" flows, with priority higher than a controller or the user can configure, that are not visible via OpenFlow. (See the "Controller" section of the FAQ for more information about hidden flows.)

	• The Open vSwitch software switch implementation uses a second kind of flow internally. These flows, called "datapath" or "kernel" flows, do not support priorities and comprise only a single table, which makes them suitable for caching. (Like OpenFlow flows, datapath flows do support wildcarding, in Open vSwitch 1.11 and later.) OpenFlow flows and datapath flows also support different actions and number ports differently.

Datapath flows are an implementation detail that is subject to change in future versions of Open vSwitch. Even with the current version of Open vSwitch, hardware switch implementations do not necessarily use this architecture.

Users and controllers directly control only the OpenFlow flow table. Open vSwitch manages the datapath flow table itself, so users should not normally be concerned with it.
-=-=-=-=-=-=-=-=-=-

--Justin



From joestringer at nicira.com  Thu Nov 12 10:43:05 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 12 Nov 2015 10:43:05 -0800
Subject: [ovs-discuss] openvswich freebsd 10.1 release configuration
	error
In-Reply-To: <480939646.5784922.1447321559038.JavaMail.yahoo@mail.yahoo.com>
References: <480939646.5784922.1447321559038.JavaMail.yahoo.ref@mail.yahoo.com>
 <480939646.5784922.1447321559038.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CANr6G5wRNkd85ObGQjH4iVwTKt=Ui3ekvnYRy=7bm9uCU3oJ4A@mail.gmail.com>

On 12 November 2015 at 01:45, Hassan Samii <hassan_samii21 at yahoo.com> wrote:
> Hi everyone, Firstly i'd like to thank everyone for the amazing work that
> your doing.
>
> To my problem.
> I installed Open vSwitch on a FreeBSD 10.1 Release (which resides on a
> virtual machine working on Virtualbox). I used the Freshports to install
> openvswitch and the installation completed successfully.
> Now the problem is that if i do ovs-vsctl --version i get the following
> (which i suspect is good):
>
> root at FreeBSDPrimo:~ # ovs-vsctl --version
> ovs-vsctl (Open vSwitch) 2.3.2
> Compiled Nov  4 2015 16:39:41
> DB Schema 7.6.2
>
> but if i use the command ovs-vsctl show i get the following (which is not
> good):
>
> ovs-vsctl: unix:/var/run/openvswitch/db.sock: database connection failed (No
> such file or directory)

Are the OVS daemons running at this point (ovs-vswitchd, ovsdb-server)?

> So then i thought that the configuration do the db was not set so i tried
> this and got the following error:
>
> root at FreeBSDPrimo:~ # rm -f /var/db/openvswitch/conf.db
> root at FreeBSDPrimo:~ # ovsdb-tool create /var/db/openvswitch/conf.db
> /usr/local/share/openvswitch/vswitch.ovsschema
> ovsdb-tool: failed to read schema:
> "/usr/local/share/openvswitch/vswitch.ovsschema" could not be read as JSON
> (error opening "/usr/local/share/openvswitch/vswitch.ovsschema": No such
> file or directory)

I suspect that this port of OVS is configured with /usr as the prefix,
not /usr/local. So the path to the latter would be something like
/usr/share/openvswitch/vswitch.ovsschema.

From hassan_samii21 at yahoo.com  Thu Nov 12 13:05:25 2015
From: hassan_samii21 at yahoo.com (Hassan Samii)
Date: Thu, 12 Nov 2015 21:05:25 +0000 (UTC)
Subject: [ovs-discuss] openvswich freebsd 10.1 release configuration
 error
In-Reply-To: <CANr6G5wRNkd85ObGQjH4iVwTKt=Ui3ekvnYRy=7bm9uCU3oJ4A@mail.gmail.com>
References: <CANr6G5wRNkd85ObGQjH4iVwTKt=Ui3ekvnYRy=7bm9uCU3oJ4A@mail.gmail.com>
Message-ID: <1802601186.6453189.1447362325497.JavaMail.yahoo@mail.yahoo.com>

The OVS deamons are not running because there is no initial configuration.When i launch the commandovsdb-tool create /var/db/openvswitch/conf.db /usr/local/share/openvswitch/vswitch.ovsschema
even if i change the prefix as you said i still get the "No such file or directory" error. 
I also tryed "whereis vswitch.ovsschema" and it doesn't find anything. 
I think there's supposed to be a folder called openvswitch which should have the db settings and all but apparently it doesnt exist. 


     Il Giovedì 12 Novembre 2015 19:43, Joe Stringer <joestringer at nicira.com> ha scritto:
   

 On 12 November 2015 at 01:45, Hassan Samii <hassan_samii21 at yahoo.com> wrote:
> Hi everyone, Firstly i'd like to thank everyone for the amazing work that
> your doing.
>
> To my problem.
> I installed Open vSwitch on a FreeBSD 10.1 Release (which resides on a
> virtual machine working on Virtualbox). I used the Freshports to install
> openvswitch and the installation completed successfully.
> Now the problem is that if i do ovs-vsctl --version i get the following
> (which i suspect is good):
>
> root at FreeBSDPrimo:~ # ovs-vsctl --version
> ovs-vsctl (Open vSwitch) 2.3.2
> Compiled Nov  4 2015 16:39:41
> DB Schema 7.6.2
>
> but if i use the command ovs-vsctl show i get the following (which is not
> good):
>
> ovs-vsctl: unix:/var/run/openvswitch/db.sock: database connection failed (No
> such file or directory)

Are the OVS daemons running at this point (ovs-vswitchd, ovsdb-server)?

> So then i thought that the configuration do the db was not set so i tried
> this and got the following error:
>
> root at FreeBSDPrimo:~ # rm -f /var/db/openvswitch/conf.db
> root at FreeBSDPrimo:~ # ovsdb-tool create /var/db/openvswitch/conf.db
> /usr/local/share/openvswitch/vswitch.ovsschema
> ovsdb-tool: failed to read schema:
> "/usr/local/share/openvswitch/vswitch.ovsschema" could not be read as JSON
> (error opening "/usr/local/share/openvswitch/vswitch.ovsschema": No such
> file or directory)

I suspect that this port of OVS is configured with /usr as the prefix,
not /usr/local. So the path to the latter would be something like
/usr/share/openvswitch/vswitch.ovsschema.


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151112/f1aa9bf3/attachment.html>

From dotslash.lu at gmail.com  Thu Nov 12 19:09:22 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Fri, 13 Nov 2015 11:09:22 +0800
Subject: [ovs-discuss] Tag lost after network restart
In-Reply-To: <CAHbON5ryh+KQYGe41QtsZfNxiVzwD+z2KfgYtvz-wib7pBVcWA@mail.gmail.com>
References: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
 <20151110192833.GB10475@ovn.org>
 <CALrtOxpHUz_MF9v264qXRv+w4gntPW_7L0fBLVHFQiGOuJ_h+A@mail.gmail.com>
 <CALrtOxqf=jjevy0fCb1rw-vhxoX8EiSyqNg=eYCYdYj=xAeObQ@mail.gmail.com>
 <CAHbON5ryh+KQYGe41QtsZfNxiVzwD+z2KfgYtvz-wib7pBVcWA@mail.gmail.com>
Message-ID: <CALrtOxqTo_BEyf2XEusROURc+FdUya4eSDp3Ro0euDWCO91+dQ@mail.gmail.com>

Shetty,

Many thanks for your help even when you're busy.

The port with tag is the internal port, so yes.

Is the loss of the virtual ports, which I created with ovs-ctl, the same
reason as the vlan tag's? I can easily add a line to ifcfg-ovsbr0 to
configure the vlan tag for the internal port, but if I have to create a
ifcfg script for each virtual port for vm to make them persistent, that's
very unmanageable. We have 7 vms, each with 4 virtual NICs, which means I
have to create 28+ ifcfg scripts.

I thought ovs-db could store those states and restore them after a reboot.
If that's not possible now, we can make it, that will make op's life easier.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151113/03eb4e87/attachment.html>

From shettyg at nicira.com  Thu Nov 12 19:33:29 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 12 Nov 2015 19:33:29 -0800
Subject: [ovs-discuss] Tag lost after network restart
In-Reply-To: <CALrtOxqTo_BEyf2XEusROURc+FdUya4eSDp3Ro0euDWCO91+dQ@mail.gmail.com>
References: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
 <20151110192833.GB10475@ovn.org>
 <CALrtOxpHUz_MF9v264qXRv+w4gntPW_7L0fBLVHFQiGOuJ_h+A@mail.gmail.com>
 <CALrtOxqf=jjevy0fCb1rw-vhxoX8EiSyqNg=eYCYdYj=xAeObQ@mail.gmail.com>
 <CAHbON5ryh+KQYGe41QtsZfNxiVzwD+z2KfgYtvz-wib7pBVcWA@mail.gmail.com>
 <CALrtOxqTo_BEyf2XEusROURc+FdUya4eSDp3Ro0euDWCO91+dQ@mail.gmail.com>
Message-ID: <CAHbON5qiNT3079ux-0CGWg9e08Y61_fAxXUg2FOkA9Q_rGSAhg@mail.gmail.com>

If you are connecting your VM interfaces to this bridge, I suggest
that you don't create this bridge via ifcfg script. Rather create the
bridge itself via ovs-vsctl.

Another strategy *could* be to create a separate bridge for your vms
and connect the 2 bridges via  patch port.

On Thu, Nov 12, 2015 at 7:09 PM, Tashi Lu <dotslash.lu at gmail.com> wrote:
> Shetty,
>
> Many thanks for your help even when you're busy.
>
> The port with tag is the internal port, so yes.
>
> Is the loss of the virtual ports, which I created with ovs-ctl, the same
> reason as the vlan tag's? I can easily add a line to ifcfg-ovsbr0 to
> configure the vlan tag for the internal port, but if I have to create a
> ifcfg script for each virtual port for vm to make them persistent, that's
> very unmanageable. We have 7 vms, each with 4 virtual NICs, which means I
> have to create 28+ ifcfg scripts.
>
> I thought ovs-db could store those states and restore them after a reboot.
> If that's not possible now, we can make it, that will make op's life easier.

From dotslash.lu at gmail.com  Thu Nov 12 20:33:02 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Fri, 13 Nov 2015 04:33:02 +0000
Subject: [ovs-discuss] Tag lost after network restart
In-Reply-To: <CAHbON5qiNT3079ux-0CGWg9e08Y61_fAxXUg2FOkA9Q_rGSAhg@mail.gmail.com>
References: <CALrtOxq3-8z-6gJyEh7AGRHE0DKQX1bsf0a84viyxcFKqQH7jw@mail.gmail.com>
 <20151110192833.GB10475@ovn.org>
 <CALrtOxpHUz_MF9v264qXRv+w4gntPW_7L0fBLVHFQiGOuJ_h+A@mail.gmail.com>
 <CALrtOxqf=jjevy0fCb1rw-vhxoX8EiSyqNg=eYCYdYj=xAeObQ@mail.gmail.com>
 <CAHbON5ryh+KQYGe41QtsZfNxiVzwD+z2KfgYtvz-wib7pBVcWA@mail.gmail.com>
 <CALrtOxqTo_BEyf2XEusROURc+FdUya4eSDp3Ro0euDWCO91+dQ@mail.gmail.com>
 <CAHbON5qiNT3079ux-0CGWg9e08Y61_fAxXUg2FOkA9Q_rGSAhg@mail.gmail.com>
Message-ID: <CALrtOxoTrct+_6WOMJskLjqmFJayoGESRtmTuQfBD1UUk5BvZQ@mail.gmail.com>

Thanks Shetty, your suggestion worked, problem solved by removing OVS
related lines in ifcfg-ovsbr. Sorry to bother.
On Fri, Nov 13, 2015 at 11:33 Gurucharan Shetty <shettyg at nicira.com> wrote:

> If you are connecting your VM interfaces to this bridge, I suggest
> that you don't create this bridge via ifcfg script. Rather create the
> bridge itself via ovs-vsctl.
>
> Another strategy *could* be to create a separate bridge for your vms
> and connect the 2 bridges via  patch port.
>
> On Thu, Nov 12, 2015 at 7:09 PM, Tashi Lu <dotslash.lu at gmail.com> wrote:
> > Shetty,
> >
> > Many thanks for your help even when you're busy.
> >
> > The port with tag is the internal port, so yes.
> >
> > Is the loss of the virtual ports, which I created with ovs-ctl, the same
> > reason as the vlan tag's? I can easily add a line to ifcfg-ovsbr0 to
> > configure the vlan tag for the internal port, but if I have to create a
> > ifcfg script for each virtual port for vm to make them persistent, that's
> > very unmanageable. We have 7 vms, each with 4 virtual NICs, which means I
> > have to create 28+ ifcfg scripts.
> >
> > I thought ovs-db could store those states and restore them after a
> reboot.
> > If that's not possible now, we can make it, that will make op's life
> easier.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20151113/4eeb5965/attachment-0001.html>

From joestringer at nicira.com  Thu Nov 12 23:19:33 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 12 Nov 2015 23:19:33 -0800
Subject: [ovs-discuss] build OpenvSwitch.deb package failed
In-Reply-To: <BAY172-W512589F6A722729D407B0DB2160@phx.gbl>
References: <BAY172-W512589F6A722729D407B0DB2160@phx.gbl>
Message-ID: <CANr6G5z6ZW7pyZ1WY+RohoAjWF0GR=TGxfpFCn417qS65x68=g@mail.gmail.com>

On 8 November 2015 at 05:04, 俊 赵 <zhaojun12 at outlook.com> wrote:
> Hi all, I have some questions to ask.
>
> First, I am trying to build OpenvSwitch 2.3.2 .deb package in raspberry with
> 500MB ram and Debian based Raspberry OS.
>
> But it failed when testing.
> 820: ofproto-dpif - exponential resubmit chain   FAILED
> (ofproto-dpif.at:4726)
> 821: ofproto-dpif - too many output actions
> FAILED(ofproto-dpif.at:4741)
>
> I wonder what is the reason causing these errors?

I strongly suspect that it could be something like OVS running out of
memory while running the test, particularly if you're attempting to
run several tests in parallel with such little memory.

> Second, due to testing errors, I am trying to use
> "DEB_BUILD_OPTIONS='parallel=8 nocheck' fakeroot debian/rules binary" to
> skip tests, and I finished success.
>
> I wonder if I install these .deb files, which functions may be influenced
> due to tests failures?

If these are the only test failures, and you're using a fairly basic
OVS featureset, then you'll probably be fine.

> Third, in openvswitch's parent folder, there are many .deb files
>
> drwxrwxr-x 20 sasm sasm    4096 Nov  8 20:52 openvswitch-2.3.2
> -rw-r--r--  1 root root 3277164 Jun 19 03:50 openvswitch-2.3.2.tar.gz
> -rw-r--r--  1 root root  725388 Nov  8 20:49
> openvswitch-common_2.3.2-1_armhf.deb
> -rw-r--r--  1 root root 3246776 Nov  8 20:55
> openvswitch-datapath-dkms_2.3.2-1_all.deb
> -rw-r--r--  1 root root 3323462 Nov  8 20:55
> openvswitch-datapath-source_2.3.2-1_all.deb
> -rw-r--r--  1 root root 7642302 Nov  8 20:51
> openvswitch-dbg_2.3.2-1_armhf.deb
> -rw-r--r--  1 root root   38136 Nov  8 20:49
> openvswitch-ipsec_2.3.2-1_armhf.deb
> -rw-r--r--  1 root root   31962 Nov  8 20:55 openvswitch-pki_2.3.2-1_all.deb
> -rw-r--r--  1 root root 1907866 Nov  8 20:49
> openvswitch-switch_2.3.2-1_armhf.deb
> -rw-r--r--  1 root root   50040 Nov  8 20:55
> openvswitch-test_2.3.2-1_all.deb
> -rw-r--r--  1 root root  187756 Nov  8 20:49
> openvswitch-vtep_2.3.2-1_armhf.deb
> -rw-r--r--  1 root root   91236 Nov  8 20:55
> python-openvswitch_2.3.2-1_all.deb
>
> Should I install all these .deb files?

I suggest you read INSTALL.Debian.md. In particular:

Install the "openvswitch-switch" and "openvswitch-common" packages.
These packages include the core userspace components of the switch.

(You may also want openvswitch-datapath-dkms if you're running OVS
with the kernel module)

From openvswitch.org at siimnet.dk  Thu Nov 12 23:25:55 2015
From: openvswitch.org at siimnet.dk (OpenvSwitch)
Date: Fri, 13 Nov 2015 08:25:55 +0100
Subject: [ovs-discuss] Multicasting with OpenvSwitches
Message-ID: <886B55F9-8C25-4A3E-99E5-D10B951AC801@siimnet.dk>

when trying to run pacemaker+corosync in two VMs interconnected by open vswtiches I needed to revert to unicast, as multicast worked strange.

Verifying multicast with omping between two VMs, multicast would work the first 180sec then stop, wondering how come and if possible to change this behaviour?

TIA

/Steffen

# ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.3.2
Compiled Jun 27 2015 18:39:30
DB Schema 7.6.2

#omping afnA afnB
...
afnA :   unicast, seq=179, size=69 bytes, dist=0, time=0.237ms
afnA : multicast, seq=179, size=69 bytes, dist=0, time=0.351ms
afnA :   unicast, seq=180, size=69 bytes, dist=0, time=0.209ms
afnA : multicast, seq=180, size=69 bytes, dist=0, time=0.334ms
afnA :   unicast, seq=181, size=69 bytes, dist=0, time=0.310ms
afnA :   unicast, seq=182, size=69 bytes, dist=0, time=0.189ms
afnA :   unicast, seq=183, size=69 bytes, dist=0, time=0.319ms
afnA :   unicast, seq=184, size=69 bytes, dist=0, time=0.265ms

From joestringer at nicira.com  Thu Nov 12 23:27:00 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 12 Nov 2015 23:27:00 -0800
Subject: [ovs-discuss] openvswich freebsd 10.1 release configuration
	error
In-Reply-To: <1802601186.6453189.1447362325497.JavaMail.yahoo@mail.yahoo.com>
References: <CANr6G5wRNkd85ObGQjH4iVwTKt=Ui3ekvnYRy=7bm9uCU3oJ4A@mail.gmail.com>
 <1802601186.6453189.1447362325497.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <CANr6G5zeFsTUYpah8cvEXOosiKcx-XxMYaKjnhQP8mb9uiWjhQ@mail.gmail.com>

Hmm. The package should provide vswitch.ovsschema somewhere, but I'm
not familiar with FreeBSD or how this particular package is
configured.

The other thought I had is that the "No such file or directory" could
be referring to /var/db/openvswitch rather than the
/usr/share/openvswitch/vswitch.ovsschema.

I've CC'd kevlo, who is listed as the maintainer for this port (if I'm
not mistaken). Perhaps he can point you in the right direction.

On 12 November 2015 at 13:05, Hassan Samii <hassan_samii21 at yahoo.com> wrote:
> The OVS deamons are not running because there is no initial configuration.
> When i launch the command
> ovsdb-tool create /var/db/openvswitch/conf.db
> /usr/local/share/openvswitch/vswitch.ovsschema
>
> even if i change the prefix as you said i still get the "No such file or
> directory" error.
> I also tryed "whereis vswitch.ovsschema" and it doesn't find anything.
> I think there's supposed to be a folder called openvswitch which should have
> the db settings and all but apparently it doesnt exist.
>
>
>
> Il Giovedì 12 Novembre 2015 19:43, Joe Stringer <joestringer at nicira.com> ha
> scritto:
>
>
> On 12 November 2015 at 01:45, Hassan Samii <hassan_samii21 at yahoo.com> wrote:
>> Hi everyone, Firstly i'd like to thank everyone for the amazing work that
>> your doing.
>>
>> To my problem.
>> I installed Open vSwitch on a FreeBSD 10.1 Release (which resides on a
>> virtual machine working on Virtualbox). I used the Freshports to install
>> openvswitch and the installation completed successfully.
>> Now the problem is that if i do ovs-vsctl --version i get the following
>> (which i suspect is good):
>>
>> root at FreeBSDPrimo:~ # ovs-vsctl --version
>> ovs-vsctl (Open vSwitch) 2.3.2
>> Compiled Nov  4 2015 16:39:41
>> DB Schema 7.6.2
>>
>> but if i use the command ovs-vsctl show i get the following (which is not
>> good):
>>
>> ovs-vsctl: unix:/var/run/openvswitch/db.sock: database connection failed
>> (No
>> such file or directory)
>
> Are the OVS daemons running at this point (ovs-vswitchd, ovsdb-server)?
>
>
>> So then i thought that the configuration do the db was not set so i tried
>> this and got the following error:
>>
>> root at FreeBSDPrimo:~ # rm -f /var/db/openvswitch/conf.db
>> root at FreeBSDPrimo:~ # ovsdb-tool create /var/db/openvswitch/conf.db
>> /usr/local/share/openvswitch/vswitch.ovsschema
>> ovsdb-tool: failed to read schema:
>> "/usr/local/share/openvswitch/vswitch.ovsschema" could not be read as JSON
>> (error opening "/usr/local/share/openvswitch/vswitch.ovsschema": No such
>> file or directory)
>
>
> I suspect that this port of OVS is configured with /usr as the prefix,
> not /usr/local. So the path to the latter would be something like
> /usr/share/openvswitch/vswitch.ovsschema.
>
>
>


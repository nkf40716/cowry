From modaresi.hojat at gmail.com  Tue Sep  1 06:08:29 2015
From: modaresi.hojat at gmail.com (Hojat Modaresi zade)
Date: Tue, 1 Sep 2015 17:38:29 +0430
Subject: [ovs-discuss] openvswitch+ openflow+ openwrt configuration problem
Message-ID: <CAKPW56-MgYoFsW5pAwN=gExotXmBWuEh549F+9MXxyt6Yn-QHA@mail.gmail.com>

Hi guys;

The problem i am facing is that hosts connected to my switch can ping each
other even without any flow installed( any controller connected). It must
be from bad configuration.
These are details:

*dpctl tcp:192.168.1.1 stats-flow*

> SENDING:
> stat_req{type="flow", flags="0x0", table="all", oport="any", ogrp="any",
> cookie=0x0", mask=0x0", match=oxm{all match}}
>
>
> RECEIVED:
> stat_repl{type="flow", flags="0x0", stats=[]}
>


My system is:

   - linksys e3000, barrier breaker openwrt
   <http://git.openwrt.org/14.07/openwrt.git> installed
   - cpqd as openflow <https://github.com/CPqD/openflow-openwrt>

in openwrt there are two file to configure :

   - /etc/conf/network
   - /etc/conf/openflow

I have uploaded mine.


can anyone please help me solving this?

or guid me through how to configure openflow on openwrt?


thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150901/cc6ce7a1/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: openflow
Type: application/octet-stream
Size: 158 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150901/cc6ce7a1/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: network
Type: application/octet-stream
Size: 783 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150901/cc6ce7a1/attachment-0001.obj>

From blp at nicira.com  Tue Sep  1 09:56:43 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 1 Sep 2015 09:56:43 -0700
Subject: [ovs-discuss] openvswitch+ openflow+ openwrt configuration
 problem
In-Reply-To: <CAKPW56-MgYoFsW5pAwN=gExotXmBWuEh549F+9MXxyt6Yn-QHA@mail.gmail.com>
References: <CAKPW56-MgYoFsW5pAwN=gExotXmBWuEh549F+9MXxyt6Yn-QHA@mail.gmail.com>
Message-ID: <20150901165643.GA4365@nicira.com>

On Tue, Sep 01, 2015 at 05:38:29PM +0430, Hojat Modaresi zade wrote:
> Hi guys;
> 
> The problem i am facing is that hosts connected to my switch can ping each
> other even without any flow installed( any controller connected). It must
> be from bad configuration.
> These are details:
> 
> *dpctl tcp:192.168.1.1 stats-flow*
> 
> > SENDING:
> > stat_req{type="flow", flags="0x0", table="all", oport="any", ogrp="any",
> > cookie=0x0", mask=0x0", match=oxm{all match}}
> >
> >
> > RECEIVED:
> > stat_repl{type="flow", flags="0x0", stats=[]}
> >
> 
> 
> My system is:
> 
>    - linksys e3000, barrier breaker openwrt
>    <http://git.openwrt.org/14.07/openwrt.git> installed
>    - cpqd as openflow <https://github.com/CPqD/openflow-openwrt>

I don't think you're using Open vSwitch, then.

From jpettit at nicira.com  Tue Sep  1 10:55:51 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 1 Sep 2015 10:55:51 -0700
Subject: [ovs-discuss] conntrack feature detection
In-Reply-To: <79CC97AE-B3A1-4A5B-A072-EBF0376D2700@skyportsystems.com>
References: <79CC97AE-B3A1-4A5B-A072-EBF0376D2700@skyportsystems.com>
Message-ID: <AFC9B268-E432-43F9-856F-D536EBE221D9@nicira.com>


> On Aug 31, 2015, at 8:40 PM, Ben Warren <ben at skyportsystems.com> wrote:
> 
> It’s exciting to see conntrack support being accepted in the Linux kernel.  We’ve been building based on the justinpettit/ovs tree and so far it works like a charm. Nice work!

Great to hear that it's working for you!

> Two questions:
> 1. Is there a way, apart from parsing the output of ‘ovs-ofctl —version’ to determine if the installed .ko supports conntrack?  I looked through /proc and /sys and didn’t see anything, but am pretty good at missing things.

I'm not aware of one.  In ofproto-dpif.c, there are run time checks for a number of features, including conntrack support.  Currently, it just logs a message, but it might make sense to store that information in OVSDB.  Would that help?

> 2. Any idea when the changes will be merged into ovs mainline?  I expect “as soon as we can”, but just wondering...

That's basically correct.  :-)  The issue is that we need to backport it to older kernels, which could be fairly complicated.  Joe Stringer is doing that work, but he's estimating a month or two.  That's subject to change, though, as he digs into it. 

I think his plan is to send out the userspace changes for review soon, though, which will allow the tip of OVS master to work with a net-next kernel.  Based on our experience using conntrack, there will be a couple of changes to the OpenFlow interface to conntrack:

	- You won't need to provide an immediate value to the zone argument.  Instead, you can point it to a register value.

	- Instead of just a "recirc" flag, you can specify a "go-to table" argument that will make execution continue from the specified table.

I'll send out later this week a link to my personal repo that makes use of these new conntrack argument for ACL support in OVN.

--Justin



From blp at nicira.com  Tue Sep  1 11:02:24 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 1 Sep 2015 11:02:24 -0700
Subject: [ovs-discuss] conntrack feature detection
In-Reply-To: <AFC9B268-E432-43F9-856F-D536EBE221D9@nicira.com>
References: <79CC97AE-B3A1-4A5B-A072-EBF0376D2700@skyportsystems.com>
 <AFC9B268-E432-43F9-856F-D536EBE221D9@nicira.com>
Message-ID: <20150901180224.GD5867@nicira.com>

On Tue, Sep 01, 2015 at 10:55:51AM -0700, Justin Pettit wrote:
> 
> > On Aug 31, 2015, at 8:40 PM, Ben Warren <ben at skyportsystems.com> wrote:
> > 1. Is there a way, apart from parsing the output of ‘ovs-ofctl
> > —version’ to determine if the installed .ko supports conntrack?  

ovs-ofctl can't tell you anything about the kernel module--it's multiple
layers removed from it, and might not even be on the same physical
machine as the kernel module in question.

> > I looked through /proc and /sys and didn’t see anything, but am
> > pretty good at missing things.
> 
> I'm not aware of one.  In ofproto-dpif.c, there are run time checks
> for a number of features, including conntrack support.  Currently, it
> just logs a message, but it might make sense to store that information
> in OVSDB.  Would that help?

Personally I recommend that users probe for features by trying to use
them.

From ben at skyportsystems.com  Tue Sep  1 11:11:07 2015
From: ben at skyportsystems.com (Ben Warren)
Date: Tue, 1 Sep 2015 11:11:07 -0700
Subject: [ovs-discuss] conntrack feature detection
In-Reply-To: <20150901180224.GD5867@nicira.com>
References: <79CC97AE-B3A1-4A5B-A072-EBF0376D2700@skyportsystems.com>
 <AFC9B268-E432-43F9-856F-D536EBE221D9@nicira.com>
 <20150901180224.GD5867@nicira.com>
Message-ID: <32DFA874-2E0C-47A5-A715-A505F27D5BAE@skyportsystems.com>


> On Sep 1, 2015, at 11:02 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> On Tue, Sep 01, 2015 at 10:55:51AM -0700, Justin Pettit wrote:
>> 
>>> On Aug 31, 2015, at 8:40 PM, Ben Warren <ben at skyportsystems.com> wrote:
>>> 1. Is there a way, apart from parsing the output of ‘ovs-ofctl
>>> —version’ to determine if the installed .ko supports conntrack?  
> 
> ovs-ofctl can't tell you anything about the kernel module--it's multiple
> layers removed from it, and might not even be on the same physical
> machine as the kernel module in question.

That makes sense.  I’ve seen other kernel drivers that have some kind of ‘feature bitmask’ that’s readable from userspace via procfs or sysfs, but that sort of thing is hard to maintain and doesn’t scale well. 
> 
>>> I looked through /proc and /sys and didn’t see anything, but am
>>> pretty good at missing things.
>> 
>> I'm not aware of one.  In ofproto-dpif.c, there are run time checks
>> for a number of features, including conntrack support.  Currently, it
>> just logs a message, but it might make sense to store that information
>> in OVSDB.  Would that help?
> 
> Personally I recommend that users probe for features by trying to use
> them.
This isn’t something I really need, it would just be handy in the short term when I have some systems with the new driver and some that don’t.  I’ll manage either through probing or manually.  Thanks for responding!

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3583 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150901/ff41d13f/attachment.bin>

From gavin_remaley at selinc.com  Tue Sep  1 12:35:29 2015
From: gavin_remaley at selinc.com (gavin_remaley at selinc.com)
Date: Tue, 1 Sep 2015 13:35:29 -0600
Subject: [ovs-discuss] Deleting Flows that reference a deleted Group
Message-ID: <OF84BBE49D.83D7A862-ON88257EB3.006AC774-87257EB3.006B9F1B@selinc.com>

When I delete a Group, I do not see Flows being deleted that reference the 
deleted Group via Write Actions.  Per the OF Spec, this seems like it 
should be happening.

It appears that the search is performed but perhaps it does not properly 
delve into Write Actions instructions?

The patch below seems to have fixed it, but I am not sure if this is the 
appropriate thing to do.  Am I missing something or does this appear to be 
a real problem?

diff --git a/lib/ofp-actions.c b/lib/ofp-actions.c
index ea47ff9..811020d 100644
--- a/lib/ofp-actions.c
+++ b/lib/ofp-actions.c
@@ -3183,9 +3183,28 @@ ofpacts_output_to_group(const struct ofpact 
*ofpacts, size_t ofpacts_len,
     const struct ofpact *a;
 
     OFPACT_FOR_EACH (a, ofpacts, ofpacts_len) {
-        if (a->type == OFPACT_GROUP
-            && ofpact_get_GROUP(a)->group_id == group_id) {
-            return true;
+        if (a->type == OFPACT_GROUP) {
+
+            if (ofpact_get_GROUP(a)->group_id == group_id) {
+               return true;
+            }
+        }
+        else if (a->type == OFPACT_WRITE_ACTIONS)
+        {
+            /* Get the nested actions */
+            const struct ofpact_nest *nested_actions = 
ofpact_get_WRITE_ACTIONS(a);
+            struct ofpact const *nested;
+ 
+            /* Loop through all the nested actions (Write Actions) */
+            OFPACT_FOR_EACH (nested,
+                             nested_actions->actions,
+                             ofpact_nest_get_action_len(nested_actions)) 
{
+                if (nested->type == OFPACT_GROUP &&
+                    ofpact_get_GROUP(nested)->group_id == group_id) {
+                    return true;
+                }
+ 
+            }
         }
     }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150901/576193a6/attachment.html>

From blp at nicira.com  Tue Sep  1 13:52:04 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 1 Sep 2015 13:52:04 -0700
Subject: [ovs-discuss] Deleting Flows that reference a deleted Group
In-Reply-To: <OF84BBE49D.83D7A862-ON88257EB3.006AC774-87257EB3.006B9F1B@selinc.com>
References: <OF84BBE49D.83D7A862-ON88257EB3.006AC774-87257EB3.006B9F1B@selinc.com>
Message-ID: <20150901205204.GE6089@nicira.com>

On Tue, Sep 01, 2015 at 01:35:29PM -0600, gavin_remaley at selinc.com wrote:
> When I delete a Group, I do not see Flows being deleted that reference the 
> deleted Group via Write Actions.  Per the OF Spec, this seems like it 
> should be happening.
> 
> It appears that the search is performed but perhaps it does not properly 
> delve into Write Actions instructions?
> 
> The patch below seems to have fixed it, but I am not sure if this is the 
> appropriate thing to do.  Am I missing something or does this appear to be 
> a real problem?

I think this is a real bug.  Will you submit this patch to the dev list?
(The full process is explained in CONTRIBUTING.md.)

From davidjoshuaevans at gmail.com  Wed Sep  2 07:57:47 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Wed, 02 Sep 2015 09:57:47 -0500
Subject: [ovs-discuss] ovs-vsctl stuck waiting for switch to quiesce on set
 interface options
Message-ID: <D20C789B.31867%davidjoshuaevans@gmail.com>

Hi OVS wizards.

I added a set_config handler to netdev-dpdk. (something like the
netdev-vport one)
I can successfully set parameters of my netdev devices If I have not sent
any traffic through the switch.

BUT, if I try to do this whilst traffic is running through OVS - even at a
low rate, I find that
* ovs­vsctl is stuck busy waiting for the switch to quiesce,
* even though the settings successfully made it to the set_config handler
and gdb tells me it¹s doing the right thing and applied the settings with
the pmd threads merrily getting on with the job.
I tried adding a netdev_change_seq_changed like the vport but this did not
help.

How do I tell ovs from my netdev-dpdk.c that everything¹s ok and get it to
tell ovs-vsctl to be happy and go away?
Is there something about netdev-vport handling that is different from pmd
netdev-dpdk handlers?

I am using revision 2.3.2+29bae5412ea3c6a1e20d79afd25c11b968dffa05 which is
kind of close to your 2.4 release.


Thank you for your super work,

Dave.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150902/d0dac01b/attachment-0001.html>

From alex.wang at intel.com  Tue Sep  1 23:05:38 2015
From: alex.wang at intel.com (Wang, Alex)
Date: Wed, 2 Sep 2015 06:05:38 +0000
Subject: [ovs-discuss] [OVS-DPDK] fail configure with dpdk lib
Message-ID: <44DCB303C35ABD46A033F2AA0A54E5BF0105FB51@shsmsx102.ccr.corp.intel.com>

Hi Team,

I am following INSTALL.DPDK.md and try to build a OVS environment with DPDK lib. But we encountered an error during compiling OVS with DPDK lib.
Here are my steps and corresponding error info, could you please help to check any exception from DPDK end? Thanks a lot in advance!


1.       Configure and install DPDK2.1.0 build

a.       CONFIG_RTE_BUILD_COMBINE_LIBS=y                // to generate single lib file in DPDK

b.      CONFIG_RTE_LIBRTE_VHOST=y                                // to build DPDK with vhost lib

c.       make install T=x86_64-native-linuxapp-gcc          // build and install the lib

d.      here are the lib generated, please help to confirm if we missed any specific for OVS requirement

[cid:image001.png at 01D0E588.5F6B87E0]



2.       try to configure and build OVS with DPDK lib involved

a.       ./boot.sh

b.      ./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"            // $DPDK_BUILD is pointing to DPDK lib path

c.       The error comes out during compiling, cannot link with dpdk. config.log(full log) is attached in mail, also list all the *.a files in $RTE_SDK/x86_64-native-linuxapp-gcc/lib/ as below. Very appreciate if you can figure out any mismatch in DPDK libraries for OVS.
[cid:image002.png at 01D0E588.5F6B87E0]


...........................

...........................

| /* end confdefs.h.  */

| #include <rte_config.h>

|                              #include <rte_eal.h>

| int

| main ()

| {

| int rte_argc; char ** rte_argv;

|                              rte_eal_init(rte_argc, rte_argv);

|   ;

|   return 0;

| }

configure:18276: error: cannot link with dpdk





Best Regards,
Alex

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150902/3fbd5895/attachment-0002.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 10472 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150902/3fbd5895/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 17809 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150902/3fbd5895/attachment-0005.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: config.log
Type: application/octet-stream
Size: 109711 bytes
Desc: config.log
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150902/3fbd5895/attachment-0002.obj>

From alex.wang at intel.com  Tue Sep  1 23:05:38 2015
From: alex.wang at intel.com (Wang, Alex)
Date: Wed, 2 Sep 2015 06:05:38 +0000
Subject: [ovs-discuss] [OVS-DPDK] fail configure with dpdk lib
Message-ID: <44DCB303C35ABD46A033F2AA0A54E5BF0105FB51@shsmsx102.ccr.corp.intel.com>

Hi Team,

I am following INSTALL.DPDK.md and try to build a OVS environment with DPDK lib. But we encountered an error during compiling OVS with DPDK lib.
Here are my steps and corresponding error info, could you please help to check any exception from DPDK end? Thanks a lot in advance!


1.       Configure and install DPDK2.1.0 build

a.       CONFIG_RTE_BUILD_COMBINE_LIBS=y                // to generate single lib file in DPDK

b.      CONFIG_RTE_LIBRTE_VHOST=y                                // to build DPDK with vhost lib

c.       make install T=x86_64-native-linuxapp-gcc          // build and install the lib

d.      here are the lib generated, please help to confirm if we missed any specific for OVS requirement

[cid:image001.png at 01D0E588.5F6B87E0]



2.       try to configure and build OVS with DPDK lib involved

a.       ./boot.sh

b.      ./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"            // $DPDK_BUILD is pointing to DPDK lib path

c.       The error comes out during compiling, cannot link with dpdk. config.log(full log) is attached in mail, also list all the *.a files in $RTE_SDK/x86_64-native-linuxapp-gcc/lib/ as below. Very appreciate if you can figure out any mismatch in DPDK libraries for OVS.
[cid:image002.png at 01D0E588.5F6B87E0]


...........................

...........................

| /* end confdefs.h.  */

| #include <rte_config.h>

|                              #include <rte_eal.h>

| int

| main ()

| {

| int rte_argc; char ** rte_argv;

|                              rte_eal_init(rte_argc, rte_argv);

|   ;

|   return 0;

| }

configure:18276: error: cannot link with dpdk





Best Regards,
Alex

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150902/3fbd5895/attachment-0003.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 10472 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150902/3fbd5895/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 17809 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150902/3fbd5895/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: config.log
Type: application/octet-stream
Size: 109711 bytes
Desc: config.log
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150902/3fbd5895/attachment-0003.obj>

From marian.mihailescu at adelaide.edu.au  Wed Sep  2 16:16:06 2015
From: marian.mihailescu at adelaide.edu.au (Marian Mihailescu)
Date: Thu, 3 Sep 2015 08:46:06 +0930
Subject: [ovs-discuss] match arp requests from local
Message-ID: <CAM3PiRw9w=hQmzeGCvgjny_Lr-S5QJjAa=Z4WXL3E+igQ-dNvQ@mail.gmail.com>

I am trying to do some level 3 routing rules, that include setting the
source ip address. For this to works, arp requests need to be
forwarded first.

the following flow works as expected:

arp, in_port=1, actions=set_field:EXTERNAL_IP->arp_spa,output:4

and arp requests received from port 1 are forwarded to port 4, and
replies are expected on EXTERNAL_IP.

my ovs switch has no IP, and interface on port 4 has EXTERNAL_IP.

how can i do the same for requests from localhost?

arp, in_port=LOCAL, actions=set_field:EXTERNAL_IP->arp_spa,output:4

is not working, no packet is matched, and the arp requests are
generated using another interface IP (not 4). in fact, i cannot match
any arp from localhost. i can forward traffic coming in, but not my
own.

fyi, there is only 1 routing rule, default, that goes to my ovs bridge
interface, so ovs should be in charge of everything.

thanks!

From ambigioz at gmail.com  Thu Sep  3 00:40:17 2015
From: ambigioz at gmail.com (Dario Banfi)
Date: Thu, 3 Sep 2015 17:40:17 +1000
Subject: [ovs-discuss] Datapath userspace reordering
Message-ID: <1ED3A783-9F65-42B8-84B9-2FD61E15B574@gmail.com>

Hi,

I have been trying to to create a “reordering” group that buffers TCP packets and send them out in order, but without success.
I use the slow path for all the packets and I can get the sequence either from ctx->xin->packet or in handle_upcall() .

But how can I buffer the packets, reorder them and send them all out? Any hint on the file / function where this could implemented would be really appreciated.
Isn’t there anywhere in the code where I can send out all the reordered packets with a loop?

From weihj1999 at gmail.com  Thu Sep  3 01:32:23 2015
From: weihj1999 at gmail.com (Hongjin Wei)
Date: Thu, 3 Sep 2015 16:32:23 +0800
Subject: [ovs-discuss] How ovs support to run on VMware virtual Machine
Message-ID: <CAPCEwzDvijd86kYvO-cAQJCgEO+N1EPSu=6LJUTHGqZG94aQug@mail.gmail.com>

Recently, I set up my owv on two VMs which hosted on vmware vcenter managed
cluster. The two VMs are hosted on same esxi server.

I am trying to add vlan port, but they can not reach each other in
bi-direction.

#ovs-vsctl add-port br-ens34 test901
#ovs-vsctl set interface test901 type=internal
#ovs-vsctl set port test901 tag=901
#ovs-vsctl set port test901 vlan_mode=native-untagged
#ip set link dev test901 up
#ip addr add 10.0.1.111/24 brd 10.0.1.255 dev test901

repeat the above on another VM which install ovs, but assign another ip
10.0.1.23/24

I failed to ping them each other, there is no any icmp reply message from
the output of tcpdump.

I guess ovs  is not supported to run on vmware guest os.  is anyone
experience this problem? Do we have solution for this?

Thanks all
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150903/2caa0749/attachment.html>

From kevin.traynor at intel.com  Thu Sep  3 02:24:09 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 3 Sep 2015 09:24:09 +0000
Subject: [ovs-discuss] [OVS-DPDK] fail configure with dpdk lib
In-Reply-To: <44DCB303C35ABD46A033F2AA0A54E5BF0105FB51@shsmsx102.ccr.corp.intel.com>
References: <44DCB303C35ABD46A033F2AA0A54E5BF0105FB51@shsmsx102.ccr.corp.intel.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74520B598@IRSMSX104.ger.corp.intel.com>


From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Wang, Alex
Sent: Wednesday, September 2, 2015 7:06 AM
To: bugs at openvswitch.org; discuss at openvswitch.org
Cc: Wang, Alex
Subject: [ovs-discuss] [OVS-DPDK] fail configure with dpdk lib

Hi Team,

I am following INSTALL.DPDK.md and try to build a OVS environment with DPDK lib. But we encountered an error during compiling OVS with DPDK lib.
Here are my steps and corresponding error info, could you please help to check any exception from DPDK end? Thanks a lot in advance!


1.       Configure and install DPDK2.1.0 build

a.       CONFIG_RTE_BUILD_COMBINE_LIBS=y                // to generate single lib file in DPDK

b.      CONFIG_RTE_LIBRTE_VHOST=y                                // to build DPDK with vhost lib

c.       make install T=x86_64-native-linuxapp-gcc          // build and install the lib

d.      here are the lib generated, please help to confirm if we missed any specific for OVS requirement

[cid:image001.png at 01D0E62A.CDB94370]


[kt] I see you are using DPDK 2.1.0 - did you pick up the patch to enable DPDK 2.1.0 support in OVS?
[kt] http://openvswitch.org/pipermail/dev/2015-September/059542.html
[kt] The combined lib name has changed in DPDK 2.1.0, so you could be hitting that problem

[kt] Also at the tip of master you'll need this patch
[kt] http://openvswitch.org/pipermail/dev/2015-September/059541.html

[kt] Assuming there is no problem with merges of these, then these are only temporary steps.







2.       try to configure and build OVS with DPDK lib involved

a.       ./boot.sh

b.      ./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"            // $DPDK_BUILD is pointing to DPDK lib path

[kt] Just to confirm this should point to the dpdk build dir so it would be <your_path>/dpdk-2.1.0/x86_64-native-linuxapp-gcc


c.       The error comes out during compiling, cannot link with dpdk. config.log(full log) is attached in mail, also list all the *.a files in $RTE_SDK/x86_64-native-linuxapp-gcc/lib/ as below. Very appreciate if you can figure out any mismatch in DPDK libraries for OVS.
[cid:image002.png at 01D0E62A.CDB94370]


...........................

...........................

| /* end confdefs.h.  */

| #include <rte_config.h>

|                              #include <rte_eal.h>

| int

| main ()

| {

| int rte_argc; char ** rte_argv;

|                              rte_eal_init(rte_argc, rte_argv);

|   ;

|   return 0;

| }

configure:18276: error: cannot link with dpdk





Best Regards,
Alex

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150903/679b64bb/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 10472 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150903/679b64bb/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 17809 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150903/679b64bb/attachment-0003.png>

From kevin.traynor at intel.com  Thu Sep  3 02:24:09 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 3 Sep 2015 09:24:09 +0000
Subject: [ovs-discuss] [OVS-DPDK] fail configure with dpdk lib
In-Reply-To: <44DCB303C35ABD46A033F2AA0A54E5BF0105FB51@shsmsx102.ccr.corp.intel.com>
References: <44DCB303C35ABD46A033F2AA0A54E5BF0105FB51@shsmsx102.ccr.corp.intel.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74520B598@IRSMSX104.ger.corp.intel.com>


From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Wang, Alex
Sent: Wednesday, September 2, 2015 7:06 AM
To: bugs at openvswitch.org; discuss at openvswitch.org
Cc: Wang, Alex
Subject: [ovs-discuss] [OVS-DPDK] fail configure with dpdk lib

Hi Team,

I am following INSTALL.DPDK.md and try to build a OVS environment with DPDK lib. But we encountered an error during compiling OVS with DPDK lib.
Here are my steps and corresponding error info, could you please help to check any exception from DPDK end? Thanks a lot in advance!


1.       Configure and install DPDK2.1.0 build

a.       CONFIG_RTE_BUILD_COMBINE_LIBS=y                // to generate single lib file in DPDK

b.      CONFIG_RTE_LIBRTE_VHOST=y                                // to build DPDK with vhost lib

c.       make install T=x86_64-native-linuxapp-gcc          // build and install the lib

d.      here are the lib generated, please help to confirm if we missed any specific for OVS requirement

[cid:image001.png at 01D0E62A.CDB94370]


[kt] I see you are using DPDK 2.1.0 - did you pick up the patch to enable DPDK 2.1.0 support in OVS?
[kt] http://openvswitch.org/pipermail/dev/2015-September/059542.html
[kt] The combined lib name has changed in DPDK 2.1.0, so you could be hitting that problem

[kt] Also at the tip of master you'll need this patch
[kt] http://openvswitch.org/pipermail/dev/2015-September/059541.html

[kt] Assuming there is no problem with merges of these, then these are only temporary steps.







2.       try to configure and build OVS with DPDK lib involved

a.       ./boot.sh

b.      ./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-align"            // $DPDK_BUILD is pointing to DPDK lib path

[kt] Just to confirm this should point to the dpdk build dir so it would be <your_path>/dpdk-2.1.0/x86_64-native-linuxapp-gcc


c.       The error comes out during compiling, cannot link with dpdk. config.log(full log) is attached in mail, also list all the *.a files in $RTE_SDK/x86_64-native-linuxapp-gcc/lib/ as below. Very appreciate if you can figure out any mismatch in DPDK libraries for OVS.
[cid:image002.png at 01D0E62A.CDB94370]


...........................

...........................

| /* end confdefs.h.  */

| #include <rte_config.h>

|                              #include <rte_eal.h>

| int

| main ()

| {

| int rte_argc; char ** rte_argv;

|                              rte_eal_init(rte_argc, rte_argv);

|   ;

|   return 0;

| }

configure:18276: error: cannot link with dpdk





Best Regards,
Alex

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150903/679b64bb/attachment-0003.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 10472 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150903/679b64bb/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 17809 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150903/679b64bb/attachment-0007.png>

From dotslash.lu at gmail.com  Thu Sep  3 03:00:20 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Thu, 3 Sep 2015 18:00:20 +0800
Subject: [ovs-discuss] Build issues on linux kernel version 2.6.32-573.3.1
	RHEL6
Message-ID: <CALrtOxpL3PKDqfgZ4rv943vtnGJsmxc4E85qfsbWbSdsAJXgRw@mail.gmail.com>

Hi all,

Seems there're some issues with linux kernel version 2.6.32-573.3.1, I've
tried to build both ovs 2.3.2 and 2.4.0 on both CentOS 6.4 and CentOS 6.6,
all ended with errors shown below.

Definitely links to this subject: build upstream ovs kernel module failed
on CentOS 6.6
http://openvswitch.org/pipermail/discuss/2014-November/015542.html
According to Pravin his patch for this has been pushed to branch-2.3
master, but it seems that it's not working for me.

With ./configure --with-linux=/lib/modules/`uname -r`/build` or rpmbuild
-bb rhel/openvswitch-kmod-rhel6.spec :
=====
.
.
.
+ /usr/bin/make -C _default/datapath/linux -j2
make: Entering directory
`/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux'
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../actions.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../dp_notify.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow_netlink.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../flow_table.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-gre.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-internal_dev.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-lisp.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-netdev.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../vport-vxlan.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/dev-openvswitch.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/exthdrs_core.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/flex_array.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/flow_dissector.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/gre.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/gso.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/genetlink-openvswitch.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/hash.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/hash-x86.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/ip_tunnels_core.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/netdevice.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/net_namespace.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/reciprocal_div.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/skbuff-openvswitch.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/vxlan.c
ln -s
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../linux/compat/utils.c
/usr/bin/make -C /usr/src/kernels/2.6.32-573.3.1.el6.x86_64
M=/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux modules
make[1]: Entering directory `/usr/src/kernels/2.6.32-573.3.1.el6.x86_64'
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.o
  CC [M]
 /root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.o
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:21:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h:
In function 'skb_clear_hash':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h:302:
error: 'struct sk_buff' has no member named 'l4_rxhash'
In file included from include/linux/if_ether.h:136,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/if_ether.h:4,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../include/linux/if_ether.h:26,
                 from include/linux/netdevice.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from include/linux/if_arp.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/if_arp.h:4,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:23:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h:
In function 'skb_clear_hash':
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/skbuff.h:302:
error: 'struct sk_buff' has no member named 'l4_rxhash'
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:22:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/in.h:
At top level:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/in.h:8:
error: redefinition of 'proto_ports_offset'
include/linux/in.h:292: note: previous definition of 'proto_ports_offset'
was here
In file included from include/linux/netfilter.h:9,
                 from include/net/netns/x_tables.h:5,
                 from include/net/net_namespace.h:18,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/net_namespace.h:4,
                 from include/linux/netdevice.h:48,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from include/linux/if_arp.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/if_arp.h:4,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:23:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/in.h:
At top level:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/in.h:8:
error: redefinition of 'proto_ports_offset'
include/linux/in.h:292: note: previous definition of 'proto_ports_offset'
was here
In file included from include/linux/if_arp.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/if_arp.h:4,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:23:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:37:
error: conflicting types for 'netdev_rx_handler_register'
include/linux/netdevice.h:2215: note: previous declaration of
'netdev_rx_handler_register' was here
In file included from include/net/sock.h:50,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/sock.h:4,
                 from include/linux/tcp.h:180,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/tcp.h:4,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:26:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/linux/netdevice.h:37:
error: conflicting types for 'netdev_rx_handler_register'
include/linux/netdevice.h:2215: note: previous declaration of
'netdev_rx_handler_register' was here
In file included from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.c:31:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:9:
error: redefinition of 'ip_is_fragment'
include/net/ip.h:249: note: previous definition of 'ip_is_fragment' was here
In file included from include/net/xfrm.h:18,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../compat.h:26,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/../datapath.h:29,
                 from
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.c:57:
/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/../datapath/linux/compat/include/net/ip.h:9:
error: redefinition of 'ip_is_fragment'
include/net/ip.h:249: note: previous definition of 'ip_is_fragment' was here
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/datapath.o]
Error 1
make[2]: *** Waiting for unfinished jobs....
make[2]: ***
[/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux/actions.o]
Error 1
make[1]: ***
[_module_/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux]
Error 2
make[1]: Leaving directory `/usr/src/kernels/2.6.32-573.3.1.el6.x86_64'
make: *** [default] Error 2
make: Leaving directory
`/root/rpmbuild/BUILD/openvswitch-2.3.2/_default/datapath/linux'
error: Bad exit status from /var/tmp/rpm-tmp.bR1bj9 (%build)
=====
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150903/e267969b/attachment.html>

From fbl at sysclose.org  Thu Sep  3 07:07:37 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Thu, 3 Sep 2015 11:07:37 -0300
Subject: [ovs-discuss] SR-IOV with OVS
In-Reply-To: <15422219-89C4-45A2-A2FD-B72D46B26E00@yahoo.com>
References: <15422219-89C4-45A2-A2FD-B72D46B26E00@yahoo.com>
Message-ID: <20150903140737.GB2349@x240.home>

On Tue, Aug 25, 2015 at 02:47:48PM +0800, c1 wrote:
> Hi,all:
> There is a physical interface eth0 on my server, I opened the SR-IOV functionality of this physical port on.Now I can see eth0 ~ 7.
> 	
> 	eth0 belong ovs network, there are some in ovs switch virtual interface for virtual machines. 
> 	
> 	One virtual interface I configured vlan 174, and through him to create a virtual machine vm0, go after the virtual machine can ping vlan gateways and vlans' IP. 
> 	
> 	When I use the SR-IOV interface to create virtual machines created vm1, and configure vlan 174, the virtual machine can also  ping the gateway and vlans' IP.    
> 	
> 	But vm1 and vm0 not be able to ping each other.    
> 	
> 	When vm1 ping vm2 : vm1 can learn vm0 the arp, arp I can see requests and responses through the tcpdump packet capture on eth0. 
> 
> 	But I do not see the icmp request packets.    
> 
> 	Phenomenon is the use of SR-IOV port did not forward the packet to eth0, what I need to do configuration changes?  
> 
> 	We look forward to your answer!

It should work, but you have to make sure the MAC addresses are
correct and if the card does VF switching or if it needs help
from the external switch.

But since you're adding to the vswitch, why do you need SR-IOV?
You probably could add the PF and do everything else in OVS.

fbl


From kevin.traynor at intel.com  Thu Sep  3 14:20:25 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 3 Sep 2015 21:20:25 +0000
Subject: [ovs-discuss] ovs-vsctl stuck waiting for switch to quiesce on
 set interface options
In-Reply-To: <D20C789B.31867%davidjoshuaevans@gmail.com>
References: <D20C789B.31867%davidjoshuaevans@gmail.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74520C6DD@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of David
> Evans
> Sent: Wednesday, September 2, 2015 3:58 PM
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] ovs-vsctl stuck waiting for switch to quiesce on set
> interface options
> 
> Hi OVS wizards.
> 
> I added a set_config handler to netdev-dpdk. (something like the netdev-vport
> one)
> I can successfully set parameters of my netdev devices If I have not sent any
> traffic through the switch.
> 
> BUT, if I try to do this whilst traffic is running through OVS - even at a
> low rate, I find that
> . ovs-vsctl is stuck busy waiting for the switch to quiesce,

seems strange. I would have thought that your set_config should just have to
return. The log message should tell you which thread is not quiescing. 

You've probably already done - but you could try removing functionality from
your set_config fn to try and isolate the problem?

> . even though the settings successfully made it to the set_config handler and
> gdb tells me it's doing the right thing and applied the settings with the pmd
> threads merrily getting on with the job.
> I tried adding a netdev_change_seq_changed like the vport but this did not
> help.
> 
> How do I tell ovs from my netdev-dpdk.c that everything's ok and get it to
> tell ovs-vsctl to be happy and go away?
> Is there something about netdev-vport handling that is different from pmd
> netdev-dpdk handlers?
> 
> I am using revision 2.3.2+29bae5412ea3c6a1e20d79afd25c11b968dffa05 which is
> kind of close to your 2.4 release.
> 
> 
> Thank you for your super work,
> 
> Dave.

From jesse at nicira.com  Thu Sep  3 14:39:17 2015
From: jesse at nicira.com (Jesse Gross)
Date: Thu, 3 Sep 2015 14:39:17 -0700
Subject: [ovs-discuss] Build issues on linux kernel version
	2.6.32-573.3.1 RHEL6
In-Reply-To: <CALrtOxpL3PKDqfgZ4rv943vtnGJsmxc4E85qfsbWbSdsAJXgRw@mail.gmail.com>
References: <CALrtOxpL3PKDqfgZ4rv943vtnGJsmxc4E85qfsbWbSdsAJXgRw@mail.gmail.com>
Message-ID: <CAEP_g=9P+z+_s3XdJ0Dh2-X2TVZ1bBJ7fhKDnN6CY0rck9+sBw@mail.gmail.com>

On Thu, Sep 3, 2015 at 3:00 AM, Tashi Lu <dotslash.lu at gmail.com> wrote:
> Hi all,
>
> Seems there're some issues with linux kernel version 2.6.32-573.3.1, I've
> tried to build both ovs 2.3.2 and 2.4.0 on both CentOS 6.4 and CentOS 6.6,
> all ended with errors shown below.

A number of fixes for CentOS 6 were just applied to branch-2.4 in git,
so I would recommend trying that to see if that solves the issue.

From kevin.traynor at intel.com  Thu Sep  3 14:45:54 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 3 Sep 2015 21:45:54 +0000
Subject: [ovs-discuss] [OVS-DPDK] fail configure with dpdk lib
In-Reply-To: <EDCEC56DA1E05E428B0B5FBB4D07139216D6D51F@xmb-rcd-x06.cisco.com>
References: <44DCB303C35ABD46A033F2AA0A54E5BF0105FB51@shsmsx102.ccr.corp.intel.com>
 <BC0FEEC7D7650749874CEC11314A88F74520B598@IRSMSX104.ger.corp.intel.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216D6D51F@xmb-rcd-x06.cisco.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74520C7F5@IRSMSX104.ger.corp.intel.com>

[re-adding list]

> -----Original Message-----
> From: Serguei Bezverkhi (sbezverk) [mailto:sbezverk at cisco.com]
> Sent: Thursday, September 3, 2015 10:17 PM
> To: Traynor, Kevin; Wang, Alex
> Subject: RE: [OVS-DPDK] fail configure with dpdk lib
> 
> Hi Kevin,
> 
> After applying second patch,  http://openvswitch.org/pipermail/dev/2015-
> September/059541.html to OVS 2.4.0
> compilation fails:

That patch is to fix an issue with a post OVS 2.4.0 release commit, so it
shouldn't be applied to OVS 2.4.0.

> 
> lib/netdev-dpdk.c: In function 'dpdk_eth_dev_init':
> lib/netdev-dpdk.c:532:23: error: request for member 'ea' in something not a
> structure or union
>      memcpy(dev->hwaddr.ea, eth_addr.addr_bytes, ETH_ADDR_LEN);
>                        ^
> 
> Any suggestions. These two patches you mentioned, do they apply to 2.4.0 and
> master or master only?

The patch above should not go on OVS 2.4, the other one (DPDK 2.1 integration)
is intended for master but you could try with OVS 2.4 if you wanted. 

DPDK 2.0 is the version paired with OVS 2.4, but I can't think of any reason
DPDK 2.1 wouldn't work with OVS 2.4 plus the patch (assuming it applies cleanly). 

> 
> Thank you
> 
> Serguei
> 
> 
> 
> Serguei Bezverkhi,
> TECHNICAL LEADER.SERVICES
> Global SP Services
> sbezverk at cisco.com
> Phone: +1 416 306 7312
> Mobile: +1 514 234 7374
> 
> CCIE (R&S,SP,Sec) - #9527
> 
> Cisco.com
> 
> 
> 
>  Think before you print.
> This email may contain confidential and privileged material for the sole use
> of the intended recipient. Any review, use, distribution or disclosure by
> others is strictly prohibited. If you are not the intended recipient (or
> authorized to receive for the recipient), please contact the sender by reply
> email and delete all copies of this message.
> Please click here for Company Registration Information.
> 
> 
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Traynor,
> Kevin
> Sent: Thursday, September 03, 2015 5:24 AM
> To: Wang, Alex <alex.wang at intel.com>; bugs at openvswitch.org;
> discuss at openvswitch.org
> Cc: Wang, Alex <alex.wang at intel.com>
> Subject: Re: [ovs-discuss] [OVS-DPDK] fail configure with dpdk lib
> 
> 
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Wang,
> Alex
> Sent: Wednesday, September 2, 2015 7:06 AM
> To: bugs at openvswitch.org; discuss at openvswitch.org
> Cc: Wang, Alex
> Subject: [ovs-discuss] [OVS-DPDK] fail configure with dpdk lib
> 
> Hi Team,
> 
> I am following INSTALL.DPDK.md and try to build a OVS environment with DPDK
> lib. But we encountered an error during compiling OVS with DPDK lib.
> Here are my steps and corresponding error info, could you please help to
> check any exception from DPDK end? Thanks a lot in advance!
> 
> 1. Configure and install DPDK2.1.0 build
> a. CONFIG_RTE_BUILD_COMBINE_LIBS=y                // to generate single lib
> file in DPDK
> b. CONFIG_RTE_LIBRTE_VHOST=y                                // to build DPDK
> with vhost lib
> c. make install T=x86_64-native-linuxapp-gcc          // build and install
> the lib
> d. here are the lib generated, please help to confirm if we missed any
> specific for OVS requirement
> 
> 
> [kt] I see you are using DPDK 2.1.0 - did you pick up the patch to enable
> DPDK 2.1.0 support in OVS?
> [kt] http://openvswitch.org/pipermail/dev/2015-September/059542.html
> [kt] The combined lib name has changed in DPDK 2.1.0, so you could be hitting
> that problem
> 
> [kt] Also at the tip of master you'll need this patch
> [kt] http://openvswitch.org/pipermail/dev/2015-September/059541.html
> 
> [kt] Assuming there is no problem with merges of these, then these are only
> temporary steps.
> 
> 
> 
> 2. try to configure and build OVS with DPDK lib involved
> a. ./boot.sh
> b. ./configure --with-dpdk=$DPDK_BUILD CFLAGS="-g -O2 -Wno-cast-
> align"            // $DPDK_BUILD is pointing to DPDK lib path
> 
> [kt] Just to confirm this should point to the dpdk build dir so it would be
> <your_path>/dpdk-2.1.0/x86_64-native-linuxapp-gcc
> 
> c. The error comes out during compiling, cannot link with dpdk.
> config.log(full log) is attached in mail, also list all the *.a files in
> $RTE_SDK/x86_64-native-linuxapp-gcc/lib/ as below. Very appreciate if you can
> figure out any mismatch in DPDK libraries for OVS.
> 
> 
> .........
> .........
> | /* end confdefs.h.  */
> | #include <rte_config.h>
> |                              #include <rte_eal.h>
> | int
> | main ()
> | {
> | int rte_argc; char ** rte_argv;
> |                              rte_eal_init(rte_argc, rte_argv);
> |   ;
> |   return 0;
> | }
> configure:18276: error: cannot link with dpdk
> 
> 
> 
> 
> Best Regards,
> Alex


From fbl at sysclose.org  Thu Sep  3 14:51:40 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Thu, 3 Sep 2015 18:51:40 -0300
Subject: [ovs-discuss] Behavior when ping "internal" bridge interface ip
 with dpdk port attached
In-Reply-To: <55DDCCE8.30502@intel.com>
References: <55DDCCE8.30502@intel.com>
Message-ID: <20150903215140.GC2349@x240.home>

On Wed, Aug 26, 2015 at 10:27:52PM +0800, Du, Fan wrote:
> After creating a user space ovs bridge, and assign an valid ip address
> after the "internal" bridge name, then add a physical interface, e.g.
> ens806f1 to the bridge. Ping the internal bridge ip address from the other
> host will work ok.

Just to be clear, the userspace doesn't provide a networking stack, so
there is no IP address, ping or arp replies. It does work because the
internal port is a TAP device so vswitchd can push data to the networking
stack in the kernel.


> But once I prevent all the packets reaching ens806f1 by iptable rules,
> Ping from the other host will not work. So my understanding is kernel
> network stack responds to the ARP request, in which case bypass ovs user
> space bridge.
> iptables -A INPUT -i ens806f1 -j DROP
> iptables -A FORWARD -i ens806f1 -j DROP
> 
> But when attaching a dpdk type port(instead of the physical interface
> like ens806f1) to the bridge,I can tcpdump ARP_REPLY from the dummy
> mirroring port, but the ARP_REPLY packet didn't reach from the other host.
> 
> So I'm puzzled, in scenario of dpdk port attached:
> a. which part of code build the ARP_REPLY packet?
> b. why the arp reply packet didn't hit on wire after setting arp with
>    normal action flow?

You might want to look at flow and port stats to see what is going on.

fbl


From dotslash.lu at gmail.com  Fri Sep  4 08:53:01 2015
From: dotslash.lu at gmail.com (Tashi Lu)
Date: Fri, 4 Sep 2015 23:53:01 +0800
Subject: [ovs-discuss] Build issues on linux kernel version
	2.6.32-573.3.1 RHEL6
In-Reply-To: <CAEP_g=9P+z+_s3XdJ0Dh2-X2TVZ1bBJ7fhKDnN6CY0rck9+sBw@mail.gmail.com>
References: <CALrtOxpL3PKDqfgZ4rv943vtnGJsmxc4E85qfsbWbSdsAJXgRw@mail.gmail.com>
 <CAEP_g=9P+z+_s3XdJ0Dh2-X2TVZ1bBJ7fhKDnN6CY0rck9+sBw@mail.gmail.com>
Message-ID: <CALrtOxrN30Av0EXNojWQVcLJ=ZVwNr0Y0FbceYaG-a29O2nNWA@mail.gmail.com>

Hi Jesse, thanks for your reply. Building from repo eliminated the compile
error, but there are still two minor errors in the build process, I fixed
them and submitted a pull request on Github
https://github.com/openvswitch/ovs/pull/65. Hope it will help.

On 4 September 2015 at 05:39, Jesse Gross <jesse at nicira.com> wrote:

> On Thu, Sep 3, 2015 at 3:00 AM, Tashi Lu <dotslash.lu at gmail.com> wrote:
> > Hi all,
> >
> > Seems there're some issues with linux kernel version 2.6.32-573.3.1, I've
> > tried to build both ovs 2.3.2 and 2.4.0 on both CentOS 6.4 and CentOS
> 6.6,
> > all ended with errors shown below.
>
> A number of fixes for CentOS 6 were just applied to branch-2.4 in git,
> so I would recommend trying that to see if that solves the issue.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150904/e2fe8889/attachment-0001.html>

From ederick.colmenares at softtek.com  Thu Sep  3 13:37:23 2015
From: ederick.colmenares at softtek.com (=?iso-8859-1?Q?Ederick_Colmenares_S=E1nchez?=)
Date: Thu, 3 Sep 2015 20:37:23 +0000
Subject: [ovs-discuss] assertion !idl->change_seqno failed in
 ovsdb_idl_get_mode()
Message-ID: <BLUPR0201MB155303848EC78BB97B958EFA9B680@BLUPR0201MB1553.namprd02.prod.outlook.com>

Hi David.

Did you get any solution for this issue?

Regards,

Ederick Colmenares Sánchez | Ingeniero en Informática
Softtek | Paseo de las Flores | Torre de Oficinas 2do. Piso  | Heredia, Costa Rica
Telf: (506) 2560- 4430 | www.softtek.com<http://www.softtek.com/?utm_campaign=emailsignature&utm_source=email&utm_medium=email>
twitter.com/Softtek<http://twitter.com/Softtek> | linkedin.com/company/Softtek<http://www.linkedin.com/company/Softtek> | facebook.com/Softtek<http://www.facebook.com/Softtek> | feeds.feedburner.com/SofttekBlog<http://feeds.feedburner.com/SofttekBlog> | youtube.com/SofttekTV<http://www.youtube.com/SofttekTV>

IMPORTANT: The documents and files attached to this transmission contain confidential information that must be kept secret by law. This information is for the exclusive use of the specified recipient whose name appears in this transmission. If you have received this message by mistake, please notify us immediately by return e-mail and delete the file and its attachments. You are hereby notified that any dissemination, copying, distribution or adoption of any action arising from the confidential information contained herein is strictly prohibited. Any violation will be penalized by law.
IMPORTANTE: Los documentos y archivos que se acompañan a esta transmisión, contienen información confidencial la cual es legalmente secreta. Esta información puede ser usada únicamente por el destinatario cuyo nombre aparece inserto en esta transmisión. Si usted ha recibido esta transmisión por error, notifíquenos inmediatamente por esta misma vía, y borre el archivo y sus anexos. Se hace de su conocimiento por medio de esta nota, que cualquier divulgación, copia, distribución o toma de cualquier acción derivada de la información confiada en esta transmisión, queda estrictamente prohibido, el incumplimiento de esto genera responsabilidad legal.
IMPORTANTE: Os documentos e arquivos anexados a este e-mail contém informações que podem confidenciais. Esta informação é para uso exclusivo do destinatário(s) especifico(s) cujo nome(s) aparecer(em) na seção de cabeçalho do e-mail. Se você recebeu esta mensagem por engano, por favor, notifique o remetente imediatamente pelo retorno da mensagem e delete o arquivo e seus anexos. Você está sendo notificado que qualquer divulgação, cópia, distribuição ou adoção de qualquer ação decorrente da informação confidencial contida neste documento é estritamente proibido. Qualquer violação poderá ser processado por lei.

Privacy Notice<http://www.softtek.com/en/privacy-notice?utm_campaign=emailsignature&utm_source=email&utm_medium=email> | Aviso de Privacidad<http://www.softtek.com/es/aviso-privacidad?utm_campaign=emailsignature&utm_source=email&utm_medium=email> | Aviso de Privacidade<http://www.softtek.com/pt/aviso-privacidade?utm_campaign=emailsignature&utm_source=email&utm_medium=email>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150903/ca62ae27/attachment.html>

From blp at nicira.com  Fri Sep  4 11:33:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 4 Sep 2015 11:33:52 -0700
Subject: [ovs-discuss] Datapath userspace reordering
In-Reply-To: <1ED3A783-9F65-42B8-84B9-2FD61E15B574@gmail.com>
References: <1ED3A783-9F65-42B8-84B9-2FD61E15B574@gmail.com>
Message-ID: <20150904183352.GO24627@nicira.com>

On Thu, Sep 03, 2015 at 05:40:17PM +1000, Dario Banfi wrote:
> I have been trying to to create a “reordering” group that buffers TCP packets and send them out in order, but without success.
> I use the slow path for all the packets and I can get the sequence either from ctx->xin->packet or in handle_upcall() .
> 
> But how can I buffer the packets, reorder them and send them all out? Any hint on the file / function where this could implemented would be really appreciated.
> Isn’t there anywhere in the code where I can send out all the reordered packets with a loop?

The existing code doesn't ever buffer packets, so this would require
adding new concepts.

From blp at nicira.com  Fri Sep  4 11:36:15 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 4 Sep 2015 11:36:15 -0700
Subject: [ovs-discuss] How ovs support to run on VMware virtual Machine
In-Reply-To: <CAPCEwzDvijd86kYvO-cAQJCgEO+N1EPSu=6LJUTHGqZG94aQug@mail.gmail.com>
References: <CAPCEwzDvijd86kYvO-cAQJCgEO+N1EPSu=6LJUTHGqZG94aQug@mail.gmail.com>
Message-ID: <20150904183615.GP24627@nicira.com>

On Thu, Sep 03, 2015 at 04:32:23PM +0800, Hongjin Wei wrote:
> Recently, I set up my owv on two VMs which hosted on vmware vcenter managed
> cluster. The two VMs are hosted on same esxi server.
> 
> I am trying to add vlan port, but they can not reach each other in
> bi-direction.
> 
> #ovs-vsctl add-port br-ens34 test901
> #ovs-vsctl set interface test901 type=internal
> #ovs-vsctl set port test901 tag=901
> #ovs-vsctl set port test901 vlan_mode=native-untagged
> #ip set link dev test901 up
> #ip addr add 10.0.1.111/24 brd 10.0.1.255 dev test901
> 
> repeat the above on another VM which install ovs, but assign another ip
> 10.0.1.23/24
> 
> I failed to ping them each other, there is no any icmp reply message from
> the output of tcpdump.

I don't see anywhere that you added an external-facing Ethernet port to
your switch.

From jesse at nicira.com  Fri Sep  4 13:47:38 2015
From: jesse at nicira.com (Jesse Gross)
Date: Fri, 4 Sep 2015 13:47:38 -0700
Subject: [ovs-discuss] Build issues on linux kernel version
	2.6.32-573.3.1 RHEL6
In-Reply-To: <CALrtOxrN30Av0EXNojWQVcLJ=ZVwNr0Y0FbceYaG-a29O2nNWA@mail.gmail.com>
References: <CALrtOxpL3PKDqfgZ4rv943vtnGJsmxc4E85qfsbWbSdsAJXgRw@mail.gmail.com>
 <CAEP_g=9P+z+_s3XdJ0Dh2-X2TVZ1bBJ7fhKDnN6CY0rck9+sBw@mail.gmail.com>
 <CALrtOxrN30Av0EXNojWQVcLJ=ZVwNr0Y0FbceYaG-a29O2nNWA@mail.gmail.com>
Message-ID: <CAEP_g=9CLLrA=sF-ZgJWt2ya9jAzpk6AyiozFHm4x8Yhsj4E-Q@mail.gmail.com>

On Friday, September 4, 2015, Tashi Lu <dotslash.lu at gmail.com> wrote:

> Hi Jesse, thanks for your reply. Building from repo eliminated the compile
> error, but there are still two minor errors in the build process, I fixed
> them and submitted a pull request on Github
> https://github.com/openvswitch/ovs/pull/65. Hope it will help.
>

Would you mind posting them as patches to the dev mailing list? My guess is
more people will look at them at way.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150904/bacce48f/attachment.html>

From s.hesam.ghasemi at gmail.com  Sat Sep  5 08:53:21 2015
From: s.hesam.ghasemi at gmail.com (Seyyed Hesamoddin Ghasemi)
Date: Sat, 5 Sep 2015 20:23:21 +0430
Subject: [ovs-discuss] add/sub a constant value to tcp sequence number and
	ack number in ovs
Message-ID: <CAOsSsa7ozZmSGSO_wkY+KL4y-X0Cy-_SLQ3D=hFgJTouFV-yxQ@mail.gmail.com>

Hi every body,
I need to develop a proxy, and for this I should add/sub a constant value
to sequence number and ack number in ovs, Could somebody please help me?

-- 
Seyyed Hesamoddin Ghasemi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150905/b943ac2b/attachment.html>

From jpettit at nicira.com  Sat Sep  5 10:49:20 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Sat, 5 Sep 2015 10:49:20 -0700
Subject: [ovs-discuss] add/sub a constant value to tcp sequence number
	and ack number in ovs
In-Reply-To: <CAOsSsa7ozZmSGSO_wkY+KL4y-X0Cy-_SLQ3D=hFgJTouFV-yxQ@mail.gmail.com>
References: <CAOsSsa7ozZmSGSO_wkY+KL4y-X0Cy-_SLQ3D=hFgJTouFV-yxQ@mail.gmail.com>
Message-ID: <3A44FEDB-631F-4DBA-8DB1-30C12C7864B3@nicira.com>


> On Sep 5, 2015, at 8:53 AM, Seyyed Hesamoddin Ghasemi <s.hesam.ghasemi at gmail.com> wrote:
> 
> Hi every body, 
> I need to develop a proxy, and for this I should add/sub a constant value to sequence number and ack number in ovs, Could somebody please help me?

OVS doesn't provide any visibility into the sequence numbers of TCP packets.

--Justin



From ambigioz at gmail.com  Sun Sep  6 16:58:19 2015
From: ambigioz at gmail.com (Dario Banfi)
Date: Mon, 7 Sep 2015 09:58:19 +1000
Subject: [ovs-discuss] Datapath userspace reordering
In-Reply-To: <20150904183352.GO24627@nicira.com>
References: <1ED3A783-9F65-42B8-84B9-2FD61E15B574@gmail.com>
 <20150904183352.GO24627@nicira.com>
Message-ID: <EE08FB40-93AB-470F-BA99-E908F1133DC6@gmail.com>

Hi, thanks so much for the response!

Could you help me understand what goes on in openvswitch in the ofproto-dpif-xlate.c?
When I set SLOW_ACTION for the context and I try to log in all the ctx->xin->packet I get alternatively one packet and one other “packet” I cannot parse..
On the contrary, If I try to log all the packets in odp_execute_actions.c I get what I expect.
If I were to modify the packets going through a group, how could I do it? Changing the xin->packet didn’t seem to work.

> On Sep 5, 2015, at 04:33, Ben Pfaff <blp at nicira.com> wrote:
> 
> On Thu, Sep 03, 2015 at 05:40:17PM +1000, Dario Banfi wrote:
>> I have been trying to to create a “reordering” group that buffers TCP packets and send them out in order, but without success.
>> I use the slow path for all the packets and I can get the sequence either from ctx->xin->packet or in handle_upcall() .
>> 
>> But how can I buffer the packets, reorder them and send them all out? Any hint on the file / function where this could implemented would be really appreciated.
>> Isn’t there anywhere in the code where I can send out all the reordered packets with a loop?
> 
> The existing code doesn't ever buffer packets, so this would require
> adding new concepts.


From xiaolia at cisco.com  Mon Sep  7 01:00:13 2015
From: xiaolia at cisco.com (Xiao Liang (xiaolia))
Date: Mon, 7 Sep 2015 08:00:13 +0000
Subject: [ovs-discuss] Forward VxLAN packets in network namespace?
Message-ID: <d24d8bbd3aab4d4ea7dd1e1f8f9252d4@XCH-RCD-014.cisco.com>

Hi,

The problem is that I want to add a VxLAN port to OVS bridge and let the tunnel packets be routed in a particular netns.

In VxLAN vport code I found that the namespace of the tunnel sock is inherited from dp. I could add a dp by "ip netns exec ns1 ovs-dpctl add-dp br1", but how can I use it then? I've also tried "ip netns exec ns1 ovs-vsctl add-br br1" and "ip link set br1 netns ns1", but seems not work.

How can I do this? Thanks in advance.

Regards,
Xiao

From elad.yosef at gmail.com  Mon Sep  7 02:57:52 2015
From: elad.yosef at gmail.com (Elad Yosef)
Date: Mon, 7 Sep 2015 12:57:52 +0300
Subject: [ovs-discuss] Who is attending the OpenStack summit in Tokyo?
Message-ID: <CAOFa9c0UNr7U4Gw5PE8sm7xvFk4gazxPuB7iaoP6ur_43hOY3w@mail.gmail.com>

I want to have a small talk about forking the OVS with DPDK to accelerate
the Nuage sulotion
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/1f991b10/attachment.html>

From jesse at nicira.com  Mon Sep  7 06:55:28 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 7 Sep 2015 06:55:28 -0700
Subject: [ovs-discuss] Forward VxLAN packets in network namespace?
In-Reply-To: <d24d8bbd3aab4d4ea7dd1e1f8f9252d4@XCH-RCD-014.cisco.com>
References: <d24d8bbd3aab4d4ea7dd1e1f8f9252d4@XCH-RCD-014.cisco.com>
Message-ID: <CAEP_g=_67KqnVbHxhSUnzMNO0AtofTacOEomNqn-MxX0Gwgfmw@mail.gmail.com>

On Monday, September 7, 2015, Xiao Liang (xiaolia) <xiaolia at cisco.com>
wrote:

> Hi,
>
> The problem is that I want to add a VxLAN port to OVS bridge and let the
> tunnel packets be routed in a particular netns.
>
> In VxLAN vport code I found that the namespace of the tunnel sock is
> inherited from dp. I could add a dp by "ip netns exec ns1 ovs-dpctl add-dp
> br1", but how can I use it then? I've also tried "ip netns exec ns1
> ovs-vsctl add-br br1" and "ip link set br1 netns ns1", but seems not work.
>

You can only change the namespace of OVS as whole. To do that you, you
should start ovs-vswitchd in that namespace. If you want to route tunnel
packets to a different namespace, you'll have to do that through the
routing table.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/66f7e058/attachment.html>

From blp at nicira.com  Mon Sep  7 10:18:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 7 Sep 2015 10:18:51 -0700
Subject: [ovs-discuss] Datapath userspace reordering
In-Reply-To: <EE08FB40-93AB-470F-BA99-E908F1133DC6@gmail.com>
References: <1ED3A783-9F65-42B8-84B9-2FD61E15B574@gmail.com>
 <20150904183352.GO24627@nicira.com>
 <EE08FB40-93AB-470F-BA99-E908F1133DC6@gmail.com>
Message-ID: <20150907171851.GC22722@nicira.com>

On Mon, Sep 07, 2015 at 09:58:19AM +1000, Dario Banfi wrote:
> Could you help me understand what goes on in openvswitch in the ofproto-dpif-xlate.c?
> When I set SLOW_ACTION for the context and I try to log in all the ctx->xin->packet I get alternatively one packet and one other “packet” I cannot parse..
> On the contrary, If I try to log all the packets in odp_execute_actions.c I get what I expect.
> If I were to modify the packets going through a group, how could I do it? Changing the xin->packet didn’t seem to work.

The main goal of translation is to come up with a set of datapath
actions that can implement the OpenFlow actions.  The packet is supplied
in case it contains needed information not in the flow, but it's not the
focus of translation.  Thus, the usual way to modify a packet would be
to implement a new datapath action and then add that action to the set
of datapath actions at translation time.

The translations of flows without packets that you're seeing are part of
"revalidation", which is used to check that the cache is still accurate.

From mortazavi at ualberta.ca  Mon Sep  7 15:36:46 2015
From: mortazavi at ualberta.ca (Seyed Hossein Mortazavi)
Date: Mon, 7 Sep 2015 18:36:46 -0400
Subject: [ovs-discuss] MPLS push - OVS 2.4
Message-ID: <CAFZP9CHkQrXb38+ZjsDNuL-OXWRCaOaLUiUUBQFyxiofLPZXLA@mail.gmail.com>

Hi,

I'm running OVS 2.4 on Ubuntu 14.04 with Kernel 3.11.

I'm trying to add MPLS headers (and then pop them) to IP packets. My
topology looks like:
h1---s1---s2---s3---h2

I've statically already configured the switches such that they would have
rules for ARP installed.

However adding the rule:

add-flow s1
"in_port=1,dl_type=0x0800,dl_src=26:95:84:d0:54:56,dl_dst=26:95:84:d0:54:56,actions=push_mpls:0x8847,set_mpls_label:10,output:2"

Doesn't seem to work (both for Openflow 1.3 and Openflow 1.0). Packets do
not get to s2.

Does anyone know how I can do so?

based on the FAQ,

"Open vSwitch version 2.4 can match, push, or pop up to 3 MPLS labels and
look past the MPLS label into the encapsulated packet. It will have kernel
support for MPLS, yielding improved performance."
<https://github.com/openvswitch/ovs/blob/master/FAQ.md#q-im-getting-error-type-45250-code-0--whats-that>

-- 
Hossein
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/6e572126/attachment.html>

From sbezverk at cisco.com  Mon Sep  7 16:28:53 2015
From: sbezverk at cisco.com (Serguei Bezverkhi (sbezverk))
Date: Mon, 7 Sep 2015 23:28:53 +0000
Subject: [ovs-discuss] MPLS push - OVS 2.4
In-Reply-To: <CAFZP9CHkQrXb38+ZjsDNuL-OXWRCaOaLUiUUBQFyxiofLPZXLA@mail.gmail.com>
References: <CAFZP9CHkQrXb38+ZjsDNuL-OXWRCaOaLUiUUBQFyxiofLPZXLA@mail.gmail.com>
Message-ID: <EDCEC56DA1E05E428B0B5FBB4D07139216D74034@xmb-rcd-x06.cisco.com>

Hi Seyed,

Shouldn’t you use packet type 0x8847 instead of 0x0800 in your layer 2 to identify to your higher layer that it is MPLS packet?? I have never tried it but it seems logical.

Thank you

Serguei

[http://www.cisco.com/c/dam/assets/email-signature-tool/logo_07.png?ct=1423747865775]

Serguei Bezverkhi,
TECHNICAL LEADER.SERVICES
Global SP Services
sbezverk at cisco.com<mailto:sbezverk at cisco.com>
Phone: +1 416 306 7312
Mobile: +1 514 234 7374

CCIE (R&S,SP,Sec) - #9527


Cisco.com<http://www.cisco.com/>



[http://www.cisco.com/assets/swa/img/thinkbeforeyouprint.gif] Think before you print.

This email may contain confidential and privileged material for the sole use of the intended recipient. Any review, use, distribution or disclosure by others is strictly prohibited. If you are not the intended recipient (or authorized to receive for the recipient), please contact the sender by reply email and delete all copies of this message.
Please click here<http://www.cisco.com/web/about/doing_business/legal/cri/index.html> for Company Registration Information.



From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Seyed Hossein Mortazavi
Sent: Monday, September 07, 2015 6:37 PM
To: discuss at openvswitch.org
Subject: [ovs-discuss] MPLS push - OVS 2.4

Hi,

I'm running OVS 2.4 on Ubuntu 14.04 with Kernel 3.11.

I'm trying to add MPLS headers (and then pop them) to IP packets. My topology looks like:
h1---s1---s2---s3---h2

I've statically already configured the switches such that they would have rules for ARP installed.

However adding the rule:

add-flow s1 "in_port=1,dl_type=0x0800,dl_src=26:95:84:d0:54:56,dl_dst=26:95:84:d0:54:56,actions=push_mpls:0x8847,set_mpls_label:10,output:2"

Doesn't seem to work (both for Openflow 1.3 and Openflow 1.0). Packets do not get to s2.

Does anyone know how I can do so?

based on the FAQ,

"Open vSwitch version 2.4 can match, push, or pop up to 3 MPLS labels and look past the MPLS label into the encapsulated packet. It will have kernel support for MPLS, yielding improved performance."

--
Hossein
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/fe38ad03/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 2629 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/fe38ad03/attachment-0001.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.gif
Type: image/gif
Size: 134 bytes
Desc: image002.gif
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/fe38ad03/attachment-0001.gif>

From xiaolia at cisco.com  Mon Sep  7 19:02:44 2015
From: xiaolia at cisco.com (Xiao Liang (xiaolia))
Date: Tue, 8 Sep 2015 02:02:44 +0000
Subject: [ovs-discuss] Forward VxLAN packets in network namespace?
In-Reply-To: <CAEP_g=_67KqnVbHxhSUnzMNO0AtofTacOEomNqn-MxX0Gwgfmw@mail.gmail.com>
References: <d24d8bbd3aab4d4ea7dd1e1f8f9252d4@XCH-RCD-014.cisco.com>
 <CAEP_g=_67KqnVbHxhSUnzMNO0AtofTacOEomNqn-MxX0Gwgfmw@mail.gmail.com>
Message-ID: <30b5425428db40c7b95c62093b9eb5f0@XCH-RCD-014.cisco.com>


> -----Original Message-----
> From: Jesse Gross [mailto:jesse at nicira.com]
> Sent: Monday, September 07, 2015 21:55
> To: Xiao Liang (xiaolia)
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Forward VxLAN packets in network namespace?
> 
> On Monday, September 7, 2015, Xiao Liang (xiaolia) <xiaolia at cisco.com>
> wrote:
> 
> 
> 	Hi,
> 
> 	The problem is that I want to add a VxLAN port to OVS bridge and let
> the tunnel packets be routed in a particular netns.
> 
> 	In VxLAN vport code I found that the namespace of the tunnel sock is
> inherited from dp. I could add a dp by "ip netns exec ns1 ovs-dpctl add-dp
> br1", but how can I use it then? I've also tried "ip netns exec ns1 ovs-vsctl
> add-br br1" and "ip link set br1 netns ns1", but seems not work.
> 
> 
> 
> You can only change the namespace of OVS as whole. To do that you, you
> should start ovs-vswitchd in that namespace. If you want to route tunnel
> packets to a different namespace, you'll have to do that through the routing
> table.

Thanks! If I start multiple ovs-vswitchd each in a different namespace, need I also start multiple ovsdb?


From mortazavi at ualberta.ca  Mon Sep  7 20:04:02 2015
From: mortazavi at ualberta.ca (Seyed Hossein Mortazavi)
Date: Mon, 7 Sep 2015 23:04:02 -0400
Subject: [ovs-discuss] MPLS push - OVS 2.4
In-Reply-To: <EDCEC56DA1E05E428B0B5FBB4D07139216D74034@xmb-rcd-x06.cisco.com>
References: <CAFZP9CHkQrXb38+ZjsDNuL-OXWRCaOaLUiUUBQFyxiofLPZXLA@mail.gmail.com>
 <EDCEC56DA1E05E428B0B5FBB4D07139216D74034@xmb-rcd-x06.cisco.com>
Message-ID: <CAFZP9CHEXPi=LB6O2BnYjdZ2HfO=aCTapZBadfc=+4dzn0zoQg@mail.gmail.com>

Hi Serguei,

The Match is on IPv4 packets (type 0x800) and the action is to add a MPLS
header to the packet. I'm pinging from h1 to h2 so the first packet that
reaches s1 has a Ethernet header and a IPv4 header. The output should be
the same packet with a MPLS header between the IP and Eth headers. However
the packet simply disappears.

On Mon, Sep 7, 2015 at 7:28 PM, Serguei Bezverkhi (sbezverk) <
sbezverk at cisco.com> wrote:

> Hi Seyed,
>
>
>
> Shouldn’t you use packet type 0x8847 instead of 0x0800 in your layer 2 to
> identify to your higher layer that it is MPLS packet?? I have never tried
> it but it seems logical.
>
>
>
> Thank you
>
>
>
> Serguei
>
>
>
> [image:
> http://www.cisco.com/c/dam/assets/email-signature-tool/logo_07.png?ct=1423747865775]
>
> *Serguei Bezverkhi,*
> TECHNICAL LEADER.SERVICES
> Global SP Services
> sbezverk at cisco.com
> Phone: *+1 416 306 7312 <%2B1%20416%20306%207312>*
> Mobile: *+1 514 234 7374 <%2B1%20514%20234%207374>*
>
> CCIE (R&S,SP,Sec) - #9527
>
>
> Cisco.com <http://www.cisco.com/>
>
>
>
> [image: http://www.cisco.com/assets/swa/img/thinkbeforeyouprint.gif] Think
> before you print.
>
> This email may contain confidential and privileged material for the sole
> use of the intended recipient. Any review, use, distribution or disclosure
> by others is strictly prohibited. If you are not the intended recipient (or
> authorized to receive for the recipient), please contact the sender by
> reply email and delete all copies of this message.
>
> Please click here
> <http://www.cisco.com/web/about/doing_business/legal/cri/index.html> for
> Company Registration Information.
>
>
>
>
>
> *From:* discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of *Seyed
> Hossein Mortazavi
> *Sent:* Monday, September 07, 2015 6:37 PM
> *To:* discuss at openvswitch.org
> *Subject:* [ovs-discuss] MPLS push - OVS 2.4
>
>
>
> Hi,
>
>
>
> I'm running OVS 2.4 on Ubuntu 14.04 with Kernel 3.11.
>
>
>
> I'm trying to add MPLS headers (and then pop them) to IP packets. My
> topology looks like:
>
> h1---s1---s2---s3---h2
>
>
>
> I've statically already configured the switches such that they would have
> rules for ARP installed.
>
>
>
> However adding the rule:
>
>
>
> add-flow s1
> "in_port=1,dl_type=0x0800,dl_src=26:95:84:d0:54:56,dl_dst=26:95:84:d0:54:56,actions=push_mpls:0x8847,set_mpls_label:10,output:2"
>
>
>
> Doesn't seem to work (both for Openflow 1.3 and Openflow 1.0). Packets do
> not get to s2.
>
>
>
> Does anyone know how I can do so?
>
>
>
> based on the FAQ,
>
> "Open vSwitch version 2.4 can match, push, or pop up to 3 MPLS labels and
> look past the MPLS label into the encapsulated packet. It will have kernel
> support for MPLS, yielding improved performance."
>
>
>
> --
>
> Hossein
>



-- 
Seyed Hossein Mortazavi

Computer Science MS Student,
University of Alberta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/0af4d480/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.gif
Type: image/gif
Size: 134 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/0af4d480/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 2629 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/0af4d480/attachment.png>

From jesse at nicira.com  Mon Sep  7 23:36:53 2015
From: jesse at nicira.com (Jesse Gross)
Date: Mon, 7 Sep 2015 23:36:53 -0700
Subject: [ovs-discuss] Forward VxLAN packets in network namespace?
In-Reply-To: <30b5425428db40c7b95c62093b9eb5f0@XCH-RCD-014.cisco.com>
References: <d24d8bbd3aab4d4ea7dd1e1f8f9252d4@XCH-RCD-014.cisco.com>
 <CAEP_g=_67KqnVbHxhSUnzMNO0AtofTacOEomNqn-MxX0Gwgfmw@mail.gmail.com>
 <30b5425428db40c7b95c62093b9eb5f0@XCH-RCD-014.cisco.com>
Message-ID: <CAEP_g=9p0BWBA58B8tmWE+UT9Sb4uxr-jmAAGtiSYTBtQQmS0w@mail.gmail.com>

On Monday, September 7, 2015, Xiao Liang (xiaolia) <xiaolia at cisco.com>
wrote:

>
> > -----Original Message-----
> > From: Jesse Gross [mailto:jesse at nicira.com <javascript:;>]
> > Sent: Monday, September 07, 2015 21:55
> > To: Xiao Liang (xiaolia)
> > Cc: discuss at openvswitch.org <javascript:;>
> > Subject: Re: [ovs-discuss] Forward VxLAN packets in network namespace?
> >
> > On Monday, September 7, 2015, Xiao Liang (xiaolia) <xiaolia at cisco.com
> <javascript:;>>
> > wrote:
> >
> >
> >       Hi,
> >
> >       The problem is that I want to add a VxLAN port to OVS bridge and
> let
> > the tunnel packets be routed in a particular netns.
> >
> >       In VxLAN vport code I found that the namespace of the tunnel sock
> is
> > inherited from dp. I could add a dp by "ip netns exec ns1 ovs-dpctl
> add-dp
> > br1", but how can I use it then? I've also tried "ip netns exec ns1
> ovs-vsctl
> > add-br br1" and "ip link set br1 netns ns1", but seems not work.
> >
> >
> >
> > You can only change the namespace of OVS as whole. To do that you, you
> > should start ovs-vswitchd in that namespace. If you want to route tunnel
> > packets to a different namespace, you'll have to do that through the
> routing
> > table.
>
> Thanks! If I start multiple ovs-vswitchd each in a different namespace,
> need I also start multiple ovsdb?
>
>
Yes, since they are operating as independent switches.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150907/3d552b2a/attachment-0001.html>

From xiaolia at cisco.com  Tue Sep  8 02:16:10 2015
From: xiaolia at cisco.com (Xiao Liang (xiaolia))
Date: Tue, 8 Sep 2015 09:16:10 +0000
Subject: [ovs-discuss] Forward VxLAN packets in network namespace?
In-Reply-To: <CAEP_g=9p0BWBA58B8tmWE+UT9Sb4uxr-jmAAGtiSYTBtQQmS0w@mail.gmail.com>
References: <d24d8bbd3aab4d4ea7dd1e1f8f9252d4@XCH-RCD-014.cisco.com>
 <CAEP_g=_67KqnVbHxhSUnzMNO0AtofTacOEomNqn-MxX0Gwgfmw@mail.gmail.com>
 <30b5425428db40c7b95c62093b9eb5f0@XCH-RCD-014.cisco.com>
 <CAEP_g=9p0BWBA58B8tmWE+UT9Sb4uxr-jmAAGtiSYTBtQQmS0w@mail.gmail.com>
Message-ID: <8dcf29d6d49a417c9df2c8417cb9f447@XCH-RCD-014.cisco.com>

It works now. Thanks a lot.

> -----Original Message-----
> From: Jesse Gross [mailto:jesse at nicira.com] 
> Sent: Tuesday, September 08, 2015 14:37
> To: Xiao Liang (xiaolia)
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Forward VxLAN packets in network namespace?
>
> On Monday, September 7, 2015, Xiao Liang (xiaolia) <xiaolia at cisco.com> wrote:
>
> > -----Original Message-----
> > From: Jesse Gross [mailto:jesse at nicira.com]
> > Sent: Monday, September 07, 2015 21:55
> > To: Xiao Liang (xiaolia)
> > Cc: discuss at openvswitch.org
> > Subject: Re: [ovs-discuss] Forward VxLAN packets in network namespace?
> >
> > On Monday, September 7, 2015, Xiao Liang (xiaolia) <xiaolia at cisco.com>
> > wrote:
> >
> >
> >       Hi,
> >
> >       The problem is that I want to add a VxLAN port to OVS bridge and let
> > the tunnel packets be routed in a particular netns.
> >
> >       In VxLAN vport code I found that the namespace of the tunnel sock is
> > inherited from dp. I could add a dp by "ip netns exec ns1 ovs-dpctl add-dp
> > br1", but how can I use it then? I've also tried "ip netns exec ns1 ovs-vsctl
> > add-br br1" and "ip link set br1 netns ns1", but seems not work.
> >
> >
> >
> > You can only change the namespace of OVS as whole. To do that you, you
> > should start ovs-vswitchd in that namespace. If you want to route tunnel
> > packets to a different namespace, you'll have to do that through the routing
> > table.
>
> Thanks! If I start multiple ovs-vswitchd each in a different namespace, need I also start multiple ovsdb?
> 
> Yes, since they are operating as independent switches.

From abhishekv.verma at gmail.com  Tue Sep  8 07:23:57 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Tue, 8 Sep 2015 19:53:57 +0530
Subject: [ovs-discuss] Docker and OVS
Message-ID: <CADDmorSTT1kzs2bZX528oAqn5YNFUEn0o5fXXeh1S0UTBmhawQ@mail.gmail.com>

Hi,

Can i use OVS to connect two docker containers? Is there some work
happening in that direction?

Thanks, Abhishek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150908/0668b4f4/attachment.html>

From shettyg at nicira.com  Tue Sep  8 07:34:04 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 8 Sep 2015 07:34:04 -0700
Subject: [ovs-discuss] Docker and OVS
In-Reply-To: <CADDmorSTT1kzs2bZX528oAqn5YNFUEn0o5fXXeh1S0UTBmhawQ@mail.gmail.com>
References: <CADDmorSTT1kzs2bZX528oAqn5YNFUEn0o5fXXeh1S0UTBmhawQ@mail.gmail.com>
Message-ID: <CAHbON5oxAZ4eLCE-GV32Jpfd7CKU9eA4d9Dj49PKsRg_SheQEQ@mail.gmail.com>

If you want to use OVS with Docker's released versions without a
control plane, you will have to use something like this:
https://github.com/openvswitch/ovs/blob/master/utilities/ovs-docker

If you want to use OVS with Docker's libnetwork (which is still
experimental and the api's will likely change based on this week's
discussions around ipam), there is work going on to provide OVN as the
control plane.

On Tue, Sep 8, 2015 at 7:23 AM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Hi,
>
> Can i use OVS to connect two docker containers? Is there some work happening
> in that direction?
>
> Thanks, Abhishek
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From shettyg at nicira.com  Tue Sep  8 07:39:08 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 8 Sep 2015 07:39:08 -0700
Subject: [ovs-discuss] Docker and OVS
In-Reply-To: <CADDmorTNiyXsAmqudL8QvbTooBMXs89SyE92gxjWfyTS+eQSuQ@mail.gmail.com>
References: <CADDmorSTT1kzs2bZX528oAqn5YNFUEn0o5fXXeh1S0UTBmhawQ@mail.gmail.com>
 <CAHbON5oxAZ4eLCE-GV32Jpfd7CKU9eA4d9Dj49PKsRg_SheQEQ@mail.gmail.com>
 <CADDmorTNiyXsAmqudL8QvbTooBMXs89SyE92gxjWfyTS+eQSuQ@mail.gmail.com>
Message-ID: <CAHbON5pK=BdPjPwwyYmQ4k6SKF3jb_Rw1xqX+vAX=331Y_-UHw@mail.gmail.com>

On Tue, Sep 8, 2015 at 7:37 AM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Hi Guru,
>
> Thanks for this.
>
> Does this mean that i can run OVS inside docker containers and can they then
> communicate with each other? So if i am running 2 docker containers on the
> same host then will i then be running two OVS instances -- one inside each
> container?

No. I did not mean to say that. You can run OVS outside docker
containers and have OVS/OVN provide networking.


>
> Cheers, Abhishek
>
> On Tue, Sep 8, 2015 at 8:04 PM, Gurucharan Shetty <shettyg at nicira.com>
> wrote:
>>
>> If you want to use OVS with Docker's released versions without a
>> control plane, you will have to use something like this:
>> https://github.com/openvswitch/ovs/blob/master/utilities/ovs-docker
>>
>> If you want to use OVS with Docker's libnetwork (which is still
>> experimental and the api's will likely change based on this week's
>> discussions around ipam), there is work going on to provide OVN as the
>> control plane.
>>
>> On Tue, Sep 8, 2015 at 7:23 AM, Abhishek Verma
>> <abhishekv.verma at gmail.com> wrote:
>> > Hi,
>> >
>> > Can i use OVS to connect two docker containers? Is there some work
>> > happening
>> > in that direction?
>> >
>> > Thanks, Abhishek
>> >
>> > _______________________________________________
>> > discuss mailing list
>> > discuss at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/discuss
>> >
>
>

From abhishekv.verma at gmail.com  Tue Sep  8 07:41:47 2015
From: abhishekv.verma at gmail.com (Abhishek Verma)
Date: Tue, 8 Sep 2015 20:11:47 +0530
Subject: [ovs-discuss] Docker and OVS
In-Reply-To: <CAHbON5pK=BdPjPwwyYmQ4k6SKF3jb_Rw1xqX+vAX=331Y_-UHw@mail.gmail.com>
References: <CADDmorSTT1kzs2bZX528oAqn5YNFUEn0o5fXXeh1S0UTBmhawQ@mail.gmail.com>
 <CAHbON5oxAZ4eLCE-GV32Jpfd7CKU9eA4d9Dj49PKsRg_SheQEQ@mail.gmail.com>
 <CADDmorTNiyXsAmqudL8QvbTooBMXs89SyE92gxjWfyTS+eQSuQ@mail.gmail.com>
 <CAHbON5pK=BdPjPwwyYmQ4k6SKF3jb_Rw1xqX+vAX=331Y_-UHw@mail.gmail.com>
Message-ID: <CADDmorT4_=TactQ+H+PQgk_xB1wOeAocVxf3CfL+mwzH_hNtgw@mail.gmail.com>

Great. Then i can have virtual ports added to OVS that can be tied to
specific docker instances. Is this correct?

Thanks, Abhishek

On Tue, Sep 8, 2015 at 8:09 PM, Gurucharan Shetty <shettyg at nicira.com>
wrote:

> On Tue, Sep 8, 2015 at 7:37 AM, Abhishek Verma
> <abhishekv.verma at gmail.com> wrote:
> > Hi Guru,
> >
> > Thanks for this.
> >
> > Does this mean that i can run OVS inside docker containers and can they
> then
> > communicate with each other? So if i am running 2 docker containers on
> the
> > same host then will i then be running two OVS instances -- one inside
> each
> > container?
>
> No. I did not mean to say that. You can run OVS outside docker
> containers and have OVS/OVN provide networking.
>
>
> >
> > Cheers, Abhishek
> >
> > On Tue, Sep 8, 2015 at 8:04 PM, Gurucharan Shetty <shettyg at nicira.com>
> > wrote:
> >>
> >> If you want to use OVS with Docker's released versions without a
> >> control plane, you will have to use something like this:
> >> https://github.com/openvswitch/ovs/blob/master/utilities/ovs-docker
> >>
> >> If you want to use OVS with Docker's libnetwork (which is still
> >> experimental and the api's will likely change based on this week's
> >> discussions around ipam), there is work going on to provide OVN as the
> >> control plane.
> >>
> >> On Tue, Sep 8, 2015 at 7:23 AM, Abhishek Verma
> >> <abhishekv.verma at gmail.com> wrote:
> >> > Hi,
> >> >
> >> > Can i use OVS to connect two docker containers? Is there some work
> >> > happening
> >> > in that direction?
> >> >
> >> > Thanks, Abhishek
> >> >
> >> > _______________________________________________
> >> > discuss mailing list
> >> > discuss at openvswitch.org
> >> > http://openvswitch.org/mailman/listinfo/discuss
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150908/bd2128bf/attachment-0001.html>

From shettyg at nicira.com  Tue Sep  8 07:53:21 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 8 Sep 2015 07:53:21 -0700
Subject: [ovs-discuss] Docker and OVS
In-Reply-To: <CADDmorT4_=TactQ+H+PQgk_xB1wOeAocVxf3CfL+mwzH_hNtgw@mail.gmail.com>
References: <CADDmorSTT1kzs2bZX528oAqn5YNFUEn0o5fXXeh1S0UTBmhawQ@mail.gmail.com>
 <CAHbON5oxAZ4eLCE-GV32Jpfd7CKU9eA4d9Dj49PKsRg_SheQEQ@mail.gmail.com>
 <CADDmorTNiyXsAmqudL8QvbTooBMXs89SyE92gxjWfyTS+eQSuQ@mail.gmail.com>
 <CAHbON5pK=BdPjPwwyYmQ4k6SKF3jb_Rw1xqX+vAX=331Y_-UHw@mail.gmail.com>
 <CADDmorT4_=TactQ+H+PQgk_xB1wOeAocVxf3CfL+mwzH_hNtgw@mail.gmail.com>
Message-ID: <CAHbON5pL9Kb+iy6HA6ti4qhP=HGZNKyUfx+5S8uaXqJyQORBKg@mail.gmail.com>

Yes.

On Tue, Sep 8, 2015 at 7:41 AM, Abhishek Verma
<abhishekv.verma at gmail.com> wrote:
> Great. Then i can have virtual ports added to OVS that can be tied to
> specific docker instances. Is this correct?
>
> Thanks, Abhishek
>
> On Tue, Sep 8, 2015 at 8:09 PM, Gurucharan Shetty <shettyg at nicira.com>
> wrote:
>>
>> On Tue, Sep 8, 2015 at 7:37 AM, Abhishek Verma
>> <abhishekv.verma at gmail.com> wrote:
>> > Hi Guru,
>> >
>> > Thanks for this.
>> >
>> > Does this mean that i can run OVS inside docker containers and can they
>> > then
>> > communicate with each other? So if i am running 2 docker containers on
>> > the
>> > same host then will i then be running two OVS instances -- one inside
>> > each
>> > container?
>>
>> No. I did not mean to say that. You can run OVS outside docker
>> containers and have OVS/OVN provide networking.
>>
>>
>> >
>> > Cheers, Abhishek
>> >
>> > On Tue, Sep 8, 2015 at 8:04 PM, Gurucharan Shetty <shettyg at nicira.com>
>> > wrote:
>> >>
>> >> If you want to use OVS with Docker's released versions without a
>> >> control plane, you will have to use something like this:
>> >> https://github.com/openvswitch/ovs/blob/master/utilities/ovs-docker
>> >>
>> >> If you want to use OVS with Docker's libnetwork (which is still
>> >> experimental and the api's will likely change based on this week's
>> >> discussions around ipam), there is work going on to provide OVN as the
>> >> control plane.
>> >>
>> >> On Tue, Sep 8, 2015 at 7:23 AM, Abhishek Verma
>> >> <abhishekv.verma at gmail.com> wrote:
>> >> > Hi,
>> >> >
>> >> > Can i use OVS to connect two docker containers? Is there some work
>> >> > happening
>> >> > in that direction?
>> >> >
>> >> > Thanks, Abhishek
>> >> >
>> >> > _______________________________________________
>> >> > discuss mailing list
>> >> > discuss at openvswitch.org
>> >> > http://openvswitch.org/mailman/listinfo/discuss
>> >> >
>> >
>> >
>
>

From joestringer at nicira.com  Tue Sep  8 10:20:45 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Tue, 8 Sep 2015 10:20:45 -0700
Subject: [ovs-discuss] MPLS push - OVS 2.4
In-Reply-To: <CAFZP9CHkQrXb38+ZjsDNuL-OXWRCaOaLUiUUBQFyxiofLPZXLA@mail.gmail.com>
References: <CAFZP9CHkQrXb38+ZjsDNuL-OXWRCaOaLUiUUBQFyxiofLPZXLA@mail.gmail.com>
Message-ID: <CANr6G5wuSYhvyLh8MZvK9vbUm2Oc9nnEq9wZNBjc7bf_dfV=KA@mail.gmail.com>

Are you using the openvswitch DKMS module that comes with OVS-2.4 or
the openvswitch module that comes with Linux-3.11?

On 7 September 2015 at 15:36, Seyed Hossein Mortazavi
<mortazavi at ualberta.ca> wrote:
> Hi,
>
> I'm running OVS 2.4 on Ubuntu 14.04 with Kernel 3.11.
>
> I'm trying to add MPLS headers (and then pop them) to IP packets. My
> topology looks like:
> h1---s1---s2---s3---h2
>
> I've statically already configured the switches such that they would have
> rules for ARP installed.
>
> However adding the rule:
>
> add-flow s1
> "in_port=1,dl_type=0x0800,dl_src=26:95:84:d0:54:56,dl_dst=26:95:84:d0:54:56,actions=push_mpls:0x8847,set_mpls_label:10,output:2"
>
> Doesn't seem to work (both for Openflow 1.3 and Openflow 1.0). Packets do
> not get to s2.
>
> Does anyone know how I can do so?
>
> based on the FAQ,
>
> "Open vSwitch version 2.4 can match, push, or pop up to 3 MPLS labels and
> look past the MPLS label into the encapsulated packet. It will have kernel
> support for MPLS, yielding improved performance."
>
>
> --
> Hossein
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From matt at gns3.net  Tue Sep  8 09:44:04 2015
From: matt at gns3.net (Matt Raio)
Date: Tue, 8 Sep 2015 09:44:04 -0700
Subject: [ovs-discuss] Where is the FIB table with OpenVSwitch?
Message-ID: <CAE=8uirLicKmO=mNYpD-Evmdxq4Cdh4Oiqo=ePfhjYskuXrLmA@mail.gmail.com>

Also, can we move the FIB table to another drive?

Where can I modify the default settings to point to the new drive?


Here is what I want to do:

create a raw disk file using QEmu.

Add that disk to the vm that is running TinyCoreOS.

Then manipulate the default settings in OpenVSwitch to point to that new
disk.

Thanks!

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150908/d3a73003/attachment.html>

From jpettit at nicira.com  Tue Sep  8 11:11:28 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 8 Sep 2015 11:11:28 -0700
Subject: [ovs-discuss] Where is the FIB table with OpenVSwitch?
In-Reply-To: <CAE=8uirLicKmO=mNYpD-Evmdxq4Cdh4Oiqo=ePfhjYskuXrLmA@mail.gmail.com>
References: <CAE=8uirLicKmO=mNYpD-Evmdxq4Cdh4Oiqo=ePfhjYskuXrLmA@mail.gmail.com>
Message-ID: <643EA726-CA52-447B-8BBA-33D22F3093AC@nicira.com>


> On Sep 8, 2015, at 9:44 AM, Matt Raio <matt at gns3.net> wrote:
> 
> Also, can we move the FIB table to another drive? 
> 
> Where can I modify the default settings to point to the new drive?
> 
> 
> Here is what I want to do:
> 
> create a raw disk file using QEmu. 
> 
> Add that disk to the vm that is running TinyCoreOS. 
> 
> Then manipulate the default settings in OpenVSwitch to point to that new disk.

The FIB table is in memory and not stored on disk.

--Justin



From matt at gns3.net  Tue Sep  8 12:20:23 2015
From: matt at gns3.net (Matt Raio)
Date: Tue, 8 Sep 2015 12:20:23 -0700
Subject: [ovs-discuss] Where is the FIB table with OpenVSwitch?
In-Reply-To: <643EA726-CA52-447B-8BBA-33D22F3093AC@nicira.com>
References: <CAE=8uirLicKmO=mNYpD-Evmdxq4Cdh4Oiqo=ePfhjYskuXrLmA@mail.gmail.com>
 <643EA726-CA52-447B-8BBA-33D22F3093AC@nicira.com>
Message-ID: <CAE=8uiowp_19q8rWrmLfVNEvRO-ySSStxhVVdiXpozjPOKF5DQ@mail.gmail.com>

Thanks Justin for the quick response...

So then is there a way to have OpenVSwitch start a separate process of the
FIB on an external memory device? If I assign the external device a drive
letter, would OpenVSwitch startup a process on the external memory device
and run the FIB table there? Assuming that this external device already has
a processor and ample RAM?



On Tue, Sep 8, 2015 at 11:11 AM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Sep 8, 2015, at 9:44 AM, Matt Raio <matt at gns3.net> wrote:
> >
> > Also, can we move the FIB table to another drive?
> >
> > Where can I modify the default settings to point to the new drive?
> >
> >
> > Here is what I want to do:
> >
> > create a raw disk file using QEmu.
> >
> > Add that disk to the vm that is running TinyCoreOS.
> >
> > Then manipulate the default settings in OpenVSwitch to point to that new
> disk.
>
> The FIB table is in memory and not stored on disk.
>
> --Justin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150908/c9590142/attachment.html>

From jpettit at nicira.com  Tue Sep  8 12:34:54 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Tue, 8 Sep 2015 12:34:54 -0700
Subject: [ovs-discuss] Where is the FIB table with OpenVSwitch?
In-Reply-To: <CAE=8uiowp_19q8rWrmLfVNEvRO-ySSStxhVVdiXpozjPOKF5DQ@mail.gmail.com>
References: <CAE=8uirLicKmO=mNYpD-Evmdxq4Cdh4Oiqo=ePfhjYskuXrLmA@mail.gmail.com>
 <643EA726-CA52-447B-8BBA-33D22F3093AC@nicira.com>
 <CAE=8uiowp_19q8rWrmLfVNEvRO-ySSStxhVVdiXpozjPOKF5DQ@mail.gmail.com>
Message-ID: <EE6DB5E7-974C-4280-8B85-FA93498AA4E3@nicira.com>


> On Sep 8, 2015, at 12:20 PM, Matt Raio <matt at gns3.net> wrote:
> 
> Thanks Justin for the quick response...
> 
> So then is there a way to have OpenVSwitch start a separate process of the FIB on an external memory device? If I assign the external device a drive letter, would OpenVSwitch startup a process on the external memory device and run the FIB table there? Assuming that this external device already has a processor and ample RAM?

I don't understand what you're trying to accomplish.  The FIB is dynamically created by OVS as it's processing packets; i's just in the ovs-vswitchd memory.  Why do you care where it's physically located?  I don't understand how device drive letters play into this.

--Justin



From mortazavi at ualberta.ca  Tue Sep  8 12:51:34 2015
From: mortazavi at ualberta.ca (Seyed Hossein Mortazavi)
Date: Tue, 8 Sep 2015 15:51:34 -0400
Subject: [ovs-discuss] MPLS push - OVS 2.4
In-Reply-To: <CANr6G5wuSYhvyLh8MZvK9vbUm2Oc9nnEq9wZNBjc7bf_dfV=KA@mail.gmail.com>
References: <CAFZP9CHkQrXb38+ZjsDNuL-OXWRCaOaLUiUUBQFyxiofLPZXLA@mail.gmail.com>
 <CANr6G5wuSYhvyLh8MZvK9vbUm2Oc9nnEq9wZNBjc7bf_dfV=KA@mail.gmail.com>
Message-ID: <CAFZP9CGmQ-eH=t30ASQEjvq6aqFHf70TtMibVY3RuoK_Sar0=Q@mail.gmail.com>

I followed the instructions here:
https://github.com/mininet/mininet/wiki/Installing-new-version-of-Open-vSwitch

and installed OVS 2.4 from its source (not using Ubuntu)


If anyone has ever successfully done this before, then I'll try doing it on
another machine/VM.

On Tue, Sep 8, 2015 at 1:20 PM, Joe Stringer <joestringer at nicira.com> wrote:

> Are you using the openvswitch DKMS module that comes with OVS-2.4 or
> the openvswitch module that comes with Linux-3.11?
>
> On 7 September 2015 at 15:36, Seyed Hossein Mortazavi
> <mortazavi at ualberta.ca> wrote:
> > Hi,
> >
> > I'm running OVS 2.4 on Ubuntu 14.04 with Kernel 3.11.
> >
> > I'm trying to add MPLS headers (and then pop them) to IP packets. My
> > topology looks like:
> > h1---s1---s2---s3---h2
> >
> > I've statically already configured the switches such that they would have
> > rules for ARP installed.
> >
> > However adding the rule:
> >
> > add-flow s1
> >
> "in_port=1,dl_type=0x0800,dl_src=26:95:84:d0:54:56,dl_dst=26:95:84:d0:54:56,actions=push_mpls:0x8847,set_mpls_label:10,output:2"
> >
> > Doesn't seem to work (both for Openflow 1.3 and Openflow 1.0). Packets do
> > not get to s2.
> >
> > Does anyone know how I can do so?
> >
> > based on the FAQ,
> >
> > "Open vSwitch version 2.4 can match, push, or pop up to 3 MPLS labels and
> > look past the MPLS label into the encapsulated packet. It will have
> kernel
> > support for MPLS, yielding improved performance."
> >
> >
> > --
> > Hossein
> >
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150908/1a621894/attachment.html>

From mortazavi at ualberta.ca  Tue Sep  8 20:40:23 2015
From: mortazavi at ualberta.ca (Seyed Hossein Mortazavi)
Date: Tue, 8 Sep 2015 23:40:23 -0400
Subject: [ovs-discuss] MPLS push - OVS 2.4
In-Reply-To: <CAFZP9CGmQ-eH=t30ASQEjvq6aqFHf70TtMibVY3RuoK_Sar0=Q@mail.gmail.com>
References: <CAFZP9CHkQrXb38+ZjsDNuL-OXWRCaOaLUiUUBQFyxiofLPZXLA@mail.gmail.com>
 <CANr6G5wuSYhvyLh8MZvK9vbUm2Oc9nnEq9wZNBjc7bf_dfV=KA@mail.gmail.com>
 <CAFZP9CGmQ-eH=t30ASQEjvq6aqFHf70TtMibVY3RuoK_Sar0=Q@mail.gmail.com>
Message-ID: <CAFZP9CFfbibGfUMwdrKeK2DAOMAfjQaY2rRz5xNEkE_ozqWhxg@mail.gmail.com>

Hi,

I made it work by running the switches in userspace:

sudo ovs-vsctl set bridge s1 datapath_type=netdev protocols=OpenFlow13


I'll try re-installing everything to see if I can make it work in kernel
mode.

On Tue, Sep 8, 2015 at 3:51 PM, Seyed Hossein Mortazavi <
mortazavi at ualberta.ca> wrote:

> I followed the instructions here:
>
> https://github.com/mininet/mininet/wiki/Installing-new-version-of-Open-vSwitch
>
> and installed OVS 2.4 from its source (not using Ubuntu)
>
>
> If anyone has ever successfully done this before, then I'll try doing it
> on another machine/VM.
>
> On Tue, Sep 8, 2015 at 1:20 PM, Joe Stringer <joestringer at nicira.com>
> wrote:
>
>> Are you using the openvswitch DKMS module that comes with OVS-2.4 or
>> the openvswitch module that comes with Linux-3.11?
>>
>> On 7 September 2015 at 15:36, Seyed Hossein Mortazavi
>> <mortazavi at ualberta.ca> wrote:
>> > Hi,
>> >
>> > I'm running OVS 2.4 on Ubuntu 14.04 with Kernel 3.11.
>> >
>> > I'm trying to add MPLS headers (and then pop them) to IP packets. My
>> > topology looks like:
>> > h1---s1---s2---s3---h2
>> >
>> > I've statically already configured the switches such that they would
>> have
>> > rules for ARP installed.
>> >
>> > However adding the rule:
>> >
>> > add-flow s1
>> >
>> "in_port=1,dl_type=0x0800,dl_src=26:95:84:d0:54:56,dl_dst=26:95:84:d0:54:56,actions=push_mpls:0x8847,set_mpls_label:10,output:2"
>> >
>> > Doesn't seem to work (both for Openflow 1.3 and Openflow 1.0). Packets
>> do
>> > not get to s2.
>> >
>> > Does anyone know how I can do so?
>> >
>> > based on the FAQ,
>> >
>> > "Open vSwitch version 2.4 can match, push, or pop up to 3 MPLS labels
>> and
>> > look past the MPLS label into the encapsulated packet. It will have
>> kernel
>> > support for MPLS, yielding improved performance."
>> >
>> >
>> > --
>> > Hossein
>> >
>> >
>> > _______________________________________________
>> > discuss mailing list
>> > discuss at openvswitch.org
>> > http://openvswitch.org/mailman/listinfo/discuss
>> >
>>
>
>
>


-- 
Seyed Hossein Mortazavi

Computer Science MS Student,
University of Alberta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150908/4b589a0b/attachment-0001.html>

From blp at nicira.com  Wed Sep  9 09:09:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 9 Sep 2015 09:09:42 -0700
Subject: [ovs-discuss] Open vSwitch balance-slb bond mode with two
 upstream switches
In-Reply-To: <59E36CB3-5F6B-46B5-AEB4-B663737F6DB1@nutanix.com>
References: <59E36CB3-5F6B-46B5-AEB4-B663737F6DB1@nutanix.com>
Message-ID: <20150909160942.GH1339@nicira.com>

On Fri, Aug 21, 2015 at 07:14:33PM +0000, Jason Burns wrote:
> Can the balance-slb bond mode in Open vSwitch be used for a bond
> connected to two separate upstream switches?
> 
> When I read the documentation [1] it states that only active-backup
> can be used to connect to two separate upstream switches, but no
> explanation is provided.

I don't recall the exact reason, but I remember that this caused
problems, and that's why we documented it.

I hope that someone else can speak up with the reason.

From manish.chopra at qlogic.com  Wed Sep  9 03:03:34 2015
From: manish.chopra at qlogic.com (Manish Chopra)
Date: Wed, 9 Sep 2015 10:03:34 +0000
Subject: [ovs-discuss] [OVS v2.4.0] - VXLAN UDP port configuration is not
 notified to L2 driver/interface.
Message-ID: <31AFFC7280259C4184970ABA9AFE8B93E46E4208@avmb3.qlogic.org>

Hi,

Detailed Description :

I am trying to test VXLAN with OVS bridge with L2 driver. With OVS release version [2.4.0] package VXLAN udp port configuration is not notified to L2 driver
via ndo_add_vxlan_port interface. Due to this hardware is not able to do offload of features [like checksum etc.], Hence TCP/IP traffic with encapsulated offload enabled on NIC is not working.

How to reproduce:

With L2 driver loaded - NIC interface eth0 [IP: 192.168.110.10] on the system


1)      Installed OVS v 2.4.0 on the system

2)      Created OVS bridge "ovs-vx" using "ovs-vsctl add-br ovs-vx"

3)      ovs-vsctl add-port ovs-vx vxlan0 -- set interface vxlan0 type=vxlan options:remote_ip=192.168.110.20 options:key=100 options:dst_port=4789


-        Here with this step VXLAN UDP port 4789 is not being notified to L2 interface eth0.



4)      Configured IP on "ovs-vx" internal port [IP: 192.168.100.10]

5)      Tried to ping remote "ovs-vx" internal port - ping 192.168.100.20 [Works fine]

6)      Try running TCP/IP traffic between "ovs-vx" internal ports - it doesn't work with encapsulated offload enabled on NIC(eth0) interface.

Expected result:
VXLAN UDP port configuration must be notified to L2 interface [to eth0].

Addition Note:

With OVS [v2.3.2] VXLAN udp port configuration was getting notified to L2 driver and there TCP/IP  traffic with encapsulated offload worked fine.

Please let me know if any more information is required.

Thanks,
Manish


________________________________

This message and any attached documents contain information from the sending company or its parent company(s), subsidiaries, divisions or branch offices that may be confidential. If you are not the intended recipient, you may not read, copy, distribute, or use this information. If you have received this transmission in error, please notify the sender immediately by reply e-mail and then delete this message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150909/a6ca08bf/attachment.html>

From jesse at nicira.com  Wed Sep  9 10:10:56 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 9 Sep 2015 10:10:56 -0700
Subject: [ovs-discuss] [OVS v2.4.0] - VXLAN UDP port configuration is
	not notified to L2 driver/interface.
In-Reply-To: <31AFFC7280259C4184970ABA9AFE8B93E46E4208@avmb3.qlogic.org>
References: <31AFFC7280259C4184970ABA9AFE8B93E46E4208@avmb3.qlogic.org>
Message-ID: <CAEP_g=9UYU5dPnaHQZ-Q06NiSWRiXh3zSEvEPxQdz_M5nhY9XQ@mail.gmail.com>

On Wed, Sep 9, 2015 at 3:03 AM, Manish Chopra <manish.chopra at qlogic.com> wrote:
> Hi,
>
> Detailed Description :
>
> I am trying to test VXLAN with OVS bridge with L2 driver. With OVS release
> version [2.4.0] package VXLAN udp port configuration is not notified to L2
> driver
>
> via ndo_add_vxlan_port interface. Due to this hardware is not able to do
> offload of features [like checksum etc.], Hence TCP/IP traffic with
> encapsulated offload enabled on NIC is not working.

You mean offloads aren't being performed and therefore things are
slower than if it was done in hardware or traffic doesn't flow?
Offloads should never be mandatory.

What is the base kernel version?

From manish.chopra at qlogic.com  Wed Sep  9 13:06:15 2015
From: manish.chopra at qlogic.com (Manish Chopra)
Date: Wed, 9 Sep 2015 20:06:15 +0000
Subject: [ovs-discuss] [OVS v2.4.0] - VXLAN UDP port configuration is
 not notified to L2 driver/interface.
In-Reply-To: <CAEP_g=9UYU5dPnaHQZ-Q06NiSWRiXh3zSEvEPxQdz_M5nhY9XQ@mail.gmail.com>
References: <31AFFC7280259C4184970ABA9AFE8B93E46E4208@avmb3.qlogic.org>
 <CAEP_g=9UYU5dPnaHQZ-Q06NiSWRiXh3zSEvEPxQdz_M5nhY9XQ@mail.gmail.com>
Message-ID: <31AFFC7280259C4184970ABA9AFE8B93E46E4F79@avmb3.qlogic.org>

> -----Original Message-----
> From: Jesse Gross [mailto:jesse at nicira.com]
> Sent: Wednesday, September 09, 2015 10:41 PM
> To: Manish Chopra
> Cc: bugs at openvswitch.org; pshelar at nicira.com; Yuval Mintz; Ashish Kumar
> Subject: Re: [OVS v2.4.0] - VXLAN UDP port configuration is not notified to L2
> driver/interface.
>
> On Wed, Sep 9, 2015 at 3:03 AM, Manish Chopra <manish.chopra at qlogic.com>
> wrote:
> > Hi,
> >
> > Detailed Description :
> >
> > I am trying to test VXLAN with OVS bridge with L2 driver. With OVS
> > release version [2.4.0] package VXLAN udp port configuration is not
> > notified to L2 driver
> >
> > via ndo_add_vxlan_port interface. Due to this hardware is not able to
> > do offload of features [like checksum etc.], Hence TCP/IP traffic with
> > encapsulated offload enabled on NIC is not working.
>
> You mean offloads aren't being performed and therefore things are slower than
> if it was done in hardware or traffic doesn't flow?
> Offloads should never be mandatory.
>
> What is the base kernel version?

Traffic doesn't flow at all. Our hardware is supportive for encap offloads only when UDP port is configured on hardware.

We claim to support below features for encapsulation  -
ndev->hw_enc_features = NETIF_F_IP_CSUM | NETIF_F_IPV6_CSUM

If we remove these features from "ndev->hw_enc_features" then traffic works fine.
Base kernel version is 3.10.0-229.el7.x86_64.

With earlier version of OVS,  UDP port used to be arrived to the L2 driver which used to configure given UDP port on hardware, hence traffic was working fine with above features
enabled in " ndev->hw_enc_features ".

Using our driver with just VXLAN module works fine as VXLAN module layer always notify UDP port to the driver. Please see below code snippet.
The only problem we see is with OVS environment and that too with latest OVS released package.

/* Notify netdevs that UDP port started listening */
static void vxlan_notify_add_rx_port(struct vxlan_sock *vs)
{
        struct net_device *dev;
        struct sock *sk = vs->sock->sk;
        struct net *net = sock_net(sk);
        sa_family_t sa_family = vxlan_get_sk_family(vs);
        __be16 port = inet_sk(sk)->inet_sport;
        int err;

        if (sa_family == AF_INET) {
                err = udp_add_offload(&vs->udp_offloads);
                if (err)
                        pr_warn("vxlan: udp_add_offload failed with status %d\n", err);
        }

        rcu_read_lock();
        for_each_netdev_rcu(net, dev) {
                if (dev->netdev_ops->ndo_add_vxlan_port)
                        dev->netdev_ops->ndo_add_vxlan_port(dev, sa_family,
                                                            port);
        }
        rcu_read_unlock();
}

Thanks.





________________________________

This message and any attached documents contain information from the sending company or its parent company(s), subsidiaries, divisions or branch offices that may be confidential. If you are not the intended recipient, you may not read, copy, distribute, or use this information. If you have received this transmission in error, please notify the sender immediately by reply e-mail and then delete this message.

From jesse at nicira.com  Wed Sep  9 13:39:03 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 9 Sep 2015 13:39:03 -0700
Subject: [ovs-discuss] [OVS v2.4.0] - VXLAN UDP port configuration is
	not notified to L2 driver/interface.
In-Reply-To: <31AFFC7280259C4184970ABA9AFE8B93E46E4F79@avmb3.qlogic.org>
References: <31AFFC7280259C4184970ABA9AFE8B93E46E4208@avmb3.qlogic.org>
 <CAEP_g=9UYU5dPnaHQZ-Q06NiSWRiXh3zSEvEPxQdz_M5nhY9XQ@mail.gmail.com>
 <31AFFC7280259C4184970ABA9AFE8B93E46E4F79@avmb3.qlogic.org>
Message-ID: <CAEP_g=81Jng1F7PeFfYj-sqX9bpJca5+Gf97ndSHXd=Me-krsg@mail.gmail.com>

On Wed, Sep 9, 2015 at 1:06 PM, Manish Chopra <manish.chopra at qlogic.com> wrote:
>> -----Original Message-----
>> From: Jesse Gross [mailto:jesse at nicira.com]
>> Sent: Wednesday, September 09, 2015 10:41 PM
>> To: Manish Chopra
>> Cc: bugs at openvswitch.org; pshelar at nicira.com; Yuval Mintz; Ashish Kumar
>> Subject: Re: [OVS v2.4.0] - VXLAN UDP port configuration is not notified to L2
>> driver/interface.
>>
>> On Wed, Sep 9, 2015 at 3:03 AM, Manish Chopra <manish.chopra at qlogic.com>
>> wrote:
>> > Hi,
>> >
>> > Detailed Description :
>> >
>> > I am trying to test VXLAN with OVS bridge with L2 driver. With OVS
>> > release version [2.4.0] package VXLAN udp port configuration is not
>> > notified to L2 driver
>> >
>> > via ndo_add_vxlan_port interface. Due to this hardware is not able to
>> > do offload of features [like checksum etc.], Hence TCP/IP traffic with
>> > encapsulated offload enabled on NIC is not working.
>>
>> You mean offloads aren't being performed and therefore things are slower than
>> if it was done in hardware or traffic doesn't flow?
>> Offloads should never be mandatory.
>>
>> What is the base kernel version?
>
> Traffic doesn't flow at all. Our hardware is supportive for encap offloads only when UDP port is configured on hardware.
>
> We claim to support below features for encapsulation  -
> ndev->hw_enc_features = NETIF_F_IP_CSUM | NETIF_F_IPV6_CSUM

I believe that the correctness issue is actually in the driver. You
can't assume that encapsulation means VXLAN or that the port will be
registered. There are other protocols that set this and there are also
other sources for offloaded encapsulation packets, such as VMs. You're
going to have to do some filtering of offloads in ndo_features_check
to support this hardware.

That being said, there is a performance regression in OVS. Thomas, I
believe that this is a result of the GBP changes since that caused
kernels that previously supported receive offloads and GRO to use the
compat code, which doesn't support them. Would you mind taking a look?

From tgraf at suug.ch  Wed Sep  9 14:06:29 2015
From: tgraf at suug.ch (Thomas Graf)
Date: Wed, 9 Sep 2015 23:06:29 +0200
Subject: [ovs-discuss] [OVS v2.4.0] - VXLAN UDP port configuration is
 not notified to L2 driver/interface.
In-Reply-To: <CAEP_g=81Jng1F7PeFfYj-sqX9bpJca5+Gf97ndSHXd=Me-krsg@mail.gmail.com>
References: <31AFFC7280259C4184970ABA9AFE8B93E46E4208@avmb3.qlogic.org>
 <CAEP_g=9UYU5dPnaHQZ-Q06NiSWRiXh3zSEvEPxQdz_M5nhY9XQ@mail.gmail.com>
 <31AFFC7280259C4184970ABA9AFE8B93E46E4F79@avmb3.qlogic.org>
 <CAEP_g=81Jng1F7PeFfYj-sqX9bpJca5+Gf97ndSHXd=Me-krsg@mail.gmail.com>
Message-ID: <20150909210628.GA23451@pox.localdomain>

On 09/09/15 at 01:39pm, Jesse Gross wrote:
> That being said, there is a performance regression in OVS. Thomas, I
> believe that this is a result of the GBP changes since that caused
> kernels that previously supported receive offloads and GRO to use the
> compat code, which doesn't support them. Would you mind taking a look?

Sure. Now that you mention it I remember that you have brought this up
before. Shouldn't explain the issue described here though.

From azhou at nicira.com  Wed Sep  9 16:28:07 2015
From: azhou at nicira.com (Andy Zhou)
Date: Wed, 9 Sep 2015 16:28:07 -0700
Subject: [ovs-discuss] Open vSwitch balance-slb bond mode with two
 upstream switches
In-Reply-To: <20150909160942.GH1339@nicira.com>
References: <59E36CB3-5F6B-46B5-AEB4-B663737F6DB1@nutanix.com>
 <20150909160942.GH1339@nicira.com>
Message-ID: <CACzMAJ+5yv2EwUBscRxpvWMricCji+LuuaSURo+K1-dM0_BC8w@mail.gmail.com>

On Wed, Sep 9, 2015 at 9:09 AM, Ben Pfaff <blp at nicira.com> wrote:
> On Fri, Aug 21, 2015 at 07:14:33PM +0000, Jason Burns wrote:
>> Can the balance-slb bond mode in Open vSwitch be used for a bond
>> connected to two separate upstream switches?
>>
>> When I read the documentation [1] it states that only active-backup
>> can be used to connect to two separate upstream switches, but no
>> explanation is provided.
>
> I don't recall the exact reason, but I remember that this caused
> problems, and that's why we documented it.
>
> I hope that someone else can speak up with the reason.

Bond traffic rebalancing or link flapping may mass up the mac learning
table of those separate upstream switches.

From blp at nicira.com  Wed Sep  9 17:11:00 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 9 Sep 2015 17:11:00 -0700
Subject: [ovs-discuss] Open vSwitch balance-slb bond mode with two
 upstream switches
In-Reply-To: <CACzMAJ+5yv2EwUBscRxpvWMricCji+LuuaSURo+K1-dM0_BC8w@mail.gmail.com>
References: <59E36CB3-5F6B-46B5-AEB4-B663737F6DB1@nutanix.com>
 <20150909160942.GH1339@nicira.com>
 <CACzMAJ+5yv2EwUBscRxpvWMricCji+LuuaSURo+K1-dM0_BC8w@mail.gmail.com>
Message-ID: <20150910001100.GA2218@nicira.com>

On Wed, Sep 09, 2015 at 04:28:07PM -0700, Andy Zhou wrote:
> On Wed, Sep 9, 2015 at 9:09 AM, Ben Pfaff <blp at nicira.com> wrote:
> > On Fri, Aug 21, 2015 at 07:14:33PM +0000, Jason Burns wrote:
> >> Can the balance-slb bond mode in Open vSwitch be used for a bond
> >> connected to two separate upstream switches?
> >>
> >> When I read the documentation [1] it states that only active-backup
> >> can be used to connect to two separate upstream switches, but no
> >> explanation is provided.
> >
> > I don't recall the exact reason, but I remember that this caused
> > problems, and that's why we documented it.
> >
> > I hope that someone else can speak up with the reason.
> 
> Bond traffic rebalancing or link flapping may mass up the mac learning
> table of those separate upstream switches.

If you have a specific example in mind, then I think we'd all find it
enlightening.

From prask9 at gmail.com  Thu Sep 10 00:21:23 2015
From: prask9 at gmail.com (kunapaneni prashanth)
Date: Thu, 10 Sep 2015 12:51:23 +0530
Subject: [ovs-discuss] Need help to verify SCTP traffic using openvswitch
Message-ID: <CABZU2_QjL+6y4wsa+_W4r946AP3u1=32A0PRCdz6onCpzmJkDw@mail.gmail.com>

Hi Soumya,
 Can you increase number of packet transmitted using -x option and let
me know if it works.

for example
sctp_test -H 10.10.10.2 -P 19001 -h 10.10.10.3 -p 19000 -s -x 30

Thanks,
Prashanth

> Message: 3
> Date: Thu, 23 Jul 2015 11:06:26 +0530
> From: soumya kumar <soumya03081986 at gmail.com>
> To: Dave Waters <davewaters1970 at gmail.com>
> Cc: "discuss at openvswitch.org" <discuss at openvswitch.org>
> Subject: Re: [ovs-discuss] Need help to verify SCTP traffic using
>         openvswitch
> Message-ID:
>         <CALK75viu5Ds+Az0F5U9Aesa76wg-Wn_BPOXrv5=5PfbWmLi6Vw at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> Hi Dave,
>
> Thanks for your reply.
>
> I have attached the configuration detail in the email, Please let me know
> if you need more information on the same.
>
> Joe, I just want to check sctp traffic communication between two ovs
> bridge, i was expecting that i should see sctp traffic, able to see tcp and
> udp traffic between two bridge but sctp traffic is not seen.
> Please check the attached configuration detail .
>
>
> Regard,
> Soumya
>
> On 23 July 2015 at 04:26, Dave Waters <davewaters1970 at gmail.com> wrote:
>
>> On the source and the destination where you're sending this sctp traffic,
>> can you send the output of ovs-dpctl dump-flows and ovs-ofctl dump-flows?
>> If there is a tunnel between the two hosts, then the packets could be
>> getting dropped because of the additional header that you have slapped on.
>>
>> Dave
>>
>> On Thu, Jul 23, 2015 at 3:19 AM, Joe Stringer <joestringer at nicira.com>
>> wrote:
>>
>>> What do you mean by verify?
>>>
>>> You'll need to be more specific on your configuration, what openflow
>>> flows you have, etc. Specifically what is the difference between the
>>> behaviour you expect and the behaviour you see?
>>>
>>> On 22 July 2015 at 06:45, soumya kumar <soumya03081986 at gmail.com> wrote:
>>> > Hi,
>>> >
>>> > I want to verify SCTP traffic between two Hosts.
>>> > I was trying to verify using two ways
>>> >    1> using iperf3 ( as it support sctp traffic)
>>> >    2> using sctp_test command
>>> >
>>> >
>>> > I am not able to see sctp traffic while checking with openvswitch
>>> 2.3.1. The
>>> > same command works and able to see sctp traffic when i am not using
>>> > openvswitch and checked with back-back connected port.
>>> >
>>> >
>>> > Is there a way to verify sctp traffic support for openvswitch.Any simple
>>> > test to verify this.
>>> >
>>> >
>>> >
>>> >
>>> > Regards,
>>> > Soumya
>>> >
>>> > _______________________________________________
>>> > discuss mailing list
>>> > discuss at openvswitch.org
>>> > http://openvswitch.org/mailman/listinfo/discuss
>>> >
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>
>>
>>
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <http://openvswitch.org/pipermail/discuss/attachments/20150723/4cc2a27e/attachment.html>
> -------------- next part --------------
> Host-1 configuration:
> ====================
> [root at localhost openvswitch-2.3.1]# ovs-vsctl show
> 0b49e9b6-4b37-46d1-9e92-f9d5f995af8a
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "vxlan0"
>             Interface "vxlan0"
>                 type: vxlan
>                 options: {remote_ip="192.168.1.10"}
> [root at localhost openvswitch-2.3.1]# ifconfig p2p1
> p2p1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>         inet 192.168.1.11  netmask 255.255.255.0  broadcast 192.168.1.255
>         inet6 fe80::21b:21ff:fe47:6af8  prefixlen 64  scopeid 0x20<link>
>         ether 00:1b:21:47:6a:f8  txqueuelen 1000  (Ethernet)
>         RX packets 71  bytes 10567 (10.3 KiB)
>         RX errors 0  dropped 0  overruns 0  frame 0
>         TX packets 147  bytes 28491 (27.8 KiB)
>         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
>
> [root at localhost openvswitch-2.3.1]# ifconfig br0
> br0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450
>         inet 10.10.10.2  netmask 255.255.255.0  broadcast 10.10.10.255
>         inet6 fe80::34d3:f2ff:fe2e:394d  prefixlen 64  scopeid 0x20<link>
>         ether 36:d3:f2:2e:39:4d  txqueuelen 0  (Ethernet)
>         RX packets 3  bytes 182 (182.0 B)
>         RX errors 0  dropped 0  overruns 0  frame 0
>         TX packets 30  bytes 4252 (4.1 KiB)
>         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
>
> [root at localhost openvswitch-2.3.1]#
>
>
> Host-2 configuration:
> ====================
> [root at localhost openvswitch-2.3.1]# ovs-vsctl show
> 88f2bd6b-abdb-42c5-9762-be193883b363
>     Bridge "br0"
>         Port "br0"
>             Interface "br0"
>                 type: internal
>         Port "vxlan0"
>             Interface "vxlan0"
>                 type: vxlan
>                 options: {remote_ip="192.168.1.11"}
> [root at localhost openvswitch-2.3.1]# ifconfig p1p1
> p1p1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
>         inet 192.168.1.10  netmask 255.255.255.0  broadcast 192.168.1.255
>         inet6 fe80::21b:21ff:febb:3104  prefixlen 64  scopeid 0x20<link>
>         ether 00:1b:21:bb:31:04  txqueuelen 1000  (Ethernet)
>         RX packets 139  bytes 29443 (28.7 KiB)
>         RX errors 0  dropped 0  overruns 0  frame 0
>         TX packets 217  bytes 25247 (24.6 KiB)
>         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
>
> [root at localhost openvswitch-2.3.1]# ifconfig br0
> br0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450
>         inet 10.10.10.3  netmask 255.255.255.0  broadcast 10.10.10.255
>         inet6 fe80::1495:cff:fe48:5847  prefixlen 64  scopeid 0x20<link>
>         ether 16:95:0c:48:58:47  txqueuelen 0  (Ethernet)
>         RX packets 30  bytes 4252 (4.1 KiB)
>         RX errors 0  dropped 0  overruns 0  frame 0
>         TX packets 29  bytes 4897 (4.7 KiB)
>         TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
>
> [root at localhost openvswitch-2.3.1]#
>
>
>
>
> SCTP TEST:
> =========
> Host-2:
>
> [root at localhost openvswitch-2.3.1]# sctp_test -H 10.10.10.3 -P 19000 -h 10.10.10.2 -p 19001 -l
> remote:addr=10.10.10.2, port=19001, family=2
> local:addr=10.10.10.3, port=igrid, family=2
> seed = 1437629180
>
> Starting tests...
>         socket(SOCK_SEQPACKET, IPPROTO_SCTP)  ->  sk=3
>         bind(sk=3, [a:10.10.10.3,p:igrid])  --  attempt 1/10
>         listen(sk=3,backlog=100)
> Server: Receiving packets.
>         recvmsg(sk=3) Notification: SCTP_ASSOC_CHANGE(COMMUNICATION_UP)
>                 (assoc_change: state=0, error=0, instr=10 outstr=10)
>         recvmsg(sk=3) Data 1 bytes. First 1 bytes: <empty> text[0]=0
>         recvmsg(sk=3) Notification: SCTP_ASSOC_CHANGE(COMMUNICATION_LOST)
>                 (assoc_change: state=1, error=0, instr=0 outstr=0)
>         recvmsg(sk=3)
>
>
>
> =============
> Host-1:
>
Re: [ovs-discuss] Need help to verify SCTP traffic using
>         openvswitch
> remote:addr=10.10.10.3, port=igrid, family=2
> local:addr=10.10.10.2, port=19001, family=2
> seed = 1437627548
>
> Starting tests...
>         socket(SOCK_SEQPACKET, IPPROTO_SCTP)  ->  sk=3
>         bind(sk=3, [a:10.10.10.2,p:19001])  --  attempt 1/10
> Client: Sending packets.(1/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2082906182
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1491096876
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1422135459
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1321169211
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=223500771
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1439362218
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=546555122
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=664489249
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1284111518
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2109450025
> Client: Sending packets.(2/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1756070314
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=129647013
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1840072735
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=459604053
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1912473904
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1560941021
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=879714667
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1394742665
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=791413906
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1667658877
> Client: Sending packets.(3/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1739004425
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1750090747
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1997851308
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1045391409
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1510755697
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1700671588
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1165511316
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=702361361
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=870604023
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1885747051
> Client: Sending packets.(4/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=143644437
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=806026557
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1229360279
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1565779897
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2127195769
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1452861050
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=857658467
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=526267243
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2117350300
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2141769985
> Client: Sending packets.(5/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=488233620
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1725936966
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=123933350
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=180822708
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=38057371
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2036407254
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1741763729
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=917772039
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1283666271
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=385693987
> Client: Sending packets.(6/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=437947268
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=875187048
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2135784734
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=288314928
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1920578457
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1499056784
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1988986517
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=938606125
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=53934497
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=712106892
> Client: Sending packets.(7/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=676869529
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=197578934
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1518133450
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1906229808
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1763358831
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1497845571
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1211607211
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=473533650
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2024112814
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1181473863
> Client: Sending packets.(8/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=467819987
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=364862786
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=759927181
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=591753337
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=545685494
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=797984552
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=480676943
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=139965575
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1715756591
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1764343214
> Client: Sending packets.(9/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=525659563
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=6220212
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=492046614
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=513960649
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=294535140
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=265141423
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2013017433
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=136038009
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1203747549
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=2066951930
> Client: Sending packets.(10/10)
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=848144902
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1880617078
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=117047217
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=218794704
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1639363238
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1880406048
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1716640275
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=703486801
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=206456051
>         sendmsg(sk=3, assoc=0)    1 bytes.
>           SNDRCV(stream=0 flags=0x1 ppid=1593269441
>         close(sk=3)
> [root at localhost openvswitch-2.3.1]#
>
> dpclt aoutput while running above test:
> ======================================
> Host-1:
>
> [root at localhost ~]# ovs-dpctl dump-flows
> recirc_id(0),skb_priority(0),in_port(1),eth(src=36:d3:f2:2e:39:4d,dst=16:95:0c:48:58:47),eth_type(0x0800),ipv4(src=10.10.10.2/0.0.0.0,dst=10.10.10.3/0.0.0.0,proto=132/0,tos=0x2/0x3,ttl=64/0,frag=no/0xff), packets:2, bytes:348, used:0.482s, actions:set(tunnel(tun_id=0x0,src=0.0.0.0,dst=192.168.1.10,tos=0x2,ttl=64,flags(df))),2
> recirc_id(0),skb_priority(0),tunnel(tun_id=0x0,src=192.168.1.10,dst=192.168.1.11,tos=0x2,ttl=64,flags(key)),in_port(2),skb_mark(0),eth(src=16:95:0c:48:58:47,dst=36:d3:f2:2e:39:4d),eth_type(0x0800),ipv4(src=10.10.10.3/0.0.0.0,dst=10.10.10.2/0.0.0.0,proto=132/0,tos=0x2/0,ttl=64/0,frag=no/0xff), packets:1, bytes:66, used:0.482s, actions:1
> [root at localhost ~]#
>
> [root at localhost ~]# ovs-ofctl dump-flows br0
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=520.150s, table=0, n_packets=96, n_bytes=11120, idle_age=0, priority=0 actions=NORMAL
> [root at localhost ~]#
>
>
>
> TCP and UDP traffic:
>
> [root at localhost openvswitch-2.3.1]# iperf -s
> ------------------------------------------------------------
> Server listening on TCP port 5001
> TCP window size: 85.3 KByte (default)
> ------------------------------------------------------------
> [  4] local 10.10.10.2 port 5001 connected with 10.10.10.3 port 50307
> [ ID] Interval       Transfer     Bandwidth
> [  4]  0.0-11.2 sec   640 KBytes   469 Kbits/sec
> ^C[root at localhost openvswitch-2.3.1]# iperf -s -u
> ------------------------------------------------------------
> Server listening on UDP port 5001
> Receiving 1470 byte datagrams
> UDP buffer size:  208 KByte (default)
> ------------------------------------------------------------
> [  3] local 10.10.10.2 port 5001 connected with 10.10.10.3 port 36930
> [ ID] Interval       Transfer     Bandwidth        Jitter   Lost/Total Datagrams
> [  3]  0.0-10.0 sec  1.25 MBytes  1.05 Mbits/sec   0.004 ms    0/  893 (0%)
> ^C[root at localhost openvswitch-2.3.1]#
>
>
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
> ------------------------------
>
> End of discuss Digest, Vol 73, Issue 74
> ***************************************

From manish.chopra at qlogic.com  Thu Sep 10 00:23:17 2015
From: manish.chopra at qlogic.com (Manish Chopra)
Date: Thu, 10 Sep 2015 07:23:17 +0000
Subject: [ovs-discuss] [OVS v2.4.0] - VXLAN UDP port configuration is
 not notified to L2 driver/interface.
In-Reply-To: <CAEP_g=81Jng1F7PeFfYj-sqX9bpJca5+Gf97ndSHXd=Me-krsg@mail.gmail.com>
References: <31AFFC7280259C4184970ABA9AFE8B93E46E4208@avmb3.qlogic.org>
 <CAEP_g=9UYU5dPnaHQZ-Q06NiSWRiXh3zSEvEPxQdz_M5nhY9XQ@mail.gmail.com>
 <31AFFC7280259C4184970ABA9AFE8B93E46E4F79@avmb3.qlogic.org>
 <CAEP_g=81Jng1F7PeFfYj-sqX9bpJca5+Gf97ndSHXd=Me-krsg@mail.gmail.com>
Message-ID: <31AFFC7280259C4184970ABA9AFE8B93E46E654E@avmb3.qlogic.org>

> -----Original Message-----
> From: Jesse Gross [mailto:jesse at nicira.com]
> Sent: Thursday, September 10, 2015 2:09 AM
> To: Manish Chopra; Thomas Graf
> Cc: bugs at openvswitch.org; pshelar at nicira.com; Yuval Mintz; Ashish Kumar
> Subject: Re: [OVS v2.4.0] - VXLAN UDP port configuration is not notified to L2
> driver/interface.
>
> On Wed, Sep 9, 2015 at 1:06 PM, Manish Chopra <manish.chopra at qlogic.com>
> wrote:
> >> -----Original Message-----
> >> From: Jesse Gross [mailto:jesse at nicira.com]
> >> Sent: Wednesday, September 09, 2015 10:41 PM
> >> To: Manish Chopra
> >> Cc: bugs at openvswitch.org; pshelar at nicira.com; Yuval Mintz; Ashish
> >> Kumar
> >> Subject: Re: [OVS v2.4.0] - VXLAN UDP port configuration is not
> >> notified to L2 driver/interface.
> >>
> >> On Wed, Sep 9, 2015 at 3:03 AM, Manish Chopra
> >> <manish.chopra at qlogic.com>
> >> wrote:
> >> > Hi,
> >> >
> >> > Detailed Description :
> >> >
> >> > I am trying to test VXLAN with OVS bridge with L2 driver. With OVS
> >> > release version [2.4.0] package VXLAN udp port configuration is not
> >> > notified to L2 driver
> >> >
> >> > via ndo_add_vxlan_port interface. Due to this hardware is not able
> >> > to do offload of features [like checksum etc.], Hence TCP/IP
> >> > traffic with encapsulated offload enabled on NIC is not working.
> >>
> >> You mean offloads aren't being performed and therefore things are
> >> slower than if it was done in hardware or traffic doesn't flow?
> >> Offloads should never be mandatory.
> >>
> >> What is the base kernel version?
> >
> > Traffic doesn't flow at all. Our hardware is supportive for encap offloads only
> when UDP port is configured on hardware.
> >
> > We claim to support below features for encapsulation  -
> > ndev->hw_enc_features = NETIF_F_IP_CSUM | NETIF_F_IPV6_CSUM
>
> I believe that the correctness issue is actually in the driver. You can't assume
> that encapsulation means VXLAN or that the port will be registered. There are
> other protocols that set this and there are also other sources for offloaded
> encapsulation packets, such as VMs. You're going to have to do some filtering of
> offloads in ndo_features_check to support this hardware.
>
> That being said, there is a performance regression in OVS. Thomas, I believe that
> this is a result of the GBP changes since that caused kernels that previously
> supported receive offloads and GRO to use the compat code, which doesn't
> support them. Would you mind taking a look?

I didn't get it much. What would have caused performance regression due to notifying UDP port ?
Not sure how it is doable the said filtering ? "ndev->hw_enc_features" is the mask of the features inherited by encapsulating device, it could be geneve/gre on top of
base device. Given that VXLAN udp port is not notified we can't just remove these features from " ndev->hw_enc_features" as it might affect other encap device features.

Thanks,
Manish



________________________________

This message and any attached documents contain information from the sending company or its parent company(s), subsidiaries, divisions or branch offices that may be confidential. If you are not the intended recipient, you may not read, copy, distribute, or use this information. If you have received this transmission in error, please notify the sender immediately by reply e-mail and then delete this message.

From azhou at nicira.com  Thu Sep 10 00:58:49 2015
From: azhou at nicira.com (Andy Zhou)
Date: Thu, 10 Sep 2015 00:58:49 -0700
Subject: [ovs-discuss] Open vSwitch balance-slb bond mode with two
 upstream switches
In-Reply-To: <20150910001100.GA2218@nicira.com>
References: <59E36CB3-5F6B-46B5-AEB4-B663737F6DB1@nutanix.com>
 <20150909160942.GH1339@nicira.com>
 <CACzMAJ+5yv2EwUBscRxpvWMricCji+LuuaSURo+K1-dM0_BC8w@mail.gmail.com>
 <20150910001100.GA2218@nicira.com>
Message-ID: <CACzMAJLW+0g_fc3uqRG_CoTKQV5FRdu4aFmSwHqoafqygB7JKQ@mail.gmail.com>

Assume two switches are connected to OVS SLB bond with two slave ports.

In case the two non-OVS switch are not directly connected. The hosts
behind one of the switches can not reach hosts behind OVS via
multicast or broadcast, since only one of the bond slave port will be
considered active slave. When rebalancing happens, the switched
away traffic will update the FIB entry of the  new switch, but not
that of the old switch.

In case the two non-OVS switches are directly connected. Incoming
multicast or broadcast won't be a problem any more. However, depends
on
traffic pattern, the new traffic may not actually pass through  the
old switch via the directly connected link. When this happens, The
stale FIB entries in the old switch now points to the bond slave that
just got rebalanced away. Causing incoming traffic flow through the
old switch to be dropped by OVS.  I am not sure this is actually a big
problem in real life.

SLB bond with single switch avoids both problems. It is possible there
are better examples that I am not aware of. But those two examples
are what I have in mind.


On Wed, Sep 9, 2015 at 5:11 PM, Ben Pfaff <blp at nicira.com> wrote:
> On Wed, Sep 09, 2015 at 04:28:07PM -0700, Andy Zhou wrote:
>> On Wed, Sep 9, 2015 at 9:09 AM, Ben Pfaff <blp at nicira.com> wrote:
>> > On Fri, Aug 21, 2015 at 07:14:33PM +0000, Jason Burns wrote:
>> >> Can the balance-slb bond mode in Open vSwitch be used for a bond
>> >> connected to two separate upstream switches?
>> >>
>> >> When I read the documentation [1] it states that only active-backup
>> >> can be used to connect to two separate upstream switches, but no
>> >> explanation is provided.
>> >
>> > I don't recall the exact reason, but I remember that this caused
>> > problems, and that's why we documented it.
>> >
>> > I hope that someone else can speak up with the reason.
>>
>> Bond traffic rebalancing or link flapping may mass up the mac learning
>> table of those separate upstream switches.
>
> If you have a specific example in mind, then I think we'd all find it
> enlightening.

From jason.burns at nutanix.com  Thu Sep 10 07:02:55 2015
From: jason.burns at nutanix.com (Jason Burns)
Date: Thu, 10 Sep 2015 14:02:55 +0000
Subject: [ovs-discuss] Open vSwitch balance-slb bond mode with two
 upstream switches
In-Reply-To: <CACzMAJLW+0g_fc3uqRG_CoTKQV5FRdu4aFmSwHqoafqygB7JKQ@mail.gmail.com>
References: <59E36CB3-5F6B-46B5-AEB4-B663737F6DB1@nutanix.com>
 <20150909160942.GH1339@nicira.com>
 <CACzMAJ+5yv2EwUBscRxpvWMricCji+LuuaSURo+K1-dM0_BC8w@mail.gmail.com>
 <20150910001100.GA2218@nicira.com>
 <CACzMAJLW+0g_fc3uqRG_CoTKQV5FRdu4aFmSwHqoafqygB7JKQ@mail.gmail.com>
Message-ID: <4CC1826F-39B3-45A6-A67C-F6EEE1F1E030@nutanix.com>

Andy and Ben, thanks for your response. The feedback is very helpful. The configuration I desire is with two upstream switches that are directly connected to each other.

Andy, based on the INTERNALS document, I assume that OVS accepts traffic on the inactive slaves, so the concern about the old FIB entry causing traffic to get dropped by OVS doesn’t seem like a problem. 
Bonding accepts unicast packets on any bond slave. [1]

Further, the FIB of both upstream switches would be updated with the new entry when the device connected to OVS sent broadcast traffic again (or if traffic from the OVS connected device went from the new switch to the old switch over the inter switch link)- so this may only be a very short period of time. It’s important to know that traffic may arrive on both incoming bond interfaces after a rebalance because the upstream switches have two separate FIB entries. Thanks for reminding me of that!

I’ve tested this in my lab with Arista 10GbE switches, running both iperf and multicast audio streaming (both client and server apps). I haven’t noticed any dropped packets or performance problems when the rebalance happens.

I did note that the rebalance algorithm does seem a bit aggressive. Assuming there are 5 active hashes (1 big flow on Slave A and 4 small flows on Slave B), and traffic between bond interfaces is almost even, but still outside the balance threshold - we see that in this condition all hashes get swapped during the rebalance - the end state being 4 on Slave A and 1 on Slave B. If traffic remains at this level, the swap back happens at the next rebalance interval.

[1] https://github.com/openvswitch/ovs/blob/master/vswitchd/INTERNALS

—
Jason Burns

> On Sep 10, 2015, at 3:58 AM, Andy Zhou <azhou at nicira.com> wrote:
> 
> Assume two switches are connected to OVS SLB bond with two slave ports.
> 
> In case the two non-OVS switch are not directly connected. The hosts
> behind one of the switches can not reach hosts behind OVS via
> multicast or broadcast, since only one of the bond slave port will be
> considered active slave. When rebalancing happens, the switched
> away traffic will update the FIB entry of the  new switch, but not
> that of the old switch.
> 
> In case the two non-OVS switches are directly connected. Incoming
> multicast or broadcast won't be a problem any more. However, depends
> on
> traffic pattern, the new traffic may not actually pass through  the
> old switch via the directly connected link. When this happens, The
> stale FIB entries in the old switch now points to the bond slave that
> just got rebalanced away. Causing incoming traffic flow through the
> old switch to be dropped by OVS.  I am not sure this is actually a big
> problem in real life.
> 
> SLB bond with single switch avoids both problems. It is possible there
> are better examples that I am not aware of. But those two examples
> are what I have in mind.
> 
> 
> On Wed, Sep 9, 2015 at 5:11 PM, Ben Pfaff <blp at nicira.com> wrote:
>> On Wed, Sep 09, 2015 at 04:28:07PM -0700, Andy Zhou wrote:
>>> On Wed, Sep 9, 2015 at 9:09 AM, Ben Pfaff <blp at nicira.com> wrote:
>>>> On Fri, Aug 21, 2015 at 07:14:33PM +0000, Jason Burns wrote:
>>>>> Can the balance-slb bond mode in Open vSwitch be used for a bond
>>>>> connected to two separate upstream switches?
>>>>> 
>>>>> When I read the documentation [1] it states that only active-backup
>>>>> can be used to connect to two separate upstream switches, but no
>>>>> explanation is provided.
>>>> 
>>>> I don't recall the exact reason, but I remember that this caused
>>>> problems, and that's why we documented it.
>>>> 
>>>> I hope that someone else can speak up with the reason.
>>> 
>>> Bond traffic rebalancing or link flapping may mass up the mac learning
>>> table of those separate upstream switches.
>> 
>> If you have a specific example in mind, then I think we'd all find it
>> enlightening.



From jesse at nicira.com  Thu Sep 10 07:43:14 2015
From: jesse at nicira.com (Jesse Gross)
Date: Thu, 10 Sep 2015 07:43:14 -0700
Subject: [ovs-discuss] [OVS v2.4.0] - VXLAN UDP port configuration is
	not notified to L2 driver/interface.
In-Reply-To: <31AFFC7280259C4184970ABA9AFE8B93E46E654E@avmb3.qlogic.org>
References: <31AFFC7280259C4184970ABA9AFE8B93E46E4208@avmb3.qlogic.org>
 <CAEP_g=9UYU5dPnaHQZ-Q06NiSWRiXh3zSEvEPxQdz_M5nhY9XQ@mail.gmail.com>
 <31AFFC7280259C4184970ABA9AFE8B93E46E4F79@avmb3.qlogic.org>
 <CAEP_g=81Jng1F7PeFfYj-sqX9bpJca5+Gf97ndSHXd=Me-krsg@mail.gmail.com>
 <31AFFC7280259C4184970ABA9AFE8B93E46E654E@avmb3.qlogic.org>
Message-ID: <CAEP_g=9S8==EFsQNuJx2Z0gGRMn3mQ8dNdkfXP1gvV8Qz2h7bA@mail.gmail.com>

On Thu, Sep 10, 2015 at 12:23 AM, Manish Chopra
<manish.chopra at qlogic.com> wrote:
>> -----Original Message-----
>> From: Jesse Gross [mailto:jesse at nicira.com]
>> Sent: Thursday, September 10, 2015 2:09 AM
>> To: Manish Chopra; Thomas Graf
>> Cc: bugs at openvswitch.org; pshelar at nicira.com; Yuval Mintz; Ashish Kumar
>> Subject: Re: [OVS v2.4.0] - VXLAN UDP port configuration is not notified to L2
>> driver/interface.
>>
>> On Wed, Sep 9, 2015 at 1:06 PM, Manish Chopra <manish.chopra at qlogic.com>
>> wrote:
>> >> -----Original Message-----
>> >> From: Jesse Gross [mailto:jesse at nicira.com]
>> >> Sent: Wednesday, September 09, 2015 10:41 PM
>> >> To: Manish Chopra
>> >> Cc: bugs at openvswitch.org; pshelar at nicira.com; Yuval Mintz; Ashish
>> >> Kumar
>> >> Subject: Re: [OVS v2.4.0] - VXLAN UDP port configuration is not
>> >> notified to L2 driver/interface.
>> >>
>> >> On Wed, Sep 9, 2015 at 3:03 AM, Manish Chopra
>> >> <manish.chopra at qlogic.com>
>> >> wrote:
>> >> > Hi,
>> >> >
>> >> > Detailed Description :
>> >> >
>> >> > I am trying to test VXLAN with OVS bridge with L2 driver. With OVS
>> >> > release version [2.4.0] package VXLAN udp port configuration is not
>> >> > notified to L2 driver
>> >> >
>> >> > via ndo_add_vxlan_port interface. Due to this hardware is not able
>> >> > to do offload of features [like checksum etc.], Hence TCP/IP
>> >> > traffic with encapsulated offload enabled on NIC is not working.
>> >>
>> >> You mean offloads aren't being performed and therefore things are
>> >> slower than if it was done in hardware or traffic doesn't flow?
>> >> Offloads should never be mandatory.
>> >>
>> >> What is the base kernel version?
>> >
>> > Traffic doesn't flow at all. Our hardware is supportive for encap offloads only
>> when UDP port is configured on hardware.
>> >
>> > We claim to support below features for encapsulation  -
>> > ndev->hw_enc_features = NETIF_F_IP_CSUM | NETIF_F_IPV6_CSUM
>>
>> I believe that the correctness issue is actually in the driver. You can't assume
>> that encapsulation means VXLAN or that the port will be registered. There are
>> other protocols that set this and there are also other sources for offloaded
>> encapsulation packets, such as VMs. You're going to have to do some filtering of
>> offloads in ndo_features_check to support this hardware.
>>
>> That being said, there is a performance regression in OVS. Thomas, I believe that
>> this is a result of the GBP changes since that caused kernels that previously
>> supported receive offloads and GRO to use the compat code, which doesn't
>> support them. Would you mind taking a look?
>
> I didn't get it much. What would have caused performance regression due to notifying UDP port ?
> Not sure how it is doable the said filtering ? "ndev->hw_enc_features" is the mask of the features inherited by encapsulating device, it could be geneve/gre on top of
> base device. Given that VXLAN udp port is not notified we can't just remove these features from " ndev->hw_enc_features" as it might affect other encap device features.

What I mean is that I agree that OVS is not notifying drivers about
VXLAN ports in 2.4 on certain kernels. However, I consider that to be
a performance regression due to the loss of receive side offloads,
such as checksum. The fact that traffic is not flowing I believe is an
issue with the driver.

Here's an example: You mentioned Geneve, which is also a UDP-based
encapsulation but does not currently have support for registering the
receive UDP port, thereby making the netdevice very similar to VXLAN
in OVS 2.4. If you send Geneve traffic with offloads, will the packets
get dropped? My guess is yes.

Assuming that is true, I see three possible solutions in your driver:
 * Ideally, find a way to decouple transmit and receive offload.
 * Continue advertising transmit offloads but for those that can't be
supported, dynamically remove their offloads using
ndo_features_check() (See the Intel fm10k driver for an example of
this.)
 * Don't advertise encapsulation offloads.

From Gabe.Black at viavisolutions.com  Thu Sep 10 08:08:11 2015
From: Gabe.Black at viavisolutions.com (Gabe Black)
Date: Thu, 10 Sep 2015 15:08:11 +0000
Subject: [ovs-discuss] Scaling up ovs-dpdk
Message-ID: <9998A334FDE6CC48AB51C9016F467F1F7AC6BB6D@AMEXMB01.ds.jdsu.net>

So I have been able to profile performance with ovs-dpdk on multi-node and single node servers.  However, when I scale up the number of VMs on the compute nodes, I see a corresponding drop in individual VM performance.

I launched ovs-dpdk with a single GB of memory on the first numa node (instructions seem to indicate memory should only be allocated to the first numa node... not sure why).  When I tried increasing the number of RX queues (ovs-vsctl set Open_vSwitch . other_config:n-dpdk-rxqs=2), performance got significantly worse.  I was wondering what is the proper way to scale up the performance of ovs-dpdk when scaling up the number of VMs that each are using significant network bandwidth?

On a related note, it seems with the default config of ovs-dpdk that it was capped at around 6 Gb/s (with 1500 byte packets).  It seemed to be an artificial limit as looking at the dpdk stats of where it was spending time, the majority of the time was in the idle/poll loop rather than the processing packets loop.  I thought perhaps that it was the VMs, so I had two instances splitting the traffic, and again the aggregate b/w seemed to be capped at 6 Gb/s with each pair of VMs doing 3 Gb/s.  Is this an artificial limit?  Or is it related to performance tuning I might have to do?

Thanks for any recommendations!
Gabriel Black



From wayne at heimdallnetworks.com  Thu Sep 10 10:34:38 2015
From: wayne at heimdallnetworks.com (Wayne Marsh)
Date: Thu, 10 Sep 2015 14:34:38 -0300
Subject: [ovs-discuss] dump flows for cookie
Message-ID: <CAOxrwStHBQexFHuKJTZDZK79nzZMEJLVx9sq_y_C=s=rwEnuDQ@mail.gmail.com>

Hello all,

I could like to get a list of flows for a given cookie.

Using:

ovs-ofctl -O OpenFlow13 dump-flows NFE cookie=0x8

I get an error:

cannot set cookie

I've tried the command without a flow to match against and all flow entries
are listed.  Setting nw_src works as expected, but I won't have this
information going in.  I would like to avoid trying to keep track of what's
on the switch in a database.

Is there a technical reason why I cannot search for a flow entry for a
given cookie?  I can delete flows for a given cookie by passing the cookie
and a cookie mask of 0xffffffffffffffff.

If I have a group of flow entries that I'm going to want to delete at the
same time, I will assign them the same cookie.  However, if I want to look
up a rule given it's opaque id - cookie - I've run into nothing but
limitations where I would have to effectively manually filter a dump of all
flows in source or maintain an external database of rules on the switch.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150910/ae425833/attachment.html>

From wayne at heimdallnetworks.com  Thu Sep 10 10:46:54 2015
From: wayne at heimdallnetworks.com (Wayne Marsh)
Date: Thu, 10 Sep 2015 14:46:54 -0300
Subject: [ovs-discuss] dump flows for cookie
Message-ID: <CAOxrwSvEumSJ+E+LRanVK_SucjuB=VcoMA1HuetsPuyR+-xH-A@mail.gmail.com>

Hello all,

I could like to get a list of flows for a given cookie.

Using:

ovs-ofctl -O OpenFlow13 dump-flows NFE cookie=0x8

I get an error:

cannot set cookie

I've tried the command without a flow to match against and all flow entries
are listed.  Setting nw_src works as expected, but I won't have this
information going in.  I would like to avoid trying to keep track of what's
on the switch in a database.

Is there a technical reason why I cannot search for a flow entry for a
given cookie?  I can delete flows for a given cookie by passing the cookie
and a cookie mask of 0xffffffffffffffff.

If I have a group of flow entries that I'm going to want to delete at the
same time, I will assign them the same cookie.  However, if I want to look
up a rule given it's opaque id - cookie - I've run into nothing but
limitations where I would have to effectively manually filter a dump of all
flows in source or maintain an external database of rules on the switch.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150910/e401871c/attachment.html>

From blp at nicira.com  Thu Sep 10 11:08:38 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 10 Sep 2015 11:08:38 -0700
Subject: [ovs-discuss] dump flows for cookie
In-Reply-To: <CAOxrwSvEumSJ+E+LRanVK_SucjuB=VcoMA1HuetsPuyR+-xH-A@mail.gmail.com>
References: <CAOxrwSvEumSJ+E+LRanVK_SucjuB=VcoMA1HuetsPuyR+-xH-A@mail.gmail.com>
Message-ID: <20150910180838.GJ21775@nicira.com>

On Thu, Sep 10, 2015 at 02:46:54PM -0300, Wayne Marsh wrote:
> Hello all,
> 
> I could like to get a list of flows for a given cookie.
> 
> Using:
> 
> ovs-ofctl -O OpenFlow13 dump-flows NFE cookie=0x8
> 
> I get an error:
> 
> cannot set cookie

The syntax to exact-match cookie 8 is cookie=8/-1, see ovs-ofctl(8).

From wayne at heimdallnetworks.com  Thu Sep 10 11:12:32 2015
From: wayne at heimdallnetworks.com (Wayne Marsh)
Date: Thu, 10 Sep 2015 15:12:32 -0300
Subject: [ovs-discuss] dump flows for cookie
In-Reply-To: <20150910180838.GJ21775@nicira.com>
References: <CAOxrwSvEumSJ+E+LRanVK_SucjuB=VcoMA1HuetsPuyR+-xH-A@mail.gmail.com>
 <20150910180838.GJ21775@nicira.com>
Message-ID: <CAOxrwStELEXMOEXCA6eoUCXygRbbeKL5wt6_MDNBrTKbuiiTGg@mail.gmail.com>

Thanks.

On Thu, Sep 10, 2015 at 3:08 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Sep 10, 2015 at 02:46:54PM -0300, Wayne Marsh wrote:
> > Hello all,
> >
> > I could like to get a list of flows for a given cookie.
> >
> > Using:
> >
> > ovs-ofctl -O OpenFlow13 dump-flows NFE cookie=0x8
> >
> > I get an error:
> >
> > cannot set cookie
>
> The syntax to exact-match cookie 8 is cookie=8/-1, see ovs-ofctl(8).
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150910/37ba52c7/attachment.html>

From rayli1107 at gmail.com  Thu Sep 10 11:46:16 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Thu, 10 Sep 2015 11:46:16 -0700
Subject: [ovs-discuss] insert-buckets support?
Message-ID: <CA+=-Fx-qpP4sTypqox1i7zTS0x4=yyo19_0LGSwriv2uXTz9kQ@mail.gmail.com>

Does OVS 2.4 support ovs-ofctl insert-buckets?

I just upgraded to OVS 2.4.0, and here's what I tried to do:

ovs-vsctl set bridge br0
protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15

ovs-ofctl add-group br0 group_id=0,type=all,bucket="actions=output:10" -O
OpenFlow11

ovs-ofctl dump-groups br0 -O OpenFlow11
(which shows the groups table correctly with a single bucket)

ovs-ofctl insert-buckets br0
group_id=0,command_bucket_id=last,bucket="actions=output:1" -O OpenFlow15

ovs-ofctl dump-groups br0 -O OpenFlow11
(This then hangs indefinitely)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150910/c3452ca3/attachment.html>

From blp at nicira.com  Thu Sep 10 13:21:13 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 10 Sep 2015 13:21:13 -0700
Subject: [ovs-discuss] insert-buckets support?
In-Reply-To: <CA+=-Fx-qpP4sTypqox1i7zTS0x4=yyo19_0LGSwriv2uXTz9kQ@mail.gmail.com>
References: <CA+=-Fx-qpP4sTypqox1i7zTS0x4=yyo19_0LGSwriv2uXTz9kQ@mail.gmail.com>
Message-ID: <20150910202113.GA20003@nicira.com>

On Thu, Sep 10, 2015 at 11:46:16AM -0700, Ray Li wrote:
> Does OVS 2.4 support ovs-ofctl insert-buckets?
> 
> I just upgraded to OVS 2.4.0, and here's what I tried to do:
> 
> ovs-vsctl set bridge br0
> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
> 
> ovs-ofctl add-group br0 group_id=0,type=all,bucket="actions=output:10" -O
> OpenFlow11
> 
> ovs-ofctl dump-groups br0 -O OpenFlow11
> (which shows the groups table correctly with a single bucket)
> 
> ovs-ofctl insert-buckets br0
> group_id=0,command_bucket_id=last,bucket="actions=output:1" -O OpenFlow15
> 
> ovs-ofctl dump-groups br0 -O OpenFlow11
> (This then hangs indefinitely)

It's a bug, thanks for reporting it.

The underlying problem is that in both cases no bucket_id was specified,
so it defaults to the same value in each case, and duplicate bucket IDs
were not correctly handled.  You can avoid the problem by specifying a
different bucket_it in your "insert-buckets" command.

I posted a fix.  You can test it by applying the following two patches,
in this order:
        http://openvswitch.org/pipermail/dev/2015-September/059865.html
        http://openvswitch.org/pipermail/dev/2015-September/059864.html

From kevin.traynor at intel.com  Thu Sep 10 13:30:16 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Thu, 10 Sep 2015 20:30:16 +0000
Subject: [ovs-discuss] Scaling up ovs-dpdk
In-Reply-To: <9998A334FDE6CC48AB51C9016F467F1F7AC6BB6D@AMEXMB01.ds.jdsu.net>
References: <9998A334FDE6CC48AB51C9016F467F1F7AC6BB6D@AMEXMB01.ds.jdsu.net>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F74521CCE2@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Gabe
> Black
> Sent: Thursday, September 10, 2015 4:08 PM
> To: discuss at openvswitch.org
> Subject: [ovs-discuss] Scaling up ovs-dpdk
> 
> So I have been able to profile performance with ovs-dpdk on multi-node and
> single node servers.  However, when I scale up the number of VMs on the
> compute nodes, I see a corresponding drop in individual VM performance.
> 
> I launched ovs-dpdk with a single GB of memory on the first numa node
> (instructions seem to indicate memory should only be allocated to the first
> numa node... not sure why).  When I tried increasing the number of RX queues
> (ovs-vsctl set Open_vSwitch . other_config:n-dpdk-rxqs=2), performance got
> significantly worse.  I was wondering what is the proper way to scale up the
> performance of ovs-dpdk when scaling up the number of VMs that each are using
> significant network bandwidth?

Probably the best way to scale is to add more cores with pmd-cpu-mask.
You won't get much by adding multiple rxqs unless you do this, as the same
pmd (core) will be polling all the rxqs. 

I submitted a patch with additional information about performance tuning,
hopefully that will help explain.
http://openvswitch.org/pipermail/dev/2015-September/059806.html

> 
> On a related note, it seems with the default config of ovs-dpdk that it was
> capped at around 6 Gb/s (with 1500 byte packets).  It seemed to be an
> artificial limit as looking at the dpdk stats of where it was spending time,
> the majority of the time was in the idle/poll loop rather than the processing
> packets loop.  I thought perhaps that it was the VMs, so I had two instances
> splitting the traffic, and again the aggregate b/w seemed to be capped at 6
> Gb/s with each pair of VMs doing 3 Gb/s.  Is this an artificial limit?  Or is
> it related to performance tuning I might have to do?

No artificial limits in OVS with DPDK. It may just be that you need to do some
performance tuning to increase the throughput.

> 
> Thanks for any recommendations!
> Gabriel Black
> 
> 
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From Gabe.Black at viavisolutions.com  Thu Sep 10 14:10:01 2015
From: Gabe.Black at viavisolutions.com (Gabe Black)
Date: Thu, 10 Sep 2015 21:10:01 +0000
Subject: [ovs-discuss] Scaling up ovs-dpdk
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F74521CCE2@IRSMSX104.ger.corp.intel.com>
References: <9998A334FDE6CC48AB51C9016F467F1F7AC6BB6D@AMEXMB01.ds.jdsu.net>
 <BC0FEEC7D7650749874CEC11314A88F74521CCE2@IRSMSX104.ger.corp.intel.com>
Message-ID: <9998A334FDE6CC48AB51C9016F467F1F7AC6BF19@AMEXMB01.ds.jdsu.net>



> -----Original Message-----
> From: Traynor, Kevin [mailto:kevin.traynor at intel.com]
> 
> > -----Original Message-----
> > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> > Gabe Black


> > I launched ovs-dpdk with a single GB of memory on the first numa node
> > (instructions seem to indicate memory should only be allocated to the
> > first numa node... not sure why).  When I tried increasing the number
> > of RX queues (ovs-vsctl set Open_vSwitch .
> > other_config:n-dpdk-rxqs=2), performance got significantly worse.  I
> > was wondering what is the proper way to scale up the performance of
> > ovs-dpdk when scaling up the number of VMs that each are using
> significant network bandwidth?
> 
> Probably the best way to scale is to add more cores with pmd-cpu-mask.
> You won't get much by adding multiple rxqs unless you do this, as the same
> pmd (core) will be polling all the rxqs.
> 

Thanks for the recommendation.  I probably should have mentioned that in addition to having more rxqs, I also set the cpu mask to have ovs only run on threads (that were not hyperthreaded siblings) on the same socket/numa node.  That still resulted in worse performance.  However that could have been because I was running on a dual quad-core system on that particular node, and keeping everything on a single numa node exhausted resources that would have normally been available for the VMs.

Presumably though, one would have VMs using memory and compute resources from multiple numa nodes.  With that in mind should I be launching ovs-vswitchd with (for example) --socket-mem 1024,1024 (and also ensure hugetable memory is available on both numa nodes)?  Should I have the cpu mask also pick cores from both sockets?  The documentation wasn't clear if this should be the route to go to support multi numa node setups, but had conflicting messages.  It claimed that it would create a pmd to run for each numa node by default, but I found that it only created a single thread, and it ran on numa 0 (and cpu 0).  The docs also seem to indicate that memory should be allocated from numa 0 as well and that ovs-vswitchd should be launched with that specification...  Is that supposed to be the case?

> I submitted a patch with additional information about performance tuning,
> hopefully that will help explain.
> http://openvswitch.org/pipermail/dev/2015-September/059806.html
 
Thank you for the additional tips.  One item I think that could be added and I haven't been able to find, is determining the location of the occasional packet drops.  In my testing, there is often very little packet drop, but no application is taking credit (blame?) for the drop.  DPDK stats show no drops (ovs-appctl dpif-netdev/pmd-stats-show), the vm interface shows no drops, application claims no drops (using zsend/zcount).   Ovs-ofctl dump-ports doesn't claim any...  ethtool on the physical nic won't work since dpdk uio owns the nic, so I can't see those stats... And that about exhausts my methods for figuring out where to look for drops...

From Gabe.Black at viavisolutions.com  Thu Sep 10 14:45:49 2015
From: Gabe.Black at viavisolutions.com (Gabe Black)
Date: Thu, 10 Sep 2015 21:45:49 +0000
Subject: [ovs-discuss] Scaling up ovs-dpdk
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F74521CCE2@IRSMSX104.ger.corp.intel.com>
References: <9998A334FDE6CC48AB51C9016F467F1F7AC6BB6D@AMEXMB01.ds.jdsu.net>
 <BC0FEEC7D7650749874CEC11314A88F74521CCE2@IRSMSX104.ger.corp.intel.com>
Message-ID: <9998A334FDE6CC48AB51C9016F467F1F7AC6BFA0@AMEXMB01.ds.jdsu.net>

> > I launched ovs-dpdk with a single GB of memory on the first numa node
> > (instructions seem to indicate memory should only be allocated to the
> > first numa node... not sure why).  When I tried increasing the number
> > of RX queues (ovs-vsctl set Open_vSwitch .
> > other_config:n-dpdk-rxqs=2), performance got significantly worse.  I
> > was wondering what is the proper way to scale up the performance of
> > ovs-dpdk when scaling up the number of VMs that each are using
> significant network bandwidth?
> 
> Probably the best way to scale is to add more cores with pmd-cpu-mask.
> You won't get much by adding multiple rxqs unless you do this, as the same
> pmd (core) will be polling all the rxqs.
> 

I think I found an issue:

ovs-appctl dpif-netdev/pmd-stats-show
main thread:
        emc hits:0
        megaflow hits:0
        miss:0
        lost:0
        polling cycles:2209488 (100.00%)
        processing cycles:0 (0.00%)
pmd thread numa_id 0 core_id 0:
        emc hits:50
        megaflow hits:6288906
        miss:1
        lost:0
        polling cycles:4860224526 (8.11%)
        processing cycles:55082803644 (91.89%)
        avg cycles per packet: 9531.47 (59943028170/6288957)
        avg processing cycles per packet: 8758.65 (55082803644/6288957)
pmd thread numa_id 0 core_id 8:
        emc hits:0
        megaflow hits:0
        miss:1
        lost:0
        polling cycles:37034036502 (100.00%)
        processing cycles:76503 (0.00%)
        avg cycles per packet: 37034113005.00 (37034113005/1)
        avg processing cycles per packet: 76503.00 (76503/1)

If you notice, both pmd threads have a numa_id of 0.

Also launching the ovs-vswitchd, the output shows:
...
2015-09-10T21:24:51Z|00033|dpif_netdev|INFO|Created 2 pmd threads on numa node 0
...

I thought it was supposed to create a thread on each numa node?
 


From rayli1107 at gmail.com  Thu Sep 10 14:51:03 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Thu, 10 Sep 2015 14:51:03 -0700
Subject: [ovs-discuss] insert-buckets support?
In-Reply-To: <20150910202113.GA20003@nicira.com>
References: <CA+=-Fx-qpP4sTypqox1i7zTS0x4=yyo19_0LGSwriv2uXTz9kQ@mail.gmail.com>
 <20150910202113.GA20003@nicira.com>
Message-ID: <CA+=-Fx-p1MDLR9jBaY0b-SW5kuHtmoqJ7UPkpFKgEXzod2uszQ@mail.gmail.com>

According to ovs-ofctl's man page, if no bucket_id is specified it's
support to allocate one. Is that not being done? Or is that the bug itself?

On Thu, Sep 10, 2015 at 1:21 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Sep 10, 2015 at 11:46:16AM -0700, Ray Li wrote:
> > Does OVS 2.4 support ovs-ofctl insert-buckets?
> >
> > I just upgraded to OVS 2.4.0, and here's what I tried to do:
> >
> > ovs-vsctl set bridge br0
> >
> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
> >
> > ovs-ofctl add-group br0 group_id=0,type=all,bucket="actions=output:10" -O
> > OpenFlow11
> >
> > ovs-ofctl dump-groups br0 -O OpenFlow11
> > (which shows the groups table correctly with a single bucket)
> >
> > ovs-ofctl insert-buckets br0
> > group_id=0,command_bucket_id=last,bucket="actions=output:1" -O OpenFlow15
> >
> > ovs-ofctl dump-groups br0 -O OpenFlow11
> > (This then hangs indefinitely)
>
> It's a bug, thanks for reporting it.
>
> The underlying problem is that in both cases no bucket_id was specified,
> so it defaults to the same value in each case, and duplicate bucket IDs
> were not correctly handled.  You can avoid the problem by specifying a
> different bucket_it in your "insert-buckets" command.
>
> I posted a fix.  You can test it by applying the following two patches,
> in this order:
>         http://openvswitch.org/pipermail/dev/2015-September/059865.html
>         http://openvswitch.org/pipermail/dev/2015-September/059864.html
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150910/67ee85f5/attachment-0001.html>

From blp at nicira.com  Thu Sep 10 14:56:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 10 Sep 2015 14:56:52 -0700
Subject: [ovs-discuss] insert-buckets support?
In-Reply-To: <CA+=-Fx-p1MDLR9jBaY0b-SW5kuHtmoqJ7UPkpFKgEXzod2uszQ@mail.gmail.com>
References: <CA+=-Fx-qpP4sTypqox1i7zTS0x4=yyo19_0LGSwriv2uXTz9kQ@mail.gmail.com>
 <20150910202113.GA20003@nicira.com>
 <CA+=-Fx-p1MDLR9jBaY0b-SW5kuHtmoqJ7UPkpFKgEXzod2uszQ@mail.gmail.com>
Message-ID: <20150910215652.GC25835@nicira.com>

With the current behavior, insert-buckets doesn't automatically allocate
non-overlapping bucket ids.  This could be considered a bug in the
documentation or in the code.  It would be more user-friendly to
consider a bug in the code and fix it in ovs-ofctl, but that's a bigger
job than just fixing the crash as these commits do.

On Thu, Sep 10, 2015 at 02:51:03PM -0700, Ray Li wrote:
> According to ovs-ofctl's man page, if no bucket_id is specified it's
> support to allocate one. Is that not being done? Or is that the bug itself?
> 
> On Thu, Sep 10, 2015 at 1:21 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Thu, Sep 10, 2015 at 11:46:16AM -0700, Ray Li wrote:
> > > Does OVS 2.4 support ovs-ofctl insert-buckets?
> > >
> > > I just upgraded to OVS 2.4.0, and here's what I tried to do:
> > >
> > > ovs-vsctl set bridge br0
> > >
> > protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
> > >
> > > ovs-ofctl add-group br0 group_id=0,type=all,bucket="actions=output:10" -O
> > > OpenFlow11
> > >
> > > ovs-ofctl dump-groups br0 -O OpenFlow11
> > > (which shows the groups table correctly with a single bucket)
> > >
> > > ovs-ofctl insert-buckets br0
> > > group_id=0,command_bucket_id=last,bucket="actions=output:1" -O OpenFlow15
> > >
> > > ovs-ofctl dump-groups br0 -O OpenFlow11
> > > (This then hangs indefinitely)
> >
> > It's a bug, thanks for reporting it.
> >
> > The underlying problem is that in both cases no bucket_id was specified,
> > so it defaults to the same value in each case, and duplicate bucket IDs
> > were not correctly handled.  You can avoid the problem by specifying a
> > different bucket_it in your "insert-buckets" command.
> >
> > I posted a fix.  You can test it by applying the following two patches,
> > in this order:
> >         http://openvswitch.org/pipermail/dev/2015-September/059865.html
> >         http://openvswitch.org/pipermail/dev/2015-September/059864.html
> >

From rayli1107 at gmail.com  Thu Sep 10 17:10:16 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Thu, 10 Sep 2015 17:10:16 -0700
Subject: [ovs-discuss] insert-buckets support?
In-Reply-To: <20150910215652.GC25835@nicira.com>
References: <CA+=-Fx-qpP4sTypqox1i7zTS0x4=yyo19_0LGSwriv2uXTz9kQ@mail.gmail.com>
 <20150910202113.GA20003@nicira.com>
 <CA+=-Fx-p1MDLR9jBaY0b-SW5kuHtmoqJ7UPkpFKgEXzod2uszQ@mail.gmail.com>
 <20150910215652.GC25835@nicira.com>
Message-ID: <CA+=-Fx_5TOK-EjoWxTsvDycO4-27FB0OBR06LucmcQiX0mpjYQ@mail.gmail.com>

Hi, I've ran into another issue. I'm trying this on a new environment. When
I tried to add a group for the first time using OpenFlow15 with bucket_id,
I got an OFPBAC_BAD_LEN error. It worked though when I tried to add a group
using OpenFlow11 without bucket_id. Any idea what this means?

ovs-ofctl add-group br1 group_id=0,type=all,bucket="actions=output:10" -O
OpenFlow11
(This works.)

ovs-ofctl del-groups br1 -O OpenFlow11

ovs-ofctl add-group br1
group_id=0,type=all,bucket="bucket_id=100,actions=output:10" -O OpenFlow15
OFPT_ERROR (OF1.5) (xid=0x2): OFPBAC_BAD_LEN
OFPT_GROUP_MOD (OF1.5) (xid=0x2):
 ADD group_id=0,type=all,bucket=bucket_id:100,actions=output:10

When I looked at the log files it shows:
2015-09-11T00:08:59.622Z|00437|ofp_actions|WARN|bad action at offset 0
(OFPBAC_BAD_LEN):
00000000  00 00 00 10 00 00 00 0a-
2015-09-11T00:08:59.622Z|00438|connmgr|INFO|br0_vxlan<->unix: sending
OFPBAC_BAD_LEN error reply to OFPT_GROUP_MOD message



Thanks



On Thu, Sep 10, 2015 at 2:56 PM, Ben Pfaff <blp at nicira.com> wrote:

> With the current behavior, insert-buckets doesn't automatically allocate
> non-overlapping bucket ids.  This could be considered a bug in the
> documentation or in the code.  It would be more user-friendly to
> consider a bug in the code and fix it in ovs-ofctl, but that's a bigger
> job than just fixing the crash as these commits do.
>
> On Thu, Sep 10, 2015 at 02:51:03PM -0700, Ray Li wrote:
> > According to ovs-ofctl's man page, if no bucket_id is specified it's
> > support to allocate one. Is that not being done? Or is that the bug
> itself?
> >
> > On Thu, Sep 10, 2015 at 1:21 PM, Ben Pfaff <blp at nicira.com> wrote:
> >
> > > On Thu, Sep 10, 2015 at 11:46:16AM -0700, Ray Li wrote:
> > > > Does OVS 2.4 support ovs-ofctl insert-buckets?
> > > >
> > > > I just upgraded to OVS 2.4.0, and here's what I tried to do:
> > > >
> > > > ovs-vsctl set bridge br0
> > > >
> > >
> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
> > > >
> > > > ovs-ofctl add-group br0
> group_id=0,type=all,bucket="actions=output:10" -O
> > > > OpenFlow11
> > > >
> > > > ovs-ofctl dump-groups br0 -O OpenFlow11
> > > > (which shows the groups table correctly with a single bucket)
> > > >
> > > > ovs-ofctl insert-buckets br0
> > > > group_id=0,command_bucket_id=last,bucket="actions=output:1" -O
> OpenFlow15
> > > >
> > > > ovs-ofctl dump-groups br0 -O OpenFlow11
> > > > (This then hangs indefinitely)
> > >
> > > It's a bug, thanks for reporting it.
> > >
> > > The underlying problem is that in both cases no bucket_id was
> specified,
> > > so it defaults to the same value in each case, and duplicate bucket IDs
> > > were not correctly handled.  You can avoid the problem by specifying a
> > > different bucket_it in your "insert-buckets" command.
> > >
> > > I posted a fix.  You can test it by applying the following two patches,
> > > in this order:
> > >
> http://openvswitch.org/pipermail/dev/2015-September/059865.html
> > >
> http://openvswitch.org/pipermail/dev/2015-September/059864.html
> > >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150910/08ce3bb5/attachment.html>

From xchenum at gmail.com  Thu Sep 10 19:36:44 2015
From: xchenum at gmail.com (Xu (Simon) Chen)
Date: Thu, 10 Sep 2015 22:36:44 -0400
Subject: [ovs-discuss] ovs not triggering vxlan offload
Message-ID: <CAGNyuhUzVPOUL+uzinTvuSOpsmUR7cK2sZBCsbBg2DkH-9pjiQ@mail.gmail.com>

Hello,

I am testing OVS 2.4.0 on Linux 3.18 kernel.

Not sure when it got changed, but VXLAN offload is no longer on by
default in 3.18 - it used to be the case in 3.14. So, normally I have:
ethtool -k eth4 | grep tnl
tx-udp_tnl-segmentation: off [fixed]

Configuring a VXLAN interface manually would trigger that option to
turn on. Something like:
ip link add vxlan0 type vxlan id 11 group 239.1.1.1 dev eth4
ip addr add 1.2.4.5/24 dev vxlan0
ip link set up vxlan0

Then we have:
ethtool -k eth4 | grep tnl
tx-udp_tnl-segmentation: on [requested off]

I imagined that when OVS created the VXLAN tunneled ports, it should
turn on VXLAN offload as well, but it's not happening.

Any ideas?

Thanks.
-Simon

From jesse at nicira.com  Thu Sep 10 19:48:06 2015
From: jesse at nicira.com (Jesse Gross)
Date: Thu, 10 Sep 2015 19:48:06 -0700
Subject: [ovs-discuss] ovs not triggering vxlan offload
In-Reply-To: <CAGNyuhUzVPOUL+uzinTvuSOpsmUR7cK2sZBCsbBg2DkH-9pjiQ@mail.gmail.com>
References: <CAGNyuhUzVPOUL+uzinTvuSOpsmUR7cK2sZBCsbBg2DkH-9pjiQ@mail.gmail.com>
Message-ID: <CAEP_g=9Xsk4a10FfTCuJLuFUKF3z2CEDayGGoeZsqnCJv7muQA@mail.gmail.com>

On Thu, Sep 10, 2015 at 7:36 PM, Xu (Simon) Chen <xchenum at gmail.com> wrote:
> Hello,
>
> I am testing OVS 2.4.0 on Linux 3.18 kernel.
>
> Not sure when it got changed, but VXLAN offload is no longer on by
> default in 3.18 - it used to be the case in 3.14. So, normally I have:
> ethtool -k eth4 | grep tnl
> tx-udp_tnl-segmentation: off [fixed]
>
> Configuring a VXLAN interface manually would trigger that option to
> turn on. Something like:
> ip link add vxlan0 type vxlan id 11 group 239.1.1.1 dev eth4
> ip addr add 1.2.4.5/24 dev vxlan0
> ip link set up vxlan0
>
> Then we have:
> ethtool -k eth4 | grep tnl
> tx-udp_tnl-segmentation: on [requested off]
>
> I imagined that when OVS created the VXLAN tunneled ports, it should
> turn on VXLAN offload as well, but it's not happening.

This was reported just yesterday:
http://openvswitch.org/pipermail/discuss/2015-September/018714.html

I'm assuming that this is with the out of tree OVS kernel module. In
that case, the change is in OVS 2.4 and shouldn't be a difference
between Linux 3.14 and 3.18.

From jesse at nicira.com  Thu Sep 10 20:05:22 2015
From: jesse at nicira.com (Jesse Gross)
Date: Thu, 10 Sep 2015 20:05:22 -0700
Subject: [ovs-discuss] ovs not triggering vxlan offload
In-Reply-To: <CAGNyuhUC9TPbeRd_kVab3fg_b1JnaMGntmwMRrgizwuEf-csYw@mail.gmail.com>
References: <CAGNyuhUzVPOUL+uzinTvuSOpsmUR7cK2sZBCsbBg2DkH-9pjiQ@mail.gmail.com>
 <CAEP_g=9Xsk4a10FfTCuJLuFUKF3z2CEDayGGoeZsqnCJv7muQA@mail.gmail.com>
 <CAGNyuhUC9TPbeRd_kVab3fg_b1JnaMGntmwMRrgizwuEf-csYw@mail.gmail.com>
Message-ID: <CAEP_g=9SVb7ffMfGJKAX0EtcMGDcjVaJ_T19j-FvmasKp7t3Zw@mail.gmail.com>

It actually is the same root cause. The only difference is the NIC is
not the same and the driver is reacting in a different way.

On Thu, Sep 10, 2015 at 7:53 PM, Xu (Simon) Chen <xchenum at gmail.com> wrote:
> I looked at that thread, and it's slightly different from mine...
>
> My traffic is flowing, just VXLAN offload isn't kicking in, which
> obviously has a significant performance hit. I am using a datapath
> kernel module built from OVS 2.4.0.
>
> On Thu, Sep 10, 2015 at 10:48 PM, Jesse Gross <jesse at nicira.com> wrote:
>> On Thu, Sep 10, 2015 at 7:36 PM, Xu (Simon) Chen <xchenum at gmail.com> wrote:
>>> Hello,
>>>
>>> I am testing OVS 2.4.0 on Linux 3.18 kernel.
>>>
>>> Not sure when it got changed, but VXLAN offload is no longer on by
>>> default in 3.18 - it used to be the case in 3.14. So, normally I have:
>>> ethtool -k eth4 | grep tnl
>>> tx-udp_tnl-segmentation: off [fixed]
>>>
>>> Configuring a VXLAN interface manually would trigger that option to
>>> turn on. Something like:
>>> ip link add vxlan0 type vxlan id 11 group 239.1.1.1 dev eth4
>>> ip addr add 1.2.4.5/24 dev vxlan0
>>> ip link set up vxlan0
>>>
>>> Then we have:
>>> ethtool -k eth4 | grep tnl
>>> tx-udp_tnl-segmentation: on [requested off]
>>>
>>> I imagined that when OVS created the VXLAN tunneled ports, it should
>>> turn on VXLAN offload as well, but it's not happening.
>>
>> This was reported just yesterday:
>> http://openvswitch.org/pipermail/discuss/2015-September/018714.html
>>
>> I'm assuming that this is with the out of tree OVS kernel module. In
>> that case, the change is in OVS 2.4 and shouldn't be a difference
>> between Linux 3.14 and 3.18.

From matt at gns3.net  Thu Sep 10 10:53:22 2015
From: matt at gns3.net (Matt Raio)
Date: Thu, 10 Sep 2015 10:53:22 -0700
Subject: [ovs-discuss] moving the process that runs the FIB...
Message-ID: <CAE=8uipGa1iedPYpZwZAAXc2srVv0nEMPRgxjibiBU0FeMZF8Q@mail.gmail.com>

For a very specific reason, I wanted to know if you can add a device that
has it's own memory space and then run the process in OpenVSwitch that
builds and maintains the FIB.

If we can tweak OpenVSwitch to load the process in a separate Linux OS (a
container...and execute the FIB process), we can expand the FIB tables and
have the ability to stack cpu and RAM externally while the main OpenVSwitch
will handle the layer 3 Routing Engine.

I hope I'm a little more clear on the reason why I would want the ability
to move the process in another device with it's own RAM and CPU.

Thanks!

-Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150910/bcd58b29/attachment.html>

From egoitz at hotmail.es  Fri Sep 11 03:04:48 2015
From: egoitz at hotmail.es (Egoitz Urrutia)
Date: Fri, 11 Sep 2015 12:04:48 +0200
Subject: [ovs-discuss] Problems with OpenFlow 1.5 in Open vSwitch
Message-ID: <DUB110-W95E0F0C9F75DABFAE08016B2500@phx.gbl>

Hello,
I am having problems with the connection Switch - Controller using OF15. 
I work in a mininet network enviroment, and I put OF15 to the switch with this command:
root at ryu-vm:~# ovs-vsctl set bridge 1º protocol=OpenFlow15
I am using RYU controller, and when I open an application based on OpenFlow 1.5 to connect with that bridge, I have problems with the first messages (Hello msgs) and doesn't come into main mode.
This is the error code captured by snoop:
root at ryu-vm:~# ovs-ofctl snoop s1OFPT_FEATURES_REQUEST (OF1.5) (xid=0x8a484d4e):OFPT_FEATURES_REPLY (OF1.5) (xid=0x8a484d4e): dpid:0000000000000001n_tables:254, n_buffers:256capabilities: FLOW_STATS TABLE_STATS PORT_STATS GROUP_STATS QUEUE_STATSOFPT_SET_CONFIG (OF1.5) (xid=0x8a484d4f): frags=normal miss_send_len=1282015-09-11T09:56:15Z|00001|ofp_msgs|WARN|received OFPST_PORT_DESC request with incorrect length 24 (expected length 20)2015-09-11T09:56:15Z|00002|ofp_msgs|WARN|received OFPST_PORT_DESC request with incorrect length 24 (expected length 20)***decode error: OFPBRC_BAD_LEN***00000000  06 12 00 18 8a 48 4d 50-00 0d 00 00 00 00 00 00 |.....HMP........|00000010  ff ff ff ff 00 00 00 00-                        |........        |2015-09-11T09:56:15Z|00003|ofp_msgs|WARN|received OFPST_PORT_DESC request with incorrect length 24 (expected length 20)OFPT_ERROR (OF1.5) (xid=0x8a484d50): OFPBRC_BAD_LEN***decode error: OFPBRC_BAD_LEN***00000000  06 12 00 18 8a 48 4d 50-00 0d 00 00 00 00 00 00 |.....HMP........|00000010  ff ff ff ff 00 00 00 00-                        |........        |OFPT_FLOW_MOD (OF1.5) (xid=0x8a484d51): ADD priority=0 out_port:0 actions=CONTROLLER:65535OFPT_ECHO_REQUEST (OF1.5) (xid=0x0): 0 bytes of payloadOFPT_ECHO_REPLY (OF1.5) (xid=0x0): 0 bytes of payloadOFPT_PACKET_IN (OF1.5) (xid=0x0): cookie=0x0 total_len=98 in_port=1 (via no_match) data_len=98 buffer=0x00000100icmp,vlan_tci=0x0000,dl_src=00:00:00:00:00:01,dl_dst=00:00:00:00:00:02,nw_src=10.0.0.1,nw_dst=10.0.0.2,nw_tos=0,nw_ecn=0,nw_ttl=64,icmp_type=8,icmp_code=0 icmp_csum:65e
Is there any problem with OpenFlow 1.5 in OvS using RYU controller? Any solution?
I need help for my proyect.
Thanks a lot,Egoitz 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150911/0c0b25fb/attachment.html>

From blp at nicira.com  Fri Sep 11 09:14:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Fri, 11 Sep 2015 09:14:20 -0700
Subject: [ovs-discuss] Problems with OpenFlow 1.5 in Open vSwitch
In-Reply-To: <DUB110-W95E0F0C9F75DABFAE08016B2500@phx.gbl>
References: <DUB110-W95E0F0C9F75DABFAE08016B2500@phx.gbl>
Message-ID: <20150911161420.GB28754@nicira.com>

On Fri, Sep 11, 2015 at 12:04:48PM +0200, Egoitz Urrutia wrote:
> I am having problems with the connection Switch - Controller using OF15. 
> I work in a mininet network enviroment, and I put OF15 to the switch with this command:

Support for OpenFlow 1.5 isn't complete, so you shouldn't bother to
enable it unless you're planning to work on developing it.

From pedroflow at icloud.com  Fri Sep 11 12:12:53 2015
From: pedroflow at icloud.com (Pedro Maia)
Date: Fri, 11 Sep 2015 20:12:53 +0100
Subject: [ovs-discuss] Connect two ovs in different vm's that are in
	different machines
Message-ID: <F0860A87-766E-46DC-B522-FAD169630FF6@icloud.com>

Hello,

I’m trying to create a network environment in which i have two Machines each with 1 VM running openvswitch.
Both machines are connected to the same switch and the VMs are using the same vlan which is mapped on that switch.
It’s something like

(((ovs1)VM1)Host1)— switch — (Host2(VM2(ovs2)))

In order to do this i’ve done the following:

Host1
- Created bridge br0 and added eth1
- ovs-vsctl set interface eth1 type=patch
- ovs-vsctl set interface eth1 options:peer=peer2
- ip nets add h1
- ip link add h1-eth1 type veth peer name s1-eth1
- ip link set h1-eth1 nets h1
- ovs-vsctl add-port br0 s1-eth1
- ip netns exec h1 ifconfig h1-eth1 10.1
- ip netns exec h1 ifconfig lo up
- ifconfig s1-eth1 up

And the same on VM2 but with ip 10.2
Then i’ve added flow’s to both switches so that they match on the inport and send to the corresponding outport, in both directions.

 cookie=0x0, duration=4142.923s, table=0, n_packets=0, n_bytes=0, idle_age=4142, in_port=3 actions=output:4
 cookie=0x0, duration=4130.518s, table=0, n_packets=24, n_bytes=1008, idle_age=3, in_port=4 actions=output:3

ovs-ofctl dump-ports-desc br0
OFPST_PORT_DESC reply (xid=0x2):
 3(eth1): addr:00:00:00:00:00:00
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 4(s1-eth1): addr:00:00:00:00:00:00
     config:     0
     state:      0
     current:    10GB-FD COPPER
     speed: 10000 Mbps now, 0 Mbps max
 LOCAL(br0): addr:00:00:00:00:00:00
     config:     PORT_DOWN
     state:      LINK_DOWN
     speed: 0 Mbps now, 0 Mbps max

But when i try ip nets exec h1 ping -c1 10.2 the packet never gets out of VM1. The counters on eth1 never change despite the ones on ovs do.

Surely i’m making something wrong but i can’t figure out what. If someone could point me in the right direction that would be great.

Regards,
Pedro

From rayli1107 at gmail.com  Fri Sep 11 13:58:43 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Fri, 11 Sep 2015 13:58:43 -0700
Subject: [ovs-discuss] insert-buckets support?
In-Reply-To: <CA+=-Fx_5TOK-EjoWxTsvDycO4-27FB0OBR06LucmcQiX0mpjYQ@mail.gmail.com>
References: <CA+=-Fx-qpP4sTypqox1i7zTS0x4=yyo19_0LGSwriv2uXTz9kQ@mail.gmail.com>
 <20150910202113.GA20003@nicira.com>
 <CA+=-Fx-p1MDLR9jBaY0b-SW5kuHtmoqJ7UPkpFKgEXzod2uszQ@mail.gmail.com>
 <20150910215652.GC25835@nicira.com>
 <CA+=-Fx_5TOK-EjoWxTsvDycO4-27FB0OBR06LucmcQiX0mpjYQ@mail.gmail.com>
Message-ID: <CA+=-Fx--d8NnW3HUui_iW2=m06PYaLmN3_706i5wVTFCw8YCxA@mail.gmail.com>

Hi, here's another issue. If I create an empty group first without buckets,
and then run insert-buckets with command_bucket_id=last, it will fail to
add the bucket and somehow delete the empty group. it works if I ran
insert-buckets with command_bucket_id=first though.

On Thu, Sep 10, 2015 at 5:10 PM, Ray Li <rayli1107 at gmail.com> wrote:

> Hi, I've ran into another issue. I'm trying this on a new environment.
> When I tried to add a group for the first time using OpenFlow15 with
> bucket_id, I got an OFPBAC_BAD_LEN error. It worked though when I tried to
> add a group using OpenFlow11 without bucket_id. Any idea what this means?
>
> ovs-ofctl add-group br1 group_id=0,type=all,bucket="actions=output:10" -O
> OpenFlow11
> (This works.)
>
> ovs-ofctl del-groups br1 -O OpenFlow11
>
> ovs-ofctl add-group br1
> group_id=0,type=all,bucket="bucket_id=100,actions=output:10" -O OpenFlow15
> OFPT_ERROR (OF1.5) (xid=0x2): OFPBAC_BAD_LEN
> OFPT_GROUP_MOD (OF1.5) (xid=0x2):
>  ADD group_id=0,type=all,bucket=bucket_id:100,actions=output:10
>
> When I looked at the log files it shows:
> 2015-09-11T00:08:59.622Z|00437|ofp_actions|WARN|bad action at offset 0
> (OFPBAC_BAD_LEN):
> 00000000  00 00 00 10 00 00 00 0a-
> 2015-09-11T00:08:59.622Z|00438|connmgr|INFO|br0_vxlan<->unix: sending
> OFPBAC_BAD_LEN error reply to OFPT_GROUP_MOD message
>
>
>
> Thanks
>
>
>
> On Thu, Sep 10, 2015 at 2:56 PM, Ben Pfaff <blp at nicira.com> wrote:
>
>> With the current behavior, insert-buckets doesn't automatically allocate
>> non-overlapping bucket ids.  This could be considered a bug in the
>> documentation or in the code.  It would be more user-friendly to
>> consider a bug in the code and fix it in ovs-ofctl, but that's a bigger
>> job than just fixing the crash as these commits do.
>>
>> On Thu, Sep 10, 2015 at 02:51:03PM -0700, Ray Li wrote:
>> > According to ovs-ofctl's man page, if no bucket_id is specified it's
>> > support to allocate one. Is that not being done? Or is that the bug
>> itself?
>> >
>> > On Thu, Sep 10, 2015 at 1:21 PM, Ben Pfaff <blp at nicira.com> wrote:
>> >
>> > > On Thu, Sep 10, 2015 at 11:46:16AM -0700, Ray Li wrote:
>> > > > Does OVS 2.4 support ovs-ofctl insert-buckets?
>> > > >
>> > > > I just upgraded to OVS 2.4.0, and here's what I tried to do:
>> > > >
>> > > > ovs-vsctl set bridge br0
>> > > >
>> > >
>> protocols=OpenFlow10,OpenFlow11,OpenFlow12,OpenFlow13,OpenFlow14,OpenFlow15
>> > > >
>> > > > ovs-ofctl add-group br0
>> group_id=0,type=all,bucket="actions=output:10" -O
>> > > > OpenFlow11
>> > > >
>> > > > ovs-ofctl dump-groups br0 -O OpenFlow11
>> > > > (which shows the groups table correctly with a single bucket)
>> > > >
>> > > > ovs-ofctl insert-buckets br0
>> > > > group_id=0,command_bucket_id=last,bucket="actions=output:1" -O
>> OpenFlow15
>> > > >
>> > > > ovs-ofctl dump-groups br0 -O OpenFlow11
>> > > > (This then hangs indefinitely)
>> > >
>> > > It's a bug, thanks for reporting it.
>> > >
>> > > The underlying problem is that in both cases no bucket_id was
>> specified,
>> > > so it defaults to the same value in each case, and duplicate bucket
>> IDs
>> > > were not correctly handled.  You can avoid the problem by specifying a
>> > > different bucket_it in your "insert-buckets" command.
>> > >
>> > > I posted a fix.  You can test it by applying the following two
>> patches,
>> > > in this order:
>> > >
>> http://openvswitch.org/pipermail/dev/2015-September/059865.html
>> > >
>> http://openvswitch.org/pipermail/dev/2015-September/059864.html
>> > >
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150911/f0700f27/attachment.html>

From joestringer at nicira.com  Fri Sep 11 14:58:00 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Fri, 11 Sep 2015 14:58:00 -0700
Subject: [ovs-discuss] Connect two ovs in different vm's that are in
 different machines
In-Reply-To: <F0860A87-766E-46DC-B522-FAD169630FF6@icloud.com>
References: <F0860A87-766E-46DC-B522-FAD169630FF6@icloud.com>
Message-ID: <CANr6G5xLFZ3D=HrPQcQBBzu3tUDca8=-p4Mhkf+4ZSy39PgF-Q@mail.gmail.com>

On 11 September 2015 at 12:12, Pedro Maia <pedroflow at icloud.com> wrote:
> Hello,
>
> I’m trying to create a network environment in which i have two Machines each with 1 VM running openvswitch.
> Both machines are connected to the same switch and the VMs are using the same vlan which is mapped on that switch.
> It’s something like
>
> (((ovs1)VM1)Host1)— switch — (Host2(VM2(ovs2)))
>
> In order to do this i’ve done the following:
>
> Host1
> - Created bridge br0 and added eth1
> - ovs-vsctl set interface eth1 type=patch
> - ovs-vsctl set interface eth1 options:peer=peer2

Is "eth1" an ethernet interface (vm NIC) or an OVS patch port?

Patch ports don't work across multiple machines. They can only link
OVS bridges within the same machine.

From pedroflow at icloud.com  Fri Sep 11 15:25:35 2015
From: pedroflow at icloud.com (Pedro Maia)
Date: Fri, 11 Sep 2015 23:25:35 +0100
Subject: [ovs-discuss] Connect two ovs in different vm's that are in
 different machines
In-Reply-To: <CANr6G5xLFZ3D=HrPQcQBBzu3tUDca8=-p4Mhkf+4ZSy39PgF-Q@mail.gmail.com>
References: <F0860A87-766E-46DC-B522-FAD169630FF6@icloud.com>
 <CANr6G5xLFZ3D=HrPQcQBBzu3tUDca8=-p4Mhkf+4ZSy39PgF-Q@mail.gmail.com>
Message-ID: <DD7BAAF2-2F16-4D6B-BB5D-704940F67713@icloud.com>

Hi Joe,

It’s a vm NIC. Ok so the only way to do this is by using a GRE tunnel? Or is there any other way so that i don’t need to use a tunnel?

Thanks for the reply,
Regards

> On 11 Sep 2015, at 22:58, Joe Stringer <joestringer at nicira.com> wrote:
> 
> On 11 September 2015 at 12:12, Pedro Maia <pedroflow at icloud.com> wrote:
>> Hello,
>> 
>> I’m trying to create a network environment in which i have two Machines each with 1 VM running openvswitch.
>> Both machines are connected to the same switch and the VMs are using the same vlan which is mapped on that switch.
>> It’s something like
>> 
>> (((ovs1)VM1)Host1)— switch — (Host2(VM2(ovs2)))
>> 
>> In order to do this i’ve done the following:
>> 
>> Host1
>> - Created bridge br0 and added eth1
>> - ovs-vsctl set interface eth1 type=patch
>> - ovs-vsctl set interface eth1 options:peer=peer2
> 
> Is "eth1" an ethernet interface (vm NIC) or an OVS patch port?
> 
> Patch ports don't work across multiple machines. They can only link
> OVS bridges within the same machine.


From rayli1107 at gmail.com  Fri Sep 11 15:41:41 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Fri, 11 Sep 2015 15:41:41 -0700
Subject: [ovs-discuss] add-flow's group action not working?
Message-ID: <CA+=-Fx8L2jjsDq4RUcFakSYeoKwR5aFKMDsVBJiKfos6MQWHqw@mail.gmail.com>

Hi, I'm testing this on 2.4.0.

I created a group with some entries, and then added a flow with
actions=group:<group_id>. However when I checked the flow table, the flow
entry becomes actions=drop.

Any idea why that happens?

Thanks,
Ray
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150911/036b54c1/attachment.html>

From rayli1107 at gmail.com  Fri Sep 11 15:55:10 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Fri, 11 Sep 2015 15:55:10 -0700
Subject: [ovs-discuss] add-flow's group action not working?
In-Reply-To: <CA+=-Fx8L2jjsDq4RUcFakSYeoKwR5aFKMDsVBJiKfos6MQWHqw@mail.gmail.com>
References: <CA+=-Fx8L2jjsDq4RUcFakSYeoKwR5aFKMDsVBJiKfos6MQWHqw@mail.gmail.com>
Message-ID: <CA+=-Fx8=4FuGowotwQFJTkWS1p0U0ab2+iWYqnRN_F9cUMiqLw@mail.gmail.com>

Never mind, ignore my question. Didn't realize that dump-flows command also
required the -O option.

Thanks

On Fri, Sep 11, 2015 at 3:41 PM, Ray Li <rayli1107 at gmail.com> wrote:

> Hi, I'm testing this on 2.4.0.
>
> I created a group with some entries, and then added a flow with
> actions=group:<group_id>. However when I checked the flow table, the flow
> entry becomes actions=drop.
>
> Any idea why that happens?
>
> Thanks,
> Ray
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150911/67e065fe/attachment.html>

From maryam.tahhan at intel.com  Sat Sep 12 04:13:37 2015
From: maryam.tahhan at intel.com (Tahhan, Maryam)
Date: Sat, 12 Sep 2015 11:13:37 +0000
Subject: [ovs-discuss] TOIT 2.0 AKA VSPERF Update
Message-ID: <1A27633A6DA49C4A92FCD5D4312DBF536A5114BB@IRSMSX109.ger.corp.intel.com>

Hi Folks

Just wanted to give you an update regarding the VSPERF performance characterization framework in OPNFV.

VSPERF is the Python based test framework for characterizing the performance of virtual switches. As of today, it's capable of conducting:
* RFC2544 throughput tests (P2P and PVP) | RFC2544 throughput scalability tests.
* RFC2544 back to back tests (P2P and PVP)
* A simple performance test (P2P) : blast the switch at 100% linerate and measure the maximum forwarding rate.
* CPU/Memory load tests with RFC2544.
On both the OVS kernel datapath (for P2P), and the netdev-dpdk.

Where P2P = Physical port → vSwitch → physical port  (for more information checkout https://etherpad.opnfv.org/p/vSwitchPerfTestSpec )
And PVP =  Physical port → vSwitch → VNF → vSwitch → physical port (for more information checkout https://etherpad.opnfv.org/p/vSwitchPerfTestSpec )

Note: It currently supports IXIA as the traffic generator, but development work is underway to support Spirent, Moongen and Xena.

For people interested in trying out the framework checkout https://gerrit.opnfv.org/gerrit/#/admin/projects/vswitchperf or https://gerrit.opnfv.org/gerrit/gitweb?p=vswitchperf.git;a=tree 

If you'd like to take part in the project in OPNFV, feel free to drop me an note and checkout https://wiki.opnfv.org/characterize_vswitch_performance_for_telco_nfv_use_cases. Our weekly meeting details can be found @ https://wiki.opnfv.org/meetings?&#characterize_vswitch_performance_for_telco_nfv_use_cases_vsperf_project_team_meeting 

Best Regards, 
Maryam


From s.hesam.ghasemi at gmail.com  Sat Sep 12 06:21:36 2015
From: s.hesam.ghasemi at gmail.com (Seyyed Hesamoddin Ghasemi)
Date: Sat, 12 Sep 2015 17:51:36 +0430
Subject: [ovs-discuss] add/sub a constant value to tcp sequence number
 and ack number in ovs
In-Reply-To: <3A44FEDB-631F-4DBA-8DB1-30C12C7864B3@nicira.com>
References: <CAOsSsa7ozZmSGSO_wkY+KL4y-X0Cy-_SLQ3D=hFgJTouFV-yxQ@mail.gmail.com>
 <3A44FEDB-631F-4DBA-8DB1-30C12C7864B3@nicira.com>
Message-ID: <CAOsSsa7jz6GDLmZxCJPK_aAVq5gnvZjELD1ut-3BE7Qbgi0h-g@mail.gmail.com>

Why not? As I know OVS have access to all header fields in layer 2 to layer
4!
How can I Implement a simple proxy using OVS? I mean, how can get packet
from a source node and send it to a destination node in a transparent
manner?

I need to get first 4 packet of a tcp session in the controller (as a
proxy) and then forward the rest of packets using OVS without intervention
of the controller and with keep current tcp session. How can I do that?


On Sat, Sep 5, 2015 at 10:19 PM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Sep 5, 2015, at 8:53 AM, Seyyed Hesamoddin Ghasemi <
> s.hesam.ghasemi at gmail.com> wrote:
> >
> > Hi every body,
> > I need to develop a proxy, and for this I should add/sub a constant
> value to sequence number and ack number in ovs, Could somebody please help
> me?
>
> OVS doesn't provide any visibility into the sequence numbers of TCP
> packets.
>
> --Justin
>
>
>


-- 
Seyyed Hesamoddin Ghasemi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150912/5dbfceff/attachment.html>

From gal.sagie at gmail.com  Sat Sep 12 07:34:36 2015
From: gal.sagie at gmail.com (Gal Sagie)
Date: Sat, 12 Sep 2015 17:34:36 +0300
Subject: [ovs-discuss] add/sub a constant value to tcp sequence number
 and ack number in ovs
In-Reply-To: <CAOsSsa7jz6GDLmZxCJPK_aAVq5gnvZjELD1ut-3BE7Qbgi0h-g@mail.gmail.com>
References: <CAOsSsa7ozZmSGSO_wkY+KL4y-X0Cy-_SLQ3D=hFgJTouFV-yxQ@mail.gmail.com>
 <3A44FEDB-631F-4DBA-8DB1-30C12C7864B3@nicira.com>
 <CAOsSsa7jz6GDLmZxCJPK_aAVq5gnvZjELD1ut-3BE7Qbgi0h-g@mail.gmail.com>
Message-ID: <CAG9LJa6VekFQQJSbF4TqBqiP-8C6vqQ3MU7TJJmATsZtgCfKog@mail.gmail.com>

If you want a "transparent" proxy, you don't need TCP termination you can
just forward the packet.
For your question, you can have a match all send to controller flow (lets
say with priority 100), then when you decide you don't need
the traffic to go to the controller you can install a flow with higher
priority for that session. (with forward actions)
(in the mean time your controller can just forward the packets to the
destination after it inspected them or did what ever it is
you want to do)

Another thing you can leverage is that OVS in master branch now has an
integration with conntrack.
You might be able to use it (
http://openvswitch.org/support/ovscon2014/17/1030-conntrack_nat.pdf)

What are you trying to do that require TCP termination?





On Sat, Sep 12, 2015 at 4:21 PM, Seyyed Hesamoddin Ghasemi <
s.hesam.ghasemi at gmail.com> wrote:

> Why not? As I know OVS have access to all header fields in layer 2 to
> layer 4!
> How can I Implement a simple proxy using OVS? I mean, how can get packet
> from a source node and send it to a destination node in a transparent
> manner?
>
> I need to get first 4 packet of a tcp session in the controller (as a
> proxy) and then forward the rest of packets using OVS without intervention
> of the controller and with keep current tcp session. How can I do that?
>
>
> On Sat, Sep 5, 2015 at 10:19 PM, Justin Pettit <jpettit at nicira.com> wrote:
>
>>
>> > On Sep 5, 2015, at 8:53 AM, Seyyed Hesamoddin Ghasemi <
>> s.hesam.ghasemi at gmail.com> wrote:
>> >
>> > Hi every body,
>> > I need to develop a proxy, and for this I should add/sub a constant
>> value to sequence number and ack number in ovs, Could somebody please help
>> me?
>>
>> OVS doesn't provide any visibility into the sequence numbers of TCP
>> packets.
>>
>> --Justin
>>
>>
>>
>
>
> --
> Seyyed Hesamoddin Ghasemi
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>


-- 
Best Regards ,

The G.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150912/af864c60/attachment-0001.html>

From s.hesam.ghasemi at gmail.com  Sat Sep 12 07:45:57 2015
From: s.hesam.ghasemi at gmail.com (Seyyed Hesamoddin Ghasemi)
Date: Sat, 12 Sep 2015 19:15:57 +0430
Subject: [ovs-discuss] add/sub a constant value to tcp sequence number
 and ack number in ovs
In-Reply-To: <CAG9LJa6VekFQQJSbF4TqBqiP-8C6vqQ3MU7TJJmATsZtgCfKog@mail.gmail.com>
References: <CAOsSsa7ozZmSGSO_wkY+KL4y-X0Cy-_SLQ3D=hFgJTouFV-yxQ@mail.gmail.com>
 <3A44FEDB-631F-4DBA-8DB1-30C12C7864B3@nicira.com>
 <CAOsSsa7jz6GDLmZxCJPK_aAVq5gnvZjELD1ut-3BE7Qbgi0h-g@mail.gmail.com>
 <CAG9LJa6VekFQQJSbF4TqBqiP-8C6vqQ3MU7TJJmATsZtgCfKog@mail.gmail.com>
Message-ID: <CAOsSsa7c+Q=kf6hHqYx2UTMQYKHfT2qFVXNdanthphf-6fuCGA@mail.gmail.com>

I my case, I have a pool (cluster) of servers and I want to Implement Layer
7 load-balancer (content-aware load- balancer). For this, I need to get
first 4 packet and then allocate a server in my cluster according to HTTP
header.

On Sat, Sep 12, 2015 at 7:04 PM, Gal Sagie <gal.sagie at gmail.com> wrote:

> If you want a "transparent" proxy, you don't need TCP termination you can
> just forward the packet.
> For your question, you can have a match all send to controller flow (lets
> say with priority 100), then when you decide you don't need
> the traffic to go to the controller you can install a flow with higher
> priority for that session. (with forward actions)
> (in the mean time your controller can just forward the packets to the
> destination after it inspected them or did what ever it is
> you want to do)
>
> Another thing you can leverage is that OVS in master branch now has an
> integration with conntrack.
> You might be able to use it (
> http://openvswitch.org/support/ovscon2014/17/1030-conntrack_nat.pdf)
>
> What are you trying to do that require TCP termination?
>
>
>
>
>
> On Sat, Sep 12, 2015 at 4:21 PM, Seyyed Hesamoddin Ghasemi <
> s.hesam.ghasemi at gmail.com> wrote:
>
>> Why not? As I know OVS have access to all header fields in layer 2 to
>> layer 4!
>> How can I Implement a simple proxy using OVS? I mean, how can get packet
>> from a source node and send it to a destination node in a transparent
>> manner?
>>
>> I need to get first 4 packet of a tcp session in the controller (as a
>> proxy) and then forward the rest of packets using OVS without intervention
>> of the controller and with keep current tcp session. How can I do that?
>>
>>
>> On Sat, Sep 5, 2015 at 10:19 PM, Justin Pettit <jpettit at nicira.com>
>> wrote:
>>
>>>
>>> > On Sep 5, 2015, at 8:53 AM, Seyyed Hesamoddin Ghasemi <
>>> s.hesam.ghasemi at gmail.com> wrote:
>>> >
>>> > Hi every body,
>>> > I need to develop a proxy, and for this I should add/sub a constant
>>> value to sequence number and ack number in ovs, Could somebody please help
>>> me?
>>>
>>> OVS doesn't provide any visibility into the sequence numbers of TCP
>>> packets.
>>>
>>> --Justin
>>>
>>>
>>>
>>
>>
>> --
>> Seyyed Hesamoddin Ghasemi
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
>>
>
>
> --
> Best Regards ,
>
> The G.
>



-- 
Seyyed Hesamoddin Ghasemi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150912/45c4cd49/attachment.html>

From s.hesam.ghasemi at gmail.com  Sat Sep 12 08:11:56 2015
From: s.hesam.ghasemi at gmail.com (Seyyed Hesamoddin Ghasemi)
Date: Sat, 12 Sep 2015 19:41:56 +0430
Subject: [ovs-discuss] add/sub a constant value to tcp sequence number
 and ack number in ovs
In-Reply-To: <CAOsSsa7c+Q=kf6hHqYx2UTMQYKHfT2qFVXNdanthphf-6fuCGA@mail.gmail.com>
References: <CAOsSsa7ozZmSGSO_wkY+KL4y-X0Cy-_SLQ3D=hFgJTouFV-yxQ@mail.gmail.com>
 <3A44FEDB-631F-4DBA-8DB1-30C12C7864B3@nicira.com>
 <CAOsSsa7jz6GDLmZxCJPK_aAVq5gnvZjELD1ut-3BE7Qbgi0h-g@mail.gmail.com>
 <CAG9LJa6VekFQQJSbF4TqBqiP-8C6vqQ3MU7TJJmATsZtgCfKog@mail.gmail.com>
 <CAOsSsa7c+Q=kf6hHqYx2UTMQYKHfT2qFVXNdanthphf-6fuCGA@mail.gmail.com>
Message-ID: <CAOsSsa6F+7Zd9oJONgU7AZKu8qMnYXRxNEjT_Ns5+rJfUQ57Nw@mail.gmail.com>

To achieve this, Client needs to establish a session to the controller and
when controller receives HTTP packet from the client, then decide to
redirect this session to the accurate server in a transparent manner. Am I
right?

On Sat, Sep 12, 2015 at 7:15 PM, Seyyed Hesamoddin Ghasemi <
s.hesam.ghasemi at gmail.com> wrote:

> I my case, I have a pool (cluster) of servers and I want to Implement
> Layer 7 load-balancer (content-aware load- balancer). For this, I need to
> get first 4 packet and then allocate a server in my cluster according to
> HTTP header.
>
> On Sat, Sep 12, 2015 at 7:04 PM, Gal Sagie <gal.sagie at gmail.com> wrote:
>
>> If you want a "transparent" proxy, you don't need TCP termination you can
>> just forward the packet.
>> For your question, you can have a match all send to controller flow (lets
>> say with priority 100), then when you decide you don't need
>> the traffic to go to the controller you can install a flow with higher
>> priority for that session. (with forward actions)
>> (in the mean time your controller can just forward the packets to the
>> destination after it inspected them or did what ever it is
>> you want to do)
>>
>> Another thing you can leverage is that OVS in master branch now has an
>> integration with conntrack.
>> You might be able to use it (
>> http://openvswitch.org/support/ovscon2014/17/1030-conntrack_nat.pdf)
>>
>> What are you trying to do that require TCP termination?
>>
>>
>>
>>
>>
>> On Sat, Sep 12, 2015 at 4:21 PM, Seyyed Hesamoddin Ghasemi <
>> s.hesam.ghasemi at gmail.com> wrote:
>>
>>> Why not? As I know OVS have access to all header fields in layer 2 to
>>> layer 4!
>>> How can I Implement a simple proxy using OVS? I mean, how can get packet
>>> from a source node and send it to a destination node in a transparent
>>> manner?
>>>
>>> I need to get first 4 packet of a tcp session in the controller (as a
>>> proxy) and then forward the rest of packets using OVS without intervention
>>> of the controller and with keep current tcp session. How can I do that?
>>>
>>>
>>> On Sat, Sep 5, 2015 at 10:19 PM, Justin Pettit <jpettit at nicira.com>
>>> wrote:
>>>
>>>>
>>>> > On Sep 5, 2015, at 8:53 AM, Seyyed Hesamoddin Ghasemi <
>>>> s.hesam.ghasemi at gmail.com> wrote:
>>>> >
>>>> > Hi every body,
>>>> > I need to develop a proxy, and for this I should add/sub a constant
>>>> value to sequence number and ack number in ovs, Could somebody please help
>>>> me?
>>>>
>>>> OVS doesn't provide any visibility into the sequence numbers of TCP
>>>> packets.
>>>>
>>>> --Justin
>>>>
>>>>
>>>>
>>>
>>>
>>> --
>>> Seyyed Hesamoddin Ghasemi
>>>
>>> _______________________________________________
>>> discuss mailing list
>>> discuss at openvswitch.org
>>> http://openvswitch.org/mailman/listinfo/discuss
>>>
>>>
>>
>>
>> --
>> Best Regards ,
>>
>> The G.
>>
>
>
>
> --
> Seyyed Hesamoddin Ghasemi
>



-- 
Seyyed Hesamoddin Ghasemi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150912/3dee07a5/attachment.html>

From blp at nicira.com  Sat Sep 12 10:48:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Sat, 12 Sep 2015 10:48:20 -0700
Subject: [ovs-discuss] Problems with OpenFlow 1.5 in Open vSwitch
In-Reply-To: <DUB110-W85F604B209219DFB6300B5B25F0@phx.gbl>
References: <DUB110-W95E0F0C9F75DABFAE08016B2500@phx.gbl>
 <20150911161420.GB28754@nicira.com>
 <DUB110-W85F604B209219DFB6300B5B25F0@phx.gbl>
Message-ID: <20150912174820.GE17563@nicira.com>

Please don't drop the mailing list.

It looks like this bug was fixed after OVS 2.4 was released.  You can
test the version that's on master.

I'm not going to backport it to OVS 2.4 because OVS 2.4 doesn't fully
support OF1.5.

On Sat, Sep 12, 2015 at 11:11:07AM +0200, Egoitz Urrutia wrote:
> But now I am doing only a ping and the error persist.
> I am trying to make a work based on scheduled bundles. The controller was updated to OF15 but OvS I don't know.
> Is able the feature that allows the scheduled bundles?
> Thanks a lot,Egoitz
> > Date: Fri, 11 Sep 2015 09:14:20 -0700
> > From: blp at nicira.com
> > To: egoitz at hotmail.es
> > CC: discuss at openvswitch.org
> > Subject: Re: [ovs-discuss] Problems with OpenFlow 1.5 in Open vSwitch
> > 
> > On Fri, Sep 11, 2015 at 12:04:48PM +0200, Egoitz Urrutia wrote:
> > > I am having problems with the connection Switch - Controller using OF15. 
> > > I work in a mininet network enviroment, and I put OF15 to the switch with this command:
> > 
> > Support for OpenFlow 1.5 isn't complete, so you shouldn't bother to
> > enable it unless you're planning to work on developing it.
>  		 	   		  

From jpettit at nicira.com  Sat Sep 12 11:09:15 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Sat, 12 Sep 2015 11:09:15 -0700
Subject: [ovs-discuss] add/sub a constant value to tcp sequence number
	and ack number in ovs
In-Reply-To: <CAOsSsa7jz6GDLmZxCJPK_aAVq5gnvZjELD1ut-3BE7Qbgi0h-g@mail.gmail.com>
References: <CAOsSsa7ozZmSGSO_wkY+KL4y-X0Cy-_SLQ3D=hFgJTouFV-yxQ@mail.gmail.com>
 <3A44FEDB-631F-4DBA-8DB1-30C12C7864B3@nicira.com>
 <CAOsSsa7jz6GDLmZxCJPK_aAVq5gnvZjELD1ut-3BE7Qbgi0h-g@mail.gmail.com>
Message-ID: <56EF6A4B-505D-4039-B1F4-5ABCB9EE2928@nicira.com>


> On Sep 12, 2015, at 6:21 AM, Seyyed Hesamoddin Ghasemi <s.hesam.ghasemi at gmail.com> wrote:
> 
> Why not? As I know OVS have access to all header fields in layer 2 to layer 4! 

We don't provide the ability to match on sequence numbers because they're not generally very useful for forwarding decisions, and it would have a horrible impact on performance.

> How can I Implement a simple proxy using OVS? I mean, how can get packet from a source node and send it to a destination node in a transparent manner?
> 
> I need to get first 4 packet of a tcp session in the controller (as a proxy) and then forward the rest of packets using OVS without intervention of the controller and with keep current tcp session. How can I do that? 

As Gal mentioned, I think the way to do it is by building on the conntrack work.  Some of the developers at VMware are starting to think about how to add that support to OVS.  Adding load-balancing will probably be built on top of NAT support, which will be built on conntrack.  If you're interested in doing this work yourself, I'd recommend looking into that, too.

--Justin




From s.hesam.ghasemi at gmail.com  Sat Sep 12 12:10:17 2015
From: s.hesam.ghasemi at gmail.com (Seyyed Hesamoddin Ghasemi)
Date: Sat, 12 Sep 2015 23:40:17 +0430
Subject: [ovs-discuss] add/sub a constant value to tcp sequence number
 and ack number in ovs
In-Reply-To: <56EF6A4B-505D-4039-B1F4-5ABCB9EE2928@nicira.com>
References: <CAOsSsa7ozZmSGSO_wkY+KL4y-X0Cy-_SLQ3D=hFgJTouFV-yxQ@mail.gmail.com>
 <3A44FEDB-631F-4DBA-8DB1-30C12C7864B3@nicira.com>
 <CAOsSsa7jz6GDLmZxCJPK_aAVq5gnvZjELD1ut-3BE7Qbgi0h-g@mail.gmail.com>
 <56EF6A4B-505D-4039-B1F4-5ABCB9EE2928@nicira.com>
Message-ID: <CAOsSsa4qZj=LtBSdtq=0V0+qLoSDvvnarfKPFx5TeQR08HaAJA@mail.gmail.com>

Tnx Gal and Justin,
But  why they don't provide visibility of sequence number and ack number to
the OVS? If it could be possible, the SDN controller can establish TCP
connections, and when get the http packet it can set a rule for that flow
in the OVS. this rule can contain action fileds i.e. add/sub a constant
value to sequence number and add/sub another constant value to the ack
number (like proxy).In this case the rest of the packets of this session
forwarded through OVS. By this feature we can implement content-aware load
balancer.

On Sat, Sep 12, 2015 at 10:39 PM, Justin Pettit <jpettit at nicira.com> wrote:

>
> > On Sep 12, 2015, at 6:21 AM, Seyyed Hesamoddin Ghasemi <
> s.hesam.ghasemi at gmail.com> wrote:
> >
> > Why not? As I know OVS have access to all header fields in layer 2 to
> layer 4!
>
> We don't provide the ability to match on sequence numbers because they're
> not generally very useful for forwarding decisions, and it would have a
> horrible impact on performance.
>
> > How can I Implement a simple proxy using OVS? I mean, how can get packet
> from a source node and send it to a destination node in a transparent
> manner?
> >
> > I need to get first 4 packet of a tcp session in the controller (as a
> proxy) and then forward the rest of packets using OVS without intervention
> of the controller and with keep current tcp session. How can I do that?
>
> As Gal mentioned, I think the way to do it is by building on the conntrack
> work.  Some of the developers at VMware are starting to think about how to
> add that support to OVS.  Adding load-balancing will probably be built on
> top of NAT support, which will be built on conntrack.  If you're interested
> in doing this work yourself, I'd recommend looking into that, too.
>
> --Justin
>
>
>
>


-- 
Seyyed Hesamoddin Ghasemi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150912/52d54e70/attachment.html>

From mariano.lopezv at yahoo.com  Sun Sep 13 18:44:05 2015
From: mariano.lopezv at yahoo.com (Mariano Lopez)
Date: Mon, 14 Sep 2015 01:44:05 +0000 (UTC)
Subject: [ovs-discuss] Get vswitch without ovs tools
Message-ID: <996491250.1889190.1442195045475.JavaMail.yahoo@mail.yahoo.com>

I'm trying to get if an interface is attached to a vswitch and to what switch is attached.

Let me put this a little bit of context here, I want to use hostapd with ovs; the challenge here is hostapd needs to register the interfaces that will recieve EAPOL in order to authenticate the wireless hosts. To register the interface the current devel version hostapd will try to get the master interface from /sys/class/net/<interface>/master; the problem with ovs is that it will return "ovs-system" interface, but this is not the actual vswitch interface.

So the question here, is there a way to get to what vswitch is attached the interface without using the ovs commands?

Thanks

From fred at mautadine.com  Sun Sep 13 20:27:49 2015
From: fred at mautadine.com (=?UTF-8?Q?Fr=C3=A9d=C3=A9ric_Marchand?=)
Date: Mon, 14 Sep 2015 05:27:49 +0200
Subject: [ovs-discuss] first ping lost
Message-ID: <CAGHyHJ0wq87sMGt4VstFzmfv4gOShpLi0Aopdg86ZwcdmSfdCA@mail.gmail.com>

Hello all,

I've installed and configured openvswitch 2.3.1 on 3 machines (ubuntu
15.04). I've created a bridge with two interfaces in LACP balance-tcp.
I also added some fake bridges with vlan tags.

The problem i have is when I ping one of the fake bridge, the first
ping is lost (unless there is a tcp connection already up!):

PING 10.10.22.11 (10.10.22.11) 56(84) bytes of data.
64 bytes from 10.10.22.11: icmp_seq=2 ttl=64 time=0.419 ms
64 bytes from 10.10.22.11: icmp_seq=3 ttl=64 time=0.361 ms

Here is the configuration:

ovs-vsctl add-br br-main
ovs-vsctl ovs-vsctl add-bond br-main bond0 em1 em2
ovs-vsctl set port bond0 bond_mode=balance-tcp
ovs-vsctl set port bond0 lacp=active
ovs-vsctl add-br br-data br-main 22
ip addr add 10.10.22.11/24 dev br-data

LACP seems fine:
---- bond0 ----
status: active negotiated
sys_id: 34:64:a9:9a:5f:00
sys_priority: 65534
aggregation key: 1
lacp_time: slow

The machines have broadcom BCM5720 interfaces using tg3 drivers.

Also, i guess it's linked, DNS queries coming out this interface
timeout most of the time. But if i ping the DNS server while doing an
nslookup, it works fine.

Anyone knows what is the problem?

Thanks,

Fred

From deepankar.gupta at tcs.com  Mon Sep 14 03:03:44 2015
From: deepankar.gupta at tcs.com (Deepankar Gupta)
Date: Mon, 14 Sep 2015 15:33:44 +0530
Subject: [ovs-discuss] GTP  OpenVSwitch Support
Message-ID: <OF01FF93B5.105A6964-ON65257EC0.0036FA5E-65257EC0.00374636@tcs.com>

Hi 
Wanted to know, if  OpenVSwitch supports  GPRS Tunnelling Protocol (GTP). 

Thanks & Regards
Deepankar Gupta
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150914/2714b7aa/attachment.html>

From erlacher at in.tum.de  Mon Sep 14 04:05:34 2015
From: erlacher at in.tum.de (Lukas Erlacher)
Date: Mon, 14 Sep 2015 13:05:34 +0200
Subject: [ovs-discuss] first ping lost
In-Reply-To: <CAGHyHJ0wq87sMGt4VstFzmfv4gOShpLi0Aopdg86ZwcdmSfdCA@mail.gmail.com>
References: <CAGHyHJ0wq87sMGt4VstFzmfv4gOShpLi0Aopdg86ZwcdmSfdCA@mail.gmail.com>
Message-ID: <55F6A9FE.9060308@in.tum.de>

Hi,
On 09/14/2015 05:27 AM, Frédéric Marchand wrote:
> Hello all,
>
> I've installed and configured openvswitch 2.3.1 on 3 machines (ubuntu
> 15.04). I've created a bridge with two interfaces in LACP balance-tcp.
> I also added some fake bridges with vlan tags.
>
> The problem i have is when I ping one of the fake bridge, the first
> ping is lost (unless there is a tcp connection already up!):
>
> PING 10.10.22.11 (10.10.22.11) 56(84) bytes of data.
> 64 bytes from 10.10.22.11: icmp_seq=2 ttl=64 time=0.419 ms
> 64 bytes from 10.10.22.11: icmp_seq=3 ttl=64 time=0.361 ms
Are you sure that's not just an empty arp cache?
>
> Here is the configuration:
>
> ovs-vsctl add-br br-main
> ovs-vsctl ovs-vsctl add-bond br-main bond0 em1 em2
> ovs-vsctl set port bond0 bond_mode=balance-tcp
> ovs-vsctl set port bond0 lacp=active
> ovs-vsctl add-br br-data br-main 22
> ip addr add 10.10.22.11/24 dev br-data
>
> LACP seems fine:
> ---- bond0 ----
> status: active negotiated
> sys_id: 34:64:a9:9a:5f:00
> sys_priority: 65534
> aggregation key: 1
> lacp_time: slow
>
> The machines have broadcom BCM5720 interfaces using tg3 drivers.
>
> Also, i guess it's linked, DNS queries coming out this interface
> timeout most of the time. But if i ping the DNS server while doing an
> nslookup, it works fine.
>
> Anyone knows what is the problem?
Could still be an arp problem. Run "arp" before and after trying to send 
those requests. If it's an arp problem, it should always be the first 
packet that gets lost and all subsequent packets/requests should be fine.

Best,
Luke

From blp at nicira.com  Mon Sep 14 07:46:51 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 14 Sep 2015 07:46:51 -0700
Subject: [ovs-discuss] GTP  OpenVSwitch Support
In-Reply-To: <OF01FF93B5.105A6964-ON65257EC0.0036FA5E-65257EC0.00374636@tcs.com>
References: <OF01FF93B5.105A6964-ON65257EC0.0036FA5E-65257EC0.00374636@tcs.com>
Message-ID: <20150914144651.GA20952@nicira.com>

On Mon, Sep 14, 2015 at 03:33:44PM +0530, Deepankar Gupta wrote:
> Wanted to know, if  OpenVSwitch supports  GPRS Tunnelling Protocol (GTP). 

No.

From blp at nicira.com  Mon Sep 14 07:51:32 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 14 Sep 2015 07:51:32 -0700
Subject: [ovs-discuss] Problems with OpenFlow 1.5 in Open vSwitch
In-Reply-To: <DUB110-W111815F2B545DF7A69DCA9FB25D0@phx.gbl>
References: <DUB110-W95E0F0C9F75DABFAE08016B2500@phx.gbl>
 <20150911161420.GB28754@nicira.com>
 <DUB110-W85F604B209219DFB6300B5B25F0@phx.gbl>
 <20150912174820.GE17563@nicira.com>
 <DUB110-W111815F2B545DF7A69DCA9FB25D0@phx.gbl>
Message-ID: <20150914145132.GD20952@nicira.com>

On Mon, Sep 14, 2015 at 11:48:34AM +0200, Egoitz Urrutia wrote:
> I am trying to install OvS from master, but I don't find the configure
> file. How can I install that?

Read INSTALL.md and follow the instructions.

> The master versions support OF1.5 and scheduled bundles?

No.

From blp at nicira.com  Mon Sep 14 07:52:54 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 14 Sep 2015 07:52:54 -0700
Subject: [ovs-discuss] Get vswitch without ovs tools
In-Reply-To: <996491250.1889190.1442195045475.JavaMail.yahoo@mail.yahoo.com>
References: <996491250.1889190.1442195045475.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <20150914145254.GE20952@nicira.com>

On Mon, Sep 14, 2015 at 01:44:05AM +0000, Mariano Lopez wrote:
> So the question here, is there a way to get to what vswitch is
> attached the interface without using the ovs commands?

If you prefer, you can use the OVSDB bindings to C or Python (or another
language) to do this.

From almazsite at mail.ru  Mon Sep 14 01:01:58 2015
From: almazsite at mail.ru (=?UTF-8?B?QSBB?=)
Date: Mon, 14 Sep 2015 11:01:58 +0300
Subject: [ovs-discuss] =?utf-8?q?openvswitch_as_VPN?=
Message-ID: <1442217718.242586803@f416.i.mail.ru>

 Hi OVS gurus!


I want to create VPN with Openvswitch
I tried n2n VPN with OVS
it works fine, but n2n will not support anymore

I tried IPSEc in openvswitch, I followed  http://akry.github.io/gre-and-gre-over-ipsec-on-open-vswitch.html
but it didn't work 


Please help with  example on vpn with MESH openvswitch

Almaz


-- 
A A
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150914/3b72bb0e/attachment.html>

From egoitz at hotmail.es  Mon Sep 14 02:48:34 2015
From: egoitz at hotmail.es (Egoitz Urrutia)
Date: Mon, 14 Sep 2015 11:48:34 +0200
Subject: [ovs-discuss] Problems with OpenFlow 1.5 in Open vSwitch
In-Reply-To: <20150912174820.GE17563@nicira.com>
References: <DUB110-W95E0F0C9F75DABFAE08016B2500@phx.gbl>,
 <20150911161420.GB28754@nicira.com>,
 <DUB110-W85F604B209219DFB6300B5B25F0@phx.gbl>,
 <20150912174820.GE17563@nicira.com>
Message-ID: <DUB110-W111815F2B545DF7A69DCA9FB25D0@phx.gbl>

Sorry I am new in email lists,
I am trying to install OvS from master, but I don't find the configure file. How can I install that?
The master versions support OF1.5 and scheduled bundles?
Thanks a lot,Egoitz

> Date: Sat, 12 Sep 2015 10:48:20 -0700
> From: blp at nicira.com
> To: egoitz at hotmail.es
> CC: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Problems with OpenFlow 1.5 in Open vSwitch
> 
> Please don't drop the mailing list.
> 
> It looks like this bug was fixed after OVS 2.4 was released.  You can
> test the version that's on master.
> 
> I'm not going to backport it to OVS 2.4 because OVS 2.4 doesn't fully
> support OF1.5.
> 
> On Sat, Sep 12, 2015 at 11:11:07AM +0200, Egoitz Urrutia wrote:
> > But now I am doing only a ping and the error persist.
> > I am trying to make a work based on scheduled bundles. The controller was updated to OF15 but OvS I don't know.
> > Is able the feature that allows the scheduled bundles?
> > Thanks a lot,Egoitz
> > > Date: Fri, 11 Sep 2015 09:14:20 -0700
> > > From: blp at nicira.com
> > > To: egoitz at hotmail.es
> > > CC: discuss at openvswitch.org
> > > Subject: Re: [ovs-discuss] Problems with OpenFlow 1.5 in Open vSwitch
> > > 
> > > On Fri, Sep 11, 2015 at 12:04:48PM +0200, Egoitz Urrutia wrote:
> > > > I am having problems with the connection Switch - Controller using OF15. 
> > > > I work in a mininet network enviroment, and I put OF15 to the switch with this command:
> > > 
> > > Support for OpenFlow 1.5 isn't complete, so you shouldn't bother to
> > > enable it unless you're planning to work on developing it.
> >  		 	   		  
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150914/237cd84f/attachment.html>

From fred at mautadine.com  Mon Sep 14 11:14:41 2015
From: fred at mautadine.com (=?UTF-8?Q?Fr=C3=A9d=C3=A9ric_Marchand?=)
Date: Mon, 14 Sep 2015 20:14:41 +0200
Subject: [ovs-discuss] first ping lost
In-Reply-To: <55F6A9FE.9060308@in.tum.de>
References: <CAGHyHJ0wq87sMGt4VstFzmfv4gOShpLi0Aopdg86ZwcdmSfdCA@mail.gmail.com>
 <55F6A9FE.9060308@in.tum.de>
Message-ID: <CAGHyHJ33UJiH2Vw_VKok6uVEJLbmyqWqbD_=ShHwEy45E-Kf8Q@mail.gmail.com>

Hello,

Thanks for the reply but I don't think it's arp. The arp table have
the correct information and also, i tried with static entries on both
side.

Maybe I should have mentioned that earlier: when i'm connected to ssh
through one of those fake bridges, the login takes a while (3-4
seconds, dns timeouts) then it's ok. And if i don't make any input for
more than 5 seconds, the next input lag a few hundred milliseconds
(kernel flows TTL?)

By the way, I don't experience those issues using linux bonding and vlan.

Regards,

Fred




On Mon, Sep 14, 2015 at 1:05 PM, Lukas Erlacher <erlacher at in.tum.de> wrote:
> Hi,
> On 09/14/2015 05:27 AM, Frédéric Marchand wrote:
>>
>> Hello all,
>>
>> I've installed and configured openvswitch 2.3.1 on 3 machines (ubuntu
>> 15.04). I've created a bridge with two interfaces in LACP balance-tcp.
>> I also added some fake bridges with vlan tags.
>>
>> The problem i have is when I ping one of the fake bridge, the first
>> ping is lost (unless there is a tcp connection already up!):
>>
>> PING 10.10.22.11 (10.10.22.11) 56(84) bytes of data.
>> 64 bytes from 10.10.22.11: icmp_seq=2 ttl=64 time=0.419 ms
>> 64 bytes from 10.10.22.11: icmp_seq=3 ttl=64 time=0.361 ms
>
> Are you sure that's not just an empty arp cache?
>>
>>
>> Here is the configuration:
>>
>> ovs-vsctl add-br br-main
>> ovs-vsctl ovs-vsctl add-bond br-main bond0 em1 em2
>> ovs-vsctl set port bond0 bond_mode=balance-tcp
>> ovs-vsctl set port bond0 lacp=active
>> ovs-vsctl add-br br-data br-main 22
>> ip addr add 10.10.22.11/24 dev br-data
>>
>> LACP seems fine:
>> ---- bond0 ----
>> status: active negotiated
>> sys_id: 34:64:a9:9a:5f:00
>> sys_priority: 65534
>> aggregation key: 1
>> lacp_time: slow
>>
>> The machines have broadcom BCM5720 interfaces using tg3 drivers.
>>
>> Also, i guess it's linked, DNS queries coming out this interface
>> timeout most of the time. But if i ping the DNS server while doing an
>> nslookup, it works fine.
>>
>> Anyone knows what is the problem?
>
> Could still be an arp problem. Run "arp" before and after trying to send
> those requests. If it's an arp problem, it should always be the first packet
> that gets lost and all subsequent packets/requests should be fine.
>
> Best,
> Luke
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From davidjoshuaevans at gmail.com  Mon Sep 14 21:57:10 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Mon, 14 Sep 2015 23:57:10 -0500
Subject: [ovs-discuss] tnl arp causes infinite reentrant stack death.
Message-ID: <CAB8HAh5oJu3EkWmjY19WFnKU18gQyMDmY43D3K1RTkWn7VGPSg@mail.gmail.com>

Hi OVS.

i am using rev 2.3.2+29bae5412ea3c6a1e20d79afd25c11b968dffa05-r0

As you can see from my gdb backtrace 13K frames deep below we get an arp
request because build_tunnel_send (frame 13659 below) decided we're
starting to use a gre tunnel on a bridge and there's no arp cache for the
destination yet.

so what follows is  xlate_flood_packet -> ofproto_dpif_execute_actions ->
xlate_actions -> do_xlate_actions -> xlate_output_action -> flood_packet
-> compose_output_action -> compose_output_action__ -> xlate_table_action
-> xlate_recusively
-> do_xlate_actions (* a few actions) then we get back to
compose_output_action__ and build_tunnel_send again.

So infinitely the code will generate arp packets, but never deliver any of
the arps out to the linux stack and keeps re-entering till it exhausts the
stack

How do i stop this?

The arp packet is set up with OFPP_FLOOD. I am not sure that this is
correct since i just want it pushed out to the linux stack to find me a
destination ?
Maybe this is the hint that something is not right?

My situation looks like:

dpdk0 traffic in -> br0 bridge -> netdev-vport gre out -> linux stack ->
breth1 internal interface -> breth1 bridge -> dpdk1 -> some gre destination
on a network.

Cheers,
Dave.


#13600 0x000000000056d04b in compose_output_action__
(ctx=ctx at entry=0x7f402f7ef290,
ofp_port=<optimized out>, xr=xr at entry=0x0, check_stp=check_stp at entry=true)

    at ofproto/ofproto-dpif-xlate.c:2865

#13601 0x000000000056de1a in compose_output_action (xr=0x0,
ofp_port=<optimized out>, ctx=0x7f402f7ef290)

    at ofproto/ofproto-dpif-xlate.c:3072

#13602 flood_packets (ctx=ctx at entry=0x7f402f7ef290, all=all at entry=false)

    at ofproto/ofproto-dpif-xlate.c:3441

#13603 0x000000000056e312 in xlate_output_action (ctx=ctx at entry=0x7f402f7ef290,
port=<optimized out>, max_len=<optimized out>,
may_packet_in=may_packet_in at entry=true)

    at ofproto/ofproto-dpif-xlate.c:3791

#13604 0x000000000056a945 in do_xlate_actions
(ofpacts=ofpacts at entry=0x7f402f7f0980,
ofpacts_len=ofpacts_len at entry=8, ctx=ctx at entry=0x7f402f7ef290)

    at ofproto/ofproto-dpif-xlate.c:4239

#13605 0x000000000056fda1 in xlate_actions (xin=xin at entry=0x7f402f7efe80,
xout=xout at entry=0x7f402f7efde0)

    at ofproto/ofproto-dpif-xlate.c:5112

#13606 0x000000000055a39e in ofproto_dpif_execute_actions
(ofproto=0xa30eb0, flow=flow at entry=0x7f402f7f0f80, rule=rule at entry=0x0,
ofpacts=ofpacts at entry=0x7f402f7f0980, ofpacts_len=ofpacts_len at entry=8,

    packet=packet at entry=0x7f402f7f0b80) at / /ofproto/ofproto-dpif.c:3670

#13607 0x000000000056d5ad in xlate_flood_packet (xbridge=0x35a8b00,
packet=0x7f402f7f0b80)

    at / /ofproto/ofproto-dpif-xlate.c:2704

#13608 tnl_send_arp_request (out_dev=<optimized out>, ip_dst=1294734859,
ip_src=<optimized out>, eth_src=0x7f402f7f0640 "")

    at / /ofproto/ofproto-dpif-xlate.c:2720

#13609 build_tunnel_send (xport=<optimized out>, tunnel_odp_port=26,
flow=0x7f402f7f3a48, ctx=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:2761

#13610 compose_output_action__ (ctx=ctx at entry=0x7f402f7f2e50,
ofp_port=<optimized out>, xr=xr at entry=0x0, check_stp=check_stp at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:3022

#13611 0x000000000056e356 in compose_output_action (xr=0x0,
ofp_port=<optimized out>, ctx=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:3072

#13612 xlate_output_action (ctx=ctx at entry=0x7f402f7f2e50, port=<optimized
out>, max_len=<optimized out>, may_packet_in=may_packet_in at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:3808

#13613 0x000000000056a945 in do_xlate_actions (ofpacts=<optimized out>,
ofpacts_len=8, ctx=ctx at entry=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:4239

#13614 0x000000000056c2fa in xlate_recursively (rule=0xadf9a0,
ctx=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:3091

#13615 xlate_table_action (ctx=0x7f402f7f2e50, in_port=<optimized out>,
table_id=<optimized out>, may_packet_in=<optimized out>,
honor_table_miss=<optimized out>)

    at / /ofproto/ofproto-dpif-xlate.c:3156

#13616 0x000000000056b845 in do_xlate_actions (ofpacts=<optimized out>,
ofpacts_len=6, ctx=ctx at entry=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:4596

#13617 0x000000000056c2fa in xlate_recursively (rule=0xad7dc0,
ctx=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:3091

#13618 xlate_table_action (ctx=0x7f402f7f2e50, in_port=<optimized out>,
table_id=<optimized out>, may_packet_in=<optimized out>,
honor_table_miss=<optimized out>)

    at / /ofproto/ofproto-dpif-xlate.c:3156

#13619 0x000000000056b845 in do_xlate_actions (ofpacts=<optimized out>,
ofpacts_len=6, ctx=ctx at entry=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:4596

---Type <return> to continue, or q <return> to quit---

#13620 0x000000000056c2fa in xlate_recursively (rule=0xad78d0,
ctx=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:3091

#13621 xlate_table_action (ctx=0x7f402f7f2e50, in_port=<optimized out>,
table_id=<optimized out>, may_packet_in=<optimized out>,
honor_table_miss=<optimized out>)

    at / /ofproto/ofproto-dpif-xlate.c:3156

#13622 0x000000000056b845 in do_xlate_actions (ofpacts=<optimized out>,
ofpacts_len=6, ctx=ctx at entry=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:4596

#13623 0x000000000056c2fa in xlate_recursively (rule=0xad76c0,
ctx=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:3091

#13624 xlate_table_action (ctx=0x7f402f7f2e50, in_port=<optimized out>,
table_id=<optimized out>, may_packet_in=<optimized out>,
honor_table_miss=<optimized out>)

    at / /ofproto/ofproto-dpif-xlate.c:3156

#13625 0x000000000056d04b in compose_output_action__
(ctx=ctx at entry=0x7f402f7f2e50,
ofp_port=<optimized out>, xr=xr at entry=0x0, check_stp=check_stp at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:2865

#13626 0x000000000056de1a in compose_output_action (xr=0x0,
ofp_port=<optimized out>, ctx=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:3072

#13627 flood_packets (ctx=ctx at entry=0x7f402f7f2e50, all=all at entry=false)

    at / /ofproto/ofproto-dpif-xlate.c:3441

#13628 0x000000000056e312 in xlate_output_action (ctx=ctx at entry=0x7f402f7f2e50,
port=<optimized out>, max_len=<optimized out>,
may_packet_in=may_packet_in at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:3791

#13629 0x000000000056a945 in do_xlate_actions
(ofpacts=ofpacts at entry=0x7f402f7f4540,
ofpacts_len=ofpacts_len at entry=8, ctx=ctx at entry=0x7f402f7f2e50)

    at / /ofproto/ofproto-dpif-xlate.c:4239

#13630 0x000000000056fda1 in xlate_actions (xin=xin at entry=0x7f402f7f3a40,
xout=xout at entry=0x7f402f7f39a0)

    at / /ofproto/ofproto-dpif-xlate.c:5112

#13631 0x000000000055a39e in ofproto_dpif_execute_actions
(ofproto=0xa30eb0, flow=flow at entry=0x7f402f7f4b40, rule=rule at entry=0x0,
ofpacts=ofpacts at entry=0x7f402f7f4540, ofpacts_len=ofpacts_len at entry=8,

    packet=packet at entry=0x7f402f7f4740) at / /ofproto/ofproto-dpif.c:3670

#13632 0x000000000056d5ad in xlate_flood_packet (xbridge=0x35a8b00,
packet=0x7f402f7f4740)

    at / /ofproto/ofproto-dpif-xlate.c:2704

#13633 tnl_send_arp_request (out_dev=<optimized out>, ip_dst=1294734859,
ip_src=<optimized out>, eth_src=0x7f402f7f4200 "")

    at / /ofproto/ofproto-dpif-xlate.c:2720

#13634 build_tunnel_send (xport=<optimized out>, tunnel_odp_port=26,
flow=0x7f402f7f7608, ctx=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:2761

#13635 compose_output_action__ (ctx=ctx at entry=0x7f402f7f6a10,
ofp_port=<optimized out>, xr=xr at entry=0x0, check_stp=check_stp at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:3022

#13636 0x000000000056e356 in compose_output_action (xr=0x0,
ofp_port=<optimized out>, ctx=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:3072

#13637 xlate_output_action (ctx=ctx at entry=0x7f402f7f6a10, port=<optimized
out>, max_len=<optimized out>, may_packet_in=may_packet_in at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:3808

#13638 0x000000000056a945 in do_xlate_actions (ofpacts=<optimized out>,
ofpacts_len=8, ctx=ctx at entry=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:4239

#13639 0x000000000056c2fa in xlate_recursively (rule=0xadf9a0,
ctx=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:3091

---Type <return> to continue, or q <return> to quit---

#13640 xlate_table_action (ctx=0x7f402f7f6a10, in_port=<optimized out>,
table_id=<optimized out>, may_packet_in=<optimized out>,
honor_table_miss=<optimized out>)

    at / /ofproto/ofproto-dpif-xlate.c:3156

#13641 0x000000000056b845 in do_xlate_actions (ofpacts=<optimized out>,
ofpacts_len=6, ctx=ctx at entry=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:4596

#13642 0x000000000056c2fa in xlate_recursively (rule=0xad7dc0,
ctx=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:3091

#13643 xlate_table_action (ctx=0x7f402f7f6a10, in_port=<optimized out>,
table_id=<optimized out>, may_packet_in=<optimized out>,
honor_table_miss=<optimized out>)

    at / /ofproto/ofproto-dpif-xlate.c:3156

#13644 0x000000000056b845 in do_xlate_actions (ofpacts=<optimized out>,
ofpacts_len=6, ctx=ctx at entry=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:4596

#13645 0x000000000056c2fa in xlate_recursively (rule=0xad78d0,
ctx=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:3091

#13646 xlate_table_action (ctx=0x7f402f7f6a10, in_port=<optimized out>,
table_id=<optimized out>, may_packet_in=<optimized out>,
honor_table_miss=<optimized out>)

    at / /ofproto/ofproto-dpif-xlate.c:3156

#13647 0x000000000056b845 in do_xlate_actions (ofpacts=<optimized out>,
ofpacts_len=6, ctx=ctx at entry=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:4596

#13648 0x000000000056c2fa in xlate_recursively (rule=0xad76c0,
ctx=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:3091

#13649 xlate_table_action (ctx=0x7f402f7f6a10, in_port=<optimized out>,
table_id=<optimized out>, may_packet_in=<optimized out>,
honor_table_miss=<optimized out>)

    at / /ofproto/ofproto-dpif-xlate.c:3156

#13650 0x000000000056d04b in compose_output_action__
(ctx=ctx at entry=0x7f402f7f6a10,
ofp_port=<optimized out>, xr=xr at entry=0x0, check_stp=check_stp at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:2865

#13651 0x000000000056de1a in compose_output_action (xr=0x0,
ofp_port=<optimized out>, ctx=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:3072

#13652 flood_packets (ctx=ctx at entry=0x7f402f7f6a10, all=all at entry=false)

    at / /ofproto/ofproto-dpif-xlate.c:3441

#13653 0x000000000056e312 in xlate_output_action (ctx=ctx at entry=0x7f402f7f6a10,
port=<optimized out>, max_len=<optimized out>,
may_packet_in=may_packet_in at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:3791

#13654 0x000000000056a945 in do_xlate_actions
(ofpacts=ofpacts at entry=0x7f402f7f8100,
ofpacts_len=ofpacts_len at entry=8, ctx=ctx at entry=0x7f402f7f6a10)

    at / /ofproto/ofproto-dpif-xlate.c:4239

#13655 0x000000000056fda1 in xlate_actions (xin=xin at entry=0x7f402f7f7600,
xout=xout at entry=0x7f402f7f7560)

    at / /ofproto/ofproto-dpif-xlate.c:5112

#13656 0x000000000055a39e in ofproto_dpif_execute_actions
(ofproto=0xa30eb0, flow=flow at entry=0x7f402f7f8700, rule=rule at entry=0x0,
ofpacts=ofpacts at entry=0x7f402f7f8100, ofpacts_len=ofpacts_len at entry=8,

    packet=packet at entry=0x7f402f7f8300) at / /ofproto/ofproto-dpif.c:3670

#13657 0x000000000056d5ad in xlate_flood_packet (xbridge=0x35a8b00,
packet=0x7f402f7f8300)

    at / /ofproto/ofproto-dpif-xlate.c:2704

#13658 tnl_send_arp_request (out_dev=<optimized out>, ip_dst=1294734859,
ip_src=<optimized out>, eth_src=0x7f402f7f7dc0 "")

    at / /ofproto/ofproto-dpif-xlate.c:2720

#13659 build_tunnel_send (xport=<optimized out>, tunnel_odp_port=26,
flow=0x7f402f7fa248, ctx=0x7f402f7f9210)

    at / /ofproto/ofproto-dpif-xlate.c:2761

---Type <return> to continue, or q <return> to quit---

#13660 compose_output_action__ (ctx=ctx at entry=0x7f402f7f9210,
ofp_port=<optimized out>, xr=xr at entry=0x0, check_stp=check_stp at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:3022

#13661 0x000000000056e356 in compose_output_action (xr=0x0,
ofp_port=<optimized out>, ctx=0x7f402f7f9210)

    at / /ofproto/ofproto-dpif-xlate.c:3072

#13662 xlate_output_action (ctx=ctx at entry=0x7f402f7f9210, port=<optimized
out>, max_len=<optimized out>, may_packet_in=may_packet_in at entry=true)

    at / /ofproto/ofproto-dpif-xlate.c:3808

#13663 0x000000000056a945 in do_xlate_actions (ofpacts=<optimized out>,
ofpacts_len=8, ctx=ctx at entry=0x7f402f7f9210)

    at / /ofproto/ofproto-dpif-xlate.c:4239

#13664 0x000000000056c2fa in xlate_recursively (rule=0xadf9a0,
ctx=0x7f402f7f9210)

    at / /ofproto/ofproto-dpif-xlate.c:3091

#13665 xlate_table_action (ctx=0x7f402f7f9210, in_port=<optimized out>,
table_id=<optimized out>, may_packet_in=<optimized out>,
honor_table_miss=<optimized out>)

    at / /ofproto/ofproto-dpif-xlate.c:3156

#13666 0x000000000056b845 in do_xlate_actions
(ofpacts=ofpacts at entry=0x7f4000004b30,
ofpacts_len=ofpacts_len at entry=8, ctx=ctx at entry=0x7f402f7f9210)

    at / /ofproto/ofproto-dpif-xlate.c:4596

#13667 0x000000000056fda1 in xlate_actions (xin=0x7f402f7fa240,
xout=0x7f402f7fa548)

    at / /ofproto/ofproto-dpif-xlate.c:5112

#13668 0x00000000005652b5 in upcall_xlate (wc=<optimized out>,
odp_actions=<optimized out>, upcall=<optimized out>, udpif=<optimized out>)

    at / /ofproto/ofproto-dpif-upcall.c:989

#13669 process_upcall (udpif=0xa2cea0, upcall=0x7f402f7fa4f0,
odp_actions=0x7f402f7fae70, wc=0x1, wc at entry=0x588d83
<dp_netdev_upcall+131>)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150914/7889f754/attachment-0001.html>

From nghiem.gia.minh at gmail.com  Tue Sep 15 01:42:35 2015
From: nghiem.gia.minh at gmail.com (Minh Nghiem Gia)
Date: Tue, 15 Sep 2015 17:42:35 +0900
Subject: [ovs-discuss] way to speak with OpenFlow module
Message-ID: <CAAsS9QSp8YfHWstN=MWL9d5KkaTjK3yiaqpx_rXieAY-BN+VUQ@mail.gmail.com>

Hello,

It is easy to push OpenFlow rules to OVS by using the OVS utility such
as ovs-ofctl. Thanks all OVS developers!
However, I now want to try that function with a SDN controller and I wonder
that does the SDN controller (i.e., pox, nox or floodlight) will call
ovs-ofctl to install OF flows or they implement their own way (which
probably works in a similar way to ovs-ofctl) to complete that tasks?
Anyone please help on my dummy question.

Thanks a lot,
Minh.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150915/6b101b6c/attachment.html>

From xiaolia at cisco.com  Tue Sep 15 02:43:03 2015
From: xiaolia at cisco.com (Xiao Liang (xiaolia))
Date: Tue, 15 Sep 2015 09:43:03 +0000
Subject: [ovs-discuss] way to speak with OpenFlow module
In-Reply-To: <CAAsS9QSp8YfHWstN=MWL9d5KkaTjK3yiaqpx_rXieAY-BN+VUQ@mail.gmail.com>
References: <CAAsS9QSp8YfHWstN=MWL9d5KkaTjK3yiaqpx_rXieAY-BN+VUQ@mail.gmail.com>
Message-ID: <2d094aae94c64690956e889b86d15153@XCH-RCD-014.cisco.com>

Hi Minh,

As far as I know, most controllers will include OpenFlow protocol implementation. They communicate with switches by OpenFlow message. In this way, ovs-ofctl makes no difference, it sends / receives messages via sockets (unix, tcp, etc.). Some controller might also have OVSDB southbound, which manipulates OVS bridges as ovs-vsctl.
Some applications (like Openstack, IIRC) might have an agent running on the host to call OVS utils.

Thanks,
Xiao

From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Minh Nghiem Gia
Sent: Tuesday, September 15, 2015 16:43
To: discuss at openvswitch.org
Subject: [ovs-discuss] way to speak with OpenFlow module

Hello,

It is easy to push OpenFlow rules to OVS by using the OVS utility such as ovs-ofctl. Thanks all OVS developers!
However, I now want to try that function with a SDN controller and I wonder that does the SDN controller (i.e., pox, nox or floodlight) will call ovs-ofctl to install OF flows or they implement their own way (which probably works in a similar way to ovs-ofctl) to complete that tasks?
Anyone please help on my dummy question.

Thanks a lot,
Minh.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150915/2d53691f/attachment.html>

From nghiem.gia.minh at gmail.com  Tue Sep 15 07:04:08 2015
From: nghiem.gia.minh at gmail.com (Minh Nghiem Gia)
Date: Tue, 15 Sep 2015 23:04:08 +0900
Subject: [ovs-discuss] way to speak with OpenFlow module
In-Reply-To: <2d094aae94c64690956e889b86d15153@XCH-RCD-014.cisco.com>
References: <CAAsS9QSp8YfHWstN=MWL9d5KkaTjK3yiaqpx_rXieAY-BN+VUQ@mail.gmail.com>
 <2d094aae94c64690956e889b86d15153@XCH-RCD-014.cisco.com>
Message-ID: <CAAsS9QTeKbWTHm4havwkPk9Wm6LW1P5NiabNPKFuD6TYZ-fLCA@mail.gmail.com>

Hi Xiao,

Thank you for your quick response. That means there are several ways to
insert OF flows! Then, if I insert OF rules by using ovs-ofctl and by a
controller, is there any way to ensure installed rules are not overlap or
interfere with the others? Or is there any way to only allow one way to
communicate with the switch?

Best regards,
Minh.

2015-09-15 18:43 GMT+09:00 Xiao Liang (xiaolia) <xiaolia at cisco.com>:

> Hi Minh,
>
>
>
> As far as I know, most controllers will include OpenFlow protocol
> implementation. They communicate with switches by OpenFlow message. In this
> way, ovs-ofctl makes no difference, it sends / receives messages via
> sockets (unix, tcp, etc.). Some controller might also have OVSDB
> southbound, which manipulates OVS bridges as ovs-vsctl.
>
> Some applications (like Openstack, IIRC) might have an agent running on
> the host to call OVS utils.
>
>
>
> Thanks,
>
> Xiao
>
>
>
> *From:* discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of *Minh
> Nghiem Gia
> *Sent:* Tuesday, September 15, 2015 16:43
> *To:* discuss at openvswitch.org
> *Subject:* [ovs-discuss] way to speak with OpenFlow module
>
>
>
> Hello,
>
>
>
> It is easy to push OpenFlow rules to OVS by using the OVS utility such
> as ovs-ofctl. Thanks all OVS developers!
>
> However, I now want to try that function with a SDN controller and I
> wonder that does the SDN controller (i.e., pox, nox or floodlight) will
> call ovs-ofctl to install OF flows or they implement their own way (which
> probably works in a similar way to ovs-ofctl) to complete that tasks?
>
> Anyone please help on my dummy question.
>
>
>
> Thanks a lot,
>
> Minh.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150915/eddcafdc/attachment.html>

From pmaia at lasige.di.fc.ul.pt  Tue Sep 15 09:55:29 2015
From: pmaia at lasige.di.fc.ul.pt (Pedro Maia)
Date: Tue, 15 Sep 2015 17:55:29 +0100
Subject: [ovs-discuss] Event or Action based on counter
Message-ID: <5EC5AA62-65F7-411B-820F-193429B3B2F3@lasige.di.fc.ul.pt>

Hello,

I’ve searched in the documentation but i was unable to find a way to execute some action on a packet or generate a event based on the counters of, by example, a number of matches of a flow entry, or sent packets in a switch port.
I’ve seen that in Nicira extended match it is possible to match on a register (idx), is there any way to write there on of those numbers (a stat entry from port or a flow)?

Thanks in advance,
Pedro

From blp at nicira.com  Tue Sep 15 10:54:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 15 Sep 2015 10:54:42 -0700
Subject: [ovs-discuss] Event or Action based on counter
In-Reply-To: <5EC5AA62-65F7-411B-820F-193429B3B2F3@lasige.di.fc.ul.pt>
References: <5EC5AA62-65F7-411B-820F-193429B3B2F3@lasige.di.fc.ul.pt>
Message-ID: <20150915175442.GH4433@nicira.com>

On Tue, Sep 15, 2015 at 05:55:29PM +0100, Pedro Maia wrote:
> I’ve searched in the documentation but i was unable to find a way to
> execute some action on a packet or generate a event based on the
> counters of, by example, a number of matches of a flow entry, or sent
> packets in a switch port.  I’ve seen that in Nicira extended match it
> is possible to match on a register (idx), is there any way to write
> there on of those numbers (a stat entry from port or a flow)?

OVS doesn't provide a way to match on statistics.

From mehtaneeraj07 at gmail.com  Tue Sep 15 11:22:20 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Tue, 15 Sep 2015 23:52:20 +0530
Subject: [ovs-discuss] Input argument to atoi
Message-ID: <CAHN905KFMrhsocJ158TMTeh8h_nzRUhMdNBz92PNjVaR=ZRY1Q@mail.gmail.com>

Hi Team,

I was looking a the code in learn.c file. As per my understanding atoi
function take const char * as an input argument. but in the below snippet
value is passed as argument which is char *.

} else if (!strcmp(name, "priority")) {
            learn->priority = atoi(value);
        } else if (!strcmp(name, "idle_timeout")) {
            learn->idle_timeout = atoi(value);
        } else if (!strcmp(name, "hard_timeout")) {
            learn->hard_timeout = atoi(value);
        } else if (!strcmp(name, "fin_idle_timeout")) {
            learn->fin_idle_timeout = atoi(value);
        } else if (!strcmp(name, "fin_hard_timeout")) {
            learn->fin_hard_timeout = atoi(value);

Should't it be const char * ?

Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150915/0381a909/attachment.html>

From mehtaneeraj07 at gmail.com  Tue Sep 15 12:13:34 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Wed, 16 Sep 2015 00:43:34 +0530
Subject: [ovs-discuss] No check for memory allocation from malloc()
Message-ID: <CAHN905JQe3cNOMobWJVApR7WoZX33xKotYhEg=HEgMMACuj4WA@mail.gmail.com>

Hi Team,

I was looking a the code in sfow_agent.c file in sflAlloc( ) function. This
funtion allocates memory via malloc but didn't check whether memory
allocation is successful or not.
I think there should be a check, in case malloc fails to allocate memory.

Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/bdbfb71e/attachment.html>

From neil.mckee at inmon.com  Tue Sep 15 12:33:03 2015
From: neil.mckee at inmon.com (Neil McKee)
Date: Tue, 15 Sep 2015 12:33:03 -0700
Subject: [ovs-discuss] No check for memory allocation from malloc()
In-Reply-To: <CAHN905JQe3cNOMobWJVApR7WoZX33xKotYhEg=HEgMMACuj4WA@mail.gmail.com>
References: <CAHN905JQe3cNOMobWJVApR7WoZX33xKotYhEg=HEgMMACuj4WA@mail.gmail.com>
Message-ID: <CAB1FvaKcZELOBBckPvaY1+A7ucAQNA9hN2=cBdU5d=VdedbgNg@mail.gmail.com>

In OVS a callback fn is given to the sFlow library for all allocation,  but
the callback (ofproto/ofproto-dpif-sflow.c:sflow_agent_alloc_cb()) just
calls "calloc()" too.  This should probably be changed to xcalloc() as
defined in lib/util.c which does the right thing.   Thanks for pointing
this out.

Neil


------
Neil McKee
InMon Corp.
http://www.inmon.com

On Tue, Sep 15, 2015 at 12:13 PM, neeraj mehta <mehtaneeraj07 at gmail.com>
wrote:

> Hi Team,
>
> I was looking a the code in sfow_agent.c file in sflAlloc( ) function.
> This funtion allocates memory via malloc but didn't check whether memory
> allocation is successful or not.
> I think there should be a check, in case malloc fails to allocate memory.
>
> Regards
> Neeraj
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150915/8945f8c5/attachment.html>

From mehtaneeraj07 at gmail.com  Tue Sep 15 13:08:36 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Wed, 16 Sep 2015 01:38:36 +0530
Subject: [ovs-discuss] Assignment is done from int->short
Message-ID: <CAHN905+03qL7qGZ8O88g0-5VfZnmPYEGOyLgR==ZZeSFv84+GA@mail.gmail.com>

Hi Team,

I was looking a the code in multipath.c file. In function algorithm_hrw( )
assignment is done from int->short (best_link = link). It might lead to
bit truncation. Following is the code snippet for your reference.

uint32_t best_weight;
    uint16_t best_link;
    unsigned int link;

    best_link = 0;
    best_weight = hash_2words(hash, 0);
    for (link = 1; link < n_links; link++) {
        uint32_t weight = hash_2words(hash, link);
        if (weight > best_weight) {
            best_link = link;
            best_weight = weight;

Regards
Neeraj



algorithm_hrw
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/7ca5744d/attachment.html>

From blp at nicira.com  Tue Sep 15 13:35:02 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 15 Sep 2015 13:35:02 -0700
Subject: [ovs-discuss] Assignment is done from int->short
In-Reply-To: <CAHN905+03qL7qGZ8O88g0-5VfZnmPYEGOyLgR==ZZeSFv84+GA@mail.gmail.com>
References: <CAHN905+03qL7qGZ8O88g0-5VfZnmPYEGOyLgR==ZZeSFv84+GA@mail.gmail.com>
Message-ID: <20150915203502.GB11826@nicira.com>

On Wed, Sep 16, 2015 at 01:38:36AM +0530, neeraj mehta wrote:
> I was looking a the code in multipath.c file. In function algorithm_hrw( )
> assignment is done from int->short (best_link = link). It might lead to
> bit truncation. Following is the code snippet for your reference.
> 
> uint32_t best_weight;
>     uint16_t best_link;
>     unsigned int link;
> 
>     best_link = 0;
>     best_weight = hash_2words(hash, 0);
>     for (link = 1; link < n_links; link++) {
>         uint32_t weight = hash_2words(hash, link);
>         if (weight > best_weight) {
>             best_link = link;
>             best_weight = weight;

n_links is always less than or equal to 64, so it's not a problem.

From jesse at nicira.com  Tue Sep 15 17:38:21 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 15 Sep 2015 17:38:21 -0700
Subject: [ovs-discuss] tnl arp causes infinite reentrant stack death.
In-Reply-To: <CAB8HAh5oJu3EkWmjY19WFnKU18gQyMDmY43D3K1RTkWn7VGPSg@mail.gmail.com>
References: <CAB8HAh5oJu3EkWmjY19WFnKU18gQyMDmY43D3K1RTkWn7VGPSg@mail.gmail.com>
Message-ID: <CAEP_g=_qRPHK6bb4y3VwrwHWzGyb2B_LTttQk3pkcHAumRKn1g@mail.gmail.com>

On Mon, Sep 14, 2015 at 9:57 PM, David Evans <davidjoshuaevans at gmail.com> wrote:
> Hi OVS.
>
> i am using rev 2.3.2+29bae5412ea3c6a1e20d79afd25c11b968dffa05-r0
>
> As you can see from my gdb backtrace 13K frames deep below we get an arp
> request because build_tunnel_send (frame 13659 below) decided we're starting
> to use a gre tunnel on a bridge and there's no arp cache for the destination
> yet.
>
> so what follows is  xlate_flood_packet -> ofproto_dpif_execute_actions ->
> xlate_actions -> do_xlate_actions -> xlate_output_action -> flood_packet
> -> compose_output_action -> compose_output_action__ -> xlate_table_action ->
> xlate_recusively
> -> do_xlate_actions (* a few actions) then we get back to
> compose_output_action__ and build_tunnel_send again.
>
> So infinitely the code will generate arp packets, but never deliver any of
> the arps out to the linux stack and keeps re-entering till it exhausts the
> stack
>
> How do i stop this?

OVS should protect itself better but fundamentally the issue is that
there is a loop somewhere in your configuration. Most likely the
remote_ip on your GRE port is pointing back into br0. Another
possibility is that a patch port is bridging packets between br0 and
breth1. In both of these cases, ARP packets from the IP stack are
re-entering the inside of the tunnel, which causes another ARP packet
and so on.

From applyhhj at 163.com  Tue Sep 15 18:48:26 2015
From: applyhhj at 163.com (applyhhj)
Date: Wed, 16 Sep 2015 09:48:26 +0800
Subject: [ovs-discuss] bridging network prevent node from connecting the
	internet
Message-ID: <73b5a713.6f61.14fd3d6c582.Coremail.applyhhj@163.com>

Hi Everyone,
I am new to openvswitch. I am now configuring openvswitch for openstack cloud. I have a network node in the cloud and it has 3 network cards. When I did as the Openstack Install Guidance said to add port eth2, which is the interface that connects to the internet in dhcp mode, to the external bridge br-ex, the whole network node become disconnected from the internet. 
Here is the network interface file:
 
# interfaces(5) file used by ifup(8) and ifdown(8)
auto lo
iface lo inet loopback
 
# management interface
auto eth0
iface eth0 inet static
address 10.0.0.21
netmask 255.255.255.0
#gateway 10.0.0.1
 
# tunnels interface
auto eth1
iface eth1 inet static
address 10.0.1.21
netmask 255.255.255.0
 
# external network interface
auto eth2
iface eth2 inet dhcp
        up ip link set dev $IFACE up
        down ip link set dev $IFACE down
 
After add eth2 to br-ex, ifconfig presents the following configuration:
 


Note: A lot of drop in bridge.
 
Openvswitch configuration:
 
# ovs-vsctl show
40981b45-f9ed-478c-8e25-288598238dc3
    Bridge br-ex
        Port phy-br-ex
            Interface phy-br-ex
                type: patch
                options: {peer=int-br-ex}
        Port br-ex
            Interface br-ex
                type: internal
        Port "eth2"
            Interface "eth2"
    Bridge br-int
        fail_mode: secure
        Port int-br-ex
            Interface int-br-ex
                type: patch
                options: {peer=phy-br-ex}
        Port br-int
            Interface br-int
                type: internal
        Port patch-tun
            Interface patch-tun
                type: patch
                options: {peer=patch-int}
    Bridge br-tun
        fail_mode: secure
        Port br-tun
            Interface br-tun
                type: internal
        Port patch-int
            Interface patch-int
                type: patch
                options: {peer=patch-tun}
ovs_version: "2.3.2"
 
# ovs-ofctl show br-ex
OFPT_FEATURES_REPLY (xid=0x2): dpid:00006c0b8442b1b5
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: OUTPUT SET_VLAN_VID SET_VLAN_PCP STRIP_VLAN SET_DL_SRC SET_DL_DST SET_NW_SRC SET_NW_DST SET_NW_TOS SET_TP_SRC SET_TP_DST ENQUEUE
 1(phy-br-ex): addr: a mac addr
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 2(eth2): addr: mac of eth2
     config:     0
     state:      0
     current:    1GB-FD COPPER AUTO_NEG
     advertised: 10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     speed: 1000 Mbps now, 1000 Mbps max
 LOCAL(br-ex): addr: mac of eth2
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
 
# ovs-vsctl br-exists br-ex
Shows noting

If I remove eth2 from br-ex, then everything goes well.
By the way I use NAT to connect all other node in the cloud to the internet, but even if I cancel NAT noting changes. And also I have enabled ipv4 forwarding.
Any suggestion is warmly welcomed! Thank you very much!!

Regards
hjh!

2015-09-16



applyhhj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/ef47c48e/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Clip(09-16-09-46-24).bmp
Type: image/bmp
Size: 272742 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/ef47c48e/attachment-0002.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Clip(09-16-09-46-30).bmp
Type: image/bmp
Size: 225546 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/ef47c48e/attachment-0003.bin>

From davidjoshuaevans at gmail.com  Tue Sep 15 19:38:55 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Tue, 15 Sep 2015 21:38:55 -0500
Subject: [ovs-discuss] tnl arp causes infinite reentrant stack death.
In-Reply-To: <CAEP_g=_qRPHK6bb4y3VwrwHWzGyb2B_LTttQk3pkcHAumRKn1g@mail.gmail.com>
References: <CAB8HAh5oJu3EkWmjY19WFnKU18gQyMDmY43D3K1RTkWn7VGPSg@mail.gmail.com>
 <CAEP_g=_qRPHK6bb4y3VwrwHWzGyb2B_LTttQk3pkcHAumRKn1g@mail.gmail.com>
Message-ID: <CAB8HAh5PVjfSSWFz5H-ahKpUcq-cyd=1=KvC=6mZ2iQdwiV+Cg@mail.gmail.com>

Thanks Jesse!
I think you may be close, but it is the ovs code that is re-entering it's
self, this isn't an arp storm from a circle of traffic path, as far as i
can tell. it is an attempt to transmit a single packet.. but never gets
even the arp out to the stack at all.
you can see build_tunnel_send 3 times as the stack trace goes in the
original post. but no packets make it out. the program call stack is 13000
frames deep - which is why it crashed.

any further thoughts?


On Tue, Sep 15, 2015 at 7:38 PM, Jesse Gross <jesse at nicira.com> wrote:

> On Mon, Sep 14, 2015 at 9:57 PM, David Evans <davidjoshuaevans at gmail.com>
> wrote:
> > Hi OVS.
> >
> > i am using rev 2.3.2+29bae5412ea3c6a1e20d79afd25c11b968dffa05-r0
> >
> > As you can see from my gdb backtrace 13K frames deep below we get an arp
> > request because build_tunnel_send (frame 13659 below) decided we're
> starting
> > to use a gre tunnel on a bridge and there's no arp cache for the
> destination
> > yet.
> >
> > so what follows is  xlate_flood_packet -> ofproto_dpif_execute_actions ->
> > xlate_actions -> do_xlate_actions -> xlate_output_action -> flood_packet
> > -> compose_output_action -> compose_output_action__ ->
> xlate_table_action ->
> > xlate_recusively
> > -> do_xlate_actions (* a few actions) then we get back to
> > compose_output_action__ and build_tunnel_send again.
> >
> > So infinitely the code will generate arp packets, but never deliver any
> of
> > the arps out to the linux stack and keeps re-entering till it exhausts
> the
> > stack
> >
> > How do i stop this?
>
> OVS should protect itself better but fundamentally the issue is that
> there is a loop somewhere in your configuration. Most likely the
> remote_ip on your GRE port is pointing back into br0. Another
> possibility is that a patch port is bridging packets between br0 and
> breth1. In both of these cases, ARP packets from the IP stack are
> re-entering the inside of the tunnel, which causes another ARP packet
> and so on.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150915/09658336/attachment.html>

From xiaolia at cisco.com  Tue Sep 15 19:44:18 2015
From: xiaolia at cisco.com (Xiao Liang (xiaolia))
Date: Wed, 16 Sep 2015 02:44:18 +0000
Subject: [ovs-discuss] way to speak with OpenFlow module
In-Reply-To: <CAAsS9QTeKbWTHm4havwkPk9Wm6LW1P5NiabNPKFuD6TYZ-fLCA@mail.gmail.com>
References: <CAAsS9QSp8YfHWstN=MWL9d5KkaTjK3yiaqpx_rXieAY-BN+VUQ@mail.gmail.com>
 <2d094aae94c64690956e889b86d15153@XCH-RCD-014.cisco.com>
 <CAAsS9QTeKbWTHm4havwkPk9Wm6LW1P5NiabNPKFuD6TYZ-fLCA@mail.gmail.com>
Message-ID: <b70a481102bb46dd94c41cc5e1e376fc@XCH-RCD-014.cisco.com>

Hi Minh,

Controller could query existing flows before adding. I’m not clear why you need to do this. Ovs-ofctl has no impact as long as you don’t use it. You can remove the mgmt socket (/var/run/openvswitch/<bridge>.mgmt) if you really want.

Thanks,
Xiao

From: Minh Nghiem Gia [mailto:nghiem.gia.minh at gmail.com]
Sent: Tuesday, September 15, 2015 22:04
To: Xiao Liang (xiaolia)
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] way to speak with OpenFlow module

Hi Xiao,

Thank you for your quick response. That means there are several ways to insert OF flows! Then, if I insert OF rules by using ovs-ofctl and by a controller, is there any way to ensure installed rules are not overlap or interfere with the others? Or is there any way to only allow one way to communicate with the switch?

Best regards,
Minh.

2015-09-15 18:43 GMT+09:00 Xiao Liang (xiaolia) <xiaolia at cisco.com<mailto:xiaolia at cisco.com>>:
Hi Minh,

As far as I know, most controllers will include OpenFlow protocol implementation. They communicate with switches by OpenFlow message. In this way, ovs-ofctl makes no difference, it sends / receives messages via sockets (unix, tcp, etc.). Some controller might also have OVSDB southbound, which manipulates OVS bridges as ovs-vsctl.
Some applications (like Openstack, IIRC) might have an agent running on the host to call OVS utils.

Thanks,
Xiao

From: discuss [mailto:discuss-bounces at openvswitch.org<mailto:discuss-bounces at openvswitch.org>] On Behalf Of Minh Nghiem Gia
Sent: Tuesday, September 15, 2015 16:43
To: discuss at openvswitch.org<mailto:discuss at openvswitch.org>
Subject: [ovs-discuss] way to speak with OpenFlow module

Hello,

It is easy to push OpenFlow rules to OVS by using the OVS utility such as ovs-ofctl. Thanks all OVS developers!
However, I now want to try that function with a SDN controller and I wonder that does the SDN controller (i.e., pox, nox or floodlight) will call ovs-ofctl to install OF flows or they implement their own way (which probably works in a similar way to ovs-ofctl) to complete that tasks?
Anyone please help on my dummy question.

Thanks a lot,
Minh.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/f69d4d81/attachment.html>

From jesse at nicira.com  Tue Sep 15 20:54:32 2015
From: jesse at nicira.com (Jesse Gross)
Date: Tue, 15 Sep 2015 20:54:32 -0700
Subject: [ovs-discuss] tnl arp causes infinite reentrant stack death.
In-Reply-To: <CAB8HAh5PVjfSSWFz5H-ahKpUcq-cyd=1=KvC=6mZ2iQdwiV+Cg@mail.gmail.com>
References: <CAB8HAh5oJu3EkWmjY19WFnKU18gQyMDmY43D3K1RTkWn7VGPSg@mail.gmail.com>
 <CAEP_g=_qRPHK6bb4y3VwrwHWzGyb2B_LTttQk3pkcHAumRKn1g@mail.gmail.com>
 <CAB8HAh5PVjfSSWFz5H-ahKpUcq-cyd=1=KvC=6mZ2iQdwiV+Cg@mail.gmail.com>
Message-ID: <CAEP_g=_qAK8pmbsduNTxWwy1vWaEyPtwOCDAJd6GDRnGWozPjA@mail.gmail.com>

On Tue, Sep 15, 2015 at 7:38 PM, David Evans <davidjoshuaevans at gmail.com> wrote:
> Thanks Jesse!
> I think you may be close, but it is the ovs code that is re-entering it's
> self, this isn't an arp storm from a circle of traffic path, as far as i can
> tell. it is an attempt to transmit a single packet.. but never gets even the
> arp out to the stack at all.
> you can see build_tunnel_send 3 times as the stack trace goes in the
> original post. but no packets make it out. the program call stack is 13000
> frames deep - which is why it crashed.

When tunneling is done in userspace (such as with DPDK), the Linux
stack is not involved at all since the point of DPDK is to avoid the
kernel for performance reasons. That's why you see OVS reentering
itself repeatedly as it tries to forward and then generate more ARP
frames.

I just sent out a patch CC'd to you that should fix this issue. Can
you test it? Note that in this case 'fix' means that it will prevent
OVS from crashing. However, traffic won't flow until the loop in the
configuration is resolved. Based on the stack trace, my guess is that
you have one or more patch ports connecting the bridges.

From davidjoshuaevans at gmail.com  Tue Sep 15 21:18:50 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Tue, 15 Sep 2015 23:18:50 -0500
Subject: [ovs-discuss] tnl arp causes infinite reentrant stack death.
In-Reply-To: <CAEP_g=_qAK8pmbsduNTxWwy1vWaEyPtwOCDAJd6GDRnGWozPjA@mail.gmail.com>
References: <CAB8HAh5oJu3EkWmjY19WFnKU18gQyMDmY43D3K1RTkWn7VGPSg@mail.gmail.com>
 <CAEP_g=_qRPHK6bb4y3VwrwHWzGyb2B_LTttQk3pkcHAumRKn1g@mail.gmail.com>
 <CAB8HAh5PVjfSSWFz5H-ahKpUcq-cyd=1=KvC=6mZ2iQdwiV+Cg@mail.gmail.com>
 <CAEP_g=_qAK8pmbsduNTxWwy1vWaEyPtwOCDAJd6GDRnGWozPjA@mail.gmail.com>
Message-ID: <CAB8HAh6OYbwKw=KePRHUX0RcfSCrZ7mqO3m6Jip8YX0HirPjBA@mail.gmail.com>

Wow. - Thanks so much Jesse,
I will try this with a fresh coffee in the morning @ the office in the
morning. it's 11pm now. - can't think straight anymore.. :)

On Tue, Sep 15, 2015 at 10:54 PM, Jesse Gross <jesse at nicira.com> wrote:

> On Tue, Sep 15, 2015 at 7:38 PM, David Evans <davidjoshuaevans at gmail.com>
> wrote:
> > Thanks Jesse!
> > I think you may be close, but it is the ovs code that is re-entering it's
> > self, this isn't an arp storm from a circle of traffic path, as far as i
> can
> > tell. it is an attempt to transmit a single packet.. but never gets even
> the
> > arp out to the stack at all.
> > you can see build_tunnel_send 3 times as the stack trace goes in the
> > original post. but no packets make it out. the program call stack is
> 13000
> > frames deep - which is why it crashed.
>
> When tunneling is done in userspace (such as with DPDK), the Linux
> stack is not involved at all since the point of DPDK is to avoid the
> kernel for performance reasons. That's why you see OVS reentering
> itself repeatedly as it tries to forward and then generate more ARP
> frames.
>
> I just sent out a patch CC'd to you that should fix this issue. Can
> you test it? Note that in this case 'fix' means that it will prevent
> OVS from crashing. However, traffic won't flow until the loop in the
> configuration is resolved. Based on the stack trace, my guess is that
> you have one or more patch ports connecting the bridges.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150915/131438af/attachment.html>

From ben at skyportsystems.com  Tue Sep 15 23:54:17 2015
From: ben at skyportsystems.com (Ben Warren)
Date: Tue, 15 Sep 2015 23:54:17 -0700
Subject: [ovs-discuss] conntrack marks in ovs not showing up
Message-ID: <9DBB035D-2E1E-44B5-AFA3-BAA4ED93BB16@skyportsystems.com>

Hi,

I’m working off Justin Pettit’s ‘conntrack’ tree @ https://github.com/justinpettit/ovs/tree/conntrack, and can’t seem to get marks to work.

Here’s an example of a flow (FTP server)

===
ovs-ofctl add-flow br0 "table=3,cookie=0xb0b,priority=32000,ct_state=+new+trk,tcp,tp_dst=21 actions=ct(commit,alg=ftp,zone=2),resubmit(,4),set_field:9->ct_mark”
===

which I believe should set the conntrack mark to 9 on packets that meet the match criteria

When I connect via FTP and use the conntrack command line, I see the flow, but no sign of the mark:

===
# conntrack -E | grep 237
    [NEW] tcp      6 120 SYN_SENT src=10.99.0.17 dst=10.11.10.237 sport=54154 dport=21 [UNREPLIED] src=10.11.10.237 dst=10.99.0.17 sport=21 dport=54154 zone=2 helper=ftp
===

My kernel is pretty vanilla, but marks definitely are seen when set via iptables.  Does it need to be patched to support marks coming from OVS?

thanks,
Ben
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3583 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150915/bd65e991/attachment.bin>

From nghiem.gia.minh at gmail.com  Wed Sep 16 00:03:19 2015
From: nghiem.gia.minh at gmail.com (Minh Nghiem Gia)
Date: Wed, 16 Sep 2015 16:03:19 +0900
Subject: [ovs-discuss] way to speak with OpenFlow module
In-Reply-To: <b70a481102bb46dd94c41cc5e1e376fc@XCH-RCD-014.cisco.com>
References: <CAAsS9QSp8YfHWstN=MWL9d5KkaTjK3yiaqpx_rXieAY-BN+VUQ@mail.gmail.com>
 <2d094aae94c64690956e889b86d15153@XCH-RCD-014.cisco.com>
 <CAAsS9QTeKbWTHm4havwkPk9Wm6LW1P5NiabNPKFuD6TYZ-fLCA@mail.gmail.com>
 <b70a481102bb46dd94c41cc5e1e376fc@XCH-RCD-014.cisco.com>
Message-ID: <CAAsS9QSMLKiHqa3Zb2E7AvM6X1o-CgETWxovjsyM1uzPqW6dxw@mail.gmail.com>

Hi Xiao,

Thanks for your help.
It's just my curious about a special case where a OF switch is under
control of 2 or more controllers.

Best regards,
Minh.

2015-09-16 11:44 GMT+09:00 Xiao Liang (xiaolia) <xiaolia at cisco.com>:

> Hi Minh,
>
>
>
> Controller could query existing flows before adding. I’m not clear why you
> need to do this. Ovs-ofctl has no impact as long as you don’t use it. You
> can remove the mgmt socket (/var/run/openvswitch/<bridge>.mgmt) if you
> really want.
>
>
>
> Thanks,
>
> Xiao
>
>
>
> *From:* Minh Nghiem Gia [mailto:nghiem.gia.minh at gmail.com]
> *Sent:* Tuesday, September 15, 2015 22:04
> *To:* Xiao Liang (xiaolia)
> *Cc:* discuss at openvswitch.org
> *Subject:* Re: [ovs-discuss] way to speak with OpenFlow module
>
>
>
> Hi Xiao,
>
>
>
> Thank you for your quick response. That means there are several ways to
> insert OF flows! Then, if I insert OF rules by using ovs-ofctl and by a
> controller, is there any way to ensure installed rules are not overlap or
> interfere with the others? Or is there any way to only allow one way to
> communicate with the switch?
>
>
>
> Best regards,
>
> Minh.
>
>
>
> 2015-09-15 18:43 GMT+09:00 Xiao Liang (xiaolia) <xiaolia at cisco.com>:
>
> Hi Minh,
>
>
>
> As far as I know, most controllers will include OpenFlow protocol
> implementation. They communicate with switches by OpenFlow message. In this
> way, ovs-ofctl makes no difference, it sends / receives messages via
> sockets (unix, tcp, etc.). Some controller might also have OVSDB
> southbound, which manipulates OVS bridges as ovs-vsctl.
>
> Some applications (like Openstack, IIRC) might have an agent running on
> the host to call OVS utils.
>
>
>
> Thanks,
>
> Xiao
>
>
>
> *From:* discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of *Minh
> Nghiem Gia
> *Sent:* Tuesday, September 15, 2015 16:43
> *To:* discuss at openvswitch.org
> *Subject:* [ovs-discuss] way to speak with OpenFlow module
>
>
>
> Hello,
>
>
>
> It is easy to push OpenFlow rules to OVS by using the OVS utility such
> as ovs-ofctl. Thanks all OVS developers!
>
> However, I now want to try that function with a SDN controller and I
> wonder that does the SDN controller (i.e., pox, nox or floodlight) will
> call ovs-ofctl to install OF flows or they implement their own way (which
> probably works in a similar way to ovs-ofctl) to complete that tasks?
>
> Anyone please help on my dummy question.
>
>
>
> Thanks a lot,
>
> Minh.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/fd99ffdd/attachment-0001.html>

From xiaolia at cisco.com  Wed Sep 16 00:57:03 2015
From: xiaolia at cisco.com (Xiao Liang (xiaolia))
Date: Wed, 16 Sep 2015 07:57:03 +0000
Subject: [ovs-discuss] way to speak with OpenFlow module
In-Reply-To: <CAAsS9QSMLKiHqa3Zb2E7AvM6X1o-CgETWxovjsyM1uzPqW6dxw@mail.gmail.com>
References: <CAAsS9QSp8YfHWstN=MWL9d5KkaTjK3yiaqpx_rXieAY-BN+VUQ@mail.gmail.com>
 <2d094aae94c64690956e889b86d15153@XCH-RCD-014.cisco.com>
 <CAAsS9QTeKbWTHm4havwkPk9Wm6LW1P5NiabNPKFuD6TYZ-fLCA@mail.gmail.com>
 <b70a481102bb46dd94c41cc5e1e376fc@XCH-RCD-014.cisco.com>
 <CAAsS9QSMLKiHqa3Zb2E7AvM6X1o-CgETWxovjsyM1uzPqW6dxw@mail.gmail.com>
Message-ID: <48e96a6e4bd84d578d68eb90bf74e1bc@XCH-RCD-014.cisco.com>

For detailed information you can refer to “multiple controllers” section in OF spec from 1.2 on.

Thanks,
Xiao

From: Minh Nghiem Gia [mailto:nghiem.gia.minh at gmail.com]
Sent: Wednesday, September 16, 2015 15:03
To: Xiao Liang (xiaolia)
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] way to speak with OpenFlow module

Hi Xiao,

Thanks for your help.
It's just my curious about a special case where a OF switch is under control of 2 or more controllers.

Best regards,
Minh.

2015-09-16 11:44 GMT+09:00 Xiao Liang (xiaolia) <xiaolia at cisco.com<mailto:xiaolia at cisco.com>>:
Hi Minh,

Controller could query existing flows before adding. I’m not clear why you need to do this. Ovs-ofctl has no impact as long as you don’t use it. You can remove the mgmt socket (/var/run/openvswitch/<bridge>.mgmt) if you really want.

Thanks,
Xiao

From: Minh Nghiem Gia [mailto:nghiem.gia.minh at gmail.com<mailto:nghiem.gia.minh at gmail.com>]
Sent: Tuesday, September 15, 2015 22:04
To: Xiao Liang (xiaolia)
Cc: discuss at openvswitch.org<mailto:discuss at openvswitch.org>
Subject: Re: [ovs-discuss] way to speak with OpenFlow module

Hi Xiao,

Thank you for your quick response. That means there are several ways to insert OF flows! Then, if I insert OF rules by using ovs-ofctl and by a controller, is there any way to ensure installed rules are not overlap or interfere with the others? Or is there any way to only allow one way to communicate with the switch?

Best regards,
Minh.

2015-09-15 18:43 GMT+09:00 Xiao Liang (xiaolia) <xiaolia at cisco.com<mailto:xiaolia at cisco.com>>:
Hi Minh,

As far as I know, most controllers will include OpenFlow protocol implementation. They communicate with switches by OpenFlow message. In this way, ovs-ofctl makes no difference, it sends / receives messages via sockets (unix, tcp, etc.). Some controller might also have OVSDB southbound, which manipulates OVS bridges as ovs-vsctl.
Some applications (like Openstack, IIRC) might have an agent running on the host to call OVS utils.

Thanks,
Xiao

From: discuss [mailto:discuss-bounces at openvswitch.org<mailto:discuss-bounces at openvswitch.org>] On Behalf Of Minh Nghiem Gia
Sent: Tuesday, September 15, 2015 16:43
To: discuss at openvswitch.org<mailto:discuss at openvswitch.org>
Subject: [ovs-discuss] way to speak with OpenFlow module

Hello,

It is easy to push OpenFlow rules to OVS by using the OVS utility such as ovs-ofctl. Thanks all OVS developers!
However, I now want to try that function with a SDN controller and I wonder that does the SDN controller (i.e., pox, nox or floodlight) will call ovs-ofctl to install OF flows or they implement their own way (which probably works in a similar way to ovs-ofctl) to complete that tasks?
Anyone please help on my dummy question.

Thanks a lot,
Minh.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/9c1ae2bc/attachment.html>

From mehtaneeraj07 at gmail.com  Wed Sep 16 07:42:24 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Wed, 16 Sep 2015 20:12:24 +0530
Subject: [ovs-discuss] same pointer is destroyed 2 times
Message-ID: <CAHN905+eTiZa2b4fh0SPhkeqYnEmfM=DFCULrWPQRmGpUNizwA@mail.gmail.com>

Hi Team,

I was looking a the code in ofproto-dpif-ipfix.c file. The
function dpif_ipfix_bridge_exporter_destroy( ) invokes following two
functions

dpif_ipfix_bridge_exporter_destroy(struct dpif_ipfix_bridge_exporter
*exporter)
{
    dpif_ipfix_bridge_exporter_clear(exporter);
    dpif_ipfix_exporter_destroy(&exporter->exporter);
}

which internally invokes the following chain of functions

dpif_ipfix_bridge_exporter_clear( )->dpif_ipfix_exporter_clear( )->
collectors_destroy(exporter->collectors)
dpif_ipfix_exporter_destroy ( )-> dpif_ipfix_exporter_clear ( )->
collectors_destroy
(exporter->collectors)

So same pointer is destroyed 2 times in function. what's your view point on
same?

Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/7f077d43/attachment-0001.html>

From blp at nicira.com  Wed Sep 16 08:14:01 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 16 Sep 2015 08:14:01 -0700
Subject: [ovs-discuss] same pointer is destroyed 2 times
In-Reply-To: <CAHN905+eTiZa2b4fh0SPhkeqYnEmfM=DFCULrWPQRmGpUNizwA@mail.gmail.com>
References: <CAHN905+eTiZa2b4fh0SPhkeqYnEmfM=DFCULrWPQRmGpUNizwA@mail.gmail.com>
Message-ID: <20150916151401.GA24644@nicira.com>

On Wed, Sep 16, 2015 at 08:12:24PM +0530, neeraj mehta wrote:
> Hi Team,
> 
> I was looking a the code in ofproto-dpif-ipfix.c file. The
> function dpif_ipfix_bridge_exporter_destroy( ) invokes following two
> functions
> 
> dpif_ipfix_bridge_exporter_destroy(struct dpif_ipfix_bridge_exporter
> *exporter)
> {
>     dpif_ipfix_bridge_exporter_clear(exporter);
>     dpif_ipfix_exporter_destroy(&exporter->exporter);
> }
> 
> which internally invokes the following chain of functions
> 
> dpif_ipfix_bridge_exporter_clear( )->dpif_ipfix_exporter_clear( )->
> collectors_destroy(exporter->collectors)
> dpif_ipfix_exporter_destroy ( )-> dpif_ipfix_exporter_clear ( )->
> collectors_destroy
> (exporter->collectors)
> 
> So same pointer is destroyed 2 times in function. what's your view point on
> same?

Can you point to a specific pointer that is freed twice?

From blp at nicira.com  Wed Sep 16 08:36:09 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 16 Sep 2015 08:36:09 -0700
Subject: [ovs-discuss] No check for memory allocation from malloc()
In-Reply-To: <CAB1FvaKcZELOBBckPvaY1+A7ucAQNA9hN2=cBdU5d=VdedbgNg@mail.gmail.com>
References: <CAHN905JQe3cNOMobWJVApR7WoZX33xKotYhEg=HEgMMACuj4WA@mail.gmail.com>
 <CAB1FvaKcZELOBBckPvaY1+A7ucAQNA9hN2=cBdU5d=VdedbgNg@mail.gmail.com>
Message-ID: <20150916153609.GE24644@nicira.com>

I sent a patch for review:
        http://openvswitch.org/pipermail/dev/2015-September/060110.html

On Tue, Sep 15, 2015 at 12:33:03PM -0700, Neil McKee wrote:
> In OVS a callback fn is given to the sFlow library for all allocation,  but
> the callback (ofproto/ofproto-dpif-sflow.c:sflow_agent_alloc_cb()) just
> calls "calloc()" too.  This should probably be changed to xcalloc() as
> defined in lib/util.c which does the right thing.   Thanks for pointing
> this out.
> 
> Neil
> 
> 
> ------
> Neil McKee
> InMon Corp.
> http://www.inmon.com
> 
> On Tue, Sep 15, 2015 at 12:13 PM, neeraj mehta <mehtaneeraj07 at gmail.com>
> wrote:
> 
> > Hi Team,
> >
> > I was looking a the code in sfow_agent.c file in sflAlloc( ) function.
> > This funtion allocates memory via malloc but didn't check whether memory
> > allocation is successful or not.
> > I think there should be a check, in case malloc fails to allocate memory.
> >
> > Regards
> > Neeraj
> >
> > _______________________________________________
> > discuss mailing list
> > discuss at openvswitch.org
> > http://openvswitch.org/mailman/listinfo/discuss
> >
> >

> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From davidjoshuaevans at gmail.com  Wed Sep 16 09:32:00 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Wed, 16 Sep 2015 11:32:00 -0500
Subject: [ovs-discuss] tnl arp causes infinite reentrant stack death.
In-Reply-To: <CAEP_g=_qAK8pmbsduNTxWwy1vWaEyPtwOCDAJd6GDRnGWozPjA@mail.gmail.com>
References: <CAB8HAh5oJu3EkWmjY19WFnKU18gQyMDmY43D3K1RTkWn7VGPSg@mail.gmail.com>
 <CAEP_g=_qRPHK6bb4y3VwrwHWzGyb2B_LTttQk3pkcHAumRKn1g@mail.gmail.com>
 <CAB8HAh5PVjfSSWFz5H-ahKpUcq-cyd=1=KvC=6mZ2iQdwiV+Cg@mail.gmail.com>
 <CAEP_g=_qAK8pmbsduNTxWwy1vWaEyPtwOCDAJd6GDRnGWozPjA@mail.gmail.com>
Message-ID: <D21F036E.320E4%davidjoshuaevans@gmail.com>

Thank you Jesse,
The patch stopped the program call stack from killing ovs.
Awesome.
Will do some more tests today.


On 9/15/15, 10:54 PM, "Jesse Gross" <jesse at nicira.com> wrote:

>On Tue, Sep 15, 2015 at 7:38 PM, David Evans <davidjoshuaevans at gmail.com>
>wrote:
>> Thanks Jesse!
>> I think you may be close, but it is the ovs code that is re-entering
>>it's
>> self, this isn't an arp storm from a circle of traffic path, as far as
>>i can
>> tell. it is an attempt to transmit a single packet.. but never gets
>>even the
>> arp out to the stack at all.
>> you can see build_tunnel_send 3 times as the stack trace goes in the
>> original post. but no packets make it out. the program call stack is
>>13000
>> frames deep - which is why it crashed.
>
>When tunneling is done in userspace (such as with DPDK), the Linux
>stack is not involved at all since the point of DPDK is to avoid the
>kernel for performance reasons. That's why you see OVS reentering
>itself repeatedly as it tries to forward and then generate more ARP
>frames.
>
>I just sent out a patch CC'd to you that should fix this issue. Can
>you test it? Note that in this case 'fix' means that it will prevent
>OVS from crashing. However, traffic won't flow until the loop in the
>configuration is resolved. Based on the stack trace, my guess is that
>you have one or more patch ports connecting the bridges.



From jesse at nicira.com  Wed Sep 16 10:05:21 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 16 Sep 2015 10:05:21 -0700
Subject: [ovs-discuss] tnl arp causes infinite reentrant stack death.
In-Reply-To: <D21F036E.320E4%davidjoshuaevans@gmail.com>
References: <CAB8HAh5oJu3EkWmjY19WFnKU18gQyMDmY43D3K1RTkWn7VGPSg@mail.gmail.com>
 <CAEP_g=_qRPHK6bb4y3VwrwHWzGyb2B_LTttQk3pkcHAumRKn1g@mail.gmail.com>
 <CAB8HAh5PVjfSSWFz5H-ahKpUcq-cyd=1=KvC=6mZ2iQdwiV+Cg@mail.gmail.com>
 <CAEP_g=_qAK8pmbsduNTxWwy1vWaEyPtwOCDAJd6GDRnGWozPjA@mail.gmail.com>
 <D21F036E.320E4%davidjoshuaevans@gmail.com>
Message-ID: <CAEP_g=_WQnJ1Ry_CSmtLvOZ7-F2qq_i6hbYEgywFiXe+6m5vnQ@mail.gmail.com>

That's great, thanks a lot for testing.

On Wed, Sep 16, 2015 at 9:32 AM, David Evans <davidjoshuaevans at gmail.com> wrote:
> Thank you Jesse,
> The patch stopped the program call stack from killing ovs.
> Awesome.
> Will do some more tests today.
>
>
> On 9/15/15, 10:54 PM, "Jesse Gross" <jesse at nicira.com> wrote:
>
>>On Tue, Sep 15, 2015 at 7:38 PM, David Evans <davidjoshuaevans at gmail.com>
>>wrote:
>>> Thanks Jesse!
>>> I think you may be close, but it is the ovs code that is re-entering
>>>it's
>>> self, this isn't an arp storm from a circle of traffic path, as far as
>>>i can
>>> tell. it is an attempt to transmit a single packet.. but never gets
>>>even the
>>> arp out to the stack at all.
>>> you can see build_tunnel_send 3 times as the stack trace goes in the
>>> original post. but no packets make it out. the program call stack is
>>>13000
>>> frames deep - which is why it crashed.
>>
>>When tunneling is done in userspace (such as with DPDK), the Linux
>>stack is not involved at all since the point of DPDK is to avoid the
>>kernel for performance reasons. That's why you see OVS reentering
>>itself repeatedly as it tries to forward and then generate more ARP
>>frames.
>>
>>I just sent out a patch CC'd to you that should fix this issue. Can
>>you test it? Note that in this case 'fix' means that it will prevent
>>OVS from crashing. However, traffic won't flow until the loop in the
>>configuration is resolved. Based on the stack trace, my guess is that
>>you have one or more patch ports connecting the bridges.
>
>

From blp at nicira.com  Wed Sep 16 10:30:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 16 Sep 2015 10:30:20 -0700
Subject: [ovs-discuss] same pointer is destroyed 2 times
In-Reply-To: <CAHN905KrW7cYhi+gpQHatuiU32wn99XhHHGJF7k13-GoOhqxmQ@mail.gmail.com>
References: <CAHN905+eTiZa2b4fh0SPhkeqYnEmfM=DFCULrWPQRmGpUNizwA@mail.gmail.com>
 <20150916151401.GA24644@nicira.com>
 <CAHN905KrW7cYhi+gpQHatuiU32wn99XhHHGJF7k13-GoOhqxmQ@mail.gmail.com>
Message-ID: <20150916173020.GF13297@nicira.com>

Please don't drop the list.

The code in question looks like this:
    collectors_destroy(exporter->collectors);
    exporter->collectors = NULL;
and collectors_destroy() does nothing if passed a null pointer.

On Wed, Sep 16, 2015 at 10:57:39PM +0530, neeraj mehta wrote:
> both the below functions are called sequentially
>  dpif_ipfix_bridge_exporter_clear(exporter);
>  dpif_ipfix_exporter_destroy(&exporter->exporter);
> 
> and in both the functions code is freeing "exporter->collectors" through
> collector_destroy( ) function.
> 
> Regards
> Neeraj
> 
> On Wed, Sep 16, 2015 at 8:44 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Sep 16, 2015 at 08:12:24PM +0530, neeraj mehta wrote:
> > > Hi Team,
> > >
> > > I was looking a the code in ofproto-dpif-ipfix.c file. The
> > > function dpif_ipfix_bridge_exporter_destroy( ) invokes following two
> > > functions
> > >
> > > dpif_ipfix_bridge_exporter_destroy(struct dpif_ipfix_bridge_exporter
> > > *exporter)
> > > {
> > >     dpif_ipfix_bridge_exporter_clear(exporter);
> > >     dpif_ipfix_exporter_destroy(&exporter->exporter);
> > > }
> > >
> > > which internally invokes the following chain of functions
> > >
> > > dpif_ipfix_bridge_exporter_clear( )->dpif_ipfix_exporter_clear( )->
> > > collectors_destroy(exporter->collectors)
> > > dpif_ipfix_exporter_destroy ( )-> dpif_ipfix_exporter_clear ( )->
> > > collectors_destroy
> > > (exporter->collectors)
> > >
> > > So same pointer is destroyed 2 times in function. what's your view point
> > on
> > > same?
> >
> > Can you point to a specific pointer that is freed twice?
> >

From rayli1107 at gmail.com  Wed Sep 16 10:52:39 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Wed, 16 Sep 2015 10:52:39 -0700
Subject: [ovs-discuss] Group actions in group buckets?
Message-ID: <CA+=-Fx_+cs0rN8_cs0ftKM5h_jJmYXsZw9qfvshHwJ=jBHR6Gg@mail.gmail.com>

Hi, is there a way to reference another group as an action in a group
bucket?

When I tried doing that right now I'm getting
an OFPGMFC_CHAINING_UNSUPPORTED error.

What I want to do is setup some common actions in group 1, and then have
other groups include group 1 in a bucket for those actions. Is this
possible?

Thanks,
Ray
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/ae1e0e35/attachment-0001.html>

From blp at nicira.com  Wed Sep 16 10:53:48 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 16 Sep 2015 10:53:48 -0700
Subject: [ovs-discuss] Group actions in group buckets?
In-Reply-To: <CA+=-Fx_+cs0rN8_cs0ftKM5h_jJmYXsZw9qfvshHwJ=jBHR6Gg@mail.gmail.com>
References: <CA+=-Fx_+cs0rN8_cs0ftKM5h_jJmYXsZw9qfvshHwJ=jBHR6Gg@mail.gmail.com>
Message-ID: <20150916175348.GB24731@nicira.com>

On Wed, Sep 16, 2015 at 10:52:39AM -0700, Ray Li wrote:
> Hi, is there a way to reference another group as an action in a group
> bucket?
> 
> When I tried doing that right now I'm getting
> an OFPGMFC_CHAINING_UNSUPPORTED error.
> 
> What I want to do is setup some common actions in group 1, and then have
> other groups include group 1 in a bucket for those actions. Is this
> possible?

OVS 2.4 supports group chaining.

From rayli1107 at gmail.com  Wed Sep 16 10:58:38 2015
From: rayli1107 at gmail.com (Ray Li)
Date: Wed, 16 Sep 2015 10:58:38 -0700
Subject: [ovs-discuss] Group actions in group buckets?
In-Reply-To: <20150916175348.GB24731@nicira.com>
References: <CA+=-Fx_+cs0rN8_cs0ftKM5h_jJmYXsZw9qfvshHwJ=jBHR6Gg@mail.gmail.com>
 <20150916175348.GB24731@nicira.com>
Message-ID: <CA+=-Fx_GKrvNNZDMojFYrmtcnYmM4Nve+WtN2ta-_Jas4KXa+w@mail.gmail.com>

I tried doing

ovs-ofctl add-group br_vxlan
group_id=1000,type=all,bucket=bucket_id=0,output:1 -O OpenFlow15
ovs-ofctl add-group br_vxlan
group_id=2000,type=all,bucket=bucket_id=0,output:2 -O OpenFlow15
ovs-ofctl add-group br_vxlan
group_id=3000,type=all,bucket=bucket_id=0,group:1000 -O OpenFlow15

And the last one gave me the following error:
OFPT_ERROR (OF1.5) (xid=0x2): OFPGMFC_CHAINING_UNSUPPORTED
OFPT_GROUP_MOD (OF1.5) (xid=0x2):
 ADD group_id=3000,type=all,bucket=bucket_id:0,actions=group:1000


On Wed, Sep 16, 2015 at 10:53 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Wed, Sep 16, 2015 at 10:52:39AM -0700, Ray Li wrote:
> > Hi, is there a way to reference another group as an action in a group
> > bucket?
> >
> > When I tried doing that right now I'm getting
> > an OFPGMFC_CHAINING_UNSUPPORTED error.
> >
> > What I want to do is setup some common actions in group 1, and then have
> > other groups include group 1 in a bucket for those actions. Is this
> > possible?
>
> OVS 2.4 supports group chaining.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/4471cb11/attachment.html>

From blp at nicira.com  Wed Sep 16 11:04:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 16 Sep 2015 11:04:20 -0700
Subject: [ovs-discuss] Group actions in group buckets?
In-Reply-To: <CA+=-Fx_GKrvNNZDMojFYrmtcnYmM4Nve+WtN2ta-_Jas4KXa+w@mail.gmail.com>
References: <CA+=-Fx_+cs0rN8_cs0ftKM5h_jJmYXsZw9qfvshHwJ=jBHR6Gg@mail.gmail.com>
 <20150916175348.GB24731@nicira.com>
 <CA+=-Fx_GKrvNNZDMojFYrmtcnYmM4Nve+WtN2ta-_Jas4KXa+w@mail.gmail.com>
Message-ID: <20150916180420.GC24731@nicira.com>

Sorry, I misread the NEWS file.

OVS 2.4 does not support group chaining, but current master does and the
next release will.

On Wed, Sep 16, 2015 at 10:58:38AM -0700, Ray Li wrote:
> I tried doing
> 
> ovs-ofctl add-group br_vxlan
> group_id=1000,type=all,bucket=bucket_id=0,output:1 -O OpenFlow15
> ovs-ofctl add-group br_vxlan
> group_id=2000,type=all,bucket=bucket_id=0,output:2 -O OpenFlow15
> ovs-ofctl add-group br_vxlan
> group_id=3000,type=all,bucket=bucket_id=0,group:1000 -O OpenFlow15
> 
> And the last one gave me the following error:
> OFPT_ERROR (OF1.5) (xid=0x2): OFPGMFC_CHAINING_UNSUPPORTED
> OFPT_GROUP_MOD (OF1.5) (xid=0x2):
>  ADD group_id=3000,type=all,bucket=bucket_id:0,actions=group:1000
> 
> 
> On Wed, Sep 16, 2015 at 10:53 AM, Ben Pfaff <blp at nicira.com> wrote:
> 
> > On Wed, Sep 16, 2015 at 10:52:39AM -0700, Ray Li wrote:
> > > Hi, is there a way to reference another group as an action in a group
> > > bucket?
> > >
> > > When I tried doing that right now I'm getting
> > > an OFPGMFC_CHAINING_UNSUPPORTED error.
> > >
> > > What I want to do is setup some common actions in group 1, and then have
> > > other groups include group 1 in a bucket for those actions. Is this
> > > possible?
> >
> > OVS 2.4 supports group chaining.
> >

From mehtaneeraj07 at gmail.com  Wed Sep 16 11:45:54 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Thu, 17 Sep 2015 00:15:54 +0530
Subject: [ovs-discuss] Input argument to atoi
In-Reply-To: <CAHN905KFMrhsocJ158TMTeh8h_nzRUhMdNBz92PNjVaR=ZRY1Q@mail.gmail.com>
References: <CAHN905KFMrhsocJ158TMTeh8h_nzRUhMdNBz92PNjVaR=ZRY1Q@mail.gmail.com>
Message-ID: <CAHN905+C2zihmARCoMWywJM5sr6MCheBe26bOPUQ5Br=dHJtFg@mail.gmail.com>

On Tue, Sep 15, 2015 at 11:52 PM, neeraj mehta <mehtaneeraj07 at gmail.com>
wrote:

> Hi Team,
>
> I was looking a the code in learn.c file. As per my understanding atoi
> function take const char * as an input argument. but in the below snippet
> value is passed as argument which is char *.
>
> } else if (!strcmp(name, "priority")) {
>             learn->priority = atoi(value);
>         } else if (!strcmp(name, "idle_timeout")) {
>             learn->idle_timeout = atoi(value);
>         } else if (!strcmp(name, "hard_timeout")) {
>             learn->hard_timeout = atoi(value);
>         } else if (!strcmp(name, "fin_idle_timeout")) {
>             learn->fin_idle_timeout = atoi(value);
>         } else if (!strcmp(name, "fin_hard_timeout")) {
>             learn->fin_hard_timeout = atoi(value);
>
> Should't it be const char * ?
>
> Regards
> Neeraj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/7d71d432/attachment.html>

From blp at nicira.com  Wed Sep 16 11:51:54 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 16 Sep 2015 11:51:54 -0700
Subject: [ovs-discuss] Input argument to atoi
In-Reply-To: <CAHN905KFMrhsocJ158TMTeh8h_nzRUhMdNBz92PNjVaR=ZRY1Q@mail.gmail.com>
References: <CAHN905KFMrhsocJ158TMTeh8h_nzRUhMdNBz92PNjVaR=ZRY1Q@mail.gmail.com>
Message-ID: <CACjuMbyM=32aWBDcRKTC2Py_+9UfjGAo8ET588+WHVRh+Bak7A@mail.gmail.com>

On Tue, Sep 15, 2015 at 11:22 AM, neeraj mehta <mehtaneeraj07 at gmail.com> wrote:
> I was looking a the code in learn.c file. As per my understanding atoi
> function take const char * as an input argument. but in the below snippet
> value is passed as argument which is char *.

It's OK to pass a modifiable argument to a function that won't modify it.

From dev_raj82 at yahoo.com  Wed Sep 16 10:55:43 2015
From: dev_raj82 at yahoo.com (Nishanth Devarajan)
Date: Wed, 16 Sep 2015 23:25:43 +0530
Subject: [ovs-discuss] Setting up the OpenFlow network
Message-ID: <432851E1-5366-4A9F-ADCF-2D703B5763D4@yahoo.com>

Hey all,
		In this site  http://archive.openflow.org/wp/deploy-labsetup/ <http://archive.openflow.org/wp/deploy-labsetup/> suppose I want to connect a machine (say a VM  ‘Client’) to Switch 1 and another machine ( VM ’Server’) to Switch 3 and both the VMs are on the same subnet as the switches. Since all the machines are on the same subnet I’m assuming that you could ping Server from Client  without using the open flow setup right? So my question is :  how do you use the open flow setup to reach Server from Client. (the pipeline should be Client —— S1 ——— S2 ——— S3 —— Server) 

Reaching Server from Client you would usually do this right:   [from client] ping <sever i.p>
 

But here if I do that I would directly ping the server without using the switches. But I want to use the switches to reach the server. Any idea on how I could go about doing this?  Any workaround, suggestion, any idea would be good right now. I’m really desperate. 

Thanks,
Nishanth D
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150916/b3014e24/attachment.html>

From changzhi1990 at gmail.com  Wed Sep 16 20:45:34 2015
From: changzhi1990 at gmail.com (zhi)
Date: Thu, 17 Sep 2015 11:45:34 +0800
Subject: [ovs-discuss] The Compatibility between Openvswitch and Physical NIC
Message-ID: <CAENZyq6NWa+tvwd2GtdMyhPoGfErePm0tNLuk=OtYMHpEa8sog@mail.gmail.com>

Hi, everyone.
  Recently, we met a strange problem. We use Openstack by openvswitch. The
network node(physical server) crashes when vm send TCP packages. By my
analysis, the information of the physical nic (public network nic) is below:


     [root at server-65.0.aa.ustack.in ~ ]$ ethtool -i eth1
    driver: bnx2
    version: 2.2.4
    firmware-version: 6.2.12 bc 5.2.3 NCSI 2.0.11
    bus-info: 0000:01:00.1
    supports-statistics: yes
    supports-test: yes
    supports-eeprom-access: yes
    supports-register-dump: yes
    supports-priv-flags: no
    [root at server-65.0.aa.ustack.in ~ ]$ ethtool  eth1
    Settings for eth1:
        Supported ports: [ TP ]
        Supported link modes:   10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
                                1000baseT/Full
        Supported pause frame use: No
        Supports auto-negotiation: Yes
        Advertised link modes:  10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
                                1000baseT/Full
        Advertised pause frame use: No
        Advertised auto-negotiation: Yes
        Speed: Unknown!
        Duplex: Unknown! (255)
        Port: Twisted Pair
        PHYAD: 1
        Transceiver: internal
        Auto-negotiation: on
        MDI-X: Unknown
        Supports Wake-on: g
        Wake-on: d
        Link detected: no


The physical NIC is :
Ethernet controller: Broadcom Corporation NetXtreme II BCM5709 Gigabit
Ethernet (rev 20)

 The version of OVS is 2.1.2, the version of kernel
is 3.12.21-1.el6.x86_64.

Did anyone met the compatibility between ovs and physical nic?


Thx
changzhi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/98efcd08/attachment.html>

From tony.vanderpeet at gmail.com  Wed Sep 16 21:26:14 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Thu, 17 Sep 2015 16:26:14 +1200
Subject: [ovs-discuss] Possible new issue with flow modification
In-Reply-To: <7C66D39D-315C-4D07-BDDE-6285512A9F09@nicira.com>
References: <CAEruU62HQVob3GWEh=A4CkmRJ4-46nLN6bDgdrQV22pko8wH0A@mail.gmail.com>
 <CAKL=qh-JvynotgVvAw=KR4_eRNhZQC8M-4u0vsJ35M7hsBY4_A@mail.gmail.com>
 <7C66D39D-315C-4D07-BDDE-6285512A9F09@nicira.com>
Message-ID: <CAKL=qh_-QGMmRPtiZAmzLriA0tKw43YoGBVfO=yTbySt8LV1yg@mail.gmail.com>

Jarno

Yes, I can verify that your patch fixes my specially constructed test
case. Thanks
very much for this, I look forward to my next update from upstream
when I can throw
away my temporary fix.

Tony

On Wed, Sep 16, 2015 at 12:00 PM, Jarno Rajahalme <jrajahalme at nicira.com> wrote:
> Tony,
>
> Sorry that it took some time to get to this, and thanks for the detailed
> report, with it it was straightforward to add a test case verifying what is
> happening here.
>
> As confusing as it may be, the datapath flow dumps that show no vlan matches
> actually exact match the non-presence of vlans. This is due to how the
> netlink flow key interface has been designed, and relates to the fact that
> vlans are expressed with a specific ethertype, the vlan field, and the rest
> of the match headers in encapsulated netlink attributes. To enforce this,
> the Linux kernel module sets the vlan mask to all ones by default, which
> will then be overwritten only if there is an actual match on vlans. OVS
> userspace compensates for this when translating a netlink flow mask to OVS
> internal struct flow representation by also defaulting the vlan_tci field to
> all ones (0xffff). Hence, the existing code in revalidate_ukey() function is
> correct and does not need a fix.
>
> However, the userspace datapath, that is used for testing (I believe also
> with oftest), did not do anything special with the vlan_tci field, and was
> happy to wildcard it. Since the netlink format is still used when
> revalidating and dumping the userspace datapath flows, the same compensation
> described above was done also with userspace datapath flows, which indeed
> caused the existing megaflow to be modified and then matched regardless of
> the presence of vlan tags in incoming packets. I have sent out a patch that
> changes the userspace datapath to also force exact matching the vlan_tci
> field and adds a test case verifying that this works as intended.
>
> You can find the patch here:
> http://openvswitch.org/pipermail/dev/2015-September/060083.html
>
> It would be superb it you could verify that this fixes your test case
> problems.
>
> Regards,
>
>   Jarno
>
>
> On Aug 18, 2015, at 6:49 PM, Tony van der Peet <tony.vanderpeet at gmail.com>
> wrote:
>
> Ethan
>
> Thanks for the response. I have made some further progress, and in
> fact have discovered a slightly crude fix that allows my tests to
> pass. In ofproto-dpif-upcall.c:revalidate_ukey I have done this:
>
>    /* Since the kernel is free to ignore wildcarded bits in the mask, we
> can't
>     * directly check that the masks are the same.  Instead we check that the
>     * mask in the kernel is more specific i.e. less wildcarded, than what
>     * we've calculated here.  This guarantees we don't catch any packets we
>     * shouldn't with the megaflow. */
> // start of "fix"
>    /* To avoid all sorts of bother about special meanings of VLAN tags (VLAN
>     * present, VLAN absent, etc) let's just require the VLAN masks to be
> equal.
>     */
>    if (dp_mask.vlan_tci != wc.masks.vlan_tci) {
>        goto exit;
>    }
> // end of "fix"
>    dp64 = (uint64_t *) &dp_mask;
>    xout64 = (uint64_t *) &wc.masks;
>    for (i = 0; i < FLOW_U64S; i++) {
>        if ((dp64[i] | xout64[i]) != dp64[i]) {
>            goto exit;
>        }
>    }
>
> Obviously, "goto exit" cannot be wrong, it's just affecting
> performance. Whether it's the best possible fix is another question!
>
> This is the test I wrote using the oftest framework:
>
> class FlowInternalModify(MatchTest):
>    """
>    Match on ipv4 protocol field (UDP), then change to match on VLAN absence.
>    """
>    def runTest(self):
>        # Start out with no flows
>        delete_all_flows(self.controller)
>        do_barrier(self.controller)
>        time.sleep(2)
>
>        match = ofp.match([
>            ofp.oxm.eth_type(0x0800),
>            ofp.oxm.ip_proto(17),
>        ])
>
>        matching = {
>            "udp": simple_udp_packet(),
>        }
>
>        nonmatching = {
>            #"tcp": simple_tcp_packet(),
>            #"icmp": simple_icmp_packet(),
>        }
>
>        self.verify_match(match, matching, nonmatching)
>        time.sleep(3)
>
>        # Interlude, delete all flows
>        delete_all_flows(self.controller)
>        do_barrier(self.controller)
>        time.sleep(2)
>
>        match = ofp.match([
>            ofp.oxm.vlan_vid(ofp.OFPVID_NONE),
>        ])
>
>        matching = {
>            "no vlan tag": simple_udp_packet()
>        }
>
>        nonmatching = {
>            "vid=2 pcp=3": simple_udp_packet(dl_vlan_enable=True,
> vlan_vid=2, vlan_pcp=3),
>            "vid=0 pcp=7": simple_udp_packet(dl_vlan_enable=True,
> vlan_vid=0, vlan_pcp=7),
>            "vid=2 pcp=0": simple_udp_packet(dl_vlan_enable=True,
> vlan_vid=2, vlan_pcp=0),
>        }
>
>        self.verify_match(match, matching, nonmatching)
>
> Here's a run of this test without the "fix", with rules and flows
> being shown alternately while the test runs (some editing has been
> carried out).
>
> awplus#sh open flow
>
>
> awplus#sh open rule
> table_id=254, duration=57s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=57s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=57s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=57s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
>
> Test just started, deleted all rules and flows are aged out
>
>
> awplus#sh open rule
> duration=0s, n_packets=0, n_bytes=0, priority=1000,udp,actions=output:2
> duration=0s, n_packets=0, n_bytes=0, priority=1,actions=CONTROLLER:65535
> table_id=254, duration=61s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=61s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=61s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=61s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
> awplus#sh open flow
> recirc_id(0),in_port(1),eth_type(0x0800),ipv4(proto=17,frag=no),
> packets:0, bytes:0, used:never, actions:2
>
> First part of test, rule and flow are OK and in sync
>
>
> awplus#sh open rule
> table_id=254, duration=65s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=65s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=65s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=65s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
> awplus#sh open flow
> recirc_id(0),in_port(1),eth_type(0x0800),ipv4(proto=17,frag=no),
> packets:1, bytes:104, used:2.768s, actions:drop
>
> Rule has been deleted but flow hangs around, but with its action changed to
> drop, as expected.
>
>
> awplus#sh open rule
> duration=1s, n_packets=0, n_bytes=0,
> priority=1000,vlan_tci=0x0000/0x1fff,actions=output:2
> duration=1s, n_packets=0, n_bytes=0, priority=1,actions=CONTROLLER:65535
> table_id=254, duration=70s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=70s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=70s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=70s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
> awplus#sh open flow
> recirc_id(0),in_port(1),eth_type(0x0800),ipv4(proto=17,frag=no),
> packets:4, bytes:416, used:0.219s, actions:2
>
> New rule has been put in place, but whoops! old flow is still there and has
> inherited the new rule's
> action. This is not so good because the flow will take UDP packets
> regardless of the presence of
> a VLAN tag.
>
>
> awplus#sh open rule
> duration=11s, n_packets=3, n_bytes=312,
> priority=1000,vlan_tci=0x0000/0x1fff,actions=output:2
> duration=11s, n_packets=0, n_bytes=0, priority=1,actions=CONTROLLER:65535
> table_id=254, duration=80s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=80s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=80s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=80s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
> awplus#sh open flow
>
> Test over and flow has aged out. Test does not get rid of rule.
>
>
>
> WIth the above mentioned fix in place, here's what happens:
>
> awplus#sh open flow
>
>
> awplus#sh open rule
> table_id=254, duration=21s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=21s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=21s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=21s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
>
> Before test runs, switch has just rebooted, so nothing there.
>
>
> awplus#sh open rule
> duration=0s, n_packets=0, n_bytes=0, priority=1000,udp,actions=output:2
> duration=0s, n_packets=0, n_bytes=0, priority=1,actions=CONTROLLER:65535
> table_id=254, duration=31s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=31s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=31s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=31s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
> awplus#sh open flow
> recirc_id(0),in_port(1),eth_type(0x0800),ipv4(proto=17,frag=no),
> packets:0, bytes:0, used:never, actions:2
>
> First part of test, same as before, flow and rule are in sync
>
>
> awplus#sh open rule
> table_id=254, duration=35s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=35s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=35s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=35s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
> awplus#sh open flow
>
>
> Rule deleted in the interlude, and my new "fix" causes the flow to be
> deleted.
>
>
> awplus#sh open rule
> duration=0s, n_packets=0, n_bytes=0,
> priority=1000,vlan_tci=0x0000/0x1fff,actions=output:2
> duration=0s, n_packets=0, n_bytes=0, priority=1,actions=CONTROLLER:65535
> table_id=254, duration=38s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=38s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=38s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=38s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
> awplus#sh open flow
> recirc_id(0),in_port(1),eth_type(0x0800),ipv4(frag=no), packets:0,
> bytes:0, used:never, actions:2
> recirc_id(0),in_port(1),eth_type(0x8100),vlan(vid=0,pcp=7/0x0),encap(eth_type(0x0800),ipv4(frag=no)),
> packets:1, bytes:100, used:
> 0.368s, actions:userspace(pid=0,slow_path(controller))
> recirc_id(0),in_port(1),eth_type(0x8100),vlan(vid=2),encap(eth_type(0x0800),ipv4(frag=no)),
> packets:3, bytes:300, used:0.344s, ac
> tions:userspace(pid=0,slow_path(controller))
>
> The second part of the test is running and things are looking more like they
> do
> when the second part is run as a test on its own.
>
>
> awplus#sh open rule
> duration=11s, n_packets=2, n_bytes=204,
> priority=1000,vlan_tci=0x0000/0x1fff,actions=output:2
> duration=11s, n_packets=6, n_bytes=600, priority=1,actions=CONTROLLER:65535
> table_id=254, duration=50s, n_packets=0, n_bytes=0,
> priority=2,recirc_id=0,actions=drop
> table_id=254, duration=50s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x1,actions=controller(reason=no_match)
> table_id=254, duration=50s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x2,actions=drop
> table_id=254, duration=50s, n_packets=0, n_bytes=0,
> priority=0,reg0=0x3,actions=drop
> awplus#sh open flow
>
> And eventually the flow times out.
>
>
> So that's it!
>
> To answer your question, you can see that the flow hangs around, with
> its action changed, but it is no longer really representative of the
> new rule since it covers all UDP packets regardless of whether there
> is a VLAN tag in the packet or not. The non-matching cases are meant
> to be sent to the controller, but the flow sends them to port 2
> instead.
>
> By the way, your apology was totally unnecessary! You and the team do
> such a great job on this code and quality is so high that I moved to
> tip of master a long time ago and have never regretted it. The number
> of issues I find in the code is tiny. Thanks for all your efforts.
>
> Tony
>
>
> On Wed, Aug 19, 2015 at 12:07 PM, Ethan Jackson <ethan at nicira.com> wrote:
>
> Hi Tony,
>
> Sorry you're running into this, it does sound like a problem this
> patch could cause.  I suppose what I'm having trouble working out here
> is whether this is an actual bug in the patch, or if you're test
> framework is making assumptions about how the code works which are no
> longer valid.  Any additional information you have on your setup would
> be especially helpful, especially if you can whittle it down into a
> somewhat minimal series of steps which reproduces the problem.
>
> Some comments inline:
>
> In a nutshell, flows created for earlier tests are being kept alive
> and having their actions modified, but then the modification as a
> result of a later test causes that later test to fail.
>
>
> Correct, as a result of this patch, we try to modify flows in the
> datapath in place, rather than deleting them when their underlying
> openflow rules changes.
>
>
> when the rule becomes:
>
> duration=2s, n_packets=0, n_bytes=0,
> priority=1000,vlan_tci=0x0000/0x1fff,actions=output:2
>
>
> So what you're saying is, you add a rule that matches on VLAN tag, but
> the datapath rule corresponding to it never updates?  So all your
> traffic forwards based on the old rule not the new one?
>
> Ethan
>
>
> Disregarding the flow's age, any UDP packet sent, VLAN or not, will
> result in output:2, but this is not the correct action for all packets
> (those with a VLAN tag).
>
> My guess is that this is fairly deep and beyond my limited experience
> with OpenVSwitch. However, I will continue to work this issue, but
> thought you might like to know. And any advice much appreciated.
>
> Tony
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>
>
>

From a.alnajjar1 at uq.edu.au  Thu Sep 17 02:57:07 2015
From: a.alnajjar1 at uq.edu.au (Anees Mohsin Hadi Al-Najjar)
Date: Thu, 17 Sep 2015 09:57:07 +0000
Subject: [ovs-discuss] OVS inside emulated host
Message-ID: <58ed9c34f8a34950b454128b2a7bb7bc@uq-exmbx8.soe.uq.edu.au>

Dear all,
   I am new with SDN. Is it possible to use OVS switch inside a host in mininet?

Thanks for your help

Anees
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/f2d959d7/attachment.html>

From jesse at nicira.com  Thu Sep 17 09:40:11 2015
From: jesse at nicira.com (Jesse Gross)
Date: Thu, 17 Sep 2015 09:40:11 -0700
Subject: [ovs-discuss] The Compatibility between Openvswitch and
	Physical NIC
In-Reply-To: <CAENZyq6NWa+tvwd2GtdMyhPoGfErePm0tNLuk=OtYMHpEa8sog@mail.gmail.com>
References: <CAENZyq6NWa+tvwd2GtdMyhPoGfErePm0tNLuk=OtYMHpEa8sog@mail.gmail.com>
Message-ID: <CAEP_g=_X2aHSt9Lvj0y0KpCJSpiRAY+WrsOxqSCC5EN35E8bRQ@mail.gmail.com>

On Wednesday, September 16, 2015, zhi <changzhi1990 at gmail.com> wrote:

> Hi, everyone.
>   Recently, we met a strange problem. We use Openstack by openvswitch. The
> network node(physical server) crashes when vm send TCP packages. By my
> analysis, the information of the physical nic (public network nic) is below:
>

This is a pretty common NIC so I don't think there is a general issue
here. You'll need to capture some of kind of stack trace for anyone to be
able to take a look.

You are also using a pretty old version of OVS, so I would try upgrading.
Are you using the OVS kernel module or the one packed with the upstream
kernel?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/bc112223/attachment.html>

From mehtaneeraj07 at gmail.com  Thu Sep 17 09:41:22 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Thu, 17 Sep 2015 22:11:22 +0530
Subject: [ovs-discuss] Flow entry not deleted on the basis of out_port
	when specified in write_actions
In-Reply-To: <CAHN905LVBmjefy88bcSEezPGE02UJjG6Pof2JFpiMCgN0pRvXA@mail.gmail.com>
References: <CAHN905LVBmjefy88bcSEezPGE02UJjG6Pof2JFpiMCgN0pRvXA@mail.gmail.com>
Message-ID: <CAHN905+4QCTgZWZitnDceUX3RLTxZ+r6t7fgpgSa_ORCqysc9w@mail.gmail.com>

sorry,I forgot to mention that I am using OVS-2.3.2.

Regards
Neeraj

On Thu, Sep 17, 2015 at 10:08 PM, neeraj mehta <mehtaneeraj07 at gmail.com>
wrote:

> Hi Team,
>
> I want to delete the flow entries from the flow table on the basis of
> out_port.
> But I am not able to delete them when output port is specified in write
> actions
>
> I am using then RYU controller. Below is the procedure for your reference.
>
> ovs-ofctl -O Openflow13 add-flow br0 'table=2 action=output:2'(Only one
> entry is added in table)
>
> curl -X POST -d '{
>      "out_port":2
> }' http://localhost:8080/stats/aggregateflow/52236564475
> {"52236564475": [{"packet_count": 0, "byte_count": 0, "flow_count": 1}]}
> (related flow count is 1 So its working fine)
>
> [Using write_actions]
>
> ovs-ofctl -O Openflow13 add-flow br0 'table=2
> action=write_actions:output:2'(Only one entry is added in table)
>
> curl -X POST -d '{
>      "out_port":2
> }' http://localhost:8080/stats/aggregateflow/52236564475
> {"52236564475": [{"packet_count": 0, "byte_count": 0, "flow_count": 0}]}
> (Flow_count is 0 in this case)
>
> Is this the right behavior?
>
> Regards
> Neeraj
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/d41bd1da/attachment.html>

From mehtaneeraj07 at gmail.com  Thu Sep 17 09:38:21 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Thu, 17 Sep 2015 22:08:21 +0530
Subject: [ovs-discuss] Flow entry not deleted on the basis of out_port when
	specified in write_actions
Message-ID: <CAHN905LVBmjefy88bcSEezPGE02UJjG6Pof2JFpiMCgN0pRvXA@mail.gmail.com>

Hi Team,

I want to delete the flow entries from the flow table on the basis of
out_port.
But I am not able to delete them when output port is specified in write
actions

I am using then RYU controller. Below is the procedure for your reference.

ovs-ofctl -O Openflow13 add-flow br0 'table=2 action=output:2'(Only one
entry is added in table)

curl -X POST -d '{
     "out_port":2
}' http://localhost:8080/stats/aggregateflow/52236564475
{"52236564475": [{"packet_count": 0, "byte_count": 0, "flow_count": 1}]}
(related flow count is 1 So its working fine)

[Using write_actions]

ovs-ofctl -O Openflow13 add-flow br0 'table=2
action=write_actions:output:2'(Only one entry is added in table)

curl -X POST -d '{
     "out_port":2
}' http://localhost:8080/stats/aggregateflow/52236564475
{"52236564475": [{"packet_count": 0, "byte_count": 0, "flow_count": 0}]}
(Flow_count is 0 in this case)

Is this the right behavior?

Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/8b2552be/attachment.html>

From blp at nicira.com  Thu Sep 17 09:47:29 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 17 Sep 2015 09:47:29 -0700
Subject: [ovs-discuss] Flow entry not deleted on the basis of out_port
 when specified in write_actions
In-Reply-To: <CAHN905LVBmjefy88bcSEezPGE02UJjG6Pof2JFpiMCgN0pRvXA@mail.gmail.com>
References: <CAHN905LVBmjefy88bcSEezPGE02UJjG6Pof2JFpiMCgN0pRvXA@mail.gmail.com>
Message-ID: <20150917164729.GA30788@nicira.com>

On Thu, Sep 17, 2015 at 10:08:21PM +0530, neeraj mehta wrote:
> I want to delete the flow entries from the flow table on the basis of
> out_port.
> But I am not able to delete them when output port is specified in write
> actions

It's a bug.  Fixes have been posted but not reviewed, starting here:
        http://openvswitch.org/pipermail/dev/2015-September/059719.html
Feel free to test the fix.

From mehtaneeraj07 at gmail.com  Thu Sep 17 10:30:30 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Thu, 17 Sep 2015 23:00:30 +0530
Subject: [ovs-discuss] Flow entry not deleted on the basis of out_port
 when specified in write_actions
In-Reply-To: <20150917164729.GA30788@nicira.com>
References: <CAHN905LVBmjefy88bcSEezPGE02UJjG6Pof2JFpiMCgN0pRvXA@mail.gmail.com>
 <20150917164729.GA30788@nicira.com>
Message-ID: <CAHN905K65G92jG3U5V0Lf-tp6BY0RitUF5TbX1T1g1zXkyBiDg@mail.gmail.com>

Thanks for confirmation. I will surely test it and revert in case of any
concern.

Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/60baff51/attachment.html>

From er.manpreet25 at gmail.com  Thu Sep 17 10:39:57 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Thu, 17 Sep 2015 23:09:57 +0530
Subject: [ovs-discuss]  Unable to set ofp_flow_mod_flags value
Message-ID: <CALD=K8vAABsvuZ9y99r5mFVKwHVpAcAzXcnsC20xDLQT6RO3pw@mail.gmail.com>

Hi Team

I am new to OVS. I want to know how to set following ofp_flow_mod_flags in
OVS-2.3.2
- OFPFF_CHECK_OVERLAP (value=2)
- OFPFF_RESET_COUNTS  (value=4)

when I set the value of flag=2 or 4 through RYU controller, Flag value is
not seen in dump-flows
Add flow entry using ryu controller rest api with table=2, priority= 11,
flags=2, match=in_port:2 and action= output:2
cookie=0x0, duration=1.880s, table=2, n_packets=0, n_bytes=0, priority=11,
in_port=2 actions=output:2 [Flag value is not seen in dump-flows]

Whereas I am able to set the below flags
OFPFF_SEND_FLOW_REM
OFPFF_NO_PKT_COUNTS
OFPFF_NO_BYT_COUNTS

Is the implementation of these flags is still left ? or Is there is any
other procedure to set these flags ? or its a defect in OVS.

Regards
Manpreet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/c2f915ae/attachment.html>

From blp at nicira.com  Thu Sep 17 10:46:39 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 17 Sep 2015 10:46:39 -0700
Subject: [ovs-discuss] Unable to set ofp_flow_mod_flags value
In-Reply-To: <CALD=K8vAABsvuZ9y99r5mFVKwHVpAcAzXcnsC20xDLQT6RO3pw@mail.gmail.com>
References: <CALD=K8vAABsvuZ9y99r5mFVKwHVpAcAzXcnsC20xDLQT6RO3pw@mail.gmail.com>
Message-ID: <20150917174639.GB30788@nicira.com>

On Thu, Sep 17, 2015 at 11:09:57PM +0530, Manpreet Singh wrote:
> I am new to OVS. I want to know how to set following ofp_flow_mod_flags in
> OVS-2.3.2
> - OFPFF_CHECK_OVERLAP (value=2)
> - OFPFF_RESET_COUNTS  (value=4)

Why?  Those "flags" only affect what a flow_mod does.  They aren't part
of the state of a flow.

From a.alnajjar1 at uq.edu.au  Thu Sep 17 16:10:26 2015
From: a.alnajjar1 at uq.edu.au (Anees Mohsin Hadi Al-Najjar)
Date: Thu, 17 Sep 2015 23:10:26 +0000
Subject: [ovs-discuss] OVS inside emulated host
In-Reply-To: <58ed9c34f8a34950b454128b2a7bb7bc@uq-exmbx8.soe.uq.edu.au>
References: <58ed9c34f8a34950b454128b2a7bb7bc@uq-exmbx8.soe.uq.edu.au>
Message-ID: <3a9694e65b7342b5b8df3385bf531e0c@uq-exmbx8.soe.uq.edu.au>

Dear all,
Is it possible to use OVS bridge inside a host in mininet, and use this hosts interface as a port in the bridge?

Thanks for your help

Anees
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/738edb42/attachment.html>

From joestringer at nicira.com  Thu Sep 17 21:18:41 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Thu, 17 Sep 2015 21:18:41 -0700
Subject: [ovs-discuss] conntrack marks in ovs not showing up
In-Reply-To: <9DBB035D-2E1E-44B5-AFA3-BAA4ED93BB16@skyportsystems.com>
References: <9DBB035D-2E1E-44B5-AFA3-BAA4ED93BB16@skyportsystems.com>
Message-ID: <CANr6G5x6hq29Lb9oQOpQ8L3i9iez8KENoZ9SF6F-EWyBZS-qhw@mail.gmail.com>

On 15 September 2015 at 23:54, Ben Warren <ben at skyportsystems.com> wrote:
> Hi,
>
> I’m working off Justin Pettit’s ‘conntrack’ tree @ https://github.com/justinpettit/ovs/tree/conntrack, and can’t seem to get marks to work.
>
> Here’s an example of a flow (FTP server)
>
> ===
> ovs-ofctl add-flow br0 "table=3,cookie=0xb0b,priority=32000,ct_state=+new+trk,tcp,tp_dst=21 actions=ct(commit,alg=ftp,zone=2),resubmit(,4),set_field:9->ct_mark”
> ===
>
> which I believe should set the conntrack mark to 9 on packets that meet the match criteria
>
> When I connect via FTP and use the conntrack command line, I see the flow, but no sign of the mark:
>
> ===
> # conntrack -E | grep 237
>     [NEW] tcp      6 120 SYN_SENT src=10.99.0.17 dst=10.11.10.237 sport=54154 dport=21 [UNREPLIED] src=10.11.10.237 dst=10.99.0.17 sport=21 dport=54154 zone=2 helper=ftp
> ===
>
> My kernel is pretty vanilla, but marks definitely are seen when set via iptables.  Does it need to be patched to support marks coming from OVS?

The "ct_mark" tests in the testsuite have some examples, perhaps they
might help?
https://github.com/justinpettit/ovs/blob/conntrack/tests/system-traffic.at#L479

Do you see anything relevant in the logs?

Are you seeing packets hit the OpenFlow flows that you expect?

The datapath flows may also provide some insight.

From shettyg at nicira.com  Thu Sep 17 17:45:11 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Thu, 17 Sep 2015 17:45:11 -0700
Subject: [ovs-discuss] OVS inside emulated host
In-Reply-To: <3a9694e65b7342b5b8df3385bf531e0c@uq-exmbx8.soe.uq.edu.au>
References: <58ed9c34f8a34950b454128b2a7bb7bc@uq-exmbx8.soe.uq.edu.au>
 <3a9694e65b7342b5b8df3385bf531e0c@uq-exmbx8.soe.uq.edu.au>
Message-ID: <CAHbON5qQAVYm5dB3ZnFg_wZqvadR_fpommWh4rv=LrnrjZ1srA@mail.gmail.com>

Very few people in this mailing list know about mininet. I would
suggest that you ask this question in a mininet mailing list.

On Thu, Sep 17, 2015 at 4:10 PM, Anees Mohsin Hadi Al-Najjar
<a.alnajjar1 at uq.edu.au> wrote:
> Dear all,
>
> Is it possible to use OVS bridge inside a host in mininet, and use this
> hosts interface as a port in the bridge?
>
>
>
> Thanks for your help
>
>
>
> Anees
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From openvswitcher at 163.com  Thu Sep 17 22:04:08 2015
From: openvswitcher at 163.com (openvswitcher)
Date: Fri, 18 Sep 2015 13:04:08 +0800 (CST)
Subject: [ovs-discuss] Why the IP is not parsed in function
	parse_8021q_onward
In-Reply-To: <440b400f.b34b.14fde4d790e.Coremail.openvswitcher@163.com>
References: <12638b42.213ba.14fdbf9dba2.Coremail.openvswitcher@163.com>
 <440b400f.b34b.14fde4d790e.Coremail.openvswitcher@163.com>
Message-ID: <7685f595.10b36.14fded69470.Coremail.openvswitcher@163.com>

Hi, all


I  read the source in kernel mode, the function named 'ovs_nla_put_flow', and I see when the eth.type is ETH_P_8021Q 
but eth.tci is 0, the OVS_KEY_ATTR_ENCAP field will only have a header but no nested fields.
But I don't think this is one correct case because I think if the eth.type is ETH_P_8021Q the tci should not be 0.
Even if the case exists, I think we should also parse the IP and Transport Level header instead of "goto unencap" directly.


Could you explain why?
Looking forward for your reply. Thanks.






int ovs_nla_put_flow(const struct sw_flow_key *swkey,
     const struct sw_flow_key *output, struct sk_buff *skb)
{


        (...skip....)
if (swkey->eth.tci || swkey->eth.type == htons(ETH_P_8021Q)) {
__be16 eth_type;
eth_type = !is_mask ? htons(ETH_P_8021Q) : htons(0xffff);
if (nla_put_be16(skb, OVS_KEY_ATTR_ETHERTYPE, eth_type) ||
    nla_put_be16(skb, OVS_KEY_ATTR_VLAN, output->eth.tci))
goto nla_put_failure;
encap = nla_nest_start(skb, OVS_KEY_ATTR_ENCAP);
if (!swkey->eth.tci)
goto unencap;
} else
encap = NULL;
        (...skip....)
unencap:
if (encap)
nla_nest_end(skb, encap);


return 0;


nla_put_failure:
return -EMSGSIZE;
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150918/00a0c151/attachment.html>

From ben at skyportsystems.com  Thu Sep 17 22:33:54 2015
From: ben at skyportsystems.com (Ben Warren)
Date: Thu, 17 Sep 2015 22:33:54 -0700
Subject: [ovs-discuss] conntrack marks in ovs not showing up
In-Reply-To: <CANr6G5x6hq29Lb9oQOpQ8L3i9iez8KENoZ9SF6F-EWyBZS-qhw@mail.gmail.com>
References: <9DBB035D-2E1E-44B5-AFA3-BAA4ED93BB16@skyportsystems.com>
 <CANr6G5x6hq29Lb9oQOpQ8L3i9iez8KENoZ9SF6F-EWyBZS-qhw@mail.gmail.com>
Message-ID: <D5F2A62F-9A6F-43D6-8653-F0DDB9F510E1@skyportsystems.com>

Thanks for responding Joe.

> On Sep 17, 2015, at 9:18 PM, Joe Stringer <joestringer at nicira.com> wrote:
> 
> On 15 September 2015 at 23:54, Ben Warren <ben at skyportsystems.com <mailto:ben at skyportsystems.com>> wrote:
>> Hi,
>> 
>> I’m working off Justin Pettit’s ‘conntrack’ tree @ https://github.com/justinpettit/ovs/tree/conntrack, and can’t seem to get marks to work.
>> 
>> Here’s an example of a flow (FTP server)
>> 
>> ===
>> ovs-ofctl add-flow br0 "table=3,cookie=0xb0b,priority=32000,ct_state=+new+trk,tcp,tp_dst=21 actions=ct(commit,alg=ftp,zone=2),resubmit(,4),set_field:9->ct_mark”
>> ===
>> 
>> which I believe should set the conntrack mark to 9 on packets that meet the match criteria
>> 
>> When I connect via FTP and use the conntrack command line, I see the flow, but no sign of the mark:
>> 
>> ===
>> # conntrack -E | grep 237
>>    [NEW] tcp      6 120 SYN_SENT src=10.99.0.17 dst=10.11.10.237 sport=54154 dport=21 [UNREPLIED] src=10.11.10.237 dst=10.99.0.17 sport=21 dport=54154 zone=2 helper=ftp
>> ===
>> 
>> My kernel is pretty vanilla, but marks definitely are seen when set via iptables.  Does it need to be patched to support marks coming from OVS?
> 
> The "ct_mark" tests in the testsuite have some examples, perhaps they
> might help?
> https://github.com/justinpettit/ovs/blob/conntrack/tests/system-traffic.at#L479 <https://github.com/justinpettit/ovs/blob/conntrack/tests/system-traffic.at#L479>
> 
I did use these as a guide when constructing the flow mentioned above, but will play with it some more.  My understanding of CONNMARK is that the mark should get applied to all packets in related flows.  In this case, I was expecting a mark of 9 to be on control and data traffic for my FTP connection, but don’t see the marks.  Is this understanding correct?
> Do you see anything relevant in the logs?
> 
I haven’t looked at the logs, but will start now
> Are you seeing packets hit the OpenFlow flows that you expect?
> 
When I do an FTP transfer, I do see a flow that has matching criteria “+new+rel” increment by the right number of bytes, but if I put “ct_mark=9” in the match criteria, it is not found.
> The datapath flows may also provide some insight.

I guess I’m wondering if you think the conntrack feature is completely self-contained in the OVS tree, or if I need any particular configs in the kernel proper.  We’re using conntrack through Iptables and marks seem to work fine there.

In case it’s useful information, the kernel is pretty old (3.10.20), because it’s cross-compiled for a MIPS processor that needs a lot of extra sauce that’s not on kernel.org <http://kernel.org/>.

Thanks again - I’ll keep working at this.
—Ben
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/3e0c86ae/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3583 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/3e0c86ae/attachment-0001.bin>

From jimsonchacko at gmail.com  Fri Sep 18 02:34:36 2015
From: jimsonchacko at gmail.com (jimson chacko)
Date: Fri, 18 Sep 2015 15:04:36 +0530
Subject: [ovs-discuss] OpenFlow shared library support
Message-ID: <CAF4aouox1_FgNBRwCVFecNAb0GMujv=4t0oS_B+iwr2s7UY60g@mail.gmail.com>

Hi,

I am using OVS 2.3.1. I could generate the shared libraries using the
LT_INIT option in configure.ac file. I would like to know if there are good
examples (snippets) on how this shared object files could be used from an
other application to communicate to OVS just like ovs-ofctl.

I would like to bypass the command line parsing in ovs-ofctl in order to
make processing faster. Which of the functions will be a good place to
start with ?

Do you recommend using these shared libraries ?

Regards
Jimson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150918/591236e2/attachment.html>

From openvswitcher at 163.com  Fri Sep 18 18:14:58 2015
From: openvswitcher at 163.com (openvswitcher)
Date: Sat, 19 Sep 2015 09:14:58 +0800 (CST)
Subject: [ovs-discuss] About the vxlan checksum offload NIC
Message-ID: <d0d5016.3d28.14fe32b20af.Coremail.openvswitcher@163.com>

Hi, all


I want to know the principle of the vxlan checksum offload NIC.
I know the vxlan packet is composed of outer udp header, vxlan header and innel l2 frame.
And I read one description of a vxlan checksum offload NIC:



VXLAN overlay performance challenge:

Hypervisor IP stack and standard NICs are not aware of the client TCP/IP traffic.

The common offload hardware techniques such as:

TCP segmentation/re-assembly
RX/TX checksum offload
CPU core scaling (RSS/TSS)

do not operate on the VM TCP/IP packets (inner payload) which leads to significant CPU overhead and much lower performance.

Mellanox ConnectX-3 Pro adapter card offloads those tasks to the hardware leading to significant CPU overhead reduction and greater performance.




I think the ip checksum and tcp/udp transport checksum of inner payload is calculcated by vm itself, so why it is needed to be calculcated in physical NIC?




Looking forward for your reply. 




Thanks.




















 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150919/eed618b5/attachment.html>

From tieudieubk at gmail.com  Fri Sep 18 22:57:32 2015
From: tieudieubk at gmail.com (thanh-hai ngo)
Date: Sat, 19 Sep 2015 14:57:32 +0900
Subject: [ovs-discuss] How to cross compile and use OVS on Android Phone
Message-ID: <CABRpsF_JuSgAPnbePzkmZ=0=_MPvHHbNZuVTmmroS2-kNVh3tQ@mail.gmail.com>

Hi everyone !


Now, I want to *integrate OVS to android platform* in our lab but I don’t
know how to start.

I see some discussions in mailing list but it's long time ago and  not
detailed enough .

I try to follow the guide here:
http://prpl.stanford.edu/pmwiki/pmwiki.php?n=Main.CompileOpenflowVirtualSwitchKernelModuleOnAndroidOS

But the script :
http://web.stanford.edu/~huangty/cross_compile_patches.tar.gz

is unavailable.

Does anybody keep this patch  or help me by a basic guide ?

Thank you very much.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150919/eb1cb44a/attachment.html>

From syedsislam at live.com  Thu Sep 17 16:14:52 2015
From: syedsislam at live.com (Syed Islam)
Date: Thu, 17 Sep 2015 19:14:52 -0400
Subject: [ovs-discuss] how to drop torrent in open vswitch
Message-ID: <BAY175-W48D36E6ED2DD7D7FB0A9DFA15A0@phx.gbl>

Hello,How to drop all torrent traffic in open vswitch.
Thanks,
Syed 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/861de1f0/attachment-0001.html>

From syedsislam at live.com  Thu Sep 17 16:35:27 2015
From: syedsislam at live.com (Syed Islam)
Date: Thu, 17 Sep 2015 19:35:27 -0400
Subject: [ovs-discuss] Blocking torrent using open vswitch
Message-ID: <BAY175-W203A80344ACA74D6C3157FA15A0@phx.gbl>

Hello,I'm trying to block torrent traffic in xenserver 6.5 using open vswitch but I can't find any document on how to block torrent traffic in open vswitch.
Any insight will be highly appreciated.
Thanks,
Syed 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150917/efe641bd/attachment-0001.html>

From takahashi.minoru7 at gmail.com  Thu Sep 17 23:58:19 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Fri, 18 Sep 2015 15:58:19 +0900
Subject: [ovs-discuss] [PATCH] Fix A bug about ofp-msgs.h.
Message-ID: <55FBB60B.7040205@gmail.com>

Hi,

I found a bug about ofp-msgs.h.

Number of OFPMP_TABLE_DESC is *14*.
(Plese refer to "Header file openflow.h" of OF1.4/5spec)

However, ofp-msgs.h set these to *15*.
https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L381
https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L384

Attached patch fixes this probelm.

thanks,
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-ofp-msgs-fix-enum-of-OFPMP_TABLE_DESC.patch
Type: text/x-patch
Size: 961 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150918/ae0427d3/attachment-0001.bin>

From 555deepaksingh at gmail.com  Fri Sep 18 06:47:33 2015
From: 555deepaksingh at gmail.com (deepaksingh)
Date: Fri, 18 Sep 2015 19:17:33 +0530
Subject: [ovs-discuss] [ovs-dev] Matadata marked onto the packet
Message-ID: <CADQZbY3=nVKFKsmexCBV-X7A9+930TSSyAk5a_zgEZ7yhun7WA@mail.gmail.com>

Hi,
I am getting multiple OXM field in packet-in msg. First one is coming due
to OXM_OF_IN_PORT and second one due to NXM_NX_PKT_MARK.
With two OXM field it is causing packet-in as a wrong packets and SDN
controller is not able to fetch these packets. I have attached the
packet-in. Is it right to be multiple OXM fields ?
..................
In my switch i am marking skb(say from port 2 and this marking is used only
for internal switch not for OVS) and sending it to the OVS. If i mark skb
to zero it will not add the NXM_NX_PKT_MARK field.
Could i mark it to zero in OVS or it will cause any issue ?
Please help me out.

-- 
Thanks you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150918/7e6fafdd/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: OXM.png
Type: image/png
Size: 17869 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150918/7e6fafdd/attachment-0001.png>

From dev_raj82 at yahoo.com  Fri Sep 18 07:39:14 2015
From: dev_raj82 at yahoo.com (Nishanth Devarajan)
Date: Fri, 18 Sep 2015 20:09:14 +0530
Subject: [ovs-discuss] Creating a small SDN network.
Message-ID: <3878C114-E06E-423B-9469-79D1BC88EDB0@yahoo.com>

Hey all,
		I want to create a small Software defined network using only VMs and I’ve run into an issue.. The topology is : Client —— S1 ——— S2 ——— S3 —— Server   and the switches are controlled by a controller.  Each node is a VM with the switch nodes running OVS. I’m using VirtualBox Internal networking to set up the subnetting using a DHCP server.  I want to ping the server from the client and the packets should flow via the created topology. But when actually I do ping the server (from the client), it uses the subnet to directly reach the server without using the switches. I can’t make  S1 the client's default gateway because when I delete the DHCP rule table in the client I lose network connectivity. I’ve tried adding both the rule tables to the client and making S1 the default gateway, but even then it uses to the subnet to ping the server. How do I fix this problem? I appreciate your help on this.

Thanks,
Nishanth D

From jpettit at nicira.com  Sun Sep 20 18:10:39 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Sun, 20 Sep 2015 18:10:39 -0700
Subject: [ovs-discuss] Blocking torrent using open vswitch
In-Reply-To: <BAY175-W203A80344ACA74D6C3157FA15A0@phx.gbl>
References: <BAY175-W203A80344ACA74D6C3157FA15A0@phx.gbl>
Message-ID: <33C9A05A-6849-42B9-81CE-C237AD613FE7@nicira.com>


> On Sep 17, 2015, at 4:35 PM, Syed Islam <syedsislam at live.com> wrote:
> 
> Hello,
> I'm trying to block torrent traffic in xenserver 6.5 using open vswitch but I can't find any document on how to block torrent traffic in open vswitch.

OVS doesn't provide any mechanism for discovering an L7 protocol.  You would need to be able to identify the traffic based on the L4 port or 5-tuple and adding a drop flow.

--Justin



From Star.Chang at advantech.com.tw  Sun Sep 20 19:32:37 2015
From: Star.Chang at advantech.com.tw (Star.Chang)
Date: Mon, 21 Sep 2015 10:32:37 +0800
Subject: [ovs-discuss] vhost-user state in openvswitch
Message-ID: <81715E7257BD4547BD37DB19AB0A553C01B29FDE@TAIPEI01.ADVANTECH.CORP>

We bring 2 VMs up with vhost-user type. We can see eth0 interfaces created in 2 VMs with proper mac address we assign. After IP address assignment, 2 VMs could not PING to each other when they are in the same network segment.

However, we check link up state via ovs-ofctl utility but LINK_DOWN as below.

Have any one with experiences and give some helps ... Thanks!!!

$ sudo ./utilities/ovs-ofctl show ovsbr0
OFPT_FEATURES_REPLY (xid=0x2): dpid:00000670da615e4a
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
1(vhost-user1): addr:00:00:00:00:00:00
config: PORT_DOWN
state: LINK_DOWN
speed: 0 Mbps now, 0 Mbps max
2(vhost-user2): addr:00:00:00:00:00:00
config: PORT_DOWN
state: LINK_DOWN
speed: 0 Mbps now, 0 Mbps max
LOCAL(ovsbr0): addr:06:70:da:61:5e:4a
config: PORT_DOWN
state: LINK_DOWN
current: 10MB-FD COPPER
speed: 10 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150921/4f6931b7/attachment.html>

From er.manpreet25 at gmail.com  Sun Sep 20 20:58:26 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Mon, 21 Sep 2015 09:28:26 +0530
Subject: [ovs-discuss] Unable to set ofp_flow_mod_flags value
In-Reply-To: <20150917174639.GB30788@nicira.com>
References: <CALD=K8vAABsvuZ9y99r5mFVKwHVpAcAzXcnsC20xDLQT6RO3pw@mail.gmail.com>
 <20150917174639.GB30788@nicira.com>
Message-ID: <CALD=K8v_waJKvzZVYqSaauh-uBBvU9ykCvL2oMu4RFhRiYhHbQ@mail.gmail.com>

Hi Ben,

Thanks!! for reply but i am again try to elaborate the flag behavior as per
my understanding.

I am adding flow entry from controller with values table_id=2, priority=22,
flags=1 match=(in_port=2)

and action=(output=4) then dump-flows i have get the following details:



cookie=0x0, duration=3.646s, table=1, n_packets=0, n_bytes=0, send_flow_rem
priority=22,in_port=1 actions=output:2



Able to see send_flow_rem flag in dump-flows



Doing same for flags=8 and flag=16 and getting following details using
dump-flows:



cookie=0x0, duration=16.703s, table=1, n_packets=0, n_bytes=0,
no_packet_counts priority=22,in_port=1 actions=output:2



cookie=0x0, duration=3.117s, table=1, n_packets=0, n_bytes=0, no_byte_counts
priority=22,in_port=1 actions=output:2



When i am setting flags=2 and flags=4 using controller with same procedure
as above then using dump flows getting

following details:



cookie=0x0, duration=3.613s, table=3, n_packets=0, n_bytes=0,
priority=22,in_port=1 actions=output:2



cookie=0x0, duration=3.613s, table=3, n_packets=0, n_bytes=0,
priority=22,in_port=1 actions=output:2



Unable to see overlap and reset_counts flag value in dump-flows.



For Reference:



enum ofp_flow_mod_flags {

OFPFF_SEND_FLOW_REM = 1 << 0, /* Send flow removed message when flow
 expires or is deleted. */

OFPFF_CHECK_OVERLAP = 1 << 1, /* Check for overlapping entries first. */

OFPFF_RESET_COUNTS = 1 << 2, /* Reset flow packet and byte counts. */

OFPFF_NO_PKT_COUNTS = 1 << 3, /* Don't keep track of packet count. */

OFPFF_NO_BYT_COUNTS = 1 << 4, /* Don't keep track of byte count. */

};

On Thu, Sep 17, 2015 at 11:16 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Thu, Sep 17, 2015 at 11:09:57PM +0530, Manpreet Singh wrote:
> > I am new to OVS. I want to know how to set following ofp_flow_mod_flags
> in
> > OVS-2.3.2
> > - OFPFF_CHECK_OVERLAP (value=2)
> > - OFPFF_RESET_COUNTS  (value=4)
>
> Why?  Those "flags" only affect what a flow_mod does.  They aren't part
> of the state of a flow.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150921/f3fa87d7/attachment.html>

From ciara.loftus at intel.com  Mon Sep 21 02:23:19 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Mon, 21 Sep 2015 09:23:19 +0000
Subject: [ovs-discuss] vhost-user state in openvswitch
In-Reply-To: <81715E7257BD4547BD37DB19AB0A553C01B29FDE@TAIPEI01.ADVANTECH.CORP>
References: <81715E7257BD4547BD37DB19AB0A553C01B29FDE@TAIPEI01.ADVANTECH.CORP>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC24CB92F5C@IRSMSX106.ger.corp.intel.com>

> 
> We bring 2 VMs up with vhost-user type. We can see eth0 interfaces created
> in 2 VMs with proper mac address we assign. After IP address assignment, 2
> VMs could not PING to each other when they are in the same network
> segment.
> However, we check link up state via ovs-ofctl utility but LINK_DOWN as
> below.
> Have any one with experiences and give some helps ... Thanks!!!
> $ sudo ./utilities/ovs-ofctl show ovsbr0
> OFPT_FEATURES_REPLY (xid=0x2): dpid:00000670da615e4a
> n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS
> ARP_MATCH_IP
> actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src
> mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src
> mod_tp_dst
> 1(vhost-user1): addr:00:00:00:00:00:00
> config: PORT_DOWN
> state: LINK_DOWN
> speed: 0 Mbps now, 0 Mbps max
> 2(vhost-user2): addr:00:00:00:00:00:00
> config: PORT_DOWN
> state: LINK_DOWN
> speed: 0 Mbps now, 0 Mbps max
> LOCAL(ovsbr0): addr:06:70:da:61:5e:4a
> config: PORT_DOWN
> state: LINK_DOWN
> current: 10MB-FD COPPER
> speed: 10 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0

Hi,

You can ignore the LINK_DOWN state - it does not give the correct state of the port at the moment.

Can you make sure the default (NORMAL) flow is installed in the switch which should allow these pings to be sent/received? eg:
ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=136.745s, table=0, n_packets=121, n_bytes=22148, idle_age=15, priority=0 actions=NORMAL

Also some quick things to check:
- Make sure you are using a separate vhost-user port per VM ie. not using the same socket device on 2 VMs.
- You are using QEMU v2.2.0 or later

Thanks,
Ciara

From syedsislam at live.com  Sun Sep 20 18:43:18 2015
From: syedsislam at live.com (Syed Islam)
Date: Sun, 20 Sep 2015 21:43:18 -0400
Subject: [ovs-discuss] Blocking torrent using open vswitch
In-Reply-To: <33C9A05A-6849-42B9-81CE-C237AD613FE7@nicira.com>
References: <BAY175-W203A80344ACA74D6C3157FA15A0@phx.gbl>
 <33C9A05A-6849-42B9-81CE-C237AD613FE7@nicira.com>
Message-ID: <BAY407-EAS3338E3780585E472416BE96A1460@phx.gbl>

Hello Justin,
Any example will be highly appreciated.

Syed

> On Sep 20, 2015, at 9:10 PM, Justin Pettit <jpettit at nicira.com> wrote:
> 
> 
>> On Sep 17, 2015, at 4:35 PM, Syed Islam <syedsislam at live.com> wrote:
>> 
>> Hello,
>> I'm trying to block torrent traffic in xenserver 6.5 using open vswitch but I can't find any document on how to block torrent traffic in open vswitch.
> 
> OVS doesn't provide any mechanism for discovering an L7 protocol.  You would need to be able to identify the traffic based on the L4 port or 5-tuple and adding a drop flow.
> 
> --Justin
> 
> 

From rishi.raj2509 at gmail.com  Mon Sep 21 04:31:01 2015
From: rishi.raj2509 at gmail.com (RishiRaj Maulick)
Date: Mon, 21 Sep 2015 17:01:01 +0530
Subject: [ovs-discuss] Query with respect to DB commit even when vsctl failed
Message-ID: <CAOLvpU5vWcyQpKkmuGAjf0F9-zp_qpBzC46o7CuF-Pq9_anwDQ@mail.gmail.com>

Hi ,



I have been using OVS recently and I noticed the following -



1)    1)   I did not insert the openvswitch kernel module

2)      2) Using “ovs-vsctl add-br br0” command , I tried to add a bridge –
which failed for obvious reasons. There is an error log that is displayed
on ovs-vsctl screen as well.

3)      3) However there are entries that are left in the ovs database –
“ovsdb-client dump”. I can see addition to the bridge , port , interface
and openvswitch tables – all entries pertaining to the bridge “br0”.

Ideally an application has to delete the bridge “br0” from the DB after
hitting an error like this.



I see that the ovs-vsctl can detect these errors through checks for the
field in the interface table entry "ofport”.



The question is how can a remote management interface for any proprietary
schemas get to know about application processing failures .



Thanks and regards,
Rishi Raj Maulick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150921/86682aaa/attachment.html>

From dsanvito90 at gmail.com  Mon Sep 21 07:11:28 2015
From: dsanvito90 at gmail.com (Davide Sanvito)
Date: Mon, 21 Sep 2015 16:11:28 +0200
Subject: [ovs-discuss] Learn action in group table
Message-ID: <CAJ-RJ=UWp0rXFZfayNC692-MUOPFzE9GDfhm=qv_ESB6yoJGKg@mail.gmail.com>

Hi guys,

I'm trying to execute a learn action to table 0 from a group entry. The
application is written with the Ryu framework and by using ovs-ofctl I can
confirm that buckets have the correct learn action associated and that
packets go through the group table.

By the way no flow entry is added to table 0 by the execution of the learn
action.

Is this a bug? Is the learn action supported as an action in a group entry?


Thank you!

Davide Sanvito
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150921/5ffb1d95/attachment.html>

From sharmila.radhakrishnan at intel.com  Mon Sep 21 08:01:52 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Mon, 21 Sep 2015 15:01:52 +0000
Subject: [ovs-discuss] Configure failing in OVS build
Message-ID: <1BA01C3192A665469272B2597052DDFF56FBFD07@BGSMSX104.gar.corp.intel.com>

Hi All,
  Iam trying to install OVS with DPDK . Iam using OVS version 2.4.0 and DPDK version 2.1.0.

root at pktgen:/usr/src/dpdk# git branch
* (detached from v2.1.0)
  master

root at pktgen:/usr/src/ovs# git branch
* (detached from v2.4.0)
  master

I built the DPDK with
 CONFIG_RTE_BUILD_COMBINE_LIBS=y in the config/common_linuapp file.

The command used to build DPDK is "make install T=x86_64-ivshmem-linuxapp-gcc". And I confirmed the folder exists in dpdk dir

root at pktgen:/usr/src/dpdk# ls
app  config  doc  drivers  examples  GNUmakefile  lib  LICENSE.GPL  LICENSE.LGPL  MAINTAINERS  Makefile  mk  pkg  scripts  tools  x86_64-ivshmem-linuxapp-gcc

I tried the configure command from OVS
root at pktgen:/usr/src/ovs# ./configure --with-dpdk=/usr/src/dpdk/x86_64-ivshmem-linuxapp-gcc CFLAGS="-g -O2 -Wno-cast-align"

Each time it fails with
checking whether make has GNU make $(if) extension... yes
configure: error: cannot link with dpdk

I tried cleaning up the folders and building it multiple times. It fails with the same error.

OS Used:
root at pktgen:/usr/src/ovs# uname -a
Linux pktgen 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux
root at pktgen:/usr/src/ovs# lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 14.04.3 LTS
Release:        14.04
Codename:       trusty

Thanks in Advance for your Help!,

Regards,
Sharmila

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150921/c5fa2773/attachment.html>

From kevin.traynor at intel.com  Mon Sep 21 14:00:27 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Mon, 21 Sep 2015 21:00:27 +0000
Subject: [ovs-discuss] Configure failing in OVS build
In-Reply-To: <1BA01C3192A665469272B2597052DDFF56FBFD07@BGSMSX104.gar.corp.intel.com>
References: <1BA01C3192A665469272B2597052DDFF56FBFD07@BGSMSX104.gar.corp.intel.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F745250462@IRSMSX104.ger.corp.intel.com>

Hi

> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> Radhakrishnan, Sharmila
> Sent: Monday, September 21, 2015 8:02 AM
> To: 'discuss at openvswitch.org'
> Subject: [ovs-discuss] Configure failing in OVS build
> 
> Hi All,
>   Iam trying to install OVS with DPDK . Iam using OVS version 2.4.0 and DPDK
> version 2.1.0.

OVS 2.4.0 builds with DPDK 2.0, not DPDK 2.1. See INSTALL.DPDK.md for matching DPDK version.

If you did want this combination, then you could backport the patch that adds DPDK 2.1 integration.

> 
> root at pktgen:/usr/src/dpdk# git branch
> * (detached from v2.1.0)
>   master
> 
> root at pktgen:/usr/src/ovs# git branch
> * (detached from v2.4.0)
>   master
> 
> I built the DPDK with
>  CONFIG_RTE_BUILD_COMBINE_LIBS=y in the config/common_linuapp file.
> 
> The command used to build DPDK is "make install T=x86_64-ivshmem-linuxapp-
> gcc". And I confirmed the folder exists in dpdk dir
> 
> root at pktgen:/usr/src/dpdk# ls
> app  config  doc  drivers  examples  GNUmakefile  lib  LICENSE.GPL  LICENSE.L
> GPL  MAINTAINERS  Makefile  mk  pkg  scripts  tools  x86_64-ivshmem-linuxapp-
> gcc
> 
> I tried the configure command from OVS
>        root at pktgen:/usr/src/ovs# ./configure --with-
> dpdk=/usr/src/dpdk/x86_64-ivshmem-linuxapp-gcc CFLAGS="-g -O2 -Wno-cast-
> align"
> 
> Each time it fails with
> checking whether make has GNU make $(if) extension... yes
> configure: error: cannot link with dpdk
> 
> I tried cleaning up the folders and building it multiple times. It fails with
> the same error.
> 
> OS Used:
> root at pktgen:/usr/src/ovs# uname -a
> Linux pktgen 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:16:20 UTC
> 2015 x86_64 x86_64 x86_64 GNU/Linux
> root at pktgen:/usr/src/ovs# lsb_release -a
> No LSB modules are available.
> Distributor ID: Ubuntu
> Description:    Ubuntu 14.04.3 LTS
> Release:        14.04
> Codename:       trusty
> 
> Thanks in Advance for your Help!,
> 
> Regards,
> Sharmila


From changzhi1990 at gmail.com  Mon Sep 21 19:00:26 2015
From: changzhi1990 at gmail.com (zhi)
Date: Tue, 22 Sep 2015 10:00:26 +0800
Subject: [ovs-discuss] Broadcom Ethernet doesn't work when forward packages
	by using OVS2.1.2
Message-ID: <CAENZyq6wEbkq8_0f0rEPDt-Wp=P-u+LscTCAwKVLvwc1_aaM2A@mail.gmail.com>

Hi, all.
    Recently, I met a very strange problem by using OVS2.1.2. The server
crash when I am using Broadcom BCM5709 Gigabit Ethernet. The phenomenon of this
problem is that the server crashes when the Ethernetforward TCP packages. Is
there anybody work in Broadcom ? BTW, the kernel version
is 3.12.21-1.el6.x86_64.

Does anyone met the similar problem just like me? My physical ethernet
is Broadcom BCM5709 Gigabit Ethernet. Below shows the detail information:

[root at server-64.0aa ~ ]$ ethtool -i eth1
driver: bnx2
version: 2.2.4
firmware-version: 6.2.12 bc 5.2.3 NCSI 2.0.11
bus-info: 0000:01:00.1
supports-statistics: yes
supports-test: yes
supports-eeprom-access: yes
supports-register-dump: yes
supports-priv-flags: no
[root at server-64.0aa.~ ]$ ethtool  eth1
Settings for eth1:
        Supported ports: [ TP ]
        Supported link modes:   10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
                                1000baseT/Full
        Supported pause frame use: No
        Supports auto-negotiation: Yes
        Advertised link modes:  10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
                                1000baseT/Full
        Advertised pause frame use: No
        Advertised auto-negotiation: Yes
        Speed: 1000Mb/s
        Duplex: Full
        Port: Twisted Pair
        PHYAD: 1
        Transceiver: internal
        Auto-negotiation: on
        MDI-X: Unknown
        Supports Wake-on: g
        Wake-on: d
        Link detected: yes
[root at server-64.0aa.~ ]$ lspci | grep Eth
01:00.0 Ethernet controller: Broadcom Corporation NetXtreme II BCM5709
Gigabit Ethernet (rev 20)
01:00.1 Ethernet controller: Broadcom Corporation NetXtreme II BCM5709
Gigabit Ethernet (rev 20)
02:00.0 Ethernet controller: Broadcom Corporation NetXtreme II BCM5709
Gigabit Ethernet (rev 20)
02:00.1 Ethernet controller: Broadcom Corporation NetXtreme II BCM5709
Gigabit Ethernet (rev 20)
05:00.0 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+
Network Connection (rev 01)
05:00.1 Ethernet controller: Intel Corporation 82599ES 10-Gigabit SFI/SFP+
Network Connection (rev 01)


Looking forward to your reply.


Thx.
Zhi Chang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150922/e4f1a52c/attachment.html>

From sharmila.radhakrishnan at intel.com  Mon Sep 21 21:49:23 2015
From: sharmila.radhakrishnan at intel.com (Radhakrishnan, Sharmila)
Date: Tue, 22 Sep 2015 04:49:23 +0000
Subject: [ovs-discuss] Configure failing in OVS build
In-Reply-To: <BC0FEEC7D7650749874CEC11314A88F745250462@IRSMSX104.ger.corp.intel.com>
References: <1BA01C3192A665469272B2597052DDFF56FBFD07@BGSMSX104.gar.corp.intel.com>
 <BC0FEEC7D7650749874CEC11314A88F745250462@IRSMSX104.ger.corp.intel.com>
Message-ID: <1BA01C3192A665469272B2597052DDFF56FC04C5@BGSMSX104.gar.corp.intel.com>

Hi Kevin,
  https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md Speaks only about the DPDK2.1. Where is the information you are mentioning present?

Thanks,
Sharmila

-----Original Message-----
From: Traynor, Kevin 
Sent: Tuesday, September 22, 2015 2:30 AM
To: Radhakrishnan, Sharmila; 'discuss at openvswitch.org'
Subject: RE: Configure failing in OVS build

Hi

> -----Original Message-----
> From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of 
> Radhakrishnan, Sharmila
> Sent: Monday, September 21, 2015 8:02 AM
> To: 'discuss at openvswitch.org'
> Subject: [ovs-discuss] Configure failing in OVS build
> 
> Hi All,
>   Iam trying to install OVS with DPDK . Iam using OVS version 2.4.0 
> and DPDK version 2.1.0.

OVS 2.4.0 builds with DPDK 2.0, not DPDK 2.1. See INSTALL.DPDK.md for matching DPDK version.

If you did want this combination, then you could backport the patch that adds DPDK 2.1 integration.

> 
> root at pktgen:/usr/src/dpdk# git branch
> * (detached from v2.1.0)
>   master
> 
> root at pktgen:/usr/src/ovs# git branch
> * (detached from v2.4.0)
>   master
> 
> I built the DPDK with
>  CONFIG_RTE_BUILD_COMBINE_LIBS=y in the config/common_linuapp file.
> 
> The command used to build DPDK is "make install 
> T=x86_64-ivshmem-linuxapp- gcc". And I confirmed the folder exists in 
> dpdk dir
> 
> root at pktgen:/usr/src/dpdk# ls
> app  config  doc  drivers  examples  GNUmakefile  lib  LICENSE.GPL  
> LICENSE.L GPL  MAINTAINERS  Makefile  mk  pkg  scripts  tools  
> x86_64-ivshmem-linuxapp- gcc
> 
> I tried the configure command from OVS
>        root at pktgen:/usr/src/ovs# ./configure --with- 
> dpdk=/usr/src/dpdk/x86_64-ivshmem-linuxapp-gcc CFLAGS="-g -O2 
> -Wno-cast- align"
> 
> Each time it fails with
> checking whether make has GNU make $(if) extension... yes
> configure: error: cannot link with dpdk
> 
> I tried cleaning up the folders and building it multiple times. It 
> fails with the same error.
> 
> OS Used:
> root at pktgen:/usr/src/ovs# uname -a
> Linux pktgen 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 
> 21:16:20 UTC
> 2015 x86_64 x86_64 x86_64 GNU/Linux
> root at pktgen:/usr/src/ovs# lsb_release -a No LSB modules are available.
> Distributor ID: Ubuntu
> Description:    Ubuntu 14.04.3 LTS
> Release:        14.04
> Codename:       trusty
> 
> Thanks in Advance for your Help!,
> 
> Regards,
> Sharmila


From tony.vanderpeet at gmail.com  Mon Sep 21 22:18:37 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Tue, 22 Sep 2015 17:18:37 +1200
Subject: [ovs-discuss] Where are the hashes calculated please?
Message-ID: <CAKL=qh8p9yvvfOSXV5zYZ5Q23O=oTo6env0zGtpc1sAYDKOoFQ@mail.gmail.com>

In dpif-netdev.c, line 3264 (master branch), appears this comment (the
routine is fast_path_processing).

/* Key length is needed in all the cases, hash computed on demand. */

I have inspected this code quite a bit, and can't find where the
hashes are calculated. In particular, this appears to cause a memory
leak in associated emc code (flows with an extra reference on them are
not being deleted). This is because the hash is not calculated when
emc_insert is called.

Could someone please point out where the hashes are calculated, or
confirm that there might be an issue here? Or that my understanding is
incorrect and we don't need those hash values?

If there is a fix required, I have a reliable test that shows up this
issue, so will be happy to test it out.

Thanks
Tony

From tony.vanderpeet at gmail.com  Mon Sep 21 22:25:50 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Tue, 22 Sep 2015 17:25:50 +1200
Subject: [ovs-discuss] Where are the hashes calculated please?
In-Reply-To: <CAKL=qh8p9yvvfOSXV5zYZ5Q23O=oTo6env0zGtpc1sAYDKOoFQ@mail.gmail.com>
References: <CAKL=qh8p9yvvfOSXV5zYZ5Q23O=oTo6env0zGtpc1sAYDKOoFQ@mail.gmail.com>
Message-ID: <CAKL=qh9ev2=i983rR2g2DeATYrctMcJbZf1sqxzGhANDFpDfOw@mail.gmail.com>

OK, hold that thought, I think I just worked it out for myself! Looks
like there is a calculation in emc_processing, which implies that the
hashes are already calculated? It's too late at the end of a long day.
Still something not quite right though, so I'll keep looking - any
further advice appreciated.

Tony

On Tue, Sep 22, 2015 at 5:18 PM, Tony van der Peet
<tony.vanderpeet at gmail.com> wrote:
> In dpif-netdev.c, line 3264 (master branch), appears this comment (the
> routine is fast_path_processing).
>
> /* Key length is needed in all the cases, hash computed on demand. */
>
> I have inspected this code quite a bit, and can't find where the
> hashes are calculated. In particular, this appears to cause a memory
> leak in associated emc code (flows with an extra reference on them are
> not being deleted). This is because the hash is not calculated when
> emc_insert is called.
>
> Could someone please point out where the hashes are calculated, or
> confirm that there might be an issue here? Or that my understanding is
> incorrect and we don't need those hash values?
>
> If there is a fix required, I have a reliable test that shows up this
> issue, so will be happy to test it out.
>
> Thanks
> Tony

From kevin.traynor at intel.com  Mon Sep 21 22:27:26 2015
From: kevin.traynor at intel.com (Traynor, Kevin)
Date: Tue, 22 Sep 2015 05:27:26 +0000
Subject: [ovs-discuss] Configure failing in OVS build
In-Reply-To: <1BA01C3192A665469272B2597052DDFF56FC04C5@BGSMSX104.gar.corp.intel.com>
References: <1BA01C3192A665469272B2597052DDFF56FBFD07@BGSMSX104.gar.corp.intel.com>
 <BC0FEEC7D7650749874CEC11314A88F745250462@IRSMSX104.ger.corp.intel.com>
 <1BA01C3192A665469272B2597052DDFF56FC04C5@BGSMSX104.gar.corp.intel.com>
Message-ID: <BC0FEEC7D7650749874CEC11314A88F745250BF3@IRSMSX104.ger.corp.intel.com>


> -----Original Message-----
> From: Radhakrishnan, Sharmila
> Sent: Monday, September 21, 2015 9:49 PM
> To: Traynor, Kevin
> Cc: 'discuss at openvswitch.org'
> Subject: RE: Configure failing in OVS build
> 
> Hi Kevin,
>   https://github.com/openvswitch/ovs/blob/master/INSTALL.DPDK.md Speaks only
> about the DPDK2.1. Where is the information you are mentioning present?

That is the INSTALL.DPDK.md for the current head of master, not OVS 2.4.0.
If you want OVS 2.4.0, download the package or switch to the OVS 2.4 branch
and look at the INSTALL.DPDK.md there.

> 
> Thanks,
> Sharmila
> 
> -----Original Message-----
> From: Traynor, Kevin
> Sent: Tuesday, September 22, 2015 2:30 AM
> To: Radhakrishnan, Sharmila; 'discuss at openvswitch.org'
> Subject: RE: Configure failing in OVS build
> 
> Hi
> 
> > -----Original Message-----
> > From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of
> > Radhakrishnan, Sharmila
> > Sent: Monday, September 21, 2015 8:02 AM
> > To: 'discuss at openvswitch.org'
> > Subject: [ovs-discuss] Configure failing in OVS build
> >
> > Hi All,
> >   Iam trying to install OVS with DPDK . Iam using OVS version 2.4.0
> > and DPDK version 2.1.0.
> 
> OVS 2.4.0 builds with DPDK 2.0, not DPDK 2.1. See INSTALL.DPDK.md for
> matching DPDK version.
> 
> If you did want this combination, then you could backport the patch that adds
> DPDK 2.1 integration.
> 
> >
> > root at pktgen:/usr/src/dpdk# git branch
> > * (detached from v2.1.0)
> >   master
> >
> > root at pktgen:/usr/src/ovs# git branch
> > * (detached from v2.4.0)
> >   master
> >
> > I built the DPDK with
> >  CONFIG_RTE_BUILD_COMBINE_LIBS=y in the config/common_linuapp file.
> >
> > The command used to build DPDK is "make install
> > T=x86_64-ivshmem-linuxapp- gcc". And I confirmed the folder exists in
> > dpdk dir
> >
> > root at pktgen:/usr/src/dpdk# ls
> > app  config  doc  drivers  examples  GNUmakefile  lib  LICENSE.GPL
> > LICENSE.L GPL  MAINTAINERS  Makefile  mk  pkg  scripts  tools
> > x86_64-ivshmem-linuxapp- gcc
> >
> > I tried the configure command from OVS
> >        root at pktgen:/usr/src/ovs# ./configure --with-
> > dpdk=/usr/src/dpdk/x86_64-ivshmem-linuxapp-gcc CFLAGS="-g -O2
> > -Wno-cast- align"
> >
> > Each time it fails with
> > checking whether make has GNU make $(if) extension... yes
> > configure: error: cannot link with dpdk
> >
> > I tried cleaning up the folders and building it multiple times. It
> > fails with the same error.
> >
> > OS Used:
> > root at pktgen:/usr/src/ovs# uname -a
> > Linux pktgen 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24
> > 21:16:20 UTC
> > 2015 x86_64 x86_64 x86_64 GNU/Linux
> > root at pktgen:/usr/src/ovs# lsb_release -a No LSB modules are available.
> > Distributor ID: Ubuntu
> > Description:    Ubuntu 14.04.3 LTS
> > Release:        14.04
> > Codename:       trusty
> >
> > Thanks in Advance for your Help!,
> >
> > Regards,
> > Sharmila


From Star.Chang at advantech.com.tw  Mon Sep 21 22:40:57 2015
From: Star.Chang at advantech.com.tw (Star.Chang)
Date: Tue, 22 Sep 2015 13:40:57 +0800
Subject: [ovs-discuss] vhost-user state in openvswitch
In-Reply-To: <74F120C019F4A64C9B78E802F6AD4CC24CB92F5C@IRSMSX106.ger.corp.intel.com>
References: <81715E7257BD4547BD37DB19AB0A553C01B29FDE@TAIPEI01.ADVANTECH.CORP>
 <74F120C019F4A64C9B78E802F6AD4CC24CB92F5C@IRSMSX106.ger.corp.intel.com>
Message-ID: <81715E7257BD4547BD37DB19AB0A553C01B2AC59@TAIPEI01.ADVANTECH.CORP>

Thanks Ciara for your kindly highlights!

After tailing the logs and basic troubleshooting, we finally can have 2 VMs to ping to each other. One dpdkvhostuser interface is for each VM and we have to new add flows based on dpdkvhostuser ofport numbers. Another issue is that we run pktgen-dpdk 2.9.1 inside of VM but no packets counted from pktgen terminal display. It is so weird that we only see 128 tx packets bursted out and then nothing is continue working. After that, we try to dump-flows via ovs-ofctl utility but it shows "connection refued". I am not sure have any one of you guys ideas here? Thanks!!!           

Bridge "ovsbr0"
        Port "ovsbr0"
            Interface "ovsbr0"
                type: internal
        Port "dpdk1"
            Interface "dpdk1"
                type: dpdk
        Port "dpdk0"
            Interface "dpdk0"
                type: dpdk
        Port "vhost-user1"
            Interface "vhost-user1"
                type: dpdkvhostuser
        Port "vhost-user0"
            Interface "vhost-user0"
                type: dpdkvhostuser

-----Original Message-----
From: Loftus, Ciara [mailto:ciara.loftus at intel.com] 
Sent: Monday, September 21, 2015 5:23 PM
To: Star.Chang
Cc: 'discuss at openvswitch.org'
Subject: RE: [ovs-discuss] vhost-user state in openvswitch

> 
> We bring 2 VMs up with vhost-user type. We can see eth0 interfaces 
> created in 2 VMs with proper mac address we assign. After IP address 
> assignment, 2 VMs could not PING to each other when they are in the 
> same network segment.
> However, we check link up state via ovs-ofctl utility but LINK_DOWN as 
> below.
> Have any one with experiences and give some helps ... Thanks!!!
> $ sudo ./utilities/ovs-ofctl show ovsbr0 OFPT_FEATURES_REPLY 
> (xid=0x2): dpid:00000670da615e4a n_tables:254, n_buffers:256
> capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS 
> ARP_MATCH_IP
> actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan 
> mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src 
> mod_tp_dst
> 1(vhost-user1): addr:00:00:00:00:00:00
> config: PORT_DOWN
> state: LINK_DOWN
> speed: 0 Mbps now, 0 Mbps max
> 2(vhost-user2): addr:00:00:00:00:00:00
> config: PORT_DOWN
> state: LINK_DOWN
> speed: 0 Mbps now, 0 Mbps max
> LOCAL(ovsbr0): addr:06:70:da:61:5e:4a
> config: PORT_DOWN
> state: LINK_DOWN
> current: 10MB-FD COPPER
> speed: 10 Mbps now, 0 Mbps max
> OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0

Hi,

You can ignore the LINK_DOWN state - it does not give the correct state of the port at the moment.

Can you make sure the default (NORMAL) flow is installed in the switch which should allow these pings to be sent/received? eg:
ovs-ofctl dump-flows br0
NXST_FLOW reply (xid=0x4):
 cookie=0x0, duration=136.745s, table=0, n_packets=121, n_bytes=22148, idle_age=15, priority=0 actions=NORMAL

Also some quick things to check:
- Make sure you are using a separate vhost-user port per VM ie. not using the same socket device on 2 VMs.
- You are using QEMU v2.2.0 or later

Thanks,
Ciara

From tony.vanderpeet at gmail.com  Mon Sep 21 23:38:56 2015
From: tony.vanderpeet at gmail.com (Tony van der Peet)
Date: Tue, 22 Sep 2015 18:38:56 +1200
Subject: [ovs-discuss] Where are the hashes calculated please?
In-Reply-To: <CAKL=qh9ev2=i983rR2g2DeATYrctMcJbZf1sqxzGhANDFpDfOw@mail.gmail.com>
References: <CAKL=qh8p9yvvfOSXV5zYZ5Q23O=oTo6env0zGtpc1sAYDKOoFQ@mail.gmail.com>
 <CAKL=qh9ev2=i983rR2g2DeATYrctMcJbZf1sqxzGhANDFpDfOw@mail.gmail.com>
Message-ID: <CAKL=qh9tb8A5bF6640i2TjbVA8iL9KZ0A38J7rgTCog7yipPyw@mail.gmail.com>

OK, problem solved. Should have known it would be my code. The netdev
is our own and on a previous update from upstream I missed the fact
that the packet hash has to be initialised in the rxq_recv routine.
All good now.

Tony

On Tue, Sep 22, 2015 at 5:25 PM, Tony van der Peet
<tony.vanderpeet at gmail.com> wrote:
> OK, hold that thought, I think I just worked it out for myself! Looks
> like there is a calculation in emc_processing, which implies that the
> hashes are already calculated? It's too late at the end of a long day.
> Still something not quite right though, so I'll keep looking - any
> further advice appreciated.
>
> Tony
>
> On Tue, Sep 22, 2015 at 5:18 PM, Tony van der Peet
> <tony.vanderpeet at gmail.com> wrote:
>> In dpif-netdev.c, line 3264 (master branch), appears this comment (the
>> routine is fast_path_processing).
>>
>> /* Key length is needed in all the cases, hash computed on demand. */
>>
>> I have inspected this code quite a bit, and can't find where the
>> hashes are calculated. In particular, this appears to cause a memory
>> leak in associated emc code (flows with an extra reference on them are
>> not being deleted). This is because the hash is not calculated when
>> emc_insert is called.
>>
>> Could someone please point out where the hashes are calculated, or
>> confirm that there might be an issue here? Or that my understanding is
>> incorrect and we don't need those hash values?
>>
>> If there is a fix required, I have a reliable test that shows up this
>> issue, so will be happy to test it out.
>>
>> Thanks
>> Tony

From ciara.loftus at intel.com  Tue Sep 22 04:22:23 2015
From: ciara.loftus at intel.com (Loftus, Ciara)
Date: Tue, 22 Sep 2015 11:22:23 +0000
Subject: [ovs-discuss] vhost-user state in openvswitch
In-Reply-To: <81715E7257BD4547BD37DB19AB0A553C01B2AC59@TAIPEI01.ADVANTECH.CORP>
References: <81715E7257BD4547BD37DB19AB0A553C01B29FDE@TAIPEI01.ADVANTECH.CORP>
 <74F120C019F4A64C9B78E802F6AD4CC24CB92F5C@IRSMSX106.ger.corp.intel.com>
 <81715E7257BD4547BD37DB19AB0A553C01B2AC59@TAIPEI01.ADVANTECH.CORP>
Message-ID: <74F120C019F4A64C9B78E802F6AD4CC24CB976EB@IRSMSX106.ger.corp.intel.com>

> 
> Thanks Ciara for your kindly highlights!
> 
> After tailing the logs and basic troubleshooting, we finally can have 2 VMs to
> ping to each other. One dpdkvhostuser interface is for each VM and we have
> to new add flows based on dpdkvhostuser ofport numbers. Another issue is
> that we run pktgen-dpdk 2.9.1 inside of VM but no packets counted from
> pktgen terminal display. It is so weird that we only see 128 tx packets bursted
> out and then nothing is continue working. After that, we try to dump-flows
> via ovs-ofctl utility but it shows "connection refued". I am not sure have any
> one of you guys ideas here? Thanks!!!

I'm inexperienced with pktgen so I haven't seen this problem before myself.
When you receive the "connection refused" error from OVS are both the ovsdb-server and ovs-vswitchd processes still running or has anything crashed at this point? If there has been a crash can you please post the gdb trace of the ovs-vswitchd process. Thanks.

Ciara

> 
> Bridge "ovsbr0"
>         Port "ovsbr0"
>             Interface "ovsbr0"
>                 type: internal
>         Port "dpdk1"
>             Interface "dpdk1"
>                 type: dpdk
>         Port "dpdk0"
>             Interface "dpdk0"
>                 type: dpdk
>         Port "vhost-user1"
>             Interface "vhost-user1"
>                 type: dpdkvhostuser
>         Port "vhost-user0"
>             Interface "vhost-user0"
>                 type: dpdkvhostuser
> 
> -----Original Message-----
> From: Loftus, Ciara [mailto:ciara.loftus at intel.com]
> Sent: Monday, September 21, 2015 5:23 PM
> To: Star.Chang
> Cc: 'discuss at openvswitch.org'
> Subject: RE: [ovs-discuss] vhost-user state in openvswitch
> 
> >
> > We bring 2 VMs up with vhost-user type. We can see eth0 interfaces
> > created in 2 VMs with proper mac address we assign. After IP address
> > assignment, 2 VMs could not PING to each other when they are in the
> > same network segment.
> > However, we check link up state via ovs-ofctl utility but LINK_DOWN as
> > below.
> > Have any one with experiences and give some helps ... Thanks!!!
> > $ sudo ./utilities/ovs-ofctl show ovsbr0 OFPT_FEATURES_REPLY
> > (xid=0x2): dpid:00000670da615e4a n_tables:254, n_buffers:256
> > capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS
> > ARP_MATCH_IP
> > actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan
> > mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos
> mod_tp_src
> > mod_tp_dst
> > 1(vhost-user1): addr:00:00:00:00:00:00
> > config: PORT_DOWN
> > state: LINK_DOWN
> > speed: 0 Mbps now, 0 Mbps max
> > 2(vhost-user2): addr:00:00:00:00:00:00
> > config: PORT_DOWN
> > state: LINK_DOWN
> > speed: 0 Mbps now, 0 Mbps max
> > LOCAL(ovsbr0): addr:06:70:da:61:5e:4a
> > config: PORT_DOWN
> > state: LINK_DOWN
> > current: 10MB-FD COPPER
> > speed: 10 Mbps now, 0 Mbps max
> > OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
> 
> Hi,
> 
> You can ignore the LINK_DOWN state - it does not give the correct state of
> the port at the moment.
> 
> Can you make sure the default (NORMAL) flow is installed in the switch
> which should allow these pings to be sent/received? eg:
> ovs-ofctl dump-flows br0
> NXST_FLOW reply (xid=0x4):
>  cookie=0x0, duration=136.745s, table=0, n_packets=121, n_bytes=22148,
> idle_age=15, priority=0 actions=NORMAL
> 
> Also some quick things to check:
> - Make sure you are using a separate vhost-user port per VM ie. not using
> the same socket device on 2 VMs.
> - You are using QEMU v2.2.0 or later
> 
> Thanks,
> Ciara

From zhunatuzi at gmail.com  Mon Sep 21 22:36:08 2015
From: zhunatuzi at gmail.com (Na Zhu)
Date: Tue, 22 Sep 2015 13:36:08 +0800
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
Message-ID: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>

Hi,

I am trying to use ovs dpdk, i follow the README-native-tunneling.md, it
does not work.
my setup is:
[image: 内嵌图片 1]
The prefix length of br-vxlan is not 24, is 25, after i create br-vxlan,
there is no route in ovs, so i add it by command ovs-appctl.
[root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
Route Table:
Cached: 10.53.87.242/32 dev br-vxlan
Cached: 127.0.0.1/32 dev lo
Cached: 158.85.164.66/32 dev bond1
Cached: 192.168.1.1/32 dev br0
Cached: 158.85.164.64/27 dev bond1
Cached: 192.168.1.0/24 dev br0
Cached: 169.254.0.0/16 dev bond1
Cached: 127.0.0.0/8 dev lo
Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
[root at juno ovs-build]#
[root at juno ovs-build]# ./bin/ovs-appctl ovs/route/add 10.53.87.242/25
br-vxlan
OK
[root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
Route Table:
User: 10.53.87.128/25 dev br-vxlan
Cached: 10.53.87.242/32 dev br-vxlan
Cached: 127.0.0.1/32 dev lo
Cached: 158.85.164.66/32 dev bond1
Cached: 192.168.1.1/32 dev br0
Cached: 158.85.164.64/27 dev bond1
Cached: 192.168.1.0/24 dev br0
Cached: 169.254.0.0/16 dev bond1
Cached: 127.0.0.0/8 dev lo
Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
[root at juno ovs-build]#
Then i ping 192.168.1.2, and i capture vxlan packet on eth0 by tcpdump,
there is no vxlan packet, do anyone know why?


BR
Juno
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150922/b0d845e4/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 10395 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150922/b0d845e4/attachment-0001.png>

From zhunatuzi at gmail.com  Tue Sep 22 01:19:32 2015
From: zhunatuzi at gmail.com (Na Zhu)
Date: Tue, 22 Sep 2015 16:19:32 +0800
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
Message-ID: <CABDe9Tw8URsUpFinKqAEah6x_hj5v4vVOf5O5brq+abevi2_Nw@mail.gmail.com>

Attach more logs.

[root at juno ovs-build]#
[root at juno ovs-build]# ./bin/ovs-vsctl show
84a54e08-c37d-459d-90e5-6c664095eddb
    Bridge "br0"
        Port "vxlan0"
            Interface "vxlan0"
                type: vxlan
                options: {remote_ip="10.53.87.254"}
        Port "br0"
            Interface "br0"
                type: internal
    Bridge br-vxlan
        Port br-vxlan
            Interface br-vxlan
                type: internal
        Port "eth0"
            Interface "eth0"
[root at juno ovs-build]# ./bin/ovs-appctl tnl/ports/show
Listening ports:
vxlan_sys_4789 (4)
[root at juno ovs-build]#
[root at juno ovs-build]# ifconfig br-vxlan
br-vxlan: flags=323<UP,BROADCAST,RUNNING,PROMISC>  mtu 1500
        inet 10.53.87.242  netmask 255.255.255.128  broadcast 0.0.0.0
        inet6 fe80::225:90ff:fe2e:ea4  prefixlen 64  scopeid 0x20<link>
        ether 00:25:90:2e:0e:a4  txqueuelen 500  (Ethernet)
        RX packets 9808  bytes 859468 (839.3 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 3564  bytes 654410 (639.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root at juno ovs-build]# ifconfig br0
br0: flags=323<UP,BROADCAST,RUNNING,PROMISC>  mtu 1500
        inet 192.1.1.1  netmask 255.255.255.0  broadcast 192.1.1.255
        inet6 fe80::4489:c3ff:fe73:c74f  prefixlen 64  scopeid 0x20<link>
        ether 46:89:c3:73:c7:4f  txqueuelen 500  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 22  bytes 1236 (1.2 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

[root at juno ovs-build]#

2015-09-22 13:36 GMT+08:00 Na Zhu <zhunatuzi at gmail.com>:

> Hi,
>
> I am trying to use ovs dpdk, i follow the README-native-tunneling.md, it
> does not work.
> my setup is:
> [image: 内嵌图片 1]
> The prefix length of br-vxlan is not 24, is 25, after i create br-vxlan,
> there is no route in ovs, so i add it by command ovs-appctl.
> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
> Route Table:
> Cached: 10.53.87.242/32 dev br-vxlan
> Cached: 127.0.0.1/32 dev lo
> Cached: 158.85.164.66/32 dev bond1
> Cached: 192.168.1.1/32 dev br0
> Cached: 158.85.164.64/27 dev bond1
> Cached: 192.168.1.0/24 dev br0
> Cached: 169.254.0.0/16 dev bond1
> Cached: 127.0.0.0/8 dev lo
> Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
> [root at juno ovs-build]#
> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/add 10.53.87.242/25
> br-vxlan
> OK
> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
> Route Table:
> User: 10.53.87.128/25 dev br-vxlan
> Cached: 10.53.87.242/32 dev br-vxlan
> Cached: 127.0.0.1/32 dev lo
> Cached: 158.85.164.66/32 dev bond1
> Cached: 192.168.1.1/32 dev br0
> Cached: 158.85.164.64/27 dev bond1
> Cached: 192.168.1.0/24 dev br0
> Cached: 169.254.0.0/16 dev bond1
> Cached: 127.0.0.0/8 dev lo
> Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
> [root at juno ovs-build]#
> Then i ping 192.168.1.2, and i capture vxlan packet on eth0 by tcpdump,
> there is no vxlan packet, do anyone know why?
>
>
> BR
> Juno
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150922/564abf4a/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 10395 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150922/564abf4a/attachment-0001.png>

From balazs.nemeth at ericsson.com  Tue Sep 22 02:39:13 2015
From: balazs.nemeth at ericsson.com (Balazs Nemeth)
Date: Tue, 22 Sep 2015 09:39:13 +0000
Subject: [ovs-discuss] OVS does not start without openvswitch log directory
Message-ID: <3BFF958DA8403D4599365B997AA23AB00114C93E@ESESSMB305.ericsson.se>

Dear All,

I'm using OVS version 2.3.0. I wanted to delete ovs log files and accidentally I deleted the whole folder /var/log/openvswitch/. I noticed that openvswitch-switch service was unable to start because of this. The error message was (I did not delete /var/run/openvswitch/):
start: Job failed to start
2015-09-22T09:27:41Z|00001|daemon_unix|WARN|/var/run/openvswitch/ovs-vswitchd.pid: open: No such file or directory
ovs-appctl: cannot read pidfile "/var/run/openvswitch/ovs-vswitchd.pid" (No such file or directory)

If the log directory exists but empty, the openvswitch-switch service will start. The problem comes up when the directory doesn't exist. Please investigate this bug.

Best regards,
Balazs Nemeth
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150922/38a04c3b/attachment-0001.html>

From azhou at nicira.com  Tue Sep 22 13:47:18 2015
From: azhou at nicira.com (Andy Zhou)
Date: Tue, 22 Sep 2015 13:47:18 -0700
Subject: [ovs-discuss] OVS does not start without openvswitch log
	directory
In-Reply-To: <3BFF958DA8403D4599365B997AA23AB00114C93E@ESESSMB305.ericsson.se>
References: <3BFF958DA8403D4599365B997AA23AB00114C93E@ESESSMB305.ericsson.se>
Message-ID: <CACzMAJ+jSbDJC5SJQEfTxorMhz+reVgWSucgizft92VauELT_w@mail.gmail.com>

What solutions do you have in mind?

In this case, it seems there is a script involved in starting ovs.  If
true, I wonder if it possible to create
the directory if necessary at the beginning of the script?

On Tue, Sep 22, 2015 at 2:39 AM, Balazs Nemeth
<balazs.nemeth at ericsson.com> wrote:
> Dear All,
>
>
>
> I’m using OVS version 2.3.0. I wanted to delete ovs log files and
> accidentally I deleted the whole folder /var/log/openvswitch/. I noticed
> that openvswitch-switch service was unable to start because of this. The
> error message was (I did not delete /var/run/openvswitch/):
>
> start: Job failed to start
>
> 2015-09-22T09:27:41Z|00001|daemon_unix|WARN|/var/run/openvswitch/ovs-vswitchd.pid:
> open: No such file or directory
>
> ovs-appctl: cannot read pidfile "/var/run/openvswitch/ovs-vswitchd.pid" (No
> such file or directory)
>
>
>
> If the log directory exists but empty, the openvswitch-switch service will
> start. The problem comes up when the directory doesn’t exist. Please
> investigate this bug.
>
> Best regards,
>
> Balazs Nemeth
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From pshelar at nicira.com  Tue Sep 22 14:52:12 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Tue, 22 Sep 2015 14:52:12 -0700
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
Message-ID: <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>

On Mon, Sep 21, 2015 at 10:36 PM, Na Zhu <zhunatuzi at gmail.com> wrote:

> Hi,
>
> I am trying to use ovs dpdk, i follow the README-native-tunneling.md, it
> does not work.
> my setup is:
> [image: 内嵌图片 1]
> The prefix length of br-vxlan is not 24, is 25, after i create br-vxlan,
> there is no route in ovs, so i add it by command ovs-appctl.
>

Which OVS version are you using?


> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
> Route Table:
> Cached: 10.53.87.242/32 dev br-vxlan
> Cached: 127.0.0.1/32 dev lo
> Cached: 158.85.164.66/32 dev bond1
> Cached: 192.168.1.1/32 dev br0
> Cached: 158.85.164.64/27 dev bond1
> Cached: 192.168.1.0/24 dev br0
> Cached: 169.254.0.0/16 dev bond1
> Cached: 127.0.0.0/8 dev lo
> Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
> [root at juno ovs-build]#
> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/add 10.53.87.242/25
> br-vxlan
> OK
> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
> Route Table:
> User: 10.53.87.128/25 dev br-vxlan
> Cached: 10.53.87.242/32 dev br-vxlan
> Cached: 127.0.0.1/32 dev lo
> Cached: 158.85.164.66/32 dev bond1
> Cached: 192.168.1.1/32 dev br0
> Cached: 158.85.164.64/27 dev bond1
> Cached: 192.168.1.0/24 dev br0
> Cached: 169.254.0.0/16 dev bond1
> Cached: 127.0.0.0/8 dev lo
> Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
> [root at juno ovs-build]#
> Then i ping 192.168.1.2, and i capture vxlan packet on eth0 by tcpdump,
> there is no vxlan packet, do anyone know why?
>
>
> You can dump-flows from datapath and check what is happening to the
packets.
ovs-appctl dpctl/dump-flows
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150922/b480701a/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 10395 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150922/b480701a/attachment.png>

From shettyg at nicira.com  Tue Sep 22 15:42:01 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Tue, 22 Sep 2015 15:42:01 -0700
Subject: [ovs-discuss] Ubuntu systemd scripts for openvswitch
Message-ID: <CAHbON5o8pDsOFVUS1FaBbHn1b6qTfe4xt5_eetk=Dbad+MQLxg@mail.gmail.com>

On Ubuntu 15.04, there are systemd scripts added for
openvswitch-switch package. (/etc/init/openvswitch-switch.conf). At
first glance (and based on a user bug report), it does not work with
OVS integration with 'interfaces' file (as described in the section
"Debian network scripts integration" at
https://github.com/openvswitch/ovs/blob/master/debian/openvswitch-switch.README.Debian).

The way 'interfaces' integration currently works is that, in
/etc/init.d/openvswitch-switch, we call "network_interfaces ifup"
function when "start" is called. Since
/etc/init/openvswitch-switch.conf does not have this integration,
things configured in /etc/network/interfaces for OVS no longer works.

Would adding the following line in /etc/init.d/openvswitch-switch a
viable solution for those that want the 'interfaces' integration to
continue to work?
_SYSTEMCTL_SKIP_REDIRECT=yes

From fred at mautadine.com  Tue Sep 22 21:36:39 2015
From: fred at mautadine.com (=?UTF-8?Q?Fr=C3=A9d=C3=A9ric_Marchand?=)
Date: Wed, 23 Sep 2015 06:36:39 +0200
Subject: [ovs-discuss] first ping lost
In-Reply-To: <CAGHyHJ33UJiH2Vw_VKok6uVEJLbmyqWqbD_=ShHwEy45E-Kf8Q@mail.gmail.com>
References: <CAGHyHJ0wq87sMGt4VstFzmfv4gOShpLi0Aopdg86ZwcdmSfdCA@mail.gmail.com>
 <55F6A9FE.9060308@in.tum.de>
 <CAGHyHJ33UJiH2Vw_VKok6uVEJLbmyqWqbD_=ShHwEy45E-Kf8Q@mail.gmail.com>
Message-ID: <CAGHyHJ0A_owPeeCqkRXoT+H2w1GYRKBVYW5_1m3XsP0FEd-B_Q@mail.gmail.com>

Just for the follow up,

Changing the bond-mode from balance-tcp to active-backup fix my
problem.. But it's not the solution. I doubt it's a switch problem
since with linux bonding, it's working fine with the hash policy
layer3+4.

My LACP seems to be correctly negociated with the switch:
---- bond0 ----
        status: active negotiated
        sys_id: d0:bf:9c:46:56:94
        sys_priority: 65534
        aggregation key: 1
        lacp_time: fast

slave: em1: current attached
        port_id: 1
        port_priority: 65535
        may_enable: true

        actor sys_id: d0:bf:9c:46:56:94
        actor sys_priority: 65534
        actor port_id: 1
        actor port_priority: 65535
        actor key: 1
        actor state: activity timeout aggregation synchronized
collecting distributing

        partner sys_id: 34:6f:90:30:14:ab
        partner sys_priority: 1
        partner port_id: 60
        partner port_priority: 1
        partner key: 1000
        partner state: activity aggregation synchronized collecting distributing

slave: em2: current attached
        port_id: 2
        port_priority: 65535
        may_enable: true

        actor sys_id: d0:bf:9c:46:56:94
        actor sys_priority: 65534
        actor port_id: 2
        actor port_priority: 65535
        actor key: 1
        actor state: activity timeout aggregation synchronized
collecting distributing

        partner sys_id: 34:6f:90:30:14:ab
        partner sys_priority: 1
        partner port_id: 52
        partner port_priority: 1
        partner key: 1000
        partner state: activity aggregation synchronized collecting distributing


If anyone have an idea what's going on!

Thanks,

Fred

On Mon, Sep 14, 2015 at 8:14 PM, Frédéric Marchand <fred at mautadine.com> wrote:
> Hello,
>
> Thanks for the reply but I don't think it's arp. The arp table have
> the correct information and also, i tried with static entries on both
> side.
>
> Maybe I should have mentioned that earlier: when i'm connected to ssh
> through one of those fake bridges, the login takes a while (3-4
> seconds, dns timeouts) then it's ok. And if i don't make any input for
> more than 5 seconds, the next input lag a few hundred milliseconds
> (kernel flows TTL?)
>
> By the way, I don't experience those issues using linux bonding and vlan.
>
> Regards,
>
> Fred
>
>
>
>
> On Mon, Sep 14, 2015 at 1:05 PM, Lukas Erlacher <erlacher at in.tum.de> wrote:
>> Hi,
>> On 09/14/2015 05:27 AM, Frédéric Marchand wrote:
>>>
>>> Hello all,
>>>
>>> I've installed and configured openvswitch 2.3.1 on 3 machines (ubuntu
>>> 15.04). I've created a bridge with two interfaces in LACP balance-tcp.
>>> I also added some fake bridges with vlan tags.
>>>
>>> The problem i have is when I ping one of the fake bridge, the first
>>> ping is lost (unless there is a tcp connection already up!):
>>>
>>> PING 10.10.22.11 (10.10.22.11) 56(84) bytes of data.
>>> 64 bytes from 10.10.22.11: icmp_seq=2 ttl=64 time=0.419 ms
>>> 64 bytes from 10.10.22.11: icmp_seq=3 ttl=64 time=0.361 ms
>>
>> Are you sure that's not just an empty arp cache?
>>>
>>>
>>> Here is the configuration:
>>>
>>> ovs-vsctl add-br br-main
>>> ovs-vsctl ovs-vsctl add-bond br-main bond0 em1 em2
>>> ovs-vsctl set port bond0 bond_mode=balance-tcp
>>> ovs-vsctl set port bond0 lacp=active
>>> ovs-vsctl add-br br-data br-main 22
>>> ip addr add 10.10.22.11/24 dev br-data
>>>
>>> LACP seems fine:
>>> ---- bond0 ----
>>> status: active negotiated
>>> sys_id: 34:64:a9:9a:5f:00
>>> sys_priority: 65534
>>> aggregation key: 1
>>> lacp_time: slow
>>>
>>> The machines have broadcom BCM5720 interfaces using tg3 drivers.
>>>
>>> Also, i guess it's linked, DNS queries coming out this interface
>>> timeout most of the time. But if i ping the DNS server while doing an
>>> nslookup, it works fine.
>>>
>>> Anyone knows what is the problem?
>>
>> Could still be an arp problem. Run "arp" before and after trying to send
>> those requests. If it's an arp problem, it should always be the first packet
>> that gets lost and all subsequent packets/requests should be fine.
>>
>> Best,
>> Luke
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss

From sugesh.chandran at intel.com  Wed Sep 23 03:02:39 2015
From: sugesh.chandran at intel.com (Chandran, Sugesh)
Date: Wed, 23 Sep 2015 10:02:39 +0000
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
 <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>
Message-ID: <2EF2F5C0CC56984AA024D0B180335FCB13CB44A6@IRSMSX102.ger.corp.intel.com>



Regards
_Sugesh

From: discuss [mailto:discuss-bounces at openvswitch.org] On Behalf Of Pravin Shelar
Sent: Tuesday, September 22, 2015 10:52 PM
To: Na Zhu
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] ovs dpdk vxlan does NOT work



On Mon, Sep 21, 2015 at 10:36 PM, Na Zhu <zhunatuzi at gmail.com<mailto:zhunatuzi at gmail.com>> wrote:
Hi,

I am trying to use ovs dpdk, i follow the README-native-tunneling.md, it does not work.
my setup is:
[内嵌图片 1]
The prefix length of br-vxlan is not 24, is 25, after i create br-vxlan, there is no route in ovs, so i add it by command ovs-appctl.

Which OVS version are you using?

[root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
Route Table:
Cached: 10.53.87.242/32<http://10.53.87.242/32> dev br-vxlan
Cached: 127.0.0.1/32<http://127.0.0.1/32> dev lo
Cached: 158.85.164.66/32<http://158.85.164.66/32> dev bond1
Cached: 192.168.1.1/32<http://192.168.1.1/32> dev br0
Cached: 158.85.164.64/27<http://158.85.164.64/27> dev bond1
Cached: 192.168.1.0/24<http://192.168.1.0/24> dev br0
Cached: 169.254.0.0/16<http://169.254.0.0/16> dev bond1
Cached: 127.0.0.0/8<http://127.0.0.0/8> dev lo
Cached: 0.0.0.0/0<http://0.0.0.0/0> dev bond1 GW 158.85.164.65
[root at juno ovs-build]#
[root at juno ovs-build]# ./bin/ovs-appctl ovs/route/add 10.53.87.242/25<http://10.53.87.242/25> br-vxlan
OK
[root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
Route Table:
User: 10.53.87.128/25<http://10.53.87.128/25> dev br-vxlan
Cached: 10.53.87.242/32<http://10.53.87.242/32> dev br-vxlan
Cached: 127.0.0.1/32<http://127.0.0.1/32> dev lo
Cached: 158.85.164.66/32<http://158.85.164.66/32> dev bond1
Cached: 192.168.1.1/32<http://192.168.1.1/32> dev br0
Cached: 158.85.164.64/27<http://158.85.164.64/27> dev bond1
Cached: 192.168.1.0/24<http://192.168.1.0/24> dev br0
Cached: 169.254.0.0/16<http://169.254.0.0/16> dev bond1
Cached: 127.0.0.0/8<http://127.0.0.0/8> dev lo
Cached: 0.0.0.0/0<http://0.0.0.0/0> dev bond1 GW 158.85.164.65
[root at juno ovs-build]#
Then i ping 192.168.1.2, and i capture vxlan packet on eth0 by tcpdump, there is no vxlan packet, do anyone know why?


You can dump-flows from datapath and check what is happening to the packets.
ovs-appctl dpctl/dump-flows

>>>>[Sugesh] My 2 cents
I assume eth0 is DPDK port, in that case you cannot tcpdump on those ports.
Can you please verify the arp entries configured on the OVS ??

ovs-appctl tnl/arp/show

br0 must have the arp entry for “10.53.87.242”
br-vxlan must have the arp entry for “10.53.87.254”

If they are missing you can set them using

ovs-appctl tnl/arp/set br0  10.53.87.242 <MAC address of br-vxlan>
ovs-appctl tnl/arp/set br-vxlan  10.53.87.254 <MAC address of remote end>




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/a89e20b4/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 10395 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/a89e20b4/attachment-0001.png>

From mehtaneeraj07 at gmail.com  Wed Sep 23 05:55:03 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Wed, 23 Sep 2015 18:25:03 +0530
Subject: [ovs-discuss] Help needed to understand code snippet
Message-ID: <CAHN905K2ryD4Q538tHxihV+o9PcuA1XtKOGGdcy5Ou_fVuCg6Q@mail.gmail.com>

Hello Team,

Can you help me in understanding below snippet.

I was looking at the code in bond.c:bond_compose_learning_packet( ). In
this, function choose_output_slave ( ) can return NULL. And returned
pointer is used as  "*port_aux = slave->aux".
How will it work?
====================================================
static struct bond_slave *
choose_output_slave(const struct bond *bond, const struct flow *flow,
                    struct flow_wildcards *wc, uint16_t vlan)
{
    struct bond_entry *e;
    int balance;

    balance = bond->balance;
    if (bond->lacp_status == LACP_CONFIGURED) {
        /* LACP has been configured on this bond but negotiations were
         * unsuccussful. If lacp_fallback_ab is enabled use active-
         * backup mode else drop all traffic. */
        if (!bond->lacp_fallback_ab) {
            return NULL;
        }

.....
===================================================

===================================================
slave = choose_output_slave(bond, &flow, NULL, vlan);

    packet = ofpbuf_new(0);
    compose_rarp(packet, eth_src);
    if (vlan) {
        eth_push_vlan(packet, htons(ETH_TYPE_VLAN), htons(vlan));
    }

    *port_aux = slave->aux;
    ovs_rwlock_unlock(&rwlock);
    }
======================================================

Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/8ccceb6a/attachment.html>

From phoracek at redhat.com  Wed Sep 23 08:44:29 2015
From: phoracek at redhat.com (Petr Horacek)
Date: Wed, 23 Sep 2015 17:44:29 +0200
Subject: [ovs-discuss] multicast_snooping and multicast_router
Message-ID: <CAGkpguXzbpes86u4PHsvxtLbTcR1VK-rM07BbquwfDU73SuYfQ@mail.gmail.com>

Hello,

I have a question: In native Linux bridging we have options
multicast_snooping
and multicast_router [1]. The first one has an alternative in OVS called
mcast_snooping_enable. Is there an alternative for multicast_router as well?

Best regards,
Petr

[1] http://www.linuxfoundation.org/collaborate/workgroups/networking/bridge
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/912df553/attachment.html>

From zhunatuzi at gmail.com  Tue Sep 22 17:49:43 2015
From: zhunatuzi at gmail.com (Na Zhu)
Date: Wed, 23 Sep 2015 08:49:43 +0800
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
 <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>
Message-ID: <CABDe9TwB276S-XbfC_C4uGeK2DkohVH7U8rEOWTO3gjG+mF07Q@mail.gmail.com>

Hi,

My version is 2.4.90, i download from ovs github and build it myself.

[root at juno bin]# ./ovs-vsctl --version
ovs-vsctl (Open vSwitch) 2.4.90
Compiled Sep 19 2015 08:46:02
DB Schema 7.12.1

[root at juno bin]# ./ovs-appctl dpif/show
netdev at ovs-netdev: hit:246440 missed:9259
        br-vxlan:
                bond0 1/2: (system)
                br-vxlan 65534/1: (tap)
        br0:
                br0 65534/3: (tap)
                vxlan0 1/4: (vxlan: remote_ip=10.53.87.254)
[root at juno bin]# ./ovs-appctl dpif/dump-flows br0
[root at juno bin]#

[root at juno bin]# ./ovs-appctl dpif/dump-flows br-vxlan
recirc_id(0),in_port(2),eth(src=00:25:90:2e:11:0c,dst=00:25:90:2e:0e:a4),eth_type(0x0800),ipv4(dst=10.53.87.242,proto=6/0x1,frag=no),
packets:1216, bytes:152197, used:0.143s, flags:SFP., actions:1
recirc_id(0),in_port(2),eth(src=52:54:00:09:28:0d,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.106,tip=10.52.36.102,op=1/0xff,sha=52:54:00:09:28:0d),
packets:132, bytes:7920, used:0.618s, actions:1
recirc_id(0),in_port(2),eth(src=00:50:56:89:4b:74,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.233,tip=10.53.34.234,op=1/0xff,sha=00:50:56:89:4b:74),
packets:85, bytes:5100, used:0.826s, actions:1
recirc_id(0),in_port(2),eth(src=00:0c:29:e5:88:e4,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
packets:139, bytes:8340, used:0.616s, actions:1
recirc_id(0),in_port(2),eth(src=00:08:e3:ff:fd:90,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.55.60.1,tip=10.55.60.4,op=1/0xff,sha=00:08:e3:ff:fd:90),
packets:6, bytes:360, used:4.789s, actions:1
recirc_id(0),in_port(2),eth(src=00:50:56:bc:29:13,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
packets:30, bytes:1800, used:0.704s, actions:1
recirc_id(0),in_port(2),eth(src=00:0c:29:10:67:d2,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
packets:139, bytes:8340, used:0.648s, actions:1
recirc_id(0),in_port(2),eth(src=00:50:56:bc:52:5e,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.54.159.98,tip=10.54.159.100,op=1/0xff,sha=00:50:56:bc:52:5e),
packets:77, bytes:4620, used:0.265s, actions:1
recirc_id(0),in_port(2),eth(src=52:54:00:23:82:5d,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.107,tip=10.52.36.102,op=1/0xff,sha=52:54:00:23:82:5d),
packets:95, bytes:5700, used:2.460s, actions:1
recirc_id(0),in_port(2),eth(src=00:0c:29:51:d5:16,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
packets:140, bytes:8400, used:0.328s, actions:1
recirc_id(0),in_port(2),eth(src=00:50:56:89:1f:74,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.235,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:1f:74),
packets:99, bytes:5940, used:0.553s, actions:1
recirc_id(0),in_port(2),eth(src=52:54:00:b6:0c:50,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.105,tip=10.52.36.102,op=1/0xff,sha=52:54:00:b6:0c:50),
packets:129, bytes:7740, used:4.243s, actions:1
recirc_id(0),in_port(2),eth(src=00:50:56:89:09:6b,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.235,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:09:6b),
packets:99, bytes:5940, used:0.554s, actions:1
recirc_id(0),in_port(2),eth(src=52:54:00:4f:dd:cf,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.109,tip=10.52.36.102,op=1/0xff,sha=52:54:00:4f:dd:cf),
packets:99, bytes:5940, used:0.805s, actions:1
recirc_id(0),in_port(2),eth(src=50:57:a8:85:cb:04,dst=50:57:a8:85:cb:04),eth_type(0x9000),
packets:0, bytes:0, used:never, actions:drop
recirc_id(0),in_port(2),eth(src=00:50:56:89:07:77,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.235,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:07:77),
packets:99, bytes:5940, used:0.554s, actions:1
recirc_id(0),in_port(2),eth(src=00:0c:29:1c:ea:54,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0800),ipv4(frag=no),
packets:4, bytes:1368, used:5.620s, actions:1
recirc_id(0),in_port(2),eth(src=00:50:56:89:4b:74,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.233,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:4b:74),
packets:121, bytes:7260, used:0.466s, actions:1
recirc_id(0),in_port(2),eth(src=00:50:56:60:7c:bc,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.55.147.137,tip=10.55.147.135,op=1/0xff,sha=00:50:56:60:7c:bc),
packets:0, bytes:0, used:never, actions:1
recirc_id(0),in_port(2),eth(src=00:25:90:35:d8:84,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.98,tip=10.52.36.102,op=1/0xff,sha=00:25:90:35:d8:84),
packets:64, bytes:3840, used:3.690s, actions:1
[root at juno bin]#

There are many flows about other packet in the link, no flows about my arp
packet (sip=192.168.1.1, dip=192.168.1.2)

Do you know why? Hope you can help me to fix it, thanks.

BR
Juno




2015-09-23 5:52 GMT+08:00 Pravin Shelar <pshelar at nicira.com>:

>
>
> On Mon, Sep 21, 2015 at 10:36 PM, Na Zhu <zhunatuzi at gmail.com> wrote:
>
>> Hi,
>>
>> I am trying to use ovs dpdk, i follow the README-native-tunneling.md, it
>> does not work.
>> my setup is:
>> [image: 内嵌图片 1]
>> The prefix length of br-vxlan is not 24, is 25, after i create br-vxlan,
>> there is no route in ovs, so i add it by command ovs-appctl.
>>
>
> Which OVS version are you using?
>
>
>> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
>> Route Table:
>> Cached: 10.53.87.242/32 dev br-vxlan
>> Cached: 127.0.0.1/32 dev lo
>> Cached: 158.85.164.66/32 dev bond1
>> Cached: 192.168.1.1/32 dev br0
>> Cached: 158.85.164.64/27 dev bond1
>> Cached: 192.168.1.0/24 dev br0
>> Cached: 169.254.0.0/16 dev bond1
>> Cached: 127.0.0.0/8 dev lo
>> Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
>> [root at juno ovs-build]#
>> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/add 10.53.87.242/25
>> br-vxlan
>> OK
>> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
>> Route Table:
>> User: 10.53.87.128/25 dev br-vxlan
>> Cached: 10.53.87.242/32 dev br-vxlan
>> Cached: 127.0.0.1/32 dev lo
>> Cached: 158.85.164.66/32 dev bond1
>> Cached: 192.168.1.1/32 dev br0
>> Cached: 158.85.164.64/27 dev bond1
>> Cached: 192.168.1.0/24 dev br0
>> Cached: 169.254.0.0/16 dev bond1
>> Cached: 127.0.0.0/8 dev lo
>> Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
>> [root at juno ovs-build]#
>> Then i ping 192.168.1.2, and i capture vxlan packet on eth0 by tcpdump,
>> there is no vxlan packet, do anyone know why?
>>
>>
>> You can dump-flows from datapath and check what is happening to the
> packets.
> ovs-appctl dpctl/dump-flows
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/4c3c3a2b/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 10395 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/4c3c3a2b/attachment-0001.png>

From daniel.swahn at clavister.com  Wed Sep 23 04:31:31 2015
From: daniel.swahn at clavister.com (Daniel Swahn)
Date: Wed, 23 Sep 2015 11:31:31 +0000
Subject: [ovs-discuss] RSTP crash in Open vSwitch
Message-ID: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>

Hi

I get the following crash in "Open vSwitch" during system startup:

[   37.294346] ovs-vswitchd[1156]: segfault at 90 ip 00000000004291ca sp 00007fff2e7c3080 error 4 in ovs-vswitchd[400000+18f000]
[   37.508100] openvswitch: netlink: Key attribute has unexpected length (type=21, length=4, expected=0).


Config:

# ovs-vsctl show
    Bridge ospf
        Port ospf
            Interface ospf
                type: internal
    Bridge "vsg_01"
        Port "vsg_01"
            Interface "vsg_01"
                type: internal
    Bridge hasync
        Port hasync
            Interface hasync
                type: internal
        Port "front1"
            Interface "front1"
   Bridge management
        Port "base2"
            Interface "base2"
        Port management
            Interface management
                type: internal
        Port "base1"
            Interface "base1"
        Port "base1.192"
            tag: 192
            Interface "base1.192"
    Bridge "vsg_02"
        Port "vsg_02"
            Interface "vsg_02"
                type: internal

# ovs-dpctl show
system at ovs-system:
        lookups: hit:457593 missed:1216 lost:1
        flows: 16
        masks: hit:1354321 total:8 hit/pkt:2.95
        port 0: ovs-system (internal)
        port 1: management (internal)
        port 2: ospf (internal)
        port 3: base1
        port 4: base2
        port 5: hasync (internal)
        port 6: front1
        port 7: base1.192
        port 8: vsg_02 (internal)
        port 9: vsg_01 (internal)


GDB:

Program terminated with signal 11, Segmentation fault.
#0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
Missing separate debuginfos, use: debuginfo-install glibc-2.17-78.el7.x86_64 keyutils-libs-1.5.8-3.el7.x86_64 krb5-libs-1.12.2-14.el7.x86_64 libcom_err-1.42.9-7.el7.x86_64 libselinux-2.2.2-6.el7.x86_64 openssl-libs-1.0.1e-42.el7.9.x86_64 pcre-8.32-14.el7.x86_64 xz-libs-5.1.2-9alpha.el7.x86_64 zlib-1.2.7-13.el7.x86_64
(gdb) bt
#0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
#1  run (ofproto_=0x1aa3120) at ofproto/ofproto-dpif.c:1495
#2  0x000000000041acfb in ofproto_run (p=0x1aa3120) at ofproto/ofproto.c:1677
#3  0x00000000004095f4 in bridge_run__ () at vswitchd/bridge.c:2864
#4  0x000000000040d3c5 in bridge_reconfigure (ovs_cfg=<optimized out>) at vswitchd/bridge.c:686
#5  0x000000000040fa2f in bridge_run () at vswitchd/bridge.c:2951
#6  0x00000000004065e5 in main (argc=11, argv=0x7fff2e7c35f8) at vswitchd/ovs-vswitchd.c:120

(gdb) frame 0
#0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,

(gdb) info locals
now = <optimized out>
elapsed = <optimized out>
rp = 0x0
ofport = <optimized out>



Version (no local modifications):

# ovs-vswitchd --version
ovs-vswitchd (Open vSwitch) 2.4.0
Compiled Sep  9 2015 09:55:47

# uname -a
Linux localhost 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux



Description:

I get this during system startup in CentOS 7. Everything seem to work once the system is fully booted.






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/ede36d25/attachment-0001.html>

From zhunatuzi at gmail.com  Wed Sep 23 06:39:30 2015
From: zhunatuzi at gmail.com (Na Zhu)
Date: Wed, 23 Sep 2015 21:39:30 +0800
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <2EF2F5C0CC56984AA024D0B180335FCB13CB44A6@IRSMSX102.ger.corp.intel.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
 <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>
 <2EF2F5C0CC56984AA024D0B180335FCB13CB44A6@IRSMSX102.ger.corp.intel.com>
Message-ID: <CABDe9TxXKJV9yQTYgcrFfy4B1sVKajHj4EfenzpwoV1xheSDZA@mail.gmail.com>

Hi Sugesh,

Yes, the eth0 is the DPDK port, I tcpdump on eth0 to check whether there is
no vxlan packets.
What do you mean can not tcpdump on those ports?

There is no arp entry for "10.53.87.242" in br0, do you know why?
[root at juno ovs-build]# ./bin/ovs-appctl tnl/arp/show
IP               MAC                 Bridge
=============================================
10.52.36.98      00:25:90:35:d8:84   br-vxlan
10.255.255.251   00:50:56:89:04:d5   br-vxlan
10.54.157.12     00:50:56:62:93:38   br-vxlan
10.52.36.105     52:54:00:b6:0c:50   br-vxlan
10.52.36.109     52:54:00:4f:dd:cf   br-vxlan
10.53.87.254     00:25:90:2e:11:0c   br-vxlan
10.52.36.106     52:54:00:09:28:0d   br-vxlan
10.52.36.107     52:54:00:23:82:5d   br-vxlan
10.53.7.131      00:25:90:57:e8:4a   br-vxlan
10.55.147.137    00:50:56:60:7c:bc   br-vxlan
10.53.87.219     06:a9:61:cf:b5:c8   br-vxlan
10.53.34.233     00:50:56:89:4b:74   br-vxlan
10.53.34.235     00:50:56:89:07:77   br-vxlan
10.54.159.98     00:50:56:bc:52:5e   br-vxlan
10.55.147.129    00:08:e3:ff:fd:90   br-vxlan
10.55.60.1       00:08:e3:ff:fd:90   br-vxlan



2015-09-23 18:02 GMT+08:00 Chandran, Sugesh <sugesh.chandran at intel.com>:

>
>
>
>
> *Regards*
>
> *_Sugesh*
>
>
>
> *From:* discuss [mailto:discuss-bounces at openvswitch.org] *On Behalf Of *Pravin
> Shelar
> *Sent:* Tuesday, September 22, 2015 10:52 PM
> *To:* Na Zhu
> *Cc:* bugs at openvswitch.org
> *Subject:* Re: [ovs-discuss] ovs dpdk vxlan does NOT work
>
>
>
>
>
>
>
> On Mon, Sep 21, 2015 at 10:36 PM, Na Zhu <zhunatuzi at gmail.com> wrote:
>
> Hi,
>
>
>
> I am trying to use ovs dpdk, i follow the README-native-tunneling.md, it
> does not work.
>
> my setup is:
>
> [image: 内嵌图片 1]
>
> The prefix length of br-vxlan is not 24, is 25, after i create br-vxlan,
> there is no route in ovs, so i add it by command ovs-appctl.
>
>
>
> Which OVS version are you using?
>
>
>
> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
>
> Route Table:
>
> Cached: 10.53.87.242/32 dev br-vxlan
>
> Cached: 127.0.0.1/32 dev lo
>
> Cached: 158.85.164.66/32 dev bond1
>
> Cached: 192.168.1.1/32 dev br0
>
> Cached: 158.85.164.64/27 dev bond1
>
> Cached: 192.168.1.0/24 dev br0
>
> Cached: 169.254.0.0/16 dev bond1
>
> Cached: 127.0.0.0/8 dev lo
>
> Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
>
> [root at juno ovs-build]#
>
> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/add 10.53.87.242/25
> br-vxlan
>
> OK
>
> [root at juno ovs-build]# ./bin/ovs-appctl ovs/route/show
>
> Route Table:
>
> User: 10.53.87.128/25 dev br-vxlan
>
> Cached: 10.53.87.242/32 dev br-vxlan
>
> Cached: 127.0.0.1/32 dev lo
>
> Cached: 158.85.164.66/32 dev bond1
>
> Cached: 192.168.1.1/32 dev br0
>
> Cached: 158.85.164.64/27 dev bond1
>
> Cached: 192.168.1.0/24 dev br0
>
> Cached: 169.254.0.0/16 dev bond1
>
> Cached: 127.0.0.0/8 dev lo
>
> Cached: 0.0.0.0/0 dev bond1 GW 158.85.164.65
>
> [root at juno ovs-build]#
>
> Then i ping 192.168.1.2, and i capture vxlan packet on eth0 by tcpdump,
> there is no vxlan packet, do anyone know why?
>
>
>
>
>
> You can dump-flows from datapath and check what is happening to the
> packets.
>
> ovs-appctl dpctl/dump-flows
>
>
>
> *>>>>[Sugesh] My 2 cents*
>
> *I assume eth0 is DPDK port, in that case you cannot tcpdump on those
> ports.*
>
> *Can you please verify the arp entries configured on the OVS ??*
>
>
>
> *ovs-appctl tnl/arp/show*
>
>
>
> *br0 must have the arp entry for “10.53.87.242” *
>
> *br-vxlan must have the arp entry for “10.53.87.254”*
>
>
>
> *If they are missing you can set them using *
>
>
>
> *ovs-appctl tnl/arp/set br0  10.53.87.242 <MAC address of br-vxlan>*
>
> *ovs-appctl tnl/arp/set br-vxlan  10.53.87.254 <MAC address of remote end>*
>
>
>
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/0e4590b9/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 10395 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/0e4590b9/attachment-0001.png>

From fbl at sysclose.org  Wed Sep 23 10:05:07 2015
From: fbl at sysclose.org (Flavio Leitner)
Date: Wed, 23 Sep 2015 14:05:07 -0300
Subject: [ovs-discuss] multicast_snooping and multicast_router
In-Reply-To: <CAGkpguXzbpes86u4PHsvxtLbTcR1VK-rM07BbquwfDU73SuYfQ@mail.gmail.com>
References: <CAGkpguXzbpes86u4PHsvxtLbTcR1VK-rM07BbquwfDU73SuYfQ@mail.gmail.com>
Message-ID: <20150923170507.GA2385@x240.home>

On Wed, Sep 23, 2015 at 05:44:29PM +0200, Petr Horacek wrote:
> Hello,
> 
> I have a question: In native Linux bridging we have options
> multicast_snooping
> and multicast_router [1]. The first one has an alternative in OVS called
> mcast_snooping_enable. Is there an alternative for multicast_router as well?

I believe so.  See ovs-vsctl(8) man-page and look for mcast-snooping-flood
and mcast-snooping-flood-reports.

fbl


From daniel.herrmann1 at gmail.com  Wed Sep 23 12:11:26 2015
From: daniel.herrmann1 at gmail.com (Daniel Herrmann)
Date: Wed, 23 Sep 2015 21:11:26 +0200
Subject: [ovs-discuss] OF Group Tables Load Balancing
Message-ID: <5602F95E.50505@gmail.com>

Hi,

I am trying to load-balance traffic in a routed scenario and want to use
OF group tables for this.

However, it seems that only one bucket is selected. I found some thread
from mid 2014, which states that only eth_dst is used for matching:

http://openvswitch.org/pipermail/discuss/2014-August/014785.html

There Srini wrote a patch, but as far as I can tell is was never
submitted to dev. Was there any follow-up until then? Does anyone still
have the patch, as I was not part of this list back then and pipermail
does not store mail attachments on the discuss list?

Thanks and best regards
Daniel

From pshelar at nicira.com  Wed Sep 23 12:45:13 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Wed, 23 Sep 2015 12:45:13 -0700
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <CABDe9TwB276S-XbfC_C4uGeK2DkohVH7U8rEOWTO3gjG+mF07Q@mail.gmail.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
 <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>
 <CABDe9TwB276S-XbfC_C4uGeK2DkohVH7U8rEOWTO3gjG+mF07Q@mail.gmail.com>
Message-ID: <CALnjE+opQ+uV-xSwBvjnJjqbEq5yt4tkRgURD=wBK394Tv3iTw@mail.gmail.com>

On Tue, Sep 22, 2015 at 5:49 PM, Na Zhu <zhunatuzi at gmail.com> wrote:

> Hi,
>
> My version is 2.4.90, i download from ovs github and build it myself.
>
> [root at juno bin]# ./ovs-vsctl --version
> ovs-vsctl (Open vSwitch) 2.4.90
> Compiled Sep 19 2015 08:46:02
> DB Schema 7.12.1
>
> [root at juno bin]# ./ovs-appctl dpif/show
> netdev at ovs-netdev: hit:246440 missed:9259
>         br-vxlan:
>                 bond0 1/2: (system)
>                 br-vxlan 65534/1: (tap)
>         br0:
>                 br0 65534/3: (tap)
>                 vxlan0 1/4: (vxlan: remote_ip=10.53.87.254)
>
Can you ping 10.53.87.254?


> [root at juno bin]# ./ovs-appctl dpif/dump-flows br0
> [root at juno bin]#
>
> [root at juno bin]# ./ovs-appctl dpif/dump-flows br-vxlan
> recirc_id(0),in_port(2),eth(src=00:25:90:2e:11:0c,dst=00:25:90:2e:0e:a4),eth_type(0x0800),ipv4(dst=10.53.87.242,proto=6/0x1,frag=no),
> packets:1216, bytes:152197, used:0.143s, flags:SFP., actions:1
> recirc_id(0),in_port(2),eth(src=52:54:00:09:28:0d,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.106,tip=10.52.36.102,op=1/0xff,sha=52:54:00:09:28:0d),
> packets:132, bytes:7920, used:0.618s, actions:1
> recirc_id(0),in_port(2),eth(src=00:50:56:89:4b:74,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.233,tip=10.53.34.234,op=1/0xff,sha=00:50:56:89:4b:74),
> packets:85, bytes:5100, used:0.826s, actions:1
> recirc_id(0),in_port(2),eth(src=00:0c:29:e5:88:e4,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
> packets:139, bytes:8340, used:0.616s, actions:1
> recirc_id(0),in_port(2),eth(src=00:08:e3:ff:fd:90,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.55.60.1,tip=10.55.60.4,op=1/0xff,sha=00:08:e3:ff:fd:90),
> packets:6, bytes:360, used:4.789s, actions:1
> recirc_id(0),in_port(2),eth(src=00:50:56:bc:29:13,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
> packets:30, bytes:1800, used:0.704s, actions:1
> recirc_id(0),in_port(2),eth(src=00:0c:29:10:67:d2,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
> packets:139, bytes:8340, used:0.648s, actions:1
> recirc_id(0),in_port(2),eth(src=00:50:56:bc:52:5e,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.54.159.98,tip=10.54.159.100,op=1/0xff,sha=00:50:56:bc:52:5e),
> packets:77, bytes:4620, used:0.265s, actions:1
> recirc_id(0),in_port(2),eth(src=52:54:00:23:82:5d,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.107,tip=10.52.36.102,op=1/0xff,sha=52:54:00:23:82:5d),
> packets:95, bytes:5700, used:2.460s, actions:1
> recirc_id(0),in_port(2),eth(src=00:0c:29:51:d5:16,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
> packets:140, bytes:8400, used:0.328s, actions:1
> recirc_id(0),in_port(2),eth(src=00:50:56:89:1f:74,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.235,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:1f:74),
> packets:99, bytes:5940, used:0.553s, actions:1
> recirc_id(0),in_port(2),eth(src=52:54:00:b6:0c:50,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.105,tip=10.52.36.102,op=1/0xff,sha=52:54:00:b6:0c:50),
> packets:129, bytes:7740, used:4.243s, actions:1
> recirc_id(0),in_port(2),eth(src=00:50:56:89:09:6b,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.235,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:09:6b),
> packets:99, bytes:5940, used:0.554s, actions:1
> recirc_id(0),in_port(2),eth(src=52:54:00:4f:dd:cf,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.109,tip=10.52.36.102,op=1/0xff,sha=52:54:00:4f:dd:cf),
> packets:99, bytes:5940, used:0.805s, actions:1
> recirc_id(0),in_port(2),eth(src=50:57:a8:85:cb:04,dst=50:57:a8:85:cb:04),eth_type(0x9000),
> packets:0, bytes:0, used:never, actions:drop
> recirc_id(0),in_port(2),eth(src=00:50:56:89:07:77,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.235,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:07:77),
> packets:99, bytes:5940, used:0.554s, actions:1
> recirc_id(0),in_port(2),eth(src=00:0c:29:1c:ea:54,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0800),ipv4(frag=no),
> packets:4, bytes:1368, used:5.620s, actions:1
> recirc_id(0),in_port(2),eth(src=00:50:56:89:4b:74,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.233,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:4b:74),
> packets:121, bytes:7260, used:0.466s, actions:1
> recirc_id(0),in_port(2),eth(src=00:50:56:60:7c:bc,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.55.147.137,tip=10.55.147.135,op=1/0xff,sha=00:50:56:60:7c:bc),
> packets:0, bytes:0, used:never, actions:1
> recirc_id(0),in_port(2),eth(src=00:25:90:35:d8:84,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.98,tip=10.52.36.102,op=1/0xff,sha=00:25:90:35:d8:84),
> packets:64, bytes:3840, used:3.690s, actions:1
> [root at juno bin]#
>
> There are many flows about other packet in the link, no flows about my arp
> packet (sip=192.168.1.1, dip=192.168.1.2)
>
>
You need to run traffic and check datapath flow. These flow are deleted if
not used.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150923/e308eee5/attachment.html>

From azhou at nicira.com  Wed Sep 23 13:00:00 2015
From: azhou at nicira.com (Andy Zhou)
Date: Wed, 23 Sep 2015 13:00:00 -0700
Subject: [ovs-discuss] Help needed to understand code snippet
In-Reply-To: <CAHN905K2ryD4Q538tHxihV+o9PcuA1XtKOGGdcy5Ou_fVuCg6Q@mail.gmail.com>
References: <CAHN905K2ryD4Q538tHxihV+o9PcuA1XtKOGGdcy5Ou_fVuCg6Q@mail.gmail.com>
Message-ID: <CACzMAJ+NYcDZV2PiCVPjUFNruTmnk-j0zoPA1=GfW6BRakkKVg@mail.gmail.com>

On Wed, Sep 23, 2015 at 5:55 AM, neeraj mehta <mehtaneeraj07 at gmail.com> wrote:
> Hello Team,
>
> Can you help me in understanding below snippet.
>
> I was looking at the code in bond.c:bond_compose_learning_packet( ). In
> this, function choose_output_slave ( ) can return NULL. And returned pointer
> is used as  "*port_aux = slave->aux".
> How will it work?
> ====================================================
> static struct bond_slave *
> choose_output_slave(const struct bond *bond, const struct flow *flow,
>                     struct flow_wildcards *wc, uint16_t vlan)
> {
>     struct bond_entry *e;
>     int balance;
>
>     balance = bond->balance;
>     if (bond->lacp_status == LACP_CONFIGURED) {
>         /* LACP has been configured on this bond but negotiations were
>          * unsuccussful. If lacp_fallback_ab is enabled use active-
>          * backup mode else drop all traffic. */
>         if (!bond->lacp_fallback_ab) {
>             return NULL;
>         }
>
> .....
> ===================================================
>
> ===================================================
> slave = choose_output_slave(bond, &flow, NULL, vlan);
>
>     packet = ofpbuf_new(0);
>     compose_rarp(packet, eth_src);
>     if (vlan) {
>         eth_push_vlan(packet, htons(ETH_TYPE_VLAN), htons(vlan));
>     }
>
>     *port_aux = slave->aux;
>     ovs_rwlock_unlock(&rwlock);
>     }
> ======================================================
>
The may_send_learning_packets() check above should make this code safe.

From phoracek at redhat.com  Thu Sep 24 00:35:09 2015
From: phoracek at redhat.com (Petr Horacek)
Date: Thu, 24 Sep 2015 09:35:09 +0200
Subject: [ovs-discuss] multicast_snooping and multicast_router
In-Reply-To: <20150923170507.GA2385@x240.home>
References: <CAGkpguXzbpes86u4PHsvxtLbTcR1VK-rM07BbquwfDU73SuYfQ@mail.gmail.com>
 <20150923170507.GA2385@x240.home>
Message-ID: <CAGkpguUCO7-7_ng=wF+C-tPS2GLG4vDFJK0M+jn0X=r=9t_EhQ@mail.gmail.com>

Thanks Flavio, I'll take a look :)

Petr

2015-09-23 19:05 GMT+02:00 Flavio Leitner <fbl at sysclose.org>:

> On Wed, Sep 23, 2015 at 05:44:29PM +0200, Petr Horacek wrote:
> > Hello,
> >
> > I have a question: In native Linux bridging we have options
> > multicast_snooping
> > and multicast_router [1]. The first one has an alternative in OVS called
> > mcast_snooping_enable. Is there an alternative for multicast_router as
> well?
>
> I believe so.  See ovs-vsctl(8) man-page and look for mcast-snooping-flood
> and mcast-snooping-flood-reports.
>
> fbl
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150924/57c00885/attachment-0001.html>

From zhunatuzi at gmail.com  Wed Sep 23 21:03:09 2015
From: zhunatuzi at gmail.com (Na Zhu)
Date: Thu, 24 Sep 2015 12:03:09 +0800
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <CALnjE+opQ+uV-xSwBvjnJjqbEq5yt4tkRgURD=wBK394Tv3iTw@mail.gmail.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
 <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>
 <CABDe9TwB276S-XbfC_C4uGeK2DkohVH7U8rEOWTO3gjG+mF07Q@mail.gmail.com>
 <CALnjE+opQ+uV-xSwBvjnJjqbEq5yt4tkRgURD=wBK394Tv3iTw@mail.gmail.com>
Message-ID: <CABDe9TzYCxsaq_bvym--rQK73hgG1SeKvirKBJnv=2jX7KLHng@mail.gmail.com>

Hi Pravin,

I can ping  10.53.87.254.

Can i tcpdump eth0 to get the vxlan packets?

Yesterday, another engineer said i can not tcpdump eth0, do you know why?

2015-09-24 3:45 GMT+08:00 Pravin Shelar <pshelar at nicira.com>:

>
>
> On Tue, Sep 22, 2015 at 5:49 PM, Na Zhu <zhunatuzi at gmail.com> wrote:
>
>> Hi,
>>
>> My version is 2.4.90, i download from ovs github and build it myself.
>>
>> [root at juno bin]# ./ovs-vsctl --version
>> ovs-vsctl (Open vSwitch) 2.4.90
>> Compiled Sep 19 2015 08:46:02
>> DB Schema 7.12.1
>>
>> [root at juno bin]# ./ovs-appctl dpif/show
>> netdev at ovs-netdev: hit:246440 missed:9259
>>         br-vxlan:
>>                 bond0 1/2: (system)
>>                 br-vxlan 65534/1: (tap)
>>         br0:
>>                 br0 65534/3: (tap)
>>                 vxlan0 1/4: (vxlan: remote_ip=10.53.87.254)
>>
> Can you ping 10.53.87.254?
>
>
>> [root at juno bin]# ./ovs-appctl dpif/dump-flows br0
>> [root at juno bin]#
>>
>> [root at juno bin]# ./ovs-appctl dpif/dump-flows br-vxlan
>> recirc_id(0),in_port(2),eth(src=00:25:90:2e:11:0c,dst=00:25:90:2e:0e:a4),eth_type(0x0800),ipv4(dst=10.53.87.242,proto=6/0x1,frag=no),
>> packets:1216, bytes:152197, used:0.143s, flags:SFP., actions:1
>> recirc_id(0),in_port(2),eth(src=52:54:00:09:28:0d,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.106,tip=10.52.36.102,op=1/0xff,sha=52:54:00:09:28:0d),
>> packets:132, bytes:7920, used:0.618s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:50:56:89:4b:74,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.233,tip=10.53.34.234,op=1/0xff,sha=00:50:56:89:4b:74),
>> packets:85, bytes:5100, used:0.826s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:0c:29:e5:88:e4,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
>> packets:139, bytes:8340, used:0.616s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:08:e3:ff:fd:90,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.55.60.1,tip=10.55.60.4,op=1/0xff,sha=00:08:e3:ff:fd:90),
>> packets:6, bytes:360, used:4.789s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:50:56:bc:29:13,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
>> packets:30, bytes:1800, used:0.704s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:0c:29:10:67:d2,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
>> packets:139, bytes:8340, used:0.648s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:50:56:bc:52:5e,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.54.159.98,tip=10.54.159.100,op=1/0xff,sha=00:50:56:bc:52:5e),
>> packets:77, bytes:4620, used:0.265s, actions:1
>> recirc_id(0),in_port(2),eth(src=52:54:00:23:82:5d,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.107,tip=10.52.36.102,op=1/0xff,sha=52:54:00:23:82:5d),
>> packets:95, bytes:5700, used:2.460s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:0c:29:51:d5:16,dst=01:00:5e:00:00:12),eth_type(0x0800),ipv4(frag=no),
>> packets:140, bytes:8400, used:0.328s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:50:56:89:1f:74,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.235,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:1f:74),
>> packets:99, bytes:5940, used:0.553s, actions:1
>> recirc_id(0),in_port(2),eth(src=52:54:00:b6:0c:50,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.105,tip=10.52.36.102,op=1/0xff,sha=52:54:00:b6:0c:50),
>> packets:129, bytes:7740, used:4.243s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:50:56:89:09:6b,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.235,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:09:6b),
>> packets:99, bytes:5940, used:0.554s, actions:1
>> recirc_id(0),in_port(2),eth(src=52:54:00:4f:dd:cf,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.109,tip=10.52.36.102,op=1/0xff,sha=52:54:00:4f:dd:cf),
>> packets:99, bytes:5940, used:0.805s, actions:1
>> recirc_id(0),in_port(2),eth(src=50:57:a8:85:cb:04,dst=50:57:a8:85:cb:04),eth_type(0x9000),
>> packets:0, bytes:0, used:never, actions:drop
>> recirc_id(0),in_port(2),eth(src=00:50:56:89:07:77,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.235,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:07:77),
>> packets:99, bytes:5940, used:0.554s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:0c:29:1c:ea:54,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0800),ipv4(frag=no),
>> packets:4, bytes:1368, used:5.620s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:50:56:89:4b:74,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.53.34.233,tip=10.53.34.230,op=1/0xff,sha=00:50:56:89:4b:74),
>> packets:121, bytes:7260, used:0.466s, actions:1
>> recirc_id(0),in_port(2),eth(src=00:50:56:60:7c:bc,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.55.147.137,tip=10.55.147.135,op=1/0xff,sha=00:50:56:60:7c:bc),
>> packets:0, bytes:0, used:never, actions:1
>> recirc_id(0),in_port(2),eth(src=00:25:90:35:d8:84,dst=ff:ff:ff:ff:ff:ff),eth_type(0x0806),arp(sip=10.52.36.98,tip=10.52.36.102,op=1/0xff,sha=00:25:90:35:d8:84),
>> packets:64, bytes:3840, used:3.690s, actions:1
>> [root at juno bin]#
>>
>> There are many flows about other packet in the link, no flows about my
>> arp packet (sip=192.168.1.1, dip=192.168.1.2)
>>
>>
> You need to run traffic and check datapath flow. These flow are deleted if
> not used.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150924/84e3791f/attachment.html>

From rishi.raj2509 at gmail.com  Thu Sep 24 03:16:15 2015
From: rishi.raj2509 at gmail.com (RishiRaj Maulick)
Date: Thu, 24 Sep 2015 15:46:15 +0530
Subject: [ovs-discuss] Fwd: Query with respect to DB commit even when vsctl
	failed
In-Reply-To: <CAOLvpU5vWcyQpKkmuGAjf0F9-zp_qpBzC46o7CuF-Pq9_anwDQ@mail.gmail.com>
References: <CAOLvpU5vWcyQpKkmuGAjf0F9-zp_qpBzC46o7CuF-Pq9_anwDQ@mail.gmail.com>
Message-ID: <CAOLvpU5PONZTvBGiQr2hwYkGaaJYZ05Zaw-PmPsvP2XyiOyb7g@mail.gmail.com>

Hi All,

In the scenario where the ovsdb has already updated the database , but the
application that has registered for monitoring the schema has failed to
process DB updates ( due to internal errors ) , we have to roll back the
database changes.

Is there a mechanism available in ovsdb-server to roll back to a certain
previous commit point.

I would greatly appreciate any response on this as it would help us in
making right design decisions.

Thanks and regards,
Rishi Raj

---------- Forwarded message ----------
From: RishiRaj Maulick <rishi.raj2509 at gmail.com>
Date: Mon, Sep 21, 2015 at 5:01 PM
Subject: Query with respect to DB commit even when vsctl failed
To: discuss at openvswitch.org, dev at openvswitch.org


Hi ,



I have been using OVS recently and I noticed the following -



1)     I did not insert the openvswitch kernel module

2)     Using “ovs-vsctl add-br br0” command , I tried to add a bridge –
which failed for obvious reasons. There is an error log that is displayed
on ovs-vsctl screen as well.

3) However there are entries that are left in the ovs database –
“ovsdb-client dump”. I can see addition to the bridge , port , interface
and openvswitch tables – all entries pertaining to the bridge “br0”.

Ideally an application has to delete the bridge “br0” from the DB after
hitting an error like this.



I see that the ovs-vsctl can detect these errors through checks for the
field in the interface table entry "ofport”.



The question is how can a remote management interface for any proprietary
schemas get to know about application processing failures .



Thanks and regards,
Rishi Raj Maulick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150924/270c9214/attachment.html>

From azhou at nicira.com  Thu Sep 24 11:14:25 2015
From: azhou at nicira.com (Andy Zhou)
Date: Thu, 24 Sep 2015 11:14:25 -0700
Subject: [ovs-discuss] [ovs-dev] Query with respect to DB commit even
	when vsctl failed
In-Reply-To: <CAOLvpU5vWcyQpKkmuGAjf0F9-zp_qpBzC46o7CuF-Pq9_anwDQ@mail.gmail.com>
References: <CAOLvpU5vWcyQpKkmuGAjf0F9-zp_qpBzC46o7CuF-Pq9_anwDQ@mail.gmail.com>
Message-ID: <CACzMAJ+bMzSOVgkanJHYV+Rd-i74o1oDLaTp4X+TxanQu018Rw@mail.gmail.com>

On Mon, Sep 21, 2015 at 4:31 AM, RishiRaj Maulick
<rishi.raj2509 at gmail.com> wrote:
> Hi ,
>
>
>
> I have been using OVS recently and I noticed the following -
>
>
>
> 1)    1)   I did not insert the openvswitch kernel module
>
> 2)      2) Using “ovs-vsctl add-br br0” command , I tried to add a bridge –
> which failed for obvious reasons. There is an error log that is displayed
> on ovs-vsctl screen as well.

Technically, this is an error reported only by ovs-vsctl. It is not an
error from ovsdb
stand point.  If you insert kmod and restart ovs-vswitchd, the bridge
will be created.

>
> 3)      3) However there are entries that are left in the ovs database –
> “ovsdb-client dump”. I can see addition to the bridge , port , interface
> and openvswitch tables – all entries pertaining to the bridge “br0”.
>
That's expected.

> Ideally an application has to delete the bridge “br0” from the DB after
> hitting an error like this.
>
I am not sure ovs-vsctl should do this. You can certainly implement a
script on top
of ovs-vsctl, or an application that do this.
>
>
> I see that the ovs-vsctl can detect these errors through checks for the
> field in the interface table entry "ofport”.
>
>
Yes
>
> The question is how can a remote management interface for any proprietary
> schemas get to know about application processing failures .
>
>
Does your schema has 'ofport', if yes, then one option could be to
monitor 'ofport'.
>
> Thanks and regards,
> Rishi Raj Maulick
> _______________________________________________
> dev mailing list
> dev at openvswitch.org
> http://openvswitch.org/mailman/listinfo/dev

From azhou at nicira.com  Thu Sep 24 11:25:53 2015
From: azhou at nicira.com (Andy Zhou)
Date: Thu, 24 Sep 2015 11:25:53 -0700
Subject: [ovs-discuss] [ovs-dev] Fwd: Query with respect to DB commit
	even when vsctl failed
In-Reply-To: <CAOLvpU5PONZTvBGiQr2hwYkGaaJYZ05Zaw-PmPsvP2XyiOyb7g@mail.gmail.com>
References: <CAOLvpU5vWcyQpKkmuGAjf0F9-zp_qpBzC46o7CuF-Pq9_anwDQ@mail.gmail.com>
 <CAOLvpU5PONZTvBGiQr2hwYkGaaJYZ05Zaw-PmPsvP2XyiOyb7g@mail.gmail.com>
Message-ID: <CACzMAJLHCoGsRvmX7aM=_Y-qfLFipA9f6rSB=K9+epn2Y9-g2g@mail.gmail.com>

On Thu, Sep 24, 2015 at 3:16 AM, RishiRaj Maulick
<rishi.raj2509 at gmail.com> wrote:
> Hi All,
>
> In the scenario where the ovsdb has already updated the database , but the
> application that has registered for monitoring the schema has failed to
> process DB updates ( due to internal errors ) , we have to roll back the
> database changes.
>
> Is there a mechanism available in ovsdb-server to roll back to a certain
> previous commit point.
Not I am aware of. ovsdb-server usually takes transactions from multiple
sources, including ovs-vswitchd.  Not sure a database wide rollback would
make sense in this scenario.

From mehtaneeraj07 at gmail.com  Thu Sep 24 12:33:51 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Fri, 25 Sep 2015 01:03:51 +0530
Subject: [ovs-discuss] Matcthing parameters for exact flow entry for
	particular packet
Message-ID: <CAHN905Kyvpoue1BKtSA5qpC7a-11n9cEKnTHTk3rG=S9jY53mw@mail.gmail.com>

Hello Team,

I am working on OVS-2.3.2. I want to add flow entries for exact match for
the packets. Is there is any documentation that I can consult to get the
information about tuples(flow entry matching parameters) needed to create
an exact flow entry for particular type of packet packet.

Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150925/bb711f35/attachment.html>

From azhou at nicira.com  Thu Sep 24 13:23:22 2015
From: azhou at nicira.com (Andy Zhou)
Date: Thu, 24 Sep 2015 13:23:22 -0700
Subject: [ovs-discuss] Matcthing parameters for exact flow entry for
 particular packet
In-Reply-To: <CAHN905Kyvpoue1BKtSA5qpC7a-11n9cEKnTHTk3rG=S9jY53mw@mail.gmail.com>
References: <CAHN905Kyvpoue1BKtSA5qpC7a-11n9cEKnTHTk3rG=S9jY53mw@mail.gmail.com>
Message-ID: <CACzMAJ+EMR2P20HkJpcGbg7NH1zYzNzPu==bWUQZZavwWzZJTA@mail.gmail.com>

man ovs-ofctl

On Thu, Sep 24, 2015 at 12:33 PM, neeraj mehta <mehtaneeraj07 at gmail.com> wrote:
> Hello Team,
>
> I am working on OVS-2.3.2. I want to add flow entries for exact match for
> the packets. Is there is any documentation that I can consult to get the
> information about tuples(flow entry matching parameters) needed to create an
> exact flow entry for particular type of packet packet.
>
> Regards
> Neeraj
>
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From blp at nicira.com  Thu Sep 24 15:20:44 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 24 Sep 2015 15:20:44 -0700
Subject: [ovs-discuss] Matcthing parameters for exact flow entry for
 particular packet
In-Reply-To: <CAHN905Kyvpoue1BKtSA5qpC7a-11n9cEKnTHTk3rG=S9jY53mw@mail.gmail.com>
References: <CAHN905Kyvpoue1BKtSA5qpC7a-11n9cEKnTHTk3rG=S9jY53mw@mail.gmail.com>
Message-ID: <20150924222044.GB6644@nicira.com>

On Fri, Sep 25, 2015 at 01:03:51AM +0530, neeraj mehta wrote:
> I am working on OVS-2.3.2. I want to add flow entries for exact match for
> the packets. Is there is any documentation that I can consult to get the
> information about tuples(flow entry matching parameters) needed to create
> an exact flow entry for particular type of packet packet.

It doesn't really make sense to talk about "exact match" these days.
What's your motivation?

From pshelar at nicira.com  Thu Sep 24 15:40:39 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Thu, 24 Sep 2015 15:40:39 -0700
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <CABDe9TzYCxsaq_bvym--rQK73hgG1SeKvirKBJnv=2jX7KLHng@mail.gmail.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
 <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>
 <CABDe9TwB276S-XbfC_C4uGeK2DkohVH7U8rEOWTO3gjG+mF07Q@mail.gmail.com>
 <CALnjE+opQ+uV-xSwBvjnJjqbEq5yt4tkRgURD=wBK394Tv3iTw@mail.gmail.com>
 <CABDe9TzYCxsaq_bvym--rQK73hgG1SeKvirKBJnv=2jX7KLHng@mail.gmail.com>
Message-ID: <CALnjE+rV1HdFb3usPbtyo3KbvpwNs3otUbysVG92ueG9p70yQg@mail.gmail.com>

On Wed, Sep 23, 2015 at 9:03 PM, Na Zhu <zhunatuzi at gmail.com> wrote:
> Hi Pravin,
>
> I can ping  10.53.87.254.
>
> Can i tcpdump eth0 to get the vxlan packets?
>
> Yesterday, another engineer said i can not tcpdump eth0, do you know why?
>
If eth0 is dpdk device AFAIK there is no way to do tcpdump on it since
tcpdump expect kernel networking device.

From xiaolia at cisco.com  Thu Sep 24 19:39:20 2015
From: xiaolia at cisco.com (Xiao Liang (xiaolia))
Date: Fri, 25 Sep 2015 02:39:20 +0000
Subject: [ovs-discuss] Negative match a field?
Message-ID: <d8fd30fecf3943c3beba6eea4a909bf9@XCH-RCD-014.cisco.com>

Hi,

I want to apply actions on all packets except those with a certain source MAC address. For example
in_port=1, dl_src!=MAC_A, actions=output:2
in_port=2, dl_src!=MAC_B, actions=output:1
priority=0, action=drop

Is there easy way to do this?

Thanks,
Xiao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150925/a5b6d181/attachment.html>

From liu.liuyongqiang at huawei.com  Thu Sep 24 21:03:19 2015
From: liu.liuyongqiang at huawei.com (Liuyongqiang (A))
Date: Fri, 25 Sep 2015 04:03:19 +0000
Subject: [ovs-discuss] ovsdb-client connected error when i update the
 ovsdb-server ca_cert.pem file
Message-ID: <621FAA8B3DA4E14193D6933FB72489BA58261A66@nkgeml511-mbx.china.huawei.com>

Hi, all
There is a probability error when I update the ovsdb-server ca_cert.pem file, the ovsdb-client was unable to connect to the ovsdb-server when it hanppened, the OVS version is 2.0.2.

the update action steps on server:
step1: rm ca_cert.pem
step2: openssl x509 -inform PEM -in ca_cert.pem > /home/ca_cert.pem

I have found the direct cause is concurrency write-read file issues, the ovsdb-server probably read the wrong certificate from ca_cert.pem file, but this error is unrecoverable, it need to restart OVS to fix,
did someone know about this problem?

The ovsdb-client connected error like this:

ERROR1:
# ovsdb-client -v -p /home/oam-network-agent_private_key.pem -c oam-network-agent_crt.pem -C /home/oam-network-agent_ca_crt.pem get-schema ssl:9.42.3.9:6632 Open_vSwitch
2015-09-25T10:54:36Z|00001|stream_ssl|INFO|Trusting CA cert from /home/oam-network-agent_ca_crt.pem (/C=CN/ST=ZheJiang/O=Huawei/OU=Huawei/CN=*.*.*.domainname.com) (fingerprint 22:a3:49:97:e1:44:ab:fb:96:29:60:ab:b8:fc:69:8b:7d:af:6c:6e)
2015-09-25T10:54:36Z|00002|poll_loop|DBG|wakeup due to 0-ms timeout
2015-09-25T10:54:36Z|00003|poll_loop|DBG|wakeup due to [POLLOUT] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:716
2015-09-25T10:54:36Z|00004|stream_ssl|DBG|client0-->ssl:9.42.3.9:6632 handshake: client_hello (85 bytes)
2015-09-25T10:54:36Z|00005|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00006|stream_ssl|DBG|client0<--ssl:9.42.3.9:6632 handshake: server_hello (53 bytes)
2015-09-25T10:54:36Z|00007|stream_ssl|DBG|client0<--ssl:9.42.3.9:6632 handshake: certificate (1944 bytes)
2015-09-25T10:54:36Z|00008|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00009|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00010|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00011|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00012|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00013|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00014|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00015|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00016|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00017|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54185<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T10:54:36Z|00048|stream_ssl|DBG|client0<--ssl:9.42.3.9:6632 handshake: certificate_request (65559 bytes)
2015-09-25T10:54:36Z|00049|stream_ssl|DBG|client0-->ssl:9.42.3.9:6632 alert: fatal, decode_error (2 bytes)
2015-09-25T10:54:36Z|00050|stream_ssl|WARN|SSL_connect: error:1408709F:SSL routines:SSL3_GET_CERTIFICATE_REQUEST:length mismatch
ovsdb-client: failed to connect to "ssl:9.42.3.9:6632" (Protocol error)

ERROR2:
# ovsdb-client -v -p /home/oam-network-agent_private_key.pem -c oam-network-agent_crt.pem -C /home/oam-network-agent_ca_crt.pem get-schema ssl:9.42.3.9:6632 Open_vSwitch
2015-09-25T11:01:06Z|00001|stream_ssl|INFO|Trusting CA cert from /home/oam-network-agent_ca_crt.pem (/C=CN/ST=ZheJiang/O=Huawei/OU=Huawei/CN=*.*.*.domainname.com) (fingerprint 22:a3:49:97:e1:44:ab:fb:96:29:60:ab:b8:fc:69:8b:7d:af:6c:6e)
2015-09-25T11:01:06Z|00002|poll_loop|DBG|wakeup due to 0-ms timeout
2015-09-25T11:01:06Z|00003|poll_loop|DBG|wakeup due to [POLLOUT] on fd 4 (9.62.243.149:54288<->9.42.3.9:6632) at lib/stream-ssl.c:716
2015-09-25T11:01:06Z|00004|stream_ssl|DBG|client0-->ssl:9.42.3.9:6632 handshake: client_hello (85 bytes)
2015-09-25T11:01:06Z|00005|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54288<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T11:01:06Z|00006|stream_ssl|DBG|client0<--ssl:9.42.3.9:6632 handshake: server_hello (53 bytes)
2015-09-25T11:01:06Z|00007|stream_ssl|DBG|client0<--ssl:9.42.3.9:6632 handshake: certificate (985 bytes)
2015-09-25T11:01:06Z|00008|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54288<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T11:01:06Z|00009|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54288<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T11:01:06Z|00010|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54288<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T11:01:06Z|00011|stream_ssl|DBG|client0<--ssl:9.42.3.9:6632 handshake: certificate_request (11019 bytes)
2015-09-25T11:01:06Z|00012|stream_ssl|DBG|client0<--ssl:9.42.3.9:6632 handshake: server_hello_done (4 bytes)
2015-09-25T11:01:06Z|00013|stream_ssl|DBG|client0-->ssl:9.42.3.9:6632 handshake: certificate (1944 bytes)
2015-09-25T11:01:06Z|00014|stream_ssl|DBG|client0-->ssl:9.42.3.9:6632 handshake: client_key_exchange (262 bytes)
2015-09-25T11:01:06Z|00015|stream_ssl|DBG|client0-->ssl:9.42.3.9:6632 handshake: certificate_verify (262 bytes)
2015-09-25T11:01:06Z|00016|stream_ssl|DBG|client0-->ssl:9.42.3.9:6632 change_cipher_spec (1 bytes)
2015-09-25T11:01:06Z|00017|stream_ssl|DBG|client0-->ssl:9.42.3.9:6632 handshake: finished (16 bytes)
2015-09-25T11:01:06Z|00018|poll_loop|DBG|wakeup due to [POLLIN] on fd 4 (9.62.243.149:54288<->9.42.3.9:6632) at lib/stream-ssl.c:723
2015-09-25T11:01:06Z|00019|stream_ssl|DBG|client0<--ssl:9.42.3.9:6632 alert: fatal, unknown_ca (2 bytes)
2015-09-25T11:01:06Z|00020|stream_ssl|WARN|SSL_connect: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1 alert unknown ca
ovsdb-client: failed to connect to "ssl:9.42.3.9:6632" (Protocol error)


the ovsdb-server log will print warning like this:

ERROR1:
2015-09-25T11:05:15.633Z|02941|stream_ssl|WARN|SSL_accept: error:1409441A:SSL routines:SSL3_READ_BYTES:tlsv1 alert decode error
2015-09-25T11:05:15.633Z|02942|jsonrpc|WARN|ssl:9.62.243.149:54187: receive error: Protocol error
2015-09-25T11:05:15.634Z|02943|reconnect|WARN|ssl:9.62.243.149:54187: connection dropped (Protocol error)

ERROR2:
2015-09-25T11:11:37.494Z|00449|stream_ssl|WARN|SSL_accept: error:140890B2:SSL routines:SSL3_GET_CLIENT_CERTIFICATE:no certificate returned
2015-09-25T11:11:37.494Z|00450|jsonrpc|WARN|ssl:9.62.243.149:54289: receive error: Protocol error
2015-09-25T11:11:37.494Z|00451|reconnect|WARN|ssl:9.62.243.149:54289: connection dropped (Protocol error)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150925/7bad8cdd/attachment-0001.html>

From blp at nicira.com  Thu Sep 24 22:23:08 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 24 Sep 2015 22:23:08 -0700
Subject: [ovs-discuss] Negative match a field?
In-Reply-To: <d8fd30fecf3943c3beba6eea4a909bf9@XCH-RCD-014.cisco.com>
References: <d8fd30fecf3943c3beba6eea4a909bf9@XCH-RCD-014.cisco.com>
Message-ID: <20150925052308.GA10652@nicira.com>

On Fri, Sep 25, 2015 at 02:39:20AM +0000, Xiao Liang (xiaolia) wrote:
> I want to apply actions on all packets except those with a certain source MAC address. For example
> in_port=1, dl_src!=MAC_A, actions=output:2
> in_port=2, dl_src!=MAC_B, actions=output:1
> priority=0, action=drop
> 
> Is there easy way to do this?

Ideally, you use high-priority flows to match the exceptions, and then
put the common case into a lower-priority flow, like this:

        dl_src=A, priority=100, actions=...
        dl_src=B, priority=100, actions=...
        priority=0, actions=...

If you really can't do that, then you can use 48 flows to match all the
possible source MAC addresses that do not equal a given MAC, one for
each possible bit that could differ.  It's a pretty bad solution because
it uses a lot of flows and has a high cost at runtime.

From er.manpreet25 at gmail.com  Thu Sep 24 22:49:23 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Fri, 25 Sep 2015 11:19:23 +0530
Subject: [ovs-discuss] Behavior of switch when controller role is slave
Message-ID: <CALD=K8u=m-z2k=dJ9AnF3zpHZctpu_j7bG8N2j6FMHeJRY5AEA@mail.gmail.com>

Hello Team,

I want to discuss the behavior of Master/Slave Controller. I am performing
below operation on OVS-2.3.2 with RYU.

- Set controller role= slave
- Reply received from switch with role set=slave
- Add Flow entry(Send FlowMod)

 The switch must reply with OFPT_ERROR message with a type field of
OFPET_BAD_REQUEST, a code field ofOFPBRC_IS_SLAVE i.e. type=1 and code=10.
But I am getting reply as type of OFPET_BAD_REQUEST and code of  OFPBRC_EPERM
i.e type=1 and code =5.

Is this behavior is correct?


Regards

Manpreet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150925/de36069f/attachment.html>

From blp at nicira.com  Thu Sep 24 23:16:10 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 24 Sep 2015 23:16:10 -0700
Subject: [ovs-discuss] Behavior of switch when controller role is slave
In-Reply-To: <CALD=K8u=m-z2k=dJ9AnF3zpHZctpu_j7bG8N2j6FMHeJRY5AEA@mail.gmail.com>
References: <CALD=K8u=m-z2k=dJ9AnF3zpHZctpu_j7bG8N2j6FMHeJRY5AEA@mail.gmail.com>
Message-ID: <20150925061610.GE10652@nicira.com>

On Fri, Sep 25, 2015 at 11:19:23AM +0530, Manpreet Singh wrote:
> Hello Team,
> 
> I want to discuss the behavior of Master/Slave Controller. I am performing
> below operation on OVS-2.3.2 with RYU.
> 
> - Set controller role= slave
> - Reply received from switch with role set=slave
> - Add Flow entry(Send FlowMod)
> 
>  The switch must reply with OFPT_ERROR message with a type field of
> OFPET_BAD_REQUEST, a code field ofOFPBRC_IS_SLAVE i.e. type=1 and code=10.
> But I am getting reply as type of OFPET_BAD_REQUEST and code of  OFPBRC_EPERM
> i.e type=1 and code =5.
> 
> Is this behavior is correct?

This bug was fixed in OVS 2.4.  I've also now backported to the 2.3.x
branch, so it'll be fixed in the next 2.3.x release also.

From blp at nicira.com  Thu Sep 24 23:34:38 2015
From: blp at nicira.com (Ben Pfaff)
Date: Thu, 24 Sep 2015 23:34:38 -0700
Subject: [ovs-discuss] ovsdb-client connected error when i update the
 ovsdb-server ca_cert.pem file
In-Reply-To: <621FAA8B3DA4E14193D6933FB72489BA58261A66@nkgeml511-mbx.china.huawei.com>
References: <621FAA8B3DA4E14193D6933FB72489BA58261A66@nkgeml511-mbx.china.huawei.com>
Message-ID: <20150925063438.GG10652@nicira.com>

On Fri, Sep 25, 2015 at 04:03:19AM +0000, Liuyongqiang (A) wrote:
> Hi, all
> There is a probability error when I update the ovsdb-server ca_cert.pem file, the ovsdb-client was unable to connect to the ovsdb-server when it hanppened, the OVS version is 2.0.2.
> 
> the update action steps on server:
> step1: rm ca_cert.pem
> step2: openssl x509 -inform PEM -in ca_cert.pem > /home/ca_cert.pem
> 
> I have found the direct cause is concurrency write-read file issues, the ovsdb-server probably read the wrong certificate from ca_cert.pem file, but this error is unrecoverable, it need to restart OVS to fix,
> did someone know about this problem?

Does it work better if you replace it atomically?

openssl x509 -inform PEM -in ca_cert.pem > /home/ca_cert.pem.tmp
mv /home/ca_cert.pem.tmp /home/ca_cert.pem

From gowrishankar.m at linux.vnet.ibm.com  Thu Sep 24 23:57:54 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Fri, 25 Sep 2015 12:27:54 +0530
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <CABDe9Tw8URsUpFinKqAEah6x_hj5v4vVOf5O5brq+abevi2_Nw@mail.gmail.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
 <CABDe9Tw8URsUpFinKqAEah6x_hj5v4vVOf5O5brq+abevi2_Nw@mail.gmail.com>
Message-ID: <5604F072.5080304@linux.vnet.ibm.com>

On Tuesday 22 September 2015 01:49 PM, Na Zhu wrote:
> Attach more logs.
>
> [root at juno ovs-build]#
> [root at juno ovs-build]# ./bin/ovs-vsctl show
> 84a54e08-c37d-459d-90e5-6c664095eddb
>     Bridge "br0"
>         Port "vxlan0"
>             Interface "vxlan0"
>                 type: vxlan
>                 options: {remote_ip="10.53.87.254"}
>         Port "br0"
>             Interface "br0"
>                 type: internal
>     Bridge br-vxlan
>         Port br-vxlan
>             Interface br-vxlan
>                 type: internal
>         Port "eth0"
>             Interface "eth0"

etho type is not "dpdkvhostuser". Are you sure you have run 
dpdk_nic_bind.py from dpdk build ?

-- 
Regards,
Gowrishankar M


From gowrishankar.m at linux.vnet.ibm.com  Fri Sep 25 00:11:12 2015
From: gowrishankar.m at linux.vnet.ibm.com (gowrishankar)
Date: Fri, 25 Sep 2015 12:41:12 +0530
Subject: [ovs-discuss] ovs dpdk vxlan does NOT work
In-Reply-To: <CALnjE+rV1HdFb3usPbtyo3KbvpwNs3otUbysVG92ueG9p70yQg@mail.gmail.com>
References: <CABDe9TxNvDu49oFecrC2Hi2Quh3GHqpp=jhYzDybOgd4Gfh0+g@mail.gmail.com>
 <CALnjE+o+y6zBpTsAeYt4Ghe3kqdLDvr0Z5ssN9ZoFOiqUG05ZQ@mail.gmail.com>
 <CABDe9TwB276S-XbfC_C4uGeK2DkohVH7U8rEOWTO3gjG+mF07Q@mail.gmail.com>
 <CALnjE+opQ+uV-xSwBvjnJjqbEq5yt4tkRgURD=wBK394Tv3iTw@mail.gmail.com>
 <CABDe9TzYCxsaq_bvym--rQK73hgG1SeKvirKBJnv=2jX7KLHng@mail.gmail.com>
 <CALnjE+rV1HdFb3usPbtyo3KbvpwNs3otUbysVG92ueG9p70yQg@mail.gmail.com>
Message-ID: <5604F390.1080004@linux.vnet.ibm.com>

On Friday 25 September 2015 04:10 AM, Pravin Shelar wrote:
> On Wed, Sep 23, 2015 at 9:03 PM, Na Zhu <zhunatuzi at gmail.com> wrote:
>> Hi Pravin,
>>
>> I can ping  10.53.87.254.
>>
>> Can i tcpdump eth0 to get the vxlan packets?
>>
>> Yesterday, another engineer said i can not tcpdump eth0, do you know why?
>>
> If eth0 is dpdk device AFAIK there is no way to do tcpdump on it since
> tcpdump expect kernel networking device.

dpdk driver that you use bypass kernel network stack. So, libpcap can 
not help you
as it operates only on any registered netdev for kernel stack (eg tap, 
lo or any virtual interface and
phy nic). In dpdk case, tcpdump would not even know such device exists.

But I use ovs feature - port mirroring -  to inspect dpdk port. Idea is 
just to mirror all
traffic from ovs internal port into a dummy port that kernel stack can 
recognise and
run tcpdump over dummy. You can refer ovs manual or some online tutorial 
for more info.

So, in your case you can try (assuming dpdk0 is dpdk port).

ip link add name pcap0 type dummy
ip link set dev pcap0 up
ovs-vsctl add-port br-vxlan pcap0
ovs-vsctl -- set bridge br-vxlan mirrors=@m -- --id=@pcap0 get port 
pcap0 -- --id=@dpdk0 get port dpdk0 -- --id=@m create mirror 
name=mirror0 select-dst-port=@dpdk0 select-src-port=@dpdk0 
output-port=@pcap0 select_all=1
ovs-vsctl list mirror

tcpdump -i pcap0

ovs-vsctl clear bridge br-vxlan mirrors
ip link delete dev pcap0

You can move dummy port to other bridge as well and create mirror 
accordingly to further
capture packets.

-- 
Regards,
Gowrishankar M


From davidjoshuaevans at gmail.com  Fri Sep 25 09:28:26 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Fri, 25 Sep 2015 11:28:26 -0500
Subject: [ovs-discuss] line rate traffic in dpdk & ovs rx errors and dead
	port.
Message-ID: <D22AE05A.32467%davidjoshuaevans@gmail.com>

Hi all,

Has anyone seen that when starting ovs (with dpdk) that the port will show
many rx-errors and the device will stop receiving traffic?
Is there a mitigation for this.
I have tried adding drop all flows to the bridge before all my other flows
are set up.
I have tried disabling the port rx too. But still get this behaviour when
starting ovs if there is traffic running to it.

Everything works fine if I have no traffic running to the dpdk port at
startup and initiate the traffic after the switch is steady and configured.

Regards,
Dave.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150925/74971f98/attachment.html>

From diproiettod at vmware.com  Fri Sep 25 09:50:07 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Fri, 25 Sep 2015 16:50:07 +0000
Subject: [ovs-discuss] line rate traffic in dpdk & ovs rx errors and
 dead port.
In-Reply-To: <D22AE05A.32467%davidjoshuaevans@gmail.com>
References: <D22AE05A.32467%davidjoshuaevans@gmail.com>
Message-ID: <D22B38C2.71DA%diproiettod@vmware.com>

I regularly start ovs with dpdk while traffic is flowing.

Is there anything suspicious in the ovs-vswitchd log?

Have you tried other DPDK apps (e.g. l2fwd)?


On 25/09/2015 17:28, "David Evans" <davidjoshuaevans at gmail.com> wrote:

>Hi all,
>
>
>Has anyone seen that when starting ovs (with dpdk) that the port will
>show many rx-errors and the device will stop receiving traffic?
>Is there a mitigation for this.
>I have tried adding drop all flows to the bridge before all my other
>flows are set up.
>I have tried disabling the port rx too. But still get this behaviour when
>starting ovs if there is traffic running to it.
>
>
>Everything works fine if I have no traffic running to the dpdk port at
>startup and initiate the traffic after the switch is steady and
>configured.
>
>
>Regards,
>Dave.
>
>


From dev_raj82 at yahoo.com  Fri Sep 25 04:08:11 2015
From: dev_raj82 at yahoo.com (Nishanth Devarajan)
Date: Fri, 25 Sep 2015 16:38:11 +0530
Subject: [ovs-discuss] Interconnection of subnets using OVS
Message-ID: <CD8BF5B6-BB86-477A-8972-4FFDF50CDCB7@yahoo.com>

Hello everyone,
			So I have an experimental lab setup of multiple subnets which require to have traffic forwarding between them (only in the forward and backward directions ). 
i.e:                           Subnet1—> Subnet2 —> Subnet3   or    Subnet1 <— Subnet2 <— Subnet3 . 

The subnets are NOT connected to some router like typical network topologies. Each subnets consists of 2 hosts and and an OVS switch so that traffic can be forwarded between the subnets.

i.e       													|
														|
						Each subnet:					    OVS
													    /     \
													   /	    \
													h1	    h2

Now,  what is the best way to connect the OVS switches ? I was thinking of GRE tunnels (but I could be wrong), and also does the OVS GRE tunnelling have support for subnets ?  I thank you for your help :)


Thank you for your time,
Nishanth

From n.borisov at siteground.com  Fri Sep 25 05:00:53 2015
From: n.borisov at siteground.com (Nikolay Borisov)
Date: Fri, 25 Sep 2015 15:00:53 +0300
Subject: [ovs-discuss] memory corruption in the kernel module
Message-ID: <56053775.8090508@siteground.com>

Hello, 

I'm using openvswitch on kernel 3.12.28 and опенжсвитцх 2.3.1 recently got the following warnings from the kernel: 

[8003509.804409] ------------[ cut here ]------------
[8003509.804653] WARNING: CPU: 28 PID: 12584 at mm/slub.c:3318 ksize+0xbd/0xc0()
[8003509.804880] Modules linked in: xt_REDIRECT tcp_diag inet_diag act_police cls_basic sch_ingress xt_iprange xt_multiport xt_pkttype xt_state veth openvswitch gre vxlan ip_tunnel xt_owner xt_conntrack iptable_mangle xt_nat iptable_nat nf_conntrack_ipv4 nf_defrag_ipv4 nf_nat_ipv4 nf_nat xt_CT nf_conntrack iptable_raw ib_ipoib rdma_ucm ib_ucm ib_uverbs ib_umad rdma_cm ib_cm iw_cm ib_addr ipv6 ib_sa ib_mad ib_core ext2 dm_thin_pool dm_bio_prison dm_persistent_data dm_bufio dm_mirror dm_region_hash dm_log i2c_i801 lpc_ich mfd_core ioapic ioatdma igb dca ipmi_devintf ipmi_si ipmi_msghandler megaraid_sas
[8003509.806801] CPU: 28 PID: 12584 Comm: handler42 Not tainted 3.12.28-clouder7 #1
[8003509.807026] Hardware name: Supermicro X9DRD-7LN4F(-JBOD)/X9DRD-EF/X9DRD-7LN4F, BIOS 3.2 01/16/2015
[8003509.807465]  0000000000000cf6 ffff883fcfc75858 ffffffff815717b9 0000000000000cf6
[8003509.807699]  0000000000000000 ffff883fcfc75898 ffffffff810786c2 ffff883fcfc75960
[8003509.807932]  ffffea005264d5c0 ffff883fcfc759b0 0000000000000000 0000000000000008
[8003509.808163] Call Trace:
[8003509.808385]  [<ffffffff815717b9>] dump_stack+0x49/0x60
[8003509.808611]  [<ffffffff810786c2>] warn_slowpath_common+0x82/0xb0
[8003509.808836]  [<ffffffff81078705>] warn_slowpath_null+0x15/0x20
[8003509.809062]  [<ffffffff8113a0dd>] ksize+0xbd/0xc0
[8003509.809290]  [<ffffffffa0290390>] reserve_sfa_size+0x30/0xe0 [openvswitch]
[8003509.809518]  [<ffffffffa02907a3>] validate_and_copy_actions+0x1e3/0x530 [openvswitch]
[8003509.809748]  [<ffffffff8113c1f1>] ? __kmalloc+0x31/0x190
[8003509.809973]  [<ffffffffa0290cc3>] ovs_packet_cmd_execute+0x1a3/0x230 [openvswitch]
[8003509.810202]  [<ffffffff814e8d61>] genl_family_rcv_msg+0x221/0x390
[8003509.810432]  [<ffffffff814e8ed0>] ? genl_family_rcv_msg+0x390/0x390
[8003509.810660]  [<ffffffff814e8f2b>] genl_rcv_msg+0x5b/0xa0
[8003509.810885]  [<ffffffff814e72b9>] netlink_rcv_skb+0x99/0xc0
[8003509.811110]  [<ffffffff814e87d7>] genl_rcv+0x27/0x40
[8003509.811335]  [<ffffffff814e634f>] netlink_unicast+0x10f/0x190
[8003509.811563]  [<ffffffff814e7cf3>] netlink_sendmsg+0x2c3/0x750
[8003509.811788]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
[8003509.812014]  [<ffffffff814a620b>] sock_sendmsg+0x8b/0xb0
[8003509.812239]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
[8003509.812465]  [<ffffffff8157583b>] ? _raw_spin_lock_bh+0x1b/0x40
[8003509.812689]  [<ffffffff81575700>] ? _raw_spin_unlock_bh+0x10/0x20
[8003509.812916]  [<ffffffff814b3091>] ? verify_iovec+0x61/0xe0
[8003509.813143]  [<ffffffff814a70d1>] ___sys_sendmsg+0x411/0x430
[8003509.813373]  [<ffffffff81193ca9>] ? ep_scan_ready_list+0x189/0x1b0
[8003509.813600]  [<ffffffff81193e2f>] ? ep_poll+0x13f/0x370
[8003509.813825]  [<ffffffff81089c4b>] ? k_getrusage+0x13b/0x380
[8003509.814047]  [<ffffffff814a72f4>] __sys_sendmsg+0x44/0x80
[8003509.814268]  [<ffffffff814a7344>] SyS_sendmsg+0x14/0x20
[8003509.819684]  [<ffffffff815763a2>] system_call_fastpath+0x16/0x1b
[8003509.819910] ---[ end trace af1b9000d8cc8f35 ]---

And almost instantly after that: 

[8003509.820257] ------------[ cut here ]------------
[8003509.820480] kernel BUG at mm/slub.c:3338!
[8003509.820699] invalid opcode: 0000 [#1] SMP 
[8003509.820922] Modules linked in: xt_REDIRECT tcp_diag inet_diag act_police cls_basic sch_ingress xt_iprange xt_multiport xt_pkttype xt_state veth openvswitch gre vxlan ip_tunnel xt_owner xt_conntrack iptable_mangle xt_nat iptable_nat nf_conntrack_ipv4 nf_defrag_ipv4 nf_nat_ipv4 nf_nat xt_CT nf_conntrack iptable_raw ib_ipoib rdma_ucm ib_ucm ib_uverbs ib_umad rdma_cm ib_cm iw_cm ib_addr ipv6 ib_sa ib_mad ib_core ext2 dm_thin_pool dm_bio_prison dm_persistent_data dm_bufio dm_mirror dm_region_hash dm_log i2c_i801 lpc_ich mfd_core ioapic ioatdma igb dca ipmi_devintf ipmi_si ipmi_msghandler megaraid_sas
[8003509.822840] CPU: 28 PID: 12584 Comm: handler42 Tainted: G        W    3.12.28-clouder7 #1
[8003509.823068] Hardware name: Supermicro X9DRD-7LN4F(-JBOD)/X9DRD-EF/X9DRD-7LN4F, BIOS 3.2 01/16/2015
[8003509.823514] task: ffff883fce76dac0 ti: ffff883fcfc74000 task.ti: ffff883fcfc74000
[8003509.823739] RIP: 0010:[<ffffffff8113a9b2>]  [<ffffffff8113a9b2>] kfree+0xe2/0xf0
[8003509.823970] RSP: 0018:ffff883fcfc75938  EFLAGS: 00010246
[8003509.824194] RAX: 02fc000000000824 RBX: ffff880261eb4cf0 RCX: ffff883fce76dac0
[8003509.824423] RDX: 0000000000402140 RSI: 0000000000000000 RDI: ffff8814993577e0
[8003509.824647] RBP: ffff883fcfc75948 R08: ffff881fffc91640 R09: ffffea005264d5c0
[8003509.824874] R10: ffffffff814b04ca R11: 0000000000000000 R12: 0000000000000000
[8003509.825098] R13: ffff880261eb4cf0 R14: ffff880261eb4d28 R15: ffff8818a080ec00
[8003509.825327] FS:  00007fa9c9ffb700(0000) GS:ffff881fffc80000(0000) knlGS:0000000000000000
[8003509.825556] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[8003509.825780] CR2: ffffffffff600400 CR3: 0000003fce560000 CR4: 00000000001407e0
[8003509.826007] Stack:
[8003509.826225]  ffff883fcfc75978 ffff880261eb4cf0 ffff883fcfc75968 ffffffffa0296c98
[8003509.826459]  ffff883fcfc75978 ffff880261eb4cf0 ffff883fcfc75988 ffffffffa0296ce9
[8003509.826693]  ffff8818a080ff00 ffff883fce2f3300 ffff883fcfc759e8 ffffffffa0290d2c
[8003509.826926] Call Trace:
[8003509.827150]  [<ffffffffa0296c98>] __flow_free+0x18/0x30 [openvswitch]
[8003509.827377]  [<ffffffffa0296ce9>] ovs_flow_free+0x39/0x70 [openvswitch]
[8003509.827609]  [<ffffffffa0290d2c>] ovs_packet_cmd_execute+0x20c/0x230 [openvswitch]
[8003509.827842]  [<ffffffff814e8d61>] genl_family_rcv_msg+0x221/0x390
[8003509.828067]  [<ffffffff814e8ed0>] ? genl_family_rcv_msg+0x390/0x390
[8003509.828288]  [<ffffffff814e8f2b>] genl_rcv_msg+0x5b/0xa0
[8003509.828508]  [<ffffffff814e72b9>] netlink_rcv_skb+0x99/0xc0
[8003509.828729]  [<ffffffff814e87d7>] genl_rcv+0x27/0x40
[8003509.828949]  [<ffffffff814e634f>] netlink_unicast+0x10f/0x190
[8003509.829170]  [<ffffffff814e7cf3>] netlink_sendmsg+0x2c3/0x750
[8003509.829393]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
[8003509.829615]  [<ffffffff814a620b>] sock_sendmsg+0x8b/0xb0
[8003509.829837]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
[8003509.830063]  [<ffffffff8157583b>] ? _raw_spin_lock_bh+0x1b/0x40
[8003509.830289]  [<ffffffff81575700>] ? _raw_spin_unlock_bh+0x10/0x20
[8003509.830517]  [<ffffffff814b3091>] ? verify_iovec+0x61/0xe0
[8003509.830742]  [<ffffffff814a70d1>] ___sys_sendmsg+0x411/0x430
[8003509.830971]  [<ffffffff81193ca9>] ? ep_scan_ready_list+0x189/0x1b0
[8003509.831199]  [<ffffffff81193e2f>] ? ep_poll+0x13f/0x370
[8003509.831426]  [<ffffffff81089c4b>] ? k_getrusage+0x13b/0x380
[8003509.831649]  [<ffffffff814a72f4>] __sys_sendmsg+0x44/0x80
[8003509.831876]  [<ffffffff814a7344>] SyS_sendmsg+0x14/0x20
[8003509.832102]  [<ffffffff815763a2>] system_call_fastpath+0x16/0x1b
[8003509.832327] Code: ce 4c 89 d7 e8 f0 fc ff ff eb d6 66 41 f7 01 00 c0 74 18 49 8b 01 31 f6 f6 c4 40 74 04 41 8b 71 68 4c 89 cf e8 f0 3e fc ff eb b6 <0f> 0b eb fe 66 2e 0f 1f 84 00 00 00 00 00 55 8b 05 79 33 ab 00 
[8003509.833151] RIP  [<ffffffff8113a9b2>] kfree+0xe2/0xf0
[8003509.833380]  RSP <ffff883fcfc75938>
[8003509.833972] ---[ end trace af1b9000d8cc8f36 ]---

It goes without saying that when this occurs the machine loses connectivity on all interface which are hooked up in an openvswitch bridge and ultimately the machine crashes. I did some review of the surrounding code, particularly in the

ovs_packet_cmd_execute->validate_and_copy_actions -> copy_action -> reserve_sfa_size -> ksize call chain and it is pretty clear that the sfa pointer is indeed allocated from the heap (it's the acts in ovs_packet_cmd_execute, which is allocated in ovs_flow_actions_alloc), yet the sanity check in the kernel fails to see if this is indeed a slab allocated memory. Same thing with the second bug splat. The flow is being allocated with ovs_flow_alloc() and by the time it has to be freed it is corrupted. I can see there are a lot of calculations happening with the netlink headers and packets and frankly this is making me a bit uneasy as it seems error prone. 

So does any of you have experienced similar corruptions?

Regards, 
Nikolay 

From balazs.nemeth at ericsson.com  Fri Sep 25 05:10:49 2015
From: balazs.nemeth at ericsson.com (Balazs Nemeth)
Date: Fri, 25 Sep 2015 12:10:49 +0000
Subject: [ovs-discuss] OVS does not start without openvswitch log
 directory
In-Reply-To: <CACzMAJ+jSbDJC5SJQEfTxorMhz+reVgWSucgizft92VauELT_w@mail.gmail.com>
References: <3BFF958DA8403D4599365B997AA23AB00114C93E@ESESSMB305.ericsson.se>
 <CACzMAJ+jSbDJC5SJQEfTxorMhz+reVgWSucgizft92VauELT_w@mail.gmail.com>
Message-ID: <3BFF958DA8403D4599365B997AA23AB00114E6B1@ESESSMB305.ericsson.se>

Dear Andy,

No, I deleted the folder and I started openvswitch-switch process. I built on branch v2.3 and installed the debs. I got this output:
balazs at ubuntu:~> sudo service openvswitch-switch start
/etc/init.d/openvswitch-switch: 65: /etc/init.d/openvswitch-switch: cannot create /var/log/openvswitch/ovs-ctl.log: Directory nonexistent
tee: /var/log/openvswitch/ovs-ctl.log: No such file or directory
 * Starting ovsdb-server
 * Configuring Open vSwitch system IDs
 * Starting ovs-vswitchd
 * Enabling remote OVSDB managers

I think a check would be enough if /var/log/openvswitch directory is existing or not. And if not, make a directory.

BR,
Balazs

-----Original Message-----
From: Andy Zhou [mailto:azhou at nicira.com] 
Sent: 22 September 2015 22:47
To: Balazs Nemeth
Cc: bugs at openvswitch.org
Subject: Re: [ovs-discuss] OVS does not start without openvswitch log directory

What solutions do you have in mind?

In this case, it seems there is a script involved in starting ovs.  If true, I wonder if it possible to create the directory if necessary at the beginning of the script?

On Tue, Sep 22, 2015 at 2:39 AM, Balazs Nemeth <balazs.nemeth at ericsson.com> wrote:
> Dear All,
>
>
>
> I’m using OVS version 2.3.0. I wanted to delete ovs log files and 
> accidentally I deleted the whole folder /var/log/openvswitch/. I 
> noticed that openvswitch-switch service was unable to start because of 
> this. The error message was (I did not delete /var/run/openvswitch/):
>
> start: Job failed to start
>
> 2015-09-22T09:27:41Z|00001|daemon_unix|WARN|/var/run/openvswitch/ovs-vswitchd.pid:
> open: No such file or directory
>
> ovs-appctl: cannot read pidfile 
> "/var/run/openvswitch/ovs-vswitchd.pid" (No such file or directory)
>
>
>
> If the log directory exists but empty, the openvswitch-switch service 
> will start. The problem comes up when the directory doesn’t exist. 
> Please investigate this bug.
>
> Best regards,
>
> Balazs Nemeth
>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From 4554916 at qq.com  Fri Sep 25 06:55:44 2015
From: 4554916 at qq.com (=?gb18030?B?ydnLpw==?=)
Date: Fri, 25 Sep 2015 21:55:44 +0800
Subject: [ovs-discuss] centos6.7_64 cannot build openswitch
Message-ID: <tencent_463B2A4260E2106133E101CC@qq.com>

my OS info
uname -a
Linux localhost.localdomain 2.6.32-573.el6.x86_64 #1 SMP Thu Jul 23 15:44:03 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux


Error INFO
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../datapath.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../dp_notify.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../flow.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../flow_netlink.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../flow_table.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../vport.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../vport-internal_dev.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../vport-netdev.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/dev-openvswitch.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/exthdrs_core.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/flex_array.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/flow_dissector.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/geneve.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/gre.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/gso.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/genetlink-openvswitch.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/ip_tunnels_core.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/netdevice.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/net_namespace.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/reciprocal_div.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/skbuff-openvswitch.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/stt.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/udp.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/udp_tunnel.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/vxlan.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../linux/compat/utils.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../vport-geneve.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../vport-gre.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../vport-lisp.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../vport-stt.c 
ln -s /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../vport-vxlan.c 
/usr/bin/make -C /usr/src/kernels/2.6.32-573.7.1.el6.x86_64 M=/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux modules
make[1]: Entering directory `/usr/src/kernels/2.6.32-573.7.1.el6.x86_64'
  CC [M]  /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.o
  CC [M]  /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/datapath.o
  CC [M]  /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/dp_notify.o
  CC [M]  /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/flow.o
In file included from include/linux/if_ether.h:136,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/if_ether.h:4,
                 from include/linux/netdevice.h:29,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/flow.c:20:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/skbuff.h: In function 'skb_clear_hash':
In file included from include/linux/if_ether.h:136,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/if_ether.h:4,
                 from include/linux/netdevice.h:29,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from include/linux/if_arp.h:26,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/if_arp.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/datapath.c:23:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/skbuff.h: In function 'skb_clear_hash':
In file included from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:21:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/skbuff.h: In function 'skb_clear_hash':
In file included from include/linux/if_ether.h:136,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/if_ether.h:4,
                 from include/linux/netdevice.h:29,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/dp_notify.c:19:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/skbuff.h: In function 'skb_clear_hash':
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/skbuff.h:335: error: 'struct sk_buff' has no member named 'l4_rxhash'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/skbuff.h:335: error: 'struct sk_buff' has no member named 'l4_rxhash'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/skbuff.h:335: error: 'struct sk_buff' has no member named 'l4_rxhash'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/skbuff.h:335: error: 'struct sk_buff' has no member named 'l4_rxhash'
In file included from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:22:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/in.h: At top level:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/in.h:8: error: redefinition of 'proto_ports_offset'
include/linux/in.h:292: note: previous definition of 'proto_ports_offset' was here
In file included from include/linux/netfilter.h:9,
                 from include/net/netns/x_tables.h:5,
                 from include/net/net_namespace.h:18,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/net/net_namespace.h:4,
                 from include/linux/netdevice.h:48,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from include/linux/if_arp.h:26,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/if_arp.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/datapath.c:23:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/in.h: At top level:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/in.h:8: error: redefinition of 'proto_ports_offset'
include/linux/in.h:292: note: previous definition of 'proto_ports_offset' was here
In file included from include/linux/netfilter.h:9,
                 from include/net/netns/x_tables.h:5,
                 from include/net/net_namespace.h:18,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/net/net_namespace.h:4,
                 from include/linux/netdevice.h:48,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/flow.c:20:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/in.h: At top level:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/in.h:8: error: redefinition of 'proto_ports_offset'
include/linux/in.h:292: note: previous definition of 'proto_ports_offset' was here
In file included from include/linux/netfilter.h:9,
                 from include/net/netns/x_tables.h:5,
                 from include/net/net_namespace.h:18,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/net/net_namespace.h:4,
                 from include/linux/netdevice.h:48,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/netdevice.h:4,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/dp_notify.c:19:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/in.h: At top level:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/linux/in.h:8: error: redefinition of 'proto_ports_offset'
include/linux/in.h:292: note: previous definition of 'proto_ports_offset' was here
In file included from include/net/xfrm.h:18,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../compat.h:26,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../datapath.h:29,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/dp_notify.c:24:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/net/ip.h:9: error: redefinition of 'ip_is_fragment'
include/net/ip.h:249: note: previous definition of 'ip_is_fragment' was here
In file included from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:31:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/net/ip.h:9: error: redefinition of 'ip_is_fragment'
include/net/ip.h:249: note: previous definition of 'ip_is_fragment' was here
In file included from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/flow.c:43:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/net/ip.h:9: error: redefinition of 'ip_is_fragment'
include/net/ip.h:249: note: previous definition of 'ip_is_fragment' was here
In file included from include/net/xfrm.h:18,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../compat.h:26,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/../datapath.h:29,
                 from /root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/datapath.c:55:
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/../datapath/linux/compat/include/net/ip.h:9: error: redefinition of 'ip_is_fragment'
include/net/ip.h:249: note: previous definition of 'ip_is_fragment' was here
make[2]: *** [/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/datapath.o] Error 1
make[2]: *** Waiting for unfinished jobs....
make[2]: *** [/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/dp_notify.o] Error 1
make[2]: *** [/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/flow.o] Error 1
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c: In function 'ovs_execute_actions':
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: error: 'exec_actions_level' undeclared (first use in this function)
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: error: (Each undeclared identifier is reported only once
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: error: for each function it appears in.)
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: warning: type defaults to 'int' in declaration of 'ret__'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: warning: type defaults to 'int' in declaration of 'ret__'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: warning: type defaults to 'int' in declaration of 'ret__'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: warning: type defaults to 'int' in declaration of 'ret__'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: warning: type defaults to 'int' in declaration of 'ret__'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:987: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:999: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:999: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:999: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:999: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:999: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:999: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:999: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:999: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: warning: type defaults to 'int' in declaration of 'type name'
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: error: invalid type argument of 'unary *' (have 'int')
/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.c:1006: warning: type defaults to 'int' in declaration of 'type name'
make[2]: *** [/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux/actions.o] Error 1
make[1]: *** [_module_/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux] Error 2
make[1]: Leaving directory `/usr/src/kernels/2.6.32-573.7.1.el6.x86_64'
make: *** [default] Error 2
make: Leaving directory `/root/rpmbuild/BUILD/openvswitch-2.4.0/_default/datapath/linux'
error: Bad exit status from /var/tmp/rpm-tmp.I8zoAh (%build)


RPM build errors:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150925/effc9606/attachment-0001.html>

From shettyg at nicira.com  Fri Sep 25 10:31:43 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 25 Sep 2015 10:31:43 -0700
Subject: [ovs-discuss] OVS does not start without openvswitch log
	directory
In-Reply-To: <3BFF958DA8403D4599365B997AA23AB00114E6B1@ESESSMB305.ericsson.se>
References: <3BFF958DA8403D4599365B997AA23AB00114C93E@ESESSMB305.ericsson.se>
 <CACzMAJ+jSbDJC5SJQEfTxorMhz+reVgWSucgizft92VauELT_w@mail.gmail.com>
 <3BFF958DA8403D4599365B997AA23AB00114E6B1@ESESSMB305.ericsson.se>
Message-ID: <CAHbON5rnvtLVu-71PSvPyrAFWq_8BvGPtkDuq3T6N75zLbAc8Q@mail.gmail.com>

Any reasons to delete the directory? Directories are created during
package install and not during software start. In this case, wouldn't
it make more sense to re-create the directory by hand?

On Fri, Sep 25, 2015 at 5:10 AM, Balazs Nemeth
<balazs.nemeth at ericsson.com> wrote:
> Dear Andy,
>
> No, I deleted the folder and I started openvswitch-switch process. I built on branch v2.3 and installed the debs. I got this output:
> balazs at ubuntu:~> sudo service openvswitch-switch start
> /etc/init.d/openvswitch-switch: 65: /etc/init.d/openvswitch-switch: cannot create /var/log/openvswitch/ovs-ctl.log: Directory nonexistent
> tee: /var/log/openvswitch/ovs-ctl.log: No such file or directory
>  * Starting ovsdb-server
>  * Configuring Open vSwitch system IDs
>  * Starting ovs-vswitchd
>  * Enabling remote OVSDB managers
>
> I think a check would be enough if /var/log/openvswitch directory is existing or not. And if not, make a directory.
>
> BR,
> Balazs
>
> -----Original Message-----
> From: Andy Zhou [mailto:azhou at nicira.com]
> Sent: 22 September 2015 22:47
> To: Balazs Nemeth
> Cc: bugs at openvswitch.org
> Subject: Re: [ovs-discuss] OVS does not start without openvswitch log directory
>
> What solutions do you have in mind?
>
> In this case, it seems there is a script involved in starting ovs.  If true, I wonder if it possible to create the directory if necessary at the beginning of the script?
>
> On Tue, Sep 22, 2015 at 2:39 AM, Balazs Nemeth <balazs.nemeth at ericsson.com> wrote:
>> Dear All,
>>
>>
>>
>> I’m using OVS version 2.3.0. I wanted to delete ovs log files and
>> accidentally I deleted the whole folder /var/log/openvswitch/. I
>> noticed that openvswitch-switch service was unable to start because of
>> this. The error message was (I did not delete /var/run/openvswitch/):
>>
>> start: Job failed to start
>>
>> 2015-09-22T09:27:41Z|00001|daemon_unix|WARN|/var/run/openvswitch/ovs-vswitchd.pid:
>> open: No such file or directory
>>
>> ovs-appctl: cannot read pidfile
>> "/var/run/openvswitch/ovs-vswitchd.pid" (No such file or directory)
>>
>>
>>
>> If the log directory exists but empty, the openvswitch-switch service
>> will start. The problem comes up when the directory doesn’t exist.
>> Please investigate this bug.
>>
>> Best regards,
>>
>> Balazs Nemeth
>>
>>
>> _______________________________________________
>> discuss mailing list
>> discuss at openvswitch.org
>> http://openvswitch.org/mailman/listinfo/discuss
>>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss

From shettyg at nicira.com  Fri Sep 25 12:37:29 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Fri, 25 Sep 2015 12:37:29 -0700
Subject: [ovs-discuss] OVS does not start without openvswitch log
	directory
In-Reply-To: <CAHbON5rnvtLVu-71PSvPyrAFWq_8BvGPtkDuq3T6N75zLbAc8Q@mail.gmail.com>
References: <3BFF958DA8403D4599365B997AA23AB00114C93E@ESESSMB305.ericsson.se>
 <CACzMAJ+jSbDJC5SJQEfTxorMhz+reVgWSucgizft92VauELT_w@mail.gmail.com>
 <3BFF958DA8403D4599365B997AA23AB00114E6B1@ESESSMB305.ericsson.se>
 <CAHbON5rnvtLVu-71PSvPyrAFWq_8BvGPtkDuq3T6N75zLbAc8Q@mail.gmail.com>
Message-ID: <CAHbON5p-C2RVtP9jgP2m2Rk=pX0-68AhToT0PkP4JZzN3mDUHQ@mail.gmail.com>

On Fri, Sep 25, 2015 at 10:31 AM, Gurucharan Shetty <shettyg at nicira.com> wrote:
> Any reasons to delete the directory? Directories are created during
> package install and not during software start. In this case, wouldn't
> it make more sense to re-create the directory by hand?

I take my above statement back. Looking at
/usr/share/openvswitch/scripts/ovs-lib we do create the logdir before
we start the daemon. In your case, the error at the beginning is only
related to ovs-ctl.log. So one could argue that we should fix the
problem there. But that error should not create problems with starting
ovs-vswitchd or ovsdb-server.


But your error:


start: Job failed to start
2015-09-22T09:27:41Z|00001|daemon_unix|WARN|/var/run/openvswitch/ovs-vswitchd.pid:
open: No such file or directory
ovs-appctl: cannot read pidfile
"/var/run/openvswitch/ovs-vswitchd.pid" (No such file or directory)

It looks unrelated to deleting log file directory to me.

In your second email, you don't seem to have the same error as
reported in the first email. Do you know what changed? Once you start
the service, you should see both ovs-vswitchd and ovsdb-server running
in "ps -ef | grep ovs". You should also see log files in
"/var/log/openvswitch" with the logdir created.

If you don't see the above behavior, can you tell what platform is
this? i.e Ubuntu? Rhel? etc

From pshelar at nicira.com  Fri Sep 25 16:26:57 2015
From: pshelar at nicira.com (Pravin Shelar)
Date: Fri, 25 Sep 2015 16:26:57 -0700
Subject: [ovs-discuss] memory corruption in the kernel module
In-Reply-To: <56053775.8090508@siteground.com>
References: <56053775.8090508@siteground.com>
Message-ID: <CALnjE+ruJtsT2RCjbTpbwG0cXfh7Jt2_=9aEUYHthr0Y+01+_g@mail.gmail.com>

On Fri, Sep 25, 2015 at 5:00 AM, Nikolay Borisov
<n.borisov at siteground.com> wrote:
> Hello,
>
> I'm using openvswitch on kernel 3.12.28 and опенжсвитцх 2.3.1 recently got the following warnings from the kernel:
>
> [8003509.804409] ------------[ cut here ]------------
> [8003509.804653] WARNING: CPU: 28 PID: 12584 at mm/slub.c:3318 ksize+0xbd/0xc0()
> [8003509.804880] Modules linked in: xt_REDIRECT tcp_diag inet_diag act_police cls_basic sch_ingress xt_iprange xt_multiport xt_pkttype xt_state veth openvswitch gre vxlan ip_tunnel xt_owner xt_conntrack iptable_mangle xt_nat iptable_nat nf_conntrack_ipv4 nf_defrag_ipv4 nf_nat_ipv4 nf_nat xt_CT nf_conntrack iptable_raw ib_ipoib rdma_ucm ib_ucm ib_uverbs ib_umad rdma_cm ib_cm iw_cm ib_addr ipv6 ib_sa ib_mad ib_core ext2 dm_thin_pool dm_bio_prison dm_persistent_data dm_bufio dm_mirror dm_region_hash dm_log i2c_i801 lpc_ich mfd_core ioapic ioatdma igb dca ipmi_devintf ipmi_si ipmi_msghandler megaraid_sas
> [8003509.806801] CPU: 28 PID: 12584 Comm: handler42 Not tainted 3.12.28-clouder7 #1
> [8003509.807026] Hardware name: Supermicro X9DRD-7LN4F(-JBOD)/X9DRD-EF/X9DRD-7LN4F, BIOS 3.2 01/16/2015
> [8003509.807465]  0000000000000cf6 ffff883fcfc75858 ffffffff815717b9 0000000000000cf6
> [8003509.807699]  0000000000000000 ffff883fcfc75898 ffffffff810786c2 ffff883fcfc75960
> [8003509.807932]  ffffea005264d5c0 ffff883fcfc759b0 0000000000000000 0000000000000008
> [8003509.808163] Call Trace:
> [8003509.808385]  [<ffffffff815717b9>] dump_stack+0x49/0x60
> [8003509.808611]  [<ffffffff810786c2>] warn_slowpath_common+0x82/0xb0
> [8003509.808836]  [<ffffffff81078705>] warn_slowpath_null+0x15/0x20
> [8003509.809062]  [<ffffffff8113a0dd>] ksize+0xbd/0xc0
> [8003509.809290]  [<ffffffffa0290390>] reserve_sfa_size+0x30/0xe0 [openvswitch]
> [8003509.809518]  [<ffffffffa02907a3>] validate_and_copy_actions+0x1e3/0x530 [openvswitch]
> [8003509.809748]  [<ffffffff8113c1f1>] ? __kmalloc+0x31/0x190
> [8003509.809973]  [<ffffffffa0290cc3>] ovs_packet_cmd_execute+0x1a3/0x230 [openvswitch]
> [8003509.810202]  [<ffffffff814e8d61>] genl_family_rcv_msg+0x221/0x390
> [8003509.810432]  [<ffffffff814e8ed0>] ? genl_family_rcv_msg+0x390/0x390
> [8003509.810660]  [<ffffffff814e8f2b>] genl_rcv_msg+0x5b/0xa0
> [8003509.810885]  [<ffffffff814e72b9>] netlink_rcv_skb+0x99/0xc0
> [8003509.811110]  [<ffffffff814e87d7>] genl_rcv+0x27/0x40
> [8003509.811335]  [<ffffffff814e634f>] netlink_unicast+0x10f/0x190
> [8003509.811563]  [<ffffffff814e7cf3>] netlink_sendmsg+0x2c3/0x750
> [8003509.811788]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
> [8003509.812014]  [<ffffffff814a620b>] sock_sendmsg+0x8b/0xb0
> [8003509.812239]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
> [8003509.812465]  [<ffffffff8157583b>] ? _raw_spin_lock_bh+0x1b/0x40
> [8003509.812689]  [<ffffffff81575700>] ? _raw_spin_unlock_bh+0x10/0x20
> [8003509.812916]  [<ffffffff814b3091>] ? verify_iovec+0x61/0xe0
> [8003509.813143]  [<ffffffff814a70d1>] ___sys_sendmsg+0x411/0x430
> [8003509.813373]  [<ffffffff81193ca9>] ? ep_scan_ready_list+0x189/0x1b0
> [8003509.813600]  [<ffffffff81193e2f>] ? ep_poll+0x13f/0x370
> [8003509.813825]  [<ffffffff81089c4b>] ? k_getrusage+0x13b/0x380
> [8003509.814047]  [<ffffffff814a72f4>] __sys_sendmsg+0x44/0x80
> [8003509.814268]  [<ffffffff814a7344>] SyS_sendmsg+0x14/0x20
> [8003509.819684]  [<ffffffff815763a2>] system_call_fastpath+0x16/0x1b
> [8003509.819910] ---[ end trace af1b9000d8cc8f35 ]---
>
> And almost instantly after that:
>
> [8003509.820257] ------------[ cut here ]------------
> [8003509.820480] kernel BUG at mm/slub.c:3338!
> [8003509.820699] invalid opcode: 0000 [#1] SMP
> [8003509.820922] Modules linked in: xt_REDIRECT tcp_diag inet_diag act_police cls_basic sch_ingress xt_iprange xt_multiport xt_pkttype xt_state veth openvswitch gre vxlan ip_tunnel xt_owner xt_conntrack iptable_mangle xt_nat iptable_nat nf_conntrack_ipv4 nf_defrag_ipv4 nf_nat_ipv4 nf_nat xt_CT nf_conntrack iptable_raw ib_ipoib rdma_ucm ib_ucm ib_uverbs ib_umad rdma_cm ib_cm iw_cm ib_addr ipv6 ib_sa ib_mad ib_core ext2 dm_thin_pool dm_bio_prison dm_persistent_data dm_bufio dm_mirror dm_region_hash dm_log i2c_i801 lpc_ich mfd_core ioapic ioatdma igb dca ipmi_devintf ipmi_si ipmi_msghandler megaraid_sas
> [8003509.822840] CPU: 28 PID: 12584 Comm: handler42 Tainted: G        W    3.12.28-clouder7 #1
> [8003509.823068] Hardware name: Supermicro X9DRD-7LN4F(-JBOD)/X9DRD-EF/X9DRD-7LN4F, BIOS 3.2 01/16/2015
> [8003509.823514] task: ffff883fce76dac0 ti: ffff883fcfc74000 task.ti: ffff883fcfc74000
> [8003509.823739] RIP: 0010:[<ffffffff8113a9b2>]  [<ffffffff8113a9b2>] kfree+0xe2/0xf0
> [8003509.823970] RSP: 0018:ffff883fcfc75938  EFLAGS: 00010246
> [8003509.824194] RAX: 02fc000000000824 RBX: ffff880261eb4cf0 RCX: ffff883fce76dac0
> [8003509.824423] RDX: 0000000000402140 RSI: 0000000000000000 RDI: ffff8814993577e0
> [8003509.824647] RBP: ffff883fcfc75948 R08: ffff881fffc91640 R09: ffffea005264d5c0
> [8003509.824874] R10: ffffffff814b04ca R11: 0000000000000000 R12: 0000000000000000
> [8003509.825098] R13: ffff880261eb4cf0 R14: ffff880261eb4d28 R15: ffff8818a080ec00
> [8003509.825327] FS:  00007fa9c9ffb700(0000) GS:ffff881fffc80000(0000) knlGS:0000000000000000
> [8003509.825556] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
> [8003509.825780] CR2: ffffffffff600400 CR3: 0000003fce560000 CR4: 00000000001407e0
> [8003509.826007] Stack:
> [8003509.826225]  ffff883fcfc75978 ffff880261eb4cf0 ffff883fcfc75968 ffffffffa0296c98
> [8003509.826459]  ffff883fcfc75978 ffff880261eb4cf0 ffff883fcfc75988 ffffffffa0296ce9
> [8003509.826693]  ffff8818a080ff00 ffff883fce2f3300 ffff883fcfc759e8 ffffffffa0290d2c
> [8003509.826926] Call Trace:
> [8003509.827150]  [<ffffffffa0296c98>] __flow_free+0x18/0x30 [openvswitch]
> [8003509.827377]  [<ffffffffa0296ce9>] ovs_flow_free+0x39/0x70 [openvswitch]
> [8003509.827609]  [<ffffffffa0290d2c>] ovs_packet_cmd_execute+0x20c/0x230 [openvswitch]
> [8003509.827842]  [<ffffffff814e8d61>] genl_family_rcv_msg+0x221/0x390
> [8003509.828067]  [<ffffffff814e8ed0>] ? genl_family_rcv_msg+0x390/0x390
> [8003509.828288]  [<ffffffff814e8f2b>] genl_rcv_msg+0x5b/0xa0
> [8003509.828508]  [<ffffffff814e72b9>] netlink_rcv_skb+0x99/0xc0
> [8003509.828729]  [<ffffffff814e87d7>] genl_rcv+0x27/0x40
> [8003509.828949]  [<ffffffff814e634f>] netlink_unicast+0x10f/0x190
> [8003509.829170]  [<ffffffff814e7cf3>] netlink_sendmsg+0x2c3/0x750
> [8003509.829393]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
> [8003509.829615]  [<ffffffff814a620b>] sock_sendmsg+0x8b/0xb0
> [8003509.829837]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
> [8003509.830063]  [<ffffffff8157583b>] ? _raw_spin_lock_bh+0x1b/0x40
> [8003509.830289]  [<ffffffff81575700>] ? _raw_spin_unlock_bh+0x10/0x20
> [8003509.830517]  [<ffffffff814b3091>] ? verify_iovec+0x61/0xe0
> [8003509.830742]  [<ffffffff814a70d1>] ___sys_sendmsg+0x411/0x430
> [8003509.830971]  [<ffffffff81193ca9>] ? ep_scan_ready_list+0x189/0x1b0
> [8003509.831199]  [<ffffffff81193e2f>] ? ep_poll+0x13f/0x370
> [8003509.831426]  [<ffffffff81089c4b>] ? k_getrusage+0x13b/0x380
> [8003509.831649]  [<ffffffff814a72f4>] __sys_sendmsg+0x44/0x80
> [8003509.831876]  [<ffffffff814a7344>] SyS_sendmsg+0x14/0x20
> [8003509.832102]  [<ffffffff815763a2>] system_call_fastpath+0x16/0x1b
> [8003509.832327] Code: ce 4c 89 d7 e8 f0 fc ff ff eb d6 66 41 f7 01 00 c0 74 18 49 8b 01 31 f6 f6 c4 40 74 04 41 8b 71 68 4c 89 cf e8 f0 3e fc ff eb b6 <0f> 0b eb fe 66 2e 0f 1f 84 00 00 00 00 00 55 8b 05 79 33 ab 00
> [8003509.833151] RIP  [<ffffffff8113a9b2>] kfree+0xe2/0xf0
> [8003509.833380]  RSP <ffff883fcfc75938>
> [8003509.833972] ---[ end trace af1b9000d8cc8f36 ]---
>
> It goes without saying that when this occurs the machine loses connectivity on all interface which are hooked up in an openvswitch bridge and ultimately the machine crashes. I did some review of the surrounding code, particularly in the
>
> ovs_packet_cmd_execute->validate_and_copy_actions -> copy_action -> reserve_sfa_size -> ksize call chain and it is pretty clear that the sfa pointer is indeed allocated from the heap (it's the acts in ovs_packet_cmd_execute, which is allocated in ovs_flow_actions_alloc), yet the sanity check in the kernel fails to see if this is indeed a slab allocated memory. Same thing with the second bug splat. The flow is being allocated with ovs_flow_alloc() and by the time it has to be freed it is corrupted. I can see there are a lot of calculations happening with the netlink headers and packets and frankly this is making me a bit uneasy as it seems error prone.
>
> So does any of you have experienced similar corruptions?
>

I have not seen such bug report before. Is this reproducible?

From jesse at nicira.com  Fri Sep 25 18:11:19 2015
From: jesse at nicira.com (Jesse Gross)
Date: Fri, 25 Sep 2015 18:11:19 -0700
Subject: [ovs-discuss] centos6.7_64 cannot build openswitch
In-Reply-To: <tencent_463B2A4260E2106133E101CC@qq.com>
References: <tencent_463B2A4260E2106133E101CC@qq.com>
Message-ID: <CAEP_g=8fepf6E0qkuyVCnSKHSK++PPG6pK2VuPafYe7TO28xZQ@mail.gmail.com>

On Fri, Sep 25, 2015 at 6:55 AM, 少帅 <4554916 at qq.com> wrote:
> my OS info
> uname -a
> Linux localhost.localdomain 2.6.32-573.el6.x86_64 #1 SMP Thu Jul 23 15:44:03
> UTC 2015 x86_64 x86_64 x86_64 GNU/Linux

It's true, 2.4.0 doesn't work on at least some versions of Centos 6.
If you build branch-2.4 from git then this should resolve the problem.

From davidjoshuaevans at gmail.com  Fri Sep 25 19:58:26 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Fri, 25 Sep 2015 21:58:26 -0500
Subject: [ovs-discuss] line rate traffic in dpdk & ovs rx errors and
	dead port.
In-Reply-To: <D22B38C2.71DA%diproiettod@vmware.com>
References: <D22AE05A.32467%davidjoshuaevans@gmail.com>
 <D22B38C2.71DA%diproiettod@vmware.com>
Message-ID: <CAB8HAh7Jpf7_LXt6VqQeJ-S_AsamSS7LHNR=s7791YjKJdHgeQ@mail.gmail.com>

Hi Daniele!
Thank you for your reply.
I find that it reliably starts too if i have 6 or less NIC ports.

Any more than 6 ports (even if there is only one receiving traffic) and the
one receivng traffic will just keep upping the rx_errors.

Ovs is automatically adding 11pmd's because i have a FFF mask for core
usage and it is using 10G worth of 1G hugepages. I have about 524288 9k
packet buffers on one  numa node memory. and 262K on the other.

If i have my 12 ports included, and if i wait till it has completed
starting up before sending any traffic it easily copes with at least
80+Gbps throughput. But alas if traffic is running on startup i just get
rx_errors.

On my bridge i add a drop all flow at low priority on table 3 and have
various other rules in table 0, 1 and 2 and 3 for
detection/filtering/forwarding. The problem is exacerbated if i add more
bridges and connect the dpdk ports to other bridges in the same switch.

Could it have leaked out all it's packet buffers?
Or the threads be busy wait somewhere else because of a race condition with
all those PMD's?
Maybe a thread synchronize, or quiescing issue?

Can you think of a neat way i can track thread synchronization & packet
usage?

btw i am using  ovs 2.3.2+29bae5412ea3c6a1e20d79afd25c11b968dffa05-r0

Regards,

Dave.


On Fri, Sep 25, 2015 at 11:50 AM, Daniele Di Proietto <
diproiettod at vmware.com> wrote:

> I regularly start ovs with dpdk while traffic is flowing.
>
> Is there anything suspicious in the ovs-vswitchd log?
>
> Have you tried other DPDK apps (e.g. l2fwd)?
>
>
> On 25/09/2015 17:28, "David Evans" <davidjoshuaevans at gmail.com> wrote:
>
> >Hi all,
> >
> >
> >Has anyone seen that when starting ovs (with dpdk) that the port will
> >show many rx-errors and the device will stop receiving traffic?
> >Is there a mitigation for this.
> >I have tried adding drop all flows to the bridge before all my other
> >flows are set up.
> >I have tried disabling the port rx too. But still get this behaviour when
> >starting ovs if there is traffic running to it.
> >
> >
> >Everything works fine if I have no traffic running to the dpdk port at
> >startup and initiate the traffic after the switch is steady and
> >configured.
> >
> >
> >Regards,
> >Dave.
> >
> >
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150925/b9aa2085/attachment-0001.html>

From jpettit at nicira.com  Fri Sep 25 22:45:51 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Fri, 25 Sep 2015 22:45:51 -0700
Subject: [ovs-discuss] Interconnection of subnets using OVS
In-Reply-To: <CD8BF5B6-BB86-477A-8972-4FFDF50CDCB7@yahoo.com>
References: <CD8BF5B6-BB86-477A-8972-4FFDF50CDCB7@yahoo.com>
Message-ID: <D1D50E40-4960-4F90-BE0E-4347EC713ABB@nicira.com>


> On Sep 25, 2015, at 4:08 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
> 
> Hello everyone,
> 			So I have an experimental lab setup of multiple subnets which require to have traffic forwarding between them (only in the forward and backward directions ). 
> i.e:                           Subnet1—> Subnet2 —> Subnet3   or    Subnet1 <— Subnet2 <— Subnet3 . 
> 
> The subnets are NOT connected to some router like typical network topologies. Each subnets consists of 2 hosts and and an OVS switch so that traffic can be forwarded between the subnets.
> 
> i.e       													|
> 														|
> 						Each subnet:					    OVS
> 													    /     \
> 													   /	    \
> 													h1	    h2
> 
> Now,  what is the best way to connect the OVS switches ? I was thinking of GRE tunnels (but I could be wrong), and also does the OVS GRE tunnelling have support for subnets ?  I thank you for your help :)

All of the tunnel formats that OVS supports are L2, so they don't inherently have any understanding of subnets.  In fact, neither does OVS; you'd need to program flows to handle any sort of routing.  GRE is a fine tunnel format, but so is VXLAN, STT, and Geneve.  They all have their pros and cons.  If you want to just do some testing, they'll all be about equivalent.

--Justin



From n.borisov at siteground.com  Sat Sep 26 00:39:00 2015
From: n.borisov at siteground.com (Nikolay Borisov)
Date: Sat, 26 Sep 2015 10:39:00 +0300
Subject: [ovs-discuss] memory corruption in the kernel module
In-Reply-To: <CALnjE+ruJtsT2RCjbTpbwG0cXfh7Jt2_=9aEUYHthr0Y+01+_g@mail.gmail.com>
References: <56053775.8090508@siteground.com>
 <CALnjE+ruJtsT2RCjbTpbwG0cXfh7Jt2_=9aEUYHthr0Y+01+_g@mail.gmail.com>
Message-ID: <CAJFSNy7_RymMRLpFXUURDggo3B1sO9FgUbqXyZSCa53n6J4tuA@mail.gmail.com>

So far I've only seen it once but I will keep monitoring the
situation. Unfortunately even if I observe this crash again it most
likely will be on live environment so enabling the SLUB debugging aid
would be out of the question. Do you have any ideas how to stress this
particular code path artificially ?

On Sat, Sep 26, 2015 at 2:26 AM, Pravin Shelar <pshelar at nicira.com> wrote:
> On Fri, Sep 25, 2015 at 5:00 AM, Nikolay Borisov
> <n.borisov at siteground.com> wrote:
>> Hello,
>>
>> I'm using openvswitch on kernel 3.12.28 and опенжсвитцх 2.3.1 recently got the following warnings from the kernel:
>>
>> [8003509.804409] ------------[ cut here ]------------
>> [8003509.804653] WARNING: CPU: 28 PID: 12584 at mm/slub.c:3318 ksize+0xbd/0xc0()
>> [8003509.804880] Modules linked in: xt_REDIRECT tcp_diag inet_diag act_police cls_basic sch_ingress xt_iprange xt_multiport xt_pkttype xt_state veth openvswitch gre vxlan ip_tunnel xt_owner xt_conntrack iptable_mangle xt_nat iptable_nat nf_conntrack_ipv4 nf_defrag_ipv4 nf_nat_ipv4 nf_nat xt_CT nf_conntrack iptable_raw ib_ipoib rdma_ucm ib_ucm ib_uverbs ib_umad rdma_cm ib_cm iw_cm ib_addr ipv6 ib_sa ib_mad ib_core ext2 dm_thin_pool dm_bio_prison dm_persistent_data dm_bufio dm_mirror dm_region_hash dm_log i2c_i801 lpc_ich mfd_core ioapic ioatdma igb dca ipmi_devintf ipmi_si ipmi_msghandler megaraid_sas
>> [8003509.806801] CPU: 28 PID: 12584 Comm: handler42 Not tainted 3.12.28-clouder7 #1
>> [8003509.807026] Hardware name: Supermicro X9DRD-7LN4F(-JBOD)/X9DRD-EF/X9DRD-7LN4F, BIOS 3.2 01/16/2015
>> [8003509.807465]  0000000000000cf6 ffff883fcfc75858 ffffffff815717b9 0000000000000cf6
>> [8003509.807699]  0000000000000000 ffff883fcfc75898 ffffffff810786c2 ffff883fcfc75960
>> [8003509.807932]  ffffea005264d5c0 ffff883fcfc759b0 0000000000000000 0000000000000008
>> [8003509.808163] Call Trace:
>> [8003509.808385]  [<ffffffff815717b9>] dump_stack+0x49/0x60
>> [8003509.808611]  [<ffffffff810786c2>] warn_slowpath_common+0x82/0xb0
>> [8003509.808836]  [<ffffffff81078705>] warn_slowpath_null+0x15/0x20
>> [8003509.809062]  [<ffffffff8113a0dd>] ksize+0xbd/0xc0
>> [8003509.809290]  [<ffffffffa0290390>] reserve_sfa_size+0x30/0xe0 [openvswitch]
>> [8003509.809518]  [<ffffffffa02907a3>] validate_and_copy_actions+0x1e3/0x530 [openvswitch]
>> [8003509.809748]  [<ffffffff8113c1f1>] ? __kmalloc+0x31/0x190
>> [8003509.809973]  [<ffffffffa0290cc3>] ovs_packet_cmd_execute+0x1a3/0x230 [openvswitch]
>> [8003509.810202]  [<ffffffff814e8d61>] genl_family_rcv_msg+0x221/0x390
>> [8003509.810432]  [<ffffffff814e8ed0>] ? genl_family_rcv_msg+0x390/0x390
>> [8003509.810660]  [<ffffffff814e8f2b>] genl_rcv_msg+0x5b/0xa0
>> [8003509.810885]  [<ffffffff814e72b9>] netlink_rcv_skb+0x99/0xc0
>> [8003509.811110]  [<ffffffff814e87d7>] genl_rcv+0x27/0x40
>> [8003509.811335]  [<ffffffff814e634f>] netlink_unicast+0x10f/0x190
>> [8003509.811563]  [<ffffffff814e7cf3>] netlink_sendmsg+0x2c3/0x750
>> [8003509.811788]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
>> [8003509.812014]  [<ffffffff814a620b>] sock_sendmsg+0x8b/0xb0
>> [8003509.812239]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
>> [8003509.812465]  [<ffffffff8157583b>] ? _raw_spin_lock_bh+0x1b/0x40
>> [8003509.812689]  [<ffffffff81575700>] ? _raw_spin_unlock_bh+0x10/0x20
>> [8003509.812916]  [<ffffffff814b3091>] ? verify_iovec+0x61/0xe0
>> [8003509.813143]  [<ffffffff814a70d1>] ___sys_sendmsg+0x411/0x430
>> [8003509.813373]  [<ffffffff81193ca9>] ? ep_scan_ready_list+0x189/0x1b0
>> [8003509.813600]  [<ffffffff81193e2f>] ? ep_poll+0x13f/0x370
>> [8003509.813825]  [<ffffffff81089c4b>] ? k_getrusage+0x13b/0x380
>> [8003509.814047]  [<ffffffff814a72f4>] __sys_sendmsg+0x44/0x80
>> [8003509.814268]  [<ffffffff814a7344>] SyS_sendmsg+0x14/0x20
>> [8003509.819684]  [<ffffffff815763a2>] system_call_fastpath+0x16/0x1b
>> [8003509.819910] ---[ end trace af1b9000d8cc8f35 ]---
>>
>> And almost instantly after that:
>>
>> [8003509.820257] ------------[ cut here ]------------
>> [8003509.820480] kernel BUG at mm/slub.c:3338!
>> [8003509.820699] invalid opcode: 0000 [#1] SMP
>> [8003509.820922] Modules linked in: xt_REDIRECT tcp_diag inet_diag act_police cls_basic sch_ingress xt_iprange xt_multiport xt_pkttype xt_state veth openvswitch gre vxlan ip_tunnel xt_owner xt_conntrack iptable_mangle xt_nat iptable_nat nf_conntrack_ipv4 nf_defrag_ipv4 nf_nat_ipv4 nf_nat xt_CT nf_conntrack iptable_raw ib_ipoib rdma_ucm ib_ucm ib_uverbs ib_umad rdma_cm ib_cm iw_cm ib_addr ipv6 ib_sa ib_mad ib_core ext2 dm_thin_pool dm_bio_prison dm_persistent_data dm_bufio dm_mirror dm_region_hash dm_log i2c_i801 lpc_ich mfd_core ioapic ioatdma igb dca ipmi_devintf ipmi_si ipmi_msghandler megaraid_sas
>> [8003509.822840] CPU: 28 PID: 12584 Comm: handler42 Tainted: G        W    3.12.28-clouder7 #1
>> [8003509.823068] Hardware name: Supermicro X9DRD-7LN4F(-JBOD)/X9DRD-EF/X9DRD-7LN4F, BIOS 3.2 01/16/2015
>> [8003509.823514] task: ffff883fce76dac0 ti: ffff883fcfc74000 task.ti: ffff883fcfc74000
>> [8003509.823739] RIP: 0010:[<ffffffff8113a9b2>]  [<ffffffff8113a9b2>] kfree+0xe2/0xf0
>> [8003509.823970] RSP: 0018:ffff883fcfc75938  EFLAGS: 00010246
>> [8003509.824194] RAX: 02fc000000000824 RBX: ffff880261eb4cf0 RCX: ffff883fce76dac0
>> [8003509.824423] RDX: 0000000000402140 RSI: 0000000000000000 RDI: ffff8814993577e0
>> [8003509.824647] RBP: ffff883fcfc75948 R08: ffff881fffc91640 R09: ffffea005264d5c0
>> [8003509.824874] R10: ffffffff814b04ca R11: 0000000000000000 R12: 0000000000000000
>> [8003509.825098] R13: ffff880261eb4cf0 R14: ffff880261eb4d28 R15: ffff8818a080ec00
>> [8003509.825327] FS:  00007fa9c9ffb700(0000) GS:ffff881fffc80000(0000) knlGS:0000000000000000
>> [8003509.825556] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
>> [8003509.825780] CR2: ffffffffff600400 CR3: 0000003fce560000 CR4: 00000000001407e0
>> [8003509.826007] Stack:
>> [8003509.826225]  ffff883fcfc75978 ffff880261eb4cf0 ffff883fcfc75968 ffffffffa0296c98
>> [8003509.826459]  ffff883fcfc75978 ffff880261eb4cf0 ffff883fcfc75988 ffffffffa0296ce9
>> [8003509.826693]  ffff8818a080ff00 ffff883fce2f3300 ffff883fcfc759e8 ffffffffa0290d2c
>> [8003509.826926] Call Trace:
>> [8003509.827150]  [<ffffffffa0296c98>] __flow_free+0x18/0x30 [openvswitch]
>> [8003509.827377]  [<ffffffffa0296ce9>] ovs_flow_free+0x39/0x70 [openvswitch]
>> [8003509.827609]  [<ffffffffa0290d2c>] ovs_packet_cmd_execute+0x20c/0x230 [openvswitch]
>> [8003509.827842]  [<ffffffff814e8d61>] genl_family_rcv_msg+0x221/0x390
>> [8003509.828067]  [<ffffffff814e8ed0>] ? genl_family_rcv_msg+0x390/0x390
>> [8003509.828288]  [<ffffffff814e8f2b>] genl_rcv_msg+0x5b/0xa0
>> [8003509.828508]  [<ffffffff814e72b9>] netlink_rcv_skb+0x99/0xc0
>> [8003509.828729]  [<ffffffff814e87d7>] genl_rcv+0x27/0x40
>> [8003509.828949]  [<ffffffff814e634f>] netlink_unicast+0x10f/0x190
>> [8003509.829170]  [<ffffffff814e7cf3>] netlink_sendmsg+0x2c3/0x750
>> [8003509.829393]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
>> [8003509.829615]  [<ffffffff814a620b>] sock_sendmsg+0x8b/0xb0
>> [8003509.829837]  [<ffffffff811666e0>] ? __pollwait+0xf0/0xf0
>> [8003509.830063]  [<ffffffff8157583b>] ? _raw_spin_lock_bh+0x1b/0x40
>> [8003509.830289]  [<ffffffff81575700>] ? _raw_spin_unlock_bh+0x10/0x20
>> [8003509.830517]  [<ffffffff814b3091>] ? verify_iovec+0x61/0xe0
>> [8003509.830742]  [<ffffffff814a70d1>] ___sys_sendmsg+0x411/0x430
>> [8003509.830971]  [<ffffffff81193ca9>] ? ep_scan_ready_list+0x189/0x1b0
>> [8003509.831199]  [<ffffffff81193e2f>] ? ep_poll+0x13f/0x370
>> [8003509.831426]  [<ffffffff81089c4b>] ? k_getrusage+0x13b/0x380
>> [8003509.831649]  [<ffffffff814a72f4>] __sys_sendmsg+0x44/0x80
>> [8003509.831876]  [<ffffffff814a7344>] SyS_sendmsg+0x14/0x20
>> [8003509.832102]  [<ffffffff815763a2>] system_call_fastpath+0x16/0x1b
>> [8003509.832327] Code: ce 4c 89 d7 e8 f0 fc ff ff eb d6 66 41 f7 01 00 c0 74 18 49 8b 01 31 f6 f6 c4 40 74 04 41 8b 71 68 4c 89 cf e8 f0 3e fc ff eb b6 <0f> 0b eb fe 66 2e 0f 1f 84 00 00 00 00 00 55 8b 05 79 33 ab 00
>> [8003509.833151] RIP  [<ffffffff8113a9b2>] kfree+0xe2/0xf0
>> [8003509.833380]  RSP <ffff883fcfc75938>
>> [8003509.833972] ---[ end trace af1b9000d8cc8f36 ]---
>>
>> It goes without saying that when this occurs the machine loses connectivity on all interface which are hooked up in an openvswitch bridge and ultimately the machine crashes. I did some review of the surrounding code, particularly in the
>>
>> ovs_packet_cmd_execute->validate_and_copy_actions -> copy_action -> reserve_sfa_size -> ksize call chain and it is pretty clear that the sfa pointer is indeed allocated from the heap (it's the acts in ovs_packet_cmd_execute, which is allocated in ovs_flow_actions_alloc), yet the sanity check in the kernel fails to see if this is indeed a slab allocated memory. Same thing with the second bug splat. The flow is being allocated with ovs_flow_alloc() and by the time it has to be freed it is corrupted. I can see there are a lot of calculations happening with the netlink headers and packets and frankly this is making me a bit uneasy as it seems error prone.
>>
>> So does any of you have experienced similar corruptions?
>>
>
> I have not seen such bug report before. Is this reproducible?

From jpettit at nicira.com  Sat Sep 26 11:26:57 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Sat, 26 Sep 2015 11:26:57 -0700
Subject: [ovs-discuss] Interconnection of subnets using OVS
In-Reply-To: <063D29B0-64A8-48F3-82E5-936F60D85A92@yahoo.com>
References: <CD8BF5B6-BB86-477A-8972-4FFDF50CDCB7@yahoo.com>
 <D1D50E40-4960-4F90-BE0E-4347EC713ABB@nicira.com>
 <063D29B0-64A8-48F3-82E5-936F60D85A92@yahoo.com>
Message-ID: <CD3F883E-F295-49DF-B31F-F862662D1EE8@nicira.com>


> On Sep 26, 2015, at 1:09 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
> 
> Thanks for the quick reply Justin. Can I use port mirroring for the job?  What would you suggest.

Please don't drop the list.

If you want to interconnect networks, I don't think mirroring is what you want.  Mirroring is for sending a copy of traffic for some collector--usually for off-box analysis.  For testing, I would probably use vxlan or geneve (if it's available on your platform), since those will have the best performance characteristics with the fewest caveats if you later want to run it in production.  As I mentioned, though, any of the tunneling mechanisms are fine for testing.

--Justin



From davidjoshuaevans at gmail.com  Sat Sep 26 13:04:31 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Sat, 26 Sep 2015 15:04:31 -0500
Subject: [ovs-discuss] line rate traffic in dpdk & ovs rx errors and
	dead port.
In-Reply-To: <CAB8HAh52P_hkXKBOEzHJVP4MpLW39o824jbpX21NzX_Ed3AyBQ@mail.gmail.com>
References: <D22AE05A.32467%davidjoshuaevans@gmail.com>
 <D22B38C2.71DA%diproiettod@vmware.com>
 <CAB8HAh7Jpf7_LXt6VqQeJ-S_AsamSS7LHNR=s7791YjKJdHgeQ@mail.gmail.com>
 <CAB8HAh52P_hkXKBOEzHJVP4MpLW39o824jbpX21NzX_Ed3AyBQ@mail.gmail.com>
Message-ID: <CAB8HAh7hyoxr-8c6snwiYZKNGopbz83CttC8cuFdJ3ek_bNZkw@mail.gmail.com>

Hi Daniele,

I have a way to mitigate the problem by stopping  rte_eth_rx_burst until
all the rules have settled. I do this with an options: argument in
other_config (amongst other arguments using this free form field - like
dedup and defrag features i am experimenting with) My rules are static so
this is ok for me to drop packets while rules are all being added as
configuration is an infrequent event for my implementation.

but occasionally after setting port options on a netdev using pmd328 via
ovsdb 'options' in other_config i get:
2015-09-26T19:41:14.186Z|00297|ovs_rcu|WARN|blocked 1000 ms waiting for
pmd327 to quiesce
from which it never recovers but exponentially backs off waiting.

Cheers,
Dave

On Fri, Sep 25, 2015 at 10:17 PM, David Evans <davidjoshuaevans at gmail.com>
wrote:

> yes i suspect a packet leak.
> As the drop count when it stops is usually about 520K packets. :(
> Where do i start looking in the source for that kind of symptom?
>
> On Fri, Sep 25, 2015 at 9:58 PM, David Evans <davidjoshuaevans at gmail.com>
> wrote:
>
>> Hi Daniele!
>> Thank you for your reply.
>> I find that it reliably starts too if i have 6 or less NIC ports.
>>
>> Any more than 6 ports (even if there is only one receiving traffic) and
>> the one receivng traffic will just keep upping the rx_errors.
>>
>> Ovs is automatically adding 11pmd's because i have a FFF mask for core
>> usage and it is using 10G worth of 1G hugepages. I have about 524288 9k
>> packet buffers on one  numa node memory. and 262K on the other.
>>
>> If i have my 12 ports included, and if i wait till it has completed
>> starting up before sending any traffic it easily copes with at least
>> 80+Gbps throughput. But alas if traffic is running on startup i just get
>> rx_errors.
>>
>> On my bridge i add a drop all flow at low priority on table 3 and have
>> various other rules in table 0, 1 and 2 and 3 for
>> detection/filtering/forwarding. The problem is exacerbated if i add more
>> bridges and connect the dpdk ports to other bridges in the same switch.
>>
>> Could it have leaked out all it's packet buffers?
>> Or the threads be busy wait somewhere else because of a race condition
>> with all those PMD's?
>> Maybe a thread synchronize, or quiescing issue?
>>
>> Can you think of a neat way i can track thread synchronization & packet
>> usage?
>>
>> btw i am using  ovs 2.3.2+29bae5412ea3c6a1e20d79afd25c11b968dffa05-r0
>>
>> Regards,
>>
>> Dave.
>>
>>
>> On Fri, Sep 25, 2015 at 11:50 AM, Daniele Di Proietto <
>> diproiettod at vmware.com> wrote:
>>
>>> I regularly start ovs with dpdk while traffic is flowing.
>>>
>>> Is there anything suspicious in the ovs-vswitchd log?
>>>
>>> Have you tried other DPDK apps (e.g. l2fwd)?
>>>
>>>
>>> On 25/09/2015 17:28, "David Evans" <davidjoshuaevans at gmail.com> wrote:
>>>
>>> >Hi all,
>>> >
>>> >
>>> >Has anyone seen that when starting ovs (with dpdk) that the port will
>>> >show many rx-errors and the device will stop receiving traffic?
>>> >Is there a mitigation for this.
>>> >I have tried adding drop all flows to the bridge before all my other
>>> >flows are set up.
>>> >I have tried disabling the port rx too. But still get this behaviour
>>> when
>>> >starting ovs if there is traffic running to it.
>>> >
>>> >
>>> >Everything works fine if I have no traffic running to the dpdk port at
>>> >startup and initiate the traffic after the switch is steady and
>>> >configured.
>>> >
>>> >
>>> >Regards,
>>> >Dave.
>>> >
>>> >
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150926/bd83680d/attachment.html>

From jpettit at nicira.com  Sat Sep 26 13:56:37 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Sat, 26 Sep 2015 13:56:37 -0700
Subject: [ovs-discuss] Interconnection of subnets using OVS
In-Reply-To: <C4E94548-A678-49FA-893D-8EF170C5657B@yahoo.com>
References: <CD8BF5B6-BB86-477A-8972-4FFDF50CDCB7@yahoo.com>
 <D1D50E40-4960-4F90-BE0E-4347EC713ABB@nicira.com>
 <063D29B0-64A8-48F3-82E5-936F60D85A92@yahoo.com>
 <CD3F883E-F295-49DF-B31F-F862662D1EE8@nicira.com>
 <C4E94548-A678-49FA-893D-8EF170C5657B@yahoo.com>
Message-ID: <C938082E-9E50-4FA1-8654-49EBCBBB1337@nicira.com>


> On Sep 26, 2015, at 11:47 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
> 
> Ok thanks Justin. I’m also using a controller connected to the switch. So an l3_learning module controller should be sufficient of the routing right?  

I don't know what module that is, but it sounds likely. 

> Anyways I’ll try vxlan or GRE for tunnelling since I haven’t heard of geneve . Thanks for your help :)

No problem. Good luck!

--Justin



From xiaolia at cisco.com  Sun Sep 27 21:52:01 2015
From: xiaolia at cisco.com (Xiao Liang (xiaolia))
Date: Mon, 28 Sep 2015 04:52:01 +0000
Subject: [ovs-discuss] Negative match a field?
In-Reply-To: <20150925052308.GA10652@nicira.com>
References: <d8fd30fecf3943c3beba6eea4a909bf9@XCH-RCD-014.cisco.com>
 <20150925052308.GA10652@nicira.com>
Message-ID: <d336e03ed4c741ebb7aa3298d4087e2c@XCH-RCD-014.cisco.com>

Thanks, Ben. The exception flow match should be:
in_port=1, dl_src=A
in_port=2, dl_src=B

It will still result in many flows when combined with more match fields. Is it possible to add negative match support in OpenFlow or as an extension?

Thanks,
Xiao

> -----Original Message-----
> From: Ben Pfaff [mailto:blp at nicira.com]
> Sent: Friday, September 25, 2015 13:23
> To: Xiao Liang (xiaolia)
> Cc: discuss at openvswitch.org
> Subject: Re: [ovs-discuss] Negative match a field?
> 
> On Fri, Sep 25, 2015 at 02:39:20AM +0000, Xiao Liang (xiaolia) wrote:
> > I want to apply actions on all packets except those with a certain
> > source MAC address. For example in_port=1, dl_src!=MAC_A,
> > actions=output:2 in_port=2, dl_src!=MAC_B, actions=output:1
> > priority=0, action=drop
> >
> > Is there easy way to do this?
> 
> Ideally, you use high-priority flows to match the exceptions, and then put the
> common case into a lower-priority flow, like this:
> 
>         dl_src=A, priority=100, actions=...
>         dl_src=B, priority=100, actions=...
>         priority=0, actions=...
> 
> If you really can't do that, then you can use 48 flows to match all the possible
> source MAC addresses that do not equal a given MAC, one for each possible
> bit that could differ.  It's a pretty bad solution because it uses a lot of flows
> and has a high cost at runtime.

From mehtaneeraj07 at gmail.com  Mon Sep 28 02:12:01 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Mon, 28 Sep 2015 14:42:01 +0530
Subject: [ovs-discuss] Matcthing parameters for exact flow entry for
 particular packet
In-Reply-To: <20150924222044.GB6644@nicira.com>
References: <CAHN905Kyvpoue1BKtSA5qpC7a-11n9cEKnTHTk3rG=S9jY53mw@mail.gmail.com>
 <20150924222044.GB6644@nicira.com>
Message-ID: <CAHN905KcHPgK18Ddff1zv25g-zfRUUbabOETkFbcaw8kLLEzGA@mail.gmail.com>

Hello Ben,

> What's your motivation?

I want to check the packet hit over a flow entry. For example I have two
flow entries as below

priority=10,dl_src=00:00:11:22:33:44, dl_dst=00:00:00:33:44:55
dl_type=0x0800 nw_proto=6 actions=2
priority=10,dl_src=00:00:11:22:33:44, dl_dst=00:00:00:33:44:55 dl_type=*
nw_proto=* actions=drop

Which flow entry should hit first? If I send TCP packet with same matching
fields.

Regards
Neeraj

On Fri, Sep 25, 2015 at 3:50 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Fri, Sep 25, 2015 at 01:03:51AM +0530, neeraj mehta wrote:
> > I am working on OVS-2.3.2. I want to add flow entries for exact match for
> > the packets. Is there is any documentation that I can consult to get the
> > information about tuples(flow entry matching parameters) needed to create
> > an exact flow entry for particular type of packet packet.
>
> It doesn't really make sense to talk about "exact match" these days.
> What's your motivation?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150928/97000e3d/attachment.html>

From dev_raj82 at yahoo.com  Sat Sep 26 11:47:02 2015
From: dev_raj82 at yahoo.com (Nishanth Devarajan)
Date: Sun, 27 Sep 2015 00:17:02 +0530
Subject: [ovs-discuss] Interconnection of subnets using OVS
In-Reply-To: <CD3F883E-F295-49DF-B31F-F862662D1EE8@nicira.com>
References: <CD8BF5B6-BB86-477A-8972-4FFDF50CDCB7@yahoo.com>
 <D1D50E40-4960-4F90-BE0E-4347EC713ABB@nicira.com>
 <063D29B0-64A8-48F3-82E5-936F60D85A92@yahoo.com>
 <CD3F883E-F295-49DF-B31F-F862662D1EE8@nicira.com>
Message-ID: <C4E94548-A678-49FA-893D-8EF170C5657B@yahoo.com>

Ok thanks Justin. I’m also using a controller connected to the switch. So an l3_learning module controller should be sufficient of the routing right?  Anyways I’ll try vxlan or GRE for tunnelling since I haven’t heard of geneve . Thanks for your help :)
 
Nishanth 
> On 26-Sep-2015, at 11:56 pm, Justin Pettit <jpettit at nicira.com> wrote:
> 
> 
>> On Sep 26, 2015, at 1:09 AM, Nishanth Devarajan <dev_raj82 at yahoo.com> wrote:
>> 
>> Thanks for the quick reply Justin. Can I use port mirroring for the job?  What would you suggest.
> 
> Please don't drop the list.
> 
> If you want to interconnect networks, I don't think mirroring is what you want.  Mirroring is for sending a copy of traffic for some collector--usually for off-box analysis.  For testing, I would probably use vxlan or geneve (if it's available on your platform), since those will have the best performance characteristics with the fewest caveats if you later want to run it in production.  As I mentioned, though, any of the tunneling mechanisms are fine for testing.
> 
> --Justin
> 
> 


From zhaojun12 at outlook.com  Mon Sep 28 01:01:27 2015
From: zhaojun12 at outlook.com (=?gb2312?B?v6Eg1dQ=?=)
Date: Mon, 28 Sep 2015 16:01:27 +0800
Subject: [ovs-discuss] Openvswitch and OpenDaylight integration failed
Message-ID: <BAY172-W429D28C7768408FC7C3317B24F0@phx.gbl>

Hi all,
I have two questions.
First,

I install opendaylight lithium and install several features listed as follows
opendaylight-user at root>feature:install odl-restconfopendaylight-user at root>feature:install odl-openflowplugin-allopendaylight-user at root>feature:install odl-mdsal-apidocsopendaylight-user at root>feature:install odl-dlux-allopendaylight-user at root>feature:install odl-adsal-northbound
I also have a VM running openvswitch. The VM has only one port called eth0, and I create a bridge called s1, I add port eth0 to s1.Now I can use ssh to connect to my VM.But as soon as I set openvswitch's controller to opendaylight, I lose ssh connection with my VM!
I do not know why? 
Second,
My VM has only one port eth0, and I create a bridge s1. I set its controller to opendaylight.
If I donot attach eth0 to s1, can I add flow rules to control traffic going through port eth0?
Thanks

Zhao Jun 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150928/3c7a3059/attachment-0001.html>

From jpettit at nicira.com  Mon Sep 28 09:31:20 2015
From: jpettit at nicira.com (Justin Pettit)
Date: Mon, 28 Sep 2015 09:31:20 -0700
Subject: [ovs-discuss] Openvswitch and OpenDaylight integration failed
In-Reply-To: <BAY172-W429D28C7768408FC7C3317B24F0@phx.gbl>
References: <BAY172-W429D28C7768408FC7C3317B24F0@phx.gbl>
Message-ID: <AD26C38A-4250-4EB1-A056-83075BED4859@nicira.com>


> On Sep 28, 2015, at 1:01 AM, 俊 赵 <zhaojun12 at outlook.com> wrote:
> 
> 
> I also have a VM running openvswitch. The VM has only one port called eth0, and I create a bridge called s1, I add port eth0 to s1.
> 
> Now I can use ssh to connect to my VM.
> 
> But as soon as I set openvswitch's controller to opendaylight, I lose ssh connection with my VM!

OpenDaylight is probably dumping the flows that allow the SSH connectivity.  Since OVS is just doing what ODL tells it, I think you'll have better luck asking followup questions on an ODL list.

> My VM has only one port eth0, and I create a bridge s1. I set its controller to opendaylight.
> 
> If I donot attach eth0 to s1, can I add flow rules to control traffic going through port eth0?

What do you have in mind?  If you generate traffic that goes through the Linux hypervisor's IP stack (e.g., sending traffic out a tunnel), you have control over what s1 can send, but you won't have control over eth0 directly.  I don't think that's exactly what you're suggesting, though, so the answer is probably no.

--Justin



From diproiettod at vmware.com  Mon Sep 28 11:16:57 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Mon, 28 Sep 2015 18:16:57 +0000
Subject: [ovs-discuss] line rate traffic in dpdk & ovs rx errors and
 dead port.
In-Reply-To: <CAB8HAh7hyoxr-8c6snwiYZKNGopbz83CttC8cuFdJ3ek_bNZkw@mail.gmail.com>
References: <D22AE05A.32467%davidjoshuaevans@gmail.com>
 <D22B38C2.71DA%diproiettod@vmware.com>
 <CAB8HAh7Jpf7_LXt6VqQeJ-S_AsamSS7LHNR=s7791YjKJdHgeQ@mail.gmail.com>
 <CAB8HAh52P_hkXKBOEzHJVP4MpLW39o824jbpX21NzX_Ed3AyBQ@mail.gmail.com>
 <CAB8HAh7hyoxr-8c6snwiYZKNGopbz83CttC8cuFdJ3ek_bNZkw@mail.gmail.com>
Message-ID: <D22F3E9D.726E%diproiettod@vmware.com>

First of all I would update to OVS 2.4 or master.

That said, the first issue you're facing might be related to a
packet leak (I suspect in the code that moves the packets to the
slow path). You could check the hit/miss counters with
`ovs-appctl dpif/show` (we added ovs-appctl dpif-netdev/pmd-stats-show
in 2.4, which gives per pmd thread statistics).

I'm not sure about the second problem, but I would suggest again strongly
to update to a more recent version.

Thanks,

Daniele

On 26/09/2015 21:04, "David Evans" <davidjoshuaevans at gmail.com> wrote:

>Hi Daniele,
>
>
>I have a way to mitigate the problem by stopping  rte_eth_rx_burst until
>all the rules have settled. I do this with an options: argument in
>other_config (amongst other arguments using this free form field - like
>dedup and defrag features i am experimenting
> with) My rules are static so this is ok for me to drop packets while
>rules are all being added as configuration is an infrequent event for my
>implementation.
>
>
>but occasionally after setting port options on a netdev using pmd328 via
>ovsdb 'options' in other_config i get:
>2015-09-26T19:41:14.186Z|00297|ovs_rcu|WARN|blocked 1000 ms waiting for
>pmd327 to quiesce
>
>
>from which it never recovers but exponentially backs off waiting.
>
>
>
>
>Cheers,
>Dave
>
>
>On Fri, Sep 25, 2015 at 10:17 PM, David Evans
><davidjoshuaevans at gmail.com> wrote:
>
>yes i suspect a packet leak.
>As the drop count when it stops is usually about 520K packets. :(
>Where do i start looking in the source for that kind of symptom?
>
>
>On Fri, Sep 25, 2015 at 9:58 PM, David Evans
><davidjoshuaevans at gmail.com> wrote:
>
>Hi Daniele!
>Thank you for your reply.
>I find that it reliably starts too if i have 6 or less NIC ports.
>
>
>Any more than 6 ports (even if there is only one receiving traffic) and
>the one receivng traffic will just keep upping the rx_errors.
>
>
>
>Ovs is automatically adding 11pmd's because i have a FFF mask for core
>usage and it is using 10G worth of 1G hugepages. I have about 524288 9k
>packet buffers on one  numa node memory. and 262K on the other.
>
>
>If i have my 12 ports included, and if i wait till it has completed
>starting up before sending any traffic it easily copes with at least
>80+Gbps throughput. But alas if traffic is running on startup i just get
>rx_errors.
>
>
>On my bridge i add a drop all flow at low priority on table 3 and have
>various other rules in table 0, 1 and 2 and 3 for
>detection/filtering/forwarding. The problem is exacerbated if i add more
>bridges and connect the dpdk ports to other bridges in the
> same switch.
>
>
>Could it have leaked out all it's packet buffers?
>Or the threads be busy wait somewhere else because of a race condition
>with all those PMD's?
>Maybe a thread synchronize, or quiescing issue?
>
>
>Can you think of a neat way i can track thread synchronization & packet
>usage?
>
>
>btw i am using  ovs 2.3.2+29bae5412ea3c6a1e20d79afd25c11b968dffa05-r0
>
>
>Regards,
>
>
>Dave.
> 
>
>
>On Fri, Sep 25, 2015 at 11:50 AM, Daniele Di Proietto
><diproiettod at vmware.com> wrote:
>
>I regularly start ovs with dpdk while traffic is flowing.
>
>Is there anything suspicious in the ovs-vswitchd log?
>
>Have you tried other DPDK apps (e.g. l2fwd)?
>
>
>On 25/09/2015 17:28, "David Evans" <davidjoshuaevans at gmail.com> wrote:
>
>>Hi all,
>>
>>
>>Has anyone seen that when starting ovs (with dpdk) that the port will
>>show many rx-errors and the device will stop receiving traffic?
>>Is there a mitigation for this.
>>I have tried adding drop all flows to the bridge before all my other
>>flows are set up.
>>I have tried disabling the port rx too. But still get this behaviour when
>>starting ovs if there is traffic running to it.
>>
>>
>>Everything works fine if I have no traffic running to the dpdk port at
>>startup and initiate the traffic after the switch is steady and
>>configured.
>>
>>
>>Regards,
>>Dave.
>>
>>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>


From wuhao.thu at gmail.com  Mon Sep 28 20:12:17 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Tue, 29 Sep 2015 11:12:17 +0800
Subject: [ovs-discuss] Does a megaflow cantain wildcard bits in OVS cache?
Message-ID: <CAHmvmjGoi0HQu296Ds6u8zP_y7L+vRMiNdrLh88VkNPPJ2WMfg@mail.gmail.com>

Hi all,

   In OVS NSDI'15 paper, it mentions there is a new megaflow cache in the
kernel space. I think it is an active subset of the flow table in user
space. Does a megaflow entry contain any wildcard bits?

thanks.

+++++++++++++++++
Best,
Hao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/9a17aef6/attachment.html>

From blp at nicira.com  Mon Sep 28 20:16:52 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 28 Sep 2015 20:16:52 -0700
Subject: [ovs-discuss] Does a megaflow cantain wildcard bits in OVS
	cache?
In-Reply-To: <CAHmvmjGoi0HQu296Ds6u8zP_y7L+vRMiNdrLh88VkNPPJ2WMfg@mail.gmail.com>
References: <CAHmvmjGoi0HQu296Ds6u8zP_y7L+vRMiNdrLh88VkNPPJ2WMfg@mail.gmail.com>
Message-ID: <20150929031652.GA29366@nicira.com>

On Tue, Sep 29, 2015 at 11:12:17AM +0800, Hao Wu wrote:
>    In OVS NSDI'15 paper, it mentions there is a new megaflow cache in the
> kernel space. I think it is an active subset of the flow table in user
> space. Does a megaflow entry contain any wildcard bits?

Yes.

From blp at nicira.com  Mon Sep 28 20:28:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 28 Sep 2015 20:28:42 -0700
Subject: [ovs-discuss] Negative match a field?
In-Reply-To: <d336e03ed4c741ebb7aa3298d4087e2c@XCH-RCD-014.cisco.com>
References: <d8fd30fecf3943c3beba6eea4a909bf9@XCH-RCD-014.cisco.com>
 <20150925052308.GA10652@nicira.com>
 <d336e03ed4c741ebb7aa3298d4087e2c@XCH-RCD-014.cisco.com>
Message-ID: <20150929032842.GC29366@nicira.com>

On Mon, Sep 28, 2015 at 04:52:01AM +0000, Xiao Liang (xiaolia) wrote:
> Is it possible to add negative match support in OpenFlow or as an
> extension?

The main problem is to design an efficient implementation of negative
match in the classifier.  I don't know a way to do it in a general way.

From wuhao.thu at gmail.com  Mon Sep 28 20:33:15 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Tue, 29 Sep 2015 11:33:15 +0800
Subject: [ovs-discuss] Does a megaflow cantain wildcard bits in OVS
	cache?
In-Reply-To: <20150929031652.GA29366@nicira.com>
References: <CAHmvmjGoi0HQu296Ds6u8zP_y7L+vRMiNdrLh88VkNPPJ2WMfg@mail.gmail.com>
 <20150929031652.GA29366@nicira.com>
Message-ID: <CAHmvmjHKKR+WOSNJs0o_U5HbqoOn_9-0sqj6huzzBB7Z1v+1DQ@mail.gmail.com>

Hi Ben,

  I think each megaflow table is built according to a certain tuple
consisting of fields. If we don't care some bits in the packet, we won't
select them in the matching tuple, so why we still need the wildcard bits?

+++++++++++++++++
Best,
Hao

On Tue, Sep 29, 2015 at 11:16 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Sep 29, 2015 at 11:12:17AM +0800, Hao Wu wrote:
> >    In OVS NSDI'15 paper, it mentions there is a new megaflow cache in the
> > kernel space. I think it is an active subset of the flow table in user
> > space. Does a megaflow entry contain any wildcard bits?
>
> Yes.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/8448e3a4/attachment.html>

From blp at nicira.com  Mon Sep 28 20:34:34 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 28 Sep 2015 20:34:34 -0700
Subject: [ovs-discuss] Does a megaflow cantain wildcard bits in OVS
	cache?
In-Reply-To: <CAHmvmjHKKR+WOSNJs0o_U5HbqoOn_9-0sqj6huzzBB7Z1v+1DQ@mail.gmail.com>
References: <CAHmvmjGoi0HQu296Ds6u8zP_y7L+vRMiNdrLh88VkNPPJ2WMfg@mail.gmail.com>
 <20150929031652.GA29366@nicira.com>
 <CAHmvmjHKKR+WOSNJs0o_U5HbqoOn_9-0sqj6huzzBB7Z1v+1DQ@mail.gmail.com>
Message-ID: <20150929033434.GD29366@nicira.com>

On Tue, Sep 29, 2015 at 11:33:15AM +0800, Hao Wu wrote:
>   I think each megaflow table is built according to a certain tuple
> consisting of fields. If we don't care some bits in the packet, we won't
> select them in the matching tuple, so why we still need the wildcard bits?

Which bits a flow matches must be tracked somehow.

From wuhao.thu at gmail.com  Mon Sep 28 20:38:02 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Tue, 29 Sep 2015 11:38:02 +0800
Subject: [ovs-discuss] Does a megaflow cantain wildcard bits in OVS
	cache?
In-Reply-To: <20150929033434.GD29366@nicira.com>
References: <CAHmvmjGoi0HQu296Ds6u8zP_y7L+vRMiNdrLh88VkNPPJ2WMfg@mail.gmail.com>
 <20150929031652.GA29366@nicira.com>
 <CAHmvmjHKKR+WOSNJs0o_U5HbqoOn_9-0sqj6huzzBB7Z1v+1DQ@mail.gmail.com>
 <20150929033434.GD29366@nicira.com>
Message-ID: <CAHmvmjF0SdAXgirFyuVkAAiGiMUSJ3HyEq9si9ZuWndGn2sKCQ@mail.gmail.com>

I see. thanks.

+++++++++++++++++
Best,
Hao

On Tue, Sep 29, 2015 at 11:34 AM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Sep 29, 2015 at 11:33:15AM +0800, Hao Wu wrote:
> >   I think each megaflow table is built according to a certain tuple
> > consisting of fields. If we don't care some bits in the packet, we won't
> > select them in the matching tuple, so why we still need the wildcard
> bits?
>
> Which bits a flow matches must be tracked somehow.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/5ea21e23/attachment-0001.html>

From blp at nicira.com  Mon Sep 28 21:13:53 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 28 Sep 2015 21:13:53 -0700
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
Message-ID: <20150929041353.GF29366@nicira.com>

On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
> (gdb) frame 0
> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,

Thanks for the report.

Jarno and Daniele, the code around line 2278 in v2.4.0 is this:

        if (rstp_shift_root_learned_address(ofproto->rstp)) {
            bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
                        ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
            rstp_reset_root_changed(ofproto->rstp);
        }

Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' and
'new_root_aux'.  I don't see any code that clears them or updates them
if something happens to invalidate them (that is, if a port gets deleted
or if its aux gets updated).  I suspect that this may be the problem
here.

Jarno or Daniele, can you confirm this?

From blp at nicira.com  Mon Sep 28 21:15:50 2015
From: blp at nicira.com (Ben Pfaff)
Date: Mon, 28 Sep 2015 21:15:50 -0700
Subject: [ovs-discuss] OF Group Tables Load Balancing
In-Reply-To: <5602F95E.50505@gmail.com>
References: <5602F95E.50505@gmail.com>
Message-ID: <20150929041550.GG29366@nicira.com>

On Wed, Sep 23, 2015 at 09:11:26PM +0200, Daniel Herrmann wrote:
> I am trying to load-balance traffic in a routed scenario and want to use
> OF group tables for this.
> 
> However, it seems that only one bucket is selected. I found some thread
> from mid 2014, which states that only eth_dst is used for matching:

See selection_method, selection_method_param, and fields in
ovs-ofctl(8), in OVS 2.4.0 and later.

From er.manpreet25 at gmail.com  Mon Sep 28 22:38:23 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Tue, 29 Sep 2015 11:08:23 +0530
Subject: [ovs-discuss] packet_out message
Message-ID: <CALD=K8tuNjwEBynJWCS7+kUJMTPrYU2rEOf4QjQthLGVkRAMig@mail.gmail.com>

Hi All,

In packet_out message when we specify the OFPP_TABLE reserved port as an
output action, then actions are perform in flow tables on packet.

There are 254 tables, my question is that who's actions will be perform on
it out of 254.


Regards,
Manpreet Singh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/dbfe59bb/attachment.html>

From wuhao.thu at gmail.com  Tue Sep 29 00:42:42 2015
From: wuhao.thu at gmail.com (Hao Wu)
Date: Tue, 29 Sep 2015 15:42:42 +0800
Subject: [ovs-discuss] Can controller install flows into OVS in the
	proactive mode?
Message-ID: <CAHmvmjETL_Bx6F-S75-axKUgUyPa0Pp3hFr8CM=zds8=MyVrPA@mail.gmail.com>

Hi,

   In common reactive mode, when a new packet comes in ovs, it will send
packet_in msg to controller to get the new flow installed. I want to know
can controller install flows into ovs without the triggering of new
packets? namely, in a proactive way? If so, how to configure ovs to do that
?

thanks.

+++++++++++++++++
Best,
Hao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/de483d72/attachment.html>

From blp at nicira.com  Tue Sep 29 08:17:59 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 29 Sep 2015 08:17:59 -0700
Subject: [ovs-discuss] Can controller install flows into OVS in the
 proactive mode?
In-Reply-To: <CAHmvmjETL_Bx6F-S75-axKUgUyPa0Pp3hFr8CM=zds8=MyVrPA@mail.gmail.com>
References: <CAHmvmjETL_Bx6F-S75-axKUgUyPa0Pp3hFr8CM=zds8=MyVrPA@mail.gmail.com>
Message-ID: <20150929151759.GC29566@nicira.com>

On Tue, Sep 29, 2015 at 03:42:42PM +0800, Hao Wu wrote:
>    In common reactive mode, when a new packet comes in ovs, it will send
> packet_in msg to controller to get the new flow installed. I want to know
> can controller install flows into ovs without the triggering of new
> packets? namely, in a proactive way? 

Yes.

> If so, how to configure ovs to do that ?

No configuration is needed.

From takahashi.minoru7 at gmail.com  Mon Sep 28 21:44:27 2015
From: takahashi.minoru7 at gmail.com (Minoru TAKAHASHI)
Date: Tue, 29 Sep 2015 13:44:27 +0900
Subject: [ovs-discuss] [PATCH] Fix A bug about ofp-msgs.h.
In-Reply-To: <55FBB60B.7040205@gmail.com>
References: <55FBB60B.7040205@gmail.com>
Message-ID: <560A172B.2070408@gmail.com>

Hi,

About 10 days ago I sent this mail.
Please check attached patch.

thanks,

On 2015年09月18日 15:58, Minoru TAKAHASHI wrote:
> Hi,
> 
> I found a bug about ofp-msgs.h.
> 
> Number of OFPMP_TABLE_DESC is *14*.
> (Plese refer to "Header file openflow.h" of OF1.4/5spec)
> 
> However, ofp-msgs.h set these to *15*.
> https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L381
> https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L384
> 
> Attached patch fixes this probelm.
> 
> thanks,
> 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-ofp-msgs-fix-enum-of-OFPMP_TABLE_DESC.patch
Type: text/x-patch
Size: 961 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/065a943f/attachment-0001.bin>

From Tytus.Kurek at pega.com  Tue Sep 29 07:15:18 2015
From: Tytus.Kurek at pega.com (Kurek, Tytus)
Date: Tue, 29 Sep 2015 14:15:18 +0000
Subject: [ovs-discuss] [openvswitch 2.4.0] testsuite: 739 failed
Message-ID: <dbd9e5de2d794ead9622e1ba9b0bb33b@EXCAMB01.rpega.com>

## ------------- ##
## Test results. ##
## ------------- ##

ERROR: 1646 tests were run,
1 failed unexpectedly.
1 test was skipped.
## -------------------------- ##
## testsuite.log was created. ##
## -------------------------- ##

Please send `tests/testsuite.log' and all information you think might help:

   To: <bugs at openvswitch.org>
   Subject: [openvswitch 2.4.0] testsuite: 739 failed

You may investigate any problem if you feel able to do so, in which
case the test suite provides a good starting point.  Its output may
be found below `tests/testsuite.dir'

There is no "testsuite.log" file:

[root at cmp01 openvswitch-2.4.0]# find . -name testsuite.log

Attached is an output from the "rpmbuild -bb rhel/openvswitch.spec" command execution.

Tytus Kurek | Lead Infrastructure Engineer / Special Projects | Pegasystems Inc.
Mobile: 0048513106743 | E-Mail: tytus.kurek at pega.com<mailto:tytus.kurek at pega.com> | www.pega.com<http://www.pega.com/>
[cid:image002.png at 01D03743.5E77F240]<http://www.facebook.com/pegasystems>  [cid:image003.png at 01D03743.5E77F240] <http://twitter.com/pegasystems>   [cid:image004.png at 01D03743.5E77F240] <http://www.linkedin.com/company/165426> [cid:image005.png at 01D03743.5E77F240] <http://www.youtube.com/pegasystems>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/38bfec21/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 619 bytes
Desc: image001.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/38bfec21/attachment-0004.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 883 bytes
Desc: image002.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/38bfec21/attachment-0005.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 759 bytes
Desc: image003.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/38bfec21/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 911 bytes
Desc: image004.png
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/38bfec21/attachment-0007.png>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: output.txt
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/38bfec21/attachment-0001.txt>

From er.manpreet25 at gmail.com  Tue Sep 29 09:37:58 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Tue, 29 Sep 2015 22:07:58 +0530
Subject: [ovs-discuss] Unable to set ofp_flow_mod_flags value
Message-ID: <CALD=K8vBXxhT+cSAaUSAMmLwJ=M3YW98SoTTRSGgtRASE3Fx2w@mail.gmail.com>

Hi All,

I am adding flow entry from controller with values table_id=2, priority=22,
flags=1 match=(in_port=2)

and action=(output=4) then dump-flows i have get the following details:



cookie=0x0, duration=3.646s, table=1, n_packets=0, n_bytes=0,
send_flow_rem priority=22,in_port=1
actions=output:2



Able to see send_flow_rem flag in dump-flows



Doing same for flags=8 and flag=16 and getting following details using
dump-flows:



cookie=0x0, duration=16.703s, table=1, n_packets=0, n_bytes=0,
no_packet_counts priority=22,in_port=1 actions=output:2



cookie=0x0, duration=3.117s, table=1, n_packets=0, n_bytes=0,
no_byte_counts priority=22,in_port=1
actions=output:2



When i am setting flags=2 and flags=4 using controller with same procedure
as above then using dump flows getting

following details:



cookie=0x0, duration=3.613s, table=3, n_packets=0, n_bytes=0,
priority=22,in_port=1 actions=output:2



cookie=0x0, duration=3.613s, table=3, n_packets=0, n_bytes=0,
priority=22,in_port=1 actions=output:2



Unable to see overlap and reset_counts flag value in dump-flows.



For Reference:



enum ofp_flow_mod_flags {

OFPFF_SEND_FLOW_REM = 1 << 0, /* Send flow removed message when flow
 expires or is deleted. */

OFPFF_CHECK_OVERLAP = 1 << 1, /* Check for overlapping entries first. */

OFPFF_RESET_COUNTS = 1 << 2, /* Reset flow packet and byte counts. */

OFPFF_NO_PKT_COUNTS = 1 << 3, /* Don't keep track of packet count. */

OFPFF_NO_BYT_COUNTS = 1 << 4, /* Don't keep track of byte count. */

};
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/8aa1f749/attachment.html>

From blp at nicira.com  Tue Sep 29 10:24:20 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 29 Sep 2015 10:24:20 -0700
Subject: [ovs-discuss] [openvswitch 2.4.0] testsuite: 739 failed
In-Reply-To: <dbd9e5de2d794ead9622e1ba9b0bb33b@EXCAMB01.rpega.com>
References: <dbd9e5de2d794ead9622e1ba9b0bb33b@EXCAMB01.rpega.com>
Message-ID: <20150929172420.GA30384@nicira.com>

On Tue, Sep 29, 2015 at 02:15:18PM +0000, Kurek, Tytus wrote:
> Please send `tests/testsuite.log' and all information you think might help:
> 
>    To: <bugs at openvswitch.org>
>    Subject: [openvswitch 2.4.0] testsuite: 739 failed
> 
> You may investigate any problem if you feel able to do so, in which
> case the test suite provides a good starting point.  Its output may
> be found below `tests/testsuite.dir'
> 
> There is no "testsuite.log" file:
> 
> [root at cmp01 openvswitch-2.4.0]# find . -name testsuite.log
> 
> Attached is an output from the "rpmbuild -bb rhel/openvswitch.spec" command execution.

Thank you for the report.

You can safely ignore this failure.  It is a bug in the testsuite rather
than in OVS.  You can run the rpmbuild "--without checK" to skip the
tests.

I sent out a testsuite fix for review:
        http://openvswitch.org/pipermail/dev/2015-September/060550.html

From blp at nicira.com  Tue Sep 29 10:31:37 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 29 Sep 2015 10:31:37 -0700
Subject: [ovs-discuss] Unable to set ofp_flow_mod_flags value
In-Reply-To: <CALD=K8vBXxhT+cSAaUSAMmLwJ=M3YW98SoTTRSGgtRASE3Fx2w@mail.gmail.com>
References: <CALD=K8vBXxhT+cSAaUSAMmLwJ=M3YW98SoTTRSGgtRASE3Fx2w@mail.gmail.com>
Message-ID: <20150929173137.GC30384@nicira.com>

On Tue, Sep 29, 2015 at 10:07:58PM +0530, Manpreet Singh wrote:
> Unable to see overlap and reset_counts flag value in dump-flows.

What would they tell you?

From er.manpreet25 at gmail.com  Tue Sep 29 10:40:39 2015
From: er.manpreet25 at gmail.com (Manpreet Singh)
Date: Tue, 29 Sep 2015 23:10:39 +0530
Subject: [ovs-discuss] Unable to set ofp_flow_mod_flags value
In-Reply-To: <20150929173137.GC30384@nicira.com>
References: <CALD=K8vBXxhT+cSAaUSAMmLwJ=M3YW98SoTTRSGgtRASE3Fx2w@mail.gmail.com>
 <20150929173137.GC30384@nicira.com>
Message-ID: <CALD=K8u+_71hD2v3oGKvbvxrn2Fekw3ZnXKp1dTJQ80AcgUTsw@mail.gmail.com>

Hi Ben,

Thanks!! for reply

I am adding flow entry from controller with values table_id=2, priority=22,
flags=2 match=(in_port=2)
and action=(output=4) then dump-flows i have get the following details:

cookie=0x0, duration=3.613s, table=2, n_packets=0, n_bytes=0,
priority=22,in_port=2 actions=output:4

Unable to see overlap flag value, this problem also continue with flag = 4

Regards,
Manpreet Singh


On Tue, Sep 29, 2015 at 11:01 PM, Ben Pfaff <blp at nicira.com> wrote:

> On Tue, Sep 29, 2015 at 10:07:58PM +0530, Manpreet Singh wrote:
> > Unable to see overlap and reset_counts flag value in dump-flows.
>
> What would they tell you?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/6465a6e2/attachment.html>

From blp at nicira.com  Tue Sep 29 10:47:50 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 29 Sep 2015 10:47:50 -0700
Subject: [ovs-discuss] Matcthing parameters for exact flow entry for
 particular packet
In-Reply-To: <CAHN905KcHPgK18Ddff1zv25g-zfRUUbabOETkFbcaw8kLLEzGA@mail.gmail.com>
References: <CAHN905Kyvpoue1BKtSA5qpC7a-11n9cEKnTHTk3rG=S9jY53mw@mail.gmail.com>
 <20150924222044.GB6644@nicira.com>
 <CAHN905KcHPgK18Ddff1zv25g-zfRUUbabOETkFbcaw8kLLEzGA@mail.gmail.com>
Message-ID: <20150929174750.GE30384@nicira.com>

On Mon, Sep 28, 2015 at 02:42:01PM +0530, neeraj mehta wrote:
> I want to check the packet hit over a flow entry. For example I have two
> flow entries as below
> 
> priority=10,dl_src=00:00:11:22:33:44, dl_dst=00:00:00:33:44:55
> dl_type=0x0800 nw_proto=6 actions=2
> priority=10,dl_src=00:00:11:22:33:44, dl_dst=00:00:00:33:44:55 dl_type=*
> nw_proto=* actions=drop
> 
> Which flow entry should hit first? If I send TCP packet with same matching
> fields.

Priorities are the right way to indicate a preference among two or more
flows that could all match a single packet.  Otherwise, which flow
matches is unpredictable.

From th1618 at att.com  Tue Sep 29 11:38:53 2015
From: th1618 at att.com (HEARNE, TIMOTHY S)
Date: Tue, 29 Sep 2015 18:38:53 +0000
Subject: [ovs-discuss] name server access
Message-ID: <00CF4A25E32E204B8968E067CE2BB0D90255A4A8@CAFRFD1MSGUSRJB.ITServices.sbc.com>

I've got an issue which I can't seem to overcome.  Here is the situation.  We started with the mininet 2.2.1 image on Ubuntu 14.4 loaded into Oracle VirtualBox.  We have set up the image to use bridged networking.  We are attempting to get the two images to talk which we can do successfully.  Our issue is with name server access.

Our /etc/nework/interfaces file contains:
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp

We set up OVS on both VMs as follows:
sudo ovs-vsctl add-br br1
sudo ovs-vsctl add-port br1 eth0
sudo ifconfig br1 192.168.1.1/24 up  (on the second image, we use IP 192.168.2.1)
sudo route add -net 0.0.0.0/0 gw 192.168.1.1 (on the second image, we use IP 192.168.2.1)

When we add the eth0 port on br1, we lose access to the name-server.  I can successfully get the two images to communicate though.  I have unsuccessfully tried several methods to restore access to a name server.  Our goal is to not hard code the values in any files if possible but rather use OVS for the configuration.

Does anyone know what I need to do to restore name server access?

Thank you!
Tim Hearne


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/61503c1d/attachment.html>

From blp at nicira.com  Tue Sep 29 11:54:40 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 29 Sep 2015 11:54:40 -0700
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <A156A809-F09E-4F30-B8DD-1ED5CAA32AB5@m3s.it>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <A156A809-F09E-4F30-B8DD-1ED5CAA32AB5@m3s.it>
Message-ID: <20150929185440.GJ30384@nicira.com>

Please don't drop the mailing list.

Daniel, can you suggest a way to reproduce the problem?

On Tue, Sep 29, 2015 at 02:19:14PM +0200, Daniele Venturino wrote:
> I’m not sure.
> What’s the easiest way to replicate this?
> 
> Daniele
> 
> > Il giorno 29/set/2015, alle ore 06:13, Ben Pfaff <blp at nicira.com> ha scritto:
> > 
> > On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
> >> (gdb) frame 0
> >> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
> >> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
> > 
> > Thanks for the report.
> > 
> > Jarno and Daniele, the code around line 2278 in v2.4.0 is this:
> > 
> >        if (rstp_shift_root_learned_address(ofproto->rstp)) {
> >            bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
> >                        ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
> >            rstp_reset_root_changed(ofproto->rstp);
> >        }
> > 
> > Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' and
> > 'new_root_aux'.  I don't see any code that clears them or updates them
> > if something happens to invalidate them (that is, if a port gets deleted
> > or if its aux gets updated).  I suspect that this may be the problem
> > here.
> > 
> > Jarno or Daniele, can you confirm this?
> 

From jrajahalme at nicira.com  Tue Sep 29 14:09:52 2015
From: jrajahalme at nicira.com (Jarno Rajahalme)
Date: Tue, 29 Sep 2015 14:09:52 -0700
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <20150929041353.GF29366@nicira.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
Message-ID: <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>


> On Sep 28, 2015, at 9:13 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
>> (gdb) frame 0
>> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
>> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
> 
> Thanks for the report.
> 
> Jarno and Daniele, the code around line 2278 in v2.4.0 is this:
> 
>        if (rstp_shift_root_learned_address(ofproto->rstp)) {
>            bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>                        ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
>            rstp_reset_root_changed(ofproto->rstp);
>        }
> 
> Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' and
> 'new_root_aux'.  I don't see any code that clears them or updates them
> if something happens to invalidate them (that is, if a port gets deleted
> or if its aux gets updated).  I suspect that this may be the problem
> here.
> 
> Jarno or Daniele, can you confirm this?

I looked into this, and it may be that we fail to move the RSTP state machine when removing a port. In rstp_port_unref(), we are setting the port state to RSTP_DISABLED, but are then removing and freeing the port without triggering any change in the RSTP state machine, so if this port was the root, the root aux would still point to the deleted ofport.

Maybe this would help:

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-rstp-Properly-disable-an-RSTP-port-before-deleting-i.patch
Type: application/octet-stream
Size: 1000 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/bfe0eb7f/attachment.obj>
-------------- next part --------------


However, it seems curious that the code in rstp_run() is executed at all, as RSTP is not configured so ofproto->rest should be NULL, and no RSTP code should be run?

  Jarno

From joestringer at nicira.com  Tue Sep 29 16:10:34 2015
From: joestringer at nicira.com (Joe Stringer)
Date: Tue, 29 Sep 2015 16:10:34 -0700
Subject: [ovs-discuss] [PATCH] Fix A bug about ofp-msgs.h.
In-Reply-To: <560A172B.2070408@gmail.com>
References: <55FBB60B.7040205@gmail.com> <560A172B.2070408@gmail.com>
Message-ID: <CANr6G5z3q5fCm4HvGRTmM_SfTiveWCt_wJNWy2xAa=2NAK2efg@mail.gmail.com>

Thanks for the patch, I applied it to master.

It is easy for patches to be missed if they are sent to bugs@ or
discuss at . Usually development (including patches) are sent to
dev at openvswitch.org, so please use that list in future :-)

On 28 September 2015 at 21:44, Minoru TAKAHASHI
<takahashi.minoru7 at gmail.com> wrote:
> Hi,
>
> About 10 days ago I sent this mail.
> Please check attached patch.
>
> thanks,
>
> On 2015年09月18日 15:58, Minoru TAKAHASHI wrote:
>> Hi,
>>
>> I found a bug about ofp-msgs.h.
>>
>> Number of OFPMP_TABLE_DESC is *14*.
>> (Plese refer to "Header file openflow.h" of OF1.4/5spec)
>>
>> However, ofp-msgs.h set these to *15*.
>> https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L381
>> https://github.com/openvswitch/ovs/blob/master/lib/ofp-msgs.h#L384
>>
>> Attached patch fixes this probelm.
>>
>> thanks,
>>
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss
>

From davidjoshuaevans at gmail.com  Tue Sep 29 20:44:41 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Tue, 29 Sep 2015 22:44:41 -0500
Subject: [ovs-discuss] how to get dpdk pmd's assigned per port.
Message-ID: <CAB8HAh7RmXw+CWTW-udHPGxg8iNOfN8PiwSnk72MoD_zBhtiqQ@mail.gmail.com>

Hi OVS (Ben particularly :) )

How do i get OVS to assign ports to the PMD's that I choose?

If i have say 6 or 12 ports and i want them distributed evenly across a
mask of 12 or more cores on a multi node numa system / or where i know the
NICs are on separate pci buses even what code do i touch to have more
deterministic control over this.

Cheers,

Dave.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150929/79fd6e26/attachment.html>

From pradeeps at linux.vnet.ibm.com  Tue Sep 29 21:40:52 2015
From: pradeeps at linux.vnet.ibm.com (Pradeep Satyanarayana)
Date: Tue, 29 Sep 2015 21:40:52 -0700
Subject: [ovs-discuss] [PATCH-RFC 1/2] Improve ARP latency
In-Reply-To: <00CF4A25E32E204B8968E067CE2BB0D90255A4A8@CAFRFD1MSGUSRJB.ITServices.sbc.com>
References: <00CF4A25E32E204B8968E067CE2BB0D90255A4A8@CAFRFD1MSGUSRJB.ITServices.sbc.com>
Message-ID: <560B67D4.8080300@linux.vnet.ibm.com>

Sending on behalf of David Wilder dwildwer at linux.vnet.ibm.com, since his 
email was stuck waiting for moderator approval.

Hi-

I have been conducting scaling tests with OVS and docker. My tests
revealed that the latency of ARP packets can become very large
resulting in many ARP re-transmissions and time-outs. I found the
source of the poor latency to be with the handling of arp packets in
ovs_vport_find_upcall_portid().  Each packet is hashed in
ovs_vport_find_upcall_portid() by calling skb_get_hash().  This hash
is used to select a netlink socket in which to send the packet to
userspace.  However, skb_get_hash() is not supporting ARP packets
returning a 0 (invalid hash) for every ARP.  This results in a single
ovs-vswitchd handler thread processing every arp packet thus severely
impacting the average latency of ARPs. I am purposing a change to
ovs_vport_find_upcall_portid() that spreads the ARP packets evenly
between all the handler threads (patch to follow).  Please let me know
if you have suggestions/comments.

I conducted tests to measure the latency of packets taking the "slow
path". I measured latency by adding a unique identifier to packets in
the openvswitch kernel modules (ovs_dp_upcall() ).  I tagged all
packets as they are sent to ovs-vswitchd.  Using a kprobe I record the
value of jiffies when each packet is sent to userspace and again when
the packet is returned to the kernel (ovs_packet_cmd_execute() ). In
addition I placed a user-probe in ovs-vswitchd to record jiffies when
the packet is read by ovs-vswitchd (read_upcalls() ).

Versions Tested:
ovs_version: "2.4.90"
openvswitch module from a 3.19.6 kernel (ubuntu 15.4)

My benchmark creates 512 containers and runs a single iperf (TCP
bandwidth test) in each. Ovs-vswitchd created 60 handler threads.  I
flushed the neighbor cache prior to each benchmark run to simulate the
worse case or a start-up environment.

These charts show 3 latencies: kernel to user, user to kernel and
kernel to kernel (RTT).  Separate results are shown for all packet
types, IPv4 packets and ARP packets.  Note: these are not port-to-port
switch performance measurements, only packets sent to user-space are
measured.

Before the patch
================
We observe the latency of arps is much greater than that of ipv4
packets (1058 vs. 5).  The majority of the latency is from the kernel
to user portion of the path.

All Packets:
Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              2144            0               2001            945
K-2-OVS          2144            0               1995            904
OVS-2-K          2144            0               914             40
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
      0 |@@@@@                                               123
      1 |@@@                                                  70
      2 |@                                                    31
      4 |                                                     15
      8 |                                                     14
     16 |@                                                    33
     32 |@@                                                   52
     64 |@@@                                                  87
    128 |@@@@@@                                              132
    256 |@@@@@@@@                                            184
    512 |@@@@@@@@@@@@@@                                      325
   1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  1078
   2048 |                                                      0
   4096 |                                                      0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
      0 |@@@@@@@                                             169
      1 |@@                                                   57
      2 |                                                     19
      4 |@                                                    32
      8 |@@                                                   60
     16 |@                                                    25
     32 |@@                                                   64
     64 |@                                                    36
    128 |@@@@@@                                              132
    256 |@@@@@@@@@                                           212
    512 |@@@@@@@@@@@@                                        282
   1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   1056
   2048 |                                                      0
   4096 |                                                      0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@                                 204
      1 |@@@@@@@@@@@@@@@@                                   181
      2 |@@@@@@@@@@@@@@@@@@@@@@@                            258
      4 |@@@@@@@@@@@@@@@@@@@@@@@@                           273
      8 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 550
     16 |@@@@@@@@@@@@@@@@@@@@@@@                            258
     32 |@@@@@@@@@@                                         114
     64 |@@@@@@@@@@@@@@@@                                   180
    128 |@@                                                  32
    256 |@@@@@                                               63
    512 |@@                                                  31
   1024 |                                                     0
   2048 |                                                     0



ARP Packet:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              1914            0               2001            1058
K-2-OVS          1914            0               1995            1013
OVS-2-K          1914            0               914             45
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
      0 |                                                     21
      1 |                                                     17
      2 |                                                     11
      4 |                                                      1
      8 |                                                      4
     16 |                                                     15
     32 |@                                                    39
     64 |@@@                                                  87
    128 |@@@@@@                                              132
    256 |@@@@@@@@                                            184
    512 |@@@@@@@@@@@@@@                                      325
   1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  1078
   2048 |                                                      0
   4096 |                                                      0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
      0 |@                                                    38
      1 |                                                     11
      2 |                                                      7
      4 |                                                     19
      8 |@@                                                   44
     16 |                                                     18
     32 |@@                                                   59
     64 |@                                                    36
    128 |@@@@@@                                              132
    256 |@@@@@@@@@                                           212
    512 |@@@@@@@@@@@@                                        282
   1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   1056
   2048 |                                                      0
   4096 |                                                      0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
      0 |@@@@                                                47
      1 |@@@@@@@@@@@@@                                      147
      2 |@@@@@@@@@@@@@@@@@@@@@@                             252
      4 |@@@@@@@@@@@@@@@@@@@@@@@                            261
      8 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   538
     16 |@@@@@@@@@@@@@@@@@@@@@@                             251
     32 |@@@@@@@@@@                                         112
     64 |@@@@@@@@@@@@@@@@                                   180
    128 |@@                                                  32
    256 |@@@@@                                               63
    512 |@@                                                  31
   1024 |                                                     0
   2048 |                                                     0

IPV4 Packets:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              230             0               53              5
K-2-OVS          230             0               44              2
OVS-2-K          230             0               50              2
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                 102
      1 |@@@@@@@@@@@@@@@@@                                   53
      2 |@@@@@@                                              20
      4 |@@@@                                                14
      8 |@@@                                                 10
     16 |@@@@@@                                              18
     32 |@@@@                                                13
     64 |                                                     0
    128 |                                                     0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@        131
      1 |@@@@@@@@@@@@@@@                                     46
      2 |@@@@                                                12
      4 |@@@@                                                12
      8 |@@@@@                                               17
     16 |@@                                                   7
     32 |@                                                    5
     64 |                                                     0
    128 |                                                     0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@            158
      1 |@@@@@@@@                                            33
      2 |@                                                    7
      4 |@@                                                  11
      8 |@@@                                                 12
     16 |@                                                    7
     32 |                                                     2
     64 |                                                     0
    128 |                                                     0

This last histogram shows the value of n_upcalls as returned by
recv_upcalls() for all packets.  UPCALL_MAX_BATCH=64 therefor anytime
n_upcalls reaches 64 the number packets waiting to be processes is 64
or greater.

base-2 logarithmic histogram of queue size
n_upcalls stats:  Number of samples=282 min=1 max=64 avg=7
value |-------------------------------------------------- count
      0 |                                                     0
      1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       223
      2 |@@@@                                                24
      4 |                                                     3
      8 |                                                     2
     16 |                                                     1
     32 |                                                     1
     64 |@@@@@                                               28
    128 |                                                     0
    256 |                                                     0

Additional debug (not shown here) showed that all arp packets were
handled by a single handler thread.


After the Patch
===============

The overall performance between IPv4 packet and ARP packets is now
balanced.  Average round-trip latency for ARPs went from 1058 to 243.
Notice that the latency of the ipv4 packets suffer from this change,
this occurs because all packets are now competing for the same
resources.  My benchmark generates more arp packets sent to
ovs-vswitchd than ipv4 packets contributing to the increase in ipv4
latency.  Note that the number of arp packets (See COUNT) has
decreased from 1914 to 865, this is due the the significant reduction
of arp re-transmissions caused by the large latency.

All Packets:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              1495            0               1859            199
K-2-OVS          1495            0               1029            98
OVS-2-K          1495            0               1829            101
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         252
      1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     182
      2 |@@@@@@@@@@@@@@                                      88
      4 |@@@@@@@@@@@@                                        75
      8 |@@@@@@@@@@@@@@@                                     93
     16 |@@@@@@@@@@@@@@@@                                    98
     32 |@@@@@@@@@@@@@@@@@@@                                114
     64 |@@@@@@@@@@@@@@@@@@                                 110
    128 |@@@@@@@@@@@@@@@@@@@@@@@@@@@                        166
    256 |@@@@@@@@@@@@@@@@@@@@                               123
    512 |@@@@@@@@@@@@@@@@@                                  103
   1024 |@@@@@@@@@@@@@@@                                     91
   2048 |                                                     0
   4096 |                                                     0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   384
      1 |@@@@@@@@@@@@@@@@@@@@@@@@                           199
      2 |@@@@@@@@                                            67
      4 |@@@@@@@@                                            66
      8 |@@@@@@@@@@@                                         89
     16 |@@@@@@@@@@@@                                       100
     32 |@@@@@@@@@@@@                                       103
     64 |@@@@@@@@@@@@                                       100
    128 |@@@@@@@@@@@@@@@@@@@@                               162
    256 |@@@@@@@@@@@@@@@@@@@                                156
    512 |@@@@@@@@                                            68
   1024 |                                                     1
   2048 |                                                     0
   4096 |                                                     0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   587
      1 |@@@@@@@@@@                                         122
      2 |@@@@@@@                                             88
      4 |@@@@@@@@                                           100
      8 |@@@@@@@                                             86
     16 |@@@@@@@                                             89
     32 |@@@@@@@                                             91
     64 |@@@@@@@@                                           107
    128 |@@@@                                                58
    256 |@@@@@                                               60
    512 |@@@@@                                               70
   1024 |@@@                                                 37
   2048 |                                                     0
   4096 |                                                     0


ARP Packet:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              865             0               1859            243
K-2-OVS          865             0               877             111
OVS-2-K          865             0               1829            131
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         86
      1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       91
      2 |@@@@@@@@@@@@@@@@@@@@@@@@@@                          52
      4 |@@@@@@@@@@@@@@@@@@@@@                               42
      8 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                    64
     16 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                      60
     32 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@              76
     64 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@             78
    128 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 100
    256 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                 71
    512 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@              76
   1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                  69
   2048 |                                                     0
   4096 |                                                     0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         168
      1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     123
      2 |@@@@@@@@@                                           37
      4 |@@@@@@@@                                            34
      8 |@@@@@@@@@@@@@                                       54
     16 |@@@@@@@@@@@@@@@@@                                   70
     32 |@@@@@@@@@@@@@@@@@                                   70
     64 |@@@@@@@@@@@@@@@@                                    64
    128 |@@@@@@@@@@@@@@@@@@@@@@@                             94
    256 |@@@@@@@@@@@@@@@@@@@@@@@@@                          101
    512 |@@@@@@@@@@@@                                        50
   1024 |                                                     0
   2048 |                                                     0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  247
      1 |@@@@@@@@@@@@@@                                      72
      2 |@@@@@@@@@@@                                         57
      4 |@@@@@@@@@@@                                         58
      8 |@@@@@@@@@@@@@@                                      70
     16 |@@@@@@@@@@@                                         56
     32 |@@@@@@@@@@@@                                        62
     64 |@@@@@@@@@@@@@@@                                     77
    128 |@@@@@@@@                                            42
    256 |@@@@@@@                                             38
    512 |@@@@@@@@@@@                                         58
   1024 |@@@@@                                               28
   2048 |                                                     0
   4096 |                                                     0


IPV4 Packets:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              630             0               1820            139
K-2-OVS          630             0               1029            80
OVS-2-K          630             0               1739            58
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@          166
      1 |@@@@@@@@@@@@@@@@@@@@@@                              91
      2 |@@@@@@@@@                                           36
      4 |@@@@@@@@                                            33
      8 |@@@@@@@                                             29
     16 |@@@@@@@@@                                           38
     32 |@@@@@@@@@                                           38
     64 |@@@@@@@@                                            32
    128 |@@@@@@@@@@@@@@@@                                    66
    256 |@@@@@@@@@@@@@                                       52
    512 |@@@@@@                                              27
   1024 |@@@@@                                               22
   2048 |                                                     0
   4096 |                                                     0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         214
      1 |@@@@@@@@@@@@@@@                                     78
      2 |@@@@@@                                              30
      4 |@@@@@@                                              32
      8 |@@@@@@@                                             35
     16 |@@@@@@                                              30
     32 |@@@@@@                                              33
     64 |@@@@@@@                                             36
    128 |@@@@@@@@@@@@@                                       68
    256 |@@@@@@@@@@@                                         55
    512 |@@@                                                 18
   1024 |                                                     1
   2048 |                                                     0
   4096 |                                                     0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
      0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   341
      1 |@@@@@@@                                             49
      2 |@@@@                                                31
      4 |@@@@@@                                              42
      8 |@@                                                  16
     16 |@@@@                                                33
     32 |@@@@                                                29
     64 |@@@@                                                30
    128 |@@                                                  16
    256 |@@@                                                 22
    512 |@                                                   12
   1024 |@                                                    9
   2048 |                                                     0
   4096 |                                                     0

The backlog of packets is significantly reduced.

base-2 logarithmic histogram of queue size
n_upcalls stats:  Number of samples=930 min=1 max=50 avg=1
value |-------------------------------------------------- count
      0 |                                                     0
      1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   770
      2 |@@@@@@                                             107
      4 |@@                                                  34
      8 |                                                    14
     16 |                                                     3
     32 |                                                     2
     64 |                                                     0
    128 |                                                     0



From pradeeps at linux.vnet.ibm.com  Tue Sep 29 21:41:45 2015
From: pradeeps at linux.vnet.ibm.com (Pradeep Satyanarayana)
Date: Tue, 29 Sep 2015 21:41:45 -0700
Subject: [ovs-discuss] [PATCH-RFC 2/2] Improve ARP latency
In-Reply-To: <00CF4A25E32E204B8968E067CE2BB0D90255A4A8@CAFRFD1MSGUSRJB.ITServices.sbc.com>
References: <00CF4A25E32E204B8968E067CE2BB0D90255A4A8@CAFRFD1MSGUSRJB.ITServices.sbc.com>
Message-ID: <560B6809.6040109@linux.vnet.ibm.com>

skb_get_hash() returns a 0 (invalid hash) for arp packets resulting in same
ids_index for every arp packet. This results in a single ovs-vswitchd 
handler
thread processing every arp packet severely impacting the average latency of
arps. This change spreads the work evenly between all the handler threads.

---
   datapath/vport.c | 6 ++++++
   1 file changed, 6 insertions(+)

diff --git a/datapath/vport.c b/datapath/vport.c
index 024491f..20d20fa 100644
--- a/datapath/vport.c
+++ b/datapath/vport.c
@@ -465,6 +465,12 @@ u32 ovs_vport_find_upcall_portid(const struct
vport *vport, struct sk_buff *skb)
   		 if (ids->n_ids == 1 && ids->ids[0] == 0)
   		 		 return 0;

+		 /* skb_get_hash() is not supporting ETH_P_ARP packets returning a 0
+		  * (invalid hash) for every ARP.
+		  */
+		 if (skb->protocol == ntohs(ETH_P_ARP))
+		 		 return ids->ids[vport->port_no%ids->n_ids];
+
   		 hash = skb_get_hash(skb);
   		 return ids->ids[hash - ids->n_ids * reciprocal_divide(hash, 
ids->rn_ids)];
   }


From pradeeps at linux.vnet.ibm.com  Tue Sep 29 21:45:43 2015
From: pradeeps at linux.vnet.ibm.com (Pradeep Satyanarayana)
Date: Tue, 29 Sep 2015 21:45:43 -0700
Subject: [ovs-discuss] [PATCH-RFC 2/2] Improve ARP latency
In-Reply-To: <560B6809.6040109@linux.vnet.ibm.com>
References: <00CF4A25E32E204B8968E067CE2BB0D90255A4A8@CAFRFD1MSGUSRJB.ITServices.sbc.com>
 <560B6809.6040109@linux.vnet.ibm.com>
Message-ID: <560B68F7.1050002@linux.vnet.ibm.com>

This was gain on behalf of David Wilder dwilder at linux.vnet.ibm.com

On 09/29/2015 09:41 PM, Pradeep Satyanarayana wrote:
> skb_get_hash() returns a 0 (invalid hash) for arp packets resulting in same
> ids_index for every arp packet. This results in a single ovs-vswitchd
> handler
> thread processing every arp packet severely impacting the average
> latency of
> arps. This change spreads the work evenly between all the handler threads.
>
> ---
>    datapath/vport.c | 6 ++++++
>    1 file changed, 6 insertions(+)
>
> diff --git a/datapath/vport.c b/datapath/vport.c
> index 024491f..20d20fa 100644
> --- a/datapath/vport.c
> +++ b/datapath/vport.c
> @@ -465,6 +465,12 @@ u32 ovs_vport_find_upcall_portid(const struct
> vport *vport, struct sk_buff *skb)
>             if (ids->n_ids == 1 && ids->ids[0] == 0)
>                      return 0;
>
> +         /* skb_get_hash() is not supporting ETH_P_ARP packets
> returning a 0
> +          * (invalid hash) for every ARP.
> +          */
> +         if (skb->protocol == ntohs(ETH_P_ARP))
> +                  return ids->ids[vport->port_no%ids->n_ids];
> +
>             hash = skb_get_hash(skb);
>             return ids->ids[hash - ids->n_ids * reciprocal_divide(hash,
> ids->rn_ids)];
>    }
>
> _______________________________________________
> discuss mailing list
> discuss at openvswitch.org
> http://openvswitch.org/mailman/listinfo/discuss


From dwilder at us.ibm.com  Tue Sep 29 22:50:39 2015
From: dwilder at us.ibm.com (dwilder at us.ibm.com)
Date: Wed, 30 Sep 2015 01:50:39 -0400
Subject: [ovs-discuss] [PATCH-RFC 1/2] Improve ARP latency
Message-ID: <20150930015039.Horde.By710uU5wzMPGcKhA46ZaA1@ltc.linux.ibm.com>

Hi-

I have been conducting scaling tests with OVS and docker. My tests  
revealed that the latency of ARP packets can become very large  
resulting in many ARP re-transmissions and time-outs. I found the  
source of the poor latency to be with the handling of arp packets in  
ovs_vport_find_upcall_portid().  Each packet is hashed in  
ovs_vport_find_upcall_portid() by calling skb_get_hash().  This hash  
is used to select a netlink socket in which to send the packet to  
userspace.  However, skb_get_hash() is not supporting ARP packets  
returning a 0 (invalid hash) for every ARP.  This results in a single  
ovs-vswitchd handler thread processing every arp packet thus severely  
impacting the average latency of ARPs. I am purposing a change to  
ovs_vport_find_upcall_portid() that spreads the ARP packets evenly  
between all the handler threads (patch to follow).  Please let me know  
if you have suggestions/comments.

I conducted tests to measure the latency of packets taking the "slow  
path". I measured latency by adding a unique identifier to packets in  
the openvswitch kernel modules (ovs_dp_upcall() ).  I tagged all  
packets as they are sent to ovs-vswitchd.  Using a kprobe I record the  
value of jiffies when each packet is sent to userspace and again when  
the packet is returned to the kernel (ovs_packet_cmd_execute() ). In  
addition I placed a user-probe in ovs-vswitchd to record jiffies when  
the packet is read by ovs-vswitchd (read_upcalls() ).

Versions Tested:
ovs_version: "2.4.90"
openvswitch module from a 3.19.6 kernel (ubuntu 15.4)

My benchmark creates 512 containers and runs a single iperf (TCP  
bandwidth test) in each. Ovs-vswitchd created 60 handler threads.  I  
flushed the neighbor cache prior to each benchmark run to simulate the  
worse case or a start-up environment.

These charts show 3 latencies: kernel to user, user to kernel and  
kernel to kernel (RTT).  Separate results are shown for all packet  
types, IPv4 packets and ARP packets.  Note: these are not port-to-port  
switch performance measurements, only packets sent to user-space are  
measured.

Before the patch
================
We observe the latency of arps is much greater than that of ipv4  
packets (1058 vs. 5).  The majority of the latency is from the kernel  
to user portion of the path.

All Packets:
Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              2144            0               2001            945
K-2-OVS          2144            0               1995            904
OVS-2-K          2144            0               914             40
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
     0 |@@@@@                                               123
     1 |@@@                                                  70
     2 |@                                                    31
     4 |                                                     15
     8 |                                                     14
    16 |@                                                    33
    32 |@@                                                   52
    64 |@@@                                                  87
   128 |@@@@@@                                              132
   256 |@@@@@@@@                                            184
   512 |@@@@@@@@@@@@@@                                      325
  1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  1078
  2048 |                                                      0
  4096 |                                                      0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
     0 |@@@@@@@                                             169
     1 |@@                                                   57
     2 |                                                     19
     4 |@                                                    32
     8 |@@                                                   60
    16 |@                                                    25
    32 |@@                                                   64
    64 |@                                                    36
   128 |@@@@@@                                              132
   256 |@@@@@@@@@                                           212
   512 |@@@@@@@@@@@@                                        282
  1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   1056
  2048 |                                                      0
  4096 |                                                      0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@                                 204
     1 |@@@@@@@@@@@@@@@@                                   181
     2 |@@@@@@@@@@@@@@@@@@@@@@@                            258
     4 |@@@@@@@@@@@@@@@@@@@@@@@@                           273
     8 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 550
    16 |@@@@@@@@@@@@@@@@@@@@@@@                            258
    32 |@@@@@@@@@@                                         114
    64 |@@@@@@@@@@@@@@@@                                   180
   128 |@@                                                  32
   256 |@@@@@                                               63
   512 |@@                                                  31
  1024 |                                                     0
  2048 |                                                     0



ARP Packet:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              1914            0               2001            1058
K-2-OVS          1914            0               1995            1013
OVS-2-K          1914            0               914             45
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
     0 |                                                     21
     1 |                                                     17
     2 |                                                     11
     4 |                                                      1
     8 |                                                      4
    16 |                                                     15
    32 |@                                                    39
    64 |@@@                                                  87
   128 |@@@@@@                                              132
   256 |@@@@@@@@                                            184
   512 |@@@@@@@@@@@@@@                                      325
  1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  1078
  2048 |                                                      0
  4096 |                                                      0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
     0 |@                                                    38
     1 |                                                     11
     2 |                                                      7
     4 |                                                     19
     8 |@@                                                   44
    16 |                                                     18
    32 |@@                                                   59
    64 |@                                                    36
   128 |@@@@@@                                              132
   256 |@@@@@@@@@                                           212
   512 |@@@@@@@@@@@@                                        282
  1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   1056
  2048 |                                                      0
  4096 |                                                      0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
     0 |@@@@                                                47
     1 |@@@@@@@@@@@@@                                      147
     2 |@@@@@@@@@@@@@@@@@@@@@@                             252
     4 |@@@@@@@@@@@@@@@@@@@@@@@                            261
     8 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   538
    16 |@@@@@@@@@@@@@@@@@@@@@@                             251
    32 |@@@@@@@@@@                                         112
    64 |@@@@@@@@@@@@@@@@                                   180
   128 |@@                                                  32
   256 |@@@@@                                               63
   512 |@@                                                  31
  1024 |                                                     0
  2048 |                                                     0

IPV4 Packets:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              230             0               53              5
K-2-OVS          230             0               44              2
OVS-2-K          230             0               50              2
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                 102
     1 |@@@@@@@@@@@@@@@@@                                   53
     2 |@@@@@@                                              20
     4 |@@@@                                                14
     8 |@@@                                                 10
    16 |@@@@@@                                              18
    32 |@@@@                                                13
    64 |                                                     0
   128 |                                                     0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@        131
     1 |@@@@@@@@@@@@@@@                                     46
     2 |@@@@                                                12
     4 |@@@@                                                12
     8 |@@@@@                                               17
    16 |@@                                                   7
    32 |@                                                    5
    64 |                                                     0
   128 |                                                     0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@            158
     1 |@@@@@@@@                                            33
     2 |@                                                    7
     4 |@@                                                  11
     8 |@@@                                                 12
    16 |@                                                    7
    32 |                                                     2
    64 |                                                     0
   128 |                                                     0

This last histogram shows the value of n_upcalls as returned by  
recv_upcalls() for all packets.  UPCALL_MAX_BATCH=64 therefor anytime  
n_upcalls reaches 64 the number packets waiting to be processes is 64  
or greater.

base-2 logarithmic histogram of queue size
n_upcalls stats:  Number of samples=282 min=1 max=64 avg=7
value |-------------------------------------------------- count
     0 |                                                     0
     1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       223
     2 |@@@@                                                24
     4 |                                                     3
     8 |                                                     2
    16 |                                                     1
    32 |                                                     1
    64 |@@@@@                                               28
   128 |                                                     0
   256 |                                                     0

Additional debug (not shown here) showed that all arp packets were  
handled by a single handler thread.


After the Patch
===============

The overall performance between IPv4 packet and ARP packets is now  
balanced.  Average round-trip latency for ARPs went from 1058 to 243.   
Notice that the latency of the ipv4 packets suffer from this change,  
this occurs because all packets are now competing for the same  
resources.  My benchmark generates more arp packets sent to  
ovs-vswitchd than ipv4 packets contributing to the increase in ipv4  
latency.  Note that the number of arp packets (See COUNT) has  
decreased from 1914 to 865, this is due the the significant reduction  
of arp re-transmissions caused by the large latency.

All Packets:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              1495            0               1859            199
K-2-OVS          1495            0               1029            98
OVS-2-K          1495            0               1829            101
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         252
     1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     182
     2 |@@@@@@@@@@@@@@                                      88
     4 |@@@@@@@@@@@@                                        75
     8 |@@@@@@@@@@@@@@@                                     93
    16 |@@@@@@@@@@@@@@@@                                    98
    32 |@@@@@@@@@@@@@@@@@@@                                114
    64 |@@@@@@@@@@@@@@@@@@                                 110
   128 |@@@@@@@@@@@@@@@@@@@@@@@@@@@                        166
   256 |@@@@@@@@@@@@@@@@@@@@                               123
   512 |@@@@@@@@@@@@@@@@@                                  103
  1024 |@@@@@@@@@@@@@@@                                     91
  2048 |                                                     0
  4096 |                                                     0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   384
     1 |@@@@@@@@@@@@@@@@@@@@@@@@                           199
     2 |@@@@@@@@                                            67
     4 |@@@@@@@@                                            66
     8 |@@@@@@@@@@@                                         89
    16 |@@@@@@@@@@@@                                       100
    32 |@@@@@@@@@@@@                                       103
    64 |@@@@@@@@@@@@                                       100
   128 |@@@@@@@@@@@@@@@@@@@@                               162
   256 |@@@@@@@@@@@@@@@@@@@                                156
   512 |@@@@@@@@                                            68
  1024 |                                                     1
  2048 |                                                     0
  4096 |                                                     0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   587
     1 |@@@@@@@@@@                                         122
     2 |@@@@@@@                                             88
     4 |@@@@@@@@                                           100
     8 |@@@@@@@                                             86
    16 |@@@@@@@                                             89
    32 |@@@@@@@                                             91
    64 |@@@@@@@@                                           107
   128 |@@@@                                                58
   256 |@@@@@                                               60
   512 |@@@@@                                               70
  1024 |@@@                                                 37
  2048 |                                                     0
  4096 |                                                     0


ARP Packet:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              865             0               1859            243
K-2-OVS          865             0               877             111
OVS-2-K          865             0               1829            131
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         86
     1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       91
     2 |@@@@@@@@@@@@@@@@@@@@@@@@@@                          52
     4 |@@@@@@@@@@@@@@@@@@@@@                               42
     8 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                    64
    16 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                      60
    32 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@              76
    64 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@             78
   128 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 100
   256 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                 71
   512 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@              76
  1024 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                  69
  2048 |                                                     0
  4096 |                                                     0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         168
     1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     123
     2 |@@@@@@@@@                                           37
     4 |@@@@@@@@                                            34
     8 |@@@@@@@@@@@@@                                       54
    16 |@@@@@@@@@@@@@@@@@                                   70
    32 |@@@@@@@@@@@@@@@@@                                   70
    64 |@@@@@@@@@@@@@@@@                                    64
   128 |@@@@@@@@@@@@@@@@@@@@@@@                             94
   256 |@@@@@@@@@@@@@@@@@@@@@@@@@                          101
   512 |@@@@@@@@@@@@                                        50
  1024 |                                                     0
  2048 |                                                     0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  247
     1 |@@@@@@@@@@@@@@                                      72
     2 |@@@@@@@@@@@                                         57
     4 |@@@@@@@@@@@                                         58
     8 |@@@@@@@@@@@@@@                                      70
    16 |@@@@@@@@@@@                                         56
    32 |@@@@@@@@@@@@                                        62
    64 |@@@@@@@@@@@@@@@                                     77
   128 |@@@@@@@@                                            42
   256 |@@@@@@@                                             38
   512 |@@@@@@@@@@@                                         58
  1024 |@@@@@                                               28
  2048 |                                                     0
  4096 |                                                     0


IPV4 Packets:

Time:            COUNT           MIN             MAX             AVERAGE
-----------------------------------------------------------------------------
RTT              630             0               1820            139
K-2-OVS          630             0               1029            80
OVS-2-K          630             0               1739            58
-----------------------------------------------------------------------------
base-2 logarithmic histogram of round trip times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@          166
     1 |@@@@@@@@@@@@@@@@@@@@@@                              91
     2 |@@@@@@@@@                                           36
     4 |@@@@@@@@                                            33
     8 |@@@@@@@                                             29
    16 |@@@@@@@@@                                           38
    32 |@@@@@@@@@                                           38
    64 |@@@@@@@@                                            32
   128 |@@@@@@@@@@@@@@@@                                    66
   256 |@@@@@@@@@@@@@                                       52
   512 |@@@@@@                                              27
  1024 |@@@@@                                               22
  2048 |                                                     0
  4096 |                                                     0

base-2 logarithmic histogram of kernel to ovs times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         214
     1 |@@@@@@@@@@@@@@@                                     78
     2 |@@@@@@                                              30
     4 |@@@@@@                                              32
     8 |@@@@@@@                                             35
    16 |@@@@@@                                              30
    32 |@@@@@@                                              33
    64 |@@@@@@@                                             36
   128 |@@@@@@@@@@@@@                                       68
   256 |@@@@@@@@@@@                                         55
   512 |@@@                                                 18
  1024 |                                                     1
  2048 |                                                     0
  4096 |                                                     0

base-2 logarithmic histogram of ovs to kernel times
value |-------------------------------------------------- count
     0 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   341
     1 |@@@@@@@                                             49
     2 |@@@@                                                31
     4 |@@@@@@                                              42
     8 |@@                                                  16
    16 |@@@@                                                33
    32 |@@@@                                                29
    64 |@@@@                                                30
   128 |@@                                                  16
   256 |@@@                                                 22
   512 |@                                                   12
  1024 |@                                                    9
  2048 |                                                     0
  4096 |                                                     0

The backlog of packets is significantly reduced.

base-2 logarithmic histogram of queue size
n_upcalls stats:  Number of samples=930 min=1 max=50 avg=1
value |-------------------------------------------------- count
     0 |                                                     0
     1 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@   770
     2 |@@@@@@                                             107
     4 |@@                                                  34
     8 |                                                    14
    16 |                                                     3
    32 |                                                     2
    64 |                                                     0
   128 |                                                     0


From dwilder at us.ibm.com  Tue Sep 29 22:50:41 2015
From: dwilder at us.ibm.com (dwilder at us.ibm.com)
Date: Wed, 30 Sep 2015 01:50:41 -0400
Subject: [ovs-discuss] [PATCH-RFC 2/2] Improve ARP latency
Message-ID: <20150930015041.Horde.bq4bzxfcBq_LySCRl8ujSA1@ltc.linux.ibm.com>

skb_get_hash() returns a 0 (invalid hash) for arp packets resulting in same
ids_index for every arp packet. This results in a single ovs-vswitchd handler
thread processing every arp packet severely impacting the average latency of
arps. This change spreads the work evenly between all the handler threads.


  datapath/vport.c | 6 ++++++
  1 file changed, 6 insertions(+)

diff --git a/datapath/vport.c b/datapath/vport.c
index 024491f..20d20fa 100644
--- a/datapath/vport.c
+++ b/datapath/vport.c
@@ -465,6 +465,12 @@ u32 ovs_vport_find_upcall_portid(const struct  
vport *vport, struct sk_buff *skb)
  	if (ids->n_ids == 1 && ids->ids[0] == 0)
  		return 0;

+	/* skb_get_hash() is not supporting ETH_P_ARP packets returning a 0
+	 * (invalid hash) for every ARP.
+	 */
+	if (skb->protocol == ntohs(ETH_P_ARP))
+		return ids->ids[vport->port_no%ids->n_ids];
+
  	hash = skb_get_hash(skb);
  	return ids->ids[hash - ids->n_ids * reciprocal_divide(hash, ids->rn_ids)];
  }
-- 


From blp at nicira.com  Tue Sep 29 23:08:17 2015
From: blp at nicira.com (Ben Pfaff)
Date: Tue, 29 Sep 2015 23:08:17 -0700
Subject: [ovs-discuss] Learn action in group table
In-Reply-To: <CAJ-RJ=UWp0rXFZfayNC692-MUOPFzE9GDfhm=qv_ESB6yoJGKg@mail.gmail.com>
References: <CAJ-RJ=UWp0rXFZfayNC692-MUOPFzE9GDfhm=qv_ESB6yoJGKg@mail.gmail.com>
Message-ID: <20150930060817.GA14940@nicira.com>

On Mon, Sep 21, 2015 at 04:11:28PM +0200, Davide Sanvito wrote:
> I'm trying to execute a learn action to table 0 from a group entry. The
> application is written with the Ryu framework and by using ovs-ofctl I can
> confirm that buckets have the correct learn action associated and that
> packets go through the group table.
> 
> By the way no flow entry is added to table 0 by the execution of the learn
> action.
> 
> Is this a bug? Is the learn action supported as an action in a group entry?

A learn action in an action set doesn't currently have any effect.

From daniele.venturino at m3s.it  Wed Sep 30 01:54:18 2015
From: daniele.venturino at m3s.it (Daniele Venturino)
Date: Wed, 30 Sep 2015 10:54:18 +0200
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
 <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
Message-ID: <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>

I tried the commands you listed but I was not able to reproduce this in a simpler setup only with RSTP enabled on the bridge.

I’m attaching a patch I’d like you to try. I’m not really expecting much from it, but can you give it a try since I can’t reproduce this?

Daniele

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-ofproto-dpif-Add-check-in-rstp_run.patch
Type: application/octet-stream
Size: 1889 bytes
Desc: not available
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150930/b9130333/attachment.obj>
-------------- next part --------------


> Il giorno 30/set/2015, alle ore 10:12, Daniel Swahn <daniel.swahn at clavister.com> ha scritto:
> 
> I tested with the patch but unfortunately the same crash occurs.
> 
> -----Original Message-----
> From: Jarno Rajahalme [mailto:jrajahalme at nicira.com] 
> Sent: 2015-09-29 23:10
> To: Ben Pfaff
> Cc: Daniel Swahn; Daniele Venturino; bugs at openvswitch.org
> Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch
> 
> 
>> On Sep 28, 2015, at 9:13 PM, Ben Pfaff <blp at nicira.com> wrote:
>> 
>> On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
>>> (gdb) frame 0
>>> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
>>> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>> 
>> Thanks for the report.
>> 
>> Jarno and Daniele, the code around line 2278 in v2.4.0 is this:
>> 
>>       if (rstp_shift_root_learned_address(ofproto->rstp)) {
>>           bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>>                       ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
>>           rstp_reset_root_changed(ofproto->rstp);
>>       }
>> 
>> Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' 
>> and 'new_root_aux'.  I don't see any code that clears them or updates 
>> them if something happens to invalidate them (that is, if a port gets 
>> deleted or if its aux gets updated).  I suspect that this may be the 
>> problem here.
>> 
>> Jarno or Daniele, can you confirm this?
> 
> I looked into this, and it may be that we fail to move the RSTP state machine when removing a port. In rstp_port_unref(), we are setting the port state to RSTP_DISABLED, but are then removing and freeing the port without triggering any change in the RSTP state machine, so if this port was the root, the root aux would still point to the deleted ofport.
> 
> Maybe this would help:
> 


From mehtaneeraj07 at gmail.com  Wed Sep 30 09:08:52 2015
From: mehtaneeraj07 at gmail.com (neeraj mehta)
Date: Wed, 30 Sep 2015 21:38:52 +0530
Subject: [ovs-discuss] unable to configure miss_send_len
Message-ID: <CAHN905JaQYW-t+a8okay5i4OO_oz61Sg2_i+2eUPFpy0832RaA@mail.gmail.com>

Hello Team,

I want to set miss_send_length in the configuration reply. But I am unable
to set it. Can you please verify below procedure.

 I am sending OFPT_SET_CONFIG using RYU req =
ofproto_v1_3_parser.OFPSetConfig(datapath, ofproto_v1_3.OFPC_FRAG_MASK,
65533)

After sending it, verify using ovs-vsctl –O Openflow13 show br0

OFPT_FEATURES_REPLY (OF1.3) (xid=0x2): dpid:0000000c298ab7fb
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS
OFPST_PORT_DESC reply (OF1.3) (xid=0x3):
1(eth1): addr:00:0c:29:8a:b7:fb
     config:     0
     state:      0
     current:    1GB-FD COPPER AUTO_NEG
     advertised: 10MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     speed: 1000 Mbps now, 1000 Mbps max
LOCAL(br0): addr:00:0c:29:8a:b7:fb
     config:     PORT_DOWN
     state:      LINK_DOWN
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (OF1.3) (xid=0x5): frags=nx-match miss_send_len=0


Sending  again OFPT_SET_CONFIG using RYU req =
ofproto_v1_3_parser.OFPSetConfig(datapath, ofproto_v1_3.OFPC_FRAG_DROP,
65532)

After sending it, verify using ovs-vsctl –O Openflow13 show br0

OFPT_FEATURES_REPLY (OF1.3) (xid=0x2): dpid:0000000c298ab7fb
n_tables:254, n_buffers:256
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS
OFPST_PORT_DESC reply (OF1.3) (xid=0x3):
1(eth1): addr:00:0c:29:8a:b7:fb
     config:     0
     state:      0
     current:    1GB-FD COPPER AUTO_NEG
     advertised: 10MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     supported:  10MB-HD 10MB-FD 100MB-HD 100MB-FD 1GB-FD COPPER AUTO_NEG
     speed: 1000 Mbps now, 1000 Mbps max
LOCAL(br0): addr:00:0c:29:8a:b7:fb
     config:     PORT_DOWN
     state:      LINK_DOWN
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (OF1.3) (xid=0x5): frags=drop miss_send_len=0


Can you please suggest me how to configure it.

Regards
Neeraj
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150930/034a7c9a/attachment-0001.html>

From blp at nicira.com  Wed Sep 30 09:11:42 2015
From: blp at nicira.com (Ben Pfaff)
Date: Wed, 30 Sep 2015 09:11:42 -0700
Subject: [ovs-discuss] unable to configure miss_send_len
In-Reply-To: <CAHN905JaQYW-t+a8okay5i4OO_oz61Sg2_i+2eUPFpy0832RaA@mail.gmail.com>
References: <CAHN905JaQYW-t+a8okay5i4OO_oz61Sg2_i+2eUPFpy0832RaA@mail.gmail.com>
Message-ID: <20150930161142.GH8052@nicira.com>

On Wed, Sep 30, 2015 at 09:38:52PM +0530, neeraj mehta wrote:
> I want to set miss_send_length in the configuration reply. But I am unable
> to set it. Can you please verify below procedure.

OVS maintains miss_send_len separately for each OpenFlow connection, so
your procedure of setting it through one connection and viewing it
through another won't work.

From daniel.swahn at clavister.com  Wed Sep 30 01:08:54 2015
From: daniel.swahn at clavister.com (Daniel Swahn)
Date: Wed, 30 Sep 2015 08:08:54 +0000
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <20150929185440.GJ30384@nicira.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <A156A809-F09E-4F30-B8DD-1ED5CAA32AB5@m3s.it>
 <20150929185440.GJ30384@nicira.com>
Message-ID: <99B444A2AB04944290142382BC3FB25AAAFB4C57@hermes.clavister.com>

> Daniel, can you suggest a way to reproduce the problem?

I have found that the crash can be reproduced using the following commands in my setup:

ovs-vsctl add-br management
ovs-vsctl set bridge management rstp_enable=true
ovs-vsctl add-port management base1
ovs-vsctl add-port management base2
sleep 2
ovs-vsctl del-port management base1
ovs-vsctl add-port management base1
ovs-vsctl del-port management base2
ovs-vsctl add-port management base2


I also keep seeing the following message at various stages during system boot-up:

"openvswitch: netlink: Key attribute has unexpected length (type=21, length=4, expected=0)."

Is that something I should be concerned about?


-----Original Message-----
From: Ben Pfaff [mailto:blp at nicira.com] 
Sent: 2015-09-29 20:55
To: Daniele Venturino; Daniel Swahn; Jarno Rajahalme
Cc: discuss at openvswitch.org
Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch

Please don't drop the mailing list.

Daniel, can you suggest a way to reproduce the problem?

On Tue, Sep 29, 2015 at 02:19:14PM +0200, Daniele Venturino wrote:
> I’m not sure.
> What’s the easiest way to replicate this?
> 
> Daniele
> 
> > Il giorno 29/set/2015, alle ore 06:13, Ben Pfaff <blp at nicira.com> ha scritto:
> > 
> > On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
> >> (gdb) frame 0
> >> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
> >> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
> > 
> > Thanks for the report.
> > 
> > Jarno and Daniele, the code around line 2278 in v2.4.0 is this:
> > 
> >        if (rstp_shift_root_learned_address(ofproto->rstp)) {
> >            bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
> >                        ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
> >            rstp_reset_root_changed(ofproto->rstp);
> >        }
> > 
> > Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' 
> > and 'new_root_aux'.  I don't see any code that clears them or 
> > updates them if something happens to invalidate them (that is, if a 
> > port gets deleted or if its aux gets updated).  I suspect that this 
> > may be the problem here.
> > 
> > Jarno or Daniele, can you confirm this?
> 

From daniel.swahn at clavister.com  Wed Sep 30 01:12:14 2015
From: daniel.swahn at clavister.com (Daniel Swahn)
Date: Wed, 30 Sep 2015 08:12:14 +0000
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
Message-ID: <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>

I tested with the patch but unfortunately the same crash occurs.

-----Original Message-----
From: Jarno Rajahalme [mailto:jrajahalme at nicira.com] 
Sent: 2015-09-29 23:10
To: Ben Pfaff
Cc: Daniel Swahn; Daniele Venturino; bugs at openvswitch.org
Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch


> On Sep 28, 2015, at 9:13 PM, Ben Pfaff <blp at nicira.com> wrote:
> 
> On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
>> (gdb) frame 0
>> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
>> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
> 
> Thanks for the report.
> 
> Jarno and Daniele, the code around line 2278 in v2.4.0 is this:
> 
>        if (rstp_shift_root_learned_address(ofproto->rstp)) {
>            bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>                        ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
>            rstp_reset_root_changed(ofproto->rstp);
>        }
> 
> Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' 
> and 'new_root_aux'.  I don't see any code that clears them or updates 
> them if something happens to invalidate them (that is, if a port gets 
> deleted or if its aux gets updated).  I suspect that this may be the 
> problem here.
> 
> Jarno or Daniele, can you confirm this?

I looked into this, and it may be that we fail to move the RSTP state machine when removing a port. In rstp_port_unref(), we are setting the port state to RSTP_DISABLED, but are then removing and freeing the port without triggering any change in the RSTP state machine, so if this port was the root, the root aux would still point to the deleted ofport.

Maybe this would help:


From diproiettod at vmware.com  Wed Sep 30 10:50:33 2015
From: diproiettod at vmware.com (Daniele Di Proietto)
Date: Wed, 30 Sep 2015 17:50:33 +0000
Subject: [ovs-discuss] how to get dpdk pmd's assigned per port.
In-Reply-To: <CAB8HAh7RmXw+CWTW-udHPGxg8iNOfN8PiwSnk72MoD_zBhtiqQ@mail.gmail.com>
References: <CAB8HAh7RmXw+CWTW-udHPGxg8iNOfN8PiwSnk72MoD_zBhtiqQ@mail.gmail.com>
Message-ID: <D231DC25.74D0%diproiettod@vmware.com>



On 30/09/2015 04:44, "David Evans" <davidjoshuaevans at gmail.com> wrote:

>Hi OVS (Ben particularly :) )
>
>How do i get OVS to assign ports to the PMD's that I choose?
>
>If i have say 6 or 12 ports and i want them distributed evenly across a
>mask of 12 or more cores on a multi node numa system / or where i know
>the NICs are on separate pci buses even what code do i touch to have more
>deterministic control over this.
>

Currently each pmd thread loads the rx queues from the NICs on its NUMA
socket.
If you create more than one pmd thread per NUMA socket, the queues will be
assigned in a round robin fashion.

The function that does this is pmd_load_queues(). It is called in
pmd_thread_main().

We're discussing a way to provide more control for the user.



>
>Cheers,
>
>
>Dave.
>
>
>
>


From davidjoshuaevans at gmail.com  Wed Sep 30 11:27:48 2015
From: davidjoshuaevans at gmail.com (David Evans)
Date: Wed, 30 Sep 2015 13:27:48 -0500
Subject: [ovs-discuss] how to get dpdk pmd's assigned per port.
In-Reply-To: <D231DC25.74D0%diproiettod@vmware.com>
References: <CAB8HAh7RmXw+CWTW-udHPGxg8iNOfN8PiwSnk72MoD_zBhtiqQ@mail.gmail.com>
 <D231DC25.74D0%diproiettod@vmware.com>
Message-ID: <D23191F7.33842%davidjoshuaevans@gmail.com>

Thank you Daniele.

I like the way the multi-queue round robin thing works,
I just need to be able to define the mask of cores for the dpdk port and
to be able to identify the primary one for managing timers or the tx queue.

I found it quite awkward to nail down a pmd lcore id to do
rte_timer_manage for each netdev.
The other_config¹ field would be ok for a start I guess.
You could set a mask for distributing the rxq¹s and a core number for the
lcore to tie the tx / other future netdev housekeeping( rte timer
management) to.

Regards,

Dave.



On 9/30/15, 12:50 PM, "Daniele Di Proietto" <diproiettod at vmware.com> wrote:

>
>
>On 30/09/2015 04:44, "David Evans" <davidjoshuaevans at gmail.com> wrote:
>
>>Hi OVS (Ben particularly :) )
>>
>>How do i get OVS to assign ports to the PMD's that I choose?
>>
>>If i have say 6 or 12 ports and i want them distributed evenly across a
>>mask of 12 or more cores on a multi node numa system / or where i know
>>the NICs are on separate pci buses even what code do i touch to have more
>>deterministic control over this.
>>
>
>Currently each pmd thread loads the rx queues from the NICs on its NUMA
>socket.
>If you create more than one pmd thread per NUMA socket, the queues will be
>assigned in a round robin fashion.
>
>The function that does this is pmd_load_queues(). It is called in
>pmd_thread_main().
>
>We're discussing a way to provide more control for the user.
>
>
>
>>
>>Cheers,
>>
>>
>>Dave.
>>
>>
>>
>>
>



From jrajahalme at nicira.com  Wed Sep 30 13:47:05 2015
From: jrajahalme at nicira.com (Jarno Rajahalme)
Date: Wed, 30 Sep 2015 13:47:05 -0700
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <99B444A2AB04944290142382BC3FB25AAAFB4D91@hermes.clavister.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
 <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
 <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
 <99B444A2AB04944290142382BC3FB25AAAFB4D91@hermes.clavister.com>
Message-ID: <1D5B7C93-C82A-4159-9551-F818231F4D11@nicira.com>

Daniel,

Did you try Daniele’s patch alone (i.e., without my patch). It seems to me that both patched should be necessary, but I’d like to know if you tried Daniele’s patch without mine to be sure.

  Jarno

> On Sep 30, 2015, at 3:45 AM, Daniel Swahn <daniel.swahn at clavister.com> wrote:
> 
> The issue seems to have been solved! I'm using yours and Jarno's patch and now the system boots up without crashes. Thanks!
> 
> -----Original Message-----
> From: Daniele Venturino [mailto:venturino.daniele at gmail.com] On Behalf Of Daniele Venturino
> Sent: 2015-09-30 10:54
> To: Daniel Swahn
> Cc: Jarno Rajahalme; Ben Pfaff; bugs at openvswitch.org
> Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch
> 
> I tried the commands you listed but I was not able to reproduce this in a simpler setup only with RSTP enabled on the bridge.
> 
> I’m attaching a patch I’d like you to try. I’m not really expecting much from it, but can you give it a try since I can’t reproduce this?
> 
> Daniele
> 


From jrajahalme at nicira.com  Wed Sep 30 13:48:21 2015
From: jrajahalme at nicira.com (Jarno Rajahalme)
Date: Wed, 30 Sep 2015 13:48:21 -0700
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
 <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
 <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
Message-ID: <F6780E6B-871A-4B71-959B-20DF8C411FD2@nicira.com>


> On Sep 30, 2015, at 1:54 AM, Daniele Venturino <daniele.venturino at m3s.it> wrote:
> 
> I tried the commands you listed but I was not able to reproduce this in a simpler setup only with RSTP enabled on the bridge.
> 
> I’m attaching a patch I’d like you to try. I’m not really expecting much from it, but can you give it a try since I can’t reproduce this?
> 
> Daniele
> 
> <0001-ofproto-dpif-Add-check-in-rstp_run.patch>
> 

Yes, NULLing the aux’es does not help without checking for NULL :-)

Acked-by: Jarno Rajahalme <jrajahalme at nicira.com>

>> Il giorno 30/set/2015, alle ore 10:12, Daniel Swahn <daniel.swahn at clavister.com> ha scritto:
>> 
>> I tested with the patch but unfortunately the same crash occurs.
>> 
>> -----Original Message-----
>> From: Jarno Rajahalme [mailto:jrajahalme at nicira.com] 
>> Sent: 2015-09-29 23:10
>> To: Ben Pfaff
>> Cc: Daniel Swahn; Daniele Venturino; bugs at openvswitch.org
>> Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch
>> 
>> 
>>> On Sep 28, 2015, at 9:13 PM, Ben Pfaff <blp at nicira.com> wrote:
>>> 
>>> On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
>>>> (gdb) frame 0
>>>> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
>>>> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>>> 
>>> Thanks for the report.
>>> 
>>> Jarno and Daniele, the code around line 2278 in v2.4.0 is this:
>>> 
>>>      if (rstp_shift_root_learned_address(ofproto->rstp)) {
>>>          bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>>>                      ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
>>>          rstp_reset_root_changed(ofproto->rstp);
>>>      }
>>> 
>>> Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' 
>>> and 'new_root_aux'.  I don't see any code that clears them or updates 
>>> them if something happens to invalidate them (that is, if a port gets 
>>> deleted or if its aux gets updated).  I suspect that this may be the 
>>> problem here.
>>> 
>>> Jarno or Daniele, can you confirm this?
>> 
>> I looked into this, and it may be that we fail to move the RSTP state machine when removing a port. In rstp_port_unref(), we are setting the port state to RSTP_DISABLED, but are then removing and freeing the port without triggering any change in the RSTP state machine, so if this port was the root, the root aux would still point to the deleted ofport.
>> 
>> Maybe this would help:
>> 
> 


From jrajahalme at nicira.com  Wed Sep 30 13:50:48 2015
From: jrajahalme at nicira.com (Jarno Rajahalme)
Date: Wed, 30 Sep 2015 13:50:48 -0700
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
 <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
 <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
Message-ID: <CD5B959E-FA45-4E10-8A64-709925C40AD4@nicira.com>

Daniele,

Could you review my patch (in combination with yours), i.e., reply with an Acked-by: if you think it is necessary, or reason why it is not needed or is not sufficient.

Regards,

  Jarno

> On Sep 30, 2015, at 1:54 AM, Daniele Venturino <daniele.venturino at m3s.it> wrote:
> 
> I tried the commands you listed but I was not able to reproduce this in a simpler setup only with RSTP enabled on the bridge.
> 
> I’m attaching a patch I’d like you to try. I’m not really expecting much from it, but can you give it a try since I can’t reproduce this?
> 
> Daniele
> 
> <0001-ofproto-dpif-Add-check-in-rstp_run.patch>
> 
>> Il giorno 30/set/2015, alle ore 10:12, Daniel Swahn <daniel.swahn at clavister.com> ha scritto:
>> 
>> I tested with the patch but unfortunately the same crash occurs.
>> 
>> -----Original Message-----
>> From: Jarno Rajahalme [mailto:jrajahalme at nicira.com] 
>> Sent: 2015-09-29 23:10
>> To: Ben Pfaff
>> Cc: Daniel Swahn; Daniele Venturino; bugs at openvswitch.org
>> Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch
>> 
>> 
>>> On Sep 28, 2015, at 9:13 PM, Ben Pfaff <blp at nicira.com> wrote:
>>> 
>>> On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
>>>> (gdb) frame 0
>>>> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
>>>> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>>> 
>>> Thanks for the report.
>>> 
>>> Jarno and Daniele, the code around line 2278 in v2.4.0 is this:
>>> 
>>>      if (rstp_shift_root_learned_address(ofproto->rstp)) {
>>>          bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>>>                      ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
>>>          rstp_reset_root_changed(ofproto->rstp);
>>>      }
>>> 
>>> Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' 
>>> and 'new_root_aux'.  I don't see any code that clears them or updates 
>>> them if something happens to invalidate them (that is, if a port gets 
>>> deleted or if its aux gets updated).  I suspect that this may be the 
>>> problem here.
>>> 
>>> Jarno or Daniele, can you confirm this?
>> 
>> I looked into this, and it may be that we fail to move the RSTP state machine when removing a port. In rstp_port_unref(), we are setting the port state to RSTP_DISABLED, but are then removing and freeing the port without triggering any change in the RSTP state machine, so if this port was the root, the root aux would still point to the deleted ofport.
>> 
>> Maybe this would help:
>> 
> 


From shettyg at nicira.com  Wed Sep 30 13:56:05 2015
From: shettyg at nicira.com (Gurucharan Shetty)
Date: Wed, 30 Sep 2015 13:56:05 -0700
Subject: [ovs-discuss] selinux and openvswitch
Message-ID: <CAHbON5remKmXfUf5OP2zN4N5ag2=2UnU44467efKQCtp7NN6mA@mail.gmail.com>

When I install openvswitch on RHEL-7 via RPM packages created from OVS
sources in github, the OVS service fails to start because it looks
like selinux prevents one from creating /etc/openvswitch.

Are there people that install OVS with SELINUX? How do you make it work?

From daniele.venturino at m3s.it  Wed Sep 30 14:00:21 2015
From: daniele.venturino at m3s.it (Daniele Venturino)
Date: Wed, 30 Sep 2015 23:00:21 +0200
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <CD5B959E-FA45-4E10-8A64-709925C40AD4@nicira.com>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
 <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
 <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
 <CD5B959E-FA45-4E10-8A64-709925C40AD4@nicira.com>
Message-ID: <F1A0FB51-B640-4604-B841-A9ADA1689CE2@m3s.it>

Hi Jarno,
I’ve seen your patch and although your suggestions look reasonable, I fear changing rstp_unref() like that. The reason is that I no longer have access to the IXIA validation suite and all these calls:
rstp_port_set_aux(rp, NULL);
rstp_port_set_state(rp, RSTP_DISABLED);
rstp_port_set_mac_operational(rp, false);
update_rstp_port_state(of port);
might have a strong effect on the behavior of the protocol that I can’t test as I’d like to.

For this reason I, like you, would like to know if Daniel tried my patch alone, since it introduces only an initialization and a check on old_root_aux and new_root_aux.

Daniele

> Il giorno 30/set/2015, alle ore 22:50, Jarno Rajahalme <jrajahalme at nicira.com> ha scritto:
> 
> Daniele,
> 
> Could you review my patch (in combination with yours), i.e., reply with an Acked-by: if you think it is necessary, or reason why it is not needed or is not sufficient.
> 
> Regards,
> 
>  Jarno
> 
>> On Sep 30, 2015, at 1:54 AM, Daniele Venturino <daniele.venturino at m3s.it> wrote:
>> 
>> I tried the commands you listed but I was not able to reproduce this in a simpler setup only with RSTP enabled on the bridge.
>> 
>> I’m attaching a patch I’d like you to try. I’m not really expecting much from it, but can you give it a try since I can’t reproduce this?
>> 
>> Daniele
>> 
>> <0001-ofproto-dpif-Add-check-in-rstp_run.patch>
>> 
>>> Il giorno 30/set/2015, alle ore 10:12, Daniel Swahn <daniel.swahn at clavister.com> ha scritto:
>>> 
>>> I tested with the patch but unfortunately the same crash occurs.
>>> 
>>> -----Original Message-----
>>> From: Jarno Rajahalme [mailto:jrajahalme at nicira.com] 
>>> Sent: 2015-09-29 23:10
>>> To: Ben Pfaff
>>> Cc: Daniel Swahn; Daniele Venturino; bugs at openvswitch.org
>>> Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch
>>> 
>>> 
>>>> On Sep 28, 2015, at 9:13 PM, Ben Pfaff <blp at nicira.com> wrote:
>>>> 
>>>> On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
>>>>> (gdb) frame 0
>>>>> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
>>>>> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>>>> 
>>>> Thanks for the report.
>>>> 
>>>> Jarno and Daniele, the code around line 2278 in v2.4.0 is this:
>>>> 
>>>>     if (rstp_shift_root_learned_address(ofproto->rstp)) {
>>>>         bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>>>>                     ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
>>>>         rstp_reset_root_changed(ofproto->rstp);
>>>>     }
>>>> 
>>>> Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' 
>>>> and 'new_root_aux'.  I don't see any code that clears them or updates 
>>>> them if something happens to invalidate them (that is, if a port gets 
>>>> deleted or if its aux gets updated).  I suspect that this may be the 
>>>> problem here.
>>>> 
>>>> Jarno or Daniele, can you confirm this?
>>> 
>>> I looked into this, and it may be that we fail to move the RSTP state machine when removing a port. In rstp_port_unref(), we are setting the port state to RSTP_DISABLED, but are then removing and freeing the port without triggering any change in the RSTP state machine, so if this port was the root, the root aux would still point to the deleted ofport.
>>> 
>>> Maybe this would help:
>>> 
>> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150930/3dcfc015/attachment-0001.html>

From daniele.venturino at m3s.it  Wed Sep 30 14:19:46 2015
From: daniele.venturino at m3s.it (Daniele Venturino)
Date: Wed, 30 Sep 2015 23:19:46 +0200
Subject: [ovs-discuss] RSTP crash in Open vSwitch
In-Reply-To: <F1A0FB51-B640-4604-B841-A9ADA1689CE2@m3s.it>
References: <99B444A2AB04944290142382BC3FB25AAAFAFD8D@hermes.clavister.com>
 <20150929041353.GF29366@nicira.com>
 <B89E83A0-D0CF-4941-B010-B9A7EA98316B@nicira.com>
 <99B444A2AB04944290142382BC3FB25AAAFB4C6E@hermes.clavister.com>
 <FA1AA9CD-8833-4049-8D7A-4D361A0C8A0F@m3s.it>
 <CD5B959E-FA45-4E10-8A64-709925C40AD4@nicira.com>
 <F1A0FB51-B640-4604-B841-A9ADA1689CE2@m3s.it>
Message-ID: <1B1F7D8E-CA78-4629-9529-32494F30572B@m3s.it>

Sorry, I was speaking of changing set_rstp_port() of course.
Anyway, my concerns on those additions remain.

Daniele


> Il giorno 30/set/2015, alle ore 23:00, Daniele Venturino <daniele.venturino at m3s.it> ha scritto:
> 
> Hi Jarno,
> I’ve seen your patch and although your suggestions look reasonable, I fear changing rstp_unref() like that. The reason is that I no longer have access to the IXIA validation suite and all these calls:
> rstp_port_set_aux(rp, NULL);
> rstp_port_set_state(rp, RSTP_DISABLED);
> rstp_port_set_mac_operational(rp, false);
> update_rstp_port_state(of port);
> might have a strong effect on the behavior of the protocol that I can’t test as I’d like to.
> 
> For this reason I, like you, would like to know if Daniel tried my patch alone, since it introduces only an initialization and a check on old_root_aux and new_root_aux.
> 
> Daniele
> 
>> Il giorno 30/set/2015, alle ore 22:50, Jarno Rajahalme <jrajahalme at nicira.com <mailto:jrajahalme at nicira.com>> ha scritto:
>> 
>> Daniele,
>> 
>> Could you review my patch (in combination with yours), i.e., reply with an Acked-by: if you think it is necessary, or reason why it is not needed or is not sufficient.
>> 
>> Regards,
>> 
>>  Jarno
>> 
>>> On Sep 30, 2015, at 1:54 AM, Daniele Venturino <daniele.venturino at m3s.it <mailto:daniele.venturino at m3s.it>> wrote:
>>> 
>>> I tried the commands you listed but I was not able to reproduce this in a simpler setup only with RSTP enabled on the bridge.
>>> 
>>> I’m attaching a patch I’d like you to try. I’m not really expecting much from it, but can you give it a try since I can’t reproduce this?
>>> 
>>> Daniele
>>> 
>>> <0001-ofproto-dpif-Add-check-in-rstp_run.patch>
>>> 
>>>> Il giorno 30/set/2015, alle ore 10:12, Daniel Swahn <daniel.swahn at clavister.com <mailto:daniel.swahn at clavister.com>> ha scritto:
>>>> 
>>>> I tested with the patch but unfortunately the same crash occurs.
>>>> 
>>>> -----Original Message-----
>>>> From: Jarno Rajahalme [mailto:jrajahalme at nicira.com <mailto:jrajahalme at nicira.com>] 
>>>> Sent: 2015-09-29 23:10
>>>> To: Ben Pfaff
>>>> Cc: Daniel Swahn; Daniele Venturino; bugs at openvswitch.org <mailto:bugs at openvswitch.org>
>>>> Subject: Re: [ovs-discuss] RSTP crash in Open vSwitch
>>>> 
>>>> 
>>>>> On Sep 28, 2015, at 9:13 PM, Ben Pfaff <blp at nicira.com <mailto:blp at nicira.com>> wrote:
>>>>> 
>>>>> On Wed, Sep 23, 2015 at 11:31:31AM +0000, Daniel Swahn wrote:
>>>>>> (gdb) frame 0
>>>>>> #0  0x00000000004291ca in rstp_run (ofproto=<optimized out>, ofproto=<optimized out>) at ofproto/ofproto-dpif.c:2278
>>>>>> 2278                bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>>>>> 
>>>>> Thanks for the report.
>>>>> 
>>>>> Jarno and Daniele, the code around line 2278 in v2.4.0 is this:
>>>>> 
>>>>>     if (rstp_shift_root_learned_address(ofproto->rstp)) {
>>>>>         bundle_move(((struct ofport_dpif *)rstp_get_old_root_aux(ofproto->rstp))->bundle,
>>>>>                     ((struct ofport_dpif *)rstp_get_new_root_aux(ofproto->rstp))->bundle);
>>>>>         rstp_reset_root_changed(ofproto->rstp);
>>>>>     }
>>>>> 
>>>>> Looking at lib/rstp*.[ch], I see some code that sets 'old_root_aux' 
>>>>> and 'new_root_aux'.  I don't see any code that clears them or updates 
>>>>> them if something happens to invalidate them (that is, if a port gets 
>>>>> deleted or if its aux gets updated).  I suspect that this may be the 
>>>>> problem here.
>>>>> 
>>>>> Jarno or Daniele, can you confirm this?
>>>> 
>>>> I looked into this, and it may be that we fail to move the RSTP state machine when removing a port. In rstp_port_unref(), we are setting the port state to RSTP_DISABLED, but are then removing and freeing the port without triggering any change in the RSTP state machine, so if this port was the root, the root aux would still point to the deleted ofport.
>>>> 
>>>> Maybe this would help:
>>>> 
>>> 
>> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://openvswitch.org/pipermail/discuss/attachments/20150930/ca0d397a/attachment.html>

From jesse at nicira.com  Wed Sep 30 17:06:18 2015
From: jesse at nicira.com (Jesse Gross)
Date: Wed, 30 Sep 2015 17:06:18 -0700
Subject: [ovs-discuss] [PATCH-RFC 1/2] Improve ARP latency
In-Reply-To: <20150930015039.Horde.By710uU5wzMPGcKhA46ZaA1@ltc.linux.ibm.com>
References: <20150930015039.Horde.By710uU5wzMPGcKhA46ZaA1@ltc.linux.ibm.com>
Message-ID: <CAEP_g=9K69Muo2xBh8u_ypO2eriiKJvUL73PEXYNa7bKDenSKw@mail.gmail.com>

On Tue, Sep 29, 2015 at 10:50 PM,  <dwilder at us.ibm.com> wrote:
> Hi-
>
> I have been conducting scaling tests with OVS and docker. My tests revealed
> that the latency of ARP packets can become very large resulting in many ARP
> re-transmissions and time-outs. I found the source of the poor latency to be
> with the handling of arp packets in ovs_vport_find_upcall_portid().  Each
> packet is hashed in ovs_vport_find_upcall_portid() by calling
> skb_get_hash().  This hash is used to select a netlink socket in which to
> send the packet to userspace.  However, skb_get_hash() is not supporting ARP
> packets returning a 0 (invalid hash) for every ARP.  This results in a
> single ovs-vswitchd handler thread processing every arp packet thus severely
> impacting the average latency of ARPs. I am purposing a change to
> ovs_vport_find_upcall_portid() that spreads the ARP packets evenly between
> all the handler threads (patch to follow).  Please let me know if you have
> suggestions/comments.

This is definitely an interesting analysis but I'm a little surprised
at the basic scenario. First, I guess it seems to me that the L2
domain is too large if there are this many ARPs. The speed also
generally seems slower than I would expect but in any case I don't
disagree that it is better to spread the load among all the cores.

On the patch itself, can't we just make skb_get_hash() be able to
decode ARP? It seems like that is cleaner and more generic.

